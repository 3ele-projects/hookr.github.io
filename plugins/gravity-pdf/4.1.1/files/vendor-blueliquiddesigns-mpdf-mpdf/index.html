<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="4.1.1" data-slug="gravity-pdf" data-type="file" data-id="21309"><head xmlns="http://www.w3.org/1999/xhtml"><title> vendor-blueliquiddesigns-mpdf-mpdf | file | Gravity Pdf | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, gravity-pdf, 4.1.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=9f6808baeb400c6405b731affbaf5c0f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/vendor-blueliquiddesigns-mpdf-mpdf/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fvendor-blueliquiddesigns-mpdf-mpdf%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fvendor-blueliquiddesigns-mpdf-mpdf%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-gravity-pdf-4.1.1-file-vendor-blueliquiddesigns-mpdf-mpdf","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="vendor-blueliquiddesigns-mpdf-mpdf" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to gravity-pdf." href="http://hookr.io/plugins/gravity-pdf/" class="plugin"><span property="name">gravity-pdf</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.1.1." href="http://hookr.io/plugins/gravity-pdf/4.1.1/" class="H_VERSION"><span property="name">4.1.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/gravity-pdf/4.1.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">vendor-blueliquiddesigns-mpdf&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="696"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/all/" title="All">All <span class="count badge">696</span></a></li><li class="" data-id="new" data-count="2"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/new/" title="New">New <span class="count badge">2</span></a></li><li class="" data-id="hooks" data-count="177"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/hooks/" title="Hooks">Hooks <span class="count badge">177</span></a></li><li class="" data-id="action" data-count="15"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/actions/" title="Actions">Actions <span class="count badge">15</span></a></li><li class="" data-id="filter" data-count="162"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/filters/" title="Filters">Filters <span class="count badge">162</span></a></li><li class="" data-id="class" data-count="411"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/classes/" title="Classes">Classes <span class="count badge">411</span></a></li><li class="" data-id="constant" data-count="64"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/constants/" title="Constants">Constants <span class="count badge">64</span></a></li><li class="" data-id="function" data-count="43"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/functions/" title="Functions">Functions <span class="count badge">43</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/vendor/blueliquiddesigns/mpdf/mpdf.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>********************************************</span></span>&nbsp;</div></li><li><div><span class="comment">// Software: mPDF, Unicode-HTML Free PDF generator                              *</span>&nbsp;</div></li><li><div><span class="comment">// Version:  6.1        based on                                                *</span>&nbsp;</div></li><li><div><span class="comment">//           FPDF by Olivier PLATHEY                                            *</span>&nbsp;</div></li><li><div><span class="comment">//           HTML2FPDF by Renato Coelho                                         *</span>&nbsp;</div></li><li><div><span class="comment">// Date:     2016-03-25                                                         *</span>&nbsp;</div></li><li><div><span class="comment">// Author:   Ian Back &lt;ianb@bpm1.com&gt;                                           *</span>&nbsp;</div></li><li><div><span class="comment">// License:  GPL                                                                *</span>&nbsp;</div></li><li><div><span class="comment">//                                                                              *</span>&nbsp;</div></li><li><div><span class="comment">// Changes:  See changelog.txt                                                  *</span>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>********************************************</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>define('mPDF_VERSION', '6.1');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//Scale factor</span>&nbsp;</div></li><li><div>define('_MPDFK', (72 / 25.4));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Specify which font metrics to use:</span>&nbsp;</div></li><li><div><span class="comment">// 'winTypo' uses sTypoAscender etc from the OS/2 table and is the one usually recommended - BUT</span>&nbsp;</div></li><li><div><span class="comment">// 'win' use WinAscent etc from OS/2 and inpractice seems to be used more commonly in Windows environment</span>&nbsp;</div></li><li><div><span class="comment">// 'mac' uses Ascender etc from hhea table, and is used on Mac/OSX environment</span>&nbsp;</div></li><li><div>if (!defined('_FONT_DESCRIPTOR')) {&nbsp;</div></li><li><div>  define(&quot;_FONT_DESCRIPTOR&quot;, 'win'); <span class="comment">// Values: '' [BLANK] or 'win', 'mac', 'winTypo'</span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>define('_BORDER_ALL', 15);&nbsp;</div></li><li><div>define('_BORDER_TOP', 8);&nbsp;</div></li><li><div>define('_BORDER_RIGHT', 4);&nbsp;</div></li><li><div>define('_BORDER_BOTTOM', 2);&nbsp;</div></li><li><div>define('_BORDER_LEFT', 1);&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>.0</span></span></span></span></span>&nbsp;</div></li><li><div><span class="comment">// Used for $textvars - user settings via CSS</span>&nbsp;</div></li><li><div>define('FD_UNDERLINE', 1); <span class="comment">// font-decoration</span>&nbsp;</div></li><li><div>define('FD_LINETHROUGH', 2);&nbsp;</div></li><li><div>define('FD_OVERLINE', 4);&nbsp;</div></li><li><div>define('FA_SUPERSCRIPT', 8); <span class="comment">// font-(vertical)-align</span>&nbsp;</div></li><li><div>define('FA_SUBSCRIPT', 16);&nbsp;</div></li><li><div>define('FT_UPPERCASE', 32); <span class="comment">// font-transform</span>&nbsp;</div></li><li><div>define('FT_LOWERCASE', 64);&nbsp;</div></li><li><div>define('FT_CAPITALIZE', 128);&nbsp;</div></li><li><div>define('FC_KERNING', 256); <span class="comment">// font-(other)-controls</span>&nbsp;</div></li><li><div>define('FC_SMALLCAPS', 512);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!defined('_MPDF_PATH')) {&nbsp;</div></li><li><div>  define('_MPDF_PATH', dirname(preg_replace('/\\\\/', '/', __FILE__)) . '/');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!defined('_MPDF_URI')) {&nbsp;</div></li><li><div>  define('_MPDF_URI', _MPDF_PATH);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>require_once _MPDF_PATH . 'includes/functions.php';&nbsp;</div></li><li><div>require_once _MPDF_PATH . 'config_lang2fonts.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>require_once _MPDF_PATH . 'classes/ucdn.php'; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>.0</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>require_once _MPDF_PATH . 'classes/indic.php'; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>.0</span></span></span></span></span>&nbsp;</div></li><li><div>require_once _MPDF_PATH . 'classes/myanmar.php'; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>.0</span></span></span></span></span>&nbsp;</div></li><li><div>require_once _MPDF_PATH . 'classes/sea.php'; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>.0</span></span></span></span></span>&nbsp;</div></li><li><div><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>require_once _MPDF_PATH . 'Tag.php';&nbsp;</div></li><li><div>require_once _MPDF_PATH . 'WordPress.php';&nbsp;</div></li><li><div>require_once _MPDF_PATH . 'MpdfException.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!defined('_JPGRAPH_PATH')) {&nbsp;</div></li><li><div>  define(&quot;_JPGRAPH_PATH&quot;, apply_filters('mpdf_jgraph_path', _MPDF_PATH . 'jpgraph/'));&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!defined('_MPDF_TEMP_PATH')) {&nbsp;</div></li><li><div>  define(&quot;_MPDF_TEMP_PATH&quot;, apply_filters('mpdf_tmp_path', _MPDF_PATH.'tmp/'));&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!defined('_MPDF_TTFONTPATH')) {&nbsp;</div></li><li><div>  define('_MPDF_TTFONTPATH', apply_filters('mpdf_font_path', _MPDF_PATH.'ttfonts/'));&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!defined('_MPDF_TTFONTDATAPATH')) {&nbsp;</div></li><li><div>  define('_MPDF_TTFONTDATAPATH', apply_filters('mpdf_fontdata_path', _MPDF_PATH.'ttfontdata/'));&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$errorlevel = error_reporting();&nbsp;</div></li><li><div>$errorlevel = error_reporting($errorlevel & ~E_NOTICE);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!function_exists('mb_strlen')) {&nbsp;</div></li><li><div>  throw new MpdfException('mPDF requires mb_string functions. Ensure that mb_string extension is loaded.');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!defined('PHP_VERSION_ID')) {&nbsp;</div></li><li><div>  $version = explode('.', PHP_VERSION);&nbsp;</div></li><li><div>  define('PHP_VERSION_ID', ($version[0] * 10000 + $version[1] * 100 + $version[2]));&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class mPDF&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>&nbsp;</div></li><li><div>  <span class="comment">// EXTERNAL (PUBLIC) VARIABLES</span>&nbsp;</div></li><li><div>  <span class="comment">// Define these in config.php</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>&nbsp;</div></li><li><div>  var $useFixedNormalLineHeight; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $useFixedTextBaseline; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $adjustFontDescLineheight; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $interpolateImages; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $defaultPagebreakType; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>  var $indexUseSubentries; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $autoScriptToLang; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $baseScript; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $autoVietnamese; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $autoArabic; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $CJKforceend;&nbsp;</div></li><li><div>  var $h2bookmarks;&nbsp;</div></li><li><div>  var $h2toc;&nbsp;</div></li><li><div>  var $decimal_align;&nbsp;</div></li><li><div>  var $margBuffer;&nbsp;</div></li><li><div>  var $splitTableBorderWidth;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $bookmarkStyles;&nbsp;</div></li><li><div>  var $useActiveForms;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $repackageTTF;&nbsp;</div></li><li><div>  var $allowCJKorphans;&nbsp;</div></li><li><div>  var $allowCJKoverflow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $useKerning;&nbsp;</div></li><li><div>  var $restrictColorSpace;&nbsp;</div></li><li><div>  var $bleedMargin;&nbsp;</div></li><li><div>  var $crossMarkMargin;&nbsp;</div></li><li><div>  var $cropMarkMargin;&nbsp;</div></li><li><div>  var $cropMarkLength;&nbsp;</div></li><li><div>  var $nonPrintMargin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $PDFX;&nbsp;</div></li><li><div>  var $PDFXauto;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $PDFA;&nbsp;</div></li><li><div>  var $PDFAauto;&nbsp;</div></li><li><div>  var $ICCProfile;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $printers_info;&nbsp;</div></li><li><div>  var $iterationCounter;&nbsp;</div></li><li><div>  var $smCapsScale;&nbsp;</div></li><li><div>  var $smCapsStretch;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $backupSubsFont;&nbsp;</div></li><li><div>  var $backupSIPFont;&nbsp;</div></li><li><div>  var $debugfonts;&nbsp;</div></li><li><div>  var $useAdobeCJK;&nbsp;</div></li><li><div>  var $percentSubset;&nbsp;</div></li><li><div>  var $maxTTFFilesize;&nbsp;</div></li><li><div>  var $BMPonly;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $tableMinSizePriority;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $dpi;&nbsp;</div></li><li><div>  var $watermarkImgAlphaBlend;&nbsp;</div></li><li><div>  var $watermarkImgBehind;&nbsp;</div></li><li><div>  var $justifyB4br;&nbsp;</div></li><li><div>  var $packTableData;&nbsp;</div></li><li><div>  var $pgsIns;&nbsp;</div></li><li><div>  var $simpleTables;&nbsp;</div></li><li><div>  var $enableImports;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $debug;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $showStats;&nbsp;</div></li><li><div>  var $setAutoTopMargin;&nbsp;</div></li><li><div>  var $setAutoBottomMargin;&nbsp;</div></li><li><div>  var $autoMarginPadding;&nbsp;</div></li><li><div>  var $collapseBlockMargins;&nbsp;</div></li><li><div>  var $falseBoldWeight;&nbsp;</div></li><li><div>  var $normalLineheight;&nbsp;</div></li><li><div>  var $incrementFPR1;&nbsp;</div></li><li><div>  var $incrementFPR2;&nbsp;</div></li><li><div>  var $incrementFPR3;&nbsp;</div></li><li><div>  var $incrementFPR4;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $SHYlang;&nbsp;</div></li><li><div>  var $SHYleftmin;&nbsp;</div></li><li><div>  var $SHYrightmin;&nbsp;</div></li><li><div>  var $SHYcharmin;&nbsp;</div></li><li><div>  var $SHYcharmax;&nbsp;</div></li><li><div>  var $SHYlanguages;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// PageNumber Conditional Text</span>&nbsp;</div></li><li><div>  var $pagenumPrefix;&nbsp;</div></li><li><div>  var $pagenumSuffix;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $nbpgPrefix;&nbsp;</div></li><li><div>  var $nbpgSuffix;&nbsp;</div></li><li><div>  var $showImageErrors;&nbsp;</div></li><li><div>  var $allow_output_buffering;&nbsp;</div></li><li><div>  var $autoPadding;&nbsp;</div></li><li><div>  var $useGraphs;&nbsp;</div></li><li><div>  var $tabSpaces;&nbsp;</div></li><li><div>  var $autoLangToFont;&nbsp;</div></li><li><div>  var $watermarkTextAlpha;&nbsp;</div></li><li><div>  var $watermarkImageAlpha;&nbsp;</div></li><li><div>  var $watermark_size;&nbsp;</div></li><li><div>  var $watermark_pos;&nbsp;</div></li><li><div>  var $annotSize;&nbsp;</div></li><li><div>  var $annotMargin;&nbsp;</div></li><li><div>  var $annotOpacity;&nbsp;</div></li><li><div>  var $title2annots;&nbsp;</div></li><li><div>  var $keepColumns;&nbsp;</div></li><li><div>  var $keep_table_proportions;&nbsp;</div></li><li><div>  var $ignore_table_widths;&nbsp;</div></li><li><div>  var $ignore_table_percents;&nbsp;</div></li><li><div>  var $list_number_suffix;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $list_auto_mode; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $list_indent_first_level; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $list_indent_default; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $list_marker_offset; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $useSubstitutions;&nbsp;</div></li><li><div>  var $CSSselectMedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $forcePortraitHeaders;&nbsp;</div></li><li><div>  var $forcePortraitMargins;&nbsp;</div></li><li><div>  var $displayDefaultOrientation;&nbsp;</div></li><li><div>  var $ignore_invalid_utf8;&nbsp;</div></li><li><div>  var $allowedCSStags;&nbsp;</div></li><li><div>  var $onlyCoreFonts;&nbsp;</div></li><li><div>  var $allow_charset_conversion;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $jSWord;&nbsp;</div></li><li><div>  var $jSmaxChar;&nbsp;</div></li><li><div>  var $jSmaxCharLast;&nbsp;</div></li><li><div>  var $jSmaxWordLast;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $max_colH_correction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $table_error_report;&nbsp;</div></li><li><div>  var $table_error_report_param;&nbsp;</div></li><li><div>  var $biDirectional;&nbsp;</div></li><li><div>  var $text_input_as_HTML;&nbsp;</div></li><li><div>  var $anchor2Bookmark;&nbsp;</div></li><li><div>  var $shrink_tables_to_fit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $allow_html_optional_endtags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $img_dpi;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $defaultheaderfontsize;&nbsp;</div></li><li><div>  var $defaultheaderfontstyle;&nbsp;</div></li><li><div>  var $defaultheaderline;&nbsp;</div></li><li><div>  var $defaultfooterfontsize;&nbsp;</div></li><li><div>  var $defaultfooterfontstyle;&nbsp;</div></li><li><div>  var $defaultfooterline;&nbsp;</div></li><li><div>  var $header_line_spacing;&nbsp;</div></li><li><div>  var $footer_line_spacing;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $pregCJKchars;&nbsp;</div></li><li><div>  var $pregRTLchars;&nbsp;</div></li><li><div>  var $pregCURSchars; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $mirrorMargins;&nbsp;</div></li><li><div>  var $watermarkText;&nbsp;</div></li><li><div>  var $watermarkImage;&nbsp;</div></li><li><div>  var $showWatermarkText;&nbsp;</div></li><li><div>  var $showWatermarkImage;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $fontsizes;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $defaultPageNumStyle; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment">// CLASS OBJECTS</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>&nbsp;</div></li><li><div>  var $otl; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $cssmgr;&nbsp;</div></li><li><div>  var $grad;&nbsp;</div></li><li><div>  var $bmp;&nbsp;</div></li><li><div>  var $wmf;&nbsp;</div></li><li><div>  var $tocontents;&nbsp;</div></li><li><div>  var $mpdfform;&nbsp;</div></li><li><div>  var $directw;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment">// INTERNAL VARIABLES</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>&nbsp;</div></li><li><div>  var $script2lang;&nbsp;</div></li><li><div>  var $viet;&nbsp;</div></li><li><div>  var $pashto;&nbsp;</div></li><li><div>  var $urdu;&nbsp;</div></li><li><div>  var $persian;&nbsp;</div></li><li><div>  var $sindhi;&nbsp;</div></li><li><div>  var $extrapagebreak; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $uniqstr; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>  var $hasOC;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $textvar; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $fontLanguageOverride; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $OTLtags; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  var $OTLdata;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $writingToC;&nbsp;</div></li><li><div>  var $layers;&nbsp;</div></li><li><div>  var $current_layer;&nbsp;</div></li><li><div>  var $open_layer_pane;&nbsp;</div></li><li><div>  var $decimal_offset;&nbsp;</div></li><li><div>  var $inMeter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $CJKleading;&nbsp;</div></li><li><div>  var $CJKfollowing;&nbsp;</div></li><li><div>  var $CJKoverflow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $textshadow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $colsums;&nbsp;</div></li><li><div>  var $spanborder;&nbsp;</div></li><li><div>  var $spanborddet;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $visibility;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $useRC128encryption;&nbsp;</div></li><li><div>  var $uniqid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $kerning;&nbsp;</div></li><li><div>  var $fixedlSpacing;&nbsp;</div></li><li><div>  var $minwSpacing;&nbsp;</div></li><li><div>  var $lSpacingCSS;&nbsp;</div></li><li><div>  var $wSpacingCSS;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $spotColorIDs;&nbsp;</div></li><li><div>  var $SVGcolors;&nbsp;</div></li><li><div>  var $spotColors;&nbsp;</div></li><li><div>  var $defTextColor;&nbsp;</div></li><li><div>  var $defDrawColor;&nbsp;</div></li><li><div>  var $defFillColor;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $tableBackgrounds;&nbsp;</div></li><li><div>  var $inlineDisplayOff;&nbsp;</div></li><li><div>  var $kt_y00;&nbsp;</div></li><li><div>  var $kt_p00;&nbsp;</div></li><li><div>  var $upperCase;&nbsp;</div></li><li><div>  var $checkSIP;&nbsp;</div></li><li><div>  var $checkSMP;&nbsp;</div></li><li><div>  var $checkCJK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $watermarkImgAlpha;&nbsp;</div></li><li><div>  var $PDFAXwarnings;&nbsp;</div></li><li><div>  var $MetadataRoot;&nbsp;</div></li><li><div>  var $OutputIntentRoot;&nbsp;</div></li><li><div>  var $InfoRoot;&nbsp;</div></li><li><div>  var $current_filename;&nbsp;</div></li><li><div>  var $parsers;&nbsp;</div></li><li><div>  var $current_parser;&nbsp;</div></li><li><div>  var $_obj_stack;&nbsp;</div></li><li><div>  var $_don_obj_stack;&nbsp;</div></li><li><div>  var $_current_obj_id;&nbsp;</div></li><li><div>  var $tpls;&nbsp;</div></li><li><div>  var $tpl;&nbsp;</div></li><li><div>  var $tplprefix;&nbsp;</div></li><li><div>  var $_res;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $pdf_version;&nbsp;</div></li><li><div>  var $noImageFile;&nbsp;</div></li><li><div>  var $lastblockbottommargin;&nbsp;</div></li><li><div>  var $baselineC;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>  var $baselineSup;&nbsp;</div></li><li><div>  var $baselineSub;&nbsp;</div></li><li><div>  var $baselineS;&nbsp;</div></li><li><div>  var $subPos;&nbsp;</div></li><li><div>  var $subArrMB;&nbsp;</div></li><li><div>  var $ReqFontStyle;&nbsp;</div></li><li><div>  var $tableClipPath;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $fullImageHeight;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $inFixedPosBlock;  <span class="comment">// Internal flag for position:fixed block</span>&nbsp;</div></li><li><div>  var $fixedPosBlock;  <span class="comment">// Buffer string for position:fixed block</span>&nbsp;</div></li><li><div>  var $fixedPosBlockDepth;&nbsp;</div></li><li><div>  var $fixedPosBlockBBox;&nbsp;</div></li><li><div>  var $fixedPosBlockSave;&nbsp;</div></li><li><div>  var $maxPosL;&nbsp;</div></li><li><div>  var $maxPosR;&nbsp;</div></li><li><div>  var $loaded;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $extraFontSubsets;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $docTemplateStart;  <span class="comment">// Internal flag for page (page no. -1) that docTemplate starts on</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $time0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Classes</span>&nbsp;</div></li><li><div>  var $indic;&nbsp;</div></li><li><div>  var $barcode;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $SHYpatterns;&nbsp;</div></li><li><div>  var $loadedSHYpatterns;&nbsp;</div></li><li><div>  var $loadedSHYdictionary;&nbsp;</div></li><li><div>  var $SHYdictionary;&nbsp;</div></li><li><div>  var $SHYdictionaryWords;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $spanbgcolorarray;&nbsp;</div></li><li><div>  var $default_font;&nbsp;</div></li><li><div>  var $headerbuffer;&nbsp;</div></li><li><div>  var $lastblocklevelchange;&nbsp;</div></li><li><div>  var $nestedtablejustfinished;&nbsp;</div></li><li><div>  var $linebreakjustfinished;&nbsp;</div></li><li><div>  var $cell_border_dominance_L;&nbsp;</div></li><li><div>  var $cell_border_dominance_R;&nbsp;</div></li><li><div>  var $cell_border_dominance_T;&nbsp;</div></li><li><div>  var $cell_border_dominance_B;&nbsp;</div></li><li><div>  var $table_keep_together;&nbsp;</div></li><li><div>  var $plainCell_properties;&nbsp;</div></li><li><div>  var $shrin_k1;&nbsp;</div></li><li><div>  var $outerfilled;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $blockContext;&nbsp;</div></li><li><div>  var $floatDivs;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $patterns;&nbsp;</div></li><li><div>  var $pageBackgrounds;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $bodyBackgroundGradient;&nbsp;</div></li><li><div>  var $bodyBackgroundImage;&nbsp;</div></li><li><div>  var $bodyBackgroundColor;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $writingHTMLheader; <span class="comment"><span class="comment"><span class="comment">// internal flag - used both for writing HTMLHeaders/Footers and FixedPos block</span></span></span>&nbsp;</div></li><li><div>  var $writingHTMLfooter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $angle;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $gradients;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $kwt_Reference;&nbsp;</div></li><li><div>  var $kwt_BMoutlines;&nbsp;</div></li><li><div>  var $kwt_toc;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $tbrot_BMoutlines;&nbsp;</div></li><li><div>  var $tbrot_toc;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $col_BMoutlines;&nbsp;</div></li><li><div>  var $col_toc;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $currentGraphId;&nbsp;</div></li><li><div>  var $graphs;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $floatbuffer;&nbsp;</div></li><li><div>  var $floatmargins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $bullet;&nbsp;</div></li><li><div>  var $bulletarray;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $currentLang;&nbsp;</div></li><li><div>  var $default_lang;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $default_available_fonts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $pageTemplate;&nbsp;</div></li><li><div>  var $docTemplate;&nbsp;</div></li><li><div>  var $docTemplateContinue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $arabGlyphs;&nbsp;</div></li><li><div>  var $arabHex;&nbsp;</div></li><li><div>  var $persianGlyphs;&nbsp;</div></li><li><div>  var $persianHex;&nbsp;</div></li><li><div>  var $arabVowels;&nbsp;</div></li><li><div>  var $arabPrevLink;&nbsp;</div></li><li><div>  var $arabNextLink;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $formobjects; <span class="comment"><span class="comment">// array of Form Objects for WMF</span></span>&nbsp;</div></li><li><div>  var $InlineProperties;&nbsp;</div></li><li><div>  var $InlineAnnots;&nbsp;</div></li><li><div>  var $InlineBDF; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Bidirectional formatting&nbsp;</div></li><li><div>  var $InlineBDFctr; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $ktAnnots;&nbsp;</div></li><li><div>  var $tbrot_Annots;&nbsp;</div></li><li><div>  var $kwt_Annots;&nbsp;</div></li><li><div>  var $columnAnnots;&nbsp;</div></li><li><div>  var $columnForms;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $PageAnnots;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $pageDim; <span class="comment">// Keep track of page wxh for orientation changes - set in _beginpage, used in _putannots</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $breakpoints;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $tableLevel;&nbsp;</div></li><li><div>  var $tbctr;&nbsp;</div></li><li><div>  var $innermostTableLevel;&nbsp;</div></li><li><div>  var $saveTableCounter;&nbsp;</div></li><li><div>  var $cellBorderBuffer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $saveHTMLFooter_height;&nbsp;</div></li><li><div>  var $saveHTMLFooterE_height;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $firstPageBoxHeader;&nbsp;</div></li><li><div>  var $firstPageBoxHeaderEven;&nbsp;</div></li><li><div>  var $firstPageBoxFooter;&nbsp;</div></li><li><div>  var $firstPageBoxFooterEven;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $page_box;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $show_marks; <span class="comment"><span class="comment">// crop or cross marks</span></span>&nbsp;</div></li><li><div>  var $basepathIsLocal;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $use_kwt;&nbsp;</div></li><li><div>  var $kwt;&nbsp;</div></li><li><div>  var $kwt_height;&nbsp;</div></li><li><div>  var $kwt_y0;&nbsp;</div></li><li><div>  var $kwt_x0;&nbsp;</div></li><li><div>  var $kwt_buffer;&nbsp;</div></li><li><div>  var $kwt_Links;&nbsp;</div></li><li><div>  var $kwt_moved;&nbsp;</div></li><li><div>  var $kwt_saved;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $PageNumSubstitutions;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $table_borders_separate;&nbsp;</div></li><li><div>  var $base_table_properties;&nbsp;</div></li><li><div>  var $borderstyles;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $blockjustfinished;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $orig_bMargin;&nbsp;</div></li><li><div>  var $orig_tMargin;&nbsp;</div></li><li><div>  var $orig_lMargin;&nbsp;</div></li><li><div>  var $orig_rMargin;&nbsp;</div></li><li><div>  var $orig_hMargin;&nbsp;</div></li><li><div>  var $orig_fMargin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $pageHTMLheaders;&nbsp;</div></li><li><div>  var $pageHTMLfooters;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $saveHTMLHeader;&nbsp;</div></li><li><div>  var $saveHTMLFooter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $HTMLheaderPageLinks;&nbsp;</div></li><li><div>  var $HTMLheaderPageAnnots;&nbsp;</div></li><li><div>  var $HTMLheaderPageForms;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// See config_fonts.php for these next 5 values</span>&nbsp;</div></li><li><div>  var $available_unifonts;&nbsp;</div></li><li><div>  var $sans_fonts;&nbsp;</div></li><li><div>  var $serif_fonts;&nbsp;</div></li><li><div>  var $mono_fonts;&nbsp;</div></li><li><div>  var $defaultSubsFont;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// List of ALL available CJK fonts (incl. styles) (Adobe add-ons)  hw removed</span>&nbsp;</div></li><li><div>  var $available_CJK_fonts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $HTMLHeader;&nbsp;</div></li><li><div>  var $HTMLFooter;&nbsp;</div></li><li><div>  var $HTMLHeaderE;&nbsp;</div></li><li><div>  var $HTMLFooterE;&nbsp;</div></li><li><div>  var $bufferoutput;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// CJK fonts</span></span>&nbsp;</div></li><li><div>  var $Big5_widths;&nbsp;</div></li><li><div>  var $GB_widths;&nbsp;</div></li><li><div>  var $SJIS_widths;&nbsp;</div></li><li><div>  var $UHC_widths;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// SetProtection</span>&nbsp;</div></li><li><div>  var $encrypted; <span class="comment">// whether document is protected</span>&nbsp;</div></li><li><div>  var $Uvalue; <span class="comment">// U entry in pdf document</span>&nbsp;</div></li><li><div>  var $Ovalue; <span class="comment">// O entry in pdf document</span>&nbsp;</div></li><li><div>  var $Pvalue; <span class="comment">// P entry in pdf document</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $enc_obj_id; <span class="comment">//encryption object id</span>&nbsp;</div></li><li><div>  var $last_rc4_key; <span class="comment">//last RC4 key encrypted (cached for optimisation)</span>&nbsp;</div></li><li><div>  var $last_rc4_key_c; <span class="comment">//last RC4 computed key</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $encryption_key;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $padding; <span class="comment">//used for encryption</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bookmark</span>&nbsp;</div></li><li><div>  var $BMoutlines;&nbsp;</div></li><li><div>  var $OutlineRoot;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// INDEX</span>&nbsp;</div></li><li><div>  var $ColActive;&nbsp;</div></li><li><div>  var $Reference;&nbsp;</div></li><li><div>  var $CurrCol;&nbsp;</div></li><li><div>  var $NbCol;&nbsp;</div></li><li><div>  var $y0;   <span class="comment">//Top ordinate of columns</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $ColL;&nbsp;</div></li><li><div>  var $ColWidth;&nbsp;</div></li><li><div>  var $ColGap;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// COLUMNS</span>&nbsp;</div></li><li><div>  var $ColR;&nbsp;</div></li><li><div>  var $ChangeColumn;&nbsp;</div></li><li><div>  var $columnbuffer;&nbsp;</div></li><li><div>  var $ColDetails;&nbsp;</div></li><li><div>  var $columnLinks;&nbsp;</div></li><li><div>  var $colvAlign;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Substitutions</span></span>&nbsp;</div></li><li><div>  var $substitute;  <span class="comment"><span class="comment">// Array of substitution strings e.g. &lt;ttz&gt;112&lt;/ttz&gt;</span></span>&nbsp;</div></li><li><div>  var $entsearch;  <span class="comment"><span class="comment">// Array of HTML entities (&gt;ASCII 127) to substitute</span></span>&nbsp;</div></li><li><div>  var $entsubstitute; <span class="comment"><span class="comment">// Array of substitution decimal unicode for the Hi entities</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Default values if no style sheet offered    (cf. http://www.w3.org/TR/CSS21/sample.html)</span>&nbsp;</div></li><li><div>  var $defaultCSS;&nbsp;</div></li><li><div>  var $lastoptionaltag; <span class="comment">// Save current block item which HTML specifies optionsl endtag</span>&nbsp;</div></li><li><div>  var $pageoutput;&nbsp;</div></li><li><div>  var $charset_in;&nbsp;</div></li><li><div>  var $blk;&nbsp;</div></li><li><div>  var $blklvl;&nbsp;</div></li><li><div>  var $ColumnAdjust;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $ws; <span class="comment"><span class="comment"><span class="comment">// Word spacing</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $HREF;&nbsp;</div></li><li><div>  var $pgwidth;&nbsp;</div></li><li><div>  var $fontlist;&nbsp;</div></li><li><div>  var $oldx;&nbsp;</div></li><li><div>  var $oldy;&nbsp;</div></li><li><div>  var $B;&nbsp;</div></li><li><div>  var $I;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $tdbegin;&nbsp;</div></li><li><div>  var $table;&nbsp;</div></li><li><div>  var $cell;&nbsp;</div></li><li><div>  var $col;&nbsp;</div></li><li><div>  var $row;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $divbegin;&nbsp;</div></li><li><div>  var $divwidth;&nbsp;</div></li><li><div>  var $divheight;&nbsp;</div></li><li><div>  var $spanbgcolor;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Used for table cell (block-type) properties&nbsp;</div></li><li><div>  var $cellTextAlign;&nbsp;</div></li><li><div>  var $cellLineHeight;&nbsp;</div></li><li><div>  var $cellLineStackingStrategy;&nbsp;</div></li><li><div>  var $cellLineStackingShift;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>  var $listcounter;&nbsp;</div></li><li><div>  var $listlvl;&nbsp;</div></li><li><div>  var $listtype;&nbsp;</div></li><li><div>  var $listitem;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $pjustfinished;&nbsp;</div></li><li><div>  var $ignorefollowingspaces;&nbsp;</div></li><li><div>  var $SMALL;&nbsp;</div></li><li><div>  var $BIG;&nbsp;</div></li><li><div>  var $dash_on;&nbsp;</div></li><li><div>  var $dotted_on;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $textbuffer;&nbsp;</div></li><li><div>  var $currentfontstyle;&nbsp;</div></li><li><div>  var $currentfontfamily;&nbsp;</div></li><li><div>  var $currentfontsize;&nbsp;</div></li><li><div>  var $colorarray;&nbsp;</div></li><li><div>  var $bgcolorarray;&nbsp;</div></li><li><div>  var $internallink;&nbsp;</div></li><li><div>  var $enabledtags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $lineheight;&nbsp;</div></li><li><div>  var $basepath;&nbsp;</div></li><li><div>  var $textparam;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $specialcontent;&nbsp;</div></li><li><div>  var $selectoption;&nbsp;</div></li><li><div>  var $objectbuffer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Table Rotation</span>&nbsp;</div></li><li><div>  var $table_rotate;&nbsp;</div></li><li><div>  var $tbrot_maxw;&nbsp;</div></li><li><div>  var $tbrot_maxh;&nbsp;</div></li><li><div>  var $tablebuffer;&nbsp;</div></li><li><div>  var $tbrot_align;&nbsp;</div></li><li><div>  var $tbrot_Links;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $keep_block_together; <span class="comment">// Keep a Block from page-break-inside: avoid</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $tbrot_y0;&nbsp;</div></li><li><div>  var $tbrot_x0;&nbsp;</div></li><li><div>  var $tbrot_w;&nbsp;</div></li><li><div>  var $tbrot_h;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $mb_enc;&nbsp;</div></li><li><div>  var $directionality;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $extgstates; <span class="comment">// Used for alpha channel - Transparency (Watermark)</span>&nbsp;</div></li><li><div>  var $mgl;&nbsp;</div></li><li><div>  var $mgt;&nbsp;</div></li><li><div>  var $mgr;&nbsp;</div></li><li><div>  var $mgb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $tts;&nbsp;</div></li><li><div>  var $ttz;&nbsp;</div></li><li><div>  var $tta;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Best to alter the below variables using default stylesheet above</span>&nbsp;</div></li><li><div>  var $page_break_after_avoid;&nbsp;</div></li><li><div>  var $margin_bottom_collapse;&nbsp;</div></li><li><div>  var $default_font_size; <span class="comment">// in pts</span>&nbsp;</div></li><li><div>  var $original_default_font_size; <span class="comment">// used to save default sizes when using table default</span>&nbsp;</div></li><li><div>  var $original_default_font;&nbsp;</div></li><li><div>  var $watermark_font;&nbsp;</div></li><li><div>  var $defaultAlign;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// TABLE</span></span>&nbsp;</div></li><li><div>  var $defaultTableAlign;&nbsp;</div></li><li><div>  var $tablethead;&nbsp;</div></li><li><div>  var $thead_font_weight;&nbsp;</div></li><li><div>  var $thead_font_style;&nbsp;</div></li><li><div>  var $thead_font_smCaps;&nbsp;</div></li><li><div>  var $thead_valign_default;&nbsp;</div></li><li><div>  var $thead_textalign_default;&nbsp;</div></li><li><div>  var $tabletfoot;&nbsp;</div></li><li><div>  var $tfoot_font_weight;&nbsp;</div></li><li><div>  var $tfoot_font_style;&nbsp;</div></li><li><div>  var $tfoot_font_smCaps;&nbsp;</div></li><li><div>  var $tfoot_valign_default;&nbsp;</div></li><li><div>  var $tfoot_textalign_default;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $trow_text_rotate;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $cellPaddingL;&nbsp;</div></li><li><div>  var $cellPaddingR;&nbsp;</div></li><li><div>  var $cellPaddingT;&nbsp;</div></li><li><div>  var $cellPaddingB;&nbsp;</div></li><li><div>  var $table_border_attr_set;&nbsp;</div></li><li><div>  var $table_border_css_set;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $shrin_k; <span class="comment">// factor with which to shrink tables - used internally - do not change</span>&nbsp;</div></li><li><div>  var $shrink_this_table_to_fit; <span class="comment">// 0 or false to disable; value (if set) gives maximum factor to reduce fontsize</span>&nbsp;</div></li><li><div>  var $MarginCorrection; <span class="comment">// corrects for OddEven Margins</span>&nbsp;</div></li><li><div>  var $margin_footer;&nbsp;</div></li><li><div>  var $margin_header;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $tabletheadjustfinished;&nbsp;</div></li><li><div>  var $usingCoreFont;&nbsp;</div></li><li><div>  var $charspacing;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Private properties FROM FPDF</span>&nbsp;</div></li><li><div>  var $DisplayPreferences;&nbsp;</div></li><li><div>  var $flowingBlockAttr;&nbsp;</div></li><li><div>  var $page; <span class="comment">//current page number</span>&nbsp;</div></li><li><div>  var $n; <span class="comment">//current object number</span>&nbsp;</div></li><li><div>  var $offsets; <span class="comment">//array of object offsets</span>&nbsp;</div></li><li><div>  var $buffer; <span class="comment">//buffer holding in-memory PDF</span>&nbsp;</div></li><li><div>  var $pages; <span class="comment">//array containing pages</span>&nbsp;</div></li><li><div>  var $state; <span class="comment">//current document state</span>&nbsp;</div></li><li><div>  var $compress; <span class="comment">//compression flag</span>&nbsp;</div></li><li><div>  var $DefOrientation; <span class="comment">//default orientation</span>&nbsp;</div></li><li><div>  var $CurOrientation; <span class="comment">//current orientation</span>&nbsp;</div></li><li><div>  var $OrientationChanges; <span class="comment">//array indicating orientation changes</span>&nbsp;</div></li><li><div>  var $k; <span class="comment">//scale factor (number of points in user unit)</span>&nbsp;</div></li><li><div>  var $fwPt;&nbsp;</div></li><li><div>  var $fhPt; <span class="comment">//dimensions of page format in points</span>&nbsp;</div></li><li><div>  var $fw;&nbsp;</div></li><li><div>  var $fh; <span class="comment">//dimensions of page format in user unit</span>&nbsp;</div></li><li><div>  var $wPt;&nbsp;</div></li><li><div>  var $hPt; <span class="comment">//current dimensions of page in points</span>&nbsp;</div></li><li><div>  var $w;&nbsp;</div></li><li><div>  var $h; <span class="comment">//current dimensions of page in user unit</span>&nbsp;</div></li><li><div>  var $lMargin; <span class="comment">//left margin</span>&nbsp;</div></li><li><div>  var $tMargin; <span class="comment">//top margin</span>&nbsp;</div></li><li><div>  var $rMargin; <span class="comment">//right margin</span>&nbsp;</div></li><li><div>  var $bMargin; <span class="comment">//page break margin</span>&nbsp;</div></li><li><div>  var $cMarginL; <span class="comment"><span class="comment">//cell margin Left</span></span>&nbsp;</div></li><li><div>  var $cMarginR; <span class="comment"><span class="comment">//cell margin Right</span></span>&nbsp;</div></li><li><div>  var $cMarginT; <span class="comment"><span class="comment">//cell margin Left</span></span>&nbsp;</div></li><li><div>  var $cMarginB; <span class="comment"><span class="comment">//cell margin Right</span></span>&nbsp;</div></li><li><div>  var $DeflMargin; <span class="comment">//Default left margin</span>&nbsp;</div></li><li><div>  var $DefrMargin; <span class="comment">//Default right margin</span>&nbsp;</div></li><li><div>  var $x;&nbsp;</div></li><li><div>  var $y; <span class="comment">//current position in user unit for cell positioning</span>&nbsp;</div></li><li><div>  var $lasth; <span class="comment">//height of last cell printed</span>&nbsp;</div></li><li><div>  var $LineWidth; <span class="comment">//line width in user unit</span>&nbsp;</div></li><li><div>  var $CoreFonts; <span class="comment">//array of standard font names</span>&nbsp;</div></li><li><div>  var $fonts; <span class="comment">//array of used fonts</span>&nbsp;</div></li><li><div>  var $FontFiles; <span class="comment">//array of font files</span>&nbsp;</div></li><li><div>  var $images; <span class="comment">//array of used images</span>&nbsp;</div></li><li><div>  var $PageLinks; <span class="comment">//array of links in pages</span>&nbsp;</div></li><li><div>  var $links; <span class="comment">//array of internal links</span>&nbsp;</div></li><li><div>  var $FontFamily; <span class="comment">//current font family</span>&nbsp;</div></li><li><div>  var $FontStyle; <span class="comment">//current font style</span>&nbsp;</div></li><li><div>  var $CurrentFont; <span class="comment">//current font info</span>&nbsp;</div></li><li><div>  var $FontSizePt; <span class="comment">//current font size in points</span>&nbsp;</div></li><li><div>  var $FontSize; <span class="comment">//current font size in user unit</span>&nbsp;</div></li><li><div>  var $DrawColor; <span class="comment">//commands for drawing color</span>&nbsp;</div></li><li><div>  var $FillColor; <span class="comment">//commands for filling color</span>&nbsp;</div></li><li><div>  var $TextColor; <span class="comment">//commands for text color</span>&nbsp;</div></li><li><div>  var $ColorFlag; <span class="comment">//indicates whether fill and text colors are different</span>&nbsp;</div></li><li><div>  var $autoPageBreak; <span class="comment">//automatic page breaking</span>&nbsp;</div></li><li><div>  var $PageBreakTrigger; <span class="comment">//threshold used to trigger page breaks</span>&nbsp;</div></li><li><div>  var $InFooter; <span class="comment">//flag set when processing footer</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $InHTMLFooter;&nbsp;</div></li><li><div>  var $processingFooter; <span class="comment">//flag set when processing footer</span> - added for columns&nbsp;</div></li><li><div>  var $processingHeader; <span class="comment">//flag set when processing header - added for columns</span>&nbsp;</div></li><li><div>  var $ZoomMode; <span class="comment">//zoom display mode</span>&nbsp;</div></li><li><div>  var $LayoutMode; <span class="comment">//layout display mode</span>&nbsp;</div></li><li><div>  var $title; <span class="comment">//title</span>&nbsp;</div></li><li><div>  var $subject; <span class="comment">//subject</span>&nbsp;</div></li><li><div>  var $author; <span class="comment">//author</span>&nbsp;</div></li><li><div>  var $keywords; <span class="comment">//keywords</span>&nbsp;</div></li><li><div>  var $creator; <span class="comment">//creator</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $aliasNbPg; <span class="comment">//alias for total number of pages</span>&nbsp;</div></li><li><div>  var $aliasNbPgGp; <span class="comment">//alias for total number of pages</span> in page group&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  //var $aliasNbPgHex;    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> deleted&nbsp;</div></li><li><div>  //var $aliasNbPgGpHex;    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> deleted&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $ispre;&nbsp;</div></li><li><div>  var $outerblocktags;&nbsp;</div></li><li><div>  var $innerblocktags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  private $tag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function __construct($mode = '', $format = 'A4', $default_font_size = 0, $default_font = '', $mgl = 15, $mgr = 15, $mgt = 16, $mgb = 16, $mgh = 9, $mgf = 9, $orientation = 'P')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (!class_exists('grad', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/grad.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;grad)) {&nbsp;</div></li><li><div>          $this-&gt;grad = new grad($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (!class_exists('mpdfform', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/mpdfform.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;mpdfform)) {&nbsp;</div></li><li><div>          $this-&gt;mpdfform = new mpdfform($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;time0 = microtime(true);&nbsp;</div></li><li><div>      <span class="comment">//Some checks</span>&nbsp;</div></li><li><div>      $this-&gt;_dochecks();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;writingToC = false;&nbsp;</div></li><li><div>      $this-&gt;layers = array();&nbsp;</div></li><li><div>      $this-&gt;current_layer = 0;&nbsp;</div></li><li><div>      $this-&gt;open_layer_pane = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;visibility = 'visible';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Initialization of properties</span>&nbsp;</div></li><li><div>      $this-&gt;spotColors = array();&nbsp;</div></li><li><div>      $this-&gt;spotColorIDs = array();&nbsp;</div></li><li><div>      $this-&gt;tableBackgrounds = array();&nbsp;</div></li><li><div>      $this-&gt;uniqstr = '20110230'; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;kt_y00 = '';&nbsp;</div></li><li><div>      $this-&gt;kt_p00 = '';&nbsp;</div></li><li><div>      $this-&gt;iterationCounter = false;&nbsp;</div></li><li><div>      $this-&gt;BMPonly = array();&nbsp;</div></li><li><div>      $this-&gt;page = 0;&nbsp;</div></li><li><div>      $this-&gt;n = 2;&nbsp;</div></li><li><div>      $this-&gt;buffer = '';&nbsp;</div></li><li><div>      $this-&gt;objectbuffer = array();&nbsp;</div></li><li><div>      $this-&gt;pages = array();&nbsp;</div></li><li><div>      $this-&gt;OrientationChanges = array();&nbsp;</div></li><li><div>      $this-&gt;state = 0;&nbsp;</div></li><li><div>      $this-&gt;fonts = array();&nbsp;</div></li><li><div>      $this-&gt;FontFiles = array();&nbsp;</div></li><li><div>      $this-&gt;images = array();&nbsp;</div></li><li><div>      $this-&gt;links = array();&nbsp;</div></li><li><div>      $this-&gt;InFooter = false;&nbsp;</div></li><li><div>      $this-&gt;processingFooter = false;&nbsp;</div></li><li><div>      $this-&gt;processingHeader = false;&nbsp;</div></li><li><div>      $this-&gt;lasth = 0;&nbsp;</div></li><li><div>      $this-&gt;FontFamily = '';&nbsp;</div></li><li><div>      $this-&gt;FontStyle = '';&nbsp;</div></li><li><div>      $this-&gt;FontSizePt = 9;&nbsp;</div></li><li><div>      $this-&gt;U = false;&nbsp;</div></li><li><div>      <span class="comment">// Small Caps</span>&nbsp;</div></li><li><div>      $this-&gt;upperCase = array();&nbsp;</div></li><li><div>      $this-&gt;smCapsScale = 1;&nbsp;</div></li><li><div>      $this-&gt;smCapsStretch = 100;&nbsp;</div></li><li><div>      $this-&gt;margBuffer = 0;&nbsp;</div></li><li><div>      $this-&gt;inMeter = false;&nbsp;</div></li><li><div>      $this-&gt;decimal_offset = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;defTextColor = $this-&gt;TextColor = $this-&gt;SetTColor($this-&gt;ConvertColor(0), true);&nbsp;</div></li><li><div>      $this-&gt;defDrawColor = $this-&gt;DrawColor = $this-&gt;SetDColor($this-&gt;ConvertColor(0), true);&nbsp;</div></li><li><div>      $this-&gt;defFillColor = $this-&gt;FillColor = $this-&gt;SetFColor($this-&gt;ConvertColor(255), true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//SVG color names array</span>&nbsp;</div></li><li><div>      <span class="comment">//http://www.w3schools.com/css/css_colornames.asp</span>&nbsp;</div></li><li><div>      $this-&gt;SVGcolors = array('antiquewhite' =&gt; '#FAEBD7', 'aqua' =&gt; '#00FFFF', 'aquamarine' =&gt; '#7FFFD4', 'beige' =&gt; '#F5F5DC', 'black' =&gt; '#000000', &nbsp;</div></li><li><div>          'blue' =&gt; '#0000FF', 'brown' =&gt; '#A52A2A', 'cadetblue' =&gt; '#5F9EA0', 'chocolate' =&gt; '#D2691E', 'cornflowerblue' =&gt; '#6495ED', 'crimson' =&gt; '#DC143C', &nbsp;</div></li><li><div>          'darkblue' =&gt; '#00008B', 'darkgoldenrod' =&gt; '#B8860B', 'darkgreen' =&gt; '#006400', 'darkmagenta' =&gt; '#8B008B', 'darkorange' =&gt; '#FF8C00', &nbsp;</div></li><li><div>          'darkred' =&gt; '#8B0000', 'darkseagreen' =&gt; '#8FBC8F', 'darkslategray' =&gt; '#2F4F4F', 'darkviolet' =&gt; '#9400D3', 'deepskyblue' =&gt; '#00BFFF', &nbsp;</div></li><li><div>          'dodgerblue' =&gt; '#1E90FF', 'firebrick' =&gt; '#B22222', 'forestgreen' =&gt; '#228B22', 'fuchsia' =&gt; '#FF00FF', 'gainsboro' =&gt; '#DCDCDC', 'gold' =&gt; '#FFD700', &nbsp;</div></li><li><div>          'gray' =&gt; '#808080', 'green' =&gt; '#008000', 'greenyellow' =&gt; '#ADFF2F', 'hotpink' =&gt; '#FF69B4', 'indigo' =&gt; '#4B0082', 'khaki' =&gt; '#F0E68C', &nbsp;</div></li><li><div>          'lavenderblush' =&gt; '#FFF0F5', 'lemonchiffon' =&gt; '#FFFACD', 'lightcoral' =&gt; '#F08080', 'lightgoldenrodyellow' =&gt; '#FAFAD2', 'lightgreen' =&gt; '#90EE90', &nbsp;</div></li><li><div>          'lightsalmon' =&gt; '#FFA07A', 'lightskyblue' =&gt; '#87CEFA', 'lightslategray' =&gt; '#778899', 'lightyellow' =&gt; '#FFFFE0', 'lime' =&gt; '#00FF00', 'limegreen' =&gt; '#32CD32', &nbsp;</div></li><li><div>          'magenta' =&gt; '#FF00FF', 'maroon' =&gt; '#800000', 'mediumaquamarine' =&gt; '#66CDAA', 'mediumorchid' =&gt; '#BA55D3', 'mediumseagreen' =&gt; '#3CB371', &nbsp;</div></li><li><div>          'mediumspringgreen' =&gt; '#00FA9A', 'mediumvioletred' =&gt; '#C71585', 'midnightblue' =&gt; '#191970', 'mintcream' =&gt; '#F5FFFA', 'moccasin' =&gt; '#FFE4B5', 'navy' =&gt; '#000080', &nbsp;</div></li><li><div>          'olive' =&gt; '#808000', 'orange' =&gt; '#FFA500', 'orchid' =&gt; '#DA70D6', 'palegreen' =&gt; '#98FB98', &nbsp;</div></li><li><div>          'palevioletred' =&gt; '#D87093', 'peachpuff' =&gt; '#FFDAB9', 'pink' =&gt; '#FFC0CB', 'powderblue' =&gt; '#B0E0E6', 'purple' =&gt; '#800080', &nbsp;</div></li><li><div>          'red' =&gt; '#FF0000', 'royalblue' =&gt; '#4169E1', 'salmon' =&gt; '#FA8072', 'seagreen' =&gt; '#2E8B57', 'sienna' =&gt; '#A0522D', 'silver' =&gt; '#C0C0C0', 'skyblue' =&gt; '#87CEEB', &nbsp;</div></li><li><div>          'slategray' =&gt; '#708090', 'springgreen' =&gt; '#00FF7F', 'steelblue' =&gt; '#4682B4', 'tan' =&gt; '#D2B48C', 'teal' =&gt; '#008080', 'thistle' =&gt; '#D8BFD8', 'turquoise' =&gt; '#40E0D0', &nbsp;</div></li><li><div>          'violetred' =&gt; '#D02090', 'white' =&gt; '#FFFFFF', 'yellow' =&gt; '#FFFF00', &nbsp;</div></li><li><div>          'aliceblue' =&gt; '#f0f8ff', 'azure' =&gt; '#f0ffff', 'bisque' =&gt; '#ffe4c4', 'blanchedalmond' =&gt; '#ffebcd', 'blueviolet' =&gt; '#8a2be2', 'burlywood' =&gt; '#deb887', &nbsp;</div></li><li><div>          'chartreuse' =&gt; '#7fff00', 'coral' =&gt; '#ff7f50', 'cornsilk' =&gt; '#fff8dc', 'cyan' =&gt; '#00ffff', 'darkcyan' =&gt; '#008b8b', 'darkgray' =&gt; '#a9a9a9', &nbsp;</div></li><li><div>          'darkgrey' =&gt; '#a9a9a9', 'darkkhaki' =&gt; '#bdb76b', 'darkolivegreen' =&gt; '#556b2f', 'darkorchid' =&gt; '#9932cc', 'darksalmon' =&gt; '#e9967a', &nbsp;</div></li><li><div>          'darkslateblue' =&gt; '#483d8b', 'darkslategrey' =&gt; '#2f4f4f', 'darkturquoise' =&gt; '#00ced1', 'deeppink' =&gt; '#ff1493', 'dimgray' =&gt; '#696969', &nbsp;</div></li><li><div>          'dimgrey' =&gt; '#696969', 'floralwhite' =&gt; '#fffaf0', 'ghostwhite' =&gt; '#f8f8ff', 'goldenrod' =&gt; '#daa520', 'grey' =&gt; '#808080', 'honeydew' =&gt; '#f0fff0', &nbsp;</div></li><li><div>          'indianred' =&gt; '#cd5c5c', 'ivory' =&gt; '#fffff0', 'lavender' =&gt; '#e6e6fa', 'lawngreen' =&gt; '#7cfc00', 'lightblue' =&gt; '#add8e6', 'lightcyan' =&gt; '#e0ffff', &nbsp;</div></li><li><div>          'lightgray' =&gt; '#d3d3d3', 'lightgrey' =&gt; '#d3d3d3', 'lightpink' =&gt; '#ffb6c1', 'lightseagreen' =&gt; '#20b2aa', 'lightslategrey' =&gt; '#778899', &nbsp;</div></li><li><div>          'lightsteelblue' =&gt; '#b0c4de', 'linen' =&gt; '#faf0e6', 'mediumblue' =&gt; '#0000cd', 'mediumpurple' =&gt; '#9370db', 'mediumslateblue' =&gt; '#7b68ee', &nbsp;</div></li><li><div>          'mediumturquoise' =&gt; '#48d1cc', 'mistyrose' =&gt; '#ffe4e1', 'navajowhite' =&gt; '#ffdead', 'oldlace' =&gt; '#fdf5e6', 'olivedrab' =&gt; '#6b8e23', 'orangered' =&gt; '#ff4500', &nbsp;</div></li><li><div>          'palegoldenrod' =&gt; '#eee8aa', 'paleturquoise' =&gt; '#afeeee', 'papayawhip' =&gt; '#ffefd5', 'peru' =&gt; '#cd853f', 'plum' =&gt; '#dda0dd', 'rosybrown' =&gt; '#bc8f8f', &nbsp;</div></li><li><div>          'saddlebrown' =&gt; '#8b4513', 'sandybrown' =&gt; '#f4a460', 'seashell' =&gt; '#fff5ee', 'slateblue' =&gt; '#6a5acd', 'slategrey' =&gt; '#708090', 'snow' =&gt; '#fffafa', &nbsp;</div></li><li><div>          'tomato' =&gt; '#ff6347', 'violet' =&gt; '#ee82ee', 'wheat' =&gt; '#f5deb3', 'whitesmoke' =&gt; '#f5f5f5', 'yellowgreen' =&gt; '#9acd32');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Uppercase alternatives (for Small Caps)</span>&nbsp;</div></li><li><div>      if (empty($this-&gt;upperCase)) {&nbsp;</div></li><li><div>          @include(_MPDF_PATH . 'includes/upperCase.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;extrapagebreak = true; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;ColorFlag = false;&nbsp;</div></li><li><div>      $this-&gt;extgstates = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;mb_enc = 'windows-1252';&nbsp;</div></li><li><div>      $this-&gt;directionality = 'ltr';&nbsp;</div></li><li><div>      $this-&gt;defaultAlign = 'L';&nbsp;</div></li><li><div>      $this-&gt;defaultTableAlign = 'L';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;fixedPosBlockSave = array();&nbsp;</div></li><li><div>      $this-&gt;extraFontSubsets = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SHYpatterns = array();&nbsp;</div></li><li><div>      $this-&gt;loadedSHYdictionary = false;&nbsp;</div></li><li><div>      $this-&gt;SHYdictionary = array();&nbsp;</div></li><li><div>      $this-&gt;SHYdictionaryWords = array();&nbsp;</div></li><li><div>      $this-&gt;blockContext = 1;&nbsp;</div></li><li><div>      $this-&gt;floatDivs = array();&nbsp;</div></li><li><div>      $this-&gt;DisplayPreferences = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;patterns = array();  <span class="comment">// Tiling patterns used for backgrounds</span>&nbsp;</div></li><li><div>      $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>      $this-&gt;writingHTMLheader = false; <span class="comment"><span class="comment"><span class="comment">// internal flag - used both for writing HTMLHeaders/Footers and FixedPos block</span></span></span>&nbsp;</div></li><li><div>      $this-&gt;writingHTMLfooter = false; <span class="comment"><span class="comment"><span class="comment">// internal flag - used both for writing HTMLHeaders/Footers and FixedPos block</span></span></span>&nbsp;</div></li><li><div>      $this-&gt;gradients = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;kwt_Reference = array();&nbsp;</div></li><li><div>      $this-&gt;kwt_BMoutlines = array();&nbsp;</div></li><li><div>      $this-&gt;kwt_toc = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;tbrot_BMoutlines = array();&nbsp;</div></li><li><div>      $this-&gt;tbrot_toc = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;col_BMoutlines = array();&nbsp;</div></li><li><div>      $this-&gt;col_toc = array();&nbsp;</div></li><li><div>      $this-&gt;graphs = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pgsIns = array();&nbsp;</div></li><li><div>      $this-&gt;PDFAXwarnings = array();&nbsp;</div></li><li><div>      $this-&gt;inlineDisplayOff = false;&nbsp;</div></li><li><div>      $this-&gt;lSpacingCSS = '';&nbsp;</div></li><li><div>      $this-&gt;wSpacingCSS = '';&nbsp;</div></li><li><div>      $this-&gt;fixedlSpacing = false;&nbsp;</div></li><li><div>      $this-&gt;minwSpacing = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;baselineC = 0.35; <span class="comment">// Baseline for text</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>      $this-&gt;baselineSup = 0.5; <span class="comment">// Sets default change in baseline for &lt;sup&gt; text as factor of preceeding fontsize</span>&nbsp;</div></li><li><div>      <span class="comment">// 0.35 has been recommended; 0.5 matches applications like MS Word</span>&nbsp;</div></li><li><div>      $this-&gt;baselineSub = -0.2; <span class="comment">// Sets default change in baseline for &lt;sub&gt; text as factor of preceeding fontsize</span>&nbsp;</div></li><li><div>      $this-&gt;baselineS = 0.3;  <span class="comment">// Sets default height for &lt;strike&gt; text as factor of fontsize</span>&nbsp;</div></li><li><div>      $this-&gt;baselineO = 1.1;  <span class="comment">// Sets default height for overline text as factor of fontsize</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;noImageFile = str_replace(&quot;\\&quot;, &quot;/&quot;, dirname(__FILE__)) . '/includes/no_image.jpg';&nbsp;</div></li><li><div>      $this-&gt;subPos = 0;&nbsp;</div></li><li><div>      $this-&gt;normalLineheight = 1.3; <span class="comment">// This should be overridden in config.php - but it is so important a default value is put here</span>&nbsp;</div></li><li><div>      <span class="comment">// These are intended as configuration variables, and should be set in config.php - which will override these values;</span>&nbsp;</div></li><li><div>      <span class="comment">// set here as failsafe as will cause an error if not defined</span>&nbsp;</div></li><li><div>      $this-&gt;incrementFPR1 = 10;&nbsp;</div></li><li><div>      $this-&gt;incrementFPR2 = 10;&nbsp;</div></li><li><div>      $this-&gt;incrementFPR3 = 10;&nbsp;</div></li><li><div>      $this-&gt;incrementFPR4 = 10;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;fullImageHeight = false;&nbsp;</div></li><li><div>      $this-&gt;floatbuffer = array();&nbsp;</div></li><li><div>      $this-&gt;floatmargins = array();&nbsp;</div></li><li><div>      $this-&gt;formobjects = array(); <span class="comment"><span class="comment">// array of Form Objects for WMF</span></span>&nbsp;</div></li><li><div>      $this-&gt;InlineProperties = array();&nbsp;</div></li><li><div>      $this-&gt;InlineAnnots = array();&nbsp;</div></li><li><div>      $this-&gt;InlineBDF = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;InlineBDFctr = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;tbrot_Annots = array();&nbsp;</div></li><li><div>      $this-&gt;kwt_Annots = array();&nbsp;</div></li><li><div>      $this-&gt;columnAnnots = array();&nbsp;</div></li><li><div>      $this-&gt;pageDim = array();&nbsp;</div></li><li><div>      $this-&gt;breakpoints = array(); <span class="comment">// used in columnbuffer</span>&nbsp;</div></li><li><div>      $this-&gt;tableLevel = 0;&nbsp;</div></li><li><div>      $this-&gt;tbctr = array(); <span class="comment">// counter for nested tables at each level</span>&nbsp;</div></li><li><div>      $this-&gt;page_box = array();&nbsp;</div></li><li><div>      $this-&gt;show_marks = ''; <span class="comment"><span class="comment">// crop or cross marks</span></span>&nbsp;</div></li><li><div>      $this-&gt;kwt = false;&nbsp;</div></li><li><div>      $this-&gt;kwt_height = 0;&nbsp;</div></li><li><div>      $this-&gt;kwt_y0 = 0;&nbsp;</div></li><li><div>      $this-&gt;kwt_x0 = 0;&nbsp;</div></li><li><div>      $this-&gt;kwt_buffer = array();&nbsp;</div></li><li><div>      $this-&gt;kwt_Links = array();&nbsp;</div></li><li><div>      $this-&gt;kwt_moved = false;&nbsp;</div></li><li><div>      $this-&gt;kwt_saved = false;&nbsp;</div></li><li><div>      $this-&gt;PageNumSubstitutions = array();&nbsp;</div></li><li><div>      $this-&gt;base_table_properties = array();&nbsp;</div></li><li><div>      $this-&gt;borderstyles = array('inset', 'groove', 'outset', 'ridge', 'dotted', 'dashed', 'solid', 'double');&nbsp;</div></li><li><div>      $this-&gt;tbrot_align = 'C';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageHTMLheaders = array();&nbsp;</div></li><li><div>      $this-&gt;pageHTMLfooters = array();&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageLinks = array();&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageAnnots = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageForms = array();&nbsp;</div></li><li><div>      $this-&gt;columnForms = array();&nbsp;</div></li><li><div>      $this-&gt;tbrotForms = array();&nbsp;</div></li><li><div>      $this-&gt;useRC128encryption = false;&nbsp;</div></li><li><div>      $this-&gt;uniqid = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageoutput = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;bufferoutput = false;&nbsp;</div></li><li><div>      $this-&gt;encrypted = false;      <span class="comment">//whether document is protected</span>&nbsp;</div></li><li><div>      $this-&gt;BMoutlines = array();&nbsp;</div></li><li><div>      $this-&gt;ColActive = 0;          <span class="comment">//Flag indicating that columns are on (the index is being processed)</span>&nbsp;</div></li><li><div>      $this-&gt;Reference = array();    <span class="comment">//Array containing the references</span>&nbsp;</div></li><li><div>      $this-&gt;CurrCol = 0;               <span class="comment">//Current column number</span>&nbsp;</div></li><li><div>      $this-&gt;ColL = array(0);   <span class="comment">// Array of Left pos of columns - absolute - needs Margin correction for Odd-Even</span>&nbsp;</div></li><li><div>      $this-&gt;ColR = array(0);   <span class="comment">// Array of Right pos of columns - absolute pos - needs Margin correction for Odd-Even</span>&nbsp;</div></li><li><div>      $this-&gt;ChangeColumn = 0;&nbsp;</div></li><li><div>      $this-&gt;columnbuffer = array();&nbsp;</div></li><li><div>      $this-&gt;ColDetails = array();  <span class="comment">// Keeps track of some column details</span>&nbsp;</div></li><li><div>      $this-&gt;columnLinks = array();  <span class="comment">// Cross references PageLinks</span>&nbsp;</div></li><li><div>      $this-&gt;substitute = array();  <span class="comment"><span class="comment">// Array of substitution strings e.g. &lt;ttz&gt;112&lt;/ttz&gt;</span></span>&nbsp;</div></li><li><div>      $this-&gt;entsearch = array();  <span class="comment"><span class="comment">// Array of HTML entities (&gt;ASCII 127) to substitute</span></span>&nbsp;</div></li><li><div>      $this-&gt;entsubstitute = array(); <span class="comment"><span class="comment">// Array of substitution decimal unicode for the Hi entities</span></span>&nbsp;</div></li><li><div>      $this-&gt;lastoptionaltag = '';&nbsp;</div></li><li><div>      $this-&gt;charset_in = '';&nbsp;</div></li><li><div>      $this-&gt;blk = array();&nbsp;</div></li><li><div>      $this-&gt;blklvl = 0;&nbsp;</div></li><li><div>      $this-&gt;tts = false;&nbsp;</div></li><li><div>      $this-&gt;ttz = false;&nbsp;</div></li><li><div>      $this-&gt;tta = false;&nbsp;</div></li><li><div>      $this-&gt;ispre = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;checkSIP = false;&nbsp;</div></li><li><div>      $this-&gt;checkSMP = false;&nbsp;</div></li><li><div>      $this-&gt;checkCJK = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;page_break_after_avoid = false;&nbsp;</div></li><li><div>      $this-&gt;margin_bottom_collapse = false;&nbsp;</div></li><li><div>      $this-&gt;tablethead = 0;&nbsp;</div></li><li><div>      $this-&gt;tabletfoot = 0;&nbsp;</div></li><li><div>      $this-&gt;table_border_attr_set = 0;&nbsp;</div></li><li><div>      $this-&gt;table_border_css_set = 0;&nbsp;</div></li><li><div>      $this-&gt;shrin_k = 1.0;&nbsp;</div></li><li><div>      $this-&gt;shrink_this_table_to_fit = 0;&nbsp;</div></li><li><div>      $this-&gt;MarginCorrection = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;tabletheadjustfinished = false;&nbsp;</div></li><li><div>      $this-&gt;usingCoreFont = false;&nbsp;</div></li><li><div>      $this-&gt;charspacing = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;autoPageBreak = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      require(_MPDF_PATH . 'config.php'); <span class="comment">// config data</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_setPageSize($format, $orientation);&nbsp;</div></li><li><div>      $this-&gt;DefOrientation = $orientation;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;margin_header = $mgh;&nbsp;</div></li><li><div>      $this-&gt;margin_footer = $mgf;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bmargin = $mgb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;DeflMargin = $mgl;&nbsp;</div></li><li><div>      $this-&gt;DefrMargin = $mgr;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;orig_tMargin = $mgt;&nbsp;</div></li><li><div>      $this-&gt;orig_bMargin = $bmargin;&nbsp;</div></li><li><div>      $this-&gt;orig_lMargin = $this-&gt;DeflMargin;&nbsp;</div></li><li><div>      $this-&gt;orig_rMargin = $this-&gt;DefrMargin;&nbsp;</div></li><li><div>      $this-&gt;orig_hMargin = $this-&gt;margin_header;&nbsp;</div></li><li><div>      $this-&gt;orig_fMargin = $this-&gt;margin_footer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;setAutoTopMargin == 'pad') {&nbsp;</div></li><li><div>          $mgt += $this-&gt;margin_header;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;setAutoBottomMargin == 'pad') {&nbsp;</div></li><li><div>          $mgb += $this-&gt;margin_footer;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetMargins($this-&gt;DeflMargin, $this-&gt;DefrMargin, $mgt); <span class="comment">// sets l r t margin</span>&nbsp;</div></li><li><div>      <span class="comment">//Automatic page break</span>&nbsp;</div></li><li><div>      $this-&gt;SetAutoPageBreak($this-&gt;autoPageBreak, $bmargin); <span class="comment">// sets $this-&gt;bMargin & PageBreakTrigger</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Interior cell margin (1 mm) ? not used</span>&nbsp;</div></li><li><div>      $this-&gt;cMarginL = 1;&nbsp;</div></li><li><div>      $this-&gt;cMarginR = 1;&nbsp;</div></li><li><div>      <span class="comment">//Line width (0.2 mm)</span>&nbsp;</div></li><li><div>      $this-&gt;LineWidth = .567 / _MPDFK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//To make the function Footer() work - replaces {nb} with page number</span>&nbsp;</div></li><li><div>      $this-&gt;AliasNbPages();&nbsp;</div></li><li><div>      $this-&gt;AliasNbPageGroups();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      //$this-&gt;aliasNbPgHex = '{nbHEXmarker}';    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> deleted&nbsp;</div></li><li><div>      //$this-&gt;aliasNbPgGpHex = '{nbpgHEXmarker}';    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> deleted&nbsp;</div></li><li><div>      <span class="comment">//Enable all tags as default</span>&nbsp;</div></li><li><div>      $this-&gt;DisableTags();&nbsp;</div></li><li><div>      <span class="comment">//Full width display mode</span>&nbsp;</div></li><li><div>      $this-&gt;SetDisplayMode(100); <span class="comment">// fullwidth?        'fullpage'</span>&nbsp;</div></li><li><div>      <span class="comment">//Compression</span>&nbsp;</div></li><li><div>      $this-&gt;SetCompression(true);&nbsp;</div></li><li><div>      <span class="comment">//Set default display preferences</span>&nbsp;</div></li><li><div>      $this-&gt;SetDisplayPreferences('');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Font data</span>&nbsp;</div></li><li><div>      require(_MPDF_PATH . 'config_fonts.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// check for a custom config file that can add/overwrite the default config</span>&nbsp;</div></li><li><div>      if (defined('_MPDF_SYSTEM_TTFONTS_CONFIG') && file_exists(_MPDF_SYSTEM_TTFONTS_CONFIG)) {&nbsp;</div></li><li><div>          require(_MPDF_SYSTEM_TTFONTS_CONFIG);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Available fonts</span>&nbsp;</div></li><li><div>      $this-&gt;available_unifonts = array();&nbsp;</div></li><li><div>      foreach ($this-&gt;fontdata AS $f =&gt; $fs) {&nbsp;</div></li><li><div>          if (isset($fs['R']) && $fs['R']) {&nbsp;</div></li><li><div>              $this-&gt;available_unifonts[] = $f;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($fs['B']) && $fs['B']) {&nbsp;</div></li><li><div>              $this-&gt;available_unifonts[] = $f . 'B';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($fs['I']) && $fs['I']) {&nbsp;</div></li><li><div>              $this-&gt;available_unifonts[] = $f . 'I';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($fs['BI']) && $fs['BI']) {&nbsp;</div></li><li><div>              $this-&gt;available_unifonts[] = $f . 'BI';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;default_available_fonts = $this-&gt;available_unifonts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $optcore = false;&nbsp;</div></li><li><div>      $onlyCoreFonts = false;&nbsp;</div></li><li><div>      if (preg_match('/([\-+])aCJK/i', $mode, $m)) {&nbsp;</div></li><li><div>          $mode = preg_replace('/([\-+])aCJK/i', '', $mode); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($m[1] == '+') {&nbsp;</div></li><li><div>              $this-&gt;useAdobeCJK = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;useAdobeCJK = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (strlen($mode) == 1) {&nbsp;</div></li><li><div>          if ($mode == 's') {&nbsp;</div></li><li><div>              $this-&gt;percentSubset = 100;&nbsp;</div></li><li><div>              $mode = '';&nbsp;</div></li><li><div>          } elseif ($mode == 'c') {&nbsp;</div></li><li><div>              $onlyCoreFonts = true;&nbsp;</div></li><li><div>              $mode = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (substr($mode, -2) == '-s') {&nbsp;</div></li><li><div>          $this-&gt;percentSubset = 100;&nbsp;</div></li><li><div>          $mode = substr($mode, 0, strlen($mode) - 2);&nbsp;</div></li><li><div>      } elseif (substr($mode, -2) == '-c') {&nbsp;</div></li><li><div>          $onlyCoreFonts = true;&nbsp;</div></li><li><div>          $mode = substr($mode, 0, strlen($mode) - 2);&nbsp;</div></li><li><div>      } elseif (substr($mode, -2) == '-x') {&nbsp;</div></li><li><div>          $optcore = true;&nbsp;</div></li><li><div>          $mode = substr($mode, 0, strlen($mode) - 2);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Autodetect if mode is a language_country string (en-GB or en_GB or en)</span>&nbsp;</div></li><li><div>      if ($mode && $mode != 'UTF-8') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          list ($coreSuitable, $mpdf_pdf_unifont) = GetLangOpts($mode, $this-&gt;useAdobeCJK, $this-&gt;fontdata);&nbsp;</div></li><li><div>          if ($coreSuitable && $optcore) {&nbsp;</div></li><li><div>              $onlyCoreFonts = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($mpdf_pdf_unifont) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $default_font = $mpdf_pdf_unifont;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;currentLang = $mode;&nbsp;</div></li><li><div>          $this-&gt;default_lang = $mode;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;onlyCoreFonts = $onlyCoreFonts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;onlyCoreFonts) {&nbsp;</div></li><li><div>          $this-&gt;setMBencoding('windows-1252'); <span class="comment"><span class="comment">// sets $this-&gt;mb_enc</span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;setMBencoding('UTF-8'); <span class="comment"><span class="comment">// sets $this-&gt;mb_enc</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      @mb_regex_encoding('UTF-8'); <span class="comment">// required only for mb_ereg... and mb_split functions</span>&nbsp;</div></li><li><div>      <span class="comment">// Adobe CJK fonts</span>&nbsp;</div></li><li><div>      $this-&gt;available_CJK_fonts = array('gb', 'big5', 'sjis', 'uhc', 'gbB', 'big5B', 'sjisB', 'uhcB', 'gbI', 'big5I', 'sjisI', 'uhcI', &nbsp;</div></li><li><div>          'gbBI', 'big5BI', 'sjisBI', 'uhcBI');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Standard font</span>s</span>&nbsp;</div></li><li><div>      $this-&gt;CoreFonts = array('ccourier' =&gt; 'Courier', 'ccourierB' =&gt; 'Courier-Bold', 'ccourierI' =&gt; 'Courier-Oblique', 'ccourierBI' =&gt; 'Courier-BoldOblique', &nbsp;</div></li><li><div>          'chelvetica' =&gt; 'Helvetica', 'chelveticaB' =&gt; 'Helvetica-Bold', 'chelveticaI' =&gt; 'Helvetica-Oblique', 'chelveticaBI' =&gt; 'Helvetica-BoldOblique', &nbsp;</div></li><li><div>          'ctimes' =&gt; 'Times-Roman', 'ctimesB' =&gt; 'Times-Bold', 'ctimesI' =&gt; 'Times-Italic', 'ctimesBI' =&gt; 'Times-BoldItalic', &nbsp;</div></li><li><div>          'csymbol' =&gt; 'Symbol', 'czapfdingbats' =&gt; 'ZapfDingbats');&nbsp;</div></li><li><div>      $this-&gt;fontlist = array(&quot;ctimes&quot;, &quot;ccourier&quot;, &quot;chelvetica&quot;, &quot;csymbol&quot;, &quot;czapfdingbats&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Substitutions</span></span>&nbsp;</div></li><li><div>      $this-&gt;setHiEntitySubstitutions();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;onlyCoreFonts) {&nbsp;</div></li><li><div>          $this-&gt;useSubstitutions = true;&nbsp;</div></li><li><div>          $this-&gt;SetSubstitutions();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!class_exists('cssmgr', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/cssmgr.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;cssmgr = new cssmgr($this);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (file_exists(_MPDF_PATH . 'mpdf.css')) {&nbsp;</div></li><li><div>          $css = file_get_contents(_MPDF_PATH . 'mpdf.css');&nbsp;</div></li><li><div>          $this-&gt;cssmgr-&gt;ReadCSS('&lt;style&gt; ' . $css . ' &lt;/style&gt;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($default_font == '') {&nbsp;</div></li><li><div>          if ($this-&gt;onlyCoreFonts) {&nbsp;</div></li><li><div>              if (in_array(strtolower($this-&gt;defaultCSS['BODY']['FONT-FAMILY']), $this-&gt;mono_fonts)) {&nbsp;</div></li><li><div>                  $default_font = 'ccourier';&nbsp;</div></li><li><div>              } elseif (in_array(strtolower($this-&gt;defaultCSS['BODY']['FONT-FAMILY']), $this-&gt;sans_fonts)) {&nbsp;</div></li><li><div>                  $default_font = 'chelvetica';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $default_font = 'ctimes';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $default_font = $this-&gt;defaultCSS['BODY']['FONT-FAMILY'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$default_font_size) {&nbsp;</div></li><li><div>          $mmsize = $this-&gt;ConvertSize($this-&gt;defaultCSS['BODY']['FONT-SIZE']);&nbsp;</div></li><li><div>          $default_font_size = $mmsize * (_MPDFK);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($default_font) {&nbsp;</div></li><li><div>          $this-&gt;SetDefaultFont($default_font);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($default_font_size) {&nbsp;</div></li><li><div>          $this-&gt;SetDefaultFontSize($default_font_size);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetLineHeight(); <span class="comment">// lineheight is in mm</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>      $this-&gt;HREF = '';&nbsp;</div></li><li><div>      $this-&gt;oldy = -1;&nbsp;</div></li><li><div>      $this-&gt;B = 0;&nbsp;</div></li><li><div>      $this-&gt;I = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>      $this-&gt;listlvl = 0;&nbsp;</div></li><li><div>      $this-&gt;listtype = array();&nbsp;</div></li><li><div>      $this-&gt;listitem = array();&nbsp;</div></li><li><div>      $this-&gt;listcounter = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;tdbegin = false;&nbsp;</div></li><li><div>      $this-&gt;table = array();&nbsp;</div></li><li><div>      $this-&gt;cell = array();&nbsp;</div></li><li><div>      $this-&gt;col = -1;&nbsp;</div></li><li><div>      $this-&gt;row = -1;&nbsp;</div></li><li><div>      $this-&gt;cellBorderBuffer = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;divbegin = false;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;cellTextAlign = '';&nbsp;</div></li><li><div>      $this-&gt;cellLineHeight = '';&nbsp;</div></li><li><div>      $this-&gt;cellLineStackingStrategy = '';&nbsp;</div></li><li><div>      $this-&gt;cellLineStackingShift = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;divwidth = 0;&nbsp;</div></li><li><div>      $this-&gt;divheight = 0;&nbsp;</div></li><li><div>      $this-&gt;spanbgcolor = false;&nbsp;</div></li><li><div>      $this-&gt;spanborder = false;&nbsp;</div></li><li><div>      $this-&gt;spanborddet = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;blockjustfinished = false;&nbsp;</div></li><li><div>      $this-&gt;ignorefollowingspaces = true; <span class="comment">//in order to eliminate exceeding left-side spaces</span>&nbsp;</div></li><li><div>      $this-&gt;dash_on = false;&nbsp;</div></li><li><div>      $this-&gt;dotted_on = false;&nbsp;</div></li><li><div>      $this-&gt;textshadow = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;currentfontfamily = '';&nbsp;</div></li><li><div>      $this-&gt;currentfontsize = '';&nbsp;</div></li><li><div>      $this-&gt;currentfontstyle = '';&nbsp;</div></li><li><div>      $this-&gt;colorarray = ''; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;spanbgcolorarray = ''; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;textbuffer = array();&nbsp;</div></li><li><div>      $this-&gt;internallink = array();&nbsp;</div></li><li><div>      $this-&gt;basepath = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetBasePath('');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;textparam = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;specialcontent = '';&nbsp;</div></li><li><div>      $this-&gt;selectoption = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;tpls = array();&nbsp;</div></li><li><div>      $this-&gt;tpl = 0;&nbsp;</div></li><li><div>      $this-&gt;tplprefix = &quot;/TPL&quot;;&nbsp;</div></li><li><div>      $this-&gt;res = array();&nbsp;</div></li><li><div>      if ($this-&gt;enableImports) {&nbsp;</div></li><li><div>          $this-&gt;SetImportUse();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;tag = new Tag($this);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _setPageSize($format, &$orientation)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Page</span> format</span>&nbsp;</div></li><li><div>      if (is_string($format)) {&nbsp;</div></li><li><div>          if ($format == '') {&nbsp;</div></li><li><div>              $format = 'A4';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $pfo = 'P';&nbsp;</div></li><li><div>          if (preg_match('/([0-9a-zA-Z]*)-L/i', $format, $m)) { <span class="comment">// e.g. A4-L = A4 landscape</span>&nbsp;</div></li><li><div>              $format = $m[1];&nbsp;</div></li><li><div>              $pfo = 'L';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $format = $this-&gt;_getPageFormat($format);&nbsp;</div></li><li><div>          if (!$format) {&nbsp;</div></li><li><div>              throw new MpdfException('Unknown page format: ' . $format);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $orientation = $pfo;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;fwPt = $format[0];&nbsp;</div></li><li><div>          $this-&gt;fhPt = $format[1];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if (!$format[0] || !$format[1]) {&nbsp;</div></li><li><div>              throw new MpdfException('Invalid page format: ' . $format[0] . ' ' . $format[1]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;fwPt = $format[0] * _MPDFK;&nbsp;</div></li><li><div>          $this-&gt;fhPt = $format[1] * _MPDFK;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;fw = $this-&gt;fwPt / _MPDFK;&nbsp;</div></li><li><div>      $this-&gt;fh = $this-&gt;fhPt / _MPDFK;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Page</span> orientation</span>&nbsp;</div></li><li><div>      $orientation = strtolower($orientation);&nbsp;</div></li><li><div>      if ($orientation == 'p' or $orientation == 'portrait') {&nbsp;</div></li><li><div>          $orientation = 'P';&nbsp;</div></li><li><div>          $this-&gt;wPt = $this-&gt;fwPt;&nbsp;</div></li><li><div>          $this-&gt;hPt = $this-&gt;fhPt;&nbsp;</div></li><li><div>      } elseif ($orientation == 'l' or $orientation == 'landscape') {&nbsp;</div></li><li><div>          $orientation = 'L';&nbsp;</div></li><li><div>          $this-&gt;wPt = $this-&gt;fhPt;&nbsp;</div></li><li><div>          $this-&gt;hPt = $this-&gt;fwPt;&nbsp;</div></li><li><div>      } else&nbsp;</div></li><li><div>          throw new MpdfException('Incorrect orientation: ' . $orientation);&nbsp;</div></li><li><div>      $this-&gt;CurOrientation = $orientation;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;w = $this-&gt;wPt / _MPDFK;&nbsp;</div></li><li><div>      $this-&gt;h = $this-&gt;hPt / _MPDFK;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _getPageFormat($format)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      switch (strtoupper($format)) {&nbsp;</div></li><li><div>          case '4A0': {&nbsp;</div></li><li><div>                  $format = array(4767.87, 6740.79);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case '2A0': {&nbsp;</div></li><li><div>                  $format = array(3370.39, 4767.87);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A0': {&nbsp;</div></li><li><div>                  $format = array(2383.94, 3370.39);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A1': {&nbsp;</div></li><li><div>                  $format = array(1683.78, 2383.94);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A2': {&nbsp;</div></li><li><div>                  $format = array(1190.55, 1683.78);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A3': {&nbsp;</div></li><li><div>                  $format = array(841.89, 1190.55);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A4': {&nbsp;</div></li><li><div>                  $format = array(595.28, 841.89);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A5': {&nbsp;</div></li><li><div>                  $format = array(419.53, 595.28);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A6': {&nbsp;</div></li><li><div>                  $format = array(297.64, 419.53);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A7': {&nbsp;</div></li><li><div>                  $format = array(209.76, 297.64);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A8': {&nbsp;</div></li><li><div>                  $format = array(147.40, 209.76);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A9': {&nbsp;</div></li><li><div>                  $format = array(104.88, 147.40);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'A10': {&nbsp;</div></li><li><div>                  $format = array(73.70, 104.88);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B0': {&nbsp;</div></li><li><div>                  $format = array(2834.65, 4008.19);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B1': {&nbsp;</div></li><li><div>                  $format = array(2004.09, 2834.65);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B2': {&nbsp;</div></li><li><div>                  $format = array(1417.32, 2004.09);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B3': {&nbsp;</div></li><li><div>                  $format = array(1000.63, 1417.32);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B4': {&nbsp;</div></li><li><div>                  $format = array(708.66, 1000.63);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B5': {&nbsp;</div></li><li><div>                  $format = array(498.90, 708.66);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B6': {&nbsp;</div></li><li><div>                  $format = array(354.33, 498.90);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B7': {&nbsp;</div></li><li><div>                  $format = array(249.45, 354.33);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B8': {&nbsp;</div></li><li><div>                  $format = array(175.75, 249.45);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B9': {&nbsp;</div></li><li><div>                  $format = array(124.72, 175.75);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B10': {&nbsp;</div></li><li><div>                  $format = array(87.87, 124.72);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C0': {&nbsp;</div></li><li><div>                  $format = array(2599.37, 3676.54);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C1': {&nbsp;</div></li><li><div>                  $format = array(1836.85, 2599.37);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C2': {&nbsp;</div></li><li><div>                  $format = array(1298.27, 1836.85);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C3': {&nbsp;</div></li><li><div>                  $format = array(918.43, 1298.27);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C4': {&nbsp;</div></li><li><div>                  $format = array(649.13, 918.43);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C5': {&nbsp;</div></li><li><div>                  $format = array(459.21, 649.13);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C6': {&nbsp;</div></li><li><div>                  $format = array(323.15, 459.21);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C7': {&nbsp;</div></li><li><div>                  $format = array(229.61, 323.15);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C8': {&nbsp;</div></li><li><div>                  $format = array(161.57, 229.61);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C9': {&nbsp;</div></li><li><div>                  $format = array(113.39, 161.57);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'C10': {&nbsp;</div></li><li><div>                  $format = array(79.37, 113.39);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'RA0': {&nbsp;</div></li><li><div>                  $format = array(2437.80, 3458.27);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'RA1': {&nbsp;</div></li><li><div>                  $format = array(1729.13, 2437.80);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'RA2': {&nbsp;</div></li><li><div>                  $format = array(1218.90, 1729.13);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'RA3': {&nbsp;</div></li><li><div>                  $format = array(864.57, 1218.90);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'RA4': {&nbsp;</div></li><li><div>                  $format = array(609.45, 864.57);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'SRA0': {&nbsp;</div></li><li><div>                  $format = array(2551.18, 3628.35);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'SRA1': {&nbsp;</div></li><li><div>                  $format = array(1814.17, 2551.18);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'SRA2': {&nbsp;</div></li><li><div>                  $format = array(1275.59, 1814.17);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'SRA3': {&nbsp;</div></li><li><div>                  $format = array(907.09, 1275.59);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'SRA4': {&nbsp;</div></li><li><div>                  $format = array(637.80, 907.09);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'LETTER': {&nbsp;</div></li><li><div>                  $format = array(612.00, 792.00);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'LEGAL': {&nbsp;</div></li><li><div>                  $format = array(612.00, 1008.00);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'LEDGER': {&nbsp;</div></li><li><div>                  $format = array(1224.00, 792.00);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'TABLOID': {&nbsp;</div></li><li><div>                  $format = array(792.00, 1224.00);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'EXECUTIVE': {&nbsp;</div></li><li><div>                  $format = array(521.86, 756.00);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'FOLIO': {&nbsp;</div></li><li><div>                  $format = array(612.00, 936.00);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          case 'B': {&nbsp;</div></li><li><div>                  $format = array(362.83, 561.26);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }  <span class="comment">//    'B' format paperback size 128x198mm</span>&nbsp;</div></li><li><div>          case 'A': {&nbsp;</div></li><li><div>                  $format = array(314.65, 504.57);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }  <span class="comment">//    'A' format paperback size 111x178mm</span>&nbsp;</div></li><li><div>          case 'DEMY': {&nbsp;</div></li><li><div>                  $format = array(382.68, 612.28);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }  <span class="comment">//    'Demy' format paperback size 135x216mm</span>&nbsp;</div></li><li><div>          case 'ROYAL': {&nbsp;</div></li><li><div>                  $format = array(433.70, 663.30);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              } <span class="comment">//    'Royal' format paperback size 153x234mm</span>&nbsp;</div></li><li><div>          default: {&nbsp;</div></li><li><div>                  $format = array(595.28, 841.89);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $format;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function RestrictUnicodeFonts($res)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// $res = array of (Unicode) fonts to restrict to: e.g. norasi|norasiB - language specific</span>&nbsp;</div></li><li><div>      if (count($res)) { <span class="comment">// Leave full list of available fonts if passed blank array</span>&nbsp;</div></li><li><div>          $this-&gt;available_unifonts = $res;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;available_unifonts = $this-&gt;default_available_fonts;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (count($this-&gt;available_unifonts) == 0) {&nbsp;</div></li><li><div>          $this-&gt;available_unifonts[] = $this-&gt;default_available_fonts[0];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;available_unifonts = array_values($this-&gt;available_unifonts);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function setMBencoding($enc)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;mb_enc != $enc) {&nbsp;</div></li><li><div>          $this-&gt;mb_enc = $enc;&nbsp;</div></li><li><div>          mb_internal_encoding($this-&gt;mb_enc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetMargins($left, $right, $top)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set left, top and right margins</span>&nbsp;</div></li><li><div>      $this-&gt;lMargin = $left;&nbsp;</div></li><li><div>      $this-&gt;rMargin = $right;&nbsp;</div></li><li><div>      $this-&gt;tMargin = $top;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function ResetMargins()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//ReSet left, top margins</span>&nbsp;</div></li><li><div>      if (($this-&gt;forcePortraitHeaders || $this-&gt;forcePortraitMargins) && $this-&gt;DefOrientation == 'P' && $this-&gt;CurOrientation == 'L') {&nbsp;</div></li><li><div>          if (($this-&gt;mirrorMargins) && (($this-&gt;page) % 2 == 0)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;tMargin = $this-&gt;orig_rMargin;&nbsp;</div></li><li><div>              $this-&gt;bMargin = $this-&gt;orig_lMargin;&nbsp;</div></li><li><div>          } else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ODD</span></span></span>    // OR NOT MIRRORING MARGINS/FOOTERS</span></span>&nbsp;</div></li><li><div>              $this-&gt;tMargin = $this-&gt;orig_lMargin;&nbsp;</div></li><li><div>              $this-&gt;bMargin = $this-&gt;orig_rMargin;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;lMargin = $this-&gt;DeflMargin;&nbsp;</div></li><li><div>          $this-&gt;rMargin = $this-&gt;DefrMargin;&nbsp;</div></li><li><div>          $this-&gt;MarginCorrection = 0;&nbsp;</div></li><li><div>          $this-&gt;PageBreakTrigger = $this-&gt;h - $this-&gt;bMargin;&nbsp;</div></li><li><div>      } elseif (($this-&gt;mirrorMargins) && (($this-&gt;page) % 2 == 0)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;lMargin = $this-&gt;DefrMargin;&nbsp;</div></li><li><div>          $this-&gt;rMargin = $this-&gt;DeflMargin;&nbsp;</div></li><li><div>          $this-&gt;MarginCorrection = $this-&gt;DefrMargin - $this-&gt;DeflMargin;&nbsp;</div></li><li><div>      } else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ODD</span></span></span>    // OR NOT MIRRORING MARGINS/FOOTERS</span></span>&nbsp;</div></li><li><div>          $this-&gt;lMargin = $this-&gt;DeflMargin;&nbsp;</div></li><li><div>          $this-&gt;rMargin = $this-&gt;DefrMargin;&nbsp;</div></li><li><div>          if ($this-&gt;mirrorMargins) {&nbsp;</div></li><li><div>              $this-&gt;MarginCorrection = $this-&gt;DeflMargin - $this-&gt;DefrMargin;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetLeftMargin($margin)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set left margin</span>&nbsp;</div></li><li><div>      $this-&gt;lMargin = $margin;&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0 and $this-&gt;x &lt; $margin)&nbsp;</div></li><li><div>          $this-&gt;x = $margin;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetTopMargin($margin)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set top margin</span>&nbsp;</div></li><li><div>      $this-&gt;tMargin = $margin;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetRightMargin($margin)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set right margin</span>&nbsp;</div></li><li><div>      $this-&gt;rMargin = $margin;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetAutoPageBreak($auto, $margin = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set auto page break mode and triggering margin</span>&nbsp;</div></li><li><div>      $this-&gt;autoPageBreak = $auto;&nbsp;</div></li><li><div>      $this-&gt;bMargin = $margin;&nbsp;</div></li><li><div>      $this-&gt;PageBreakTrigger = $this-&gt;h - $margin;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDisplayMode($zoom, $layout = 'continuous')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set display mode in viewer</span>&nbsp;</div></li><li><div>      if ($zoom == 'fullpage' or $zoom == 'fullwidth' or $zoom == 'real' or $zoom == 'default' or ! is_string($zoom))&nbsp;</div></li><li><div>          $this-&gt;ZoomMode = $zoom;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          throw new MpdfException('Incorrect zoom display mode: ' . $zoom);&nbsp;</div></li><li><div>      if ($layout == 'single' or $layout == 'continuous' or $layout == 'two' or $layout == 'twoleft' or $layout == 'tworight' or $layout == 'default')&nbsp;</div></li><li><div>          $this-&gt;LayoutMode = $layout;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          throw new MpdfException('Incorrect layout display mode: ' . $layout);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetCompression($compress)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set page compression</span>&nbsp;</div></li><li><div>      if (function_exists('gzcompress'))&nbsp;</div></li><li><div>          $this-&gt;compress = $compress;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $this-&gt;compress = false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetTitle($title)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Title of document // Arrives as UTF-8</span>&nbsp;</div></li><li><div>      $this-&gt;title = $title;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetSubject($subject)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Subject of document</span>&nbsp;</div></li><li><div>      $this-&gt;subject = $subject;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetAuthor($author)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Author of document</span>&nbsp;</div></li><li><div>      $this-&gt;author = $author;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetKeywords($keywords)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Keywords of document</span>&nbsp;</div></li><li><div>      $this-&gt;keywords = $keywords;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetCreator($creator)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Creator of document</span>&nbsp;</div></li><li><div>      $this-&gt;creator = $creator;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetAnchor2Bookmark($x)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;anchor2Bookmark = $x;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AliasNbPages($alias = '{nb}')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Define an alias for total number of pages</span>&nbsp;</div></li><li><div>      $this-&gt;aliasNbPg = $alias;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AliasNbPageGroups($alias = '{nbpg}')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Define an alias for total number of pages</span> in a group&nbsp;</div></li><li><div>      $this-&gt;aliasNbPgGp = $alias;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetAlpha($alpha, $bm = 'Normal', $return = false, $mode = 'B')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// alpha: real value from 0 (transparent) to 1 (opaque)</span>&nbsp;</div></li><li><div>      <span class="comment">// bm:    blend mode, one of the following:</span>&nbsp;</div></li><li><div>      <span class="comment">//          Normal, Multiply, Screen, Overlay, Darken, Lighten, ColorDodge, ColorBurn, </span>&nbsp;</div></li><li><div>      <span class="comment">//          HardLight, SoftLight, Difference, Exclusion, Hue, Saturation, Color, Luminosity</span>&nbsp;</div></li><li><div>      <span class="comment">// set alpha for stroking (CA) and non-stroking (ca) operations</span>&nbsp;</div></li><li><div>      <span class="comment">// mode determines F (fill) S (stroke) B (both)</span>&nbsp;</div></li><li><div>      if (($this-&gt;PDFA || $this-&gt;PDFX) && $alpha != 1) {&nbsp;</div></li><li><div>          if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>              $this-&gt;PDFAXwarnings[] = &quot;Image opacity must be 100% (Opacity changed to 100%)&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $alpha = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $a = array('BM' =&gt; '/' . $bm);&nbsp;</div></li><li><div>      if ($mode == 'F' || $mode == 'B')&nbsp;</div></li><li><div>          $a['ca'] = $alpha; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>      if ($mode == 'S' || $mode == 'B')&nbsp;</div></li><li><div>          $a['CA'] = $alpha; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>      $gs = $this-&gt;AddExtGState($a);&nbsp;</div></li><li><div>      if ($return) {&nbsp;</div></li><li><div>          return sprintf('/GS%d gs', $gs);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('/GS%d gs', $gs));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddExtGState($parms)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $n = count($this-&gt;extgstates);&nbsp;</div></li><li><div>      <span class="comment">// check if graphics state already exists</span>&nbsp;</div></li><li><div>      for ($i = 1; $i &lt;= $n; $i++) {&nbsp;</div></li><li><div>          if (count($this-&gt;extgstates[$i]['parms']) == count($parms)) {&nbsp;</div></li><li><div>              $same = true;&nbsp;</div></li><li><div>              foreach ($this-&gt;extgstates[$i]['parms'] AS $k =&gt; $v) {&nbsp;</div></li><li><div>                  if (!isset($parms[$k]) || $parms[$k] != $v) {&nbsp;</div></li><li><div>                      $same = false;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($same) {&nbsp;</div></li><li><div>                  return $i;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $n++;&nbsp;</div></li><li><div>      $this-&gt;extgstates[$n]['parms'] = $parms;&nbsp;</div></li><li><div>      return $n;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetVisibility($v)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (($this-&gt;PDFA || $this-&gt;PDFX) && $this-&gt;visibility != 'visible') {&nbsp;</div></li><li><div>          $this-&gt;PDFAXwarnings[] = &quot;Cannot set visibility to anything other than full when using PDFA or PDFX&quot;;&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } elseif (!$this-&gt;PDFA && !$this-&gt;PDFX)&nbsp;</div></li><li><div>          $this-&gt;pdf_version = '1.5';&nbsp;</div></li><li><div>      if ($this-&gt;visibility != 'visible') {&nbsp;</div></li><li><div>          $this-&gt;_out('EMC');&nbsp;</div></li><li><div>          $this-&gt;hasOC = intval($this-&gt;hasOC);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($v == 'printonly') {&nbsp;</div></li><li><div>          $this-&gt;_out('/OC /OC1 BDC');&nbsp;</div></li><li><div>          $this-&gt;hasOC = ($this-&gt;hasOC | 1);&nbsp;</div></li><li><div>      } elseif ($v == 'screenonly') {&nbsp;</div></li><li><div>          $this-&gt;_out('/OC /OC2 BDC');&nbsp;</div></li><li><div>          $this-&gt;hasOC = ($this-&gt;hasOC | 2);&nbsp;</div></li><li><div>      } elseif ($v == 'hidden') {&nbsp;</div></li><li><div>          $this-&gt;_out('/OC /OC3 BDC');&nbsp;</div></li><li><div>          $this-&gt;hasOC = ($this-&gt;hasOC | 4);&nbsp;</div></li><li><div>      } elseif ($v != 'visible')&nbsp;</div></li><li><div>          throw new MpdfException('Incorrect visibility: ' . $v);&nbsp;</div></li><li><div>      $this-&gt;visibility = $v;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Open()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Begin document</span>&nbsp;</div></li><li><div>      if ($this-&gt;state == 0) {&nbsp;</div></li><li><div>          <span class="comment">// Was is function _begindoc()</span>&nbsp;</div></li><li><div>          <span class="comment">// Start document</span>&nbsp;</div></li><li><div>          $this-&gt;state = 1;&nbsp;</div></li><li><div>          $this-&gt;_out('%PDF-' . $this-&gt;pdf_version);&nbsp;</div></li><li><div>          $this-&gt;_out('%' . chr(226) . chr(227) . chr(207) . chr(211)); <span class="comment">// 4 chars &gt; 128 to show binary file</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Trigger a E_USER_NOTICE so the message is stored in PHP's log</span>&nbsp;</div></li><li><div><span class="comment">   * @param String $message</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function Notice( $message ) {&nbsp;</div></li><li><div>      trigger_error( $message );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span>&nbsp;</div></li><li><div>  <span class="comment">// DEPRACATED but included for backwards compatability</span>&nbsp;</div></li><li><div>  <span class="comment">// Depracated - can use AddPage for all</span>&nbsp;</div></li><li><div>  function AddPages($a = '', $b = '', $c = '', $d = '', $e = '', $f = '', $g = '', $h = '', $i = '', $j = '', $k = '', $l = '', $m = '', $n = '', $o = '', $p = 0, $q = 0, $r = 0, $s = 0, $t = '', $u = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Notice('function AddPages is depracated as of mPDF 6. Please use AddPage or HTML code methods instead.');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function startPageNums()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Notice('function startPageNums is depracated as of mPDF 6.');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function setUnvalidatedText($a = '', $b = -1)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Notice('function setUnvalidatedText is depracated as of mPDF 6. Please use SetWatermarkText instead.');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetAutoFont($a)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if($a === 0) {&nbsp;</div></li><li><div>          $this-&gt;autoLangToFont = false;&nbsp;</div></li><li><div>          $this-&gt;autoScriptToLang = false;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;autoLangToFont = true;&nbsp;</div></li><li><div>          $this-&gt;autoScriptToLang = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;Notice('function SetAutoFont is depracated as of mPDF 6. Please use autoScriptToLang instead. See config.php');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Reference($a)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Notice('function Reference is depracated as of mPDF 6. Please use IndexEntry instead.');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function ReferenceSee($a, $b)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Notice('function ReferenceSee is depracated as of mPDF 6. Please use IndexEntrySee instead.');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function CreateReference($a = 1, $b = '', $c = '', $d = 3, $e = 1, $f = '', $g = 5, $h = '', $i = '', $j = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Notice('function CreateReference is depracated as of mPDF 6. Please use InsertIndex instead.');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function CreateIndex($a = 1, $b = '', $c = '', $d = 3, $e = 1, $f = '', $g = 5, $h = '', $i = '', $j = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Notice('function CreateIndex is depracated as of mPDF 6. Please use InsertIndex instead.');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Close()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Check old Aliases - now depracated mPDF 6</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;UnvalidatedText)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;UnvalidatedText is depracated as of mPDF 6. Please use $mpdf-&gt;watermarkText  instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;TopicIsUnvalidated)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;TopicIsUnvalidated is depracated as of mPDF 6. Please use $mpdf-&gt;showWatermarkText instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;AliasNbPg)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;AliasNbPg is depracated as of mPDF 6. Please use $mpdf-&gt;aliasNbPg instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;AliasNbPgGp)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;AliasNbPgGp is depracated as of mPDF 6. Please use $mpdf-&gt;aliasNbPgGp instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;BiDirectional)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;BiDirectional is depracated as of mPDF 6. Please use $mpdf-&gt;biDirectional instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;Anchor2Bookmark)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;Anchor2Bookmark is depracated as of mPDF 6. Please use $mpdf-&gt;anchor2Bookmark instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;KeepColumns)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;KeepColumns is depracated as of mPDF 6. Please use $mpdf-&gt;keepColumns instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;useOddEven)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;useOddEven is depracated as of mPDF 6. Please use $mpdf-&gt;mirrorMargins instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;useSubstitutionsMB)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;useSubstitutionsMB is depracated as of mPDF 6. Please use $mpdf-&gt;useSubstitutions instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;useLang)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;useLang is depracated as of mPDF 6. Please use $mpdf-&gt;autoLangToFont instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;useAutoFont)) {&nbsp;</div></li><li><div>          $this-&gt;Notice('$mpdf-&gt;useAutoFont is depracated. Please use $mpdf-&gt;autoScriptToLang instead.');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Terminate document</span>&nbsp;</div></li><li><div>      if ($this-&gt;state == 3)&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      if ($this-&gt;page == 0)&nbsp;</div></li><li><div>          $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>      if (count($this-&gt;cellBorderBuffer)) {&nbsp;</div></li><li><div>          $this-&gt;printcellbuffer();&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;tablebuffer) {&nbsp;</div></li><li><div>          $this-&gt;printtablebuffer();&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          $this-&gt;SetColumns(0);&nbsp;</div></li><li><div>          $this-&gt;ColActive = 0;&nbsp;</div></li><li><div>          if (count($this-&gt;columnbuffer)) {&nbsp;</div></li><li><div>              $this-&gt;printcolumnbuffer();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// BODY Backgrounds</span></span>&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s .= $this-&gt;PrintBodyBackgrounds();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s .= $this-&gt;PrintPageBackgrounds();&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] = preg_replace('/(___BACKGROUND___PATTERNS' . $this-&gt;uniqstr . ')/', &quot;\n&quot; . $s . &quot;\n&quot; . '\\1', $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>      $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;visibility != 'visible')&nbsp;</div></li><li><div>          $this-&gt;SetVisibility('visible');&nbsp;</div></li><li><div>      $this-&gt;EndLayer();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;tocontents || !$this-&gt;tocontents-&gt;TOCmark) { <span class="comment"><span class="comment"><span class="comment">//Page</span> footer</span></span>&nbsp;</div></li><li><div>          $this-&gt;InFooter = true;&nbsp;</div></li><li><div>          $this-&gt;Footer();&nbsp;</div></li><li><div>          $this-&gt;InFooter = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;tocontents && ($this-&gt;tocontents-&gt;TOCmark || count($this-&gt;tocontents-&gt;m_TOC))) {&nbsp;</div></li><li><div>          $this-&gt;tocontents-&gt;insertTOC();&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment">// *TOC*</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Close page</span></span>&nbsp;</div></li><li><div>      $this-&gt;_endpage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Close document</span>&nbsp;</div></li><li><div>      $this-&gt;_enddoc();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _resizeBackgroundImage($imw, $imh, $cw, $ch, $resize = 0, $repx, $repy, $pba = array(), $size = array())&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// pba is background positioning area (from CSS background-origin) may not always be set [x, y, w, h]</span>&nbsp;</div></li><li><div>      <span class="comment">// size is from CSS3 background-size - takes precendence over old resize</span>&nbsp;</div></li><li><div>      <span class="comment">//    $w - absolute length or % or auto or cover | contain</span>&nbsp;</div></li><li><div>      <span class="comment">//    $h - absolute length or % or auto or cover | contain</span>&nbsp;</div></li><li><div>      if (isset($pba['w']))&nbsp;</div></li><li><div>          $cw = $pba['w'];&nbsp;</div></li><li><div>      if (isset($pba['h']))&nbsp;</div></li><li><div>          $ch = $pba['h'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cw = $cw * _MPDFK;&nbsp;</div></li><li><div>      $ch = $ch * _MPDFK;&nbsp;</div></li><li><div>      if (empty($size) && !$resize) {&nbsp;</div></li><li><div>          return array($imw, $imh, $repx, $repy);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($size['w']) && $size['w']) {&nbsp;</div></li><li><div>          if ($size['w'] == 'contain') {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// Scale the image, while preserving its intrinsic aspect ratio (if any), to the largest size such that both its width and its height can fit inside the background positioning area.</span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// Same as resize==3</span></span></span>&nbsp;</div></li><li><div>              $h = $imh * $cw / $imw;&nbsp;</div></li><li><div>              $w = $cw;&nbsp;</div></li><li><div>              if ($h &gt; $ch) {&nbsp;</div></li><li><div>                  $w = $w * $ch / $h;&nbsp;</div></li><li><div>                  $h = $ch;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($size['w'] == 'cover') {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// Scale the image, while preserving its intrinsic aspect ratio (if any), to the smallest size such that both its width and its height can completely cover the background positioning area.</span></span></span>&nbsp;</div></li><li><div>              $h = $imh * $cw / $imw;&nbsp;</div></li><li><div>              $w = $cw;&nbsp;</div></li><li><div>              if ($h &lt; $ch) {&nbsp;</div></li><li><div>                  $w = $w * $h / $ch;&nbsp;</div></li><li><div>                  $h = $ch;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if (stristr($size['w'], '%')) {&nbsp;</div></li><li><div>                  $size['w'] += 0;&nbsp;</div></li><li><div>                  $size['w'] /= 100;&nbsp;</div></li><li><div>                  $size['w'] = ($cw * $size['w']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (stristr($size['h'], '%')) {&nbsp;</div></li><li><div>                  $size['h'] += 0;&nbsp;</div></li><li><div>                  $size['h'] /= 100;&nbsp;</div></li><li><div>                  $size['h'] = ($ch * $size['h']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($size['w'] == 'auto' && $size['h'] == 'auto') {&nbsp;</div></li><li><div>                  $w = $imw;&nbsp;</div></li><li><div>                  $h = $imh;&nbsp;</div></li><li><div>              } elseif ($size['w'] == 'auto' && $size['h'] != 'auto') {&nbsp;</div></li><li><div>                  $w = $imw * $size['h'] / $imh;&nbsp;</div></li><li><div>                  $h = $size['h'];&nbsp;</div></li><li><div>              } elseif ($size['w'] != 'auto' && $size['h'] == 'auto') {&nbsp;</div></li><li><div>                  $h = $imh * $size['w'] / $imw;&nbsp;</div></li><li><div>                  $w = $size['w'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $w = $size['w'];&nbsp;</div></li><li><div>                  $h = $size['h'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return array($w, $h, $repx, $repy);&nbsp;</div></li><li><div>      } elseif ($resize == 1 && $imw &gt; $cw) {&nbsp;</div></li><li><div>          $h = $imh * $cw / $imw;&nbsp;</div></li><li><div>          return array($cw, $h, $repx, $repy);&nbsp;</div></li><li><div>      } elseif ($resize == 2 && $imh &gt; $ch) {&nbsp;</div></li><li><div>          $w = $imw * $ch / $imh;&nbsp;</div></li><li><div>          return array($w, $ch, $repx, $repy);&nbsp;</div></li><li><div>      } elseif ($resize == 3) {&nbsp;</div></li><li><div>          $w = $imw;&nbsp;</div></li><li><div>          $h = $imh;&nbsp;</div></li><li><div>          if ($w &gt; $cw) {&nbsp;</div></li><li><div>              $h = $h * $cw / $w;&nbsp;</div></li><li><div>              $w = $cw;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($h &gt; $ch) {&nbsp;</div></li><li><div>              $w = $w * $ch / $h;&nbsp;</div></li><li><div>              $h = $ch;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return array($w, $h, $repx, $repy);&nbsp;</div></li><li><div>      } elseif ($resize == 4) {&nbsp;</div></li><li><div>          $h = $imh * $cw / $imw;&nbsp;</div></li><li><div>          return array($cw, $h, $repx, $repy);&nbsp;</div></li><li><div>      } elseif ($resize == 5) {&nbsp;</div></li><li><div>          $w = $imw * $ch / $imh;&nbsp;</div></li><li><div>          return array($w, $ch, $repx, $repy);&nbsp;</div></li><li><div>      } elseif ($resize == 6) {&nbsp;</div></li><li><div>          return array($cw, $ch, $repx, $repy);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array($imw, $imh, $repx, $repy);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetBackground(&$properties, &$maxwidth)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (isset($properties['BACKGROUND-ORIGIN']) && ($properties['BACKGROUND-ORIGIN'] == 'border-box' || $properties['BACKGROUND-ORIGIN'] == 'content-box')) {&nbsp;</div></li><li><div>          $origin = $properties['BACKGROUND-ORIGIN'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $origin = 'padding-box';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($properties['BACKGROUND-SIZE'])) {&nbsp;</div></li><li><div>          if (stristr($properties['BACKGROUND-SIZE'], 'contain')) {&nbsp;</div></li><li><div>              $bsw = $bsh = 'contain';&nbsp;</div></li><li><div>          } elseif (stristr($properties['BACKGROUND-SIZE'], 'cover')) {&nbsp;</div></li><li><div>              $bsw = $bsh = 'cover';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $bsw = $bsh = 'auto';&nbsp;</div></li><li><div>              $sz = preg_split('/\s+/', trim($properties['BACKGROUND-SIZE']));&nbsp;</div></li><li><div>              if (count($sz) == 2) {&nbsp;</div></li><li><div>                  $bsw = $sz[0];&nbsp;</div></li><li><div>                  $bsh = $sz[1];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $bsw = $sz[0];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!stristr($bsw, '%') && !stristr($bsw, 'auto')) {&nbsp;</div></li><li><div>                  $bsw = $this-&gt;ConvertSize($bsw, $maxwidth, $this-&gt;FontSize);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!stristr($bsh, '%') && !stristr($bsh, 'auto')) {&nbsp;</div></li><li><div>                  $bsh = $this-&gt;ConvertSize($bsh, $maxwidth, $this-&gt;FontSize);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $size = array('w' =&gt; $bsw, 'h' =&gt; $bsh);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $size = false;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (preg_match('/(-moz-)*(repeating-)*(linear|radial)-gradient/', $properties['BACKGROUND-IMAGE'])) {&nbsp;</div></li><li><div>          return array('gradient' =&gt; $properties['BACKGROUND-IMAGE'], 'origin' =&gt; $origin, 'size' =&gt; $size);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $file = $properties['BACKGROUND-IMAGE'];&nbsp;</div></li><li><div>          $sizesarray = $this-&gt;Image($file, 0, 0, 0, 0, '', '', false, false, false, false, true);&nbsp;</div></li><li><div>          if (isset($sizesarray['IMAGE_ID'])) {&nbsp;</div></li><li><div>              $image_id = $sizesarray['IMAGE_ID'];&nbsp;</div></li><li><div>              $orig_w = $sizesarray['WIDTH'] * _MPDFK;  <span class="comment">// in user units i.e. mm</span>&nbsp;</div></li><li><div>              $orig_h = $sizesarray['HEIGHT'] * _MPDFK;  <span class="comment">// (using $this-&gt;img_dpi)</span>&nbsp;</div></li><li><div>              if (isset($properties['BACKGROUND-IMAGE-RESOLUTION'])) {&nbsp;</div></li><li><div>                  if (preg_match('/from-image/i', $properties['BACKGROUND-IMAGE-RESOLUTION']) && isset($sizesarray['set-dpi']) && $sizesarray['set-dpi'] &gt; 0) {&nbsp;</div></li><li><div>                      $orig_w *= $this-&gt;img_dpi / $sizesarray['set-dpi'];&nbsp;</div></li><li><div>                      $orig_h *= $this-&gt;img_dpi / $sizesarray['set-dpi'];&nbsp;</div></li><li><div>                  } elseif (preg_match('/(\d+)dpi/i', $properties['BACKGROUND-IMAGE-RESOLUTION'], $m)) {&nbsp;</div></li><li><div>                      $dpi = $m[1];&nbsp;</div></li><li><div>                      if ($dpi &gt; 0) {&nbsp;</div></li><li><div>                          $orig_w *= $this-&gt;img_dpi / $dpi;&nbsp;</div></li><li><div>                          $orig_h *= $this-&gt;img_dpi / $dpi;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $x_repeat = true;&nbsp;</div></li><li><div>              $y_repeat = true;&nbsp;</div></li><li><div>              if (isset($properties['BACKGROUND-REPEAT'])) {&nbsp;</div></li><li><div>                  if ($properties['BACKGROUND-REPEAT'] == 'no-repeat' || $properties['BACKGROUND-REPEAT'] == 'repeat-x') {&nbsp;</div></li><li><div>                      $y_repeat = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($properties['BACKGROUND-REPEAT'] == 'no-repeat' || $properties['BACKGROUND-REPEAT'] == 'repeat-y') {&nbsp;</div></li><li><div>                      $x_repeat = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $x_pos = 0;&nbsp;</div></li><li><div>              $y_pos = 0;&nbsp;</div></li><li><div>              if (isset($properties['BACKGROUND-POSITION'])) {&nbsp;</div></li><li><div>                  $ppos = preg_split('/\s+/', $properties['BACKGROUND-POSITION']);&nbsp;</div></li><li><div>                  $x_pos = $ppos[0];&nbsp;</div></li><li><div>                  $y_pos = $ppos[1];&nbsp;</div></li><li><div>                  if (!stristr($x_pos, '%')) {&nbsp;</div></li><li><div>                      $x_pos = $this-&gt;ConvertSize($x_pos, $maxwidth, $this-&gt;FontSize);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!stristr($y_pos, '%')) {&nbsp;</div></li><li><div>                      $y_pos = $this-&gt;ConvertSize($y_pos, $maxwidth, $this-&gt;FontSize);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($properties['BACKGROUND-IMAGE-RESIZE'])) {&nbsp;</div></li><li><div>                  $resize = $properties['BACKGROUND-IMAGE-RESIZE'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $resize = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($properties['BACKGROUND-IMAGE-OPACITY'])) {&nbsp;</div></li><li><div>                  $opacity = $properties['BACKGROUND-IMAGE-OPACITY'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $opacity = 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return array('image_id' =&gt; $image_id, 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $x_pos, 'y_pos' =&gt; $y_pos, 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'resize' =&gt; $resize, 'opacity' =&gt; $opacity, 'itype' =&gt; $sizesarray['itype'], 'origin' =&gt; $origin, 'size' =&gt; $size);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function PrintBodyBackgrounds()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>      $clx = 0;&nbsp;</div></li><li><div>      $cly = 0;&nbsp;</div></li><li><div>      $clw = $this-&gt;w;&nbsp;</div></li><li><div>      $clh = $this-&gt;h;&nbsp;</div></li><li><div>      <span class="comment">// If using bleed and trim margins in paged media</span>&nbsp;</div></li><li><div>      if ($this-&gt;pageDim[$this-&gt;page]['outer_width_LR'] || $this-&gt;pageDim[$this-&gt;page]['outer_width_TB']) {&nbsp;</div></li><li><div>          $clx = $this-&gt;pageDim[$this-&gt;page]['outer_width_LR'] - $this-&gt;pageDim[$this-&gt;page]['bleedMargin'];&nbsp;</div></li><li><div>          $cly = $this-&gt;pageDim[$this-&gt;page]['outer_width_TB'] - $this-&gt;pageDim[$this-&gt;page]['bleedMargin'];&nbsp;</div></li><li><div>          $clw = $this-&gt;w - 2 * $clx;&nbsp;</div></li><li><div>          $clh = $this-&gt;h - 2 * $cly;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;bodyBackgroundColor) {&nbsp;</div></li><li><div>          $s .= 'q ' . $this-&gt;SetFColor($this-&gt;bodyBackgroundColor, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>          if ($this-&gt;bodyBackgroundColor{0} == 5) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>              $s .= $this-&gt;SetAlpha(ord($this-&gt;bodyBackgroundColor{4}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>          } elseif ($this-&gt;bodyBackgroundColor{0} == 6) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>              $s .= $this-&gt;SetAlpha(ord($this-&gt;bodyBackgroundColor{5}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $s .= sprintf('%.3F %.3F %.3F %.3F re f Q', ($clx * _MPDFK), ($cly * _MPDFK), $clw * _MPDFK, $clh * _MPDFK) . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;bodyBackgroundGradient) {&nbsp;</div></li><li><div>          $g = $this-&gt;grad-&gt;parseBackgroundGradient($this-&gt;bodyBackgroundGradient);&nbsp;</div></li><li><div>          if ($g) {&nbsp;</div></li><li><div>              $s .= $this-&gt;grad-&gt;Gradient($clx, $cly, $clw, $clh, (isset($g['gradtype']) ? $g['gradtype'] : null), $g['stops'], $g['colorspace'], $g['coords'], $g['extend'], true);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;bodyBackgroundImage) {&nbsp;</div></li><li><div>          if (isset($this-&gt;bodyBackgroundImage['gradient']) && $this-&gt;bodyBackgroundImage['gradient'] && preg_match('/(-moz-)*(repeating-)*(linear|radial)-gradient/', $this-&gt;bodyBackgroundImage['gradient'])) {&nbsp;</div></li><li><div>              $g = $this-&gt;grad-&gt;parseMozGradient($this-&gt;bodyBackgroundImage['gradient']);&nbsp;</div></li><li><div>              if ($g) {&nbsp;</div></li><li><div>                  $s .= $this-&gt;grad-&gt;Gradient($clx, $cly, $clw, $clh, $g['type'], $g['stops'], $g['colorspace'], $g['coords'], $g['extend'], true);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($this-&gt;bodyBackgroundImage['image_id']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Background pattern</span></span></span></span>&nbsp;</div></li><li><div>              $n = count($this-&gt;patterns) + 1;&nbsp;</div></li><li><div>              <span class="comment">// If using resize, uses TrimBox (not including the bleed)</span>&nbsp;</div></li><li><div>              list($orig_w, $orig_h, $x_repeat, $y_repeat) = $this-&gt;_resizeBackgroundImage($this-&gt;bodyBackgroundImage['orig_w'], $this-&gt;bodyBackgroundImage['orig_h'], $clw, $clh, $this-&gt;bodyBackgroundImage['resize'], $this-&gt;bodyBackgroundImage['x_repeat'], $this-&gt;bodyBackgroundImage['y_repeat']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;patterns[$n] = array('x' =&gt; $clx, 'y' =&gt; $cly, 'w' =&gt; $clw, 'h' =&gt; $clh, 'pgh' =&gt; $this-&gt;h, 'image_id' =&gt; $this-&gt;bodyBackgroundImage['image_id'], 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $this-&gt;bodyBackgroundImage['x_pos'], 'y_pos' =&gt; $this-&gt;bodyBackgroundImage['y_pos'], 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'itype' =&gt; $this-&gt;bodyBackgroundImage['itype']);&nbsp;</div></li><li><div>              if (($this-&gt;bodyBackgroundImage['opacity'] &gt; 0 || $this-&gt;bodyBackgroundImage['opacity'] === '0') && $this-&gt;bodyBackgroundImage['opacity'] &lt; 1) {&nbsp;</div></li><li><div>                  $opac = $this-&gt;SetAlpha($this-&gt;bodyBackgroundImage['opacity'], 'Normal', true);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $opac = '';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s .= sprintf('q /Pattern cs /P%d scn %s %.3F %.3F %.3F %.3F re f Q', $n, $opac, ($clx * _MPDFK), ($cly * _MPDFK), $clw * _MPDFK, $clh * _MPDFK) . &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _setClippingPath($clx, $cly, $clw, $clh)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = ' q 0 w '; <span class="comment"><span class="comment">// Line width</span>=0</span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F m ', ($clx) * _MPDFK, ($this-&gt;h - ($cly)) * _MPDFK); <span class="comment"><span class="comment">// start point TL before the arc</span></span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F l ', ($clx) * _MPDFK, ($this-&gt;h - ($cly + $clh)) * _MPDFK); <span class="comment"><span class="comment">// line to BL</span></span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F l ', ($clx + $clw) * _MPDFK, ($this-&gt;h - ($cly + $clh)) * _MPDFK); <span class="comment"><span class="comment">// line to BR</span></span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F l ', ($clx + $clw) * _MPDFK, ($this-&gt;h - ($cly)) * _MPDFK); <span class="comment"><span class="comment">// line to TR</span></span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F l ', ($clx) * _MPDFK, ($this-&gt;h - ($cly)) * _MPDFK); <span class="comment"><span class="comment">// line to TL</span></span>&nbsp;</div></li><li><div>      $s .= ' W n '; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function PrintPageBackgrounds($adjustmenty = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      ksort($this-&gt;pageBackgrounds);&nbsp;</div></li><li><div>      foreach ($this-&gt;pageBackgrounds AS $bl =&gt; $pbs) {&nbsp;</div></li><li><div>          foreach ($pbs AS $pb) {&nbsp;</div></li><li><div>              if ((!isset($pb['image_id']) && !isset($pb['gradient'])) || isset($pb['shadowonly'])) { <span class="comment">// Background colour or boxshadow</span>&nbsp;</div></li><li><div>                  if ($pb['z-index'] &gt; 0) {&nbsp;</div></li><li><div>                      $this-&gt;current_layer = $pb['z-index'];&nbsp;</div></li><li><div>                      $s .= &quot;\n&quot; . '/OCBZ-index /ZI' . $pb['z-index'] . ' BDC' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($pb['visibility'] != 'visible') {&nbsp;</div></li><li><div>                      if ($pb['visibility'] == 'printonly')&nbsp;</div></li><li><div>                          $s .= '/OC /OC1 BDC' . &quot;\n&quot;;&nbsp;</div></li><li><div>                      elseif ($pb['visibility'] == 'screenonly')&nbsp;</div></li><li><div>                          $s .= '/OC /OC2 BDC' . &quot;\n&quot;;&nbsp;</div></li><li><div>                      elseif ($pb['visibility'] == 'hidden')&nbsp;</div></li><li><div>                          $s .= '/OC /OC3 BDC' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment">// Box shadow</span>&nbsp;</div></li><li><div>                  if (isset($pb['shadow']) && $pb['shadow']) {&nbsp;</div></li><li><div>                      $s .= $pb['shadow'] . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= $pb['clippath'] . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $s .= 'q ' . $this-&gt;SetFColor($pb['col'], true) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  if ($pb['col']{0} == 5) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                      $s .= $this-&gt;SetAlpha(ord($pb['col']{4}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>                  } elseif ($pb['col']{0} == 6) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                      $s .= $this-&gt;SetAlpha(ord($pb['col']{5}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $s .= sprintf('%.3F %.3F %.3F %.3F re f Q', $pb['x'] * _MPDFK, ($this-&gt;h - $pb['y']) * _MPDFK, $pb['w'] * _MPDFK, -$pb['h'] * _MPDFK) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= 'Q' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($pb['visibility'] != 'visible')&nbsp;</div></li><li><div>                      $s .= 'EMC' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($pb['z-index'] &gt; 0) {&nbsp;</div></li><li><div>                      $s .= &quot;\n&quot; . 'EMCBZ-index' . &quot;\n&quot;;&nbsp;</div></li><li><div>                      $this-&gt;current_layer = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          foreach ($pbs AS $pb) {&nbsp;</div></li><li><div>              if ((isset($pb['gradient']) && $pb['gradient']) || (isset($pb['image_id']) && $pb['image_id'])) {&nbsp;</div></li><li><div>                  if ($pb['z-index'] &gt; 0) {&nbsp;</div></li><li><div>                      $this-&gt;current_layer = $pb['z-index'];&nbsp;</div></li><li><div>                      $s .= &quot;\n&quot; . '/OCGZ-index /ZI' . $pb['z-index'] . ' BDC' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($pb['visibility'] != 'visible') {&nbsp;</div></li><li><div>                      if ($pb['visibility'] == 'printonly')&nbsp;</div></li><li><div>                          $s .= '/OC /OC1 BDC' . &quot;\n&quot;;&nbsp;</div></li><li><div>                      elseif ($pb['visibility'] == 'screenonly')&nbsp;</div></li><li><div>                          $s .= '/OC /OC2 BDC' . &quot;\n&quot;;&nbsp;</div></li><li><div>                      elseif ($pb['visibility'] == 'hidden')&nbsp;</div></li><li><div>                          $s .= '/OC /OC3 BDC' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($pb['gradient']) && $pb['gradient']) {&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= $pb['clippath'] . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $s .= $this-&gt;grad-&gt;Gradient($pb['x'], $pb['y'], $pb['w'], $pb['h'], $pb['gradtype'], $pb['stops'], $pb['colorspace'], $pb['coords'], $pb['extend'], true);&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= 'Q' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif (isset($pb['image_id']) && $pb['image_id']) { <span class="comment">// Background Image</span>&nbsp;</div></li><li><div>                  $pb['y'] -= $adjustmenty;&nbsp;</div></li><li><div>                  $pb['h'] += $adjustmenty;&nbsp;</div></li><li><div>                  $n = count($this-&gt;patterns) + 1;&nbsp;</div></li><li><div>                  list($orig_w, $orig_h, $x_repeat, $y_repeat) = $this-&gt;_resizeBackgroundImage($pb['orig_w'], $pb['orig_h'], $pb['w'], $pb['h'], $pb['resize'], $pb['x_repeat'], $pb['y_repeat'], $pb['bpa'], $pb['size']);&nbsp;</div></li><li><div>                  $this-&gt;patterns[$n] = array('x' =&gt; $pb['x'], 'y' =&gt; $pb['y'], 'w' =&gt; $pb['w'], 'h' =&gt; $pb['h'], 'pgh' =&gt; $this-&gt;h, 'image_id' =&gt; $pb['image_id'], 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $pb['x_pos'], 'y_pos' =&gt; $pb['y_pos'], 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'itype' =&gt; $pb['itype'], 'bpa' =&gt; $pb['bpa']);&nbsp;</div></li><li><div>                  $x = $pb['x'] * _MPDFK;&nbsp;</div></li><li><div>                  $y = ($this-&gt;h - $pb['y']) * _MPDFK;&nbsp;</div></li><li><div>                  $w = $pb['w'] * _MPDFK;&nbsp;</div></li><li><div>                  $h = -$pb['h'] * _MPDFK;&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= $pb['clippath'] . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;writingHTMLfooter || $this-&gt;writingHTMLheader) { <span class="comment"><span class="comment">// Write each (tiles) image rather than use as a pattern</span></span>&nbsp;</div></li><li><div>                      $iw = $pb['orig_w'] / _MPDFK;&nbsp;</div></li><li><div>                      $ih = $pb['orig_h'] / _MPDFK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $w = $pb['w'];&nbsp;</div></li><li><div>                      $h = $pb['h'];&nbsp;</div></li><li><div>                      $x0 = $pb['x'];&nbsp;</div></li><li><div>                      $y0 = $pb['y'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (isset($pb['bpa']) && $pb['bpa']) {&nbsp;</div></li><li><div>                          $w = $pb['bpa']['w'];&nbsp;</div></li><li><div>                          $h = $pb['bpa']['h'];&nbsp;</div></li><li><div>                          $x0 = $pb['bpa']['x'];&nbsp;</div></li><li><div>                          $y0 = $pb['bpa']['y'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (isset($pb['size']['w']) && $pb['size']['w']) {&nbsp;</div></li><li><div>                          $size = $pb['size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($size['w'] == 'contain') {&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment">// Scale the image, while preserving its intrinsic aspect ratio (if any), to the largest size such that both its width and its height can fit inside the background positioning area.</span></span></span>&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment">// Same as resize==3</span></span></span>&nbsp;</div></li><li><div>                              $ih = $ih * $pb['bpa']['w'] / $iw;&nbsp;</div></li><li><div>                              $iw = $pb['bpa']['w'];&nbsp;</div></li><li><div>                              if ($ih &gt; $pb['bpa']['h']) {&nbsp;</div></li><li><div>                                  $iw = $iw * $pb['bpa']['h'] / $ih;&nbsp;</div></li><li><div>                                  $ih = $pb['bpa']['h'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } elseif ($size['w'] == 'cover') {&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment">// Scale the image, while preserving its intrinsic aspect ratio (if any), to the smallest size such that both its width and its height can completely cover the background positioning area.</span></span></span>&nbsp;</div></li><li><div>                              $ih = $ih * $pb['bpa']['w'] / $iw;&nbsp;</div></li><li><div>                              $iw = $pb['bpa']['w'];&nbsp;</div></li><li><div>                              if ($ih &lt; $pb['bpa']['h']) {&nbsp;</div></li><li><div>                                  $iw = $iw * $ih / $pb['bpa']['h'];&nbsp;</div></li><li><div>                                  $ih = $pb['bpa']['h'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              if (stristr($size['w'], '%')) {&nbsp;</div></li><li><div>                                  $size['w'] += 0;&nbsp;</div></li><li><div>                                  $size['w'] /= 100;&nbsp;</div></li><li><div>                                  $size['w'] = ($pb['bpa']['w'] * $size['w']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if (stristr($size['h'], '%')) {&nbsp;</div></li><li><div>                                  $size['h'] += 0;&nbsp;</div></li><li><div>                                  $size['h'] /= 100;&nbsp;</div></li><li><div>                                  $size['h'] = ($pb['bpa']['h'] * $size['h']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($size['w'] == 'auto' && $size['h'] == 'auto') {&nbsp;</div></li><li><div>                                  $iw = $iw;&nbsp;</div></li><li><div>                                  $ih = $ih;&nbsp;</div></li><li><div>                              } elseif ($size['w'] == 'auto' && $size['h'] != 'auto') {&nbsp;</div></li><li><div>                                  $iw = $iw * $size['h'] / $ih;&nbsp;</div></li><li><div>                                  $ih = $size['h'];&nbsp;</div></li><li><div>                              } elseif ($size['w'] != 'auto' && $size['h'] == 'auto') {&nbsp;</div></li><li><div>                                  $ih = $ih * $size['w'] / $iw;&nbsp;</div></li><li><div>                                  $iw = $size['w'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $iw = $size['w'];&nbsp;</div></li><li><div>                                  $ih = $size['h'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Number to repeat</span></span>&nbsp;</div></li><li><div>                      if ($pb['x_repeat']) {&nbsp;</div></li><li><div>                          $nx = ceil($pb['w'] / $iw) + 1;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $nx = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($pb['y_repeat']) {&nbsp;</div></li><li><div>                          $ny = ceil($pb['h'] / $ih) + 1;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $ny = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $x_pos = $pb['x_pos'];&nbsp;</div></li><li><div>                      if (stristr($x_pos, '%')) {&nbsp;</div></li><li><div>                          $x_pos += 0;&nbsp;</div></li><li><div>                          $x_pos /= 100;&nbsp;</div></li><li><div>                          $x_pos = ($pb['bpa']['w'] * $x_pos) - ($iw * $x_pos);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $y_pos = $pb['y_pos'];&nbsp;</div></li><li><div>                      if (stristr($y_pos, '%')) {&nbsp;</div></li><li><div>                          $y_pos += 0;&nbsp;</div></li><li><div>                          $y_pos /= 100;&nbsp;</div></li><li><div>                          $y_pos = ($pb['bpa']['h'] * $y_pos) - ($ih * $y_pos);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($nx &gt; 1) {&nbsp;</div></li><li><div>                          while ($x_pos &gt; ($pb['x'] - $pb['bpa']['x'])) {&nbsp;</div></li><li><div>                              $x_pos -= $iw;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($ny &gt; 1) {&nbsp;</div></li><li><div>                          while ($y_pos &gt; ($pb['y'] - $pb['bpa']['y'])) {&nbsp;</div></li><li><div>                              $y_pos -= $ih;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      for ($xi = 0; $xi &lt; $nx; $xi++) {&nbsp;</div></li><li><div>                          for ($yi = 0; $yi &lt; $ny; $yi++) {&nbsp;</div></li><li><div>                              $x = $x0 + $x_pos + ($iw * $xi);&nbsp;</div></li><li><div>                              $y = $y0 + $y_pos + ($ih * $yi);&nbsp;</div></li><li><div>                              if ($pb['opacity'] &gt; 0 && $pb['opacity'] &lt; 1) {&nbsp;</div></li><li><div>                                  $opac = $this-&gt;SetAlpha($pb['opacity'], 'Normal', true);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $opac = '';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $s .= sprintf(&quot;q %s %.3F 0 0 %.3F %.3F %.3F cm /I%d Do Q&quot;, $opac, $iw * _MPDFK, $ih * _MPDFK, $x * _MPDFK, ($this-&gt;h - ($y + $ih)) * _MPDFK, $pb['image_id']) . &quot;\n&quot;;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if (($pb['opacity'] &gt; 0 || $pb['opacity'] === '0') && $pb['opacity'] &lt; 1) {&nbsp;</div></li><li><div>                          $opac = $this-&gt;SetAlpha($pb['opacity'], 'Normal', true);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $opac = '';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $s .= sprintf('q /Pattern cs /P%d scn %s %.3F %.3F %.3F %.3F re f Q', $n, $opac, $x, $y, $w, $h) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= 'Q' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ((isset($pb['gradient']) && $pb['gradient']) || (isset($pb['image_id']) && $pb['image_id'])) {&nbsp;</div></li><li><div>                  if ($pb['visibility'] != 'visible')&nbsp;</div></li><li><div>                      $s .= 'EMC' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($pb['z-index'] &gt; 0) {&nbsp;</div></li><li><div>                      $s .= &quot;\n&quot; . 'EMCGZ-index' . &quot;\n&quot;;&nbsp;</div></li><li><div>                      $this-&gt;current_layer = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function PrintTableBackgrounds($adjustmenty = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      ksort($this-&gt;tableBackgrounds);&nbsp;</div></li><li><div>      foreach ($this-&gt;tableBackgrounds AS $bl =&gt; $pbs) {&nbsp;</div></li><li><div>          foreach ($pbs AS $pb) {&nbsp;</div></li><li><div>              if ((!isset($pb['gradient']) || !$pb['gradient']) && (!isset($pb['image_id']) || !$pb['image_id'])) {&nbsp;</div></li><li><div>                  $s .= 'q ' . $this-&gt;SetFColor($pb['col'], true) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  if ($pb['col']{0} == 5) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                      $s .= $this-&gt;SetAlpha(ord($pb['col']{4}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>                  } elseif ($pb['col']{0} == 6) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                      $s .= $this-&gt;SetAlpha(ord($pb['col']{5}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $s .= sprintf('%.3F %.3F %.3F %.3F re %s Q', $pb['x'] * _MPDFK, ($this-&gt;h - $pb['y']) * _MPDFK, $pb['w'] * _MPDFK, -$pb['h'] * _MPDFK, 'f') . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($pb['gradient']) && $pb['gradient']) {&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= $pb['clippath'] . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $s .= $this-&gt;grad-&gt;Gradient($pb['x'], $pb['y'], $pb['w'], $pb['h'], $pb['gradtype'], $pb['stops'], $pb['colorspace'], $pb['coords'], $pb['extend'], true);&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= 'Q' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($pb['image_id']) && $pb['image_id']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Background pattern</span></span></span></span>&nbsp;</div></li><li><div>                  $pb['y'] -= $adjustmenty;&nbsp;</div></li><li><div>                  $pb['h'] += $adjustmenty;&nbsp;</div></li><li><div>                  $n = count($this-&gt;patterns) + 1;&nbsp;</div></li><li><div>                  list($orig_w, $orig_h, $x_repeat, $y_repeat) = $this-&gt;_resizeBackgroundImage($pb['orig_w'], $pb['orig_h'], $pb['w'], $pb['h'], $pb['resize'], $pb['x_repeat'], $pb['y_repeat']);&nbsp;</div></li><li><div>                  $this-&gt;patterns[$n] = array('x' =&gt; $pb['x'], 'y' =&gt; $pb['y'], 'w' =&gt; $pb['w'], 'h' =&gt; $pb['h'], 'pgh' =&gt; $this-&gt;h, 'image_id' =&gt; $pb['image_id'], 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $pb['x_pos'], 'y_pos' =&gt; $pb['y_pos'], 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'itype' =&gt; $pb['itype']);&nbsp;</div></li><li><div>                  $x = $pb['x'] * _MPDFK;&nbsp;</div></li><li><div>                  $y = ($this-&gt;h - $pb['y']) * _MPDFK;&nbsp;</div></li><li><div>                  $w = $pb['w'] * _MPDFK;&nbsp;</div></li><li><div>                  $h = -$pb['h'] * _MPDFK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>                  if (($this-&gt;writingHTMLfooter || $this-&gt;writingHTMLheader) && (!isset($pb['clippath']) || $pb['clippath'] == '')) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set clipping path</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $pb['clippath'] = sprintf(' q 0 w %.3F %.3F m %.3F %.3F l %.3F %.3F l %.3F %.3F l %.3F %.3F l W n ', $x, $y, $x, $y + $h, $x + $w, $y + $h, $x + $w, $y, $x, $y);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= $pb['clippath'] . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;writingHTMLfooter || $this-&gt;writingHTMLheader) { <span class="comment"><span class="comment">// Write each (tiles) image rather than use as a pattern</span></span>&nbsp;</div></li><li><div>                      $iw = $pb['orig_w'] / _MPDFK;&nbsp;</div></li><li><div>                      $ih = $pb['orig_h'] / _MPDFK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $w = $pb['w'];&nbsp;</div></li><li><div>                      $h = $pb['h'];&nbsp;</div></li><li><div>                      $x0 = $pb['x'];&nbsp;</div></li><li><div>                      $y0 = $pb['y'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (isset($pb['bpa']) && $pb['bpa']) {&nbsp;</div></li><li><div>                          $w = $pb['bpa']['w'];&nbsp;</div></li><li><div>                          $h = $pb['bpa']['h'];&nbsp;</div></li><li><div>                          $x0 = $pb['bpa']['x'];&nbsp;</div></li><li><div>                          $y0 = $pb['bpa']['y'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment">// At present 'bpa' (background page area) is not set for tablebackgrounds - only pagebackgrounds</span>&nbsp;</div></li><li><div>                      <span class="comment">// For now, just set it as:</span>&nbsp;</div></li><li><div>                      else {&nbsp;</div></li><li><div>                          $pb['bpa'] = array('x' =&gt; $x0, 'y' =&gt; $y0, 'w' =&gt; $w, 'h' =&gt; $h);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (isset($pb['size']['w']) && $pb['size']['w']) {&nbsp;</div></li><li><div>                          $size = $pb['size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($size['w'] == 'contain') {&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment">// Scale the image, while preserving its intrinsic aspect ratio (if any), to the largest size such that both its width and its height can fit inside the background positioning area.</span></span></span>&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment">// Same as resize==3</span></span></span>&nbsp;</div></li><li><div>                              $ih = $ih * $pb['bpa']['w'] / $iw;&nbsp;</div></li><li><div>                              $iw = $pb['bpa']['w'];&nbsp;</div></li><li><div>                              if ($ih &gt; $pb['bpa']['h']) {&nbsp;</div></li><li><div>                                  $iw = $iw * $pb['bpa']['h'] / $ih;&nbsp;</div></li><li><div>                                  $ih = $pb['bpa']['h'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } elseif ($size['w'] == 'cover') {&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment">// Scale the image, while preserving its intrinsic aspect ratio (if any), to the smallest size such that both its width and its height can completely cover the background positioning area.</span></span></span>&nbsp;</div></li><li><div>                              $ih = $ih * $pb['bpa']['w'] / $iw;&nbsp;</div></li><li><div>                              $iw = $pb['bpa']['w'];&nbsp;</div></li><li><div>                              if ($ih &lt; $pb['bpa']['h']) {&nbsp;</div></li><li><div>                                  $iw = $iw * $ih / $pb['bpa']['h'];&nbsp;</div></li><li><div>                                  $ih = $pb['bpa']['h'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              if (stristr($size['w'], '%')) {&nbsp;</div></li><li><div>                                  $size['w'] += 0;&nbsp;</div></li><li><div>                                  $size['w'] /= 100;&nbsp;</div></li><li><div>                                  $size['w'] = ($pb['bpa']['w'] * $size['w']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if (stristr($size['h'], '%')) {&nbsp;</div></li><li><div>                                  $size['h'] += 0;&nbsp;</div></li><li><div>                                  $size['h'] /= 100;&nbsp;</div></li><li><div>                                  $size['h'] = ($pb['bpa']['h'] * $size['h']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($size['w'] == 'auto' && $size['h'] == 'auto') {&nbsp;</div></li><li><div>                                  $iw = $iw;&nbsp;</div></li><li><div>                                  $ih = $ih;&nbsp;</div></li><li><div>                              } elseif ($size['w'] == 'auto' && $size['h'] != 'auto') {&nbsp;</div></li><li><div>                                  $iw = $iw * $size['h'] / $ih;&nbsp;</div></li><li><div>                                  $ih = $size['h'];&nbsp;</div></li><li><div>                              } elseif ($size['w'] != 'auto' && $size['h'] == 'auto') {&nbsp;</div></li><li><div>                                  $ih = $ih * $size['w'] / $iw;&nbsp;</div></li><li><div>                                  $iw = $size['w'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $iw = $size['w'];&nbsp;</div></li><li><div>                                  $ih = $size['h'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Number to repeat</span></span>&nbsp;</div></li><li><div>                      if (isset($pb['x_repeat']) && $pb['x_repeat']) {&nbsp;</div></li><li><div>                          $nx = ceil($pb['w'] / $iw) + 1;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $nx = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (isset($pb['y_repeat']) && $pb['y_repeat']) {&nbsp;</div></li><li><div>                          $ny = ceil($pb['h'] / $ih) + 1;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $ny = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $x_pos = $pb['x_pos'];&nbsp;</div></li><li><div>                      if (stristr($x_pos, '%')) {&nbsp;</div></li><li><div>                          $x_pos += 0;&nbsp;</div></li><li><div>                          $x_pos /= 100;&nbsp;</div></li><li><div>                          $x_pos = ($pb['bpa']['w'] * $x_pos) - ($iw * $x_pos);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $y_pos = $pb['y_pos'];&nbsp;</div></li><li><div>                      if (stristr($y_pos, '%')) {&nbsp;</div></li><li><div>                          $y_pos += 0;&nbsp;</div></li><li><div>                          $y_pos /= 100;&nbsp;</div></li><li><div>                          $y_pos = ($pb['bpa']['h'] * $y_pos) - ($ih * $y_pos);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($nx &gt; 1) {&nbsp;</div></li><li><div>                          while ($x_pos &gt; ($pb['x'] - $pb['bpa']['x'])) {&nbsp;</div></li><li><div>                              $x_pos -= $iw;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($ny &gt; 1) {&nbsp;</div></li><li><div>                          while ($y_pos &gt; ($pb['y'] - $pb['bpa']['y'])) {&nbsp;</div></li><li><div>                              $y_pos -= $ih;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      for ($xi = 0; $xi &lt; $nx; $xi++) {&nbsp;</div></li><li><div>                          for ($yi = 0; $yi &lt; $ny; $yi++) {&nbsp;</div></li><li><div>                              $x = $x0 + $x_pos + ($iw * $xi);&nbsp;</div></li><li><div>                              $y = $y0 + $y_pos + ($ih * $yi);&nbsp;</div></li><li><div>                              if ($pb['opacity'] &gt; 0 && $pb['opacity'] &lt; 1) {&nbsp;</div></li><li><div>                                  $opac = $this-&gt;SetAlpha($pb['opacity'], 'Normal', true);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $opac = '';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $s .= sprintf(&quot;q %s %.3F 0 0 %.3F %.3F %.3F cm /I%d Do Q&quot;, $opac, $iw * _MPDFK, $ih * _MPDFK, $x * _MPDFK, ($this-&gt;h - ($y + $ih)) * _MPDFK, $pb['image_id']) . &quot;\n&quot;;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if (($pb['opacity'] &gt; 0 || $pb['opacity'] === '0') && $pb['opacity'] &lt; 1) {&nbsp;</div></li><li><div>                          $opac = $this-&gt;SetAlpha($pb['opacity'], 'Normal', true);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $opac = '';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $s .= sprintf('q /Pattern cs /P%d scn %s %.3F %.3F %.3F %.3F re f Q', $n, $opac, $x, $y, $w, $h) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($pb['clippath']) && $pb['clippath']) {&nbsp;</div></li><li><div>                      $s .= 'Q' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function BeginLayer($id)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;current_layer &gt; 0)&nbsp;</div></li><li><div>          $this-&gt;EndLayer();&nbsp;</div></li><li><div>      if ($id &lt; 1) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($this-&gt;layers[$id])) {&nbsp;</div></li><li><div>          $this-&gt;layers[$id] = array('name' =&gt; 'Layer ' . ($id));&nbsp;</div></li><li><div>          if (($this-&gt;PDFA || $this-&gt;PDFX)) {&nbsp;</div></li><li><div>              $this-&gt;PDFAXwarnings[] = &quot;Cannot use layers when using PDFA or PDFX&quot;;&nbsp;</div></li><li><div>              return '';&nbsp;</div></li><li><div>          } elseif (!$this-&gt;PDFA && !$this-&gt;PDFX) {&nbsp;</div></li><li><div>              $this-&gt;pdf_version = '1.5';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;current_layer = $id;&nbsp;</div></li><li><div>      $this-&gt;_out('/OCZ-index /ZI' . $id . ' BDC');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function EndLayer()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;current_layer &gt; 0) {&nbsp;</div></li><li><div>          $this-&gt;_out('EMCZ-index');&nbsp;</div></li><li><div>          $this-&gt;current_layer = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddPageByArray($a)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!is_array($a)) {&nbsp;</div></li><li><div>          $a = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $orientation = (isset($a['orientation']) ? $a['orientation'] : '');&nbsp;</div></li><li><div>      $condition = (isset($a['condition']) ? $a['condition'] : (isset($a['type']) ? $a['type'] : ''));&nbsp;</div></li><li><div>      $resetpagenum = (isset($a['resetpagenum']) ? $a['resetpagenum'] : '');&nbsp;</div></li><li><div>      $pagenumstyle = (isset($a['pagenumstyle']) ? $a['pagenumstyle'] : '');&nbsp;</div></li><li><div>      $suppress = (isset($a['suppress']) ? $a['suppress'] : '');&nbsp;</div></li><li><div>      $mgl = (isset($a['mgl']) ? $a['mgl'] : (isset($a['margin-left']) ? $a['margin-left'] : ''));&nbsp;</div></li><li><div>      $mgr = (isset($a['mgr']) ? $a['mgr'] : (isset($a['margin-right']) ? $a['margin-right'] : ''));&nbsp;</div></li><li><div>      $mgt = (isset($a['mgt']) ? $a['mgt'] : (isset($a['margin-top']) ? $a['margin-top'] : ''));&nbsp;</div></li><li><div>      $mgb = (isset($a['mgb']) ? $a['mgb'] : (isset($a['margin-bottom']) ? $a['margin-bottom'] : ''));&nbsp;</div></li><li><div>      $mgh = (isset($a['mgh']) ? $a['mgh'] : (isset($a['margin-header']) ? $a['margin-header'] : ''));&nbsp;</div></li><li><div>      $mgf = (isset($a['mgf']) ? $a['mgf'] : (isset($a['margin-footer']) ? $a['margin-footer'] : ''));&nbsp;</div></li><li><div>      $ohname = (isset($a['ohname']) ? $a['ohname'] : (isset($a['odd-header-name']) ? $a['odd-header-name'] : ''));&nbsp;</div></li><li><div>      $ehname = (isset($a['ehname']) ? $a['ehname'] : (isset($a['even-header-name']) ? $a['even-header-name'] : ''));&nbsp;</div></li><li><div>      $ofname = (isset($a['ofname']) ? $a['ofname'] : (isset($a['odd-footer-name']) ? $a['odd-footer-name'] : ''));&nbsp;</div></li><li><div>      $efname = (isset($a['efname']) ? $a['efname'] : (isset($a['even-footer-name']) ? $a['even-footer-name'] : ''));&nbsp;</div></li><li><div>      $ohvalue = (isset($a['ohvalue']) ? $a['ohvalue'] : (isset($a['odd-header-value']) ? $a['odd-header-value'] : 0));&nbsp;</div></li><li><div>      $ehvalue = (isset($a['ehvalue']) ? $a['ehvalue'] : (isset($a['even-header-value']) ? $a['even-header-value'] : 0));&nbsp;</div></li><li><div>      $ofvalue = (isset($a['ofvalue']) ? $a['ofvalue'] : (isset($a['odd-footer-value']) ? $a['odd-footer-value'] : 0));&nbsp;</div></li><li><div>      $efvalue = (isset($a['efvalue']) ? $a['efvalue'] : (isset($a['even-footer-value']) ? $a['even-footer-value'] : 0));&nbsp;</div></li><li><div>      $pagesel = (isset($a['pagesel']) ? $a['pagesel'] : (isset($a['pageselector']) ? $a['pageselector'] : ''));&nbsp;</div></li><li><div>      $newformat = (isset($a['newformat']) ? $a['newformat'] : (isset($a['sheet-size']) ? $a['sheet-size'] : ''));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;AddPage($orientation, $condition, $resetpagenum, $pagenumstyle, $suppress, $mgl, $mgr, $mgt, $mgb, $mgh, $mgf, $ohname, $ehname, $ofname, $efname, $ohvalue, $ehvalue, $ofvalue, $efvalue, $pagesel, $newformat);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>  function _preForcedPagebreak($pagebreaktype)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($pagebreaktype == 'cloneall') {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Close any open block tags</span></span></span></span>&nbsp;</div></li><li><div>          $arr = array();&nbsp;</div></li><li><div>          $ai = 0;&nbsp;</div></li><li><div>          for ($b = $this-&gt;blklvl; $b &gt; 0; $b--) {&nbsp;</div></li><li><div>              $this-&gt;tag-&gt;CloseTag($this-&gt;blk[$b]['tag'], $arr, $ai);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;blklvl == 0 && !empty($this-&gt;textbuffer)) { <span class="comment"><span class="comment"><span class="comment">//Output previously buffered content</span></span></span>&nbsp;</div></li><li><div>              $this-&gt;printbuffer($this-&gt;textbuffer, 1);&nbsp;</div></li><li><div>              $this-&gt;textbuffer = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($pagebreaktype == 'clonebycss') {&nbsp;</div></li><li><div>          <span class="comment">// Close open block tags whilst box-decoration-break==clone</span>&nbsp;</div></li><li><div>          $arr = array();&nbsp;</div></li><li><div>          $ai = 0;&nbsp;</div></li><li><div>          for ($b = $this-&gt;blklvl; $b &gt; 0; $b--) {&nbsp;</div></li><li><div>              if (isset($this-&gt;blk[$b]['box_decoration_break']) && $this-&gt;blk[$b]['box_decoration_break'] == 'clone') {&nbsp;</div></li><li><div>                  $this-&gt;tag-&gt;CloseTag($this-&gt;blk[$b]['tag'], $arr, $ai);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ($b == $this-&gt;blklvl && !empty($this-&gt;textbuffer)) { <span class="comment"><span class="comment"><span class="comment">//Output previously buffered content</span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;printbuffer($this-&gt;textbuffer, 1);&nbsp;</div></li><li><div>                      $this-&gt;textbuffer = array();&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (!empty($this-&gt;textbuffer)) { <span class="comment"><span class="comment"><span class="comment">//Output previously buffered content</span></span></span>&nbsp;</div></li><li><div>          $this-&gt;printbuffer($this-&gt;textbuffer, 1);&nbsp;</div></li><li><div>          $this-&gt;textbuffer = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>  function _postForcedPagebreak($pagebreaktype, $startpage, $save_blk, $save_blklvl)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($pagebreaktype == 'cloneall') {&nbsp;</div></li><li><div>          $this-&gt;blk = array();&nbsp;</div></li><li><div>          $this-&gt;blk[0] = $save_blk[0];&nbsp;</div></li><li><div>          <span class="comment">// Re-open block tags</span>&nbsp;</div></li><li><div>          $this-&gt;blklvl = 0;&nbsp;</div></li><li><div>          $arr = array();&nbsp;</div></li><li><div>          $i = 0;&nbsp;</div></li><li><div>          for ($b = 1; $b &lt;= $save_blklvl; $b++) {&nbsp;</div></li><li><div>              $this-&gt;tag-&gt;OpenTag($save_blk[$b]['tag'], $save_blk[$b]['attr'], $arr, $i);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($pagebreaktype == 'clonebycss') {&nbsp;</div></li><li><div>          $this-&gt;blk = array();&nbsp;</div></li><li><div>          $this-&gt;blk[0] = $save_blk[0];&nbsp;</div></li><li><div>          <span class="comment">// Don't re-open tags for lowest level elements - so need to do some adjustments</span>&nbsp;</div></li><li><div>          for ($b = 1; $b &lt;= $this-&gt;blklvl; $b++) {&nbsp;</div></li><li><div>              $this-&gt;blk[$b] = $save_blk[$b];&nbsp;</div></li><li><div>              $this-&gt;blk[$b]['startpage'] = 0;&nbsp;</div></li><li><div>              $this-&gt;blk[$b]['y0'] = $this-&gt;y; <span class="comment">// ?? $this-&gt;tMargin</span>&nbsp;</div></li><li><div>              if (($this-&gt;page - $startpage) % 2) {&nbsp;</div></li><li><div>                  if (isset($this-&gt;blk[$b]['x0'])) {&nbsp;</div></li><li><div>                      $this-&gt;blk[$b]['x0'] += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;blk[$b]['x0'] = $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">//for Float DIV</span>&nbsp;</div></li><li><div>              $this-&gt;blk[$b]['marginCorrected'][$this-&gt;page] = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Re-open block tags</span> for any that have box_decoration_break==clone&nbsp;</div></li><li><div>          $arr = array();&nbsp;</div></li><li><div>          $i = 0;&nbsp;</div></li><li><div>          for ($b = $this-&gt;blklvl + 1; $b &lt;= $save_blklvl; $b++) {&nbsp;</div></li><li><div>              if ($b &lt; $this-&gt;blklvl) {&nbsp;</div></li><li><div>                  $this-&gt;lastblocklevelchange = -1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;tag-&gt;OpenTag($save_blk[$b]['tag'], $save_blk[$b]['attr'], $arr, $i);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;blk[$this-&gt;blklvl]['box_decoration_break'] != 'clone') {&nbsp;</div></li><li><div>              $this-&gt;lastblocklevelchange = -1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;lastblocklevelchange = -1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddPage($orientation = '', $condition = '', $resetpagenum = '', $pagenumstyle = '', $suppress = '', $mgl = '', $mgr = '', $mgt = '', $mgb = '', $mgh = '', $mgf = '', $ohname = '', $ehname = '', $ofname = '', $efname = '', $ohvalue = 0, $ehvalue = 0, $ofvalue = 0, $efvalue = 0, $pagesel = '', $newformat = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Float DIV</span></span>&nbsp;</div></li><li><div>      <span class="comment">// Cannot do with columns on, or if any change in page orientation/margins etc.</span>&nbsp;</div></li><li><div>      <span class="comment">// If next page already exists - i.e background /headers and footers already written</span>&nbsp;</div></li><li><div>      if ($this-&gt;state &gt; 0 && $this-&gt;page &lt; count($this-&gt;pages)) {&nbsp;</div></li><li><div>          $bak_cml = $this-&gt;cMarginL;&nbsp;</div></li><li><div>          $bak_cmr = $this-&gt;cMarginR;&nbsp;</div></li><li><div>          $bak_dw = $this-&gt;divwidth;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Paint Div Border if necessary</span></span>&nbsp;</div></li><li><div>          if ($this-&gt;blklvl &gt; 0) {&nbsp;</div></li><li><div>              $save_tr = $this-&gt;table_rotate; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;table_rotate = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (($this-&gt;y &gt; $this-&gt;blk[$this-&gt;blklvl]['y0']) || $this-&gt;flowingBlockAttr['is_table']) {&nbsp;</div></li><li><div>                  $toplvl = $this-&gt;blklvl;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $toplvl = $this-&gt;blklvl - 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $sy = $this-&gt;y;&nbsp;</div></li><li><div>              for ($bl = 1; $bl &lt;= $toplvl; $bl++) {&nbsp;</div></li><li><div>                  $this-&gt;PaintDivBB('pagebottom', 0, $bl);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;y = $sy;&nbsp;</div></li><li><div>              $this-&gt;table_rotate = $save_tr; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $s = $this-&gt;PrintPageBackgrounds();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Writes after the marker so not overwritten later by page background etc.</span></span></span>&nbsp;</div></li><li><div>          $this-&gt;pages[$this-&gt;page] = preg_replace('/(___BACKGROUND___PATTERNS' . $this-&gt;uniqstr . ')/', '\\1' . &quot;\n&quot; . $s . &quot;\n&quot;, $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>          $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>          $family = $this-&gt;FontFamily;&nbsp;</div></li><li><div>          $style = $this-&gt;FontStyle;&nbsp;</div></li><li><div>          $size = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>          $lw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>          $dc = $this-&gt;DrawColor;&nbsp;</div></li><li><div>          $fc = $this-&gt;FillColor;&nbsp;</div></li><li><div>          $tc = $this-&gt;TextColor;&nbsp;</div></li><li><div>          $cf = $this-&gt;ColorFlag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;printfloatbuffer();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">//Move to next page</span>&nbsp;</div></li><li><div>          $this-&gt;page++;&nbsp;</div></li><li><div>          $this-&gt;ResetMargins();&nbsp;</div></li><li><div>          $this-&gt;SetAutoPageBreak($this-&gt;autoPageBreak, $this-&gt;bMargin);&nbsp;</div></li><li><div>          $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>          $this-&gt;y = $this-&gt;tMargin;&nbsp;</div></li><li><div>          $this-&gt;FontFamily = '';&nbsp;</div></li><li><div>          $this-&gt;_out('2 J');&nbsp;</div></li><li><div>          $this-&gt;LineWidth = $lw;&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('%.3F w', $lw * _MPDFK));&nbsp;</div></li><li><div>          if ($family)&nbsp;</div></li><li><div>              $this-&gt;SetFont($family, $style, $size, true, true);&nbsp;</div></li><li><div>          $this-&gt;DrawColor = $dc;&nbsp;</div></li><li><div>          if ($dc != $this-&gt;defDrawColor)&nbsp;</div></li><li><div>              $this-&gt;_out($dc);&nbsp;</div></li><li><div>          $this-&gt;FillColor = $fc;&nbsp;</div></li><li><div>          if ($fc != $this-&gt;defFillColor)&nbsp;</div></li><li><div>              $this-&gt;_out($fc);&nbsp;</div></li><li><div>          $this-&gt;TextColor = $tc;&nbsp;</div></li><li><div>          $this-&gt;ColorFlag = $cf;&nbsp;</div></li><li><div>          for ($bl = 1; $bl &lt;= $this-&gt;blklvl; $bl++) {&nbsp;</div></li><li><div>              $this-&gt;blk[$bl]['y0'] = $this-&gt;y;&nbsp;</div></li><li><div>              <span class="comment">// Don't correct more than once for background DIV containing a Float</span>&nbsp;</div></li><li><div>              if (!isset($this-&gt;blk[$bl]['marginCorrected'][$this-&gt;page])) {&nbsp;</div></li><li><div>                  $this-&gt;blk[$bl]['x0'] += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;blk[$bl]['marginCorrected'][$this-&gt;page] = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;cMarginL = $bak_cml;&nbsp;</div></li><li><div>          $this-&gt;cMarginR = $bak_cmr;&nbsp;</div></li><li><div>          $this-&gt;divwidth = $bak_dw;&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Start a new page</span></span>&nbsp;</div></li><li><div>      if ($this-&gt;state == 0)&nbsp;</div></li><li><div>          $this-&gt;Open();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bak_cml = $this-&gt;cMarginL;&nbsp;</div></li><li><div>      $bak_cmr = $this-&gt;cMarginR;&nbsp;</div></li><li><div>      $bak_dw = $this-&gt;divwidth;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bak_lh = $this-&gt;lineheight;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $orientation = substr(strtoupper($orientation), 0, 1);&nbsp;</div></li><li><div>      $condition = strtoupper($condition);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($condition == 'E') { <span class="comment">// only adds new page if needed to create an Even page</span>&nbsp;</div></li><li><div>          if (!$this-&gt;mirrorMargins || ($this-&gt;page) % 2 == 0) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($condition == 'O') { <span class="comment">// only adds new page if needed to create an Odd page</span>&nbsp;</div></li><li><div>          if (!$this-&gt;mirrorMargins || ($this-&gt;page) % 2 == 1) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($condition == 'NEXT-EVEN') { <span class="comment">// always adds at least one new page to create an Even page</span>&nbsp;</div></li><li><div>          if (!$this-&gt;mirrorMargins) {&nbsp;</div></li><li><div>              $condition = '';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ($pagesel) {&nbsp;</div></li><li><div>                  $pbch = $pagesel;&nbsp;</div></li><li><div>                  $pagesel = '';&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *CSS-PAGE*</span></span></span></span></span></span>&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $pbch = false;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *CSS-PAGE*</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;AddPage($this-&gt;CurOrientation, 'O');&nbsp;</div></li><li><div>              $this-&gt;extrapagebreak = true; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>              if ($pbch) {&nbsp;</div></li><li><div>                  $pagesel = $pbch;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *CSS-PAGE*</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $condition = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($condition == 'NEXT-ODD') { <span class="comment">// always adds at least one new page to create an Odd page</span>&nbsp;</div></li><li><div>          if (!$this-&gt;mirrorMargins) {&nbsp;</div></li><li><div>              $condition = '';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ($pagesel) {&nbsp;</div></li><li><div>                  $pbch = $pagesel;&nbsp;</div></li><li><div>                  $pagesel = '';&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *CSS-PAGE*</span></span></span></span></span></span>&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $pbch = false;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *CSS-PAGE*</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;AddPage($this-&gt;CurOrientation, 'E');&nbsp;</div></li><li><div>              $this-&gt;extrapagebreak = true; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>              if ($pbch) {&nbsp;</div></li><li><div>                  $pagesel = $pbch;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *CSS-PAGE*</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $condition = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($resetpagenum || $pagenumstyle || $suppress) {&nbsp;</div></li><li><div>          $this-&gt;PageNumSubstitutions[] = array('from' =&gt; ($this-&gt;page + 1), 'reset' =&gt; $resetpagenum, 'type' =&gt; $pagenumstyle, 'suppress' =&gt; $suppress);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $save_tr = $this-&gt;table_rotate; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;table_rotate = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $save_kwt = $this-&gt;kwt;&nbsp;</div></li><li><div>      $this-&gt;kwt = 0;&nbsp;</div></li><li><div>      $save_layer = $this-&gt;current_layer;&nbsp;</div></li><li><div>      $save_vis = $this-&gt;visibility;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;visibility != 'visible')&nbsp;</div></li><li><div>          $this-&gt;SetVisibility('visible');&nbsp;</div></li><li><div>      $this-&gt;EndLayer();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Paint Div Border if necessary</span></span>&nbsp;</div></li><li><div>      <span class="comment">//PAINTS BACKGROUND COLOUR OR BORDERS for DIV - DISABLED FOR COLUMNS (cf. AcceptPageBreak) AT PRESENT in -&gt;PaintDivBB</span>&nbsp;</div></li><li><div>      if (!$this-&gt;ColActive && $this-&gt;blklvl &gt; 0) {&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['y0']) && $this-&gt;y == $this-&gt;blk[$this-&gt;blklvl]['y0'] && !$this-&gt;extrapagebreak && !$this-&gt;blk[$this-&gt;blklvl]['float']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>              if (isset($this-&gt;blk[$this-&gt;blklvl]['startpage'])) {&nbsp;</div></li><li><div>                  $this-&gt;blk[$this-&gt;blklvl]['startpage'] ++;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;blk[$this-&gt;blklvl]['startpage'] = 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ((isset($this-&gt;blk[$this-&gt;blklvl]['y0']) && $this-&gt;y &gt; $this-&gt;blk[$this-&gt;blklvl]['y0']) || $this-&gt;flowingBlockAttr['is_table'] || $this-&gt;extrapagebreak) {&nbsp;</div></li><li><div>              $toplvl = $this-&gt;blklvl;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $toplvl = $this-&gt;blklvl - 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $sy = $this-&gt;y;&nbsp;</div></li><li><div>          for ($bl = 1; $bl &lt;= $toplvl; $bl++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (isset($this-&gt;blk[$bl]['z-index']) && $this-&gt;blk[$bl]['z-index'] &gt; 0) {&nbsp;</div></li><li><div>                  $this-&gt;BeginLayer($this-&gt;blk[$bl]['z-index']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($this-&gt;blk[$bl]['visibility']) && $this-&gt;blk[$bl]['visibility'] && $this-&gt;blk[$bl]['visibility'] != 'visible') {&nbsp;</div></li><li><div>                  $this-&gt;SetVisibility($this-&gt;blk[$bl]['visibility']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;PaintDivBB('pagebottom', 0, $bl);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;y = $sy;&nbsp;</div></li><li><div>          <span class="comment">// RESET block y0 and x0 - see below</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;extrapagebreak = false; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;visibility != 'visible')&nbsp;</div></li><li><div>          $this-&gt;SetVisibility('visible');&nbsp;</div></li><li><div>      $this-&gt;EndLayer();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// BODY Backgrounds</span></span>&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0) {&nbsp;</div></li><li><div>          $s = '';&nbsp;</div></li><li><div>          $s .= $this-&gt;PrintBodyBackgrounds();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $s .= $this-&gt;PrintPageBackgrounds();&nbsp;</div></li><li><div>          $this-&gt;pages[$this-&gt;page] = preg_replace('/(___BACKGROUND___PATTERNS' . $this-&gt;uniqstr . ')/', &quot;\n&quot; . $s . &quot;\n&quot; . '\\1', $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>          $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $save_kt = $this-&gt;keep_block_together;&nbsp;</div></li><li><div>      $this-&gt;keep_block_together = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $save_cols = false;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          $save_cols = true;&nbsp;</div></li><li><div>          $save_nbcol = $this-&gt;NbCol; <span class="comment"><span class="comment">// other values of gap and vAlign will not change by setting Columns off</span></span>&nbsp;</div></li><li><div>          $this-&gt;SetColumns(0);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $family = $this-&gt;FontFamily;&nbsp;</div></li><li><div>      $style = $this-&gt;FontStyle;&nbsp;</div></li><li><div>      $size = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>      $this-&gt;ColumnAdjust = true; <span class="comment"><span class="comment">// enables column height adjustment for the page</span></span>&nbsp;</div></li><li><div>      $lw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>      $dc = $this-&gt;DrawColor;&nbsp;</div></li><li><div>      $fc = $this-&gt;FillColor;&nbsp;</div></li><li><div>      $tc = $this-&gt;TextColor;&nbsp;</div></li><li><div>      $cf = $this-&gt;ColorFlag;&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//Page</span> footer</span></span>&nbsp;</div></li><li><div>          $this-&gt;InFooter = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;Reset();&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;Footer();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Close page</span></span>&nbsp;</div></li><li><div>          $this-&gt;_endpage();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Start new page</span>&nbsp;</div></li><li><div>      $this-&gt;_beginpage($orientation, $mgl, $mgr, $mgt, $mgb, $mgh, $mgf, $ohname, $ehname, $ofname, $efname, $ohvalue, $ehvalue, $ofvalue, $efvalue, $pagesel, $newformat);&nbsp;</div></li><li><div>      if ($this-&gt;docTemplate) {&nbsp;</div></li><li><div>          $pagecount = $this-&gt;SetSourceFile($this-&gt;docTemplate);&nbsp;</div></li><li><div>          if (($this-&gt;page - $this-&gt;docTemplateStart) &gt; $pagecount) {&nbsp;</div></li><li><div>              if ($this-&gt;docTemplateContinue) {&nbsp;</div></li><li><div>                  $tplIdx = $this-&gt;ImportPage($pagecount);&nbsp;</div></li><li><div>                  $this-&gt;UseTemplate($tplIdx);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $tplIdx = $this-&gt;ImportPage(($this-&gt;page - $this-&gt;docTemplateStart));&nbsp;</div></li><li><div>              $this-&gt;UseTemplate($tplIdx);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;pageTemplate) {&nbsp;</div></li><li><div>          $this-&gt;UseTemplate($this-&gt;pageTemplate);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Tiling Patterns</span></span>&nbsp;</div></li><li><div>      $this-&gt;_out('___PAGE___START' . $this-&gt;uniqstr);&nbsp;</div></li><li><div>      $this-&gt;_out('___BACKGROUND___PATTERNS' . $this-&gt;uniqstr);&nbsp;</div></li><li><div>      $this-&gt;_out('___HEADER___MARKER' . $this-&gt;uniqstr);&nbsp;</div></li><li><div>      $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Set line cap style to square</span>&nbsp;</div></li><li><div>      $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Set line width</span></span>&nbsp;</div></li><li><div>      $this-&gt;LineWidth = $lw;&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F w', $lw * _MPDFK));&nbsp;</div></li><li><div>      <span class="comment">//Set font</span>&nbsp;</div></li><li><div>      if ($family)&nbsp;</div></li><li><div>          $this-&gt;SetFont($family, $style, $size, true, true); <span class="comment"><span class="comment">// forces write</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Set colors</span>&nbsp;</div></li><li><div>      $this-&gt;DrawColor = $dc;&nbsp;</div></li><li><div>      if ($dc != $this-&gt;defDrawColor)&nbsp;</div></li><li><div>          $this-&gt;_out($dc);&nbsp;</div></li><li><div>      $this-&gt;FillColor = $fc;&nbsp;</div></li><li><div>      if ($fc != $this-&gt;defFillColor)&nbsp;</div></li><li><div>          $this-&gt;_out($fc);&nbsp;</div></li><li><div>      $this-&gt;TextColor = $tc;&nbsp;</div></li><li><div>      $this-&gt;ColorFlag = $cf;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Page</span> header</span>&nbsp;</div></li><li><div>      $this-&gt;Header();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Restore line width</span>&nbsp;</div></li><li><div>      if ($this-&gt;LineWidth != $lw) {&nbsp;</div></li><li><div>          $this-&gt;LineWidth = $lw;&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('%.3F w', $lw * _MPDFK));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Restore font</span></span>&nbsp;</div></li><li><div>      if ($family)&nbsp;</div></li><li><div>          $this-&gt;SetFont($family, $style, $size, true, true); <span class="comment"><span class="comment">// forces write</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Restore colors</span>&nbsp;</div></li><li><div>      if ($this-&gt;DrawColor != $dc) {&nbsp;</div></li><li><div>          $this-&gt;DrawColor = $dc;&nbsp;</div></li><li><div>          $this-&gt;_out($dc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;FillColor != $fc) {&nbsp;</div></li><li><div>          $this-&gt;FillColor = $fc;&nbsp;</div></li><li><div>          $this-&gt;_out($fc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;TextColor = $tc;&nbsp;</div></li><li><div>      $this-&gt;ColorFlag = $cf;&nbsp;</div></li><li><div>      $this-&gt;InFooter = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($save_layer &gt; 0)&nbsp;</div></li><li><div>          $this-&gt;BeginLayer($save_layer);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($save_vis != 'visible')&nbsp;</div></li><li><div>          $this-&gt;SetVisibility($save_vis);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($save_cols) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Restore</span> columns</span>&nbsp;</div></li><li><div>          $this-&gt;SetColumns($save_nbcol, $this-&gt;colvAlign, $this-&gt;ColGap);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          $this-&gt;SetCol(0);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//RESET BLOCK BORDER TOP</span>&nbsp;</div></li><li><div>      if (!$this-&gt;ColActive) {&nbsp;</div></li><li><div>          for ($bl = 1; $bl &lt;= $this-&gt;blklvl; $bl++) {&nbsp;</div></li><li><div>              $this-&gt;blk[$bl]['y0'] = $this-&gt;y;&nbsp;</div></li><li><div>              if (isset($this-&gt;blk[$bl]['x0'])) {&nbsp;</div></li><li><div>                  $this-&gt;blk[$bl]['x0'] += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;blk[$bl]['x0'] = $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added mPDF 3.0</span> Float DIV</span></span></span>&nbsp;</div></li><li><div>              $this-&gt;blk[$bl]['marginCorrected'][$this-&gt;page] = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;table_rotate = $save_tr; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;kwt = $save_kwt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;keep_block_together = $save_kt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;cMarginL = $bak_cml;&nbsp;</div></li><li><div>      $this-&gt;cMarginR = $bak_cmr;&nbsp;</div></li><li><div>      $this-&gt;divwidth = $bak_dw;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;lineheight = $bak_lh;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function PageNo()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Get current page number</span>&nbsp;</div></li><li><div>      return $this-&gt;page;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddSpotColorsFromFile($file)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $colors = @file($file);&nbsp;</div></li><li><div>      if (!$colors) {&nbsp;</div></li><li><div>          throw new MpdfException(&quot;Cannot load spot colors file - &quot; . $file);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ($colors AS $sc) {&nbsp;</div></li><li><div>          list($name, $c, $m, $y, $k) = preg_split(&quot;/\t/&quot;, $sc);&nbsp;</div></li><li><div>          $c = intval($c);&nbsp;</div></li><li><div>          $m = intval($m);&nbsp;</div></li><li><div>          $y = intval($y);&nbsp;</div></li><li><div>          $k = intval($k);&nbsp;</div></li><li><div>          $this-&gt;AddSpotColor($name, $c, $m, $y, $k);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddSpotColor($name, $c, $m, $y, $k)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $name = strtoupper(trim($name));&nbsp;</div></li><li><div>      if (!isset($this-&gt;spotColors[$name])) {&nbsp;</div></li><li><div>          $i = count($this-&gt;spotColors) + 1;&nbsp;</div></li><li><div>          $this-&gt;spotColors[$name] = array('i' =&gt; $i, 'c' =&gt; $c, 'm' =&gt; $m, 'y' =&gt; $y, 'k' =&gt; $k);&nbsp;</div></li><li><div>          $this-&gt;spotColorIDs[$i] = $name;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetColor($col, $type = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $out = '';&nbsp;</div></li><li><div>      if (!$col) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($col{0} == 3 || $col{0} == 5) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span> / RGBa</span>&nbsp;</div></li><li><div>          $out = sprintf('%.3F %.3F %.3F rg', ord($col{1}) / 255, ord($col{2}) / 255, ord($col{3}) / 255);&nbsp;</div></li><li><div>      } elseif ($col{0} == 1) { <span class="comment"><span class="comment">// GRAYSCALE</span></span>&nbsp;</div></li><li><div>          $out = sprintf('%.3F g', ord($col{1}) / 255);&nbsp;</div></li><li><div>      } elseif ($col{0} == 2) { <span class="comment"><span class="comment"><span class="comment">// SPOT COLOR</span></span></span>&nbsp;</div></li><li><div>          $out = sprintf('/CS%d cs %.3F scn', ord($col{1}), ord($col{2}) / 100);&nbsp;</div></li><li><div>      } elseif ($col{0} == 4 || $col{0} == 6) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span> / CMYKa</span>&nbsp;</div></li><li><div>          $out = sprintf('%.3F %.3F %.3F %.3F k', ord($col{1}) / 100, ord($col{2}) / 100, ord($col{3}) / 100, ord($col{4}) / 100);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($type == 'Draw') {&nbsp;</div></li><li><div>          $out = strtoupper($out);&nbsp;</div></li><li><div>      } <span class="comment">// e.g. rg =&gt; RG</span>&nbsp;</div></li><li><div>      elseif ($type == 'CodeOnly') {&nbsp;</div></li><li><div>          $out = preg_replace('/\s(rg|g|k)/', '', $out);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $out;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDColor($col, $return = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $out = $this-&gt;SetColor($col, 'Draw');&nbsp;</div></li><li><div>      if ($return) {&nbsp;</div></li><li><div>          return $out;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($out == '') {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;DrawColor = $out;&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['DrawColor']) && $this-&gt;pageoutput[$this-&gt;page]['DrawColor'] != $this-&gt;DrawColor) || !isset($this-&gt;pageoutput[$this-&gt;page]['DrawColor']))) {&nbsp;</div></li><li><div>          $this-&gt;_out($this-&gt;DrawColor);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page]['DrawColor'] = $this-&gt;DrawColor;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetFColor($col, $return = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $out = $this-&gt;SetColor($col, 'Fill');&nbsp;</div></li><li><div>      if ($return) {&nbsp;</div></li><li><div>          return $out;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($out == '') {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;FillColor = $out;&nbsp;</div></li><li><div>      $this-&gt;ColorFlag = ($out != $this-&gt;TextColor);&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['FillColor']) && $this-&gt;pageoutput[$this-&gt;page]['FillColor'] != $this-&gt;FillColor) || !isset($this-&gt;pageoutput[$this-&gt;page]['FillColor']))) {&nbsp;</div></li><li><div>          $this-&gt;_out($this-&gt;FillColor);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page]['FillColor'] = $this-&gt;FillColor;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetTColor($col, $return = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $out = $this-&gt;SetColor($col, 'Text');&nbsp;</div></li><li><div>      if ($return) {&nbsp;</div></li><li><div>          return $out;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($out == '') {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;TextColor = $out;&nbsp;</div></li><li><div>      $this-&gt;ColorFlag = ($this-&gt;FillColor != $out);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDrawColor($r, $g = -1, $b = -1, $col4 = -1, $return = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set color for all stroking operations</span>&nbsp;</div></li><li><div>      $col = array();&nbsp;</div></li><li><div>      if (($r == 0 and $g == 0 and $b == 0 && $col4 == -1) or $g == -1) {&nbsp;</div></li><li><div>          $col = $this-&gt;ConvertColor($r);&nbsp;</div></li><li><div>      } elseif ($col4 == -1) {&nbsp;</div></li><li><div>          $col = $this-&gt;ConvertColor('rgb(' . $r . ', ' . $g . ', ' . $b . ')');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $col = $this-&gt;ConvertColor('cmyk(' . $r . ', ' . $g . ', ' . $b . ', ' . $col4 . ')');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $out = $this-&gt;SetDColor($col, $return);&nbsp;</div></li><li><div>      return $out;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetFillColor($r, $g = -1, $b = -1, $col4 = -1, $return = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set color for all filling operations</span>&nbsp;</div></li><li><div>      $col = array();&nbsp;</div></li><li><div>      if (($r == 0 and $g == 0 and $b == 0 && $col4 == -1) or $g == -1) {&nbsp;</div></li><li><div>          $col = $this-&gt;ConvertColor($r);&nbsp;</div></li><li><div>      } elseif ($col4 == -1) {&nbsp;</div></li><li><div>          $col = $this-&gt;ConvertColor('rgb(' . $r . ', ' . $g . ', ' . $b . ')');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $col = $this-&gt;ConvertColor('cmyk(' . $r . ', ' . $g . ', ' . $b . ', ' . $col4 . ')');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $out = $this-&gt;SetFColor($col, $return);&nbsp;</div></li><li><div>      return $out;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetTextColor($r, $g = -1, $b = -1, $col4 = -1, $return = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set color for text</span>&nbsp;</div></li><li><div>      $col = array();&nbsp;</div></li><li><div>      if (($r == 0 and $g == 0 and $b == 0 && $col4 == -1) or $g == -1) {&nbsp;</div></li><li><div>          $col = $this-&gt;ConvertColor($r);&nbsp;</div></li><li><div>      } elseif ($col4 == -1) {&nbsp;</div></li><li><div>          $col = $this-&gt;ConvertColor('rgb(' . $r . ', ' . $g . ', ' . $b . ')');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $col = $this-&gt;ConvertColor('cmyk(' . $r . ', ' . $g . ', ' . $b . ', ' . $col4 . ')');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $out = $this-&gt;SetTColor($col, $return);&nbsp;</div></li><li><div>      return $out;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _getCharWidth(&$cw, $u, $isdef = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $w = 0;&nbsp;</div></li><li><div>      if ($u == 0) {&nbsp;</div></li><li><div>          $w = false;&nbsp;</div></li><li><div>      } elseif (isset($cw[$u * 2 + 1])) {&nbsp;</div></li><li><div>          $w = (ord($cw[$u * 2]) &lt;&lt; 8) + ord($cw[$u * 2 + 1]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($w == 65535) {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      } elseif ($w) {&nbsp;</div></li><li><div>          return $w;&nbsp;</div></li><li><div>      } elseif ($isdef) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _charDefined(&$cw, $u)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $w = 0;&nbsp;</div></li><li><div>      if ($u == 0) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($cw[$u * 2 + 1])) {&nbsp;</div></li><li><div>          $w = (ord($cw[$u * 2]) &lt;&lt; 8) + ord($cw[$u * 2 + 1]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($w) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function GetCharWidthCore($c)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Get width of a single character in the current Core font</span>&nbsp;</div></li><li><div>      $c = (string) $c;&nbsp;</div></li><li><div>      $w = 0;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Soft Hyphens</span></span> chr(173)</span>&nbsp;</div></li><li><div>      if ($c == chr(173) && $this-&gt;FontFamily != 'csymbol' && $this-&gt;FontFamily != 'czapfdingbats') {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      } elseif (($this-&gt;textvar & FC_SMALLCAPS) && isset($this-&gt;upperCase[ord($c)])) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $charw = $this-&gt;CurrentFont['cw'][chr($this-&gt;upperCase[ord($c)])];&nbsp;</div></li><li><div>          if ($charw !== false) {&nbsp;</div></li><li><div>              $charw = $charw * $this-&gt;smCapsScale * $this-&gt;smCapsStretch / 100;&nbsp;</div></li><li><div>              $w+=$charw;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (isset($this-&gt;CurrentFont['cw'][$c])) {&nbsp;</div></li><li><div>          $w += $this-&gt;CurrentFont['cw'][$c];&nbsp;</div></li><li><div>      } elseif (isset($this-&gt;CurrentFont['cw'][ord($c)])) {&nbsp;</div></li><li><div>          $w += $this-&gt;CurrentFont['cw'][ord($c)];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $w *= ($this-&gt;FontSize / 1000);&nbsp;</div></li><li><div>      if ($this-&gt;minwSpacing || $this-&gt;fixedlSpacing) {&nbsp;</div></li><li><div>          if ($c == ' ')&nbsp;</div></li><li><div>              $nb_spaces = 1;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $nb_spaces = 0;&nbsp;</div></li><li><div>          $w += $this-&gt;fixedlSpacing + ($nb_spaces * $this-&gt;minwSpacing);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return ($w);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function GetCharWidthNonCore($c, $addSubset = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Get width of a single character in the current Non-Core font</span>&nbsp;</div></li><li><div>      $c = (string) $c;&nbsp;</div></li><li><div>      $w = 0;&nbsp;</div></li><li><div>      $unicode = $this-&gt;UTF8StringToArray($c, $addSubset);&nbsp;</div></li><li><div>      $char = $unicode[0];&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;CurrentFont['type'] == 'Type0') { <span class="comment"><span class="comment">// CJK Adobe fonts</span></span>&nbsp;</div></li><li><div>          if ($char == 173) {&nbsp;</div></li><li><div>              return 0;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment">// Soft Hyphens</span></span>&nbsp;</div></li><li><div>          elseif (isset($this-&gt;CurrentFont['cw'][$char])) {&nbsp;</div></li><li><div>              $w+=$this-&gt;CurrentFont['cw'][$char];&nbsp;</div></li><li><div>          } elseif (isset($this-&gt;CurrentFont['MissingWidth'])) {&nbsp;</div></li><li><div>              $w += $this-&gt;CurrentFont['MissingWidth'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $w += 500;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($char == 173) {&nbsp;</div></li><li><div>              return 0;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment">// Soft Hyphens</span></span>&nbsp;</div></li><li><div>          elseif (($this-&gt;textvar & FC_SMALLCAPS) && isset($this-&gt;upperCase[$char])) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $charw = $this-&gt;_getCharWidth($this-&gt;CurrentFont['cw'], $this-&gt;upperCase[$char]);&nbsp;</div></li><li><div>              if ($charw !== false) {&nbsp;</div></li><li><div>                  $charw = $charw * $this-&gt;smCapsScale * $this-&gt;smCapsStretch / 100;&nbsp;</div></li><li><div>                  $w+=$charw;&nbsp;</div></li><li><div>              } elseif (isset($this-&gt;CurrentFont['desc']['MissingWidth'])) {&nbsp;</div></li><li><div>                  $w += $this-&gt;CurrentFont['desc']['MissingWidth'];&nbsp;</div></li><li><div>              } elseif (isset($this-&gt;CurrentFont['MissingWidth'])) {&nbsp;</div></li><li><div>                  $w += $this-&gt;CurrentFont['MissingWidth'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $w += 500;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $charw = $this-&gt;_getCharWidth($this-&gt;CurrentFont['cw'], $char);&nbsp;</div></li><li><div>              if ($charw !== false) {&nbsp;</div></li><li><div>                  $w+=$charw;&nbsp;</div></li><li><div>              } elseif (isset($this-&gt;CurrentFont['desc']['MissingWidth'])) {&nbsp;</div></li><li><div>                  $w += $this-&gt;CurrentFont['desc']['MissingWidth'];&nbsp;</div></li><li><div>              } elseif (isset($this-&gt;CurrentFont['MissingWidth'])) {&nbsp;</div></li><li><div>                  $w += $this-&gt;CurrentFont['MissingWidth'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $w += 500;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment">// *CJK-FONTS*</span></span></span>&nbsp;</div></li><li><div>      $w *= ($this-&gt;FontSize / 1000);&nbsp;</div></li><li><div>      if ($this-&gt;minwSpacing || $this-&gt;fixedlSpacing) {&nbsp;</div></li><li><div>          if ($c == ' ')&nbsp;</div></li><li><div>              $nb_spaces = 1;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $nb_spaces = 0;&nbsp;</div></li><li><div>          $w += $this-&gt;fixedlSpacing + ($nb_spaces * $this-&gt;minwSpacing);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return ($w);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function GetCharWidth($c, $addSubset = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          return $this-&gt;GetCharWidthNonCore($c, $addSubset);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return $this-&gt;GetCharWidthCore($c);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function GetStringWidth($s, $addSubset = true, $OTLdata = false, $textvar = 0, $includeKashida = false)&nbsp;</div></li><li><div>  { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">//Get width of a string in the current font</span>&nbsp;</div></li><li><div>      $s = (string) $s;&nbsp;</div></li><li><div>      $cw = &$this-&gt;CurrentFont['cw'];&nbsp;</div></li><li><div>      $w = 0;&nbsp;</div></li><li><div>      $kerning = 0;&nbsp;</div></li><li><div>      $lastchar = 0;&nbsp;</div></li><li><div>      $nb_carac = 0;&nbsp;</div></li><li><div>      $nb_spaces = 0;&nbsp;</div></li><li><div>      $kashida = 0;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF ITERATION</span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;iterationCounter)&nbsp;</div></li><li><div>          $s = preg_replace('/{iteration ([a-zA-Z0-9_]+)}/', '\\1', $s);&nbsp;</div></li><li><div>      if (!$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $discards = substr_count($s, &quot;\xc2\xad&quot;); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> soft hyphens [U+00AD]&nbsp;</div></li><li><div>          $unicode = $this-&gt;UTF8StringToArray($s, $addSubset);&nbsp;</div></li><li><div>          if ($this-&gt;minwSpacing || $this-&gt;fixedlSpacing) {&nbsp;</div></li><li><div>              $nb_spaces = mb_substr_count($s, ' ', $this-&gt;mb_enc);&nbsp;</div></li><li><div>              $nb_carac = count($unicode) - $discards; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Use GPOS OTL</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>                  if (isset($OTLdata['group']) && $OTLdata['group']) {&nbsp;</div></li><li><div>                      $nb_carac -= substr_count($OTLdata['group'], 'M');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;CurrentFont['type'] == 'Type0') { <span class="comment"><span class="comment">// CJK Adobe fonts</span></span>&nbsp;</div></li><li><div>              foreach ($unicode as $char) {&nbsp;</div></li><li><div>                  if ($char == 0x00AD) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> soft hyphens [U+00AD]&nbsp;</div></li><li><div>                  if (isset($cw[$char])) {&nbsp;</div></li><li><div>                      $w+=$cw[$char];&nbsp;</div></li><li><div>                  } elseif (isset($this-&gt;CurrentFont['MissingWidth'])) {&nbsp;</div></li><li><div>                      $w += $this-&gt;CurrentFont['MissingWidth'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $w += 500;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              foreach ($unicode as $i =&gt; $char) {&nbsp;</div></li><li><div>                  if ($char == 0x00AD) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> soft hyphens [U+00AD]&nbsp;</div></li><li><div>                  if (($textvar & FC_SMALLCAPS) && isset($this-&gt;upperCase[$char])) {&nbsp;</div></li><li><div>                      $charw = $this-&gt;_getCharWidth($cw, $this-&gt;upperCase[$char]);&nbsp;</div></li><li><div>                      if ($charw !== false) {&nbsp;</div></li><li><div>                          $charw = $charw * $this-&gt;smCapsScale * $this-&gt;smCapsStretch / 100;&nbsp;</div></li><li><div>                          $w+=$charw;&nbsp;</div></li><li><div>                      } elseif (isset($this-&gt;CurrentFont['desc']['MissingWidth'])) {&nbsp;</div></li><li><div>                          $w += $this-&gt;CurrentFont['desc']['MissingWidth'];&nbsp;</div></li><li><div>                      } elseif (isset($this-&gt;CurrentFont['MissingWidth'])) {&nbsp;</div></li><li><div>                          $w += $this-&gt;CurrentFont['MissingWidth'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $w += 500;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $charw = $this-&gt;_getCharWidth($cw, $char);&nbsp;</div></li><li><div>                      if ($charw !== false) {&nbsp;</div></li><li><div>                          $w+=$charw;&nbsp;</div></li><li><div>                      } elseif (isset($this-&gt;CurrentFont['desc']['MissingWidth'])) {&nbsp;</div></li><li><div>                          $w += $this-&gt;CurrentFont['desc']['MissingWidth'];&nbsp;</div></li><li><div>                      } elseif (isset($this-&gt;CurrentFont['MissingWidth'])) {&nbsp;</div></li><li><div>                          $w += $this-&gt;CurrentFont['MissingWidth'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $w += 500;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Use GPOS OTL</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment">// ...GetStringWidth...</span>&nbsp;</div></li><li><div>                      if (isset($this-&gt;CurrentFont['useOTL']) && ($this-&gt;CurrentFont['useOTL'] & 0xFF) && !empty($OTLdata)) {&nbsp;</div></li><li><div>                          if (isset($OTLdata['GPOSinfo'][$i]['wDir']) && $OTLdata['GPOSinfo'][$i]['wDir'] == 'RTL') {&nbsp;</div></li><li><div>                              if (isset($OTLdata['GPOSinfo'][$i]['XAdvanceR']) && $OTLdata['GPOSinfo'][$i]['XAdvanceR']) {&nbsp;</div></li><li><div>                                  $w += $OTLdata['GPOSinfo'][$i]['XAdvanceR'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              if (isset($OTLdata['GPOSinfo'][$i]['XAdvanceL']) && $OTLdata['GPOSinfo'][$i]['XAdvanceL']) {&nbsp;</div></li><li><div>                                  $w += $OTLdata['GPOSinfo'][$i]['XAdvanceL'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment">// Kashida</span> from GPOS</span></span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// Kashida</span> is set as an absolute length value (already set as a proportion based on useKashida %)</span>&nbsp;</div></li><li><div>                          if ($includeKashida && isset($OTLdata['GPOSinfo'][$i]['kashida_space']) && $OTLdata['GPOSinfo'][$i]['kashida_space']) {&nbsp;</div></li><li><div>                              $kashida += $OTLdata['GPOSinfo'][$i]['kashida_space'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (($textvar & FC_KERNING) && $lastchar) {&nbsp;</div></li><li><div>                          if (isset($this-&gt;CurrentFont['kerninfo'][$lastchar][$char])) {&nbsp;</div></li><li><div>                              $kerning += $this-&gt;CurrentFont['kerninfo'][$lastchar][$char];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $lastchar = $char;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment">// *CJK-FONTS*</span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ($this-&gt;FontFamily != 'csymbol' && $this-&gt;FontFamily != 'czapfdingbats') {&nbsp;</div></li><li><div>              $s = str_replace(chr(173), '', $s);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $nb_carac = $l = strlen($s);&nbsp;</div></li><li><div>          if ($this-&gt;minwSpacing || $this-&gt;fixedlSpacing) {&nbsp;</div></li><li><div>              $nb_spaces = substr_count($s, ' ');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $l; $i++) {&nbsp;</div></li><li><div>              if (($textvar & FC_SMALLCAPS) && isset($this-&gt;upperCase[ord($s[$i])])) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $charw = $cw[chr($this-&gt;upperCase[ord($s[$i])])];&nbsp;</div></li><li><div>                  if ($charw !== false) {&nbsp;</div></li><li><div>                      $charw = $charw * $this-&gt;smCapsScale * $this-&gt;smCapsStretch / 100;&nbsp;</div></li><li><div>                      $w+=$charw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif (isset($cw[$s[$i]])) {&nbsp;</div></li><li><div>                  $w += $cw[$s[$i]];&nbsp;</div></li><li><div>              } elseif (isset($cw[ord($s[$i])])) {&nbsp;</div></li><li><div>                  $w += $cw[ord($s[$i])];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (($textvar & FC_KERNING) && $i &gt; 0) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;CurrentFont['kerninfo'][$s[($i - 1)]][$s[$i]])) {&nbsp;</div></li><li><div>                      $kerning += $this-&gt;CurrentFont['kerninfo'][$s[($i - 1)]][$s[$i]];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset($cw);&nbsp;</div></li><li><div>      if ($textvar & FC_KERNING) {&nbsp;</div></li><li><div>          $w += $kerning;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $w *= ($this-&gt;FontSize / 1000);&nbsp;</div></li><li><div>      $w += (($nb_carac + $nb_spaces) * $this-&gt;fixedlSpacing) + ($nb_spaces * $this-&gt;minwSpacing);&nbsp;</div></li><li><div>      $w += $kashida / _MPDFK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return ($w);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetLineWidth($width)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Set line width</span></span>&nbsp;</div></li><li><div>      $this-&gt;LineWidth = $width;&nbsp;</div></li><li><div>      $lwout = (sprintf('%.3F w', $width * _MPDFK));&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['LineWidth']) && $this-&gt;pageoutput[$this-&gt;page]['LineWidth'] != $lwout) || !isset($this-&gt;pageoutput[$this-&gt;page]['LineWidth']))) {&nbsp;</div></li><li><div>          $this-&gt;_out($lwout);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page]['LineWidth'] = $lwout;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Line($x1, $y1, $x2, $y2)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Draw a line</span></span>&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F m %.3F %.3F l S', $x1 * _MPDFK, ($this-&gt;h - $y1) * _MPDFK, $x2 * _MPDFK, ($this-&gt;h - $y2) * _MPDFK));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Arrow($x1, $y1, $x2, $y2, $headsize = 3, $fill = 'B', $angle = 25)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//F == fill //S == stroke //B == stroke and fill</span>&nbsp;</div></li><li><div>      <span class="comment">// angle = splay of arrowhead - 1 - 89 degrees</span>&nbsp;</div></li><li><div>      if ($fill == 'F')&nbsp;</div></li><li><div>          $fill = 'f';&nbsp;</div></li><li><div>      elseif ($fill == 'FD' or $fill == 'DF' or $fill == 'B')&nbsp;</div></li><li><div>          $fill = 'B';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $fill = 'S';&nbsp;</div></li><li><div>      $a = atan2(($y2 - $y1), ($x2 - $x1));&nbsp;</div></li><li><div>      $b = $a + deg2rad($angle);&nbsp;</div></li><li><div>      $c = $a - deg2rad($angle);&nbsp;</div></li><li><div>      $x3 = $x2 - ($headsize * cos($b));&nbsp;</div></li><li><div>      $y3 = $this-&gt;h - ($y2 - ($headsize * sin($b)));&nbsp;</div></li><li><div>      $x4 = $x2 - ($headsize * cos($c));&nbsp;</div></li><li><div>      $y4 = $this-&gt;h - ($y2 - ($headsize * sin($c)));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $x5 = $x3 - ($x3 - $x4) / 2; <span class="comment">// mid point of base of arrowhead - to join arrow line to</span>&nbsp;</div></li><li><div>      $y5 = $y3 - ($y3 - $y4) / 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>      $s.=sprintf('%.3F %.3F m %.3F %.3F l S', $x1 * _MPDFK, ($this-&gt;h - $y1) * _MPDFK, $x5 * _MPDFK, $y5 * _MPDFK);&nbsp;</div></li><li><div>      $this-&gt;_out($s);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>      $s.=sprintf('%.3F %.3F m %.3F %.3F l %.3F %.3F l %.3F %.3F l %.3F %.3F l ', $x5 * _MPDFK, $y5 * _MPDFK, $x3 * _MPDFK, $y3 * _MPDFK, $x2 * _MPDFK, ($this-&gt;h - $y2) * _MPDFK, $x4 * _MPDFK, $y4 * _MPDFK, $x5 * _MPDFK, $y5 * _MPDFK);&nbsp;</div></li><li><div>      $s.=$fill;&nbsp;</div></li><li><div>      $this-&gt;_out($s);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Rect($x, $y, $w, $h, $style = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Draw a rectangle</span>&nbsp;</div></li><li><div>      if ($style == 'F')&nbsp;</div></li><li><div>          $op = 'f';&nbsp;</div></li><li><div>      elseif ($style == 'FD' or $style == 'DF')&nbsp;</div></li><li><div>          $op = 'B';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $op = 'S';&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F %.3F %.3F re %s', $x * _MPDFK, ($this-&gt;h - $y) * _MPDFK, $w * _MPDFK, -$h * _MPDFK, $op));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddFont($family, $style = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (empty($family)) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $family = strtolower($family);&nbsp;</div></li><li><div>      $style = strtoupper($style);&nbsp;</div></li><li><div>      $style = str_replace('U', '', $style);&nbsp;</div></li><li><div>      if ($style == 'IB')&nbsp;</div></li><li><div>          $style = 'BI';&nbsp;</div></li><li><div>      $fontkey = $family . $style;&nbsp;</div></li><li><div>      <span class="comment">// check if the font has been already added</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;fonts[$fontkey])) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (in_array($family, $this-&gt;available_CJK_fonts)) {&nbsp;</div></li><li><div>          if (empty($this-&gt;Big5_widths)) {&nbsp;</div></li><li><div>              require(_MPDF_PATH . 'includes/CJKdata.php');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;AddCJKFont($family); <span class="comment"><span class="comment">// don't need to add style</span></span>&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          throw new MpdfException(&quot;mPDF Error - problem with Font management&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $stylekey = $style;&nbsp;</div></li><li><div>      if (!$style) {&nbsp;</div></li><li><div>          $stylekey = 'R';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!isset($this-&gt;fontdata[$family][$stylekey]) || !$this-&gt;fontdata[$family][$stylekey]) {&nbsp;</div></li><li><div>          throw new MpdfException('mPDF Error - Font is not supported - ' . $family . ' ' . $style);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $name = '';&nbsp;</div></li><li><div>      $originalsize = 0;&nbsp;</div></li><li><div>      $sip = false;&nbsp;</div></li><li><div>      $smp = false;&nbsp;</div></li><li><div>      $useOTL = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $fontmetrics = ''; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $haskerninfo = false;&nbsp;</div></li><li><div>      $haskernGPOS = false;&nbsp;</div></li><li><div>      $hassmallcapsGSUB = false;&nbsp;</div></li><li><div>      $BMPselected = false;&nbsp;</div></li><li><div>      $GSUBScriptLang = array();&nbsp;</div></li><li><div>      $GSUBFeatures = array();&nbsp;</div></li><li><div>      $GSUBLookups = array();&nbsp;</div></li><li><div>      $GPOSScriptLang = array();&nbsp;</div></li><li><div>      $GPOSFeatures = array();&nbsp;</div></li><li><div>      $GPOSLookups = array();&nbsp;</div></li><li><div>      if (file_exists(_MPDF_TTFONTDATAPATH . $fontkey . '.mtx.php')) {&nbsp;</div></li><li><div>          include(_MPDF_TTFONTDATAPATH . $fontkey . '.mtx.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $ttffile = '';&nbsp;</div></li><li><div>      if (defined('_MPDF_SYSTEM_TTFONTS')) {&nbsp;</div></li><li><div>          $ttffile = _MPDF_SYSTEM_TTFONTS . $this-&gt;fontdata[$family][$stylekey];&nbsp;</div></li><li><div>          if (!file_exists($ttffile)) {&nbsp;</div></li><li><div>              $ttffile = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$ttffile) {&nbsp;</div></li><li><div>          <span class="comment">/** Allow filter to change which file is loaded */</span>&nbsp;</div></li><li><div>          $ttffile = apply_filters('mpdf_current_font_path', _MPDF_TTFONTPATH . $this-&gt;fontdata[$family][$stylekey], $this-&gt;fontdata[$family][$stylekey]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_file($ttffile)) {&nbsp;</div></li><li><div>              throw new MpdfException(&quot;mPDF Error - cannot find TTF TrueType font file - &quot; . $ttffile);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $ttfstat = stat($ttffile);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($this-&gt;fontdata[$family]['TTCfontID'][$stylekey])) {&nbsp;</div></li><li><div>          $TTCfontID = $this-&gt;fontdata[$family]['TTCfontID'][$stylekey];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $TTCfontID = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $BMPonly = false;&nbsp;</div></li><li><div>      if (in_array($family, $this-&gt;BMPonly)) {&nbsp;</div></li><li><div>          $BMPonly = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $regenerate = false;&nbsp;</div></li><li><div>      if ($BMPonly && !$BMPselected) {&nbsp;</div></li><li><div>          $regenerate = true;&nbsp;</div></li><li><div>      } elseif (!$BMPonly && $BMPselected) {&nbsp;</div></li><li><div>          $regenerate = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;fontdata[$family]['useOTL']) && $this-&gt;fontdata[$family]['useOTL'] && $useOTL != $this-&gt;fontdata[$family]['useOTL']) {&nbsp;</div></li><li><div>          $regenerate = true;&nbsp;</div></li><li><div>          $useOTL = $this-&gt;fontdata[$family]['useOTL'];&nbsp;</div></li><li><div>      } elseif ((!isset($this-&gt;fontdata[$family]['useOTL']) || !$this-&gt;fontdata[$family]['useOTL']) && $useOTL) {&nbsp;</div></li><li><div>          $regenerate = true;&nbsp;</div></li><li><div>          $useOTL = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (_FONT_DESCRIPTOR != $fontmetrics) {&nbsp;</div></li><li><div>          $regenerate = true;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (!isset($name) || $originalsize != $ttfstat['size'] || $regenerate) {&nbsp;</div></li><li><div>          if (!class_exists('TTFontFile', false)) {&nbsp;</div></li><li><div>              include(_MPDF_PATH . 'classes/ttfontsuni.php');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $ttf = new TTFontFile();&nbsp;</div></li><li><div>          $ttf-&gt;getMetrics($ttffile, $fontkey, $TTCfontID, $this-&gt;debugfonts, $BMPonly, $useOTL); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $cw = $ttf-&gt;charWidths;&nbsp;</div></li><li><div>          $kerninfo = $ttf-&gt;kerninfo;&nbsp;</div></li><li><div>          if ($kerninfo)&nbsp;</div></li><li><div>              $haskerninfo = true;&nbsp;</div></li><li><div>          $haskernGPOS = $ttf-&gt;haskernGPOS;&nbsp;</div></li><li><div>          $hassmallcapsGSUB = $ttf-&gt;hassmallcapsGSUB;&nbsp;</div></li><li><div>          $name = preg_replace('/[ ()]/', '', $ttf-&gt;fullName);&nbsp;</div></li><li><div>          $sip = $ttf-&gt;sipset;&nbsp;</div></li><li><div>          $smp = $ttf-&gt;smpset;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $GSUBScriptLang = $ttf-&gt;GSUBScriptLang;&nbsp;</div></li><li><div>          $GSUBFeatures = $ttf-&gt;GSUBFeatures;&nbsp;</div></li><li><div>          $GSUBLookups = $ttf-&gt;GSUBLookups;&nbsp;</div></li><li><div>          $rtlPUAstr = $ttf-&gt;rtlPUAstr;&nbsp;</div></li><li><div>          $GPOSScriptLang = $ttf-&gt;GPOSScriptLang;&nbsp;</div></li><li><div>          $GPOSFeatures = $ttf-&gt;GPOSFeatures;&nbsp;</div></li><li><div>          $GPOSLookups = $ttf-&gt;GPOSLookups;&nbsp;</div></li><li><div>          $glyphIDtoUni = $ttf-&gt;glyphIDtoUni;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $desc = array(&nbsp;</div></li><li><div>              'CapHeight' =&gt; round($ttf-&gt;capHeight), &nbsp;</div></li><li><div>              'XHeight' =&gt; round($ttf-&gt;xHeight), &nbsp;</div></li><li><div>              'FontBBox' =&gt; '[' . round($ttf-&gt;bbox[0]) . &quot; &quot; . round($ttf-&gt;bbox[1]) . &quot; &quot; . round($ttf-&gt;bbox[2]) . &quot; &quot; . round($ttf-&gt;bbox[3]) . ']', <span class="comment">/** FontBBox from head table */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**         'MaxWidth' =&gt; round($ttf-&gt;advanceWidthMax), // AdvanceWidthMax from hhea table    NB ArialUnicode MS = 31990 ! */</span>&nbsp;</div></li><li><div>              'Flags' =&gt; $ttf-&gt;flags, &nbsp;</div></li><li><div>              'Ascent' =&gt; round($ttf-&gt;ascent), &nbsp;</div></li><li><div>              'Descent' =&gt; round($ttf-&gt;descent), &nbsp;</div></li><li><div>              'Leading' =&gt; round($ttf-&gt;lineGap), &nbsp;</div></li><li><div>              'ItalicAngle' =&gt; $ttf-&gt;italicAngle, &nbsp;</div></li><li><div>              'StemV' =&gt; round($ttf-&gt;stemV), &nbsp;</div></li><li><div>              'MissingWidth' =&gt; round($ttf-&gt;defaultWidth)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $panose = '';&nbsp;</div></li><li><div>          if (count($ttf-&gt;panose)) {&nbsp;</div></li><li><div>              $panoseArray = array_merge(array($ttf-&gt;sFamilyClass, $ttf-&gt;sFamilySubClass), $ttf-&gt;panose);&nbsp;</div></li><li><div>              foreach ($panoseArray as $value)&nbsp;</div></li><li><div>                  $panose .= ' ' . dechex($value);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $unitsPerEm = round($ttf-&gt;unitsPerEm);&nbsp;</div></li><li><div>          $up = round($ttf-&gt;underlinePosition);&nbsp;</div></li><li><div>          $ut = round($ttf-&gt;underlineThickness);&nbsp;</div></li><li><div>          $strp = round($ttf-&gt;strikeoutPosition); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $strs = round($ttf-&gt;strikeoutSize); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $originalsize = $ttfstat['size'] + 0;&nbsp;</div></li><li><div>          $type = 'TTF';&nbsp;</div></li><li><div>          <span class="comment">//Generate metrics .php file</span>&nbsp;</div></li><li><div>          $s = '&lt;?php' . &quot;\n&quot;;&nbsp;</div></li><li><div>          $s.='$name=\'' . $name . &quot;';\n&quot;;&nbsp;</div></li><li><div>          $s.='$type=\'' . $type . &quot;';\n&quot;;&nbsp;</div></li><li><div>          $s.='$desc=' . var_export($desc, true) . &quot;;\n&quot;;&nbsp;</div></li><li><div>          $s.='$unitsPerEm=' . $unitsPerEm . &quot;;\n&quot;;&nbsp;</div></li><li><div>          $s.='$up=' . $up . &quot;;\n&quot;;&nbsp;</div></li><li><div>          $s.='$ut=' . $ut . &quot;;\n&quot;;&nbsp;</div></li><li><div>          $s.='$strp=' . $strp . &quot;;\n&quot;; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $s.='$strs=' . $strs . &quot;;\n&quot;; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $s.='$ttffile=\'' . $ttffile . &quot;';\n&quot;;&nbsp;</div></li><li><div>          $s.='$TTCfontID=\'' . $TTCfontID . &quot;';\n&quot;;&nbsp;</div></li><li><div>          $s.='$originalsize=' . $originalsize . &quot;;\n&quot;;&nbsp;</div></li><li><div>          if ($sip)&nbsp;</div></li><li><div>              $s.='$sip=true;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $s.='$sip=false;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          if ($smp)&nbsp;</div></li><li><div>              $s.='$smp=true;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $s.='$smp=false;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          if ($BMPonly)&nbsp;</div></li><li><div>              $s.='$BMPselected=true;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $s.='$BMPselected=false;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          $s.='$fontkey=\'' . $fontkey . &quot;';\n&quot;;&nbsp;</div></li><li><div>          $s.='$panose=\'' . $panose . &quot;';\n&quot;;&nbsp;</div></li><li><div>          if ($haskerninfo)&nbsp;</div></li><li><div>              $s.='$haskerninfo=true;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $s.='$haskerninfo=false;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          if ($haskernGPOS)&nbsp;</div></li><li><div>              $s.='$haskernGPOS=true;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $s.='$haskernGPOS=false;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          if ($hassmallcapsGSUB)&nbsp;</div></li><li><div>              $s.='$hassmallcapsGSUB=true;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $s.='$hassmallcapsGSUB=false;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          $s.='$fontmetrics=\'' . _FONT_DESCRIPTOR . &quot;';\n&quot;; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $s.='<span class="comment">// TypoAscender/TypoDescender/TypoLineGap = ' . round($ttf-&gt;typoAscender) . ', ' . round($ttf-&gt;typoDescender) . ', ' . round($ttf-&gt;typoLineGap) . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>          $s.='<span class="comment">// usWinAscent/usWinDescent = ' . round($ttf-&gt;usWinAscent) . ', ' . round(-$ttf-&gt;usWinDescent) . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>          $s.='<span class="comment">// hhea Ascent/Descent/LineGap = ' . round($ttf-&gt;hheaascent) . ', ' . round($ttf-&gt;hheadescent) . ', ' . round($ttf-&gt;hhealineGap) . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">//  mPDF 5.7.1</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;fontdata[$family]['useOTL'])) {&nbsp;</div></li><li><div>              $s.='$useOTL=' . $this-&gt;fontdata[$family]['useOTL'] . ';' . &quot;\n&quot;;&nbsp;</div></li><li><div>          } else&nbsp;</div></li><li><div>              $s.='$useOTL=0x0000;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          if ($rtlPUAstr) {&nbsp;</div></li><li><div>              $s.='$rtlPUAstr=\'' . $rtlPUAstr . &quot;';\n&quot;;&nbsp;</div></li><li><div>          } else&nbsp;</div></li><li><div>              $s.='$rtlPUAstr=\'\';' . &quot;\n&quot;;&nbsp;</div></li><li><div>          if (count($GSUBScriptLang)) {&nbsp;</div></li><li><div>              $s.='$GSUBScriptLang=' . var_export($GSUBScriptLang, true) . &quot;;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (count($GSUBFeatures)) {&nbsp;</div></li><li><div>              $s.='$GSUBFeatures=' . var_export($GSUBFeatures, true) . &quot;;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (count($GSUBLookups)) {&nbsp;</div></li><li><div>              $s.='$GSUBLookups=' . var_export($GSUBLookups, true) . &quot;;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (count($GPOSScriptLang)) {&nbsp;</div></li><li><div>              $s.='$GPOSScriptLang=' . var_export($GPOSScriptLang, true) . &quot;;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (count($GPOSFeatures)) {&nbsp;</div></li><li><div>              $s.='$GPOSFeatures=' . var_export($GPOSFeatures, true) . &quot;;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (count($GPOSLookups)) {&nbsp;</div></li><li><div>              $s.='$GPOSLookups=' . var_export($GPOSLookups, true) . &quot;;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($kerninfo) {&nbsp;</div></li><li><div>              $s.='$kerninfo=' . var_export($kerninfo, true) . &quot;;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $s.=&quot;?&gt;&quot;;&nbsp;</div></li><li><div>          if (is_writable(dirname(_MPDF_TTFONTDATAPATH . 'x'))) {&nbsp;</div></li><li><div>              $fh = fopen(_MPDF_TTFONTDATAPATH . $fontkey . '.mtx.php', &quot;w&quot;);&nbsp;</div></li><li><div>              fwrite($fh, $s, strlen($s));&nbsp;</div></li><li><div>              fclose($fh);&nbsp;</div></li><li><div>              $fh = fopen(_MPDF_TTFONTDATAPATH . $fontkey . '.cw.dat', &quot;wb&quot;);&nbsp;</div></li><li><div>              fwrite($fh, $cw, strlen($cw));&nbsp;</div></li><li><div>              fclose($fh);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $fh = fopen(_MPDF_TTFONTDATAPATH . $fontkey . '.gid.dat', &quot;wb&quot;);&nbsp;</div></li><li><div>              fwrite($fh, $glyphIDtoUni, strlen($glyphIDtoUni));&nbsp;</div></li><li><div>              fclose($fh);&nbsp;</div></li><li><div>              if (file_exists(_MPDF_TTFONTDATAPATH . $fontkey . '.cgm'))&nbsp;</div></li><li><div>                  unlink(_MPDF_TTFONTDATAPATH . $fontkey . '.cgm');&nbsp;</div></li><li><div>              if (file_exists(_MPDF_TTFONTDATAPATH . $fontkey . '.z'))&nbsp;</div></li><li><div>                  unlink(_MPDF_TTFONTDATAPATH . $fontkey . '.z');&nbsp;</div></li><li><div>              if (file_exists(_MPDF_TTFONTDATAPATH . $fontkey . '.cw127.php'))&nbsp;</div></li><li><div>                  unlink(_MPDF_TTFONTDATAPATH . $fontkey . '.cw127.php');&nbsp;</div></li><li><div>              if (file_exists(_MPDF_TTFONTDATAPATH . $fontkey . '.cw'))&nbsp;</div></li><li><div>                  unlink(_MPDF_TTFONTDATAPATH . $fontkey . '.cw');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ($this-&gt;debugfonts) {&nbsp;</div></li><li><div>              throw new MpdfException('Cannot write to the font caching directory - ' . _MPDF_TTFONTDATAPATH);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset($ttf);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $cw = '';&nbsp;</div></li><li><div>          $glyphIDtoUni = '';&nbsp;</div></li><li><div>          if (file_exists(_MPDF_TTFONTDATAPATH . $fontkey . '.cw.dat'))&nbsp;</div></li><li><div>              $cw = file_get_contents(_MPDF_TTFONTDATAPATH . $fontkey . '.cw.dat');&nbsp;</div></li><li><div>          if (file_exists(_MPDF_TTFONTDATAPATH . $fontkey . '.gid.dat'))&nbsp;</div></li><li><div>              $glyphIDtoUni = file_get_contents(_MPDF_TTFONTDATAPATH . $fontkey . '.gid.dat');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Use OTL OpenType Table Layout - GSUB</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;fontdata[$family]['useOTL']) && ($this-&gt;fontdata[$family]['useOTL'])) {&nbsp;</div></li><li><div>          if (!class_exists('otl', false)) {&nbsp;</div></li><li><div>              include(_MPDF_PATH . 'classes/otl.php');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (empty($this-&gt;otl)) {&nbsp;</div></li><li><div>              $this-&gt;otl = new otl($this);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($this-&gt;fontdata[$family]['sip-ext']) && $this-&gt;fontdata[$family]['sip-ext']) {&nbsp;</div></li><li><div>          $sipext = $this-&gt;fontdata[$family]['sip-ext'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $sipext = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Override with values from config_font.php</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;fontdata[$family]['Ascent']) && $this-&gt;fontdata[$family]['Ascent']) {&nbsp;</div></li><li><div>          $desc['Ascent'] = $this-&gt;fontdata[$family]['Ascent'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;fontdata[$family]['Descent']) && $this-&gt;fontdata[$family]['Descent']) {&nbsp;</div></li><li><div>          $desc['Descent'] = $this-&gt;fontdata[$family]['Descent'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;fontdata[$family]['Leading']) && $this-&gt;fontdata[$family]['Leading']) {&nbsp;</div></li><li><div>          $desc['Leading'] = $this-&gt;fontdata[$family]['Leading'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $i = count($this-&gt;fonts) + $this-&gt;extraFontSubsets + 1;&nbsp;</div></li><li><div>      if ($sip || $smp) {&nbsp;</div></li><li><div>          $this-&gt;fonts[$fontkey] = array('i' =&gt; $i, 'type' =&gt; $type, 'name' =&gt; $name, 'desc' =&gt; $desc, 'panose' =&gt; $panose, 'unitsPerEm' =&gt; $unitsPerEm, 'up' =&gt; $up, 'ut' =&gt; $ut, 'strs' =&gt; $strs, 'strp' =&gt; $strp, 'cw' =&gt; $cw, 'ttffile' =&gt; $ttffile, 'fontkey' =&gt; $fontkey, 'subsets' =&gt; array(0 =&gt; range(0, 127)), 'subsetfontids' =&gt; array($i), 'used' =&gt; false, 'sip' =&gt; $sip, 'sipext' =&gt; $sipext, 'smp' =&gt; $smp, 'TTCfontID' =&gt; $TTCfontID, 'useOTL' =&gt; (isset($this-&gt;fontdata[$family]['useOTL']) ? $this-&gt;fontdata[$family]['useOTL'] : false), 'useKashida' =&gt; (isset($this-&gt;fontdata[$family]['useKashida']) ? $this-&gt;fontdata[$family]['useKashida'] : false), 'GSUBScriptLang' =&gt; $GSUBScriptLang, 'GSUBFeatures' =&gt; $GSUBFeatures, 'GSUBLookups' =&gt; $GSUBLookups, 'GPOSScriptLang' =&gt; $GPOSScriptLang, 'GPOSFeatures' =&gt; $GPOSFeatures, 'GPOSLookups' =&gt; $GPOSLookups, 'rtlPUAstr' =&gt; $rtlPUAstr, 'glyphIDtoUni' =&gt; $glyphIDtoUni, 'haskerninfo' =&gt; $haskerninfo, 'haskernGPOS' =&gt; $haskernGPOS, 'hassmallcapsGSUB' =&gt; $hassmallcapsGSUB); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $ss = array();&nbsp;</div></li><li><div>          for ($s = 32; $s &lt; 128; $s++) {&nbsp;</div></li><li><div>              $ss[$s] = $s;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;fonts[$fontkey] = array('i' =&gt; $i, 'type' =&gt; $type, 'name' =&gt; $name, 'desc' =&gt; $desc, 'panose' =&gt; $panose, 'unitsPerEm' =&gt; $unitsPerEm, 'up' =&gt; $up, 'ut' =&gt; $ut, 'strs' =&gt; $strs, 'strp' =&gt; $strp, 'cw' =&gt; $cw, 'ttffile' =&gt; $ttffile, 'fontkey' =&gt; $fontkey, 'subset' =&gt; $ss, 'used' =&gt; false, 'sip' =&gt; $sip, 'sipext' =&gt; $sipext, 'smp' =&gt; $smp, 'TTCfontID' =&gt; $TTCfontID, 'useOTL' =&gt; (isset($this-&gt;fontdata[$family]['useOTL']) ? $this-&gt;fontdata[$family]['useOTL'] : false), 'useKashida' =&gt; (isset($this-&gt;fontdata[$family]['useKashida']) ? $this-&gt;fontdata[$family]['useKashida'] : false), 'GSUBScriptLang' =&gt; $GSUBScriptLang, 'GSUBFeatures' =&gt; $GSUBFeatures, 'GSUBLookups' =&gt; $GSUBLookups, 'GPOSScriptLang' =&gt; $GPOSScriptLang, 'GPOSFeatures' =&gt; $GPOSFeatures, 'GPOSLookups' =&gt; $GPOSLookups, 'rtlPUAstr' =&gt; $rtlPUAstr, 'glyphIDtoUni' =&gt; $glyphIDtoUni, 'haskerninfo' =&gt; $haskerninfo, 'haskernGPOS' =&gt; $haskernGPOS, 'hassmallcapsGSUB' =&gt; $hassmallcapsGSUB); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($haskerninfo) {&nbsp;</div></li><li><div>          $this-&gt;fonts[$fontkey]['kerninfo'] = $kerninfo;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;FontFiles[$fontkey] = array('length1' =&gt; $originalsize, 'type' =&gt; &quot;TTF&quot;, 'ttffile' =&gt; $ttffile, 'sip' =&gt; $sip, 'smp' =&gt; $smp);&nbsp;</div></li><li><div>      unset($cw);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetFont($family, $style = '', $size = 0, $write = true, $forcewrite = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $family = strtolower($family);&nbsp;</div></li><li><div>      if (!$this-&gt;onlyCoreFonts) {&nbsp;</div></li><li><div>          if ($family == 'sans' || $family == 'sans-serif') {&nbsp;</div></li><li><div>              $family = $this-&gt;sans_fonts[0];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($family == 'serif') {&nbsp;</div></li><li><div>              $family = $this-&gt;serif_fonts[0];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($family == 'mono' || $family == 'monospace') {&nbsp;</div></li><li><div>              $family = $this-&gt;mono_fonts[0];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;fonttrans[$family]) && $this-&gt;fonttrans[$family]) {&nbsp;</div></li><li><div>          $family = $this-&gt;fonttrans[$family];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($family == '') {&nbsp;</div></li><li><div>          if ($this-&gt;FontFamily) {&nbsp;</div></li><li><div>              $family = $this-&gt;FontFamily;&nbsp;</div></li><li><div>          } elseif ($this-&gt;default_font) {&nbsp;</div></li><li><div>              $family = $this-&gt;default_font;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              throw new MpdfException(&quot;No font or default font set!&quot;);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;ReqFontStyle = $style; <span class="comment">// required or requested style - used later for artificial bold/italic</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (($family == 'csymbol') || ($family == 'czapfdingbats') || ($family == 'ctimes') || ($family == 'ccourier') || ($family == 'chelvetica')) {&nbsp;</div></li><li><div>          if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>              if ($family == 'csymbol' || $family == 'czapfdingbats') {&nbsp;</div></li><li><div>                  throw new MpdfException(&quot;Symbol and Zapfdingbats cannot be embedded in mPDF (required for PDFA1-b or PDFX/1-a).&quot;);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($family == 'ctimes' || $family == 'ccourier' || $family == 'chelvetica') {&nbsp;</div></li><li><div>                  if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>                      $this-&gt;PDFAXwarnings[] = &quot;Core Adobe font &quot; . ucfirst($family) . &quot; cannot be embedded in mPDF, which is required for PDFA1-b or PDFX/1-a. (Embedded font will be substituted.)&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($family == 'chelvetica') {&nbsp;</div></li><li><div>                      $family = 'sans';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($family == 'ctimes') {&nbsp;</div></li><li><div>                      $family = 'serif';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($family == 'ccourier') {&nbsp;</div></li><li><div>                      $family = 'mono';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;usingCoreFont = false;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;usingCoreFont = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($family == 'csymbol' || $family == 'czapfdingbats') {&nbsp;</div></li><li><div>              $style = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;usingCoreFont = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($style) {&nbsp;</div></li><li><div>          $style = strtoupper($style);&nbsp;</div></li><li><div>          if ($style == 'IB')&nbsp;</div></li><li><div>              $style = 'BI';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($size == 0)&nbsp;</div></li><li><div>          $size = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $fontkey = $family . $style;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $stylekey = $style;&nbsp;</div></li><li><div>      if (!$stylekey) {&nbsp;</div></li><li><div>          $stylekey = &quot;R&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;onlyCoreFonts && !$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          if (!isset($this-&gt;fonts[$fontkey]) || count($this-&gt;default_available_fonts) != count($this-&gt;available_unifonts)) { <span class="comment">// not already added</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// CJK fonts</span></span>&nbsp;</div></li><li><div>              if (in_array($fontkey, $this-&gt;available_CJK_fonts)) {&nbsp;</div></li><li><div>                  if (!isset($this-&gt;fonts[$fontkey])) { <span class="comment">// already added</span>&nbsp;</div></li><li><div>                      if (empty($this-&gt;Big5_widths)) {&nbsp;</div></li><li><div>                          require(_MPDF_PATH . 'includes/CJKdata.php');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;AddCJKFont($family); <span class="comment"><span class="comment">// don't need to add style</span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// Test to see if requested font/style is available - or substitute</span>&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (!in_array($fontkey, $this-&gt;available_unifonts)) {&nbsp;</div></li><li><div>                  <span class="comment">// If font[nostyle] exists - set it</span>&nbsp;</div></li><li><div>                  if (in_array($family, $this-&gt;available_unifonts)) {&nbsp;</div></li><li><div>                      $style = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// elseif only one font available - set it (assumes if only one font available it will not have a style)</span>&nbsp;</div></li><li><div>                  elseif (count($this-&gt;available_unifonts) == 1) {&nbsp;</div></li><li><div>                      $family = $this-&gt;available_unifonts[0];&nbsp;</div></li><li><div>                      $style = '';&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $found = 0;&nbsp;</div></li><li><div>                      <span class="comment">// else substitute font of similar type</span>&nbsp;</div></li><li><div>                      if (in_array($family, $this-&gt;sans_fonts)) {&nbsp;</div></li><li><div>                          $i = array_intersect($this-&gt;sans_fonts, $this-&gt;available_unifonts);&nbsp;</div></li><li><div>                          if (count($i)) {&nbsp;</div></li><li><div>                              $i = array_values($i);&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// with requested style if possible</span></span></span></span>&nbsp;</div></li><li><div>                              if (!in_array(($i[0] . $style), $this-&gt;available_unifonts)) {&nbsp;</div></li><li><div>                                  $style = '';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $family = $i[0];&nbsp;</div></li><li><div>                              $found = 1;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif (in_array($family, $this-&gt;serif_fonts)) {&nbsp;</div></li><li><div>                          $i = array_intersect($this-&gt;serif_fonts, $this-&gt;available_unifonts);&nbsp;</div></li><li><div>                          if (count($i)) {&nbsp;</div></li><li><div>                              $i = array_values($i);&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// with requested style if possible</span></span></span></span>&nbsp;</div></li><li><div>                              if (!in_array(($i[0] . $style), $this-&gt;available_unifonts)) {&nbsp;</div></li><li><div>                                  $style = '';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $family = $i[0];&nbsp;</div></li><li><div>                              $found = 1;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif (in_array($family, $this-&gt;mono_fonts)) {&nbsp;</div></li><li><div>                          $i = array_intersect($this-&gt;mono_fonts, $this-&gt;available_unifonts);&nbsp;</div></li><li><div>                          if (count($i)) {&nbsp;</div></li><li><div>                              $i = array_values($i);&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// with requested style if possible</span></span></span></span>&nbsp;</div></li><li><div>                              if (!in_array(($i[0] . $style), $this-&gt;available_unifonts)) {&nbsp;</div></li><li><div>                                  $style = '';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $family = $i[0];&nbsp;</div></li><li><div>                              $found = 1;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (!$found) {&nbsp;</div></li><li><div>                          <span class="comment">// set first available font</span>&nbsp;</div></li><li><div>                          $fs = $this-&gt;available_unifonts[0];&nbsp;</div></li><li><div>                          preg_match('/^([a-z_0-9\-]+)([BI]{0, 2})$/', $fs, $fas); <span class="comment">// Allow &quot;-&quot;</span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// with requested style if possible</span></span></span></span>&nbsp;</div></li><li><div>                          $ws = $fas[1] . $style;&nbsp;</div></li><li><div>                          if (in_array($ws, $this-&gt;available_unifonts)) {&nbsp;</div></li><li><div>                              $family = $fas[1]; <span class="comment">// leave $style as is</span>&nbsp;</div></li><li><div>                          } elseif (in_array($fas[1], $this-&gt;available_unifonts)) {&nbsp;</div></li><li><div>                              <span class="comment">// or without style</span>&nbsp;</div></li><li><div>                              $family = $fas[1];&nbsp;</div></li><li><div>                              $style = '';&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              <span class="comment">// or with the style specified</span>&nbsp;</div></li><li><div>                              $family = $fas[1];&nbsp;</div></li><li><div>                              $style = $fas[2];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $fontkey = $family . $style;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// try to add font (if not already added)</span>&nbsp;</div></li><li><div>          $this-&gt;AddFont($family, $style);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//Test if font is already selected</span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;FontFamily == $family && $this-&gt;FontFamily == $this-&gt;currentfontfamily && $this-&gt;FontStyle == $style && $this-&gt;FontStyle == $this-&gt;currentfontstyle && $this-&gt;FontSizePt == $size && $this-&gt;FontSizePt == $this-&gt;currentfontsize && !$forcewrite) {&nbsp;</div></li><li><div>              return $family;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $fontkey = $family . $style;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Select it</span></span>&nbsp;</div></li><li><div>          $this-&gt;FontFamily = $family;&nbsp;</div></li><li><div>          $this-&gt;FontStyle = $style;&nbsp;</div></li><li><div>          $this-&gt;FontSizePt = $size;&nbsp;</div></li><li><div>          $this-&gt;FontSize = $size / _MPDFK;&nbsp;</div></li><li><div>          $this-&gt;CurrentFont = &$this-&gt;fonts[$fontkey];&nbsp;</div></li><li><div>          if ($write) {&nbsp;</div></li><li><div>              $fontout = (sprintf('BT /F%d %.3F Tf ET', $this-&gt;CurrentFont['i'], $this-&gt;FontSizePt));&nbsp;</div></li><li><div>              if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['Font']) && $this-&gt;pageoutput[$this-&gt;page]['Font'] != $fontout) || !isset($this-&gt;pageoutput[$this-&gt;page]['Font']))) {&nbsp;</div></li><li><div>                  $this-&gt;_out($fontout);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;pageoutput[$this-&gt;page]['Font'] = $fontout;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Added - currentfont (lowercase) used in HTML2PDF</span></span>&nbsp;</div></li><li><div>          $this-&gt;currentfontfamily = $family;&nbsp;</div></li><li><div>          $this-&gt;currentfontsize = $size;&nbsp;</div></li><li><div>          $this-&gt;currentfontstyle = $style;&nbsp;</div></li><li><div>          $this-&gt;setMBencoding('UTF-8');&nbsp;</div></li><li><div>      } else {  <span class="comment">// if using core fonts</span>&nbsp;</div></li><li><div>          if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>              throw new MpdfException('Core Adobe fonts cannot be embedded in mPDF (required for PDFA1-b or PDFX/1-a) - cannot use option to use core fonts.');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;setMBencoding('windows-1252');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//Test if font is already selected</span></span></span>&nbsp;</div></li><li><div>          if (($this-&gt;FontFamily == $family) AND ( $this-&gt;FontStyle == $style) AND ( $this-&gt;FontSizePt == $size) && !$forcewrite) {&nbsp;</div></li><li><div>              return $family;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (!isset($this-&gt;CoreFonts[$fontkey])) {&nbsp;</div></li><li><div>              if (in_array($family, $this-&gt;serif_fonts)) {&nbsp;</div></li><li><div>                  $family = 'ctimes';&nbsp;</div></li><li><div>              } elseif (in_array($family, $this-&gt;mono_fonts)) {&nbsp;</div></li><li><div>                  $family = 'ccourier';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $family = 'chelvetica';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;usingCoreFont = true;&nbsp;</div></li><li><div>              $fontkey = $family . $style;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (!isset($this-&gt;fonts[$fontkey])) {&nbsp;</div></li><li><div>              <span class="comment">// STANDARD CORE FONTS</span>&nbsp;</div></li><li><div>              if (isset($this-&gt;CoreFonts[$fontkey])) {&nbsp;</div></li><li><div>                  <span class="comment">//Load metric file</span>&nbsp;</div></li><li><div>                  $file = $family;&nbsp;</div></li><li><div>                  if ($family == 'ctimes' || $family == 'chelvetica' || $family == 'ccourier') {&nbsp;</div></li><li><div>                      $file.=strtolower($style);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $file.='.php';&nbsp;</div></li><li><div>                  include(_MPDF_PATH . 'font/' . $file);&nbsp;</div></li><li><div>                  if (!isset($cw)) {&nbsp;</div></li><li><div>                      throw new MpdfException('Could not include font metric file');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $i = count($this-&gt;fonts) + $this-&gt;extraFontSubsets + 1;&nbsp;</div></li><li><div>                  $this-&gt;fonts[$fontkey] = array('i' =&gt; $i, 'type' =&gt; 'core', 'name' =&gt; $this-&gt;CoreFonts[$fontkey], 'desc' =&gt; $desc, 'up' =&gt; $up, 'ut' =&gt; $ut, 'cw' =&gt; $cw);&nbsp;</div></li><li><div>                  if ($this-&gt;useKerning && isset($kerninfo)) {&nbsp;</div></li><li><div>                      $this-&gt;fonts[$fontkey]['kerninfo'] = $kerninfo;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  throw new MpdfException('mPDF error - Font not defined');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//Test if font is already selected</span></span></span>&nbsp;</div></li><li><div>          if (($this-&gt;FontFamily == $family) AND ( $this-&gt;FontStyle == $style) AND ( $this-&gt;FontSizePt == $size) && !$forcewrite) {&nbsp;</div></li><li><div>              return $family;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Select it</span></span>&nbsp;</div></li><li><div>          $this-&gt;FontFamily = $family;&nbsp;</div></li><li><div>          $this-&gt;FontStyle = $style;&nbsp;</div></li><li><div>          $this-&gt;FontSizePt = $size;&nbsp;</div></li><li><div>          $this-&gt;FontSize = $size / _MPDFK;&nbsp;</div></li><li><div>          $this-&gt;CurrentFont = &$this-&gt;fonts[$fontkey];&nbsp;</div></li><li><div>          if ($write) {&nbsp;</div></li><li><div>              $fontout = (sprintf('BT /F%d %.3F Tf ET', $this-&gt;CurrentFont['i'], $this-&gt;FontSizePt));&nbsp;</div></li><li><div>              if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['Font']) && $this-&gt;pageoutput[$this-&gt;page]['Font'] != $fontout) || !isset($this-&gt;pageoutput[$this-&gt;page]['Font']))) {&nbsp;</div></li><li><div>                  $this-&gt;_out($fontout);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;pageoutput[$this-&gt;page]['Font'] = $fontout;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Added - currentfont (lowercase) used in HTML2PDF</span></span>&nbsp;</div></li><li><div>          $this-&gt;currentfontfamily = $family;&nbsp;</div></li><li><div>          $this-&gt;currentfontsize = $size;&nbsp;</div></li><li><div>          $this-&gt;currentfontstyle = $style;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $family;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetFontSize($size, $write = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set font</span> size in points&nbsp;</div></li><li><div>      if ($this-&gt;FontSizePt == $size)&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      $this-&gt;FontSizePt = $size;&nbsp;</div></li><li><div>      $this-&gt;FontSize = $size / _MPDFK;&nbsp;</div></li><li><div>      $this-&gt;currentfontsize = $size;&nbsp;</div></li><li><div>      if ($write) {&nbsp;</div></li><li><div>          $fontout = (sprintf('BT /F%d %.3F Tf ET', $this-&gt;CurrentFont['i'], $this-&gt;FontSizePt));&nbsp;</div></li><li><div>          <span class="comment">// Edited mPDF 3.0</span>&nbsp;</div></li><li><div>          if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['Font']) && $this-&gt;pageoutput[$this-&gt;page]['Font'] != $fontout) || !isset($this-&gt;pageoutput[$this-&gt;page]['Font']))) {&nbsp;</div></li><li><div>              $this-&gt;_out($fontout);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page]['Font'] = $fontout;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddLink()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Create a new internal link</span>&nbsp;</div></li><li><div>      $n = count($this-&gt;links) + 1;&nbsp;</div></li><li><div>      $this-&gt;links[$n] = array(0, 0);&nbsp;</div></li><li><div>      return $n;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetLink($link, $y = 0, $page = -1)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set destination of internal link</span>&nbsp;</div></li><li><div>      if ($y == -1)&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>      if ($page == -1)&nbsp;</div></li><li><div>          $page = $this-&gt;page;&nbsp;</div></li><li><div>      $this-&gt;links[$link] = array($page, $y);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Link($x, $y, $w, $h, $link)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $l = array($x * _MPDFK, $this-&gt;hPt - $y * _MPDFK, $w * _MPDFK, $h * _MPDFK, $link);&nbsp;</div></li><li><div>      if ($this-&gt;keep_block_together) { <span class="comment"><span class="comment"><span class="comment">// don't write</span> yet</span></span>&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      } elseif ($this-&gt;table_rotate) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;tbrot_Links[$this-&gt;page][] = $l; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          return; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      elseif ($this-&gt;kwt) {&nbsp;</div></li><li><div>          $this-&gt;kwt_Links[$this-&gt;page][] = $l;&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;writingHTMLheader || $this-&gt;writingHTMLfooter) {&nbsp;</div></li><li><div>          $this-&gt;HTMLheaderPageLinks[] = $l;&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Put a link on the page</span>&nbsp;</div></li><li><div>      $this-&gt;PageLinks[$this-&gt;page][] = $l;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Save cross-reference to Column buffer</span></span>&nbsp;</div></li><li><div>      $ref = count($this-&gt;PageLinks[$this-&gt;page]) - 1; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;columnLinks[$this-&gt;CurrCol][INTVAL($this-&gt;x)][INTVAL($this-&gt;y)] = $ref; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Text($x, $y, $txt, $OTLdata = array(), $textvar = 0, $aixextra = '', $coordsys = '', $return = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Output (or return) a string</span>&nbsp;</div></li><li><div>      <span class="comment">// Called (internally) by Watermark() & _tableWrite() [rotated cells] & TableHeaderFooter() & WriteText()</span>&nbsp;</div></li><li><div>      <span class="comment">// Called also from classes/svg.php</span>&nbsp;</div></li><li><div>      <span class="comment">// Expects Font to be set</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Expects input to be mb_encoded if necessary and RTL reversed</span> & OTL processed</span>&nbsp;</div></li><li><div>      <span class="comment">// ARTIFICIAL BOLD AND ITALIC</span>&nbsp;</div></li><li><div>      $s = 'q ';&nbsp;</div></li><li><div>      if ($this-&gt;falseBoldWeight && strpos($this-&gt;ReqFontStyle, &quot;B&quot;) !== false && strpos($this-&gt;FontStyle, &quot;B&quot;) === false) {&nbsp;</div></li><li><div>          $s .= '2 Tr 1 J 1 j ';&nbsp;</div></li><li><div>          $s .= sprintf('%.3F w ', ($this-&gt;FontSize / 130) * _MPDFK * $this-&gt;falseBoldWeight);&nbsp;</div></li><li><div>          $tc = strtoupper($this-&gt;TextColor); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// change 0 0 0 rg to 0 0 0 RG</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;FillColor != $tc) {&nbsp;</div></li><li><div>              $s .= $tc . ' ';&nbsp;</div></li><li><div>          }  <span class="comment"><span class="comment">// stroke (outline) = same colour as text(fill)</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (strpos($this-&gt;ReqFontStyle, &quot;I&quot;) !== false && strpos($this-&gt;FontStyle, &quot;I&quot;) === false) {&nbsp;</div></li><li><div>          $aix = '1 0 0.261799 1 %.3F %.3F Tm';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $aix = '%.3F %.3F Td';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $aix = $aixextra . $aix;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;ColorFlag)&nbsp;</div></li><li><div>          $s.=$this-&gt;TextColor . ' ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;CurrentFont['used'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $txt2 = str_replace(chr(160), chr(32), $txt);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $txt2 = str_replace(chr(194) . chr(160), chr(32), $txt);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $px = $x;&nbsp;</div></li><li><div>      $py = $y;&nbsp;</div></li><li><div>      if ($coordsys != 'SVG') {&nbsp;</div></li><li><div>          $px = $x * _MPDFK;&nbsp;</div></li><li><div>          $py = ($this-&gt;h - $y) * _MPDFK;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**         * ************** SIMILAR TO Cell() ************************ */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// IF corefonts AND NOT SmCaps AND NOT Kerning</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Just output text</span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont && !($textvar & FC_SMALLCAPS) && !($textvar & FC_KERNING)) {&nbsp;</div></li><li><div>          $txt2 = $this-&gt;_escape($txt2);&nbsp;</div></li><li><div>          $s .=sprintf('BT ' . $aix . ' (%s) Tj ET', $px, $py, $txt2);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// IF NOT corefonts [AND NO wordspacing] AND NOT SIP/SMP AND NOT SmCaps AND NOT Kerning AND NOT OTL</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Just output text</span></span></span>&nbsp;</div></li><li><div>      elseif (!$this-&gt;usingCoreFont && !($textvar & FC_SMALLCAPS) && !($textvar & FC_KERNING) && !(isset($this-&gt;CurrentFont['useOTL']) && ($this-&gt;CurrentFont['useOTL'] & 0xFF) && !empty($OTLdata['GPOSinfo']))) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// IF SIP/SMP</span></span>&nbsp;</div></li><li><div>          if ($this-&gt;CurrentFont['sip'] || $this-&gt;CurrentFont['smp']) {&nbsp;</div></li><li><div>              $txt2 = $this-&gt;UTF8toSubset($txt2);&nbsp;</div></li><li><div>              $s .=sprintf('BT ' . $aix . ' %s Tj ET', $px, $py, $txt2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// NOT SIP/SMP</span></span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $txt2 = $this-&gt;UTF8ToUTF16BE($txt2, false);&nbsp;</div></li><li><div>              $txt2 = $this-&gt;_escape($txt2);&nbsp;</div></li><li><div>              $s .=sprintf('BT ' . $aix . ' (%s) Tj ET', $px, $py, $txt2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// IF NOT corefonts [AND IS wordspacing] AND NOT SIP AND NOT SmCaps AND NOT Kerning AND NOT OTL</span>&nbsp;</div></li><li><div>      <span class="comment">// Not required here (cf. Cell() )</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// ELSE (IF SmCaps || Kerning || OTL) [corefonts or not corefonts; SIP or SMP or BMP]</span></span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $s .= $this-&gt;applyGPOSpdf($txt2, $aix, $px, $py, $OTLdata, $textvar);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">/**         * ************** END ************************ */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s .= ' ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (($textvar & FD_UNDERLINE) && $txt != '') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $c = strtoupper($this-&gt;TextColor); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// change 0 0 0 rg to 0 0 0 RG</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>              $s.= ' ' . $c . ' ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['up']) && $this-&gt;CurrentFont['up']) {&nbsp;</div></li><li><div>              $up = $this-&gt;CurrentFont['up'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $up = -100;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $adjusty = (-$up / 1000 * $this-&gt;FontSize);&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['ut']) && $this-&gt;CurrentFont['ut']) {&nbsp;</div></li><li><div>              $ut = $this-&gt;CurrentFont['ut'] / 1000 * $this-&gt;FontSize;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $ut = 60 / 1000 * $this-&gt;FontSize;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $olw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>          $s.=' ' . (sprintf(' %.3F w', $ut * _MPDFK));&nbsp;</div></li><li><div>          $s.=' ' . $this-&gt;_dounderline($x, $y + $adjusty, $txt, $OTLdata, $textvar);&nbsp;</div></li><li><div>          $s.=' ' . (sprintf(' %.3F w', $olw * _MPDFK));&nbsp;</div></li><li><div>          if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>              $s.= ' ' . $this-&gt;FillColor . ' ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// STRIKETHROUGH</span></span>&nbsp;</div></li><li><div>      if (($textvar & FD_LINETHROUGH) && $txt != '') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $c = strtoupper($this-&gt;TextColor); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// change 0 0 0 rg to 0 0 0 RG</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>              $s.= ' ' . $c . ' ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//Superscript and Subscript Y coordinate adjustment (now for striked-through texts)</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['desc']['CapHeight']) && $this-&gt;CurrentFont['desc']['CapHeight']) {&nbsp;</div></li><li><div>              $ch = $this-&gt;CurrentFont['desc']['CapHeight'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $ch = 700;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $adjusty = (-$ch / 1000 * $this-&gt;FontSize) * 0.35;&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['ut']) && $this-&gt;CurrentFont['ut']) {&nbsp;</div></li><li><div>              $ut = $this-&gt;CurrentFont['ut'] / 1000 * $this-&gt;FontSize;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $ut = 60 / 1000 * $this-&gt;FontSize;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $olw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>          $s.=' ' . (sprintf(' %.3F w', $ut * _MPDFK));&nbsp;</div></li><li><div>          $s.=' ' . $this-&gt;_dounderline($x, $y + $adjusty, $txt, $OTLdata, $textvar);&nbsp;</div></li><li><div>          $s.=' ' . (sprintf(' %.3F w', $olw * _MPDFK));&nbsp;</div></li><li><div>          if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>              $s.= ' ' . $this-&gt;FillColor . ' ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $s .= 'Q';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($return) {&nbsp;</div></li><li><div>          return $s . &quot; \n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_out($s);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- DIRECTW -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function WriteText($x, $y, $txt)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Output a string using Text() but does encoding and text reversing of RTL</span>&nbsp;</div></li><li><div>      $txt = $this-&gt;purify_utf8_text($txt);&nbsp;</div></li><li><div>      if ($this-&gt;text_input_as_HTML) {&nbsp;</div></li><li><div>          $txt = $this-&gt;all_entities_to_utf8($txt);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $txt = mb_convert_encoding($txt, $this-&gt;mb_enc, 'UTF-8');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span>&nbsp;</div></li><li><div>      if (preg_match(&quot;/([&quot; . $this-&gt;pregRTLchars . &quot;])/u&quot;, $txt)) {&nbsp;</div></li><li><div>          $this-&gt;biDirectional = true;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $textvar = 0;&nbsp;</div></li><li><div>      $save_OTLtags = $this-&gt;OTLtags;&nbsp;</div></li><li><div>      $this-&gt;OTLtags = array();&nbsp;</div></li><li><div>      if ($this-&gt;useKerning) {&nbsp;</div></li><li><div>          if ($this-&gt;CurrentFont['haskernGPOS']) {&nbsp;</div></li><li><div>              $this-&gt;OTLtags['Plus'] .= ' kern';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $textvar = ($textvar | FC_KERNING);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Use OTL OpenType Table Layout - GSUB</span> & GPOS&nbsp;</div></li><li><div>      if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>          $txt = $this-&gt;otl-&gt;applyOTL($txt, $this-&gt;CurrentFont['useOTL']);&nbsp;</div></li><li><div>          $OTLdata = $this-&gt;otl-&gt;OTLdata;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;OTLtags = $save_OTLtags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;magic_reverse_dir($txt, $this-&gt;directionality, $OTLdata);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;Text($x, $y, $txt, $OTLdata, $textvar);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function WriteCell($w, $h = 0, $txt = '', $border = 0, $ln = 0, $align = '', $fill = 0, $link = '', $currentx = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Output a cell</span> using Cell() but does encoding and text reversing of RTL</span>&nbsp;</div></li><li><div>      $txt = $this-&gt;purify_utf8_text($txt);&nbsp;</div></li><li><div>      if ($this-&gt;text_input_as_HTML) {&nbsp;</div></li><li><div>          $txt = $this-&gt;all_entities_to_utf8($txt);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $txt = mb_convert_encoding($txt, $this-&gt;mb_enc, 'UTF-8');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span>&nbsp;</div></li><li><div>      if (preg_match(&quot;/([&quot; . $this-&gt;pregRTLchars . &quot;])/u&quot;, $txt)) {&nbsp;</div></li><li><div>          $this-&gt;biDirectional = true;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $textvar = 0;&nbsp;</div></li><li><div>      $save_OTLtags = $this-&gt;OTLtags;&nbsp;</div></li><li><div>      $this-&gt;OTLtags = array();&nbsp;</div></li><li><div>      if ($this-&gt;useKerning) {&nbsp;</div></li><li><div>          if ($this-&gt;CurrentFont['haskernGPOS']) {&nbsp;</div></li><li><div>              $this-&gt;OTLtags['Plus'] .= ' kern';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $textvar = ($textvar | FC_KERNING);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Use OTL OpenType Table Layout - GSUB</span> & GPOS&nbsp;</div></li><li><div>      if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>          $txt = $this-&gt;otl-&gt;applyOTL($txt, $this-&gt;CurrentFont['useOTL']);&nbsp;</div></li><li><div>          $OTLdata = $this-&gt;otl-&gt;OTLdata;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;OTLtags = $save_OTLtags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;magic_reverse_dir($txt, $this-&gt;directionality, $OTLdata);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;Cell($w, $h, $txt, $border, $ln, $align, $fill, $link, $currentx, 0, 0, 'M', 0, false, $OTLdata, $textvar);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END DIRECTW -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function ResetSpacing()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;ws != 0) {&nbsp;</div></li><li><div>          $this-&gt;_out('BT 0 Tw ET');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;ws = 0;&nbsp;</div></li><li><div>      if ($this-&gt;charspacing != 0) {&nbsp;</div></li><li><div>          $this-&gt;_out('BT 0 Tc ET');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;charspacing = 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetSpacing($cs, $ws)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (intval($cs * 1000) == 0) {&nbsp;</div></li><li><div>          $cs = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($cs) {&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('BT %.3F Tc ET', $cs));&nbsp;</div></li><li><div>      } elseif ($this-&gt;charspacing != 0) {&nbsp;</div></li><li><div>          $this-&gt;_out('BT 0 Tc ET');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;charspacing = $cs;&nbsp;</div></li><li><div>      if (intval($ws * 1000) == 0) {&nbsp;</div></li><li><div>          $ws = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($ws) {&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('BT %.3F Tw ET', $ws));&nbsp;</div></li><li><div>      } elseif ($this-&gt;ws != 0) {&nbsp;</div></li><li><div>          $this-&gt;_out('BT 0 Tw ET');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;ws = $ws;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  function GetJspacing($nc, $ns, $w, $inclCursive, &$cOTLdata)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $kashida_present = false;&nbsp;</div></li><li><div>      $kashida_space = 0;&nbsp;</div></li><li><div>      if ($w &gt; 0 && $inclCursive && isset($this-&gt;CurrentFont['useKashida']) && $this-&gt;CurrentFont['useKashida'] && !empty($cOTLdata)) {&nbsp;</div></li><li><div>          for ($c = 0; $c &lt; count($cOTLdata); $c++) {&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; strlen($cOTLdata[$c]['group']); $i++) {&nbsp;</div></li><li><div>                  if (isset($cOTLdata[$c]['GPOSinfo'][$i]['kashida']) && $cOTLdata[$c]['GPOSinfo'][$i]['kashida'] &gt; 0) {&nbsp;</div></li><li><div>                      $kashida_present = true;&nbsp;</div></li><li><div>                      break 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($kashida_present) {&nbsp;</div></li><li><div>          $k_ctr = 0;  <span class="comment">// Number of kashida points</span>&nbsp;</div></li><li><div>          $k_total = 0;  <span class="comment">// Total of kashida values (priority)</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Reset</span> word</span></span>&nbsp;</div></li><li><div>          $max_kashida_in_word = 0;&nbsp;</div></li><li><div>          $last_kashida_in_word = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          for ($c = 0; $c &lt; count($cOTLdata); $c++) {&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; strlen($cOTLdata[$c]['group']); $i++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($cOTLdata[$c]['group']{$i} == 'S') {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Save from last word</span></span>&nbsp;</div></li><li><div>                      if ($max_kashida_in_word) {&nbsp;</div></li><li><div>                          $k_ctr++;&nbsp;</div></li><li><div>                          $k_total = $max_kashida_in_word;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment">// Reset</span> word</span></span>&nbsp;</div></li><li><div>                      $max_kashida_in_word = 0;&nbsp;</div></li><li><div>                      $last_kashida_in_word = -1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($cOTLdata[$c]['GPOSinfo'][$i]['kashida']) && $cOTLdata[$c]['GPOSinfo'][$i]['kashida'] &gt; 0) {&nbsp;</div></li><li><div>                      if ($max_kashida_in_word) {&nbsp;</div></li><li><div>                          if ($cOTLdata[$c]['GPOSinfo'][$i]['kashida'] &gt; $max_kashida_in_word) {&nbsp;</div></li><li><div>                              $max_kashida_in_word = $cOTLdata[$c]['GPOSinfo'][$i]['kashida'];&nbsp;</div></li><li><div>                              $cOTLdata[$c]['GPOSinfo'][$last_kashida_in_word]['kashida'] = 0;&nbsp;</div></li><li><div>                              $last_kashida_in_word = $i;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $cOTLdata[$c]['GPOSinfo'][$i]['kashida'] = 0;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $max_kashida_in_word = $cOTLdata[$c]['GPOSinfo'][$i]['kashida'];&nbsp;</div></li><li><div>                          $last_kashida_in_word = $i;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Save from last word</span></span>&nbsp;</div></li><li><div>          if ($max_kashida_in_word) {&nbsp;</div></li><li><div>              $k_ctr++;&nbsp;</div></li><li><div>              $k_total = $max_kashida_in_word;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Number of kashida points</span> = $k_ctr&nbsp;</div></li><li><div>          <span class="comment">// $useKashida is a % value from CurrentFont/config_fonts.php</span>&nbsp;</div></li><li><div>          <span class="comment">// % ratio divided between word-spacing and kashida-spacing</span>&nbsp;</div></li><li><div>          $kashida_space_ratio = intval($this-&gt;CurrentFont['useKashida']) / 100;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $kashida_space = $w * $kashida_space_ratio;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $tatw = $this-&gt;_getCharWidth($this-&gt;CurrentFont['cw'], 0x0640);&nbsp;</div></li><li><div>          <span class="comment">// Only use kashida if each allocated kashida width is &gt; 0.01 x width of a tatweel</span>&nbsp;</div></li><li><div>          <span class="comment">// Otherwise fontstretch is too small and errors</span>&nbsp;</div></li><li><div>          <span class="comment">// If not just leave to adjust word-spacing</span>&nbsp;</div></li><li><div>          if ($tatw && (($kashida_space / $k_ctr) / $tatw) &gt; 0.01) {&nbsp;</div></li><li><div>              for ($c = 0; $c &lt; count($cOTLdata); $c++) {&nbsp;</div></li><li><div>                  for ($i = 0; $i &lt; strlen($cOTLdata[$c]['group']); $i++) {&nbsp;</div></li><li><div>                      if (isset($cOTLdata[$c]['GPOSinfo'][$i]['kashida']) && $cOTLdata[$c]['GPOSinfo'][$i]['kashida'] &gt; 0) {&nbsp;</div></li><li><div>                          <span class="comment">// At this point kashida is a number representing priority (higher number - higher priority)</span>&nbsp;</div></li><li><div>                          <span class="comment">// We are now going to set it as an actual length</span>&nbsp;</div></li><li><div>                          <span class="comment">// This shares it equally amongst words:</span>&nbsp;</div></li><li><div>                          $cOTLdata[$c]['GPOSinfo'][$i]['kashida_space'] = (1 / $k_ctr) * $kashida_space;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $w -= $kashida_space;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $ws = 0;&nbsp;</div></li><li><div>      $charspacing = 0;&nbsp;</div></li><li><div>      $ww = $this-&gt;jSWord;&nbsp;</div></li><li><div>      $ncx = $nc - 1;&nbsp;</div></li><li><div>      if ($nc == 0) {&nbsp;</div></li><li><div>          return array(0, 0, 0);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Only word spacing allowed / possible</span>&nbsp;</div></li><li><div>      elseif ($this-&gt;fixedlSpacing !== false || $inclCursive) {&nbsp;</div></li><li><div>          if ($ns) {&nbsp;</div></li><li><div>              $ws = $w / $ns;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($nc == 1) {&nbsp;</div></li><li><div>          $charspacing = $w;&nbsp;</div></li><li><div>      } elseif (!$ns) {&nbsp;</div></li><li><div>          $charspacing = $w / ($ncx );&nbsp;</div></li><li><div>          if (($this-&gt;jSmaxChar &gt; 0) && ($charspacing &gt; $this-&gt;jSmaxChar)) {&nbsp;</div></li><li><div>              $charspacing = $this-&gt;jSmaxChar;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($ns == ($ncx )) {&nbsp;</div></li><li><div>          $charspacing = $w / $ns;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>              $cs = ($w * (1 - $this-&gt;jSWord)) / ($ncx );&nbsp;</div></li><li><div>              if (($this-&gt;jSmaxChar &gt; 0) && ($cs &gt; $this-&gt;jSmaxChar)) {&nbsp;</div></li><li><div>                  $cs = $this-&gt;jSmaxChar;&nbsp;</div></li><li><div>                  $ww = 1 - (($cs * ($ncx )) / $w);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $charspacing = $cs;&nbsp;</div></li><li><div>              $ws = ($w * ($ww) ) / $ns;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $cs = ($w * (1 - $this-&gt;jSWord)) / ($ncx - $ns);&nbsp;</div></li><li><div>              if (($this-&gt;jSmaxChar &gt; 0) && ($cs &gt; $this-&gt;jSmaxChar)) {&nbsp;</div></li><li><div>                  $cs = $this-&gt;jSmaxChar;&nbsp;</div></li><li><div>                  $ww = 1 - (($cs * ($ncx - $ns)) / $w);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $charspacing = $cs;&nbsp;</div></li><li><div>              $ws = (($w * ($ww) ) / $ns) - $charspacing;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array($charspacing, $ws, $kashida_space);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Cell($w, $h = 0, $txt = '', $border = 0, $ln = 0, $align = '', $fill = 0, $link = '', $currentx = 0, $lcpaddingL = 0, $lcpaddingR = 0, $valign = 'M', $spanfill = 0, $exactWidth = false, $OTLdata = false, $textvar = 0, $lineBox = false)&nbsp;</div></li><li><div>  {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">//Output a cell</span>&nbsp;</div></li><li><div>      <span class="comment">// Expects input to be mb_encoded if necessary and RTL reversed</span>&nbsp;</div></li><li><div>      <span class="comment">// NON_BREAKING SPACE</span>&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $txt = str_replace(chr(160), chr(32), $txt);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $txt = str_replace(chr(194) . chr(160), chr(32), $txt);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>      <span class="comment">// Automatic page break</span>&nbsp;</div></li><li><div>      <span class="comment">// Allows PAGE-BREAK-AFTER = avoid to work</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$this-&gt;blklvl])) {&nbsp;</div></li><li><div>          $bottom = $this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['margin_bottom'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $bottom = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;tableLevel && (($this-&gt;y + $this-&gt;divheight &gt; $this-&gt;PageBreakTrigger) || ($this-&gt;y + $h &gt; $this-&gt;PageBreakTrigger) ||&nbsp;</div></li><li><div>          ($this-&gt;y + ($h * 2) + $bottom &gt; $this-&gt;PageBreakTrigger && $this-&gt;blk[$this-&gt;blklvl]['page_break_after_avoid'])) and ! $this-&gt;InFooter and $this-&gt;AcceptPageBreak()) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>          $x = $this-&gt;x; <span class="comment"><span class="comment"><span class="comment">//Current X position</span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $ws = $this-&gt;ws; <span class="comment"><span class="comment"><span class="comment">//Word Spacing</span></span></span>&nbsp;</div></li><li><div>          $charspacing = $this-&gt;charspacing; <span class="comment"><span class="comment"><span class="comment">//Character Spacing</span></span></span>&nbsp;</div></li><li><div>          $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added to correct for OddEven Margins</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $x += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>          if ($currentx) {&nbsp;</div></li><li><div>              $currentx += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;x = $x;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;SetSpacing($charspacing, $ws);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Test: to put line through centre of cell: $this-&gt;Line($this-&gt;x, $this-&gt;y+($h/2), $this-&gt;x+50, $this-&gt;y+($h/2));</span>&nbsp;</div></li><li><div>      <span class="comment">// Test: to put border around cell as it is specified: $border='LRTB';</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLUMN CHANGE</span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;CurrCol != $oldcolumn) {&nbsp;</div></li><li><div>          if ($currentx) {&nbsp;</div></li><li><div>              $currentx += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;x += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// COLUMNS</span> Update/overwrite the lowest bottom of printing y value for a column&nbsp;</div></li><li><div>      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          if ($h) {&nbsp;</div></li><li><div>              $this-&gt;ColDetails[$this-&gt;CurrCol]['bottom_margin'] = $this-&gt;y + $h;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;ColDetails[$this-&gt;CurrCol]['bottom_margin'] = $this-&gt;y + $this-&gt;divheight;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($w == 0)&nbsp;</div></li><li><div>          $w = $this-&gt;w - $this-&gt;rMargin - $this-&gt;x;&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>      if ($fill == 1 && $this-&gt;FillColor) {&nbsp;</div></li><li><div>          if ((isset($this-&gt;pageoutput[$this-&gt;page]['FillColor']) && $this-&gt;pageoutput[$this-&gt;page]['FillColor'] != $this-&gt;FillColor) || !isset($this-&gt;pageoutput[$this-&gt;page]['FillColor'])) {&nbsp;</div></li><li><div>              $s .= $this-&gt;FillColor . ' ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page]['FillColor'] = $this-&gt;FillColor;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($lineBox && isset($lineBox['boxtop']) && $txt) { <span class="comment">// i.e. always from WriteFlowingBlock/finishFlowingBlock (but not objects -</span>&nbsp;</div></li><li><div>          <span class="comment">// which only have $lineBox['top'] set)</span>&nbsp;</div></li><li><div>          $boxtop = $this-&gt;y + $lineBox['boxtop'];&nbsp;</div></li><li><div>          $boxbottom = $this-&gt;y + $lineBox['boxbottom'];&nbsp;</div></li><li><div>          $glyphYorigin = $lineBox['glyphYorigin'];&nbsp;</div></li><li><div>          $baseline_shift = $lineBox['baseline-shift'];&nbsp;</div></li><li><div>          $bord_boxtop = $bg_boxtop = $boxtop = $boxtop - $baseline_shift;&nbsp;</div></li><li><div>          $bord_boxbottom = $bg_boxbottom = $boxbottom = $boxbottom - $baseline_shift;&nbsp;</div></li><li><div>          $bord_boxheight = $bg_boxheight = $boxheight = $boxbottom - $boxtop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If inline element BACKGROUND has bounding box set by parent element:</span>&nbsp;</div></li><li><div>          if (isset($lineBox['background-boxtop'])) {&nbsp;</div></li><li><div>              $bg_boxtop = $this-&gt;y + $lineBox['background-boxtop'] - $lineBox['background-baseline-shift'];&nbsp;</div></li><li><div>              $bg_boxbottom = $this-&gt;y + $lineBox['background-boxbottom'] - $lineBox['background-baseline-shift'];&nbsp;</div></li><li><div>              $bg_boxheight = $bg_boxbottom - $bg_boxtop;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// If inline element BORDER has bounding box set by parent element:</span>&nbsp;</div></li><li><div>          if (isset($lineBox['border-boxtop'])) {&nbsp;</div></li><li><div>              $bord_boxtop = $this-&gt;y + $lineBox['border-boxtop'] - $lineBox['border-baseline-shift'];&nbsp;</div></li><li><div>              $bord_boxbottom = $this-&gt;y + $lineBox['border-boxbottom'] - $lineBox['border-baseline-shift'];&nbsp;</div></li><li><div>              $bord_boxheight = $bord_boxbottom - $bord_boxtop;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $boxtop = $this-&gt;y;&nbsp;</div></li><li><div>          $boxheight = $h;&nbsp;</div></li><li><div>          $boxbottom = $this-&gt;y + $h;&nbsp;</div></li><li><div>          $baseline_shift = 0;&nbsp;</div></li><li><div>          if ($txt != '') {&nbsp;</div></li><li><div>              <span class="comment">// FONT SIZE - this determines the baseline caculation</span>&nbsp;</div></li><li><div>              $bfs = $this-&gt;FontSize;&nbsp;</div></li><li><div>              <span class="comment">//Calculate baseline Superscript and Subscript Y coordinate adjustment</span>&nbsp;</div></li><li><div>              $bfx = $this-&gt;baselineC;&nbsp;</div></li><li><div>              $baseline = $bfx * $bfs;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($textvar & FA_SUPERSCRIPT) {&nbsp;</div></li><li><div>                  $baseline_shift = $this-&gt;textparam['text-baseline'];&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              elseif ($textvar & FA_SUBSCRIPT) {&nbsp;</div></li><li><div>                  $baseline_shift = $this-&gt;textparam['text-baseline'];&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              elseif ($this-&gt;bullet) {&nbsp;</div></li><li><div>                  $baseline += ($bfx - 0.7) * $this-&gt;FontSize;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Vertical align (for Images)</span>&nbsp;</div></li><li><div>              if ($valign == 'T') {&nbsp;</div></li><li><div>                  $va = (0.5 * $bfs * $this-&gt;normalLineheight);&nbsp;</div></li><li><div>              } elseif ($valign == 'B') {&nbsp;</div></li><li><div>                  $va = $h - (0.5 * $bfs * $this-&gt;normalLineheight);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $va = 0.5 * $h;&nbsp;</div></li><li><div>              } <span class="comment">// Middle</span>&nbsp;</div></li><li><div>              <span class="comment">// ONLY SET THESE IF WANT TO CONFINE BORDER +/- FILL TO FIT FONTSIZE - NOT FULL CELL AS IS ORIGINAL FUNCTION</span>&nbsp;</div></li><li><div>              <span class="comment">// spanfill or spanborder are set in FlowingBlock functions</span>&nbsp;</div></li><li><div>              if ($spanfill || !empty($this-&gt;spanborddet) || $link != '') {&nbsp;</div></li><li><div>                  $exth = 0.2; <span class="comment">// Add to fontsize to increase height of background / link / border</span>&nbsp;</div></li><li><div>                  $boxtop = $this-&gt;y + $baseline + $va - ($this-&gt;FontSize * (1 + $exth / 2) * (0.5 + $bfx));&nbsp;</div></li><li><div>                  $boxheight = $this-&gt;FontSize * (1 + $exth);&nbsp;</div></li><li><div>                  $boxbottom = $boxtop + $boxheight;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $glyphYorigin = $baseline + $va;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $boxtop -= $baseline_shift;&nbsp;</div></li><li><div>          $boxbottom -= $baseline_shift;&nbsp;</div></li><li><div>          $bord_boxtop = $bg_boxtop = $boxtop;&nbsp;</div></li><li><div>          $bord_boxbottom = $bg_boxbottom = $boxbottom;&nbsp;</div></li><li><div>          $bord_boxheight = $bg_boxheight = $boxheight = $boxbottom - $boxtop;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bbw = $tbw = $lbw = $rbw = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Border widths</span></span></span></span></span>&nbsp;</div></li><li><div>      if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>          if (!isset($this-&gt;spanborddet['B'])) {&nbsp;</div></li><li><div>              $this-&gt;spanborddet['B'] = array('s' =&gt; 0, 'style' =&gt; '', 'w' =&gt; 0);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!isset($this-&gt;spanborddet['T'])) {&nbsp;</div></li><li><div>              $this-&gt;spanborddet['T'] = array('s' =&gt; 0, 'style' =&gt; '', 'w' =&gt; 0);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!isset($this-&gt;spanborddet['L'])) {&nbsp;</div></li><li><div>              $this-&gt;spanborddet['L'] = array('s' =&gt; 0, 'style' =&gt; '', 'w' =&gt; 0);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!isset($this-&gt;spanborddet['R'])) {&nbsp;</div></li><li><div>              $this-&gt;spanborddet['R'] = array('s' =&gt; 0, 'style' =&gt; '', 'w' =&gt; 0);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $bbw = $this-&gt;spanborddet['B']['w'];&nbsp;</div></li><li><div>          $tbw = $this-&gt;spanborddet['T']['w'];&nbsp;</div></li><li><div>          $lbw = $this-&gt;spanborddet['L']['w'];&nbsp;</div></li><li><div>          $rbw = $this-&gt;spanborddet['R']['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($fill == 1 || $border == 1 || !empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>          if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>              if ($fill == 1) {&nbsp;</div></li><li><div>                  $s.=sprintf('%.3F %.3F %.3F %.3F re f ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bg_boxtop + $tbw) * _MPDFK, ($w + $lbw + $rbw) * _MPDFK, (-$bg_boxheight - $tbw - $bbw) * _MPDFK);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s.= ' q ';&nbsp;</div></li><li><div>              $dashon = 3;&nbsp;</div></li><li><div>              $dashoff = 3.5;&nbsp;</div></li><li><div>              $dot = 2.5;&nbsp;</div></li><li><div>              if ($tbw) {&nbsp;</div></li><li><div>                  $short = 0;&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['T']['style'] == 'dashed') {&nbsp;</div></li><li><div>                      $s.=sprintf(' 0 j 0 J [%.3F %.3F] 0 d ', $tbw * $dashon * _MPDFK, $tbw * $dashoff * _MPDFK);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;spanborddet['T']['style'] == 'dotted') {&nbsp;</div></li><li><div>                      $s.=sprintf(' 1 j 1 J [%.3F %.3F] %.3F d ', 0.001, $tbw * $dot * _MPDFK, -$tbw / 2 * _MPDFK);&nbsp;</div></li><li><div>                      $short = $tbw / 2;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s.=' 0 j 0 J [] 0 d ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['T']['style'] != 'dotted') {&nbsp;</div></li><li><div>                      $s .= 'q ';&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F m ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x + $w + $rbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x + $w) * _MPDFK, ($this-&gt;h - $bord_boxtop) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x) * _MPDFK, ($this-&gt;h - $bord_boxtop) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= ' h W n '; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $c = $this-&gt;SetDColor($this-&gt;spanborddet['T']['c'], true);&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['T']['style'] == 'double') {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $tbw / 3 * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw * 5 / 6) * _MPDFK, ($this-&gt;x + $w + $rbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw * 5 / 6) * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw / 6) * _MPDFK, ($this-&gt;x + $w + $rbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw / 6) * _MPDFK);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;spanborddet['T']['style'] == 'dotted') {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $tbw * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw / 2) * _MPDFK, ($this-&gt;x + $w + $rbw - $short) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw / 2) * _MPDFK);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $tbw * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw / 2) * _MPDFK, ($this-&gt;x + $w + $rbw - $short) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw / 2) * _MPDFK);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['T']['style'] != 'dotted') {&nbsp;</div></li><li><div>                      $s .= ' Q ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbw) {&nbsp;</div></li><li><div>                  $short = 0;&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['B']['style'] == 'dashed') {&nbsp;</div></li><li><div>                      $s.=sprintf(' 0 j 0 J [%.3F %.3F] 0 d ', $bbw * $dashon * _MPDFK, $bbw * $dashoff * _MPDFK);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;spanborddet['B']['style'] == 'dotted') {&nbsp;</div></li><li><div>                      $s.=sprintf(' 1 j 1 J [%.3F %.3F] %.3F d ', 0.001, $bbw * $dot * _MPDFK, -$bbw / 2 * _MPDFK);&nbsp;</div></li><li><div>                      $short = $bbw / 2;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s.=' 0 j 0 J [] 0 d ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['B']['style'] != 'dotted') {&nbsp;</div></li><li><div>                      $s .= 'q ';&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F m ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x + $w + $rbw) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x + $w) * _MPDFK, ($this-&gt;h - $bord_boxbottom) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x) * _MPDFK, ($this-&gt;h - $bord_boxbottom) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= ' h W n '; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $c = $this-&gt;SetDColor($this-&gt;spanborddet['B']['c'], true);&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['B']['style'] == 'double') {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $bbw / 3 * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw / 6) * _MPDFK, ($this-&gt;x + $w + $rbw - $short) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw / 6) * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw * 5 / 6) * _MPDFK, ($this-&gt;x + $w + $rbw - $short) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw * 5 / 6) * _MPDFK);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;spanborddet['B']['style'] == 'dotted') {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $bbw * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw / 2) * _MPDFK, ($this-&gt;x + $w + $rbw - $short) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw / 2) * _MPDFK);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $bbw * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw / 2) * _MPDFK, ($this-&gt;x + $w + $rbw - $short) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw / 2) * _MPDFK);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['B']['style'] != 'dotted') {&nbsp;</div></li><li><div>                      $s .= ' Q ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($lbw) {&nbsp;</div></li><li><div>                  $short = 0;&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['L']['style'] == 'dashed') {&nbsp;</div></li><li><div>                      $s.=sprintf(' 0 j 0 J [%.3F %.3F] 0 d ', $lbw * $dashon * _MPDFK, $lbw * $dashoff * _MPDFK);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;spanborddet['L']['style'] == 'dotted') {&nbsp;</div></li><li><div>                      $s.=sprintf(' 1 j 1 J [%.3F %.3F] %.3F d ', 0.001, $lbw * $dot * _MPDFK, -$lbw / 2 * _MPDFK);&nbsp;</div></li><li><div>                      $short = $lbw / 2;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s.=' 0 j 0 J [] 0 d ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['L']['style'] != 'dotted') {&nbsp;</div></li><li><div>                      $s .= 'q ';&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F m ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x) * _MPDFK, ($this-&gt;h - $bord_boxbottom) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x) * _MPDFK, ($this-&gt;h - $bord_boxtop) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x - $lbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= ' h W n '; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $c = $this-&gt;SetDColor($this-&gt;spanborddet['L']['c'], true);&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['L']['style'] == 'double') {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $lbw / 3 * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw / 6) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK, ($this-&gt;x - $lbw / 6) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw + $short) * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw * 5 / 6) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK, ($this-&gt;x - $lbw * 5 / 6) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw + $short) * _MPDFK);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;spanborddet['L']['style'] == 'dotted') {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $lbw * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw / 2) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK, ($this-&gt;x - $lbw / 2) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw + $short) * _MPDFK);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $lbw * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x - $lbw / 2) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK, ($this-&gt;x - $lbw / 2) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw + $short) * _MPDFK);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['L']['style'] != 'dotted') {&nbsp;</div></li><li><div>                      $s .= ' Q ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($rbw) {&nbsp;</div></li><li><div>                  $short = 0;&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['R']['style'] == 'dashed') {&nbsp;</div></li><li><div>                      $s.=sprintf(' 0 j 0 J [%.3F %.3F] 0 d ', $rbw * $dashon * _MPDFK, $rbw * $dashoff * _MPDFK);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;spanborddet['R']['style'] == 'dotted') {&nbsp;</div></li><li><div>                      $s.=sprintf(' 1 j 1 J [%.3F %.3F] %.3F d ', 0.001, $rbw * $dot * _MPDFK, -$rbw / 2 * _MPDFK);&nbsp;</div></li><li><div>                      $short = $rbw / 2;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s.=' 0 j 0 J [] 0 d ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['R']['style'] != 'dotted') {&nbsp;</div></li><li><div>                      $s .= 'q ';&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F m ', ($this-&gt;x + $w + $rbw) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x + $w) * _MPDFK, ($this-&gt;h - $bord_boxbottom) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x + $w) * _MPDFK, ($this-&gt;h - $bord_boxtop) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= sprintf('%.3F %.3F l ', ($this-&gt;x + $w + $rbw) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK);&nbsp;</div></li><li><div>                      $s .= ' h W n '; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $c = $this-&gt;SetDColor($this-&gt;spanborddet['R']['c'], true);&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['R']['style'] == 'double') {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $rbw / 3 * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x + $w + $rbw / 6) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK, ($this-&gt;x + $w + $rbw / 6) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw + $short) * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x + $w + $rbw * 5 / 6) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK, ($this-&gt;x + $w + $rbw * 5 / 6) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw + $short) * _MPDFK);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;spanborddet['R']['style'] == 'dotted') {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $rbw * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x + $w + $rbw / 2) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK, ($this-&gt;x + $w + $rbw / 2) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw + $short) * _MPDFK);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s.=sprintf(' %s %.3F w ', $c, $rbw * _MPDFK);&nbsp;</div></li><li><div>                      $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($this-&gt;x + $w + $rbw / 2) * _MPDFK, ($this-&gt;h - $bord_boxtop + $tbw) * _MPDFK, ($this-&gt;x + $w + $rbw / 2) * _MPDFK, ($this-&gt;h - $bord_boxbottom - $bbw + $short) * _MPDFK);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;spanborddet['R']['style'] != 'dotted') {&nbsp;</div></li><li><div>                      $s .= ' Q ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s.= ' Q ';&nbsp;</div></li><li><div>          } else { <span class="comment"><span class="comment">// If &quot;border&quot;, does not come from WriteFlowingBlock or FinishFlowingBlock</span></span>&nbsp;</div></li><li><div>              if ($fill == 1)&nbsp;</div></li><li><div>                  $op = ($border == 1) ? 'B' : 'f';&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $op = 'S';&nbsp;</div></li><li><div>              $s.=sprintf('%.3F %.3F %.3F %.3F re %s ', $this-&gt;x * _MPDFK, ($this-&gt;h - $bg_boxtop) * _MPDFK, $w * _MPDFK, -$bg_boxheight * _MPDFK, $op);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (is_string($border)) { <span class="comment"><span class="comment">// If &quot;border&quot;, does not come from WriteFlowingBlock or FinishFlowingBlock</span></span>&nbsp;</div></li><li><div>          $x = $this-&gt;x;&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>          if (is_int(strpos($border, 'L')))&nbsp;</div></li><li><div>              $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', $x * _MPDFK, ($this-&gt;h - $bord_boxtop) * _MPDFK, $x * _MPDFK, ($this-&gt;h - ($bord_boxbottom)) * _MPDFK);&nbsp;</div></li><li><div>          if (is_int(strpos($border, 'T')))&nbsp;</div></li><li><div>              $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', $x * _MPDFK, ($this-&gt;h - $bord_boxtop) * _MPDFK, ($x + $w) * _MPDFK, ($this-&gt;h - $bord_boxtop) * _MPDFK);&nbsp;</div></li><li><div>          if (is_int(strpos($border, 'R')))&nbsp;</div></li><li><div>              $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', ($x + $w) * _MPDFK, ($this-&gt;h - $bord_boxtop) * _MPDFK, ($x + $w) * _MPDFK, ($this-&gt;h - ($bord_boxbottom)) * _MPDFK);&nbsp;</div></li><li><div>          if (is_int(strpos($border, 'B')))&nbsp;</div></li><li><div>              $s.=sprintf('%.3F %.3F m %.3F %.3F l S ', $x * _MPDFK, ($this-&gt;h - ($bord_boxbottom)) * _MPDFK, ($x + $w) * _MPDFK, ($this-&gt;h - ($bord_boxbottom)) * _MPDFK);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($txt != '') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($exactWidth)&nbsp;</div></li><li><div>              $stringWidth = $w;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $stringWidth = $this-&gt;GetStringWidth($txt, true, $OTLdata, $textvar) + ( $this-&gt;charspacing * mb_strlen($txt, $this-&gt;mb_enc) / _MPDFK ) + ( $this-&gt;ws * mb_substr_count($txt, ' ', $this-&gt;mb_enc) / _MPDFK );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set x OFFSET FOR PRINTING</span>&nbsp;</div></li><li><div>          if ($align == 'R') {&nbsp;</div></li><li><div>              $dx = $w - $this-&gt;cMarginR - $stringWidth - $lcpaddingR;&nbsp;</div></li><li><div>          } elseif ($align == 'C') {&nbsp;</div></li><li><div>              $dx = (($w - $stringWidth ) / 2);&nbsp;</div></li><li><div>          } elseif ($align == 'L' or $align == 'J')&nbsp;</div></li><li><div>              $dx = $this-&gt;cMarginL + $lcpaddingL;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $dx = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;ColorFlag)&nbsp;</div></li><li><div>              $s .='q ' . $this-&gt;TextColor . ' ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// OUTLINE</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;textparam['outline-s']) && $this-&gt;textparam['outline-s'] && !($textvar & FC_SMALLCAPS)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $s .=' ' . sprintf('%.3F w', $this-&gt;LineWidth * _MPDFK) . ' ';&nbsp;</div></li><li><div>              $s .=&quot; $this-&gt;DrawColor &quot;;&nbsp;</div></li><li><div>              $s .=&quot; 2 Tr &quot;;&nbsp;</div></li><li><div>          } elseif ($this-&gt;falseBoldWeight && strpos($this-&gt;ReqFontStyle, &quot;B&quot;) !== false && strpos($this-&gt;FontStyle, &quot;B&quot;) === false && !($textvar & FC_SMALLCAPS)) { // can't use together with OUTLINE or Small Caps    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    ??? why not with SmallCaps ???&nbsp;</div></li><li><div>              $s .= ' 2 Tr 1 J 1 j ';&nbsp;</div></li><li><div>              $s .= ' ' . sprintf('%.3F w', ($this-&gt;FontSize / 130) * _MPDFK * $this-&gt;falseBoldWeight) . ' ';&nbsp;</div></li><li><div>              $tc = strtoupper($this-&gt;TextColor); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// change 0 0 0 rg to 0 0 0 RG</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($this-&gt;FillColor != $tc) {&nbsp;</div></li><li><div>                  $s .= ' ' . $tc . ' ';&nbsp;</div></li><li><div>              }  <span class="comment"><span class="comment">// stroke (outline) = same colour as text(fill)</span></span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $s .=&quot; 0 Tr &quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (strpos($this-&gt;ReqFontStyle, &quot;I&quot;) !== false && strpos($this-&gt;FontStyle, &quot;I&quot;) === false) { <span class="comment"><span class="comment"><span class="comment">// Artificial italic</span></span></span>&nbsp;</div></li><li><div>              $aix = '1 0 0.261799 1 %.3F %.3F Tm ';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $aix = '%.3F %.3F Td ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $px = ($this-&gt;x + $dx) * _MPDFK;&nbsp;</div></li><li><div>          $py = ($this-&gt;h - ($this-&gt;y + $glyphYorigin - $baseline_shift)) * _MPDFK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// THE TEXT</span>&nbsp;</div></li><li><div>          $txt2 = $txt;&nbsp;</div></li><li><div>          $sub = '';&nbsp;</div></li><li><div>          $this-&gt;CurrentFont['used'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**             * ************** SIMILAR TO Text() ************************ */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// IF corefonts AND NOT SmCaps AND NOT Kerning</span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Just output text</span></span></span>; charspacing and wordspacing already set by charspacing (Tc) and ws (Tw)&nbsp;</div></li><li><div>          if ($this-&gt;usingCoreFont && !($textvar & FC_SMALLCAPS) && !($textvar & FC_KERNING)) {&nbsp;</div></li><li><div>              $txt2 = $this-&gt;_escape($txt2);&nbsp;</div></li><li><div>              $sub .=sprintf('BT ' . $aix . ' (%s) Tj ET', $px, $py, $txt2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// IF NOT corefonts AND NO wordspacing AND NOT SIP/SMP AND NOT SmCaps AND NOT Kerning AND NOT OTL</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Just output text</span></span></span>&nbsp;</div></li><li><div>          elseif (!$this-&gt;usingCoreFont && !$this-&gt;ws && !($textvar & FC_SMALLCAPS) && !($textvar & FC_KERNING) && !(isset($this-&gt;CurrentFont['useOTL']) && ($this-&gt;CurrentFont['useOTL'] & 0xFF) && !empty($OTLdata['GPOSinfo']))) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// IF SIP/SMP</span></span>&nbsp;</div></li><li><div>              if ((isset($this-&gt;CurrentFont['sip']) && $this-&gt;CurrentFont['sip']) || (isset($this-&gt;CurrentFont['smp']) && $this-&gt;CurrentFont['smp'])) {&nbsp;</div></li><li><div>                  $txt2 = $this-&gt;UTF8toSubset($txt2);&nbsp;</div></li><li><div>                  $sub .=sprintf('BT ' . $aix . ' %s Tj ET', $px, $py, $txt2);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// NOT SIP/SMP</span></span>&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $txt2 = $this-&gt;UTF8ToUTF16BE($txt2, false);&nbsp;</div></li><li><div>                  $txt2 = $this-&gt;_escape($txt2);&nbsp;</div></li><li><div>                  $sub .=sprintf('BT ' . $aix . ' (%s) Tj ET', $px, $py, $txt2);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// IF NOT corefonts AND IS wordspacing AND NOT SIP AND NOT SmCaps AND NOT Kerning AND NOT OTL</span>&nbsp;</div></li><li><div>          <span class="comment">// Output text word by word with an adjustment to the intercharacter spacing for SPACEs to form word spacing</span>&nbsp;</div></li><li><div>          <span class="comment">// IF multibyte - Tw has no effect - need to do word spacing using an adjustment before each space</span>&nbsp;</div></li><li><div>          elseif (!$this-&gt;usingCoreFont && $this-&gt;ws && !((isset($this-&gt;CurrentFont['sip']) && $this-&gt;CurrentFont['sip']) || (isset($this-&gt;CurrentFont['smp']) && $this-&gt;CurrentFont['smp'])) && !($textvar & FC_SMALLCAPS) && !($textvar & FC_KERNING) && !(isset($this-&gt;CurrentFont['useOTL']) && ($this-&gt;CurrentFont['useOTL'] & 0xFF) && (!empty($OTLdata['GPOSinfo']) || (strpos($OTLdata['group'], 'M') !== false && $this-&gt;charspacing)) )) {&nbsp;</div></li><li><div>              $space = &quot; &quot;;&nbsp;</div></li><li><div>              $space = $this-&gt;UTF8ToUTF16BE($space, false);&nbsp;</div></li><li><div>              $space = $this-&gt;_escape($space);&nbsp;</div></li><li><div>              $sub .=sprintf('BT ' . $aix . ' %.3F Tc [', $px, $py, $this-&gt;charspacing);&nbsp;</div></li><li><div>              $t = explode(' ', $txt2);&nbsp;</div></li><li><div>              $numt = count($t);&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; $numt; $i++) {&nbsp;</div></li><li><div>                  $tx = $t[$i];&nbsp;</div></li><li><div>                  $tx = $this-&gt;UTF8ToUTF16BE($tx, false);&nbsp;</div></li><li><div>                  $tx = $this-&gt;_escape($tx);&nbsp;</div></li><li><div>                  $sub .=sprintf('(%s) ', $tx);&nbsp;</div></li><li><div>                  if (($i + 1) &lt; $numt) {&nbsp;</div></li><li><div>                      $adj = -($this-&gt;ws) * 1000 / $this-&gt;FontSizePt;&nbsp;</div></li><li><div>                      $sub .=sprintf('%d(%s) ', $adj, $space);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $sub .='] TJ ';&nbsp;</div></li><li><div>              $sub .=' ET';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// ELSE (IF SmCaps || Kerning || OTL) [corefonts or not corefonts; SIP or SMP or BMP]</span></span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $sub = $this-&gt;applyGPOSpdf($txt, $aix, $px, $py, $OTLdata, $textvar);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**             * ************** END SIMILAR TO Text() ************************ */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;shrin_k &gt; 1) {&nbsp;</div></li><li><div>              $shrin_k = $this-&gt;shrin_k;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $shrin_k = 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// UNDERLINE</span>&nbsp;</div></li><li><div>          if ($textvar & FD_UNDERLINE) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              $c = $this-&gt;textparam['u-decoration']['color'];&nbsp;</div></li><li><div>              if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>                  $sub .= ' ' . $c . ' ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              $decorationfontkey = $this-&gt;textparam['u-decoration']['fontkey'];&nbsp;</div></li><li><div>              $decorationfontsize = $this-&gt;textparam['u-decoration']['fontsize'] / $shrin_k;&nbsp;</div></li><li><div>              if (isset($this-&gt;fonts[$decorationfontkey]['ut']) && $this-&gt;fonts[$decorationfontkey]['ut']) {&nbsp;</div></li><li><div>                  $ut = $this-&gt;fonts[$decorationfontkey]['ut'] / 1000 * $decorationfontsize;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $ut = 60 / 1000 * $decorationfontsize;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($this-&gt;fonts[$decorationfontkey]['up']) && $this-&gt;fonts[$decorationfontkey]['up']) {&nbsp;</div></li><li><div>                  $up = $this-&gt;fonts[$decorationfontkey]['up'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $up = -100;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $adjusty = (-$up / 1000 * $decorationfontsize) + $ut / 2;&nbsp;</div></li><li><div>              $ubaseline = $glyphYorigin - $this-&gt;textparam['u-decoration']['baseline'] / $shrin_k;&nbsp;</div></li><li><div>              $olw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>              $sub .=' ' . (sprintf(' %.3F w 0 j 0 J ', $ut * _MPDFK));&nbsp;</div></li><li><div>              $sub .=' ' . $this-&gt;_dounderline($this-&gt;x + $dx, $this-&gt;y + $ubaseline + $adjusty, $txt, $OTLdata, $textvar);&nbsp;</div></li><li><div>              $sub .=' ' . (sprintf(' %.3F w 2 j 2 J ', $olw * _MPDFK));&nbsp;</div></li><li><div>              if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>                  $sub .= ' ' . $this-&gt;FillColor . ' ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// STRIKETHROUGH</span></span>&nbsp;</div></li><li><div>          if ($textvar & FD_LINETHROUGH) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              $c = $this-&gt;textparam['s-decoration']['color'];&nbsp;</div></li><li><div>              if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>                  $sub .= ' ' . $c . ' ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              $decorationfontkey = $this-&gt;textparam['s-decoration']['fontkey'];&nbsp;</div></li><li><div>              $decorationfontsize = $this-&gt;textparam['s-decoration']['fontsize'] / $shrin_k;&nbsp;</div></li><li><div>              <span class="comment">// Use yStrikeoutSize from OS/2 if available</span>&nbsp;</div></li><li><div>              if (isset($this-&gt;fonts[$decorationfontkey]['strs']) && $this-&gt;fonts[$decorationfontkey]['strs']) {&nbsp;</div></li><li><div>                  $ut = $this-&gt;fonts[$decorationfontkey]['strs'] / 1000 * $decorationfontsize;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// else use underlineThickness from post if available</span>&nbsp;</div></li><li><div>              elseif (isset($this-&gt;fonts[$decorationfontkey]['ut']) && $this-&gt;fonts[$decorationfontkey]['ut']) {&nbsp;</div></li><li><div>                  $ut = $this-&gt;fonts[$decorationfontkey]['ut'] / 1000 * $decorationfontsize;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $ut = 50 / 1000 * $decorationfontsize;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// Use yStrikeoutPosition from OS/2 if available</span>&nbsp;</div></li><li><div>              if (isset($this-&gt;fonts[$decorationfontkey]['strp']) && $this-&gt;fonts[$decorationfontkey]['strp']) {&nbsp;</div></li><li><div>                  $up = $this-&gt;fonts[$decorationfontkey]['strp'];&nbsp;</div></li><li><div>                  $adjusty = (-$up / 1000 * $decorationfontsize);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// else use a fraction ($this-&gt;baselineS) of CapHeight</span>&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  if (isset($this-&gt;fonts[$decorationfontkey]['desc']['CapHeight']) && $this-&gt;fonts[$decorationfontkey]['desc']['CapHeight']) {&nbsp;</div></li><li><div>                      $ch = $this-&gt;fonts[$decorationfontkey]['desc']['CapHeight'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $ch = 700;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $adjusty = (-$ch / 1000 * $decorationfontsize) * $this-&gt;baselineS;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sbaseline = $glyphYorigin - $this-&gt;textparam['s-decoration']['baseline'] / $shrin_k;&nbsp;</div></li><li><div>              $olw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>              $sub .=' ' . (sprintf(' %.3F w 0 j 0 J ', $ut * _MPDFK));&nbsp;</div></li><li><div>              $sub .=' ' . $this-&gt;_dounderline($this-&gt;x + $dx, $this-&gt;y + $sbaseline + $adjusty, $txt, $OTLdata, $textvar);&nbsp;</div></li><li><div>              $sub .=' ' . (sprintf(' %.3F w 2 j 2 J ', $olw * _MPDFK));&nbsp;</div></li><li><div>              if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>                  $sub .= ' ' . $this-&gt;FillColor . ' ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>          <span class="comment">// OVERLINE</span>&nbsp;</div></li><li><div>          if ($textvar & FD_OVERLINE) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              $c = $this-&gt;textparam['o-decoration']['color'];&nbsp;</div></li><li><div>              if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>                  $sub .= ' ' . $c . ' ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              $decorationfontkey = $this-&gt;textparam['o-decoration']['fontkey'] / $shrin_k;&nbsp;</div></li><li><div>              $decorationfontsize = $this-&gt;textparam['o-decoration']['fontsize'];&nbsp;</div></li><li><div>              if (isset($this-&gt;fonts[$decorationfontkey]['ut']) && $this-&gt;fonts[$decorationfontkey]['ut']) {&nbsp;</div></li><li><div>                  $ut = $this-&gt;fonts[$decorationfontkey]['ut'] / 1000 * $decorationfontsize;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $ut = 60 / 1000 * $decorationfontsize;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($this-&gt;fonts[$decorationfontkey]['desc']['CapHeight']) && $this-&gt;fonts[$decorationfontkey]['desc']['CapHeight']) {&nbsp;</div></li><li><div>                  $ch = $this-&gt;fonts[$decorationfontkey]['desc']['CapHeight'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $ch = 700;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $adjusty = (-$ch / 1000 * $decorationfontsize) * $this-&gt;baselineO;&nbsp;</div></li><li><div>              $obaseline = $glyphYorigin - $this-&gt;textparam['o-decoration']['baseline'] / $shrin_k;&nbsp;</div></li><li><div>              $olw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>              $sub .=' ' . (sprintf(' %.3F w 0 j 0 J ', $ut * _MPDFK));&nbsp;</div></li><li><div>              $sub .=' ' . $this-&gt;_dounderline($this-&gt;x + $dx, $this-&gt;y + $obaseline + $adjusty, $txt, $OTLdata, $textvar);&nbsp;</div></li><li><div>              $sub .=' ' . (sprintf(' %.3F w 2 j 2 J ', $olw * _MPDFK));&nbsp;</div></li><li><div>              if ($this-&gt;FillColor != $c) {&nbsp;</div></li><li><div>                  $sub .= ' ' . $this-&gt;FillColor . ' ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// TEXT</span> SHADOW</span>&nbsp;</div></li><li><div>          if ($this-&gt;textshadow) {  <span class="comment">// First to process is last in CSS comma separated shadows</span>&nbsp;</div></li><li><div>              foreach ($this-&gt;textshadow AS $ts) {&nbsp;</div></li><li><div>                  $s .= ' q ';&nbsp;</div></li><li><div>                  $s .= $this-&gt;SetTColor($ts['col'], true) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  if ($ts['col']{0} == 5 && ord($ts['col']{4}) &lt; 100) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                      $s .= $this-&gt;SetAlpha(ord($ts['col']{4}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>                  } elseif ($ts['col']{0} == 6 && ord($ts['col']{5}) &lt; 100) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                      $s .= $this-&gt;SetAlpha(ord($ts['col']{5}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>                  } elseif ($ts['col']{0} == 1 && $ts['col']{2} == 1 && ord($ts['col']{3}) &lt; 100) { <span class="comment"><span class="comment">// Gray</span></span>&nbsp;</div></li><li><div>                      $s .= $this-&gt;SetAlpha(ord($ts['col']{3}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $s .= sprintf(' 1 0 0 1 %.4F %.4F cm', $ts['x'] * _MPDFK, -$ts['y'] * _MPDFK) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  $s .= $sub;&nbsp;</div></li><li><div>                  $s .= ' Q ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $s .= $sub;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// COLOR</span>&nbsp;</div></li><li><div>          if ($this-&gt;ColorFlag)&nbsp;</div></li><li><div>              $s .=' Q';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// LINK</span></span>&nbsp;</div></li><li><div>          if ($link != '') {&nbsp;</div></li><li><div>              $this-&gt;Link($this-&gt;x, $boxtop, $w, $boxheight, $link);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($s)&nbsp;</div></li><li><div>          $this-&gt;_out($s);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;ws && !$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('BT %.3F Tc ET', $this-&gt;charspacing));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;lasth = $h;&nbsp;</div></li><li><div>      if (strpos($txt, &quot;\n&quot;) !== false)&nbsp;</div></li><li><div>          $ln = 1; <span class="comment">// cell recognizes \n from &lt;BR&gt; tag</span>&nbsp;</div></li><li><div>      if ($ln &gt; 0) {&nbsp;</div></li><li><div>          <span class="comment">//Go to next line</span>&nbsp;</div></li><li><div>          $this-&gt;y += $h;&nbsp;</div></li><li><div>          if ($ln == 1) {&nbsp;</div></li><li><div>              <span class="comment">//Move to next line</span>&nbsp;</div></li><li><div>              if ($currentx != 0) {&nbsp;</div></li><li><div>                  $this-&gt;x = $currentx;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else&nbsp;</div></li><li><div>          $this-&gt;x+=$w;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function applyGPOSpdf($txt, $aix, $x, $y, $OTLdata, $textvar = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Generate PDF string</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>&nbsp;</div></li><li><div>      if ((isset($this-&gt;CurrentFont['sip']) && $this-&gt;CurrentFont['sip']) || (isset($this-&gt;CurrentFont['smp']) && $this-&gt;CurrentFont['smp'])) {&nbsp;</div></li><li><div>          $sipset = true;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $sipset = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($textvar & FC_SMALLCAPS) {&nbsp;</div></li><li><div>          $smcaps = true;&nbsp;</div></li><li><div>      } <span class="comment">// IF SmallCaps using transformation, NOT OTL</span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $smcaps = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($sipset) {&nbsp;</div></li><li><div>          $fontid = $last_fontid = $original_fontid = $this-&gt;CurrentFont['subsetfontids'][0];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $fontid = $last_fontid = $original_fontid = $this-&gt;CurrentFont['i'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $SmallCapsON = false;  <span class="comment"><span class="comment">// state: uppercase/not</span></span>&nbsp;</div></li><li><div>      $lastSmallCapsON = false; <span class="comment"><span class="comment">// state: uppercase/not</span></span>&nbsp;</div></li><li><div>      $last_fontsize = $fontsize = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>      $last_fontstretch = $fontstretch = 100;&nbsp;</div></li><li><div>      $groupBreak = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $unicode = $this-&gt;UTF8StringToArray($txt);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $GPOSinfo = (isset($OTLdata['GPOSinfo']) ? $OTLdata['GPOSinfo'] : array());&nbsp;</div></li><li><div>      $charspacing = ($this-&gt;charspacing * 1000 / $this-&gt;FontSizePt);&nbsp;</div></li><li><div>      $wordspacing = ($this-&gt;ws * 1000 / $this-&gt;FontSizePt);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $XshiftBefore = 0;&nbsp;</div></li><li><div>      $XshiftAfter = 0;&nbsp;</div></li><li><div>      $lastYPlacement = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($sipset) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  DELETED ********&nbsp;</div></li><li><div>          <span class="comment">//        $txt= preg_replace('/'.preg_quote($this-&gt;aliasNbPg, '/').'/', chr(7), $txt);    // ? Need to adjust OTL info</span>&nbsp;</div></li><li><div>          <span class="comment">//        $txt= preg_replace('/'.preg_quote($this-&gt;aliasNbPgGp, '/').'/', chr(8), $txt);    // ? Need to adjust OTL info</span>&nbsp;</div></li><li><div>          $tj = '&lt;';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tj = '(';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; count($unicode); $i++) {&nbsp;</div></li><li><div>          $c = $unicode[$i];&nbsp;</div></li><li><div>          $tx = '';&nbsp;</div></li><li><div>          $XshiftBefore = $XshiftAfter;&nbsp;</div></li><li><div>          $XshiftAfter = 0;&nbsp;</div></li><li><div>          $YPlacement = 0;&nbsp;</div></li><li><div>          $groupBreak = false;&nbsp;</div></li><li><div>          $kashida = 0;&nbsp;</div></li><li><div>          if (!empty($OTLdata)) {&nbsp;</div></li><li><div>              <span class="comment">// YPlacement from GPOS</span>&nbsp;</div></li><li><div>              if (isset($GPOSinfo[$i]['YPlacement']) && $GPOSinfo[$i]['YPlacement']) {&nbsp;</div></li><li><div>                  $YPlacement = $GPOSinfo[$i]['YPlacement'] * $this-&gt;FontSizePt / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                  $groupBreak = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// XPlacement from GPOS</span>&nbsp;</div></li><li><div>              if (isset($GPOSinfo[$i]['XPlacement']) && $GPOSinfo[$i]['XPlacement']) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (!isset($GPOSinfo[$i]['wDir']) || $GPOSinfo[$i]['wDir'] != 'RTL') {&nbsp;</div></li><li><div>                      if (isset($GPOSinfo[$i]['BaseWidth'])) {&nbsp;</div></li><li><div>                          $GPOSinfo[$i]['XPlacement'] -= $GPOSinfo[$i]['BaseWidth'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Convert to PDF Text space (thousandths of a unit );</span>&nbsp;</div></li><li><div>                  $XshiftBefore += $GPOSinfo[$i]['XPlacement'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                  $XshiftAfter += -$GPOSinfo[$i]['XPlacement'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// Kashida</span> from GPOS</span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Kashida</span> is set as an absolute length value, but to adjust text needs to be converted to</span>&nbsp;</div></li><li><div>              <span class="comment">// font-related size</span>&nbsp;</div></li><li><div>              if (isset($GPOSinfo[$i]['kashida_space']) && $GPOSinfo[$i]['kashida_space']) {&nbsp;</div></li><li><div>                  $kashida = $GPOSinfo[$i]['kashida_space'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($c == 32) { <span class="comment">// word spacing</span>&nbsp;</div></li><li><div>                  $XshiftAfter += $wordspacing;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (substr($OTLdata['group'], ($i + 1), 1) != 'M') { <span class="comment">// Don't add inter-character spacing before Marks</span>&nbsp;</div></li><li><div>                  $XshiftAfter += $charspacing;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// ...applyGPOSpdf...</span>&nbsp;</div></li><li><div>              <span class="comment">// XAdvance from GPOS - Convert to PDF Text space (thousandths of a unit );</span>&nbsp;</div></li><li><div>              if (((isset($GPOSinfo[$i]['wDir']) && $GPOSinfo[$i]['wDir'] != 'RTL') || !isset($GPOSinfo[$i]['wDir'])) && isset($GPOSinfo[$i]['XAdvanceL']) && $GPOSinfo[$i]['XAdvanceL']) {&nbsp;</div></li><li><div>                  $XshiftAfter += $GPOSinfo[$i]['XAdvanceL'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>              } elseif (isset($GPOSinfo[$i]['wDir']) && $GPOSinfo[$i]['wDir'] == 'RTL' && isset($GPOSinfo[$i]['XAdvanceR']) && $GPOSinfo[$i]['XAdvanceR']) {&nbsp;</div></li><li><div>                  $XshiftAfter += $GPOSinfo[$i]['XAdvanceR'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Character & Word spacing - if NOT OTL</span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $XshiftAfter += $charspacing;&nbsp;</div></li><li><div>              if ($c == 32) {&nbsp;</div></li><li><div>                  $XshiftAfter += $wordspacing;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// IF Kerning done using pairs rather than OTL</span>&nbsp;</div></li><li><div>          if ($textvar & FC_KERNING) {&nbsp;</div></li><li><div>              if ($i &gt; 0 && isset($this-&gt;CurrentFont['kerninfo'][$unicode[($i - 1)]][$unicode[$i]])) {&nbsp;</div></li><li><div>                  $XshiftBefore += $this-&gt;CurrentFont['kerninfo'][$unicode[($i - 1)]][$unicode[$i]];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($YPlacement != $lastYPlacement) {&nbsp;</div></li><li><div>              $groupBreak = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($XshiftBefore) {  <span class="comment">// +ve value in PDF moves to the left</span>&nbsp;</div></li><li><div>              <span class="comment">// If Fontstretch is ongoing, need to adjust X adjustments because these will be stretched out.</span>&nbsp;</div></li><li><div>              $XshiftBefore *= 100 / $last_fontstretch;&nbsp;</div></li><li><div>              if ($sipset) {&nbsp;</div></li><li><div>                  $tj .= sprintf('&gt;%d&lt;', (-$XshiftBefore));&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $tj .= sprintf(')%d(', (-$XshiftBefore));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Small-Caps</span>&nbsp;</div></li><li><div>          if ($smcaps) {&nbsp;</div></li><li><div>              if (isset($this-&gt;upperCase[$c])) {&nbsp;</div></li><li><div>                  $c = $this-&gt;upperCase[$c];&nbsp;</div></li><li><div>                  <span class="comment">//$this-&gt;CurrentFont['subset'][$this-&gt;upperCase[$c]] = $this-&gt;upperCase[$c];    // add the CAP to subset</span>&nbsp;</div></li><li><div>                  $SmallCapsON = true;&nbsp;</div></li><li><div>                  <span class="comment">// For $sipset</span>&nbsp;</div></li><li><div>                  if (!$lastSmallCapsON) {   <span class="comment">// Turn ON SmallCaps</span>&nbsp;</div></li><li><div>                      $groupBreak = true;&nbsp;</div></li><li><div>                      $fontstretch = $this-&gt;smCapsStretch;&nbsp;</div></li><li><div>                      $fontsize = $this-&gt;FontSizePt * $this-&gt;smCapsScale;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $SmallCapsON = false;&nbsp;</div></li><li><div>                  if ($lastSmallCapsON) {  <span class="comment">// Turn OFF SmallCaps</span>&nbsp;</div></li><li><div>                      $groupBreak = true;&nbsp;</div></li><li><div>                      $fontstretch = 100;&nbsp;</div></li><li><div>                      $fontsize = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Prepare Text and Select Font ID</span></span>&nbsp;</div></li><li><div>          if ($sipset) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  DELETED ********&nbsp;</div></li><li><div>              <span class="comment">//if ($c == 7 || $c == 8) {</span>&nbsp;</div></li><li><div>              <span class="comment">//    if ($original_fontid != $last_fontid) {</span>&nbsp;</div></li><li><div>              <span class="comment">//        $groupBreak = true;</span>&nbsp;</div></li><li><div>              <span class="comment">//        $fontid = $original_fontid;</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">//    }</span></span></span>&nbsp;</div></li><li><div>              <span class="comment">//    if ($c == 7) { $tj .= $this-&gt;aliasNbPgHex; }</span>&nbsp;</div></li><li><div>              <span class="comment">//    else { $tj .= $this-&gt;aliasNbPgGpHex; }</span>&nbsp;</div></li><li><div>              <span class="comment">//    continue;</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//}</span></span>&nbsp;</div></li><li><div>              for ($j = 0; $j &lt; 99; $j++) {&nbsp;</div></li><li><div>                  $init = array_search($c, $this-&gt;CurrentFont['subsets'][$j]);&nbsp;</div></li><li><div>                  if ($init !== false) {&nbsp;</div></li><li><div>                      if ($this-&gt;CurrentFont['subsetfontids'][$j] != $last_fontid) {&nbsp;</div></li><li><div>                          $groupBreak = true;&nbsp;</div></li><li><div>                          $fontid = $this-&gt;CurrentFont['subsetfontids'][$j];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $tx = sprintf(&quot;%02s&quot;, strtoupper(dechex($init)));&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  } elseif (count($this-&gt;CurrentFont['subsets'][$j]) &lt; 255) {&nbsp;</div></li><li><div>                      $n = count($this-&gt;CurrentFont['subsets'][$j]);&nbsp;</div></li><li><div>                      $this-&gt;CurrentFont['subsets'][$j][$n] = $c;&nbsp;</div></li><li><div>                      if ($this-&gt;CurrentFont['subsetfontids'][$j] != $last_fontid) {&nbsp;</div></li><li><div>                          $groupBreak = true;&nbsp;</div></li><li><div>                          $fontid = $this-&gt;CurrentFont['subsetfontids'][$j];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $tx = sprintf(&quot;%02s&quot;, strtoupper(dechex($n)));&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  } elseif (!isset($this-&gt;CurrentFont['subsets'][($j + 1)])) {&nbsp;</div></li><li><div>                      $this-&gt;CurrentFont['subsets'][($j + 1)] = array(0 =&gt; 0);&nbsp;</div></li><li><div>                      $this-&gt;CurrentFont['subsetfontids'][($j + 1)] = count($this-&gt;fonts) + $this-&gt;extraFontSubsets + 1;&nbsp;</div></li><li><div>                      $this-&gt;extraFontSubsets++;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $tx = code2utf($c);&nbsp;</div></li><li><div>              if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                  $tx = utf8_decode($tx);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $tx = $this-&gt;UTF8ToUTF16BE($tx, false);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $tx = $this-&gt;_escape($tx);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If any settings require a new Text Group</span>&nbsp;</div></li><li><div>          if ($groupBreak || $fontstretch != $last_fontstretch) {&nbsp;</div></li><li><div>              if ($sipset) {&nbsp;</div></li><li><div>                  $tj .= '&gt;] TJ ';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $tj .= ')] TJ ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($fontid != $last_fontid || $fontsize != $last_fontsize) {&nbsp;</div></li><li><div>                  $tj .= sprintf(' /F%d %.3F Tf ', $fontid, $fontsize);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($fontstretch != $last_fontstretch) {&nbsp;</div></li><li><div>                  $tj .= sprintf('%d Tz ', $fontstretch);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($YPlacement != $lastYPlacement) {&nbsp;</div></li><li><div>                  $tj .= sprintf('%.3F Ts ', $YPlacement);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($sipset) {&nbsp;</div></li><li><div>                  $tj .= '[&lt;';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $tj .= '[(';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Output the code for the txt character</span>&nbsp;</div></li><li><div>          $tj .= $tx;&nbsp;</div></li><li><div>          $lastSmallCapsON = $SmallCapsON;&nbsp;</div></li><li><div>          $last_fontid = $fontid;&nbsp;</div></li><li><div>          $last_fontsize = $fontsize;&nbsp;</div></li><li><div>          $last_fontstretch = $fontstretch;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Kashida</span>&nbsp;</div></li><li><div>          if ($kashida) {&nbsp;</div></li><li><div>              $c = 0x0640; <span class="comment">// add the Tatweel U+0640</span>&nbsp;</div></li><li><div>              if (isset($this-&gt;CurrentFont['subset'])) {&nbsp;</div></li><li><div>                  $this-&gt;CurrentFont['subset'][$c] = $c;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $kashida *= 1000 / $this-&gt;FontSizePt;&nbsp;</div></li><li><div>              $tatw = $this-&gt;_getCharWidth($this-&gt;CurrentFont['cw'], 0x0640);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Get YPlacement from next Base character</span>&nbsp;</div></li><li><div>              $nextbase = $i + 1;&nbsp;</div></li><li><div>              while ($OTLdata['group']{$nextbase} != 'C') {&nbsp;</div></li><li><div>                  $nextbase++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($GPOSinfo[$nextbase]) && isset($GPOSinfo[$nextbase]['YPlacement']) && $GPOSinfo[$nextbase]['YPlacement']) {&nbsp;</div></li><li><div>                  $YPlacement = $GPOSinfo[$nextbase]['YPlacement'] * $this-&gt;FontSizePt / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Prepare Text and Select Font ID</span></span>&nbsp;</div></li><li><div>              if ($sipset) {&nbsp;</div></li><li><div>                  for ($j = 0; $j &lt; 99; $j++) {&nbsp;</div></li><li><div>                      $init = array_search($c, $this-&gt;CurrentFont['subsets'][$j]);&nbsp;</div></li><li><div>                      if ($init !== false) {&nbsp;</div></li><li><div>                          if ($this-&gt;CurrentFont['subsetfontids'][$j] != $last_fontid) {&nbsp;</div></li><li><div>                              $fontid = $this-&gt;CurrentFont['subsetfontids'][$j];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $tx = sprintf(&quot;%02s&quot;, strtoupper(dechex($init)));&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      } elseif (count($this-&gt;CurrentFont['subsets'][$j]) &lt; 255) {&nbsp;</div></li><li><div>                          $n = count($this-&gt;CurrentFont['subsets'][$j]);&nbsp;</div></li><li><div>                          $this-&gt;CurrentFont['subsets'][$j][$n] = $c;&nbsp;</div></li><li><div>                          if ($this-&gt;CurrentFont['subsetfontids'][$j] != $last_fontid) {&nbsp;</div></li><li><div>                              $fontid = $this-&gt;CurrentFont['subsetfontids'][$j];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $tx = sprintf(&quot;%02s&quot;, strtoupper(dechex($n)));&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      } elseif (!isset($this-&gt;CurrentFont['subsets'][($j + 1)])) {&nbsp;</div></li><li><div>                          $this-&gt;CurrentFont['subsets'][($j + 1)] = array(0 =&gt; 0);&nbsp;</div></li><li><div>                          $this-&gt;CurrentFont['subsetfontids'][($j + 1)] = count($this-&gt;fonts) + $this-&gt;extraFontSubsets + 1;&nbsp;</div></li><li><div>                          $this-&gt;extraFontSubsets++;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $tx = code2utf($c);&nbsp;</div></li><li><div>                  $tx = $this-&gt;UTF8ToUTF16BE($tx, false);&nbsp;</div></li><li><div>                  $tx = $this-&gt;_escape($tx);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($kashida &gt; $tatw) {&nbsp;</div></li><li><div>                  <span class="comment">// Insert multiple tatweel characters, repositioning the last one to give correct total length</span>&nbsp;</div></li><li><div>                  $fontstretch = 100;&nbsp;</div></li><li><div>                  $nt = intval($kashida / $tatw);&nbsp;</div></li><li><div>                  $nudgeback = (($nt + 1) * $tatw) - $kashida;&nbsp;</div></li><li><div>                  $optx = str_repeat($tx, $nt);&nbsp;</div></li><li><div>                  if ($sipset) {&nbsp;</div></li><li><div>                      $optx .= sprintf('&gt;%d&lt;', ($nudgeback));&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $optx .= sprintf(')%d(', ($nudgeback));&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $optx .= $tx; <span class="comment">// #last</span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment">// Insert single tatweel character and use fontstretch to get correct length</span>&nbsp;</div></li><li><div>                  $fontstretch = ($kashida / $tatw) * 100;&nbsp;</div></li><li><div>                  $optx = $tx;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($sipset) {&nbsp;</div></li><li><div>                  $tj .= '&gt;] TJ ';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $tj .= ')] TJ ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($fontid != $last_fontid || $fontsize != $last_fontsize) {&nbsp;</div></li><li><div>                  $tj .= sprintf(' /F%d %.3F Tf ', $fontid, $fontsize);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($fontstretch != $last_fontstretch) {&nbsp;</div></li><li><div>                  $tj .= sprintf('%d Tz ', $fontstretch);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $tj .= sprintf('%.3F Ts ', $YPlacement);&nbsp;</div></li><li><div>              if ($sipset) {&nbsp;</div></li><li><div>                  $tj .= '[&lt;';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $tj .= '[(';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Output the code for the txt character</span>(s)&nbsp;</div></li><li><div>              $tj .= $optx;&nbsp;</div></li><li><div>              $last_fontid = $fontid;&nbsp;</div></li><li><div>              $last_fontstretch = $fontstretch;&nbsp;</div></li><li><div>              $fontstretch = 100;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lastYPlacement = $YPlacement;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Finish up</span>&nbsp;</div></li><li><div>      if ($sipset) {&nbsp;</div></li><li><div>          $tj .= '&gt;';&nbsp;</div></li><li><div>          if ($XshiftAfter) {&nbsp;</div></li><li><div>              $tj .= sprintf('%d', (-$XshiftAfter));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($last_fontid != $original_fontid) {&nbsp;</div></li><li><div>              $tj .= '] TJ ';&nbsp;</div></li><li><div>              $tj .= sprintf(' /F%d %.3F Tf ', $original_fontid, $fontsize);&nbsp;</div></li><li><div>              $tj .= '[';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $tj = preg_replace('/([^\\\])&lt;&gt;/', '\\1 ', $tj);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tj .= ')';&nbsp;</div></li><li><div>          if ($XshiftAfter) {&nbsp;</div></li><li><div>              $tj .= sprintf('%d', (-$XshiftAfter));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($last_fontid != $original_fontid) {&nbsp;</div></li><li><div>              $tj .= '] TJ ';&nbsp;</div></li><li><div>              $tj .= sprintf(' /F%d %.3F Tf ', $original_fontid, $fontsize);&nbsp;</div></li><li><div>              $tj .= '[';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $tj = preg_replace('/([^\\\])\(\)/', '\\1 ', $tj);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s = sprintf(' BT ' . $aix . ' 0 Tc 0 Tw [%s] TJ ET ', $x, $y, $tj);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//echo $s.&quot;\n\n&quot;; // exit;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _kern($txt, $mode, $aix, $x, $y)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($mode == 'MBTw') { <span class="comment">// Multibyte requiring word spacing</span>&nbsp;</div></li><li><div>          $space = ' ';&nbsp;</div></li><li><div>          <span class="comment">//Convert string to UTF-16BE without BOM</span>&nbsp;</div></li><li><div>          $space = $this-&gt;UTF8ToUTF16BE($space, false);&nbsp;</div></li><li><div>          $space = $this-&gt;_escape($space);&nbsp;</div></li><li><div>          $s = sprintf(' BT ' . $aix, $x * _MPDFK, ($this-&gt;h - $y) * _MPDFK);&nbsp;</div></li><li><div>          $t = explode(' ', $txt);&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; count($t); $i++) {&nbsp;</div></li><li><div>              $tx = $t[$i];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $tj = '(';&nbsp;</div></li><li><div>              $unicode = $this-&gt;UTF8StringToArray($tx);&nbsp;</div></li><li><div>              for ($ti = 0; $ti &lt; count($unicode); $ti++) {&nbsp;</div></li><li><div>                  if ($ti &gt; 0 && isset($this-&gt;CurrentFont['kerninfo'][$unicode[($ti - 1)]][$unicode[$ti]])) {&nbsp;</div></li><li><div>                      $kern = -$this-&gt;CurrentFont['kerninfo'][$unicode[($ti - 1)]][$unicode[$ti]];&nbsp;</div></li><li><div>                      $tj .= sprintf(')%d(', $kern);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $tc = code2utf($unicode[$ti]);&nbsp;</div></li><li><div>                  $tc = $this-&gt;UTF8ToUTF16BE($tc, false);&nbsp;</div></li><li><div>                  $tj .= $this-&gt;_escape($tc);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $tj .= ')';&nbsp;</div></li><li><div>              $s.=sprintf(' %.3F Tc [%s] TJ', $this-&gt;charspacing, $tj);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (($i + 1) &lt; count($t)) {&nbsp;</div></li><li><div>                  $s.=sprintf(' %.3F Tc (%s) Tj', $this-&gt;ws + $this-&gt;charspacing, $space);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $s.=' ET ';&nbsp;</div></li><li><div>      } elseif (!$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $s = '';&nbsp;</div></li><li><div>          $tj = '(';&nbsp;</div></li><li><div>          $unicode = $this-&gt;UTF8StringToArray($txt);&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; count($unicode); $i++) {&nbsp;</div></li><li><div>              if ($i &gt; 0 && isset($this-&gt;CurrentFont['kerninfo'][$unicode[($i - 1)]][$unicode[$i]])) {&nbsp;</div></li><li><div>                  $kern = -$this-&gt;CurrentFont['kerninfo'][$unicode[($i - 1)]][$unicode[$i]];&nbsp;</div></li><li><div>                  $tj .= sprintf(')%d(', $kern);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $tx = code2utf($unicode[$i]);&nbsp;</div></li><li><div>              $tx = $this-&gt;UTF8ToUTF16BE($tx, false);&nbsp;</div></li><li><div>              $tj .= $this-&gt;_escape($tx);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $tj .= ')';&nbsp;</div></li><li><div>          $s.=sprintf(' BT ' . $aix . ' [%s] TJ ET ', $x * _MPDFK, ($this-&gt;h - $y) * _MPDFK, $tj);&nbsp;</div></li><li><div>      } else { <span class="comment">// CORE Font</span>&nbsp;</div></li><li><div>          $s = '';&nbsp;</div></li><li><div>          $tj = '(';&nbsp;</div></li><li><div>          $l = strlen($txt);&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $l; $i++) {&nbsp;</div></li><li><div>              if ($i &gt; 0 && isset($this-&gt;CurrentFont['kerninfo'][$txt[($i - 1)]][$txt[$i]])) {&nbsp;</div></li><li><div>                  $kern = -$this-&gt;CurrentFont['kerninfo'][$txt[($i - 1)]][$txt[$i]];&nbsp;</div></li><li><div>                  $tj .= sprintf(')%d(', $kern);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $tj .= $this-&gt;_escape($txt[$i]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $tj .= ')';&nbsp;</div></li><li><div>          $s.=sprintf(' BT ' . $aix . ' [%s] TJ ET ', $x * _MPDFK, ($this-&gt;h - $y) * _MPDFK, $tj);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function MultiCell($w, $h, $txt, $border = 0, $align = '', $fill = 0, $link = '', $directionality = 'ltr', $encoded = false, $OTLdata = false, $maxrows = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// maxrows is called from mpdfform-&gt;TEXTAREA</span>&nbsp;</div></li><li><div>      <span class="comment">// Parameter (pre-)encoded - When called internally from form::textarea - mb_encoding already done and OTL - but not reverse RTL</span>&nbsp;</div></li><li><div>      if (!$encoded) {&nbsp;</div></li><li><div>          $txt = $this-&gt;purify_utf8_text($txt);&nbsp;</div></li><li><div>          if ($this-&gt;text_input_as_HTML) {&nbsp;</div></li><li><div>              $txt = $this-&gt;all_entities_to_utf8($txt);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>              $txt = mb_convert_encoding($txt, $this-&gt;mb_enc, 'UTF-8');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (preg_match(&quot;/([&quot; . $this-&gt;pregRTLchars . &quot;])/u&quot;, $txt)) {&nbsp;</div></li><li><div>              $this-&gt;biDirectional = true;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $OTLdata = array();&nbsp;</div></li><li><div>          <span class="comment">// Use OTL OpenType Table Layout - GSUB</span> & GPOS&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>              $txt = $this-&gt;otl-&gt;applyOTL($txt, $this-&gt;CurrentFont['useOTL']);&nbsp;</div></li><li><div>              $OTLdata = $this-&gt;otl-&gt;OTLdata;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($directionality == 'rtl' || $this-&gt;biDirectional) {&nbsp;</div></li><li><div>              if (!isset($OTLdata)) {&nbsp;</div></li><li><div>                  $unicode = $this-&gt;UTF8StringToArray($txt, false);&nbsp;</div></li><li><div>                  $is_strong = false;&nbsp;</div></li><li><div>                  $this-&gt;getBasicOTLdata($OTLdata, $unicode, $is_strong);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$align) {&nbsp;</div></li><li><div>          $align = $this-&gt;defaultAlign;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Output text with automatic or explicit line breaks</span>&nbsp;</div></li><li><div>      $cw = &$this-&gt;CurrentFont['cw'];&nbsp;</div></li><li><div>      if ($w == 0)&nbsp;</div></li><li><div>          $w = $this-&gt;w - $this-&gt;rMargin - $this-&gt;x;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wmax = ($w - ($this-&gt;cMarginL + $this-&gt;cMarginR));&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $s = str_replace(&quot;\r&quot;, '', $txt);&nbsp;</div></li><li><div>          $nb = strlen($s);&nbsp;</div></li><li><div>          while ($nb &gt; 0 and $s[$nb - 1] == &quot;\n&quot;)&nbsp;</div></li><li><div>              $nb--;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $s = str_replace(&quot;\r&quot;, '', $txt);&nbsp;</div></li><li><div>          $nb = mb_strlen($s, $this-&gt;mb_enc);&nbsp;</div></li><li><div>          while ($nb &gt; 0 and mb_substr($s, $nb - 1, 1, $this-&gt;mb_enc) == &quot;\n&quot;)&nbsp;</div></li><li><div>              $nb--;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $b = 0;&nbsp;</div></li><li><div>      if ($border) {&nbsp;</div></li><li><div>          if ($border == 1) {&nbsp;</div></li><li><div>              $border = 'LTRB';&nbsp;</div></li><li><div>              $b = 'LRT';&nbsp;</div></li><li><div>              $b2 = 'LR';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $b2 = '';&nbsp;</div></li><li><div>              if (is_int(strpos($border, 'L')))&nbsp;</div></li><li><div>                  $b2.='L';&nbsp;</div></li><li><div>              if (is_int(strpos($border, 'R')))&nbsp;</div></li><li><div>                  $b2.='R';&nbsp;</div></li><li><div>              $b = is_int(strpos($border, 'T')) ? $b2 . 'T' : $b2;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $sep = -1;&nbsp;</div></li><li><div>      $i = 0;&nbsp;</div></li><li><div>      $j = 0;&nbsp;</div></li><li><div>      $l = 0;&nbsp;</div></li><li><div>      $ns = 0;&nbsp;</div></li><li><div>      $nl = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $rows = 0;&nbsp;</div></li><li><div>      $start_y = $this-&gt;y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $inclCursive = false;&nbsp;</div></li><li><div>          if (preg_match(&quot;/([&quot; . $this-&gt;pregCURSchars . &quot;])/u&quot;, $s)) {&nbsp;</div></li><li><div>              $inclCursive = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          while ($i &lt; $nb) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Get next character</span></span>&nbsp;</div></li><li><div>              $c = mb_substr($s, $i, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>              if ($c == &quot;\n&quot;) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//Explicit line break</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>                  $tmp = rtrim(mb_substr($s, $j, $i - $j, $this-&gt;mb_enc));&nbsp;</div></li><li><div>                  $tmpOTLdata = false;&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($OTLdata)) {&nbsp;</div></li><li><div>                      $tmpOTLdata = $this-&gt;otl-&gt;sliceOTLdata($OTLdata, $j, $i - $j);&nbsp;</div></li><li><div>                      $this-&gt;otl-&gt;trimOTLdata($tmpOTLdata, false, true);&nbsp;</div></li><li><div>                      $this-&gt;magic_reverse_dir($tmp, $directionality, $tmpOTLdata);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;Cell($w, $h, $tmp, $b, 2, $align, $fill, $link, 0, 0, 0, 'M', 0, false, $tmpOTLdata);&nbsp;</div></li><li><div>                  if ($maxrows != false && isset($this-&gt;mpdfform) && ($this-&gt;y - $start_y) / $h &gt; $maxrows) {&nbsp;</div></li><li><div>                      return false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $i++;&nbsp;</div></li><li><div>                  $sep = -1;&nbsp;</div></li><li><div>                  $j = $i;&nbsp;</div></li><li><div>                  $l = 0;&nbsp;</div></li><li><div>                  $ns = 0;&nbsp;</div></li><li><div>                  $nl++;&nbsp;</div></li><li><div>                  if ($border and $nl == 2)&nbsp;</div></li><li><div>                      $b = $b2;&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($c == &quot; &quot;) {&nbsp;</div></li><li><div>                  $sep = $i;&nbsp;</div></li><li><div>                  $ls = $l;&nbsp;</div></li><li><div>                  $ns++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $l += $this-&gt;GetCharWidthNonCore($c);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($l &gt; $wmax) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//Automatic line break</span></span>&nbsp;</div></li><li><div>                  if ($sep == -1) { <span class="comment">// Only one word</span>&nbsp;</div></li><li><div>                      if ($i == $j)&nbsp;</div></li><li><div>                          $i++;&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>                      $tmp = rtrim(mb_substr($s, $j, $i - $j, $this-&gt;mb_enc));&nbsp;</div></li><li><div>                      $tmpOTLdata = false;&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($OTLdata)) {&nbsp;</div></li><li><div>                          $tmpOTLdata = $this-&gt;otl-&gt;sliceOTLdata($OTLdata, $j, $i - $j);&nbsp;</div></li><li><div>                          $this-&gt;otl-&gt;trimOTLdata($tmpOTLdata, false, true);&nbsp;</div></li><li><div>                          $this-&gt;magic_reverse_dir($tmp, $directionality, $tmpOTLdata);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;Cell($w, $h, $tmp, $b, 2, $align, $fill, $link, 0, 0, 0, 'M', 0, false, $tmpOTLdata);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $tmp = rtrim(mb_substr($s, $j, $sep - $j, $this-&gt;mb_enc));&nbsp;</div></li><li><div>                      $tmpOTLdata = false;&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($OTLdata)) {&nbsp;</div></li><li><div>                          $tmpOTLdata = $this-&gt;otl-&gt;sliceOTLdata($OTLdata, $j, $sep - $j);&nbsp;</div></li><li><div>                          $this-&gt;otl-&gt;trimOTLdata($tmpOTLdata, false, true);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if ($align == 'J') {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>///////////&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// JUSTIFY J using Unicode fonts (Word spacing doesn't work)</span></span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> UNICODE&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// Change NON_BREAKING SPACE to spaces so they are 'spaced' properly</span></span>&nbsp;</div></li><li><div>                          $tmp = str_replace(chr(194) . chr(160), chr(32), $tmp);&nbsp;</div></li><li><div>                          $len_ligne = $this-&gt;GetStringWidth($tmp, false, $tmpOTLdata);&nbsp;</div></li><li><div>                          $nb_carac = mb_strlen($tmp, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                          $nb_spaces = mb_substr_count($tmp, ' ', $this-&gt;mb_enc);&nbsp;</div></li><li><div>                          <span class="comment">// Take off number of Marks</span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Use GPOS OTL</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          if (isset($this-&gt;CurrentFont['useOTL']) && ($this-&gt;CurrentFont['useOTL'])) {&nbsp;</div></li><li><div>                              if (isset($tmpOTLdata['group']) && $tmpOTLdata['group']) {&nbsp;</div></li><li><div>                                  $nb_carac -= substr_count($tmpOTLdata['group'], 'M');&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          list($charspacing, $ws, $kashida) = $this-&gt;GetJspacing($nb_carac, $nb_spaces, ((($wmax) - $len_ligne) * _MPDFK), $inclCursive, $tmpOTLdata);&nbsp;</div></li><li><div>                          $this-&gt;SetSpacing($charspacing, $ws);&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>///////////&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (isset($OTLdata)) {&nbsp;</div></li><li><div>                          $this-&gt;magic_reverse_dir($tmp, $directionality, $tmpOTLdata);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;Cell($w, $h, $tmp, $b, 2, $align, $fill, $link, 0, 0, 0, 'M', 0, false, $tmpOTLdata);&nbsp;</div></li><li><div>                      $i = $sep + 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($maxrows != false && isset($this-&gt;mpdfform) && ($this-&gt;y - $start_y) / $h &gt; $maxrows) {&nbsp;</div></li><li><div>                      return false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $sep = -1;&nbsp;</div></li><li><div>                  $j = $i;&nbsp;</div></li><li><div>                  $l = 0;&nbsp;</div></li><li><div>                  $ns = 0;&nbsp;</div></li><li><div>                  $nl++;&nbsp;</div></li><li><div>                  if ($border and $nl == 2)&nbsp;</div></li><li><div>                      $b = $b2;&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>                  $i++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//Last chunk</span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          while ($i &lt; $nb) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Get next character</span></span>&nbsp;</div></li><li><div>              $c = $s[$i];&nbsp;</div></li><li><div>              if ($c == &quot;\n&quot;) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//Explicit line break</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>                  $this-&gt;Cell($w, $h, substr($s, $j, $i - $j), $b, 2, $align, $fill, $link);&nbsp;</div></li><li><div>                  if ($maxrows != false && isset($this-&gt;mpdfform) && ($this-&gt;y - $start_y) / $h &gt; $maxrows) {&nbsp;</div></li><li><div>                      return false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $i++;&nbsp;</div></li><li><div>                  $sep = -1;&nbsp;</div></li><li><div>                  $j = $i;&nbsp;</div></li><li><div>                  $l = 0;&nbsp;</div></li><li><div>                  $ns = 0;&nbsp;</div></li><li><div>                  $nl++;&nbsp;</div></li><li><div>                  if ($border and $nl == 2)&nbsp;</div></li><li><div>                      $b = $b2;&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($c == &quot; &quot;) {&nbsp;</div></li><li><div>                  $sep = $i;&nbsp;</div></li><li><div>                  $ls = $l;&nbsp;</div></li><li><div>                  $ns++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $l += $this-&gt;GetCharWidthCore($c);&nbsp;</div></li><li><div>              if ($l &gt; $wmax) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//Automatic line break</span></span>&nbsp;</div></li><li><div>                  if ($sep == -1) {&nbsp;</div></li><li><div>                      if ($i == $j)&nbsp;</div></li><li><div>                          $i++;&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>                      $this-&gt;Cell($w, $h, substr($s, $j, $i - $j), $b, 2, $align, $fill, $link);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      if ($align == 'J') {&nbsp;</div></li><li><div>                          $tmp = rtrim(substr($s, $j, $sep - $j));&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>///////////&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// JUSTIFY J using Unicode fonts (Word spacing doesn't work)</span></span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> NON_UNICODE/CJK&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// Change NON_BREAKING SPACE to spaces so they are 'spaced' properly</span></span>&nbsp;</div></li><li><div>                          $tmp = str_replace(chr(160), chr(32), $tmp);&nbsp;</div></li><li><div>                          $len_ligne = $this-&gt;GetStringWidth($tmp);&nbsp;</div></li><li><div>                          $nb_carac = strlen($tmp);&nbsp;</div></li><li><div>                          $nb_spaces = substr_count($tmp, ' ');&nbsp;</div></li><li><div>                          $tmpOTLdata = array();&nbsp;</div></li><li><div>                          list($charspacing, $ws, $kashida) = $this-&gt;GetJspacing($nb_carac, $nb_spaces, ((($wmax) - $len_ligne) * _MPDFK), false, $tmpOTLdata);&nbsp;</div></li><li><div>                          $this-&gt;SetSpacing($charspacing, $ws);&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>///////////&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;Cell($w, $h, substr($s, $j, $sep - $j), $b, 2, $align, $fill, $link);&nbsp;</div></li><li><div>                      $i = $sep + 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($maxrows != false && isset($this-&gt;mpdfform) && ($this-&gt;y - $start_y) / $h &gt; $maxrows) {&nbsp;</div></li><li><div>                      return false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $sep = -1;&nbsp;</div></li><li><div>                  $j = $i;&nbsp;</div></li><li><div>                  $l = 0;&nbsp;</div></li><li><div>                  $ns = 0;&nbsp;</div></li><li><div>                  $nl++;&nbsp;</div></li><li><div>                  if ($border and $nl == 2)&nbsp;</div></li><li><div>                      $b = $b2;&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>                  $i++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//Last chunk</span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//Last chunk</span></span></span>&nbsp;</div></li><li><div>      if ($border and is_int(strpos($border, 'B')))&nbsp;</div></li><li><div>          $b.='B';&nbsp;</div></li><li><div>      if (!$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $tmp = rtrim(mb_substr($s, $j, $i - $j, $this-&gt;mb_enc));&nbsp;</div></li><li><div>          $tmpOTLdata = false;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($OTLdata)) {&nbsp;</div></li><li><div>              $tmpOTLdata = $this-&gt;otl-&gt;sliceOTLdata($OTLdata, $j, $i - $j);&nbsp;</div></li><li><div>              $this-&gt;otl-&gt;trimOTLdata($tmpOTLdata, false, true);&nbsp;</div></li><li><div>              $this-&gt;magic_reverse_dir($tmp, $directionality, $tmpOTLdata);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;Cell($w, $h, $tmp, $b, 2, $align, $fill, $link, 0, 0, 0, 'M', 0, false, $tmpOTLdata);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;Cell($w, $h, substr($s, $j, $i - $j), $b, 2, $align, $fill, $link);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- DIRECTW -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Write($h, $txt, $currentx = 0, $link = '', $directionality = 'ltr', $align = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('directw', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/directw.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;directw)) {&nbsp;</div></li><li><div>          $this-&gt;directw = new directw($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;directw-&gt;Write($h, $txt, $currentx, $link, $directionality, $align);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END DIRECTW -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function saveInlineProperties()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $saved = array();&nbsp;</div></li><li><div>      $saved['family'] = $this-&gt;FontFamily;&nbsp;</div></li><li><div>      $saved['style'] = $this-&gt;FontStyle;&nbsp;</div></li><li><div>      $saved['sizePt'] = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>      $saved['size'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>      $saved['HREF'] = $this-&gt;HREF;&nbsp;</div></li><li><div>      $saved['textvar'] = $this-&gt;textvar; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $saved['OTLtags'] = $this-&gt;OTLtags; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $saved['textshadow'] = $this-&gt;textshadow;&nbsp;</div></li><li><div>      $saved['linewidth'] = $this-&gt;LineWidth;&nbsp;</div></li><li><div>      $saved['drawcolor'] = $this-&gt;DrawColor;&nbsp;</div></li><li><div>      $saved['textparam'] = $this-&gt;textparam;&nbsp;</div></li><li><div>      $saved['lSpacingCSS'] = $this-&gt;lSpacingCSS;&nbsp;</div></li><li><div>      $saved['wSpacingCSS'] = $this-&gt;wSpacingCSS;&nbsp;</div></li><li><div>      $saved['I'] = $this-&gt;I;&nbsp;</div></li><li><div>      $saved['B'] = $this-&gt;B;&nbsp;</div></li><li><div>      $saved['colorarray'] = $this-&gt;colorarray;&nbsp;</div></li><li><div>      $saved['bgcolorarray'] = $this-&gt;spanbgcolorarray;&nbsp;</div></li><li><div>      $saved['border'] = $this-&gt;spanborddet;&nbsp;</div></li><li><div>      $saved['color'] = $this-&gt;TextColor;&nbsp;</div></li><li><div>      $saved['bgcolor'] = $this-&gt;FillColor;&nbsp;</div></li><li><div>      $saved['lang'] = $this-&gt;currentLang;&nbsp;</div></li><li><div>      $saved['fontLanguageOverride'] = $this-&gt;fontLanguageOverride; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $saved['display_off'] = $this-&gt;inlineDisplayOff;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $saved;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function restoreInlineProperties(&$saved)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $FontFamily = $saved['family'];&nbsp;</div></li><li><div>      $this-&gt;FontStyle = $saved['style'];&nbsp;</div></li><li><div>      $this-&gt;FontSizePt = $saved['sizePt'];&nbsp;</div></li><li><div>      $this-&gt;FontSize = $saved['size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;currentLang = $saved['lang'];&nbsp;</div></li><li><div>      $this-&gt;fontLanguageOverride = $saved['fontLanguageOverride']; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;ColorFlag = ($this-&gt;FillColor != $this-&gt;TextColor); <span class="comment"><span class="comment">//Restore ColorFlag as well</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;HREF = $saved['HREF'];&nbsp;</div></li><li><div>      $this-&gt;textvar = $saved['textvar']; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;OTLtags = $saved['OTLtags']; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;textshadow = $saved['textshadow'];&nbsp;</div></li><li><div>      $this-&gt;LineWidth = $saved['linewidth'];&nbsp;</div></li><li><div>      $this-&gt;DrawColor = $saved['drawcolor'];&nbsp;</div></li><li><div>      $this-&gt;textparam = $saved['textparam'];&nbsp;</div></li><li><div>      $this-&gt;inlineDisplayOff = $saved['display_off'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;lSpacingCSS = $saved['lSpacingCSS'];&nbsp;</div></li><li><div>      if (($this-&gt;lSpacingCSS || $this-&gt;lSpacingCSS === '0') && strtoupper($this-&gt;lSpacingCSS) != 'NORMAL') {&nbsp;</div></li><li><div>          $this-&gt;fixedlSpacing = $this-&gt;ConvertSize($this-&gt;lSpacingCSS, $this-&gt;FontSize);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;fixedlSpacing = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;wSpacingCSS = $saved['wSpacingCSS'];&nbsp;</div></li><li><div>      if ($this-&gt;wSpacingCSS && strtoupper($this-&gt;wSpacingCSS) != 'NORMAL') {&nbsp;</div></li><li><div>          $this-&gt;minwSpacing = $this-&gt;ConvertSize($this-&gt;wSpacingCSS, $this-&gt;FontSize);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;minwSpacing = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetFont($FontFamily, $saved['style'], $saved['sizePt'], false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;currentfontstyle = $saved['style'];&nbsp;</div></li><li><div>      $this-&gt;currentfontsize = $saved['sizePt'];&nbsp;</div></li><li><div>      $this-&gt;SetStylesArray(array('B' =&gt; $saved['B'], 'I' =&gt; $saved['I'])); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;TextColor = $saved['color'];&nbsp;</div></li><li><div>      $this-&gt;FillColor = $saved['bgcolor'];&nbsp;</div></li><li><div>      $this-&gt;colorarray = $saved['colorarray'];&nbsp;</div></li><li><div>      $cor = $saved['colorarray'];&nbsp;</div></li><li><div>      if ($cor)&nbsp;</div></li><li><div>          $this-&gt;SetTColor($cor);&nbsp;</div></li><li><div>      $this-&gt;spanbgcolorarray = $saved['bgcolorarray'];&nbsp;</div></li><li><div>      $cor = $saved['bgcolorarray'];&nbsp;</div></li><li><div>      if ($cor)&nbsp;</div></li><li><div>          $this-&gt;SetFColor($cor);&nbsp;</div></li><li><div>      $this-&gt;spanborddet = $saved['border'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Used when ColActive for tables - updated to return first block with background fill OR borders</span>&nbsp;</div></li><li><div>  function GetFirstBlockFill()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Returns the first blocklevel that uses a bgcolor fill</span>&nbsp;</div></li><li><div>      $startfill = 0;&nbsp;</div></li><li><div>      for ($i = 1; $i &lt;= $this-&gt;blklvl; $i++) {&nbsp;</div></li><li><div>          if ($this-&gt;blk[$i]['bgcolor'] || $this-&gt;blk[$i]['border_left']['w'] || $this-&gt;blk[$i]['border_right']['w'] || $this-&gt;blk[$i]['border_top']['w'] || $this-&gt;blk[$i]['border_bottom']['w']) {&nbsp;</div></li><li><div>              $startfill = $i;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $startfill;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//-------------------------FLOWING BLOCK------------------------------------//</span>&nbsp;</div></li><li><div>  <span class="comment">//The following functions were originally written by Damon Kohler           //</span>&nbsp;</div></li><li><div>  <span class="comment">//--------------------------------------------------------------------------//</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function saveFont()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $saved = array();&nbsp;</div></li><li><div>      $saved['family'] = $this-&gt;FontFamily;&nbsp;</div></li><li><div>      $saved['style'] = $this-&gt;FontStyle;&nbsp;</div></li><li><div>      $saved['sizePt'] = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>      $saved['size'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>      $saved['curr'] = &$this-&gt;CurrentFont;&nbsp;</div></li><li><div>      $saved['lang'] = $this-&gt;currentLang; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $saved['color'] = $this-&gt;TextColor;&nbsp;</div></li><li><div>      $saved['spanbgcolor'] = $this-&gt;spanbgcolor;&nbsp;</div></li><li><div>      $saved['spanbgcolorarray'] = $this-&gt;spanbgcolorarray;&nbsp;</div></li><li><div>      $saved['bord'] = $this-&gt;spanborder;&nbsp;</div></li><li><div>      $saved['border'] = $this-&gt;spanborddet;&nbsp;</div></li><li><div>      $saved['HREF'] = $this-&gt;HREF;&nbsp;</div></li><li><div>      $saved['textvar'] = $this-&gt;textvar; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $saved['textshadow'] = $this-&gt;textshadow;&nbsp;</div></li><li><div>      $saved['linewidth'] = $this-&gt;LineWidth;&nbsp;</div></li><li><div>      $saved['drawcolor'] = $this-&gt;DrawColor;&nbsp;</div></li><li><div>      $saved['textparam'] = $this-&gt;textparam;&nbsp;</div></li><li><div>      $saved['ReqFontStyle'] = $this-&gt;ReqFontStyle;&nbsp;</div></li><li><div>      $saved['fixedlSpacing'] = $this-&gt;fixedlSpacing;&nbsp;</div></li><li><div>      $saved['minwSpacing'] = $this-&gt;minwSpacing;&nbsp;</div></li><li><div>      return $saved;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function restoreFont(&$saved, $write = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!isset($saved) || empty($saved))&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;FontFamily = $saved['family'];&nbsp;</div></li><li><div>      $this-&gt;FontStyle = $saved['style'];&nbsp;</div></li><li><div>      $this-&gt;FontSizePt = $saved['sizePt'];&nbsp;</div></li><li><div>      $this-&gt;FontSize = $saved['size'];&nbsp;</div></li><li><div>      $this-&gt;CurrentFont = &$saved['curr'];&nbsp;</div></li><li><div>      $this-&gt;currentLang = $saved['lang']; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;TextColor = $saved['color'];&nbsp;</div></li><li><div>      $this-&gt;spanbgcolor = $saved['spanbgcolor'];&nbsp;</div></li><li><div>      $this-&gt;spanbgcolorarray = $saved['spanbgcolorarray'];&nbsp;</div></li><li><div>      $this-&gt;spanborder = $saved['bord'];&nbsp;</div></li><li><div>      $this-&gt;spanborddet = $saved['border'];&nbsp;</div></li><li><div>      $this-&gt;ColorFlag = ($this-&gt;FillColor != $this-&gt;TextColor); <span class="comment"><span class="comment">//Restore ColorFlag as well</span></span>&nbsp;</div></li><li><div>      $this-&gt;HREF = $saved['HREF'];&nbsp;</div></li><li><div>      $this-&gt;fixedlSpacing = $saved['fixedlSpacing'];&nbsp;</div></li><li><div>      $this-&gt;minwSpacing = $saved['minwSpacing'];&nbsp;</div></li><li><div>      $this-&gt;textvar = $saved['textvar'];  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;textshadow = $saved['textshadow'];&nbsp;</div></li><li><div>      $this-&gt;LineWidth = $saved['linewidth'];&nbsp;</div></li><li><div>      $this-&gt;DrawColor = $saved['drawcolor'];&nbsp;</div></li><li><div>      $this-&gt;textparam = $saved['textparam'];&nbsp;</div></li><li><div>      if ($write) {&nbsp;</div></li><li><div>          $this-&gt;SetFont($saved['family'], $saved['style'], $saved['sizePt'], true, true); <span class="comment">// force output</span>&nbsp;</div></li><li><div>          $fontout = (sprintf('BT /F%d %.3F Tf ET', $this-&gt;CurrentFont['i'], $this-&gt;FontSizePt));&nbsp;</div></li><li><div>          if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['Font']) && $this-&gt;pageoutput[$this-&gt;page]['Font'] != $fontout) || !isset($this-&gt;pageoutput[$this-&gt;page]['Font']))) {&nbsp;</div></li><li><div>              $this-&gt;_out($fontout);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page]['Font'] = $fontout;&nbsp;</div></li><li><div>      } else&nbsp;</div></li><li><div>          $this-&gt;SetFont($saved['family'], $saved['style'], $saved['sizePt'], false);&nbsp;</div></li><li><div>      $this-&gt;ReqFontStyle = $saved['ReqFontStyle'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function newFlowingBlock($w, $h, $a = '', $is_table = false, $blockstate = 0, $newblock = true, $blockdir = 'ltr', $table_draft = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$a) {&nbsp;</div></li><li><div>          if ($blockdir == 'rtl') {&nbsp;</div></li><li><div>              $a = 'R';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $a = 'L';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['width'] = ($w * _MPDFK);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// line height in user units</span></span>&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['is_table'] = $is_table;&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['table_draft'] = $table_draft;&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['height'] = $h;&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['lineCount'] = 0;&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['align'] = $a;&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['font'] = array();&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['content'] = array();&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['contentB'] = array();&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['contentWidth'] = 0;&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['blockstate'] = $blockstate;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['newblock'] = $newblock;&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['valign'] = 'M';&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['blockdir'] = $blockdir;&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['cOTLdata'] = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;flowingBlockAttr['lastBidiText'] = ''; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (!empty($this-&gt;otl)) {&nbsp;</div></li><li><div>          $this-&gt;otl-&gt;lastBidiStrongType = '';&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function finishFlowingBlock($endofblock = false, $next = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $currentx = $this-&gt;x;&nbsp;</div></li><li><div>      <span class="comment">//prints out the last chunk</span>&nbsp;</div></li><li><div>      $is_table = $this-&gt;flowingBlockAttr['is_table'];&nbsp;</div></li><li><div>      $table_draft = $this-&gt;flowingBlockAttr['table_draft'];&nbsp;</div></li><li><div>      $maxWidth = & $this-&gt;flowingBlockAttr['width'];&nbsp;</div></li><li><div>      $stackHeight = & $this-&gt;flowingBlockAttr['height'];&nbsp;</div></li><li><div>      $align = & $this-&gt;flowingBlockAttr['align'];&nbsp;</div></li><li><div>      $content = & $this-&gt;flowingBlockAttr['content'];&nbsp;</div></li><li><div>      $contentB = & $this-&gt;flowingBlockAttr['contentB'];&nbsp;</div></li><li><div>      $font = & $this-&gt;flowingBlockAttr['font'];&nbsp;</div></li><li><div>      $contentWidth = & $this-&gt;flowingBlockAttr['contentWidth'];&nbsp;</div></li><li><div>      $lineCount = & $this-&gt;flowingBlockAttr['lineCount'];&nbsp;</div></li><li><div>      $valign = & $this-&gt;flowingBlockAttr['valign'];&nbsp;</div></li><li><div>      $blockstate = $this-&gt;flowingBlockAttr['blockstate'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cOTLdata = & $this-&gt;flowingBlockAttr['cOTLdata']; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $newblock = $this-&gt;flowingBlockAttr['newblock'];&nbsp;</div></li><li><div>      $blockdir = $this-&gt;flowingBlockAttr['blockdir'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// ****</span>******* BLOCK BACKGROUND COLOR *****************//</span>&nbsp;</div></li><li><div>      if ($this-&gt;blk[$this-&gt;blklvl]['bgcolor'] && !$is_table) {&nbsp;</div></li><li><div>          $fill = 0;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>          $fill = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $hanger = '';&nbsp;</div></li><li><div>      <span class="comment">// Always right trim!</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> trim last content and adjust width if needed to justify (later)</span>&nbsp;</div></li><li><div>      if (isset($content[count($content) - 1]) && preg_match('/[ ]+$/', $content[count($content) - 1], $m)) {&nbsp;</div></li><li><div>          $strip = strlen($m[0]);&nbsp;</div></li><li><div>          $content[count($content) - 1] = substr($content[count($content) - 1], 0, (strlen($content[count($content) - 1]) - $strip));&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>              $this-&gt;otl-&gt;trimOTLdata($cOTLdata[count($cOTLdata) - 1], false, true);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// the amount of space taken up so far in user units</span>&nbsp;</div></li><li><div>      $usedWidth = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive && !$is_table) {&nbsp;</div></li><li><div>          $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Print out each chunk</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($is_table) {&nbsp;</div></li><li><div>          $ipaddingL = 0;&nbsp;</div></li><li><div>          $ipaddingR = 0;&nbsp;</div></li><li><div>          $paddingL = 0;&nbsp;</div></li><li><div>          $paddingR = 0;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $ipaddingL = $this-&gt;blk[$this-&gt;blklvl]['padding_left'];&nbsp;</div></li><li><div>          $ipaddingR = $this-&gt;blk[$this-&gt;blklvl]['padding_right'];&nbsp;</div></li><li><div>          $paddingL = ($ipaddingL * _MPDFK);&nbsp;</div></li><li><div>          $paddingR = ($ipaddingR * _MPDFK);&nbsp;</div></li><li><div>          $this-&gt;cMarginL = $this-&gt;blk[$this-&gt;blklvl]['border_left']['w'];&nbsp;</div></li><li><div>          $this-&gt;cMarginR = $this-&gt;blk[$this-&gt;blklvl]['border_right']['w'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added mPDF 3.0</span> Float DIV</span></span></span>&nbsp;</div></li><li><div>          $fpaddingR = 0;&nbsp;</div></li><li><div>          $fpaddingL = 0;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (count($this-&gt;floatDivs)) {&nbsp;</div></li><li><div>              list($l_exists, $r_exists, $l_max, $r_max, $l_width, $r_width) = $this-&gt;GetFloatDivInfo($this-&gt;blklvl);&nbsp;</div></li><li><div>              if ($r_exists) {&nbsp;</div></li><li><div>                  $fpaddingR = $r_width;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($l_exists) {&nbsp;</div></li><li><div>                  $fpaddingL = $l_width;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $usey = $this-&gt;y + 0.002;&nbsp;</div></li><li><div>          if (($newblock) && ($blockstate == 1 || $blockstate == 3) && ($lineCount == 0)) {&nbsp;</div></li><li><div>              $usey += $this-&gt;blk[$this-&gt;blklvl]['margin_top'] + $this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// If float exists at this level</span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;floatmargins['R']) && $usey &lt;= $this-&gt;floatmargins['R']['y1'] && $usey &gt;= $this-&gt;floatmargins['R']['y0'] && !$this-&gt;floatmargins['R']['skipline']) {&nbsp;</div></li><li><div>              $fpaddingR += $this-&gt;floatmargins['R']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;floatmargins['L']) && $usey &lt;= $this-&gt;floatmargins['L']['y1'] && $usey &gt;= $this-&gt;floatmargins['L']['y0'] && !$this-&gt;floatmargins['L']['skipline']) {&nbsp;</div></li><li><div>              $fpaddingL += $this-&gt;floatmargins['L']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $lineBox = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_setInlineBlockHeights($lineBox, $stackHeight, $content, $font, $is_table);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($is_table && count($content) == 0) {&nbsp;</div></li><li><div>          $stackHeight = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($table_draft) {&nbsp;</div></li><li><div>          $this-&gt;y += $stackHeight;&nbsp;</div></li><li><div>          $this-&gt;objectbuffer = array();&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// While we're at it, check if contains cursive text</span>&nbsp;</div></li><li><div>      <span class="comment">// Change NBSP to SPACE.</span>&nbsp;</div></li><li><div>      <span class="comment">// Re-calculate contentWidth</span>&nbsp;</div></li><li><div>      $contentWidth = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($content as $k =&gt; $chunk) {&nbsp;</div></li><li><div>          $this-&gt;restoreFont($font[$k], false);&nbsp;</div></li><li><div>          if (!isset($this-&gt;objectbuffer[$k]) || (isset($this-&gt;objectbuffer[$k]) && !$this-&gt;objectbuffer[$k])) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// Soft Hyphens</span></span> chr(173)</span>&nbsp;</div></li><li><div>              if (!$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>                      $this-&gt;otl-&gt;removeChar($chunk, $cOTLdata[$k], &quot;\xc2\xad&quot;);&nbsp;</div></li><li><div>                      $this-&gt;otl-&gt;replaceSpace($chunk, $cOTLdata[$k]);&nbsp;</div></li><li><div>                      $content[$k] = $chunk;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> else {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $content[$k] = $chunk = str_replace(&quot;\xc2\xad&quot;, '', $chunk);&nbsp;</div></li><li><div>                      $content[$k] = $chunk = str_replace(chr(194) . chr(160), chr(32), $chunk);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              } elseif ($this-&gt;FontFamily != 'csymbol' && $this-&gt;FontFamily != 'czapfdingbats') {&nbsp;</div></li><li><div>                  $content[$k] = $chunk = str_replace(chr(173), '', $chunk);&nbsp;</div></li><li><div>                  $content[$k] = $chunk = str_replace(chr(160), chr(32), $chunk);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $contentWidth += $this-&gt;GetStringWidth($chunk, true, (isset($cOTLdata[$k]) ? $cOTLdata[$k] : false), $this-&gt;textvar) * _MPDFK;&nbsp;</div></li><li><div>          } elseif (isset($this-&gt;objectbuffer[$k]) && $this-&gt;objectbuffer[$k]) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// LIST MARKERS</span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>              if ($this-&gt;objectbuffer[$k]['type'] == 'image' && isset($this-&gt;objectbuffer[$k]['listmarker']) && $this-&gt;objectbuffer[$k]['listmarker'] && $this-&gt;objectbuffer[$k]['listmarkerposition'] == 'outside') {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// do nothing</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $contentWidth += $this-&gt;objectbuffer[$k]['OUTER-WIDTH'] * _MPDFK;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($font[count($font) - 1])) {&nbsp;</div></li><li><div>          $lastfontreqstyle = (isset($font[count($font) - 1]['ReqFontStyle']) ? $font[count($font) - 1]['ReqFontStyle'] : '');&nbsp;</div></li><li><div>          $lastfontstyle = (isset($font[count($font) - 1]['style']) ? $font[count($font) - 1]['style'] : '');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $lastfontreqstyle = null;&nbsp;</div></li><li><div>          $lastfontstyle = null;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($blockdir == 'ltr' && strpos($lastfontreqstyle, &quot;I&quot;) !== false && strpos($lastfontstyle, &quot;I&quot;) === false) { <span class="comment"><span class="comment"><span class="comment">// Artificial italic</span></span></span>&nbsp;</div></li><li><div>          $lastitalic = $this-&gt;FontSize * 0.15 * _MPDFK;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $lastitalic = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get PAGEBREAK TO TEST for height including the bottom border/padding</span>&nbsp;</div></li><li><div>      $check_h = max($this-&gt;divheight, $stackHeight);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// This fixes a proven bug...</span>&nbsp;</div></li><li><div>      if ($endofblock && $newblock && $blockstate == 0 && !$content) {&nbsp;</div></li><li><div>          $check_h = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// but ? needs to fix potentially more widespread...</span>&nbsp;</div></li><li><div>      <span class="comment">//    if (!$content) {  $check_h = 0; }</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;blklvl &gt; 0 && !$is_table) {&nbsp;</div></li><li><div>          if ($endofblock && $blockstate &gt; 1) {&nbsp;</div></li><li><div>              if ($this-&gt;blk[$this-&gt;blklvl]['page_break_after_avoid']) {&nbsp;</div></li><li><div>                  $check_h += $stackHeight;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $check_h += ($this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['border_bottom']['w']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (($newblock && ($blockstate == 1 || $blockstate == 3) && $lineCount == 0) || ($endofblock && $blockstate == 3 && $lineCount == 0)) {&nbsp;</div></li><li><div>              $check_h += ($this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['margin_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Force PAGE break if column height cannot take check-height</span>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive && $check_h &gt; ($this-&gt;PageBreakTrigger - $this-&gt;y0)) {&nbsp;</div></li><li><div>          $this-&gt;SetCol($this-&gt;NbCol - 1);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Avoid just border/background-color moved on to next page</span>&nbsp;</div></li><li><div>      if ($endofblock && $blockstate &gt; 1 && !$content) {&nbsp;</div></li><li><div>          $buff = $this-&gt;margBuffer;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $buff = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// PAGEBREAK</span></span>&nbsp;</div></li><li><div>      if (!$is_table && ($this-&gt;y + $check_h) &gt; ($this-&gt;PageBreakTrigger + $buff) and ! $this-&gt;InFooter and $this-&gt;AcceptPageBreak()) {&nbsp;</div></li><li><div>          $bak_x = $this-&gt;x; <span class="comment"><span class="comment"><span class="comment">//Current X position</span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $ws = $this-&gt;ws; <span class="comment"><span class="comment"><span class="comment">//Word Spacing</span></span></span>&nbsp;</div></li><li><div>          $charspacing = $this-&gt;charspacing; <span class="comment"><span class="comment"><span class="comment">//Character Spacing</span></span></span>&nbsp;</div></li><li><div>          $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added to correct for OddEven Margins</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $currentx += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>          $this-&gt;x += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;SetSpacing($charspacing, $ws);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLUMN CHANGE</span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;CurrCol != $oldcolumn) {&nbsp;</div></li><li><div>          $currentx += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>          $this-&gt;x += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>          $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive && !$is_table) {&nbsp;</div></li><li><div>          $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// TOP</span> MARGIN</span></span>&nbsp;</div></li><li><div>      if ($newblock && ($blockstate == 1 || $blockstate == 3) && ($this-&gt;blk[$this-&gt;blklvl]['margin_top']) && $lineCount == 0 && !$is_table) {&nbsp;</div></li><li><div>          $this-&gt;DivLn($this-&gt;blk[$this-&gt;blklvl]['margin_top'], $this-&gt;blklvl - 1, true, $this-&gt;blk[$this-&gt;blklvl]['margin_collapse']);&nbsp;</div></li><li><div>          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>              $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($newblock && ($blockstate == 1 || $blockstate == 3) && $lineCount == 0 && !$is_table) {&nbsp;</div></li><li><div>          $this-&gt;blk[$this-&gt;blklvl]['y0'] = $this-&gt;y;&nbsp;</div></li><li><div>          $this-&gt;blk[$this-&gt;blklvl]['startpage'] = $this-&gt;page;&nbsp;</div></li><li><div>          if ($this-&gt;blk[$this-&gt;blklvl]['float']) {&nbsp;</div></li><li><div>              $this-&gt;blk[$this-&gt;blklvl]['float_start_y'] = $this-&gt;y;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>              $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Paragraph INDENT</span></span></span></span>&nbsp;</div></li><li><div>      $WidthCorrection = 0;&nbsp;</div></li><li><div>      if (($newblock) && ($blockstate == 1 || $blockstate == 3) && isset($this-&gt;blk[$this-&gt;blklvl]['text_indent']) && ($lineCount == 0) && (!$is_table) && ($align != 'C')) {&nbsp;</div></li><li><div>          $ti = $this-&gt;ConvertSize($this-&gt;blk[$this-&gt;blklvl]['text_indent'], $this-&gt;blk[$this-&gt;blklvl]['inner_width'], $this-&gt;blk[$this-&gt;blklvl]['InlineProperties']['size'], false);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>          $WidthCorrection = ($ti * _MPDFK);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// PADDING</span> and BORDER spacing/fill</span></span>&nbsp;</div></li><li><div>      if (($newblock) && ($blockstate == 1 || $blockstate == 3) && (($this-&gt;blk[$this-&gt;blklvl]['padding_top']) || ($this-&gt;blk[$this-&gt;blklvl]['border_top'])) && ($lineCount == 0) && (!$is_table)) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $state = 0 normal; 1 top; 2 bottom; 3 top and bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;DivLn($this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w'], -3, true, false, 1);&nbsp;</div></li><li><div>          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>              $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;x = $currentx;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added mPDF 3.0</span> Float DIV</span></span></span>&nbsp;</div></li><li><div>      $fpaddingR = 0;&nbsp;</div></li><li><div>      $fpaddingL = 0;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;floatDivs)) {&nbsp;</div></li><li><div>          list($l_exists, $r_exists, $l_max, $r_max, $l_width, $r_width) = $this-&gt;GetFloatDivInfo($this-&gt;blklvl);&nbsp;</div></li><li><div>          if ($r_exists) {&nbsp;</div></li><li><div>              $fpaddingR = $r_width;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($l_exists) {&nbsp;</div></li><li><div>              $fpaddingL = $l_width;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $usey = $this-&gt;y + 0.002;&nbsp;</div></li><li><div>      if (($newblock) && ($blockstate == 1 || $blockstate == 3) && ($lineCount == 0)) {&nbsp;</div></li><li><div>          $usey += $this-&gt;blk[$this-&gt;blklvl]['margin_top'] + $this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// If float exists at this level</span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;floatmargins['R']) && $usey &lt;= $this-&gt;floatmargins['R']['y1'] && $usey &gt;= $this-&gt;floatmargins['R']['y0'] && !$this-&gt;floatmargins['R']['skipline']) {&nbsp;</div></li><li><div>          $fpaddingR += $this-&gt;floatmargins['R']['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;floatmargins['L']) && $usey &lt;= $this-&gt;floatmargins['L']['y1'] && $usey &gt;= $this-&gt;floatmargins['L']['y0'] && !$this-&gt;floatmargins['L']['skipline']) {&nbsp;</div></li><li><div>          $fpaddingL += $this-&gt;floatmargins['L']['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($content) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// In FinishFlowing Block no lines are justified as it is always last line</span>&nbsp;</div></li><li><div>          <span class="comment">// but if CJKorphan has allowed content width to go over max width, use J charspacing to compress line</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// JUSTIFICATION J</span> - NOT!</span>&nbsp;</div></li><li><div>          $nb_carac = 0;&nbsp;</div></li><li><div>          $nb_spaces = 0;&nbsp;</div></li><li><div>          $jcharspacing = 0;&nbsp;</div></li><li><div>          $jkashida = 0;&nbsp;</div></li><li><div>          $jws = 0;&nbsp;</div></li><li><div>          $inclCursive = false;&nbsp;</div></li><li><div>          $dottab = false;&nbsp;</div></li><li><div>          foreach ($content as $k =&gt; $chunk) {&nbsp;</div></li><li><div>              if (!isset($this-&gt;objectbuffer[$k]) || (isset($this-&gt;objectbuffer[$k]) && !$this-&gt;objectbuffer[$k])) {&nbsp;</div></li><li><div>                  $nb_carac += mb_strlen($chunk, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  $nb_spaces += mb_substr_count($chunk, ' ', $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Use GPOS OTL</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;restoreFont($font[$k], false);&nbsp;</div></li><li><div>                  if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>                      if (isset($cOTLdata[$k]['group']) && $cOTLdata[$k]['group']) {&nbsp;</div></li><li><div>                          $nb_marks = substr_count($cOTLdata[$k]['group'], 'M');&nbsp;</div></li><li><div>                          $nb_carac -= $nb_marks;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (preg_match(&quot;/([&quot; . $this-&gt;pregCURSchars . &quot;])/u&quot;, $chunk)) {&nbsp;</div></li><li><div>                          $inclCursive = true;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $nb_carac ++;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> allow spacing for inline object&nbsp;</div></li><li><div>                  if ($this-&gt;objectbuffer[$k]['type'] == 'dottab') {&nbsp;</div></li><li><div>                      $dottab = $this-&gt;objectbuffer[$k]['outdent'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span> RTL&nbsp;</div></li><li><div>          $chunkorder = range(0, count($content) - 1); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($blockdir == 'rtl' || $this-&gt;biDirectional) {&nbsp;</div></li><li><div>              $this-&gt;otl-&gt;_bidiReorder($chunkorder, $content, $cOTLdata, $blockdir);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// From this point on, $content and $cOTLdata may contain more elements (and re-ordered) compared to</span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// $this-&gt;objectbuffer and $font ($chunkorder contains the mapping)</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Remove any XAdvance from OTL data at end of line</span></span>&nbsp;</div></li><li><div>          <span class="comment">// And correct for XPlacement on last character</span>&nbsp;</div></li><li><div>          <span class="comment">// BIDI is applied</span>&nbsp;</div></li><li><div>          foreach ($chunkorder AS $aord =&gt; $k) {&nbsp;</div></li><li><div>              if (count($cOTLdata)) {&nbsp;</div></li><li><div>                  $this-&gt;restoreFont($font[$k], false);&nbsp;</div></li><li><div>                  <span class="comment">// ...FinishFlowingBlock...</span>&nbsp;</div></li><li><div>                  if ($aord == count($chunkorder) - 1 && isset($cOTLdata[$aord]['group'])) { <span class="comment"><span class="comment">// Last chunk on line</span></span>&nbsp;</div></li><li><div>                      $nGPOS = strlen($cOTLdata[$aord]['group']) - 1; <span class="comment"><span class="comment">// Last character</span></span>&nbsp;</div></li><li><div>                      if (isset($cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL']) || isset($cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceR'])) {&nbsp;</div></li><li><div>                          if (isset($cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL'])) {&nbsp;</div></li><li><div>                              $w = $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $w = $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceR'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $w *= ($this-&gt;FontSize / 1000);&nbsp;</div></li><li><div>                          $contentWidth -= $w * _MPDFK;&nbsp;</div></li><li><div>                          $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL'] = 0;&nbsp;</div></li><li><div>                          $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceR'] = 0;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// If last character has an XPlacement set, adjust width calculation, and add to XAdvance to account for it</span></span>&nbsp;</div></li><li><div>                      if (isset($cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XPlacement'])) {&nbsp;</div></li><li><div>                          $w = -$cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XPlacement'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                          $w *= ($this-&gt;FontSize / 1000);&nbsp;</div></li><li><div>                          $contentWidth -= $w * _MPDFK;&nbsp;</div></li><li><div>                          $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL'] = $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XPlacement'];&nbsp;</div></li><li><div>                          $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceR'] = $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XPlacement'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// if it's justified, we need to find the char/word spacing (or if orphans have allowed length of line to go over the maxwidth)</span>&nbsp;</div></li><li><div>          <span class="comment">// If &quot;orphans&quot; in fact is just a final space - ignore this</span>&nbsp;</div></li><li><div>          $lastchar = mb_substr($content[(count($chunkorder) - 1)], mb_strlen($content[(count($chunkorder) - 1)], $this-&gt;mb_enc) - 1, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>          if (preg_match(&quot;/[&quot; . $this-&gt;CJKoverflow . &quot;]/u&quot;, $lastchar)) {&nbsp;</div></li><li><div>              $CJKoverflow = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $CJKoverflow = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ((((($contentWidth + $lastitalic) &gt; $maxWidth) && ($content[(count($chunkorder) - 1)] != ' ') ) ||&nbsp;</div></li><li><div>              (!$endofblock && $align == 'J' && ($next == 'image' || $next == 'select' || $next == 'input' || $next == 'textarea' || ($next == 'br' && $this-&gt;justifyB4br)))) && !($CJKoverflow && $this-&gt;allowCJKoverflow)) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              list($jcharspacing, $jws, $jkashida) = $this-&gt;GetJspacing($nb_carac, $nb_spaces, ($maxWidth - $lastitalic - $contentWidth - $WidthCorrection - (($this-&gt;cMarginL + $this-&gt;cMarginR) * _MPDFK) - ($paddingL + $paddingR + (($fpaddingL + $fpaddingR) * _MPDFK) )), $inclCursive, $cOTLdata);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span> elseif ($this-&gt;checkCJK && $align == 'J' && $CJKoverflow && $this-&gt;allowCJKoverflow && $this-&gt;CJKforceend) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// force-end overhang</span></span></span></span>&nbsp;</div></li><li><div>              $hanger = mb_substr($content[(count($chunkorder) - 1)], mb_strlen($content[(count($chunkorder) - 1)], $this-&gt;mb_enc) - 1, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>              if (preg_match(&quot;/[&quot; . $this-&gt;CJKoverflow . &quot;]/u&quot;, $hanger)) {&nbsp;</div></li><li><div>                  $content[(count($chunkorder) - 1)] = mb_substr($content[(count($chunkorder) - 1)], 0, mb_strlen($content[(count($chunkorder) - 1)], $this-&gt;mb_enc) - 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  $this-&gt;restoreFont($font[$chunkorder[count($chunkorder) - 1]], false);&nbsp;</div></li><li><div>                  $contentWidth -= $this-&gt;GetStringWidth($hanger) * _MPDFK;&nbsp;</div></li><li><div>                  $nb_carac -= 1;&nbsp;</div></li><li><div>                  list($jcharspacing, $jws, $jkashida) = $this-&gt;GetJspacing($nb_carac, $nb_spaces, ($maxWidth - $lastitalic - $contentWidth - $WidthCorrection - (($this-&gt;cMarginL + $this-&gt;cMarginR) * _MPDFK) - ($paddingL + $paddingR + (($fpaddingL + $fpaddingR) * _MPDFK) )), $inclCursive, $cOTLdata);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Check if will fit at word/char spacing of previous line - if so continue it</span>&nbsp;</div></li><li><div>          <span class="comment">// but only allow a maximum of $this-&gt;jSmaxWordLast and $this-&gt;jSmaxCharLast</span>&nbsp;</div></li><li><div>          elseif ($contentWidth &lt; ($maxWidth - $lastitalic - $WidthCorrection - (($this-&gt;cMarginL + $this-&gt;cMarginR) * _MPDFK) - ($paddingL + $paddingR + (($fpaddingL + $fpaddingR) * _MPDFK))) && !$this-&gt;fixedlSpacing) {&nbsp;</div></li><li><div>              if ($this-&gt;ws &gt; $this-&gt;jSmaxWordLast) {&nbsp;</div></li><li><div>                  $jws = $this-&gt;jSmaxWordLast;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;charspacing &gt; $this-&gt;jSmaxCharLast) {&nbsp;</div></li><li><div>                  $jcharspacing = $this-&gt;jSmaxCharLast;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $check = $maxWidth - $lastitalic - $WidthCorrection - $contentWidth - (($this-&gt;cMarginL + $this-&gt;cMarginR) * _MPDFK) - ($paddingL + $paddingR + (($fpaddingL + $fpaddingR) * _MPDFK) ) - ( $jcharspacing * $nb_carac) - ( $jws * $nb_spaces);&nbsp;</div></li><li><div>              if ($check &lt;= 0) {&nbsp;</div></li><li><div>                  $jcharspacing = 0;&nbsp;</div></li><li><div>                  $jws = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $empty = $maxWidth - $lastitalic - $WidthCorrection - $contentWidth - (($this-&gt;cMarginL + $this-&gt;cMarginR) * _MPDFK) - ($paddingL + $paddingR + (($fpaddingL + $fpaddingR) * _MPDFK) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $empty -= ($jcharspacing * ($nb_carac - 1)); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> nb_carac MINUS 1&nbsp;</div></li><li><div>          $empty -= ($jws * $nb_spaces);&nbsp;</div></li><li><div>          $empty -= ($jkashida);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $empty /= _MPDFK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (!$is_table) {&nbsp;</div></li><li><div>              $this-&gt;maxPosR = max($this-&gt;maxPosR, ($this-&gt;w - $this-&gt;rMargin - $this-&gt;blk[$this-&gt;blklvl]['outer_right_margin'] - $empty));&nbsp;</div></li><li><div>              $this-&gt;maxPosL = min($this-&gt;maxPosL, ($this-&gt;lMargin + $this-&gt;blk[$this-&gt;blklvl]['outer_left_margin'] + $empty));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $arraysize = count($chunkorder);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $margins = ($this-&gt;cMarginL + $this-&gt;cMarginR) + ($ipaddingL + $ipaddingR + $fpaddingR + $fpaddingR );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (!$is_table) {&nbsp;</div></li><li><div>              $this-&gt;DivLn($stackHeight, $this-&gt;blklvl, false);&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment">// false -&gt; don't advance y</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;x = $currentx + $this-&gt;cMarginL + $ipaddingL + $fpaddingL;&nbsp;</div></li><li><div>          if ($dottab !== false && $blockdir == 'rtl') {&nbsp;</div></li><li><div>              $this-&gt;x -= $dottab;&nbsp;</div></li><li><div>          } elseif ($align == 'R') {&nbsp;</div></li><li><div>              $this-&gt;x += $empty;&nbsp;</div></li><li><div>          } elseif ($align == 'J' && $blockdir == 'rtl') {&nbsp;</div></li><li><div>              $this-&gt;x += $empty;&nbsp;</div></li><li><div>          } elseif ($align == 'C') {&nbsp;</div></li><li><div>              $this-&gt;x += ($empty / 2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Paragraph INDENT</span></span></span></span>&nbsp;</div></li><li><div>          $WidthCorrection = 0;&nbsp;</div></li><li><div>          if (($newblock) && ($blockstate == 1 || $blockstate == 3) && isset($this-&gt;blk[$this-&gt;blklvl]['text_indent']) && ($lineCount == 0) && (!$is_table) && ($align != 'C')) {&nbsp;</div></li><li><div>              $ti = $this-&gt;ConvertSize($this-&gt;blk[$this-&gt;blklvl]['text_indent'], $this-&gt;blk[$this-&gt;blklvl]['inner_width'], $this-&gt;blk[$this-&gt;blklvl]['InlineProperties']['size'], false);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>              if ($blockdir != 'rtl') {&nbsp;</div></li><li><div>                  $this-&gt;x += $ti;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ($chunkorder AS $aord =&gt; $k) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $chunk = $content[$aord];&nbsp;</div></li><li><div>              if (isset($this-&gt;objectbuffer[$k]) && $this-&gt;objectbuffer[$k]) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $xadj = $this-&gt;x - $this-&gt;objectbuffer[$k]['OUTER-X'];&nbsp;</div></li><li><div>                  $this-&gt;objectbuffer[$k]['OUTER-X'] += $xadj;&nbsp;</div></li><li><div>                  $this-&gt;objectbuffer[$k]['BORDER-X'] += $xadj;&nbsp;</div></li><li><div>                  $this-&gt;objectbuffer[$k]['INNER-X'] += $xadj;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;objectbuffer[$k]['type'] == 'listmarker') {&nbsp;</div></li><li><div>                      $this-&gt;objectbuffer[$k]['lineBox'] = $lineBox[-1]; <span class="comment"><span class="comment">// Block element details for glyph-origin</span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $yadj = $this-&gt;y - $this-&gt;objectbuffer[$k]['OUTER-Y'];&nbsp;</div></li><li><div>                  if ($this-&gt;objectbuffer[$k]['type'] == 'dottab') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> DOTTAB&nbsp;</div></li><li><div>                      $this-&gt;objectbuffer[$k]['lineBox'] = $lineBox[$k]; <span class="comment"><span class="comment">// element details for glyph-origin</span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;objectbuffer[$k]['type'] != 'dottab') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> DOTTAB&nbsp;</div></li><li><div>                      $yadj += $lineBox[$k]['top'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;objectbuffer[$k]['OUTER-Y'] += $yadj;&nbsp;</div></li><li><div>                  $this-&gt;objectbuffer[$k]['BORDER-Y'] += $yadj;&nbsp;</div></li><li><div>                  $this-&gt;objectbuffer[$k]['INNER-Y'] += $yadj;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;restoreFont($font[$k]);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($is_table && substr($align, 0, 1) == 'D' && $aord == 0) {&nbsp;</div></li><li><div>                  $dp = $this-&gt;decimal_align[substr($align, 0, 2)];&nbsp;</div></li><li><div>                  $s = preg_split('/' . preg_quote($dp, '/') . '/', $content[0], 2);  <span class="comment"><span class="comment">// ? needs to be /u if not core</span></span>&nbsp;</div></li><li><div>                  $s0 = $this-&gt;GetStringWidth($s[0], false);&nbsp;</div></li><li><div>                  $this-&gt;x += ($this-&gt;decimal_offset - $s0);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;SetSpacing(($this-&gt;fixedlSpacing * _MPDFK) + $jcharspacing, ($this-&gt;fixedlSpacing + $this-&gt;minwSpacing) * _MPDFK + $jws);&nbsp;</div></li><li><div>              $this-&gt;fixedlSpacing = false;&nbsp;</div></li><li><div>              $this-&gt;minwSpacing = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $save_vis = $this-&gt;visibility;&nbsp;</div></li><li><div>              if (isset($this-&gt;textparam['visibility']) && $this-&gt;textparam['visibility'] && $this-&gt;textparam['visibility'] != $this-&gt;visibility) {&nbsp;</div></li><li><div>                  $this-&gt;SetVisibility($this-&gt;textparam['visibility']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// ****</span>******* SPAN BACKGROUND COLOR ***************** //</span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;spanbgcolor) && $this-&gt;spanbgcolor) {&nbsp;</div></li><li><div>                  $cor = $this-&gt;spanbgcolorarray;&nbsp;</div></li><li><div>                  $this-&gt;SetFColor($cor);&nbsp;</div></li><li><div>                  $save_fill = $fill;&nbsp;</div></li><li><div>                  $spanfill = 1;&nbsp;</div></li><li><div>                  $fill = 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>                  if (strpos($contentB[$k], 'L') !== false && isset($this-&gt;spanborddet['L']))&nbsp;</div></li><li><div>                      $this-&gt;x += $this-&gt;spanborddet['L']['w'];&nbsp;</div></li><li><div>                  if (strpos($contentB[$k], 'L') === false)&nbsp;</div></li><li><div>                      $this-&gt;spanborddet['L']['s'] = $this-&gt;spanborddet['L']['w'] = 0;&nbsp;</div></li><li><div>                  if (strpos($contentB[$k], 'R') === false)&nbsp;</div></li><li><div>                      $this-&gt;spanborddet['R']['s'] = $this-&gt;spanborddet['R']['w'] = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $stringWidth = $this-&gt;GetStringWidth($chunk, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar);&nbsp;</div></li><li><div>              $nch = mb_strlen($chunk, $this-&gt;mb_enc);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Use GPOS OTL</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>                  if (isset($cOTLdata[$aord]['group']) && $cOTLdata[$aord]['group']) {&nbsp;</div></li><li><div>                      $nch -= substr_count($cOTLdata[$aord]['group'], 'M');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $stringWidth += ( $this-&gt;charspacing * $nch / _MPDFK );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $stringWidth += ( $this-&gt;ws * mb_substr_count($chunk, ' ', $this-&gt;mb_enc) / _MPDFK );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (isset($this-&gt;objectbuffer[$k])) {&nbsp;</div></li><li><div>                  if ($this-&gt;objectbuffer[$k]['type'] == 'dottab') {&nbsp;</div></li><li><div>                      $this-&gt;objectbuffer[$k]['OUTER-WIDTH'] +=$empty;&nbsp;</div></li><li><div>                      $this-&gt;objectbuffer[$k]['OUTER-WIDTH'] +=$this-&gt;objectbuffer[$k]['outdent'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// LIST MARKERS</span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>                  if ($this-&gt;objectbuffer[$k]['type'] == 'image' && isset($this-&gt;objectbuffer[$k]['listmarker']) && $this-&gt;objectbuffer[$k]['listmarker'] && $this-&gt;objectbuffer[$k]['listmarkerposition'] == 'outside') {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// do nothing</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $stringWidth = $this-&gt;objectbuffer[$k]['OUTER-WIDTH'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($stringWidth == 0) {&nbsp;</div></li><li><div>                  $stringWidth = 0.000001;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($aord == $arraysize - 1) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;checkCJK && $CJKoverflow && $align == 'J' && $this-&gt;allowCJKoverflow && $hanger && $this-&gt;CJKforceend) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// force-end overhang</span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;Cell($stringWidth, $stackHeight, $chunk, '', 0, '', $fill, $this-&gt;HREF, $currentx, 0, 0, 'M', $fill, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar, (isset($lineBox[$k]) ? $lineBox[$k] : false));  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;Cell($this-&gt;GetStringWidth($hanger), $stackHeight, $hanger, '', 1, '', $fill, $this-&gt;HREF, $currentx, 0, 0, 'M', $fill, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar, (isset($lineBox[$k]) ? $lineBox[$k] : false)); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;Cell($stringWidth, $stackHeight, $chunk, '', 1, '', $fill, $this-&gt;HREF, $currentx, 0, 0, 'M', $fill, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar, (isset($lineBox[$k]) ? $lineBox[$k] : false)); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>                  $this-&gt;Cell($stringWidth, $stackHeight, $chunk, '', 0, '', $fill, $this-&gt;HREF, 0, 0, 0, 'M', $fill, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar, (isset($lineBox[$k]) ? $lineBox[$k] : false)); <span class="comment">//first or middle part</span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>                  if (strpos($contentB[$k], 'R') !== false && $aord != $arraysize - 1)&nbsp;</div></li><li><div>                      $this-&gt;x += $this-&gt;spanborddet['R']['w'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// ****</span>******* SPAN BACKGROUND COLOR OFF - RESET BLOCK BGCOLOR ***************** //</span></span>&nbsp;</div></li><li><div>              if (isset($spanfill) && $spanfill) {&nbsp;</div></li><li><div>                  $fill = $save_fill;&nbsp;</div></li><li><div>                  $spanfill = 0;&nbsp;</div></li><li><div>                  if ($fill) {&nbsp;</div></li><li><div>                      $this-&gt;SetFColor($bcor);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($this-&gt;textparam['visibility']) && $this-&gt;textparam['visibility'] && $this-&gt;visibility != $save_vis) {&nbsp;</div></li><li><div>                  $this-&gt;SetVisibility($save_vis);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;printobjectbuffer($is_table, $blockdir);&nbsp;</div></li><li><div>          $this-&gt;objectbuffer = array();&nbsp;</div></li><li><div>          $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>      } <span class="comment">// END IF CONTENT</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Update values if set to skipline</span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;floatmargins) {&nbsp;</div></li><li><div>          $this-&gt;_advanceFloatMargins();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($endofblock && $blockstate &gt; 1) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// If float exists at this level</span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;floatmargins['R']['y1'])) {&nbsp;</div></li><li><div>              $fry1 = $this-&gt;floatmargins['R']['y1'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $fry1 = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;floatmargins['L']['y1'])) {&nbsp;</div></li><li><div>              $fly1 = $this-&gt;floatmargins['L']['y1'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $fly1 = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;y &lt; $fry1 || $this-&gt;y &lt; $fly1) {&nbsp;</div></li><li><div>              $drop = max($fry1, $fly1) - $this-&gt;y;&nbsp;</div></li><li><div>              $this-&gt;DivLn($drop);&nbsp;</div></li><li><div>              $this-&gt;x = $currentx;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// PADDING</span> and BORDER spacing/fill</span></span>&nbsp;</div></li><li><div>      if ($endofblock && ($blockstate &gt; 1) && ($this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] || $this-&gt;blk[$this-&gt;blklvl]['border_bottom'] || $this-&gt;blk[$this-&gt;blklvl]['css_set_height']) && (!$is_table)) {&nbsp;</div></li><li><div>          <span class="comment">// If CSS height set, extend bottom - if on same page as block started, and CSS HEIGHT &gt; actual height, </span>&nbsp;</div></li><li><div>          <span class="comment">// and does not force pagebreak</span>&nbsp;</div></li><li><div>          $extra = 0;&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['css_set_height']) && $this-&gt;blk[$this-&gt;blklvl]['css_set_height'] && $this-&gt;blk[$this-&gt;blklvl]['startpage'] == $this-&gt;page) {&nbsp;</div></li><li><div>              <span class="comment">// predicted height</span>&nbsp;</div></li><li><div>              $h1 = ($this-&gt;y - $this-&gt;blk[$this-&gt;blklvl]['y0']) + $this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['border_bottom']['w'];&nbsp;</div></li><li><div>              if ($h1 &lt; ($this-&gt;blk[$this-&gt;blklvl]['css_set_height'] + $this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['padding_top'])) {&nbsp;</div></li><li><div>                  $extra = ($this-&gt;blk[$this-&gt;blklvl]['css_set_height'] + $this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['padding_top']) - $h1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;y + $this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['border_bottom']['w'] + $extra &gt; $this-&gt;PageBreakTrigger) {&nbsp;</div></li><li><div>                  $extra = $this-&gt;PageBreakTrigger - ($this-&gt;y + $this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['border_bottom']['w']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $state = 0 normal; 1 top; 2 bottom; 3 top and bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;DivLn($this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['border_bottom']['w'] + $extra, -3, true, false, 2);&nbsp;</div></li><li><div>          $this-&gt;x = $currentx;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>              $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// SET Bottom y1 of block (used for painting borders)</span>&nbsp;</div></li><li><div>      if (($endofblock) && ($blockstate &gt; 1) && (!$is_table)) {&nbsp;</div></li><li><div>          $this-&gt;blk[$this-&gt;blklvl]['y1'] = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// BOTTOM</span></span> MARGIN</span>&nbsp;</div></li><li><div>      if (($endofblock) && ($blockstate &gt; 1) && ($this-&gt;blk[$this-&gt;blklvl]['margin_bottom']) && (!$is_table)) {&nbsp;</div></li><li><div>          if ($this-&gt;y + $this-&gt;blk[$this-&gt;blklvl]['margin_bottom'] &lt; $this-&gt;PageBreakTrigger and ! $this-&gt;InFooter) {&nbsp;</div></li><li><div>              $this-&gt;DivLn($this-&gt;blk[$this-&gt;blklvl]['margin_bottom'], $this-&gt;blklvl - 1, true, $this-&gt;blk[$this-&gt;blklvl]['margin_collapse']);&nbsp;</div></li><li><div>              if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                  $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Reset</span> lineheight</span></span>&nbsp;</div></li><li><div>      $stackHeight = $this-&gt;divheight;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function printobjectbuffer($is_table = false, $blockdir = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$blockdir) {&nbsp;</div></li><li><div>          $blockdir = $this-&gt;directionality;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($is_table && $this-&gt;shrin_k &gt; 1) {&nbsp;</div></li><li><div>          $k = $this-&gt;shrin_k;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $k = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $save_y = $this-&gt;y;&nbsp;</div></li><li><div>      $save_x = $this-&gt;x;&nbsp;</div></li><li><div>      $save_currentfontfamily = $this-&gt;FontFamily;&nbsp;</div></li><li><div>      $save_currentfontsize = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>      $save_currentfontstyle = $this-&gt;FontStyle;&nbsp;</div></li><li><div>      if ($blockdir == 'rtl') {&nbsp;</div></li><li><div>          $rtlalign = 'R';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $rtlalign = 'L';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ($this-&gt;objectbuffer AS $ib =&gt; $objattr) {&nbsp;</div></li><li><div>          if ($objattr['type'] == 'bookmark' || $objattr['type'] == 'indexentry' || $objattr['type'] == 'toc') {&nbsp;</div></li><li><div>              $x = $objattr['OUTER-X'];&nbsp;</div></li><li><div>              $y = $objattr['OUTER-Y'];&nbsp;</div></li><li><div>              $this-&gt;y = $y - $this-&gt;FontSize / 2;&nbsp;</div></li><li><div>              $this-&gt;x = $x;&nbsp;</div></li><li><div>              if ($objattr['type'] == 'bookmark') {&nbsp;</div></li><li><div>                  $this-&gt;Bookmark($objattr['CONTENT'], $objattr['bklevel'], $y - $this-&gt;FontSize);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment">// *BOOKMARKS*</span></span>&nbsp;</div></li><li><div>              if ($objattr['type'] == 'indexentry') {&nbsp;</div></li><li><div>                  $this-&gt;IndexEntry($objattr['CONTENT']);&nbsp;</div></li><li><div>              } <span class="comment">// *INDEX*</span>&nbsp;</div></li><li><div>              if ($objattr['type'] == 'toc') {&nbsp;</div></li><li><div>                  $this-&gt;TOC_Entry($objattr['CONTENT'], $objattr['toclevel'], (isset($objattr['toc_id']) ? $objattr['toc_id'] : ''));&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment">// *TOC*</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif ($objattr['type'] == 'annot') {&nbsp;</div></li><li><div>              if ($objattr['POS-X']) {&nbsp;</div></li><li><div>                  $x = $objattr['POS-X'];&nbsp;</div></li><li><div>              } elseif ($this-&gt;annotMargin &lt;&gt; 0) {&nbsp;</div></li><li><div>                  $x = -$objattr['OUTER-X'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $x = $objattr['OUTER-X'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($objattr['POS-Y']) {&nbsp;</div></li><li><div>                  $y = $objattr['POS-Y'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $y = $objattr['OUTER-Y'] - $this-&gt;FontSize / 2;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// Create a dummy entry in the _out/columnBuffer with position sensitive data, </span>&nbsp;</div></li><li><div>              <span class="comment">// linking $y-1 in the Columnbuffer with entry in $this-&gt;columnAnnots</span>&nbsp;</div></li><li><div>              <span class="comment">// and when columns are split in length will not break annotation from current line</span>&nbsp;</div></li><li><div>              $this-&gt;y = $y - 1;&nbsp;</div></li><li><div>              $this-&gt;x = $x - 1;&nbsp;</div></li><li><div>              $this-&gt;Line($x - 1, $y - 1, $x - 1, $y - 1);&nbsp;</div></li><li><div>              $this-&gt;Annotation($objattr['CONTENT'], $x, $y, $objattr['ICON'], $objattr['AUTHOR'], $objattr['SUBJECT'], $objattr['OPACITY'], $objattr['COLOR'], (isset($objattr['POPUP']) ? $objattr['POPUP'] : ''), (isset($objattr['FILE']) ? $objattr['FILE'] : ''));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> else {&nbsp;</div></li><li><div>              $y = $objattr['OUTER-Y'];&nbsp;</div></li><li><div>              $x = $objattr['OUTER-X'];&nbsp;</div></li><li><div>              $w = $objattr['OUTER-WIDTH'];&nbsp;</div></li><li><div>              $h = $objattr['OUTER-HEIGHT'];&nbsp;</div></li><li><div>              if (isset($objattr['text'])) {&nbsp;</div></li><li><div>                  $texto = $objattr['text'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;y = $y;&nbsp;</div></li><li><div>              $this-&gt;x = $x;&nbsp;</div></li><li><div>              if (isset($objattr['fontfamily'])) {&nbsp;</div></li><li><div>                  $this-&gt;SetFont($objattr['fontfamily'], '', $objattr['fontsize']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// HR</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'hr') {&nbsp;</div></li><li><div>              $this-&gt;SetDColor($objattr['color']);&nbsp;</div></li><li><div>              switch ($objattr['align']) {&nbsp;</div></li><li><div>                  case 'C':&nbsp;</div></li><li><div>                      $empty = $objattr['OUTER-WIDTH'] - $objattr['INNER-WIDTH'];&nbsp;</div></li><li><div>                      $empty /= 2;&nbsp;</div></li><li><div>                      $x += $empty;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'R':&nbsp;</div></li><li><div>                      $empty = $objattr['OUTER-WIDTH'] - $objattr['INNER-WIDTH'];&nbsp;</div></li><li><div>                      $x += $empty;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $oldlinewidth = $this-&gt;LineWidth;&nbsp;</div></li><li><div>              $this-&gt;SetLineWidth($objattr['linewidth'] / $k);&nbsp;</div></li><li><div>              $this-&gt;y += ($objattr['linewidth'] / 2) + $objattr['margin_top'] / $k;&nbsp;</div></li><li><div>              $this-&gt;Line($x, $this-&gt;y, $x + $objattr['INNER-WIDTH'], $this-&gt;y);&nbsp;</div></li><li><div>              $this-&gt;SetLineWidth($oldlinewidth);&nbsp;</div></li><li><div>              $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// IMAGE</span></span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'image') {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>              if (isset($objattr['transform'])) {&nbsp;</div></li><li><div>                  $this-&gt;_out(&quot;\n&quot; . '% BTR'); <span class="comment">// Begin Transform</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($objattr['z-index']) && $objattr['z-index'] &gt; 0 && $this-&gt;current_layer == 0) {&nbsp;</div></li><li><div>                  $this-&gt;BeginLayer($objattr['z-index']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($objattr['visibility']) && $objattr['visibility'] != 'visible' && $objattr['visibility']) {&nbsp;</div></li><li><div>                  $this-&gt;SetVisibility($objattr['visibility']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($objattr['opacity'])) {&nbsp;</div></li><li><div>                  $this-&gt;SetAlpha($objattr['opacity']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $obiw = $objattr['INNER-WIDTH'];&nbsp;</div></li><li><div>              $obih = $objattr['INNER-HEIGHT'];&nbsp;</div></li><li><div>              $sx = $objattr['INNER-WIDTH'] * _MPDFK / $objattr['orig_w'];&nbsp;</div></li><li><div>              $sy = abs($objattr['INNER-HEIGHT']) * _MPDFK / abs($objattr['orig_h']);&nbsp;</div></li><li><div>              $sx = ($objattr['INNER-WIDTH'] * _MPDFK / $objattr['orig_w']);&nbsp;</div></li><li><div>              $sy = ($objattr['INNER-HEIGHT'] * _MPDFK / $objattr['orig_h']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $rotate = 0;&nbsp;</div></li><li><div>              if (isset($objattr['ROTATE'])) {&nbsp;</div></li><li><div>                  $rotate = $objattr['ROTATE'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($rotate == 90) {&nbsp;</div></li><li><div>                  <span class="comment">// Clockwise</span>&nbsp;</div></li><li><div>                  $obiw = $objattr['INNER-HEIGHT'];&nbsp;</div></li><li><div>                  $obih = $objattr['INNER-WIDTH'];&nbsp;</div></li><li><div>                  $tr = $this-&gt;transformTranslate(0, -$objattr['INNER-WIDTH'], true);&nbsp;</div></li><li><div>                  $tr .= ' ' . $this-&gt;transformRotate(90, $objattr['INNER-X'], ($objattr['INNER-Y'] + $objattr['INNER-WIDTH']), true);&nbsp;</div></li><li><div>                  $sx = $obiw * _MPDFK / $objattr['orig_h'];&nbsp;</div></li><li><div>                  $sy = $obih * _MPDFK / $objattr['orig_w'];&nbsp;</div></li><li><div>              } elseif ($rotate == -90 || $rotate == 270) {&nbsp;</div></li><li><div>                  <span class="comment">// AntiClockwise</span>&nbsp;</div></li><li><div>                  $obiw = $objattr['INNER-HEIGHT'];&nbsp;</div></li><li><div>                  $obih = $objattr['INNER-WIDTH'];&nbsp;</div></li><li><div>                  $tr = $this-&gt;transformTranslate($objattr['INNER-WIDTH'], ($objattr['INNER-HEIGHT'] - $objattr['INNER-WIDTH']), true);&nbsp;</div></li><li><div>                  $tr .= ' ' . $this-&gt;transformRotate(-90, $objattr['INNER-X'], ($objattr['INNER-Y'] + $objattr['INNER-WIDTH']), true);&nbsp;</div></li><li><div>                  $sx = $obiw * _MPDFK / $objattr['orig_h'];&nbsp;</div></li><li><div>                  $sy = $obih * _MPDFK / $objattr['orig_w'];&nbsp;</div></li><li><div>              } elseif ($rotate == 180) {&nbsp;</div></li><li><div>                  <span class="comment">// Mirror</span>&nbsp;</div></li><li><div>                  $tr = $this-&gt;transformTranslate($objattr['INNER-WIDTH'], -$objattr['INNER-HEIGHT'], true);&nbsp;</div></li><li><div>                  $tr .= ' ' . $this-&gt;transformRotate(180, $objattr['INNER-X'], ($objattr['INNER-Y'] + $objattr['INNER-HEIGHT']), true);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $tr = '';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $tr = trim($tr);&nbsp;</div></li><li><div>              if ($tr) {&nbsp;</div></li><li><div>                  $tr .= ' ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $gradmask = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>              $tr2 = '';&nbsp;</div></li><li><div>              if (isset($objattr['transform'])) {&nbsp;</div></li><li><div>                  $maxsize_x = $w;&nbsp;</div></li><li><div>                  $maxsize_y = $h;&nbsp;</div></li><li><div>                  $cx = $x + $w / 2;&nbsp;</div></li><li><div>                  $cy = $y + $h / 2;&nbsp;</div></li><li><div>                  preg_match_all('/(translatex|translatey|translate|scalex|scaley|scale|rotate|skewX|skewY|skew)\((.*?)\)/is', $objattr['transform'], $m);&nbsp;</div></li><li><div>                  if (count($m[0])) {&nbsp;</div></li><li><div>                      for ($i = 0; $i &lt; count($m[0]); $i++) {&nbsp;</div></li><li><div>                          $c = strtolower($m[1][$i]);&nbsp;</div></li><li><div>                          $v = trim($m[2][$i]);&nbsp;</div></li><li><div>                          $vv = preg_split('/[ , ]+/', $v);&nbsp;</div></li><li><div>                          if ($c == 'translate' && count($vv)) {&nbsp;</div></li><li><div>                              $translate_x = $this-&gt;ConvertSize($vv[0], $maxsize_x, false, false);&nbsp;</div></li><li><div>                              if (count($vv) == 2) {&nbsp;</div></li><li><div>                                  $translate_y = $this-&gt;ConvertSize($vv[1], $maxsize_y, false, false);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $translate_y = 0;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformTranslate($translate_x, $translate_y, true) . ' ';&nbsp;</div></li><li><div>                          } elseif ($c == 'translatex' && count($vv)) {&nbsp;</div></li><li><div>                              $translate_x = $this-&gt;ConvertSize($vv[0], $maxsize_x, false, false);&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformTranslate($translate_x, 0, true) . ' ';&nbsp;</div></li><li><div>                          } elseif ($c == 'translatey' && count($vv)) {&nbsp;</div></li><li><div>                              $translate_y = $this-&gt;ConvertSize($vv[1], $maxsize_y, false, false);&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformTranslate(0, $translate_y, true) . ' ';&nbsp;</div></li><li><div>                          } elseif ($c == 'scale' && count($vv)) {&nbsp;</div></li><li><div>                              $scale_x = $vv[0] * 100;&nbsp;</div></li><li><div>                              if (count($vv) == 2) {&nbsp;</div></li><li><div>                                  $scale_y = $vv[1] * 100;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $scale_y = $scale_x;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformScale($scale_x, $scale_y, $cx, $cy, true) . ' ';&nbsp;</div></li><li><div>                          } elseif ($c == 'scalex' && count($vv)) {&nbsp;</div></li><li><div>                              $scale_x = $vv[0] * 100;&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformScale($scale_x, 0, $cx, $cy, true) . ' ';&nbsp;</div></li><li><div>                          } elseif ($c == 'scaley' && count($vv)) {&nbsp;</div></li><li><div>                              $scale_y = $vv[1] * 100;&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformScale(0, $scale_y, $cx, $cy, true) . ' ';&nbsp;</div></li><li><div>                          } elseif ($c == 'skew' && count($vv)) {&nbsp;</div></li><li><div>                              $angle_x = $this-&gt;ConvertAngle($vv[0], false);&nbsp;</div></li><li><div>                              if (count($vv) == 2) {&nbsp;</div></li><li><div>                                  $angle_y = $this-&gt;ConvertAngle($vv[1], false);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $angle_y = 0;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformSkew($angle_x, $angle_y, $cx, $cy, true) . ' ';&nbsp;</div></li><li><div>                          } elseif ($c == 'skewx' && count($vv)) {&nbsp;</div></li><li><div>                              $angle = $this-&gt;ConvertAngle($vv[0], false);&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformSkew($angle, 0, $cx, $cy, true) . ' ';&nbsp;</div></li><li><div>                          } elseif ($c == 'skewy' && count($vv)) {&nbsp;</div></li><li><div>                              $angle = $this-&gt;ConvertAngle($vv[0], false);&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformSkew(0, $angle, $cx, $cy, true) . ' ';&nbsp;</div></li><li><div>                          } elseif ($c == 'rotate' && count($vv)) {&nbsp;</div></li><li><div>                              $angle = $this-&gt;ConvertAngle($vv[0]);&nbsp;</div></li><li><div>                              $tr2 .= $this-&gt;transformRotate($angle, $cx, $cy, true) . ' ';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// LIST MARKERS</span></span> (Images)    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>              if (isset($objattr['listmarker']) && $objattr['listmarker'] && $objattr['listmarkerposition'] == 'outside') {&nbsp;</div></li><li><div>                  $mw = $objattr['OUTER-WIDTH'];&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//  NB If change marker-offset, also need to alter in function _getListMarkerWidth</span></span>&nbsp;</div></li><li><div>                  $adjx = $this-&gt;ConvertSize($this-&gt;list_marker_offset, $this-&gt;FontSize);&nbsp;</div></li><li><div>                  if ($objattr['dir'] == 'rtl') {&nbsp;</div></li><li><div>                      $objattr['INNER-X'] += $adjx;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $objattr['INNER-X'] -= $adjx;&nbsp;</div></li><li><div>                      $objattr['INNER-X'] -= $mw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS / BACKGROUND COLOR&nbsp;</div></li><li><div>              <span class="comment">// Transform also affects image background</span>&nbsp;</div></li><li><div>              if ($tr2) {&nbsp;</div></li><li><div>                  $this-&gt;_out('q ' . $tr2 . ' ');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($objattr['bgcolor']) && $objattr['bgcolor']) {&nbsp;</div></li><li><div>                  $bgcol = $objattr['bgcolor'];&nbsp;</div></li><li><div>                  $this-&gt;SetFColor($bgcol);&nbsp;</div></li><li><div>                  $this-&gt;Rect($x, $y, $w, $h, 'F');&nbsp;</div></li><li><div>                  $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($tr2) {&nbsp;</div></li><li><div>                  $this-&gt;_out('Q');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($objattr['GRADIENT-MASK'])) {&nbsp;</div></li><li><div>                  $g = $this-&gt;grad-&gt;parseMozGradient($objattr['GRADIENT-MASK']);&nbsp;</div></li><li><div>                  if ($g) {&nbsp;</div></li><li><div>                      $dummy = $this-&gt;grad-&gt;Gradient($objattr['INNER-X'], $objattr['INNER-Y'], $obiw, $obih, $g['type'], $g['stops'], $g['colorspace'], $g['coords'], $g['extend'], true, true);&nbsp;</div></li><li><div>                      $gradmask = '/TGS' . count($this-&gt;gradients) . ' gs ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($objattr['itype']) && $objattr['itype'] == 'wmf') {&nbsp;</div></li><li><div>                  $outstring = sprintf('q ' . $tr . $tr2 . '%.3F 0 0 %.3F %.3F %.3F cm /FO%d Do Q', $sx, -$sy, $objattr['INNER-X'] * _MPDFK - $sx * $objattr['wmf_x'], (($this-&gt;h - $objattr['INNER-Y']) * _MPDFK) + $sy * $objattr['wmf_y'], $objattr['ID']); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($objattr['itype']) && $objattr['itype'] == 'svg') {&nbsp;</div></li><li><div>                  $outstring = sprintf('q ' . $tr . $tr2 . '%.3F 0 0 %.3F %.3F %.3F cm /FO%d Do Q', $sx, -$sy, $objattr['INNER-X'] * _MPDFK - $sx * $objattr['wmf_x'], (($this-&gt;h - $objattr['INNER-Y']) * _MPDFK) + $sy * $objattr['wmf_y'], $objattr['ID']); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $outstring = sprintf(&quot;q &quot; . $tr . $tr2 . &quot;%.3F 0 0 %.3F %.3F %.3F cm &quot; . $gradmask . &quot;/I%d Do Q&quot;, $obiw * _MPDFK, $obih * _MPDFK, $objattr['INNER-X'] * _MPDFK, ($this-&gt;h - ($objattr['INNER-Y'] + $obih )) * _MPDFK, $objattr['ID']); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out($outstring);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// LINK</span></span>&nbsp;</div></li><li><div>              if (isset($objattr['link']))&nbsp;</div></li><li><div>                  $this-&gt;Link($objattr['INNER-X'], $objattr['INNER-Y'], $objattr['INNER-WIDTH'], $objattr['INNER-HEIGHT'], $objattr['link']);&nbsp;</div></li><li><div>              if (isset($objattr['opacity'])) {&nbsp;</div></li><li><div>                  $this-&gt;SetAlpha(1);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>              <span class="comment">// Transform also affects image borders</span>&nbsp;</div></li><li><div>              if ($tr2) {&nbsp;</div></li><li><div>                  $this-&gt;_out('q ' . $tr2 . ' ');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ((isset($objattr['border_top']) && $objattr['border_top'] &gt; 0) || (isset($objattr['border_left']) && $objattr['border_left'] &gt; 0) || (isset($objattr['border_right']) && $objattr['border_right'] &gt; 0) || (isset($objattr['border_bottom']) && $objattr['border_bottom'] &gt; 0)) {&nbsp;</div></li><li><div>                  $this-&gt;PaintImgBorder($objattr, $is_table);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($tr2) {&nbsp;</div></li><li><div>                  $this-&gt;_out('Q');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (isset($objattr['visibility']) && $objattr['visibility'] != 'visible' && $objattr['visibility']) {&nbsp;</div></li><li><div>                  $this-&gt;SetVisibility('visible');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($objattr['z-index']) && $objattr['z-index'] &gt; 0 && $this-&gt;current_layer == 0) {&nbsp;</div></li><li><div>                  $this-&gt;EndLayer();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>              if (isset($objattr['transform'])) {&nbsp;</div></li><li><div>                  $this-&gt;_out(&quot;\n&quot; . '% ETR'); <span class="comment">// End Transform</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** -- BARCODES -- */</span></span>&nbsp;</div></li><li><div>          <span class="comment">// BARCODE</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'barcode') {&nbsp;</div></li><li><div>              $bgcol = $this-&gt;ConvertColor(255);&nbsp;</div></li><li><div>              if (isset($objattr['bgcolor']) && $objattr['bgcolor']) {&nbsp;</div></li><li><div>                  $bgcol = $objattr['bgcolor'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $col = $this-&gt;ConvertColor(0);&nbsp;</div></li><li><div>              if (isset($objattr['color']) && $objattr['color']) {&nbsp;</div></li><li><div>                  $col = $objattr['color'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;SetFColor($bgcol);&nbsp;</div></li><li><div>              $this-&gt;Rect($objattr['BORDER-X'], $objattr['BORDER-Y'], $objattr['BORDER-WIDTH'], $objattr['BORDER-HEIGHT'], 'F');&nbsp;</div></li><li><div>              $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>              if (isset($objattr['BORDER-WIDTH'])) {&nbsp;</div></li><li><div>                  $this-&gt;PaintImgBorder($objattr, $is_table);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($objattr['btype'] == 'EAN13' || $objattr['btype'] == 'ISBN' || $objattr['btype'] == 'ISSN' || $objattr['btype'] == 'UPCA' || $objattr['btype'] == 'UPCE' || $objattr['btype'] == 'EAN8') {&nbsp;</div></li><li><div>                  $this-&gt;WriteBarcode($objattr['code'], $objattr['showtext'], $objattr['INNER-X'], $objattr['INNER-Y'], $objattr['bsize'], 0, 0, 0, 0, 0, $objattr['bheight'], $bgcol, $col, $objattr['btype'], $objattr['bsupp'], (isset($objattr['bsupp_code']) ? $objattr['bsupp_code'] : ''), $k);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// QR-code</span>&nbsp;</div></li><li><div>              elseif ($objattr['btype'] == 'QR') {&nbsp;</div></li><li><div>                  if (!class_exists('QRcode', false)) {&nbsp;</div></li><li><div>                      include(_MPDF_PATH . 'qrcode/qrcode.class.php');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;qrcode = new QRcode($objattr['code'], $objattr['errorlevel']);&nbsp;</div></li><li><div>                  $this-&gt;qrcode-&gt;displayFPDF($this, $objattr['INNER-X'], $objattr['INNER-Y'], $objattr['bsize'] * 25, array(255, 255, 255), array(0, 0, 0));&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;WriteBarcode2($objattr['code'], $objattr['INNER-X'], $objattr['INNER-Y'], $objattr['bsize'], $objattr['bheight'], $bgcol, $col, $objattr['btype'], $objattr['pr_ratio'], $k);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** -- END BARCODES -- */</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// TEXT</span> CIRCLE</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'textcircle') {&nbsp;</div></li><li><div>              $bgcol = '';&nbsp;</div></li><li><div>              if (isset($objattr['bgcolor']) && $objattr['bgcolor']) {&nbsp;</div></li><li><div>                  $bgcol = $objattr['bgcolor'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $col = $this-&gt;ConvertColor(0);&nbsp;</div></li><li><div>              if (isset($objattr['color']) && $objattr['color']) {&nbsp;</div></li><li><div>                  $col = $objattr['color'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;SetTColor($col);&nbsp;</div></li><li><div>              $this-&gt;SetFColor($bgcol);&nbsp;</div></li><li><div>              if ($bgcol)&nbsp;</div></li><li><div>                  $this-&gt;Rect($objattr['BORDER-X'], $objattr['BORDER-Y'], $objattr['BORDER-WIDTH'], $objattr['BORDER-HEIGHT'], 'F');&nbsp;</div></li><li><div>              $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>              if (isset($objattr['BORDER-WIDTH'])) {&nbsp;</div></li><li><div>                  $this-&gt;PaintImgBorder($objattr, $is_table);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!class_exists('directw', false)) {&nbsp;</div></li><li><div>                  include(_MPDF_PATH . 'classes/directw.php');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (empty($this-&gt;directw)) {&nbsp;</div></li><li><div>                  $this-&gt;directw = new directw($this);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($objattr['top-text'])) {&nbsp;</div></li><li><div>                  $this-&gt;directw-&gt;CircularText($objattr['INNER-X'] + $objattr['INNER-WIDTH'] / 2, $objattr['INNER-Y'] + $objattr['INNER-HEIGHT'] / 2, $objattr['r'] / $k, $objattr['top-text'], 'top', $objattr['fontfamily'], $objattr['fontsize'] / $k, $objattr['fontstyle'], $objattr['space-width'], $objattr['char-width'], (isset($objattr['divider']) ? $objattr['divider'] : ''));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($objattr['bottom-text'])) {&nbsp;</div></li><li><div>                  $this-&gt;directw-&gt;CircularText($objattr['INNER-X'] + $objattr['INNER-WIDTH'] / 2, $objattr['INNER-Y'] + $objattr['INNER-HEIGHT'] / 2, $objattr['r'] / $k, $objattr['bottom-text'], 'bottom', $objattr['fontfamily'], $objattr['fontsize'] / $k, $objattr['fontstyle'], $objattr['space-width'], $objattr['char-width'], (isset($objattr['divider']) ? $objattr['divider'] : ''));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// LIST MARKERS</span></span> (Text or bullets)    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>          if ($objattr['type'] == 'listmarker') {&nbsp;</div></li><li><div>              if (isset($objattr['fontfamily'])) {&nbsp;</div></li><li><div>                  $this-&gt;SetFont($objattr['fontfamily'], $objattr['fontstyle'], $objattr['fontsizept']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $col = $this-&gt;ConvertColor(0);&nbsp;</div></li><li><div>              if (isset($objattr['colorarray']) && ($objattr['colorarray'])) {&nbsp;</div></li><li><div>                  $col = $objattr['colorarray'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (isset($objattr['bullet']) && $objattr['bullet']) { <span class="comment">// Used for position &quot;outside&quot; only</span>&nbsp;</div></li><li><div>                  $type = $objattr['bullet'];&nbsp;</div></li><li><div>                  $size = $objattr['size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($objattr['listmarkerposition'] == 'inside') {&nbsp;</div></li><li><div>                      $adjx = $size / 2;&nbsp;</div></li><li><div>                      if ($objattr['dir'] == 'rtl') {&nbsp;</div></li><li><div>                          $adjx += $objattr['offset'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;x += $adjx;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $adjx = $objattr['offset'];&nbsp;</div></li><li><div>                      $adjx += $size / 2;&nbsp;</div></li><li><div>                      if ($objattr['dir'] == 'rtl') {&nbsp;</div></li><li><div>                          $this-&gt;x += $adjx;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;x -= $adjx;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $yadj = $objattr['lineBox']['glyphYorigin'];&nbsp;</div></li><li><div>                  if (isset($this-&gt;CurrentFont['desc']['XHeight']) && $this-&gt;CurrentFont['desc']['XHeight']) {&nbsp;</div></li><li><div>                      $xh = $this-&gt;CurrentFont['desc']['XHeight'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $xh = 500;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $yadj -= ($this-&gt;FontSize * $xh / 1000) * 0.625; <span class="comment">// Vertical height of bullet (centre) from baseline= XHeight * 0.625</span>&nbsp;</div></li><li><div>                  $this-&gt;y += $yadj;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $this-&gt;_printListBullet($this-&gt;x, $this-&gt;y, $size, $type, $col);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;SetTColor($col);&nbsp;</div></li><li><div>                  $w = $this-&gt;GetStringWidth($texto);&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//  NB If change marker-offset, also need to alter in function _getListMarkerWidth</span></span>&nbsp;</div></li><li><div>                  $adjx = $this-&gt;ConvertSize($this-&gt;list_marker_offset, $this-&gt;FontSize);&nbsp;</div></li><li><div>                  if ($objattr['dir'] == 'rtl') {&nbsp;</div></li><li><div>                      $align = 'L';&nbsp;</div></li><li><div>                      $this-&gt;x += $adjx;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      <span class="comment">// Use these lines to set as marker-offset, right-aligned - default</span>&nbsp;</div></li><li><div>                      $align = 'R';&nbsp;</div></li><li><div>                      $this-&gt;x -= $adjx;&nbsp;</div></li><li><div>                      $this-&gt;x -= $w;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;Cell($w, $this-&gt;FontSize, $texto, 0, 0, $align, 0, '', 0, 0, 0, 'T', 0, false, false, 0, $objattr['lineBox']);&nbsp;</div></li><li><div>                  $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// DOT-TAB</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'dottab') {&nbsp;</div></li><li><div>              if (isset($objattr['fontfamily'])) {&nbsp;</div></li><li><div>                  $this-&gt;SetFont($objattr['fontfamily'], '', $objattr['fontsize']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $sp = $this-&gt;GetStringWidth(' ');&nbsp;</div></li><li><div>              $nb = floor(($w - 2 * $sp) / $this-&gt;GetStringWidth('.'));&nbsp;</div></li><li><div>              if ($nb &gt; 0) {&nbsp;</div></li><li><div>                  $dots = ' ' . str_repeat('.', $nb) . ' ';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $dots = ' ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $col = $this-&gt;ConvertColor(0);&nbsp;</div></li><li><div>              if (isset($objattr['colorarray']) && ($objattr['colorarray'])) {&nbsp;</div></li><li><div>                  $col = $objattr['colorarray'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;SetTColor($col);&nbsp;</div></li><li><div>              $save_dh = $this-&gt;divheight;&nbsp;</div></li><li><div>              $save_sbd = $this-&gt;spanborddet;&nbsp;</div></li><li><div>              $save_textvar = $this-&gt;textvar; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;spanborddet = '';&nbsp;</div></li><li><div>              $this-&gt;divheight = 0;&nbsp;</div></li><li><div>              $this-&gt;textvar = 0x00; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;Cell($w, $h, $dots, 0, 0, 'C', 0, '', 0, 0, 0, 'T', 0, false, false, 0, $objattr['lineBox']); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> DOTTAB&nbsp;</div></li><li><div>              $this-&gt;spanborddet = $save_sbd;&nbsp;</div></li><li><div>              $this-&gt;textvar = $save_textvar; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;divheight = $save_dh;&nbsp;</div></li><li><div>              $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// TEXT</span>/PASSWORD INPUT</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'input' && ($objattr['subtype'] == 'TEXT' || $objattr['subtype'] == 'PASSWORD')) {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;print_ob_text($objattr, $w, $h, $texto, $rtlalign, $k, $blockdir);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// TEXT</span>AREA</span></span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'textarea') {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;print_ob_textarea($objattr, $w, $h, $texto, $rtlalign, $k, $blockdir);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// SELECT</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'select') {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;print_ob_select($objattr, $w, $h, $texto, $rtlalign, $k, $blockdir);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// INPUT/BUTTON as IMAGE</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'input' && $objattr['subtype'] == 'IMAGE') {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;print_ob_imageinput($objattr, $w, $h, $texto, $rtlalign, $k, $blockdir);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// BUTTON</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'input' && ($objattr['subtype'] == 'SUBMIT' || $objattr['subtype'] == 'RESET' || $objattr['subtype'] == 'BUTTON')) {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;print_ob_button($objattr, $w, $h, $texto, $rtlalign, $k, $blockdir);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// CHECKBOX</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'input' && ($objattr['subtype'] == 'CHECKBOX')) {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;print_ob_checkbox($objattr, $w, $h, $texto, $rtlalign, $k, $blockdir, $x, $y);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// RADIO</span>&nbsp;</div></li><li><div>          if ($objattr['type'] == 'input' && ($objattr['subtype'] == 'RADIO')) {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;print_ob_radio($objattr, $w, $h, $texto, $rtlalign, $k, $blockdir, $x, $y);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetFont($save_currentfontfamily, $save_currentfontstyle, $save_currentfontsize);&nbsp;</div></li><li><div>      $this-&gt;y = $save_y;&nbsp;</div></li><li><div>      $this-&gt;x = $save_x;&nbsp;</div></li><li><div>      unset($content);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _printListBullet($x, $y, $size, $type, $color)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// x and y are the centre of the bullet; size is the width and/or height in mm</span>&nbsp;</div></li><li><div>      $fcol = $this-&gt;SetTColor($color, true);&nbsp;</div></li><li><div>      $lcol = strtoupper($fcol); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// change 0 0 0 rg to 0 0 0 RG</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('q %s %s', $lcol, $fcol));&nbsp;</div></li><li><div>      $this-&gt;_out('0 j 0 J [] 0 d');&nbsp;</div></li><li><div>      if ($type == 'square') {&nbsp;</div></li><li><div>          $size *= 0.85; <span class="comment">// Smaller to appear the same size as circle/disc</span>&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('%.3F %.3F %.3F %.3F re f', ($x - $size / 2) * _MPDFK, ($this-&gt;h - $y + $size / 2) * _MPDFK, ($size) * _MPDFK, (-$size) * _MPDFK));&nbsp;</div></li><li><div>      } elseif ($type == 'disc') {&nbsp;</div></li><li><div>          $this-&gt;Circle($x, $y, $size / 2, 'F'); <span class="comment">// Fill</span>&nbsp;</div></li><li><div>      } elseif ($type == 'circle') {&nbsp;</div></li><li><div>          $lw = $size / 12; <span class="comment">// Line width</span>&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('%.3F w ', $lw * _MPDFK));&nbsp;</div></li><li><div>          $this-&gt;Circle($x, $y, $size / 2 - $lw / 2, 'S'); <span class="comment">// Stroke</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_out('Q');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Get previous character</span> and move pointers</span>&nbsp;</div></li><li><div>  function _moveToPrevChar(&$contentctr, &$charctr, $content)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $lastchar = false;&nbsp;</div></li><li><div>      $charctr--;&nbsp;</div></li><li><div>      while ($charctr &lt; 0) { <span class="comment"><span class="comment">// go back to previous $content[]</span></span>&nbsp;</div></li><li><div>          $contentctr--;&nbsp;</div></li><li><div>          if ($contentctr &lt; 0) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>              $charctr = strlen($content[$contentctr]) - 1;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $charctr = mb_strlen($content[$contentctr], $this-&gt;mb_enc) - 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $lastchar = $content[$contentctr][$charctr];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $lastchar = mb_substr($content[$contentctr], $charctr, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $lastchar;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get previous character</span>&nbsp;</div></li><li><div>  function _getPrevChar($contentctr, $charctr, $content)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $lastchar = false;&nbsp;</div></li><li><div>      $charctr--;&nbsp;</div></li><li><div>      while ($charctr &lt; 0) { <span class="comment"><span class="comment">// go back to previous $content[]</span></span>&nbsp;</div></li><li><div>          $contentctr--;&nbsp;</div></li><li><div>          if ($contentctr &lt; 0) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>              $charctr = strlen($content[$contentctr]) - 1;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $charctr = mb_strlen($content[$contentctr], $this-&gt;mb_enc) - 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $lastchar = $content[$contentctr][$charctr];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $lastchar = mb_substr($content[$contentctr], $charctr, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $lastchar;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function WriteFlowingBlock($s, $sOTLdata)&nbsp;</div></li><li><div>  { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $currentx = $this-&gt;x;&nbsp;</div></li><li><div>      $is_table = $this-&gt;flowingBlockAttr['is_table'];&nbsp;</div></li><li><div>      $table_draft = $this-&gt;flowingBlockAttr['table_draft'];&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// width</span> of all the content so far in points</span>&nbsp;</div></li><li><div>      $contentWidth = & $this-&gt;flowingBlockAttr['contentWidth'];&nbsp;</div></li><li><div>      <span class="comment">// cell width in points</span>&nbsp;</div></li><li><div>      $maxWidth = & $this-&gt;flowingBlockAttr['width'];&nbsp;</div></li><li><div>      $lineCount = & $this-&gt;flowingBlockAttr['lineCount'];&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// line height in user units</span></span>&nbsp;</div></li><li><div>      $stackHeight = & $this-&gt;flowingBlockAttr['height'];&nbsp;</div></li><li><div>      $align = & $this-&gt;flowingBlockAttr['align'];&nbsp;</div></li><li><div>      $content = & $this-&gt;flowingBlockAttr['content'];&nbsp;</div></li><li><div>      $contentB = & $this-&gt;flowingBlockAttr['contentB'];&nbsp;</div></li><li><div>      $font = & $this-&gt;flowingBlockAttr['font'];&nbsp;</div></li><li><div>      $valign = & $this-&gt;flowingBlockAttr['valign'];&nbsp;</div></li><li><div>      $blockstate = $this-&gt;flowingBlockAttr['blockstate'];&nbsp;</div></li><li><div>      $cOTLdata = & $this-&gt;flowingBlockAttr['cOTLdata']; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $newblock = $this-&gt;flowingBlockAttr['newblock'];&nbsp;</div></li><li><div>      $blockdir = $this-&gt;flowingBlockAttr['blockdir'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// ****</span>******* BLOCK BACKGROUND COLOR ***************** //</span>&nbsp;</div></li><li><div>      if ($this-&gt;blk[$this-&gt;blklvl]['bgcolor'] && !$is_table) {&nbsp;</div></li><li><div>          $fill = 0;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>          $fill = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $font[] = $this-&gt;saveFont();&nbsp;</div></li><li><div>      $content[] = '';&nbsp;</div></li><li><div>      $contentB[] = '';&nbsp;</div></li><li><div>      $cOTLdata[] = $sOTLdata; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $currContent = & $content[count($content) - 1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $CJKoverflow = false;&nbsp;</div></li><li><div>      $Oikomi = false; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $hanger = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>      if ($this-&gt;ColActive && !$is_table) {&nbsp;</div></li><li><div>          $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($is_table) {&nbsp;</div></li><li><div>          $ipaddingL = 0;&nbsp;</div></li><li><div>          $ipaddingR = 0;&nbsp;</div></li><li><div>          $paddingL = 0;&nbsp;</div></li><li><div>          $paddingR = 0;&nbsp;</div></li><li><div>          $cpaddingadjustL = 0;&nbsp;</div></li><li><div>          $cpaddingadjustR = 0;&nbsp;</div></li><li><div>          <span class="comment">// Added mPDF 3.0</span>&nbsp;</div></li><li><div>          $fpaddingR = 0;&nbsp;</div></li><li><div>          $fpaddingL = 0;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $ipaddingL = $this-&gt;blk[$this-&gt;blklvl]['padding_left'];&nbsp;</div></li><li><div>          $ipaddingR = $this-&gt;blk[$this-&gt;blklvl]['padding_right'];&nbsp;</div></li><li><div>          $paddingL = ($ipaddingL * _MPDFK);&nbsp;</div></li><li><div>          $paddingR = ($ipaddingR * _MPDFK);&nbsp;</div></li><li><div>          $this-&gt;cMarginL = $this-&gt;blk[$this-&gt;blklvl]['border_left']['w'];&nbsp;</div></li><li><div>          $cpaddingadjustL = -$this-&gt;cMarginL;&nbsp;</div></li><li><div>          $this-&gt;cMarginR = $this-&gt;blk[$this-&gt;blklvl]['border_right']['w'];&nbsp;</div></li><li><div>          $cpaddingadjustR = -$this-&gt;cMarginR;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added mPDF 3.0</span> Float DIV</span></span></span>&nbsp;</div></li><li><div>          $fpaddingR = 0;&nbsp;</div></li><li><div>          $fpaddingL = 0;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (count($this-&gt;floatDivs)) {&nbsp;</div></li><li><div>              list($l_exists, $r_exists, $l_max, $r_max, $l_width, $r_width) = $this-&gt;GetFloatDivInfo($this-&gt;blklvl);&nbsp;</div></li><li><div>              if ($r_exists) {&nbsp;</div></li><li><div>                  $fpaddingR = $r_width;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($l_exists) {&nbsp;</div></li><li><div>                  $fpaddingL = $l_width;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $usey = $this-&gt;y + 0.002;&nbsp;</div></li><li><div>          if (($newblock) && ($blockstate == 1 || $blockstate == 3) && ($lineCount == 0)) {&nbsp;</div></li><li><div>              $usey += $this-&gt;blk[$this-&gt;blklvl]['margin_top'] + $this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// If float exists at this level</span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;floatmargins['R']) && $usey &lt;= $this-&gt;floatmargins['R']['y1'] && $usey &gt;= $this-&gt;floatmargins['R']['y0'] && !$this-&gt;floatmargins['R']['skipline']) {&nbsp;</div></li><li><div>              $fpaddingR += $this-&gt;floatmargins['R']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;floatmargins['L']) && $usey &lt;= $this-&gt;floatmargins['L']['y1'] && $usey &gt;= $this-&gt;floatmargins['L']['y0'] && !$this-&gt;floatmargins['L']['skipline']) {&nbsp;</div></li><li><div>              $fpaddingL += $this-&gt;floatmargins['L']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">//OBJECTS - IMAGES & FORM Elements (NB has already skipped line/page if required - in printbuffer)</span>&nbsp;</div></li><li><div>      if (substr($s, 0, 3) == &quot;\xbb\xa4\xac&quot;) { <span class="comment"><span class="comment">//identifier has been identified!</span></span>&nbsp;</div></li><li><div>          $objattr = $this-&gt;_getObjAttr($s);&nbsp;</div></li><li><div>          $h_corr = 0;&nbsp;</div></li><li><div>          if ($is_table) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $maximumW = ($maxWidth / _MPDFK) - ($this-&gt;cellPaddingL + $this-&gt;cMarginL + $this-&gt;cellPaddingR + $this-&gt;cMarginR);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (($newblock) && ($blockstate == 1 || $blockstate == 3) && ($lineCount == 0) && (!$is_table)) {&nbsp;</div></li><li><div>                  $h_corr = $this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $maximumW = ($maxWidth / _MPDFK) - ($this-&gt;blk[$this-&gt;blklvl]['padding_left'] + $this-&gt;blk[$this-&gt;blklvl]['border_left']['w'] + $this-&gt;blk[$this-&gt;blklvl]['padding_right'] + $this-&gt;blk[$this-&gt;blklvl]['border_right']['w'] + $fpaddingL + $fpaddingR );&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $objattr = $this-&gt;inlineObject($objattr['type'], $this-&gt;lMargin + $fpaddingL + ($contentWidth / _MPDFK), ($this-&gt;y + $h_corr), $objattr, $this-&gt;lMargin, ($contentWidth / _MPDFK), $maximumW, $stackHeight, true, $is_table);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// SET LINEHEIGHT for this line ================ RESET AT END</span>&nbsp;</div></li><li><div>          $stackHeight = MAX($stackHeight, $objattr['OUTER-HEIGHT']);&nbsp;</div></li><li><div>          $this-&gt;objectbuffer[count($content) - 1] = $objattr;&nbsp;</div></li><li><div>          <span class="comment">// if (isset($objattr['vertical-align'])) { $valign = $objattr['vertical-align']; }</span>&nbsp;</div></li><li><div>          <span class="comment">// else { $valign = ''; }</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// LIST MARKERS</span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>          if ($objattr['type'] == 'image' && isset($objattr['listmarker']) && $objattr['listmarker'] && $objattr['listmarkerposition'] == 'outside') {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// do nothing</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $contentWidth += ($objattr['OUTER-WIDTH'] * _MPDFK);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $lbw = $rbw = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Border widths</span></span></span></span></span>&nbsp;</div></li><li><div>      if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>          if (isset($this-&gt;spanborddet['L']))&nbsp;</div></li><li><div>              $lbw = $this-&gt;spanborddet['L']['w'];&nbsp;</div></li><li><div>          if (isset($this-&gt;spanborddet['R']))&nbsp;</div></li><li><div>              $rbw = $this-&gt;spanborddet['R']['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $clen = strlen($s);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $clen = mb_strlen($s, $this-&gt;mb_enc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// for every character in the string</span>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $clen; $i++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// extract the current character</span>&nbsp;</div></li><li><div>          <span class="comment">// get the width of the character in points</span>&nbsp;</div></li><li><div>          if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>              $c = $s[$i];&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// Soft Hyphens</span></span> chr(173)</span>&nbsp;</div></li><li><div>              $cw = ($this-&gt;GetCharWidthCore($c) * _MPDFK);&nbsp;</div></li><li><div>              if (($this-&gt;textvar & FC_KERNING) && $i &gt; 0) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;CurrentFont['kerninfo'][$s[($i - 1)]][$c])) {&nbsp;</div></li><li><div>                      $cw += ($this-&gt;CurrentFont['kerninfo'][$s[($i - 1)]][$c] * $this-&gt;FontSizePt / 1000 );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $c = mb_substr($s, $i, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>              $cw = ($this-&gt;GetCharWidthNonCore($c, false) * _MPDFK);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment">// Use OTL GPOS</span>&nbsp;</div></li><li><div>              if (isset($this-&gt;CurrentFont['useOTL']) && ($this-&gt;CurrentFont['useOTL'] & 0xFF)) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// ...WriteFlowingBlock...</span></span>&nbsp;</div></li><li><div>                  <span class="comment">// Only  add XAdvanceL (not sure at present whether RTL or LTR writing direction)</span>&nbsp;</div></li><li><div>                  <span class="comment">// At this point, XAdvanceL and XAdvanceR will balance</span>&nbsp;</div></li><li><div>                  if (isset($sOTLdata['GPOSinfo'][$i]['XAdvanceL'])) {&nbsp;</div></li><li><div>                      $cw += $sOTLdata['GPOSinfo'][$i]['XAdvanceL'] * (1000 / $this-&gt;CurrentFont['unitsPerEm']) * ($this-&gt;FontSize / 1000) * _MPDFK;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (($this-&gt;textvar & FC_KERNING) && $i &gt; 0) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $lastc = mb_substr($s, ($i - 1), 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  $ulastc = $this-&gt;UTF8StringToArray($lastc, false);&nbsp;</div></li><li><div>                  $uc = $this-&gt;UTF8StringToArray($c, false);&nbsp;</div></li><li><div>                  if (isset($this-&gt;CurrentFont['kerninfo'][$ulastc[0]][$uc[0]])) {&nbsp;</div></li><li><div>                      $cw += ($this-&gt;CurrentFont['kerninfo'][$ulastc[0]][$uc[0]] * $this-&gt;FontSizePt / 1000 );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($i == 0) {&nbsp;</div></li><li><div>              $cw += $lbw * _MPDFK;&nbsp;</div></li><li><div>              $contentB[(count($contentB) - 1)] .= 'L';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($i == ($clen - 1)) {&nbsp;</div></li><li><div>              $cw += $rbw * _MPDFK;&nbsp;</div></li><li><div>              $contentB[(count($contentB) - 1)] .= 'R';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($c == ' ') {&nbsp;</div></li><li><div>              $currContent .= $c;&nbsp;</div></li><li><div>              $contentWidth += $cw;&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Paragraph INDENT</span></span></span></span>&nbsp;</div></li><li><div>          $WidthCorrection = 0;&nbsp;</div></li><li><div>          if (($newblock) && ($blockstate == 1 || $blockstate == 3) && isset($this-&gt;blk[$this-&gt;blklvl]['text_indent']) && ($lineCount == 0) && (!$is_table) && ($align != 'C')) {&nbsp;</div></li><li><div>              $ti = $this-&gt;ConvertSize($this-&gt;blk[$this-&gt;blklvl]['text_indent'], $this-&gt;blk[$this-&gt;blklvl]['inner_width'], $this-&gt;blk[$this-&gt;blklvl]['InlineProperties']['size'], false);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>              $WidthCorrection = ($ti * _MPDFK);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// OUTDENT</span>&nbsp;</div></li><li><div>          foreach ($this-&gt;objectbuffer AS $k =&gt; $objattr) {   <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> DOTTAB&nbsp;</div></li><li><div>              if ($objattr['type'] == 'dottab') {&nbsp;</div></li><li><div>                  $WidthCorrection -= ($objattr['outdent'] * _MPDFK);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added mPDF 3.0</span> Float DIV</span></span></span>&nbsp;</div></li><li><div>          $fpaddingR = 0;&nbsp;</div></li><li><div>          $fpaddingL = 0;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (count($this-&gt;floatDivs)) {&nbsp;</div></li><li><div>              list($l_exists, $r_exists, $l_max, $r_max, $l_width, $r_width) = $this-&gt;GetFloatDivInfo($this-&gt;blklvl);&nbsp;</div></li><li><div>              if ($r_exists) {&nbsp;</div></li><li><div>                  $fpaddingR = $r_width;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($l_exists) {&nbsp;</div></li><li><div>                  $fpaddingL = $l_width;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $usey = $this-&gt;y + 0.002;&nbsp;</div></li><li><div>          if (($newblock) && ($blockstate == 1 || $blockstate == 3) && ($lineCount == 0)) {&nbsp;</div></li><li><div>              $usey += $this-&gt;blk[$this-&gt;blklvl]['margin_top'] + $this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// If float exists at this level</span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;floatmargins['R']) && $usey &lt;= $this-&gt;floatmargins['R']['y1'] && $usey &gt;= $this-&gt;floatmargins['R']['y0'] && !$this-&gt;floatmargins['R']['skipline']) {&nbsp;</div></li><li><div>              $fpaddingR += $this-&gt;floatmargins['R']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;floatmargins['L']) && $usey &lt;= $this-&gt;floatmargins['L']['y1'] && $usey &gt;= $this-&gt;floatmargins['L']['y0'] && !$this-&gt;floatmargins['L']['skipline']) {&nbsp;</div></li><li><div>              $fpaddingL += $this-&gt;floatmargins['L']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// try adding another char</span>&nbsp;</div></li><li><div>          if (( $contentWidth + $cw &gt; $maxWidth - $WidthCorrection - (($this-&gt;cMarginL + $this-&gt;cMarginR) * _MPDFK) - ($paddingL + $paddingR + (($fpaddingL + $fpaddingR) * _MPDFK) ) + 0.001)) {<span class="comment"><span class="comment">// 0.001 is to correct for deviations converting mm=&gt;pts</span></span>&nbsp;</div></li><li><div>              <span class="comment">// it won't fit, output what we already have</span>&nbsp;</div></li><li><div>              $lineCount++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// contains any content that didn't make it into this print</span>&nbsp;</div></li><li><div>              $savedContent = '';&nbsp;</div></li><li><div>              $savedContentB = '';&nbsp;</div></li><li><div>              $savedOTLdata = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $savedFont = array();&nbsp;</div></li><li><div>              $savedObj = array();&nbsp;</div></li><li><div>              $savedPreOTLdata = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $savedPreContent = array();&nbsp;</div></li><li><div>              $savedPreContentB = array();&nbsp;</div></li><li><div>              $savedPreFont = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment">// New line-breaking algorithm</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment">// LINE BREAKING</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $breakfound = false;&nbsp;</div></li><li><div>              $contentctr = count($content) - 1;&nbsp;</div></li><li><div>              if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                  $charctr = strlen($currContent);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $charctr = mb_strlen($currContent, $this-&gt;mb_enc);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $checkchar = $c;&nbsp;</div></li><li><div>              $prevchar = $this-&gt;_getPrevChar($contentctr, $charctr, $content);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// 1) CJK Overflowing a) punctuation or b) Oikomi</span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment">// Next character ($c) is suitable to add as overhanging or squeezed punctuation, or Oikomi</span>&nbsp;</div></li><li><div>              if ($CJKoverflow || $Oikomi) { <span class="comment">// If flag already set</span>&nbsp;</div></li><li><div>                  $CJKoverflow = false;&nbsp;</div></li><li><div>                  $Oikomi = false;&nbsp;</div></li><li><div>                  $breakfound = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!$this-&gt;usingCoreFont && !$breakfound && $this-&gt;checkCJK) {&nbsp;</div></li><li><div>                  <span class="comment">// Get next/following character (in this chunk)</span>&nbsp;</div></li><li><div>                  $followingchar = '';&nbsp;</div></li><li><div>                  if ($i &lt; ($clen - 1)) {&nbsp;</div></li><li><div>                      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                          $followingchar = $s[$i + 1];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $followingchar = mb_substr($s, $i + 1, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// 1a) Overflow punctuation</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (preg_match(&quot;/[&quot; . $this-&gt;pregCJKchars . &quot;]/u&quot;, $prevchar) && preg_match(&quot;/[&quot; . $this-&gt;CJKoverflow . &quot;]/u&quot;, $checkchar) && $this-&gt;allowCJKorphans) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// add character onto this line</span></span>&nbsp;</div></li><li><div>                      $currContent .= $c;&nbsp;</div></li><li><div>                      $contentWidth += $cw;&nbsp;</div></li><li><div>                      $CJKoverflow = true; <span class="comment"><span class="comment">// Set flag</span></span>&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// 1b) Try squeezing another character(s) onto this line = Oikomi, if character cannot end line</span>&nbsp;</div></li><li><div>                  <span class="comment">//  or next character cannot start line (and not splitting CJK numerals)</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// NB otherwise it move lastchar(s) to next line to keep $c company = Oidashi, which is done below in standard way</span>&nbsp;</div></li><li><div>                  elseif (preg_match(&quot;/[&quot; . $this-&gt;pregCJKchars . &quot;]/u&quot;, $checkchar) && $this-&gt;allowCJKorphans &&&nbsp;</div></li><li><div>                      (preg_match(&quot;/[&quot; . $this-&gt;CJKleading . &quot;]/u&quot;, $followingchar) || preg_match(&quot;/[&quot; . $this-&gt;CJKfollowing . &quot;]/u&quot;, $checkchar)) &&&nbsp;</div></li><li><div>                      !preg_match(&quot;/[&quot; . $this-&gt;CJKleading . &quot;]/u&quot;, $checkchar) && !preg_match(&quot;/[&quot; . $this-&gt;CJKfollowing . &quot;]/u&quot;, $followingchar) &&&nbsp;</div></li><li><div>                      !(preg_match(&quot;/[0-9\x{ff10}-\x{ff19}]/u&quot;, $followingchar) && preg_match(&quot;/[0-9\x{ff10}-\x{ff19}]/u&quot;, $checkchar))) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// add character onto this line</span></span>&nbsp;</div></li><li><div>                      $currContent .= $c;&nbsp;</div></li><li><div>                      $contentWidth += $cw;&nbsp;</div></li><li><div>                      $Oikomi = true; <span class="comment"><span class="comment">// Set flag</span></span>&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">/** -- HYPHENATION -- */</span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment">// AUTOMATIC HYPHENATION</span>&nbsp;</div></li><li><div>              <span class="comment">// 2) Automatic hyphen in current word (does not cross tags)</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;textparam['hyphens']) && $this-&gt;textparam['hyphens'] == 1) {&nbsp;</div></li><li><div>                  $currWord = '';&nbsp;</div></li><li><div>                  <span class="comment">// Look back and ahead to get current word</span>&nbsp;</div></li><li><div>                  for ($ac = $charctr - 1; $ac &gt;= 0; $ac--) {&nbsp;</div></li><li><div>                      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                          $addc = substr($currContent, $ac, 1);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $addc = mb_substr($currContent, $ac, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($addc == ' ') {&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $currWord = $addc . $currWord;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $start = $ac + 1;&nbsp;</div></li><li><div>                  for ($ac = $i; $ac &lt; ($clen - 1); $ac++) {&nbsp;</div></li><li><div>                      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                          $addc = substr($s, $ac, 1);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $addc = mb_substr($s, $ac, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($addc == ' ') {&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $currWord .= $addc;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $ptr = $this-&gt;hyphenateWord($currWord, $charctr - $start);&nbsp;</div></li><li><div>                  if ($ptr &gt; -1) {&nbsp;</div></li><li><div>                      $breakfound = array($contentctr, $start + $ptr, $contentctr, $start + $ptr, 'hyphen');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">/** -- END HYPHENATION -- */</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Search backwards to find first line-break opportunity</span>&nbsp;</div></li><li><div>              while ($breakfound == false && $prevchar !== false) {&nbsp;</div></li><li><div>                  $cutcontentctr = $contentctr;&nbsp;</div></li><li><div>                  $cutcharctr = $charctr;&nbsp;</div></li><li><div>                  $prevchar = $this-&gt;_moveToPrevChar($contentctr, $charctr, $content);&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// 3) Break at SPACE</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($prevchar == ' ') {&nbsp;</div></li><li><div>                      $breakfound = array($contentctr, $charctr, $cutcontentctr, $cutcharctr, 'discard');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// 4) Break at U+200B in current word (Khmer, Lao & Thai Invisible word boundary, and Tibetan)</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  elseif ($prevchar == &quot;\xe2\x80\x8b&quot;) { <span class="comment">// U+200B Zero-width Word Break</span>&nbsp;</div></li><li><div>                      $breakfound = array($contentctr, $charctr, $cutcontentctr, $cutcharctr, 'discard');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// 5) Break at Hard HYPHEN '-' or U+2010</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  elseif (isset($this-&gt;textparam['hyphens']) && $this-&gt;textparam['hyphens'] != 2 && ($prevchar == '-' || $prevchar == &quot;\xe2\x80\x90&quot;)) {&nbsp;</div></li><li><div>                      <span class="comment">// Don't break a URL</span>&nbsp;</div></li><li><div>                      <span class="comment">// Look back to get first part of current word</span>&nbsp;</div></li><li><div>                      $checkw = '';&nbsp;</div></li><li><div>                      for ($ac = $charctr - 1; $ac &gt;= 0; $ac--) {&nbsp;</div></li><li><div>                          if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                              $addc = substr($currContent, $ac, 1);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $addc = mb_substr($currContent, $ac, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($addc == ' ') {&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $checkw = $addc . $checkw;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment">// Don't break if HyphenMinus AND (a URL or before a numeral or before a &gt;)</span>&nbsp;</div></li><li><div>                      if ((!preg_match('/(http:|ftp:|https:|www\.)/', $checkw) && $checkchar != '&gt;' && !preg_match('/[0-9]/', $checkchar)) || $prevchar == &quot;\xe2\x80\x90&quot;) {&nbsp;</div></li><li><div>                          $breakfound = array($cutcontentctr, $cutcharctr, $cutcontentctr, $cutcharctr, 'cut');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// 6) Break at Soft HYPHEN (replace with hard hyphen)</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  elseif (isset($this-&gt;textparam['hyphens']) && $this-&gt;textparam['hyphens'] != 2 && !$this-&gt;usingCoreFont && $prevchar == &quot;\xc2\xad&quot;) {&nbsp;</div></li><li><div>                      $breakfound = array($cutcontentctr, $cutcharctr, $cutcontentctr, $cutcharctr, 'cut');&nbsp;</div></li><li><div>                      $content[$contentctr] = mb_substr($content[$contentctr], 0, $charctr, $this-&gt;mb_enc) . '-' . mb_substr($content[$contentctr], $charctr + 1, mb_strlen($content[$contentctr]), $this-&gt;mb_enc);&nbsp;</div></li><li><div>                      if (!empty($cOTLdata[$contentctr])) {&nbsp;</div></li><li><div>                          $cOTLdata[$contentctr]['char_data'][$charctr] = array('bidi_class' =&gt; 9, 'uni' =&gt; 45);&nbsp;</div></li><li><div>                          $cOTLdata[$contentctr]['group'][$charctr] = 'C';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif (isset($this-&gt;textparam['hyphens']) && $this-&gt;textparam['hyphens'] != 2 && $this-&gt;FontFamily != 'csymbol' && $this-&gt;FontFamily != 'czapfdingbats' && $prevchar == chr(173)) {&nbsp;</div></li><li><div>                      $breakfound = array($cutcontentctr, $cutcharctr, $cutcontentctr, $cutcharctr, 'cut');&nbsp;</div></li><li><div>                      $content[$contentctr] = substr($content[$contentctr], 0, $charctr) . '-' . substr($content[$contentctr], $charctr + 1);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// 7) Break at CJK characters (unless forbidden characters to end or start line)</span>&nbsp;</div></li><li><div>                  <span class="comment">// CJK Avoiding line break in the middle of numerals</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  elseif (!$this-&gt;usingCoreFont && $this-&gt;checkCJK && preg_match(&quot;/[&quot; . $this-&gt;pregCJKchars . &quot;]/u&quot;, $checkchar) &&&nbsp;</div></li><li><div>                      !preg_match(&quot;/[&quot; . $this-&gt;CJKfollowing . &quot;]/u&quot;, $checkchar) && !preg_match(&quot;/[&quot; . $this-&gt;CJKleading . &quot;]/u&quot;, $prevchar) &&&nbsp;</div></li><li><div>                      !(preg_match(&quot;/[0-9\x{ff10}-\x{ff19}]/u&quot;, $prevchar) && preg_match(&quot;/[0-9\x{ff10}-\x{ff19}]/u&quot;, $checkchar))) {&nbsp;</div></li><li><div>                      $breakfound = array($cutcontentctr, $cutcharctr, $cutcontentctr, $cutcharctr, 'cut');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// 8) Break at OBJECT (Break before all objects here - selected objects are moved forward to next line below e.g. dottab)</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;objectbuffer[$contentctr])) {&nbsp;</div></li><li><div>                      $breakfound = array($cutcontentctr, $cutcharctr, $cutcontentctr, $cutcharctr, 'cut');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $checkchar = $prevchar;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// If a line-break opportunity found:</span>&nbsp;</div></li><li><div>              if (is_array($breakfound)) {&nbsp;</div></li><li><div>                  $contentctr = $breakfound[0];&nbsp;</div></li><li><div>                  $charctr = $breakfound[1];&nbsp;</div></li><li><div>                  $cutcontentctr = $breakfound[2];&nbsp;</div></li><li><div>                  $cutcharctr = $breakfound[3];&nbsp;</div></li><li><div>                  $type = $breakfound[4];&nbsp;</div></li><li><div>                  <span class="comment">// Cache chunks which are already processed, but now need to be passed on to the new line</span>&nbsp;</div></li><li><div>                  for ($ix = count($content) - 1; $ix &gt; $cutcontentctr; $ix--) {&nbsp;</div></li><li><div>                      <span class="comment">// save and crop off any subsequent chunks</span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if (!empty($sOTLdata)) {&nbsp;</div></li><li><div>                          $tmpOTL = array_pop($cOTLdata);&nbsp;</div></li><li><div>                          $savedPreOTLdata[] = $tmpOTL;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $savedPreContent[] = array_pop($content);&nbsp;</div></li><li><div>                      $savedPreContentB[] = array_pop($contentB);&nbsp;</div></li><li><div>                      $savedPreFont[] = array_pop($font);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Next cache the part which will start the next line</span>&nbsp;</div></li><li><div>                  if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                      $savedPreContent[] = substr($content[$cutcontentctr], $cutcharctr);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $savedPreContent[] = mb_substr($content[$cutcontentctr], $cutcharctr, mb_strlen($content[$cutcontentctr]), $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $savedPreContentB[] = preg_replace('/L/', '', $contentB[$cutcontentctr]);&nbsp;</div></li><li><div>                  $savedPreFont[] = $font[$cutcontentctr];&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (!empty($sOTLdata)) {&nbsp;</div></li><li><div>                      $savedPreOTLdata[] = $this-&gt;otl-&gt;splitOTLdata($cOTLdata[$cutcontentctr], $cutcharctr, $cutcharctr);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Finally adjust the Current content which ends this line</span>&nbsp;</div></li><li><div>                  if ($cutcharctr == 0 && $type == 'discard') {&nbsp;</div></li><li><div>                      array_pop($content);&nbsp;</div></li><li><div>                      array_pop($contentB);&nbsp;</div></li><li><div>                      array_pop($font);&nbsp;</div></li><li><div>                      array_pop($cOTLdata);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $currContent = & $content[count($content) - 1];&nbsp;</div></li><li><div>                  if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                      $currContent = substr($currContent, 0, $charctr);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $currContent = mb_substr($currContent, 0, $charctr, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (!empty($sOTLdata)) {&nbsp;</div></li><li><div>                      $savedPreOTLdata[] = $this-&gt;otl-&gt;splitOTLdata($cOTLdata[(count($cOTLdata) - 1)], mb_strlen($currContent, $this-&gt;mb_enc));&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (strpos($contentB[(count($contentB) - 1)], 'R') !== false) {   <span class="comment"><span class="comment">// ???</span></span>&nbsp;</div></li><li><div>                      $contentB[count($content) - 1] = preg_replace('/R/', '', $contentB[count($content) - 1]); <span class="comment"><span class="comment">// ???</span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($type == 'hyphen') {&nbsp;</div></li><li><div>                      $currContent .= '-';&nbsp;</div></li><li><div>                      if (!empty($cOTLdata[(count($cOTLdata) - 1)])) {&nbsp;</div></li><li><div>                          $cOTLdata[(count($cOTLdata) - 1)]['char_data'][] = array('bidi_class' =&gt; 9, 'uni' =&gt; 45);&nbsp;</div></li><li><div>                          $cOTLdata[(count($cOTLdata) - 1)]['group'] .= 'C';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $savedContent = '';&nbsp;</div></li><li><div>                  $savedContentB = '';&nbsp;</div></li><li><div>                  $savedFont = array();&nbsp;</div></li><li><div>                  $savedOTLdata = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// If no line-break opportunity found - split at current position</span>&nbsp;</div></li><li><div>              <span class="comment">// or - Next character ($c) is suitable to add as overhanging or squeezed punctuation, or Oikomi, as set above by:</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// 1) CJK Overflowing a) punctuation or b) Oikomi</span></span>&nbsp;</div></li><li><div>              <span class="comment">// in which case $breakfound==1 and NOT array</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (!is_array($breakfound)) {&nbsp;</div></li><li><div>                  $savedFont = $this-&gt;saveFont();&nbsp;</div></li><li><div>                  if (!empty($sOTLdata)) {&nbsp;</div></li><li><div>                      $savedOTLdata = $this-&gt;otl-&gt;splitOTLdata($cOTLdata[(count($cOTLdata) - 1)], mb_strlen($currContent, $this-&gt;mb_enc));&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($content[count($content) - 1] == '' && !isset($this-&gt;objectbuffer[count($content) - 1])) {&nbsp;</div></li><li><div>                  array_pop($content);&nbsp;</div></li><li><div>                  array_pop($contentB);&nbsp;</div></li><li><div>                  array_pop($font);&nbsp;</div></li><li><div>                  array_pop($cOTLdata);&nbsp;</div></li><li><div>                  $currContent = & $content[count($content) - 1];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Trim current content - including CJK space, and for OTLdata</span>&nbsp;</div></li><li><div>              <span class="comment">// incl. CJK - strip CJK space at end of line &#x3000; = \xe3\x80\x80 = CJK space</span>&nbsp;</div></li><li><div>              $currContent = rtrim($currContent);&nbsp;</div></li><li><div>              if ($this-&gt;checkCJK) {&nbsp;</div></li><li><div>                  $currContent = preg_replace(&quot;/\xe3\x80\x80$/&quot;, '', $currContent);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment">// *CJK-FONTS*</span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>                  $this-&gt;otl-&gt;trimOTLdata($cOTLdata[count($cOTLdata) - 1], false, true); <span class="comment">// NB also does U+3000</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Selected OBJECTS are moved forward to next line, unless they come before a space or U+200B (type='discard')</span>&nbsp;</div></li><li><div>              if (isset($this-&gt;objectbuffer[(count($content) - 1)]) && (!isset($type) || $type != 'discard')) {&nbsp;</div></li><li><div>                  $objtype = $this-&gt;objectbuffer[(count($content) - 1)]['type'];&nbsp;</div></li><li><div>                  if ($objtype == 'dottab' || $objtype == 'bookmark' || $objtype == 'indexentry' || $objtype == 'toc' || $objtype == 'annot') {&nbsp;</div></li><li><div>                      $savedObj = array_pop($this-&gt;objectbuffer);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Decimal alignment (cancel if wraps to &gt; 1 line)</span>&nbsp;</div></li><li><div>              if ($is_table && substr($align, 0, 1) == 'D') {&nbsp;</div></li><li><div>                  $align = substr($align, 2, 1);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $lineBox = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;_setInlineBlockHeights($lineBox, $stackHeight, $content, $font, $is_table);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// update $contentWidth since it has changed with cropping</span>&nbsp;</div></li><li><div>              $contentWidth = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $inclCursive = false;&nbsp;</div></li><li><div>              foreach ($content as $k =&gt; $chunk) {&nbsp;</div></li><li><div>                  if (isset($this-&gt;objectbuffer[$k]) && $this-&gt;objectbuffer[$k]) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// LIST MARKERS</span></span>&nbsp;</div></li><li><div>                      if ($this-&gt;objectbuffer[$k]['type'] == 'image' && isset($this-&gt;objectbuffer[$k]['listmarker']) && $this-&gt;objectbuffer[$k]['listmarker']) {&nbsp;</div></li><li><div>                          if ($this-&gt;objectbuffer[$k]['listmarkerposition'] != 'outside') {&nbsp;</div></li><li><div>                              $contentWidth += $this-&gt;objectbuffer[$k]['OUTER-WIDTH'] * _MPDFK;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $contentWidth += $this-&gt;objectbuffer[$k]['OUTER-WIDTH'] * _MPDFK;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif (!isset($this-&gt;objectbuffer[$k]) || (isset($this-&gt;objectbuffer[$k]) && !$this-&gt;objectbuffer[$k])) {&nbsp;</div></li><li><div>                      $this-&gt;restoreFont($font[$k], false);&nbsp;</div></li><li><div>                      if ($this-&gt;checkCJK && $k == count($content) - 1 && $CJKoverflow && $align == 'J' && $this-&gt;allowCJKoverflow && $this-&gt;CJKforceend) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// force-end overhang</span></span></span></span>&nbsp;</div></li><li><div>                          $hanger = mb_substr($chunk, mb_strlen($chunk, $this-&gt;mb_enc) - 1, 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                          <span class="comment">// Probably ought to do something with char_data and GPOS in cOTLdata...</span>&nbsp;</div></li><li><div>                          $content[$k] = $chunk = mb_substr($chunk, 0, mb_strlen($chunk, $this-&gt;mb_enc) - 1, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment">// Soft Hyphens</span></span> chr(173)</span> + Replace NBSP with SPACE + Set inclcursive if includes CURSIVE TEXT&nbsp;</div></li><li><div>                      if (!$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          if ((isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) || !empty($sOTLdata)) {&nbsp;</div></li><li><div>                              $this-&gt;otl-&gt;removeChar($chunk, $cOTLdata[$k], &quot;\xc2\xad&quot;);&nbsp;</div></li><li><div>                              $this-&gt;otl-&gt;replaceSpace($chunk, $cOTLdata[$k]); <span class="comment">// NBSP -&gt; space</span>&nbsp;</div></li><li><div>                              if (preg_match(&quot;/([&quot; . $this-&gt;pregCURSchars . &quot;])/u&quot;, $chunk)) {&nbsp;</div></li><li><div>                                  $inclCursive = true;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $content[$k] = $chunk;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> else {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                              $content[$k] = $chunk = str_replace(&quot;\xc2\xad&quot;, '', $chunk);&nbsp;</div></li><li><div>                              $content[$k] = $chunk = str_replace(chr(194) . chr(160), chr(32), $chunk);&nbsp;</div></li><li><div>                          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      } elseif ($this-&gt;FontFamily != 'csymbol' && $this-&gt;FontFamily != 'czapfdingbats') {&nbsp;</div></li><li><div>                          $content[$k] = $chunk = str_replace(chr(173), '', $chunk);&nbsp;</div></li><li><div>                          $content[$k] = $chunk = str_replace(chr(160), chr(32), $chunk);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $contentWidth += $this-&gt;GetStringWidth($chunk, true, (isset($cOTLdata[$k]) ? $cOTLdata[$k] : false), $this-&gt;textvar) * _MPDFK;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>                          if (isset($this-&gt;spanborddet['L']['w']) && strpos($contentB[$k], 'L') !== false)&nbsp;</div></li><li><div>                              $contentWidth += $this-&gt;spanborddet['L']['w'] * _MPDFK;&nbsp;</div></li><li><div>                          if (isset($this-&gt;spanborddet['R']['w']) && strpos($contentB[$k], 'R') !== false)&nbsp;</div></li><li><div>                              $contentWidth += $this-&gt;spanborddet['R']['w'] * _MPDFK;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $lastfontreqstyle = (isset($font[count($font) - 1]['ReqFontStyle']) ? $font[count($font) - 1]['ReqFontStyle'] : '');&nbsp;</div></li><li><div>              $lastfontstyle = (isset($font[count($font) - 1]['style']) ? $font[count($font) - 1]['style'] : '');&nbsp;</div></li><li><div>              if ($blockdir == 'ltr' && strpos($lastfontreqstyle, &quot;I&quot;) !== false && strpos($lastfontstyle, &quot;I&quot;) === false) { <span class="comment"><span class="comment"><span class="comment">// Artificial italic</span></span></span>&nbsp;</div></li><li><div>                  $lastitalic = $this-&gt;FontSize * 0.15 * _MPDFK;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $lastitalic = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// NOW FORMAT THE LINE TO OUTPUT</span>&nbsp;</div></li><li><div>              if (!$table_draft) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span> RTL&nbsp;</div></li><li><div>                  $chunkorder = range(0, count($content) - 1); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($blockdir == 'rtl' || $this-&gt;biDirectional) {&nbsp;</div></li><li><div>                      $this-&gt;otl-&gt;_bidiReorder($chunkorder, $content, $cOTLdata, $blockdir);&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// From this point on, $content and $cOTLdata may contain more elements (and re-ordered) compared to</span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// $this-&gt;objectbuffer and $font ($chunkorder contains the mapping)</span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Remove any XAdvance from OTL data at end of line</span></span>&nbsp;</div></li><li><div>                  foreach ($chunkorder AS $aord =&gt; $k) {&nbsp;</div></li><li><div>                      if (count($cOTLdata)) {&nbsp;</div></li><li><div>                          $this-&gt;restoreFont($font[$k], false);&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// ...WriteFlowingBlock...</span></span>&nbsp;</div></li><li><div>                          if ($aord == count($chunkorder) - 1 && isset($cOTLdata[$aord]['group'])) { <span class="comment"><span class="comment">// Last chunk on line</span></span>&nbsp;</div></li><li><div>                              $nGPOS = strlen($cOTLdata[$aord]['group']) - 1; <span class="comment"><span class="comment">// Last character</span></span>&nbsp;</div></li><li><div>                              if (isset($cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL']) || isset($cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceR'])) {&nbsp;</div></li><li><div>                                  if (isset($cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL'])) {&nbsp;</div></li><li><div>                                      $w = $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $w = $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceR'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $w *= ($this-&gt;FontSize / 1000);&nbsp;</div></li><li><div>                                  $contentWidth -= $w * _MPDFK;&nbsp;</div></li><li><div>                                  $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL'] = 0;&nbsp;</div></li><li><div>                                  $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceR'] = 0;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment">// If last character has an XPlacement set, adjust width calculation, and add to XAdvance to account for it</span></span>&nbsp;</div></li><li><div>                              if (isset($cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XPlacement'])) {&nbsp;</div></li><li><div>                                  $w = -$cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XPlacement'] * 1000 / $this-&gt;CurrentFont['unitsPerEm'];&nbsp;</div></li><li><div>                                  $w *= ($this-&gt;FontSize / 1000);&nbsp;</div></li><li><div>                                  $contentWidth -= $w * _MPDFK;&nbsp;</div></li><li><div>                                  $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceL'] = $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XPlacement'];&nbsp;</div></li><li><div>                                  $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XAdvanceR'] = $cOTLdata[$aord]['GPOSinfo'][$nGPOS]['XPlacement'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// JUSTIFICATION J</span>&nbsp;</div></li><li><div>                  $jcharspacing = 0;&nbsp;</div></li><li><div>                  $jws = 0;&nbsp;</div></li><li><div>                  $nb_carac = 0;&nbsp;</div></li><li><div>                  $nb_spaces = 0;&nbsp;</div></li><li><div>                  $jkashida = 0;&nbsp;</div></li><li><div>                  <span class="comment">// if it's justified, we need to find the char/word spacing (or if hanger $this-&gt;CJKforceend)</span>&nbsp;</div></li><li><div>                  if (($align == 'J' && !$CJKoverflow) || (($contentWidth + $lastitalic &gt; $maxWidth - $WidthCorrection - (($this-&gt;cMarginL + $this-&gt;cMarginR) * _MPDFK) - ($paddingL + $paddingR + (($fpaddingL + $fpaddingR) * _MPDFK) ) + 0.001) && (!$CJKoverflow || ($CJKoverflow && !$this-&gt;allowCJKoverflow))) || $CJKoverflow && $align == 'J' && $this-&gt;allowCJKoverflow && $hanger && $this-&gt;CJKforceend) {   <span class="comment"><span class="comment">// 0.001 is to correct for deviations converting mm=&gt;pts</span></span>&nbsp;</div></li><li><div>                      <span class="comment">// JUSTIFY J (Use character spacing)</span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      foreach ($chunkorder AS $aord =&gt; $k) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $chunk = $content[$aord];&nbsp;</div></li><li><div>                          if (!isset($this-&gt;objectbuffer[$k]) || (isset($this-&gt;objectbuffer[$k]) && !$this-&gt;objectbuffer[$k])) {&nbsp;</div></li><li><div>                              $nb_carac += mb_strlen($chunk, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                              $nb_spaces += mb_substr_count($chunk, ' ', $this-&gt;mb_enc);&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Use GPOS OTL</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                              if (isset($this-&gt;CurrentFont['useOTL']) && ($this-&gt;CurrentFont['useOTL'] & 0xFF)) {&nbsp;</div></li><li><div>                                  if (isset($cOTLdata[$aord]['group']) && $cOTLdata[$aord]['group']) {&nbsp;</div></li><li><div>                                      $nb_carac -= substr_count($cOTLdata[$aord]['group'], 'M');&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $nb_carac ++;&nbsp;</div></li><li><div>                          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> allow spacing for inline object&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment">// GetJSpacing adds kashida spacing to GPOSinfo if appropriate for Font</span>&nbsp;</div></li><li><div>                      list($jcharspacing, $jws, $jkashida) = $this-&gt;GetJspacing($nb_carac, $nb_spaces, ($maxWidth - $lastitalic - $contentWidth - $WidthCorrection - (($this-&gt;cMarginL + $this-&gt;cMarginR) * _MPDFK) - ($paddingL + $paddingR + (($fpaddingL + $fpaddingR) * _MPDFK) )), $inclCursive, $cOTLdata);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $empty = $maxWidth - $lastitalic - $WidthCorrection - $contentWidth - (($this-&gt;cMarginL + $this-&gt;cMarginR) * _MPDFK) - ($paddingL + $paddingR + (($fpaddingL + $fpaddingR) * _MPDFK) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $empty -= ($jcharspacing * ($nb_carac - 1)); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> nb_carac MINUS 1&nbsp;</div></li><li><div>                  $empty -= ($jws * $nb_spaces);&nbsp;</div></li><li><div>                  $empty -= ($jkashida);&nbsp;</div></li><li><div>                  $empty /= _MPDFK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $b = ''; <span class="comment">//do not use borders</span>&nbsp;</div></li><li><div>                  <span class="comment">// Get PAGEBREAK TO TEST for height including the top border/padding</span>&nbsp;</div></li><li><div>                  $check_h = max($this-&gt;divheight, $stackHeight);&nbsp;</div></li><li><div>                  if (($newblock) && ($blockstate == 1 || $blockstate == 3) && ($this-&gt;blklvl &gt; 0) && ($lineCount == 1) && (!$is_table)) {&nbsp;</div></li><li><div>                      $check_h += ($this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['margin_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;ColActive && $check_h &gt; ($this-&gt;PageBreakTrigger - $this-&gt;y0)) {&nbsp;</div></li><li><div>                      $this-&gt;SetCol($this-&gt;NbCol - 1);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// PAGEBREAK</span></span>&nbsp;</div></li><li><div>                  <span class="comment">// 'If' below used in order to fix &quot;first-line of other page with justify on&quot; bug</span>&nbsp;</div></li><li><div>                  if (!$is_table && ($this-&gt;y + $check_h) &gt; $this-&gt;PageBreakTrigger and ! $this-&gt;InFooter and $this-&gt;AcceptPageBreak()) {&nbsp;</div></li><li><div>                      $bak_x = $this-&gt;x; <span class="comment"><span class="comment"><span class="comment">//Current X position</span></span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $ws = $this-&gt;ws; <span class="comment"><span class="comment"><span class="comment">//Word Spacing</span></span></span>&nbsp;</div></li><li><div>                      $charspacing = $this-&gt;charspacing; <span class="comment"><span class="comment"><span class="comment">//Character Spacing</span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;ResetSpacing();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added to correct for OddEven Margins</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $currentx += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                      $this-&gt;x += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;SetSpacing($charspacing, $ws);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;kwt && !$is_table) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>+&nbsp;</div></li><li><div>                      $this-&gt;printkwtbuffer();&nbsp;</div></li><li><div>                      $this-&gt;kwt = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLUMN CHANGE</span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;CurrCol != $oldcolumn) {&nbsp;</div></li><li><div>                      $currentx += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                      $this-&gt;x += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                      $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;ColActive && !$is_table) {&nbsp;</div></li><li><div>                      $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// TOP</span> MARGIN</span></span>&nbsp;</div></li><li><div>                  if (($newblock) && ($blockstate == 1 || $blockstate == 3) && ($this-&gt;blk[$this-&gt;blklvl]['margin_top']) && ($lineCount == 1) && (!$is_table)) {&nbsp;</div></li><li><div>                      $this-&gt;DivLn($this-&gt;blk[$this-&gt;blklvl]['margin_top'], $this-&gt;blklvl - 1, true, $this-&gt;blk[$this-&gt;blklvl]['margin_collapse']);&nbsp;</div></li><li><div>                      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                          $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Update y0 for top of block (used to paint border)</span>&nbsp;</div></li><li><div>                  if (($newblock) && ($blockstate == 1 || $blockstate == 3) && ($lineCount == 1) && (!$is_table)) {&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['y0'] = $this-&gt;y;&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['startpage'] = $this-&gt;page;&nbsp;</div></li><li><div>                      if ($this-&gt;blk[$this-&gt;blklvl]['float']) {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['float_start_y'] = $this-&gt;y;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// TOP</span> PADDING and BORDER spacing/fill</span>&nbsp;</div></li><li><div>                  if (($newblock) && ($blockstate == 1 || $blockstate == 3) && (($this-&gt;blk[$this-&gt;blklvl]['padding_top']) || ($this-&gt;blk[$this-&gt;blklvl]['border_top'])) && ($lineCount == 1) && (!$is_table)) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $state = 0 normal; 1 top; 2 bottom; 3 top and bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;DivLn($this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w'], -3, true, false, 1);&nbsp;</div></li><li><div>                      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                          $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $arraysize = count($chunkorder);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $margins = ($this-&gt;cMarginL + $this-&gt;cMarginR) + ($ipaddingL + $ipaddingR + $fpaddingR + $fpaddingR );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// PAINT BACKGROUND FOR THIS LINE</span>&nbsp;</div></li><li><div>                  if (!$is_table) {&nbsp;</div></li><li><div>                      $this-&gt;DivLn($stackHeight, $this-&gt;blklvl, false);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment">// false -&gt; don't advance y</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $this-&gt;x = $currentx + $this-&gt;cMarginL + $ipaddingL + $fpaddingL;&nbsp;</div></li><li><div>                  if ($align == 'R') {&nbsp;</div></li><li><div>                      $this-&gt;x += $empty;&nbsp;</div></li><li><div>                  } elseif ($align == 'C') {&nbsp;</div></li><li><div>                      $this-&gt;x += ($empty / 2);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Paragraph INDENT</span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;blk[$this-&gt;blklvl]['text_indent']) && ($newblock) && ($blockstate == 1 || $blockstate == 3) && ($lineCount == 1) && (!$is_table) && ($blockdir != 'rtl') && ($align != 'C')) {&nbsp;</div></li><li><div>                      $ti = $this-&gt;ConvertSize($this-&gt;blk[$this-&gt;blklvl]['text_indent'], $this-&gt;blk[$this-&gt;blklvl]['inner_width'], $this-&gt;blk[$this-&gt;blklvl]['InlineProperties']['size'], false);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>                      $this-&gt;x += $ti;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// BIDI magic_reverse moved upwards from here</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  foreach ($chunkorder AS $aord =&gt; $k) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $chunk = $content[$aord];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (isset($this-&gt;objectbuffer[$k]) && $this-&gt;objectbuffer[$k]) {&nbsp;</div></li><li><div>                          $xadj = $this-&gt;x - $this-&gt;objectbuffer[$k]['OUTER-X'];&nbsp;</div></li><li><div>                          $this-&gt;objectbuffer[$k]['OUTER-X'] += $xadj;&nbsp;</div></li><li><div>                          $this-&gt;objectbuffer[$k]['BORDER-X'] += $xadj;&nbsp;</div></li><li><div>                          $this-&gt;objectbuffer[$k]['INNER-X'] += $xadj;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($this-&gt;objectbuffer[$k]['type'] == 'listmarker') {&nbsp;</div></li><li><div>                              $this-&gt;objectbuffer[$k]['lineBox'] = $lineBox[-1]; <span class="comment"><span class="comment">// Block element details for glyph-origin</span></span>&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $yadj = $this-&gt;y - $this-&gt;objectbuffer[$k]['OUTER-Y'];&nbsp;</div></li><li><div>                          if ($this-&gt;objectbuffer[$k]['type'] == 'dottab') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> DOTTAB&nbsp;</div></li><li><div>                              $this-&gt;objectbuffer[$k]['lineBox'] = $lineBox[$k]; <span class="comment"><span class="comment">// element details for glyph-origin</span></span>&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;objectbuffer[$k]['type'] != 'dottab') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> DOTTAB&nbsp;</div></li><li><div>                              $yadj += $lineBox[$k]['top'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;objectbuffer[$k]['OUTER-Y'] += $yadj;&nbsp;</div></li><li><div>                          $this-&gt;objectbuffer[$k]['BORDER-Y'] += $yadj;&nbsp;</div></li><li><div>                          $this-&gt;objectbuffer[$k]['INNER-Y'] += $yadj;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;restoreFont($font[$k]);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;SetSpacing(($this-&gt;fixedlSpacing * _MPDFK) + $jcharspacing, ($this-&gt;fixedlSpacing + $this-&gt;minwSpacing) * _MPDFK + $jws);&nbsp;</div></li><li><div>                      <span class="comment">// Now unset these values so they don't influence GetStringwidth below or in fn. Cell</span>&nbsp;</div></li><li><div>                      $this-&gt;fixedlSpacing = false;&nbsp;</div></li><li><div>                      $this-&gt;minwSpacing = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $save_vis = $this-&gt;visibility;&nbsp;</div></li><li><div>                      if (isset($this-&gt;textparam['visibility']) && $this-&gt;textparam['visibility'] && $this-&gt;textparam['visibility'] != $this-&gt;visibility) {&nbsp;</div></li><li><div>                          $this-&gt;SetVisibility($this-&gt;textparam['visibility']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment">// ****</span>******* SPAN BACKGROUND COLOR ***************** //</span></span>&nbsp;</div></li><li><div>                      if ($this-&gt;spanbgcolor) {&nbsp;</div></li><li><div>                          $cor = $this-&gt;spanbgcolorarray;&nbsp;</div></li><li><div>                          $this-&gt;SetFColor($cor);&nbsp;</div></li><li><div>                          $save_fill = $fill;&nbsp;</div></li><li><div>                          $spanfill = 1;&nbsp;</div></li><li><div>                          $fill = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>                          if (strpos($contentB[$k], 'L') !== false)&nbsp;</div></li><li><div>                              $this-&gt;x += (isset($this-&gt;spanborddet['L']['w']) ? $this-&gt;spanborddet['L']['w'] : 0);&nbsp;</div></li><li><div>                          if (strpos($contentB[$k], 'L') === false)&nbsp;</div></li><li><div>                              $this-&gt;spanborddet['L']['s'] = $this-&gt;spanborddet['L']['w'] = 0;&nbsp;</div></li><li><div>                          if (strpos($contentB[$k], 'R') === false)&nbsp;</div></li><li><div>                              $this-&gt;spanborddet['R']['s'] = $this-&gt;spanborddet['R']['w'] = 0;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment">// StringWidth this time includes any kashida spacing</span>&nbsp;</div></li><li><div>                      $stringWidth = $this-&gt;GetStringWidth($chunk, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $nch = mb_strlen($chunk, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Use GPOS OTL</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($this-&gt;CurrentFont['useOTL']) && ($this-&gt;CurrentFont['useOTL'] & 0xFF)) {&nbsp;</div></li><li><div>                          if (isset($cOTLdata[$aord]['group']) && $cOTLdata[$aord]['group']) {&nbsp;</div></li><li><div>                              $nch -= substr_count($cOTLdata[$aord]['group'], 'M');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $stringWidth += ( $this-&gt;charspacing * $nch / _MPDFK );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $stringWidth += ( $this-&gt;ws * mb_substr_count($chunk, ' ', $this-&gt;mb_enc) / _MPDFK );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (isset($this-&gt;objectbuffer[$k])) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// LIST MARKERS</span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>                          if ($this-&gt;objectbuffer[$k]['type'] == 'image' && isset($this-&gt;objectbuffer[$k]['listmarker']) && $this-&gt;objectbuffer[$k]['listmarker'] && $this-&gt;objectbuffer[$k]['listmarkerposition'] == 'outside') {&nbsp;</div></li><li><div>                              $stringWidth = 0;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $stringWidth = $this-&gt;objectbuffer[$k]['OUTER-WIDTH'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($stringWidth == 0) {&nbsp;</div></li><li><div>                          $stringWidth = 0.000001;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($aord == $arraysize - 1) {&nbsp;</div></li><li><div>                          $stringWidth -= ( $this-&gt;charspacing / _MPDFK );&nbsp;</div></li><li><div>                          if ($this-&gt;checkCJK && $CJKoverflow && $align == 'J' && $this-&gt;allowCJKoverflow && $hanger && $this-&gt;CJKforceend) {&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// force-end overhang</span></span></span></span>&nbsp;</div></li><li><div>                              $this-&gt;Cell($stringWidth, $stackHeight, $chunk, '', 0, '', $fill, $this-&gt;HREF, $currentx, 0, 0, 'M', $fill, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar, (isset($lineBox[$k]) ? $lineBox[$k] : false));&nbsp;</div></li><li><div>                              $this-&gt;Cell($this-&gt;GetStringWidth($hanger), $stackHeight, $hanger, '', 1, '', $fill, $this-&gt;HREF, $currentx, 0, 0, 'M', $fill, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar, (isset($lineBox[$k]) ? $lineBox[$k] : false));&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;Cell($stringWidth, $stackHeight, $chunk, '', 1, '', $fill, $this-&gt;HREF, $currentx, 0, 0, 'M', $fill, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar, (isset($lineBox[$k]) ? $lineBox[$k] : false)); <span class="comment">//mono-style line or last part (skips line)</span>&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else&nbsp;</div></li><li><div>                          $this-&gt;Cell($stringWidth, $stackHeight, $chunk, '', 0, '', $fill, $this-&gt;HREF, 0, 0, 0, 'M', $fill, true, (isset($cOTLdata[$aord]) ? $cOTLdata[$aord] : false), $this-&gt;textvar, (isset($lineBox[$k]) ? $lineBox[$k] : false)); <span class="comment">//first or middle part</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>                          if (strpos($contentB[$k], 'R') !== false && $aord != $arraysize - 1)&nbsp;</div></li><li><div>                              $this-&gt;x += $this-&gt;spanborddet['R']['w'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment">// ****</span>******* SPAN BACKGROUND COLOR OFF - RESET BLOCK BGCOLOR ***************** //</span></span>&nbsp;</div></li><li><div>                      if (isset($spanfill) && $spanfill) {&nbsp;</div></li><li><div>                          $fill = $save_fill;&nbsp;</div></li><li><div>                          $spanfill = 0;&nbsp;</div></li><li><div>                          if ($fill) {&nbsp;</div></li><li><div>                              $this-&gt;SetFColor($bcor);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (isset($this-&gt;textparam['visibility']) && $this-&gt;textparam['visibility'] && $this-&gt;visibility != $save_vis) {&nbsp;</div></li><li><div>                          $this-&gt;SetVisibility($save_vis);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ($table_draft) {&nbsp;</div></li><li><div>                  $this-&gt;y += $stackHeight;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (!$is_table) {&nbsp;</div></li><li><div>                  $this-&gt;maxPosR = max($this-&gt;maxPosR, ($this-&gt;w - $this-&gt;rMargin - $this-&gt;blk[$this-&gt;blklvl]['outer_right_margin']));&nbsp;</div></li><li><div>                  $this-&gt;maxPosL = min($this-&gt;maxPosL, ($this-&gt;lMargin + $this-&gt;blk[$this-&gt;blklvl]['outer_left_margin']));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// move on to the next line, reset variables, tack on saved content and current char</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (!$table_draft)&nbsp;</div></li><li><div>                  $this-&gt;printobjectbuffer($is_table, $blockdir);&nbsp;</div></li><li><div>              $this-&gt;objectbuffer = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// Update values if set to skipline</span></span></span>&nbsp;</div></li><li><div>              if ($this-&gt;floatmargins) {&nbsp;</div></li><li><div>                  $this-&gt;_advanceFloatMargins();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// Reset</span> lineheight</span></span>&nbsp;</div></li><li><div>              $stackHeight = $this-&gt;divheight;&nbsp;</div></li><li><div>              $valign = 'M';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $font = array();&nbsp;</div></li><li><div>              $content = array();&nbsp;</div></li><li><div>              $contentB = array();&nbsp;</div></li><li><div>              $cOTLdata = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $contentWidth = 0;&nbsp;</div></li><li><div>              if (!empty($savedObj)) {&nbsp;</div></li><li><div>                  $this-&gt;objectbuffer[] = $savedObj;&nbsp;</div></li><li><div>                  $font[] = $savedFont;&nbsp;</div></li><li><div>                  $content[] = '';&nbsp;</div></li><li><div>                  $contentB[] = '';&nbsp;</div></li><li><div>                  $cOTLdata[] = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $contentWidth += $savedObj['OUTER-WIDTH'] * _MPDFK;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (count($savedPreContent) &gt; 0) {&nbsp;</div></li><li><div>                  for ($ix = count($savedPreContent) - 1; $ix &gt;= 0; $ix--) {&nbsp;</div></li><li><div>                      $font[] = $savedPreFont[$ix];&nbsp;</div></li><li><div>                      $content[] = $savedPreContent[$ix];&nbsp;</div></li><li><div>                      $contentB[] = $savedPreContentB[$ix];&nbsp;</div></li><li><div>                      if (!empty($sOTLdata)) {&nbsp;</div></li><li><div>                          $cOTLdata[] = $savedPreOTLdata[$ix];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;restoreFont($savedPreFont[$ix]);&nbsp;</div></li><li><div>                      $lbw = $rbw = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Border widths</span></span></span></span></span>&nbsp;</div></li><li><div>                      if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>                          $lbw = (isset($this-&gt;spanborddet['L']['w']) ? $this-&gt;spanborddet['L']['w'] : 0);&nbsp;</div></li><li><div>                          $rbw = (isset($this-&gt;spanborddet['R']['w']) ? $this-&gt;spanborddet['R']['w'] : 0);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($ix &gt; 0) {&nbsp;</div></li><li><div>                          $contentWidth += $this-&gt;GetStringWidth($savedPreContent[$ix], true, (isset($savedPreOTLdata[$ix]) ? $savedPreOTLdata[$ix] : false), $this-&gt;textvar) * _MPDFK; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          if (strpos($savedPreContentB[$ix], 'L') !== false)&nbsp;</div></li><li><div>                              $contentWidth += $lbw;&nbsp;</div></li><li><div>                          if (strpos($savedPreContentB[$ix], 'R') !== false)&nbsp;</div></li><li><div>                              $contentWidth += $rbw;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $savedPreContent = array();&nbsp;</div></li><li><div>                  $savedPreContentB = array();&nbsp;</div></li><li><div>                  $savedPreOTLdata = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $savedPreFont = array();&nbsp;</div></li><li><div>                  $content[(count($content) - 1)] .= $c;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $font[] = $savedFont;&nbsp;</div></li><li><div>                  $content[] = $savedContent . $c;&nbsp;</div></li><li><div>                  $contentB[] = $savedContentB;&nbsp;</div></li><li><div>                  $cOTLdata[] = $savedOTLdata; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $currContent = & $content[(count($content) - 1)];&nbsp;</div></li><li><div>              $this-&gt;restoreFont($font[(count($font) - 1)]); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>.0</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment">// CJK - strip CJK space at start of line</span>&nbsp;</div></li><li><div>              <span class="comment">// &#x3000; = \xe3\x80\x80 = CJK space</span>&nbsp;</div></li><li><div>              if ($this-&gt;checkCJK && $currContent == &quot;\xe3\x80\x80&quot;) {&nbsp;</div></li><li><div>                  $currContent = '';&nbsp;</div></li><li><div>                  if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>                      $this-&gt;otl-&gt;trimOTLdata($cOTLdata[count($cOTLdata) - 1], true, false); <span class="comment"><span class="comment"><span class="comment">// left</span></span> trim U+3000</span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $lbw = $rbw = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Border widths</span></span></span></span></span>&nbsp;</div></li><li><div>              if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>                  $lbw = (isset($this-&gt;spanborddet['L']['w']) ? $this-&gt;spanborddet['L']['w'] : 0);&nbsp;</div></li><li><div>                  $rbw = (isset($this-&gt;spanborddet['R']['w']) ? $this-&gt;spanborddet['R']['w'] : 0);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $contentWidth += $this-&gt;GetStringWidth($currContent, false, (isset($cOTLdata[(count($cOTLdata) - 1)]) ? $cOTLdata[(count($cOTLdata) - 1)] : false), $this-&gt;textvar) * _MPDFK; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (strpos($savedContentB, 'L') !== false)&nbsp;</div></li><li><div>                  $contentWidth += $lbw;&nbsp;</div></li><li><div>              $CJKoverflow = false;&nbsp;</div></li><li><div>              $hanger = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// another character will fit, so add it on</span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $contentWidth += $cw;&nbsp;</div></li><li><div>              $currContent .= $c;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unset($content);&nbsp;</div></li><li><div>      unset($contentB);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//----------------------END OF FLOWING BLOCK------------------------------------//</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">// Update values if set to skipline</span></span></span>&nbsp;</div></li><li><div>  function _advanceFloatMargins()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Update floatmargins - L</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;floatmargins['L']) && $this-&gt;floatmargins['L']['skipline'] && $this-&gt;floatmargins['L']['y0'] != $this-&gt;y) {&nbsp;</div></li><li><div>          $yadj = $this-&gt;y - $this-&gt;floatmargins['L']['y0'];&nbsp;</div></li><li><div>          $this-&gt;floatmargins['L']['y0'] = $this-&gt;y;&nbsp;</div></li><li><div>          $this-&gt;floatmargins['L']['y1'] += $yadj;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Update objattr in floatbuffer</span></span>&nbsp;</div></li><li><div>          if ($this-&gt;floatbuffer[$this-&gt;floatmargins['L']['id']]['border_left']['w']) {&nbsp;</div></li><li><div>              $this-&gt;floatbuffer[$this-&gt;floatmargins['L']['id']]['BORDER-Y'] += $yadj;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;floatbuffer[$this-&gt;floatmargins['L']['id']]['INNER-Y'] += $yadj;&nbsp;</div></li><li><div>          $this-&gt;floatbuffer[$this-&gt;floatmargins['L']['id']]['OUTER-Y'] += $yadj;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Unset values</span></span>&nbsp;</div></li><li><div>          $this-&gt;floatbuffer[$this-&gt;floatmargins['L']['id']]['skipline'] = false;&nbsp;</div></li><li><div>          $this-&gt;floatmargins['L']['skipline'] = false;&nbsp;</div></li><li><div>          $this-&gt;floatmargins['L']['id'] = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Update floatmargins - R</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;floatmargins['R']) && $this-&gt;floatmargins['R']['skipline'] && $this-&gt;floatmargins['R']['y0'] != $this-&gt;y) {&nbsp;</div></li><li><div>          $yadj = $this-&gt;y - $this-&gt;floatmargins['R']['y0'];&nbsp;</div></li><li><div>          $this-&gt;floatmargins['R']['y0'] = $this-&gt;y;&nbsp;</div></li><li><div>          $this-&gt;floatmargins['R']['y1'] += $yadj;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Update objattr in floatbuffer</span></span>&nbsp;</div></li><li><div>          if ($this-&gt;floatbuffer[$this-&gt;floatmargins['R']['id']]['border_left']['w']) {&nbsp;</div></li><li><div>              $this-&gt;floatbuffer[$this-&gt;floatmargins['R']['id']]['BORDER-Y'] += $yadj;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;floatbuffer[$this-&gt;floatmargins['R']['id']]['INNER-Y'] += $yadj;&nbsp;</div></li><li><div>          $this-&gt;floatbuffer[$this-&gt;floatmargins['R']['id']]['OUTER-Y'] += $yadj;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Unset values</span></span>&nbsp;</div></li><li><div>          $this-&gt;floatbuffer[$this-&gt;floatmargins['R']['id']]['skipline'] = false;&nbsp;</div></li><li><div>          $this-&gt;floatmargins['R']['skipline'] = false;&nbsp;</div></li><li><div>          $this-&gt;floatmargins['R']['id'] = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _SetTextRendering($mode)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!(($mode == 0) || ($mode == 1) || ($mode == 2)))&nbsp;</div></li><li><div>          throw new MpdfException(&quot;Text rendering mode should be 0, 1 or 2 (value : $mode)&quot;);&nbsp;</div></li><li><div>      $tr = ($mode . ' Tr');&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['TextRendering']) && $this-&gt;pageoutput[$this-&gt;page]['TextRendering'] != $tr) || !isset($this-&gt;pageoutput[$this-&gt;page]['TextRendering']))) {&nbsp;</div></li><li><div>          $this-&gt;_out($tr);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page]['TextRendering'] = $tr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetTextOutline($params = array())&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (isset($params['outline-s']) && $params['outline-s']) {&nbsp;</div></li><li><div>          $this-&gt;SetLineWidth($params['outline-WIDTH']);&nbsp;</div></li><li><div>          $this-&gt;SetDColor($params['outline-COLOR']);&nbsp;</div></li><li><div>          $tr = ('2 Tr');&nbsp;</div></li><li><div>          if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['TextRendering']) && $this-&gt;pageoutput[$this-&gt;page]['TextRendering'] != $tr) || !isset($this-&gt;pageoutput[$this-&gt;page]['TextRendering']))) {&nbsp;</div></li><li><div>              $this-&gt;_out($tr);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page]['TextRendering'] = $tr;&nbsp;</div></li><li><div>      } else { <span class="comment">//Now resets all values</span>&nbsp;</div></li><li><div>          $this-&gt;SetLineWidth(0.2);&nbsp;</div></li><li><div>          $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          $this-&gt;_SetTextRendering(0);&nbsp;</div></li><li><div>          $tr = ('0 Tr');&nbsp;</div></li><li><div>          if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['TextRendering']) && $this-&gt;pageoutput[$this-&gt;page]['TextRendering'] != $tr) || !isset($this-&gt;pageoutput[$this-&gt;page]['TextRendering']))) {&nbsp;</div></li><li><div>              $this-&gt;_out($tr);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page]['TextRendering'] = $tr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Image($file, $x, $y, $w = 0, $h = 0, $type = '', $link = '', $paint = true, $constrain = true, $watermark = false, $shownoimg = true, $allowvector = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $orig_srcpath = $file;&nbsp;</div></li><li><div>      $this-&gt;GetFullPath($file);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $info = $this-&gt;_getImage($file, true, $allowvector, $orig_srcpath);&nbsp;</div></li><li><div>      if (!$info && $paint) {&nbsp;</div></li><li><div>          $info = $this-&gt;_getImage($this-&gt;noImageFile);&nbsp;</div></li><li><div>          if ($info) {&nbsp;</div></li><li><div>              $file = $this-&gt;noImageFile;&nbsp;</div></li><li><div>              $w = ($info['w'] * (25.4 / $this-&gt;dpi));  <span class="comment"><span class="comment">// 14 x 16px</span></span>&nbsp;</div></li><li><div>              $h = ($info['h'] * (25.4 / $this-&gt;dpi));  <span class="comment"><span class="comment">// 14 x 16px</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$info)&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      <span class="comment">//Automatic width and height calculation if needed</span>&nbsp;</div></li><li><div>      if ($w == 0 and $h == 0) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($info['type'] == 'wmf') {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// WMF</span> units are twips (1/20pt)</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// divide by 20 to get points</span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// divide by k to get user units</span></span>&nbsp;</div></li><li><div>              $w = abs($info['w']) / (20 * _MPDFK);&nbsp;</div></li><li><div>              $h = abs($info['h']) / (20 * _MPDFK);&nbsp;</div></li><li><div>          } else&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($info['type'] == 'svg') {&nbsp;</div></li><li><div>              <span class="comment">// returned SVG units are pts</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// divide by k to get user units</span></span> (mm)&nbsp;</div></li><li><div>              $w = abs($info['w']) / _MPDFK;&nbsp;</div></li><li><div>              $h = abs($info['h']) / _MPDFK;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Put image at default image dpi</span></span>&nbsp;</div></li><li><div>              $w = ($info['w'] / _MPDFK) * (72 / $this-&gt;img_dpi);&nbsp;</div></li><li><div>              $h = ($info['h'] / _MPDFK) * (72 / $this-&gt;img_dpi);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($w == 0)&nbsp;</div></li><li><div>          $w = abs($h * $info['w'] / $info['h']);&nbsp;</div></li><li><div>      if ($h == 0)&nbsp;</div></li><li><div>          $h = abs($w * $info['h'] / $info['w']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- WATERMARK -- */</span></span></span></span>&nbsp;</div></li><li><div>      if ($watermark) {&nbsp;</div></li><li><div>          $maxw = $this-&gt;w;&nbsp;</div></li><li><div>          $maxh = $this-&gt;h;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Size</span> = D PF or array</span>&nbsp;</div></li><li><div>          if (is_array($this-&gt;watermark_size)) {&nbsp;</div></li><li><div>              $w = $this-&gt;watermark_size[0];&nbsp;</div></li><li><div>              $h = $this-&gt;watermark_size[1];&nbsp;</div></li><li><div>          } elseif (!is_string($this-&gt;watermark_size)) {&nbsp;</div></li><li><div>              $maxw -= $this-&gt;watermark_size * 2;&nbsp;</div></li><li><div>              $maxh -= $this-&gt;watermark_size * 2;&nbsp;</div></li><li><div>              $w = $maxw;&nbsp;</div></li><li><div>              $h = abs($w * $info['h'] / $info['w']);&nbsp;</div></li><li><div>              if ($h &gt; $maxh) {&nbsp;</div></li><li><div>                  $h = $maxh;&nbsp;</div></li><li><div>                  $w = abs($h * $info['w'] / $info['h']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($this-&gt;watermark_size == 'F') {&nbsp;</div></li><li><div>              if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                  $maxw = $this-&gt;w - ($this-&gt;DeflMargin + $this-&gt;DefrMargin);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $maxw = $this-&gt;pgwidth;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $maxh = $this-&gt;h - ($this-&gt;tMargin + $this-&gt;bMargin);&nbsp;</div></li><li><div>              $w = $maxw;&nbsp;</div></li><li><div>              $h = abs($w * $info['h'] / $info['w']);&nbsp;</div></li><li><div>              if ($h &gt; $maxh) {&nbsp;</div></li><li><div>                  $h = $maxh;&nbsp;</div></li><li><div>                  $w = abs($h * $info['w'] / $info['h']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($this-&gt;watermark_size == 'P') { <span class="comment">// Default P</span>&nbsp;</div></li><li><div>              $w = $maxw;&nbsp;</div></li><li><div>              $h = abs($w * $info['h'] / $info['w']);&nbsp;</div></li><li><div>              if ($h &gt; $maxh) {&nbsp;</div></li><li><div>                  $h = $maxh;&nbsp;</div></li><li><div>                  $w = abs($h * $info['w'] / $info['h']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Automatically resize to maximum dimensions of page if too large</span></span>&nbsp;</div></li><li><div>          if ($w &gt; $maxw) {&nbsp;</div></li><li><div>              $w = $maxw;&nbsp;</div></li><li><div>              $h = abs($w * $info['h'] / $info['w']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($h &gt; $maxh) {&nbsp;</div></li><li><div>              $h = $maxh;&nbsp;</div></li><li><div>              $w = abs($h * $info['w'] / $info['h']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Position</span>&nbsp;</div></li><li><div>          if (is_array($this-&gt;watermark_pos)) {&nbsp;</div></li><li><div>              $x = $this-&gt;watermark_pos[0];&nbsp;</div></li><li><div>              $y = $this-&gt;watermark_pos[1];&nbsp;</div></li><li><div>          } elseif ($this-&gt;watermark_pos == 'F') { <span class="comment">// centred on printable area</span>&nbsp;</div></li><li><div>              if ($this-&gt;ColActive) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (($this-&gt;mirrorMargins) && (($this-&gt;page) % 2 == 0)) {&nbsp;</div></li><li><div>                      $xadj = $this-&gt;DeflMargin - $this-&gt;DefrMargin;&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $xadj = 0;&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $x = ($this-&gt;DeflMargin - $xadj + ($this-&gt;w - ($this-&gt;DeflMargin + $this-&gt;DefrMargin)) / 2) - ($w / 2); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              else {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $x = ($this-&gt;lMargin + ($this-&gt;pgwidth) / 2) - ($w / 2);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $y = ($this-&gt;tMargin + ($this-&gt;h - ($this-&gt;tMargin + $this-&gt;bMargin)) / 2) - ($h / 2);&nbsp;</div></li><li><div>          } else { <span class="comment">// default P - centred on whole page</span>&nbsp;</div></li><li><div>              $x = ($this-&gt;w / 2) - ($w / 2);&nbsp;</div></li><li><div>              $y = ($this-&gt;h / 2) - ($h / 2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($info['type'] == 'wmf') {&nbsp;</div></li><li><div>              $sx = $w * _MPDFK / $info['w'];&nbsp;</div></li><li><div>              $sy = -$h * _MPDFK / $info['h'];&nbsp;</div></li><li><div>              $outstring = sprintf('q %.3F 0 0 %.3F %.3F %.3F cm /FO%d Do Q', $sx, $sy, $x * _MPDFK - $sx * $info['x'], (($this-&gt;h - $y) * _MPDFK) - $sy * $info['y'], $info['i']);&nbsp;</div></li><li><div>          } else&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($info['type'] == 'svg') {&nbsp;</div></li><li><div>              $sx = $w * _MPDFK / $info['w'];&nbsp;</div></li><li><div>              $sy = -$h * _MPDFK / $info['h'];&nbsp;</div></li><li><div>              $outstring = sprintf('q %.3F 0 0 %.3F %.3F %.3F cm /FO%d Do Q', $sx, $sy, $x * _MPDFK - $sx * $info['x'], (($this-&gt;h - $y) * _MPDFK) - $sy * $info['y'], $info['i']);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $outstring = sprintf(&quot;q %.3F 0 0 %.3F %.3F %.3F cm /I%d Do Q&quot;, $w * _MPDFK, $h * _MPDFK, $x * _MPDFK, ($this-&gt;h - ($y + $h)) * _MPDFK, $info['i']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;watermarkImgBehind) {&nbsp;</div></li><li><div>              $outstring = $this-&gt;watermarkImgAlpha . &quot;\n&quot; . $outstring . &quot;\n&quot; . $this-&gt;SetAlpha(1, 'Normal', true) . &quot;\n&quot;;&nbsp;</div></li><li><div>              $this-&gt;pages[$this-&gt;page] = preg_replace('/(___BACKGROUND___PATTERNS' . $this-&gt;uniqstr . ')/', &quot;\n&quot; . $outstring . &quot;\n&quot; . '\\1', $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out($outstring);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      } <span class="comment">// end of IF watermark</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END WATERMARK -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($constrain) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Automatically resize to maximum dimensions of page if too large</span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['inner_width']) && $this-&gt;blk[$this-&gt;blklvl]['inner_width']) {&nbsp;</div></li><li><div>              $maxw = $this-&gt;blk[$this-&gt;blklvl]['inner_width'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $maxw = $this-&gt;pgwidth;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($w &gt; $maxw) {&nbsp;</div></li><li><div>              $w = $maxw;&nbsp;</div></li><li><div>              $h = abs($w * $info['h'] / $info['w']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($h &gt; $this-&gt;h - ($this-&gt;tMargin + $this-&gt;bMargin + 1)) {  <span class="comment">// see below - +10 to avoid drawing too close to border of page</span>&nbsp;</div></li><li><div>              $h = $this-&gt;h - ($this-&gt;tMargin + $this-&gt;bMargin + 1);&nbsp;</div></li><li><div>              if ($this-&gt;fullImageHeight) {&nbsp;</div></li><li><div>                  $h = $this-&gt;fullImageHeight;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $w = abs($h * $info['w'] / $info['h']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">//Avoid drawing out of the paper(exceeding width limits).</span>&nbsp;</div></li><li><div>          <span class="comment">//if ( ($x + $w) &gt; $this-&gt;fw ) {</span>&nbsp;</div></li><li><div>          if (($x + $w) &gt; $this-&gt;w) {&nbsp;</div></li><li><div>              $x = $this-&gt;lMargin;&nbsp;</div></li><li><div>              $y += 5;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $changedpage = false;&nbsp;</div></li><li><div>          $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>          <span class="comment">//Avoid drawing out of the page.</span>&nbsp;</div></li><li><div>          if ($y + $h &gt; $this-&gt;PageBreakTrigger and ! $this-&gt;InFooter and $this-&gt;AcceptPageBreak()) {&nbsp;</div></li><li><div>              $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added to correct for OddEven Margins</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $x = $x + $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>              $y = $this-&gt;tMargin; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>              $changedpage = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLUMN CHANGE</span></span></span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;CurrCol != $oldcolumn) {&nbsp;</div></li><li><div>              $y = $this-&gt;y0;&nbsp;</div></li><li><div>              $x += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>              $this-&gt;x += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } <span class="comment">// end of IF constrain</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($info['type'] == 'wmf') {&nbsp;</div></li><li><div>          $sx = $w * _MPDFK / $info['w'];&nbsp;</div></li><li><div>          $sy = -$h * _MPDFK / $info['h'];&nbsp;</div></li><li><div>          $outstring = sprintf('q %.3F 0 0 %.3F %.3F %.3F cm /FO%d Do Q', $sx, $sy, $x * _MPDFK - $sx * $info['x'], (($this-&gt;h - $y) * _MPDFK) - $sy * $info['y'], $info['i']);&nbsp;</div></li><li><div>      } else&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($info['type'] == 'svg') {&nbsp;</div></li><li><div>          $sx = $w * _MPDFK / $info['w'];&nbsp;</div></li><li><div>          $sy = -$h * _MPDFK / $info['h'];&nbsp;</div></li><li><div>          $outstring = sprintf('q %.3F 0 0 %.3F %.3F %.3F cm /FO%d Do Q', $sx, $sy, $x * _MPDFK - $sx * $info['x'], (($this-&gt;h - $y) * _MPDFK) - $sy * $info['y'], $info['i']);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $outstring = sprintf(&quot;q %.3F 0 0 %.3F %.3F %.3F cm /I%d Do Q&quot;, $w * _MPDFK, $h * _MPDFK, $x * _MPDFK, ($this-&gt;h - ($y + $h)) * _MPDFK, $info['i']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($paint) {&nbsp;</div></li><li><div>          $this-&gt;_out($outstring);&nbsp;</div></li><li><div>          if ($link)&nbsp;</div></li><li><div>              $this-&gt;Link($x, $y, $w, $h, $link);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Avoid writing text on top of the image. // THIS WAS OUTSIDE THE if ($paint) bit!!!!!!!!!!!!!!!!</span>&nbsp;</div></li><li><div>          $this-&gt;y = $y + $h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Return width-height array</span></span>&nbsp;</div></li><li><div>      $sizesarray['WIDTH'] = $w;&nbsp;</div></li><li><div>      $sizesarray['HEIGHT'] = $h;&nbsp;</div></li><li><div>      $sizesarray['X'] = $x; <span class="comment"><span class="comment">//Position before painting image</span></span>&nbsp;</div></li><li><div>      $sizesarray['Y'] = $y; <span class="comment"><span class="comment">//Position before painting image</span></span>&nbsp;</div></li><li><div>      $sizesarray['OUTPUT'] = $outstring;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $sizesarray['IMAGE_ID'] = $info['i'];&nbsp;</div></li><li><div>      $sizesarray['itype'] = $info['type'];&nbsp;</div></li><li><div>      $sizesarray['set-dpi'] = (isset($info['set-dpi']) ? $info['set-dpi'] : 0);&nbsp;</div></li><li><div>      return $sizesarray;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _getObjAttr($t)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $c = explode(&quot;\xbb\xa4\xac&quot;, $t, 2);&nbsp;</div></li><li><div>      $c = explode(&quot;, &quot;, $c[1], 2);&nbsp;</div></li><li><div>      foreach ($c as $v) {&nbsp;</div></li><li><div>          $v = explode(&quot;=&quot;, $v, 2);&nbsp;</div></li><li><div>          $sp[$v[0]] = $v[1];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return (unserialize($sp['objattr']));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function inlineObject($type, $x, $y, $objattr, $Lmargin, $widthUsed, $maxWidth, $lineHeight, $paint = false, $is_table = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($is_table) {&nbsp;</div></li><li><div>          $k = $this-&gt;shrin_k;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $k = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// NB $x is only used when paint=true</span>&nbsp;</div></li><li><div>      <span class="comment">// Lmargin not used</span>&nbsp;</div></li><li><div>      $w = 0;&nbsp;</div></li><li><div>      if (isset($objattr['width'])) {&nbsp;</div></li><li><div>          $w = $objattr['width'] / $k;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $h = 0;&nbsp;</div></li><li><div>      if (isset($objattr['height'])) {&nbsp;</div></li><li><div>          $h = abs($objattr['height'] / $k);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $widthLeft = $maxWidth - $widthUsed;&nbsp;</div></li><li><div>      $maxHeight = $this-&gt;h - ($this-&gt;tMargin + $this-&gt;bMargin + 10);&nbsp;</div></li><li><div>      if ($this-&gt;fullImageHeight) {&nbsp;</div></li><li><div>          $maxHeight = $this-&gt;fullImageHeight;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// For Images</span></span>&nbsp;</div></li><li><div>      if (isset($objattr['border_left'])) {&nbsp;</div></li><li><div>          $extraWidth = ($objattr['border_left']['w'] + $objattr['border_right']['w'] + $objattr['margin_left'] + $objattr['margin_right']) / $k;&nbsp;</div></li><li><div>          $extraHeight = ($objattr['border_top']['w'] + $objattr['border_bottom']['w'] + $objattr['margin_top'] + $objattr['margin_bottom']) / $k;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($type == 'image' || $type == 'barcode' || $type == 'textcircle') {&nbsp;</div></li><li><div>              $extraWidth += ($objattr['padding_left'] + $objattr['padding_right']) / $k;&nbsp;</div></li><li><div>              $extraHeight += ($objattr['padding_top'] + $objattr['padding_bottom']) / $k;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!isset($objattr['vertical-align'])) {&nbsp;</div></li><li><div>          if ($objattr['type'] == 'select') {&nbsp;</div></li><li><div>              $objattr['vertical-align'] = 'M';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $objattr['vertical-align'] = 'BS';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($type == 'image' || (isset($objattr['subtype']) && $objattr['subtype'] == 'IMAGE')) {&nbsp;</div></li><li><div>          if (isset($objattr['itype']) && ($objattr['itype'] == 'wmf' || $objattr['itype'] == 'svg')) {&nbsp;</div></li><li><div>              $file = $objattr['file'];&nbsp;</div></li><li><div>              $info = $this-&gt;formobjects[$file];&nbsp;</div></li><li><div>          } elseif (isset($objattr['file'])) {&nbsp;</div></li><li><div>              $file = $objattr['file'];&nbsp;</div></li><li><div>              $info = $this-&gt;images[$file];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($type == 'annot' || $type == 'bookmark' || $type == 'indexentry' || $type == 'toc') {&nbsp;</div></li><li><div>          $w = 0.00001;&nbsp;</div></li><li><div>          $h = 0.00001;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// TEST whether need to skipline</span>&nbsp;</div></li><li><div>      if (!$paint) {&nbsp;</div></li><li><div>          if ($type == 'hr') { <span class="comment">// always force new line</span>&nbsp;</div></li><li><div>              if (($y + $h + $lineHeight &gt; $this-&gt;PageBreakTrigger) && !$this-&gt;InFooter && !$is_table) {&nbsp;</div></li><li><div>                  return array(-2, $w, $h);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment">// New page + new line</span></span>&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  return array(1, $w, $h);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment">// new line</span></span></span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// LIST MARKERS</span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>              $displayheight = $h;&nbsp;</div></li><li><div>              $displaywidth = $w;&nbsp;</div></li><li><div>              if ($objattr['type'] == 'image' && isset($objattr['listmarker']) && $objattr['listmarker']) {&nbsp;</div></li><li><div>                  $displayheight = 0;&nbsp;</div></li><li><div>                  if ($objattr['listmarkerposition'] == 'outside') {&nbsp;</div></li><li><div>                      $displaywidth = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($widthUsed &gt; 0 && $displaywidth &gt; $widthLeft && (!$is_table || $type != 'image')) {  <span class="comment">// New line needed</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>                  if (($y + $displayheight + $lineHeight &gt; $this-&gt;PageBreakTrigger) && !$this-&gt;InFooter) {&nbsp;</div></li><li><div>                      return array(-2, $w, $h);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment">// New page + new line</span></span>&nbsp;</div></li><li><div>                  return array(1, $w, $h); <span class="comment"><span class="comment"><span class="comment">// new line</span></span></span>&nbsp;</div></li><li><div>              } elseif ($widthUsed &gt; 0 && $displaywidth &gt; $widthLeft && $is_table) {  <span class="comment">// New line needed</span> in TABLE&nbsp;</div></li><li><div>                  return array(1, $w, $h); <span class="comment"><span class="comment"><span class="comment">// new line</span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// Will fit on line but NEW PAGE REQUIRED</span>&nbsp;</div></li><li><div>              elseif (($y + $displayheight &gt; $this-&gt;PageBreakTrigger) && !$this-&gt;InFooter && !$is_table) {&nbsp;</div></li><li><div>                  return array(-1, $w, $h);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  return array(0, $w, $h);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($type == 'annot' || $type == 'bookmark' || $type == 'indexentry' || $type == 'toc') {&nbsp;</div></li><li><div>          $w = 0.00001;&nbsp;</div></li><li><div>          $h = 0.00001;&nbsp;</div></li><li><div>          $objattr['BORDER-WIDTH'] = 0;&nbsp;</div></li><li><div>          $objattr['BORDER-HEIGHT'] = 0;&nbsp;</div></li><li><div>          $objattr['BORDER-X'] = $x;&nbsp;</div></li><li><div>          $objattr['BORDER-Y'] = $y;&nbsp;</div></li><li><div>          $objattr['INNER-WIDTH'] = 0;&nbsp;</div></li><li><div>          $objattr['INNER-HEIGHT'] = 0;&nbsp;</div></li><li><div>          $objattr['INNER-X'] = $x;&nbsp;</div></li><li><div>          $objattr['INNER-Y'] = $y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($type == 'image') {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Automatically resize to width remaining</span></span></span>&nbsp;</div></li><li><div>          if ($w &gt; ($widthLeft + 0.0001) && !$is_table) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>  0.0001 to allow for rounding errors when w==maxWidth&nbsp;</div></li><li><div>              $w = $widthLeft;&nbsp;</div></li><li><div>              $h = abs($w * $info['h'] / $info['w']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $img_w = $w - $extraWidth;&nbsp;</div></li><li><div>          $img_h = $h - $extraHeight;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $objattr['BORDER-WIDTH'] = $img_w + $objattr['padding_left'] / $k + $objattr['padding_right'] / $k + (($objattr['border_left']['w'] / $k + $objattr['border_right']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['BORDER-HEIGHT'] = $img_h + $objattr['padding_top'] / $k + $objattr['padding_bottom'] / $k + (($objattr['border_top']['w'] / $k + $objattr['border_bottom']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['BORDER-X'] = $x + $objattr['margin_left'] / $k + (($objattr['border_left']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['BORDER-Y'] = $y + $objattr['margin_top'] / $k + (($objattr['border_top']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['INNER-WIDTH'] = $img_w;&nbsp;</div></li><li><div>          $objattr['INNER-HEIGHT'] = $img_h;&nbsp;</div></li><li><div>          $objattr['INNER-X'] = $x + $objattr['padding_left'] / $k + $objattr['margin_left'] / $k + ($objattr['border_left']['w'] / $k);&nbsp;</div></li><li><div>          $objattr['INNER-Y'] = $y + $objattr['padding_top'] / $k + $objattr['margin_top'] / $k + ($objattr['border_top']['w'] / $k);&nbsp;</div></li><li><div>          $objattr['ID'] = $info['i'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($type == 'input' && $objattr['subtype'] == 'IMAGE') {&nbsp;</div></li><li><div>          $img_w = $w - $extraWidth;&nbsp;</div></li><li><div>          $img_h = $h - $extraHeight;&nbsp;</div></li><li><div>          $objattr['BORDER-WIDTH'] = $img_w + (($objattr['border_left']['w'] / $k + $objattr['border_right']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['BORDER-HEIGHT'] = $img_h + (($objattr['border_top']['w'] / $k + $objattr['border_bottom']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['BORDER-X'] = $x + $objattr['margin_left'] / $k + (($objattr['border_left']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['BORDER-Y'] = $y + $objattr['margin_top'] / $k + (($objattr['border_top']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['INNER-WIDTH'] = $img_w;&nbsp;</div></li><li><div>          $objattr['INNER-HEIGHT'] = $img_h;&nbsp;</div></li><li><div>          $objattr['INNER-X'] = $x + $objattr['margin_left'] / $k + ($objattr['border_left']['w'] / $k);&nbsp;</div></li><li><div>          $objattr['INNER-Y'] = $y + $objattr['margin_top'] / $k + ($objattr['border_top']['w'] / $k);&nbsp;</div></li><li><div>          $objattr['ID'] = $info['i'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($type == 'barcode' || $type == 'textcircle') {&nbsp;</div></li><li><div>          $b_w = $w - $extraWidth;&nbsp;</div></li><li><div>          $b_h = $h - $extraHeight;&nbsp;</div></li><li><div>          $objattr['BORDER-WIDTH'] = $b_w + $objattr['padding_left'] / $k + $objattr['padding_right'] / $k + (($objattr['border_left']['w'] / $k + $objattr['border_right']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['BORDER-HEIGHT'] = $b_h + $objattr['padding_top'] / $k + $objattr['padding_bottom'] / $k + (($objattr['border_top']['w'] / $k + $objattr['border_bottom']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['BORDER-X'] = $x + $objattr['margin_left'] / $k + (($objattr['border_left']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['BORDER-Y'] = $y + $objattr['margin_top'] / $k + (($objattr['border_top']['w'] / $k) / 2);&nbsp;</div></li><li><div>          $objattr['INNER-X'] = $x + $objattr['padding_left'] / $k + $objattr['margin_left'] / $k + ($objattr['border_left']['w'] / $k);&nbsp;</div></li><li><div>          $objattr['INNER-Y'] = $y + $objattr['padding_top'] / $k + $objattr['margin_top'] / $k + ($objattr['border_top']['w'] / $k);&nbsp;</div></li><li><div>          $objattr['INNER-WIDTH'] = $b_w;&nbsp;</div></li><li><div>          $objattr['INNER-HEIGHT'] = $b_h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($type == 'textarea') {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Automatically resize to width remaining</span></span></span>&nbsp;</div></li><li><div>          if ($w &gt; $widthLeft && !$is_table) {&nbsp;</div></li><li><div>              $w = $widthLeft;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// This used to resize height to maximum remaining on page ? why. Causes problems when in table and causing a new column</span>&nbsp;</div></li><li><div>          <span class="comment">//    if (($y + $h &gt; $this-&gt;PageBreakTrigger) && !$this-&gt;InFooter) {</span>&nbsp;</div></li><li><div>          <span class="comment">//        $h=$this-&gt;h - $y - $this-&gt;bMargin;</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//    }</span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($type == 'hr') {&nbsp;</div></li><li><div>          if ($is_table) {&nbsp;</div></li><li><div>              $objattr['INNER-WIDTH'] = $maxWidth * $objattr['W-PERCENT'] / 100;&nbsp;</div></li><li><div>              $objattr['width'] = $objattr['INNER-WIDTH'];&nbsp;</div></li><li><div>              $w = $maxWidth;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ($w &gt; $maxWidth) {&nbsp;</div></li><li><div>                  $w = $maxWidth;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $objattr['INNER-WIDTH'] = $w;&nbsp;</div></li><li><div>              $w = $maxWidth;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (($type == 'select') || ($type == 'input' && ($objattr['subtype'] == 'TEXT' || $objattr['subtype'] == 'PASSWORD'))) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Automatically resize to width remaining</span></span></span>&nbsp;</div></li><li><div>          if ($w &gt; $widthLeft && !$is_table) {&nbsp;</div></li><li><div>              $w = $widthLeft;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($type == 'textarea' || $type == 'select' || $type == 'input') {&nbsp;</div></li><li><div>          if (isset($objattr['fontsize']))&nbsp;</div></li><li><div>              $objattr['fontsize'] /= $k;&nbsp;</div></li><li><div>          if (isset($objattr['linewidth']))&nbsp;</div></li><li><div>              $objattr['linewidth'] /= $k;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!isset($objattr['BORDER-Y'])) {&nbsp;</div></li><li><div>          $objattr['BORDER-Y'] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($objattr['BORDER-X'])) {&nbsp;</div></li><li><div>          $objattr['BORDER-X'] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($objattr['INNER-Y'])) {&nbsp;</div></li><li><div>          $objattr['INNER-Y'] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($objattr['INNER-X'])) {&nbsp;</div></li><li><div>          $objattr['INNER-X'] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Return width-height array</span></span>&nbsp;</div></li><li><div>      $objattr['OUTER-WIDTH'] = $w;&nbsp;</div></li><li><div>      $objattr['OUTER-HEIGHT'] = $h;&nbsp;</div></li><li><div>      $objattr['OUTER-X'] = $x;&nbsp;</div></li><li><div>      $objattr['OUTER-Y'] = $y;&nbsp;</div></li><li><div>      return $objattr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===============================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetLineJoin($mode = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = sprintf('%d j', $mode);&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['LineJoin']) && $this-&gt;pageoutput[$this-&gt;page]['LineJoin'] != $s) || !isset($this-&gt;pageoutput[$this-&gt;page]['LineJoin']))) {&nbsp;</div></li><li><div>          $this-&gt;_out($s);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page]['LineJoin'] = $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetLineCap($mode = 2)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = sprintf('%d J', $mode);&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['LineCap']) && $this-&gt;pageoutput[$this-&gt;page]['LineCap'] != $s) || !isset($this-&gt;pageoutput[$this-&gt;page]['LineCap']))) {&nbsp;</div></li><li><div>          $this-&gt;_out($s);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page]['LineCap'] = $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDash($black = false, $white = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($black and $white)&nbsp;</div></li><li><div>          $s = sprintf('[%.3F %.3F] 0 d', $black * _MPDFK, $white * _MPDFK);&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $s = '[] 0 d';&nbsp;</div></li><li><div>      if ($this-&gt;page &gt; 0 && ((isset($this-&gt;pageoutput[$this-&gt;page]['Dash']) && $this-&gt;pageoutput[$this-&gt;page]['Dash'] != $s) || !isset($this-&gt;pageoutput[$this-&gt;page]['Dash']))) {&nbsp;</div></li><li><div>          $this-&gt;_out($s);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page]['Dash'] = $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDisplayPreferences($preferences)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// String containing any or none of /HideMenubar/HideToolbar/HideWindowUI/DisplayDocTitle/CenterWindow/FitWindow</span>&nbsp;</div></li><li><div>      $this-&gt;DisplayPreferences .= $preferences;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Ln($h = '', $collapsible = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Added collapsible to allow collapsible top-margin on new page</span>&nbsp;</div></li><li><div>      <span class="comment">//Line feed; default value is last cell height</span>&nbsp;</div></li><li><div>      $this-&gt;x = $this-&gt;lMargin + $this-&gt;blk[$this-&gt;blklvl]['outer_left_margin'];&nbsp;</div></li><li><div>      if ($collapsible && ($this-&gt;y == $this-&gt;tMargin) && (!$this-&gt;ColActive)) {&nbsp;</div></li><li><div>          $h = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (is_string($h))&nbsp;</div></li><li><div>          $this-&gt;y+=$this-&gt;lasth;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $this-&gt;y+=$h;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function DivLn($h, $level = -3, $move_y = true, $collapsible = false, $state = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $state = 0 normal; 1 top; 2 bottom; 3 top and bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Used in Columns and keep-with-table i.e. &quot;kwt&quot;</span>&nbsp;</div></li><li><div>      <span class="comment">// writes background block by block so it can be repositioned</span>&nbsp;</div></li><li><div>      <span class="comment">// and also used in writingFlowingBlock at top and bottom of blocks to move y (not to draw/paint anything)</span>&nbsp;</div></li><li><div>      <span class="comment">// adds lines (y) where DIV bgcolors are filled in</span>&nbsp;</div></li><li><div>      <span class="comment">// this-&gt;x is returned as it was</span>&nbsp;</div></li><li><div>      <span class="comment">// allows .00001 as nominal height used for bookmarks/annotations etc.</span>&nbsp;</div></li><li><div>      if ($collapsible && (sprintf(&quot;%0.4f&quot;, $this-&gt;y) == sprintf(&quot;%0.4f&quot;, $this-&gt;tMargin)) && (!$this-&gt;ColActive)) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Columns&nbsp;</div></li><li><div>      //   if ($collapsible && (sprintf(&quot;%0.4f&quot;, $this-&gt;y)==sprintf(&quot;%0.4f&quot;, $this-&gt;y0)) && ($this-&gt;ColActive) && $this-&gt;CurrCol == 0) { return; }    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($collapsible && (sprintf(&quot;%0.4f&quot;, $this-&gt;y) == sprintf(&quot;%0.4f&quot;, $this-&gt;y0)) && ($this-&gt;ColActive)) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Still use this method if columns or keep-with-table, as it allows repositioning later</span>&nbsp;</div></li><li><div>      <span class="comment">// otherwise, now uses PaintDivBB()</span>&nbsp;</div></li><li><div>      if (!$this-&gt;ColActive && !$this-&gt;kwt) {&nbsp;</div></li><li><div>          if ($move_y && !$this-&gt;ColActive) {&nbsp;</div></li><li><div>              $this-&gt;y += $h;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($level == -3) {&nbsp;</div></li><li><div>          $level = $this-&gt;blklvl;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $firstblockfill = $this-&gt;GetFirstBlockFill();&nbsp;</div></li><li><div>      if ($firstblockfill && $this-&gt;blklvl &gt; 0 && $this-&gt;blklvl &gt;= $firstblockfill) {&nbsp;</div></li><li><div>          $last_x = 0;&nbsp;</div></li><li><div>          $last_w = 0;&nbsp;</div></li><li><div>          $last_fc = $this-&gt;FillColor;&nbsp;</div></li><li><div>          $bak_x = $this-&gt;x;&nbsp;</div></li><li><div>          $bak_h = $this-&gt;divheight;&nbsp;</div></li><li><div>          $this-&gt;divheight = 0; <span class="comment">// Temporarily turn off divheight - as Cell() uses it to check for PageBreak</span>&nbsp;</div></li><li><div>          for ($blvl = $firstblockfill; $blvl &lt;= $level; $blvl++) {&nbsp;</div></li><li><div>              $this-&gt;x = $this-&gt;lMargin + $this-&gt;blk[$blvl]['outer_left_margin'];&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($this-&gt;blk[$blvl]['bgcolor']) {&nbsp;</div></li><li><div>                  $this-&gt;SetFColor($this-&gt;blk[$blvl]['bgcolorarray']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($last_x != ($this-&gt;lMargin + $this-&gt;blk[$blvl]['outer_left_margin']) || ($last_w != $this-&gt;blk[$blvl]['width']) || $last_fc != $this-&gt;FillColor || (isset($this-&gt;blk[$blvl]['border_top']['s']) && $this-&gt;blk[$blvl]['border_top']['s']) || (isset($this-&gt;blk[$blvl]['border_bottom']['s']) && $this-&gt;blk[$blvl]['border_bottom']['s']) || (isset($this-&gt;blk[$blvl]['border_left']['s']) && $this-&gt;blk[$blvl]['border_left']['s']) || (isset($this-&gt;blk[$blvl]['border_right']['s']) && $this-&gt;blk[$blvl]['border_right']['s'])) {&nbsp;</div></li><li><div>                  $x = $this-&gt;x;&nbsp;</div></li><li><div>                  $this-&gt;Cell(($this-&gt;blk[$blvl]['width']), $h, '', '', 0, '', 1);&nbsp;</div></li><li><div>                  $this-&gt;x = $x;&nbsp;</div></li><li><div>                  if (!$this-&gt;keep_block_together && !$this-&gt;writingHTMLheader && !$this-&gt;writingHTMLfooter) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $state = 0 normal; 1 top; 2 bottom; 3 top and bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if ($blvl == $this-&gt;blklvl) {&nbsp;</div></li><li><div>                          $this-&gt;PaintDivLnBorder($state, $blvl, $h);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;PaintDivLnBorder(0, $blvl, $h);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $last_x = $this-&gt;lMargin + $this-&gt;blk[$blvl]['outer_left_margin'];&nbsp;</div></li><li><div>              $last_w = $this-&gt;blk[$blvl]['width'];&nbsp;</div></li><li><div>              $last_fc = $this-&gt;FillColor;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Reset</span> current block fill</span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['bgcolorarray'])) {&nbsp;</div></li><li><div>              $bcor = $this-&gt;blk[$this-&gt;blklvl]['bgcolorarray'];&nbsp;</div></li><li><div>              $this-&gt;SetFColor($bcor);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>          $this-&gt;divheight = $bak_h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($move_y) {&nbsp;</div></li><li><div>          $this-&gt;y += $h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetX($x)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set x position</span>&nbsp;</div></li><li><div>      if ($x &gt;= 0)&nbsp;</div></li><li><div>          $this-&gt;x = $x;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $this-&gt;x = $this-&gt;w + $x;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetY($y)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set y position and reset x</span>&nbsp;</div></li><li><div>      $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>      if ($y &gt;= 0)&nbsp;</div></li><li><div>          $this-&gt;y = $y;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $this-&gt;y = $this-&gt;h + $y;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetXY($x, $y)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Set x and y positions</span>&nbsp;</div></li><li><div>      $this-&gt;SetY($y);&nbsp;</div></li><li><div>      $this-&gt;SetX($x);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Output($name = '', $dest = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Output PDF to some destination</span>&nbsp;</div></li><li><div>      if ($this-&gt;showStats) {&nbsp;</div></li><li><div>          $this-&gt;WriteHTML('&lt;div&gt;Generated in ' . sprintf('%.2F', (microtime(true) - $this-&gt;time0)) . ' seconds&lt;/div&gt;');&nbsp;</div></li><li><div>          $this-&gt;WriteHTML('&lt;div&gt;Compiled in ' . sprintf('%.2F', (microtime(true) - $this-&gt;time0)) . ' seconds (total)&lt;/div&gt;');&nbsp;</div></li><li><div>          $this-&gt;WriteHTML('&lt;div&gt;Peak Memory usage ' . number_format((memory_get_peak_usage(true) / (1024 * 1024)), 2) . ' MB&lt;/div&gt;');&nbsp;</div></li><li><div>          $this-&gt;WriteHTML('&lt;div&gt;Number of fonts ' . count($this-&gt;fonts) . '&lt;/div&gt;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Finish document if necessary */</span>&nbsp;</div></li><li><div>      if($this-&gt;state &lt; 3) {&nbsp;</div></li><li><div>          $this-&gt;Close();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (($this-&gt;PDFA || $this-&gt;PDFX) && $this-&gt;encrypted) {&nbsp;</div></li><li><div>          throw new MpdfException(&quot;PDFA1-b or PDFX/1-a does not permit encryption of documents.&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (count($this-&gt;PDFAXwarnings) && (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto))) {&nbsp;</div></li><li><div>          if ($this-&gt;PDFA) {&nbsp;</div></li><li><div>              echo '&lt;div&gt;WARNING - This file could not be generated as it stands as a PDFA1-b compliant file.&lt;/div&gt;';&nbsp;</div></li><li><div>              echo '&lt;div&gt;These issues can be automatically fixed by mPDF using &lt;i&gt;$mpdf-&gt;PDFAauto=true;&lt;/i&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>              echo '&lt;div&gt;Action that mPDF will take to automatically force PDFA1-b compliance are shown in brackets.&lt;/div&gt;';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              echo '&lt;div&gt;WARNING - This file could not be generated as it stands as a PDFX/1-a compliant file.&lt;/div&gt;';&nbsp;</div></li><li><div>              echo '&lt;div&gt;These issues can be automatically fixed by mPDF using &lt;i&gt;$mpdf-&gt;PDFXauto=true;&lt;/i&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>              echo '&lt;div&gt;Action that mPDF will take to automatically force PDFX/1-a compliance are shown in brackets.&lt;/div&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;div&gt;Warning(s) generated:&lt;/div&gt;&lt;ul&gt;';&nbsp;</div></li><li><div>          $this-&gt;PDFAXwarnings = array_unique($this-&gt;PDFAXwarnings);&nbsp;</div></li><li><div>          foreach ($this-&gt;PDFAXwarnings AS $w) {&nbsp;</div></li><li><div>              echo '&lt;li&gt;' . $w . '&lt;/li&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;/ul&gt;';&nbsp;</div></li><li><div>          exit;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (is_bool($dest)) {&nbsp;</div></li><li><div>          $dest = $dest ? 'D' : 'F';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $dest = strtoupper($dest);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($dest == '') {&nbsp;</div></li><li><div>          if ($name == '') {&nbsp;</div></li><li><div>              $name = 'mpdf.pdf';&nbsp;</div></li><li><div>              $dest = 'I';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $dest = 'F';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $dest = apply_filters('mpdf_output_destination', $dest, $name);&nbsp;</div></li><li><div>      $name = apply_filters('mpdf_output_name', $name, $dest);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ($dest) {&nbsp;</div></li><li><div>          case 'I':&nbsp;</div></li><li><div>              if ($this-&gt;debug && !$this-&gt;allow_output_buffering && ob_get_contents()) {&nbsp;</div></li><li><div>                  throw new MpdfException('Output has already been sent from the script - PDF file generation aborted.');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Send to standard output</span></span>&nbsp;</div></li><li><div>              if (PHP_SAPI != 'cli') {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//We send to a browser</span></span>&nbsp;</div></li><li><div>                  header('Content-Type: application/pdf');&nbsp;</div></li><li><div>                  if (headers_sent()) {&nbsp;</div></li><li><div>                      throw new MpdfException('Some data has already been output to browser, can\'t send PDF file');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (!isset($_SERVER['HTTP_ACCEPT_ENCODING']) || empty($_SERVER['HTTP_ACCEPT_ENCODING'])) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// don't use length if server using compression</span></span>&nbsp;</div></li><li><div>                      header('Content-Length: ' . strlen($this-&gt;buffer));&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  header('Content-disposition: inline; filename=&quot;' . $name . '&quot;');&nbsp;</div></li><li><div>                  header('Cache-Control: public, must-revalidate, max-age=0');&nbsp;</div></li><li><div>                  header('Pragma: public');&nbsp;</div></li><li><div>                  header('Expires: Sat, 26 Jul 1997 05:00:00 GMT');&nbsp;</div></li><li><div>                  header('Last-Modified: ' . gmdate('D, d M Y H:i:s') . ' GMT');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              echo $this-&gt;buffer;&nbsp;</div></li><li><div>              exit;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'D':&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Download file</span></span>&nbsp;</div></li><li><div>              header('Content-Description: File Transfer');&nbsp;</div></li><li><div>              if (headers_sent()) {&nbsp;</div></li><li><div>                  throw new MpdfException('Some data has already been output to browser, can\'t send PDF file');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              header('Content-Transfer-Encoding: binary');&nbsp;</div></li><li><div>              header('Cache-Control: public, must-revalidate, max-age=0');&nbsp;</div></li><li><div>              header('Pragma: public');&nbsp;</div></li><li><div>              header('Expires: Sat, 26 Jul 1997 05:00:00 GMT');&nbsp;</div></li><li><div>              header('Last-Modified: ' . gmdate('D, d M Y H:i:s') . ' GMT');&nbsp;</div></li><li><div>              header('Content-Type: application/force-download');&nbsp;</div></li><li><div>              header('Content-Type: application/octet-stream', false);&nbsp;</div></li><li><div>              header('Content-Type: application/download', false);&nbsp;</div></li><li><div>              header('Content-Type: application/pdf', false);&nbsp;</div></li><li><div>              if (!isset($_SERVER['HTTP_ACCEPT_ENCODING']) || empty($_SERVER['HTTP_ACCEPT_ENCODING'])) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// don't use length if server using compression</span></span>&nbsp;</div></li><li><div>                  header('Content-Length: ' . strlen($this-&gt;buffer));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              header('Content-disposition: attachment; filename=&quot;' . $name . '&quot;');&nbsp;</div></li><li><div>              echo $this-&gt;buffer;&nbsp;</div></li><li><div>              exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'F':&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">//Save to local file</span></span></span>&nbsp;</div></li><li><div>              $f = fopen($name, 'wb');&nbsp;</div></li><li><div>              if (!$f) {&nbsp;</div></li><li><div>                  throw new MpdfException('Unable to create output file: ' . $name);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              fwrite($f, $this-&gt;buffer, strlen($this-&gt;buffer));&nbsp;</div></li><li><div>              fclose($f);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'S':&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Return as a string</span></span>&nbsp;</div></li><li><div>              return $this-&gt;buffer;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              throw new MpdfException('Incorrect output destination: ' . $dest);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>*******************************************&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//                                                                             *</span></span>&nbsp;</div></li><li><div>  <span class="comment">//                             Protected methods                               *</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//                                                                             *</span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ****</span>******************************</span></span></span></span></span></span></span></span></span>*******************************************&nbsp;</div></li><li><div>  function _dochecks()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Check for locale-related bug</span>&nbsp;</div></li><li><div>      if (1.1 == 1)&nbsp;</div></li><li><div>          throw new MpdfException('Don\'t alter the locale before including mPDF');&nbsp;</div></li><li><div>      <span class="comment">//Check for decimal separator</span>&nbsp;</div></li><li><div>      if (sprintf('%.1f', 1.0) != '1.0')&nbsp;</div></li><li><div>          setlocale(LC_NUMERIC, 'C');&nbsp;</div></li><li><div>      $mqr = ini_get(&quot;magic_quotes_runtime&quot;);&nbsp;</div></li><li><div>      if ($mqr) {&nbsp;</div></li><li><div>          throw new MpdfException('mPDF requires magic_quotes_runtime to be turned off e.g. by using ini_set(&quot;magic_quotes_runtime&quot;, 0);');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _puthtmlheaders()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;state = 2;&nbsp;</div></li><li><div>      $nb = $this-&gt;page;&nbsp;</div></li><li><div>      for ($n = 1; $n &lt;= $nb; $n++) {&nbsp;</div></li><li><div>          if ($this-&gt;mirrorMargins && $n % 2 == 0) {&nbsp;</div></li><li><div>              $OE = 'E';&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $OE = 'O';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;page = $n;&nbsp;</div></li><li><div>          $pn = $this-&gt;docPageNum($n);&nbsp;</div></li><li><div>          if ($pn)&nbsp;</div></li><li><div>              $pnstr = $this-&gt;pagenumPrefix . $pn . $this-&gt;pagenumSuffix;&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $pnstr = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $pnt = $this-&gt;docPageNumTotal($n);&nbsp;</div></li><li><div>          if ($pnt)&nbsp;</div></li><li><div>              $pntstr = $this-&gt;nbpgPrefix . $pnt . $this-&gt;nbpgSuffix;&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $pntstr = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;saveHTMLHeader[$n][$OE])) {&nbsp;</div></li><li><div>              $html = $this-&gt;saveHTMLHeader[$n][$OE]['html'];&nbsp;</div></li><li><div>              $this-&gt;lMargin = $this-&gt;saveHTMLHeader[$n][$OE]['ml'];&nbsp;</div></li><li><div>              $this-&gt;rMargin = $this-&gt;saveHTMLHeader[$n][$OE]['mr'];&nbsp;</div></li><li><div>              $this-&gt;tMargin = $this-&gt;saveHTMLHeader[$n][$OE]['mh'];&nbsp;</div></li><li><div>              $this-&gt;bMargin = $this-&gt;saveHTMLHeader[$n][$OE]['mf'];&nbsp;</div></li><li><div>              $this-&gt;margin_header = $this-&gt;saveHTMLHeader[$n][$OE]['mh'];&nbsp;</div></li><li><div>              $this-&gt;margin_footer = $this-&gt;saveHTMLHeader[$n][$OE]['mf'];&nbsp;</div></li><li><div>              $this-&gt;w = $this-&gt;saveHTMLHeader[$n][$OE]['pw'];&nbsp;</div></li><li><div>              $this-&gt;h = $this-&gt;saveHTMLHeader[$n][$OE]['ph'];&nbsp;</div></li><li><div>              $rotate = (isset($this-&gt;saveHTMLHeader[$n][$OE]['rotate']) ? $this-&gt;saveHTMLHeader[$n][$OE]['rotate'] : null);&nbsp;</div></li><li><div>              $this-&gt;Reset();&nbsp;</div></li><li><div>              $this-&gt;pageoutput[$n] = array();&nbsp;</div></li><li><div>              $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>              $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>              $this-&gt;y = $this-&gt;margin_header;&nbsp;</div></li><li><div>              $html = str_replace('{PAGENO}', $pnstr, $html);&nbsp;</div></li><li><div>              $html = str_replace($this-&gt;aliasNbPgGp, $pntstr, $html); <span class="comment"><span class="comment">// {nbpg}</span></span>&nbsp;</div></li><li><div>              $html = str_replace($this-&gt;aliasNbPg, $nb, $html); <span class="comment"><span class="comment">// {nb}</span></span>&nbsp;</div></li><li><div>              $html = preg_replace_callback('/\{DATE\s+(.*?)\}/', array($this, 'date_callback'), $html); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageLinks = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageAnnots = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageForms = array();&nbsp;</div></li><li><div>              $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;writingHTMLheader = true;&nbsp;</div></li><li><div>              $this-&gt;WriteHTML($html, 4); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// parameter 4 saves output to $this-&gt;headerbuffer</span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;writingHTMLheader = false;&nbsp;</div></li><li><div>              $this-&gt;Reset();&nbsp;</div></li><li><div>              $this-&gt;pageoutput[$n] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $s = $this-&gt;PrintPageBackgrounds();&nbsp;</div></li><li><div>              $this-&gt;headerbuffer = $s . $this-&gt;headerbuffer;&nbsp;</div></li><li><div>              $os = '';&nbsp;</div></li><li><div>              if ($rotate) {&nbsp;</div></li><li><div>                  $os .= sprintf('q 0 -1 1 0 0 %.3F cm ', ($this-&gt;w * _MPDFK));&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// To rotate the other way i.e. Header to left of page:</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//$os .= sprintf('q 0 1 -1 0 %.3F %.3F cm ', ($this-&gt;h*_MPDFK), (($this-&gt;rMargin - $this-&gt;lMargin )*_MPDFK));</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $os .= $this-&gt;headerbuffer;&nbsp;</div></li><li><div>              if ($rotate) {&nbsp;</div></li><li><div>                  $os .= ' Q' . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Writes over the page background but behind any other output on page</span></span>&nbsp;</div></li><li><div>              $os = preg_replace('/\\\\/', '\\\\\\\\', $os);&nbsp;</div></li><li><div>              $this-&gt;pages[$n] = preg_replace('/(___HEADER___MARKER' . $this-&gt;uniqstr . ')/', &quot;\n&quot; . $os . &quot;\n&quot; . '\\1', $this-&gt;pages[$n]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $lks = $this-&gt;HTMLheaderPageLinks;&nbsp;</div></li><li><div>              foreach ($lks AS $lk) {&nbsp;</div></li><li><div>                  if ($rotate) {&nbsp;</div></li><li><div>                      $lw = $lk[2];&nbsp;</div></li><li><div>                      $lh = $lk[3];&nbsp;</div></li><li><div>                      $lk[2] = $lh;&nbsp;</div></li><li><div>                      $lk[3] = $lw; <span class="comment"><span class="comment"><span class="comment">// swap width and height</span></span></span>&nbsp;</div></li><li><div>                      $ax = $lk[0] / _MPDFK;&nbsp;</div></li><li><div>                      $ay = $lk[1] / _MPDFK;&nbsp;</div></li><li><div>                      $bx = $ay - ($lh / _MPDFK);&nbsp;</div></li><li><div>                      $by = $this-&gt;w - $ax;&nbsp;</div></li><li><div>                      $lk[0] = $bx * _MPDFK;&nbsp;</div></li><li><div>                      $lk[1] = ($this-&gt;h - $by) * _MPDFK - $lw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;PageLinks[$n][] = $lk;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              foreach ($this-&gt;HTMLheaderPageForms AS $f) {&nbsp;</div></li><li><div>                  $this-&gt;mpdfform-&gt;forms[$f['n']] = $f;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;saveHTMLFooter[$n][$OE])) {&nbsp;</div></li><li><div>              $html = $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['html'];&nbsp;</div></li><li><div>              $this-&gt;lMargin = $this-&gt;saveHTMLFooter[$n][$OE]['ml'];&nbsp;</div></li><li><div>              $this-&gt;rMargin = $this-&gt;saveHTMLFooter[$n][$OE]['mr'];&nbsp;</div></li><li><div>              $this-&gt;tMargin = $this-&gt;saveHTMLFooter[$n][$OE]['mh'];&nbsp;</div></li><li><div>              $this-&gt;bMargin = $this-&gt;saveHTMLFooter[$n][$OE]['mf'];&nbsp;</div></li><li><div>              $this-&gt;margin_header = $this-&gt;saveHTMLFooter[$n][$OE]['mh'];&nbsp;</div></li><li><div>              $this-&gt;margin_footer = $this-&gt;saveHTMLFooter[$n][$OE]['mf'];&nbsp;</div></li><li><div>              $this-&gt;w = $this-&gt;saveHTMLFooter[$n][$OE]['pw'];&nbsp;</div></li><li><div>              $this-&gt;h = $this-&gt;saveHTMLFooter[$n][$OE]['ph'];&nbsp;</div></li><li><div>              $rotate = (isset($this-&gt;saveHTMLFooter[$n][$OE]['rotate']) ? $this-&gt;saveHTMLFooter[$n][$OE]['rotate'] : null);&nbsp;</div></li><li><div>              $this-&gt;Reset();&nbsp;</div></li><li><div>              $this-&gt;pageoutput[$n] = array();&nbsp;</div></li><li><div>              $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>              $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>              $top_y = $this-&gt;y = $this-&gt;h - $this-&gt;margin_footer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// if bottom-margin==0, corrects to avoid division by zero</span>&nbsp;</div></li><li><div>              if ($this-&gt;y == $this-&gt;h) {&nbsp;</div></li><li><div>                  $top_y = $this-&gt;y = ($this-&gt;h + 0.00000001);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $html = str_replace('{PAGENO}', $pnstr, $html);&nbsp;</div></li><li><div>              $html = str_replace($this-&gt;aliasNbPgGp, $pntstr, $html); <span class="comment"><span class="comment">// {nbpg}</span></span>&nbsp;</div></li><li><div>              $html = str_replace($this-&gt;aliasNbPg, $nb, $html); <span class="comment"><span class="comment">// {nb}</span></span>&nbsp;</div></li><li><div>              $html = preg_replace_callback('/\{DATE\s+(.*?)\}/', array($this, 'date_callback'), $html); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageLinks = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageAnnots = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageForms = array();&nbsp;</div></li><li><div>              $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;writingHTMLfooter = true;&nbsp;</div></li><li><div>              $this-&gt;InFooter = true;&nbsp;</div></li><li><div>              $this-&gt;WriteHTML($html, 4); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// parameter 4 saves output to $this-&gt;headerbuffer</span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;InFooter = false;&nbsp;</div></li><li><div>              $this-&gt;Reset();&nbsp;</div></li><li><div>              $this-&gt;pageoutput[$n] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $fheight = $this-&gt;y - $top_y;&nbsp;</div></li><li><div>              $adj = -$fheight;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $s = $this-&gt;PrintPageBackgrounds(-$adj);&nbsp;</div></li><li><div>              $this-&gt;headerbuffer = $s . $this-&gt;headerbuffer;&nbsp;</div></li><li><div>              $this-&gt;writingHTMLfooter = false; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  (moved after PrintPageBackgrounds so can adjust position of images in footer)&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $os = '';&nbsp;</div></li><li><div>              $os .= $this-&gt;StartTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>              if ($rotate) {&nbsp;</div></li><li><div>                  $os .= sprintf('q 0 -1 1 0 0 %.3F cm ', ($this-&gt;w * _MPDFK));&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// To rotate the other way i.e. Header to left of page:</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//$os .= sprintf('q 0 1 -1 0 %.3F %.3F cm ', ($this-&gt;h*_MPDFK), (($this-&gt;rMargin - $this-&gt;lMargin )*_MPDFK));</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $os .= $this-&gt;transformTranslate(0, $adj, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>              $os .= $this-&gt;headerbuffer;&nbsp;</div></li><li><div>              if ($rotate) {&nbsp;</div></li><li><div>                  $os .= ' Q' . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $os .= $this-&gt;StopTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Writes over the page background but behind any other output on page</span></span>&nbsp;</div></li><li><div>              $os = preg_replace('/\\\\/', '\\\\\\\\', $os);&nbsp;</div></li><li><div>              $this-&gt;pages[$n] = preg_replace('/(___HEADER___MARKER' . $this-&gt;uniqstr . ')/', &quot;\n&quot; . $os . &quot;\n&quot; . '\\1', $this-&gt;pages[$n]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $lks = $this-&gt;HTMLheaderPageLinks;&nbsp;</div></li><li><div>              foreach ($lks AS $lk) {&nbsp;</div></li><li><div>                  $lk[1] -= $adj * _MPDFK;&nbsp;</div></li><li><div>                  if ($rotate) {&nbsp;</div></li><li><div>                      $lw = $lk[2];&nbsp;</div></li><li><div>                      $lh = $lk[3];&nbsp;</div></li><li><div>                      $lk[2] = $lh;&nbsp;</div></li><li><div>                      $lk[3] = $lw; <span class="comment"><span class="comment"><span class="comment">// swap width and height</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $ax = $lk[0] / _MPDFK;&nbsp;</div></li><li><div>                      $ay = $lk[1] / _MPDFK;&nbsp;</div></li><li><div>                      $bx = $ay - ($lh / _MPDFK);&nbsp;</div></li><li><div>                      $by = $this-&gt;w - $ax;&nbsp;</div></li><li><div>                      $lk[0] = $bx * _MPDFK;&nbsp;</div></li><li><div>                      $lk[1] = ($this-&gt;h - $by) * _MPDFK - $lw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;PageLinks[$n][] = $lk;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              foreach ($this-&gt;HTMLheaderPageForms AS $f) {&nbsp;</div></li><li><div>                  $f['y'] += $adj;&nbsp;</div></li><li><div>                  $this-&gt;mpdfform-&gt;forms[$f['n']] = $f;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;page = $nb;&nbsp;</div></li><li><div>      $this-&gt;state = 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putpages()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $nb = $this-&gt;page;&nbsp;</div></li><li><div>      $filter = ($this-&gt;compress) ? '/Filter /FlateDecode ' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;DefOrientation == 'P') {&nbsp;</div></li><li><div>          $defwPt = $this-&gt;fwPt;&nbsp;</div></li><li><div>          $defhPt = $this-&gt;fhPt;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $defwPt = $this-&gt;fhPt;&nbsp;</div></li><li><div>          $defhPt = $this-&gt;fwPt;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $annotid = (3 + 2 * $nb);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Active Forms</span></span></span></span>&nbsp;</div></li><li><div>      $totaladdnum = 0;&nbsp;</div></li><li><div>      for ($n = 1; $n &lt;= $nb; $n++) {&nbsp;</div></li><li><div>          if (isset($this-&gt;PageLinks[$n])) {&nbsp;</div></li><li><div>              $totaladdnum += count($this-&gt;PageLinks[$n]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;PageAnnots[$n])) {&nbsp;</div></li><li><div>              foreach ($this-&gt;PageAnnots[$n] as $k =&gt; $pl) {&nbsp;</div></li><li><div>                  if (!empty($pl['opt']['popup']) || !empty($pl['opt']['file'])) {&nbsp;</div></li><li><div>                      $totaladdnum += 2;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $totaladdnum++;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (count($this-&gt;mpdfform-&gt;forms) &gt; 0) {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;countPageForms($n, $totaladdnum);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Make a note in the radio button group of the obj_id it will have</span>&nbsp;</div></li><li><div>      $ctr = 0;&nbsp;</div></li><li><div>      if (count($this-&gt;mpdfform-&gt;form_radio_groups)) {&nbsp;</div></li><li><div>          foreach ($this-&gt;mpdfform-&gt;form_radio_groups AS $name =&gt; $frg) {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;form_radio_groups[$name]['obj_id'] = $annotid + $totaladdnum + $ctr;&nbsp;</div></li><li><div>              $ctr++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Select unused fonts (usually default font)</span>&nbsp;</div></li><li><div>      $unused = array();&nbsp;</div></li><li><div>      foreach ($this-&gt;fonts as $fk =&gt; $font) {&nbsp;</div></li><li><div>          if (isset($font['type']) && $font['type'] == 'TTF' && !$font['used']) {&nbsp;</div></li><li><div>              $unused[] = $fk;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($n = 1; $n &lt;= $nb; $n++) {&nbsp;</div></li><li><div>          $thispage = $this-&gt;pages[$n];&nbsp;</div></li><li><div>          if (isset($this-&gt;OrientationChanges[$n])) {&nbsp;</div></li><li><div>              $hPt = $this-&gt;pageDim[$n]['w'] * _MPDFK;&nbsp;</div></li><li><div>              $wPt = $this-&gt;pageDim[$n]['h'] * _MPDFK;&nbsp;</div></li><li><div>              $owidthPt_LR = $this-&gt;pageDim[$n]['outer_width_TB'] * _MPDFK;&nbsp;</div></li><li><div>              $owidthPt_TB = $this-&gt;pageDim[$n]['outer_width_LR'] * _MPDFK;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $wPt = $this-&gt;pageDim[$n]['w'] * _MPDFK;&nbsp;</div></li><li><div>              $hPt = $this-&gt;pageDim[$n]['h'] * _MPDFK;&nbsp;</div></li><li><div>              $owidthPt_LR = $this-&gt;pageDim[$n]['outer_width_LR'] * _MPDFK;&nbsp;</div></li><li><div>              $owidthPt_TB = $this-&gt;pageDim[$n]['outer_width_TB'] * _MPDFK;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Remove references to unused fonts (usually default font)</span></span>&nbsp;</div></li><li><div>          foreach ($unused as $fk) {&nbsp;</div></li><li><div>              if ($this-&gt;fonts[$fk]['sip'] || $this-&gt;fonts[$fk]['smp']) {&nbsp;</div></li><li><div>                  foreach ($this-&gt;fonts[$fk]['subsetfontids'] AS $k =&gt; $fid) {&nbsp;</div></li><li><div>                      $thispage = preg_replace('/\s\/F' . $fid . ' \d[\d.]* Tf\s/is', ' ', $thispage);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $thispage = preg_replace('/\s\/F' . $this-&gt;fonts[$fk]['i'] . ' \d[\d.]* Tf\s/is', ' ', $thispage);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Clean up repeated /GS1 gs statements</span>&nbsp;</div></li><li><div>          <span class="comment">// For some reason using + for repetition instead of {2, 20} crashes PHP Script Interpreter ???</span>&nbsp;</div></li><li><div>          $thispage = preg_replace('/(\/GS1 gs\n) {2, 20}/', &quot;/GS1 gs\n&quot;, $thispage);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $thispage = preg_replace('/(\s*___BACKGROUND___PATTERNS' . $this-&gt;uniqstr . '\s*)/', &quot; &quot;, $thispage);&nbsp;</div></li><li><div>          $thispage = preg_replace('/(\s*___HEADER___MARKER' . $this-&gt;uniqstr . '\s*)/', &quot; &quot;, $thispage);&nbsp;</div></li><li><div>          $thispage = preg_replace('/(\s*___PAGE___START' . $this-&gt;uniqstr . '\s*)/', &quot; &quot;, $thispage);&nbsp;</div></li><li><div>          $thispage = preg_replace('/(\s*___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . '\s*)/', &quot; &quot;, $thispage);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>          while (preg_match('/(\% BTR(.*?)\% ETR)/is', $thispage, $m)) {&nbsp;</div></li><li><div>              $thispage = preg_replace('/(\% BTR.*?\% ETR)/is', '', $thispage, 1) . &quot;\n&quot; . $m[2];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">//Page</span>&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/Type /Page');&nbsp;</div></li><li><div>          $this-&gt;_out('/Parent 1 0 R');&nbsp;</div></li><li><div>          if (isset($this-&gt;OrientationChanges[$n])) {&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/MediaBox [0 0 %.3F %.3F]', $hPt, $wPt));&nbsp;</div></li><li><div>              <span class="comment">//If BleedBox is defined, it must be larger than the TrimBox, but smaller than the MediaBox</span>&nbsp;</div></li><li><div>              $bleedMargin = $this-&gt;pageDim[$n]['bleedMargin'] * _MPDFK;&nbsp;</div></li><li><div>              if ($bleedMargin && ($owidthPt_TB || $owidthPt_LR)) {&nbsp;</div></li><li><div>                  $x0 = $owidthPt_TB - $bleedMargin;&nbsp;</div></li><li><div>                  $y0 = $owidthPt_LR - $bleedMargin;&nbsp;</div></li><li><div>                  $x1 = $hPt - $owidthPt_TB + $bleedMargin;&nbsp;</div></li><li><div>                  $y1 = $wPt - $owidthPt_LR + $bleedMargin;&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('/BleedBox [%.3F %.3F %.3F %.3F]', $x0, $y0, $x1, $y1));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/TrimBox [%.3F %.3F %.3F %.3F]', $owidthPt_TB, $owidthPt_LR, ($hPt - $owidthPt_TB), ($wPt - $owidthPt_LR)));&nbsp;</div></li><li><div>              if (isset($this-&gt;OrientationChanges[$n]) && $this-&gt;displayDefaultOrientation) {&nbsp;</div></li><li><div>                  if ($this-&gt;DefOrientation == 'P') {&nbsp;</div></li><li><div>                      $this-&gt;_out('/Rotate 270');&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;_out('/Rotate 90');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//elseif($wPt != $defwPt || $hPt != $defhPt) {</span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/MediaBox [0 0 %.3F %.3F]', $wPt, $hPt));&nbsp;</div></li><li><div>              $bleedMargin = $this-&gt;pageDim[$n]['bleedMargin'] * _MPDFK;&nbsp;</div></li><li><div>              if ($bleedMargin && ($owidthPt_TB || $owidthPt_LR)) {&nbsp;</div></li><li><div>                  $x0 = $owidthPt_LR - $bleedMargin;&nbsp;</div></li><li><div>                  $y0 = $owidthPt_TB - $bleedMargin;&nbsp;</div></li><li><div>                  $x1 = $wPt - $owidthPt_LR + $bleedMargin;&nbsp;</div></li><li><div>                  $y1 = $hPt - $owidthPt_TB + $bleedMargin;&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('/BleedBox [%.3F %.3F %.3F %.3F]', $x0, $y0, $x1, $y1));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/TrimBox [%.3F %.3F %.3F %.3F]', $owidthPt_LR, $owidthPt_TB, ($wPt - $owidthPt_LR), ($hPt - $owidthPt_TB)));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out('/Resources 2 0 R');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Important to keep in RGB colorSpace when using transparency</span>&nbsp;</div></li><li><div>          if (!$this-&gt;PDFA && !$this-&gt;PDFX) {&nbsp;</div></li><li><div>              if ($this-&gt;restrictColorSpace == 3)&nbsp;</div></li><li><div>                  $this-&gt;_out('/Group &lt;&lt; /Type /Group /S /Transparency /CS /DeviceCMYK &gt;&gt; ');&nbsp;</div></li><li><div>              elseif ($this-&gt;restrictColorSpace == 1)&nbsp;</div></li><li><div>                  $this-&gt;_out('/Group &lt;&lt; /Type /Group /S /Transparency /CS /DeviceGray &gt;&gt; ');&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $this-&gt;_out('/Group &lt;&lt; /Type /Group /S /Transparency /CS /DeviceRGB &gt;&gt; ');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $annotsnum = 0;&nbsp;</div></li><li><div>          $embeddedfiles = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> /EmbeddedFiles&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($this-&gt;PageLinks[$n])) {&nbsp;</div></li><li><div>              $annotsnum += count($this-&gt;PageLinks[$n]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;PageAnnots[$n])) {&nbsp;</div></li><li><div>              foreach ($this-&gt;PageAnnots[$n] as $k =&gt; $pl) {&nbsp;</div></li><li><div>                  if (!empty($pl['opt']['file'])) {&nbsp;</div></li><li><div>                      $embeddedfiles[$annotsnum + 1] = true;&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> /EmbeddedFiles&nbsp;</div></li><li><div>                  if (!empty($pl['opt']['popup']) || !empty($pl['opt']['file'])) {&nbsp;</div></li><li><div>                      $annotsnum += 2;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $annotsnum++;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;PageAnnots[$n][$k]['pageobj'] = $this-&gt;n;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Active Forms</span></span></span></span>&nbsp;</div></li><li><div>          $formsnum = 0;&nbsp;</div></li><li><div>          if (count($this-&gt;mpdfform-&gt;forms) &gt; 0) {&nbsp;</div></li><li><div>              foreach ($this-&gt;mpdfform-&gt;forms as $val) {&nbsp;</div></li><li><div>                  if ($val['page'] == $n)&nbsp;</div></li><li><div>                      $formsnum++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($annotsnum || $formsnum) {&nbsp;</div></li><li><div>              $s = '/Annots [ ';&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; $annotsnum; $i++) {&nbsp;</div></li><li><div>                  if (!isset($embeddedfiles[$i])) {&nbsp;</div></li><li><div>                      $s .= ($annotid + $i) . ' 0 R ';&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> /EmbeddedFiles&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $annotid += $annotsnum;&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (count($this-&gt;mpdfform-&gt;forms) &gt; 0) {&nbsp;</div></li><li><div>                  $this-&gt;mpdfform-&gt;addFormIds($n, $s, $annotid);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $s .= '] ';&nbsp;</div></li><li><div>              $this-&gt;_out($s);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;_out('/Contents ' . ($this-&gt;n + 1) . ' 0 R&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">//Page</span> content&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $p = ($this-&gt;compress) ? gzcompress($thispage) : $thispage;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;' . $filter . '/Length ' . strlen($p) . '&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_putstream($p);&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_putannots(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">//Page</span>s root&nbsp;</div></li><li><div>      $this-&gt;offsets[1] = strlen($this-&gt;buffer);&nbsp;</div></li><li><div>      $this-&gt;_out('1 0 obj');&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;/Type /Pages');&nbsp;</div></li><li><div>      $kids = '/Kids [';&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $nb; $i++)&nbsp;</div></li><li><div>          $kids.=(3 + 2 * $i) . ' 0 R ';&nbsp;</div></li><li><div>      $this-&gt;_out($kids . ']');&nbsp;</div></li><li><div>      $this-&gt;_out('/Count ' . $nb);&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('/MediaBox [0 0 %.3F %.3F]', $defwPt, $defhPt));&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putannots()&nbsp;</div></li><li><div>  { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>      $filter = ($this-&gt;compress) ? '/Filter /FlateDecode ' : '';&nbsp;</div></li><li><div>      $nb = $this-&gt;page;&nbsp;</div></li><li><div>      for ($n = 1; $n &lt;= $nb; $n++) {&nbsp;</div></li><li><div>          $annotobjs = array();&nbsp;</div></li><li><div>          if (isset($this-&gt;PageLinks[$n]) || isset($this-&gt;PageAnnots[$n]) || count($this-&gt;mpdfform-&gt;forms) &gt; 0) {&nbsp;</div></li><li><div>              $wPt = $this-&gt;pageDim[$n]['w'] * _MPDFK;&nbsp;</div></li><li><div>              $hPt = $this-&gt;pageDim[$n]['h'] * _MPDFK;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">//Links</span>&nbsp;</div></li><li><div>              if (isset($this-&gt;PageLinks[$n])) {&nbsp;</div></li><li><div>                  foreach ($this-&gt;PageLinks[$n] as $key =&gt; $pl) {&nbsp;</div></li><li><div>                      $this-&gt;_newobj();&nbsp;</div></li><li><div>                      $annot = '';&nbsp;</div></li><li><div>                      $rect = sprintf('%.3F %.3F %.3F %.3F', $pl[0], $pl[1], $pl[0] + $pl[2], $pl[1] - $pl[3]);&nbsp;</div></li><li><div>                      $annot .= '&lt;&lt;/Type /Annot /Subtype /Link /Rect [' . $rect . ']';&nbsp;</div></li><li><div>                      $annot .= ' /Contents ' . $this-&gt;_UTF16BEtextstring($pl[4]);&nbsp;</div></li><li><div>                      $annot .= ' /NM ' . $this-&gt;_textstring(sprintf('%04u-%04u', $n, $key));&nbsp;</div></li><li><div>                      $annot .= ' /M ' . $this-&gt;_textstring('D:' . date('YmdHis'));&nbsp;</div></li><li><div>                      $annot .= ' /Border [0 0 0]';&nbsp;</div></li><li><div>                      <span class="comment">// Use this (instead of /Border) to specify border around link</span>&nbsp;</div></li><li><div>                      <span class="comment">//        $annot .= ' /BS &lt;&lt;/W 1';    <span class="comment"><span class="comment">// Width</span></span> on points; 0 = no line</span>&nbsp;</div></li><li><div>                      <span class="comment">//        $annot .= ' /S /D';        // style - [S]olid, [D]ashed, [B]eveled, [I]nset, [U]nderline</span>&nbsp;</div></li><li><div>                      <span class="comment">//        $annot .= ' /D [3 2]';        // Dash array - if dashed</span>&nbsp;</div></li><li><div>                      <span class="comment">//        $annot .= ' &gt;&gt;';</span>&nbsp;</div></li><li><div>                      <span class="comment">//        $annot .= ' /C [1 0 0]';    // Color RGB</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>                          $annot .= ' /F 28';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (strpos($pl[4], '@') === 0) {&nbsp;</div></li><li><div>                          $p = substr($pl[4], 1);&nbsp;</div></li><li><div>                          <span class="comment">//    $h=isset($this-&gt;OrientationChanges[$p]) ? $wPt : $hPt;</span>&nbsp;</div></li><li><div>                          $htarg = $this-&gt;pageDim[$p]['h'] * _MPDFK;&nbsp;</div></li><li><div>                          $annot.=sprintf(' /Dest [%d 0 R /XYZ 0 %.3F null]&gt;&gt;', 1 + 2 * $p, $htarg);&nbsp;</div></li><li><div>                      } elseif (is_string($pl[4])) {&nbsp;</div></li><li><div>                          $annot .= ' /A &lt;&lt;/S /URI /URI ' . $this-&gt;_textstring($pl[4]) . '&gt;&gt; &gt;&gt;';&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $l = $this-&gt;links[$pl[4]];&nbsp;</div></li><li><div>                          <span class="comment">// may not be set if #link points to non-existent target</span>&nbsp;</div></li><li><div>                          if (isset($this-&gt;pageDim[$l[0]]['h'])) {&nbsp;</div></li><li><div>                              $htarg = $this-&gt;pageDim[$l[0]]['h'] * _MPDFK;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $htarg = $this-&gt;h * _MPDFK;&nbsp;</div></li><li><div>                          } <span class="comment">// doesn't really matter</span>&nbsp;</div></li><li><div>                          $annot.=sprintf(' /Dest [%d 0 R /XYZ 0 %.3F null]&gt;&gt;', 1 + 2 * $l[0], $htarg - $l[1] * _MPDFK);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;_out($annot);&nbsp;</div></li><li><div>                      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;PageAnnots[$n])) {&nbsp;</div></li><li><div>                  foreach ($this-&gt;PageAnnots[$n] as $key =&gt; $pl) {&nbsp;</div></li><li><div>                      if ($pl['opt']['file']) {&nbsp;</div></li><li><div>                          $FileAttachment = true;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $FileAttachment = false;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;_newobj();&nbsp;</div></li><li><div>                      $annot = '';&nbsp;</div></li><li><div>                      $pl['opt'] = array_change_key_case($pl['opt'], CASE_LOWER);&nbsp;</div></li><li><div>                      $x = $pl['x'];&nbsp;</div></li><li><div>                      if ($this-&gt;annotMargin &lt;&gt; 0 || $x == 0 || $x &lt; 0) { <span class="comment">// Odd page</span>&nbsp;</div></li><li><div>                          $x = ($wPt / _MPDFK) - $this-&gt;annotMargin;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $w = $h = 0;&nbsp;</div></li><li><div>                      $a = $x * _MPDFK;&nbsp;</div></li><li><div>                      $b = $hPt - ($pl['y'] * _MPDFK);&nbsp;</div></li><li><div>                      $annot .= '&lt;&lt;/Type /Annot ';&nbsp;</div></li><li><div>                      if ($FileAttachment) {&nbsp;</div></li><li><div>                          $annot .= '/Subtype /FileAttachment ';&nbsp;</div></li><li><div>                          <span class="comment">// Need to set a size for FileAttachment icons</span>&nbsp;</div></li><li><div>                          if ($pl['opt']['icon'] == 'Paperclip') {&nbsp;</div></li><li><div>                              $w = 8.235;&nbsp;</div></li><li><div>                              $h = 20;&nbsp;</div></li><li><div>                          } <span class="comment">// 7, 17</span>&nbsp;</div></li><li><div>                          elseif ($pl['opt']['icon'] == 'Tag') {&nbsp;</div></li><li><div>                              $w = 20;&nbsp;</div></li><li><div>                              $h = 16;&nbsp;</div></li><li><div>                          } elseif ($pl['opt']['icon'] == 'Graph') {&nbsp;</div></li><li><div>                              $w = 20;&nbsp;</div></li><li><div>                              $h = 20;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $w = 14;&nbsp;</div></li><li><div>                              $h = 20;&nbsp;</div></li><li><div>                          }  <span class="comment">// PushPin</span>&nbsp;</div></li><li><div>                          $f = $pl['opt']['file'];&nbsp;</div></li><li><div>                          $f = preg_replace('/^.*\<span class="comment">//', '', $f);</span>&nbsp;</div></li><li><div>                          $f = preg_replace('/[^a-zA-Z0-9._]/', '', $f);&nbsp;</div></li><li><div>                          $annot .= '/FS &lt;&lt;/Type /Filespec /F (' . $f . ')';&nbsp;</div></li><li><div>                          $annot .= '/EF &lt;&lt;/F ' . ($this-&gt;n + 1) . ' 0 R&gt;&gt;';&nbsp;</div></li><li><div>                          $annot .= '&gt;&gt;';&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $annot .= '/Subtype /Text';&nbsp;</div></li><li><div>                          $w = 20;&nbsp;</div></li><li><div>                          $h = 20;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $rect = sprintf('%.3F %.3F %.3F %.3F', $a, $b - $h, $a + $w, $b);&nbsp;</div></li><li><div>                      $annot .= ' /Rect [' . $rect . ']';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// contents = description of file in free text</span>&nbsp;</div></li><li><div>                      $annot .= ' /Contents ' . $this-&gt;_UTF16BEtextstring($pl['txt']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $annot .= ' /NM ' . $this-&gt;_textstring(sprintf('%04u-%04u', $n, (2000 + $key)));&nbsp;</div></li><li><div>                      $annot .= ' /M ' . $this-&gt;_textstring('D:' . date('YmdHis'));&nbsp;</div></li><li><div>                      $annot .= ' /CreationDate ' . $this-&gt;_textstring('D:' . date('YmdHis'));&nbsp;</div></li><li><div>                      $annot .= ' /Border [0 0 0]';&nbsp;</div></li><li><div>                      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>                          $annot .= ' /F 28';&nbsp;</div></li><li><div>                          $annot .= ' /CA 1';&nbsp;</div></li><li><div>                      } elseif ($pl['opt']['ca'] &gt; 0) {&nbsp;</div></li><li><div>                          $annot .= ' /CA ' . $pl['opt']['ca'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $annotcolor = ' /C [';&nbsp;</div></li><li><div>                      if (isset($pl['opt']['c']) AND $pl['opt']['c']) {&nbsp;</div></li><li><div>                          $col = $pl['opt']['c'];&nbsp;</div></li><li><div>                          if ($col{0} == 3 || $col{0} == 5) {&nbsp;</div></li><li><div>                              $annotcolor .= sprintf(&quot;%.3F %.3F %.3F&quot;, ord($col{1}) / 255, ord($col{2}) / 255, ord($col{3}) / 255);&nbsp;</div></li><li><div>                          } elseif ($col{0} == 1) {&nbsp;</div></li><li><div>                              $annotcolor .= sprintf(&quot;%.3F&quot;, ord($col{1}) / 255);&nbsp;</div></li><li><div>                          } elseif ($col{0} == 4 || $col{0} == 6) {&nbsp;</div></li><li><div>                              $annotcolor .= sprintf(&quot;%.3F %.3F %.3F %.3F&quot;, ord($col{1}) / 100, ord($col{2}) / 100, ord($col{3}) / 100, ord($col{4}) / 100);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $annotcolor .= '1 1 0';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $annotcolor .= '1 1 0';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $annotcolor .= ']';&nbsp;</div></li><li><div>                      $annot .= $annotcolor;&nbsp;</div></li><li><div>                      <span class="comment">// Usually Author</span>&nbsp;</div></li><li><div>                      <span class="comment">// Use as Title for fileattachment</span>&nbsp;</div></li><li><div>                      if (isset($pl['opt']['t']) AND is_string($pl['opt']['t'])) {&nbsp;</div></li><li><div>                          $annot .= ' /T ' . $this-&gt;_UTF16BEtextstring($pl['opt']['t']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($FileAttachment) {&nbsp;</div></li><li><div>                          $iconsapp = array('Paperclip', 'Graph', 'PushPin', 'Tag');&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $iconsapp = array('Comment', 'Help', 'Insert', 'Key', 'NewParagraph', 'Note', 'Paragraph');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (isset($pl['opt']['icon']) AND in_array($pl['opt']['icon'], $iconsapp)) {&nbsp;</div></li><li><div>                          $annot .= ' /Name /' . $pl['opt']['icon'];&nbsp;</div></li><li><div>                      } elseif ($FileAttachment) {&nbsp;</div></li><li><div>                          $annot .= ' /Name /PushPin';&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $annot .= ' /Name /Note';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (!$FileAttachment) {&nbsp;</div></li><li><div>                          <span class="comment">// /Subj is PDF 1.5 spec.</span>&nbsp;</div></li><li><div>                          if (isset($pl['opt']['subj']) && !$this-&gt;PDFA && !$this-&gt;PDFX) {&nbsp;</div></li><li><div>                              $annot .= ' /Subj ' . $this-&gt;_UTF16BEtextstring($pl['opt']['subj']);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if (!empty($pl['opt']['popup'])) {&nbsp;</div></li><li><div>                              $annot .= ' /Open true';&nbsp;</div></li><li><div>                              $annot .= ' /Popup ' . ($this-&gt;n + 1) . ' 0 R';&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $annot .= ' /Open false';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $annot .= ' /P ' . $pl['pageobj'] . ' 0 R';&nbsp;</div></li><li><div>                      $annot .= '&gt;&gt;';&nbsp;</div></li><li><div>                      $this-&gt;_out($annot);&nbsp;</div></li><li><div>                      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($FileAttachment) {&nbsp;</div></li><li><div>                          $file = @file_get_contents($pl['opt']['file']);&nbsp;</div></li><li><div>                          if (!$file) {&nbsp;</div></li><li><div>                              throw new MpdfException('mPDF Error: Cannot access file attachment - ' . $pl['opt']['file']);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $filestream = gzcompress($file);&nbsp;</div></li><li><div>                          $this-&gt;_newobj();&nbsp;</div></li><li><div>                          $this-&gt;_out('&lt;&lt;/Type /EmbeddedFile');&nbsp;</div></li><li><div>                          $this-&gt;_out('/Length ' . strlen($filestream));&nbsp;</div></li><li><div>                          $this-&gt;_out('/Filter /FlateDecode');&nbsp;</div></li><li><div>                          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                          $this-&gt;_putstream($filestream);&nbsp;</div></li><li><div>                          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>                      } elseif (!empty($pl['opt']['popup'])) {&nbsp;</div></li><li><div>                          $this-&gt;_newobj();&nbsp;</div></li><li><div>                          $annot = '';&nbsp;</div></li><li><div>                          if (is_array($pl['opt']['popup']) && isset($pl['opt']['popup'][0])) {&nbsp;</div></li><li><div>                              $x = $pl['opt']['popup'][0] * _MPDFK;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $x = $pl['x'] * _MPDFK;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if (is_array($pl['opt']['popup']) && isset($pl['opt']['popup'][1])) {&nbsp;</div></li><li><div>                              $y = $hPt - ($pl['opt']['popup'][1] * _MPDFK);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $y = $hPt - ($pl['y'] * _MPDFK);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if (is_array($pl['opt']['popup']) && isset($pl['opt']['popup'][2])) {&nbsp;</div></li><li><div>                              $w = $pl['opt']['popup'][2] * _MPDFK;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $w = 180;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if (is_array($pl['opt']['popup']) && isset($pl['opt']['popup'][3])) {&nbsp;</div></li><li><div>                              $h = $pl['opt']['popup'][3] * _MPDFK;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $h = 120;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $rect = sprintf('%.3F %.3F %.3F %.3F', $x, $y - $h, $x + $w, $y);&nbsp;</div></li><li><div>                          $annot .= '&lt;&lt;/Type /Annot /Subtype /Popup /Rect [' . $rect . ']';&nbsp;</div></li><li><div>                          $annot .= ' /M ' . $this-&gt;_textstring('D:' . date('YmdHis'));&nbsp;</div></li><li><div>                          if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>                              $annot .= ' /F 28';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $annot .= ' /Parent ' . ($this-&gt;n - 1) . ' 0 R';&nbsp;</div></li><li><div>                          $annot .= '&gt;&gt;';&nbsp;</div></li><li><div>                          $this-&gt;_out($annot);&nbsp;</div></li><li><div>                          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Active Forms</span></span></span></span>&nbsp;</div></li><li><div>              if (count($this-&gt;mpdfform-&gt;forms) &gt; 0) {&nbsp;</div></li><li><div>                  $this-&gt;mpdfform-&gt;_putFormItems($n, $hPt);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Active Forms</span></span></span></span> - Radio Button Group entries&nbsp;</div></li><li><div>      <span class="comment">// Output Radio Button Group form entries (radio_on_obj_id already determined)</span>&nbsp;</div></li><li><div>      if (count($this-&gt;mpdfform-&gt;form_radio_groups)) {&nbsp;</div></li><li><div>          $this-&gt;mpdfform-&gt;_putRadioItems($n);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Annotation($text, $x = 0, $y = 0, $icon = 'Note', $author = '', $subject = '', $opacity = 0, $colarray = false, $popup = '', $file = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (is_array($colarray) && count($colarray) == 3) {&nbsp;</div></li><li><div>          $colarray = $this-&gt;ConvertColor('rgb(' . $colarray[0] . ', ' . $colarray[1] . ', ' . $colarray[2] . ')');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($colarray === false) {&nbsp;</div></li><li><div>          $colarray = $this-&gt;ConvertColor('yellow');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($x == 0) {&nbsp;</div></li><li><div>          $x = $this-&gt;x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($y == 0) {&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $page = $this-&gt;page;&nbsp;</div></li><li><div>      if ($page &lt; 1) { <span class="comment">// Document has not been started - assume it's for first page</span>&nbsp;</div></li><li><div>          $page = 1;&nbsp;</div></li><li><div>          if ($x == 0) {&nbsp;</div></li><li><div>              $x = $this-&gt;lMargin;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($y == 0) {&nbsp;</div></li><li><div>              $y = $this-&gt;tMargin;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>          if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>              $this-&gt;PDFAXwarnings[] = &quot;Annotation markers cannot be semi-transparent in PDFA1-b or PDFX/1-a, so they may make underlying text unreadable. (Annotation markers moved to right margin)&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $x = ($this-&gt;w) - $this-&gt;rMargin * 0.66;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;annotMargin) {&nbsp;</div></li><li><div>          $y -= $this-&gt;FontSize / 2;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$opacity && $this-&gt;annotMargin) {&nbsp;</div></li><li><div>          $opacity = 1;&nbsp;</div></li><li><div>      } elseif (!$opacity) {&nbsp;</div></li><li><div>          $opacity = $this-&gt;annotOpacity;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $an = array('txt' =&gt; $text, 'x' =&gt; $x, 'y' =&gt; $y, 'opt' =&gt; array('Icon' =&gt; $icon, 'T' =&gt; $author, 'Subj' =&gt; $subject, 'C' =&gt; $colarray, 'CA' =&gt; $opacity, 'popup' =&gt; $popup, 'file' =&gt; $file));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;keep_block_together) { <span class="comment"><span class="comment"><span class="comment">// don't write</span> yet</span></span>&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      } elseif ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>          $this-&gt;tbrot_Annots[$this-&gt;page][] = $an;&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      } elseif ($this-&gt;kwt) {&nbsp;</div></li><li><div>          $this-&gt;kwt_Annots[$this-&gt;page][] = $an;&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;writingHTMLheader || $this-&gt;writingHTMLfooter) {&nbsp;</div></li><li><div>          $this-&gt;HTMLheaderPageAnnots[] = $an;&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Put an Annotation on the page</span>&nbsp;</div></li><li><div>      $this-&gt;PageAnnots[$page][] = $an;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Save cross-reference to Column buffer</span></span>&nbsp;</div></li><li><div>      $ref = count($this-&gt;PageAnnots[$this-&gt;page]) - 1;&nbsp;</div></li><li><div>      $this-&gt;columnAnnots[$this-&gt;CurrCol][INTVAL($this-&gt;x)][INTVAL($this-&gt;y)] = $ref;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putfonts()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $nf = $this-&gt;n;&nbsp;</div></li><li><div>      foreach ($this-&gt;FontFiles as $fontkey =&gt; $info) {&nbsp;</div></li><li><div>          <span class="comment">// TrueType embedded</span>&nbsp;</div></li><li><div>          if (isset($info['type']) && $info['type'] == 'TTF' && !$info['sip'] && !$info['smp']) {&nbsp;</div></li><li><div>              $used = true;&nbsp;</div></li><li><div>              $asSubset = false;&nbsp;</div></li><li><div>              foreach ($this-&gt;fonts AS $k =&gt; $f) {&nbsp;</div></li><li><div>                  if (isset($f['fontkey']) && $f['fontkey'] == $fontkey && $f['type'] == 'TTF') {&nbsp;</div></li><li><div>                      $used = $f['used'];&nbsp;</div></li><li><div>                      if ($used) {&nbsp;</div></li><li><div>                          $nChars = (ord($f['cw'][0]) &lt;&lt; 8) + ord($f['cw'][1]);&nbsp;</div></li><li><div>                          $usage = intval(count($f['subset']) * 100 / $nChars);&nbsp;</div></li><li><div>                          $fsize = $info['length1'];&nbsp;</div></li><li><div>                          <span class="comment">// Always subset the very large TTF files</span>&nbsp;</div></li><li><div>                          if ($fsize &gt; ($this-&gt;maxTTFFilesize * 1024)) {&nbsp;</div></li><li><div>                              $asSubset = true;&nbsp;</div></li><li><div>                          } elseif ($usage &lt; $this-&gt;percentSubset) {&nbsp;</div></li><li><div>                              $asSubset = true;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($this-&gt;PDFA || $this-&gt;PDFX)&nbsp;</div></li><li><div>                          $asSubset = false;&nbsp;</div></li><li><div>                      $this-&gt;fonts[$k]['asSubset'] = $asSubset;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($used && !$asSubset) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">//Font file</span></span> embedding</span>&nbsp;</div></li><li><div>                  $this-&gt;_newobj();&nbsp;</div></li><li><div>                  $this-&gt;FontFiles[$fontkey]['n'] = $this-&gt;n;&nbsp;</div></li><li><div>                  $font = '';&nbsp;</div></li><li><div>                  $originalsize = $info['length1'];&nbsp;</div></li><li><div>                  if ($this-&gt;repackageTTF || $this-&gt;fonts[$fontkey]['TTCfontID'] &gt; 0 || $this-&gt;fonts[$fontkey]['useOTL'] &gt; 0) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// First see if there is a cached compressed file</span></span>&nbsp;</div></li><li><div>                      if (file_exists(_MPDF_TTFONTDATAPATH . $fontkey . '.ps.z')) {&nbsp;</div></li><li><div>                          $f = fopen(_MPDF_TTFONTDATAPATH . $fontkey . '.ps.z', 'rb');&nbsp;</div></li><li><div>                          if (!$f) {&nbsp;</div></li><li><div>                              throw new MpdfException('Font file .ps.z not found');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          while (!feof($f)) {&nbsp;</div></li><li><div>                              $font .= fread($f, 2048);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          fclose($f);&nbsp;</div></li><li><div>                          include(_MPDF_TTFONTDATAPATH . $fontkey . '.ps.php'); <span class="comment">// sets $originalsize (of repackaged font)</span>&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          if (!class_exists('TTFontFile', false)) {&nbsp;</div></li><li><div>                              include(_MPDF_PATH . 'classes/ttfontsuni.php');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $ttf = new TTFontFile();&nbsp;</div></li><li><div>                          $font = $ttf-&gt;repackageTTF($this-&gt;FontFiles[$fontkey]['ttffile'], $this-&gt;fonts[$fontkey]['TTCfontID'], $this-&gt;debugfonts, $this-&gt;fonts[$fontkey]['useOTL']); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $originalsize = strlen($font);&nbsp;</div></li><li><div>                          $font = gzcompress($font);&nbsp;</div></li><li><div>                          unset($ttf);&nbsp;</div></li><li><div>                          if (is_writable(dirname(_MPDF_TTFONTDATAPATH . 'x'))) {&nbsp;</div></li><li><div>                              $fh = fopen(_MPDF_TTFONTDATAPATH . $fontkey . '.ps.z', &quot;wb&quot;);&nbsp;</div></li><li><div>                              fwrite($fh, $font, strlen($font));&nbsp;</div></li><li><div>                              fclose($fh);&nbsp;</div></li><li><div>                              $fh = fopen(_MPDF_TTFONTDATAPATH . $fontkey . '.ps.php', &quot;wb&quot;);&nbsp;</div></li><li><div>                              $len = &quot;&lt;?php \n&quot;;&nbsp;</div></li><li><div>                              $len.='$originalsize=' . $originalsize . &quot;;\n&quot;;&nbsp;</div></li><li><div>                              $len.=&quot;?&gt;&quot;;&nbsp;</div></li><li><div>                              fwrite($fh, $len, strlen($len));&nbsp;</div></li><li><div>                              fclose($fh);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// First see if there is a cached compressed file</span></span>&nbsp;</div></li><li><div>                      if (file_exists(_MPDF_TTFONTDATAPATH . $fontkey . '.z')) {&nbsp;</div></li><li><div>                          $f = fopen(_MPDF_TTFONTDATAPATH . $fontkey . '.z', 'rb');&nbsp;</div></li><li><div>                          if (!$f) {&nbsp;</div></li><li><div>                              throw new MpdfException('Font file not found');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          while (!feof($f)) {&nbsp;</div></li><li><div>                              $font .= fread($f, 2048);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          fclose($f);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $f = fopen($this-&gt;FontFiles[$fontkey]['ttffile'], 'rb');&nbsp;</div></li><li><div>                          if (!$f) {&nbsp;</div></li><li><div>                              throw new MpdfException('Font file not found');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          while (!feof($f)) {&nbsp;</div></li><li><div>                              $font .= fread($f, 2048);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          fclose($f);&nbsp;</div></li><li><div>                          $font = gzcompress($font);&nbsp;</div></li><li><div>                          if (is_writable(dirname(_MPDF_TTFONTDATAPATH . 'x'))) {&nbsp;</div></li><li><div>                              $fh = fopen(_MPDF_TTFONTDATAPATH . $fontkey . '.z', &quot;wb&quot;);&nbsp;</div></li><li><div>                              fwrite($fh, $font, strlen($font));&nbsp;</div></li><li><div>                              fclose($fh);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $this-&gt;_out('&lt;&lt;/Length ' . strlen($font));&nbsp;</div></li><li><div>                  $this-&gt;_out('/Filter /FlateDecode');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Length1 ' . $originalsize);&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_putstream($font);&nbsp;</div></li><li><div>                  $this-&gt;_out('endobj');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $nfonts = count($this-&gt;fonts);&nbsp;</div></li><li><div>      $fctr = 1;&nbsp;</div></li><li><div>      foreach ($this-&gt;fonts as $k =&gt; $font) {&nbsp;</div></li><li><div>          <span class="comment">//Font objects</span>&nbsp;</div></li><li><div>          $type = $font['type'];&nbsp;</div></li><li><div>          $name = $font['name'];&nbsp;</div></li><li><div>          if ((!isset($font['used']) || !$font['used']) && $type == 'TTF') {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($font['asSubset'])) {&nbsp;</div></li><li><div>              $asSubset = $font['asSubset'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $asSubset = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($type == 'Type0') {  <span class="comment">// = Adobe CJK Fonts</span>&nbsp;</div></li><li><div>              $this-&gt;fonts[$k]['n'] = $this-&gt;n + 1;&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/Type /Font');&nbsp;</div></li><li><div>              $this-&gt;_putType0($font);&nbsp;</div></li><li><div>          } else&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($type == 'core') {&nbsp;</div></li><li><div>              <span class="comment">//Standard font</span>&nbsp;</div></li><li><div>              $this-&gt;fonts[$k]['n'] = $this-&gt;n + 1;&nbsp;</div></li><li><div>              if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>                  throw new MpdfException('Core fonts are not allowed in PDF/A1-b or PDFX/1-a files (Times, Helvetica, Courier etc.)');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/Type /Font');&nbsp;</div></li><li><div>              $this-&gt;_out('/BaseFont /' . $name);&nbsp;</div></li><li><div>              $this-&gt;_out('/Subtype /Type1');&nbsp;</div></li><li><div>              if ($name != 'Symbol' && $name != 'ZapfDingbats') {&nbsp;</div></li><li><div>                  $this-&gt;_out('/Encoding /WinAnsiEncoding');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// TrueType embedded</span> SUBSETS for SIP (CJK extB containing Supplementary Ideographic Plane 2)&nbsp;</div></li><li><div>          <span class="comment">// Or Unicode Plane 1 - Supplementary Multilingual Plane</span>&nbsp;</div></li><li><div>          elseif ($type == 'TTF' && ($font['sip'] || $font['smp'])) {&nbsp;</div></li><li><div>              if (!$font['used']) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $ssfaid = &quot;AA&quot;;&nbsp;</div></li><li><div>              if (!class_exists('TTFontFile', false)) {&nbsp;</div></li><li><div>                  include(_MPDF_PATH . 'classes/ttfontsuni.php');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $ttf = new TTFontFile();&nbsp;</div></li><li><div>              for ($sfid = 0; $sfid &lt; count($font['subsetfontids']); $sfid++) {&nbsp;</div></li><li><div>                  $this-&gt;fonts[$k]['n'][$sfid] = $this-&gt;n + 1;  <span class="comment">// NB an array for subset</span>&nbsp;</div></li><li><div>                  $subsetname = 'MPDF' . $ssfaid . '+' . $font['name'];&nbsp;</div></li><li><div>                  $ssfaid++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/** For some strange reason a subset ($sfid &gt; 0) containing less than 97 characters causes an error</span>&nbsp;</div></li><li><div><span class="comment">                    so fill up the array */</span>&nbsp;</div></li><li><div>                  for ($j = count($font['subsets'][$sfid]); $j &lt; 98; $j++) {&nbsp;</div></li><li><div>                      $font['subsets'][$sfid][$j] = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $subset = $font['subsets'][$sfid];&nbsp;</div></li><li><div>                  unset($subset[0]);&nbsp;</div></li><li><div>                  $ttfontstream = $ttf-&gt;makeSubsetSIP($font['ttffile'], $subset, $font['TTCfontID'], $this-&gt;debugfonts, $font['useOTL']); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $ttfontsize = strlen($ttfontstream);&nbsp;</div></li><li><div>                  $fontstream = gzcompress($ttfontstream);&nbsp;</div></li><li><div>                  $widthstring = '';&nbsp;</div></li><li><div>                  $toUnistring = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  foreach ($font['subsets'][$sfid] AS $cp =&gt; $u) {&nbsp;</div></li><li><div>                      $w = $this-&gt;_getCharWidth($font['cw'], $u);&nbsp;</div></li><li><div>                      if ($w !== false) {&nbsp;</div></li><li><div>                          $widthstring .= $w . ' ';&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $widthstring .= round($ttf-&gt;defaultWidth) . ' ';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($u &gt; 65535) {&nbsp;</div></li><li><div>                          $utf8 = chr(($u &gt;&gt; 18) + 240) . chr((($u &gt;&gt; 12) & 63) + 128) . chr((($u &gt;&gt; 6) & 63) + 128) . chr(($u & 63) + 128);&nbsp;</div></li><li><div>                          $utf16 = mb_convert_encoding($utf8, 'UTF-16BE', 'UTF-8');&nbsp;</div></li><li><div>                          $l1 = ord($utf16[0]);&nbsp;</div></li><li><div>                          $h1 = ord($utf16[1]);&nbsp;</div></li><li><div>                          $l2 = ord($utf16[2]);&nbsp;</div></li><li><div>                          $h2 = ord($utf16[3]);&nbsp;</div></li><li><div>                          $toUnistring .= sprintf(&quot;&lt;%02s&gt; &lt;%02s%02s%02s%02s&gt;\n&quot;, strtoupper(dechex($cp)), strtoupper(dechex($l1)), strtoupper(dechex($h1)), strtoupper(dechex($l2)), strtoupper(dechex($h2)));&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $toUnistring .= sprintf(&quot;&lt;%02s&gt; &lt;%04s&gt;\n&quot;, strtoupper(dechex($cp)), strtoupper(dechex($u)));&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Additional Type1 or TrueType font</span>&nbsp;</div></li><li><div>                  $this-&gt;_newobj();&nbsp;</div></li><li><div>                  $this-&gt;_out('&lt;&lt;/Type /Font');&nbsp;</div></li><li><div>                  $this-&gt;_out('/BaseFont /' . $subsetname);&nbsp;</div></li><li><div>                  $this-&gt;_out('/Subtype /TrueType');&nbsp;</div></li><li><div>                  $this-&gt;_out('/FirstChar 0 /LastChar ' . (count($font['subsets'][$sfid]) - 1));&nbsp;</div></li><li><div>                  $this-&gt;_out('/Widths ' . ($this-&gt;n + 1) . ' 0 R');&nbsp;</div></li><li><div>                  $this-&gt;_out('/FontDescriptor ' . ($this-&gt;n + 2) . ' 0 R');&nbsp;</div></li><li><div>                  $this-&gt;_out('/ToUnicode ' . ($this-&gt;n + 3) . ' 0 R');&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Widths</span>&nbsp;</div></li><li><div>                  $this-&gt;_newobj();&nbsp;</div></li><li><div>                  $this-&gt;_out('[' . $widthstring . ']');&nbsp;</div></li><li><div>                  $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Descriptor</span>&nbsp;</div></li><li><div>                  $this-&gt;_newobj();&nbsp;</div></li><li><div>                  $s = '&lt;&lt;/Type /FontDescriptor /FontName /' . $subsetname . &quot;\n&quot;;&nbsp;</div></li><li><div>                  foreach ($font['desc'] as $kd =&gt; $v) {&nbsp;</div></li><li><div>                      if ($kd == 'Flags') {&nbsp;</div></li><li><div>                          $v = $v | 4;&nbsp;</div></li><li><div>                          $v = $v & ~32;&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment">// SYMBOLIC font flag</span></span>&nbsp;</div></li><li><div>                      $s.=' /' . $kd . ' ' . $v . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $s.='/FontFile2 ' . ($this-&gt;n + 2) . ' 0 R';&nbsp;</div></li><li><div>                  $this-&gt;_out($s . '&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// ToUnicode</span></span>&nbsp;</div></li><li><div>                  $this-&gt;_newobj();&nbsp;</div></li><li><div>                  $toUni = &quot;/CIDInit /ProcSet findresource begin\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;12 dict begin\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;begincmap\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;/CIDSystemInfo\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;&lt;&lt;/Registry (Adobe)\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;/Ordering (UCS)\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;/Supplement 0\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;&gt;&gt; def\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;/CMapName /Adobe-Identity-UCS def\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;/CMapType 2 def\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;1 begincodespacerange\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;&lt;00&gt; &lt;FF&gt;\n&quot;;&nbsp;</div></li><li><div>                  <span class="comment">//$toUni .= sprintf(&quot;&lt;00&gt; &lt;%02s&gt;\n&quot;, strtoupper(dechex(count($font['subsets'][$sfid])-1)));</span>&nbsp;</div></li><li><div>                  $toUni .= &quot;endcodespacerange\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= count($font['subsets'][$sfid]) . &quot; beginbfchar\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= $toUnistring;&nbsp;</div></li><li><div>                  $toUni .= &quot;endbfchar\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;endcmap\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;CMapName currentdict /CMap defineresource pop\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;end\n&quot;;&nbsp;</div></li><li><div>                  $toUni .= &quot;end\n&quot;;&nbsp;</div></li><li><div>                  $this-&gt;_out('&lt;&lt;/Length ' . (strlen($toUni)) . '&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_putstream($toUni);&nbsp;</div></li><li><div>                  $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//Font file</span></span>&nbsp;</div></li><li><div>                  $this-&gt;_newobj();&nbsp;</div></li><li><div>                  $this-&gt;_out('&lt;&lt;/Length ' . strlen($fontstream));&nbsp;</div></li><li><div>                  $this-&gt;_out('/Filter /FlateDecode');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Length1 ' . $ttfontsize);&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_putstream($fontstream);&nbsp;</div></li><li><div>                  $this-&gt;_out('endobj');&nbsp;</div></li><li><div>              } <span class="comment">// foreach subset</span>&nbsp;</div></li><li><div>              unset($ttf);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// TrueType embedded</span> SUBSETS or FULL&nbsp;</div></li><li><div>          elseif ($type == 'TTF') {&nbsp;</div></li><li><div>              $this-&gt;fonts[$k]['n'] = $this-&gt;n + 1;&nbsp;</div></li><li><div>              if ($asSubset) {&nbsp;</div></li><li><div>                  $ssfaid = &quot;A&quot;;&nbsp;</div></li><li><div>                  if (!class_exists('TTFontFile', false)) {&nbsp;</div></li><li><div>                      include(_MPDF_PATH . 'classes/ttfontsuni.php');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $ttf = new TTFontFile();&nbsp;</div></li><li><div>                  $fontname = 'MPDFA' . $ssfaid . '+' . $font['name'];&nbsp;</div></li><li><div>                  $subset = $font['subset'];&nbsp;</div></li><li><div>                  unset($subset[0]);&nbsp;</div></li><li><div>                  $ttfontstream = $ttf-&gt;makeSubset($font['ttffile'], $subset, $font['TTCfontID'], $this-&gt;debugfonts, $font['useOTL']);&nbsp;</div></li><li><div>                  $ttfontsize = strlen($ttfontstream);&nbsp;</div></li><li><div>                  $fontstream = gzcompress($ttfontstream);&nbsp;</div></li><li><div>                  $codeToGlyph = $ttf-&gt;codeToGlyph;&nbsp;</div></li><li><div>                  unset($codeToGlyph[0]);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $fontname = $font['name'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// Type0 Font</span>&nbsp;</div></li><li><div>              <span class="comment">// A composite font - a font composed of other fonts, organized hierarchically</span>&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/Type /Font');&nbsp;</div></li><li><div>              $this-&gt;_out('/Subtype /Type0');&nbsp;</div></li><li><div>              $this-&gt;_out('/BaseFont /' . $fontname . '');&nbsp;</div></li><li><div>              $this-&gt;_out('/Encoding /Identity-H');&nbsp;</div></li><li><div>              $this-&gt;_out('/DescendantFonts [' . ($this-&gt;n + 1) . ' 0 R]');&nbsp;</div></li><li><div>              $this-&gt;_out('/ToUnicode ' . ($this-&gt;n + 2) . ' 0 R');&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// CIDFontType2</span>&nbsp;</div></li><li><div>              <span class="comment">// A CIDFont whose glyph descriptions are based on TrueType font technology</span>&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/Type /Font');&nbsp;</div></li><li><div>              $this-&gt;_out('/Subtype /CIDFontType2');&nbsp;</div></li><li><div>              $this-&gt;_out('/BaseFont /' . $fontname . '');&nbsp;</div></li><li><div>              $this-&gt;_out('/CIDSystemInfo ' . ($this-&gt;n + 2) . ' 0 R');&nbsp;</div></li><li><div>              $this-&gt;_out('/FontDescriptor ' . ($this-&gt;n + 3) . ' 0 R');&nbsp;</div></li><li><div>              if (isset($font['desc']['MissingWidth'])) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/DW ' . $font['desc']['MissingWidth'] . '');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (!$asSubset && file_exists(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cw')) {&nbsp;</div></li><li><div>                  $w = '';&nbsp;</div></li><li><div>                  $w = file_get_contents(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cw');&nbsp;</div></li><li><div>                  $this-&gt;_out($w);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;_putTTfontwidths($font, $asSubset, ($asSubset ? $ttf-&gt;maxUni : 0));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;_out('/CIDToGIDMap ' . ($this-&gt;n + 4) . ' 0 R');&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// ToUnicode</span></span>&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $toUni = &quot;/CIDInit /ProcSet findresource begin\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;12 dict begin\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;begincmap\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;/CIDSystemInfo\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;&lt;&lt;/Registry (Adobe)\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;/Ordering (UCS)\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;/Supplement 0\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;&gt;&gt; def\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;/CMapName /Adobe-Identity-UCS def\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;/CMapType 2 def\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;1 begincodespacerange\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;&lt;0000&gt; &lt;FFFF&gt;\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;endcodespacerange\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;1 beginbfrange\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;&lt;0000&gt; &lt;FFFF&gt; &lt;0000&gt;\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;endbfrange\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;endcmap\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;CMapName currentdict /CMap defineresource pop\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;end\n&quot;;&nbsp;</div></li><li><div>              $toUni .= &quot;end\n&quot;;&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/Length ' . (strlen($toUni)) . '&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_putstream($toUni);&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// CIDSystemInfo dictionary</span>&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/Registry (Adobe)');&nbsp;</div></li><li><div>              $this-&gt;_out('/Ordering (UCS)');&nbsp;</div></li><li><div>              $this-&gt;_out('/Supplement 0');&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Font descriptor</span>&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/Type /FontDescriptor');&nbsp;</div></li><li><div>              $this-&gt;_out('/FontName /' . $fontname);&nbsp;</div></li><li><div>              foreach ($font['desc'] as $kd =&gt; $v) {&nbsp;</div></li><li><div>                  if ($asSubset && $kd == 'Flags') {&nbsp;</div></li><li><div>                      $v = $v | 4;&nbsp;</div></li><li><div>                      $v = $v & ~32;&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment">// SYMBOLIC font flag</span></span>&nbsp;</div></li><li><div>                  $this-&gt;_out(' /' . $kd . ' ' . $v);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($font['panose']) {&nbsp;</div></li><li><div>                  $this-&gt;_out(' /Style &lt;&lt; /Panose &lt;' . $font['panose'] . '&gt; &gt;&gt;');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($asSubset) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/FontFile2 ' . ($this-&gt;n + 2) . ' 0 R');&nbsp;</div></li><li><div>              } elseif ($font['fontkey']) {&nbsp;</div></li><li><div>                  <span class="comment">// obj ID of a stream containing a TrueType font program</span>&nbsp;</div></li><li><div>                  $this-&gt;_out('/FontFile2 ' . $this-&gt;FontFiles[$font['fontkey']]['n'] . ' 0 R');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Embed CIDToGIDMap</span>&nbsp;</div></li><li><div>              <span class="comment">// A specification of the mapping from CIDs to glyph indices</span>&nbsp;</div></li><li><div>              if ($asSubset) {&nbsp;</div></li><li><div>                  $cidtogidmap = '';&nbsp;</div></li><li><div>                  $cidtogidmap = str_pad('', 256 * 256 * 2, &quot;\x00&quot;);&nbsp;</div></li><li><div>                  foreach ($codeToGlyph as $cc =&gt; $glyph) {&nbsp;</div></li><li><div>                      $cidtogidmap[$cc * 2] = chr($glyph &gt;&gt; 8);&nbsp;</div></li><li><div>                      $cidtogidmap[$cc * 2 + 1] = chr($glyph & 0xFF);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $cidtogidmap = gzcompress($cidtogidmap);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment">// First see if there is a cached CIDToGIDMapfile</span>&nbsp;</div></li><li><div>                  $cidtogidmap = '';&nbsp;</div></li><li><div>                  if (file_exists(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cgm')) {&nbsp;</div></li><li><div>                      $f = fopen(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cgm', 'rb');&nbsp;</div></li><li><div>                      while (!feof($f)) {&nbsp;</div></li><li><div>                          $cidtogidmap .= fread($f, 2048);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      fclose($f);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if (!class_exists('TTFontFile', false)) {&nbsp;</div></li><li><div>                          include(_MPDF_PATH . 'classes/ttfontsuni.php');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $ttf = new TTFontFile();&nbsp;</div></li><li><div>                      $charToGlyph = $ttf-&gt;getCTG($font['ttffile'], $font['TTCfontID'], $this-&gt;debugfonts, $font['useOTL']);&nbsp;</div></li><li><div>                      $cidtogidmap = str_pad('', 256 * 256 * 2, &quot;\x00&quot;);&nbsp;</div></li><li><div>                      foreach ($charToGlyph as $cc =&gt; $glyph) {&nbsp;</div></li><li><div>                          $cidtogidmap[$cc * 2] = chr($glyph &gt;&gt; 8);&nbsp;</div></li><li><div>                          $cidtogidmap[$cc * 2 + 1] = chr($glyph & 0xFF);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      unset($ttf);&nbsp;</div></li><li><div>                      $cidtogidmap = gzcompress($cidtogidmap);&nbsp;</div></li><li><div>                      if (is_writable(dirname(_MPDF_TTFONTDATAPATH . 'x'))) {&nbsp;</div></li><li><div>                          $fh = fopen(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cgm', &quot;wb&quot;);&nbsp;</div></li><li><div>                          fwrite($fh, $cidtogidmap, strlen($cidtogidmap));&nbsp;</div></li><li><div>                          fclose($fh);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/Length ' . strlen($cidtogidmap) . '');&nbsp;</div></li><li><div>              $this-&gt;_out('/Filter /FlateDecode');&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_putstream($cidtogidmap);&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Font file</span></span>&nbsp;</div></li><li><div>              if ($asSubset) {&nbsp;</div></li><li><div>                  $this-&gt;_newobj();&nbsp;</div></li><li><div>                  $this-&gt;_out('&lt;&lt;/Length ' . strlen($fontstream));&nbsp;</div></li><li><div>                  $this-&gt;_out('/Filter /FlateDecode');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Length1 ' . $ttfontsize);&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_putstream($fontstream);&nbsp;</div></li><li><div>                  $this-&gt;_out('endobj');&nbsp;</div></li><li><div>                  unset($ttf);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              throw new MpdfException('Unsupported font type: ' . $type . ' (' . $name . ')');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putTTfontwidths(&$font, $asSubset, $maxUni)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($asSubset && file_exists(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cw127.php')) {&nbsp;</div></li><li><div>          include(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cw127.php');&nbsp;</div></li><li><div>          $startcid = 128;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $rangeid = 0;&nbsp;</div></li><li><div>          $range = array();&nbsp;</div></li><li><div>          $prevcid = -2;&nbsp;</div></li><li><div>          $prevwidth = -1;&nbsp;</div></li><li><div>          $interval = false;&nbsp;</div></li><li><div>          $startcid = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($asSubset) {&nbsp;</div></li><li><div>          $cwlen = $maxUni + 1;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $cwlen = (strlen($font['cw']) / 2);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// for each character</span></span>&nbsp;</div></li><li><div>      for ($cid = $startcid; $cid &lt; $cwlen; $cid++) {&nbsp;</div></li><li><div>          if ($cid == 128 && $asSubset && (!file_exists(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cw127.php'))) {&nbsp;</div></li><li><div>              if (is_writable(dirname(_MPDF_TTFONTDATAPATH . 'x'))) {&nbsp;</div></li><li><div>                  $fh = fopen(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cw127.php', &quot;wb&quot;);&nbsp;</div></li><li><div>                  $cw127 = '&lt;?php' . &quot;\n&quot;;&nbsp;</div></li><li><div>                  $cw127.='$rangeid=' . $rangeid . &quot;;\n&quot;;&nbsp;</div></li><li><div>                  $cw127.='$prevcid=' . $prevcid . &quot;;\n&quot;;&nbsp;</div></li><li><div>                  $cw127.='$prevwidth=' . $prevwidth . &quot;;\n&quot;;&nbsp;</div></li><li><div>                  if ($interval) {&nbsp;</div></li><li><div>                      $cw127.='$interval=true' . &quot;;\n&quot;;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $cw127.='$interval=false' . &quot;;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $cw127.='$range=' . var_export($range, true) . &quot;;\n&quot;;&nbsp;</div></li><li><div>                  $cw127.=&quot;?&gt;&quot;;&nbsp;</div></li><li><div>                  fwrite($fh, $cw127, strlen($cw127));&nbsp;</div></li><li><div>                  fclose($fh);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($font['cw'][$cid * 2] == &quot;\00&quot; && $font['cw'][$cid * 2 + 1] == &quot;\00&quot;) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $width = (ord($font['cw'][$cid * 2]) &lt;&lt; 8) + ord($font['cw'][$cid * 2 + 1]);&nbsp;</div></li><li><div>          if ($width == 65535) {&nbsp;</div></li><li><div>              $width = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($asSubset && $cid &gt; 255 && (!isset($font['subset'][$cid]) || !$font['subset'][$cid])) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($asSubset && $cid &gt; 0xFFFF) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (!isset($font['dw']) || (isset($font['dw']) && $width != $font['dw'])) {&nbsp;</div></li><li><div>              if ($cid == ($prevcid + 1)) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// consecutive CID</span></span>&nbsp;</div></li><li><div>                  if ($width == $prevwidth) {&nbsp;</div></li><li><div>                      if ($width == $range[$rangeid][0]) {&nbsp;</div></li><li><div>                          $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          array_pop($range[$rangeid]);&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// new range</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $rangeid = $prevcid;&nbsp;</div></li><li><div>                          $range[$rangeid] = array();&nbsp;</div></li><li><div>                          $range[$rangeid][] = $prevwidth;&nbsp;</div></li><li><div>                          $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $interval = true;&nbsp;</div></li><li><div>                      $range[$rangeid]['interval'] = true;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ($interval) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// new range</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $rangeid = $cid;&nbsp;</div></li><li><div>                          $range[$rangeid] = array();&nbsp;</div></li><li><div>                          $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $interval = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// new range</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $rangeid = $cid;&nbsp;</div></li><li><div>                  $range[$rangeid] = array();&nbsp;</div></li><li><div>                  $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                  $interval = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $prevcid = $cid;&nbsp;</div></li><li><div>              $prevwidth = $width;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $w = $this-&gt;_putfontranges($range);&nbsp;</div></li><li><div>      $this-&gt;_out($w);&nbsp;</div></li><li><div>      if (!$asSubset) {&nbsp;</div></li><li><div>          if (is_writable(dirname(_MPDF_TTFONTDATAPATH . 'x'))) {&nbsp;</div></li><li><div>              $fh = fopen(_MPDF_TTFONTDATAPATH . $font['fontkey'] . '.cw', &quot;wb&quot;);&nbsp;</div></li><li><div>              fwrite($fh, $w, strlen($w));&nbsp;</div></li><li><div>              fclose($fh);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putfontranges(&$range)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// optimize ranges</span>&nbsp;</div></li><li><div>      $prevk = -1;&nbsp;</div></li><li><div>      $nextk = -1;&nbsp;</div></li><li><div>      $prevint = false;&nbsp;</div></li><li><div>      foreach ($range as $k =&gt; $ws) {&nbsp;</div></li><li><div>          $cws = count($ws);&nbsp;</div></li><li><div>          if (($k == $nextk) AND ( !$prevint) AND ( (!isset($ws['interval'])) OR ( $cws &lt; 4))) {&nbsp;</div></li><li><div>              if (isset($range[$k]['interval'])) {&nbsp;</div></li><li><div>                  unset($range[$k]['interval']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $range[$prevk] = array_merge($range[$prevk], $range[$k]);&nbsp;</div></li><li><div>              unset($range[$k]);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $prevk = $k;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $nextk = $k + $cws;&nbsp;</div></li><li><div>          if (isset($ws['interval'])) {&nbsp;</div></li><li><div>              if ($cws &gt; 3) {&nbsp;</div></li><li><div>                  $prevint = true;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $prevint = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              unset($range[$k]['interval']);&nbsp;</div></li><li><div>              --$nextk;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $prevint = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// output data</span>&nbsp;</div></li><li><div>      $w = '';&nbsp;</div></li><li><div>      foreach ($range as $k =&gt; $ws) {&nbsp;</div></li><li><div>          if (count(array_count_values($ws)) == 1) {&nbsp;</div></li><li><div>              <span class="comment">// interval mode is more compact</span>&nbsp;</div></li><li><div>              $w .= ' ' . $k . ' ' . ($k + count($ws) - 1) . ' ' . $ws[0];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">// range mode</span>&nbsp;</div></li><li><div>              $w .= ' ' . $k . ' [ ' . implode(' ', $ws) . ' ]' . &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return '/W [' . $w . ' ]';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putfontwidths(&$font, $cidoffset = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      ksort($font['cw']);&nbsp;</div></li><li><div>      unset($font['cw'][65535]);&nbsp;</div></li><li><div>      $rangeid = 0;&nbsp;</div></li><li><div>      $range = array();&nbsp;</div></li><li><div>      $prevcid = -2;&nbsp;</div></li><li><div>      $prevwidth = -1;&nbsp;</div></li><li><div>      $interval = false;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// for each character</span></span>&nbsp;</div></li><li><div>      foreach ($font['cw'] as $cid =&gt; $width) {&nbsp;</div></li><li><div>          $cid -= $cidoffset;&nbsp;</div></li><li><div>          if (!isset($font['dw']) || (isset($font['dw']) && $width != $font['dw'])) {&nbsp;</div></li><li><div>              if ($cid == ($prevcid + 1)) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// consecutive CID</span></span>&nbsp;</div></li><li><div>                  if ($width == $prevwidth) {&nbsp;</div></li><li><div>                      if ($width == $range[$rangeid][0]) {&nbsp;</div></li><li><div>                          $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          array_pop($range[$rangeid]);&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// new range</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $rangeid = $prevcid;&nbsp;</div></li><li><div>                          $range[$rangeid] = array();&nbsp;</div></li><li><div>                          $range[$rangeid][] = $prevwidth;&nbsp;</div></li><li><div>                          $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $interval = true;&nbsp;</div></li><li><div>                      $range[$rangeid]['interval'] = true;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ($interval) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// new range</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $rangeid = $cid;&nbsp;</div></li><li><div>                          $range[$rangeid] = array();&nbsp;</div></li><li><div>                          $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $interval = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// new range</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $rangeid = $cid;&nbsp;</div></li><li><div>                  $range[$rangeid] = array();&nbsp;</div></li><li><div>                  $range[$rangeid][] = $width;&nbsp;</div></li><li><div>                  $interval = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $prevcid = $cid;&nbsp;</div></li><li><div>              $prevwidth = $width;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_out($this-&gt;_putfontranges($range));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// from class PDF_Chinese CJK EXTENSIONS</span></span>&nbsp;</div></li><li><div>  function _putType0(&$font)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Type0</span>&nbsp;</div></li><li><div>      $this-&gt;_out('/Subtype /Type0');&nbsp;</div></li><li><div>      $this-&gt;_out('/BaseFont /' . $font['name'] . '-' . $font['CMap']);&nbsp;</div></li><li><div>      $this-&gt;_out('/Encoding /' . $font['CMap']);&nbsp;</div></li><li><div>      $this-&gt;_out('/DescendantFonts [' . ($this-&gt;n + 1) . ' 0 R]');&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      <span class="comment">//CIDFont</span>&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;/Type /Font');&nbsp;</div></li><li><div>      $this-&gt;_out('/Subtype /CIDFontType0');&nbsp;</div></li><li><div>      $this-&gt;_out('/BaseFont /' . $font['name']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cidinfo = '/Registry ' . $this-&gt;_textstring('Adobe');&nbsp;</div></li><li><div>      $cidinfo .= ' /Ordering ' . $this-&gt;_textstring($font['registry']['ordering']);&nbsp;</div></li><li><div>      $cidinfo .= ' /Supplement ' . $font['registry']['supplement'];&nbsp;</div></li><li><div>      $this-&gt;_out('/CIDSystemInfo &lt;&lt;' . $cidinfo . '&gt;&gt;');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_out('/FontDescriptor ' . ($this-&gt;n + 1) . ' 0 R');&nbsp;</div></li><li><div>      if (isset($font['MissingWidth'])) {&nbsp;</div></li><li><div>          $this-&gt;_out('/DW ' . $font['MissingWidth'] . '');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_putfontwidths($font, 31);&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Font descriptor</span>&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $s = '&lt;&lt;/Type /FontDescriptor /FontName /' . $font['name'];&nbsp;</div></li><li><div>      foreach ($font['desc'] as $k =&gt; $v) {&nbsp;</div></li><li><div>          if ($k != 'Style') {&nbsp;</div></li><li><div>              $s .= ' /' . $k . ' ' . $v . '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_out($s . '&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putimages()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $filter = ($this-&gt;compress) ? '/Filter /FlateDecode ' : '';&nbsp;</div></li><li><div>      reset($this-&gt;images);&nbsp;</div></li><li><div>      while (list($file, $info) = each($this-&gt;images)) {&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;images[$file]['n'] = $this-&gt;n;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/Type /XObject');&nbsp;</div></li><li><div>          $this-&gt;_out('/Subtype /Image');&nbsp;</div></li><li><div>          $this-&gt;_out('/Width ' . $info['w']);&nbsp;</div></li><li><div>          $this-&gt;_out('/Height ' . $info['h']);&nbsp;</div></li><li><div>          if (isset($info['interpolation']) && $info['interpolation']) {&nbsp;</div></li><li><div>              $this-&gt;_out('/Interpolate true'); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> - image interpolation shall be performed by a conforming reader&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($info['masked'])) {&nbsp;</div></li><li><div>              $this-&gt;_out('/SMask ' . ($this-&gt;n - 1) . ' 0 R');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// set color space</span>&nbsp;</div></li><li><div>          $icc = false;&nbsp;</div></li><li><div>          if (isset($info['icc']) AND ( $info['icc'] !== false)) {&nbsp;</div></li><li><div>              <span class="comment">// ICC Colour Space</span>&nbsp;</div></li><li><div>              $icc = true;&nbsp;</div></li><li><div>              $this-&gt;_out('/ColorSpace [/ICCBased ' . ($this-&gt;n + 1) . ' 0 R]');&nbsp;</div></li><li><div>          } elseif ($info['cs'] == 'Indexed') {&nbsp;</div></li><li><div>              if ($this-&gt;PDFX || ($this-&gt;PDFA && $this-&gt;restrictColorSpace == 3)) {&nbsp;</div></li><li><div>                  throw new MpdfException(&quot;PDFA1-b and PDFX/1-a files do not permit using mixed colour space (&quot; . $file . &quot;).&quot;);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out('/ColorSpace [/Indexed /DeviceRGB ' . (strlen($info['pal']) / 3 - 1) . ' ' . ($this-&gt;n + 1) . ' 0 R]');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out('/ColorSpace /' . $info['cs']);&nbsp;</div></li><li><div>              if ($info['cs'] == 'DeviceCMYK') {&nbsp;</div></li><li><div>                  if ($this-&gt;PDFA && $this-&gt;restrictColorSpace != 3) {&nbsp;</div></li><li><div>                      throw new MpdfException(&quot;PDFA1-b does not permit Images using mixed colour space (&quot; . $file . &quot;).&quot;);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($info['type'] == 'jpg') {&nbsp;</div></li><li><div>                      $this-&gt;_out('/Decode [1 0 1 0 1 0 1 0]');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ($info['cs'] == 'DeviceRGB' && ($this-&gt;PDFX || ($this-&gt;PDFA && $this-&gt;restrictColorSpace == 3))) {&nbsp;</div></li><li><div>                  throw new MpdfException(&quot;PDFA1-b and PDFX/1-a files do not permit using mixed colour space (&quot; . $file . &quot;).&quot;);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out('/BitsPerComponent ' . $info['bpc']);&nbsp;</div></li><li><div>          if (isset($info['f']) && $info['f']) {&nbsp;</div></li><li><div>              $this-&gt;_out('/Filter /' . $info['f']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($info['parms'])) {&nbsp;</div></li><li><div>              $this-&gt;_out($info['parms']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($info['trns']) and is_array($info['trns'])) {&nbsp;</div></li><li><div>              $trns = '';&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; count($info['trns']); $i++)&nbsp;</div></li><li><div>                  $trns.=$info['trns'][$i] . ' ' . $info['trns'][$i] . ' ';&nbsp;</div></li><li><div>              $this-&gt;_out('/Mask [' . $trns . ']');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out('/Length ' . strlen($info['data']) . '&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_putstream($info['data']);&nbsp;</div></li><li><div>          unset($this-&gt;images[$file]['data']);&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// ICC colour profile</span>&nbsp;</div></li><li><div>          if ($icc) {&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $icc = ($this-&gt;compress) ? gzcompress($info['icc']) : $info['icc'];&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/N ' . $info['ch'] . ' ' . $filter . '/Length ' . strlen($icc) . '&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_putstream($icc);&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//Palette</span>&nbsp;</div></li><li><div>          elseif ($info['cs'] == 'Indexed') {&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $pal = ($this-&gt;compress) ? gzcompress($info['pal']) : $info['pal'];&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;' . $filter . '/Length ' . strlen($pal) . '&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_putstream($pal);&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putinfo()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;_out('/Producer ' . $this-&gt;_UTF16BEtextstring('mPDF ' . mPDF_VERSION));&nbsp;</div></li><li><div>      if (!empty($this-&gt;title))&nbsp;</div></li><li><div>          $this-&gt;_out('/Title ' . $this-&gt;_UTF16BEtextstring($this-&gt;title));&nbsp;</div></li><li><div>      if (!empty($this-&gt;subject))&nbsp;</div></li><li><div>          $this-&gt;_out('/Subject ' . $this-&gt;_UTF16BEtextstring($this-&gt;subject));&nbsp;</div></li><li><div>      if (!empty($this-&gt;author))&nbsp;</div></li><li><div>          $this-&gt;_out('/Author ' . $this-&gt;_UTF16BEtextstring($this-&gt;author));&nbsp;</div></li><li><div>      if (!empty($this-&gt;keywords))&nbsp;</div></li><li><div>          $this-&gt;_out('/Keywords ' . $this-&gt;_UTF16BEtextstring($this-&gt;keywords));&nbsp;</div></li><li><div>      if (!empty($this-&gt;creator))&nbsp;</div></li><li><div>          $this-&gt;_out('/Creator ' . $this-&gt;_UTF16BEtextstring($this-&gt;creator));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $z = date('O'); <span class="comment"><span class="comment">// +0200</span></span>&nbsp;</div></li><li><div>      $offset = substr($z, 0, 3) . &quot;'&quot; . substr($z, 3, 2) . &quot;'&quot;;&nbsp;</div></li><li><div>      $this-&gt;_out('/CreationDate ' . $this-&gt;_textstring(date('YmdHis') . $offset));&nbsp;</div></li><li><div>      $this-&gt;_out('/ModDate ' . $this-&gt;_textstring(date('YmdHis') . $offset));&nbsp;</div></li><li><div>      if ($this-&gt;PDFX) {&nbsp;</div></li><li><div>          $this-&gt;_out('/Trapped/False');&nbsp;</div></li><li><div>          $this-&gt;_out('/GTS_PDFXVersion(PDF/X-1a:2003)');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putmetadata()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $this-&gt;MetadataRoot = $this-&gt;n;&nbsp;</div></li><li><div>      $Producer = 'mPDF ' . mPDF_VERSION;&nbsp;</div></li><li><div>      $z = date('O'); <span class="comment"><span class="comment">// +0200</span></span>&nbsp;</div></li><li><div>      $offset = substr($z, 0, 3) . ':' . substr($z, 3, 2);&nbsp;</div></li><li><div>      $CreationDate = date('Y-m-d\TH:i:s') . $offset; <span class="comment">// 2006-03-10T10:47:26-05:00 2006-06-19T09:05:17Z</span>&nbsp;</div></li><li><div>      $uuid = sprintf('%04x%04x-%04x-%04x-%04x-%04x%04x%04x', mt_rand(0, 0xffff), mt_rand(0, 0xffff), mt_rand(0, 0xffff), mt_rand(0, 0x0fff) | 0x4000, mt_rand(0, 0x3fff) | 0x8000, mt_rand(0, 0xffff), mt_rand(0, 0xffff), mt_rand(0, 0xffff));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $m = '&lt;?xpacket begin=&quot;' . chr(239) . chr(187) . chr(191) . '&quot; id=&quot;W5M0MpCehiHzreSzNTczkc9d&quot;?&gt;' . &quot;\n&quot;; <span class="comment">// begin = FEFF BOM</span>&nbsp;</div></li><li><div>      $m .= ' &lt;x:xmpmeta xmlns:x=&quot;adobe:ns:meta/&quot; x:xmptk=&quot;3.1-701&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $m .= '  &lt;rdf:RDF xmlns:rdf=&quot;http:<span class="comment">//www.w3.org/1999/02/22-rdf-syntax-ns#&quot;&gt;' . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>      $m .= '   &lt;rdf:Description rdf:about=&quot;uuid:' . $uuid . '&quot; xmlns:pdf=&quot;http:<span class="comment">//ns.adobe.com/pdf/1.3/&quot;&gt;' . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>      $m .= '    &lt;pdf:Producer&gt;' . $Producer . '&lt;/pdf:Producer&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      if (!empty($this-&gt;keywords)) {&nbsp;</div></li><li><div>          $m .= '    &lt;pdf:Keywords&gt;' . $this-&gt;keywords . '&lt;/pdf:Keywords&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $m .= '   &lt;/rdf:Description&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $m .= '   &lt;rdf:Description rdf:about=&quot;uuid:' . $uuid . '&quot; xmlns:xmp=&quot;http:<span class="comment">//ns.adobe.com/xap/1.0/&quot;&gt;' . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>      $m .= '    &lt;xmp:CreateDate&gt;' . $CreationDate . '&lt;/xmp:CreateDate&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $m .= '    &lt;xmp:ModifyDate&gt;' . $CreationDate . '&lt;/xmp:ModifyDate&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $m .= '    &lt;xmp:MetadataDate&gt;' . $CreationDate . '&lt;/xmp:MetadataDate&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      if (!empty($this-&gt;creator)) {&nbsp;</div></li><li><div>          $m .= '    &lt;xmp:CreatorTool&gt;' . $this-&gt;creator . '&lt;/xmp:CreatorTool&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $m .= '   &lt;/rdf:Description&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// DC elements</span>&nbsp;</div></li><li><div>      $m .= '   &lt;rdf:Description rdf:about=&quot;uuid:' . $uuid . '&quot; xmlns:dc=&quot;http:<span class="comment">//purl.org/dc/elements/1.1/&quot;&gt;' . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>      $m .= '    &lt;dc:format&gt;application/pdf&lt;/dc:format&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      if (!empty($this-&gt;title)) {&nbsp;</div></li><li><div>          $m .= '    &lt;dc:title&gt;&nbsp;</div></li><li><div>   &lt;rdf:Alt&gt;&nbsp;</div></li><li><div>    &lt;rdf:li xml:lang=&quot;x-default&quot;&gt;' . $this-&gt;title . '&lt;/rdf:li&gt;&nbsp;</div></li><li><div>   &lt;/rdf:Alt&gt;&nbsp;</div></li><li><div>  &lt;/dc:title&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!empty($this-&gt;keywords)) {&nbsp;</div></li><li><div>          $m .= '    &lt;dc:subject&gt;&nbsp;</div></li><li><div>   &lt;rdf:Bag&gt;&nbsp;</div></li><li><div>    &lt;rdf:li&gt;' . $this-&gt;keywords . '&lt;/rdf:li&gt;&nbsp;</div></li><li><div>   &lt;/rdf:Bag&gt;&nbsp;</div></li><li><div>  &lt;/dc:subject&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!empty($this-&gt;subject)) {&nbsp;</div></li><li><div>          $m .= '    &lt;dc:description&gt;&nbsp;</div></li><li><div>   &lt;rdf:Alt&gt;&nbsp;</div></li><li><div>    &lt;rdf:li xml:lang=&quot;x-default&quot;&gt;' . $this-&gt;subject . '&lt;/rdf:li&gt;&nbsp;</div></li><li><div>   &lt;/rdf:Alt&gt;&nbsp;</div></li><li><div>  &lt;/dc:description&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!empty($this-&gt;author)) {&nbsp;</div></li><li><div>          $m .= '    &lt;dc:creator&gt;&nbsp;</div></li><li><div>   &lt;rdf:Seq&gt;&nbsp;</div></li><li><div>    &lt;rdf:li&gt;' . $this-&gt;author . '&lt;/rdf:li&gt;&nbsp;</div></li><li><div>   &lt;/rdf:Seq&gt;&nbsp;</div></li><li><div>  &lt;/dc:creator&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $m .= '   &lt;/rdf:Description&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// This bit is specific to PDFX-1a</span>&nbsp;</div></li><li><div>      if ($this-&gt;PDFX) {&nbsp;</div></li><li><div>          $m .= '   &lt;rdf:Description rdf:about=&quot;uuid:' . $uuid . '&quot; xmlns:pdfx=&quot;http:<span class="comment">//ns.adobe.com/pdfx/1.3/&quot; pdfx:Apag_PDFX_Checkup=&quot;1.3&quot; pdfx:GTS_PDFXConformance=&quot;PDF/X-1a:2003&quot; pdfx:GTS_PDFXVersion=&quot;PDF/X-1:2003&quot;/&gt;' . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// This bit is specific to PDFA-1b</span>&nbsp;</div></li><li><div>      elseif ($this-&gt;PDFA) {&nbsp;</div></li><li><div>          $m .= '   &lt;rdf:Description rdf:about=&quot;uuid:' . $uuid . '&quot; xmlns:pdfaid=&quot;http:<span class="comment">//www.aiim.org/pdfa/ns/id/&quot; &gt;' . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>          $m .= '    &lt;pdfaid:part&gt;1&lt;/pdfaid:part&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          $m .= '    &lt;pdfaid:conformance&gt;B&lt;/pdfaid:conformance&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          $m .= '    &lt;pdfaid:amd&gt;2005&lt;/pdfaid:amd&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          $m .= '   &lt;/rdf:Description&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $m .= '   &lt;rdf:Description rdf:about=&quot;uuid:' . $uuid . '&quot; xmlns:xmpMM=&quot;http:<span class="comment">//ns.adobe.com/xap/1.0/mm/&quot;&gt;' . &quot;\n&quot;;</span>&nbsp;</div></li><li><div>      $m .= '    &lt;xmpMM:DocumentID&gt;uuid:' . $uuid . '&lt;/xmpMM:DocumentID&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $m .= '   &lt;/rdf:Description&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $m .= '  &lt;/rdf:RDF&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $m .= ' &lt;/x:xmpmeta&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      $m .= str_repeat(str_repeat(' ', 100) . &quot;\n&quot;, 20); <span class="comment">// 2-4kB whitespace padding required</span>&nbsp;</div></li><li><div>      $m .= '&lt;?xpacket end=&quot;w&quot;?&gt;'; <span class="comment">// &quot;r&quot; read only</span>&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;/Type/Metadata/Subtype/XML/Length ' . strlen($m) . '&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_putstream($m);&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putoutputintent()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $this-&gt;OutputIntentRoot = $this-&gt;n;&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;/Type /OutputIntent');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;PDFA) {&nbsp;</div></li><li><div>          $this-&gt;_out('/S /GTS_PDFA1');&nbsp;</div></li><li><div>          if ($this-&gt;ICCProfile) {&nbsp;</div></li><li><div>              $this-&gt;_out('/Info (' . preg_replace('/_/', ' ', $this-&gt;ICCProfile) . ')');&nbsp;</div></li><li><div>              $this-&gt;_out('/OutputConditionIdentifier (Custom)');&nbsp;</div></li><li><div>              $this-&gt;_out('/OutputCondition ()');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out('/Info (sRGB IEC61966-2.1)');&nbsp;</div></li><li><div>              $this-&gt;_out('/OutputConditionIdentifier (sRGB IEC61966-2.1)');&nbsp;</div></li><li><div>              $this-&gt;_out('/OutputCondition ()');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out('/DestOutputProfile ' . ($this-&gt;n + 1) . ' 0 R');&nbsp;</div></li><li><div>      } elseif ($this-&gt;PDFX) { <span class="comment">// always a CMYK profile</span>&nbsp;</div></li><li><div>          $this-&gt;_out('/S /GTS_PDFX');&nbsp;</div></li><li><div>          if ($this-&gt;ICCProfile) {&nbsp;</div></li><li><div>              $this-&gt;_out('/Info (' . preg_replace('/_/', ' ', $this-&gt;ICCProfile) . ')');&nbsp;</div></li><li><div>              $this-&gt;_out('/OutputConditionIdentifier (Custom)');&nbsp;</div></li><li><div>              $this-&gt;_out('/OutputCondition ()');&nbsp;</div></li><li><div>              $this-&gt;_out('/DestOutputProfile ' . ($this-&gt;n + 1) . ' 0 R');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out('/Info (CGATS TR 001)');&nbsp;</div></li><li><div>              $this-&gt;_out('/OutputConditionIdentifier (CGATS TR 001)');&nbsp;</div></li><li><div>              $this-&gt;_out('/OutputCondition (CGATS TR 001 (SWOP))');&nbsp;</div></li><li><div>              $this-&gt;_out('/RegistryName (http:<span class="comment">//www.color.org)');</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;PDFX && !$this-&gt;ICCProfile) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      } <span class="comment">// no ICCProfile embedded</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      if ($this-&gt;ICCProfile)&nbsp;</div></li><li><div>          $s = file_get_contents(_MPDF_PATH . 'iccprofiles/' . $this-&gt;ICCProfile . '.icc');&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $s = file_get_contents(_MPDF_PATH . 'iccprofiles/sRGB_IEC61966-2-1.icc');&nbsp;</div></li><li><div>      if ($this-&gt;compress) {&nbsp;</div></li><li><div>          $s = gzcompress($s);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>      if ($this-&gt;PDFX || ($this-&gt;PDFA && $this-&gt;restrictColorSpace == 3)) {&nbsp;</div></li><li><div>          $this-&gt;_out('/N 4');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_out('/N 3');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;compress)&nbsp;</div></li><li><div>          $this-&gt;_out('/Filter /FlateDecode ');&nbsp;</div></li><li><div>      $this-&gt;_out('/Length ' . strlen($s) . '&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_putstream($s);&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putcatalog()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;_out('/Type /Catalog');&nbsp;</div></li><li><div>      $this-&gt;_out('/Pages 1 0 R');&nbsp;</div></li><li><div>      if ($this-&gt;ZoomMode == 'fullpage')&nbsp;</div></li><li><div>          $this-&gt;_out('/OpenAction [3 0 R /Fit]');&nbsp;</div></li><li><div>      elseif ($this-&gt;ZoomMode == 'fullwidth')&nbsp;</div></li><li><div>          $this-&gt;_out('/OpenAction [3 0 R /FitH null]');&nbsp;</div></li><li><div>      elseif ($this-&gt;ZoomMode == 'real')&nbsp;</div></li><li><div>          $this-&gt;_out('/OpenAction [3 0 R /XYZ null null 1]');&nbsp;</div></li><li><div>      elseif (!is_string($this-&gt;ZoomMode))&nbsp;</div></li><li><div>          $this-&gt;_out('/OpenAction [3 0 R /XYZ null null ' . ($this-&gt;ZoomMode / 100) . ']');&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $this-&gt;_out('/OpenAction [3 0 R /XYZ null null null]');&nbsp;</div></li><li><div>      if ($this-&gt;LayoutMode == 'single')&nbsp;</div></li><li><div>          $this-&gt;_out('/PageLayout /SinglePage');&nbsp;</div></li><li><div>      elseif ($this-&gt;LayoutMode == 'continuous')&nbsp;</div></li><li><div>          $this-&gt;_out('/PageLayout /OneColumn');&nbsp;</div></li><li><div>      elseif ($this-&gt;LayoutMode == 'twoleft')&nbsp;</div></li><li><div>          $this-&gt;_out('/PageLayout /TwoColumnLeft');&nbsp;</div></li><li><div>      elseif ($this-&gt;LayoutMode == 'tworight')&nbsp;</div></li><li><div>          $this-&gt;_out('/PageLayout /TwoColumnRight');&nbsp;</div></li><li><div>      elseif ($this-&gt;LayoutMode == 'two') {&nbsp;</div></li><li><div>          if ($this-&gt;mirrorMargins) {&nbsp;</div></li><li><div>              $this-&gt;_out('/PageLayout /TwoColumnRight');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out('/PageLayout /TwoColumnLeft');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;BMoutlines) &gt; 0) {&nbsp;</div></li><li><div>          $this-&gt;_out('/Outlines ' . $this-&gt;OutlineRoot . ' 0 R');&nbsp;</div></li><li><div>          $this-&gt;_out('/PageMode /UseOutlines');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (is_int(strpos($this-&gt;DisplayPreferences, 'FullScreen')))&nbsp;</div></li><li><div>          $this-&gt;_out('/PageMode /FullScreen');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Metadata</span>&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>          $this-&gt;_out('/Metadata ' . $this-&gt;MetadataRoot . ' 0 R');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// OutputIntents</span>&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX || $this-&gt;ICCProfile) {&nbsp;</div></li><li><div>          $this-&gt;_out('/OutputIntents [' . $this-&gt;OutputIntentRoot . ' 0 R]');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;mpdfform-&gt;forms) &gt; 0) {&nbsp;</div></li><li><div>          $this-&gt;mpdfform-&gt;_putFormsCatalog();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;js)) {&nbsp;</div></li><li><div>          $this-&gt;_out('/Names &lt;&lt; /JavaScript ' . ($this-&gt;n_js) . ' 0 R &gt;&gt; ');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;DisplayPreferences || $this-&gt;directionality == 'rtl' || $this-&gt;mirrorMargins) {&nbsp;</div></li><li><div>          $this-&gt;_out('/ViewerPreferences&lt;&lt;');&nbsp;</div></li><li><div>          if (is_int(strpos($this-&gt;DisplayPreferences, 'HideMenubar')))&nbsp;</div></li><li><div>              $this-&gt;_out('/HideMenubar true');&nbsp;</div></li><li><div>          if (is_int(strpos($this-&gt;DisplayPreferences, 'HideToolbar')))&nbsp;</div></li><li><div>              $this-&gt;_out('/HideToolbar true');&nbsp;</div></li><li><div>          if (is_int(strpos($this-&gt;DisplayPreferences, 'HideWindowUI')))&nbsp;</div></li><li><div>              $this-&gt;_out('/HideWindowUI true');&nbsp;</div></li><li><div>          if (is_int(strpos($this-&gt;DisplayPreferences, 'DisplayDocTitle')))&nbsp;</div></li><li><div>              $this-&gt;_out('/DisplayDocTitle true');&nbsp;</div></li><li><div>          if (is_int(strpos($this-&gt;DisplayPreferences, 'CenterWindow')))&nbsp;</div></li><li><div>              $this-&gt;_out('/CenterWindow true');&nbsp;</div></li><li><div>          if (is_int(strpos($this-&gt;DisplayPreferences, 'FitWindow')))&nbsp;</div></li><li><div>              $this-&gt;_out('/FitWindow true');&nbsp;</div></li><li><div>          <span class="comment">// /PrintScaling is PDF 1.6 spec.</span>&nbsp;</div></li><li><div>          if (is_int(strpos($this-&gt;DisplayPreferences, 'NoPrintScaling')) && !$this-&gt;PDFA && !$this-&gt;PDFX)&nbsp;</div></li><li><div>              $this-&gt;_out('/PrintScaling /None');&nbsp;</div></li><li><div>          if ($this-&gt;directionality == 'rtl')&nbsp;</div></li><li><div>              $this-&gt;_out('/Direction /R2L');&nbsp;</div></li><li><div>          <span class="comment">// /Duplex is PDF 1.7 spec.</span>&nbsp;</div></li><li><div>          if ($this-&gt;mirrorMargins && !$this-&gt;PDFA && !$this-&gt;PDFX) {&nbsp;</div></li><li><div>              <span class="comment">// if ($this-&gt;DefOrientation=='P') $this-&gt;_out('/Duplex /DuplexFlipShortEdge');</span>&nbsp;</div></li><li><div>              $this-&gt;_out('/Duplex /DuplexFlipLongEdge'); <span class="comment">// PDF v1.7+</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;open_layer_pane && ($this-&gt;hasOC || count($this-&gt;layers)))&nbsp;</div></li><li><div>          $this-&gt;_out('/PageMode /UseOC');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;hasOC || count($this-&gt;layers)) {&nbsp;</div></li><li><div>          $p = $v = $h = $l = $loff = $lall = $as = '';&nbsp;</div></li><li><div>          if ($this-&gt;hasOC) {&nbsp;</div></li><li><div>              if (($this-&gt;hasOC & 1) == 1)&nbsp;</div></li><li><div>                  $p = $this-&gt;n_ocg_print . ' 0 R';&nbsp;</div></li><li><div>              if (($this-&gt;hasOC & 2) == 2)&nbsp;</div></li><li><div>                  $v = $this-&gt;n_ocg_view . ' 0 R';&nbsp;</div></li><li><div>              if (($this-&gt;hasOC & 4) == 4)&nbsp;</div></li><li><div>                  $h = $this-&gt;n_ocg_hidden . ' 0 R';&nbsp;</div></li><li><div>              $as = &quot;&lt;&lt;/Event /Print /OCGs [$p $v $h] /Category [/Print]&gt;&gt; &lt;&lt;/Event /View /OCGs [$p $v $h] /Category [/View]&gt;&gt;&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (count($this-&gt;layers)) {&nbsp;</div></li><li><div>              foreach ($this-&gt;layers as $k =&gt; $layer) {&nbsp;</div></li><li><div>                  if (strtolower($this-&gt;layerDetails[$k]['state']) == 'hidden') {&nbsp;</div></li><li><div>                      $loff .= $layer['n'] . ' 0 R ';&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $l .= $layer['n'] . ' 0 R ';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $lall .= $layer['n'] . ' 0 R ';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out(&quot;/OCProperties &lt;&lt;/OCGs [$p $v $h $lall] /D &lt;&lt;/ON [$p $l] /OFF [$v $h $loff] &quot;);&nbsp;</div></li><li><div>          $this-&gt;_out(&quot;/Order [$v $p $h $lall] &quot;);&nbsp;</div></li><li><div>          if ($as)&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;/AS [$as] &quot;);&nbsp;</div></li><li><div>          $this-&gt;_out(&quot;&gt;&gt;&gt;&gt;&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Inactive function left for backwards compatability</span>&nbsp;</div></li><li><div>  function SetUserRights($enable = true, $annots = &quot;&quot;, $form = &quot;&quot;, $signature = &quot;&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Does nothing</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _enddoc()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;_puthtmlheaders();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Remove references to unused fonts (usually default font)</span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;fonts as $fk =&gt; $font) {&nbsp;</div></li><li><div>          if (isset($font['type']) && $font['type'] == 'TTF' && !$font['used']) {&nbsp;</div></li><li><div>              if ($font['sip'] || $font['smp']) {&nbsp;</div></li><li><div>                  foreach ($font['subsetfontids'] AS $k =&gt; $fid) {&nbsp;</div></li><li><div>                      foreach ($this-&gt;pages AS $pn =&gt; $page) {&nbsp;</div></li><li><div>                          $this-&gt;pages[$pn] = preg_replace('/\s\/F' . $fid . ' \d[\d.]* Tf\s/is', ' ', $this-&gt;pages[$pn]);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  foreach ($this-&gt;pages AS $pn =&gt; $page) {&nbsp;</div></li><li><div>                      $this-&gt;pages[$pn] = preg_replace('/\s\/F' . $font['i'] . ' \d[\d.]* Tf\s/is', ' ', $this-&gt;pages[$pn]);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (count($this-&gt;layers)) {&nbsp;</div></li><li><div>          foreach ($this-&gt;pages AS $pn =&gt; $page) {&nbsp;</div></li><li><div>              preg_match_all('/\/OCZ-index \/ZI(\d+) BDC(.*?)(EMCZ)-index/is', $this-&gt;pages[$pn], $m1);&nbsp;</div></li><li><div>              preg_match_all('/\/OCBZ-index \/ZI(\d+) BDC(.*?)(EMCBZ)-index/is', $this-&gt;pages[$pn], $m2);&nbsp;</div></li><li><div>              preg_match_all('/\/OCGZ-index \/ZI(\d+) BDC(.*?)(EMCGZ)-index/is', $this-&gt;pages[$pn], $m3);&nbsp;</div></li><li><div>              $m = array();&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; 4; $i++) {&nbsp;</div></li><li><div>                  $m[$i] = array_merge($m1[$i], $m2[$i], $m3[$i]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (count($m[0])) {&nbsp;</div></li><li><div>                  $sortarr = array();&nbsp;</div></li><li><div>                  for ($i = 0; $i &lt; count($m[0]); $i++) {&nbsp;</div></li><li><div>                      $key = $m[1][$i] * 2;&nbsp;</div></li><li><div>                      if ($m[3][$i] == 'EMCZ')&nbsp;</div></li><li><div>                          $key +=2; <span class="comment">// background first then gradient then normal</span>&nbsp;</div></li><li><div>                      elseif ($m[3][$i] == 'EMCGZ')&nbsp;</div></li><li><div>                          $key +=1;&nbsp;</div></li><li><div>                      $sortarr[$i] = $key;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  asort($sortarr);&nbsp;</div></li><li><div>                  foreach ($sortarr AS $i =&gt; $k) {&nbsp;</div></li><li><div>                      $this-&gt;pages[$pn] = str_replace($m[0][$i], '', $this-&gt;pages[$pn]);&nbsp;</div></li><li><div>                      $this-&gt;pages[$pn] .= &quot;\n&quot; . $m[0][$i] . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;pages[$pn] = preg_replace('/\/OC[BG]{0, 1}Z-index \/ZI(\d+) BDC/is', '/OC /ZI\\1 BDC ', $this-&gt;pages[$pn]);&nbsp;</div></li><li><div>                  $this-&gt;pages[$pn] = preg_replace('/EMC[BG]{0, 1}Z-index/is', 'EMC', $this-&gt;pages[$pn]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_putpages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_putresources();&nbsp;</div></li><li><div>      <span class="comment">//Info</span>&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $this-&gt;InfoRoot = $this-&gt;n;&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>      $this-&gt;_putinfo();&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// METADATA</span>&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>          $this-&gt;_putmetadata();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// OUTPUT</span>INTENT</span>&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX || $this-&gt;ICCProfile) {&nbsp;</div></li><li><div>          $this-&gt;_putoutputintent();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Catalog</span>&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>      $this-&gt;_putcatalog();&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      <span class="comment">//Cross-ref</span>&nbsp;</div></li><li><div>      $o = strlen($this-&gt;buffer);&nbsp;</div></li><li><div>      $this-&gt;_out('xref');&nbsp;</div></li><li><div>      $this-&gt;_out('0 ' . ($this-&gt;n + 1));&nbsp;</div></li><li><div>      $this-&gt;_out('0000000000 65535 f ');&nbsp;</div></li><li><div>      for ($i = 1; $i &lt;= $this-&gt;n; $i++)&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('%010d 00000 n ', $this-&gt;offsets[$i]));&nbsp;</div></li><li><div>      <span class="comment">//Trailer</span>&nbsp;</div></li><li><div>      $this-&gt;_out('trailer');&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>      $this-&gt;_puttrailer();&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('startxref');&nbsp;</div></li><li><div>      $this-&gt;_out($o);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;buffer .= '%%EOF';&nbsp;</div></li><li><div>      $this-&gt;state = 3;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;enableImports && count($this-&gt;parsers) &gt; 0) {&nbsp;</div></li><li><div>          foreach ($this-&gt;parsers as $k =&gt; $_) {&nbsp;</div></li><li><div>              $this-&gt;parsers[$k]-&gt;closeFile();&nbsp;</div></li><li><div>              $this-&gt;parsers[$k] = null;&nbsp;</div></li><li><div>              unset($this-&gt;parsers[$k]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _beginpage($orientation, $mgl = '', $mgr = '', $mgt = '', $mgb = '', $mgh = '', $mgf = '', $ohname = '', $ehname = '', $ofname = '', $efname = '', $ohvalue = 0, $ehvalue = 0, $ofvalue = 0, $efvalue = 0, $pagesel = '', $newformat = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!($pagesel && $this-&gt;page == 1 && (sprintf(&quot;%0.4f&quot;, $this-&gt;y) == sprintf(&quot;%0.4f&quot;, $this-&gt;tMargin)))) {&nbsp;</div></li><li><div>          $this-&gt;page++;&nbsp;</div></li><li><div>          $this-&gt;pages[$this-&gt;page] = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;state = 2;&nbsp;</div></li><li><div>      $resetHTMLHeadersrequired = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($newformat) {&nbsp;</div></li><li><div>          $this-&gt;_setPageSize($newformat, $orientation);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-PAGE -- */</span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Paged media (page-box)</span>&nbsp;</div></li><li><div>      if ($pagesel || (isset($this-&gt;page_box['using']) && $this-&gt;page_box['using'])) {&nbsp;</div></li><li><div>          if ($pagesel || $this-&gt;page == 1) {&nbsp;</div></li><li><div>              $first = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $first = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;mirrorMargins && ($this-&gt;page % 2 == 0)) {&nbsp;</div></li><li><div>              $oddEven = 'E';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $oddEven = 'O';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($pagesel) {&nbsp;</div></li><li><div>              $psel = $pagesel;&nbsp;</div></li><li><div>          } elseif ($this-&gt;page_box['current']) {&nbsp;</div></li><li><div>              $psel = $this-&gt;page_box['current'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $psel = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * The passed in format should override the @page format</span>&nbsp;</div></li><li><div><span class="comment">           * Until the SetPagedMediaCSS method is rewritten this is the easiest and most effective way</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ( $newformat ) {&nbsp;</div></li><li><div>              $saved_orientation = $orientation;&nbsp;</div></li><li><div>              $saved_newformat = $newformat;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          list($orientation, $mgl, $mgr, $mgt, $mgb, $mgh, $mgf, $hname, $fname, $bg, $resetpagenum, $pagenumstyle, $suppress, $marks, $newformat) = $this-&gt;SetPagedMediaCSS($psel, $first, $oddEven);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/** Reset the orientation and format, if needed */</span>&nbsp;</div></li><li><div>          if ( isset( $saved_newformat ) ) {&nbsp;</div></li><li><div>              $orientation = $saved_orientation;&nbsp;</div></li><li><div>              $newformat = $saved_newformat;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;mirrorMargins && ($this-&gt;page % 2 == 0)) {&nbsp;</div></li><li><div>              if ($hname) {&nbsp;</div></li><li><div>                  $ehvalue = 1;&nbsp;</div></li><li><div>                  $ehname = $hname;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $ehvalue = -1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($fname) {&nbsp;</div></li><li><div>                  $efvalue = 1;&nbsp;</div></li><li><div>                  $efname = $fname;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $efvalue = -1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ($hname) {&nbsp;</div></li><li><div>                  $ohvalue = 1;&nbsp;</div></li><li><div>                  $ohname = $hname;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $ohvalue = -1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($fname) {&nbsp;</div></li><li><div>                  $ofvalue = 1;&nbsp;</div></li><li><div>                  $ofname = $fname;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $ofvalue = -1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($resetpagenum || $pagenumstyle || $suppress) {&nbsp;</div></li><li><div>              $this-&gt;PageNumSubstitutions[] = array('from' =&gt; ($this-&gt;page), 'reset' =&gt; $resetpagenum, 'type' =&gt; $pagenumstyle, 'suppress' =&gt; $suppress);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// PAGED MEDIA - CROP / CROSS MARKS from @PAGE</span></span>&nbsp;</div></li><li><div>          $this-&gt;show_marks = $marks;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Background color</span>&nbsp;</div></li><li><div>          if (isset($bg['BACKGROUND-COLOR'])) {&nbsp;</div></li><li><div>              $cor = $this-&gt;ConvertColor($bg['BACKGROUND-COLOR']);&nbsp;</div></li><li><div>              if ($cor) {&nbsp;</div></li><li><div>                  $this-&gt;bodyBackgroundColor = $cor;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;bodyBackgroundColor = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($bg['BACKGROUND-GRADIENT'])) {&nbsp;</div></li><li><div>              $this-&gt;bodyBackgroundGradient = $bg['BACKGROUND-GRADIENT'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;bodyBackgroundGradient = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Tiling Patterns</span></span>&nbsp;</div></li><li><div>          if (isset($bg['BACKGROUND-IMAGE']) && $bg['BACKGROUND-IMAGE']) {&nbsp;</div></li><li><div>              $ret = $this-&gt;SetBackground($bg, $this-&gt;pgwidth);&nbsp;</div></li><li><div>              if ($ret) {&nbsp;</div></li><li><div>                  $this-&gt;bodyBackgroundImage = $ret;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;bodyBackgroundImage = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;page_box['current'] = $psel;&nbsp;</div></li><li><div>          $this-&gt;page_box['using'] = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-PAGE -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Page</span> orientation</span>&nbsp;</div></li><li><div>      if (!$orientation)&nbsp;</div></li><li><div>          $orientation = $this-&gt;DefOrientation;&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $orientation = strtoupper(substr($orientation, 0, 1));&nbsp;</div></li><li><div>          if ($orientation != $this-&gt;DefOrientation)&nbsp;</div></li><li><div>              $this-&gt;OrientationChanges[$this-&gt;page] = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($orientation != $this-&gt;CurOrientation || $newformat) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">//Change orientation</span>&nbsp;</div></li><li><div>          if ($orientation == 'P') {&nbsp;</div></li><li><div>              $this-&gt;wPt = $this-&gt;fwPt;&nbsp;</div></li><li><div>              $this-&gt;hPt = $this-&gt;fhPt;&nbsp;</div></li><li><div>              $this-&gt;w = $this-&gt;fw;&nbsp;</div></li><li><div>              $this-&gt;h = $this-&gt;fh;&nbsp;</div></li><li><div>              if (($this-&gt;forcePortraitHeaders || $this-&gt;forcePortraitMargins) && $this-&gt;DefOrientation == 'P') {&nbsp;</div></li><li><div>                  $this-&gt;tMargin = $this-&gt;orig_tMargin;&nbsp;</div></li><li><div>                  $this-&gt;bMargin = $this-&gt;orig_bMargin;&nbsp;</div></li><li><div>                  $this-&gt;DeflMargin = $this-&gt;orig_lMargin;&nbsp;</div></li><li><div>                  $this-&gt;DefrMargin = $this-&gt;orig_rMargin;&nbsp;</div></li><li><div>                  $this-&gt;margin_header = $this-&gt;orig_hMargin;&nbsp;</div></li><li><div>                  $this-&gt;margin_footer = $this-&gt;orig_fMargin;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;wPt = $this-&gt;fhPt;&nbsp;</div></li><li><div>              $this-&gt;hPt = $this-&gt;fwPt;&nbsp;</div></li><li><div>              $this-&gt;w = $this-&gt;fh;&nbsp;</div></li><li><div>              $this-&gt;h = $this-&gt;fw;&nbsp;</div></li><li><div>              if (($this-&gt;forcePortraitHeaders || $this-&gt;forcePortraitMargins) && $this-&gt;DefOrientation == 'P') {&nbsp;</div></li><li><div>                  $this-&gt;tMargin = $this-&gt;orig_lMargin;&nbsp;</div></li><li><div>                  $this-&gt;bMargin = $this-&gt;orig_rMargin;&nbsp;</div></li><li><div>                  $this-&gt;DeflMargin = $this-&gt;orig_bMargin;&nbsp;</div></li><li><div>                  $this-&gt;DefrMargin = $this-&gt;orig_tMargin;&nbsp;</div></li><li><div>                  $this-&gt;margin_header = $this-&gt;orig_hMargin;&nbsp;</div></li><li><div>                  $this-&gt;margin_footer = $this-&gt;orig_fMargin;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;CurOrientation = $orientation;&nbsp;</div></li><li><div>          $this-&gt;ResetMargins();&nbsp;</div></li><li><div>          $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>          $this-&gt;PageBreakTrigger = $this-&gt;h - $this-&gt;bMargin;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageDim[$this-&gt;page]['w'] = $this-&gt;w;&nbsp;</div></li><li><div>      $this-&gt;pageDim[$this-&gt;page]['h'] = $this-&gt;h;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageDim[$this-&gt;page]['outer_width_LR'] = isset($this-&gt;page_box['outer_width_LR']) ? $this-&gt;page_box['outer_width_LR'] : 0;&nbsp;</div></li><li><div>      $this-&gt;pageDim[$this-&gt;page]['outer_width_TB'] = isset($this-&gt;page_box['outer_width_TB']) ? $this-&gt;page_box['outer_width_TB'] : 0;&nbsp;</div></li><li><div>      if (!isset($this-&gt;page_box['outer_width_LR']) && !isset($this-&gt;page_box['outer_width_TB'])) {&nbsp;</div></li><li><div>          $this-&gt;pageDim[$this-&gt;page]['bleedMargin'] = 0;&nbsp;</div></li><li><div>      } elseif ($this-&gt;bleedMargin &lt;= $this-&gt;page_box['outer_width_LR'] && $this-&gt;bleedMargin &lt;= $this-&gt;page_box['outer_width_TB']) {&nbsp;</div></li><li><div>          $this-&gt;pageDim[$this-&gt;page]['bleedMargin'] = $this-&gt;bleedMargin;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;pageDim[$this-&gt;page]['bleedMargin'] = min($this-&gt;page_box['outer_width_LR'], $this-&gt;page_box['outer_width_TB']) - 0.01;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If Page Margins are re-defined</span>&nbsp;</div></li><li><div>      <span class="comment">// strlen()&gt;0 is used to pick up (integer) 0, (string) '0', or set value</span>&nbsp;</div></li><li><div>      if ((strlen($mgl) &gt; 0 && $this-&gt;DeflMargin != $mgl) || (strlen($mgr) &gt; 0 && $this-&gt;DefrMargin != $mgr) || (strlen($mgt) &gt; 0 && $this-&gt;tMargin != $mgt) || (strlen($mgb) &gt; 0 && $this-&gt;bMargin != $mgb) || (strlen($mgh) &gt; 0 && $this-&gt;margin_header != $mgh) || (strlen($mgf) &gt; 0 && $this-&gt;margin_footer != $mgf)) {&nbsp;</div></li><li><div>          if (strlen($mgl) &gt; 0)&nbsp;</div></li><li><div>              $this-&gt;DeflMargin = $mgl;&nbsp;</div></li><li><div>          if (strlen($mgr) &gt; 0)&nbsp;</div></li><li><div>              $this-&gt;DefrMargin = $mgr;&nbsp;</div></li><li><div>          if (strlen($mgt) &gt; 0)&nbsp;</div></li><li><div>              $this-&gt;tMargin = $mgt;&nbsp;</div></li><li><div>          if (strlen($mgb) &gt; 0)&nbsp;</div></li><li><div>              $this-&gt;bMargin = $mgb;&nbsp;</div></li><li><div>          if (strlen($mgh) &gt; 0)&nbsp;</div></li><li><div>              $this-&gt;margin_header = $mgh;&nbsp;</div></li><li><div>          if (strlen($mgf) &gt; 0)&nbsp;</div></li><li><div>              $this-&gt;margin_footer = $mgf;&nbsp;</div></li><li><div>          $this-&gt;ResetMargins();&nbsp;</div></li><li><div>          $this-&gt;SetAutoPageBreak($this-&gt;autoPageBreak, $this-&gt;bMargin);&nbsp;</div></li><li><div>          $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>          $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;ResetMargins();&nbsp;</div></li><li><div>      $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>      $this-&gt;SetAutoPageBreak($this-&gt;autoPageBreak, $this-&gt;bMargin);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Reset</span> column top margin</span></span>&nbsp;</div></li><li><div>      $this-&gt;y0 = $this-&gt;tMargin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>      $this-&gt;y = $this-&gt;tMargin;&nbsp;</div></li><li><div>      $this-&gt;FontFamily = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      // HEADERS AND FOOTERS    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($ohvalue &lt; 0 || strtoupper($ohvalue) == 'OFF') {&nbsp;</div></li><li><div>          $this-&gt;HTMLHeader = '';&nbsp;</div></li><li><div>          $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>      } elseif ($ohname && $ohvalue &gt; 0) {&nbsp;</div></li><li><div>          if (preg_match('/^html_(.*)$/i', $ohname, $n)) {&nbsp;</div></li><li><div>              $name = $n[1];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $name = $ohname;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;pageHTMLheaders[$name])) {&nbsp;</div></li><li><div>              $this-&gt;HTMLHeader = $this-&gt;pageHTMLheaders[$name];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;HTMLHeader = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($ehvalue &lt; 0 || strtoupper($ehvalue) == 'OFF') {&nbsp;</div></li><li><div>          $this-&gt;HTMLHeaderE = '';&nbsp;</div></li><li><div>          $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>      } elseif ($ehname && $ehvalue &gt; 0) {&nbsp;</div></li><li><div>          if (preg_match('/^html_(.*)$/i', $ehname, $n)) {&nbsp;</div></li><li><div>              $name = $n[1];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $name = $ehname;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;pageHTMLheaders[$name])) {&nbsp;</div></li><li><div>              $this-&gt;HTMLHeaderE = $this-&gt;pageHTMLheaders[$name];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;HTMLHeaderE = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($ofvalue &lt; 0 || strtoupper($ofvalue) == 'OFF') {&nbsp;</div></li><li><div>          $this-&gt;HTMLFooter = '';&nbsp;</div></li><li><div>          $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>      } elseif ($ofname && $ofvalue &gt; 0) {&nbsp;</div></li><li><div>          if (preg_match('/^html_(.*)$/i', $ofname, $n)) {&nbsp;</div></li><li><div>              $name = $n[1];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $name = $ofname;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;pageHTMLfooters[$name])) {&nbsp;</div></li><li><div>              $this-&gt;HTMLFooter = $this-&gt;pageHTMLfooters[$name];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;HTMLFooter = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($efvalue &lt; 0 || strtoupper($efvalue) == 'OFF') {&nbsp;</div></li><li><div>          $this-&gt;HTMLFooterE = '';&nbsp;</div></li><li><div>          $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>      } elseif ($efname && $efvalue &gt; 0) {&nbsp;</div></li><li><div>          if (preg_match('/^html_(.*)$/i', $efname, $n)) {&nbsp;</div></li><li><div>              $name = $n[1];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $name = $efname;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;pageHTMLfooters[$name])) {&nbsp;</div></li><li><div>              $this-&gt;HTMLFooterE = $this-&gt;pageHTMLfooters[$name];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;HTMLFooterE = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $resetHTMLHeadersrequired = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($resetHTMLHeadersrequired) {&nbsp;</div></li><li><div>          $this-&gt;SetHTMLHeader($this-&gt;HTMLHeader);&nbsp;</div></li><li><div>          $this-&gt;SetHTMLHeader($this-&gt;HTMLHeaderE, 'E');&nbsp;</div></li><li><div>          $this-&gt;SetHTMLFooter($this-&gt;HTMLFooter);&nbsp;</div></li><li><div>          $this-&gt;SetHTMLFooter($this-&gt;HTMLFooterE, 'E');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (($this-&gt;mirrorMargins) && (($this-&gt;page) % 2 == 0)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;_setAutoHeaderHeight($this-&gt;HTMLHeaderE);&nbsp;</div></li><li><div>          $this-&gt;_setAutoFooterHeight($this-&gt;HTMLFooterE);&nbsp;</div></li><li><div>      } else { <span class="comment"><span class="comment"><span class="comment"><span class="comment">// ODD</span></span></span> or DEFAULT</span>&nbsp;</div></li><li><div>          $this-&gt;_setAutoHeaderHeight($this-&gt;HTMLHeader);&nbsp;</div></li><li><div>          $this-&gt;_setAutoFooterHeight($this-&gt;HTMLFooter);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Reset</span> column top margin</span></span>&nbsp;</div></li><li><div>      $this-&gt;y0 = $this-&gt;tMargin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>      $this-&gt;y = $this-&gt;tMargin;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  function _setAutoHeaderHeight(&$htmlh)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">/** Don't apply auto header height if no header exists */</span>&nbsp;</div></li><li><div>      if ((is_string($this-&gt;HTMLHeader) && strlen($this-&gt;HTMLHeader) == 0) && (is_string($this-&gt;HTMLHeaderE) && strlen($this-&gt;HTMLHeaderE) == 0)) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;setAutoTopMargin == 'pad') {&nbsp;</div></li><li><div>          if (isset($htmlh['h']) && $htmlh['h']) {&nbsp;</div></li><li><div>              $h = $htmlh['h'];&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment">// 5.7.3</span></span></span></span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $h = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;tMargin = $this-&gt;margin_header + $h + $this-&gt;orig_tMargin;&nbsp;</div></li><li><div>      } elseif ($this-&gt;setAutoTopMargin == 'stretch') {&nbsp;</div></li><li><div>          if (isset($htmlh['h']) && $htmlh['h']) {&nbsp;</div></li><li><div>              $h = $htmlh['h'];&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment">// 5.7.3</span></span></span></span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $h = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;tMargin = max($this-&gt;orig_tMargin, $this-&gt;margin_header + $h + $this-&gt;autoMarginPadding);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  function _setAutoFooterHeight(&$htmlf)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">/** Don't apply auto footer height if no footer exists */</span>&nbsp;</div></li><li><div>      if ((is_string($this-&gt;HTMLFooter) && strlen($this-&gt;HTMLFooter) == 0) && (is_string($this-&gt;HTMLFooterE) && strlen($this-&gt;HTMLFooterE) == 0)) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;setAutoBottomMargin == 'pad') {&nbsp;</div></li><li><div>          if (isset($htmlf['h']) && $htmlf['h']) {&nbsp;</div></li><li><div>              $h = $htmlf['h'];&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment">// 5.7.3</span></span></span></span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $h = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;bMargin = $this-&gt;margin_footer + $h + $this-&gt;orig_bMargin;&nbsp;</div></li><li><div>          $this-&gt;PageBreakTrigger = $this-&gt;h - $this-&gt;bMargin;&nbsp;</div></li><li><div>      } elseif ($this-&gt;setAutoBottomMargin == 'stretch') {&nbsp;</div></li><li><div>          if (isset($htmlf['h']) && $htmlf['h']) {&nbsp;</div></li><li><div>              $h = $htmlf['h'];&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment">// 5.7.3</span></span></span></span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $h = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;bMargin = max($this-&gt;orig_bMargin, $this-&gt;margin_footer + $h + $this-&gt;autoMarginPadding);&nbsp;</div></li><li><div>          $this-&gt;PageBreakTrigger = $this-&gt;h - $this-&gt;bMargin;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _endpage()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;printfloatbuffer();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;visibility != 'visible')&nbsp;</div></li><li><div>          $this-&gt;SetVisibility('visible');&nbsp;</div></li><li><div>      $this-&gt;EndLayer();&nbsp;</div></li><li><div>      <span class="comment">//End of page contents</span>&nbsp;</div></li><li><div>      $this-&gt;state = 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _newobj($obj_id = false, $onlynewobj = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$obj_id) {&nbsp;</div></li><li><div>          $obj_id = ++$this-&gt;n;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Begin a new object</span>&nbsp;</div></li><li><div>      if (!$onlynewobj) {&nbsp;</div></li><li><div>          $this-&gt;offsets[$obj_id] = strlen($this-&gt;buffer);&nbsp;</div></li><li><div>          $this-&gt;_out($obj_id . ' 0 obj');&nbsp;</div></li><li><div>          $this-&gt;_current_obj_id = $obj_id; <span class="comment">// for later use with encryption</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _dounderline($x, $y, $txt, $OTLdata = false, $textvar = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Now print line exactly where $y secifies - called from Text() and Cell() - adjust  position there</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $w = ($this-&gt;GetStringWidth($txt, false, $OTLdata, $textvar) * _MPDFK) + ($this-&gt;charspacing * mb_strlen($txt, $this-&gt;mb_enc)) + ( $this-&gt;ws * mb_substr_count($txt, ' ', $this-&gt;mb_enc));&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Draw a line</span></span>&nbsp;</div></li><li><div>      return sprintf('%.3F %.3F m %.3F %.3F l S', $x * _MPDFK, ($this-&gt;h - $y) * _MPDFK, ($x * _MPDFK) + $w, ($this-&gt;h - $y) * _MPDFK);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _imageError($file, $firsttime, $msg)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Save re-trying image URL's which have already failed</span></span>&nbsp;</div></li><li><div>      $this-&gt;failedimages[$file] = true;&nbsp;</div></li><li><div>      if ($firsttime && $this-&gt;showImageErrors) {&nbsp;</div></li><li><div>          throw new MpdfException(&quot;IMAGE Error (&quot; . $file . &quot;): &quot; . $msg);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _getImage(&$file, $firsttime = true, $allowvector = true, $orig_srcpath = false, $interpolation = false)&nbsp;</div></li><li><div>  {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// firsttime i.e. whether to add to this-&gt;images - use false when calling iteratively</span>&nbsp;</div></li><li><div>      <span class="comment">// Image Data passed directly as var:varname</span>&nbsp;</div></li><li><div>      if (preg_match('/var:\s*(.*)/', $file, $v)) {&nbsp;</div></li><li><div>          $data = $this-&gt;{$v[1]};&nbsp;</div></li><li><div>          $file = md5($data);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (preg_match('/data:image\/(gif|jpeg|png);base64, (.*)/', $file, $v)) {&nbsp;</div></li><li><div>          $type = $v[1];&nbsp;</div></li><li><div>          $data = base64_decode($v[2]);&nbsp;</div></li><li><div>          $file = md5($data);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span> URLs&nbsp;</div></li><li><div>      if ($firsttime && $file && substr($file, 0, 5) != 'data:') {&nbsp;</div></li><li><div>          $file = str_replace(&quot; &quot;, &quot;%20&quot;, $file);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($firsttime && $orig_srcpath) {&nbsp;</div></li><li><div>          <span class="comment">// If orig_srcpath is a relative file path (and not a URL), then it needs to be URL decoded</span>&nbsp;</div></li><li><div>          if (substr($orig_srcpath, 0, 5) != 'data:') {&nbsp;</div></li><li><div>              $orig_srcpath = str_replace(&quot; &quot;, &quot;%20&quot;, $orig_srcpath);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!preg_match('/^(http|ftp)/', $orig_srcpath)) {&nbsp;</div></li><li><div>              $orig_srcpath = urldecode_parts($orig_srcpath);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $ppUx = 0;&nbsp;</div></li><li><div>      if ($orig_srcpath && isset($this-&gt;images[$orig_srcpath])) {&nbsp;</div></li><li><div>          $file = $orig_srcpath;&nbsp;</div></li><li><div>          return $this-&gt;images[$orig_srcpath];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;images[$file])) {&nbsp;</div></li><li><div>          return $this-&gt;images[$file];&nbsp;</div></li><li><div>      } elseif ($orig_srcpath && isset($this-&gt;formobjects[$orig_srcpath])) {&nbsp;</div></li><li><div>          $file = $orig_srcpath;&nbsp;</div></li><li><div>          return $this-&gt;formobjects[$file];&nbsp;</div></li><li><div>      } elseif (isset($this-&gt;formobjects[$file])) {&nbsp;</div></li><li><div>          return $this-&gt;formobjects[$file];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Save re-trying image URL's which have already failed</span></span>&nbsp;</div></li><li><div>      elseif ($firsttime && isset($this-&gt;failedimages[$file])) {&nbsp;</div></li><li><div>          return $this-&gt;_imageError($file, $firsttime, '');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($data)) {&nbsp;</div></li><li><div>          $type = '';&nbsp;</div></li><li><div>          $data = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($orig_srcpath && $this-&gt;basepathIsLocal && $check = @fopen($orig_srcpath, &quot;rb&quot;)) {&nbsp;</div></li><li><div>              fclose($check);&nbsp;</div></li><li><div>              $file = $orig_srcpath;&nbsp;</div></li><li><div>              $data = file_get_contents($file);&nbsp;</div></li><li><div>              $type = $this-&gt;_imageTypeFromString($data);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$data && $check = @fopen($file, &quot;rb&quot;)) {&nbsp;</div></li><li><div>              fclose($check);&nbsp;</div></li><li><div>              $data = file_get_contents($file);&nbsp;</div></li><li><div>              $type = $this-&gt;_imageTypeFromString($data);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ((!$data || !$type) && !ini_get('allow_url_fopen')) { <span class="comment">// only worth trying if remote file and !ini_get('allow_url_fopen')</span>&nbsp;</div></li><li><div>              $this-&gt;file_get_contents_by_socket($file, $data); <span class="comment"><span class="comment">// needs full url?? even on local (never needed for local)</span></span>&nbsp;</div></li><li><div>              if ($data) {&nbsp;</div></li><li><div>                  $type = $this-&gt;_imageTypeFromString($data);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ((!$data || !$type) && function_exists(&quot;curl_init&quot;)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>              $this-&gt;file_get_contents_by_curl($file, $data);  <span class="comment"><span class="comment">// needs full url?? even on local (never needed for local)</span></span>&nbsp;</div></li><li><div>              if ($data) {&nbsp;</div></li><li><div>                  $type = $this-&gt;_imageTypeFromString($data);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$data) {&nbsp;</div></li><li><div>          return $this-&gt;_imageError($file, $firsttime, 'Could not find image file');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($type)) {&nbsp;</div></li><li><div>          $type = $this-&gt;_imageTypeFromString($data);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (($type == 'wmf' || $type == 'svg') && !$allowvector) {&nbsp;</div></li><li><div>          return $this-&gt;_imageError($file, $firsttime, 'WMF or SVG image file not supported in this context');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// SVG</span>&nbsp;</div></li><li><div>      if ($type == 'svg') {&nbsp;</div></li><li><div>          if (!class_exists('SVG', false)) {&nbsp;</div></li><li><div>              include(_MPDF_PATH . 'classes/svg.php');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $svg = new SVG($this);&nbsp;</div></li><li><div>          $family = $this-&gt;FontFamily;&nbsp;</div></li><li><div>          $style = $this-&gt;FontStyle;&nbsp;</div></li><li><div>          $size = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>          $info = $svg-&gt;ImageSVG($data);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Restore font</span></span>&nbsp;</div></li><li><div>          if ($family)&nbsp;</div></li><li><div>              $this-&gt;SetFont($family, $style, $size, false);&nbsp;</div></li><li><div>          if (!$info) {&nbsp;</div></li><li><div>              return $this-&gt;_imageError($file, $firsttime, 'Error parsing SVG file');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $info['type'] = 'svg';&nbsp;</div></li><li><div>          $info['i'] = count($this-&gt;formobjects) + 1;&nbsp;</div></li><li><div>          $this-&gt;formobjects[$file] = $info;&nbsp;</div></li><li><div>          return $info;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// JPEG</span>&nbsp;</div></li><li><div>      if ($type == 'jpeg' || $type == 'jpg') {&nbsp;</div></li><li><div>          $hdr = $this-&gt;_jpgHeaderFromString($data);&nbsp;</div></li><li><div>          if (!$hdr) {&nbsp;</div></li><li><div>              return $this-&gt;_imageError($file, $firsttime, 'Error parsing JPG header');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $a = $this-&gt;_jpgDataFromHeader($hdr);&nbsp;</div></li><li><div>          $channels = intval($a[4]);&nbsp;</div></li><li><div>          $j = strpos($data, 'JFIF');&nbsp;</div></li><li><div>          if ($j) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Read resolution</span></span>&nbsp;</div></li><li><div>              $unitSp = ord(substr($data, ($j + 7), 1));&nbsp;</div></li><li><div>              if ($unitSp &gt; 0) {&nbsp;</div></li><li><div>                  $ppUx = $this-&gt;_twobytes2int(substr($data, ($j + 8), 2)); <span class="comment"><span class="comment">// horizontal pixels per meter, usually set to zero</span></span>&nbsp;</div></li><li><div>                  if ($unitSp == 2) { <span class="comment">// = dots per cm (if == 1 set as dpi)</span>&nbsp;</div></li><li><div>                      $ppUx = round($ppUx / 10 * 25.4);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($a[2] == 'DeviceCMYK' && (($this-&gt;PDFA && $this-&gt;restrictColorSpace != 3) || $this-&gt;restrictColorSpace == 2)) {&nbsp;</div></li><li><div>              <span class="comment">// convert to RGB image</span>&nbsp;</div></li><li><div>              if (!function_exists(&quot;gd_info&quot;)) {&nbsp;</div></li><li><div>                  throw new MpdfException(&quot;JPG image may not use CMYK color space (&quot; . $file . &quot;).&quot;);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;PDFA && !$this-&gt;PDFAauto) {&nbsp;</div></li><li><div>                  $this-&gt;PDFAXwarnings[] = &quot;JPG image may not use CMYK color space - &quot; . $file . &quot; - (Image converted to RGB. NB This will alter the colour profile of the image.)&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $im = @imagecreatefromstring($data);&nbsp;</div></li><li><div>              if ($im) {&nbsp;</div></li><li><div>                  $tempfile = _MPDF_TEMP_PATH . '_tempImgPNG' . md5($file) . RAND(1, 10000) . '.png';&nbsp;</div></li><li><div>                  imageinterlace($im, false);&nbsp;</div></li><li><div>                  $check = @imagepng($im, $tempfile);&nbsp;</div></li><li><div>                  if (!$check) {&nbsp;</div></li><li><div>                      return $this-&gt;_imageError($file, $firsttime, 'Error creating temporary file (' . $tempfile . ') whilst using GD library to parse JPG(CMYK) image');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $info = $this-&gt;_getImage($tempfile, false);&nbsp;</div></li><li><div>                  if (!$info) {&nbsp;</div></li><li><div>                      return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file (' . $tempfile . ') created with GD library to parse JPG(CMYK) image');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  imagedestroy($im);&nbsp;</div></li><li><div>                  unlink($tempfile);&nbsp;</div></li><li><div>                  $info['type'] = 'jpg';&nbsp;</div></li><li><div>                  if ($firsttime) {&nbsp;</div></li><li><div>                      $info['i'] = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>                      $info['interpolation'] = $interpolation; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;images[$file] = $info;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  return $info;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, 'Error creating GD image file from JPG(CMYK) image');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($a[2] == 'DeviceRGB' && ($this-&gt;PDFX || $this-&gt;restrictColorSpace == 3)) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Convert to CMYK image stream - nominally returned as type='png'</span></span>&nbsp;</div></li><li><div>              $info = $this-&gt;_convImage($data, $a[2], 'DeviceCMYK', $a[0], $a[1], $ppUx, false);&nbsp;</div></li><li><div>              if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>                  $this-&gt;PDFAXwarnings[] = &quot;JPG image may not use RGB color space - &quot; . $file . &quot; - (Image converted to CMYK. NB This will alter the colour profile of the image.)&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif (($a[2] == 'DeviceRGB' || $a[2] == 'DeviceCMYK') && $this-&gt;restrictColorSpace == 1) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Convert to Grayscale image stream - nominally returned as type='png'</span></span>&nbsp;</div></li><li><div>              $info = $this-&gt;_convImage($data, $a[2], 'DeviceGray', $a[0], $a[1], $ppUx, false);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Detect Adobe APP14 Tag&nbsp;</div></li><li><div>              <span class="comment">//$pos = strpos($data, &quot;\xFF\xEE\x00\x0EAdobe\0&quot;);</span>&nbsp;</div></li><li><div>              <span class="comment">//if ($pos !== false) {</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//}</span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> ICC profile&nbsp;</div></li><li><div>              $offset = 0;&nbsp;</div></li><li><div>              $icc = array();&nbsp;</div></li><li><div>              while (($pos = strpos($data, &quot;ICC_PROFILE\0&quot;, $offset)) !== false) {&nbsp;</div></li><li><div>                  <span class="comment">// get ICC sequence length</span>&nbsp;</div></li><li><div>                  $length = $this-&gt;_twobytes2int(substr($data, ($pos - 2), 2)) - 16;&nbsp;</div></li><li><div>                  $sn = max(1, ord($data[($pos + 12)]));&nbsp;</div></li><li><div>                  $nom = max(1, ord($data[($pos + 13)]));&nbsp;</div></li><li><div>                  $icc[($sn - 1)] = substr($data, ($pos + 14), $length);&nbsp;</div></li><li><div>                  $offset = ($pos + 14 + $length);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// order and compact ICC segments</span>&nbsp;</div></li><li><div>              if (count($icc) &gt; 0) {&nbsp;</div></li><li><div>                  ksort($icc);&nbsp;</div></li><li><div>                  $icc = implode('', $icc);&nbsp;</div></li><li><div>                  if (substr($icc, 36, 4) != 'acsp') {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment">// invalid ICC profile</span></span></span>&nbsp;</div></li><li><div>                      $icc = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $input = substr($icc, 16, 4);&nbsp;</div></li><li><div>                  $output = substr($icc, 20, 4);&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// Ignore Color profiles for conversion to other colorspaces e.g. CMYK/Lab</span></span></span>&nbsp;</div></li><li><div>                  if ($input != 'RGB ' || $output != 'XYZ ') {&nbsp;</div></li><li><div>                      $icc = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $icc = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $info = array('w' =&gt; $a[0], 'h' =&gt; $a[1], 'cs' =&gt; $a[2], 'bpc' =&gt; $a[3], 'f' =&gt; 'DCTDecode', 'data' =&gt; $data, 'type' =&gt; 'jpg', 'ch' =&gt; $channels, 'icc' =&gt; $icc);&nbsp;</div></li><li><div>              if ($ppUx) {&nbsp;</div></li><li><div>                  $info['set-dpi'] = $ppUx;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$info) {&nbsp;</div></li><li><div>              return $this-&gt;_imageError($file, $firsttime, 'Error parsing or converting JPG image');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($firsttime) {&nbsp;</div></li><li><div>              $info['i'] = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>              $info['interpolation'] = $interpolation; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;images[$file] = $info;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $info;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// PNG</span>&nbsp;</div></li><li><div>      elseif ($type == 'png') {&nbsp;</div></li><li><div>          <span class="comment">//Check signature</span>&nbsp;</div></li><li><div>          if (substr($data, 0, 8) != chr(137) . 'PNG' . chr(13) . chr(10) . chr(26) . chr(10)) {&nbsp;</div></li><li><div>              return $this-&gt;_imageError($file, $firsttime, 'Error parsing PNG identifier');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//Read header chunk</span>&nbsp;</div></li><li><div>          if (substr($data, 12, 4) != 'IHDR') {&nbsp;</div></li><li><div>              return $this-&gt;_imageError($file, $firsttime, 'Incorrect PNG file (no IHDR block found)');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $w = $this-&gt;_fourbytes2int(substr($data, 16, 4));&nbsp;</div></li><li><div>          $h = $this-&gt;_fourbytes2int(substr($data, 20, 4));&nbsp;</div></li><li><div>          $bpc = ord(substr($data, 24, 1));&nbsp;</div></li><li><div>          $errpng = false;&nbsp;</div></li><li><div>          $pngalpha = false;&nbsp;</div></li><li><div>          $channels = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          //    if($bpc&gt;8) { $errpng = 'not 8-bit depth'; }    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Allow through to be handled as native PNG&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $ct = ord(substr($data, 25, 1));&nbsp;</div></li><li><div>          if ($ct == 0) {&nbsp;</div></li><li><div>              $colspace = 'DeviceGray';&nbsp;</div></li><li><div>              $channels = 1;&nbsp;</div></li><li><div>          } elseif ($ct == 2) {&nbsp;</div></li><li><div>              $colspace = 'DeviceRGB';&nbsp;</div></li><li><div>              $channels = 3;&nbsp;</div></li><li><div>          } elseif ($ct == 3) {&nbsp;</div></li><li><div>              $colspace = 'Indexed';&nbsp;</div></li><li><div>              $channels = 1;&nbsp;</div></li><li><div>          } elseif ($ct == 4) {&nbsp;</div></li><li><div>              $colspace = 'DeviceGray';&nbsp;</div></li><li><div>              $channels = 1;&nbsp;</div></li><li><div>              $errpng = 'alpha channel';&nbsp;</div></li><li><div>              $pngalpha = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $colspace = 'DeviceRGB';&nbsp;</div></li><li><div>              $channels = 3;&nbsp;</div></li><li><div>              $errpng = 'alpha channel';&nbsp;</div></li><li><div>              $pngalpha = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($ct &lt; 4 && strpos($data, 'tRNS') !== false) {&nbsp;</div></li><li><div>              $errpng = 'transparency';&nbsp;</div></li><li><div>              $pngalpha = true;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($ct == 3 && strpos($data, 'iCCP') !== false) {&nbsp;</div></li><li><div>              $errpng = 'indexed plus ICC';&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment">// $pngalpha is used as a FLAG of any kind of transparency which COULD be tranferred to an alpha channel</span>&nbsp;</div></li><li><div>          <span class="comment">// incl. single-color tarnsparency, depending which type of handling occurs later</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (ord(substr($data, 26, 1)) != 0) {&nbsp;</div></li><li><div>              $errpng = 'compression method';&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment">// only 0 should be specified</span></span>&nbsp;</div></li><li><div>          if (ord(substr($data, 27, 1)) != 0) {&nbsp;</div></li><li><div>              $errpng = 'filter method';&nbsp;</div></li><li><div>          }  <span class="comment"><span class="comment">// only 0 should be specified</span></span>&nbsp;</div></li><li><div>          if (ord(substr($data, 28, 1)) != 0) {&nbsp;</div></li><li><div>              $errpng = 'interlaced file';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $j = strpos($data, 'pHYs');&nbsp;</div></li><li><div>          if ($j) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Read resolution</span></span>&nbsp;</div></li><li><div>              $unitSp = ord(substr($data, ($j + 12), 1));&nbsp;</div></li><li><div>              if ($unitSp == 1) {&nbsp;</div></li><li><div>                  $ppUx = $this-&gt;_fourbytes2int(substr($data, ($j + 4), 4)); <span class="comment"><span class="comment">// horizontal pixels per meter, usually set to zero</span></span>&nbsp;</div></li><li><div>                  $ppUx = round($ppUx / 1000 * 25.4);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>          $gamma_correction = 0;&nbsp;</div></li><li><div>          $gAMA = 0;&nbsp;</div></li><li><div>          $j = strpos($data, 'gAMA');&nbsp;</div></li><li><div>          if ($j && strpos($data, 'sRGB') === false) { <span class="comment">// sRGB colorspace - overrides gAMA</span>&nbsp;</div></li><li><div>              $gAMA = $this-&gt;_fourbytes2int(substr($data, ($j + 4), 4)); <span class="comment">// Gamma value times 100000</span>&nbsp;</div></li><li><div>              $gAMA /= 100000;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// http://www.libpng.org/pub/png/spec/1.2/PNG-Encoders.html</span>&nbsp;</div></li><li><div>              <span class="comment">// &quot;If the source file's gamma value is greater than 1.0, it is probably a display system exponent, ...&quot;</span>&nbsp;</div></li><li><div>              <span class="comment">// (&quot;..and you should use its reciprocal for the PNG gamma.&quot;)</span>&nbsp;</div></li><li><div>              <span class="comment">//if ($gAMA &gt; 1) { $gAMA = 1/$gAMA; }</span>&nbsp;</div></li><li><div>              <span class="comment">// (Some) Applications seem to ignore it... appearing how it was probably intended</span>&nbsp;</div></li><li><div>              <span class="comment">// Test Case - image(s) on http://www.w3.org/TR/CSS21/intro.html  - PNG has gAMA set as 1.45454</span>&nbsp;</div></li><li><div>              <span class="comment">// Probably unintentional as mentioned above and should be 0.45454 which is 1 / 2.2</span>&nbsp;</div></li><li><div>              <span class="comment">// Tested on Windows PC</span>&nbsp;</div></li><li><div>              <span class="comment">// Firefox and Opera display gray as 234 (correct, but looks wrong)</span>&nbsp;</div></li><li><div>              <span class="comment">// IE9 and Safari display gray as 193 (incorrect but looks right)</span>&nbsp;</div></li><li><div>              <span class="comment">// See test different gamma chunks at http://www.libpng.org/pub/png/pngsuite-all-good.html</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($gAMA) {&nbsp;</div></li><li><div>              $gamma_correction = 1 / $gAMA;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Don't need to apply gamma correction if == default i.e. 2.2</span>&nbsp;</div></li><li><div>          if ($gamma_correction &gt; 2.15 && $gamma_correction &lt; 2.25) {&nbsp;</div></li><li><div>              $gamma_correction = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// NOT supported at present</span>&nbsp;</div></li><li><div>          //$j = strpos($data, 'sRGB');    <span class="comment">// sRGB colorspace - overrides gAMA</span>&nbsp;</div></li><li><div>          <span class="comment">//$j = strpos($data, 'cHRM');    // Chromaticity and Whitepoint</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// $firsttime added mPDF 6 so when PNG Grayscale with alpha using resrtictcolorspace to CMYK</span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// the alpha channel is sent through as secondtime as Indexed and should not be converted to CMYK</span></span>&nbsp;</div></li><li><div>          if ($firsttime && ($colspace == 'DeviceRGB' || $colspace == 'Indexed') && ($this-&gt;PDFX || $this-&gt;restrictColorSpace == 3)) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Convert to CMYK image stream - nominally returned as type='png'</span></span>&nbsp;</div></li><li><div>              $info = $this-&gt;_convImage($data, $colspace, 'DeviceCMYK', $w, $h, $ppUx, $pngalpha, $gamma_correction, $ct); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>              if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>                  $this-&gt;PDFAXwarnings[] = &quot;PNG image may not use RGB color space - &quot; . $file . &quot; - (Image converted to CMYK. NB This will alter the colour profile of the image.)&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// $firsttime added mPDF 6 so when PNG Grayscale with alpha using resrtictcolorspace to CMYK</span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// the alpha channel is sent through as secondtime as Indexed and should not be converted to CMYK</span></span>&nbsp;</div></li><li><div>          elseif ($firsttime && ($colspace == 'DeviceRGB' || $colspace == 'Indexed') && $this-&gt;restrictColorSpace == 1) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Convert to Grayscale image stream - nominally returned as type='png'</span></span>&nbsp;</div></li><li><div>              $info = $this-&gt;_convImage($data, $colspace, 'DeviceGray', $w, $h, $ppUx, $pngalpha, $gamma_correction, $ct); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>          } elseif (($this-&gt;PDFA || $this-&gt;PDFX) && $pngalpha) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Remove alpha channel</span>&nbsp;</div></li><li><div>              if ($this-&gt;restrictColorSpace == 1) { <span class="comment"><span class="comment">// Gray</span></span>scale&nbsp;</div></li><li><div>                  $info = $this-&gt;_convImage($data, $colspace, 'DeviceGray', $w, $h, $ppUx, $pngalpha, $gamma_correction, $ct); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>              } elseif ($this-&gt;restrictColorSpace == 3) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $info = $this-&gt;_convImage($data, $colspace, 'DeviceCMYK', $w, $h, $ppUx, $pngalpha, $gamma_correction, $ct); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>              } elseif ($this-&gt;PDFA) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $info = $this-&gt;_convImage($data, $colspace, 'DeviceRGB', $w, $h, $ppUx, $pngalpha, $gamma_correction, $ct); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>                  $this-&gt;PDFAXwarnings[] = &quot;Transparency (alpha channel) not permitted in PDFA or PDFX files - &quot; . $file . &quot; - (Image converted to one without transparency.)&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($firsttime && ($errpng || $pngalpha || $gamma_correction)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>              if (function_exists('gd_info')) {&nbsp;</div></li><li><div>                  $gd = gd_info();&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $gd = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!isset($gd['PNG Support'])) {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, 'GD library required for PNG image (' . $errpng . ')');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $im = imagecreatefromstring($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (!$im) {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, 'Error creating GD image from PNG file (' . $errpng . ')');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $w = imagesx($im);&nbsp;</div></li><li><div>              $h = imagesy($im);&nbsp;</div></li><li><div>              if ($im) {&nbsp;</div></li><li><div>                  $tempfile = _MPDF_TEMP_PATH . '_tempImgPNG' . md5($file) . RAND(1, 10000) . '.png';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Alpha channel set (including using tRNS for Paletted images)</span>&nbsp;</div></li><li><div>                  if ($pngalpha) {&nbsp;</div></li><li><div>                      if ($this-&gt;PDFA) {&nbsp;</div></li><li><div>                          throw new MpdfException(&quot;PDFA1-b does not permit images with alpha channel transparency (&quot; . $file . &quot;).&quot;);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $imgalpha = imagecreate($w, $h);&nbsp;</div></li><li><div>                      <span class="comment">// generate gray scale pallete</span>&nbsp;</div></li><li><div>                      for ($c = 0; $c &lt; 256; ++$c) {&nbsp;</div></li><li><div>                          imagecolorallocate($imgalpha, $c, $c, $c);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if ($colspace == 'Indexed') { <span class="comment"><span class="comment"><span class="comment">// generate Alpha channel values from tRNS</span></span></span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Read transparency info</span></span></span></span>&nbsp;</div></li><li><div>                          $transparency = '';&nbsp;</div></li><li><div>                          $p = strpos($data, 'tRNS');&nbsp;</div></li><li><div>                          if ($p) {&nbsp;</div></li><li><div>                              $n = $this-&gt;_fourbytes2int(substr($data, ($p - 4), 4));&nbsp;</div></li><li><div>                              $transparency = substr($data, ($p + 4), $n);&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment">// ord($transparency{$index}) = the alpha value for that index</span></span>&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// generate alpha channel</span></span></span></span>&nbsp;</div></li><li><div>                              for ($ypx = 0; $ypx &lt; $h; ++$ypx) {&nbsp;</div></li><li><div>                                  for ($xpx = 0; $xpx &lt; $w; ++$xpx) {&nbsp;</div></li><li><div>                                      $colorindex = imagecolorat($im, $xpx, $ypx);&nbsp;</div></li><li><div>                                      if ($colorindex &gt;= $n) {&nbsp;</div></li><li><div>                                          $alpha = 255;&nbsp;</div></li><li><div>                                      } else {&nbsp;</div></li><li><div>                                          $alpha = ord($transparency{$colorindex});&nbsp;</div></li><li><div>                                      } <span class="comment"><span class="comment">// 0-255</span></span>&nbsp;</div></li><li><div>                                      if ($alpha &gt; 0) {&nbsp;</div></li><li><div>                                          imagesetpixel($imgalpha, $xpx, $ypx, $alpha);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif ($ct === 0 || $ct == 2) { <span class="comment"><span class="comment"><span class="comment">// generate Alpha channel values from tRNS</span></span></span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// Get transparency as array of RGB</span></span>&nbsp;</div></li><li><div>                          $p = strpos($data, 'tRNS');&nbsp;</div></li><li><div>                          if ($p) {&nbsp;</div></li><li><div>                              $trns = '';&nbsp;</div></li><li><div>                              $n = $this-&gt;_fourbytes2int(substr($data, ($p - 4), 4));&nbsp;</div></li><li><div>                              $t = substr($data, ($p + 4), $n);&nbsp;</div></li><li><div>                              if ($colspace == 'DeviceGray') {  <span class="comment"><span class="comment"><span class="comment">// ct===0</span></span></span>&nbsp;</div></li><li><div>                                  $trns = array($this-&gt;_trnsvalue(substr($t, 0, 2), $bpc));&nbsp;</div></li><li><div>                              } else <span class="comment"><span class="comment">/** $colspace=='DeviceRGB' */</span></span> {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ct==2</span></span></span></span></span>&nbsp;</div></li><li><div>                                  $trns = array();&nbsp;</div></li><li><div>                                  $trns[0] = $this-&gt;_trnsvalue(substr($t, 0, 2), $bpc);&nbsp;</div></li><li><div>                                  $trns[1] = $this-&gt;_trnsvalue(substr($t, 2, 2), $bpc);&nbsp;</div></li><li><div>                                  $trns[2] = $this-&gt;_trnsvalue(substr($t, 4, 2), $bpc);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// generate alpha channel</span></span></span></span>&nbsp;</div></li><li><div>                              for ($ypx = 0; $ypx &lt; $h; ++$ypx) {&nbsp;</div></li><li><div>                                  for ($xpx = 0; $xpx &lt; $w; ++$xpx) {&nbsp;</div></li><li><div>                                      $rgb = imagecolorat($im, $xpx, $ypx);&nbsp;</div></li><li><div>                                      $r = ($rgb &gt;&gt; 16) & 0xFF;&nbsp;</div></li><li><div>                                      $g = ($rgb &gt;&gt; 8) & 0xFF;&nbsp;</div></li><li><div>                                      $b = $rgb & 0xFF;&nbsp;</div></li><li><div>                                      if ($colspace == 'DeviceGray' && $b == $trns[0]) {&nbsp;</div></li><li><div>                                          $alpha = 0;&nbsp;</div></li><li><div>                                      } elseif ($r == $trns[0] && $g == $trns[1] && $b == $trns[2]) {&nbsp;</div></li><li><div>                                          $alpha = 0;&nbsp;</div></li><li><div>                                      }  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ct==2</span></span></span></span></span>&nbsp;</div></li><li><div>                                      else {&nbsp;</div></li><li><div>                                          $alpha = 255;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                      if ($alpha &gt; 0) {&nbsp;</div></li><li><div>                                          imagesetpixel($imgalpha, $xpx, $ypx, $alpha);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          <span class="comment">// extract alpha channel</span>&nbsp;</div></li><li><div>                          for ($ypx = 0; $ypx &lt; $h; ++$ypx) {&nbsp;</div></li><li><div>                              for ($xpx = 0; $xpx &lt; $w; ++$xpx) {&nbsp;</div></li><li><div>                                  $alpha = (imagecolorat($im, $xpx, $ypx) & 0x7F000000) &gt;&gt; 24;&nbsp;</div></li><li><div>                                  if ($alpha &lt; 127) {&nbsp;</div></li><li><div>                                      imagesetpixel($imgalpha, $xpx, $ypx, (255 - ($alpha * 2)));&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// NB This must happen after the Alpha channel is extracted</span>&nbsp;</div></li><li><div>                      <span class="comment">// imagegammacorrect() removes the alpha channel data in $im - (I think this is a bug in PHP)</span>&nbsp;</div></li><li><div>                      if ($gamma_correction) {&nbsp;</div></li><li><div>                          imagegammacorrect($im, $gamma_correction, 2.2);&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>                      <span class="comment">// create temp alpha file</span>&nbsp;</div></li><li><div>                      $tempfile_alpha = _MPDF_TEMP_PATH . '_tempMskPNG' . md5($file) . RAND(1, 10000) . '.png';&nbsp;</div></li><li><div>                      if (!is_writable(_MPDF_TEMP_PATH)) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>                          ob_start();&nbsp;</div></li><li><div>                          $check = @imagepng($imgalpha);&nbsp;</div></li><li><div>                          if (!$check) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Error creating temporary image object whilst using GD library to parse PNG image');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          imagedestroy($imgalpha);&nbsp;</div></li><li><div>                          $this-&gt;_tempimg = ob_get_contents();&nbsp;</div></li><li><div>                          $this-&gt;_tempimglnk = 'var:_tempimg';&nbsp;</div></li><li><div>                          ob_end_clean();&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// extract image without alpha channel</span></span>&nbsp;</div></li><li><div>                          $imgplain = imagecreatetruecolor($w, $h);&nbsp;</div></li><li><div>                          imagealphablending($imgplain, false); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>                          imagecopy($imgplain, $im, 0, 0, 0, 0, $w, $h);&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// create temp image file</span></span>&nbsp;</div></li><li><div>                          $minfo = $this-&gt;_getImage($this-&gt;_tempimglnk, false);&nbsp;</div></li><li><div>                          if (!$minfo) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file image object created with GD library to parse PNG image');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          ob_start();&nbsp;</div></li><li><div>                          $check = @imagepng($imgplain);&nbsp;</div></li><li><div>                          if (!$check) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Error creating temporary image object whilst using GD library to parse PNG image');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;_tempimg = ob_get_contents();&nbsp;</div></li><li><div>                          $this-&gt;_tempimglnk = 'var:_tempimg';&nbsp;</div></li><li><div>                          ob_end_clean();&nbsp;</div></li><li><div>                          $info = $this-&gt;_getImage($this-&gt;_tempimglnk, false);&nbsp;</div></li><li><div>                          if (!$info) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file image object created with GD library to parse PNG image');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          imagedestroy($imgplain);&nbsp;</div></li><li><div>                          $imgmask = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>                          $minfo['cs'] = 'DeviceGray';&nbsp;</div></li><li><div>                          $minfo['i'] = $imgmask;&nbsp;</div></li><li><div>                          $this-&gt;images[$tempfile_alpha] = $minfo;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $check = @imagepng($imgalpha, $tempfile_alpha);&nbsp;</div></li><li><div>                          if (!$check) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Failed to create temporary image file (' . $tempfile_alpha . ') parsing PNG image with alpha channel (' . $errpng . ')');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          imagedestroy($imgalpha);&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// extract image without alpha channel</span></span>&nbsp;</div></li><li><div>                          $imgplain = imagecreatetruecolor($w, $h);&nbsp;</div></li><li><div>                          imagealphablending($imgplain, false); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>                          imagecopy($imgplain, $im, 0, 0, 0, 0, $w, $h);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// create temp image file</span></span>&nbsp;</div></li><li><div>                          $check = @imagepng($imgplain, $tempfile);&nbsp;</div></li><li><div>                          if (!$check) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Failed to create temporary image file (' . $tempfile . ') parsing PNG image with alpha channel (' . $errpng . ')');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          imagedestroy($imgplain);&nbsp;</div></li><li><div>                          <span class="comment">// embed mask image</span>&nbsp;</div></li><li><div>                          $minfo = $this-&gt;_getImage($tempfile_alpha, false);&nbsp;</div></li><li><div>                          unlink($tempfile_alpha);&nbsp;</div></li><li><div>                          if (!$minfo) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file (' . $tempfile_alpha . ') created with GD library to parse PNG image');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $imgmask = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>                          $minfo['cs'] = 'DeviceGray';&nbsp;</div></li><li><div>                          $minfo['i'] = $imgmask;&nbsp;</div></li><li><div>                          $this-&gt;images[$tempfile_alpha] = $minfo;&nbsp;</div></li><li><div>                          <span class="comment">// embed image, masked with previously embedded mask</span>&nbsp;</div></li><li><div>                          $info = $this-&gt;_getImage($tempfile, false);&nbsp;</div></li><li><div>                          unlink($tempfile);&nbsp;</div></li><li><div>                          if (!$info) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file (' . $tempfile . ') created with GD library to parse PNG image');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $info['masked'] = $imgmask;&nbsp;</div></li><li><div>                      if ($ppUx) {&nbsp;</div></li><li><div>                          $info['set-dpi'] = $ppUx;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $info['type'] = 'png';&nbsp;</div></li><li><div>                      if ($firsttime) {&nbsp;</div></li><li><div>                          $info['i'] = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>                          $info['interpolation'] = $interpolation; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;images[$file] = $info;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      return $info;&nbsp;</div></li><li><div>                  } else {  <span class="comment">// No alpha/transparency set (but cannot read directly because e.g. bit-depth != 8, interlaced etc)</span>&nbsp;</div></li><li><div>                      <span class="comment">// ICC profile</span>&nbsp;</div></li><li><div>                      $icc = false;&nbsp;</div></li><li><div>                      $p = strpos($data, 'iCCP');&nbsp;</div></li><li><div>                      if ($p && $colspace == &quot;Indexed&quot;) { <span class="comment">// Cannot have ICC profile and Indexed together</span>&nbsp;</div></li><li><div>                          $p += 4;&nbsp;</div></li><li><div>                          $n = $this-&gt;_fourbytes2int(substr($data, ($p - 8), 4));&nbsp;</div></li><li><div>                          $nullsep = strpos(substr($data, $p, 80), chr(0));&nbsp;</div></li><li><div>                          $icc = substr($data, ($p + $nullsep + 2), ($n - ($nullsep + 2)));&nbsp;</div></li><li><div>                          $icc = @gzuncompress($icc); <span class="comment"><span class="comment">// Ignored if fails</span></span>&nbsp;</div></li><li><div>                          if ($icc) {&nbsp;</div></li><li><div>                              if (substr($icc, 36, 4) != 'acsp') {&nbsp;</div></li><li><div>                                  $icc = false;&nbsp;</div></li><li><div>                              } <span class="comment"><span class="comment"><span class="comment">// invalid ICC profile</span></span></span>&nbsp;</div></li><li><div>                              else {&nbsp;</div></li><li><div>                                  $input = substr($icc, 16, 4);&nbsp;</div></li><li><div>                                  $output = substr($icc, 20, 4);&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment"><span class="comment">// Ignore Color profiles for conversion to other colorspaces e.g. CMYK/Lab</span></span></span>&nbsp;</div></li><li><div>                                  if ($input != 'RGB ' || $output != 'XYZ ') {&nbsp;</div></li><li><div>                                      $icc = false;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment">// Convert to RGB colorspace so can use ICC Profile</span>&nbsp;</div></li><li><div>                          if ($icc) {&nbsp;</div></li><li><div>                              imagepalettetotruecolor($im);&nbsp;</div></li><li><div>                              $colspace = 'DeviceRGB';&nbsp;</div></li><li><div>                              $channels = 3;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($gamma_correction) {&nbsp;</div></li><li><div>                          imagegammacorrect($im, $gamma_correction, 2.2);&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>                      imagealphablending($im, false);&nbsp;</div></li><li><div>                      imagesavealpha($im, false);&nbsp;</div></li><li><div>                      imageinterlace($im, false);&nbsp;</div></li><li><div>                      if (!is_writable(_MPDF_TEMP_PATH)) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>                          ob_start();&nbsp;</div></li><li><div>                          $check = @imagepng($im);&nbsp;</div></li><li><div>                          if (!$check) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Error creating temporary image object whilst using GD library to parse PNG image');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;_tempimg = ob_get_contents();&nbsp;</div></li><li><div>                          $this-&gt;_tempimglnk = 'var:_tempimg';&nbsp;</div></li><li><div>                          ob_end_clean();&nbsp;</div></li><li><div>                          $info = $this-&gt;_getImage($this-&gt;_tempimglnk, false);&nbsp;</div></li><li><div>                          if (!$info) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file image object created with GD library to parse PNG image');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          imagedestroy($im);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $check = @imagepng($im, $tempfile);&nbsp;</div></li><li><div>                          if (!$check) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Failed to create temporary image file (' . $tempfile . ') parsing PNG image (' . $errpng . ')');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          imagedestroy($im);&nbsp;</div></li><li><div>                          $info = $this-&gt;_getImage($tempfile, false);&nbsp;</div></li><li><div>                          unlink($tempfile);&nbsp;</div></li><li><div>                          if (!$info) {&nbsp;</div></li><li><div>                              return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file (' . $tempfile . ') created with GD library to parse PNG image');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($ppUx) {&nbsp;</div></li><li><div>                          $info['set-dpi'] = $ppUx;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $info['type'] = 'png';&nbsp;</div></li><li><div>                      if ($firsttime) {&nbsp;</div></li><li><div>                          $info['i'] = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>                          $info['interpolation'] = $interpolation; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          if ($icc) {&nbsp;</div></li><li><div>                              $info['ch'] = $channels;&nbsp;</div></li><li><div>                              $info['icc'] = $icc;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;images[$file] = $info;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      return $info;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else { <span class="comment">// PNG</span> image with no need to convert alph channels, bpc &lt;&gt; 8 etc.&nbsp;</div></li><li><div>              $parms = '/DecodeParms &lt;&lt;/Predictor 15 /Colors ' . $channels . ' /BitsPerComponent ' . $bpc . ' /Columns ' . $w . '&gt;&gt;';&nbsp;</div></li><li><div>              <span class="comment">//Scan chunks looking for palette, transparency and image data</span>&nbsp;</div></li><li><div>              $pal = '';&nbsp;</div></li><li><div>              $trns = '';&nbsp;</div></li><li><div>              $pngdata = '';&nbsp;</div></li><li><div>              $icc = false;&nbsp;</div></li><li><div>              $p = 33;&nbsp;</div></li><li><div>              do {&nbsp;</div></li><li><div>                  $n = $this-&gt;_fourbytes2int(substr($data, $p, 4));&nbsp;</div></li><li><div>                  $p += 4;&nbsp;</div></li><li><div>                  $type = substr($data, $p, 4);&nbsp;</div></li><li><div>                  $p += 4;&nbsp;</div></li><li><div>                  if ($type == 'PLTE') {&nbsp;</div></li><li><div>                      <span class="comment">//Read palette</span>&nbsp;</div></li><li><div>                      $pal = substr($data, $p, $n);&nbsp;</div></li><li><div>                      $p += $n;&nbsp;</div></li><li><div>                      $p += 4;&nbsp;</div></li><li><div>                  } elseif ($type == 'tRNS') {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Read transparency info</span></span></span></span>&nbsp;</div></li><li><div>                      $t = substr($data, $p, $n);&nbsp;</div></li><li><div>                      $p += $n;&nbsp;</div></li><li><div>                      if ($ct == 0)&nbsp;</div></li><li><div>                          $trns = array(ord(substr($t, 1, 1)));&nbsp;</div></li><li><div>                      elseif ($ct == 2)&nbsp;</div></li><li><div>                          $trns = array(ord(substr($t, 1, 1)), ord(substr($t, 3, 1)), ord(substr($t, 5, 1)));&nbsp;</div></li><li><div>                      else {&nbsp;</div></li><li><div>                          $pos = strpos($t, chr(0));&nbsp;</div></li><li><div>                          if (is_int($pos))&nbsp;</div></li><li><div>                              $trns = array($pos);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $p += 4;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  elseif ($type == 'IDAT') {&nbsp;</div></li><li><div>                      $pngdata.=substr($data, $p, $n);&nbsp;</div></li><li><div>                      $p += $n;&nbsp;</div></li><li><div>                      $p += 4;&nbsp;</div></li><li><div>                  } elseif ($type == 'iCCP') {&nbsp;</div></li><li><div>                      $nullsep = strpos(substr($data, $p, 80), chr(0));&nbsp;</div></li><li><div>                      $icc = substr($data, ($p + $nullsep + 2), ($n - ($nullsep + 2)));&nbsp;</div></li><li><div>                      $icc = @gzuncompress($icc); <span class="comment"><span class="comment">// Ignored if fails</span></span>&nbsp;</div></li><li><div>                      if ($icc) {&nbsp;</div></li><li><div>                          if (substr($icc, 36, 4) != 'acsp') {&nbsp;</div></li><li><div>                              $icc = false;&nbsp;</div></li><li><div>                          } <span class="comment"><span class="comment"><span class="comment">// invalid ICC profile</span></span></span>&nbsp;</div></li><li><div>                          else {&nbsp;</div></li><li><div>                              $input = substr($icc, 16, 4);&nbsp;</div></li><li><div>                              $output = substr($icc, 20, 4);&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment">// Ignore Color profiles for conversion to other colorspaces e.g. CMYK/Lab</span></span></span>&nbsp;</div></li><li><div>                              if ($input != 'RGB ' || $output != 'XYZ ') {&nbsp;</div></li><li><div>                                  $icc = false;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $p += $n;&nbsp;</div></li><li><div>                      $p += 4;&nbsp;</div></li><li><div>                  } elseif ($type == 'IEND') {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  } elseif (preg_match('/[a-zA-Z]{4}/', $type)) {&nbsp;</div></li><li><div>                      $p += $n + 4;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      return $this-&gt;_imageError($file, $firsttime, 'Error parsing PNG image data');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } while ($n);&nbsp;</div></li><li><div>              if (!$pngdata) {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, 'Error parsing PNG image data - no IDAT data found');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($colspace == 'Indexed' && empty($pal)) {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, 'Error parsing PNG image data - missing colour palette');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($colspace == 'Indexed' && $icc) {&nbsp;</div></li><li><div>                  $icc = false;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> cannot have ICC profile and Indexed in a PDF document as both use the colorspace tag.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $info = array('w' =&gt; $w, 'h' =&gt; $h, 'cs' =&gt; $colspace, 'bpc' =&gt; $bpc, 'f' =&gt; 'FlateDecode', 'parms' =&gt; $parms, 'pal' =&gt; $pal, 'trns' =&gt; $trns, 'data' =&gt; $pngdata, 'ch' =&gt; $channels, 'icc' =&gt; $icc);&nbsp;</div></li><li><div>              $info['type'] = 'png';&nbsp;</div></li><li><div>              if ($ppUx) {&nbsp;</div></li><li><div>                  $info['set-dpi'] = $ppUx;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (!$info) {&nbsp;</div></li><li><div>              return $this-&gt;_imageError($file, $firsttime, 'Error parsing or converting PNG image');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($firsttime) {&nbsp;</div></li><li><div>              $info['i'] = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>              $info['interpolation'] = $interpolation; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;images[$file] = $info;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $info;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// GIF</span>&nbsp;</div></li><li><div>      elseif ($type == 'gif') {&nbsp;</div></li><li><div>          if (function_exists('gd_info')) {&nbsp;</div></li><li><div>              $gd = gd_info();&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $gd = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($gd['GIF Read Support']) && $gd['GIF Read Support']) {&nbsp;</div></li><li><div>              $im = @imagecreatefromstring($data);&nbsp;</div></li><li><div>              if ($im) {&nbsp;</div></li><li><div>                  $tempfile = _MPDF_TEMP_PATH . '_tempImgPNG' . md5($file) . RAND(1, 10000) . '.png';&nbsp;</div></li><li><div>                  imagealphablending($im, false);&nbsp;</div></li><li><div>                  imagesavealpha($im, false);&nbsp;</div></li><li><div>                  imageinterlace($im, false);&nbsp;</div></li><li><div>                  if (!is_writable($tempfile)) {&nbsp;</div></li><li><div>                      ob_start();&nbsp;</div></li><li><div>                      $check = @imagepng($im);&nbsp;</div></li><li><div>                      if (!$check) {&nbsp;</div></li><li><div>                          return $this-&gt;_imageError($file, $firsttime, 'Error creating temporary image object whilst using GD library to parse GIF image');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;_tempimg = ob_get_contents();&nbsp;</div></li><li><div>                      $this-&gt;_tempimglnk = 'var:_tempimg';&nbsp;</div></li><li><div>                      ob_end_clean();&nbsp;</div></li><li><div>                      $info = $this-&gt;_getImage($this-&gt;_tempimglnk, false);&nbsp;</div></li><li><div>                      if (!$info) {&nbsp;</div></li><li><div>                          return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file image object created with GD library to parse GIF image');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      imagedestroy($im);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $check = @imagepng($im, $tempfile);&nbsp;</div></li><li><div>                      if (!$check) {&nbsp;</div></li><li><div>                          return $this-&gt;_imageError($file, $firsttime, 'Error creating temporary file (' . $tempfile . ') whilst using GD library to parse GIF image');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $info = $this-&gt;_getImage($tempfile, false);&nbsp;</div></li><li><div>                      if (!$info) {&nbsp;</div></li><li><div>                          return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file (' . $tempfile . ') created with GD library to parse GIF image');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      imagedestroy($im);&nbsp;</div></li><li><div>                      unlink($tempfile);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $info['type'] = 'gif';&nbsp;</div></li><li><div>                  if ($firsttime) {&nbsp;</div></li><li><div>                      $info['i'] = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>                      $info['interpolation'] = $interpolation; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;images[$file] = $info;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  return $info;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, 'Error creating GD image file from GIF image');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (!class_exists('gif', false)) {&nbsp;</div></li><li><div>              include_once(_MPDF_PATH . 'classes/gif.php');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $gif = new CGIF();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $h = 0;&nbsp;</div></li><li><div>          $w = 0;&nbsp;</div></li><li><div>          $gif-&gt;loadFile($data, 0);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($gif-&gt;m_img-&gt;m_gih-&gt;m_bLocalClr) && $gif-&gt;m_img-&gt;m_gih-&gt;m_bLocalClr) {&nbsp;</div></li><li><div>              $nColors = $gif-&gt;m_img-&gt;m_gih-&gt;m_nTableSize;&nbsp;</div></li><li><div>              $pal = $gif-&gt;m_img-&gt;m_gih-&gt;m_colorTable-&gt;toString();&nbsp;</div></li><li><div>              if ((isset($bgColor)) and $bgColor != -1) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>                  $bgColor = $gif-&gt;m_img-&gt;m_gih-&gt;m_colorTable-&gt;colorIndex($bgColor);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $colspace = 'Indexed';&nbsp;</div></li><li><div>          } elseif (isset($gif-&gt;m_gfh-&gt;m_bGlobalClr) && $gif-&gt;m_gfh-&gt;m_bGlobalClr) {&nbsp;</div></li><li><div>              $nColors = $gif-&gt;m_gfh-&gt;m_nTableSize;&nbsp;</div></li><li><div>              $pal = $gif-&gt;m_gfh-&gt;m_colorTable-&gt;toString();&nbsp;</div></li><li><div>              if ((isset($bgColor)) and $bgColor != -1) {&nbsp;</div></li><li><div>                  $bgColor = $gif-&gt;m_gfh-&gt;m_colorTable-&gt;colorIndex($bgColor);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $colspace = 'Indexed';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $nColors = 0;&nbsp;</div></li><li><div>              $bgColor = -1;&nbsp;</div></li><li><div>              $colspace = 'DeviceGray';&nbsp;</div></li><li><div>              $pal = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $trns = '';&nbsp;</div></li><li><div>          if (isset($gif-&gt;m_img-&gt;m_bTrans) && $gif-&gt;m_img-&gt;m_bTrans && ($nColors &gt; 0)) {&nbsp;</div></li><li><div>              $trns = array($gif-&gt;m_img-&gt;m_nTrans);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $gifdata = $gif-&gt;m_img-&gt;m_data;&nbsp;</div></li><li><div>          $w = $gif-&gt;m_gfh-&gt;m_nWidth;&nbsp;</div></li><li><div>          $h = $gif-&gt;m_gfh-&gt;m_nHeight;&nbsp;</div></li><li><div>          $gif-&gt;ClearData();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($colspace == 'Indexed' and empty($pal)) {&nbsp;</div></li><li><div>              return $this-&gt;_imageError($file, $firsttime, 'Error parsing GIF image - missing colour palette');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;compress) {&nbsp;</div></li><li><div>              $gifdata = gzcompress($gifdata);&nbsp;</div></li><li><div>              $info = array('w' =&gt; $w, 'h' =&gt; $h, 'cs' =&gt; $colspace, 'bpc' =&gt; 8, 'f' =&gt; 'FlateDecode', 'pal' =&gt; $pal, 'trns' =&gt; $trns, 'data' =&gt; $gifdata);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $info = array('w' =&gt; $w, 'h' =&gt; $h, 'cs' =&gt; $colspace, 'bpc' =&gt; 8, 'pal' =&gt; $pal, 'trns' =&gt; $trns, 'data' =&gt; $gifdata);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $info['type'] = 'gif';&nbsp;</div></li><li><div>          if ($firsttime) {&nbsp;</div></li><li><div>              $info['i'] = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>              $info['interpolation'] = $interpolation; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;images[$file] = $info;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $info;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** -- IMAGES-BMP -- */</span>&nbsp;</div></li><li><div>      <span class="comment">// BMP (Windows Bitmap)</span>&nbsp;</div></li><li><div>      elseif ($type == 'bmp') {&nbsp;</div></li><li><div>          if (!class_exists('bmp', false)) {&nbsp;</div></li><li><div>              include(_MPDF_PATH . 'classes/bmp.php');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (empty($this-&gt;bmp)) {&nbsp;</div></li><li><div>              $this-&gt;bmp = new bmp($this);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $info = $this-&gt;bmp-&gt;_getBMPimage($data, $file);&nbsp;</div></li><li><div>          if (isset($info['error'])) {&nbsp;</div></li><li><div>              return $this-&gt;_imageError($file, $firsttime, $info['error']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($firsttime) {&nbsp;</div></li><li><div>              $info['i'] = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>              $info['interpolation'] = $interpolation; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;images[$file] = $info;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $info;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">/** -- END IMAGES-BMP -- */</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// WMF</span>&nbsp;</div></li><li><div>      elseif ($type == 'wmf') {&nbsp;</div></li><li><div>          if (!class_exists('wmf', false)) {&nbsp;</div></li><li><div>              include(_MPDF_PATH . 'classes/wmf.php');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (empty($this-&gt;wmf)) {&nbsp;</div></li><li><div>              $this-&gt;wmf = new wmf($this);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $wmfres = $this-&gt;wmf-&gt;_getWMFimage($data);&nbsp;</div></li><li><div>          if ($wmfres[0] == 0) {&nbsp;</div></li><li><div>              if ($wmfres[1]) {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, $wmfres[1]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return $this-&gt;_imageError($file, $firsttime, 'Error parsing WMF image');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $info = array('x' =&gt; $wmfres[2][0], 'y' =&gt; $wmfres[2][1], 'w' =&gt; $wmfres[3][0], 'h' =&gt; $wmfres[3][1], 'data' =&gt; $wmfres[1]);&nbsp;</div></li><li><div>          $info['i'] = count($this-&gt;formobjects) + 1;&nbsp;</div></li><li><div>          $info['type'] = 'wmf';&nbsp;</div></li><li><div>          $this-&gt;formobjects[$file] = $info;&nbsp;</div></li><li><div>          return $info;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// UNKNOWN TYPE - try GD imagecreatefromstring</span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          if (function_exists('gd_info')) {&nbsp;</div></li><li><div>              $gd = gd_info();&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $gd = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($gd['PNG Support']) && $gd['PNG Support']) {&nbsp;</div></li><li><div>              $im = @imagecreatefromstring($data);&nbsp;</div></li><li><div>              if (!$im) {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, 'Error parsing image file - image type not recognised, and not supported by GD imagecreate');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $tempfile = _MPDF_TEMP_PATH . '_tempImgPNG' . md5($file) . RAND(1, 10000) . '.png';&nbsp;</div></li><li><div>              imagealphablending($im, false);&nbsp;</div></li><li><div>              imagesavealpha($im, false);&nbsp;</div></li><li><div>              imageinterlace($im, false);&nbsp;</div></li><li><div>              $check = @imagepng($im, $tempfile);&nbsp;</div></li><li><div>              if (!$check) {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, 'Error creating temporary file (' . $tempfile . ') whilst using GD library to parse unknown image type');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $info = $this-&gt;_getImage($tempfile, false);&nbsp;</div></li><li><div>              imagedestroy($im);&nbsp;</div></li><li><div>              unlink($tempfile);&nbsp;</div></li><li><div>              if (!$info) {&nbsp;</div></li><li><div>                  return $this-&gt;_imageError($file, $firsttime, 'Error parsing temporary file (' . $tempfile . ') created with GD library to parse unknown image type');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $info['type'] = 'png';&nbsp;</div></li><li><div>              if ($firsttime) {&nbsp;</div></li><li><div>                  $info['i'] = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>                  $info['interpolation'] = $interpolation; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;images[$file] = $info;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return $info;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;_imageError($file, $firsttime, 'Error parsing image file - image type not recognised');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>================================&nbsp;</div></li><li><div>  function _convImage(&$data, $colspace, $targetcs, $w, $h, $dpi, $mask, $gamma_correction = false, $pngcolortype = false)&nbsp;</div></li><li><div>  { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>          $mask = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $im = @imagecreatefromstring($data);&nbsp;</div></li><li><div>      $info = array();&nbsp;</div></li><li><div>      $bpc = ord(substr($data, 24, 1));&nbsp;</div></li><li><div>      if ($im) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $imgdata = '';&nbsp;</div></li><li><div>          $mimgdata = '';&nbsp;</div></li><li><div>          $minfo = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>          <span class="comment">// Need to extract alpha channel info before imagegammacorrect (which loses the data)</span>&nbsp;</div></li><li><div>          if ($mask) { <span class="comment">// i.e. $pngalpha for PNG</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($colspace == 'Indexed') { <span class="comment"><span class="comment"><span class="comment">// generate Alpha channel values from tRNS</span></span></span> - only from PNG&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Read transparency info</span></span></span></span>&nbsp;</div></li><li><div>                  $transparency = '';&nbsp;</div></li><li><div>                  $p = strpos($data, 'tRNS');&nbsp;</div></li><li><div>                  if ($p) {&nbsp;</div></li><li><div>                      $n = $this-&gt;_fourbytes2int(substr($data, ($p - 4), 4));&nbsp;</div></li><li><div>                      $transparency = substr($data, ($p + 4), $n);&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// ord($transparency{$index}) = the alpha value for that index</span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// generate alpha channel</span></span></span></span>&nbsp;</div></li><li><div>                      for ($ypx = 0; $ypx &lt; $h; ++$ypx) {&nbsp;</div></li><li><div>                          for ($xpx = 0; $xpx &lt; $w; ++$xpx) {&nbsp;</div></li><li><div>                              $colorindex = imagecolorat($im, $xpx, $ypx);&nbsp;</div></li><li><div>                              if ($colorindex &gt;= $n) {&nbsp;</div></li><li><div>                                  $alpha = 255;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $alpha = ord($transparency{$colorindex});&nbsp;</div></li><li><div>                              } <span class="comment"><span class="comment">// 0-255</span></span>&nbsp;</div></li><li><div>                              $mimgdata .= chr($alpha);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ($pngcolortype === 0 || $pngcolortype == 2) { <span class="comment"><span class="comment"><span class="comment">// generate Alpha channel values from tRNS</span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Get transparency as array of RGB</span></span>&nbsp;</div></li><li><div>                  $p = strpos($data, 'tRNS');&nbsp;</div></li><li><div>                  if ($p) {&nbsp;</div></li><li><div>                      $trns = '';&nbsp;</div></li><li><div>                      $n = $this-&gt;_fourbytes2int(substr($data, ($p - 4), 4));&nbsp;</div></li><li><div>                      $t = substr($data, ($p + 4), $n);&nbsp;</div></li><li><div>                      if ($colspace == 'DeviceGray') {  <span class="comment"><span class="comment"><span class="comment">// ct===0</span></span></span>&nbsp;</div></li><li><div>                          $trns = array($this-&gt;_trnsvalue(substr($t, 0, 2), $bpc));&nbsp;</div></li><li><div>                      } else <span class="comment"><span class="comment">/** $colspace=='DeviceRGB' */</span></span> {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ct==2</span></span></span></span></span>&nbsp;</div></li><li><div>                          $trns = array();&nbsp;</div></li><li><div>                          $trns[0] = $this-&gt;_trnsvalue(substr($t, 0, 2), $bpc);&nbsp;</div></li><li><div>                          $trns[1] = $this-&gt;_trnsvalue(substr($t, 2, 2), $bpc);&nbsp;</div></li><li><div>                          $trns[2] = $this-&gt;_trnsvalue(substr($t, 4, 2), $bpc);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// generate alpha channel</span></span></span></span>&nbsp;</div></li><li><div>                      for ($ypx = 0; $ypx &lt; $h; ++$ypx) {&nbsp;</div></li><li><div>                          for ($xpx = 0; $xpx &lt; $w; ++$xpx) {&nbsp;</div></li><li><div>                              $rgb = imagecolorat($im, $xpx, $ypx);&nbsp;</div></li><li><div>                              $r = ($rgb &gt;&gt; 16) & 0xFF;&nbsp;</div></li><li><div>                              $g = ($rgb &gt;&gt; 8) & 0xFF;&nbsp;</div></li><li><div>                              $b = $rgb & 0xFF;&nbsp;</div></li><li><div>                              if ($colspace == 'DeviceGray' && $b == $trns[0]) {&nbsp;</div></li><li><div>                                  $alpha = 0;&nbsp;</div></li><li><div>                              } elseif ($r == $trns[0] && $g == $trns[1] && $b == $trns[2]) {&nbsp;</div></li><li><div>                                  $alpha = 0;&nbsp;</div></li><li><div>                              }  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ct==2</span></span></span></span></span>&nbsp;</div></li><li><div>                              else {&nbsp;</div></li><li><div>                                  $alpha = 255;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $mimgdata .= chr($alpha);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  for ($i = 0; $i &lt; $h; $i++) {&nbsp;</div></li><li><div>                      for ($j = 0; $j &lt; $w; $j++) {&nbsp;</div></li><li><div>                          $rgb = imagecolorat($im, $j, $i);&nbsp;</div></li><li><div>                          $alpha = ($rgb & 0x7F000000) &gt;&gt; 24;&nbsp;</div></li><li><div>                          if ($alpha &lt; 127) {&nbsp;</div></li><li><div>                              $mimgdata .= chr(255 - ($alpha * 2));&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $mimgdata .= chr(0);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($gamma_correction) {&nbsp;</div></li><li><div>              imagegammacorrect($im, $gamma_correction, 2.2);&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> Gamma correction&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Read transparency info</span></span></span></span>&nbsp;</div></li><li><div>          $trns = array();&nbsp;</div></li><li><div>          $trnsrgb = false;&nbsp;</div></li><li><div>          if (!$this-&gt;PDFA && !$this-&gt;PDFX && !$mask) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> added NOT mask&nbsp;</div></li><li><div>              $p = strpos($data, 'tRNS');&nbsp;</div></li><li><div>              if ($p) {&nbsp;</div></li><li><div>                  $n = $this-&gt;_fourbytes2int(substr($data, ($p - 4), 4));&nbsp;</div></li><li><div>                  $t = substr($data, ($p + 4), $n);&nbsp;</div></li><li><div>                  if ($colspace == 'DeviceGray') {  <span class="comment"><span class="comment"><span class="comment">// ct===0</span></span></span>&nbsp;</div></li><li><div>                      $trns = array($this-&gt;_trnsvalue(substr($t, 0, 2), $bpc));&nbsp;</div></li><li><div>                  } elseif ($colspace == 'DeviceRGB') {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ct==2</span></span></span></span></span>&nbsp;</div></li><li><div>                      $trns[0] = $this-&gt;_trnsvalue(substr($t, 0, 2), $bpc);&nbsp;</div></li><li><div>                      $trns[1] = $this-&gt;_trnsvalue(substr($t, 2, 2), $bpc);&nbsp;</div></li><li><div>                      $trns[2] = $this-&gt;_trnsvalue(substr($t, 4, 2), $bpc);&nbsp;</div></li><li><div>                      $trnsrgb = $trns;&nbsp;</div></li><li><div>                      if ($targetcs == 'DeviceCMYK') {&nbsp;</div></li><li><div>                          $col = $this-&gt;rgb2cmyk(array(3, $trns[0], $trns[1], $trns[2]));&nbsp;</div></li><li><div>                          $c1 = intval($col[1] * 2.55);&nbsp;</div></li><li><div>                          $c2 = intval($col[2] * 2.55);&nbsp;</div></li><li><div>                          $c3 = intval($col[3] * 2.55);&nbsp;</div></li><li><div>                          $c4 = intval($col[4] * 2.55);&nbsp;</div></li><li><div>                          $trns = array($c1, $c2, $c3, $c4);&nbsp;</div></li><li><div>                      } elseif ($targetcs == 'DeviceGray') {&nbsp;</div></li><li><div>                          $c = intval(($trns[0] * .21) + ($trns[1] * .71) + ($trns[2] * .07));&nbsp;</div></li><li><div>                          $trns = array($c);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else { <span class="comment">// Indexed</span>&nbsp;</div></li><li><div>                      $pos = strpos($t, chr(0));&nbsp;</div></li><li><div>                      if (is_int($pos)) {&nbsp;</div></li><li><div>                          $pal = imagecolorsforindex($im, $pos);&nbsp;</div></li><li><div>                          $r = $pal['red'];&nbsp;</div></li><li><div>                          $g = $pal['green'];&nbsp;</div></li><li><div>                          $b = $pal['blue'];&nbsp;</div></li><li><div>                          $trns = array($r, $g, $b); <span class="comment">// ****</span>&nbsp;</div></li><li><div>                          $trnsrgb = $trns;&nbsp;</div></li><li><div>                          if ($targetcs == 'DeviceCMYK') {&nbsp;</div></li><li><div>                              $col = $this-&gt;rgb2cmyk(array(3, $r, $g, $b));&nbsp;</div></li><li><div>                              $c1 = intval($col[1] * 2.55);&nbsp;</div></li><li><div>                              $c2 = intval($col[2] * 2.55);&nbsp;</div></li><li><div>                              $c3 = intval($col[3] * 2.55);&nbsp;</div></li><li><div>                              $c4 = intval($col[4] * 2.55);&nbsp;</div></li><li><div>                              $trns = array($c1, $c2, $c3, $c4);&nbsp;</div></li><li><div>                          } elseif ($targetcs == 'DeviceGray') {&nbsp;</div></li><li><div>                              $c = intval(($r * .21) + ($g * .71) + ($b * .07));&nbsp;</div></li><li><div>                              $trns = array($c);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $h; $i++) {&nbsp;</div></li><li><div>              for ($j = 0; $j &lt; $w; $j++) {&nbsp;</div></li><li><div>                  $rgb = imagecolorat($im, $j, $i);&nbsp;</div></li><li><div>                  $r = ($rgb &gt;&gt; 16) & 0xFF;&nbsp;</div></li><li><div>                  $g = ($rgb &gt;&gt; 8) & 0xFF;&nbsp;</div></li><li><div>                  $b = $rgb & 0xFF;&nbsp;</div></li><li><div>                  if ($colspace == 'Indexed') {&nbsp;</div></li><li><div>                      $pal = imagecolorsforindex($im, $rgb);&nbsp;</div></li><li><div>                      $r = $pal['red'];&nbsp;</div></li><li><div>                      $g = $pal['green'];&nbsp;</div></li><li><div>                      $b = $pal['blue'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($targetcs == 'DeviceCMYK') {&nbsp;</div></li><li><div>                      $col = $this-&gt;rgb2cmyk(array(3, $r, $g, $b));&nbsp;</div></li><li><div>                      $c1 = intval($col[1] * 2.55);&nbsp;</div></li><li><div>                      $c2 = intval($col[2] * 2.55);&nbsp;</div></li><li><div>                      $c3 = intval($col[3] * 2.55);&nbsp;</div></li><li><div>                      $c4 = intval($col[4] * 2.55);&nbsp;</div></li><li><div>                      if ($trnsrgb) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// original pixel was not set as transparent but processed color does match</span></span>&nbsp;</div></li><li><div>                          if ($trnsrgb != array($r, $g, $b) && $trns == array($c1, $c2, $c3, $c4)) {&nbsp;</div></li><li><div>                              if ($c4 == 0) {&nbsp;</div></li><li><div>                                  $c4 = 1;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $c4--;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $imgdata .= chr($c1) . chr($c2) . chr($c3) . chr($c4);&nbsp;</div></li><li><div>                  } elseif ($targetcs == 'DeviceGray') {&nbsp;</div></li><li><div>                      $c = intval(($r * .21) + ($g * .71) + ($b * .07));&nbsp;</div></li><li><div>                      if ($trnsrgb) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// original pixel was not set as transparent but processed color does match</span></span>&nbsp;</div></li><li><div>                          if ($trnsrgb != array($r, $g, $b) && $trns == array($c)) {&nbsp;</div></li><li><div>                              if ($c == 0) {&nbsp;</div></li><li><div>                                  $c = 1;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $c--;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $imgdata .= chr($c);&nbsp;</div></li><li><div>                  } elseif ($targetcs == 'DeviceRGB') {&nbsp;</div></li><li><div>                      $imgdata .= chr($r) . chr($g) . chr($b);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($targetcs == 'DeviceGray') {&nbsp;</div></li><li><div>              $ncols = 1;&nbsp;</div></li><li><div>          } elseif ($targetcs == 'DeviceRGB') {&nbsp;</div></li><li><div>              $ncols = 3;&nbsp;</div></li><li><div>          } elseif ($targetcs == 'DeviceCMYK') {&nbsp;</div></li><li><div>              $ncols = 4;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $imgdata = gzcompress($imgdata);&nbsp;</div></li><li><div>          $info = array('w' =&gt; $w, 'h' =&gt; $h, 'cs' =&gt; $targetcs, 'bpc' =&gt; 8, 'f' =&gt; 'FlateDecode', 'data' =&gt; $imgdata, 'type' =&gt; 'png', &nbsp;</div></li><li><div>              'parms' =&gt; '/DecodeParms &lt;&lt;/Colors ' . $ncols . ' /BitsPerComponent 8 /Columns ' . $w . '&gt;&gt;');&nbsp;</div></li><li><div>          if ($dpi) {&nbsp;</div></li><li><div>              $info['set-dpi'] = $dpi;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($mask) {&nbsp;</div></li><li><div>              $mimgdata = gzcompress($mimgdata);&nbsp;</div></li><li><div>              $minfo = array('w' =&gt; $w, 'h' =&gt; $h, 'cs' =&gt; 'DeviceGray', 'bpc' =&gt; 8, 'f' =&gt; 'FlateDecode', 'data' =&gt; $mimgdata, 'type' =&gt; 'png', &nbsp;</div></li><li><div>                  'parms' =&gt; '/DecodeParms &lt;&lt;/Colors ' . $ncols . ' /BitsPerComponent 8 /Columns ' . $w . '&gt;&gt;');&nbsp;</div></li><li><div>              if ($dpi) {&nbsp;</div></li><li><div>                  $minfo['set-dpi'] = $dpi;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $tempfile = '_tempImgPNG' . md5($data) . RAND(1, 10000) . '.png';&nbsp;</div></li><li><div>              $imgmask = count($this-&gt;images) + 1;&nbsp;</div></li><li><div>              $minfo['i'] = $imgmask;&nbsp;</div></li><li><div>              $this-&gt;images[$tempfile] = $minfo;&nbsp;</div></li><li><div>              $info['masked'] = $imgmask;&nbsp;</div></li><li><div>          } elseif ($trns) {&nbsp;</div></li><li><div>              $info['trns'] = $trns;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          imagedestroy($im);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $info;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _trnsvalue($s, $bpc)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Corrects 2-byte integer to 8-bit depth value</span>&nbsp;</div></li><li><div>      <span class="comment">// If original image is bpc != 8, tRNS will be in this bpc</span>&nbsp;</div></li><li><div>      <span class="comment">// $im from imagecreatefromstring will always be in bpc=8</span>&nbsp;</div></li><li><div>      <span class="comment">// So why do we only need to correct 16-bit tRNS and NOT 2 or 4-bit???</span>&nbsp;</div></li><li><div>      $n = $this-&gt;_twobytes2int($s);&nbsp;</div></li><li><div>      if ($bpc == 16) {&nbsp;</div></li><li><div>          $n = ($n &gt;&gt; 8);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//elseif ($bpc==4) { $n = ($n &lt;&lt; 2); }</span>&nbsp;</div></li><li><div>      <span class="comment">//elseif ($bpc==2) { $n = ($n &lt;&lt; 4); }</span>&nbsp;</div></li><li><div>      return $n;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _fourbytes2int($s)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Read a 4-byte integer from string</span>&nbsp;</div></li><li><div>      return (ord($s[0]) &lt;&lt; 24) + (ord($s[1]) &lt;&lt; 16) + (ord($s[2]) &lt;&lt; 8) + ord($s[3]);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _twobytes2int($s)&nbsp;</div></li><li><div>  { <span class="comment">// equivalent to _get_ushort</span>&nbsp;</div></li><li><div>      <span class="comment">//Read a 2-byte integer from string</span>&nbsp;</div></li><li><div>      return (ord(substr($s, 0, 1)) &lt;&lt; 8) + ord(substr($s, 1, 1));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _jpgHeaderFromString(&$data)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $p = 4;&nbsp;</div></li><li><div>      $p += $this-&gt;_twobytes2int(substr($data, $p, 2)); <span class="comment">// Length of initial marker block</span>&nbsp;</div></li><li><div>      $marker = substr($data, $p, 2);&nbsp;</div></li><li><div>      while ($marker != chr(255) . chr(192) && $marker != chr(255) . chr(194) && $p &lt; strlen($data)) {&nbsp;</div></li><li><div>          <span class="comment">// Start of frame marker (FFC0) or (FFC2) mPDF 4.4.004</span>&nbsp;</div></li><li><div>          $p += ($this-&gt;_twobytes2int(substr($data, $p + 2, 2))) + 2; <span class="comment">// Length of marker block</span>&nbsp;</div></li><li><div>          $marker = substr($data, $p, 2);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($marker != chr(255) . chr(192) && $marker != chr(255) . chr(194)) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return substr($data, $p + 2, 10);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _jpgDataFromHeader($hdr)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $bpc = ord(substr($hdr, 2, 1));&nbsp;</div></li><li><div>      if (!$bpc) {&nbsp;</div></li><li><div>          $bpc = 8;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $h = $this-&gt;_twobytes2int(substr($hdr, 3, 2));&nbsp;</div></li><li><div>      $w = $this-&gt;_twobytes2int(substr($hdr, 5, 2));&nbsp;</div></li><li><div>      $channels = ord(substr($hdr, 7, 1));&nbsp;</div></li><li><div>      if ($channels == 3) {&nbsp;</div></li><li><div>          $colspace = 'DeviceRGB';&nbsp;</div></li><li><div>      } elseif ($channels == 4) {&nbsp;</div></li><li><div>          $colspace = 'DeviceCMYK';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $colspace = 'DeviceGray';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array($w, $h, $colspace, $bpc, $channels);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function file_get_contents_by_curl($url, &$data)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $timeout = 5;&nbsp;</div></li><li><div>      $ch = curl_init($url);&nbsp;</div></li><li><div>      curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:13.0) Gecko/20100101 Firefox/13.0.1'); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>      curl_setopt($ch, CURLOPT_HEADER, 0);&nbsp;</div></li><li><div>      curl_setopt($ch, CURLOPT_NOBODY, 0);&nbsp;</div></li><li><div>      curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);&nbsp;</div></li><li><div>      curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, $timeout);&nbsp;</div></li><li><div>      $data = curl_exec($ch);&nbsp;</div></li><li><div>      curl_close($ch);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function file_get_contents_by_socket($url, &$data)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>      $timeout = 1;&nbsp;</div></li><li><div>      $p = parse_url($url);&nbsp;</div></li><li><div>      $file = $p['path'];&nbsp;</div></li><li><div>      if ($p['scheme'] == 'https') {&nbsp;</div></li><li><div>          $prefix = 'ssl:<span class="comment"><span class="comment">//';</span></span>&nbsp;</div></li><li><div>          $port = ($p['port'] ? $p['port'] : 443);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $prefix = '';&nbsp;</div></li><li><div>          $port = ($p['port'] ? $p['port'] : 80);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($p['query']) {&nbsp;</div></li><li><div>          $file .= '?' . $p['query'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!($fh = @fsockopen($prefix . $p['host'], $port, $errno, $errstr, $timeout))) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $getstring = &quot;GET &quot; . $file . &quot; HTTP/1.0 \r\n&quot; .&nbsp;</div></li><li><div>          &quot;Host: &quot; . $p['host'] . &quot; \r\n&quot; .&nbsp;</div></li><li><div>          &quot;Connection: close\r\n\r\n&quot;;&nbsp;</div></li><li><div>      fwrite($fh, $getstring);&nbsp;</div></li><li><div>      <span class="comment">// Get rid of HTTP header</span>&nbsp;</div></li><li><div>      $s = fgets($fh, 1024);&nbsp;</div></li><li><div>      if (!$s) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $httpheader .= $s;&nbsp;</div></li><li><div>      while (!feof($fh)) {&nbsp;</div></li><li><div>          $s = fgets($fh, 1024);&nbsp;</div></li><li><div>          if ($s == &quot;\r\n&quot;) {&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $data = '';&nbsp;</div></li><li><div>      while (!feof($fh)) {&nbsp;</div></li><li><div>          $data .= fgets($fh, 1024);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      fclose($fh);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _imageTypeFromString(&$data)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $type = '';&nbsp;</div></li><li><div>      if (substr($data, 6, 4) == 'JFIF' || substr($data, 6, 4) == 'Exif' || substr($data, 0, 2) == chr(255) . chr(216)) { <span class="comment">// 0xFF 0xD8    // mpDF 5.7.2</span>&nbsp;</div></li><li><div>          $type = 'jpeg';&nbsp;</div></li><li><div>      } elseif (substr($data, 0, 6) == &quot;GIF87a&quot; || substr($data, 0, 6) == &quot;GIF89a&quot;) {&nbsp;</div></li><li><div>          $type = 'gif';&nbsp;</div></li><li><div>      } elseif (substr($data, 0, 8) == chr(137) . 'PNG' . chr(13) . chr(10) . chr(26) . chr(10)) {&nbsp;</div></li><li><div>          $type = 'png';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMAGES-WMF -- */</span></span></span></span></span></span></span></span> elseif (substr($data, 0, 4) == chr(215) . chr(205) . chr(198) . chr(154)) {&nbsp;</div></li><li><div>          $type = 'wmf';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMAGES-WMF -- */</span></span></span></span></span></span></span></span> elseif (preg_match('/&lt;svg.*&lt;\/svg&gt;/is', $data)) {&nbsp;</div></li><li><div>          $type = 'svg';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// BMP images</span>&nbsp;</div></li><li><div>      elseif (substr($data, 0, 2) == &quot;BM&quot;) {&nbsp;</div></li><li><div>          $type = 'bmp';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $type;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>================================&nbsp;</div></li><li><div>  <span class="comment">// Moved outside WMF as also needed for SVG</span>&nbsp;</div></li><li><div>  function _putformobjects()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      reset($this-&gt;formobjects);&nbsp;</div></li><li><div>      while (list($file, $info) = each($this-&gt;formobjects)) {&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;formobjects[$file]['n'] = $this-&gt;n;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/Type /XObject');&nbsp;</div></li><li><div>          $this-&gt;_out('/Subtype /Form');&nbsp;</div></li><li><div>          $this-&gt;_out('/Group ' . ($this-&gt;n + 1) . ' 0 R');&nbsp;</div></li><li><div>          $this-&gt;_out('/BBox [' . $info['x'] . ' ' . $info['y'] . ' ' . ($info['w'] + $info['x']) . ' ' . ($info['h'] + $info['y']) . ']');&nbsp;</div></li><li><div>          if ($this-&gt;compress)&nbsp;</div></li><li><div>              $this-&gt;_out('/Filter /FlateDecode');&nbsp;</div></li><li><div>          $data = ($this-&gt;compress) ? gzcompress($info['data']) : $info['data'];&nbsp;</div></li><li><div>          $this-&gt;_out('/Length ' . strlen($data) . '&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_putstream($data);&nbsp;</div></li><li><div>          unset($this-&gt;formobjects[$file]['data']);&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>          <span class="comment">// Required for SVG transparency (opacity) to work</span>&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/Type /Group');&nbsp;</div></li><li><div>          $this-&gt;_out('/S /Transparency');&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _freadint($f)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Read a 4-byte integer from file</span>&nbsp;</div></li><li><div>      $i = ord(fread($f, 1)) &lt;&lt; 24;&nbsp;</div></li><li><div>      $i+=ord(fread($f, 1)) &lt;&lt; 16;&nbsp;</div></li><li><div>      $i+=ord(fread($f, 1)) &lt;&lt; 8;&nbsp;</div></li><li><div>      $i+=ord(fread($f, 1));&nbsp;</div></li><li><div>      return $i;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _UTF16BEtextstring($s)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = $this-&gt;UTF8ToUTF16BE($s, true);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>          $s = $this-&gt;_RC4($this-&gt;_objectkey($this-&gt;_current_obj_id), $s);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      return '(' . $this-&gt;_escape($s) . ')';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _textstring($s)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>          $s = $this-&gt;_RC4($this-&gt;_objectkey($this-&gt;_current_obj_id), $s);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      return '(' . $this-&gt;_escape($s) . ')';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _escape($s)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// the chr(13) substitution fixes the Bugs item #1421290.</span>&nbsp;</div></li><li><div>      return strtr($s, array(')' =&gt; '\\)', '(' =&gt; '\\(', '\\' =&gt; '\\\\', chr(13) =&gt; '\r'));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putstream($s)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>          $s = $this-&gt;_RC4($this-&gt;_objectkey($this-&gt;_current_obj_id), $s);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;_out('stream');&nbsp;</div></li><li><div>      $this-&gt;_out($s);&nbsp;</div></li><li><div>      $this-&gt;_out('endstream');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _out($s, $ln = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;state == 2) {&nbsp;</div></li><li><div>          if ($this-&gt;bufferoutput) {&nbsp;</div></li><li><div>              $this-&gt;headerbuffer.= $s . &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif (($this-&gt;ColActive) && !$this-&gt;processingHeader && !$this-&gt;processingFooter) {&nbsp;</div></li><li><div>              <span class="comment">// Captures everything in buffer for columns; Almost everything is sent from fn. Cell() except:</span>&nbsp;</div></li><li><div>              <span class="comment">// Images sent from Image() or</span>&nbsp;</div></li><li><div>              <span class="comment">// later sent as _out($textto) in printbuffer</span>&nbsp;</div></li><li><div>              <span class="comment">// Line()</span>&nbsp;</div></li><li><div>              if (preg_match('/q \d+\.\d\d+ 0 0 (\d+\.\d\d+) \d+\.\d\d+ \d+\.\d\d+ cm \/(I|FO)\d+ Do Q/', $s, $m)) { <span class="comment">// Image data</span>&nbsp;</div></li><li><div>                  $h = ($m[1] / _MPDFK);&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Update/overwrite the lowest bottom of printing y value for a column</span></span>&nbsp;</div></li><li><div>                  $this-&gt;ColDetails[$this-&gt;CurrCol]['bottom_margin'] = $this-&gt;y + $h;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif (preg_match('/\d+\.\d\d+ \d+\.\d\d+ \d+\.\d\d+ ([\-]{0, 1}\d+\.\d\d+) re/', $s, $m) && $this-&gt;tableLevel &gt; 0) { <span class="comment">// Rect in table</span>&nbsp;</div></li><li><div>                  $h = ($m[1] / _MPDFK);&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Update/overwrite the lowest bottom of printing y value for a column</span></span>&nbsp;</div></li><li><div>                  $this-&gt;ColDetails[$this-&gt;CurrCol]['bottom_margin'] = max($this-&gt;ColDetails[$this-&gt;CurrCol]['bottom_margin'], ($this-&gt;y + $h));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> else {  <span class="comment">// Td Text Set in Cell()</span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;ColDetails[$this-&gt;CurrCol]['bottom_margin'])) {&nbsp;</div></li><li><div>                      $h = $this-&gt;ColDetails[$this-&gt;CurrCol]['bottom_margin'] - $this-&gt;y;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $h = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($h &lt; 0) {&nbsp;</div></li><li><div>                  $h = -$h;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;columnbuffer[] = array(&nbsp;</div></li><li><div>                  's' =&gt; $s, <span class="comment"><span class="comment">// Text string to output</span></span>&nbsp;</div></li><li><div>                  'col' =&gt; $this-&gt;CurrCol, <span class="comment">// Column when printed</span>&nbsp;</div></li><li><div>                  'x' =&gt; $this-&gt;x, <span class="comment"><span class="comment">// x when printed</span></span>&nbsp;</div></li><li><div>                  'y' =&gt; $this-&gt;y, <span class="comment">// this-&gt;y when printed (after column break)</span>&nbsp;</div></li><li><div>                  'h' =&gt; $h        <span class="comment">// actual y at bottom when printed = y+h</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif ($this-&gt;table_rotate && !$this-&gt;processingHeader && !$this-&gt;processingFooter) {&nbsp;</div></li><li><div>              <span class="comment">// Captures eveything in buffer for rotated tables;</span>&nbsp;</div></li><li><div>              $this-&gt;tablebuffer .= $s . &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif ($this-&gt;kwt && !$this-&gt;processingHeader && !$this-&gt;processingFooter) {&nbsp;</div></li><li><div>              <span class="comment">// Captures eveything in buffer for keep-with-table (h1-6);</span>&nbsp;</div></li><li><div>              $this-&gt;kwt_buffer[] = array(&nbsp;</div></li><li><div>                  's' =&gt; $s, <span class="comment"><span class="comment">// Text string to output</span></span>&nbsp;</div></li><li><div>                  'x' =&gt; $this-&gt;x, <span class="comment"><span class="comment">// x when printed</span></span>&nbsp;</div></li><li><div>                  'y' =&gt; $this-&gt;y, <span class="comment">// y when printed</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          } elseif (($this-&gt;keep_block_together) && !$this-&gt;processingHeader && !$this-&gt;processingFooter) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// do nothing</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;pages[$this-&gt;page] .= $s . ($ln == true ? &quot;\n&quot; : '');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;buffer .= $s . ($ln == true ? &quot;\n&quot; : '');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- WATERMARK -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// add a watermark</span>&nbsp;</div></li><li><div>  function watermark($texte, $angle = 45, $fontsize = 96, $alpha = 0.2)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>          throw new MpdfException('PDFA and PDFX do not permit transparency, so mPDF does not allow Watermarks!');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;watermark_font) {&nbsp;</div></li><li><div>          $this-&gt;watermark_font = $this-&gt;default_font;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetFont($this-&gt;watermark_font, &quot;B&quot;, $fontsize, false); <span class="comment"><span class="comment">// Don't output</span></span>&nbsp;</div></li><li><div>      $texte = $this-&gt;purify_utf8_text($texte);&nbsp;</div></li><li><div>      if ($this-&gt;text_input_as_HTML) {&nbsp;</div></li><li><div>          $texte = $this-&gt;all_entities_to_utf8($texte);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $texte = mb_convert_encoding($texte, $this-&gt;mb_enc, 'UTF-8');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span>&nbsp;</div></li><li><div>      if (preg_match(&quot;/([&quot; . $this-&gt;pregRTLchars . &quot;])/u&quot;, $texte)) {&nbsp;</div></li><li><div>          $this-&gt;biDirectional = true;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $textvar = 0;&nbsp;</div></li><li><div>      $save_OTLtags = $this-&gt;OTLtags;&nbsp;</div></li><li><div>      $this-&gt;OTLtags = array();&nbsp;</div></li><li><div>      if ($this-&gt;useKerning) {&nbsp;</div></li><li><div>          if ($this-&gt;CurrentFont['haskernGPOS']) {&nbsp;</div></li><li><div>              $this-&gt;OTLtags['Plus'] .= ' kern';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $textvar = ($textvar | FC_KERNING);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Use OTL OpenType Table Layout - GSUB</span> & GPOS&nbsp;</div></li><li><div>      if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>          $texte = $this-&gt;otl-&gt;applyOTL($texte, $this-&gt;CurrentFont['useOTL']);&nbsp;</div></li><li><div>          $OTLdata = $this-&gt;otl-&gt;OTLdata;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;OTLtags = $save_OTLtags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;magic_reverse_dir($texte, $this-&gt;directionality, $OTLdata);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetAlpha($alpha);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>      $szfont = $fontsize;&nbsp;</div></li><li><div>      $loop = 0;&nbsp;</div></li><li><div>      $maxlen = (min($this-&gt;w, $this-&gt;h) ); <span class="comment">// sets max length of text as 7/8 width/height of page</span>&nbsp;</div></li><li><div>      while ($loop == 0) {&nbsp;</div></li><li><div>          $this-&gt;SetFont($this-&gt;watermark_font, &quot;B&quot;, $szfont, false); <span class="comment"><span class="comment">// Don't output</span></span>&nbsp;</div></li><li><div>          $offset = ((sin(deg2rad($angle))) * ($szfont / _MPDFK));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $strlen = $this-&gt;GetStringWidth($texte, true, $OTLdata, $textvar);&nbsp;</div></li><li><div>          if ($strlen &gt; $maxlen - $offset)&nbsp;</div></li><li><div>              $szfont --;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $loop ++;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetFont($this-&gt;watermark_font, &quot;B&quot;, $szfont - 0.1, true, true); <span class="comment">// Output The -0.1 is because SetFont above is not written to PDF</span>&nbsp;</div></li><li><div>      <span class="comment">// Repeating it will not output anything as mPDF thinks it is set</span>&nbsp;</div></li><li><div>      $adj = ((cos(deg2rad($angle))) * ($strlen / 2));&nbsp;</div></li><li><div>      $opp = ((sin(deg2rad($angle))) * ($strlen / 2));&nbsp;</div></li><li><div>      $wx = ($this-&gt;w / 2) - $adj + $offset / 3;&nbsp;</div></li><li><div>      $wy = ($this-&gt;h / 2) + $opp;&nbsp;</div></li><li><div>      $this-&gt;Rotate($angle, $wx, $wy);&nbsp;</div></li><li><div>      $this-&gt;Text($wx, $wy, $texte, $OTLdata, $textvar);&nbsp;</div></li><li><div>      $this-&gt;Rotate(0);&nbsp;</div></li><li><div>      $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetAlpha(1);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function watermarkImg($src, $alpha = 0.2)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>          throw new MpdfException('PDFA and PDFX do not permit transparency, so mPDF does not allow Watermarks!');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;watermarkImgBehind) {&nbsp;</div></li><li><div>          $this-&gt;watermarkImgAlpha = $this-&gt;SetAlpha($alpha, 'Normal', true);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetAlpha($alpha, $this-&gt;watermarkImgAlphaBlend);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;Image($src, 0, 0, 0, 0, '', '', true, true, true);&nbsp;</div></li><li><div>      if (!$this-&gt;watermarkImgBehind) {&nbsp;</div></li><li><div>          $this-&gt;SetAlpha(1);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END WATERMARK -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Rotate($angle, $x = -1, $y = -1)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($x == -1)&nbsp;</div></li><li><div>          $x = $this-&gt;x;&nbsp;</div></li><li><div>      if ($y == -1)&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>      if ($this-&gt;angle != 0)&nbsp;</div></li><li><div>          $this-&gt;_out('Q');&nbsp;</div></li><li><div>      $this-&gt;angle = $angle;&nbsp;</div></li><li><div>      if ($angle != 0) {&nbsp;</div></li><li><div>          $angle*=M_PI / 180;&nbsp;</div></li><li><div>          $c = cos($angle);&nbsp;</div></li><li><div>          $s = sin($angle);&nbsp;</div></li><li><div>          $cx = $x * _MPDFK;&nbsp;</div></li><li><div>          $cy = ($this-&gt;h - $y) * _MPDFK;&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('q %.5F %.5F %.5F %.5F %.3F %.3F cm 1 0 0 1 %.3F %.3F cm', $c, $s, -$s, $c, $cx, $cy, -$cx, -$cy));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function CircularText($x, $y, $r, $text, $align = 'top', $fontfamily = '', $fontsize = 0, $fontstyle = '', $kerning = 120, $fontwidth = 100, $divider)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('directw', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/directw.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;directw)) {&nbsp;</div></li><li><div>          $this-&gt;directw = new directw($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;directw-&gt;CircularText($x, $y, $r, $text, $align, $fontfamily, $fontsize, $fontstyle, $kerning, $fontwidth, $divider);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// From Invoice</span>&nbsp;</div></li><li><div>  function RoundedRect($x, $y, $w, $h, $r, $style = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $hp = $this-&gt;h;&nbsp;</div></li><li><div>      if ($style == 'F')&nbsp;</div></li><li><div>          $op = 'f';&nbsp;</div></li><li><div>      elseif ($style == 'FD' or $style == 'DF')&nbsp;</div></li><li><div>          $op = 'B';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $op = 'S';&nbsp;</div></li><li><div>      $MyArc = 4 / 3 * (sqrt(2) - 1);&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F m', ($x + $r) * _MPDFK, ($hp - $y) * _MPDFK));&nbsp;</div></li><li><div>      $xc = $x + $w - $r;&nbsp;</div></li><li><div>      $yc = $y + $r;&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F l', $xc * _MPDFK, ($hp - $y) * _MPDFK));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_Arc($xc + $r * $MyArc, $yc - $r, $xc + $r, $yc - $r * $MyArc, $xc + $r, $yc);&nbsp;</div></li><li><div>      $xc = $x + $w - $r;&nbsp;</div></li><li><div>      $yc = $y + $h - $r;&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F l', ($x + $w) * _MPDFK, ($hp - $yc) * _MPDFK));&nbsp;</div></li><li><div>      $this-&gt;_Arc($xc + $r, $yc + $r * $MyArc, $xc + $r * $MyArc, $yc + $r, $xc, $yc + $r);&nbsp;</div></li><li><div>      $xc = $x + $r;&nbsp;</div></li><li><div>      $yc = $y + $h - $r;&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F l', $xc * _MPDFK, ($hp - ($y + $h)) * _MPDFK));&nbsp;</div></li><li><div>      $this-&gt;_Arc($xc - $r * $MyArc, $yc + $r, $xc - $r, $yc + $r * $MyArc, $xc - $r, $yc);&nbsp;</div></li><li><div>      $xc = $x + $r;&nbsp;</div></li><li><div>      $yc = $y + $r;&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F l', ($x) * _MPDFK, ($hp - $yc) * _MPDFK));&nbsp;</div></li><li><div>      $this-&gt;_Arc($xc - $r, $yc - $r * $MyArc, $xc - $r * $MyArc, $yc - $r, $xc, $yc - $r);&nbsp;</div></li><li><div>      $this-&gt;_out($op);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _Arc($x1, $y1, $x2, $y2, $x3, $y3)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $h = $this-&gt;h;&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', $x1 * _MPDFK, ($h - $y1) * _MPDFK, $x2 * _MPDFK, ($h - $y2) * _MPDFK, $x3 * _MPDFK, ($h - $y3) * _MPDFK));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>======================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- DIRECTW -- */</span></span></span></span>&nbsp;</div></li><li><div>  function Shaded_box($text, $font = '', $fontstyle = 'B', $szfont = '', $width = '70%', $style = 'DF', $radius = 2.5, $fill = '#FFFFFF', $color = '#000000', $pad = 2)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// F (shading - no line), S (line, no shading), DF (both)</span>&nbsp;</div></li><li><div>      if (!class_exists('directw', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/directw.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;directw)) {&nbsp;</div></li><li><div>          $this-&gt;directw = new directw($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;directw-&gt;Shaded_box($text, $font, $fontstyle, $szfont, $width, $style, $radius, $fill, $color, $pad);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END DIRECTW -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function UTF8StringToArray($str, $addSubset = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $out = array();&nbsp;</div></li><li><div>      $len = strlen($str);&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $len; $i++) {&nbsp;</div></li><li><div>          $uni = -1;&nbsp;</div></li><li><div>          $h = ord($str[$i]);&nbsp;</div></li><li><div>          if ($h &lt;= 0x7F)&nbsp;</div></li><li><div>              $uni = $h;&nbsp;</div></li><li><div>          elseif ($h &gt;= 0xC2) {&nbsp;</div></li><li><div>              if (($h &lt;= 0xDF) && ($i &lt; $len - 1))&nbsp;</div></li><li><div>                  $uni = ($h & 0x1F) &lt;&lt; 6 | (ord($str[++$i]) & 0x3F);&nbsp;</div></li><li><div>              elseif (($h &lt;= 0xEF) && ($i &lt; $len - 2))&nbsp;</div></li><li><div>                  $uni = ($h & 0x0F) &lt;&lt; 12 | (ord($str[++$i]) & 0x3F) &lt;&lt; 6 | (ord($str[++$i]) & 0x3F);&nbsp;</div></li><li><div>              elseif (($h &lt;= 0xF4) && ($i &lt; $len - 3))&nbsp;</div></li><li><div>                  $uni = ($h & 0x0F) &lt;&lt; 18 | (ord($str[++$i]) & 0x3F) &lt;&lt; 12 | (ord($str[++$i]) & 0x3F) &lt;&lt; 6 | (ord($str[++$i]) & 0x3F);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($uni &gt;= 0) {&nbsp;</div></li><li><div>              $out[] = $uni;&nbsp;</div></li><li><div>              if ($addSubset && isset($this-&gt;CurrentFont['subset'])) {&nbsp;</div></li><li><div>                  $this-&gt;CurrentFont['subset'][$uni] = $uni;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $out;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Convert utf-8 string to &lt;HHHHHH&gt; for Font Subsets</span>&nbsp;</div></li><li><div>  function UTF8toSubset($str)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $ret = '&lt;';&nbsp;</div></li><li><div>      //$str = preg_replace('/'.preg_quote($this-&gt;aliasNbPg, '/').'/', chr(7), $str );    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> deleted&nbsp;</div></li><li><div>      //$str = preg_replace('/'.preg_quote($this-&gt;aliasNbPgGp, '/').'/', chr(8), $str );    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> deleted&nbsp;</div></li><li><div>      $unicode = $this-&gt;UTF8StringToArray($str);&nbsp;</div></li><li><div>      $orig_fid = $this-&gt;CurrentFont['subsetfontids'][0];&nbsp;</div></li><li><div>      $last_fid = $this-&gt;CurrentFont['subsetfontids'][0];&nbsp;</div></li><li><div>      foreach ($unicode as $c) {&nbsp;</div></li><li><div>          /**     <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> deleted&nbsp;</div></li><li><div>            if ($c == 7 || $c == 8) {&nbsp;</div></li><li><div>            if ($orig_fid != $last_fid) {&nbsp;</div></li><li><div>            $ret .= '&gt; Tj /F'.$orig_fid.' '.$this-&gt;FontSizePt.' Tf &lt;';&nbsp;</div></li><li><div>            $last_fid = $orig_fid;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($c == 7) { $ret .= $this-&gt;aliasNbPgHex; }&nbsp;</div></li><li><div>            else { $ret .= $this-&gt;aliasNbPgGpHex; }&nbsp;</div></li><li><div>            continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>           */&nbsp;</div></li><li><div>          if (!$this-&gt;_charDefined($this-&gt;CurrentFont['cw'], $c)) {&nbsp;</div></li><li><div>              $c = 0;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; 99; $i++) {&nbsp;</div></li><li><div>              <span class="comment">// return c as decimal char</span>&nbsp;</div></li><li><div>              $init = array_search($c, $this-&gt;CurrentFont['subsets'][$i]);&nbsp;</div></li><li><div>              if ($init !== false) {&nbsp;</div></li><li><div>                  if ($this-&gt;CurrentFont['subsetfontids'][$i] != $last_fid) {&nbsp;</div></li><li><div>                      $ret .= '&gt; Tj /F' . $this-&gt;CurrentFont['subsetfontids'][$i] . ' ' . $this-&gt;FontSizePt . ' Tf &lt;';&nbsp;</div></li><li><div>                      $last_fid = $this-&gt;CurrentFont['subsetfontids'][$i];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $ret .= sprintf(&quot;%02s&quot;, strtoupper(dechex($init)));&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// TrueType embedded</span> SUBSETS&nbsp;</div></li><li><div>              elseif (count($this-&gt;CurrentFont['subsets'][$i]) &lt; 255) {&nbsp;</div></li><li><div>                  $n = count($this-&gt;CurrentFont['subsets'][$i]);&nbsp;</div></li><li><div>                  $this-&gt;CurrentFont['subsets'][$i][$n] = $c;&nbsp;</div></li><li><div>                  if ($this-&gt;CurrentFont['subsetfontids'][$i] != $last_fid) {&nbsp;</div></li><li><div>                      $ret .= '&gt; Tj /F' . $this-&gt;CurrentFont['subsetfontids'][$i] . ' ' . $this-&gt;FontSizePt . ' Tf &lt;';&nbsp;</div></li><li><div>                      $last_fid = $this-&gt;CurrentFont['subsetfontids'][$i];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $ret .= sprintf(&quot;%02s&quot;, strtoupper(dechex($n)));&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              } elseif (!isset($this-&gt;CurrentFont['subsets'][($i + 1)])) {&nbsp;</div></li><li><div>                  <span class="comment">// TrueType embedded</span> SUBSETS&nbsp;</div></li><li><div>                  $this-&gt;CurrentFont['subsets'][($i + 1)] = array(0 =&gt; 0);&nbsp;</div></li><li><div>                  $new_fid = count($this-&gt;fonts) + $this-&gt;extraFontSubsets + 1;&nbsp;</div></li><li><div>                  $this-&gt;CurrentFont['subsetfontids'][($i + 1)] = $new_fid;&nbsp;</div></li><li><div>                  $this-&gt;extraFontSubsets++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $ret .= '&gt;';&nbsp;</div></li><li><div>      if ($last_fid != $orig_fid) {&nbsp;</div></li><li><div>          $ret .= ' Tj /F' . $orig_fid . ' ' . $this-&gt;FontSizePt . ' Tf &lt;&gt; ';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $ret;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Converts UTF-8 strings to UTF16-BE.</span>&nbsp;</div></li><li><div>  function UTF8ToUTF16BE($str, $setbom = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;checkSIP && preg_match(&quot;/([\x{20000}-\x{2FFFF}])/u&quot;, $str)) {&nbsp;</div></li><li><div>          if (!in_array($this-&gt;currentfontfamily, array('gb', 'big5', 'sjis', 'uhc', 'gbB', 'big5B', 'sjisB', 'uhcB', 'gbI', 'big5I', 'sjisI', 'uhcI', &nbsp;</div></li><li><div>                  'gbBI', 'big5BI', 'sjisBI', 'uhcBI'))) {&nbsp;</div></li><li><div>              $str = preg_replace(&quot;/[\x{20000}-\x{2FFFF}]/u&quot;, chr(0), $str);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;checkSMP && preg_match(&quot;/([\x{10000}-\x{1FFFF}])/u&quot;, $str)) {&nbsp;</div></li><li><div>          $str = preg_replace(&quot;/[\x{10000}-\x{1FFFF}]/u&quot;, chr(0), $str);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $outstr = &quot;&quot;; <span class="comment">// string to be returned</span>&nbsp;</div></li><li><div>      if ($setbom) {&nbsp;</div></li><li><div>          $outstr .= &quot;\xFE\xFF&quot;; <span class="comment">// Byte Order Mark (BOM)</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $outstr .= mb_convert_encoding($str, 'UTF-16BE', 'UTF-8');&nbsp;</div></li><li><div>      return $outstr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ====================================================</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ====================================================</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// from class PDF_Chinese CJK EXTENSIONS</span></span>&nbsp;</div></li><li><div>  function AddCIDFont($family, $style, $name, &$cw, $CMap, $registry, $desc)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $fontkey = strtolower($family) . strtoupper($style);&nbsp;</div></li><li><div>      if (isset($this-&gt;fonts[$fontkey]))&nbsp;</div></li><li><div>          throw new MpdfException(&quot;Font already added: $family $style&quot;);&nbsp;</div></li><li><div>      $i = count($this-&gt;fonts) + $this-&gt;extraFontSubsets + 1;&nbsp;</div></li><li><div>      $name = str_replace(' ', '', $name);&nbsp;</div></li><li><div>      if ($family == 'sjis') {&nbsp;</div></li><li><div>          $up = -120;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $up = -130;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// ? 'up' and 'ut' do not seem to be referenced anywhere</span>&nbsp;</div></li><li><div>      $this-&gt;fonts[$fontkey] = array('i' =&gt; $i, 'type' =&gt; 'Type0', 'name' =&gt; $name, 'up' =&gt; $up, 'ut' =&gt; 40, 'cw' =&gt; $cw, 'CMap' =&gt; $CMap, 'registry' =&gt; $registry, 'MissingWidth' =&gt; 1000, 'desc' =&gt; $desc);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddCJKFont($family)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>          throw new MpdfException(&quot;Adobe CJK fonts cannot be embedded in mPDF (required for PDFA1-b and PDFX/1-a).&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($family == 'big5') {&nbsp;</div></li><li><div>          $this-&gt;AddBig5Font();&nbsp;</div></li><li><div>      } elseif ($family == 'gb') {&nbsp;</div></li><li><div>          $this-&gt;AddGBFont();&nbsp;</div></li><li><div>      } elseif ($family == 'sjis') {&nbsp;</div></li><li><div>          $this-&gt;AddSJISFont();&nbsp;</div></li><li><div>      } elseif ($family == 'uhc') {&nbsp;</div></li><li><div>          $this-&gt;AddUHCFont();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddBig5Font()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Add Big5 font with proportional Latin</span>&nbsp;</div></li><li><div>      $family = 'big5';&nbsp;</div></li><li><div>      $name = 'MSungStd-Light-Acro';&nbsp;</div></li><li><div>      $cw = $this-&gt;Big5_widths;&nbsp;</div></li><li><div>      $CMap = 'UniCNS-UTF16-H';&nbsp;</div></li><li><div>      $registry = array('ordering' =&gt; 'CNS1', 'supplement' =&gt; 4);&nbsp;</div></li><li><div>      $desc = array(&nbsp;</div></li><li><div>          'Ascent' =&gt; 880, &nbsp;</div></li><li><div>          'Descent' =&gt; -120, &nbsp;</div></li><li><div>          'CapHeight' =&gt; 880, &nbsp;</div></li><li><div>          'Flags' =&gt; 6, &nbsp;</div></li><li><div>          'FontBBox' =&gt; '[-160 -249 1015 1071]', &nbsp;</div></li><li><div>          'ItalicAngle' =&gt; 0, &nbsp;</div></li><li><div>          'StemV' =&gt; 93, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, '', $name, $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'B', $name . ', Bold', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'I', $name . ', Italic', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'BI', $name . ', BoldItalic', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddGBFont()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Add GB font with proportional Latin</span>&nbsp;</div></li><li><div>      $family = 'gb';&nbsp;</div></li><li><div>      $name = 'STSongStd-Light-Acro';&nbsp;</div></li><li><div>      $cw = $this-&gt;GB_widths;&nbsp;</div></li><li><div>      $CMap = 'UniGB-UTF16-H';&nbsp;</div></li><li><div>      $registry = array('ordering' =&gt; 'GB1', 'supplement' =&gt; 4);&nbsp;</div></li><li><div>      $desc = array(&nbsp;</div></li><li><div>          'Ascent' =&gt; 880, &nbsp;</div></li><li><div>          'Descent' =&gt; -120, &nbsp;</div></li><li><div>          'CapHeight' =&gt; 737, &nbsp;</div></li><li><div>          'Flags' =&gt; 6, &nbsp;</div></li><li><div>          'FontBBox' =&gt; '[-25 -254 1000 880]', &nbsp;</div></li><li><div>          'ItalicAngle' =&gt; 0, &nbsp;</div></li><li><div>          'StemV' =&gt; 58, &nbsp;</div></li><li><div>          'Style' =&gt; '&lt;&lt; /Panose &lt;000000000400000000000000&gt; &gt;&gt;', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, '', $name, $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'B', $name . ', Bold', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'I', $name . ', Italic', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'BI', $name . ', BoldItalic', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddSJISFont()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Add SJIS font with proportional Latin</span>&nbsp;</div></li><li><div>      $family = 'sjis';&nbsp;</div></li><li><div>      $name = 'KozMinPro-Regular-Acro';&nbsp;</div></li><li><div>      $cw = $this-&gt;SJIS_widths;&nbsp;</div></li><li><div>      $CMap = 'UniJIS-UTF16-H';&nbsp;</div></li><li><div>      $registry = array('ordering' =&gt; 'Japan1', 'supplement' =&gt; 5);&nbsp;</div></li><li><div>      $desc = array(&nbsp;</div></li><li><div>          'Ascent' =&gt; 880, &nbsp;</div></li><li><div>          'Descent' =&gt; -120, &nbsp;</div></li><li><div>          'CapHeight' =&gt; 740, &nbsp;</div></li><li><div>          'Flags' =&gt; 6, &nbsp;</div></li><li><div>          'FontBBox' =&gt; '[-195 -272 1110 1075]', &nbsp;</div></li><li><div>          'ItalicAngle' =&gt; 0, &nbsp;</div></li><li><div>          'StemV' =&gt; 86, &nbsp;</div></li><li><div>          'XHeight' =&gt; 502, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, '', $name, $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'B', $name . ', Bold', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'I', $name . ', Italic', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'BI', $name . ', BoldItalic', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddUHCFont()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Add UHC font with proportional Latin</span>&nbsp;</div></li><li><div>      $family = 'uhc';&nbsp;</div></li><li><div>      $name = 'HYSMyeongJoStd-Medium-Acro';&nbsp;</div></li><li><div>      $cw = $this-&gt;UHC_widths;&nbsp;</div></li><li><div>      $CMap = 'UniKS-UTF16-H';&nbsp;</div></li><li><div>      $registry = array('ordering' =&gt; 'Korea1', 'supplement' =&gt; 2);&nbsp;</div></li><li><div>      $desc = array(&nbsp;</div></li><li><div>          'Ascent' =&gt; 880, &nbsp;</div></li><li><div>          'Descent' =&gt; -120, &nbsp;</div></li><li><div>          'CapHeight' =&gt; 720, &nbsp;</div></li><li><div>          'Flags' =&gt; 6, &nbsp;</div></li><li><div>          'FontBBox' =&gt; '[-28 -148 1001 880]', &nbsp;</div></li><li><div>          'ItalicAngle' =&gt; 0, &nbsp;</div></li><li><div>          'StemV' =&gt; 60, &nbsp;</div></li><li><div>          'Style' =&gt; '&lt;&lt; /Panose &lt;000000000600000000000000&gt; &gt;&gt;', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, '', $name, $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'B', $name . ', Bold', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'I', $name . ', Italic', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>      $this-&gt;AddCIDFont($family, 'BI', $name . ', BoldItalic', $cw, $CMap, $registry, $desc);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>////////////////&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>////////////////&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>////////////////&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>////////////////&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>////////////////&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>////////////////&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDefaultFont($font)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Disallow embedded fonts to be used as defaults in PDFA</span>&nbsp;</div></li><li><div>      if ($this-&gt;PDFA || $this-&gt;PDFX) {&nbsp;</div></li><li><div>          if (strtolower($font) == 'ctimes') {&nbsp;</div></li><li><div>              $font = 'serif';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (strtolower($font) == 'ccourier') {&nbsp;</div></li><li><div>              $font = 'monospace';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (strtolower($font) == 'chelvetica') {&nbsp;</div></li><li><div>              $font = 'sans-serif';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $font = $this-&gt;SetFont($font); <span class="comment">// returns substituted font if necessary</span>&nbsp;</div></li><li><div>      $this-&gt;default_font = $font;&nbsp;</div></li><li><div>      $this-&gt;original_default_font = $font;&nbsp;</div></li><li><div>      if (!$this-&gt;watermark_font) {&nbsp;</div></li><li><div>          $this-&gt;watermark_font = $font;&nbsp;</div></li><li><div>      } <span class="comment">// *WATERMARK*</span>&nbsp;</div></li><li><div>      $this-&gt;defaultCSS['BODY']['FONT-FAMILY'] = $font;&nbsp;</div></li><li><div>      $this-&gt;cssmgr-&gt;CSS['BODY']['FONT-FAMILY'] = $font;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDefaultFontSize($fontsize)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;default_font_size = $fontsize;&nbsp;</div></li><li><div>      $this-&gt;original_default_font_size = $fontsize;&nbsp;</div></li><li><div>      $this-&gt;SetFontSize($fontsize);&nbsp;</div></li><li><div>      $this-&gt;defaultCSS['BODY']['FONT-SIZE'] = $fontsize . 'pt';&nbsp;</div></li><li><div>      $this-&gt;cssmgr-&gt;CSS['BODY']['FONT-SIZE'] = $fontsize . 'pt';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDefaultBodyCSS($prop, $val)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($prop) {&nbsp;</div></li><li><div>          $this-&gt;defaultCSS['BODY'][strtoupper($prop)] = $val;&nbsp;</div></li><li><div>          $this-&gt;cssmgr-&gt;CSS['BODY'][strtoupper($prop)] = $val;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDirectionality($dir = 'ltr')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (strtolower($dir) == 'rtl') {&nbsp;</div></li><li><div>          if ($this-&gt;directionality != 'rtl') {&nbsp;</div></li><li><div>              <span class="comment">// Swop L/R Margins so page 1 RTL is an 'even' page</span>&nbsp;</div></li><li><div>              $tmp = $this-&gt;DeflMargin;&nbsp;</div></li><li><div>              $this-&gt;DeflMargin = $this-&gt;DefrMargin;&nbsp;</div></li><li><div>              $this-&gt;DefrMargin = $tmp;&nbsp;</div></li><li><div>              $this-&gt;orig_lMargin = $this-&gt;DeflMargin;&nbsp;</div></li><li><div>              $this-&gt;orig_rMargin = $this-&gt;DefrMargin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;SetMargins($this-&gt;DeflMargin, $this-&gt;DefrMargin, $this-&gt;tMargin);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;directionality = 'rtl';&nbsp;</div></li><li><div>          $this-&gt;defaultAlign = 'R';&nbsp;</div></li><li><div>          $this-&gt;defaultTableAlign = 'R';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;directionality = 'ltr';&nbsp;</div></li><li><div>          $this-&gt;defaultAlign = 'L';&nbsp;</div></li><li><div>          $this-&gt;defaultTableAlign = 'L';&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;cssmgr-&gt;CSS['BODY']['DIRECTION'] = $this-&gt;directionality;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Return either a number (factor) - based on current set fontsize (if % or em) - or exact lineheight (with 'mm' after it)</span>&nbsp;</div></li><li><div>  function fixLineheight($v)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $lh = false;&nbsp;</div></li><li><div>      if (preg_match('/^[0-9\., ]*$/', $v) && $v &gt;= 0) {&nbsp;</div></li><li><div>          return ($v + 0);&nbsp;</div></li><li><div>      } elseif (strtoupper($v) == 'NORMAL' || $v == 'N') {&nbsp;</div></li><li><div>          return 'N';  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tlh = $this-&gt;ConvertSize($v, $this-&gt;FontSize, $this-&gt;FontSize, true);&nbsp;</div></li><li><div>          if ($tlh) {&nbsp;</div></li><li><div>              return ($tlh . 'mm');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $this-&gt;normalLineheight;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _getNormalLineheight($desc = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$desc) {&nbsp;</div></li><li><div>          $desc = $this-&gt;CurrentFont['desc'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($desc['Leading'])) {&nbsp;</div></li><li><div>          $desc['Leading'] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;useFixedNormalLineHeight) {&nbsp;</div></li><li><div>          $lh = $this-&gt;normalLineheight;&nbsp;</div></li><li><div>      } elseif (isset($desc['Ascent']) && $desc['Ascent']) {&nbsp;</div></li><li><div>          $lh = ($this-&gt;adjustFontDescLineheight * ($desc['Ascent'] - $desc['Descent'] + $desc['Leading']) / 1000);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $lh = $this-&gt;normalLineheight;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $lh;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set a (fixed) lineheight to an actual value - either to named fontsize(pts) or default</span>&nbsp;</div></li><li><div>  function SetLineHeight($FontPt = '', $lh = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$FontPt) {&nbsp;</div></li><li><div>          $FontPt = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $fs = $FontPt / _MPDFK;&nbsp;</div></li><li><div>      $this-&gt;lineheight = $this-&gt;_computeLineheight($lh, $fs);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _computeLineheight($lh, $fs = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;shrin_k &gt; 1) {&nbsp;</div></li><li><div>          $k = $this-&gt;shrin_k;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $k = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$fs) {&nbsp;</div></li><li><div>          $fs = $this-&gt;FontSize;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($lh == 'N') {&nbsp;</div></li><li><div>          $lh = $this-&gt;_getNormalLineheight();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (preg_match('/mm/', $lh)) {&nbsp;</div></li><li><div>          return (($lh + 0.0) / $k); <span class="comment"><span class="comment">// convert to number</span></span>&nbsp;</div></li><li><div>      } elseif ($lh &gt; 0) {&nbsp;</div></li><li><div>          return ($fs * $lh);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return ($fs * $this-&gt;normalLineheight);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _setLineYpos(&$fontsize, &$fontdesc, &$CSSlineheight, $blockYpos = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $ypos['glyphYorigin'] = 0;&nbsp;</div></li><li><div>      $ypos['baseline-shift'] = 0;&nbsp;</div></li><li><div>      $linegap = 0;&nbsp;</div></li><li><div>      $leading = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($fontdesc['Ascent']) && $fontdesc['Ascent'] && !$this-&gt;useFixedTextBaseline) {&nbsp;</div></li><li><div>          <span class="comment">// Fontsize uses font metrics - this method seems to produce results compatible with browsers (except IE9)</span>&nbsp;</div></li><li><div>          $ypos['boxtop'] = $fontdesc['Ascent'] / 1000 * $fontsize;&nbsp;</div></li><li><div>          $ypos['boxbottom'] = $fontdesc['Descent'] / 1000 * $fontsize;&nbsp;</div></li><li><div>          if (isset($fontdesc['Leading'])) {&nbsp;</div></li><li><div>              $linegap = $fontdesc['Leading'] / 1000 * $fontsize;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Default if not set - uses baselineC</span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $ypos['boxtop'] = (0.5 + $this-&gt;baselineC) * $fontsize;&nbsp;</div></li><li><div>          $ypos['boxbottom'] = -(0.5 - $this-&gt;baselineC) * $fontsize;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $fontheight = $ypos['boxtop'] - $ypos['boxbottom'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;shrin_k &gt; 1) {&nbsp;</div></li><li><div>          $shrin_k = $this-&gt;shrin_k;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $shrin_k = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $leading = 0;&nbsp;</div></li><li><div>      if ($CSSlineheight == 'N') {&nbsp;</div></li><li><div>          $lh = $this-&gt;_getNormalLineheight($fontdesc);&nbsp;</div></li><li><div>          $lineheight = ($fontsize * $lh);&nbsp;</div></li><li><div>          $leading += $linegap; <span class="comment">// specified in hhea or sTypo in OpenType tables    ****************************************</span>&nbsp;</div></li><li><div>      } elseif (preg_match('/mm/', $CSSlineheight)) {&nbsp;</div></li><li><div>          $lineheight = (($CSSlineheight + 0.0) / $shrin_k);&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment">// convert to number</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// ???</span></span> If lineheight is a factor e.g. 1.3  ?? use factor x 1em or ? use 'normal' lineheight * factor ******************************&nbsp;</div></li><li><div>      <span class="comment">// Could depend on value for $text_height - a draft CSS value as set above for now</span>&nbsp;</div></li><li><div>      elseif ($CSSlineheight &gt; 0) {&nbsp;</div></li><li><div>          $lineheight = ($fontsize * $CSSlineheight);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $lineheight = ($fontsize * $this-&gt;normalLineheight);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// In general, calculate the &quot;leading&quot; - the difference between the fontheight and the lineheight</span>&nbsp;</div></li><li><div>      <span class="comment">// and add half to the top and half to the bottom. BUT</span>&nbsp;</div></li><li><div>      <span class="comment">// If an inline element has a font-size less than the block element, and the line-height is set as an em or % value</span>&nbsp;</div></li><li><div>      <span class="comment">// it will add too much leading below the font and expand the height of the line - so just use the block element exttop/extbottom:</span>&nbsp;</div></li><li><div>      if (preg_match('/mm/', $CSSlineheight) && $ypos['boxtop'] &lt; $blockYpos['boxtop'] && $ypos['boxbottom'] &gt; $blockYpos['boxbottom']) {&nbsp;</div></li><li><div>          $ypos['exttop'] = $blockYpos['exttop'];&nbsp;</div></li><li><div>          $ypos['extbottom'] = $blockYpos['extbottom'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $leading += ($lineheight - $fontheight);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $ypos['exttop'] = $ypos['boxtop'] + $leading / 2;&nbsp;</div></li><li><div>          $ypos['extbottom'] = $ypos['boxbottom'] - $leading / 2;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// TEMP ONLY FOR DEBUGGING *********************************</span>&nbsp;</div></li><li><div>      <span class="comment">//$ypos['lineheight'] = $lineheight;</span>&nbsp;</div></li><li><div>      <span class="comment">//$ypos['fontheight'] = $fontheight;</span>&nbsp;</div></li><li><div>      <span class="comment">//$ypos['leading'] = $leading;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $ypos;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** Called from WriteFlowingBlock() and finishFlowingBlock()</span>&nbsp;</div></li><li><div><span class="comment">    Determines the line hieght and glyph/writing position</span>&nbsp;</div></li><li><div><span class="comment">    for each element in the line to be written */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _setInlineBlockHeights(&$lineBox, &$stackHeight, &$content, &$font, $is_table)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;shrin_k &gt; 1) {&nbsp;</div></li><li><div>          $shrin_k = $this-&gt;shrin_k;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $shrin_k = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $ypos = array();&nbsp;</div></li><li><div>      $bordypos = array();&nbsp;</div></li><li><div>      $bgypos = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($is_table) {&nbsp;</div></li><li><div>          <span class="comment">// FOR TABLE</span>&nbsp;</div></li><li><div>          $fontsize = $this-&gt;FontSize;&nbsp;</div></li><li><div>          $fontkey = $this-&gt;FontFamily . $this-&gt;FontStyle;&nbsp;</div></li><li><div>          $fontdesc = $this-&gt;fonts[$fontkey]['desc'];&nbsp;</div></li><li><div>          $CSSlineheight = $this-&gt;cellLineHeight;&nbsp;</div></li><li><div>          $line_stacking_strategy = $this-&gt;cellLineStackingStrategy; <span class="comment">// inline-line-height [default] | block-line-height | max-height | grid-height</span>&nbsp;</div></li><li><div>          $line_stacking_shift = $this-&gt;cellLineStackingShift;  <span class="comment">// consider-shifts [default] | disregard-shifts</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// FOR BLOCK FONT</span>&nbsp;</div></li><li><div>          $fontsize = $this-&gt;blk[$this-&gt;blklvl]['InlineProperties']['size'];&nbsp;</div></li><li><div>          $fontkey = $this-&gt;blk[$this-&gt;blklvl]['InlineProperties']['family'] . $this-&gt;blk[$this-&gt;blklvl]['InlineProperties']['style'];&nbsp;</div></li><li><div>          $fontdesc = $this-&gt;fonts[$fontkey]['desc'];&nbsp;</div></li><li><div>          $CSSlineheight = $this-&gt;blk[$this-&gt;blklvl]['line_height'];&nbsp;</div></li><li><div>          <span class="comment">// inline-line-height | block-line-height | max-height | grid-height</span>&nbsp;</div></li><li><div>          $line_stacking_strategy = (isset($this-&gt;blk[$this-&gt;blklvl]['line_stacking_strategy']) ? $this-&gt;blk[$this-&gt;blklvl]['line_stacking_strategy'] : 'inline-line-height');&nbsp;</div></li><li><div>          <span class="comment">// consider-shifts | disregard-shifts</span>&nbsp;</div></li><li><div>          $line_stacking_shift = (isset($this-&gt;blk[$this-&gt;blklvl]['line_stacking_shift']) ? $this-&gt;blk[$this-&gt;blklvl]['line_stacking_shift'] : 'consider-shifts');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $boxLineHeight = $this-&gt;_computeLineheight($CSSlineheight, $fontsize);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// First, set a &quot;strut&quot; using block font at index $lineBox[-1]</span>&nbsp;</div></li><li><div>      $ypos[-1] = $this-&gt;_setLineYpos($fontsize, $fontdesc, $CSSlineheight);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// for the block element - always taking the block EXTENDED progression including leading - which may be negative</span>&nbsp;</div></li><li><div>      if ($line_stacking_strategy == 'block-line-height') {&nbsp;</div></li><li><div>          $topy = $ypos[-1]['exttop'];&nbsp;</div></li><li><div>          $bottomy = $ypos[-1]['extbottom'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $topy = 0;&nbsp;</div></li><li><div>          $bottomy = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get text-middle for aligning images/objects</span>&nbsp;</div></li><li><div>      $midpoint = $ypos[-1]['boxtop'] - (($ypos[-1]['boxtop'] - $ypos[-1]['boxbottom']) / 2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// for images / inline objects / replaced elements</span>&nbsp;</div></li><li><div>      $mta = 0; <span class="comment">// Maximum top-aligned</span>&nbsp;</div></li><li><div>      $mba = 0; <span class="comment">// Maximum bottom-aligned</span>&nbsp;</div></li><li><div>      foreach ($content as $k =&gt; $chunk) {&nbsp;</div></li><li><div>          if (isset($this-&gt;objectbuffer[$k]) && $this-&gt;objectbuffer[$k]['type'] == 'listmarker') {&nbsp;</div></li><li><div>              $ypos[$k] = $ypos[-1];&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// UPDATE Maximums</span></span>&nbsp;</div></li><li><div>              if ($line_stacking_strategy == 'block-line-height' || $line_stacking_strategy == 'grid-height' || $line_stacking_strategy == 'max-height') { <span class="comment"><span class="comment">// don't include extended block progression of all inline elements</span></span>&nbsp;</div></li><li><div>                  if ($ypos[$k]['boxtop'] &gt; $topy)&nbsp;</div></li><li><div>                      $topy = $ypos[$k]['boxtop'];&nbsp;</div></li><li><div>                  if ($ypos[$k]['boxbottom'] &lt; $bottomy)&nbsp;</div></li><li><div>                      $bottomy = $ypos[$k]['boxbottom'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  if ($ypos[$k]['exttop'] &gt; $topy)&nbsp;</div></li><li><div>                      $topy = $ypos[$k]['exttop'];&nbsp;</div></li><li><div>                  if ($ypos[$k]['extbottom'] &lt; $bottomy)&nbsp;</div></li><li><div>                      $bottomy = $ypos[$k]['extbottom'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif (isset($this-&gt;objectbuffer[$k]) && $this-&gt;objectbuffer[$k]['type'] == 'dottab') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> DOTTAB&nbsp;</div></li><li><div>              $fontsize = $font[$k]['size'];&nbsp;</div></li><li><div>              $fontdesc = $font[$k]['curr']['desc'];&nbsp;</div></li><li><div>              $lh = 1;&nbsp;</div></li><li><div>              $ypos[$k] = $this-&gt;_setLineYpos($fontsize, $fontdesc, $lh, $ypos[-1]); <span class="comment">// Lineheight=1 fixed</span>&nbsp;</div></li><li><div>          } elseif (isset($this-&gt;objectbuffer[$k])) {&nbsp;</div></li><li><div>              $oh = $this-&gt;objectbuffer[$k]['OUTER-HEIGHT'];&nbsp;</div></li><li><div>              $va = $this-&gt;objectbuffer[$k]['vertical-align'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($va == 'BS') { <span class="comment"><span class="comment">//  (BASELINE default)</span></span>&nbsp;</div></li><li><div>                  if ($oh &gt; $topy)&nbsp;</div></li><li><div>                      $topy = $oh;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ($va == 'M') {&nbsp;</div></li><li><div>                  if (($midpoint + $oh / 2) &gt; $topy)&nbsp;</div></li><li><div>                      $topy = $midpoint + $oh / 2;&nbsp;</div></li><li><div>                  if (($midpoint - $oh / 2) &lt; $bottomy)&nbsp;</div></li><li><div>                      $bottomy = $midpoint - $oh / 2;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ($va == 'TT') {&nbsp;</div></li><li><div>                  if (($ypos[-1]['boxtop'] - $oh) &lt; $bottomy) {&nbsp;</div></li><li><div>                      $bottomy = $ypos[-1]['boxtop'] - $oh;&nbsp;</div></li><li><div>                      $topy = max($topy, $ypos[-1]['boxtop']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ($va == 'TB') {&nbsp;</div></li><li><div>                  if (($ypos[-1]['boxbottom'] + $oh) &gt; $topy) {&nbsp;</div></li><li><div>                      $topy = $ypos[-1]['boxbottom'] + $oh;&nbsp;</div></li><li><div>                      $bottomy = min($bottomy, $ypos[-1]['boxbottom']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ($va == 'T') {&nbsp;</div></li><li><div>                  if ($oh &gt; $mta)&nbsp;</div></li><li><div>                      $mta = $oh;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ($va == 'B') {&nbsp;</div></li><li><div>                  if ($oh &gt; $mba)&nbsp;</div></li><li><div>                      $mba = $oh;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ($content[$k] || $content[$k] === '0') {&nbsp;</div></li><li><div>              <span class="comment">// FOR FLOWING BLOCK</span>&nbsp;</div></li><li><div>              $fontsize = $font[$k]['size'];&nbsp;</div></li><li><div>              $fontdesc = $font[$k]['curr']['desc'];&nbsp;</div></li><li><div>              <span class="comment">// In future could set CSS line-height from inline elements; for now, use block level:</span>&nbsp;</div></li><li><div>              $ypos[$k] = $this-&gt;_setLineYpos($fontsize, $fontdesc, $CSSlineheight, $ypos[-1]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (isset($font[$k]['textparam']['text-baseline']) && $font[$k]['textparam']['text-baseline'] != 0) {&nbsp;</div></li><li><div>                  $ypos[$k]['baseline-shift'] = $font[$k]['textparam']['text-baseline'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// DO ALIGNMENT FOR BASELINES *******************</span>&nbsp;</div></li><li><div>              <span class="comment">// Until most fonts have OpenType BASE tables, this won't work</span>&nbsp;</div></li><li><div>              <span class="comment">// $ypos[$k] compared to $ypos[-1] or $ypos[$k-1] using $dominant_baseline and $baseline_table</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// UPDATE Maximums</span></span>&nbsp;</div></li><li><div>              if ($line_stacking_strategy == 'block-line-height' || $line_stacking_strategy == 'grid-height' || $line_stacking_strategy == 'max-height') { <span class="comment"><span class="comment">// don't include extended block progression of all inline elements</span></span>&nbsp;</div></li><li><div>                  if ($line_stacking_shift == 'disregard-shifts') {&nbsp;</div></li><li><div>                      if ($ypos[$k]['boxtop'] &gt; $topy)&nbsp;</div></li><li><div>                          $topy = $ypos[$k]['boxtop'];&nbsp;</div></li><li><div>                      if ($ypos[$k]['boxbottom'] &lt; $bottomy)&nbsp;</div></li><li><div>                          $bottomy = $ypos[$k]['boxbottom'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      if (($ypos[$k]['boxtop'] + $ypos[$k]['baseline-shift']) &gt; $topy)&nbsp;</div></li><li><div>                          $topy = $ypos[$k]['boxtop'] + $ypos[$k]['baseline-shift'];&nbsp;</div></li><li><div>                      if (($ypos[$k]['boxbottom'] + $ypos[$k]['baseline-shift']) &lt; $bottomy)&nbsp;</div></li><li><div>                          $bottomy = $ypos[$k]['boxbottom'] + $ypos[$k]['baseline-shift'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  if ($line_stacking_shift == 'disregard-shifts') {&nbsp;</div></li><li><div>                      if ($ypos[$k]['exttop'] &gt; $topy)&nbsp;</div></li><li><div>                          $topy = $ypos[$k]['exttop'];&nbsp;</div></li><li><div>                      if ($ypos[$k]['extbottom'] &lt; $bottomy)&nbsp;</div></li><li><div>                          $bottomy = $ypos[$k]['extbottom'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      if (($ypos[$k]['exttop'] + $ypos[$k]['baseline-shift']) &gt; $topy)&nbsp;</div></li><li><div>                          $topy = $ypos[$k]['exttop'] + $ypos[$k]['baseline-shift'];&nbsp;</div></li><li><div>                      if (($ypos[$k]['extbottom'] + $ypos[$k]['baseline-shift']) &lt; $bottomy)&nbsp;</div></li><li><div>                          $bottomy = $ypos[$k]['extbottom'] + $ypos[$k]['baseline-shift'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// If BORDER set on inline element</span>&nbsp;</div></li><li><div>              if (isset($font[$k]['bord']) && $font[$k]['bord']) {&nbsp;</div></li><li><div>                  $bordfontsize = $font[$k]['textparam']['bord-decoration']['fontsize'] / $shrin_k;&nbsp;</div></li><li><div>                  $bordfontkey = $font[$k]['textparam']['bord-decoration']['fontkey'];&nbsp;</div></li><li><div>                  if ($bordfontkey != $fontkey || $bordfontsize != $fontsize || isset($font[$k]['textparam']['bord-decoration']['baseline'])) {&nbsp;</div></li><li><div>                      $bordfontdesc = $this-&gt;fonts[$bordfontkey]['desc'];&nbsp;</div></li><li><div>                      $bordypos[$k] = $this-&gt;_setLineYpos($bordfontsize, $bordfontdesc, $CSSlineheight, $ypos[-1]);&nbsp;</div></li><li><div>                      if (isset($font[$k]['textparam']['bord-decoration']['baseline']) && $font[$k]['textparam']['bord-decoration']['baseline'] != 0) {&nbsp;</div></li><li><div>                          $bordypos[$k]['baseline-shift'] = $font[$k]['textparam']['bord-decoration']['baseline'] / $shrin_k;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// If BACKGROUND set on inline element</span>&nbsp;</div></li><li><div>              if (isset($font[$k]['spanbgcolor']) && $font[$k]['spanbgcolor']) {&nbsp;</div></li><li><div>                  $bgfontsize = $font[$k]['textparam']['bg-decoration']['fontsize'] / $shrin_k;&nbsp;</div></li><li><div>                  $bgfontkey = $font[$k]['textparam']['bg-decoration']['fontkey'];&nbsp;</div></li><li><div>                  if ($bgfontkey != $fontkey || $bgfontsize != $fontsize || isset($font[$k]['textparam']['bg-decoration']['baseline'])) {&nbsp;</div></li><li><div>                      $bgfontdesc = $this-&gt;fonts[$bgfontkey]['desc'];&nbsp;</div></li><li><div>                      $bgypos[$k] = $this-&gt;_setLineYpos($bgfontsize, $bgfontdesc, $CSSlineheight, $ypos[-1]);&nbsp;</div></li><li><div>                      if (isset($font[$k]['textparam']['bg-decoration']['baseline']) && $font[$k]['textparam']['bg-decoration']['baseline'] != 0) {&nbsp;</div></li><li><div>                          $bgypos[$k]['baseline-shift'] = $font[$k]['textparam']['bg-decoration']['baseline'] / $shrin_k;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// TOP</span> or BOTTOM aligned images</span>&nbsp;</div></li><li><div>      if ($mta &gt; ($topy - $bottomy)) {&nbsp;</div></li><li><div>          if (($topy - $mta) &lt; $bottomy)&nbsp;</div></li><li><div>              $bottomy = $topy - $mta;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($mba &gt; ($topy - $bottomy)) {&nbsp;</div></li><li><div>          if (($bottomy + $mba) &gt; $topy)&nbsp;</div></li><li><div>              $topy = $bottomy + $mba;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($line_stacking_strategy == 'block-line-height') { <span class="comment">// fixed height set by block element (whether present or not)</span>&nbsp;</div></li><li><div>          $topy = $ypos[-1]['exttop'];&nbsp;</div></li><li><div>          $bottomy = $ypos[-1]['extbottom'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $inclusiveHeight = $topy - $bottomy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// SET $stackHeight taking note of line_stacking_strategy</span>&nbsp;</div></li><li><div>      <span class="comment">// NB inclusive height already takes account of need to consider block progression height (excludes leading set by lineheight)</span>&nbsp;</div></li><li><div>      <span class="comment">// or extended block progression height (includes leading set by lineheight)</span>&nbsp;</div></li><li><div>      if ($line_stacking_strategy == 'block-line-height') { <span class="comment">// fixed = extended block progression height of block element</span>&nbsp;</div></li><li><div>          $stackHeight = $boxLineHeight;&nbsp;</div></li><li><div>      } elseif ($line_stacking_strategy == 'max-height') { <span class="comment">// smallest height which includes extended block progression height of block element</span>&nbsp;</div></li><li><div>          <span class="comment">// and block progression heights of inline elements (NOT extended)</span>&nbsp;</div></li><li><div>          $stackHeight = $inclusiveHeight;&nbsp;</div></li><li><div>      } elseif ($line_stacking_strategy == 'grid-height') { <span class="comment">// smallest multiple of block element lineheight to include</span>&nbsp;</div></li><li><div>          <span class="comment">// block progression heights of inline elements (NOT extended)</span>&nbsp;</div></li><li><div>          $stackHeight = $boxLineHeight;&nbsp;</div></li><li><div>          while ($stackHeight &lt; $inclusiveHeight) {&nbsp;</div></li><li><div>              $stackHeight += $boxLineHeight;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else { // 'inline-line-height' = default        <span class="comment">// smallest height which includes extended block progression height of block element</span>&nbsp;</div></li><li><div>          <span class="comment">// AND extended block progression heights of inline elements</span>&nbsp;</div></li><li><div>          $stackHeight = $inclusiveHeight;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $diff = $stackHeight - $inclusiveHeight;&nbsp;</div></li><li><div>      $topy += $diff / 2;&nbsp;</div></li><li><div>      $bottomy -= $diff / 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// ADJUST $ypos =&gt; lineBox using $stackHeight; lineBox are all offsets from the top of stackHeight in mm</span>&nbsp;</div></li><li><div>      <span class="comment">// and SET IMAGE OFFSETS</span>&nbsp;</div></li><li><div>      $lineBox[-1]['boxtop'] = $topy - $ypos[-1]['boxtop'];&nbsp;</div></li><li><div>      $lineBox[-1]['boxbottom'] = $topy - $ypos[-1]['boxbottom'];&nbsp;</div></li><li><div>      <span class="comment">//    $lineBox[-1]['exttop'] = $topy - $ypos[-1]['exttop'];</span>&nbsp;</div></li><li><div>      <span class="comment">//    $lineBox[-1]['extbottom'] = $topy - $ypos[-1]['extbottom'];</span>&nbsp;</div></li><li><div>      $lineBox[-1]['glyphYorigin'] = $topy - $ypos[-1]['glyphYorigin'];&nbsp;</div></li><li><div>      $lineBox[-1]['baseline-shift'] = $ypos[-1]['baseline-shift'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $midpoint = $lineBox[-1]['boxbottom'] - (($lineBox[-1]['boxbottom'] - $lineBox[-1]['boxtop']) / 2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($content as $k =&gt; $chunk) {&nbsp;</div></li><li><div>          if (isset($this-&gt;objectbuffer[$k])) {&nbsp;</div></li><li><div>              $oh = $this-&gt;objectbuffer[$k]['OUTER-HEIGHT'];&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// LIST MARKERS</span></span>&nbsp;</div></li><li><div>              if ($this-&gt;objectbuffer[$k]['type'] == 'listmarker') {&nbsp;</div></li><li><div>                  $oh = $fontsize;&nbsp;</div></li><li><div>              } elseif ($this-&gt;objectbuffer[$k]['type'] == 'dottab') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> DOTTAB&nbsp;</div></li><li><div>                  $oh = $font[$k]['size']; <span class="comment">// == $this-&gt;objectbuffer[$k]['fontsize']/_MPDFK;</span>&nbsp;</div></li><li><div>                  $lineBox[$k]['boxtop'] = $topy - $ypos[$k]['boxtop'];&nbsp;</div></li><li><div>                  $lineBox[$k]['boxbottom'] = $topy - $ypos[$k]['boxbottom'];&nbsp;</div></li><li><div>                  $lineBox[$k]['glyphYorigin'] = $topy - $ypos[$k]['glyphYorigin'];&nbsp;</div></li><li><div>                  $lineBox[$k]['baseline-shift'] = 0;&nbsp;</div></li><li><div>                  <span class="comment">// continue;</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $va = $this-&gt;objectbuffer[$k]['vertical-align']; <span class="comment">// = $objattr['vertical-align'] = set as M, T, B, S</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($va == 'BS') { <span class="comment"><span class="comment">//  (BASELINE default)</span></span>&nbsp;</div></li><li><div>                  $lineBox[$k]['top'] = $lineBox[-1]['glyphYorigin'] - $oh;&nbsp;</div></li><li><div>              } elseif ($va == 'M') {&nbsp;</div></li><li><div>                  $lineBox[$k]['top'] = $midpoint - $oh / 2;&nbsp;</div></li><li><div>              } elseif ($va == 'TT') {&nbsp;</div></li><li><div>                  $lineBox[$k]['top'] = $lineBox[-1]['boxtop'];&nbsp;</div></li><li><div>              } elseif ($va == 'TB') {&nbsp;</div></li><li><div>                  $lineBox[$k]['top'] = $lineBox[-1]['boxbottom'] - $oh;&nbsp;</div></li><li><div>              } elseif ($va == 'T') {&nbsp;</div></li><li><div>                  $lineBox[$k]['top'] = 0;&nbsp;</div></li><li><div>              } elseif ($va == 'B') {&nbsp;</div></li><li><div>                  $lineBox[$k]['top'] = $stackHeight - $oh;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($content[$k] || $content[$k] === '0') {&nbsp;</div></li><li><div>              $lineBox[$k]['boxtop'] = $topy - $ypos[$k]['boxtop'];&nbsp;</div></li><li><div>              $lineBox[$k]['boxbottom'] = $topy - $ypos[$k]['boxbottom'];&nbsp;</div></li><li><div>              <span class="comment">// $lineBox[$k]['exttop'] = $topy - $ypos[$k]['exttop'];</span>&nbsp;</div></li><li><div>              <span class="comment">// $lineBox[$k]['extbottom'] = $topy - $ypos[$k]['extbottom'];</span>&nbsp;</div></li><li><div>              $lineBox[$k]['glyphYorigin'] = $topy - $ypos[$k]['glyphYorigin'];&nbsp;</div></li><li><div>              $lineBox[$k]['baseline-shift'] = $ypos[$k]['baseline-shift'];&nbsp;</div></li><li><div>              if (isset($bordypos[$k]['boxtop'])) {&nbsp;</div></li><li><div>                  $lineBox[$k]['border-boxtop'] = $topy - $bordypos[$k]['boxtop'];&nbsp;</div></li><li><div>                  $lineBox[$k]['border-boxbottom'] = $topy - $bordypos[$k]['boxbottom'];&nbsp;</div></li><li><div>                  $lineBox[$k]['border-baseline-shift'] = $bordypos[$k]['baseline-shift'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($bgypos[$k]['boxtop'])) {&nbsp;</div></li><li><div>                  $lineBox[$k]['background-boxtop'] = $topy - $bgypos[$k]['boxtop'];&nbsp;</div></li><li><div>                  $lineBox[$k]['background-boxbottom'] = $topy - $bgypos[$k]['boxbottom'];&nbsp;</div></li><li><div>                  $lineBox[$k]['background-baseline-shift'] = $bgypos[$k]['baseline-shift'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetBasePath($str = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (isset($_SERVER['HTTP_HOST'])) {&nbsp;</div></li><li><div>          $host = $_SERVER['HTTP_HOST'];&nbsp;</div></li><li><div>      } elseif (isset($_SERVER['SERVER_NAME'])) {&nbsp;</div></li><li><div>          $host = $_SERVER['SERVER_NAME'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $host = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$str) {&nbsp;</div></li><li><div>          if ($_SERVER['SCRIPT_NAME']) {&nbsp;</div></li><li><div>              $currentPath = dirname($_SERVER['SCRIPT_NAME']);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $currentPath = dirname($_SERVER['PHP_SELF']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $currentPath = str_replace(&quot;\\&quot;, &quot;/&quot;, $currentPath);&nbsp;</div></li><li><div>          if ($currentPath == '/') {&nbsp;</div></li><li><div>              $currentPath = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($host) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS']) {&nbsp;</div></li><li><div>                  $currpath = 'https:<span class="comment"><span class="comment">//' . $host . $currentPath . '/';</span></span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $currpath = 'http:<span class="comment"><span class="comment">//' . $host . $currentPath . '/';</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $currpath = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;basepath = $currpath;&nbsp;</div></li><li><div>          $this-&gt;basepathIsLocal = true;&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $str = preg_replace('/\?.*/', '', $str);&nbsp;</div></li><li><div>      if (!preg_match('/(http|https|ftp):\/\/.*\<span class="comment">//i', $str)) {</span>&nbsp;</div></li><li><div>          $str .= '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $str .= 'xxx'; <span class="comment">// in case $str ends in / e.g. http://www.bbc.co.uk/</span>&nbsp;</div></li><li><div>      $this-&gt;basepath = dirname($str) . &quot;/&quot;; <span class="comment">// returns e.g. e.g. http://www.google.com/dir1/dir2/dir3/</span>&nbsp;</div></li><li><div>      $this-&gt;basepath = str_replace(&quot;\\&quot;, &quot;/&quot;, $this-&gt;basepath); <span class="comment"><span class="comment">//If on Windows</span></span>&nbsp;</div></li><li><div>      $tr = parse_url($this-&gt;basepath);&nbsp;</div></li><li><div>      if (isset($tr['host']) && ($tr['host'] == $host)) {&nbsp;</div></li><li><div>          $this-&gt;basepathIsLocal = true;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;basepathIsLocal = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function GetFullPath(&$path, $basepath = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// When parsing CSS need to pass temporary basepath - so links are relative to current stylesheet</span>&nbsp;</div></li><li><div>      if (!$basepath) {&nbsp;</div></li><li><div>          $basepath = $this-&gt;basepath;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Fix path value</span>&nbsp;</div></li><li><div>      $path = str_replace(&quot;\\&quot;, &quot;/&quot;, $path); <span class="comment"><span class="comment">//If on Windows</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>      if (substr($path, 0, 2) == &quot;<span class="comment">//&quot;) {</span>&nbsp;</div></li><li><div>          $tr = parse_url($basepath);&nbsp;</div></li><li><div>          $path = $tr['scheme'] . ':' . $path; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $regexp = '|^./|'; <span class="comment">// Inadvertently corrects &quot;./path/etc&quot; and &quot;//www.domain.com/etc&quot;</span>&nbsp;</div></li><li><div>      $path = preg_replace($regexp, '', $path);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (substr($path, 0, 1) == '#') {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (preg_match('@^(mailto|tel|fax):.*@i', $path)) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (substr($path, 0, 3) == &quot;../&quot;) { <span class="comment">//It is a Relative Link</span>&nbsp;</div></li><li><div>          $backtrackamount = substr_count($path, &quot;../&quot;);&nbsp;</div></li><li><div>          $maxbacktrack = substr_count($basepath, &quot;/&quot;) - 3;&nbsp;</div></li><li><div>          $filepath = str_replace(&quot;../&quot;, '', $path);&nbsp;</div></li><li><div>          $path = $basepath;&nbsp;</div></li><li><div>          <span class="comment">//If it is an invalid relative link, then make it go to directory root</span>&nbsp;</div></li><li><div>          if ($backtrackamount &gt; $maxbacktrack)&nbsp;</div></li><li><div>              $backtrackamount = $maxbacktrack;&nbsp;</div></li><li><div>          <span class="comment">//Backtrack some directories</span>&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $backtrackamount + 1; $i++)&nbsp;</div></li><li><div>              $path = substr($path, 0, strrpos($path, &quot;/&quot;));&nbsp;</div></li><li><div>          $path = $path . &quot;/&quot; . $filepath; <span class="comment">//Make it an absolute path</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ((strpos($path, &quot;:/&quot;) === false || strpos($path, &quot;:/&quot;) &gt; 10) && !is_file($path)) { <span class="comment">//It is a Local Link</span>&nbsp;</div></li><li><div>          if (substr($path, 0, 1) == &quot;/&quot;) {&nbsp;</div></li><li><div>              $tr = parse_url($basepath);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>              $root = '';&nbsp;</div></li><li><div>              if (!empty($tr['scheme'])) {&nbsp;</div></li><li><div>                  $root .= $tr['scheme'] . ':<span class="comment"><span class="comment">//';</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $root .= isset($tr['host']) ? $tr['host'] : '';&nbsp;</div></li><li><div>              $root .= ((isset($tr['port']) && $tr['port']) ? (':' . $tr['port']) : ''); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>              $path = $root . $path;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $path = $basepath . $path;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Do nothing if it is an Absolute Link</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Used for external CSS files</span>&nbsp;</div></li><li><div>  function _get_file($path)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// If local file try using local path (? quicker, but also allowed even if allow_url_fopen false)</span>&nbsp;</div></li><li><div>      $contents = '';&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>      if (strpos($path, &quot;<span class="comment">//&quot;) === false) {</span>&nbsp;</div></li><li><div>          $path = preg_replace('/\.css\?.*$/', '.css', $path);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $contents = @file_get_contents($path);&nbsp;</div></li><li><div>      if ($contents) {&nbsp;</div></li><li><div>          return $contents;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;basepathIsLocal) {&nbsp;</div></li><li><div>          $tr = parse_url($path);&nbsp;</div></li><li><div>          $lp = getenv(&quot;SCRIPT_NAME&quot;);&nbsp;</div></li><li><div>          $ap = realpath($lp);&nbsp;</div></li><li><div>          $ap = str_replace(&quot;\\&quot;, &quot;/&quot;, $ap);&nbsp;</div></li><li><div>          $docroot = substr($ap, 0, strpos($ap, $lp));&nbsp;</div></li><li><div>          <span class="comment">// WriteHTML parses all paths to full URLs; may be local file name</span>&nbsp;</div></li><li><div>          if ($tr['scheme'] && $tr['host'] && $_SERVER[&quot;DOCUMENT_ROOT&quot;]) {&nbsp;</div></li><li><div>              $localpath = $_SERVER[&quot;DOCUMENT_ROOT&quot;] . $tr['path'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// DOCUMENT_ROOT is not returned on IIS</span>&nbsp;</div></li><li><div>          elseif ($docroot) {&nbsp;</div></li><li><div>              $localpath = $docroot . $tr['path'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $localpath = $path;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $contents = @file_get_contents($localpath);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// if not use full URL</span>&nbsp;</div></li><li><div>      elseif (!$contents && !ini_get('allow_url_fopen') && function_exists(&quot;curl_init&quot;)) {&nbsp;</div></li><li><div>          $ch = curl_init($path);&nbsp;</div></li><li><div>          curl_setopt($ch, CURLOPT_HEADER, 0);&nbsp;</div></li><li><div>          curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);&nbsp;</div></li><li><div>          $contents = curl_exec($ch);&nbsp;</div></li><li><div>          curl_close($ch);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $contents;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function docPageNum($num = 0, $extras = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($num &lt; 1) {&nbsp;</div></li><li><div>          $num = $this-&gt;page;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $type = $this-&gt;defaultPageNumStyle; <span class="comment"><span class="comment"><span class="comment">// set default Page Number Style</span></span></span>&nbsp;</div></li><li><div>      $ppgno = $num;&nbsp;</div></li><li><div>      $suppress = 0;&nbsp;</div></li><li><div>      $offset = 0;&nbsp;</div></li><li><div>      $lastreset = 0;&nbsp;</div></li><li><div>      foreach ($this-&gt;PageNumSubstitutions AS $psarr) {&nbsp;</div></li><li><div>          if ($num &gt;= $psarr['from']) {&nbsp;</div></li><li><div>              if ($psarr['reset']) {&nbsp;</div></li><li><div>                  if ($psarr['reset'] &gt; 1) {&nbsp;</div></li><li><div>                      $offset = $psarr['reset'] - 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $ppgno = $num - $psarr['from'] + 1 + $offset;&nbsp;</div></li><li><div>                  $lastreset = $psarr['from'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($psarr['type']) {&nbsp;</div></li><li><div>                  $type = $psarr['type'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (strtoupper($psarr['suppress']) == 'ON' || $psarr['suppress'] == 1) {&nbsp;</div></li><li><div>                  $suppress = 1;&nbsp;</div></li><li><div>              } elseif (strtoupper($psarr['suppress']) == 'OFF') {&nbsp;</div></li><li><div>                  $suppress = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($suppress) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $ppgno = $this-&gt;_getStyledNumber($ppgno, $type);&nbsp;</div></li><li><div>      if ($extras) {&nbsp;</div></li><li><div>          $ppgno = $this-&gt;pagenumPrefix . $ppgno . $this-&gt;pagenumSuffix;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $ppgno;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function docPageNumTotal($num = 0, $extras = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($num &lt; 1) {&nbsp;</div></li><li><div>          $num = $this-&gt;page;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $type = $this-&gt;defaultPageNumStyle; <span class="comment"><span class="comment"><span class="comment">// set default Page Number Style</span></span></span>&nbsp;</div></li><li><div>      $ppgstart = 1;&nbsp;</div></li><li><div>      $ppgend = count($this-&gt;pages) + 1;&nbsp;</div></li><li><div>      $suppress = 0;&nbsp;</div></li><li><div>      $offset = 0;&nbsp;</div></li><li><div>      foreach ($this-&gt;PageNumSubstitutions AS $psarr) {&nbsp;</div></li><li><div>          if ($num &gt;= $psarr['from']) {&nbsp;</div></li><li><div>              if ($psarr['reset']) {&nbsp;</div></li><li><div>                  if ($psarr['reset'] &gt; 1) {&nbsp;</div></li><li><div>                      $offset = $psarr['reset'] - 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $ppgstart = $psarr['from'] + $offset;&nbsp;</div></li><li><div>                  $ppgend = count($this-&gt;pages) + 1 + $offset;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($psarr['type']) {&nbsp;</div></li><li><div>                  $type = $psarr['type'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (strtoupper($psarr['suppress']) == 'ON' || $psarr['suppress'] == 1) {&nbsp;</div></li><li><div>                  $suppress = 1;&nbsp;</div></li><li><div>              } elseif (strtoupper($psarr['suppress']) == 'OFF') {&nbsp;</div></li><li><div>                  $suppress = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($num &lt; $psarr['from']) {&nbsp;</div></li><li><div>              if ($psarr['reset']) {&nbsp;</div></li><li><div>                  $ppgend = $psarr['from'] + $offset;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($suppress) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $ppgno = $ppgend - $ppgstart + $offset;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $ppgno = $this-&gt;_getStyledNumber($ppgno, $type);&nbsp;</div></li><li><div>      if ($extras) {&nbsp;</div></li><li><div>          $ppgno = $this-&gt;pagenumPrefix . $ppgno . $this-&gt;pagenumSuffix;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $ppgno;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  function _getStyledNumber($ppgno, $type, $listmarker = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($listmarker) {&nbsp;</div></li><li><div>          $reverse = true;   <span class="comment">// Reverse RTL numerals (Hebrew) when using for list</span>&nbsp;</div></li><li><div>          $checkfont = true; <span class="comment">// Using list - font is set, so check if character is available</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $reverse = false;  <span class="comment">// For pagenumbers, RTL numerals (Hebrew) will get reversed later by bidi</span>&nbsp;</div></li><li><div>          $checkfont = false; <span class="comment">// For pagenumbers - font is not set, so no check</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $lowertype = strtolower($type);&nbsp;</div></li><li><div>      if ($lowertype == 'upper-latin' || $lowertype == 'upper-alpha' || $type == 'A') {&nbsp;</div></li><li><div>          $ppgno = $this-&gt;dec2alpha($ppgno, true);&nbsp;</div></li><li><div>      } elseif ($lowertype == 'lower-latin' || $lowertype == 'lower-alpha' || $type == 'a') {&nbsp;</div></li><li><div>          $ppgno = $this-&gt;dec2alpha($ppgno, false);&nbsp;</div></li><li><div>      } elseif ($lowertype == 'upper-roman' || $type == 'I') {&nbsp;</div></li><li><div>          $ppgno = $this-&gt;dec2roman($ppgno, true);&nbsp;</div></li><li><div>      } elseif ($lowertype == 'lower-roman' || $type == 'i') {&nbsp;</div></li><li><div>          $ppgno = $this-&gt;dec2roman($ppgno, false);&nbsp;</div></li><li><div>      } elseif ($lowertype == 'hebrew') {&nbsp;</div></li><li><div>          $ppgno = $this-&gt;dec2hebrew($ppgno, $reverse);&nbsp;</div></li><li><div>      } elseif (preg_match('/(arabic-indic|bengali|devanagari|gujarati|gurmukhi|kannada|malayalam|oriya|persian|tamil|telugu|thai|urdu|cambodian|khmer|lao)/i', $lowertype, $m)) {&nbsp;</div></li><li><div>          switch ($m[1]) { <span class="comment">//Format type</span>&nbsp;</div></li><li><div>              case 'arabic-indic': $cp = 0x0660;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'persian':&nbsp;</div></li><li><div>              case 'urdu': $cp = 0x06F0;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'bengali': $cp = 0x09E6;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'devanagari': $cp = 0x0966;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'gujarati': $cp = 0x0AE6;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'gurmukhi': $cp = 0x0A66;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'kannada': $cp = 0x0CE6;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'malayalam': $cp = 0x0D66;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'oriya': $cp = 0x0B66;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'telugu': $cp = 0x0C66;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'tamil': $cp = 0x0BE6;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'thai': $cp = 0x0E50;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'khmer':&nbsp;</div></li><li><div>              case 'cambodian': $cp = 0x17E0;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'lao': $cp = 0x0ED0;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $ppgno = $this-&gt;dec2other($ppgno, $cp, $checkfont);&nbsp;</div></li><li><div>      } elseif ($lowertype == 'cjk-decimal') {&nbsp;</div></li><li><div>          $ppgno = $this-&gt;dec2cjk($ppgno);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $ppgno;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function docPageSettings($num = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Returns current type (numberstyle), suppression state for this page number;</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// reset</span> is only returned if set for this page number</span>&nbsp;</div></li><li><div>      if ($num &lt; 1) {&nbsp;</div></li><li><div>          $num = $this-&gt;page;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $type = $this-&gt;defaultPageNumStyle; <span class="comment"><span class="comment"><span class="comment">// set default Page Number Style</span></span></span>&nbsp;</div></li><li><div>      $ppgno = $num;&nbsp;</div></li><li><div>      $suppress = 0;&nbsp;</div></li><li><div>      $offset = 0;&nbsp;</div></li><li><div>      $reset = '';&nbsp;</div></li><li><div>      foreach ($this-&gt;PageNumSubstitutions AS $psarr) {&nbsp;</div></li><li><div>          if ($num &gt;= $psarr['from']) {&nbsp;</div></li><li><div>              if ($psarr['reset']) {&nbsp;</div></li><li><div>                  if ($psarr['reset'] &gt; 1) {&nbsp;</div></li><li><div>                      $offset = $psarr['reset'] - 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $ppgno = $num - $psarr['from'] + 1 + $offset;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($psarr['type']) {&nbsp;</div></li><li><div>                  $type = $psarr['type'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (strtoupper($psarr['suppress']) == 'ON' || $psarr['suppress'] == 1) {&nbsp;</div></li><li><div>                  $suppress = 1;&nbsp;</div></li><li><div>              } elseif (strtoupper($psarr['suppress']) == 'OFF') {&nbsp;</div></li><li><div>                  $suppress = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($num == $psarr['from']) {&nbsp;</div></li><li><div>              $reset = $psarr['reset'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($suppress) {&nbsp;</div></li><li><div>          $suppress = 'on';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $suppress = 'off';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array($type, $suppress, $reset);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function RestartDocTemplate()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;docTemplateStart = $this-&gt;page;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//Page</span> header</span>&nbsp;</div></li><li><div>  function Header($content = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;cMarginL = 0;&nbsp;</div></li><li><div>      $this-&gt;cMarginR = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (($this-&gt;mirrorMargins && ($this-&gt;page % 2 == 0) && $this-&gt;HTMLHeaderE) || ($this-&gt;mirrorMargins && ($this-&gt;page % 2 == 1) && $this-&gt;HTMLHeader) || (!$this-&gt;mirrorMargins && $this-&gt;HTMLHeader)) {&nbsp;</div></li><li><div>          $this-&gt;writeHTMLHeaders();&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function TableHeaderFooter($content = '', $tablestartpage = '', $tablestartcolumn = '', $horf = 'H', $level, $firstSpread = true, $finalSpread = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (($horf == 'H' || $horf == 'F') && !empty($content)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>          $table = &$this-&gt;table[1][1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>          if ($horf == 'F') { <span class="comment">// Table Footer</span>&nbsp;</div></li><li><div>              $firstrow = count($table['cells']) - $table['footernrows'];&nbsp;</div></li><li><div>              $lastrow = count($table['cells']) - 1;&nbsp;</div></li><li><div>          } else {  <span class="comment">// Table Header</span>&nbsp;</div></li><li><div>              $firstrow = 0;&nbsp;</div></li><li><div>              $lastrow = $table['headernrows'] - 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (empty($content[$firstrow])) {&nbsp;</div></li><li><div>              if ($this-&gt;debug) {&nbsp;</div></li><li><div>                  throw new MpdfException(&quot;&lt;tfoot&gt; must precede &lt;tbody&gt; in a table&quot;);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  return;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Advance down page</span> by half width of top border</span></span>&nbsp;</div></li><li><div>          if ($horf == 'H') { <span class="comment">// Only if header</span>&nbsp;</div></li><li><div>              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                  $adv = $table['border_spacing_V'] / 2 + $table['border_details']['T']['w'] + $table['padding']['T'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $adv = $table['max_cell_border_width']['T'] / 2;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($adv) {&nbsp;</div></li><li><div>                  if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>                      $this-&gt;y += ($adv);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;DivLn($adv, $this-&gt;blklvl, true);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $topy = $content[$firstrow][0]['y'] - $this-&gt;y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          for ($i = $firstrow; $i &lt;= $lastrow; $i++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $y = $this-&gt;y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// If outside columns, this is done in PaintDivBB</span></span>&nbsp;</div></li><li><div>              if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//OUTER FILL BGCOLOR of DIVS</span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;blklvl &gt; 0) {&nbsp;</div></li><li><div>                      $firstblockfill = $this-&gt;GetFirstBlockFill();&nbsp;</div></li><li><div>                      if ($firstblockfill && $this-&gt;blklvl &gt;= $firstblockfill) {&nbsp;</div></li><li><div>                          $divh = $content[$i][0]['h'];&nbsp;</div></li><li><div>                          $bak_x = $this-&gt;x;&nbsp;</div></li><li><div>                          $this-&gt;DivLn($divh, -3, false);&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment">// Reset</span> current block fill</span></span>&nbsp;</div></li><li><div>                          $bcor = $this-&gt;blk[$this-&gt;blklvl]['bgcolorarray'];&nbsp;</div></li><li><div>                          $this-&gt;SetFColor($bcor);&nbsp;</div></li><li><div>                          $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $colctr = 0;&nbsp;</div></li><li><div>              foreach ($content[$i] as $tablehf) {&nbsp;</div></li><li><div>                  $colctr++;&nbsp;</div></li><li><div>                  $y = $tablehf['y'] - $topy;&nbsp;</div></li><li><div>                  $this-&gt;y = $y;&nbsp;</div></li><li><div>                  <span class="comment">//Set some cell values</span>&nbsp;</div></li><li><div>                  $x = $tablehf['x'];&nbsp;</div></li><li><div>                  if (($this-&gt;mirrorMargins) && ($tablestartpage == 'ODD') && (($this-&gt;page) % 2 == 0)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $x = $x + $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                  } elseif (($this-&gt;mirrorMargins) && ($tablestartpage == 'EVEN') && (($this-&gt;page) % 2 == 1)) { <span class="comment"><span class="comment"><span class="comment">// ODD</span></span></span>&nbsp;</div></li><li><div>                      $x = $x + $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Added to correct for Columns</span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                      if ($this-&gt;directionality == 'rtl') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $x -= ($this-&gt;CurrCol - $tablestartcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $x += ($this-&gt;CurrCol - $tablestartcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($colctr == 1) {&nbsp;</div></li><li><div>                      $x0 = $x;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF ITERATION</span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;iterationCounter) {&nbsp;</div></li><li><div>                      foreach ($tablehf['textbuffer'] AS $k =&gt; $t) {&nbsp;</div></li><li><div>                          if (!is_array($t[0]) && preg_match('/{iteration ([a-zA-Z0-9_]+)}/', $t[0], $m)) {&nbsp;</div></li><li><div>                              $vname = '__' . $m[1] . '_';&nbsp;</div></li><li><div>                              if (!isset($this-&gt;$vname)) {&nbsp;</div></li><li><div>                                  $this-&gt;$vname = 1;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;$vname++;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $tablehf['textbuffer'][$k][0] = preg_replace('/{iteration ' . $m[1] . '}/', $this-&gt;$vname, $tablehf['textbuffer'][$k][0]);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $w = $tablehf['w'];&nbsp;</div></li><li><div>                  $h = $tablehf['h'];&nbsp;</div></li><li><div>                  $va = $tablehf['va'];&nbsp;</div></li><li><div>                  $R = $tablehf['R'];&nbsp;</div></li><li><div>                  $direction = $tablehf['direction'];&nbsp;</div></li><li><div>                  $mih = $tablehf['mih'];&nbsp;</div></li><li><div>                  $border = $tablehf['border'];&nbsp;</div></li><li><div>                  $border_details = $tablehf['border_details'];&nbsp;</div></li><li><div>                  $padding = $tablehf['padding'];&nbsp;</div></li><li><div>                  $this-&gt;tabletheadjustfinished = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $textbuffer = $tablehf['textbuffer'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Align</span>&nbsp;</div></li><li><div>                  $align = $tablehf['a'];&nbsp;</div></li><li><div>                  $this-&gt;cellTextAlign = $align;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $this-&gt;cellLineHeight = $tablehf['cellLineHeight'];&nbsp;</div></li><li><div>                  $this-&gt;cellLineStackingStrategy = $tablehf['cellLineStackingStrategy'];&nbsp;</div></li><li><div>                  $this-&gt;cellLineStackingShift = $tablehf['cellLineStackingShift'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $this-&gt;x = $x;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                      if ($table['borders_separate']) {&nbsp;</div></li><li><div>                          $tablefill = isset($table['bgcolor'][-1]) ? $table['bgcolor'][-1] : 0;&nbsp;</div></li><li><div>                          if ($tablefill) {&nbsp;</div></li><li><div>                              $color = $this-&gt;ConvertColor($tablefill);&nbsp;</div></li><li><div>                              if ($color) {&nbsp;</div></li><li><div>                                  $xadj = ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $yadj = ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                  $wadj = $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $hadj = $table['border_spacing_V'];&nbsp;</div></li><li><div>                                  if ($i == $firstrow && $horf == 'H') {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span>&nbsp;</div></li><li><div>                                      $yadj += $table['padding']['T'] + $table['border_details']['T']['w'];&nbsp;</div></li><li><div>                                      $hadj += $table['padding']['T'] + $table['border_details']['T']['w'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if (($i == ($lastrow) || (isset($tablehf['rowspan']) && ($i + $tablehf['rowspan']) == ($lastrow + 1)) || (!isset($tablehf['rowspan']) && ($i + 1) == ($lastrow + 1))) && $horf == 'F') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>                                      $hadj += $table['padding']['B'] + $table['border_details']['B']['w'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($colctr == 1) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span>&nbsp;</div></li><li><div>                                      $xadj += $table['padding']['L'] + $table['border_details']['L']['w'];&nbsp;</div></li><li><div>                                      $wadj += $table['padding']['L'] + $table['border_details']['L']['w'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($colctr == count($content[$i])) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span>&nbsp;</div></li><li><div>                                      $wadj += $table['padding']['R'] + $table['border_details']['R']['w'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;SetFColor($color);&nbsp;</div></li><li><div>                                  $this-&gt;Rect($x - $xadj, $y - $yadj, $w + $wadj, $h + $hadj, 'F');&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($table['empty_cells'] != 'hide' || !empty($textbuffer) || !$table['borders_separate']) {&nbsp;</div></li><li><div>                      $paintcell = true;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $paintcell = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Vertical align</span>&nbsp;</div></li><li><div>                  if ($R && INTVAL($R) &gt; 0 && isset($va) && $va != 'B') {&nbsp;</div></li><li><div>                      $va = 'B';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (!isset($va) || empty($va) || $va == 'M')&nbsp;</div></li><li><div>                      $this-&gt;y += ($h - $mih) / 2;&nbsp;</div></li><li><div>                  elseif (isset($va) && $va == 'B')&nbsp;</div></li><li><div>                      $this-&gt;y += $h - $mih;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//TABLE ROW OR CELL FILL BGCOLOR</span></span>&nbsp;</div></li><li><div>                  $fill = 0;&nbsp;</div></li><li><div>                  if (isset($tablehf['bgcolor']) && $tablehf['bgcolor'] && $tablehf['bgcolor'] != 'transparent') {&nbsp;</div></li><li><div>                      $fill = $tablehf['bgcolor'];&nbsp;</div></li><li><div>                      $leveladj = 6;&nbsp;</div></li><li><div>                  } elseif (isset($content[$i][0]['trbgcolor']) && $content[$i][0]['trbgcolor'] && $content[$i][0]['trbgcolor'] != 'transparent') { <span class="comment"><span class="comment">// Row color</span></span>&nbsp;</div></li><li><div>                      $fill = $content[$i][0]['trbgcolor'];&nbsp;</div></li><li><div>                      $leveladj = 3;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($fill && $paintcell) {&nbsp;</div></li><li><div>                      $color = $this-&gt;ConvertColor($fill);&nbsp;</div></li><li><div>                      if ($color) {&nbsp;</div></li><li><div>                          if ($table['borders_separate']) {&nbsp;</div></li><li><div>                              if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                                  $this-&gt;SetFColor($color);&nbsp;</div></li><li><div>                                  $this-&gt;Rect($x + ($table['border_spacing_H'] / 2), $y + ($table['border_spacing_V'] / 2), $w - $table['border_spacing_H'], $h - $table['border_spacing_V'], 'F');&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + $leveladj][] = array('gradient' =&gt; false, 'x' =&gt; ($x + ($table['border_spacing_H'] / 2)), 'y' =&gt; ($y + ($table['border_spacing_V'] / 2)), 'w' =&gt; ($w - $table['border_spacing_H']), 'h' =&gt; ($h - $table['border_spacing_V']), 'col' =&gt; $color);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                                  $this-&gt;SetFColor($color);&nbsp;</div></li><li><div>                                  $this-&gt;Rect($x, $y, $w, $h, 'F');&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + $leveladj][] = array('gradient' =&gt; false, 'x' =&gt; $x, 'y' =&gt; $y, 'w' =&gt; $w, 'h' =&gt; $h, 'col' =&gt; $color);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($tablehf['gradient']) && $tablehf['gradient'] && $paintcell) {&nbsp;</div></li><li><div>                      $g = $this-&gt;grad-&gt;parseBackgroundGradient($tablehf['gradient']);&nbsp;</div></li><li><div>                      if ($g) {&nbsp;</div></li><li><div>                          if ($table['borders_separate']) {&nbsp;</div></li><li><div>                              $px = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                              $py = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                              $pw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                              $ph = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $px = $x;&nbsp;</div></li><li><div>                              $py = $y;&nbsp;</div></li><li><div>                              $pw = $w;&nbsp;</div></li><li><div>                              $ph = $h;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                              $this-&gt;grad-&gt;Gradient($px, $py, $pw, $ph, $g['type'], $g['stops'], $g['colorspace'], $g['coords'], $g['extend']);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;tableBackgrounds[$level * 9 + 7][] = array('gradient' =&gt; true, 'x' =&gt; $px, 'y' =&gt; $py, 'w' =&gt; $pw, 'h' =&gt; $ph, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($tablehf['background-image']) && $paintcell) {&nbsp;</div></li><li><div>                      if ($tablehf['background-image']['gradient'] && preg_match('/(-moz-)*(repeating-)*(linear|radial)-gradient/', $tablehf['background-image']['gradient'])) {&nbsp;</div></li><li><div>                          $g = $this-&gt;grad-&gt;parseMozGradient($tablehf['background-image']['gradient']);&nbsp;</div></li><li><div>                          if ($g) {&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $px = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $py = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                  $pw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $ph = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $px = $x;&nbsp;</div></li><li><div>                                  $py = $y;&nbsp;</div></li><li><div>                                  $pw = $w;&nbsp;</div></li><li><div>                                  $ph = $h;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                                  $this-&gt;grad-&gt;Gradient($px, $py, $pw, $ph, $g['type'], $g['stops'], $g['colorspace'], $g['coords'], $g['extend']);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 7][] = array('gradient' =&gt; true, 'x' =&gt; $px, 'y' =&gt; $py, 'w' =&gt; $pw, 'h' =&gt; $ph, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif ($tablehf['background-image']['image_id']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Background pattern</span></span></span></span>&nbsp;</div></li><li><div>                          $n = count($this-&gt;patterns) + 1;&nbsp;</div></li><li><div>                          if ($table['borders_separate']) {&nbsp;</div></li><li><div>                              $px = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                              $py = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                              $pw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                              $ph = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $px = $x;&nbsp;</div></li><li><div>                              $py = $y;&nbsp;</div></li><li><div>                              $pw = $w;&nbsp;</div></li><li><div>                              $ph = $h;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                              list($orig_w, $orig_h, $x_repeat, $y_repeat) = $this-&gt;_resizeBackgroundImage($tablehf['background-image']['orig_w'], $tablehf['background-image']['orig_h'], $pw, $ph, $tablehf['background-image']['resize'], $tablehf['background-image']['x_repeat'], $tablehf['background-image']['y_repeat']);&nbsp;</div></li><li><div>                              $this-&gt;patterns[$n] = array('x' =&gt; $px, 'y' =&gt; $py, 'w' =&gt; $pw, 'h' =&gt; $ph, 'pgh' =&gt; $this-&gt;h, 'image_id' =&gt; $tablehf['background-image']['image_id'], 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $tablehf['background-image']['x_pos'], 'y_pos' =&gt; $tablehf['background-image']['y_pos'], 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'itype' =&gt; $tablehf['background-image']['itype']);&nbsp;</div></li><li><div>                              if ($tablehf['background-image']['opacity'] &gt; 0 && $tablehf['background-image']['opacity'] &lt; 1) {&nbsp;</div></li><li><div>                                  $opac = $this-&gt;SetAlpha($tablehf['background-image']['opacity'], 'Normal', true);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $opac = '';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $this-&gt;_out(sprintf('q /Pattern cs /P%d scn %s %.3F %.3F %.3F %.3F re f Q', $n, $opac, $px * _MPDFK, ($this-&gt;h - $py) * _MPDFK, $pw * _MPDFK, -$ph * _MPDFK));&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;tableBackgrounds[$level * 9 + 8][] = array('x' =&gt; $px, 'y' =&gt; $py, 'w' =&gt; $pw, 'h' =&gt; $ph, 'image_id' =&gt; $tablehf['background-image']['image_id'], 'orig_w' =&gt; $tablehf['background-image']['orig_w'], 'orig_h' =&gt; $tablehf['background-image']['orig_h'], 'x_pos' =&gt; $tablehf['background-image']['x_pos'], 'y_pos' =&gt; $tablehf['background-image']['y_pos'], 'x_repeat' =&gt; $tablehf['background-image']['x_repeat'], 'y_repeat' =&gt; $tablehf['background-image']['y_repeat'], 'clippath' =&gt; '', 'resize' =&gt; $tablehf['background-image']['resize'], 'opacity' =&gt; $tablehf['background-image']['opacity'], 'itype' =&gt; $tablehf['background-image']['itype']);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Cell Border</span>&nbsp;</div></li><li><div>                  if ($table['borders_separate'] && $paintcell && $border) {&nbsp;</div></li><li><div>                      $this-&gt;_tableRect($x + ($table['border_spacing_H'] / 2) + ($border_details['L']['w'] / 2), $y + ($table['border_spacing_V'] / 2) + ($border_details['T']['w'] / 2), $w - $table['border_spacing_H'] - ($border_details['L']['w'] / 2) - ($border_details['R']['w'] / 2), $h - $table['border_spacing_V'] - ($border_details['T']['w'] / 2) - ($border_details['B']['w'] / 2), $border, $border_details, false, $table['borders_separate']);&nbsp;</div></li><li><div>                  } elseif ($paintcell && $border) {&nbsp;</div></li><li><div>                      $this-&gt;_tableRect($x, $y, $w, $h, $border, $border_details, true, $table['borders_separate']);   <span class="comment"><span class="comment">// true causes buffer</span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Print cell content</span>&nbsp;</div></li><li><div>                  if (!empty($textbuffer)) {&nbsp;</div></li><li><div>                      if ($horf == 'F' && preg_match('/{colsum([0-9]*)[_]*}/', $textbuffer[0][0], $m)) {&nbsp;</div></li><li><div>                          $rep = sprintf(&quot;%01.&quot; . intval($m[1]) . &quot;f&quot;, $this-&gt;colsums[$colctr - 1]);&nbsp;</div></li><li><div>                          $textbuffer[0][0] = preg_replace('/{colsum[0-9_]*}/', $rep, $textbuffer[0][0]);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($R) {&nbsp;</div></li><li><div>                          $cellPtSize = $textbuffer[0][11] / $this-&gt;shrin_k;&nbsp;</div></li><li><div>                          if (!$cellPtSize) {&nbsp;</div></li><li><div>                              $cellPtSize = $this-&gt;default_font_size;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $cellFontHeight = ($cellPtSize / _MPDFK);&nbsp;</div></li><li><div>                          $opx = $this-&gt;x;&nbsp;</div></li><li><div>                          $opy = $this-&gt;y;&nbsp;</div></li><li><div>                          $angle = INTVAL($R);&nbsp;</div></li><li><div>                          <span class="comment">// Only allow 45 - 90 degrees (when bottom-aligned) or -90</span>&nbsp;</div></li><li><div>                          if ($angle &gt; 90) {&nbsp;</div></li><li><div>                              $angle = 90;&nbsp;</div></li><li><div>                          } elseif ($angle &gt; 0 && (isset($va) && $va != 'B')) {&nbsp;</div></li><li><div>                              $angle = 90;&nbsp;</div></li><li><div>                          } elseif ($angle &gt; 0 && $angle &lt; 45) {&nbsp;</div></li><li><div>                              $angle = 45;&nbsp;</div></li><li><div>                          } elseif ($angle &lt; 0) {&nbsp;</div></li><li><div>                              $angle = -90;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $offset = ((sin(deg2rad($angle))) * 0.37 * $cellFontHeight);&nbsp;</div></li><li><div>                          if (isset($align) && $align == 'R') {&nbsp;</div></li><li><div>                              $this-&gt;x += ($w) + ($offset) - ($cellFontHeight / 3) - ($padding['R'] + $border_details['R']['w']);&nbsp;</div></li><li><div>                          } elseif (!isset($align) || $align == 'C') {&nbsp;</div></li><li><div>                              $this-&gt;x += ($w / 2) + ($offset);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;x += ($offset) + ($cellFontHeight / 3) + ($padding['L'] + $border_details['L']['w']);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $str = '';&nbsp;</div></li><li><div>                          foreach ($tablehf['textbuffer'] AS $t) {&nbsp;</div></li><li><div>                              $str .= $t[0] . ' ';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $str = rtrim($str);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if (!isset($va) || $va == 'M') {&nbsp;</div></li><li><div>                              $this-&gt;y -= ($h - $mih) / 2; <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Undo what was added earlier VERTICAL ALIGN</span></span></span></span>&nbsp;</div></li><li><div>                              if ($angle &gt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += (($h - $mih) / 2) + ($padding['T'] + $border_details['T']['w']) + ($mih - ($padding['T'] + $border_details['T']['w'] + $border_details['B']['w'] + $padding['B']));&nbsp;</div></li><li><div>                              } elseif ($angle &lt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += (($h - $mih) / 2) + ($padding['T'] + $border_details['T']['w']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } elseif (isset($va) && $va == 'B') {&nbsp;</div></li><li><div>                              $this-&gt;y -= $h - $mih; <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Undo what was added earlier VERTICAL ALIGN</span></span></span></span>&nbsp;</div></li><li><div>                              if ($angle &gt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += $h - ($border_details['B']['w'] + $padding['B']);&nbsp;</div></li><li><div>                              } elseif ($angle &lt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += $h - $mih + ($padding['T'] + $border_details['T']['w']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } elseif (isset($va) && $va == 'T') {&nbsp;</div></li><li><div>                              if ($angle &gt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += $mih - ($border_details['B']['w'] + $padding['B']);&nbsp;</div></li><li><div>                              } elseif ($angle &lt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += ($padding['T'] + $border_details['T']['w']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $this-&gt;Rotate($angle, $this-&gt;x, $this-&gt;y);&nbsp;</div></li><li><div>                          $s_fs = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>                          $s_f = $this-&gt;FontFamily;&nbsp;</div></li><li><div>                          $s_st = $this-&gt;FontStyle;&nbsp;</div></li><li><div>                          if (!empty($textbuffer[0][3])) { <span class="comment"><span class="comment"><span class="comment">//Font Color</span></span></span>&nbsp;</div></li><li><div>                              $cor = $textbuffer[0][3];&nbsp;</div></li><li><div>                              $this-&gt;SetTColor($cor);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;SetFont($textbuffer[0][4], $textbuffer[0][2], $cellPtSize, true, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $this-&gt;magic_reverse_dir($str, $this-&gt;directionality, $textbuffer[0][18]);&nbsp;</div></li><li><div>                          $this-&gt;Text($this-&gt;x, $this-&gt;y, $str, $textbuffer[0][18], $textbuffer[0][8]); <span class="comment"><span class="comment">// textvar</span></span>&nbsp;</div></li><li><div>                          $this-&gt;Rotate(0);&nbsp;</div></li><li><div>                          $this-&gt;SetFont($s_f, $s_st, $s_fs, true, true);&nbsp;</div></li><li><div>                          $this-&gt;SetTColor(0);&nbsp;</div></li><li><div>                          $this-&gt;x = $opx;&nbsp;</div></li><li><div>                          $this-&gt;y = $opy;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          if ($table['borders_separate']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// NB twice border width</span></span></span></span></span></span>&nbsp;</div></li><li><div>                              $xadj = $border_details['L']['w'] + $padding['L'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                              $wadj = $border_details['L']['w'] + $border_details['R']['w'] + $padding['L'] + $padding['R'] + $table['border_spacing_H'];&nbsp;</div></li><li><div>                              $yadj = $border_details['T']['w'] + $padding['T'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $xadj = $border_details['L']['w'] / 2 + $padding['L'];&nbsp;</div></li><li><div>                              $wadj = ($border_details['L']['w'] + $border_details['R']['w']) / 2 + $padding['L'] + $padding['R'];&nbsp;</div></li><li><div>                              $yadj = $border_details['T']['w'] / 2 + $padding['T'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $this-&gt;divwidth = $w - ($wadj);&nbsp;</div></li><li><div>                          $this-&gt;x += $xadj;&nbsp;</div></li><li><div>                          $this-&gt;y += $yadj;&nbsp;</div></li><li><div>                          $this-&gt;printbuffer($textbuffer, '', true, false, $direction);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $textbuffer = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (!$this-&gt;ColActive) {&nbsp;</div></li><li><div>                      if (isset($content[$i][0]['trgradients']) && ($colctr == 1 || $table['borders_separate'])) {&nbsp;</div></li><li><div>                          $g = $this-&gt;grad-&gt;parseBackgroundGradient($content[$i][0]['trgradients']);&nbsp;</div></li><li><div>                          if ($g) {&nbsp;</div></li><li><div>                              $gx = $x0;&nbsp;</div></li><li><div>                              $gy = $y;&nbsp;</div></li><li><div>                              $gh = $h;&nbsp;</div></li><li><div>                              $gw = $table['w'] - ($table['max_cell_border_width']['L'] / 2) - ($table['max_cell_border_width']['R'] / 2) - $table['margin']['L'] - $table['margin']['R'];&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $gw -= ($table['padding']['L'] + $table['border_details']['L']['w'] + $table['padding']['R'] + $table['border_details']['R']['w'] + $table['border_spacing_H']);&nbsp;</div></li><li><div>                                  $clx = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $cly = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                  $clw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $clh = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set clipping path</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  $s = $this-&gt;_setClippingPath($clx, $cly, $clw, $clh); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 4][] = array('gradient' =&gt; true, 'x' =&gt; $gx + ($table['border_spacing_H'] / 2), 'y' =&gt; $gy + ($table['border_spacing_V'] / 2), 'w' =&gt; $gw - $table['border_spacing_V'], 'h' =&gt; $gh - $table['border_spacing_H'], 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; $s);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 4][] = array('gradient' =&gt; true, 'x' =&gt; $gx, 'y' =&gt; $gy, 'w' =&gt; $gw, 'h' =&gt; $gh, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (isset($content[$i][0]['trbackground-images']) && ($colctr == 1 || $table['borders_separate'])) {&nbsp;</div></li><li><div>                          if ($content[$i][0]['trbackground-images']['gradient'] && preg_match('/(-moz-)*(repeating-)*(linear|radial)-gradient/', $content[$i][0]['trbackground-images']['gradient'])) {&nbsp;</div></li><li><div>                              $g = $this-&gt;grad-&gt;parseMozGradient($content[$i][0]['trbackground-images']['gradient']);&nbsp;</div></li><li><div>                              if ($g) {&nbsp;</div></li><li><div>                                  $gx = $x0;&nbsp;</div></li><li><div>                                  $gy = $y;&nbsp;</div></li><li><div>                                  $gh = $h;&nbsp;</div></li><li><div>                                  $gw = $table['w'] - ($table['max_cell_border_width']['L'] / 2) - ($table['max_cell_border_width']['R'] / 2) - $table['margin']['L'] - $table['margin']['R'];&nbsp;</div></li><li><div>                                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                      $gw -= ($table['padding']['L'] + $table['border_details']['L']['w'] + $table['padding']['R'] + $table['border_details']['R']['w'] + $table['border_spacing_H']);&nbsp;</div></li><li><div>                                      $clx = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                      $cly = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                      $clw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                                      $clh = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set clipping path</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                      $s = $this-&gt;_setClippingPath($clx, $cly, $clw, $clh); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                      $this-&gt;tableBackgrounds[$level * 9 + 4][] = array('gradient' =&gt; true, 'x' =&gt; $gx + ($table['border_spacing_H'] / 2), 'y' =&gt; $gy + ($table['border_spacing_V'] / 2), 'w' =&gt; $gw - $table['border_spacing_V'], 'h' =&gt; $gh - $table['border_spacing_H'], 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; $s);&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $this-&gt;tableBackgrounds[$level * 9 + 4][] = array('gradient' =&gt; true, 'x' =&gt; $gx, 'y' =&gt; $gy, 'w' =&gt; $gw, 'h' =&gt; $gh, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $image_id = $content[$i][0]['trbackground-images']['image_id'];&nbsp;</div></li><li><div>                              $orig_w = $content[$i][0]['trbackground-images']['orig_w'];&nbsp;</div></li><li><div>                              $orig_h = $content[$i][0]['trbackground-images']['orig_h'];&nbsp;</div></li><li><div>                              $x_pos = $content[$i][0]['trbackground-images']['x_pos'];&nbsp;</div></li><li><div>                              $y_pos = $content[$i][0]['trbackground-images']['y_pos'];&nbsp;</div></li><li><div>                              $x_repeat = $content[$i][0]['trbackground-images']['x_repeat'];&nbsp;</div></li><li><div>                              $y_repeat = $content[$i][0]['trbackground-images']['y_repeat'];&nbsp;</div></li><li><div>                              $resize = $content[$i][0]['trbackground-images']['resize'];&nbsp;</div></li><li><div>                              $opacity = $content[$i][0]['trbackground-images']['opacity'];&nbsp;</div></li><li><div>                              $itype = $content[$i][0]['trbackground-images']['itype'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              $clippath = '';&nbsp;</div></li><li><div>                              $gx = $x0;&nbsp;</div></li><li><div>                              $gy = $y;&nbsp;</div></li><li><div>                              $gh = $h;&nbsp;</div></li><li><div>                              $gw = $table['w'] - ($table['max_cell_border_width']['L'] / 2) - ($table['max_cell_border_width']['R'] / 2) - $table['margin']['L'] - $table['margin']['R'];&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $gw -= ($table['padding']['L'] + $table['border_details']['L']['w'] + $table['padding']['R'] + $table['border_details']['R']['w'] + $table['border_spacing_H']);&nbsp;</div></li><li><div>                                  $clx = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $cly = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                  $clw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $clh = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set clipping path</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  $s = $this-&gt;_setClippingPath($clx, $cly, $clw, $clh); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 5][] = array('x' =&gt; $gx + ($table['border_spacing_H'] / 2), 'y' =&gt; $gy + ($table['border_spacing_V'] / 2), 'w' =&gt; $gw - $table['border_spacing_V'], 'h' =&gt; $gh - $table['border_spacing_H'], 'image_id' =&gt; $image_id, 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $x_pos, 'y_pos' =&gt; $y_pos, 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'clippath' =&gt; $s, 'resize' =&gt; $resize, 'opacity' =&gt; $opacity, 'itype' =&gt; $itype);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 5][] = array('x' =&gt; $gx, 'y' =&gt; $gy, 'w' =&gt; $gw, 'h' =&gt; $gh, 'image_id' =&gt; $image_id, 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $x_pos, 'y_pos' =&gt; $y_pos, 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'clippath' =&gt; '', 'resize' =&gt; $resize, 'opacity' =&gt; $opacity, 'itype' =&gt; $itype);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// TABLE</span></span> BORDER - if separate OR collapsed and only table border&nbsp;</div></li><li><div>                  if (($table['borders_separate'] || ($this-&gt;simpleTables && !$table['simple']['border'])) && $table['border']) {&nbsp;</div></li><li><div>                      $halfspaceL = $table['padding']['L'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                      $halfspaceR = $table['padding']['R'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                      $halfspaceT = $table['padding']['T'] + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                      $halfspaceB = $table['padding']['B'] + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                      $tbx = $x;&nbsp;</div></li><li><div>                      $tby = $y;&nbsp;</div></li><li><div>                      $tbw = $w;&nbsp;</div></li><li><div>                      $tbh = $h;&nbsp;</div></li><li><div>                      $tab_bord = 0;&nbsp;</div></li><li><div>                      $corner = '';&nbsp;</div></li><li><div>                      if ($i == $firstrow && $horf == 'H') {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span>&nbsp;</div></li><li><div>                          $tby -= $halfspaceT + ($table['border_details']['T']['w'] / 2);&nbsp;</div></li><li><div>                          $tbh += $halfspaceT + ($table['border_details']['T']['w'] / 2);&nbsp;</div></li><li><div>                          $this-&gt;setBorder($tab_bord, _BORDER_TOP);&nbsp;</div></li><li><div>                          $corner .= 'T';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (($i == ($lastrow) || (isset($tablehf['rowspan']) && ($i + $tablehf['rowspan']) == ($lastrow + 1))) && $horf == 'F') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $tbh += $halfspaceB + ($table['border_details']['B']['w'] / 2);&nbsp;</div></li><li><div>                          $this-&gt;setBorder($tab_bord, _BORDER_BOTTOM);&nbsp;</div></li><li><div>                          $corner .= 'B';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($colctr == 1 && $firstSpread) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span>&nbsp;</div></li><li><div>                          $tbx -= $halfspaceL + ($table['border_details']['L']['w'] / 2);&nbsp;</div></li><li><div>                          $tbw += $halfspaceL + ($table['border_details']['L']['w'] / 2);&nbsp;</div></li><li><div>                          $this-&gt;setBorder($tab_bord, _BORDER_LEFT);&nbsp;</div></li><li><div>                          $corner .= 'L';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($colctr == count($content[$i]) && $finalSpread) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span>&nbsp;</div></li><li><div>                          $tbw += $halfspaceR + ($table['border_details']['R']['w'] / 2);&nbsp;</div></li><li><div>                          $this-&gt;setBorder($tab_bord, _BORDER_RIGHT);&nbsp;</div></li><li><div>                          $corner .= 'R';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;_tableRect($tbx, $tby, $tbw, $tbh, $tab_bord, $table['border_details'], false, $table['borders_separate'], 'table', $corner, $table['border_spacing_V'], $table['border_spacing_H']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }<span class="comment">// end column $content</span>&nbsp;</div></li><li><div>              $this-&gt;y = $y + $h; <span class="comment">//Update y coordinate</span>&nbsp;</div></li><li><div>          }<span class="comment">// end row $i</span>&nbsp;</div></li><li><div>          unset($table);&nbsp;</div></li><li><div>          $this-&gt;colsums = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetHTMLHeader($header = '', $OE = '', $write = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $height = 0;&nbsp;</div></li><li><div>      if (is_array($header) && isset($header['html']) && $header['html']) {&nbsp;</div></li><li><div>          $Hhtml = $header['html'];&nbsp;</div></li><li><div>          if ($this-&gt;setAutoTopMargin) {&nbsp;</div></li><li><div>              if (isset($header['h'])) {&nbsp;</div></li><li><div>                  $height = $header['h'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $height = $this-&gt;_gethtmlheight($Hhtml);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (!is_array($header) && $header) {&nbsp;</div></li><li><div>          $Hhtml = $header;&nbsp;</div></li><li><div>          if ($this-&gt;setAutoTopMargin) {&nbsp;</div></li><li><div>              $height = $this-&gt;_gethtmlheight($Hhtml);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $Hhtml = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($OE != 'E') {&nbsp;</div></li><li><div>          $OE = 'O';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($OE == 'E') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($Hhtml) {&nbsp;</div></li><li><div>              if (empty($this-&gt;HTMLHeaderE)) $this-&gt;HTMLHeaderE = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLHeaderE['html'] = $Hhtml;&nbsp;</div></li><li><div>              $this-&gt;HTMLHeaderE['h'] = $height;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;HTMLHeaderE = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($Hhtml) {&nbsp;</div></li><li><div>              if (empty($this-&gt;HTMLHeader)) $this-&gt;HTMLHeader = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLHeader['html'] = $Hhtml;&nbsp;</div></li><li><div>              $this-&gt;HTMLHeader['h'] = $height;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;HTMLHeader = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;mirrorMargins && $OE == 'E') {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($Hhtml == '') {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;setAutoTopMargin == 'pad') {&nbsp;</div></li><li><div>          $this-&gt;tMargin = $this-&gt;margin_header + $height + $this-&gt;orig_tMargin;&nbsp;</div></li><li><div>          if (isset($this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mt'])) {&nbsp;</div></li><li><div>              $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mt'] = $this-&gt;tMargin;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($this-&gt;setAutoTopMargin == 'stretch') {&nbsp;</div></li><li><div>          $this-&gt;tMargin = max($this-&gt;orig_tMargin, $this-&gt;margin_header + $height + $this-&gt;autoMarginPadding);&nbsp;</div></li><li><div>          if (isset($this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mt'])) {&nbsp;</div></li><li><div>              $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mt'] = $this-&gt;tMargin;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($write && $this-&gt;state != 0 && (($this-&gt;mirrorMargins && $OE == 'E' && ($this-&gt;page) % 2 == 0) || ($this-&gt;mirrorMargins && $OE != 'E' && ($this-&gt;page) % 2 == 1) || !$this-&gt;mirrorMargins)) {&nbsp;</div></li><li><div>          $this-&gt;writeHTMLHeaders();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetHTMLFooter($footer = '', $OE = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $height = 0;&nbsp;</div></li><li><div>      if (is_array($footer) && isset($footer['html']) && $footer['html']) {&nbsp;</div></li><li><div>          $Fhtml = $footer['html'];&nbsp;</div></li><li><div>          if ($this-&gt;setAutoBottomMargin) {&nbsp;</div></li><li><div>              if (isset($footer['h'])) {&nbsp;</div></li><li><div>                  $height = $footer['h'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $height = $this-&gt;_gethtmlheight($Fhtml);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (!is_array($footer) && $footer) {&nbsp;</div></li><li><div>          $Fhtml = $footer;&nbsp;</div></li><li><div>          if ($this-&gt;setAutoBottomMargin) {&nbsp;</div></li><li><div>              $height = $this-&gt;_gethtmlheight($Fhtml);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $Fhtml = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($OE != 'E') {&nbsp;</div></li><li><div>          $OE = 'O';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($OE == 'E') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($Fhtml) {&nbsp;</div></li><li><div>              $this-&gt;HTMLFooterE['html'] = $Fhtml;&nbsp;</div></li><li><div>              $this-&gt;HTMLFooterE['h'] = $height;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;HTMLFooterE = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($Fhtml) {&nbsp;</div></li><li><div>              $this-&gt;HTMLFooter['html'] = $Fhtml;&nbsp;</div></li><li><div>              $this-&gt;HTMLFooter['h'] = $height;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;HTMLFooter = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;mirrorMargins && $OE == 'E') {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($Fhtml == '') {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;setAutoBottomMargin == 'pad') {&nbsp;</div></li><li><div>          $this-&gt;bMargin = $this-&gt;margin_footer + $height + $this-&gt;orig_bMargin;&nbsp;</div></li><li><div>          $this-&gt;PageBreakTrigger = $this-&gt;h - $this-&gt;bMargin;&nbsp;</div></li><li><div>          if (isset($this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mb'])) {&nbsp;</div></li><li><div>              $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mb'] = $this-&gt;bMargin;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($this-&gt;setAutoBottomMargin == 'stretch') {&nbsp;</div></li><li><div>          $this-&gt;bMargin = max($this-&gt;orig_bMargin, $this-&gt;margin_footer + $height + $this-&gt;autoMarginPadding);&nbsp;</div></li><li><div>          $this-&gt;PageBreakTrigger = $this-&gt;h - $this-&gt;bMargin;&nbsp;</div></li><li><div>          if (isset($this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mb'])) {&nbsp;</div></li><li><div>              $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mb'] = $this-&gt;bMargin;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _getHtmlHeight($html)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $save_state = $this-&gt;state;&nbsp;</div></li><li><div>      if ($this-&gt;state == 0) {&nbsp;</div></li><li><div>          $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;state = 2;&nbsp;</div></li><li><div>      $this-&gt;Reset();&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>      $save_x = $this-&gt;x;&nbsp;</div></li><li><div>      $save_y = $this-&gt;y;&nbsp;</div></li><li><div>      $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>      $this-&gt;y = $this-&gt;margin_header;&nbsp;</div></li><li><div>      $html = str_replace('{PAGENO}', $this-&gt;pagenumPrefix . $this-&gt;docPageNum($this-&gt;page) . $this-&gt;pagenumSuffix, $html);&nbsp;</div></li><li><div>      $html = str_replace($this-&gt;aliasNbPgGp, $this-&gt;nbpgPrefix . $this-&gt;docPageNumTotal($this-&gt;page) . $this-&gt;nbpgSuffix, $html);&nbsp;</div></li><li><div>      $html = str_replace($this-&gt;aliasNbPg, $this-&gt;page, $html);&nbsp;</div></li><li><div>      $html = preg_replace_callback('/\{DATE\s+(.*?)\}/', array($this, 'date_callback'), $html); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageLinks = array();&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageAnnots = array();&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageForms = array();&nbsp;</div></li><li><div>      $savepb = $this-&gt;pageBackgrounds;&nbsp;</div></li><li><div>      $this-&gt;writingHTMLheader = true;&nbsp;</div></li><li><div>      $this-&gt;WriteHTML($html, 4); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// parameter 4 saves output to $this-&gt;headerbuffer</span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;writingHTMLheader = false;&nbsp;</div></li><li><div>      $h = ($this-&gt;y - $this-&gt;margin_header);&nbsp;</div></li><li><div>      $this-&gt;Reset();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span> - Clear in case Float used in Header/Footer&nbsp;</div></li><li><div>      $this-&gt;blk[0]['blockContext'] = 0;&nbsp;</div></li><li><div>      $this-&gt;blk[0]['float_endpos'] = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>      $this-&gt;headerbuffer = '';&nbsp;</div></li><li><div>      $this-&gt;pageBackgrounds = $savepb;&nbsp;</div></li><li><div>      $this-&gt;x = $save_x;&nbsp;</div></li><li><div>      $this-&gt;y = $save_y;&nbsp;</div></li><li><div>      $this-&gt;state = $save_state;&nbsp;</div></li><li><div>      if ($save_state == 0) {&nbsp;</div></li><li><div>          unset($this-&gt;pages[1]);&nbsp;</div></li><li><div>          $this-&gt;page = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $h;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Called internally from Header</span>&nbsp;</div></li><li><div>  function writeHTMLHeaders()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;mirrorMargins && ($this-&gt;page) % 2 == 0) {&nbsp;</div></li><li><div>          $OE = 'E';&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $OE = 'O';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($OE == 'E') {&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['html'] = $this-&gt;HTMLHeaderE['html'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['html'] = $this-&gt;HTMLHeader['html'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;forcePortraitHeaders && $this-&gt;CurOrientation == 'L' && $this-&gt;CurOrientation != $this-&gt;DefOrientation) {&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['rotate'] = true;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['ml'] = $this-&gt;tMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mr'] = $this-&gt;bMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mh'] = $this-&gt;margin_header;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mf'] = $this-&gt;margin_footer;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['pw'] = $this-&gt;h;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['ph'] = $this-&gt;w;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['ml'] = $this-&gt;lMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mr'] = $this-&gt;rMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mh'] = $this-&gt;margin_header;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['mf'] = $this-&gt;margin_footer;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['pw'] = $this-&gt;w;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader[$this-&gt;page][$OE]['ph'] = $this-&gt;h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function writeHTMLFooters()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;mirrorMargins && ($this-&gt;page) % 2 == 0) {&nbsp;</div></li><li><div>          $OE = 'E';&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $OE = 'O';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($OE == 'E') {&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['html'] = $this-&gt;HTMLFooterE['html'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['html'] = $this-&gt;HTMLFooter['html'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;forcePortraitHeaders && $this-&gt;CurOrientation == 'L' && $this-&gt;CurOrientation != $this-&gt;DefOrientation) {&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['rotate'] = true;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['ml'] = $this-&gt;tMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mr'] = $this-&gt;bMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mt'] = $this-&gt;rMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mb'] = $this-&gt;lMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mh'] = $this-&gt;margin_header;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mf'] = $this-&gt;margin_footer;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['pw'] = $this-&gt;h;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['ph'] = $this-&gt;w;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['ml'] = $this-&gt;lMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mr'] = $this-&gt;rMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mt'] = $this-&gt;tMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mb'] = $this-&gt;bMargin;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mh'] = $this-&gt;margin_header;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['mf'] = $this-&gt;margin_footer;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['pw'] = $this-&gt;w;&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter[$this-&gt;page][$OE]['ph'] = $this-&gt;h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  function _shareHeaderFooterWidth($cl, $cc, $cr)&nbsp;</div></li><li><div>  { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $l = mb_strlen($cl, 'UTF-8');&nbsp;</div></li><li><div>      $c = mb_strlen($cc, 'UTF-8');&nbsp;</div></li><li><div>      $r = mb_strlen($cr, 'UTF-8');&nbsp;</div></li><li><div>      $s = max($l, $r);&nbsp;</div></li><li><div>      $tw = $c + 2 * $s;&nbsp;</div></li><li><div>      if ($tw &gt; 0) {&nbsp;</div></li><li><div>          return array(intval($s * 100 / $tw), intval($c * 100 / $tw), intval($s * 100 / $tw));&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return array(33, 33, 33);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment">// Create an HTML header/footer from array (non-HTML header/footer)</span>&nbsp;</div></li><li><div>  function _createHTMLheaderFooter($arr, $hf)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $lContent = (isset($arr['L']['content']) ? $arr['L']['content'] : '');&nbsp;</div></li><li><div>      $cContent = (isset($arr['C']['content']) ? $arr['C']['content'] : '');&nbsp;</div></li><li><div>      $rContent = (isset($arr['R']['content']) ? $arr['R']['content'] : '');&nbsp;</div></li><li><div>      list($lw, $cw, $rw) = $this-&gt;_shareHeaderFooterWidth($lContent, $cContent, $rContent);&nbsp;</div></li><li><div>      if ($hf == 'H') {&nbsp;</div></li><li><div>          $valign = 'bottom';&nbsp;</div></li><li><div>          $vpadding = '0 0 ' . $this-&gt;header_line_spacing . 'em 0';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $valign = 'top';&nbsp;</div></li><li><div>          $vpadding = '' . $this-&gt;footer_line_spacing . 'em 0 0 0';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;directionality == 'rtl') { <span class="comment">// table columns get reversed so need different text-alignment</span>&nbsp;</div></li><li><div>          $talignL = 'right';&nbsp;</div></li><li><div>          $talignR = 'left';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $talignL = 'left';&nbsp;</div></li><li><div>          $talignR = 'right';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html = '&lt;table width=&quot;100%&quot; style=&quot;border-collapse: collapse; margin: 0; vertical-align: ' . $valign . '; color: #000000; ';&nbsp;</div></li><li><div>      if (isset($arr['line']) && $arr['line']) {&nbsp;</div></li><li><div>          $html .= ' border-' . $valign . ': 0.1mm solid #000000;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= '&quot;&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;tr&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;td width=&quot;' . $lw . '%&quot; style=&quot;padding: ' . $vpadding . '; text-align: ' . $talignL . '; ';&nbsp;</div></li><li><div>      if (isset($arr['L']['font-family'])) {&nbsp;</div></li><li><div>          $html .= ' font-family: ' . $arr['L']['font-family'] . ';';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($arr['L']['color'])) {&nbsp;</div></li><li><div>          $html .= ' color: ' . $arr['L']['color'] . ';';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($arr['L']['font-size'])) {&nbsp;</div></li><li><div>          $html .= ' font-size: ' . $arr['L']['font-size'] . 'pt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($arr['L']['font-style'])) {&nbsp;</div></li><li><div>          if ($arr['L']['font-style'] == 'B' || $arr['L']['font-style'] == 'BI') {&nbsp;</div></li><li><div>              $html .= ' font-weight: bold;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($arr['L']['font-style'] == 'I' || $arr['L']['font-style'] == 'BI') {&nbsp;</div></li><li><div>              $html .= ' font-style: italic;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= '&quot;&gt;' . $lContent . '&lt;/td&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;td width=&quot;' . $cw . '%&quot; style=&quot;padding: ' . $vpadding . '; text-align: center; ';&nbsp;</div></li><li><div>      if (isset($arr['C']['font-family'])) {&nbsp;</div></li><li><div>          $html .= ' font-family: ' . $arr['C']['font-family'] . ';';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($arr['C']['color'])) {&nbsp;</div></li><li><div>          $html .= ' color: ' . $arr['C']['color'] . ';';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($arr['C']['font-size'])) {&nbsp;</div></li><li><div>          $html .= ' font-size: ' . $arr['L']['font-size'] . 'pt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($arr['C']['font-style'])) {&nbsp;</div></li><li><div>          if ($arr['C']['font-style'] == 'B' || $arr['C']['font-style'] == 'BI') {&nbsp;</div></li><li><div>              $html .= ' font-weight: bold;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($arr['C']['font-style'] == 'I' || $arr['C']['font-style'] == 'BI') {&nbsp;</div></li><li><div>              $html .= ' font-style: italic;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= '&quot;&gt;' . $cContent . '&lt;/td&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;td width=&quot;' . $rw . '%&quot; style=&quot;padding: ' . $vpadding . '; text-align: ' . $talignR . '; ';&nbsp;</div></li><li><div>      if (isset($arr['R']['font-family'])) {&nbsp;</div></li><li><div>          $html .= ' font-family: ' . $arr['R']['font-family'] . ';';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($arr['R']['color'])) {&nbsp;</div></li><li><div>          $html .= ' color: ' . $arr['R']['color'] . ';';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($arr['R']['font-size'])) {&nbsp;</div></li><li><div>          $html .= ' font-size: ' . $arr['R']['font-size'] . 'pt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($arr['R']['font-style'])) {&nbsp;</div></li><li><div>          if ($arr['R']['font-style'] == 'B' || $arr['R']['font-style'] == 'BI') {&nbsp;</div></li><li><div>              $html .= ' font-weight: bold;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($arr['R']['font-style'] == 'I' || $arr['R']['font-style'] == 'BI') {&nbsp;</div></li><li><div>              $html .= ' font-style: italic;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= '&quot;&gt;' . $rContent . '&lt;/td&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>      return $html;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function DefHeaderByName($name, $arr)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$name) {&nbsp;</div></li><li><div>          $name = '_nonhtmldefault';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html = $this-&gt;_createHTMLheaderFooter($arr, 'H');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageHTMLheaders[$name]['html'] = $html;&nbsp;</div></li><li><div>      $this-&gt;pageHTMLheaders[$name]['h'] = $this-&gt;_gethtmlheight($html);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function DefFooterByName($name, $arr)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$name) {&nbsp;</div></li><li><div>          $name = '_nonhtmldefault';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html = $this-&gt;_createHTMLheaderFooter($arr, 'F');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageHTMLfooters[$name]['html'] = $html;&nbsp;</div></li><li><div>      $this-&gt;pageHTMLfooters[$name]['h'] = $this-&gt;_gethtmlheight($html);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetHeaderByName($name, $side = 'O', $write = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$name) {&nbsp;</div></li><li><div>          $name = '_nonhtmldefault';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetHTMLHeader($this-&gt;pageHTMLheaders[$name], $side, $write);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetFooterByName($name, $side = 'O')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$name) {&nbsp;</div></li><li><div>          $name = '_nonhtmldefault';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetHTMLFooter($this-&gt;pageHTMLfooters[$name], $side);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function DefHTMLHeaderByName($name, $html)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$name) {&nbsp;</div></li><li><div>          $name = '_default';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageHTMLheaders[$name]['html'] = $html;&nbsp;</div></li><li><div>      $this-&gt;pageHTMLheaders[$name]['h'] = $this-&gt;_gethtmlheight($html);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function DefHTMLFooterByName($name, $html)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$name) {&nbsp;</div></li><li><div>          $name = '_default';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pageHTMLfooters[$name]['html'] = $html;&nbsp;</div></li><li><div>      $this-&gt;pageHTMLfooters[$name]['h'] = $this-&gt;_gethtmlheight($html);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetHTMLHeaderByName($name, $side = 'O', $write = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$name) {&nbsp;</div></li><li><div>          $name = '_default';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetHTMLHeader($this-&gt;pageHTMLheaders[$name], $side, $write);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetHTMLFooterByName($name, $side = 'O')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$name) {&nbsp;</div></li><li><div>          $name = '_default';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetHTMLFooter($this-&gt;pageHTMLfooters[$name], $side);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetHeader($Harray = array(), $side = '', $write = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $oddhtml = '';&nbsp;</div></li><li><div>      $evenhtml = '';&nbsp;</div></li><li><div>      if (is_string($Harray)) {&nbsp;</div></li><li><div>          if (strlen($Harray) == 0) {&nbsp;</div></li><li><div>              $oddhtml = '';&nbsp;</div></li><li><div>              $evenhtml = '';&nbsp;</div></li><li><div>          } elseif (strpos($Harray, '|') !== false) {&nbsp;</div></li><li><div>              $hdet = explode('|', $Harray);&nbsp;</div></li><li><div>              list($lw, $cw, $rw) = $this-&gt;_shareHeaderFooterWidth($hdet[0], $hdet[1], $hdet[2]);&nbsp;</div></li><li><div>              $oddhtml = '&lt;table width=&quot;100%&quot; style=&quot;border-collapse: collapse; margin: 0; vertical-align: bottom; color: #000000; ';&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderfontsize) {&nbsp;</div></li><li><div>                  $oddhtml .= ' font-size: ' . $this-&gt;defaultheaderfontsize . 'pt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderfontstyle) {&nbsp;</div></li><li><div>                  if ($this-&gt;defaultheaderfontstyle == 'B' || $this-&gt;defaultheaderfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $oddhtml .= ' font-weight: bold;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;defaultheaderfontstyle == 'I' || $this-&gt;defaultheaderfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $oddhtml .= ' font-style: italic;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderline) {&nbsp;</div></li><li><div>                  $oddhtml .= ' border-bottom: 0.1mm solid #000000;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $oddhtml .= '&quot;&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;tr&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;td width=&quot;' . $lw . '%&quot; style=&quot;padding: 0 0 ' . $this-&gt;header_line_spacing . 'em 0; text-align: left; &quot;&gt;' . $hdet[0] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;td width=&quot;' . $cw . '%&quot; style=&quot;padding: 0 0 ' . $this-&gt;header_line_spacing . 'em 0; text-align: center; &quot;&gt;' . $hdet[1] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;td width=&quot;' . $rw . '%&quot; style=&quot;padding: 0 0 ' . $this-&gt;header_line_spacing . 'em 0; text-align: right; &quot;&gt;' . $hdet[2] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $evenhtml = '&lt;table width=&quot;100%&quot; style=&quot;border-collapse: collapse; margin: 0; vertical-align: bottom; color: #000000; ';&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderfontsize) {&nbsp;</div></li><li><div>                  $evenhtml .= ' font-size: ' . $this-&gt;defaultheaderfontsize . 'pt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderfontstyle) {&nbsp;</div></li><li><div>                  if ($this-&gt;defaultheaderfontstyle == 'B' || $this-&gt;defaultheaderfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $evenhtml .= ' font-weight: bold;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;defaultheaderfontstyle == 'I' || $this-&gt;defaultheaderfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $evenhtml .= ' font-style: italic;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderline) {&nbsp;</div></li><li><div>                  $evenhtml .= ' border-bottom: 0.1mm solid #000000;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $evenhtml .= '&quot;&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;tr&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;td width=&quot;' . $rw . '%&quot; style=&quot;padding: 0 0 ' . $this-&gt;header_line_spacing . 'em 0; text-align: left; &quot;&gt;' . $hdet[2] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;td width=&quot;' . $cw . '%&quot; style=&quot;padding: 0 0 ' . $this-&gt;header_line_spacing . 'em 0; text-align: center; &quot;&gt;' . $hdet[1] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;td width=&quot;' . $lw . '%&quot; style=&quot;padding: 0 0 ' . $this-&gt;header_line_spacing . 'em 0; text-align: right; &quot;&gt;' . $hdet[0] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $oddhtml = '&lt;div style=&quot;margin: 0; color: #000000; ';&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderfontsize) {&nbsp;</div></li><li><div>                  $oddhtml .= ' font-size: ' . $this-&gt;defaultheaderfontsize . 'pt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderfontstyle) {&nbsp;</div></li><li><div>                  if ($this-&gt;defaultheaderfontstyle == 'B' || $this-&gt;defaultheaderfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $oddhtml .= ' font-weight: bold;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;defaultheaderfontstyle == 'I' || $this-&gt;defaultheaderfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $oddhtml .= ' font-style: italic;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderline) {&nbsp;</div></li><li><div>                  $oddhtml .= ' border-bottom: 0.1mm solid #000000;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $oddhtml .= 'text-align: right; &quot;&gt;' . $Harray . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $evenhtml = '&lt;div style=&quot;margin: 0; color: #000000; ';&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderfontsize) {&nbsp;</div></li><li><div>                  $evenhtml .= ' font-size: ' . $this-&gt;defaultheaderfontsize . 'pt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderfontstyle) {&nbsp;</div></li><li><div>                  if ($this-&gt;defaultheaderfontstyle == 'B' || $this-&gt;defaultheaderfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $evenhtml .= ' font-weight: bold;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;defaultheaderfontstyle == 'I' || $this-&gt;defaultheaderfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $evenhtml .= ' font-style: italic;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultheaderline) {&nbsp;</div></li><li><div>                  $evenhtml .= ' border-bottom: 0.1mm solid #000000;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $evenhtml .= 'text-align: left; &quot;&gt;' . $Harray . '&lt;/div&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (is_array($Harray) && !empty($Harray)) {&nbsp;</div></li><li><div>          if ($side == 'O') {&nbsp;</div></li><li><div>              $odd = $Harray;&nbsp;</div></li><li><div>          } elseif ($side == 'E') {&nbsp;</div></li><li><div>              $even = $Harray;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $odd = $Harray['odd'];&nbsp;</div></li><li><div>              $even = $Harray['even'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $oddhtml = $this-&gt;_createHTMLheaderFooter($odd, 'H');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $evenhtml = $this-&gt;_createHTMLheaderFooter($even, 'H');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($side == 'E') {&nbsp;</div></li><li><div>          $this-&gt;SetHTMLHeader($evenhtml, 'E', $write);&nbsp;</div></li><li><div>      } elseif ($side == 'O') {&nbsp;</div></li><li><div>          $this-&gt;SetHTMLHeader($oddhtml, 'O', $write);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetHTMLHeader($oddhtml, 'O', $write);&nbsp;</div></li><li><div>          $this-&gt;SetHTMLHeader($evenhtml, 'E', $write);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetFooter($Farray = array(), $side = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $oddhtml = '';&nbsp;</div></li><li><div>      $evenhtml = '';&nbsp;</div></li><li><div>      if (is_string($Farray)) {&nbsp;</div></li><li><div>          if (strlen($Farray) == 0) {&nbsp;</div></li><li><div>              $oddhtml = '';&nbsp;</div></li><li><div>              $evenhtml = '';&nbsp;</div></li><li><div>          } elseif (strpos($Farray, '|') !== false) {&nbsp;</div></li><li><div>              $hdet = explode('|', $Farray);&nbsp;</div></li><li><div>              $oddhtml = '&lt;table width=&quot;100%&quot; style=&quot;border-collapse: collapse; margin: 0; vertical-align: top; color: #000000; ';&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterfontsize) {&nbsp;</div></li><li><div>                  $oddhtml .= ' font-size: ' . $this-&gt;defaultfooterfontsize . 'pt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterfontstyle) {&nbsp;</div></li><li><div>                  if ($this-&gt;defaultfooterfontstyle == 'B' || $this-&gt;defaultfooterfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $oddhtml .= ' font-weight: bold;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;defaultfooterfontstyle == 'I' || $this-&gt;defaultfooterfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $oddhtml .= ' font-style: italic;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterline) {&nbsp;</div></li><li><div>                  $oddhtml .= ' border-top: 0.1mm solid #000000;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $oddhtml .= '&quot;&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;tr&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;td width=&quot;33%&quot; style=&quot;padding: ' . $this-&gt;footer_line_spacing . 'em 0 0 0; text-align: left; &quot;&gt;' . $hdet[0] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;td width=&quot;33%&quot; style=&quot;padding: ' . $this-&gt;footer_line_spacing . 'em 0 0 0; text-align: center; &quot;&gt;' . $hdet[1] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;td width=&quot;33%&quot; style=&quot;padding: ' . $this-&gt;footer_line_spacing . 'em 0 0 0; text-align: right; &quot;&gt;' . $hdet[2] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $oddhtml .= '&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $evenhtml = '&lt;table width=&quot;100%&quot; style=&quot;border-collapse: collapse; margin: 0; vertical-align: top; color: #000000; ';&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterfontsize) {&nbsp;</div></li><li><div>                  $evenhtml .= ' font-size: ' . $this-&gt;defaultfooterfontsize . 'pt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterfontstyle) {&nbsp;</div></li><li><div>                  if ($this-&gt;defaultfooterfontstyle == 'B' || $this-&gt;defaultfooterfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $evenhtml .= ' font-weight: bold;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;defaultfooterfontstyle == 'I' || $this-&gt;defaultfooterfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $evenhtml .= ' font-style: italic;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterline) {&nbsp;</div></li><li><div>                  $evenhtml .= ' border-top: 0.1mm solid #000000;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $evenhtml .= '&quot;&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;tr&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;td width=&quot;33%&quot; style=&quot;padding: ' . $this-&gt;footer_line_spacing . 'em 0 0 0; text-align: left; &quot;&gt;' . $hdet[2] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;td width=&quot;33%&quot; style=&quot;padding: ' . $this-&gt;footer_line_spacing . 'em 0 0 0; text-align: center; &quot;&gt;' . $hdet[1] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;td width=&quot;33%&quot; style=&quot;padding: ' . $this-&gt;footer_line_spacing . 'em 0 0 0; text-align: right; &quot;&gt;' . $hdet[0] . '&lt;/td&gt;';&nbsp;</div></li><li><div>              $evenhtml .= '&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $oddhtml = '&lt;div style=&quot;margin: 0; color: #000000; ';&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterfontsize) {&nbsp;</div></li><li><div>                  $oddhtml .= ' font-size: ' . $this-&gt;defaultfooterfontsize . 'pt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterfontstyle) {&nbsp;</div></li><li><div>                  if ($this-&gt;defaultfooterfontstyle == 'B' || $this-&gt;defaultfooterfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $oddhtml .= ' font-weight: bold;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;defaultfooterfontstyle == 'I' || $this-&gt;defaultfooterfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $oddhtml .= ' font-style: italic;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterline) {&nbsp;</div></li><li><div>                  $oddhtml .= ' border-top: 0.1mm solid #000000;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $oddhtml .= 'text-align: right; &quot;&gt;' . $Farray . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $evenhtml = '&lt;div style=&quot;margin: 0; color: #000000; ';&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterfontsize) {&nbsp;</div></li><li><div>                  $evenhtml .= ' font-size: ' . $this-&gt;defaultfooterfontsize . 'pt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterfontstyle) {&nbsp;</div></li><li><div>                  if ($this-&gt;defaultfooterfontstyle == 'B' || $this-&gt;defaultfooterfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $evenhtml .= ' font-weight: bold;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;defaultfooterfontstyle == 'I' || $this-&gt;defaultfooterfontstyle == 'BI') {&nbsp;</div></li><li><div>                      $evenhtml .= ' font-style: italic;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;defaultfooterline) {&nbsp;</div></li><li><div>                  $evenhtml .= ' border-top: 0.1mm solid #000000;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $evenhtml .= 'text-align: left; &quot;&gt;' . $Farray . '&lt;/div&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (is_array($Farray)) {&nbsp;</div></li><li><div>          if ($side == 'O') {&nbsp;</div></li><li><div>              $odd = $Farray;&nbsp;</div></li><li><div>          } elseif ($side == 'E') {&nbsp;</div></li><li><div>              $even = $Farray;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if (isset($Farray['odd']))&nbsp;</div></li><li><div>                  $odd = $Farray['odd'];&nbsp;</div></li><li><div>              if (isset($Farray['even']))&nbsp;</div></li><li><div>                  $even = $Farray['even'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($odd))&nbsp;</div></li><li><div>              $oddhtml = $this-&gt;_createHTMLheaderFooter($odd, 'F');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($even))&nbsp;</div></li><li><div>              $evenhtml = $this-&gt;_createHTMLheaderFooter($even, 'F');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">/** -- HTMLfooterS-FOOTERS -- */</span>&nbsp;</div></li><li><div>      if ($side == 'E') {&nbsp;</div></li><li><div>          $this-&gt;SetHTMLfooter($evenhtml, 'E');&nbsp;</div></li><li><div>      } elseif ($side == 'O') {&nbsp;</div></li><li><div>          $this-&gt;SetHTMLfooter($oddhtml, 'O');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetHTMLfooter($oddhtml, 'O');&nbsp;</div></li><li><div>          $this-&gt;SetHTMLfooter($evenhtml, 'E');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">/** -- END HTMLfooterS-FOOTERS -- */</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- WATERMARK -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetWatermarkText($txt = '', $alpha = -1)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($alpha &gt;= 0)&nbsp;</div></li><li><div>          $this-&gt;watermarkTextAlpha = $alpha;&nbsp;</div></li><li><div>      $this-&gt;watermarkText = $txt;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetWatermarkImage($src, $alpha = -1, $size = 'D', $pos = 'F')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($alpha &gt;= 0)&nbsp;</div></li><li><div>          $this-&gt;watermarkImageAlpha = $alpha;&nbsp;</div></li><li><div>      $this-&gt;watermarkImage = $src;&nbsp;</div></li><li><div>      $this-&gt;watermark_size = $size;&nbsp;</div></li><li><div>      $this-&gt;watermark_pos = $pos;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END WATERMARK -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//Page</span> footer</span></span>&nbsp;</div></li><li><div>  function Footer()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-PAGE -- */</span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// PAGED MEDIA - CROP / CROSS MARKS from @PAGE</span></span>&nbsp;</div></li><li><div>      if ($this-&gt;show_marks == 'CROP' || $this-&gt;show_marks == 'CROPCROSS') {&nbsp;</div></li><li><div>          <span class="comment">// Show TICK MARKS</span>&nbsp;</div></li><li><div>          $this-&gt;SetLineWidth(0.1); <span class="comment"><span class="comment">// = 0.1 mm</span></span>&nbsp;</div></li><li><div>          $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          $l = $this-&gt;cropMarkLength;&nbsp;</div></li><li><div>          $m = $this-&gt;cropMarkMargin; <span class="comment">// Distance of crop mark from margin</span>&nbsp;</div></li><li><div>          $b = $this-&gt;nonPrintMargin; <span class="comment">// Non-printable border at edge of paper sheet</span>&nbsp;</div></li><li><div>          $ax1 = $b;&nbsp;</div></li><li><div>          $bx = $this-&gt;page_box['outer_width_LR'] - $m;&nbsp;</div></li><li><div>          $ax = max($ax1, $bx - $l);&nbsp;</div></li><li><div>          $cx1 = $this-&gt;w - $b;&nbsp;</div></li><li><div>          $dx = $this-&gt;w - $this-&gt;page_box['outer_width_LR'] + $m;&nbsp;</div></li><li><div>          $cx = min($cx1, $dx + $l);&nbsp;</div></li><li><div>          $ay1 = $b;&nbsp;</div></li><li><div>          $by = $this-&gt;page_box['outer_width_TB'] - $m;&nbsp;</div></li><li><div>          $ay = max($ay1, $by - $l);&nbsp;</div></li><li><div>          $cy1 = $this-&gt;h - $b;&nbsp;</div></li><li><div>          $dy = $this-&gt;h - $this-&gt;page_box['outer_width_TB'] + $m;&nbsp;</div></li><li><div>          $cy = min($cy1, $dy + $l);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;Line($ax, $this-&gt;page_box['outer_width_TB'], $bx, $this-&gt;page_box['outer_width_TB']);&nbsp;</div></li><li><div>          $this-&gt;Line($cx, $this-&gt;page_box['outer_width_TB'], $dx, $this-&gt;page_box['outer_width_TB']);&nbsp;</div></li><li><div>          $this-&gt;Line($ax, $this-&gt;h - $this-&gt;page_box['outer_width_TB'], $bx, $this-&gt;h - $this-&gt;page_box['outer_width_TB']);&nbsp;</div></li><li><div>          $this-&gt;Line($cx, $this-&gt;h - $this-&gt;page_box['outer_width_TB'], $dx, $this-&gt;h - $this-&gt;page_box['outer_width_TB']);&nbsp;</div></li><li><div>          $this-&gt;Line($this-&gt;page_box['outer_width_LR'], $ay, $this-&gt;page_box['outer_width_LR'], $by);&nbsp;</div></li><li><div>          $this-&gt;Line($this-&gt;page_box['outer_width_LR'], $cy, $this-&gt;page_box['outer_width_LR'], $dy);&nbsp;</div></li><li><div>          $this-&gt;Line($this-&gt;w - $this-&gt;page_box['outer_width_LR'], $ay, $this-&gt;w - $this-&gt;page_box['outer_width_LR'], $by);&nbsp;</div></li><li><div>          $this-&gt;Line($this-&gt;w - $this-&gt;page_box['outer_width_LR'], $cy, $this-&gt;w - $this-&gt;page_box['outer_width_LR'], $dy);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;printers_info) {&nbsp;</div></li><li><div>              $hd = date('Y-m-d H:i') . '  Page ' . $this-&gt;page . ' of {nb}';&nbsp;</div></li><li><div>              $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>              $this-&gt;SetFont('arial', '', 7.5, true, true);&nbsp;</div></li><li><div>              $this-&gt;x = $this-&gt;page_box['outer_width_LR'] + 1.5;&nbsp;</div></li><li><div>              $this-&gt;y = 1;&nbsp;</div></li><li><div>              $this-&gt;Cell($headerpgwidth, $this-&gt;FontSize, $hd, 0, 0, 'L', 0, '', 0, 0, 0, 'M');&nbsp;</div></li><li><div>              $this-&gt;SetFont($this-&gt;default_font, '', $this-&gt;original_default_font_size);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;show_marks == 'CROSS' || $this-&gt;show_marks == 'CROPCROSS') {&nbsp;</div></li><li><div>          $this-&gt;SetLineWidth(0.1); <span class="comment"><span class="comment">// = 0.1 mm</span></span>&nbsp;</div></li><li><div>          $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          $l = 14 / 2; <span class="comment">// longer length of the cross line (half)</span>&nbsp;</div></li><li><div>          $w = 6 / 2; <span class="comment">// shorter width of the cross line (half)</span>&nbsp;</div></li><li><div>          $r = 1.2; <span class="comment">// radius of circle</span>&nbsp;</div></li><li><div>          $m = $this-&gt;crossMarkMargin; <span class="comment">// Distance of cross mark from margin</span>&nbsp;</div></li><li><div>          $x1 = $this-&gt;page_box['outer_width_LR'] - $m;&nbsp;</div></li><li><div>          $x2 = $this-&gt;w - $this-&gt;page_box['outer_width_LR'] + $m;&nbsp;</div></li><li><div>          $y1 = $this-&gt;page_box['outer_width_TB'] - $m;&nbsp;</div></li><li><div>          $y2 = $this-&gt;h - $this-&gt;page_box['outer_width_TB'] + $m;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;Circle($x1, $this-&gt;h / 2, $r, 'S');&nbsp;</div></li><li><div>          $this-&gt;Line($x1 - $w, $this-&gt;h / 2, $x1 + $w, $this-&gt;h / 2);&nbsp;</div></li><li><div>          $this-&gt;Line($x1, $this-&gt;h / 2 - $l, $x1, $this-&gt;h / 2 + $l);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;Circle($x2, $this-&gt;h / 2, $r, 'S');&nbsp;</div></li><li><div>          $this-&gt;Line($x2 - $w, $this-&gt;h / 2, $x2 + $w, $this-&gt;h / 2);&nbsp;</div></li><li><div>          $this-&gt;Line($x2, $this-&gt;h / 2 - $l, $x2, $this-&gt;h / 2 + $l);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;Circle($this-&gt;w / 2, $y1, $r, 'S');&nbsp;</div></li><li><div>          $this-&gt;Line($this-&gt;w / 2, $y1 - $w, $this-&gt;w / 2, $y1 + $w);&nbsp;</div></li><li><div>          $this-&gt;Line($this-&gt;w / 2 - $l, $y1, $this-&gt;w / 2 + $l, $y1);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;Circle($this-&gt;w / 2, $y2, $r, 'S');&nbsp;</div></li><li><div>          $this-&gt;Line($this-&gt;w / 2, $y2 - $w, $this-&gt;w / 2, $y2 + $w);&nbsp;</div></li><li><div>          $this-&gt;Line($this-&gt;w / 2 - $l, $y2, $this-&gt;w / 2 + $l, $y2);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-PAGE -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// If @page set non-HTML headers/footers named, they were not read until later in the HTML code - so now set them</span>&nbsp;</div></li><li><div>      if ($this-&gt;page == 1) {&nbsp;</div></li><li><div>          if ($this-&gt;firstPageBoxHeader) {&nbsp;</div></li><li><div>              if (isset($this-&gt;pageHTMLheaders[$this-&gt;firstPageBoxHeader])) {&nbsp;</div></li><li><div>                  $this-&gt;HTMLHeader = $this-&gt;pageHTMLheaders[$this-&gt;firstPageBoxHeader];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;Header();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;firstPageBoxFooter) {&nbsp;</div></li><li><div>              if (isset($this-&gt;pageHTMLfooters[$this-&gt;firstPageBoxFooter])) {&nbsp;</div></li><li><div>                  $this-&gt;HTMLFooter = $this-&gt;pageHTMLfooters[$this-&gt;firstPageBoxFooter];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;firstPageBoxHeader = '';&nbsp;</div></li><li><div>          $this-&gt;firstPageBoxFooter = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (($this-&gt;mirrorMargins && ($this-&gt;page % 2 == 0) && $this-&gt;HTMLFooterE) || ($this-&gt;mirrorMargins && ($this-&gt;page % 2 == 1) && $this-&gt;HTMLFooter) || (!$this-&gt;mirrorMargins && $this-&gt;HTMLFooter)) {&nbsp;</div></li><li><div>          $this-&gt;writeHTMLFooters();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- WATERMARK -- */</span></span></span></span>&nbsp;</div></li><li><div>      if (($this-&gt;watermarkText) && ($this-&gt;showWatermarkText)) {&nbsp;</div></li><li><div>          $this-&gt;watermark($this-&gt;watermarkText, 45, 120, $this-&gt;watermarkTextAlpha); <span class="comment">// Watermark text</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (($this-&gt;watermarkImage) && ($this-&gt;showWatermarkImage)) {&nbsp;</div></li><li><div>          $this-&gt;watermarkImg($this-&gt;watermarkImage, $this-&gt;watermarkImageAlpha); <span class="comment">// Watermark image</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END WATERMARK -- */</span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">/** -- HYPHENATION -- */</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment">// HYPHENATION</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment">// Word hyphenation</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  function hyphenateWord($word, $currptr)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Do everything inside this function in utf-8</span>&nbsp;</div></li><li><div>      <span class="comment">// Don't hyphenate web addresses</span>&nbsp;</div></li><li><div>      if (preg_match('/^(http:|www\.)/', $word)) {&nbsp;</div></li><li><div>          return -1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $ptr = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get dictionary</span>&nbsp;</div></li><li><div>      if (!$this-&gt;loadedSHYdictionary) {&nbsp;</div></li><li><div>          if (file_exists(_MPDF_PATH . 'patterns/dictionary.txt')) {&nbsp;</div></li><li><div>              $this-&gt;SHYdictionary = file(_MPDF_PATH . 'patterns/dictionary.txt', FILE_SKIP_EMPTY_LINES);&nbsp;</div></li><li><div>              foreach ($this-&gt;SHYdictionary as $entry) {&nbsp;</div></li><li><div>                  $entry = trim($entry);&nbsp;</div></li><li><div>                  $poss = array();&nbsp;</div></li><li><div>                  $offset = 0;&nbsp;</div></li><li><div>                  $p = true;&nbsp;</div></li><li><div>                  $wl = mb_strlen($entry, 'UTF-8');&nbsp;</div></li><li><div>                  while ($offset &lt; $wl) {&nbsp;</div></li><li><div>                      $p = mb_strpos($entry, '/', $offset, 'UTF-8');&nbsp;</div></li><li><div>                      if ($p !== false) {&nbsp;</div></li><li><div>                          $poss[] = $p - count($poss);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $offset = $p + 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (count($poss)) {&nbsp;</div></li><li><div>                      $this-&gt;SHYdictionaryWords[str_replace('/', '', mb_strtolower($entry))] = $poss;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;loadedSHYdictionary = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!in_array($this-&gt;SHYlang, $this-&gt;SHYlanguages)) {&nbsp;</div></li><li><div>          return -1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// If no pattern loaded or not the best one</span>&nbsp;</div></li><li><div>      if (count($this-&gt;SHYpatterns) &lt; 1 || ($this-&gt;loadedSHYpatterns && $this-&gt;loadedSHYpatterns != $this-&gt;SHYlang)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . &quot;patterns/&quot; . $this-&gt;SHYlang . &quot;.php&quot;);&nbsp;</div></li><li><div>          $patterns = explode(' ', $patterns);&nbsp;</div></li><li><div>          $new_patterns = array();&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; count($patterns); $i++) {&nbsp;</div></li><li><div>              $value = $patterns[$i];&nbsp;</div></li><li><div>              $new_patterns[preg_replace('/[0-9]/', '', $value)] = $value;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;SHYpatterns = $new_patterns;&nbsp;</div></li><li><div>          $this-&gt;loadedSHYpatterns = $this-&gt;SHYlang;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $word = mb_convert_encoding($word, 'UTF-8', $this-&gt;mb_enc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $prepre = '';&nbsp;</div></li><li><div>      $postpost = '';&nbsp;</div></li><li><div>      $startpunctuation = &quot;\xc2\xab\xc2\xbf\xe2\x80\x98\xe2\x80\x9b\xe2\x80\x9c\xe2\x80\x9f&quot;;&nbsp;</div></li><li><div>      $endpunctuation = &quot;\xe2\x80\x9e\xe2\x80\x9d\xe2\x80\x9a\xe2\x80\x99\xc2\xbb&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (preg_match('/^([&quot;\'' . $startpunctuation . '])+(.{' . $this-&gt;SHYcharmin . ', })$/u', $word, $m)) {&nbsp;</div></li><li><div>          $prepre = $m[1];&nbsp;</div></li><li><div>          $word = $m[2];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (preg_match('/^(.{' . $this-&gt;SHYcharmin . ', })([\'\., ;:!?&quot;' . $endpunctuation . ']+)$/u', $word, $m)) {&nbsp;</div></li><li><div>          $word = $m[1];&nbsp;</div></li><li><div>          $postpost = $m[2];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (mb_strlen($word, 'UTF-8') &lt; $this-&gt;SHYcharmin) {&nbsp;</div></li><li><div>          return -1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $success = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $preprelen = mb_strlen($prepre);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($this-&gt;SHYdictionaryWords[mb_strtolower($word)])) {&nbsp;</div></li><li><div>          foreach ($this-&gt;SHYdictionaryWords[mb_strtolower($word)] AS $i) {&nbsp;</div></li><li><div>              if (($i + $preprelen) &gt;= $currptr) {&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $ptr = $i + $preprelen;&nbsp;</div></li><li><div>              $success = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$success) {&nbsp;</div></li><li><div>          $text_word = '_' . $word . '_';&nbsp;</div></li><li><div>          $word_length = mb_strlen($text_word, 'UTF-8');&nbsp;</div></li><li><div>          $text_word = mb_strtolower($text_word, 'UTF-8');&nbsp;</div></li><li><div>          $hyphenated_word = array();&nbsp;</div></li><li><div>          $numb3rs = array('0' =&gt; true, '1' =&gt; true, '2' =&gt; true, '3' =&gt; true, '4' =&gt; true, '5' =&gt; true, '6' =&gt; true, '7' =&gt; true, '8' =&gt; true, '9' =&gt; true);&nbsp;</div></li><li><div>          for ($position = 0; $position &lt;= ($word_length - $this-&gt;SHYcharmin); $position++) {&nbsp;</div></li><li><div>              $maxwins = min(($word_length - $position), $this-&gt;SHYcharmax);&nbsp;</div></li><li><div>              for ($win = $this-&gt;SHYcharmin; $win &lt;= $maxwins; $win++) {&nbsp;</div></li><li><div>                  if (isset($this-&gt;SHYpatterns[mb_substr($text_word, $position, $win, 'UTF-8')])) {&nbsp;</div></li><li><div>                      $pattern = $this-&gt;SHYpatterns[mb_substr($text_word, $position, $win, 'UTF-8')];&nbsp;</div></li><li><div>                      $digits = 1;&nbsp;</div></li><li><div>                      $pattern_length = mb_strlen($pattern, 'UTF-8');&nbsp;</div></li><li><div>                      for ($i = 0; $i &lt; $pattern_length; $i++) {&nbsp;</div></li><li><div>                          $char = $pattern[$i];&nbsp;</div></li><li><div>                          if (isset($numb3rs[$char])) {&nbsp;</div></li><li><div>                              $zero = ($i == 0) ? $position - 1 : $position + $i - $digits;&nbsp;</div></li><li><div>                              if (!isset($hyphenated_word[$zero]) || $hyphenated_word[$zero] != $char)&nbsp;</div></li><li><div>                                  $hyphenated_word[$zero] = $char;&nbsp;</div></li><li><div>                              $digits++;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          for ($i = $this-&gt;SHYleftmin; $i &lt;= (mb_strlen($word, 'UTF-8') - $this-&gt;SHYrightmin); $i++) {&nbsp;</div></li><li><div>              if (isset($hyphenated_word[$i]) && $hyphenated_word[$i] % 2 != 0) {&nbsp;</div></li><li><div>                  if (($i + $preprelen) &gt; $currptr) {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $ptr = $i + $preprelen;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $ptr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">/** -- END HYPHENATION -- */</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment">/// HTML parser ///</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>&nbsp;</div></li><li><div>  function WriteHTML($html, $sub = 0, $init = true, $close = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// $sub - 0 = default; 1=headerCSS only; 2=HTML body (parts) only; 3 - HTML parses only</span>&nbsp;</div></li><li><div>      <span class="comment">// 4 - writes HTML headers/Fixed pos DIVs - stores in buffer - for single page only</span>&nbsp;</div></li><li><div>      <span class="comment">// $close - if false Leaves buffers etc. in current state, so that it can continue a block etc.</span>&nbsp;</div></li><li><div>      <span class="comment">// $init - Clears and sets buffers to Top level block etc.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Check if $html is null and set to blank string */</span>&nbsp;</div></li><li><div>      if( $html === null ) {&nbsp;</div></li><li><div>          $html = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Check $html is an integer, float, string, boolean or class with __toString(), otherwise throw exception */</span>&nbsp;</div></li><li><div>      if (is_scalar($html) === false) {&nbsp;</div></li><li><div>          if(!is_object($html) || ! method_exists($html, '__toString')) {&nbsp;</div></li><li><div>              throw new MpdfException('WriteHTML() requires $html be an integer, float, string, boolean or an object with the __toString() magic method.');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Cast $html as a string */</span>&nbsp;</div></li><li><div>      $html = (string) $html;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($init) {&nbsp;</div></li><li><div>          $this-&gt;headerbuffer = '';&nbsp;</div></li><li><div>          $this-&gt;textbuffer = array();&nbsp;</div></li><li><div>          $this-&gt;fixedPosBlockSave = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($sub == 1) {&nbsp;</div></li><li><div>          $html = '&lt;style&gt; ' . $html . ' &lt;/style&gt;';&nbsp;</div></li><li><div>      } <span class="comment">// stylesheet only</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;allow_charset_conversion) {&nbsp;</div></li><li><div>          if ($sub &lt; 1) {&nbsp;</div></li><li><div>              $this-&gt;ReadCharset($html);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;charset_in && $sub != 4) {&nbsp;</div></li><li><div>              $success = iconv($this-&gt;charset_in, 'UTF-8<span class="comment">//TRANSLIT', $html);</span>&nbsp;</div></li><li><div>              if ($success) {&nbsp;</div></li><li><div>                  $html = $success;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html = $this-&gt;purify_utf8($html, false);&nbsp;</div></li><li><div>      if ($init) {&nbsp;</div></li><li><div>          $this-&gt;blklvl = 0;&nbsp;</div></li><li><div>          $this-&gt;lastblocklevelchange = 0;&nbsp;</div></li><li><div>          $this-&gt;blk = array();&nbsp;</div></li><li><div>          $this-&gt;initialiseBlock($this-&gt;blk[0]);&nbsp;</div></li><li><div>          $this-&gt;blk[0]['width'] = & $this-&gt;pgwidth;&nbsp;</div></li><li><div>          $this-&gt;blk[0]['inner_width'] = & $this-&gt;pgwidth;&nbsp;</div></li><li><div>          $this-&gt;blk[0]['blockContext'] = $this-&gt;blockContext;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $zproperties = array();&nbsp;</div></li><li><div>      if ($sub &lt; 2) {&nbsp;</div></li><li><div>          $this-&gt;ReadMetaTags($html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (preg_match('/&lt;base[^&gt;]*href=[&quot;\']([^&quot;\'&gt;]*)[&quot;\']/i', $html, $m)) {&nbsp;</div></li><li><div>              $this-&gt;SetBasePath($m[1]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $html = $this-&gt;cssmgr-&gt;ReadCSS($html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;autoLangToFont && !$this-&gt;usingCoreFont && preg_match('/&lt;html [^&gt;]*lang=[\'\&quot;](.*?)[\'\&quot;]/ism', $html, $m)) {&nbsp;</div></li><li><div>              $html_lang = $m[1];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (preg_match('/&lt;html [^&gt;]*dir=[\'\&quot;]\s*rtl\s*[\'\&quot;]/ism', $html)) {&nbsp;</div></li><li><div>              $zproperties['DIRECTION'] = 'rtl';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// allow in-line CSS for body tag to be parsed // Get &lt;body&gt; tag inline CSS</span>&nbsp;</div></li><li><div>          if (preg_match('/&lt;body([^&gt;]*)&gt;(.*?)&lt;\/body&gt;/ism', $html, $m) || preg_match('/&lt;body([^&gt;]*)&gt;(.*)$/ism', $html, $m)) {&nbsp;</div></li><li><div>              $html = $m[2];&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// Changed to allow style=&quot;background: url('bg.jpg')&quot;</span></span></span>&nbsp;</div></li><li><div>              if (preg_match('/style=[\&quot;](.*?)[\&quot;]/ism', $m[1], $mm) || preg_match('/style=[\'](.*?)[\']/ism', $m[1], $mm)) {&nbsp;</div></li><li><div>                  $zproperties = $this-&gt;cssmgr-&gt;readInlineCSS($mm[1]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (preg_match('/dir=[\'\&quot;]\s*rtl\s*[\'\&quot;]/ism', $m[1])) {&nbsp;</div></li><li><div>                  $zproperties['DIRECTION'] = 'rtl';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($html_lang) && $html_lang) {&nbsp;</div></li><li><div>                  $zproperties['LANG'] = $html_lang;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;autoLangToFont && !$this-&gt;onlyCoreFonts && preg_match('/lang=[\'\&quot;](.*?)[\'\&quot;]/ism', $m[1], $mm)) {&nbsp;</div></li><li><div>                  $zproperties['LANG'] = $mm[1];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $properties = $this-&gt;cssmgr-&gt;MergeCSS('BLOCK', 'BODY', '');&nbsp;</div></li><li><div>      if ($zproperties) {&nbsp;</div></li><li><div>          $properties = $this-&gt;cssmgr-&gt;array_merge_recursive_unique($properties, $zproperties);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($properties['DIRECTION']) && $properties['DIRECTION']) {&nbsp;</div></li><li><div>          $this-&gt;cssmgr-&gt;CSS['BODY']['DIRECTION'] = $properties['DIRECTION'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($this-&gt;cssmgr-&gt;CSS['BODY']['DIRECTION'])) {&nbsp;</div></li><li><div>          $this-&gt;cssmgr-&gt;CSS['BODY']['DIRECTION'] = $this-&gt;directionality;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetDirectionality($this-&gt;cssmgr-&gt;CSS['BODY']['DIRECTION']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;setCSS($properties, '', 'BODY');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;blk[0]['InlineProperties'] = $this-&gt;saveInlineProperties();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($sub == 1) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($this-&gt;cssmgr-&gt;CSS['BODY'])) {&nbsp;</div></li><li><div>          $this-&gt;cssmgr-&gt;CSS['BODY'] = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($properties['BACKGROUND-GRADIENT'])) {&nbsp;</div></li><li><div>          $this-&gt;bodyBackgroundGradient = $properties['BACKGROUND-GRADIENT'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($properties['BACKGROUND-IMAGE']) && $properties['BACKGROUND-IMAGE']) {&nbsp;</div></li><li><div>          $ret = $this-&gt;SetBackground($properties, $this-&gt;pgwidth);&nbsp;</div></li><li><div>          if ($ret) {&nbsp;</div></li><li><div>              $this-&gt;bodyBackgroundImage = $ret;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-PAGE -- */</span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// If page-box is set</span>&nbsp;</div></li><li><div>      if ($this-&gt;state == 0 && ((isset($this-&gt;cssmgr-&gt;CSS['@PAGE']) && $this-&gt;cssmgr-&gt;CSS['@PAGE']) || (isset($this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;PSEUDO&gt;&gt;FIRST']) && $this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;PSEUDO&gt;&gt;FIRST']))) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>          $this-&gt;page_box['current'] = '';&nbsp;</div></li><li><div>          $this-&gt;page_box['using'] = true;&nbsp;</div></li><li><div>          list($pborientation, $pbmgl, $pbmgr, $pbmgt, $pbmgb, $pbmgh, $pbmgf, $hname, $fname, $bg, $resetpagenum, $pagenumstyle, $suppress, $marks, $newformat) = $this-&gt;SetPagedMediaCSS('', false, 'O');&nbsp;</div></li><li><div>          $this-&gt;DefOrientation = $this-&gt;CurOrientation = $pborientation;&nbsp;</div></li><li><div>          $this-&gt;orig_lMargin = $this-&gt;DeflMargin = $pbmgl;&nbsp;</div></li><li><div>          $this-&gt;orig_rMargin = $this-&gt;DefrMargin = $pbmgr;&nbsp;</div></li><li><div>          $this-&gt;orig_tMargin = $this-&gt;tMargin = $pbmgt;&nbsp;</div></li><li><div>          $this-&gt;orig_bMargin = $this-&gt;bMargin = $pbmgb;&nbsp;</div></li><li><div>          $this-&gt;orig_hMargin = $this-&gt;margin_header = $pbmgh;&nbsp;</div></li><li><div>          $this-&gt;orig_fMargin = $this-&gt;margin_footer = $pbmgf;&nbsp;</div></li><li><div>          list($pborientation, $pbmgl, $pbmgr, $pbmgt, $pbmgb, $pbmgh, $pbmgf, $hname, $fname, $bg, $resetpagenum, $pagenumstyle, $suppress, $marks, $newformat) = $this-&gt;SetPagedMediaCSS('', true, 'O'); <span class="comment">// first page</span>&nbsp;</div></li><li><div>          $this-&gt;show_marks = $marks;&nbsp;</div></li><li><div>          if ($hname)&nbsp;</div></li><li><div>              $this-&gt;firstPageBoxHeader = $hname;&nbsp;</div></li><li><div>          if ($fname)&nbsp;</div></li><li><div>              $this-&gt;firstPageBoxFooter = $fname;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-PAGE -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $parseonly = false;&nbsp;</div></li><li><div>      $this-&gt;bufferoutput = false;&nbsp;</div></li><li><div>      if ($sub == 3) {&nbsp;</div></li><li><div>          $parseonly = true;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Close any open block tags</span></span></span></span>&nbsp;</div></li><li><div>          $arr = array();&nbsp;</div></li><li><div>          $ai = 0;&nbsp;</div></li><li><div>          for ($b = $this-&gt;blklvl; $b &gt; 0; $b--) {&nbsp;</div></li><li><div>              $this-&gt;tag-&gt;CloseTag($this-&gt;blk[$b]['tag'], $arr, $ai);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Output any text left in buffer</span></span></span>&nbsp;</div></li><li><div>          if (count($this-&gt;textbuffer)) {&nbsp;</div></li><li><div>              $this-&gt;printbuffer($this-&gt;textbuffer);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;textbuffer = array();&nbsp;</div></li><li><div>      } elseif ($sub == 4) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Close any open block tags</span></span></span></span>&nbsp;</div></li><li><div>          $arr = array();&nbsp;</div></li><li><div>          $ai = 0;&nbsp;</div></li><li><div>          for ($b = $this-&gt;blklvl; $b &gt; 0; $b--) {&nbsp;</div></li><li><div>              $this-&gt;tag-&gt;CloseTag($this-&gt;blk[$b]['tag'], $arr, $ai);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Output any text left in buffer</span></span></span>&nbsp;</div></li><li><div>          if (count($this-&gt;textbuffer)) {&nbsp;</div></li><li><div>              $this-&gt;printbuffer($this-&gt;textbuffer);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;bufferoutput = true;&nbsp;</div></li><li><div>          $this-&gt;textbuffer = array();&nbsp;</div></li><li><div>          $this-&gt;headerbuffer = '';&nbsp;</div></li><li><div>          $properties = $this-&gt;cssmgr-&gt;MergeCSS('BLOCK', 'BODY', '');&nbsp;</div></li><li><div>          $this-&gt;setCSS($properties, '', 'BODY');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      mb_internal_encoding('UTF-8');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = $this-&gt;AdjustHTML($html, $this-&gt;tabSpaces); <span class="comment">//Try to make HTML look more like XHTML</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;autoScriptToLang) {&nbsp;</div></li><li><div>          $html = $this-&gt;markScriptToLang($html);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      preg_match_all('/&lt;htmlpageheader([^&gt;]*)&gt;(.*?)&lt;\/htmlpageheader&gt;/si', $html, $h);&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; count($h[1]); $i++) {&nbsp;</div></li><li><div>          if (preg_match('/name=[\'|\&quot;](.*?)[\'|\&quot;]/', $h[1][$i], $n)) {&nbsp;</div></li><li><div>              $this-&gt;pageHTMLheaders[$n[1]]['html'] = $h[2][$i];&nbsp;</div></li><li><div>              $this-&gt;pageHTMLheaders[$n[1]]['h'] = $this-&gt;_gethtmlheight($h[2][$i]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      preg_match_all('/&lt;htmlpagefooter([^&gt;]*)&gt;(.*?)&lt;\/htmlpagefooter&gt;/si', $html, $f);&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; count($f[1]); $i++) {&nbsp;</div></li><li><div>          if (preg_match('/name=[\'|\&quot;](.*?)[\'|\&quot;]/', $f[1][$i], $n)) {&nbsp;</div></li><li><div>              $this-&gt;pageHTMLfooters[$n[1]]['html'] = $f[2][$i];&nbsp;</div></li><li><div>              $this-&gt;pageHTMLfooters[$n[1]]['h'] = $this-&gt;_gethtmlheight($f[2][$i]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;htmlpageheader.*?&lt;\/htmlpageheader&gt;/si', '', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;htmlpagefooter.*?&lt;\/htmlpagefooter&gt;/si', '', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;state == 0 && $sub != 1 && $sub != 3 && $sub != 4) {&nbsp;</div></li><li><div>          $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($hname) && preg_match('/^html_(.*)$/i', $hname, $n))&nbsp;</div></li><li><div>          $this-&gt;SetHTMLHeader($this-&gt;pageHTMLheaders[$n[1]], 'O', true);&nbsp;</div></li><li><div>      if (isset($fname) && preg_match('/^html_(.*)$/i', $fname, $n))&nbsp;</div></li><li><div>          $this-&gt;SetHTMLFooter($this-&gt;pageHTMLfooters[$n[1]], 'O');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = str_replace('&lt;?', '&lt; ', $html); <span class="comment">//Fix '&lt;?XML' bug from HTML code generated by MS Word</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;checkSIP = false;&nbsp;</div></li><li><div>      $this-&gt;checkSMP = false;&nbsp;</div></li><li><div>      $this-&gt;checkCJK = false;&nbsp;</div></li><li><div>      if ($this-&gt;onlyCoreFonts) {&nbsp;</div></li><li><div>          $html = $this-&gt;SubstituteChars($html);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if (preg_match(&quot;/([&quot; . $this-&gt;pregRTLchars . &quot;])/u&quot;, $html)) {&nbsp;</div></li><li><div>              $this-&gt;biDirectional = true;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (preg_match(&quot;/([\x{20000}-\x{2FFFF}])/u&quot;, $html)) {&nbsp;</div></li><li><div>              $this-&gt;checkSIP = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (preg_match(&quot;/([\x{10000}-\x{1FFFF}])/u&quot;, $html)) {&nbsp;</div></li><li><div>              $this-&gt;checkSMP = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (preg_match(&quot;/([&quot; . $this-&gt;pregCJKchars . &quot;])/u&quot;, $html)) {&nbsp;</div></li><li><div>              $this-&gt;checkCJK = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CJK-FONTS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Don't allow non-breaking spaces that are converted to substituted chars or will break anyway and mess up table width calc.</span>&nbsp;</div></li><li><div>      $html = str_replace('&lt;tta&gt;160&lt;/tta&gt;', chr(32), $html);&nbsp;</div></li><li><div>      $html = str_replace('&lt;/tta&gt;&lt;tta&gt;', '|', $html);&nbsp;</div></li><li><div>      $html = str_replace('&lt;/tts&gt;&lt;tts&gt;', '|', $html);&nbsp;</div></li><li><div>      $html = str_replace('&lt;/ttz&gt;&lt;ttz&gt;', '|', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Add new supported tags in the DisableTags function</span>&nbsp;</div></li><li><div>      $html = strip_tags($html, $this-&gt;enabledtags); <span class="comment">//remove all unsupported tags, but the ones inside the 'enabledtags' string</span>&nbsp;</div></li><li><div>      <span class="comment">//Explode the string in order to parse the HTML code</span>&nbsp;</div></li><li><div>      $a = preg_split('/&lt;(.*?)&gt;/ms', $html, -1, PREG_SPLIT_DELIM_CAPTURE);&nbsp;</div></li><li><div>      <span class="comment">// ? more accurate regexp that allows e.g. &lt;a name=&quot;Silly &lt;name&gt;&quot;&gt;</span>&nbsp;</div></li><li><div>      <span class="comment">// if changing - also change in fn.SubstituteChars()</span>&nbsp;</div></li><li><div>      <span class="comment">// $a = preg_split ('/&lt;((?:[^&lt;&gt;]+(?:&quot;[^&quot;]*&quot;|\'[^\']*\')?)+)&gt;/ms', $html, -1, PREG_SPLIT_DELIM_CAPTURE);</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;mb_enc) {&nbsp;</div></li><li><div>          mb_internal_encoding($this-&gt;mb_enc);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $pbc = 0;&nbsp;</div></li><li><div>      $this-&gt;subPos = -1;&nbsp;</div></li><li><div>      $cnt = count($a);&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $cnt; $i++) {&nbsp;</div></li><li><div>          $e = $a[$i];&nbsp;</div></li><li><div>          if ($i % 2 == 0) {&nbsp;</div></li><li><div>              <span class="comment">//TEXT</span>&nbsp;</div></li><li><div>              if ($this-&gt;blk[$this-&gt;blklvl]['hide']) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;inlineDisplayOff) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;inMeter) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($this-&gt;inFixedPosBlock) {&nbsp;</div></li><li><div>                  $this-&gt;fixedPosBlock .= $e;&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              } <span class="comment">// *CSS-POSITION*</span>&nbsp;</div></li><li><div>              if (strlen($e) == 0) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($this-&gt;ignorefollowingspaces && !$this-&gt;ispre) {&nbsp;</div></li><li><div>                  if (strlen(ltrim($e)) == 0) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;FontFamily != 'csymbol' && $this-&gt;FontFamily != 'czapfdingbats' && substr($e, 0, 1) == ' ') {&nbsp;</div></li><li><div>                      $this-&gt;ignorefollowingspaces = false;&nbsp;</div></li><li><div>                      $e = ltrim($e);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;OTLdata = NULL;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $e = strcode2utf($e);&nbsp;</div></li><li><div>              $e = $this-&gt;lesser_entity_decode($e);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// If core font is selected in document which is not onlyCoreFonts - substitute with non-core font</span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;useSubstitutions && !$this-&gt;onlyCoreFonts && $this-&gt;subPos &lt; $i && !$this-&gt;specialcontent) {&nbsp;</div></li><li><div>                      $cnt += $this-&gt;SubstituteCharsNonCore($a, $i, $e);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment">// CONVERT ENCODING</span>&nbsp;</div></li><li><div>                  $e = mb_convert_encoding($e, $this-&gt;mb_enc, 'UTF-8');&nbsp;</div></li><li><div>                  if ($this-&gt;textvar & FT_UPPERCASE) {&nbsp;</div></li><li><div>                      $e = mb_strtoupper($e, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  elseif ($this-&gt;textvar & FT_LOWERCASE) {&nbsp;</div></li><li><div>                      $e = mb_strtolower($e, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  elseif ($this-&gt;textvar & FT_CAPITALIZE) {&nbsp;</div></li><li><div>                      $e = mb_convert_case($e, MB_CASE_TITLE, &quot;UTF-8&quot;);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ($this-&gt;checkSIP && $this-&gt;CurrentFont['sipext'] && $this-&gt;subPos &lt; $i && (!$this-&gt;specialcontent || !$this-&gt;useActiveForms)) {&nbsp;</div></li><li><div>                      $cnt += $this-&gt;SubstituteCharsSIP($a, $i, $e);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;useSubstitutions && !$this-&gt;onlyCoreFonts && $this-&gt;CurrentFont['type'] != 'Type0' && $this-&gt;subPos &lt; $i && (!$this-&gt;specialcontent || !$this-&gt;useActiveForms)) {&nbsp;</div></li><li><div>                      $cnt += $this-&gt;SubstituteCharsMB($a, $i, $e);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;textvar & FT_UPPERCASE) {&nbsp;</div></li><li><div>                      $e = mb_strtoupper($e, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;textvar & FT_LOWERCASE) {&nbsp;</div></li><li><div>                      $e = mb_strtolower($e, $this-&gt;mb_enc);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;textvar & FT_CAPITALIZE) {&nbsp;</div></li><li><div>                      $e = mb_convert_case($e, MB_CASE_TITLE, &quot;UTF-8&quot;);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// Use OTL OpenType Table Layout - GSUB</span> & GPOS&nbsp;</div></li><li><div>                  if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL'] && (!$this-&gt;specialcontent || !$this-&gt;useActiveForms)) {&nbsp;</div></li><li><div>                      $e = $this-&gt;otl-&gt;applyOTL($e, $this-&gt;CurrentFont['useOTL']);&nbsp;</div></li><li><div>                      $this-&gt;OTLdata = $this-&gt;otl-&gt;OTLdata;&nbsp;</div></li><li><div>                      $this-&gt;otl-&gt;removeChar($e, $this-&gt;OTLdata, &quot;\xef\xbb\xbf&quot;); <span class="comment"><span class="comment">// Remove ZWNBSP (also Byte order mark FEFF)</span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment">// removes U+200E/U+200F LTR and RTL mark and U+200C/U+200D Zero-width Joiner and Non-joiner</span>&nbsp;</div></li><li><div>                      $e = preg_replace(&quot;/[\xe2\x80\x8c\xe2\x80\x8d\xe2\x80\x8e\xe2\x80\x8f]/u&quot;, '', $e);&nbsp;</div></li><li><div>                      $e = preg_replace(&quot;/[\xef\xbb\xbf]/u&quot;, '', $e); <span class="comment"><span class="comment">// Remove ZWNBSP (also Byte order mark FEFF)</span></span>&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (($this-&gt;tts) || ($this-&gt;ttz) || ($this-&gt;tta)) {&nbsp;</div></li><li><div>                  $es = explode('|', $e);&nbsp;</div></li><li><div>                  $e = '';&nbsp;</div></li><li><div>                  foreach ($es AS $val) {&nbsp;</div></li><li><div>                      $e .= chr($val);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">//  FORM ELEMENTS</span>&nbsp;</div></li><li><div>              if ($this-&gt;specialcontent) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">//SELECT tag (form element)</span>&nbsp;</div></li><li><div>                  if ($this-&gt;specialcontent == &quot;type=select&quot;) {&nbsp;</div></li><li><div>                      $e = ltrim($e);&nbsp;</div></li><li><div>                      if (!empty($this-&gt;OTLdata)) {&nbsp;</div></li><li><div>                          $this-&gt;otl-&gt;trimOTLdata($this-&gt;OTLdata, true, false);&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $stringwidth = $this-&gt;GetStringWidth($e);&nbsp;</div></li><li><div>                      if (!isset($this-&gt;selectoption['MAXWIDTH']) || $stringwidth &gt; $this-&gt;selectoption['MAXWIDTH']) {&nbsp;</div></li><li><div>                          $this-&gt;selectoption['MAXWIDTH'] = $stringwidth;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (!isset($this-&gt;selectoption['SELECTED']) || $this-&gt;selectoption['SELECTED'] == '') {&nbsp;</div></li><li><div>                          $this-&gt;selectoption['SELECTED'] = $e;&nbsp;</div></li><li><div>                          if (!empty($this-&gt;OTLdata)) {&nbsp;</div></li><li><div>                              $this-&gt;selectoption['SELECTED-OTLDATA'] = $this-&gt;OTLdata;&nbsp;</div></li><li><div>                          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Active Forms</span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($this-&gt;selectoption['ACTIVE']) && $this-&gt;selectoption['ACTIVE']) {&nbsp;</div></li><li><div>                          $this-&gt;selectoption['ITEMS'][] = array('exportValue' =&gt; $this-&gt;selectoption['currentVAL'], 'content' =&gt; $e, 'selected' =&gt; $this-&gt;selectoption['currentSEL']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;OTLdata = array();&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// TEXT</span>AREA</span></span>&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $objattr = unserialize($this-&gt;specialcontent);&nbsp;</div></li><li><div>                      $objattr['text'] = $e;&nbsp;</div></li><li><div>                      $objattr['OTLdata'] = $this-&gt;OTLdata;&nbsp;</div></li><li><div>                      $this-&gt;OTLdata = array();&nbsp;</div></li><li><div>                      $te = &quot;\xbb\xa4\xactype=textarea, objattr=&quot; . serialize($objattr) . &quot;\xbb\xa4\xac&quot;;&nbsp;</div></li><li><div>                      if ($this-&gt;tdbegin) {&nbsp;</div></li><li><div>                          $this-&gt;_saveCellTextBuffer($te, $this-&gt;HREF);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;_saveTextBuffer($te, $this-&gt;HREF);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END FORMS -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// TABLE</span></span>&nbsp;</div></li><li><div>              elseif ($this-&gt;tableLevel) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;tdbegin) {&nbsp;</div></li><li><div>                      if (($this-&gt;ignorefollowingspaces) && !$this-&gt;ispre) {&nbsp;</div></li><li><div>                          $e = ltrim($e);&nbsp;</div></li><li><div>                          if (!empty($this-&gt;OTLdata)) {&nbsp;</div></li><li><div>                              $this-&gt;otl-&gt;trimOTLdata($this-&gt;OTLdata, true, false);&nbsp;</div></li><li><div>                          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($e || $e === '0') {&nbsp;</div></li><li><div>                          if ($this-&gt;blockjustfinished && $this-&gt;cell[$this-&gt;row][$this-&gt;col]['s'] &gt; 0) {&nbsp;</div></li><li><div>                              $this-&gt;_saveCellTextBuffer(&quot;\n&quot;);&nbsp;</div></li><li><div>                              if (!isset($this-&gt;cell[$this-&gt;row][$this-&gt;col]['maxs'])) {&nbsp;</div></li><li><div>                                  $this-&gt;cell[$this-&gt;row][$this-&gt;col]['maxs'] = $this-&gt;cell[$this-&gt;row][$this-&gt;col]['s'];&nbsp;</div></li><li><div>                              } elseif ($this-&gt;cell[$this-&gt;row][$this-&gt;col]['maxs'] &lt; $this-&gt;cell[$this-&gt;row][$this-&gt;col]['s']) {&nbsp;</div></li><li><div>                                  $this-&gt;cell[$this-&gt;row][$this-&gt;col]['maxs'] = $this-&gt;cell[$this-&gt;row][$this-&gt;col]['s'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $this-&gt;cell[$this-&gt;row][$this-&gt;col]['s'] = 0; <span class="comment">// reset</span>&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;blockjustfinished = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if (!isset($this-&gt;cell[$this-&gt;row][$this-&gt;col]['R']) || !$this-&gt;cell[$this-&gt;row][$this-&gt;col]['R']) {&nbsp;</div></li><li><div>                              if (isset($this-&gt;cell[$this-&gt;row][$this-&gt;col]['s'])) {&nbsp;</div></li><li><div>                                  $this-&gt;cell[$this-&gt;row][$this-&gt;col]['s'] += $this-&gt;GetStringWidth($e, false, $this-&gt;OTLdata, $this-&gt;textvar);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;cell[$this-&gt;row][$this-&gt;col]['s'] = $this-&gt;GetStringWidth($e, false, $this-&gt;OTLdata, $this-&gt;textvar);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if (!empty($this-&gt;spanborddet)) {&nbsp;</div></li><li><div>                                  $this-&gt;cell[$this-&gt;row][$this-&gt;col]['s'] += (isset($this-&gt;spanborddet['L']['w']) ? $this-&gt;spanborddet['L']['w'] : 0) + (isset($this-&gt;spanborddet['R']['w']) ? $this-&gt;spanborddet['R']['w'] : 0);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;_saveCellTextBuffer($e, $this-&gt;HREF);&nbsp;</div></li><li><div>                          if (substr($this-&gt;cell[$this-&gt;row][$this-&gt;col]['a'], 0, 1) == 'D') {&nbsp;</div></li><li><div>                              $dp = $this-&gt;decimal_align[substr($this-&gt;cell[$this-&gt;row][$this-&gt;col]['a'], 0, 2)];&nbsp;</div></li><li><div>                              $s = preg_split('/' . preg_quote($dp, '/') . '/', $e, 2);  <span class="comment"><span class="comment">// ? needs to be /u if not core</span></span>&nbsp;</div></li><li><div>                              $s0 = $this-&gt;GetStringWidth($s[0], false);&nbsp;</div></li><li><div>                              if (isset($s[1]) && $s[1]) {&nbsp;</div></li><li><div>                                  $s1 = $this-&gt;GetStringWidth(($s[1] . $dp), false);&nbsp;</div></li><li><div>                              } else&nbsp;</div></li><li><div>                                  $s1 = 0;&nbsp;</div></li><li><div>                              if (!isset($this-&gt;table[$this-&gt;tableLevel][$this-&gt;tbctr[$this-&gt;tableLevel]]['decimal_align'][$this-&gt;col]['maxs0'])) {&nbsp;</div></li><li><div>                                  $this-&gt;table[$this-&gt;tableLevel][$this-&gt;tbctr[$this-&gt;tableLevel]]['decimal_align'][$this-&gt;col]['maxs0'] = $s0;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;table[$this-&gt;tableLevel][$this-&gt;tbctr[$this-&gt;tableLevel]]['decimal_align'][$this-&gt;col]['maxs0'] = max($s0, $this-&gt;table[$this-&gt;tableLevel][$this-&gt;tbctr[$this-&gt;tableLevel]]['decimal_align'][$this-&gt;col]['maxs0']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if (!isset($this-&gt;table[$this-&gt;tableLevel][$this-&gt;tbctr[$this-&gt;tableLevel]]['decimal_align'][$this-&gt;col]['maxs1'])) {&nbsp;</div></li><li><div>                                  $this-&gt;table[$this-&gt;tableLevel][$this-&gt;tbctr[$this-&gt;tableLevel]]['decimal_align'][$this-&gt;col]['maxs1'] = $s1;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;table[$this-&gt;tableLevel][$this-&gt;tbctr[$this-&gt;tableLevel]]['decimal_align'][$this-&gt;col]['maxs1'] = max($s1, $this-&gt;table[$this-&gt;tableLevel][$this-&gt;tbctr[$this-&gt;tableLevel]]['decimal_align'][$this-&gt;col]['maxs1']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($this-&gt;tableLevel == 1 && $this-&gt;useGraphs) {&nbsp;</div></li><li><div>                              $this-&gt;graphs[$this-&gt;currentGraphId]['data'][$this-&gt;row][$this-&gt;col] = $e;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;nestedtablejustfinished = false;&nbsp;</div></li><li><div>                          $this-&gt;linebreakjustfinished = false;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// ALL ELSE</span>&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  if ($this-&gt;ignorefollowingspaces && !$this-&gt;ispre) {&nbsp;</div></li><li><div>                      $e = ltrim($e);&nbsp;</div></li><li><div>                      if (!empty($this-&gt;OTLdata)) {&nbsp;</div></li><li><div>                          $this-&gt;otl-&gt;trimOTLdata($this-&gt;OTLdata, true, false);&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($e || $e === '0')&nbsp;</div></li><li><div>                      $this-&gt;_saveTextBuffer($e, $this-&gt;HREF);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($e || $e === '0')&nbsp;</div></li><li><div>                  $this-&gt;ignorefollowingspaces = false; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (substr($e, -1, 1) == ' ' && !$this-&gt;ispre && $this-&gt;FontFamily != 'csymbol' && $this-&gt;FontFamily != 'czapfdingbats') {&nbsp;</div></li><li><div>                  $this-&gt;ignorefollowingspaces = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else { <span class="comment">// TAG **</span>&nbsp;</div></li><li><div>              if (isset($e[0]) && $e[0] == '/') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $endtag = trim(strtoupper(substr($e, 1)));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;inFixedPosBlock) {&nbsp;</div></li><li><div>                      if (in_array($endtag, $this-&gt;outerblocktags) || in_array($endtag, $this-&gt;innerblocktags)) {&nbsp;</div></li><li><div>                          $this-&gt;fixedPosBlockDepth--;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($this-&gt;fixedPosBlockDepth == 0) {&nbsp;</div></li><li><div>                          $this-&gt;fixedPosBlockSave[] = array($this-&gt;fixedPosBlock, $this-&gt;fixedPosBlockBBox, $this-&gt;page);&nbsp;</div></li><li><div>                          $this-&gt;fixedPosBlock = '';&nbsp;</div></li><li><div>                          $this-&gt;inFixedPosBlock = false;&nbsp;</div></li><li><div>                          continue;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;fixedPosBlock .= '&lt;' . $e . '&gt;';&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// Correct for tags where HTML5 specifies optional end tags (see also OpenTag() )</span>&nbsp;</div></li><li><div>                  if ($this-&gt;allow_html_optional_endtags && !$parseonly) {&nbsp;</div></li><li><div>                      if (isset($this-&gt;blk[$this-&gt;blklvl]['tag'])) {&nbsp;</div></li><li><div>                          $closed = false;&nbsp;</div></li><li><div>                          <span class="comment">// li end tag may be omitted if there is no more content in the parent element</span>&nbsp;</div></li><li><div>                          if (!$closed && $this-&gt;blk[$this-&gt;blklvl]['tag'] == 'LI' && $endtag != 'LI' && (in_array($endtag, $this-&gt;outerblocktags) || in_array($endtag, $this-&gt;innerblocktags))) {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag('LI', $a, $i);&nbsp;</div></li><li><div>                              $closed = true;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment">// dd end tag may be omitted if there is no more content in the parent element</span>&nbsp;</div></li><li><div>                          if (!$closed && $this-&gt;blk[$this-&gt;blklvl]['tag'] == 'DD' && $endtag != 'DD' && (in_array($endtag, $this-&gt;outerblocktags) || in_array($endtag, $this-&gt;innerblocktags))) {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag('DD', $a, $i);&nbsp;</div></li><li><div>                              $closed = true;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment">// p end tag may be omitted if there is no more content in the parent element and the parent element is not an A element [??????]</span>&nbsp;</div></li><li><div>                          if (!$closed && $this-&gt;blk[$this-&gt;blklvl]['tag'] == 'P' && $endtag != 'P' && (in_array($endtag, $this-&gt;outerblocktags) || in_array($endtag, $this-&gt;innerblocktags))) {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag('P', $a, $i);&nbsp;</div></li><li><div>                              $closed = true;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment">// option end tag may be omitted if there is no more content in the parent element</span>&nbsp;</div></li><li><div>                          if (!$closed && $this-&gt;blk[$this-&gt;blklvl]['tag'] == 'OPTION' && $endtag != 'OPTION' && (in_array($endtag, $this-&gt;outerblocktags) || in_array($endtag, $this-&gt;innerblocktags))) {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag('OPTION', $a, $i);&nbsp;</div></li><li><div>                              $closed = true;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment">// Check for Table tags where HTML specifies optional end tags, </span>&nbsp;</div></li><li><div>                      if ($endtag == 'TABLE') {&nbsp;</div></li><li><div>                          if ($this-&gt;lastoptionaltag == 'THEAD' || $this-&gt;lastoptionaltag == 'TBODY' || $this-&gt;lastoptionaltag == 'TFOOT') {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag($this-&gt;lastoptionaltag, $a, $i);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;lastoptionaltag == 'TR') {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag('TR', $a, $i);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;lastoptionaltag == 'TD' || $this-&gt;lastoptionaltag == 'TH') {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag($this-&gt;lastoptionaltag, $a, $i);&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag('TR', $a, $i);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($endtag == 'THEAD' || $endtag == 'TBODY' || $endtag == 'TFOOT') {&nbsp;</div></li><li><div>                          if ($this-&gt;lastoptionaltag == 'TR') {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag('TR', $a, $i);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;lastoptionaltag == 'TD' || $this-&gt;lastoptionaltag == 'TH') {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag($this-&gt;lastoptionaltag, $a, $i);&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag('TR', $a, $i);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($endtag == 'TR') {&nbsp;</div></li><li><div>                          if ($this-&gt;lastoptionaltag == 'TD' || $this-&gt;lastoptionaltag == 'TH') {&nbsp;</div></li><li><div>                              $this-&gt;tag-&gt;CloseTag($this-&gt;lastoptionaltag, $a, $i);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;blk[$this-&gt;blklvl]['hide']) {&nbsp;</div></li><li><div>                      if (in_array($endtag, $this-&gt;outerblocktags) || in_array($endtag, $this-&gt;innerblocktags)) {&nbsp;</div></li><li><div>                          unset($this-&gt;blk[$this-&gt;blklvl]);&nbsp;</div></li><li><div>                          $this-&gt;blklvl--;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;tag-&gt;CloseTag($endtag, $a, $i); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              } else { <span class="comment">// OPENING TAG</span>&nbsp;</div></li><li><div>                  if ($this-&gt;blk[$this-&gt;blklvl]['hide']) {&nbsp;</div></li><li><div>                      if (strpos($e, ' ')) {&nbsp;</div></li><li><div>                          $te = strtoupper(substr($e, 0, strpos($e, ' ')));&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $te = strtoupper($e);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if ($te == 'THEAD' || $te == 'TBODY' || $te == 'TFOOT' || $te == 'TR' || $te == 'TD' || $te == 'TH') {&nbsp;</div></li><li><div>                          $this-&gt;lastoptionaltag = $te;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (in_array($te, $this-&gt;outerblocktags) || in_array($te, $this-&gt;innerblocktags)) {&nbsp;</div></li><li><div>                          $this-&gt;blklvl++;&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['hide'] = true;&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['tag'] = $te; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;inFixedPosBlock) {&nbsp;</div></li><li><div>                      if (strpos($e, ' ')) {&nbsp;</div></li><li><div>                          $te = strtoupper(substr($e, 0, strpos($e, ' ')));&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $te = strtoupper($e);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;fixedPosBlock .= '&lt;' . $e . '&gt;';&nbsp;</div></li><li><div>                      if (in_array($te, $this-&gt;outerblocktags) || in_array($te, $this-&gt;innerblocktags)) {&nbsp;</div></li><li><div>                          $this-&gt;fixedPosBlockDepth++;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>                  $regexp = '|=\'(.*?)\'|s'; <span class="comment">// eliminate single quotes, if any</span>&nbsp;</div></li><li><div>                  $e = preg_replace($regexp, &quot;=\&quot;\$1\&quot;&quot;, $e);&nbsp;</div></li><li><div>                  <span class="comment">// changes anykey=anyvalue to anykey=&quot;anyvalue&quot; (only do this inside [some] tags)</span>&nbsp;</div></li><li><div>                  if (substr($e, 0, 10) != 'pageheader' && substr($e, 0, 10) != 'pagefooter' && substr($e, 0, 12) != 'tocpagebreak' && substr($e, 0, 10) != 'indexentry' && substr($e, 0, 8) != 'tocentry') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  (ZZZ99H)&nbsp;</div></li><li><div>                      $regexp = '| (\\w+?)=([^\\s&gt;&quot;]+)|si';&nbsp;</div></li><li><div>                      $e = preg_replace($regexp, &quot; \$1=\&quot;\$2\&quot;&quot;, $e);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $e = preg_replace('/ (\\S+?)\s*=\s*&quot;/i', &quot; \\1=\&quot;&quot;, $e);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Fix path value</span>s, if needed&nbsp;</div></li><li><div>                  $orig_srcpath = '';&nbsp;</div></li><li><div>                  if ((stristr($e, &quot;href=&quot;) !== false) or ( stristr($e, &quot;src=&quot;) !== false)) {&nbsp;</div></li><li><div>                      $regexp = '/ (href|src)\s*=\s*&quot;(.*?)&quot;/i';&nbsp;</div></li><li><div>                      preg_match($regexp, $e, $auxiliararray);&nbsp;</div></li><li><div>                      if (isset($auxiliararray[2])) {&nbsp;</div></li><li><div>                          $path = $auxiliararray[2];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $path = '';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (trim($path) != '' && !(stristr($e, &quot;src=&quot;) !== false && substr($path, 0, 4) == 'var:') && substr($path, 0, 1) != '@') {&nbsp;</div></li><li><div>                          $path = htmlspecialchars_decode($path); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span> URLs&nbsp;</div></li><li><div>                          $orig_srcpath = $path;&nbsp;</div></li><li><div>                          $this-&gt;GetFullPath($path);&nbsp;</div></li><li><div>                          $regexp = '/ (href|src)=&quot;(.*?)&quot;/i';&nbsp;</div></li><li><div>                          $e = preg_replace($regexp, ' \\1=&quot;' . $path . '&quot;', $e);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }<span class="comment">//END of Fix path values</span>&nbsp;</div></li><li><div>                  <span class="comment">//Extract attributes</span>&nbsp;</div></li><li><div>                  $contents = array();&nbsp;</div></li><li><div>                  $contents1 = array();&nbsp;</div></li><li><div>                  $contents2 = array();&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// Changed to allow style=&quot;background: url('bg.jpg')&quot;</span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// Changed to improve performance; maximum length of \S (attribute) = 16</span>&nbsp;</div></li><li><div>                  <span class="comment">// Increase allowed attribute name to 32 - cutting off &quot;toc-even-header-name&quot; etc.</span>&nbsp;</div></li><li><div>                  preg_match_all('/\\S{1, 32}=[&quot;][^&quot;]*[&quot;]/', $e, $contents1);&nbsp;</div></li><li><div>                  preg_match_all('/\\S{1, 32}=[\'][^\']*[\']/i', $e, $contents2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $contents = array_merge($contents1, $contents2);&nbsp;</div></li><li><div>                  preg_match('/\\S+/', $e, $a2);&nbsp;</div></li><li><div>                  $tag = (isset($a2[0]) ? strtoupper($a2[0]) : '');&nbsp;</div></li><li><div>                  $attr = array();&nbsp;</div></li><li><div>                  if ($orig_srcpath) {&nbsp;</div></li><li><div>                      $attr['ORIG_SRC'] = $orig_srcpath;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!empty($contents)) {&nbsp;</div></li><li><div>                      foreach ($contents[0] as $v) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment">// Changed to allow style=&quot;background: url('bg.jpg')&quot;</span></span></span>&nbsp;</div></li><li><div>                          if (preg_match('/^([^=]*)=[&quot;]?([^&quot;]*)[&quot;]?$/', $v, $a3) || preg_match('/^([^=]*)=[\']?([^\']*)[\']?$/', $v, $a3)) {&nbsp;</div></li><li><div>                              if (strtoupper($a3[1]) == 'ID' || strtoupper($a3[1]) == 'CLASS') { <span class="comment">// 4.2.013 Omits STYLE</span>&nbsp;</div></li><li><div>                                  $attr[strtoupper($a3[1])] = trim(strtoupper($a3[2]));&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              <span class="comment">// includes header-style-right etc. used for &lt;pageheader&gt;</span>&nbsp;</div></li><li><div>                              elseif (preg_match('/^(HEADER|FOOTER)-STYLE/i', $a3[1])) {&nbsp;</div></li><li><div>                                  $attr[strtoupper($a3[1])] = trim(strtoupper($a3[2]));&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $attr[strtoupper($a3[1])] = trim($a3[2]);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;tag-&gt;OpenTag($tag, $attr, $a, $i); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;inFixedPosBlock) {&nbsp;</div></li><li><div>                      $this-&gt;fixedPosBlockBBox = array($tag, $attr, $this-&gt;x, $this-&gt;y);&nbsp;</div></li><li><div>                      $this-&gt;fixedPosBlock = '';&nbsp;</div></li><li><div>                      $this-&gt;fixedPosBlockDepth = 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>                  if (preg_match('/\/$/', $e)) {&nbsp;</div></li><li><div>                      $this-&gt;tag-&gt;CloseTag($tag, $a, $i);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } <span class="comment">// end TAG</span>&nbsp;</div></li><li><div>      } <span class="comment">//end of    foreach($a as $i=&gt;$e)</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($close) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Close any open block tags</span></span></span></span>&nbsp;</div></li><li><div>          for ($b = $this-&gt;blklvl; $b &gt; 0; $b--) {&nbsp;</div></li><li><div>              $this-&gt;tag-&gt;CloseTag($this-&gt;blk[$b]['tag'], $a, $i);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Output any text left in buffer</span></span></span>&nbsp;</div></li><li><div>          if (count($this-&gt;textbuffer) && !$parseonly) {&nbsp;</div></li><li><div>              $this-&gt;printbuffer($this-&gt;textbuffer);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$parseonly)&nbsp;</div></li><li><div>              $this-&gt;textbuffer = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment">// If ended with a float, need to move to end page</span>&nbsp;</div></li><li><div>          $currpos = $this-&gt;page * 1000 + $this-&gt;y;&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['float_endpos']) && $this-&gt;blk[$this-&gt;blklvl]['float_endpos'] &gt; $currpos) {&nbsp;</div></li><li><div>              $old_page = $this-&gt;page;&nbsp;</div></li><li><div>              $new_page = intval($this-&gt;blk[$this-&gt;blklvl]['float_endpos'] / 1000);&nbsp;</div></li><li><div>              if ($old_page != $new_page) {&nbsp;</div></li><li><div>                  $s = $this-&gt;PrintPageBackgrounds();&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// Writes after the marker so not overwritten later by page background etc.</span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;pages[$this-&gt;page] = preg_replace('/(___BACKGROUND___PATTERNS' . $this-&gt;uniqstr . ')/', '\\1' . &quot;\n&quot; . $s . &quot;\n&quot;, $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>                  $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>                  $this-&gt;page = $new_page;&nbsp;</div></li><li><div>                  $this-&gt;ResetMargins();&nbsp;</div></li><li><div>                  $this-&gt;Reset();&nbsp;</div></li><li><div>                  $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;y = (($this-&gt;blk[$this-&gt;blklvl]['float_endpos'] * 1000) % 1000000) / 1000; <span class="comment"><span class="comment">// mod changes operands to integers before processing</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;printfloatbuffer();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">//Create Internal Links, if needed</span>&nbsp;</div></li><li><div>          if (!empty($this-&gt;internallink)) {&nbsp;</div></li><li><div>              foreach ($this-&gt;internallink as $k =&gt; $v) {&nbsp;</div></li><li><div>                  if (strpos($k, &quot;#&quot;) !== false) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  } <span class="comment">//ignore</span>&nbsp;</div></li><li><div>                  $ypos = $v['Y'];&nbsp;</div></li><li><div>                  $pagenum = $v['PAGE'];&nbsp;</div></li><li><div>                  $sharp = &quot;#&quot;;&nbsp;</div></li><li><div>                  while (array_key_exists($sharp . $k, $this-&gt;internallink)) {&nbsp;</div></li><li><div>                      $internallink = $this-&gt;internallink[$sharp . $k];&nbsp;</div></li><li><div>                      $this-&gt;SetLink($internallink, $ypos, $pagenum);&nbsp;</div></li><li><div>                      $sharp .= &quot;#&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;bufferoutput = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>          if (count($this-&gt;fixedPosBlockSave)) {&nbsp;</div></li><li><div>              foreach ($this-&gt;fixedPosBlockSave AS $fpbs) {&nbsp;</div></li><li><div>                  $old_page = $this-&gt;page;&nbsp;</div></li><li><div>                  $this-&gt;page = $fpbs[2];&nbsp;</div></li><li><div>                  $this-&gt;WriteFixedPosHTML($fpbs[0], 0, 0, 100, 100, 'auto', $fpbs[1]);  <span class="comment">// 0, 0, 10, 10 are overwritten by bbox</span>&nbsp;</div></li><li><div>                  $this-&gt;page = $old_page;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;fixedPosBlockSave = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function WriteFixedPosHTML($html = '', $x, $y, $w, $h, $overflow = 'visible', $bounding = array())&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// $overflow can be 'hidden', 'visible' or 'auto' - 'auto' causes autofit to size</span>&nbsp;</div></li><li><div>      <span class="comment">// Annotations disabled - enabled in mPDF 5.0</span>&nbsp;</div></li><li><div>      <span class="comment">// Links do work</span>&nbsp;</div></li><li><div>      <span class="comment">// Will always go on current page (or start Page 1 if required)</span>&nbsp;</div></li><li><div>      <span class="comment">// Probably INCOMPATIBLE WITH keep with table, columns etc.</span>&nbsp;</div></li><li><div>      <span class="comment">// Called externally or interally via &lt;div style=&quot;position: [fixed|absolute]&quot;&gt;</span>&nbsp;</div></li><li><div>      <span class="comment">// When used internally, $x $y $w $h and $overflow are all overridden by $bounding</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $overflow = strtolower($overflow);&nbsp;</div></li><li><div>      if ($this-&gt;state == 0) {&nbsp;</div></li><li><div>          $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $save_y = $this-&gt;y;&nbsp;</div></li><li><div>      $save_x = $this-&gt;x;&nbsp;</div></li><li><div>      $this-&gt;fullImageHeight = $this-&gt;h;&nbsp;</div></li><li><div>      $save_cols = false;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          $save_cols = true;&nbsp;</div></li><li><div>          $save_nbcol = $this-&gt;NbCol; <span class="comment"><span class="comment">// other values of gap and vAlign will not change by setting Columns off</span></span>&nbsp;</div></li><li><div>          $this-&gt;SetColumns(0);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $save_annots = $this-&gt;title2annots; <span class="comment"><span class="comment">// *ANNOTATIONS*</span></span>&nbsp;</div></li><li><div>      $this-&gt;writingHTMLheader = true; <span class="comment">// a FIX to stop pagebreaks etc.</span>&nbsp;</div></li><li><div>      $this-&gt;writingHTMLfooter = true;&nbsp;</div></li><li><div>      $this-&gt;InFooter = true; <span class="comment">// suppresses autopagebreaks</span>&nbsp;</div></li><li><div>      $save_bgs = $this-&gt;pageBackgrounds;&nbsp;</div></li><li><div>      $checkinnerhtml = preg_replace('/\s/', '', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($w &gt; $this-&gt;w) {&nbsp;</div></li><li><div>          $x = 0;&nbsp;</div></li><li><div>          $w = $this-&gt;w;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($h &gt; $this-&gt;h) {&nbsp;</div></li><li><div>          $y = 0;&nbsp;</div></li><li><div>          $h = $this-&gt;h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($x &gt; $this-&gt;w) {&nbsp;</div></li><li><div>          $x = $this-&gt;w - $w;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($y &gt; $this-&gt;h) {&nbsp;</div></li><li><div>          $y = $this-&gt;h - $h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!empty($bounding)) {&nbsp;</div></li><li><div>          <span class="comment">// $cont_ containing block = full physical page (position: absolute) or page inside margins (position: fixed)</span>&nbsp;</div></li><li><div>          <span class="comment">// $bbox_ Bounding box is the &lt;div&gt; which is positioned absolutely/fixed</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// top</span>/left/right/bottom/width/height/background*/border*/padding*/margin* are taken from bounding</span>&nbsp;</div></li><li><div>          <span class="comment">// font*[family/size/style/weight]/line-height/text*[align/decoration/transform/indent]/color are transferred to $inner</span>&nbsp;</div></li><li><div>          <span class="comment">// as an enclosing &lt;div&gt; (after having checked ID/CLASS)</span>&nbsp;</div></li><li><div>          <span class="comment">// $x, $y, $w, $h are inside of $bbox_ = containing box for $inner_</span>&nbsp;</div></li><li><div>          <span class="comment">// $inner_ InnerHTML is the contents of that block to be output</span>&nbsp;</div></li><li><div>          $tag = $bounding[0];&nbsp;</div></li><li><div>          $attr = $bounding[1];&nbsp;</div></li><li><div>          $orig_x0 = $bounding[2];&nbsp;</div></li><li><div>          $orig_y0 = $bounding[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// As in WriteHTML() initialising</span>&nbsp;</div></li><li><div>          $this-&gt;blklvl = 0;&nbsp;</div></li><li><div>          $this-&gt;lastblocklevelchange = 0;&nbsp;</div></li><li><div>          $this-&gt;blk = array();&nbsp;</div></li><li><div>          $this-&gt;initialiseBlock($this-&gt;blk[0]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;blk[0]['width'] = & $this-&gt;pgwidth;&nbsp;</div></li><li><div>          $this-&gt;blk[0]['inner_width'] = & $this-&gt;pgwidth;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;blk[0]['blockContext'] = $this-&gt;blockContext;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $properties = $this-&gt;cssmgr-&gt;MergeCSS('BLOCK', 'BODY', '');&nbsp;</div></li><li><div>          $this-&gt;setCSS($properties, '', 'BODY');&nbsp;</div></li><li><div>          $this-&gt;blklvl = 1;&nbsp;</div></li><li><div>          $this-&gt;initialiseBlock($this-&gt;blk[1]);&nbsp;</div></li><li><div>          $this-&gt;blk[1]['tag'] = $tag;&nbsp;</div></li><li><div>          $this-&gt;blk[1]['attr'] = $attr;&nbsp;</div></li><li><div>          $this-&gt;Reset();&nbsp;</div></li><li><div>          $p = $this-&gt;cssmgr-&gt;MergeCSS('BLOCK', $tag, $attr);&nbsp;</div></li><li><div>          if (isset($p['ROTATE']) && ($p['ROTATE'] == 90 || $p['ROTATE'] == -90 || $p['ROTATE'] == 180)) {&nbsp;</div></li><li><div>              $rotate = $p['ROTATE'];&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $rotate = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['OVERFLOW'])) {&nbsp;</div></li><li><div>              $overflow = strtolower($p['OVERFLOW']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (strtolower($p['POSITION']) == 'fixed') {&nbsp;</div></li><li><div>              $cont_w = $this-&gt;pgwidth; <span class="comment">// $this-&gt;blk[0]['inner_width'];</span>&nbsp;</div></li><li><div>              $cont_h = $this-&gt;h - $this-&gt;tMargin - $this-&gt;bMargin;&nbsp;</div></li><li><div>              $cont_x = $this-&gt;lMargin;&nbsp;</div></li><li><div>              $cont_y = $this-&gt;tMargin;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $cont_w = $this-&gt;w; <span class="comment">// ABSOLUTE;</span>&nbsp;</div></li><li><div>              $cont_h = $this-&gt;h;&nbsp;</div></li><li><div>              $cont_x = 0;&nbsp;</div></li><li><div>              $cont_y = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Pass on in-line properties to the innerhtml</span>&nbsp;</div></li><li><div>          $css = '';&nbsp;</div></li><li><div>          if (isset($p['TEXT-ALIGN'])) {&nbsp;</div></li><li><div>              $css .= 'text-align: ' . strtolower($p['TEXT-ALIGN']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['TEXT-TRANSFORM'])) {&nbsp;</div></li><li><div>              $css .= 'text-transform: ' . strtolower($p['TEXT-TRANSFORM']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['TEXT-INDENT'])) {&nbsp;</div></li><li><div>              $css .= 'text-indent: ' . strtolower($p['TEXT-INDENT']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['TEXT-DECORATION'])) {&nbsp;</div></li><li><div>              $css .= 'text-decoration: ' . strtolower($p['TEXT-DECORATION']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-FAMILY'])) {&nbsp;</div></li><li><div>              $css .= 'font-family: ' . strtolower($p['FONT-FAMILY']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-STYLE'])) {&nbsp;</div></li><li><div>              $css .= 'font-style: ' . strtolower($p['FONT-STYLE']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-WEIGHT'])) {&nbsp;</div></li><li><div>              $css .= 'font-weight: ' . strtolower($p['FONT-WEIGHT']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-SIZE'])) {&nbsp;</div></li><li><div>              $css .= 'font-size: ' . strtolower($p['FONT-SIZE']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['LINE-HEIGHT'])) {&nbsp;</div></li><li><div>              $css .= 'line-height: ' . strtolower($p['LINE-HEIGHT']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['TEXT-SHADOW'])) {&nbsp;</div></li><li><div>              $css .= 'text-shadow: ' . strtolower($p['TEXT-SHADOW']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['LETTER-SPACING'])) {&nbsp;</div></li><li><div>              $css .= 'letter-spacing: ' . strtolower($p['LETTER-SPACING']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($p['FONT-VARIANT-POSITION'])) {&nbsp;</div></li><li><div>              $css .= 'font-variant-position: ' . strtolower($p['FONT-VARIANT-POSITION']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-VARIANT-CAPS'])) {&nbsp;</div></li><li><div>              $css .= 'font-variant-caps: ' . strtolower($p['FONT-VARIANT-CAPS']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-VARIANT-LIGATURES'])) {&nbsp;</div></li><li><div>              $css .= 'font-variant-ligatures: ' . strtolower($p['FONT-VARIANT-LIGATURES']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-VARIANT-NUMERIC'])) {&nbsp;</div></li><li><div>              $css .= 'font-variant-numeric: ' . strtolower($p['FONT-VARIANT-NUMERIC']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-VARIANT-ALTERNATES'])) {&nbsp;</div></li><li><div>              $css .= 'font-variant-alternates: ' . strtolower($p['FONT-VARIANT-ALTERNATES']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-FEATURE-SETTINGS'])) {&nbsp;</div></li><li><div>              $css .= 'font-feature-settings: ' . strtolower($p['FONT-FEATURE-SETTINGS']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-LANGUAGE-OVERRIDE'])) {&nbsp;</div></li><li><div>              $css .= 'font-language-override: ' . strtolower($p['FONT-LANGUAGE-OVERRIDE']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['FONT-KERNING'])) {&nbsp;</div></li><li><div>              $css .= 'font-kerning: ' . strtolower($p['FONT-KERNING']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($p['COLOR'])) {&nbsp;</div></li><li><div>              $css .= 'color: ' . strtolower($p['COLOR']) . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['Z-INDEX'])) {&nbsp;</div></li><li><div>              $css .= 'z-index: ' . $p['Z-INDEX'] . '; ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($css) {&nbsp;</div></li><li><div>              $html = '&lt;div style=&quot;' . $css . '&quot;&gt;' . $html . '&lt;/div&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Copy over (only) the properties to set for border and background</span>&nbsp;</div></li><li><div>          $pb = array();&nbsp;</div></li><li><div>          $pb['MARGIN-TOP'] = (isset($p['MARGIN-TOP']) ? $p['MARGIN-TOP'] : '');&nbsp;</div></li><li><div>          $pb['MARGIN-RIGHT'] = (isset($p['MARGIN-RIGHT']) ? $p['MARGIN-RIGHT'] : '');&nbsp;</div></li><li><div>          $pb['MARGIN-BOTTOM'] = (isset($p['MARGIN-BOTTOM']) ? $p['MARGIN-BOTTOM'] : '');&nbsp;</div></li><li><div>          $pb['MARGIN-LEFT'] = (isset($p['MARGIN-LEFT']) ? $p['MARGIN-LEFT'] : '');&nbsp;</div></li><li><div>          $pb['PADDING-TOP'] = (isset($p['PADDING-TOP']) ? $p['PADDING-TOP'] : '');&nbsp;</div></li><li><div>          $pb['PADDING-RIGHT'] = (isset($p['PADDING-RIGHT']) ? $p['PADDING-RIGHT'] : '');&nbsp;</div></li><li><div>          $pb['PADDING-BOTTOM'] = (isset($p['PADDING-BOTTOM']) ? $p['PADDING-BOTTOM'] : '');&nbsp;</div></li><li><div>          $pb['PADDING-LEFT'] = (isset($p['PADDING-LEFT']) ? $p['PADDING-LEFT'] : '');&nbsp;</div></li><li><div>          $pb['BORDER-TOP'] = (isset($p['BORDER-TOP']) ? $p['BORDER-TOP'] : '');&nbsp;</div></li><li><div>          $pb['BORDER-RIGHT'] = (isset($p['BORDER-RIGHT']) ? $p['BORDER-RIGHT'] : '');&nbsp;</div></li><li><div>          $pb['BORDER-BOTTOM'] = (isset($p['BORDER-BOTTOM']) ? $p['BORDER-BOTTOM'] : '');&nbsp;</div></li><li><div>          $pb['BORDER-LEFT'] = (isset($p['BORDER-LEFT']) ? $p['BORDER-LEFT'] : '');&nbsp;</div></li><li><div>          if (isset($p['BORDER-TOP-LEFT-RADIUS-H'])) {&nbsp;</div></li><li><div>              $pb['BORDER-TOP-LEFT-RADIUS-H'] = $p['BORDER-TOP-LEFT-RADIUS-H'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BORDER-TOP-LEFT-RADIUS-V'])) {&nbsp;</div></li><li><div>              $pb['BORDER-TOP-LEFT-RADIUS-V'] = $p['BORDER-TOP-LEFT-RADIUS-V'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BORDER-TOP-RIGHT-RADIUS-H'])) {&nbsp;</div></li><li><div>              $pb['BORDER-TOP-RIGHT-RADIUS-H'] = $p['BORDER-TOP-RIGHT-RADIUS-H'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BORDER-TOP-RIGHT-RADIUS-V'])) {&nbsp;</div></li><li><div>              $pb['BORDER-TOP-RIGHT-RADIUS-V'] = $p['BORDER-TOP-RIGHT-RADIUS-V'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BORDER-BOTTOM-LEFT-RADIUS-H'])) {&nbsp;</div></li><li><div>              $pb['BORDER-BOTTOM-LEFT-RADIUS-H'] = $p['BORDER-BOTTOM-LEFT-RADIUS-H'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BORDER-BOTTOM-LEFT-RADIUS-V'])) {&nbsp;</div></li><li><div>              $pb['BORDER-BOTTOM-LEFT-RADIUS-V'] = $p['BORDER-BOTTOM-LEFT-RADIUS-V'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BORDER-BOTTOM-RIGHT-RADIUS-H'])) {&nbsp;</div></li><li><div>              $pb['BORDER-BOTTOM-RIGHT-RADIUS-H'] = $p['BORDER-BOTTOM-RIGHT-RADIUS-H'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BORDER-BOTTOM-RIGHT-RADIUS-V'])) {&nbsp;</div></li><li><div>              $pb['BORDER-BOTTOM-RIGHT-RADIUS-V'] = $p['BORDER-BOTTOM-RIGHT-RADIUS-V'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-COLOR'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-COLOR'] = $p['BACKGROUND-COLOR'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BOX-SHADOW'])) {&nbsp;</div></li><li><div>              $pb['BOX-SHADOW'] = $p['BOX-SHADOW'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-IMAGE'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-IMAGE'] = $p['BACKGROUND-IMAGE'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-IMAGE-RESIZE'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-IMAGE-RESIZE'] = $p['BACKGROUND-IMAGE-RESIZE'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-IMAGE-OPACITY'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-IMAGE-OPACITY'] = $p['BACKGROUND-IMAGE-OPACITY'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-REPEAT'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-REPEAT'] = $p['BACKGROUND-REPEAT'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-POSITION'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-POSITION'] = $p['BACKGROUND-POSITION'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-GRADIENT'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-GRADIENT'] = $p['BACKGROUND-GRADIENT'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-SIZE'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-SIZE'] = $p['BACKGROUND-SIZE'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-ORIGIN'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-ORIGIN'] = $p['BACKGROUND-ORIGIN'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BACKGROUND-CLIP'])) {&nbsp;</div></li><li><div>              $pb['BACKGROUND-CLIP'] = $p['BACKGROUND-CLIP'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;setCSS($pb, 'BLOCK', $tag);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>          $bbox_br = $this-&gt;blk[1]['border_right']['w'];&nbsp;</div></li><li><div>          $bbox_bl = $this-&gt;blk[1]['border_left']['w'];&nbsp;</div></li><li><div>          $bbox_bt = $this-&gt;blk[1]['border_top']['w'];&nbsp;</div></li><li><div>          $bbox_bb = $this-&gt;blk[1]['border_bottom']['w'];&nbsp;</div></li><li><div>          $bbox_pr = $this-&gt;blk[1]['padding_right'];&nbsp;</div></li><li><div>          $bbox_pl = $this-&gt;blk[1]['padding_left'];&nbsp;</div></li><li><div>          $bbox_pt = $this-&gt;blk[1]['padding_top'];&nbsp;</div></li><li><div>          $bbox_pb = $this-&gt;blk[1]['padding_bottom'];&nbsp;</div></li><li><div>          $bbox_mr = $this-&gt;blk[1]['margin_right'];&nbsp;</div></li><li><div>          if (isset($p['MARGIN-RIGHT']) && strtolower($p['MARGIN-RIGHT']) == 'auto') {&nbsp;</div></li><li><div>              $bbox_mr = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $bbox_ml = $this-&gt;blk[1]['margin_left'];&nbsp;</div></li><li><div>          if (isset($p['MARGIN-LEFT']) && strtolower($p['MARGIN-LEFT']) == 'auto') {&nbsp;</div></li><li><div>              $bbox_ml = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $bbox_mt = $this-&gt;blk[1]['margin_top'];&nbsp;</div></li><li><div>          if (isset($p['MARGIN-TOP']) && strtolower($p['MARGIN-TOP']) == 'auto') {&nbsp;</div></li><li><div>              $bbox_mt = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $bbox_mb = $this-&gt;blk[1]['margin_bottom'];&nbsp;</div></li><li><div>          if (isset($p['MARGIN-BOTTOM']) && strtolower($p['MARGIN-BOTTOM']) == 'auto') {&nbsp;</div></li><li><div>              $bbox_mb = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['LEFT']) && strtolower($p['LEFT']) != 'auto') {&nbsp;</div></li><li><div>              $bbox_left = $this-&gt;ConvertSize($p['LEFT'], $cont_w, $this-&gt;FontSize, false);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $bbox_left = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['TOP']) && strtolower($p['TOP']) != 'auto') {&nbsp;</div></li><li><div>              $bbox_top = $this-&gt;ConvertSize($p['TOP'], $cont_h, $this-&gt;FontSize, false);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $bbox_top = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['RIGHT']) && strtolower($p['RIGHT']) != 'auto') {&nbsp;</div></li><li><div>              $bbox_right = $this-&gt;ConvertSize($p['RIGHT'], $cont_w, $this-&gt;FontSize, false);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $bbox_right = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['BOTTOM']) && strtolower($p['BOTTOM']) != 'auto') {&nbsp;</div></li><li><div>              $bbox_bottom = $this-&gt;ConvertSize($p['BOTTOM'], $cont_h, $this-&gt;FontSize, false);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $bbox_bottom = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['WIDTH']) && strtolower($p['WIDTH']) != 'auto') {&nbsp;</div></li><li><div>              $inner_w = $this-&gt;ConvertSize($p['WIDTH'], $cont_w, $this-&gt;FontSize, false);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $inner_w = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['HEIGHT']) && strtolower($p['HEIGHT']) != 'auto') {&nbsp;</div></li><li><div>              $inner_h = $this-&gt;ConvertSize($p['HEIGHT'], $cont_h, $this-&gt;FontSize, false);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $inner_h = 'auto';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If bottom or right pos are set and not left / top - save this to adjust rotated block later</span>&nbsp;</div></li><li><div>          if ($rotate == 90 || $rotate == -90) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($bbox_left === 'auto' && $bbox_right !== 'auto') {&nbsp;</div></li><li><div>                  $rot_rpos = $bbox_right;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $rot_rpos = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbox_top === 'auto' && $bbox_bottom !== 'auto') {&nbsp;</div></li><li><div>                  $rot_bpos = $bbox_bottom;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $rot_bpos = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>          if ($checkinnerhtml == '' && $inner_h === 'auto') {&nbsp;</div></li><li><div>              $inner_h = 0.0001;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($checkinnerhtml == '' && $inner_w === 'auto') {&nbsp;</div></li><li><div>              $inner_w = 2 * $this-&gt;GetCharWidth('W', false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>          <span class="comment">// Algorithm from CSS2.1  See http://www.w3.org/TR/CSS21/visudet.html#abs-non-replaced-height</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// mPD 5.3.14</span></span>&nbsp;</div></li><li><div>          <span class="comment">// Special case (not CSS) if all not specified, centre vertically on page</span>&nbsp;</div></li><li><div>          $bbox_top_orig = '';&nbsp;</div></li><li><div>          if ($bbox_top === 'auto' && $inner_h === 'auto' && $bbox_bottom === 'auto' && $bbox_mt === 'auto' && $bbox_mb === 'auto') {&nbsp;</div></li><li><div>              $bbox_top_orig = $bbox_top;&nbsp;</div></li><li><div>              if ($bbox_mt === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mt = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbox_mb === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mb = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $bbox_top = $orig_y0 - $bbox_mt - $cont_y;&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// solve for $bbox_bottom when content_h known - $inner_h=='auto' && $bbox_bottom=='auto'</span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// mPD 5.3.14</span></span>&nbsp;</div></li><li><div>          elseif ($bbox_top === 'auto' && $inner_h === 'auto' && $bbox_bottom === 'auto') {&nbsp;</div></li><li><div>              $bbox_top_orig = $bbox_top = $orig_y0 - $cont_y;&nbsp;</div></li><li><div>              if ($bbox_mt === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mt = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbox_mb === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mb = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// solve for $bbox_bottom when content_h known - $inner_h=='auto' && $bbox_bottom=='auto'</span></span></span>&nbsp;</div></li><li><div>          } elseif ($bbox_top !== 'auto' && $inner_h !== 'auto' && $bbox_bottom !== 'auto') {&nbsp;</div></li><li><div>              if ($bbox_mt === 'auto' && $bbox_mb === 'auto') {&nbsp;</div></li><li><div>                  $x = $cont_h - $bbox_top - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_bottom;&nbsp;</div></li><li><div>                  $bbox_mt = $bbox_mb = ($x / 2);&nbsp;</div></li><li><div>              } elseif ($bbox_mt === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mt = $cont_h - $bbox_top - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_mb - $bbox_bottom;&nbsp;</div></li><li><div>              } elseif ($bbox_mb === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mb = $cont_h - $bbox_top - $bbox_mt - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_bottom;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $bbox_bottom = $cont_h - $bbox_top - $bbox_mt - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_mt;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ($bbox_mt === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mt = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbox_mb === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mb = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbox_top === 'auto' && $inner_h === 'auto' && $bbox_bottom !== 'auto') {&nbsp;</div></li><li><div>                  <span class="comment">// solve for $bbox_top when content_h known - $inner_h=='auto' && $bbox_top =='auto'</span>&nbsp;</div></li><li><div>              } elseif ($bbox_top === 'auto' && $bbox_bottom === 'auto' && $inner_h !== 'auto') {&nbsp;</div></li><li><div>                  $bbox_top = $orig_y0 - $bbox_mt - $cont_y;&nbsp;</div></li><li><div>                  $bbox_bottom = $cont_h - $bbox_top - $bbox_mt - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_mt;&nbsp;</div></li><li><div>              } elseif ($inner_h === 'auto' && $bbox_bottom === 'auto' && $bbox_top !== 'auto') {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// solve for $bbox_bottom when content_h known - $inner_h=='auto' && $bbox_bottom=='auto'</span></span></span>&nbsp;</div></li><li><div>              } elseif ($bbox_top === 'auto' && $inner_h !== 'auto' && $bbox_bottom !== 'auto') {&nbsp;</div></li><li><div>                  $bbox_top = $cont_h - $bbox_mt - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_mt - $bbox_bottom;&nbsp;</div></li><li><div>              } elseif ($inner_h === 'auto' && $bbox_top !== 'auto' && $bbox_bottom !== 'auto') {&nbsp;</div></li><li><div>                  $inner_h = $cont_h - $bbox_top - $bbox_mt - $bbox_bt - $bbox_pt - $bbox_pb - $bbox_bb - $bbox_mt - $bbox_bottom;&nbsp;</div></li><li><div>              } elseif ($bbox_bottom === 'auto' && $bbox_top !== 'auto' && $inner_h !== 'auto') {&nbsp;</div></li><li><div>                  $bbox_bottom = $cont_h - $bbox_top - $bbox_mt - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_mt;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// THEN DO SAME FOR WIDTH</span>&nbsp;</div></li><li><div>          <span class="comment">// http://www.w3.org/TR/CSS21/visudet.html#abs-non-replaced-width</span>&nbsp;</div></li><li><div>          if ($bbox_left === 'auto' && $inner_w === 'auto' && $bbox_right === 'auto') {&nbsp;</div></li><li><div>              if ($bbox_ml === 'auto') {&nbsp;</div></li><li><div>                  $bbox_ml = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbox_mr === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mr = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// IF containing element RTL, should set $bbox_right</span></span>&nbsp;</div></li><li><div>              $bbox_left = $orig_x0 - $bbox_ml - $cont_x;&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// solve for $bbox_right when content_w known - $inner_w=='auto' && $bbox_right=='auto'</span></span>&nbsp;</div></li><li><div>          } elseif ($bbox_left !== 'auto' && $inner_w !== 'auto' && $bbox_right !== 'auto') {&nbsp;</div></li><li><div>              if ($bbox_ml === 'auto' && $bbox_mr === 'auto') {&nbsp;</div></li><li><div>                  $x = $cont_w - $bbox_left - $bbox_bl - $bbox_pl - $inner_w - $bbox_pr - $bbox_br - $bbox_right;&nbsp;</div></li><li><div>                  $bbox_ml = $bbox_mr = ($x / 2);&nbsp;</div></li><li><div>              } elseif ($bbox_ml === 'auto') {&nbsp;</div></li><li><div>                  $bbox_ml = $cont_w - $bbox_left - $bbox_bl - $bbox_pl - $inner_w - $bbox_pr - $bbox_br - $bbox_mr - $bbox_right;&nbsp;</div></li><li><div>              } elseif ($bbox_mr === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mr = $cont_w - $bbox_left - $bbox_ml - $bbox_bl - $bbox_pl - $inner_w - $bbox_pr - $bbox_br - $bbox_right;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $bbox_right = $cont_w - $bbox_left - $bbox_ml - $bbox_bl - $bbox_pl - $inner_w - $bbox_pr - $bbox_br - $bbox_ml;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ($bbox_ml === 'auto') {&nbsp;</div></li><li><div>                  $bbox_ml = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbox_mr === 'auto') {&nbsp;</div></li><li><div>                  $bbox_mr = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbox_left === 'auto' && $inner_w === 'auto' && $bbox_right !== 'auto') {&nbsp;</div></li><li><div>                  <span class="comment">// solve for $bbox_left when content_w known - $inner_w=='auto' && $bbox_left =='auto'</span>&nbsp;</div></li><li><div>              } elseif ($bbox_left === 'auto' && $bbox_right === 'auto' && $inner_w !== 'auto') {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// IF containing element RTL, should set $bbox_right</span></span>&nbsp;</div></li><li><div>                  $bbox_left = $orig_x0 - $bbox_ml - $cont_x;&nbsp;</div></li><li><div>                  $bbox_right = $cont_w - $bbox_left - $bbox_ml - $bbox_bl - $bbox_pl - $inner_w - $bbox_pr - $bbox_br - $bbox_ml;&nbsp;</div></li><li><div>              } elseif ($inner_w === 'auto' && $bbox_right === 'auto' && $bbox_left !== 'auto') {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// solve for $bbox_right when content_w known - $inner_w=='auto' && $bbox_right=='auto'</span></span>&nbsp;</div></li><li><div>              } elseif ($bbox_left === 'auto' && $inner_w !== 'auto' && $bbox_right !== 'auto') {&nbsp;</div></li><li><div>                  $bbox_left = $cont_w - $bbox_ml - $bbox_bl - $bbox_pl - $inner_w - $bbox_pr - $bbox_br - $bbox_ml - $bbox_right;&nbsp;</div></li><li><div>              } elseif ($inner_w === 'auto' && $bbox_left !== 'auto' && $bbox_right !== 'auto') {&nbsp;</div></li><li><div>                  $inner_w = $cont_w - $bbox_left - $bbox_ml - $bbox_bl - $bbox_pl - $bbox_pr - $bbox_br - $bbox_ml - $bbox_right;&nbsp;</div></li><li><div>              } elseif ($bbox_right === 'auto' && $bbox_left !== 'auto' && $inner_w !== 'auto') {&nbsp;</div></li><li><div>                  $bbox_right = $cont_w - $bbox_left - $bbox_ml - $bbox_bl - $bbox_pl - $inner_w - $bbox_pr - $bbox_br - $bbox_ml;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($pb['BACKGROUND-IMAGE']) && $pb['BACKGROUND-IMAGE']) {&nbsp;</div></li><li><div>              $ret = $this-&gt;SetBackground($pb, $this-&gt;blk[1]['inner_width']);&nbsp;</div></li><li><div>              if ($ret) {&nbsp;</div></li><li><div>                  $this-&gt;blk[1]['background-image'] = $ret;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>          $y = $cont_y + $bbox_top + $bbox_mt + $bbox_bt + $bbox_pt;&nbsp;</div></li><li><div>          $h = $cont_h - $bbox_top - $bbox_mt - $bbox_bt - $bbox_pt - $bbox_pb - $bbox_bb - $bbox_mb - $bbox_bottom;&nbsp;</div></li><li><div>          $x = $cont_x + $bbox_left + $bbox_ml + $bbox_bl + $bbox_pl;&nbsp;</div></li><li><div>          $w = $cont_w - $bbox_left - $bbox_ml - $bbox_bl - $bbox_pl - $bbox_pr - $bbox_br - $bbox_mr - $bbox_right;&nbsp;</div></li><li><div>          <span class="comment">// Set (temporary) values for x y w h to do first paint, if values are auto</span>&nbsp;</div></li><li><div>          if ($inner_h === 'auto' && $bbox_top === 'auto') {&nbsp;</div></li><li><div>              $y = $cont_y + $bbox_mt + $bbox_bt + $bbox_pt;&nbsp;</div></li><li><div>              $h = $cont_h - ($bbox_bottom + $bbox_mt + $bbox_mb + $bbox_bt + $bbox_bb + $bbox_pt + $bbox_pb);&nbsp;</div></li><li><div>          } elseif ($inner_h === 'auto' && $bbox_bottom === 'auto') {&nbsp;</div></li><li><div>              $y = $cont_y + $bbox_top + $bbox_mt + $bbox_bt + $bbox_pt;&nbsp;</div></li><li><div>              $h = $cont_h - ($bbox_top + $bbox_mt + $bbox_mb + $bbox_bt + $bbox_bb + $bbox_pt + $bbox_pb);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($inner_w === 'auto' && $bbox_left === 'auto') {&nbsp;</div></li><li><div>              $x = $cont_x + $bbox_ml + $bbox_bl + $bbox_pl;&nbsp;</div></li><li><div>              $w = $cont_w - ($bbox_right + $bbox_ml + $bbox_mr + $bbox_bl + $bbox_br + $bbox_pl + $bbox_pr);&nbsp;</div></li><li><div>          } elseif ($inner_w === 'auto' && $bbox_right === 'auto') {&nbsp;</div></li><li><div>              $x = $cont_x + $bbox_left + $bbox_ml + $bbox_bl + $bbox_pl;&nbsp;</div></li><li><div>              $w = $cont_w - ($bbox_left + $bbox_ml + $bbox_mr + $bbox_bl + $bbox_br + $bbox_pl + $bbox_pr);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $bbox_y = $cont_y + $bbox_top + $bbox_mt;&nbsp;</div></li><li><div>          $bbox_x = $cont_x + $bbox_left + $bbox_ml;&nbsp;</div></li><li><div>          $saved_block1 = $this-&gt;blk[1];&nbsp;</div></li><li><div>          unset($p);&nbsp;</div></li><li><div>          unset($pb);&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>          if ($inner_w === 'auto') { <span class="comment"><span class="comment">// do a first write</span></span>&nbsp;</div></li><li><div>              $this-&gt;lMargin = $x;&nbsp;</div></li><li><div>              $this-&gt;rMargin = $this-&gt;w - $w - $x;&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// SET POSITION & FONT VALUES</span></span></span>&nbsp;</div></li><li><div>              $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>              $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>              $this-&gt;x = $x;&nbsp;</div></li><li><div>              $this-&gt;y = $y;&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageLinks = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageAnnots = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageForms = array();&nbsp;</div></li><li><div>              $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>              $this-&gt;maxPosR = 0;&nbsp;</div></li><li><div>              $this-&gt;maxPosL = $this-&gt;w; <span class="comment">// For RTL</span>&nbsp;</div></li><li><div>              $this-&gt;WriteHTML($html, 4);&nbsp;</div></li><li><div>              $inner_w = $this-&gt;maxPosR - $this-&gt;lMargin;&nbsp;</div></li><li><div>              if ($bbox_right === 'auto') {&nbsp;</div></li><li><div>                  $bbox_right = $cont_w - $bbox_left - $bbox_ml - $bbox_bl - $bbox_pl - $inner_w - $bbox_pr - $bbox_br - $bbox_ml;&nbsp;</div></li><li><div>              } elseif ($bbox_left === 'auto') {&nbsp;</div></li><li><div>                  $bbox_left = $cont_w - $bbox_ml - $bbox_bl - $bbox_pl - $inner_w - $bbox_pr - $bbox_br - $bbox_ml - $bbox_right;&nbsp;</div></li><li><div>                  $bbox_x = $cont_x + $bbox_left + $bbox_ml;&nbsp;</div></li><li><div>                  $inner_x = $bbox_x + $bbox_bl + $bbox_pl;&nbsp;</div></li><li><div>                  $x = $inner_x;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $w = $inner_w;&nbsp;</div></li><li><div>              $bbox_y = $cont_y + $bbox_top + $bbox_mt;&nbsp;</div></li><li><div>              $bbox_x = $cont_x + $bbox_left + $bbox_ml;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($inner_h === 'auto') { <span class="comment"><span class="comment">// do a first write</span></span>&nbsp;</div></li><li><div>              $this-&gt;lMargin = $x;&nbsp;</div></li><li><div>              $this-&gt;rMargin = $this-&gt;w - $w - $x;&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// SET POSITION & FONT VALUES</span></span></span>&nbsp;</div></li><li><div>              $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>              $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>              $this-&gt;x = $x;&nbsp;</div></li><li><div>              $this-&gt;y = $y;&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageLinks = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageAnnots = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageForms = array();&nbsp;</div></li><li><div>              $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>              $this-&gt;WriteHTML($html, 4);&nbsp;</div></li><li><div>              $inner_h = $this-&gt;y - $y;&nbsp;</div></li><li><div>              if ($overflow != 'hidden' && $overflow != 'visible') { <span class="comment"><span class="comment"><span class="comment">// constrained</span></span></span>&nbsp;</div></li><li><div>                  if (($this-&gt;y + $bbox_pb + $bbox_bb) &gt; ($cont_y + $cont_h)) {&nbsp;</div></li><li><div>                      $adj = ($this-&gt;y + $bbox_pb + $bbox_bb) - ($cont_y + $cont_h);&nbsp;</div></li><li><div>                      $inner_h -= $adj;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($bbox_bottom === 'auto' && $bbox_top_orig === 'auto') {&nbsp;</div></li><li><div>                  $bbox_bottom = $bbox_top = ($cont_h - $bbox_mt - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_mb) / 2;&nbsp;</div></li><li><div>                  if ($overflow != 'hidden' && $overflow != 'visible') { <span class="comment"><span class="comment"><span class="comment">// constrained</span></span></span>&nbsp;</div></li><li><div>                      if ($bbox_top &lt; 0) {&nbsp;</div></li><li><div>                          $bbox_top = 0;&nbsp;</div></li><li><div>                          $inner_h = $cont_h - $bbox_top - $bbox_mt - $bbox_bt - $bbox_pt - $bbox_pb - $bbox_bb - $bbox_mb - $bbox_bottom;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $bbox_y = $cont_y + $bbox_top + $bbox_mt;&nbsp;</div></li><li><div>                  $inner_y = $bbox_y + $bbox_bt + $bbox_pt;&nbsp;</div></li><li><div>                  $y = $inner_y;&nbsp;</div></li><li><div>              } elseif ($bbox_bottom === 'auto') {&nbsp;</div></li><li><div>                  $bbox_bottom = $cont_h - $bbox_top - $bbox_mt - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_mb;&nbsp;</div></li><li><div>              } elseif ($bbox_top === 'auto') {&nbsp;</div></li><li><div>                  $bbox_top = $cont_h - $bbox_mt - $bbox_bt - $bbox_pt - $inner_h - $bbox_pb - $bbox_bb - $bbox_mb - $bbox_bottom;&nbsp;</div></li><li><div>                  if ($overflow != 'hidden' && $overflow != 'visible') { <span class="comment"><span class="comment"><span class="comment">// constrained</span></span></span>&nbsp;</div></li><li><div>                      if ($bbox_top &lt; 0) {&nbsp;</div></li><li><div>                          $bbox_top = 0;&nbsp;</div></li><li><div>                          $inner_h = $cont_h - $bbox_top - $bbox_mt - $bbox_bt - $bbox_pt - $bbox_pb - $bbox_bb - $bbox_mb - $bbox_bottom;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $bbox_y = $cont_y + $bbox_top + $bbox_mt;&nbsp;</div></li><li><div>                  $inner_y = $bbox_y + $bbox_bt + $bbox_pt;&nbsp;</div></li><li><div>                  $y = $inner_y;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $h = $inner_h;&nbsp;</div></li><li><div>              $bbox_y = $cont_y + $bbox_top + $bbox_mt;&nbsp;</div></li><li><div>              $bbox_x = $cont_x + $bbox_left + $bbox_ml;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $inner_w = $w;&nbsp;</div></li><li><div>          $inner_h = $h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;lMargin = $x;&nbsp;</div></li><li><div>      $this-&gt;rMargin = $this-&gt;w - $w - $x;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// SET POSITION & FONT VALUES</span></span></span>&nbsp;</div></li><li><div>      $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>      $this-&gt;x = $x;&nbsp;</div></li><li><div>      $this-&gt;y = $y;&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageLinks = array();&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageAnnots = array();&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageForms = array();&nbsp;</div></li><li><div>      $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>      $this-&gt;WriteHTML($html, 4); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// parameter 4 saves output to $this-&gt;headerbuffer</span></span></span></span></span>&nbsp;</div></li><li><div>      $actual_h = $this-&gt;y - $y;&nbsp;</div></li><li><div>      $use_w = $w;&nbsp;</div></li><li><div>      $use_h = $h;&nbsp;</div></li><li><div>      $ratio = $actual_h / $use_w;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($overflow != 'hidden' && $overflow != 'visible') {&nbsp;</div></li><li><div>          $target = $h / $w;&nbsp;</div></li><li><div>          if (($ratio / $target ) &gt; 1) {&nbsp;</div></li><li><div>              $nl = CEIL($actual_h / $this-&gt;lineheight);&nbsp;</div></li><li><div>              $l = $use_w * $nl;&nbsp;</div></li><li><div>              $est_w = sqrt(($l * $this-&gt;lineheight) / $target) * 0.8;&nbsp;</div></li><li><div>              $use_w += ($est_w - $use_w) - ($w / 100);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $bpcstart = ($ratio / $target);&nbsp;</div></li><li><div>          $bpcctr = 1;&nbsp;</div></li><li><div>          while (($ratio / $target ) &gt; 1) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;x = $x;&nbsp;</div></li><li><div>              $this-&gt;y = $y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (($ratio / $target) &gt; 1.5 || ($ratio / $target) &lt; 0.6) {&nbsp;</div></li><li><div>                  $use_w += ($w / $this-&gt;incrementFPR1);&nbsp;</div></li><li><div>              } elseif (($ratio / $target) &gt; 1.2 || ($ratio / $target) &lt; 0.85) {&nbsp;</div></li><li><div>                  $use_w += ($w / $this-&gt;incrementFPR2);&nbsp;</div></li><li><div>              } elseif (($ratio / $target) &gt; 1.1 || ($ratio / $target) &lt; 0.91) {&nbsp;</div></li><li><div>                  $use_w += ($w / $this-&gt;incrementFPR3);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $use_w += ($w / $this-&gt;incrementFPR4);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $use_h = $use_w * $target;&nbsp;</div></li><li><div>              $this-&gt;rMargin = $this-&gt;w - $use_w - $x;&nbsp;</div></li><li><div>              $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageLinks = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageAnnots = array();&nbsp;</div></li><li><div>              $this-&gt;HTMLheaderPageForms = array();&nbsp;</div></li><li><div>              $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>              $this-&gt;WriteHTML($html, 4); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// parameter 4 saves output to $this-&gt;headerbuffer</span></span></span></span></span>&nbsp;</div></li><li><div>              $actual_h = $this-&gt;y - $y;&nbsp;</div></li><li><div>              $ratio = $actual_h / $use_w;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $shrink_f = $w / $use_w;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] .= '___BEFORE_BORDERS___';&nbsp;</div></li><li><div>      $block_s = $this-&gt;PrintPageBackgrounds(); <span class="comment">// Save to print later inside clipping path</span>&nbsp;</div></li><li><div>      $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($rotate == 90 || $rotate == -90) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $prerotw = $bbox_bl + $bbox_pl + $inner_w + $bbox_pr + $bbox_br;&nbsp;</div></li><li><div>          $preroth = $bbox_bt + $bbox_pt + $inner_h + $bbox_pb + $bbox_bb;&nbsp;</div></li><li><div>          $rot_start = &quot; q\n&quot;;&nbsp;</div></li><li><div>          if ($rotate == 90) {&nbsp;</div></li><li><div>              if ($rot_rpos !== false) {&nbsp;</div></li><li><div>                  $adjw = $prerotw;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment">// width</span> before rotation</span></span>&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $adjw = $preroth;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// height</span></span></span> before rotation</span></span>&nbsp;</div></li><li><div>              if ($rot_bpos !== false) {&nbsp;</div></li><li><div>                  $adjh = -$prerotw + $preroth;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $adjh = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ($rot_rpos !== false) {&nbsp;</div></li><li><div>                  $adjw = $prerotw - $preroth;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $adjw = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($rot_bpos !== false) {&nbsp;</div></li><li><div>                  $adjh = $preroth;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// height</span></span></span> before rotation</span></span>&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $adjh = $prerotw;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment">// width</span> before rotation</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $rot_start .= $this-&gt;transformTranslate($adjw, $adjh, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>          $rot_start .= $this-&gt;transformRotate($rotate, $bbox_x, $bbox_y, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>          $rot_end = &quot; Q\n&quot;;&nbsp;</div></li><li><div>      } elseif ($rotate == 180) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $rot_start = &quot; q\n&quot;;&nbsp;</div></li><li><div>          $rot_start .= $this-&gt;transformTranslate($bbox_bl + $bbox_pl + $inner_w + $bbox_pr + $bbox_br, $bbox_bt + $bbox_pt + $inner_h + $bbox_pb + $bbox_bb, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>          $rot_start .= $this-&gt;transformRotate(180, $bbox_x, $bbox_y, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>          $rot_end = &quot; Q\n&quot;;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $rot_start = '';&nbsp;</div></li><li><div>          $rot_end = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>==================================&nbsp;</div></li><li><div>      if (!empty($bounding)) {&nbsp;</div></li><li><div>          <span class="comment">// WHEN HEIGHT <span class="comment"><span class="comment">// BOTTOM</span></span> EDGE IS KNOWN and $this-&gt;y is set to the bottom</span>&nbsp;</div></li><li><div>          <span class="comment">// Re-instate saved $this-&gt;blk[1]</span>&nbsp;</div></li><li><div>          $this-&gt;blk[1] = $saved_block1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// These are only needed when painting border/background</span>&nbsp;</div></li><li><div>          $this-&gt;blk[1]['width'] = $bbox_w = $cont_w - $bbox_left - $bbox_ml - $bbox_mr - $bbox_right;&nbsp;</div></li><li><div>          $this-&gt;blk[1]['x0'] = $bbox_x;&nbsp;</div></li><li><div>          $this-&gt;blk[1]['y0'] = $bbox_y;&nbsp;</div></li><li><div>          $this-&gt;blk[1]['startpage'] = $this-&gt;page;&nbsp;</div></li><li><div>          $this-&gt;blk[1]['y1'] = $bbox_y + $bbox_bt + $bbox_pt + $inner_h + $bbox_pb + $bbox_bb;&nbsp;</div></li><li><div>          $this-&gt;_out($rot_start);&nbsp;</div></li><li><div>          $this-&gt;PaintDivBB('', 0, 1); <span class="comment">// Prints borders and sets backgrounds in $this-&gt;pageBackgrounds</span>&nbsp;</div></li><li><div>          $this-&gt;_out($rot_end);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s = $this-&gt;PrintPageBackgrounds();&nbsp;</div></li><li><div>      $s = $rot_start . $s . $rot_end;&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] = preg_replace('/___BEFORE_BORDERS___/', &quot;\n&quot; . $s . &quot;\n&quot;, $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>      $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_out($rot_start);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Clipping Output</span>&nbsp;</div></li><li><div>      if ($overflow == 'hidden') {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Bounding rectangle to clip</span></span>&nbsp;</div></li><li><div>          $clip_y1 = $this-&gt;y;&nbsp;</div></li><li><div>          if (!empty($bounding) && ($this-&gt;y + $bbox_pb + $bbox_bb) &gt; ($bbox_y + $bbox_bt + $bbox_pt + $inner_h + $bbox_pb + $bbox_bb )) {&nbsp;</div></li><li><div>              $clip_y1 = ($bbox_y + $bbox_bt + $bbox_pt + $inner_h + $bbox_pb + $bbox_bb ) - ($bbox_pb + $bbox_bb);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//$op = 'W* n';    // Clipping</span>&nbsp;</div></li><li><div>          $op = 'W n'; <span class="comment">// Clipping alternative mode</span>&nbsp;</div></li><li><div>          $this-&gt;_out(&quot;q&quot;);&nbsp;</div></li><li><div>          $ch = $clip_y1 - $y;&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('%.3F %.3F %.3F %.3F re %s', $x * _MPDFK, ($this-&gt;h - $y) * _MPDFK, $w * _MPDFK, -$ch * _MPDFK, $op));&nbsp;</div></li><li><div>          if (!empty($block_s)) {&nbsp;</div></li><li><div>              $tmp = &quot;q\n&quot; . sprintf('%.3F %.3F %.3F %.3F re %s', $x * _MPDFK, ($this-&gt;h - $y) * _MPDFK, $w * _MPDFK, -$ch * _MPDFK, $op);&nbsp;</div></li><li><div>              $tmp .= &quot;\n&quot; . $block_s . &quot;\nQ&quot;;&nbsp;</div></li><li><div>              $block_s = $tmp;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!empty($block_s)) {&nbsp;</div></li><li><div>          if ($shrink_f != 1) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// i.e. autofit has resized the box</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $tmp = &quot;q\n&quot; . $this-&gt;transformScale(($shrink_f * 100), ($shrink_f * 100), $x, $y, true);&nbsp;</div></li><li><div>              $tmp .= &quot;\n&quot; . $block_s . &quot;\nQ&quot;;&nbsp;</div></li><li><div>              $block_s = $tmp;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out($block_s);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($shrink_f != 1) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// i.e. autofit has resized the box</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;StartTransform();&nbsp;</div></li><li><div>          $this-&gt;transformScale(($shrink_f * 100), ($shrink_f * 100), $x, $y);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_out($this-&gt;headerbuffer);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($shrink_f != 1) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// i.e. autofit has resized the box</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;StopTransform();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($overflow == 'hidden') {&nbsp;</div></li><li><div>          <span class="comment">//End clipping</span>&nbsp;</div></li><li><div>          $this-&gt;_out(&quot;Q&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_out($rot_end);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Page Links</span>&nbsp;</div></li><li><div>      foreach ($this-&gt;HTMLheaderPageLinks AS $lk) {&nbsp;</div></li><li><div>          if ($rotate) {&nbsp;</div></li><li><div>              $tmp = $lk[2]; <span class="comment">// Switch h - w</span>&nbsp;</div></li><li><div>              $lk[2] = $lk[3];&nbsp;</div></li><li><div>              $lk[3] = $tmp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $lx1 = (($lk[0] / _MPDFK));&nbsp;</div></li><li><div>              $ly1 = (($this-&gt;h - ($lk[1] / _MPDFK)));&nbsp;</div></li><li><div>              if ($rotate == 90) {&nbsp;</div></li><li><div>                  $adjx = -($lx1 - $bbox_x) + ($preroth - ($ly1 - $bbox_y));&nbsp;</div></li><li><div>                  $adjy = -($ly1 - $bbox_y) + ($lx1 - $bbox_x);&nbsp;</div></li><li><div>                  $lk[2] = -$lk[2];&nbsp;</div></li><li><div>              } elseif ($rotate == -90) {&nbsp;</div></li><li><div>                  $adjx = -($lx1 - $bbox_x) + ($ly1 - $bbox_y);&nbsp;</div></li><li><div>                  $adjy = -($ly1 - $bbox_y) - ($lx1 - $bbox_x) + $prerotw;&nbsp;</div></li><li><div>                  $lk[3] = -$lk[3];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($rot_rpos !== false) {&nbsp;</div></li><li><div>                  $adjx += $prerotw - $preroth;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($rot_bpos !== false) {&nbsp;</div></li><li><div>                  $adjy += $preroth - $prerotw;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $lx1 += $adjx;&nbsp;</div></li><li><div>              $ly1 += $adjy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $lk[0] = $lx1 * _MPDFK;&nbsp;</div></li><li><div>              $lk[1] = ($this-&gt;h - $ly1) * _MPDFK;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($shrink_f != 1) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// i.e. autofit has resized the box</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $lx1 = (($lk[0] / _MPDFK) - $x);&nbsp;</div></li><li><div>              $lx2 = $x + ($lx1 * $shrink_f);&nbsp;</div></li><li><div>              $lk[0] = $lx2 * _MPDFK;&nbsp;</div></li><li><div>              $ly1 = (($this-&gt;h - ($lk[1] / _MPDFK)) - $y);&nbsp;</div></li><li><div>              $ly2 = $y + ($ly1 * $shrink_f);&nbsp;</div></li><li><div>              $lk[1] = ($this-&gt;h - $ly2) * _MPDFK;&nbsp;</div></li><li><div>              $lk[2] *= $shrink_f; <span class="comment">// width</span>&nbsp;</div></li><li><div>              $lk[3] *= $shrink_f; <span class="comment"><span class="comment"><span class="comment">// height</span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;PageLinks[$this-&gt;page][] = $lk;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($this-&gt;HTMLheaderPageForms AS $n =&gt; $f) {&nbsp;</div></li><li><div>          if ($shrink_f != 1) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// i.e. autofit has resized the box</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $f['x'] = $x + (($f['x'] - $x) * $shrink_f);&nbsp;</div></li><li><div>              $f['y'] = $y + (($f['y'] - $y) * $shrink_f);&nbsp;</div></li><li><div>              $f['w'] *= $shrink_f;&nbsp;</div></li><li><div>              $f['h'] *= $shrink_f;&nbsp;</div></li><li><div>              $f['style']['fontsize'] *= $shrink_f;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;mpdfform-&gt;forms[$f['n']] = $f;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Page Annotations</span>&nbsp;</div></li><li><div>      foreach ($this-&gt;HTMLheaderPageAnnots AS $lk) {&nbsp;</div></li><li><div>          if ($rotate) {&nbsp;</div></li><li><div>              if ($rotate == 90) {&nbsp;</div></li><li><div>                  $adjx = -($lk['x'] - $bbox_x) + ($preroth - ($lk['y'] - $bbox_y));&nbsp;</div></li><li><div>                  $adjy = -($lk['y'] - $bbox_y) + ($lk['x'] - $bbox_x);&nbsp;</div></li><li><div>              } elseif ($rotate == -90) {&nbsp;</div></li><li><div>                  $adjx = -($lk['x'] - $bbox_x) + ($lk['y'] - $bbox_y);&nbsp;</div></li><li><div>                  $adjy = -($lk['y'] - $bbox_y) - ($lk['x'] - $bbox_x) + $prerotw;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($rot_rpos !== false) {&nbsp;</div></li><li><div>                  $adjx += $prerotw - $preroth;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($rot_bpos !== false) {&nbsp;</div></li><li><div>                  $adjy += $preroth - $prerotw;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $lk['x'] += $adjx;&nbsp;</div></li><li><div>              $lk['y'] += $adjy;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($shrink_f != 1) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// i.e. autofit has resized the box</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $lk['x'] = $x + (($lk['x'] - $x) * $shrink_f);&nbsp;</div></li><li><div>              $lk['y'] = $y + (($lk['y'] - $y) * $shrink_f);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;PageAnnots[$this-&gt;page][] = $lk;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Restore</span>&nbsp;</div></li><li><div>      $this-&gt;headerbuffer = '';&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageLinks = array();&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageAnnots = array();&nbsp;</div></li><li><div>      $this-&gt;HTMLheaderPageForms = array();&nbsp;</div></li><li><div>      $this-&gt;pageBackgrounds = $save_bgs;&nbsp;</div></li><li><div>      $this-&gt;writingHTMLheader = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;writingHTMLfooter = false;&nbsp;</div></li><li><div>      $this-&gt;fullImageHeight = false;&nbsp;</div></li><li><div>      $this-&gt;ResetMargins();&nbsp;</div></li><li><div>      $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>      $this-&gt;SetXY($save_x, $save_y);&nbsp;</div></li><li><div>      $this-&gt;title2annots = $save_annots; <span class="comment"><span class="comment">// *ANNOTATIONS*</span></span>&nbsp;</div></li><li><div>      $this-&gt;InFooter = false; <span class="comment">// turns back on autopagebreaks</span>&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page]['Font'] = '';&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($save_cols) {&nbsp;</div></li><li><div>          $this-&gt;SetColumns($save_nbcol, $this-&gt;colvAlign, $this-&gt;ColGap);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-POSITION -- */</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function initialiseBlock(&$blk)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $blk['margin_top'] = 0;&nbsp;</div></li><li><div>      $blk['margin_left'] = 0;&nbsp;</div></li><li><div>      $blk['margin_bottom'] = 0;&nbsp;</div></li><li><div>      $blk['margin_right'] = 0;&nbsp;</div></li><li><div>      $blk['padding_top'] = 0;&nbsp;</div></li><li><div>      $blk['padding_left'] = 0;&nbsp;</div></li><li><div>      $blk['padding_bottom'] = 0;&nbsp;</div></li><li><div>      $blk['padding_right'] = 0;&nbsp;</div></li><li><div>      $blk['border_top']['w'] = 0;&nbsp;</div></li><li><div>      $blk['border_left']['w'] = 0;&nbsp;</div></li><li><div>      $blk['border_bottom']['w'] = 0;&nbsp;</div></li><li><div>      $blk['border_right']['w'] = 0;&nbsp;</div></li><li><div>      $blk['direction'] = 'ltr';&nbsp;</div></li><li><div>      $blk['hide'] = false;&nbsp;</div></li><li><div>      $blk['outer_left_margin'] = 0;&nbsp;</div></li><li><div>      $blk['outer_right_margin'] = 0;&nbsp;</div></li><li><div>      $blk['cascadeCSS'] = array();&nbsp;</div></li><li><div>      $blk['block-align'] = false;&nbsp;</div></li><li><div>      $blk['bgcolor'] = false;&nbsp;</div></li><li><div>      $blk['page_break_after_avoid'] = false;&nbsp;</div></li><li><div>      $blk['keep_block_together'] = false;&nbsp;</div></li><li><div>      $blk['float'] = false;&nbsp;</div></li><li><div>      $blk['line_height'] = '';&nbsp;</div></li><li><div>      $blk['margin_collapse'] = false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function border_details($bd)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $prop = preg_split('/\s+/', trim($bd));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$this-&gt;blklvl]['inner_width'])) {&nbsp;</div></li><li><div>          $refw = $this-&gt;blk[$this-&gt;blklvl]['inner_width'];&nbsp;</div></li><li><div>      } elseif (isset($this-&gt;blk[$this-&gt;blklvl - 1]['inner_width'])) {&nbsp;</div></li><li><div>          $refw = $this-&gt;blk[$this-&gt;blklvl - 1]['inner_width'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $refw = $this-&gt;w;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (count($prop) == 1) {&nbsp;</div></li><li><div>          $bsize = $this-&gt;ConvertSize($prop[0], $refw, $this-&gt;FontSize, false);&nbsp;</div></li><li><div>          if ($bsize &gt; 0) {&nbsp;</div></li><li><div>              return array('s' =&gt; 1, 'w' =&gt; $bsize, 'c' =&gt; $this-&gt;ConvertColor(0), 'style' =&gt; 'solid');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return array('w' =&gt; 0, 's' =&gt; 0);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (count($prop) == 2) {&nbsp;</div></li><li><div>          <span class="comment">// 1px solid</span>&nbsp;</div></li><li><div>          if (in_array($prop[1], $this-&gt;borderstyles) || $prop[1] == 'none' || $prop[1] == 'hidden') {&nbsp;</div></li><li><div>              $prop[2] = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// solid #000000</span>&nbsp;</div></li><li><div>          elseif (in_array($prop[0], $this-&gt;borderstyles) || $prop[0] == 'none' || $prop[0] == 'hidden') {&nbsp;</div></li><li><div>              $prop[0] = '';&nbsp;</div></li><li><div>              $prop[1] = $prop[0];&nbsp;</div></li><li><div>              $prop[2] = $prop[1];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// 1px #000000</span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $prop[1] = '';&nbsp;</div></li><li><div>              $prop[2] = $prop[1];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (count($prop) == 3) {&nbsp;</div></li><li><div>          <span class="comment">// Change #000000 1px solid to 1px solid #000000 (proper)</span>&nbsp;</div></li><li><div>          if (substr($prop[0], 0, 1) == '#') {&nbsp;</div></li><li><div>              $tmp = $prop[0];&nbsp;</div></li><li><div>              $prop[0] = $prop[1];&nbsp;</div></li><li><div>              $prop[1] = $prop[2];&nbsp;</div></li><li><div>              $prop[2] = $tmp;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Change solid #000000 1px to 1px solid #000000 (proper)</span>&nbsp;</div></li><li><div>          elseif (substr($prop[0], 1, 1) == '#') {&nbsp;</div></li><li><div>              $tmp = $prop[1];&nbsp;</div></li><li><div>              $prop[0] = $prop[2];&nbsp;</div></li><li><div>              $prop[1] = $prop[0];&nbsp;</div></li><li><div>              $prop[2] = $tmp;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Change solid 1px #000000 to 1px solid #000000 (proper)</span>&nbsp;</div></li><li><div>          elseif (in_array($prop[0], $this-&gt;borderstyles) || $prop[0] == 'none' || $prop[0] == 'hidden') {&nbsp;</div></li><li><div>              $tmp = $prop[0];&nbsp;</div></li><li><div>              $prop[0] = $prop[1];&nbsp;</div></li><li><div>              $prop[1] = $tmp;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Size</span>&nbsp;</div></li><li><div>      $bsize = $this-&gt;ConvertSize($prop[0], $refw, $this-&gt;FontSize, false);&nbsp;</div></li><li><div>      <span class="comment">//color</span>&nbsp;</div></li><li><div>      $coul = $this-&gt;ConvertColor($prop[2]); <span class="comment">// returns array</span>&nbsp;</div></li><li><div>      <span class="comment">// Style</span>&nbsp;</div></li><li><div>      $prop[1] = strtolower($prop[1]);&nbsp;</div></li><li><div>      if (in_array($prop[1], $this-&gt;borderstyles) && $bsize &gt; 0) {&nbsp;</div></li><li><div>          $on = 1;&nbsp;</div></li><li><div>      } elseif ($prop[1] == 'hidden') {&nbsp;</div></li><li><div>          $on = 1;&nbsp;</div></li><li><div>          $bsize = 0;&nbsp;</div></li><li><div>          $coul = '';&nbsp;</div></li><li><div>      } elseif ($prop[1] == 'none') {&nbsp;</div></li><li><div>          $on = 0;&nbsp;</div></li><li><div>          $bsize = 0;&nbsp;</div></li><li><div>          $coul = '';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $on = 0;&nbsp;</div></li><li><div>          $bsize = 0;&nbsp;</div></li><li><div>          $coul = '';&nbsp;</div></li><li><div>          $prop[1] = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array('s' =&gt; $on, 'w' =&gt; $bsize, 'c' =&gt; $coul, 'style' =&gt; $prop[1]);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _borderPadding($a, $b, &$px, &$py)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// $px and py are padding long axis (x) and short axis (y)</span>&nbsp;</div></li><li><div>      $added = 0; <span class="comment">// extra padding</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $x = $a - $px;&nbsp;</div></li><li><div>      $y = $b - $py;&nbsp;</div></li><li><div>      <span class="comment">// Check if Falls within ellipse of border radius</span>&nbsp;</div></li><li><div>      if (( (($x + $added) * ($x + $added)) / ($a * $a) + (($y + $added) * ($y + $added)) / ($b * $b) ) &lt;= 1) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $t = atan2($y, $x);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $newx = $b / sqrt((($b * $b) / ($a * $a)) + ( tan($t) * tan($t) ));&nbsp;</div></li><li><div>      $newy = $a / sqrt((($a * $a) / ($b * $b)) + ( (1 / tan($t)) * (1 / tan($t)) ));&nbsp;</div></li><li><div>      $px = max($px, $a - $newx + $added);&nbsp;</div></li><li><div>      $py = max($py, $b - $newy + $added);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-PAGE -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetPagedMediaCSS($name = '', $first, $oddEven)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($oddEven == 'E') {&nbsp;</div></li><li><div>          if ($this-&gt;directionality == 'rtl') {&nbsp;</div></li><li><div>              $side = 'R';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $side = 'L';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ($this-&gt;directionality == 'rtl') {&nbsp;</div></li><li><div>              $side = 'L';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $side = 'R';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $name = strtoupper($name);&nbsp;</div></li><li><div>      $p = array();&nbsp;</div></li><li><div>      $p['SIZE'] = 'AUTO';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Uses mPDF original margins as default</span>&nbsp;</div></li><li><div>      $p['MARGIN-RIGHT'] = strval($this-&gt;orig_rMargin) . 'mm';&nbsp;</div></li><li><div>      $p['MARGIN-LEFT'] = strval($this-&gt;orig_lMargin) . 'mm';&nbsp;</div></li><li><div>      $p['MARGIN-TOP'] = strval($this-&gt;orig_tMargin) . 'mm';&nbsp;</div></li><li><div>      $p['MARGIN-BOTTOM'] = strval($this-&gt;orig_bMargin) . 'mm';&nbsp;</div></li><li><div>      $p['MARGIN-HEADER'] = strval($this-&gt;orig_hMargin) . 'mm';&nbsp;</div></li><li><div>      $p['MARGIN-FOOTER'] = strval($this-&gt;orig_fMargin) . 'mm';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Basic page + selector</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;cssmgr-&gt;CSS['@PAGE'])) {&nbsp;</div></li><li><div>          $zp = $this-&gt;cssmgr-&gt;CSS['@PAGE'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $zp = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (is_array($zp) && !empty($zp)) {&nbsp;</div></li><li><div>          $p = array_merge($p, $zp);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($p['EVEN-HEADER-NAME']) && $oddEven == 'E') {&nbsp;</div></li><li><div>          $p['HEADER'] = $p['EVEN-HEADER-NAME'];&nbsp;</div></li><li><div>          unset($p['EVEN-HEADER-NAME']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['ODD-HEADER-NAME']) && $oddEven != 'E') {&nbsp;</div></li><li><div>          $p['HEADER'] = $p['ODD-HEADER-NAME'];&nbsp;</div></li><li><div>          unset($p['ODD-HEADER-NAME']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['EVEN-FOOTER-NAME']) && $oddEven == 'E') {&nbsp;</div></li><li><div>          $p['FOOTER'] = $p['EVEN-FOOTER-NAME'];&nbsp;</div></li><li><div>          unset($p['EVEN-FOOTER-NAME']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['ODD-FOOTER-NAME']) && $oddEven != 'E') {&nbsp;</div></li><li><div>          $p['FOOTER'] = $p['ODD-FOOTER-NAME'];&nbsp;</div></li><li><div>          unset($p['ODD-FOOTER-NAME']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If right/Odd page</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;PSEUDO&gt;&gt;RIGHT']) && $side == 'R') {&nbsp;</div></li><li><div>          $zp = $this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;PSEUDO&gt;&gt;RIGHT'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $zp = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($zp['SIZE'])) {&nbsp;</div></li><li><div>          unset($zp['SIZE']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($zp['SHEET-SIZE'])) {&nbsp;</div></li><li><div>          unset($zp['SHEET-SIZE']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Disallow margin-left or -right on :LEFT or :RIGHT</span></span></span></span>&nbsp;</div></li><li><div>      if (isset($zp['MARGIN-LEFT'])) {&nbsp;</div></li><li><div>          unset($zp['MARGIN-LEFT']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($zp['MARGIN-RIGHT'])) {&nbsp;</div></li><li><div>          unset($zp['MARGIN-RIGHT']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (is_array($zp) && !empty($zp)) {&nbsp;</div></li><li><div>          $p = array_merge($p, $zp);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If left/Even page</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;PSEUDO&gt;&gt;LEFT']) && $side == 'L') {&nbsp;</div></li><li><div>          $zp = $this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;PSEUDO&gt;&gt;LEFT'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $zp = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($zp['SIZE'])) {&nbsp;</div></li><li><div>          unset($zp['SIZE']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($zp['SHEET-SIZE'])) {&nbsp;</div></li><li><div>          unset($zp['SHEET-SIZE']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Disallow margin-left or -right on :LEFT or :RIGHT</span></span></span></span>&nbsp;</div></li><li><div>      if (isset($zp['MARGIN-LEFT'])) {&nbsp;</div></li><li><div>          unset($zp['MARGIN-LEFT']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($zp['MARGIN-RIGHT'])) {&nbsp;</div></li><li><div>          unset($zp['MARGIN-RIGHT']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (is_array($zp) && !empty($zp)) {&nbsp;</div></li><li><div>          $p = array_merge($p, $zp);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If first page</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;PSEUDO&gt;&gt;FIRST']) && $first) {&nbsp;</div></li><li><div>          $zp = $this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;PSEUDO&gt;&gt;FIRST'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $zp = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($zp['SIZE'])) {&nbsp;</div></li><li><div>          unset($zp['SIZE']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($zp['SHEET-SIZE'])) {&nbsp;</div></li><li><div>          unset($zp['SHEET-SIZE']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      // Disallow margin-left or -right on :FIRST    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>      if (isset($zp['MARGIN-LEFT'])) {&nbsp;</div></li><li><div>          unset($zp['MARGIN-LEFT']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($zp['MARGIN-RIGHT'])) {&nbsp;</div></li><li><div>          unset($zp['MARGIN-RIGHT']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (is_array($zp) && !empty($zp)) {&nbsp;</div></li><li><div>          $p = array_merge($p, $zp);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If named page</span>&nbsp;</div></li><li><div>      if ($name) {&nbsp;</div></li><li><div>          if (isset($this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;NAMED&gt;&gt;' . $name])) {&nbsp;</div></li><li><div>              $zp = $this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;NAMED&gt;&gt;' . $name];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $zp = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (is_array($zp) && !empty($zp)) {&nbsp;</div></li><li><div>              $p = array_merge($p, $zp);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($p['EVEN-HEADER-NAME']) && $oddEven == 'E') {&nbsp;</div></li><li><div>              $p['HEADER'] = $p['EVEN-HEADER-NAME'];&nbsp;</div></li><li><div>              unset($p['EVEN-HEADER-NAME']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['ODD-HEADER-NAME']) && $oddEven != 'E') {&nbsp;</div></li><li><div>              $p['HEADER'] = $p['ODD-HEADER-NAME'];&nbsp;</div></li><li><div>              unset($p['ODD-HEADER-NAME']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['EVEN-FOOTER-NAME']) && $oddEven == 'E') {&nbsp;</div></li><li><div>              $p['FOOTER'] = $p['EVEN-FOOTER-NAME'];&nbsp;</div></li><li><div>              unset($p['EVEN-FOOTER-NAME']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($p['ODD-FOOTER-NAME']) && $oddEven != 'E') {&nbsp;</div></li><li><div>              $p['FOOTER'] = $p['ODD-FOOTER-NAME'];&nbsp;</div></li><li><div>              unset($p['ODD-FOOTER-NAME']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If named right/Odd page</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;NAMED&gt;&gt;' . $name . '&gt;&gt;PSEUDO&gt;&gt;RIGHT']) && $side == 'R') {&nbsp;</div></li><li><div>              $zp = $this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;NAMED&gt;&gt;' . $name . '&gt;&gt;PSEUDO&gt;&gt;RIGHT'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $zp = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($zp['SIZE'])) {&nbsp;</div></li><li><div>              unset($zp['SIZE']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($zp['SHEET-SIZE'])) {&nbsp;</div></li><li><div>              unset($zp['SHEET-SIZE']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Disallow margin-left or -right on :LEFT or :RIGHT</span></span></span></span>&nbsp;</div></li><li><div>          if (isset($zp['MARGIN-LEFT'])) {&nbsp;</div></li><li><div>              unset($zp['MARGIN-LEFT']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($zp['MARGIN-RIGHT'])) {&nbsp;</div></li><li><div>              unset($zp['MARGIN-RIGHT']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (is_array($zp) && !empty($zp)) {&nbsp;</div></li><li><div>              $p = array_merge($p, $zp);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If named left/Even page</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;NAMED&gt;&gt;' . $name . '&gt;&gt;PSEUDO&gt;&gt;LEFT']) && $side == 'L') {&nbsp;</div></li><li><div>              $zp = $this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;NAMED&gt;&gt;' . $name . '&gt;&gt;PSEUDO&gt;&gt;LEFT'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $zp = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($zp['SIZE'])) {&nbsp;</div></li><li><div>              unset($zp['SIZE']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($zp['SHEET-SIZE'])) {&nbsp;</div></li><li><div>              unset($zp['SHEET-SIZE']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Disallow margin-left or -right on :LEFT or :RIGHT</span></span></span></span>&nbsp;</div></li><li><div>          if (isset($zp['MARGIN-LEFT'])) {&nbsp;</div></li><li><div>              unset($zp['MARGIN-LEFT']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($zp['MARGIN-RIGHT'])) {&nbsp;</div></li><li><div>              unset($zp['MARGIN-RIGHT']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (is_array($zp) && !empty($zp)) {&nbsp;</div></li><li><div>              $p = array_merge($p, $zp);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If named first page</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;NAMED&gt;&gt;' . $name . '&gt;&gt;PSEUDO&gt;&gt;FIRST']) && $first) {&nbsp;</div></li><li><div>              $zp = $this-&gt;cssmgr-&gt;CSS['@PAGE&gt;&gt;NAMED&gt;&gt;' . $name . '&gt;&gt;PSEUDO&gt;&gt;FIRST'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $zp = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($zp['SIZE'])) {&nbsp;</div></li><li><div>              unset($zp['SIZE']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($zp['SHEET-SIZE'])) {&nbsp;</div></li><li><div>              unset($zp['SHEET-SIZE']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          // Disallow margin-left or -right on :FIRST    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>          if (isset($zp['MARGIN-LEFT'])) {&nbsp;</div></li><li><div>              unset($zp['MARGIN-LEFT']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($zp['MARGIN-RIGHT'])) {&nbsp;</div></li><li><div>              unset($zp['MARGIN-RIGHT']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (is_array($zp) && !empty($zp)) {&nbsp;</div></li><li><div>              $p = array_merge($p, $zp);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $orientation = $mgl = $mgr = $mgt = $mgb = $mgh = $mgf = '';&nbsp;</div></li><li><div>      $header = $footer = '';&nbsp;</div></li><li><div>      $resetpagenum = $pagenumstyle = $suppress = '';&nbsp;</div></li><li><div>      $marks = '';&nbsp;</div></li><li><div>      $bg = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $newformat = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($p['SHEET-SIZE']) && is_array($p['SHEET-SIZE'])) {&nbsp;</div></li><li><div>          $newformat = $p['SHEET-SIZE'];&nbsp;</div></li><li><div>          if ($newformat[0] &gt; $newformat[1]) { <span class="comment">// landscape</span>&nbsp;</div></li><li><div>              $newformat = array_reverse($newformat);&nbsp;</div></li><li><div>              $p['ORIENTATION'] = 'L';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $p['ORIENTATION'] = 'P';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_setPageSize($newformat, $p['ORIENTATION']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($p['SIZE']) && is_array($p['SIZE']) && !$newformat) {&nbsp;</div></li><li><div>          if ($p['SIZE']['W'] &gt; $p['SIZE']['H']) {&nbsp;</div></li><li><div>              $p['ORIENTATION'] = 'L';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $p['ORIENTATION'] = 'P';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (is_array($p['SIZE'])) {&nbsp;</div></li><li><div>          if ($p['SIZE']['W'] &gt; $this-&gt;fw) {&nbsp;</div></li><li><div>              $p['SIZE']['W'] = $this-&gt;fw;&nbsp;</div></li><li><div>          } <span class="comment">// mPD 4.2 use fw not fPt</span>&nbsp;</div></li><li><div>          if ($p['SIZE']['H'] &gt; $this-&gt;fh) {&nbsp;</div></li><li><div>              $p['SIZE']['H'] = $this-&gt;fh;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (($p['ORIENTATION'] == $this-&gt;DefOrientation && !$newformat) || ($newformat && $p['ORIENTATION'] == 'P')) {&nbsp;</div></li><li><div>              $outer_width_LR = ($this-&gt;fw - $p['SIZE']['W']) / 2;&nbsp;</div></li><li><div>              $outer_width_TB = ($this-&gt;fh - $p['SIZE']['H']) / 2;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $outer_width_LR = ($this-&gt;fh - $p['SIZE']['W']) / 2;&nbsp;</div></li><li><div>              $outer_width_TB = ($this-&gt;fw - $p['SIZE']['H']) / 2;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $pgw = $p['SIZE']['W'];&nbsp;</div></li><li><div>          $pgh = $p['SIZE']['H'];&nbsp;</div></li><li><div>      } else { <span class="comment">// AUTO LANDSCAPE PORTRAIT</span>&nbsp;</div></li><li><div>          $outer_width_LR = 0;&nbsp;</div></li><li><div>          $outer_width_TB = 0;&nbsp;</div></li><li><div>          if (!$newformat) {&nbsp;</div></li><li><div>              if (strtoupper($p['SIZE']) == 'AUTO') {&nbsp;</div></li><li><div>                  $p['ORIENTATION'] = $this-&gt;DefOrientation;&nbsp;</div></li><li><div>              } elseif (strtoupper($p['SIZE']) == 'LANDSCAPE') {&nbsp;</div></li><li><div>                  $p['ORIENTATION'] = 'L';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $p['ORIENTATION'] = 'P';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (($p['ORIENTATION'] == $this-&gt;DefOrientation && !$newformat) || ($newformat && $p['ORIENTATION'] == 'P')) {&nbsp;</div></li><li><div>              $pgw = $this-&gt;fw;&nbsp;</div></li><li><div>              $pgh = $this-&gt;fh;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $pgw = $this-&gt;fh;&nbsp;</div></li><li><div>              $pgh = $this-&gt;fw;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($p['HEADER']) && $p['HEADER']) {&nbsp;</div></li><li><div>          $header = $p['HEADER'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['FOOTER']) && $p['FOOTER']) {&nbsp;</div></li><li><div>          $footer = $p['FOOTER'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['RESETPAGENUM']) && $p['RESETPAGENUM']) {&nbsp;</div></li><li><div>          $resetpagenum = $p['RESETPAGENUM'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['PAGENUMSTYLE']) && $p['PAGENUMSTYLE']) {&nbsp;</div></li><li><div>          $pagenumstyle = $p['PAGENUMSTYLE'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['SUPPRESS']) && $p['SUPPRESS']) {&nbsp;</div></li><li><div>          $suppress = $p['SUPPRESS'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($p['MARKS'])) {&nbsp;</div></li><li><div>          if (preg_match('/cross/i', $p['MARKS']) && preg_match('/crop/i', $p['MARKS'])) {&nbsp;</div></li><li><div>              $marks = 'CROPCROSS';&nbsp;</div></li><li><div>          } elseif (strtoupper($p['MARKS']) == 'CROP') {&nbsp;</div></li><li><div>              $marks = 'CROP';&nbsp;</div></li><li><div>          } elseif (strtoupper($p['MARKS']) == 'CROSS') {&nbsp;</div></li><li><div>              $marks = 'CROSS';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($p['BACKGROUND-COLOR']) && $p['BACKGROUND-COLOR']) {&nbsp;</div></li><li><div>          $bg['BACKGROUND-COLOR'] = $p['BACKGROUND-COLOR'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($p['BACKGROUND-GRADIENT']) && $p['BACKGROUND-GRADIENT']) {&nbsp;</div></li><li><div>          $bg['BACKGROUND-GRADIENT'] = $p['BACKGROUND-GRADIENT'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['BACKGROUND-IMAGE']) && $p['BACKGROUND-IMAGE']) {&nbsp;</div></li><li><div>          $bg['BACKGROUND-IMAGE'] = $p['BACKGROUND-IMAGE'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['BACKGROUND-REPEAT']) && $p['BACKGROUND-REPEAT']) {&nbsp;</div></li><li><div>          $bg['BACKGROUND-REPEAT'] = $p['BACKGROUND-REPEAT'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['BACKGROUND-POSITION']) && $p['BACKGROUND-POSITION']) {&nbsp;</div></li><li><div>          $bg['BACKGROUND-POSITION'] = $p['BACKGROUND-POSITION'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['BACKGROUND-IMAGE-RESIZE']) && $p['BACKGROUND-IMAGE-RESIZE']) {&nbsp;</div></li><li><div>          $bg['BACKGROUND-IMAGE-RESIZE'] = $p['BACKGROUND-IMAGE-RESIZE'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['BACKGROUND-IMAGE-OPACITY'])) {&nbsp;</div></li><li><div>          $bg['BACKGROUND-IMAGE-OPACITY'] = $p['BACKGROUND-IMAGE-OPACITY'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($p['MARGIN-LEFT'])) {&nbsp;</div></li><li><div>          $mgl = $this-&gt;ConvertSize($p['MARGIN-LEFT'], $pgw) + $outer_width_LR;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['MARGIN-RIGHT'])) {&nbsp;</div></li><li><div>          $mgr = $this-&gt;ConvertSize($p['MARGIN-RIGHT'], $pgw) + $outer_width_LR;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['MARGIN-BOTTOM'])) {&nbsp;</div></li><li><div>          $mgb = $this-&gt;ConvertSize($p['MARGIN-BOTTOM'], $pgh) + $outer_width_TB;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['MARGIN-TOP'])) {&nbsp;</div></li><li><div>          $mgt = $this-&gt;ConvertSize($p['MARGIN-TOP'], $pgh) + $outer_width_TB;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['MARGIN-HEADER'])) {&nbsp;</div></li><li><div>          $mgh = $this-&gt;ConvertSize($p['MARGIN-HEADER'], $pgh) + $outer_width_TB;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($p['MARGIN-FOOTER'])) {&nbsp;</div></li><li><div>          $mgf = $this-&gt;ConvertSize($p['MARGIN-FOOTER'], $pgh) + $outer_width_TB;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($p['ORIENTATION']) && $p['ORIENTATION']) {&nbsp;</div></li><li><div>          $orientation = $p['ORIENTATION'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;page_box['outer_width_LR'] = $outer_width_LR; <span class="comment">// Used in MARKS:crop etc.</span>&nbsp;</div></li><li><div>      $this-&gt;page_box['outer_width_TB'] = $outer_width_TB;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array($orientation, $mgl, $mgr, $mgt, $mgb, $mgh, $mgf, $header, $footer, $bg, $resetpagenum, $pagenumstyle, $suppress, $marks, $newformat);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-PAGE -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added mPDF 3.0</span> Float DIV</span></span></span> - CLEAR&nbsp;</div></li><li><div>  function ClearFloats($clear, $blklvl = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      list($l_exists, $r_exists, $l_max, $r_max, $l_width, $r_width) = $this-&gt;GetFloatDivInfo($blklvl, true);&nbsp;</div></li><li><div>      $end = $currpos = ($this-&gt;page * 1000 + $this-&gt;y);&nbsp;</div></li><li><div>      if ($clear == 'BOTH' && ($l_exists || $r_exists)) {&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>          $end = max($l_max, $r_max, $currpos);&nbsp;</div></li><li><div>      } elseif ($clear == 'RIGHT' && $r_exists) {&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>          $end = max($r_max, $currpos);&nbsp;</div></li><li><div>      } elseif ($clear == 'LEFT' && $l_exists) {&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>          $end = max($l_max, $currpos);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $old_page = $this-&gt;page;&nbsp;</div></li><li><div>      $new_page = intval($end / 1000);&nbsp;</div></li><li><div>      if ($old_page != $new_page) {&nbsp;</div></li><li><div>          $s = $this-&gt;PrintPageBackgrounds();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Writes after the marker so not overwritten later by page background etc.</span></span></span>&nbsp;</div></li><li><div>          $this-&gt;pages[$this-&gt;page] = preg_replace('/(___BACKGROUND___PATTERNS' . $this-&gt;uniqstr . ')/', '\\1' . &quot;\n&quot; . $s . &quot;\n&quot;, $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>          $this-&gt;pageBackgrounds = array();&nbsp;</div></li><li><div>          $this-&gt;page = $new_page;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;ResetMargins();&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page] = array();&nbsp;</div></li><li><div>      $this-&gt;y = (($end * 1000) % 1000000) / 1000; <span class="comment"><span class="comment">// mod changes operands to integers before processing</span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added mPDF 3.0</span> Float DIV</span></span></span>&nbsp;</div></li><li><div>  function GetFloatDivInfo($blklvl = 0, $clear = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// If blklvl specified, only returns floats at that level - for ClearFloats</span>&nbsp;</div></li><li><div>      $l_exists = false;&nbsp;</div></li><li><div>      $r_exists = false;&nbsp;</div></li><li><div>      $l_max = 0;&nbsp;</div></li><li><div>      $r_max = 0;&nbsp;</div></li><li><div>      $l_width = 0;&nbsp;</div></li><li><div>      $r_width = 0;&nbsp;</div></li><li><div>      if (count($this-&gt;floatDivs)) {&nbsp;</div></li><li><div>          $currpos = ($this-&gt;page * 1000 + $this-&gt;y);&nbsp;</div></li><li><div>          foreach ($this-&gt;floatDivs AS $f) {&nbsp;</div></li><li><div>              if (($clear && $f['blockContext'] == $this-&gt;blk[$blklvl]['blockContext']) || (!$clear && $currpos &gt;= $f['startpos'] && $currpos &lt; ($f['endpos'] - 0.001) && $f['blklvl'] &gt; $blklvl && $f['blockContext'] == $this-&gt;blk[$blklvl]['blockContext'])) {&nbsp;</div></li><li><div>                  if ($f['side'] == 'L') {&nbsp;</div></li><li><div>                      $l_exists = true;&nbsp;</div></li><li><div>                      $l_max = max($l_max, $f['endpos']);&nbsp;</div></li><li><div>                      $l_width = max($l_width, $f['w']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($f['side'] == 'R') {&nbsp;</div></li><li><div>                      $r_exists = true;&nbsp;</div></li><li><div>                      $r_max = max($r_max, $f['endpos']);&nbsp;</div></li><li><div>                      $r_width = max($r_width, $f['w']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array($l_exists, $r_exists, $l_max, $r_max, $l_width, $r_width);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// LIST MARKERS</span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>  function _setListMarker($listitemtype, $listitemimage, $listitemposition)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// if position:inside (and NOT table) - output now as a textbuffer; (so if next is block, will move to new line)</span>&nbsp;</div></li><li><div>      <span class="comment">// elseif position:outside (and NOT table) - output in front of first textbuffer output by setting listitem (cf. _saveTextBuffer)</span>&nbsp;</div></li><li><div>      $e = '';&nbsp;</div></li><li><div>      $this-&gt;listitem = '';&nbsp;</div></li><li><div>      $spacer = ' ';&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// IMAGE</span></span>&nbsp;</div></li><li><div>      if ($listitemimage && $listitemimage != 'none') {&nbsp;</div></li><li><div>          $listitemimage = trim(preg_replace('/url\([&quot;\']*(.*?)[&quot;\']*\)/', '\\1', $listitemimage));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// ? Restrict maximum height/width of list marker??</span>&nbsp;</div></li><li><div>          $maxWidth = 100;&nbsp;</div></li><li><div>          $maxHeight = 100;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $objattr = array();&nbsp;</div></li><li><div>          $objattr['margin_top'] = 0;&nbsp;</div></li><li><div>          $objattr['margin_bottom'] = 0;&nbsp;</div></li><li><div>          $objattr['margin_left'] = 0;&nbsp;</div></li><li><div>          $objattr['margin_right'] = 0;&nbsp;</div></li><li><div>          $objattr['padding_top'] = 0;&nbsp;</div></li><li><div>          $objattr['padding_bottom'] = 0;&nbsp;</div></li><li><div>          $objattr['padding_left'] = 0;&nbsp;</div></li><li><div>          $objattr['padding_right'] = 0;&nbsp;</div></li><li><div>          $objattr['width'] = 0;&nbsp;</div></li><li><div>          $objattr['height'] = 0;&nbsp;</div></li><li><div>          $objattr['border_top']['w'] = 0;&nbsp;</div></li><li><div>          $objattr['border_bottom']['w'] = 0;&nbsp;</div></li><li><div>          $objattr['border_left']['w'] = 0;&nbsp;</div></li><li><div>          $objattr['border_right']['w'] = 0;&nbsp;</div></li><li><div>          $objattr['visibility'] = 'visible';&nbsp;</div></li><li><div>          $srcpath = $listitemimage;&nbsp;</div></li><li><div>          $orig_srcpath = $listitemimage;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $objattr['vertical-align'] = 'BS'; <span class="comment">// vertical alignment of marker (baseline)</span>&nbsp;</div></li><li><div>          $w = 0;&nbsp;</div></li><li><div>          $h = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Image file</span>&nbsp;</div></li><li><div>          $info = $this-&gt;_getImage($srcpath, true, true, $orig_srcpath);&nbsp;</div></li><li><div>          if (!$info)&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          if ($info['w'] == 0 && $info['h'] == 0) {&nbsp;</div></li><li><div>              $info['h'] = $this-&gt;ConvertSize('1em', $this-&gt;blk[$this-&gt;blklvl]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $objattr['file'] = $srcpath;&nbsp;</div></li><li><div>          <span class="comment">//Default width and height calculation if needed</span>&nbsp;</div></li><li><div>          if ($w == 0 and $h == 0) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($info['type'] == 'wmf') {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// WMF</span> units are twips (1/20pt)</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// divide by 20 to get points</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// divide by k to get user units</span></span>&nbsp;</div></li><li><div>                  $w = abs($info['w']) / (20 * _MPDFK);&nbsp;</div></li><li><div>                  $h = abs($info['h']) / (20 * _MPDFK);&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($info['type'] == 'svg') {&nbsp;</div></li><li><div>                  <span class="comment">// SVG</span> units are pixels&nbsp;</div></li><li><div>                  $w = abs($info['w']) / _MPDFK;&nbsp;</div></li><li><div>                  $h = abs($info['h']) / _MPDFK;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//Put image at default image dpi</span></span>&nbsp;</div></li><li><div>                  $w = ($info['w'] / _MPDFK) * (72 / $this-&gt;img_dpi);&nbsp;</div></li><li><div>                  $h = ($info['h'] / _MPDFK) * (72 / $this-&gt;img_dpi);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// IF WIDTH OR HEIGHT SPECIFIED</span>&nbsp;</div></li><li><div>          if ($w == 0)&nbsp;</div></li><li><div>              $w = abs($h * $info['w'] / $info['h']);&nbsp;</div></li><li><div>          if ($h == 0)&nbsp;</div></li><li><div>              $h = abs($w * $info['h'] / $info['w']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($w &gt; $maxWidth) {&nbsp;</div></li><li><div>              $w = $maxWidth;&nbsp;</div></li><li><div>              $h = abs($w * $info['h'] / $info['w']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($h &gt; $maxHeight) {&nbsp;</div></li><li><div>              $h = $maxHeight;&nbsp;</div></li><li><div>              $w = abs($h * $info['w'] / $info['h']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $objattr['type'] = 'image';&nbsp;</div></li><li><div>          $objattr['itype'] = $info['type'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $objattr['orig_h'] = $info['h'];&nbsp;</div></li><li><div>          $objattr['orig_w'] = $info['w'];&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($info['type'] == 'wmf') {&nbsp;</div></li><li><div>              $objattr['wmf_x'] = $info['x'];&nbsp;</div></li><li><div>              $objattr['wmf_y'] = $info['y'];&nbsp;</div></li><li><div>          } else&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMAGES-WMF -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($info['type'] == 'svg') {&nbsp;</div></li><li><div>              $objattr['wmf_x'] = $info['x'];&nbsp;</div></li><li><div>              $objattr['wmf_y'] = $info['y'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $objattr['height'] = $h;&nbsp;</div></li><li><div>          $objattr['width'] = $w;&nbsp;</div></li><li><div>          $objattr['image_height'] = $h;&nbsp;</div></li><li><div>          $objattr['image_width'] = $w;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $objattr['dir'] = (isset($this-&gt;blk[$this-&gt;blklvl]['direction']) ? $this-&gt;blk[$this-&gt;blklvl]['direction'] : 'ltr');&nbsp;</div></li><li><div>          $objattr['listmarker'] = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $objattr['listmarkerposition'] = $listitemposition;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $e = &quot;\xbb\xa4\xactype=image, objattr=&quot; . serialize($objattr) . &quot;\xbb\xa4\xac&quot;;&nbsp;</div></li><li><div>          $this-&gt;_saveTextBuffer($e);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($listitemposition == 'inside') {&nbsp;</div></li><li><div>              $e = $spacer;&nbsp;</div></li><li><div>              $this-&gt;_saveTextBuffer($e);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// SYMBOL (needs new font)</span>&nbsp;</div></li><li><div>      elseif ($listitemtype == 'disc' || $listitemtype == 'circle' || $listitemtype == 'square') {&nbsp;</div></li><li><div>          $objattr = array();&nbsp;</div></li><li><div>          $objattr['type'] = 'listmarker';&nbsp;</div></li><li><div>          $objattr['listmarkerposition'] = $listitemposition;&nbsp;</div></li><li><div>          $objattr['width'] = 0;&nbsp;</div></li><li><div>          $size = $this-&gt;ConvertSize($this-&gt;list_symbol_size, $this-&gt;FontSize);&nbsp;</div></li><li><div>          $objattr['size'] = $size;&nbsp;</div></li><li><div>          $objattr['offset'] = $this-&gt;ConvertSize($this-&gt;list_marker_offset, $this-&gt;FontSize);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($listitemposition == 'inside') {&nbsp;</div></li><li><div>              $objattr['width'] = $size + $objattr['offset'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $objattr['height'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>          $objattr['vertical-align'] = 'T';&nbsp;</div></li><li><div>          $objattr['text'] = '';&nbsp;</div></li><li><div>          $objattr['dir'] = (isset($this-&gt;blk[$this-&gt;blklvl]['direction']) ? $this-&gt;blk[$this-&gt;blklvl]['direction'] : 'ltr');&nbsp;</div></li><li><div>          $objattr['bullet'] = $listitemtype;&nbsp;</div></li><li><div>          $objattr['colorarray'] = $this-&gt;colorarray;&nbsp;</div></li><li><div>          $objattr['fontfamily'] = $this-&gt;FontFamily;&nbsp;</div></li><li><div>          $objattr['fontsize'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>          $objattr['fontsizept'] = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>          $objattr['fontstyle'] = $this-&gt;FontStyle;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $e = &quot;\xbb\xa4\xactype=listmarker, objattr=&quot; . serialize($objattr) . &quot;\xbb\xa4\xac&quot;;&nbsp;</div></li><li><div>          $this-&gt;listitem = $this-&gt;_saveTextBuffer($e, '', '', true); <span class="comment"><span class="comment"><span class="comment">// true returns array</span></span></span>&nbsp;</div></li><li><div>          <span class="comment">//    if ($listitemposition == 'inside') {</span>&nbsp;</div></li><li><div>          <span class="comment">//        $e = $spacer;</span>&nbsp;</div></li><li><div>          <span class="comment">//        $this-&gt;_saveTextBuffer($e);</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//    }</span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// SYMBOL 2 (needs new font)</span>&nbsp;</div></li><li><div>      elseif (preg_match('/U\+([a-fA-F0-9]+)/i', $listitemtype, $m)) {&nbsp;</div></li><li><div>          if ($this-&gt;_charDefined($this-&gt;CurrentFont['cw'], hexdec($m[1]))) {&nbsp;</div></li><li><div>              $list_item_marker = codeHex2utf($m[1]);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $list_item_marker = '-';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (preg_match('/rgb\(.*?\)/', $listitemtype, $m)) {&nbsp;</div></li><li><div>              $list_item_color = $this-&gt;ConvertColor($m[0]);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $list_item_color = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// SAVE then SET COLR</span>&nbsp;</div></li><li><div>          $save_colorarray = $this-&gt;colorarray;&nbsp;</div></li><li><div>          if ($list_item_color) {&nbsp;</div></li><li><div>              $this-&gt;colorarray = $list_item_color;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($listitemposition == 'inside') {&nbsp;</div></li><li><div>              $e = $list_item_marker . $spacer;&nbsp;</div></li><li><div>              $this-&gt;_saveTextBuffer($e);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $objattr = array();&nbsp;</div></li><li><div>              $objattr['type'] = 'listmarker';&nbsp;</div></li><li><div>              $objattr['width'] = 0;&nbsp;</div></li><li><div>              $objattr['height'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>              $objattr['vertical-align'] = 'T';&nbsp;</div></li><li><div>              $objattr['text'] = $list_item_marker;&nbsp;</div></li><li><div>              $objattr['dir'] = (isset($this-&gt;blk[$this-&gt;blklvl]['direction']) ? $this-&gt;blk[$this-&gt;blklvl]['direction'] : 'ltr');&nbsp;</div></li><li><div>              $objattr['colorarray'] = $this-&gt;colorarray;&nbsp;</div></li><li><div>              $objattr['fontfamily'] = $this-&gt;FontFamily;&nbsp;</div></li><li><div>              $objattr['fontsize'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>              $objattr['fontsizept'] = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>              $objattr['fontstyle'] = $this-&gt;FontStyle;&nbsp;</div></li><li><div>              $e = &quot;\xbb\xa4\xactype=listmarker, objattr=&quot; . serialize($objattr) . &quot;\xbb\xa4\xac&quot;;&nbsp;</div></li><li><div>              $this-&gt;listitem = $this-&gt;_saveTextBuffer($e, '', '', true); <span class="comment"><span class="comment"><span class="comment">// true returns array</span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// RESET COLOR</span>&nbsp;</div></li><li><div>          $this-&gt;colorarray = $save_colorarray;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// TEXT</span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $counter = $this-&gt;listcounter[$this-&gt;listlvl];&nbsp;</div></li><li><div>          if ($listitemtype == 'none') {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $num = $this-&gt;_getStyledNumber($counter, $listitemtype, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($listitemposition == 'inside') {&nbsp;</div></li><li><div>              $e = $num . $this-&gt;list_number_suffix . $spacer;&nbsp;</div></li><li><div>              $this-&gt;_saveTextBuffer($e);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if (isset($this-&gt;blk[$this-&gt;blklvl]['direction']) && $this-&gt;blk[$this-&gt;blklvl]['direction'] == 'rtl') {&nbsp;</div></li><li><div>                  <span class="comment">// REPLACE MIRRORED RTL $this-&gt;list_number_suffix  e.g. ) -&gt; (  (NB could use UCDN::$mirror_pairs)</span>&nbsp;</div></li><li><div>                  $m = strtr($this-&gt;list_number_suffix, &quot;)]}&quot;, &quot;([{&quot;) . $num;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $m = $num . $this-&gt;list_number_suffix;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $objattr = array();&nbsp;</div></li><li><div>              $objattr['type'] = 'listmarker';&nbsp;</div></li><li><div>              $objattr['width'] = 0;&nbsp;</div></li><li><div>              $objattr['height'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>              $objattr['vertical-align'] = 'T';&nbsp;</div></li><li><div>              $objattr['text'] = $m;&nbsp;</div></li><li><div>              $objattr['dir'] = (isset($this-&gt;blk[$this-&gt;blklvl]['direction']) ? $this-&gt;blk[$this-&gt;blklvl]['direction'] : 'ltr');&nbsp;</div></li><li><div>              $objattr['colorarray'] = $this-&gt;colorarray;&nbsp;</div></li><li><div>              $objattr['fontfamily'] = $this-&gt;FontFamily;&nbsp;</div></li><li><div>              $objattr['fontsize'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>              $objattr['fontsizept'] = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>              $objattr['fontstyle'] = $this-&gt;FontStyle;&nbsp;</div></li><li><div>              $e = &quot;\xbb\xa4\xactype=listmarker, objattr=&quot; . serialize($objattr) . &quot;\xbb\xa4\xac&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;listitem = $this-&gt;_saveTextBuffer($e, '', '', true); <span class="comment"><span class="comment"><span class="comment">// true returns array</span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// mPDF Lists</span>&nbsp;</div></li><li><div>  function _getListMarkerWidth(&$currblk, &$a, &$i)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $blt_width = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $markeroffset = $this-&gt;ConvertSize($this-&gt;list_marker_offset, $this-&gt;FontSize);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get Maximum number in the list</span>&nbsp;</div></li><li><div>      $maxnum = $this-&gt;listcounter[$this-&gt;listlvl];&nbsp;</div></li><li><div>      if ($currblk['list_style_type'] != 'disc' && $currblk['list_style_type'] != 'circle' && $currblk['list_style_type'] != 'square') {&nbsp;</div></li><li><div>          $lvl = 1;&nbsp;</div></li><li><div>          for ($j = $i + 2; $j &lt; count($a); $j+=2) {&nbsp;</div></li><li><div>              $e = $a[$j];&nbsp;</div></li><li><div>              if (!$e) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($e[0] == '/') { <span class="comment">// end tag</span>&nbsp;</div></li><li><div>                  $e = strtoupper(substr($e, 1));&nbsp;</div></li><li><div>                  if ($e == 'OL' || $e == 'UL') {&nbsp;</div></li><li><div>                      if ($lvl == 1) {&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $lvl--;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else { <span class="comment">// opening tag</span>&nbsp;</div></li><li><div>                  if (strpos($e, ' ')) {&nbsp;</div></li><li><div>                      $e = substr($e, 0, strpos($e, ' '));&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $e = strtoupper($e);&nbsp;</div></li><li><div>                  if ($e == 'LI') {&nbsp;</div></li><li><div>                      if ($lvl == 1) {&nbsp;</div></li><li><div>                          $maxnum++;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ($e == 'OL' || $e == 'UL') {&nbsp;</div></li><li><div>                      $lvl++;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ($currblk['list_style_type']) {&nbsp;</div></li><li><div>          case 'decimal':&nbsp;</div></li><li><div>          case '1':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat('5', strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'none':&nbsp;</div></li><li><div>              $blt_width = 0;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'upper-alpha':&nbsp;</div></li><li><div>          case 'upper-latin':&nbsp;</div></li><li><div>          case 'A':&nbsp;</div></li><li><div>              $maxnumA = $this-&gt;dec2alpha($maxnum, true);&nbsp;</div></li><li><div>              if ($maxnum &lt; 13) {&nbsp;</div></li><li><div>                  $blt_width = $this-&gt;GetStringWidth('D' . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $blt_width = $this-&gt;GetStringWidth(str_repeat('W', strlen($maxnumA)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'lower-alpha':&nbsp;</div></li><li><div>          case 'lower-latin':&nbsp;</div></li><li><div>          case 'a':&nbsp;</div></li><li><div>              $maxnuma = $this-&gt;dec2alpha($maxnum, false);&nbsp;</div></li><li><div>              if ($maxnum &lt; 13) {&nbsp;</div></li><li><div>                  $blt_width = $this-&gt;GetStringWidth('b' . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $blt_width = $this-&gt;GetStringWidth(str_repeat('m', strlen($maxnuma)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'upper-roman':&nbsp;</div></li><li><div>          case 'I':&nbsp;</div></li><li><div>              if ($maxnum &gt; 87) {&nbsp;</div></li><li><div>                  $bbit = 87;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 86) {&nbsp;</div></li><li><div>                  $bbit = 86;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 37) {&nbsp;</div></li><li><div>                  $bbit = 38;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 36) {&nbsp;</div></li><li><div>                  $bbit = 37;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 27) {&nbsp;</div></li><li><div>                  $bbit = 28;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 26) {&nbsp;</div></li><li><div>                  $bbit = 27;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 17) {&nbsp;</div></li><li><div>                  $bbit = 18;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 16) {&nbsp;</div></li><li><div>                  $bbit = 17;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 7) {&nbsp;</div></li><li><div>                  $bbit = 8;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 6) {&nbsp;</div></li><li><div>                  $bbit = 7;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 3) {&nbsp;</div></li><li><div>                  $bbit = 4;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $bbit = $maxnum;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $maxlnum = $this-&gt;dec2roman($bbit, true);&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth($maxlnum . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'lower-roman':&nbsp;</div></li><li><div>          case 'i':&nbsp;</div></li><li><div>              if ($maxnum &gt; 87) {&nbsp;</div></li><li><div>                  $bbit = 87;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 86) {&nbsp;</div></li><li><div>                  $bbit = 86;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 37) {&nbsp;</div></li><li><div>                  $bbit = 38;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 36) {&nbsp;</div></li><li><div>                  $bbit = 37;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 27) {&nbsp;</div></li><li><div>                  $bbit = 28;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 26) {&nbsp;</div></li><li><div>                  $bbit = 27;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 17) {&nbsp;</div></li><li><div>                  $bbit = 18;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 16) {&nbsp;</div></li><li><div>                  $bbit = 17;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 7) {&nbsp;</div></li><li><div>                  $bbit = 8;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 6) {&nbsp;</div></li><li><div>                  $bbit = 7;&nbsp;</div></li><li><div>              } elseif ($maxnum &gt; 3) {&nbsp;</div></li><li><div>                  $bbit = 4;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $bbit = $maxnum;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $maxlnum = $this-&gt;dec2roman($bbit, false);&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth($maxlnum . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'disc':&nbsp;</div></li><li><div>          case 'circle':&nbsp;</div></li><li><div>          case 'square':&nbsp;</div></li><li><div>              $size = $this-&gt;ConvertSize($this-&gt;list_symbol_size, $this-&gt;FontSize);&nbsp;</div></li><li><div>              $offset = $this-&gt;ConvertSize($this-&gt;list_marker_offset, $this-&gt;FontSize);&nbsp;</div></li><li><div>              $blt_width = $size + $offset;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'arabic-indic':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(3, 0x0660), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'persian':&nbsp;</div></li><li><div>          case 'urdu':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(3, 0x06F0), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'bengali':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(3, 0x09E6), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'devanagari':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(3, 0x0966), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'gujarati':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(3, 0x0AE6), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'gurmukhi':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(3, 0x0A66), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'kannada':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(3, 0x0CE6), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'malayalam':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(6, 0x0D66), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'oriya':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(3, 0x0B66), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'telugu':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(3, 0x0C66), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'tamil':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(9, 0x0BE6), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'thai':&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat($this-&gt;dec2other(5, 0x0E50), strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              $blt_width = $this-&gt;GetStringWidth(str_repeat('5', strlen($maxnum)) . $this-&gt;list_number_suffix);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return ($blt_width + $markeroffset);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// This function determines the shrink factor when resizing tables</span>&nbsp;</div></li><li><div>  <span class="comment">// val is the table_height / page_height_available</span>&nbsp;</div></li><li><div>  <span class="comment">// returns a scaling factor used as $shrin_k to resize the table</span>&nbsp;</div></li><li><div>  <span class="comment">// Overcompensating will be quicker but may unnecessarily shrink table too much</span>&nbsp;</div></li><li><div>  <span class="comment">// Undercompensating means it will reiterate more times (taking more processing time)</span>&nbsp;</div></li><li><div>  function tbsqrt($val, $iteration = 3)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $k = 4; <span class="comment">// Alters number of iterations until it returns $val itself - Must be &gt; 2</span>&nbsp;</div></li><li><div>      <span class="comment">// Probably best guess and most accurate</span>&nbsp;</div></li><li><div>      if ($iteration == 1)&nbsp;</div></li><li><div>          return sqrt($val);&nbsp;</div></li><li><div>      <span class="comment">// Faster than using sqrt (because it won't undercompensate), and gives reasonable results</span>&nbsp;</div></li><li><div>      <span class="comment">//return 1+(($val-1)/2);</span>&nbsp;</div></li><li><div>      $x = 2 - (($iteration - 2) / ($k - 2));&nbsp;</div></li><li><div>      if ($x == 0) {&nbsp;</div></li><li><div>          $ret = $val + 0.00001;&nbsp;</div></li><li><div>      } elseif ($x &lt; 0) {&nbsp;</div></li><li><div>          $ret = 1 + ( pow(2, ($iteration - 2 - $k)) / 1000 );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $ret = 1 + (($val - 1) / $x);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $ret;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _saveTextBuffer($t, $link = '', $intlink = '', $return = false)&nbsp;</div></li><li><div>  { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>      $arr = array();&nbsp;</div></li><li><div>      $arr[0] = $t;&nbsp;</div></li><li><div>      if (isset($link) && $link)&nbsp;</div></li><li><div>          $arr[1] = $link;&nbsp;</div></li><li><div>      $arr[2] = $this-&gt;currentfontstyle;&nbsp;</div></li><li><div>      if (isset($this-&gt;colorarray) && $this-&gt;colorarray)&nbsp;</div></li><li><div>          $arr[3] = $this-&gt;colorarray;&nbsp;</div></li><li><div>      $arr[4] = $this-&gt;currentfontfamily;&nbsp;</div></li><li><div>      $arr[5] = $this-&gt;currentLang; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($intlink) && $intlink)&nbsp;</div></li><li><div>          $arr[7] = $intlink;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// If Kerning set for OTL, and useOTL has positive value, but has not set for this particular script, </span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// set for kerning via kern table</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// e.g. Latin script when useOTL set as 0x80</span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;OTLtags['Plus']) && strpos($this-&gt;OTLtags['Plus'], 'kern') !== false && empty($this-&gt;OTLdata['GPOSinfo'])) {&nbsp;</div></li><li><div>          $this-&gt;textvar = ($this-&gt;textvar | FC_KERNING);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $arr[8] = $this-&gt;textvar; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;textparam) && $this-&gt;textparam)&nbsp;</div></li><li><div>          $arr[9] = $this-&gt;textparam;&nbsp;</div></li><li><div>      if (isset($this-&gt;spanbgcolorarray) && $this-&gt;spanbgcolorarray)&nbsp;</div></li><li><div>          $arr[10] = $this-&gt;spanbgcolorarray;&nbsp;</div></li><li><div>      $arr[11] = $this-&gt;currentfontsize;&nbsp;</div></li><li><div>      if (isset($this-&gt;ReqFontStyle) && $this-&gt;ReqFontStyle)&nbsp;</div></li><li><div>          $arr[12] = $this-&gt;ReqFontStyle;&nbsp;</div></li><li><div>      if (isset($this-&gt;lSpacingCSS) && $this-&gt;lSpacingCSS)&nbsp;</div></li><li><div>          $arr[14] = $this-&gt;lSpacingCSS;&nbsp;</div></li><li><div>      if (isset($this-&gt;wSpacingCSS) && $this-&gt;wSpacingCSS)&nbsp;</div></li><li><div>          $arr[15] = $this-&gt;wSpacingCSS;&nbsp;</div></li><li><div>      if (isset($this-&gt;spanborddet) && $this-&gt;spanborddet)&nbsp;</div></li><li><div>          $arr[16] = $this-&gt;spanborddet;&nbsp;</div></li><li><div>      if (isset($this-&gt;textshadow) && $this-&gt;textshadow)&nbsp;</div></li><li><div>          $arr[17] = $this-&gt;textshadow;&nbsp;</div></li><li><div>      if (isset($this-&gt;OTLdata) && $this-&gt;OTLdata) {&nbsp;</div></li><li><div>          $arr[18] = $this-&gt;OTLdata;&nbsp;</div></li><li><div>          $this-&gt;OTLdata = array();&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $arr[18] = NULL;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>      if ($return) {&nbsp;</div></li><li><div>          return ($arr);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;listitem) {&nbsp;</div></li><li><div>          $this-&gt;textbuffer[] = $this-&gt;listitem;&nbsp;</div></li><li><div>          $this-&gt;listitem = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;textbuffer[] = $arr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _saveCellTextBuffer($t, $link = '', $intlink = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $arr = array();&nbsp;</div></li><li><div>      $arr[0] = $t;&nbsp;</div></li><li><div>      if (isset($link) && $link)&nbsp;</div></li><li><div>          $arr[1] = $link;&nbsp;</div></li><li><div>      $arr[2] = $this-&gt;currentfontstyle;&nbsp;</div></li><li><div>      if (isset($this-&gt;colorarray) && $this-&gt;colorarray)&nbsp;</div></li><li><div>          $arr[3] = $this-&gt;colorarray;&nbsp;</div></li><li><div>      $arr[4] = $this-&gt;currentfontfamily;&nbsp;</div></li><li><div>      if (isset($intlink) && $intlink)&nbsp;</div></li><li><div>          $arr[7] = $intlink;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// If Kerning set for OTL, and useOTL has positive value, but has not set for this particular script, </span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// set for kerning via kern table</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// e.g. Latin script when useOTL set as 0x80</span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;OTLtags['Plus']) && strpos($this-&gt;OTLtags['Plus'], 'kern') !== false && empty($this-&gt;OTLdata['GPOSinfo'])) {&nbsp;</div></li><li><div>          $this-&gt;textvar = ($this-&gt;textvar | FC_KERNING);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $arr[8] = $this-&gt;textvar; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;textparam) && $this-&gt;textparam)&nbsp;</div></li><li><div>          $arr[9] = $this-&gt;textparam;&nbsp;</div></li><li><div>      if (isset($this-&gt;spanbgcolorarray) && $this-&gt;spanbgcolorarray)&nbsp;</div></li><li><div>          $arr[10] = $this-&gt;spanbgcolorarray;&nbsp;</div></li><li><div>      $arr[11] = $this-&gt;currentfontsize;&nbsp;</div></li><li><div>      if (isset($this-&gt;ReqFontStyle) && $this-&gt;ReqFontStyle)&nbsp;</div></li><li><div>          $arr[12] = $this-&gt;ReqFontStyle;&nbsp;</div></li><li><div>      if (isset($this-&gt;lSpacingCSS) && $this-&gt;lSpacingCSS)&nbsp;</div></li><li><div>          $arr[14] = $this-&gt;lSpacingCSS;&nbsp;</div></li><li><div>      if (isset($this-&gt;wSpacingCSS) && $this-&gt;wSpacingCSS)&nbsp;</div></li><li><div>          $arr[15] = $this-&gt;wSpacingCSS;&nbsp;</div></li><li><div>      if (isset($this-&gt;spanborddet) && $this-&gt;spanborddet)&nbsp;</div></li><li><div>          $arr[16] = $this-&gt;spanborddet;&nbsp;</div></li><li><div>      if (isset($this-&gt;textshadow) && $this-&gt;textshadow)&nbsp;</div></li><li><div>          $arr[17] = $this-&gt;textshadow;&nbsp;</div></li><li><div>      if (isset($this-&gt;OTLdata) && $this-&gt;OTLdata) {&nbsp;</div></li><li><div>          $arr[18] = $this-&gt;OTLdata;&nbsp;</div></li><li><div>          $this-&gt;OTLdata = array();&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $arr[18] = NULL;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;cell[$this-&gt;row][$this-&gt;col]['textbuffer'][] = $arr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function printbuffer($arrayaux, $blockstate = 0, $is_table = false, $table_draft = false, $cell_dir = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// $blockstate = 0;    // NO margins/padding</span>&nbsp;</div></li><li><div>      // $blockstate = 1;    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span> margins/padding only&nbsp;</div></li><li><div>      // $blockstate = 2;    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span> margins/padding only&nbsp;</div></li><li><div>      // $blockstate = 3;    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span> & bottom margins/padding&nbsp;</div></li><li><div>      $this-&gt;spanbgcolorarray = '';&nbsp;</div></li><li><div>      $this-&gt;spanbgcolor = false;&nbsp;</div></li><li><div>      $this-&gt;spanborder = false;&nbsp;</div></li><li><div>      $this-&gt;spanborddet = array();&nbsp;</div></li><li><div>      $paint_ht_corr = 0;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;floatDivs)) {&nbsp;</div></li><li><div>          list($l_exists, $r_exists, $l_max, $r_max, $l_width, $r_width) = $this-&gt;GetFloatDivInfo($this-&gt;blklvl);&nbsp;</div></li><li><div>          if (($this-&gt;blk[$this-&gt;blklvl]['inner_width'] - $l_width - $r_width) &lt; (2 * $this-&gt;GetCharWidth('W', false))) {&nbsp;</div></li><li><div>              <span class="comment">// Too narrow to fit - try to move down past L or R float</span>&nbsp;</div></li><li><div>              if ($l_max &lt; $r_max && ($this-&gt;blk[$this-&gt;blklvl]['inner_width'] - $r_width) &gt; (2 * $this-&gt;GetCharWidth('W', false))) {&nbsp;</div></li><li><div>                  $this-&gt;ClearFloats('LEFT', $this-&gt;blklvl);&nbsp;</div></li><li><div>              } elseif ($r_max &lt; $l_max && ($this-&gt;blk[$this-&gt;blklvl]['inner_width'] - $l_width) &gt; (2 * $this-&gt;GetCharWidth('W', false))) {&nbsp;</div></li><li><div>                  $this-&gt;ClearFloats('RIGHT', $this-&gt;blklvl);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;ClearFloats('BOTH', $this-&gt;blklvl);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-FLOAT -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $bak_y = $this-&gt;y;&nbsp;</div></li><li><div>      $bak_x = $this-&gt;x;&nbsp;</div></li><li><div>      $align = '';&nbsp;</div></li><li><div>      if (!$is_table) {&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['align']) && $this-&gt;blk[$this-&gt;blklvl]['align']) {&nbsp;</div></li><li><div>              $align = $this-&gt;blk[$this-&gt;blklvl]['align'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Block-align is set by e.g. &lt;.. align=&quot;center&quot;&gt; Takes priority for this block but not inherited</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['block-align']) && $this-&gt;blk[$this-&gt;blklvl]['block-align']) {&nbsp;</div></li><li><div>              $align = $this-&gt;blk[$this-&gt;blklvl]['block-align'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['direction']))&nbsp;</div></li><li><div>              $blockdir = $this-&gt;blk[$this-&gt;blklvl]['direction'];&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $blockdir = &quot;&quot;;&nbsp;</div></li><li><div>          $this-&gt;divwidth = $this-&gt;blk[$this-&gt;blklvl]['width'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $align = $this-&gt;cellTextAlign;&nbsp;</div></li><li><div>          $blockdir = $cell_dir;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $oldpage = $this-&gt;page;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// ADDED</span> for Out of Block now done as Flowing Block</span>&nbsp;</div></li><li><div>      if ($this-&gt;divwidth == 0) {&nbsp;</div></li><li><div>          $this-&gt;divwidth = $this-&gt;pgwidth;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$is_table) {&nbsp;</div></li><li><div>          $this-&gt;SetLineHeight($this-&gt;FontSizePt, $this-&gt;blk[$this-&gt;blklvl]['line_height']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;divheight = $this-&gt;lineheight;&nbsp;</div></li><li><div>      $old_height = $this-&gt;divheight;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// As a failsafe - if font has been set but not output to page</span>&nbsp;</div></li><li><div>      if (!$table_draft)&nbsp;</div></li><li><div>          $this-&gt;SetFont($this-&gt;default_font, '', $this-&gt;default_font_size, true, true); <span class="comment">// force output</span> to page&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;newFlowingBlock($this-&gt;divwidth, $this-&gt;divheight, $align, $is_table, $blockstate, true, $blockdir, $table_draft);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $array_size = count($arrayaux);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Added - Otherwise &lt;div&gt;&lt;div&gt;&lt;p&gt; did not output top margins/padding for 1st/2nd div</span>&nbsp;</div></li><li><div>      if ($array_size == 0) {&nbsp;</div></li><li><div>          $this-&gt;finishFlowingBlock(true);&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment">// true = END of flowing block</span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// ALL the chunks of textbuffer need to have at least basic OTLdata set</span>&nbsp;</div></li><li><div>      <span class="comment">// First make sure each element/chunk has the OTLdata for Bidi set.</span>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $array_size; $i++) {&nbsp;</div></li><li><div>          if (empty($arrayaux[$i][18])) {&nbsp;</div></li><li><div>              if (substr($arrayaux[$i][0], 0, 3) == &quot;\xbb\xa4\xac&quot;) { <span class="comment">// object identifier has been identified!</span>&nbsp;</div></li><li><div>                  $unicode = array(0xFFFC); <span class="comment">// Object replacement character</span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $unicode = $this-&gt;UTF8StringToArray($arrayaux[$i][0], false);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $is_strong = false;&nbsp;</div></li><li><div>              $this-&gt;getBasicOTLdata($arrayaux[$i][18], $unicode, $is_strong);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Gets messed up if try and use core fonts inside a paragraph of text which needs to be BiDi re-ordered or OTLdata set</span>&nbsp;</div></li><li><div>          if (($blockdir == 'rtl' || $this-&gt;biDirectional) && isset($arrayaux[$i][4]) && in_array($arrayaux[$i][4], array('ccourier', 'ctimes', 'chelvetica', 'csymbol', 'czapfdingbats'))) {&nbsp;</div></li><li><div>              <span class="comment">/** Fallback to appropriate font type when RTL is detected */</span>&nbsp;</div></li><li><div>              switch ($arrayaux[$i][4]) {&nbsp;</div></li><li><div>                  case 'ccourier':&nbsp;</div></li><li><div>                      $arrayaux[$i][4] = $this-&gt;mono_fonts[0];&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'ctimes':&nbsp;</div></li><li><div>                      $arrayaux[$i][4] = $this-&gt;serif_fonts[0];&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'chelvetica':&nbsp;</div></li><li><div>                  default:&nbsp;</div></li><li><div>                      $arrayaux[$i][4] = $this-&gt;sans_fonts[0];&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Process bidirectional text ready for bidi-re-ordering (which is done after line-breaks are established in WriteFlowingBlock etc.)</span>&nbsp;</div></li><li><div>      if (($blockdir == 'rtl' || $this-&gt;biDirectional) && !$table_draft) {&nbsp;</div></li><li><div>          if (!class_exists('otl', false)) {&nbsp;</div></li><li><div>              include(_MPDF_PATH . 'classes/otl.php');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (empty($this-&gt;otl)) {&nbsp;</div></li><li><div>              $this-&gt;otl = new otl($this);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;otl-&gt;_bidiPrepare($arrayaux, $blockdir);&nbsp;</div></li><li><div>          $array_size = count($arrayaux);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      // Remove empty items <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      for ($i = $array_size - 1; $i &gt; 0; $i--) {&nbsp;</div></li><li><div>          if (empty($arrayaux[$i][0]) && (isset($arrayaux[$i][16]) && $arrayaux[$i][16] !== '0') && empty($arrayaux[$i][7])) {&nbsp;</div></li><li><div>              unset($arrayaux[$i]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Correct adjoining borders for inline elements</span>&nbsp;</div></li><li><div>      if (isset($arrayaux[0][16])) {&nbsp;</div></li><li><div>          $lastspanborder = $arrayaux[0][16];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $lastspanborder = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      for ($i = 1; $i &lt; $array_size; $i++) {&nbsp;</div></li><li><div>          if (isset($arrayaux[$i][16]) && $arrayaux[$i][16] == $lastspanborder &&&nbsp;</div></li><li><div>              ((!isset($arrayaux[$i][9]['bord-decoration']) && !isset($arrayaux[$i - 1][9]['bord-decoration'])) ||&nbsp;</div></li><li><div>              (isset($arrayaux[$i][9]['bord-decoration']) && isset($arrayaux[$i - 1][9]['bord-decoration']) && $arrayaux[$i][9]['bord-decoration'] == $arrayaux[$i - 1][9]['bord-decoration'])&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>              if (isset($arrayaux[$i][16]['R'])) {&nbsp;</div></li><li><div>                  $lastspanborder = $arrayaux[$i][16];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $lastspanborder = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $arrayaux[$i][16]['L']['s'] = 0;&nbsp;</div></li><li><div>              $arrayaux[$i][16]['L']['w'] = 0;&nbsp;</div></li><li><div>              $arrayaux[$i - 1][16]['R']['s'] = 0;&nbsp;</div></li><li><div>              $arrayaux[$i - 1][16]['R']['w'] = 0;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if (isset($arrayaux[$i][16]['R'])) {&nbsp;</div></li><li><div>                  $lastspanborder = $arrayaux[$i][16];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $lastspanborder = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $array_size; $i++) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>          $vetor = isset($arrayaux[$i]) ? $arrayaux[$i] : NULL;&nbsp;</div></li><li><div>          if ($i == 0 && $vetor[0] != &quot;\n&quot; && ! $this-&gt;ispre) {&nbsp;</div></li><li><div>              $vetor[0] = ltrim($vetor[0]);&nbsp;</div></li><li><div>              if (!empty($vetor[18])) {&nbsp;</div></li><li><div>                  $this-&gt;otl-&gt;trimOTLdata($vetor[18], true, false);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// FIXED TO ALLOW IT TO SHOW '0'</span>&nbsp;</div></li><li><div>          if (empty($vetor[0]) && !($vetor[0] === '0') && empty($vetor[7])) { <span class="comment"><span class="comment">//Ignore empty text</span> and not carrying an internal link</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">//Check if it is the last element. If so then finish printing the block</span></span></span>&nbsp;</div></li><li><div>              if ($i == ($array_size - 1)) {&nbsp;</div></li><li><div>                  $this-&gt;finishFlowingBlock(true);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment">// true = END of flowing block</span></span></span></span>&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">//Activating buffer properties</span>&nbsp;</div></li><li><div>          if (isset($vetor[11]) && $vetor[11] != '') {   <span class="comment">// Font Size</span>&nbsp;</div></li><li><div>              if ($is_table && $this-&gt;shrin_k) {&nbsp;</div></li><li><div>                  $this-&gt;SetFontSize($vetor[11] / $this-&gt;shrin_k, false);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;SetFontSize($vetor[11], false);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($vetor[17]) && !empty($vetor[17])) { <span class="comment">//TextShadow</span>&nbsp;</div></li><li><div>              $this-&gt;textshadow = $vetor[17];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($vetor[16]) && !empty($vetor[16])) { <span class="comment"><span class="comment">//Border</span></span>&nbsp;</div></li><li><div>              $this-&gt;spanborddet = $vetor[16];&nbsp;</div></li><li><div>              $this-&gt;spanborder = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($vetor[15])) {   <span class="comment"><span class="comment"><span class="comment">// Word spacing</span></span></span>&nbsp;</div></li><li><div>              $this-&gt;wSpacingCSS = $vetor[15];&nbsp;</div></li><li><div>              if ($this-&gt;wSpacingCSS && strtoupper($this-&gt;wSpacingCSS) != 'NORMAL') {&nbsp;</div></li><li><div>                  $this-&gt;minwSpacing = $this-&gt;ConvertSize($this-&gt;wSpacingCSS, $this-&gt;FontSize) / $this-&gt;shrin_k; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($vetor[14])) {   <span class="comment"><span class="comment">// Letter spacing</span></span>&nbsp;</div></li><li><div>              $this-&gt;lSpacingCSS = $vetor[14];&nbsp;</div></li><li><div>              if (($this-&gt;lSpacingCSS || $this-&gt;lSpacingCSS === '0') && strtoupper($this-&gt;lSpacingCSS) != 'NORMAL') {&nbsp;</div></li><li><div>                  $this-&gt;fixedlSpacing = $this-&gt;ConvertSize($this-&gt;lSpacingCSS, $this-&gt;FontSize) / $this-&gt;shrin_k; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($vetor[10]) and ! empty($vetor[10])) { <span class="comment">//Background color</span>&nbsp;</div></li><li><div>              $this-&gt;spanbgcolorarray = $vetor[10];&nbsp;</div></li><li><div>              $this-&gt;spanbgcolor = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($vetor[9]) and ! empty($vetor[9])) { <span class="comment">// Text parameters - Outline + hyphens</span>&nbsp;</div></li><li><div>              $this-&gt;textparam = $vetor[9];&nbsp;</div></li><li><div>              $this-&gt;SetTextOutline($this-&gt;textparam);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              if ($is_table && $this-&gt;shrin_k) {&nbsp;</div></li><li><div>                  if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>                      $this-&gt;textparam['text-baseline'] /= $this-&gt;shrin_k;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($this-&gt;textparam['decoration-baseline'])) {&nbsp;</div></li><li><div>                      $this-&gt;textparam['decoration-baseline'] /= $this-&gt;shrin_k;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($this-&gt;textparam['decoration-fontsize'])) {&nbsp;</div></li><li><div>                      $this-&gt;textparam['decoration-fontsize'] /= $this-&gt;shrin_k;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($vetor[8])) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;textvar = $vetor[8];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($vetor[7]) and $vetor[7] != '') { <span class="comment">// internal target: &lt;a name=&quot;anyvalue&quot;&gt;</span>&nbsp;</div></li><li><div>              $ily = $this-&gt;y;&nbsp;</div></li><li><div>              if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>                  $this-&gt;internallink[$vetor[7]] = array(&quot;Y&quot; =&gt; $ily, &quot;PAGE&quot; =&gt; $this-&gt;page, &quot;tbrot&quot; =&gt; true);&nbsp;</div></li><li><div>              } elseif ($this-&gt;kwt) {&nbsp;</div></li><li><div>                  $this-&gt;internallink[$vetor[7]] = array(&quot;Y&quot; =&gt; $ily, &quot;PAGE&quot; =&gt; $this-&gt;page, &quot;kwt&quot; =&gt; true);&nbsp;</div></li><li><div>              } elseif ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                  $this-&gt;internallink[$vetor[7]] = array(&quot;Y&quot; =&gt; $ily, &quot;PAGE&quot; =&gt; $this-&gt;page, &quot;col&quot; =&gt; $this-&gt;CurrCol);&nbsp;</div></li><li><div>              } elseif (!$this-&gt;keep_block_together) {&nbsp;</div></li><li><div>                  $this-&gt;internallink[$vetor[7]] = array(&quot;Y&quot; =&gt; $ily, &quot;PAGE&quot; =&gt; $this-&gt;page);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (empty($vetor[0])) { <span class="comment">//Ignore empty text</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">//Check if it is the last element. If so then finish printing the block</span></span></span>&nbsp;</div></li><li><div>                  if ($i == ($array_size - 1)) {&nbsp;</div></li><li><div>                      $this-&gt;finishFlowingBlock(true);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment">// true = END of flowing block</span></span></span></span>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($vetor[5]) and $vetor[5] != '') {  // Language    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;currentLang = $vetor[5];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($vetor[4]) and $vetor[4] != '') {  <span class="comment">// Font Family</span>&nbsp;</div></li><li><div>              $font = $this-&gt;SetFont($vetor[4], $this-&gt;FontStyle, 0, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!empty($vetor[3])) { <span class="comment"><span class="comment"><span class="comment">//Font Color</span></span></span>&nbsp;</div></li><li><div>              $cor = $vetor[3];&nbsp;</div></li><li><div>              $this-&gt;SetTColor($cor);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($vetor[2]) and $vetor[2] != '') { <span class="comment">//Bold, Italic styles</span>&nbsp;</div></li><li><div>              $this-&gt;SetStyles($vetor[2]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($vetor[12]) and $vetor[12] != '') { <span class="comment">//Requested Bold, Italic</span>&nbsp;</div></li><li><div>              $this-&gt;ReqFontStyle = $vetor[12];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($vetor[1]) and $vetor[1] != '') { <span class="comment">//LINK</span>&nbsp;</div></li><li><div>              if (strpos($vetor[1], &quot;.&quot;) === false && strpos($vetor[1], &quot;@&quot;) !== 0) { <span class="comment">//assuming every external link has a dot indicating extension (e.g: .html .txt .zip www.somewhere.com etc.)</span>&nbsp;</div></li><li><div>                  <span class="comment">//Repeated reference to same anchor?</span>&nbsp;</div></li><li><div>                  while (array_key_exists($vetor[1], $this-&gt;internallink))&nbsp;</div></li><li><div>                      $vetor[1] = &quot;#&quot; . $vetor[1];&nbsp;</div></li><li><div>                  $this-&gt;internallink[$vetor[1]] = $this-&gt;AddLink();&nbsp;</div></li><li><div>                  $vetor[1] = $this-&gt;internallink[$vetor[1]];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;HREF = $vetor[1];     <span class="comment">// HR</span>EF link style set here ******&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// SPECIAL CONTENT - IMAGES & FORM OBJECTS</span>&nbsp;</div></li><li><div>          <span class="comment">//Print-out special content</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (substr($vetor[0], 0, 3) == &quot;\xbb\xa4\xac&quot;) { <span class="comment"><span class="comment">//identifier has been identified!</span></span>&nbsp;</div></li><li><div>              $objattr = $this-&gt;_getObjAttr($vetor[0]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($objattr['type'] == 'nestedtable') {&nbsp;</div></li><li><div>                  if ($objattr['nestedcontent']) {&nbsp;</div></li><li><div>                      $level = $objattr['level'];&nbsp;</div></li><li><div>                      $table = &$this-&gt;table[$level][$objattr['table']];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($table_draft) {&nbsp;</div></li><li><div>                          $this-&gt;y += $this-&gt;table[($level + 1)][$objattr['nestedcontent']]['h']; <span class="comment">// nested table height</span>&nbsp;</div></li><li><div>                          $this-&gt;finishFlowingBlock(false, 'nestedtable');&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $cell = &$table['cells'][$objattr['row']][$objattr['col']];&nbsp;</div></li><li><div>                          $this-&gt;finishFlowingBlock(false, 'nestedtable');&nbsp;</div></li><li><div>                          $save_dw = $this-&gt;divwidth;&nbsp;</div></li><li><div>                          $save_buffer = $this-&gt;cellBorderBuffer;&nbsp;</div></li><li><div>                          $this-&gt;cellBorderBuffer = array();&nbsp;</div></li><li><div>                          $ncx = $this-&gt;x;&nbsp;</div></li><li><div>                          list($dummyx, $w) = $this-&gt;_tableGetWidth($table, $objattr['row'], $objattr['col']);&nbsp;</div></li><li><div>                          $ntw = $this-&gt;table[($level + 1)][$objattr['nestedcontent']]['w']; <span class="comment">// nested table width</span>&nbsp;</div></li><li><div>                          if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                              if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                                  list($bt, $br, $bb, $bl) = $this-&gt;_getBorderWidths($cell['borderbin']);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $br = $cell['border_details']['R']['w'];&nbsp;</div></li><li><div>                                  $bl = $cell['border_details']['L']['w'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $innerw = $w - $bl - $br - $cell['padding']['L'] - $cell['padding']['R'] - $table['border_spacing_H'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $innerw = $w - $bl / 2 - $br / 2 - $cell['padding']['L'] - $cell['padding']['R'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } elseif ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $innerw = $w - $table['simple']['border_details']['L']['w'] - $table['simple']['border_details']['R']['w'] - $cell['padding']['L'] - $cell['padding']['R'] - $table['border_spacing_H'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $innerw = $w - $table['simple']['border_details']['L']['w'] / 2 - $table['simple']['border_details']['R']['w'] / 2 - $cell['padding']['L'] - $cell['padding']['R'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($cell['a'] == 'C' || $this-&gt;table[($level + 1)][$objattr['nestedcontent']]['a'] == 'C') {&nbsp;</div></li><li><div>                              $ncx += ($innerw - $ntw) / 2;&nbsp;</div></li><li><div>                          } elseif ($cell['a'] == 'R' || $this-&gt;table[($level + 1)][$objattr['nestedcontent']]['a'] == 'R') {&nbsp;</div></li><li><div>                              $ncx += $innerw - $ntw;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;x = $ncx;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $this-&gt;_tableWrite($this-&gt;table[($level + 1)][$objattr['nestedcontent']]);&nbsp;</div></li><li><div>                          $this-&gt;cellBorderBuffer = $save_buffer;&nbsp;</div></li><li><div>                          $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                          $this-&gt;divwidth = $save_dw;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;newFlowingBlock($this-&gt;divwidth, $this-&gt;divheight, $align, $is_table, $blockstate, false, $blockdir, $table_draft);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($is_table) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $maxWidth = $this-&gt;divwidth;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $maxWidth = $this-&gt;divwidth - ($this-&gt;blk[$this-&gt;blklvl]['padding_left'] + $this-&gt;blk[$this-&gt;blklvl]['border_left']['w'] + $this-&gt;blk[$this-&gt;blklvl]['padding_right'] + $this-&gt;blk[$this-&gt;blklvl]['border_right']['w']);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment">// If float (already) exists at this level</span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;floatmargins['R']) && $this-&gt;y &lt;= $this-&gt;floatmargins['R']['y1'] && $this-&gt;y &gt;= $this-&gt;floatmargins['R']['y0']) {&nbsp;</div></li><li><div>                      $maxWidth -= $this-&gt;floatmargins['R']['w'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($this-&gt;floatmargins['L']) && $this-&gt;y &lt;= $this-&gt;floatmargins['L']['y1'] && $this-&gt;y &gt;= $this-&gt;floatmargins['L']['y0']) {&nbsp;</div></li><li><div>                      $maxWidth -= $this-&gt;floatmargins['L']['w'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  list($skipln) = $this-&gt;inlineObject($objattr['type'], '', $this-&gt;y, $objattr, $this-&gt;lMargin, ($this-&gt;flowingBlockAttr['contentWidth'] / _MPDFK), $maxWidth, $this-&gt;flowingBlockAttr['height'], false, $is_table);&nbsp;</div></li><li><div>                  <span class="comment">//  1 -&gt; New line needed because of width</span>&nbsp;</div></li><li><div>                  <span class="comment">// -1 -&gt; Will fit width on line but NEW PAGE REQUIRED because of height</span>&nbsp;</div></li><li><div>                  <span class="comment">// -2 -&gt; Will not fit on line therefore needs new line but thus NEW PAGE REQUIRED</span>&nbsp;</div></li><li><div>                  $iby = $this-&gt;y;&nbsp;</div></li><li><div>                  $oldpage = $this-&gt;page;&nbsp;</div></li><li><div>                  $oldcol = $this-&gt;CurrCol;&nbsp;</div></li><li><div>                  if (($skipln == 1 || $skipln == -2) && !isset($objattr['float'])) {&nbsp;</div></li><li><div>                      $this-&gt;finishFlowingBlock(false, $objattr['type']);&nbsp;</div></li><li><div>                      $this-&gt;newFlowingBlock($this-&gt;divwidth, $this-&gt;divheight, $align, $is_table, $blockstate, false, $blockdir, $table_draft);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (!$table_draft) {&nbsp;</div></li><li><div>                      $thispage = $this-&gt;page;&nbsp;</div></li><li><div>                      if ($this-&gt;CurrCol != $oldcol) {&nbsp;</div></li><li><div>                          $changedcol = true;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $changedcol = false;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// the previous lines can already have triggered page break or column change</span>&nbsp;</div></li><li><div>                      if (!$changedcol && $skipln &lt; 0 && $this-&gt;AcceptPageBreak() && $thispage == $oldpage) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment">// Added to correct Images already set on line before page advanced</span>&nbsp;</div></li><li><div>                          <span class="comment">// i.e. if second inline image on line is higher than first and forces new page</span>&nbsp;</div></li><li><div>                          if (count($this-&gt;objectbuffer)) {&nbsp;</div></li><li><div>                              $yadj = $iby - $this-&gt;y;&nbsp;</div></li><li><div>                              foreach ($this-&gt;objectbuffer AS $ib =&gt; $val) {&nbsp;</div></li><li><div>                                  if ($this-&gt;objectbuffer[$ib]['OUTER-Y'])&nbsp;</div></li><li><div>                                      $this-&gt;objectbuffer[$ib]['OUTER-Y'] -= $yadj;&nbsp;</div></li><li><div>                                  if ($this-&gt;objectbuffer[$ib]['BORDER-Y'])&nbsp;</div></li><li><div>                                      $this-&gt;objectbuffer[$ib]['BORDER-Y'] -= $yadj;&nbsp;</div></li><li><div>                                  if ($this-&gt;objectbuffer[$ib]['INNER-Y'])&nbsp;</div></li><li><div>                                      $this-&gt;objectbuffer[$ib]['INNER-Y'] -= $yadj;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added to correct for OddEven Margins</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if ($this-&gt;page != $oldpage) {&nbsp;</div></li><li><div>                          if (($this-&gt;page - $oldpage) % 2 == 1) {&nbsp;</div></li><li><div>                              $bak_x += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $oldpage = $this-&gt;page;&nbsp;</div></li><li><div>                          $y = $this-&gt;tMargin - $paint_ht_corr;&nbsp;</div></li><li><div>                          $this-&gt;oldy = $this-&gt;tMargin - $paint_ht_corr;&nbsp;</div></li><li><div>                          $old_height = 0;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// OR COLUMN CHANGE</span></span></span></span>&nbsp;</div></li><li><div>                      if ($this-&gt;CurrCol != $oldcolumn) {&nbsp;</div></li><li><div>                          if ($this-&gt;directionality == 'rtl') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                              $bak_x -= ($this-&gt;CurrCol - $oldcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                              $bak_x += ($this-&gt;CurrCol - $oldcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                          $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>                          $y = $this-&gt;y0 - $paint_ht_corr;&nbsp;</div></li><li><div>                          $this-&gt;oldy = $this-&gt;y0 - $paint_ht_corr;&nbsp;</div></li><li><div>                          $old_height = 0;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($objattr['type'] == 'image' && isset($objattr['float'])) {&nbsp;</div></li><li><div>                      $fy = $this-&gt;y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// DIV TOP MARGIN/BORDER/PADDING</span>&nbsp;</div></li><li><div>                      if ($this-&gt;flowingBlockAttr['newblock'] && ($this-&gt;flowingBlockAttr['blockstate'] == 1 || $this-&gt;flowingBlockAttr['blockstate'] == 3) && $this-&gt;flowingBlockAttr['lineCount'] == 0) {&nbsp;</div></li><li><div>                          $fy += $this-&gt;blk[$this-&gt;blklvl]['margin_top'] + $this-&gt;blk[$this-&gt;blklvl]['padding_top'] + $this-&gt;blk[$this-&gt;blklvl]['border_top']['w'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($objattr['float'] == 'R') {&nbsp;</div></li><li><div>                          $fx = $this-&gt;w - $this-&gt;rMargin - $objattr['width'] - ($this-&gt;blk[$this-&gt;blklvl]['outer_right_margin'] + $this-&gt;blk[$this-&gt;blklvl]['border_right']['w'] + $this-&gt;blk[$this-&gt;blklvl]['padding_right']);&nbsp;</div></li><li><div>                      } elseif ($objattr['float'] == 'L') {&nbsp;</div></li><li><div>                          $fx = $this-&gt;lMargin + ($this-&gt;blk[$this-&gt;blklvl]['outer_left_margin'] + $this-&gt;blk[$this-&gt;blklvl]['border_left']['w'] + $this-&gt;blk[$this-&gt;blklvl]['padding_left']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $w = $objattr['width'];&nbsp;</div></li><li><div>                      $h = abs($objattr['height']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $widthLeft = $maxWidth - ($this-&gt;flowingBlockAttr['contentWidth'] / _MPDFK);&nbsp;</div></li><li><div>                      $maxHeight = $this-&gt;h - ($this-&gt;tMargin + $this-&gt;margin_header + $this-&gt;bMargin + 10);&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// For Images</span></span>&nbsp;</div></li><li><div>                      $extraWidth = ($objattr['border_left']['w'] + $objattr['border_right']['w'] + $objattr['margin_left'] + $objattr['margin_right']);&nbsp;</div></li><li><div>                      $extraHeight = ($objattr['border_top']['w'] + $objattr['border_bottom']['w'] + $objattr['margin_top'] + $objattr['margin_bottom']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($objattr['itype'] == 'wmf' || $objattr['itype'] == 'svg') {&nbsp;</div></li><li><div>                          $file = $objattr['file'];&nbsp;</div></li><li><div>                          $info = $this-&gt;formobjects[$file];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $file = $objattr['file'];&nbsp;</div></li><li><div>                          $info = $this-&gt;images[$file];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $img_w = $w - $extraWidth;&nbsp;</div></li><li><div>                      $img_h = $h - $extraHeight;&nbsp;</div></li><li><div>                      if ($objattr['border_left']['w']) {&nbsp;</div></li><li><div>                          $objattr['BORDER-WIDTH'] = $img_w + (($objattr['border_left']['w'] + $objattr['border_right']['w']) / 2);&nbsp;</div></li><li><div>                          $objattr['BORDER-HEIGHT'] = $img_h + (($objattr['border_top']['w'] + $objattr['border_bottom']['w']) / 2);&nbsp;</div></li><li><div>                          $objattr['BORDER-X'] = $fx + $objattr['margin_left'] + (($objattr['border_left']['w']) / 2);&nbsp;</div></li><li><div>                          $objattr['BORDER-Y'] = $fy + $objattr['margin_top'] + (($objattr['border_top']['w']) / 2);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $objattr['INNER-WIDTH'] = $img_w;&nbsp;</div></li><li><div>                      $objattr['INNER-HEIGHT'] = $img_h;&nbsp;</div></li><li><div>                      $objattr['INNER-X'] = $fx + $objattr['margin_left'] + ($objattr['border_left']['w']);&nbsp;</div></li><li><div>                      $objattr['INNER-Y'] = $fy + $objattr['margin_top'] + ($objattr['border_top']['w']);&nbsp;</div></li><li><div>                      $objattr['ID'] = $info['i'];&nbsp;</div></li><li><div>                      $objattr['OUTER-WIDTH'] = $w;&nbsp;</div></li><li><div>                      $objattr['OUTER-HEIGHT'] = $h;&nbsp;</div></li><li><div>                      $objattr['OUTER-X'] = $fx;&nbsp;</div></li><li><div>                      $objattr['OUTER-Y'] = $fy;&nbsp;</div></li><li><div>                      if ($objattr['float'] == 'R') {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// If R float already exists at this level</span></span>&nbsp;</div></li><li><div>                          $this-&gt;floatmargins['R']['skipline'] = false;&nbsp;</div></li><li><div>                          if (isset($this-&gt;floatmargins['R']['y1']) && $this-&gt;floatmargins['R']['y1'] &gt; 0 && $fy &lt; $this-&gt;floatmargins['R']['y1']) {&nbsp;</div></li><li><div>                              $this-&gt;WriteFlowingBlock($vetor[0], $vetor[18]);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// If L float already exists at this level</span></span>&nbsp;</div></li><li><div>                          elseif (isset($this-&gt;floatmargins['L']['y1']) && $this-&gt;floatmargins['L']['y1'] &gt; 0 && $fy &lt; $this-&gt;floatmargins['L']['y1']) {&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment">// Final check distance between floats is not now too narrow to fit text</span></span>&nbsp;</div></li><li><div>                              $mw = 2 * $this-&gt;GetCharWidth('W', false);&nbsp;</div></li><li><div>                              if (($this-&gt;blk[$this-&gt;blklvl]['inner_width'] - $w - $this-&gt;floatmargins['L']['w']) &lt; $mw) {&nbsp;</div></li><li><div>                                  $this-&gt;WriteFlowingBlock($vetor[0], $vetor[18]);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['R']['x'] = $fx;&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['R']['w'] = $w;&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['R']['y0'] = $fy;&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['R']['y1'] = $fy + $h;&nbsp;</div></li><li><div>                                  if ($skipln == 1) {&nbsp;</div></li><li><div>                                      $this-&gt;floatmargins['R']['skipline'] = true;&nbsp;</div></li><li><div>                                      $this-&gt;floatmargins['R']['id'] = count($this-&gt;floatbuffer) + 0;&nbsp;</div></li><li><div>                                      $objattr['skipline'] = true;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;floatbuffer[] = $objattr;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;floatmargins['R']['x'] = $fx;&nbsp;</div></li><li><div>                              $this-&gt;floatmargins['R']['w'] = $w;&nbsp;</div></li><li><div>                              $this-&gt;floatmargins['R']['y0'] = $fy;&nbsp;</div></li><li><div>                              $this-&gt;floatmargins['R']['y1'] = $fy + $h;&nbsp;</div></li><li><div>                              if ($skipln == 1) {&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['R']['skipline'] = true;&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['R']['id'] = count($this-&gt;floatbuffer) + 0;&nbsp;</div></li><li><div>                                  $objattr['skipline'] = true;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $this-&gt;floatbuffer[] = $objattr;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif ($objattr['float'] == 'L') {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// If L float already exists at this level</span></span>&nbsp;</div></li><li><div>                          $this-&gt;floatmargins['L']['skipline'] = false;&nbsp;</div></li><li><div>                          if (isset($this-&gt;floatmargins['L']['y1']) && $this-&gt;floatmargins['L']['y1'] &gt; 0 && $fy &lt; $this-&gt;floatmargins['L']['y1']) {&nbsp;</div></li><li><div>                              $this-&gt;floatmargins['L']['skipline'] = false;&nbsp;</div></li><li><div>                              $this-&gt;WriteFlowingBlock($vetor[0], $vetor[18]);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// If R float already exists at this level</span></span>&nbsp;</div></li><li><div>                          elseif (isset($this-&gt;floatmargins['R']['y1']) && $this-&gt;floatmargins['R']['y1'] &gt; 0 && $fy &lt; $this-&gt;floatmargins['R']['y1']) {&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment">// Final check distance between floats is not now too narrow to fit text</span></span>&nbsp;</div></li><li><div>                              $mw = 2 * $this-&gt;GetCharWidth('W', false);&nbsp;</div></li><li><div>                              if (($this-&gt;blk[$this-&gt;blklvl]['inner_width'] - $w - $this-&gt;floatmargins['R']['w']) &lt; $mw) {&nbsp;</div></li><li><div>                                  $this-&gt;WriteFlowingBlock($vetor[0], $vetor[18]);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['L']['x'] = $fx + $w;&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['L']['w'] = $w;&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['L']['y0'] = $fy;&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['L']['y1'] = $fy + $h;&nbsp;</div></li><li><div>                                  if ($skipln == 1) {&nbsp;</div></li><li><div>                                      $this-&gt;floatmargins['L']['skipline'] = true;&nbsp;</div></li><li><div>                                      $this-&gt;floatmargins['L']['id'] = count($this-&gt;floatbuffer) + 0;&nbsp;</div></li><li><div>                                      $objattr['skipline'] = true;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;floatbuffer[] = $objattr;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;floatmargins['L']['x'] = $fx + $w;&nbsp;</div></li><li><div>                              $this-&gt;floatmargins['L']['w'] = $w;&nbsp;</div></li><li><div>                              $this-&gt;floatmargins['L']['y0'] = $fy;&nbsp;</div></li><li><div>                              $this-&gt;floatmargins['L']['y1'] = $fy + $h;&nbsp;</div></li><li><div>                              if ($skipln == 1) {&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['L']['skipline'] = true;&nbsp;</div></li><li><div>                                  $this-&gt;floatmargins['L']['id'] = count($this-&gt;floatbuffer) + 0;&nbsp;</div></li><li><div>                                  $objattr['skipline'] = true;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $this-&gt;floatbuffer[] = $objattr;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;WriteFlowingBlock($vetor[0], (isset($vetor[18]) ? $vetor[18] : NULL));  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END CSS-IMAGE-FLOAT -- */</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          } <span class="comment">// END If special content</span>&nbsp;</div></li><li><div>          else { <span class="comment">//THE text</span>&nbsp;</div></li><li><div>              if ($this-&gt;tableLevel) {&nbsp;</div></li><li><div>                  $paint_ht_corr = 0;&nbsp;</div></li><li><div>              } <span class="comment">// To move the y up when new column/page started if div border needed</span>&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $paint_ht_corr = $this-&gt;blk[$this-&gt;blklvl]['border_top']['w'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($vetor[0] == &quot;\n&quot;) { <span class="comment">//We are reading a &lt;BR&gt; now turned into newline (&quot;\n&quot;)</span>&nbsp;</div></li><li><div>                  if ($this-&gt;flowingBlockAttr['content']) {&nbsp;</div></li><li><div>                      $this-&gt;finishFlowingBlock(false, 'br');&nbsp;</div></li><li><div>                  } elseif ($is_table) {&nbsp;</div></li><li><div>                      $this-&gt;y+= $this-&gt;_computeLineheight($this-&gt;cellLineHeight);&nbsp;</div></li><li><div>                  } elseif (!$is_table) {&nbsp;</div></li><li><div>                      $this-&gt;DivLn($this-&gt;lineheight);&nbsp;</div></li><li><div>                      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                          $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added to correct for OddEven Margins</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;page != $oldpage) {&nbsp;</div></li><li><div>                      if (($this-&gt;page - $oldpage) % 2 == 1) {&nbsp;</div></li><li><div>                          $bak_x += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $oldpage = $this-&gt;page;&nbsp;</div></li><li><div>                      $y = $this-&gt;tMargin - $paint_ht_corr;&nbsp;</div></li><li><div>                      $this-&gt;oldy = $this-&gt;tMargin - $paint_ht_corr;&nbsp;</div></li><li><div>                      $old_height = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// OR COLUMN CHANGE</span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;CurrCol != $oldcolumn) {&nbsp;</div></li><li><div>                      if ($this-&gt;directionality == 'rtl') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $bak_x -= ($this-&gt;CurrCol - $oldcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $bak_x += ($this-&gt;CurrCol - $oldcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                      $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>                      $y = $this-&gt;y0 - $paint_ht_corr;&nbsp;</div></li><li><div>                      $this-&gt;oldy = $this-&gt;y0 - $paint_ht_corr;&nbsp;</div></li><li><div>                      $old_height = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;newFlowingBlock($this-&gt;divwidth, $this-&gt;divheight, $align, $is_table, $blockstate, false, $blockdir, $table_draft);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;WriteFlowingBlock($vetor[0], $vetor[18]);  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added to correct for OddEven Margins</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;page != $oldpage) {&nbsp;</div></li><li><div>                      if (($this-&gt;page - $oldpage) % 2 == 1) {&nbsp;</div></li><li><div>                          $bak_x += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                          $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $oldpage = $this-&gt;page;&nbsp;</div></li><li><div>                      $y = $this-&gt;tMargin - $paint_ht_corr;&nbsp;</div></li><li><div>                      $this-&gt;oldy = $this-&gt;tMargin - $paint_ht_corr;&nbsp;</div></li><li><div>                      $old_height = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// OR COLUMN CHANGE</span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;CurrCol != $oldcolumn) {&nbsp;</div></li><li><div>                      if ($this-&gt;directionality == 'rtl') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $bak_x -= ($this-&gt;CurrCol - $oldcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $bak_x += ($this-&gt;CurrCol - $oldcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                      $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>                      $y = $this-&gt;y0 - $paint_ht_corr;&nbsp;</div></li><li><div>                      $this-&gt;oldy = $this-&gt;y0 - $paint_ht_corr;&nbsp;</div></li><li><div>                      $old_height = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">//Check if it is the last element. If so then finish printing the block</span></span></span>&nbsp;</div></li><li><div>          if ($i == ($array_size - 1)) {&nbsp;</div></li><li><div>              $this-&gt;finishFlowingBlock(true); <span class="comment"><span class="comment"><span class="comment"><span class="comment">// true = END of flowing block</span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added to correct for OddEven Margins</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($this-&gt;page != $oldpage) {&nbsp;</div></li><li><div>                  if (($this-&gt;page - $oldpage) % 2 == 1) {&nbsp;</div></li><li><div>                      $bak_x += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                      $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $oldpage = $this-&gt;page;&nbsp;</div></li><li><div>                  $y = $this-&gt;tMargin - $paint_ht_corr;&nbsp;</div></li><li><div>                  $this-&gt;oldy = $this-&gt;tMargin - $paint_ht_corr;&nbsp;</div></li><li><div>                  $old_height = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// OR COLUMN CHANGE</span></span></span></span>&nbsp;</div></li><li><div>              if ($this-&gt;CurrCol != $oldcolumn) {&nbsp;</div></li><li><div>                  if ($this-&gt;directionality == 'rtl') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $bak_x -= ($this-&gt;CurrCol - $oldcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $bak_x += ($this-&gt;CurrCol - $oldcolumn) * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                  $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>                  $y = $this-&gt;y0 - $paint_ht_corr;&nbsp;</div></li><li><div>                  $this-&gt;oldy = $this-&gt;y0 - $paint_ht_corr;&nbsp;</div></li><li><div>                  $old_height = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// RESETTING VALUES</span></span>&nbsp;</div></li><li><div>          $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>          $this-&gt;colorarray = '';&nbsp;</div></li><li><div>          $this-&gt;spanbgcolorarray = '';&nbsp;</div></li><li><div>          $this-&gt;spanbgcolor = false;&nbsp;</div></li><li><div>          $this-&gt;spanborder = false;&nbsp;</div></li><li><div>          $this-&gt;spanborddet = array();&nbsp;</div></li><li><div>          $this-&gt;HREF = '';&nbsp;</div></li><li><div>          $this-&gt;textparam = array();&nbsp;</div></li><li><div>          $this-&gt;SetTextOutline();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;textvar = 0x00; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;OTLtags = array();&nbsp;</div></li><li><div>          $this-&gt;textshadow = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;currentfontfamily = '';&nbsp;</div></li><li><div>          $this-&gt;currentfontsize = '';&nbsp;</div></li><li><div>          $this-&gt;currentfontstyle = '';&nbsp;</div></li><li><div>          $this-&gt;currentLang = $this-&gt;default_lang;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;RestrictUnicodeFonts($this-&gt;default_available_fonts); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;tableLevel) {&nbsp;</div></li><li><div>              $this-&gt;SetLineHeight('', $this-&gt;table[1][1]['cellLineHeight']); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          } else&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['line_height']) && $this-&gt;blk[$this-&gt;blklvl]['line_height']) {&nbsp;</div></li><li><div>              $this-&gt;SetLineHeight('', $this-&gt;blk[$this-&gt;blklvl]['line_height']); <span class="comment"><span class="comment">// sets default line height</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;ResetStyles();&nbsp;</div></li><li><div>          $this-&gt;lSpacingCSS = '';&nbsp;</div></li><li><div>          $this-&gt;wSpacingCSS = '';&nbsp;</div></li><li><div>          $this-&gt;fixedlSpacing = false;&nbsp;</div></li><li><div>          $this-&gt;minwSpacing = 0;&nbsp;</div></li><li><div>          $this-&gt;SetDash();&nbsp;</div></li><li><div>          $this-&gt;dash_on = false;&nbsp;</div></li><li><div>          $this-&gt;dotted_on = false;&nbsp;</div></li><li><div>      }<span class="comment">//end of for(i=0;i&lt;arraysize;i++)</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;Reset(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// PAINT DIV BORDER    // DISABLED IN COLUMNS AS DOESN'T WORK WHEN BROKEN ACROSS COLS??</span>&nbsp;</div></li><li><div>      if ((isset($this-&gt;blk[$this-&gt;blklvl]['border']) || isset($this-&gt;blk[$this-&gt;blklvl]['bgcolor']) || isset($this-&gt;blk[$this-&gt;blklvl]['box_shadow'])) && $blockstate && ($this-&gt;y != $this-&gt;oldy)) {&nbsp;</div></li><li><div>          $bottom_y = $this-&gt;y; <span class="comment">// Does not include Bottom Margin</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$this-&gt;blklvl]['startpage']) && $this-&gt;blk[$this-&gt;blklvl]['startpage'] != $this-&gt;page && $blockstate != 1) {&nbsp;</div></li><li><div>              $this-&gt;PaintDivBB('pagetop', $blockstate);&nbsp;</div></li><li><div>          } elseif ($blockstate != 1) {&nbsp;</div></li><li><div>              $this-&gt;PaintDivBB('', $blockstate);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;y = $bottom_y;&nbsp;</div></li><li><div>          $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Reset</span> Font</span>&nbsp;</div></li><li><div>      $this-&gt;SetFontSize($this-&gt;default_font_size, false);&nbsp;</div></li><li><div>      if ($table_draft) {&nbsp;</div></li><li><div>          $ch = $this-&gt;y - $bak_y;&nbsp;</div></li><li><div>          $this-&gt;y = $bak_y;&nbsp;</div></li><li><div>          $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>          return $ch;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _setDashBorder($style, $div, $cp, $side)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($style == 'dashed' && (($side == 'L' || $side == 'R') || ($side == 'T' && $div != 'pagetop' && !$cp) || ($side == 'B' && $div != 'pagebottom') )) {&nbsp;</div></li><li><div>          $dashsize = 2; <span class="comment"><span class="comment">// final dash will be this + 1*linewidth</span></span>&nbsp;</div></li><li><div>          $dashsizek = 1.5; <span class="comment"><span class="comment">// ratio of Dash/Blank</span></span>&nbsp;</div></li><li><div>          $this-&gt;SetDash($dashsize, ($dashsize / $dashsizek) + ($this-&gt;LineWidth * 2));&nbsp;</div></li><li><div>      } elseif ($style == 'dotted' || ($side == 'T' && ($div == 'pagetop' || $cp)) || ($side == 'B' && $div == 'pagebottom')) {&nbsp;</div></li><li><div>          <span class="comment">//Round join and cap</span>&nbsp;</div></li><li><div>          $this-&gt;SetLineJoin(1);&nbsp;</div></li><li><div>          $this-&gt;SetLineCap(1);&nbsp;</div></li><li><div>          $this-&gt;SetDash(0.001, ($this-&gt;LineWidth * 3));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _setBorderLine($b, $k = 1)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;SetLineWidth($b['w'] / $k);&nbsp;</div></li><li><div>      $this-&gt;SetDColor($b['c']);&nbsp;</div></li><li><div>      if ($b['c'][0] == 5) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;SetAlpha(ord($b['c'][4]) / 100, 'Normal', false, 'S') . &quot;\n&quot;; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>      } elseif ($b['c'][0] == 6) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;SetAlpha(ord($b['c'][5]) / 100, 'Normal', false, 'S') . &quot;\n&quot;; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function PaintDivBB($divider = '', $blockstate = 0, $blvl = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Borders & backgrounds are done elsewhere for columns - messes up the repositioning in printcolumnbuffer</span>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;keep_block_together) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $save_y = $this-&gt;y;&nbsp;</div></li><li><div>      if (!$blvl) {&nbsp;</div></li><li><div>          $blvl = $this-&gt;blklvl;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $x0 = $x1 = $y0 = $y1 = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added mPDF 3.0</span> Float DIV</span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['bb_painted'][$this-&gt;page]) && $this-&gt;blk[$blvl]['bb_painted'][$this-&gt;page]) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      } <span class="comment">// *CSS-FLOAT*</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['x0'])) {&nbsp;</div></li><li><div>          $x0 = $this-&gt;blk[$blvl]['x0'];&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment">// left</span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['y1'])) {&nbsp;</div></li><li><div>          $y1 = $this-&gt;blk[$blvl]['y1'];&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment">// bottom</span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added mPDF 3.0</span> Float DIV</span></span></span> - ensures backgrounds/borders are drawn to bottom of page&nbsp;</div></li><li><div>      if ($y1 == 0) {&nbsp;</div></li><li><div>          if ($divider == 'pagebottom') {&nbsp;</div></li><li><div>              $y1 = $this-&gt;h - $this-&gt;bMargin;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $y1 = $this-&gt;y;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['startpage']) && $this-&gt;blk[$blvl]['startpage'] != $this-&gt;page) {&nbsp;</div></li><li><div>          $continuingpage = true;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $continuingpage = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['y0'])) {&nbsp;</div></li><li><div>          $y0 = $this-&gt;blk[$blvl]['y0'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $h = $y1 - $y0;&nbsp;</div></li><li><div>      $w = $this-&gt;blk[$blvl]['width'];&nbsp;</div></li><li><div>      $x1 = $x0 + $w;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Set border-widths as used here</span>&nbsp;</div></li><li><div>      $border_top = $this-&gt;blk[$blvl]['border_top']['w'];&nbsp;</div></li><li><div>      $border_bottom = $this-&gt;blk[$blvl]['border_bottom']['w'];&nbsp;</div></li><li><div>      $border_left = $this-&gt;blk[$blvl]['border_left']['w'];&nbsp;</div></li><li><div>      $border_right = $this-&gt;blk[$blvl]['border_right']['w'];&nbsp;</div></li><li><div>      if (!$this-&gt;blk[$blvl]['border_top'] || $divider == 'pagetop' || $continuingpage) {&nbsp;</div></li><li><div>          $border_top = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;blk[$blvl]['border_bottom'] || $blockstate == 1 || $divider == 'pagebottom') {&nbsp;</div></li><li><div>          $border_bottom = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $brTL_H = 0;&nbsp;</div></li><li><div>      $brTL_V = 0;&nbsp;</div></li><li><div>      $brTR_H = 0;&nbsp;</div></li><li><div>      $brTR_V = 0;&nbsp;</div></li><li><div>      $brBL_H = 0;&nbsp;</div></li><li><div>      $brBL_V = 0;&nbsp;</div></li><li><div>      $brBR_H = 0;&nbsp;</div></li><li><div>      $brBR_V = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $brset = false;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['border_radius_TL_H'])) {&nbsp;</div></li><li><div>          $brTL_H = $this-&gt;blk[$blvl]['border_radius_TL_H'];&nbsp;</div></li><li><div>          $brset = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['border_radius_TL_V'])) {&nbsp;</div></li><li><div>          $brTL_V = $this-&gt;blk[$blvl]['border_radius_TL_V'];&nbsp;</div></li><li><div>          $brset = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['border_radius_TR_H'])) {&nbsp;</div></li><li><div>          $brTR_H = $this-&gt;blk[$blvl]['border_radius_TR_H'];&nbsp;</div></li><li><div>          $brset = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['border_radius_TR_V'])) {&nbsp;</div></li><li><div>          $brTR_V = $this-&gt;blk[$blvl]['border_radius_TR_V'];&nbsp;</div></li><li><div>          $brset = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['border_radius_BR_H'])) {&nbsp;</div></li><li><div>          $brBR_H = $this-&gt;blk[$blvl]['border_radius_BR_H'];&nbsp;</div></li><li><div>          $brset = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['border_radius_BR_V'])) {&nbsp;</div></li><li><div>          $brBR_V = $this-&gt;blk[$blvl]['border_radius_BR_V'];&nbsp;</div></li><li><div>          $brset = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['border_radius_BL_H'])) {&nbsp;</div></li><li><div>          $brBL_H = $this-&gt;blk[$blvl]['border_radius_BL_H'];&nbsp;</div></li><li><div>          $brset = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['border_radius_BL_V'])) {&nbsp;</div></li><li><div>          $brBL_V = $this-&gt;blk[$blvl]['border_radius_BL_V'];&nbsp;</div></li><li><div>          $brset = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;blk[$blvl]['border_top'] || $divider == 'pagetop' || $continuingpage) {&nbsp;</div></li><li><div>          $brTL_H = 0;&nbsp;</div></li><li><div>          $brTL_V = 0;&nbsp;</div></li><li><div>          $brTR_H = 0;&nbsp;</div></li><li><div>          $brTR_V = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;blk[$blvl]['border_bottom'] || $blockstate == 1 || $divider == 'pagebottom') {&nbsp;</div></li><li><div>          $brBL_H = 0;&nbsp;</div></li><li><div>          $brBL_V = 0;&nbsp;</div></li><li><div>          $brBR_H = 0;&nbsp;</div></li><li><div>          $brBR_V = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Disallow border-radius if it is smaller than the border width.</span>&nbsp;</div></li><li><div>      if ($brTL_H &lt; min($border_left, $border_top)) {&nbsp;</div></li><li><div>          $brTL_H = $brTL_V = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($brTL_V &lt; min($border_left, $border_top)) {&nbsp;</div></li><li><div>          $brTL_V = $brTL_H = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($brTR_H &lt; min($border_right, $border_top)) {&nbsp;</div></li><li><div>          $brTR_H = $brTR_V = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($brTR_V &lt; min($border_right, $border_top)) {&nbsp;</div></li><li><div>          $brTR_V = $brTR_H = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($brBL_H &lt; min($border_left, $border_bottom)) {&nbsp;</div></li><li><div>          $brBL_H = $brBL_V = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($brBL_V &lt; min($border_left, $border_bottom)) {&nbsp;</div></li><li><div>          $brBL_V = $brBL_H = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($brBR_H &lt; min($border_right, $border_bottom)) {&nbsp;</div></li><li><div>          $brBR_H = $brBR_V = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($brBR_V &lt; min($border_right, $border_bottom)) {&nbsp;</div></li><li><div>          $brBR_V = $brBR_H = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// CHECK FOR radii that sum to &gt; width or height of div ********</span>&nbsp;</div></li><li><div>      $f = min($h / ($brTL_V + $brBL_V + 0.001), $h / ($brTR_V + $brBR_V + 0.001), $w / ($brTL_H + $brTR_H + 0.001), $w / ($brBL_H + $brBR_H + 0.001));&nbsp;</div></li><li><div>      if ($f &lt; 1) {&nbsp;</div></li><li><div>          $brTL_H *= $f;&nbsp;</div></li><li><div>          $brTL_V *= $f;&nbsp;</div></li><li><div>          $brTR_H *= $f;&nbsp;</div></li><li><div>          $brTR_V *= $f;&nbsp;</div></li><li><div>          $brBL_H *= $f;&nbsp;</div></li><li><div>          $brBL_V *= $f;&nbsp;</div></li><li><div>          $brBR_H *= $f;&nbsp;</div></li><li><div>          $brBR_V *= $f;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tbcol = $this-&gt;ConvertColor(255);&nbsp;</div></li><li><div>      for ($l = 0; $l &lt;= $blvl; $l++) {&nbsp;</div></li><li><div>          if ($this-&gt;blk[$l]['bgcolor']) {&nbsp;</div></li><li><div>              $tbcol = $this-&gt;blk[$l]['bgcolorarray'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// BORDERS</span></span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['y0']) && $this-&gt;blk[$blvl]['y0']) {&nbsp;</div></li><li><div>          $y0 = $this-&gt;blk[$blvl]['y0'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $h = $y1 - $y0;&nbsp;</div></li><li><div>      $w = $this-&gt;blk[$blvl]['width'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;blk[$blvl]['border_top'] && $divider != 'pagetop' && !$continuingpage) {&nbsp;</div></li><li><div>          $tbd = $this-&gt;blk[$blvl]['border_top'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $legend = '';&nbsp;</div></li><li><div>          $legbreakL = 0;&nbsp;</div></li><li><div>          $legbreakR = 0;&nbsp;</div></li><li><div>          <span class="comment">// BORDER LEGEND</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$blvl]['border_legend']) && $this-&gt;blk[$blvl]['border_legend']) {&nbsp;</div></li><li><div>              $legend = $this-&gt;blk[$blvl]['border_legend']; <span class="comment">// Same structure array as textbuffer</span>&nbsp;</div></li><li><div>              $txt = $legend[0] = ltrim($legend[0]);&nbsp;</div></li><li><div>              if (!empty($legend[18])) {&nbsp;</div></li><li><div>                  $this-&gt;otl-&gt;trimOTLdata($legend[18], true, false);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment">//Set font</span>, size, style, color&nbsp;</div></li><li><div>              $this-&gt;SetFont($legend[4], $legend[2], $legend[11]);&nbsp;</div></li><li><div>              if (isset($legend[3]) && $legend[3]) {&nbsp;</div></li><li><div>                  $cor = $legend[3];&nbsp;</div></li><li><div>                  $this-&gt;SetTColor($cor);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $stringWidth = $this-&gt;GetStringWidth($txt, true, $legend[18], $legend[8]);&nbsp;</div></li><li><div>              $save_x = $this-&gt;x;&nbsp;</div></li><li><div>              $save_y = $this-&gt;y;&nbsp;</div></li><li><div>              $save_currentfontfamily = $this-&gt;FontFamily;&nbsp;</div></li><li><div>              $save_currentfontsize = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>              $save_currentfontstyle = $this-&gt;FontStyle;&nbsp;</div></li><li><div>              $this-&gt;y = $y0 - $this-&gt;FontSize / 2 + $this-&gt;blk[$blvl]['border_top']['w'] / 2;&nbsp;</div></li><li><div>              $this-&gt;x = $x0 + $this-&gt;blk[$blvl]['padding_left'] + $this-&gt;blk[$blvl]['border_left']['w'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Set the distance from the border line to the text ? make configurable variable</span>&nbsp;</div></li><li><div>              $gap = 0.2 * $this-&gt;FontSize;&nbsp;</div></li><li><div>              $legbreakL = $this-&gt;x - $gap;&nbsp;</div></li><li><div>              $legbreakR = $this-&gt;x + $stringWidth + $gap;&nbsp;</div></li><li><div>              $this-&gt;magic_reverse_dir($txt, $this-&gt;blk[$blvl]['direction'], $legend[18]);&nbsp;</div></li><li><div>              $fill = '';&nbsp;</div></li><li><div>              $this-&gt;Cell($stringWidth, $this-&gt;FontSize, $txt, '', 0, 'C', $fill, '', 0, 0, 0, 'M', $fill, false, $legend[18], $legend[8]);&nbsp;</div></li><li><div>              <span class="comment">// Reset</span>&nbsp;</div></li><li><div>              $this-&gt;x = $save_x;&nbsp;</div></li><li><div>              $this-&gt;y = $save_y;&nbsp;</div></li><li><div>              $this-&gt;SetFont($save_currentfontfamily, $save_currentfontstyle, $save_currentfontsize);&nbsp;</div></li><li><div>              $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($tbd['s']) && $tbd['s']) {&nbsp;</div></li><li><div>              if (!$brset && $tbd['style'] != 'dotted' && $tbd['style'] != 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_out('q');&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth(0);&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F m ', ($x0) * _MPDFK, ($this-&gt;h - ($y0)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $border_left) * _MPDFK, ($this-&gt;h - ($y0 + $border_top)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $w - $border_right) * _MPDFK, ($this-&gt;h - ($y0 + $border_top)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $w) * _MPDFK, ($this-&gt;h - ($y0)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(' h W n '); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $legbreakL -= $border_top / 2; <span class="comment">// because line cap different</span>&nbsp;</div></li><li><div>                  $legbreakR += $border_top / 2;&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], $divider, $continuingpage, 'T');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif (($brTL_V && $brTL_H) || ($brTR_V && $brTR_H) || $tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s = '';&nbsp;</div></li><li><div>              if ($brTR_H && $brTR_V) {&nbsp;</div></li><li><div>                  $s .= ($this-&gt;_EllipseArc($x0 + $w - $brTR_H, $y0 + $brTR_V, $brTR_H - $border_top / 2, $brTR_V - $border_top / 2, 1, 2, true)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F m ', ($x0 + $w) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F m ', ($x0 + $w - ($border_top / 2)) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($brTL_H && $brTL_V) {&nbsp;</div></li><li><div>                  if ($legend) {&nbsp;</div></li><li><div>                      if ($legbreakR &lt; ($x0 + $w - $brTR_H)) {&nbsp;</div></li><li><div>                          $s .= (sprintf('%.3F %.3F l ', $legbreakR * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($legbreakL &gt; ($x0 + $brTL_H )) {&nbsp;</div></li><li><div>                          $s .= (sprintf('%.3F %.3F m ', $legbreakL * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                          $s .= (sprintf('%.3F %.3F l ', ($x0 + $brTL_H ) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK) . &quot;\n&quot;);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $s .= (sprintf('%.3F %.3F m ', ($x0 + $brTL_H ) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s .= (sprintf('%.3F %.3F l ', ($x0 + $brTL_H ) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $s .= ($this-&gt;_EllipseArc($x0 + $brTL_H, $y0 + $brTL_V, $brTL_H - $border_top / 2, $brTL_V - $border_top / 2, 2, 1)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($legend) {&nbsp;</div></li><li><div>                      if ($legbreakR &lt; ($x0 + $w)) {&nbsp;</div></li><li><div>                          $s .= (sprintf('%.3F %.3F l ', $legbreakR * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($legbreakL &gt; ($x0)) {&nbsp;</div></li><li><div>                          $s .= (sprintf('%.3F %.3F m ', $legbreakL * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                          if ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                              $s .= (sprintf('%.3F %.3F l ', ($x0) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $s .= (sprintf('%.3F %.3F l ', ($x0 + ($border_top / 2)) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                          $s .= (sprintf('%.3F %.3F m ', ($x0) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $s .= (sprintf('%.3F %.3F m ', ($x0 + $border_top / 2) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                      $s .= (sprintf('%.3F %.3F l ', ($x0) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s .= (sprintf('%.3F %.3F l ', ($x0 + ($border_top / 2)) * _MPDFK, ($this-&gt;h - ($y0 + ($border_top / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $s .= 'S' . &quot;\n&quot;;&nbsp;</div></li><li><div>              $this-&gt;_out($s);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth($tbd['w'] / 3);&nbsp;</div></li><li><div>                  $this-&gt;SetDColor($tbcol);&nbsp;</div></li><li><div>                  $this-&gt;_out($s);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!$brset && $tbd['style'] != 'dotted' && $tbd['style'] != 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_out('Q');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineWidth(0.1);&nbsp;</div></li><li><div>              $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Reinstate line above for dotted line divider when block border crosses a page</span>&nbsp;</div></li><li><div>      <span class="comment">//elseif ($divider == 'pagetop' || $continuingpage) {</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;blk[$blvl]['border_bottom'] && $blockstate != 1 && $divider != 'pagebottom') {&nbsp;</div></li><li><div>          $tbd = $this-&gt;blk[$blvl]['border_bottom'];&nbsp;</div></li><li><div>          if (isset($tbd['s']) && $tbd['s']) {&nbsp;</div></li><li><div>              if (!$brset && $tbd['style'] != 'dotted' && $tbd['style'] != 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_out('q');&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth(0);&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F m ', ($x0) * _MPDFK, ($this-&gt;h - ($y0 + $h)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $border_left) * _MPDFK, ($this-&gt;h - ($y0 + $h - $border_bottom)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $w - $border_right) * _MPDFK, ($this-&gt;h - ($y0 + $h - $border_bottom)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $w) * _MPDFK, ($this-&gt;h - ($y0 + $h)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(' h W n '); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], $divider, $continuingpage, 'B');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif (($brBL_V && $brBL_H) || ($brBR_V && $brBR_H) || $tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s = '';&nbsp;</div></li><li><div>              if ($brBL_H && $brBL_V) {&nbsp;</div></li><li><div>                  $s .= ($this-&gt;_EllipseArc($x0 + $brBL_H, $y0 + $h - $brBL_V, $brBL_H - $border_bottom / 2, $brBL_V - $border_bottom / 2, 3, 2, true)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F m ', ($x0) * _MPDFK, ($this-&gt;h - ($y0 + $h - ($border_bottom / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F m ', ($x0 + ($border_bottom / 2)) * _MPDFK, ($this-&gt;h - ($y0 + $h - ($border_bottom / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($brBR_H && $brBR_V) {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F l ', ($x0 + $w - ($border_bottom / 2) - $brBR_H ) * _MPDFK, ($this-&gt;h - ($y0 + $h - ($border_bottom / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  $s .= ($this-&gt;_EllipseArc($x0 + $w - $brBR_H, $y0 + $h - $brBR_V, $brBR_H - $border_bottom / 2, $brBR_V - $border_bottom / 2, 4, 1)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F l ', ($x0 + $w) * _MPDFK, ($this-&gt;h - ($y0 + $h - ($border_bottom / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F l ', ($x0 + $w - ($border_bottom / 2)) * _MPDFK, ($this-&gt;h - ($y0 + $h - ($border_bottom / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s .= 'S' . &quot;\n&quot;;&nbsp;</div></li><li><div>              $this-&gt;_out($s);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth($tbd['w'] / 3);&nbsp;</div></li><li><div>                  $this-&gt;SetDColor($tbcol);&nbsp;</div></li><li><div>                  $this-&gt;_out($s);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!$brset && $tbd['style'] != 'dotted' && $tbd['style'] != 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_out('Q');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineWidth(0.1);&nbsp;</div></li><li><div>              $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Reinstate line below for dotted line divider when block border crosses a page</span>&nbsp;</div></li><li><div>      <span class="comment">//elseif ($blockstate == 1 || $divider == 'pagebottom') {</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;blk[$blvl]['border_left']) {&nbsp;</div></li><li><div>          $tbd = $this-&gt;blk[$blvl]['border_left'];&nbsp;</div></li><li><div>          if (isset($tbd['s']) && $tbd['s']) {&nbsp;</div></li><li><div>              if (!$brset && $tbd['style'] != 'dotted' && $tbd['style'] != 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_out('q');&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth(0);&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F m ', ($x0) * _MPDFK, ($this-&gt;h - ($y0)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $border_left) * _MPDFK, ($this-&gt;h - ($y0 + $border_top)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $border_left) * _MPDFK, ($this-&gt;h - ($y0 + $h - $border_bottom)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0) * _MPDFK, ($this-&gt;h - ($y0 + $h)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(' h W n '); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], $divider, $continuingpage, 'L');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif (($brTL_V && $brTL_H) || ($brBL_V && $brBL_H) || $tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s = '';&nbsp;</div></li><li><div>              if ($brTL_V && $brTL_H) {&nbsp;</div></li><li><div>                  $s .= ($this-&gt;_EllipseArc($x0 + $brTL_H, $y0 + $brTL_V, $brTL_H - $border_left / 2, $brTL_V - $border_left / 2, 2, 2, true)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F m ', ($x0 + ($border_left / 2)) * _MPDFK, ($this-&gt;h - ($y0)) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F m ', ($x0 + ($border_left / 2)) * _MPDFK, ($this-&gt;h - ($y0 + ($border_left / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($brBL_V && $brBL_H) {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F l ', ($x0 + ($border_left / 2)) * _MPDFK, ($this-&gt;h - ($y0 + $h - ($border_left / 2) - $brBL_V) ) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  $s .= ($this-&gt;_EllipseArc($x0 + $brBL_H, $y0 + $h - $brBL_V, $brBL_H - $border_left / 2, $brBL_V - $border_left / 2, 3, 1)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F l ', ($x0 + ($border_left / 2)) * _MPDFK, ($this-&gt;h - ($y0 + $h) ) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F l ', ($x0 + ($border_left / 2)) * _MPDFK, ($this-&gt;h - ($y0 + $h - ($border_left / 2)) ) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s .= 'S' . &quot;\n&quot;;&nbsp;</div></li><li><div>              $this-&gt;_out($s);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth($tbd['w'] / 3);&nbsp;</div></li><li><div>                  $this-&gt;SetDColor($tbcol);&nbsp;</div></li><li><div>                  $this-&gt;_out($s);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!$brset && $tbd['style'] != 'dotted' && $tbd['style'] != 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_out('Q');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineWidth(0.1);&nbsp;</div></li><li><div>              $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;blk[$blvl]['border_right']) {&nbsp;</div></li><li><div>          $tbd = $this-&gt;blk[$blvl]['border_right'];&nbsp;</div></li><li><div>          if (isset($tbd['s']) && $tbd['s']) {&nbsp;</div></li><li><div>              if (!$brset && $tbd['style'] != 'dotted' && $tbd['style'] != 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_out('q');&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth(0);&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F m ', ($x0 + $w) * _MPDFK, ($this-&gt;h - ($y0)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $w - $border_right) * _MPDFK, ($this-&gt;h - ($y0 + $border_top)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $w - $border_right) * _MPDFK, ($this-&gt;h - ($y0 + $h - $border_bottom)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('%.3F %.3F l ', ($x0 + $w) * _MPDFK, ($this-&gt;h - ($y0 + $h)) * _MPDFK));&nbsp;</div></li><li><div>                  $this-&gt;_out(' h W n '); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], $divider, $continuingpage, 'R');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif (($brTR_V && $brTR_H) || ($brBR_V && $brBR_H) || $tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s = '';&nbsp;</div></li><li><div>              if ($brBR_V && $brBR_H) {&nbsp;</div></li><li><div>                  $s .= ($this-&gt;_EllipseArc($x0 + $w - $brBR_H, $y0 + $h - $brBR_V, $brBR_H - $border_right / 2, $brBR_V - $border_right / 2, 4, 2, true)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F m ', ($x0 + $w - ($border_right / 2)) * _MPDFK, ($this-&gt;h - ($y0 + $h)) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F m ', ($x0 + $w - ($border_right / 2)) * _MPDFK, ($this-&gt;h - ($y0 + $h - ($border_right / 2))) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($brTR_V && $brTR_H) {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F l ', ($x0 + $w - ($border_right / 2)) * _MPDFK, ($this-&gt;h - ($y0 + ($border_right / 2) + $brTR_V) ) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  $s .= ($this-&gt;_EllipseArc($x0 + $w - $brTR_H, $y0 + $brTR_V, $brTR_H - $border_right / 2, $brTR_V - $border_right / 2, 1, 1)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'solid' || $tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F l ', ($x0 + $w - ($border_right / 2)) * _MPDFK, ($this-&gt;h - ($y0) ) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $s .= (sprintf('%.3F %.3F l ', ($x0 + $w - ($border_right / 2)) * _MPDFK, ($this-&gt;h - ($y0 + ($border_right / 2)) ) * _MPDFK)) . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s .= 'S' . &quot;\n&quot;;&nbsp;</div></li><li><div>              $this-&gt;_out($s);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($tbd['style'] == 'double') {&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth($tbd['w'] / 3);&nbsp;</div></li><li><div>                  $this-&gt;SetDColor($tbcol);&nbsp;</div></li><li><div>                  $this-&gt;_out($s);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!$brset && $tbd['style'] != 'dotted' && $tbd['style'] != 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_out('Q');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineWidth(0.1);&nbsp;</div></li><li><div>              $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetDash();&nbsp;</div></li><li><div>      $this-&gt;y = $save_y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// BACKGROUNDS are disabled in columns/kbt/headers - messes up the repositioning in printcolumnbuffer</span>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive || $this-&gt;kwt || $this-&gt;keep_block_together) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bgx0 = $x0;&nbsp;</div></li><li><div>      $bgx1 = $x1;&nbsp;</div></li><li><div>      $bgy0 = $y0;&nbsp;</div></li><li><div>      $bgy1 = $y1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Defined br values represent the radius of the outer curve - need to take border-width/2 from each radius for drawing the borders</span>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['background_clip']) && $this-&gt;blk[$blvl]['background_clip'] == 'padding-box') {&nbsp;</div></li><li><div>          $brbgTL_H = max(0, $brTL_H - $this-&gt;blk[$blvl]['border_left']['w']);&nbsp;</div></li><li><div>          $brbgTL_V = max(0, $brTL_V - $this-&gt;blk[$blvl]['border_top']['w']);&nbsp;</div></li><li><div>          $brbgTR_H = max(0, $brTR_H - $this-&gt;blk[$blvl]['border_right']['w']);&nbsp;</div></li><li><div>          $brbgTR_V = max(0, $brTR_V - $this-&gt;blk[$blvl]['border_top']['w']);&nbsp;</div></li><li><div>          $brbgBL_H = max(0, $brBL_H - $this-&gt;blk[$blvl]['border_left']['w']);&nbsp;</div></li><li><div>          $brbgBL_V = max(0, $brBL_V - $this-&gt;blk[$blvl]['border_bottom']['w']);&nbsp;</div></li><li><div>          $brbgBR_H = max(0, $brBR_H - $this-&gt;blk[$blvl]['border_right']['w']);&nbsp;</div></li><li><div>          $brbgBR_V = max(0, $brBR_V - $this-&gt;blk[$blvl]['border_bottom']['w']);&nbsp;</div></li><li><div>          $bgx0 += $this-&gt;blk[$blvl]['border_left']['w'];&nbsp;</div></li><li><div>          $bgx1 -= $this-&gt;blk[$blvl]['border_right']['w'];&nbsp;</div></li><li><div>          if ($this-&gt;blk[$blvl]['border_top'] && $divider != 'pagetop' && !$continuingpage) {&nbsp;</div></li><li><div>              $bgy0 += $this-&gt;blk[$blvl]['border_top']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;blk[$blvl]['border_bottom'] && $blockstate != 1 && $divider != 'pagebottom') {&nbsp;</div></li><li><div>              $bgy1 -= $this-&gt;blk[$blvl]['border_bottom']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (isset($this-&gt;blk[$blvl]['background_clip']) && $this-&gt;blk[$blvl]['background_clip'] == 'content-box') {&nbsp;</div></li><li><div>          $brbgTL_H = max(0, $brTL_H - $this-&gt;blk[$blvl]['border_left']['w'] - $this-&gt;blk[$blvl]['padding_left']);&nbsp;</div></li><li><div>          $brbgTL_V = max(0, $brTL_V - $this-&gt;blk[$blvl]['border_top']['w'] - $this-&gt;blk[$blvl]['padding_top']);&nbsp;</div></li><li><div>          $brbgTR_H = max(0, $brTR_H - $this-&gt;blk[$blvl]['border_right']['w'] - $this-&gt;blk[$blvl]['padding_right']);&nbsp;</div></li><li><div>          $brbgTR_V = max(0, $brTR_V - $this-&gt;blk[$blvl]['border_top']['w'] - $this-&gt;blk[$blvl]['padding_top']);&nbsp;</div></li><li><div>          $brbgBL_H = max(0, $brBL_H - $this-&gt;blk[$blvl]['border_left']['w'] - $this-&gt;blk[$blvl]['padding_left']);&nbsp;</div></li><li><div>          $brbgBL_V = max(0, $brBL_V - $this-&gt;blk[$blvl]['border_bottom']['w'] - $this-&gt;blk[$blvl]['padding_bottom']);&nbsp;</div></li><li><div>          $brbgBR_H = max(0, $brBR_H - $this-&gt;blk[$blvl]['border_right']['w'] - $this-&gt;blk[$blvl]['padding_right']);&nbsp;</div></li><li><div>          $brbgBR_V = max(0, $brBR_V - $this-&gt;blk[$blvl]['border_bottom']['w'] - $this-&gt;blk[$blvl]['padding_bottom']);&nbsp;</div></li><li><div>          $bgx0 += $this-&gt;blk[$blvl]['border_left']['w'] + $this-&gt;blk[$blvl]['padding_left'];&nbsp;</div></li><li><div>          $bgx1 -= $this-&gt;blk[$blvl]['border_right']['w'] + $this-&gt;blk[$blvl]['padding_right'];&nbsp;</div></li><li><div>          if (($this-&gt;blk[$blvl]['border_top']['w'] || $this-&gt;blk[$blvl]['padding_top']) && $divider != 'pagetop' && !$continuingpage) {&nbsp;</div></li><li><div>              $bgy0 += $this-&gt;blk[$blvl]['border_top']['w'] + $this-&gt;blk[$blvl]['padding_top'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (($this-&gt;blk[$blvl]['border_bottom']['w'] || $this-&gt;blk[$blvl]['padding_bottom']) && $blockstate != 1 && $divider != 'pagebottom') {&nbsp;</div></li><li><div>              $bgy1 -= $this-&gt;blk[$blvl]['border_bottom']['w'] + $this-&gt;blk[$blvl]['padding_bottom'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $brbgTL_H = $brTL_H;&nbsp;</div></li><li><div>          $brbgTL_V = $brTL_V;&nbsp;</div></li><li><div>          $brbgTR_H = $brTR_H;&nbsp;</div></li><li><div>          $brbgTR_V = $brTR_V;&nbsp;</div></li><li><div>          $brbgBL_H = $brBL_H;&nbsp;</div></li><li><div>          $brbgBL_V = $brBL_V;&nbsp;</div></li><li><div>          $brbgBR_H = $brBR_H;&nbsp;</div></li><li><div>          $brbgBR_V = $brBR_V;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set clipping path</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $s = ' q 0 w '; <span class="comment"><span class="comment">// Line width</span>=0</span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F m ', ($bgx0 + $brbgTL_H ) * _MPDFK, ($this-&gt;h - $bgy0) * _MPDFK); <span class="comment"><span class="comment">// start point TL before the arc</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($brbgTL_H || $brbgTL_V) {&nbsp;</div></li><li><div>          $s .= $this-&gt;_EllipseArc($bgx0 + $brbgTL_H, $bgy0 + $brbgTL_V, $brbgTL_H, $brbgTL_V, 2); <span class="comment">// segment 2 TL</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F l ', ($bgx0) * _MPDFK, ($this-&gt;h - ($bgy1 - $brbgBL_V )) * _MPDFK); <span class="comment"><span class="comment">// line to BL</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($brbgBL_H || $brbgBL_V) {&nbsp;</div></li><li><div>          $s .= $this-&gt;_EllipseArc($bgx0 + $brbgBL_H, $bgy1 - $brbgBL_V, $brbgBL_H, $brbgBL_V, 3); <span class="comment">// segment 3 BL</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F l ', ($bgx1 - $brbgBR_H ) * _MPDFK, ($this-&gt;h - ($bgy1)) * _MPDFK); <span class="comment"><span class="comment">// line to BR</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($brbgBR_H || $brbgBR_V) {&nbsp;</div></li><li><div>          $s .= $this-&gt;_EllipseArc($bgx1 - $brbgBR_H, $bgy1 - $brbgBR_V, $brbgBR_H, $brbgBR_V, 4); <span class="comment">// segment 4 BR</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F l ', ($bgx1) * _MPDFK, ($this-&gt;h - ($bgy0 + $brbgTR_V)) * _MPDFK); <span class="comment"><span class="comment">// line to TR</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($brbgTR_H || $brbgTR_V) {&nbsp;</div></li><li><div>          $s .= $this-&gt;_EllipseArc($bgx1 - $brbgTR_H, $bgy0 + $brbgTR_V, $brbgTR_H, $brbgTR_V, 1); <span class="comment">// segment 1 TR</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $s .= sprintf('%.3F %.3F l ', ($bgx0 + $brbgTL_H ) * _MPDFK, ($this-&gt;h - $bgy0) * _MPDFK); <span class="comment"><span class="comment">// line to TL</span></span>&nbsp;</div></li><li><div>      <span class="comment">// Box Shadow</span>&nbsp;</div></li><li><div>      $shadow = '';&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['box_shadow']) && $this-&gt;blk[$blvl]['box_shadow'] && $h &gt; 0) {&nbsp;</div></li><li><div>          foreach ($this-&gt;blk[$blvl]['box_shadow'] AS $sh) {&nbsp;</div></li><li><div>              <span class="comment">// Colors</span>&nbsp;</div></li><li><div>              if ($sh['col']{0} == 1) {&nbsp;</div></li><li><div>                  $colspace = 'Gray';&nbsp;</div></li><li><div>                  if ($sh['col']{2} == 1) {&nbsp;</div></li><li><div>                      $col1 = '1' . $sh['col'][1] . '1' . $sh['col'][3];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $col1 = '1' . $sh['col'][1] . '1' . chr(100);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $col2 = '1' . $sh['col'][1] . '1' . chr(0);&nbsp;</div></li><li><div>              } elseif ($sh['col']{0} == 4) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $colspace = 'CMYK';&nbsp;</div></li><li><div>                  $col1 = '6' . $sh['col'][1] . $sh['col'][2] . $sh['col'][3] . $sh['col'][4] . chr(100);&nbsp;</div></li><li><div>                  $col2 = '6' . $sh['col'][1] . $sh['col'][2] . $sh['col'][3] . $sh['col'][4] . chr(0);&nbsp;</div></li><li><div>              } elseif ($sh['col']{0} == 5) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                  $colspace = 'RGB';&nbsp;</div></li><li><div>                  $col1 = '5' . $sh['col'][1] . $sh['col'][2] . $sh['col'][3] . $sh['col'][4];&nbsp;</div></li><li><div>                  $col2 = '5' . $sh['col'][1] . $sh['col'][2] . $sh['col'][3] . chr(0);&nbsp;</div></li><li><div>              } elseif ($sh['col']{0} == 6) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                  $colspace = 'CMYK';&nbsp;</div></li><li><div>                  $col1 = '6' . $sh['col'][1] . $sh['col'][2] . $sh['col'][3] . $sh['col'][4] . $sh['col'][5];&nbsp;</div></li><li><div>                  $col2 = '6' . $sh['col'][1] . $sh['col'][2] . $sh['col'][3] . $sh['col'][4] . chr(0);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $colspace = 'RGB';&nbsp;</div></li><li><div>                  $col1 = '5' . $sh['col'][1] . $sh['col'][2] . $sh['col'][3] . chr(100);&nbsp;</div></li><li><div>                  $col2 = '5' . $sh['col'][1] . $sh['col'][2] . $sh['col'][3] . chr(0);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Use clipping path as set above (and rectangle around page) to clip area outside box</span>&nbsp;</div></li><li><div>              $shadow .= $s; <span class="comment">// Use the clipping path with W*</span>&nbsp;</div></li><li><div>              $shadow .= sprintf('0 %.3F m %.3F %.3F l ', $this-&gt;h * _MPDFK, $this-&gt;w * _MPDFK, $this-&gt;h * _MPDFK);&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F 0 l 0 0 l 0 %.3F l ', $this-&gt;w * _MPDFK, $this-&gt;h * _MPDFK);&nbsp;</div></li><li><div>              $shadow .= 'W n' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sh['blur'] = abs($sh['blur']); <span class="comment">// cannot have negative blur value</span>&nbsp;</div></li><li><div>              <span class="comment">// Ensure spread/blur do not make effective shadow width/height &lt; 0</span>&nbsp;</div></li><li><div>              <span class="comment">// Could do more complex things but this just adjusts spread value</span>&nbsp;</div></li><li><div>              if (-$sh['spread'] + $sh['blur'] / 2 &gt; min($w / 2, $h / 2)) {&nbsp;</div></li><li><div>                  $sh['spread'] = $sh['blur'] / 2 - min($w / 2, $h / 2) + 0.01;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Shadow Offset</span></span>&nbsp;</div></li><li><div>              if ($sh['x'] || $sh['y'])&nbsp;</div></li><li><div>                  $shadow .= sprintf(' q 1 0 0 1 %.4F %.4F cm', $sh['x'] * _MPDFK, -$sh['y'] * _MPDFK) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Set path for INNER shadow</span>&nbsp;</div></li><li><div>              $shadow .= ' q 0 w ';&nbsp;</div></li><li><div>              $shadow .= $this-&gt;SetFColor($col1, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>              if ($col1{0} == 5 && ord($col1{4}) &lt; 100) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                  $shadow .= $this-&gt;SetAlpha(ord($col1{4}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>              } elseif ($col1{0} == 6 && ord($col1{5}) &lt; 100) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>                  $shadow .= $this-&gt;SetAlpha(ord($col1{5}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>              } elseif ($col1{0} == 1 && $col1{2} == 1 && ord($col1{3}) &lt; 100) { <span class="comment"><span class="comment">// Gray</span></span>&nbsp;</div></li><li><div>                  $shadow .= $this-&gt;SetAlpha(ord($col1{3}) / 100, 'Normal', true, 'F') . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Blur edges</span>&nbsp;</div></li><li><div>              $mag = 0.551784; <span class="comment">// Bezier Control magic number for 4-part spline for circle/ellipse</span>&nbsp;</div></li><li><div>              $mag2 = 0.551784; <span class="comment">// Bezier Control magic number to fill in edge of blurred rectangle</span>&nbsp;</div></li><li><div>              $d1 = $sh['spread'] + $sh['blur'] / 2;&nbsp;</div></li><li><div>              $d2 = $sh['spread'] - $sh['blur'] / 2;&nbsp;</div></li><li><div>              $bl = $sh['blur'];&nbsp;</div></li><li><div>              $x00 = $x0 - $d1;&nbsp;</div></li><li><div>              $y00 = $y0 - $d1;&nbsp;</div></li><li><div>              $w00 = $w + $d1 * 2;&nbsp;</div></li><li><div>              $h00 = $h + $d1 * 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// If any border-radius is greater width-negative spread(inner edge), ignore radii for shadow or screws up</span>&nbsp;</div></li><li><div>              $flatten = false;&nbsp;</div></li><li><div>              if (max($brbgTR_H, $brbgTL_H, $brbgBR_H, $brbgBL_H) &gt;= $w + $d2) {&nbsp;</div></li><li><div>                  $flatten = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (max($brbgTR_V, $brbgTL_V, $brbgBR_V, $brbgBL_V) &gt;= $h + $d2) {&nbsp;</div></li><li><div>                  $flatten = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// TOP</span> RIGHT corner</span>&nbsp;</div></li><li><div>              $p1x = $x00 + $w00 - $d1 - $brbgTR_H;&nbsp;</div></li><li><div>              $p1c2x = $p1x + ($d2 + $brbgTR_H) * $mag;&nbsp;</div></li><li><div>              $p1y = $y00 + $bl;&nbsp;</div></li><li><div>              $p2x = $x00 + $w00 - $d1 - $brbgTR_H;&nbsp;</div></li><li><div>              $p2c2x = $p2x + ($d1 + $brbgTR_H) * $mag;&nbsp;</div></li><li><div>              $p2y = $y00;&nbsp;</div></li><li><div>              $p2c1y = $p2y + $bl / 2;&nbsp;</div></li><li><div>              $p3x = $x00 + $w00;&nbsp;</div></li><li><div>              $p3c2x = $p3x - $bl / 2;&nbsp;</div></li><li><div>              $p3y = $y00 + $d1 + $brbgTR_V;&nbsp;</div></li><li><div>              $p3c1y = $p3y - ($d1 + $brbgTR_V) * $mag;&nbsp;</div></li><li><div>              $p4x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>              $p4y = $y00 + $d1 + $brbgTR_V;&nbsp;</div></li><li><div>              $p4c2y = $p4y - ($d2 + $brbgTR_V) * $mag;&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgTR_H, $brbgTR_V) || $flatten) {&nbsp;</div></li><li><div>                  $p1x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>                  $p1c2x = $p1x;&nbsp;</div></li><li><div>                  $p2x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>                  $p2c2x = $p2x + $bl * $mag2;&nbsp;</div></li><li><div>                  $p3y = $y00 + $bl;&nbsp;</div></li><li><div>                  $p3c1y = $p3y - $bl * $mag2;&nbsp;</div></li><li><div>                  $p4y = $y00 + $bl;&nbsp;</div></li><li><div>                  $p4c2y = $p4y;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F %.3F m ', ($p1x ) * _MPDFK, ($this-&gt;h - ($p1y )) * _MPDFK);&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($p1c2x) * _MPDFK, ($this-&gt;h - ($p1y)) * _MPDFK, ($p4x) * _MPDFK, ($this-&gt;h - ($p4c2y)) * _MPDFK, ($p4x) * _MPDFK, ($this-&gt;h - ($p4y)) * _MPDFK);&nbsp;</div></li><li><div>              $patch_array[0]['f'] = 0;&nbsp;</div></li><li><div>              $patch_array[0]['points'] = array($p1x, $p1y, $p1x, $p1y, &nbsp;</div></li><li><div>                  $p2x, $p2c1y, $p2x, $p2y, $p2c2x, $p2y, &nbsp;</div></li><li><div>                  $p3x, $p3c1y, $p3x, $p3y, $p3c2x, $p3y, &nbsp;</div></li><li><div>                  $p4x, $p4y, $p4x, $p4y, $p4x, $p4c2y, &nbsp;</div></li><li><div>                  $p1c2x, $p1y);&nbsp;</div></li><li><div>              $patch_array[0]['colors'] = array($col1, $col2, $col2, $col1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// RIGHT</span></span>&nbsp;</div></li><li><div>              $p1x = $x00 + $w00; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p3 preceding</span></span></span></span>&nbsp;</div></li><li><div>              $p1y = $y00 + $d1 + $brbgTR_V;&nbsp;</div></li><li><div>              $p2x = $x00 + $w00 - $bl; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p4 preceding</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $p2y = $y00 + $d1 + $brbgTR_V;&nbsp;</div></li><li><div>              $p3x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>              $p3y = $y00 + $h00 - $d1 - $brbgBR_V;&nbsp;</div></li><li><div>              $p4x = $x00 + $w00;&nbsp;</div></li><li><div>              $p4c1x = $p4x - $bl / 2;&nbsp;</div></li><li><div>              $p4y = $y00 + $h00 - $d1 - $brbgBR_V;&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgTR_H, $brbgTR_V) || $flatten) {&nbsp;</div></li><li><div>                  $p1y = $y00 + $bl;&nbsp;</div></li><li><div>                  $p2y = $y00 + $bl;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgBR_H, $brbgBR_V) || $flatten) {&nbsp;</div></li><li><div>                  $p3y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>                  $p4y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F %.3F l ', ($p3x ) * _MPDFK, ($this-&gt;h - ($p3y )) * _MPDFK);&nbsp;</div></li><li><div>              $patch_array[1]['f'] = 2;&nbsp;</div></li><li><div>              $patch_array[1]['points'] = array($p2x, $p2y, &nbsp;</div></li><li><div>                  $p3x, $p3y, $p3x, $p3y, $p3x, $p3y, &nbsp;</div></li><li><div>                  $p4c1x, $p4y, $p4x, $p4y, $p4x, $p4y, &nbsp;</div></li><li><div>                  $p1x, $p1y);&nbsp;</div></li><li><div>              $patch_array[1]['colors'] = array($col1, $col2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// BOTTOM</span></span> RIGHT corner</span>&nbsp;</div></li><li><div>              $p1x = $x00 + $w00 - $bl;  <span class="comment"><span class="comment"><span class="comment">// control points only matches p3 preceding</span></span></span>&nbsp;</div></li><li><div>              $p1y = $y00 + $h00 - $d1 - $brbgBR_V;&nbsp;</div></li><li><div>              $p1c2y = $p1y + ($d2 + $brbgBR_V) * $mag;&nbsp;</div></li><li><div>              $p2x = $x00 + $w00;     <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p4 preceding</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $p2y = $y00 + $h00 - $d1 - $brbgBR_V;&nbsp;</div></li><li><div>              $p2c2y = $p2y + ($d1 + $brbgBR_V) * $mag;&nbsp;</div></li><li><div>              $p3x = $x00 + $w00 - $d1 - $brbgBR_H;&nbsp;</div></li><li><div>              $p3c1x = $p3x + ($d1 + $brbgBR_H) * $mag;&nbsp;</div></li><li><div>              $p3y = $y00 + $h00;&nbsp;</div></li><li><div>              $p3c2y = $p3y - $bl / 2;&nbsp;</div></li><li><div>              $p4x = $x00 + $w00 - $d1 - $brbgBR_H;&nbsp;</div></li><li><div>              $p4c2x = $p4x + ($d2 + $brbgBR_H) * $mag;&nbsp;</div></li><li><div>              $p4y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgBR_H, $brbgBR_V) || $flatten) {&nbsp;</div></li><li><div>                  $p1y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>                  $p1c2y = $p1y;&nbsp;</div></li><li><div>                  $p2y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>                  $p2c2y = $p2y + $bl * $mag2;&nbsp;</div></li><li><div>                  $p3x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>                  $p3c1x = $p3x + $bl * $mag2;&nbsp;</div></li><li><div>                  $p4x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>                  $p4c2x = $p4x;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($p1x) * _MPDFK, ($this-&gt;h - ($p1c2y)) * _MPDFK, ($p4c2x) * _MPDFK, ($this-&gt;h - ($p4y)) * _MPDFK, ($p4x) * _MPDFK, ($this-&gt;h - ($p4y)) * _MPDFK);&nbsp;</div></li><li><div>              $patch_array[2]['f'] = 2;&nbsp;</div></li><li><div>              $patch_array[2]['points'] = array($p2x, $p2c2y, &nbsp;</div></li><li><div>                  $p3c1x, $p3y, $p3x, $p3y, $p3x, $p3c2y, &nbsp;</div></li><li><div>                  $p4x, $p4y, $p4x, $p4y, $p4c2x, $p4y, &nbsp;</div></li><li><div>                  $p1x, $p1c2y);&nbsp;</div></li><li><div>              $patch_array[2]['colors'] = array($col2, $col1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// BOTTOM</span></span>&nbsp;</div></li><li><div>              $p1x = $x00 + $w00 - $d1 - $brbgBR_H; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p3 preceding</span></span></span></span>&nbsp;</div></li><li><div>              $p1y = $y00 + $h00;&nbsp;</div></li><li><div>              $p2x = $x00 + $w00 - $d1 - $brbgBR_H; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p4 preceding</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $p2y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>              $p3x = $x00 + $d1 + $brbgBL_H;&nbsp;</div></li><li><div>              $p3y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>              $p4x = $x00 + $d1 + $brbgBL_H;&nbsp;</div></li><li><div>              $p4y = $y00 + $h00;&nbsp;</div></li><li><div>              $p4c1y = $p4y - $bl / 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgBR_H, $brbgBR_V) || $flatten) {&nbsp;</div></li><li><div>                  $p1x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>                  $p2x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgBL_H, $brbgBL_V) || $flatten) {&nbsp;</div></li><li><div>                  $p3x = $x00 + $bl;&nbsp;</div></li><li><div>                  $p4x = $x00 + $bl;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F %.3F l ', ($p3x ) * _MPDFK, ($this-&gt;h - ($p3y )) * _MPDFK);&nbsp;</div></li><li><div>              $patch_array[3]['f'] = 2;&nbsp;</div></li><li><div>              $patch_array[3]['points'] = array($p2x, $p2y, &nbsp;</div></li><li><div>                  $p3x, $p3y, $p3x, $p3y, $p3x, $p3y, &nbsp;</div></li><li><div>                  $p4x, $p4c1y, $p4x, $p4y, $p4x, $p4y, &nbsp;</div></li><li><div>                  $p1x, $p1y);&nbsp;</div></li><li><div>              $patch_array[3]['colors'] = array($col1, $col2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// BOTTOM</span></span> LEFT corner&nbsp;</div></li><li><div>              $p1x = $x00 + $d1 + $brbgBL_H;&nbsp;</div></li><li><div>              $p1c2x = $p1x - ($d2 + $brbgBL_H) * $mag; <span class="comment"><span class="comment"><span class="comment">// control points only matches p3 preceding</span></span></span>&nbsp;</div></li><li><div>              $p1y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>              $p2x = $x00 + $d1 + $brbgBL_H;&nbsp;</div></li><li><div>              $p2c2x = $p2x - ($d1 + $brbgBL_H) * $mag; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p4 preceding</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $p2y = $y00 + $h00;&nbsp;</div></li><li><div>              $p3x = $x00;&nbsp;</div></li><li><div>              $p3c2x = $p3x + $bl / 2;&nbsp;</div></li><li><div>              $p3y = $y00 + $h00 - $d1 - $brbgBL_V;&nbsp;</div></li><li><div>              $p3c1y = $p3y + ($d1 + $brbgBL_V) * $mag;&nbsp;</div></li><li><div>              $p4x = $x00 + $bl;&nbsp;</div></li><li><div>              $p4y = $y00 + $h00 - $d1 - $brbgBL_V;&nbsp;</div></li><li><div>              $p4c2y = $p4y + ($d2 + $brbgBL_V) * $mag;&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgBL_H, $brbgBL_V) || $flatten) {&nbsp;</div></li><li><div>                  $p1x = $x00 + $bl;&nbsp;</div></li><li><div>                  $p1c2x = $p1x;&nbsp;</div></li><li><div>                  $p2x = $x00 + $bl;&nbsp;</div></li><li><div>                  $p2c2x = $p2x - $bl * $mag2;&nbsp;</div></li><li><div>                  $p3y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>                  $p3c1y = $p3y + $bl * $mag2;&nbsp;</div></li><li><div>                  $p4y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>                  $p4c2y = $p4y;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($p1c2x) * _MPDFK, ($this-&gt;h - ($p1y)) * _MPDFK, ($p4x) * _MPDFK, ($this-&gt;h - ($p4c2y)) * _MPDFK, ($p4x) * _MPDFK, ($this-&gt;h - ($p4y)) * _MPDFK);&nbsp;</div></li><li><div>              $patch_array[4]['f'] = 2;&nbsp;</div></li><li><div>              $patch_array[4]['points'] = array($p2c2x, $p2y, &nbsp;</div></li><li><div>                  $p3x, $p3c1y, $p3x, $p3y, $p3c2x, $p3y, &nbsp;</div></li><li><div>                  $p4x, $p4y, $p4x, $p4y, $p4x, $p4c2y, &nbsp;</div></li><li><div>                  $p1c2x, $p1y);&nbsp;</div></li><li><div>              $patch_array[4]['colors'] = array($col2, $col1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// LEFT</span> - joins on the right (C3-C4 of previous): f = 2</span>&nbsp;</div></li><li><div>              $p1x = $x00; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p3 preceding</span></span></span></span>&nbsp;</div></li><li><div>              $p1y = $y00 + $h00 - $d1 - $brbgBL_V;&nbsp;</div></li><li><div>              $p2x = $x00 + $bl; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p4 preceding</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $p2y = $y00 + $h00 - $d1 - $brbgBL_V;&nbsp;</div></li><li><div>              $p3x = $x00 + $bl;&nbsp;</div></li><li><div>              $p3y = $y00 + $d1 + $brbgTL_V;&nbsp;</div></li><li><div>              $p4x = $x00;&nbsp;</div></li><li><div>              $p4c1x = $p4x + $bl / 2;&nbsp;</div></li><li><div>              $p4y = $y00 + $d1 + $brbgTL_V;&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgBL_H, $brbgBL_V) || $flatten) {&nbsp;</div></li><li><div>                  $p1y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>                  $p2y = $y00 + $h00 - $bl;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgTL_H, $brbgTL_V) || $flatten) {&nbsp;</div></li><li><div>                  $p3y = $y00 + $bl;&nbsp;</div></li><li><div>                  $p4y = $y00 + $bl;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F %.3F l ', ($p3x ) * _MPDFK, ($this-&gt;h - ($p3y )) * _MPDFK);&nbsp;</div></li><li><div>              $patch_array[5]['f'] = 2;&nbsp;</div></li><li><div>              $patch_array[5]['points'] = array($p2x, $p2y, &nbsp;</div></li><li><div>                  $p3x, $p3y, $p3x, $p3y, $p3x, $p3y, &nbsp;</div></li><li><div>                  $p4c1x, $p4y, $p4x, $p4y, $p4x, $p4y, &nbsp;</div></li><li><div>                  $p1x, $p1y);&nbsp;</div></li><li><div>              $patch_array[5]['colors'] = array($col1, $col2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// TOP</span> LEFT corner</span>&nbsp;</div></li><li><div>              $p1x = $x00 + $bl;  <span class="comment"><span class="comment"><span class="comment">// control points only matches p3 preceding</span></span></span>&nbsp;</div></li><li><div>              $p1y = $y00 + $d1 + $brbgTL_V;&nbsp;</div></li><li><div>              $p1c2y = $p1y - ($d2 + $brbgTL_V) * $mag;&nbsp;</div></li><li><div>              $p2x = $x00;   <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p4 preceding</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $p2y = $y00 + $d1 + $brbgTL_V;&nbsp;</div></li><li><div>              $p2c2y = $p2y - ($d1 + $brbgTL_V) * $mag;&nbsp;</div></li><li><div>              $p3x = $x00 + $d1 + $brbgTL_H;&nbsp;</div></li><li><div>              $p3c1x = $p3x - ($d1 + $brbgTL_H) * $mag;&nbsp;</div></li><li><div>              $p3y = $y00;&nbsp;</div></li><li><div>              $p3c2y = $p3y + $bl / 2;&nbsp;</div></li><li><div>              $p4x = $x00 + $d1 + $brbgTL_H;&nbsp;</div></li><li><div>              $p4c2x = $p4x - ($d2 + $brbgTL_H) * $mag;&nbsp;</div></li><li><div>              $p4y = $y00 + $bl;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgTL_H, $brbgTL_V) || $flatten) {&nbsp;</div></li><li><div>                  $p1y = $y00 + $bl;&nbsp;</div></li><li><div>                  $p1c2y = $p1y;&nbsp;</div></li><li><div>                  $p2y = $y00 + $bl;&nbsp;</div></li><li><div>                  $p2c2y = $p2y - $bl * $mag2;&nbsp;</div></li><li><div>                  $p3x = $x00 + $bl;&nbsp;</div></li><li><div>                  $p3c1x = $p3x - $bl * $mag2;&nbsp;</div></li><li><div>                  $p4x = $x00 + $bl;&nbsp;</div></li><li><div>                  $p4c2x = $p4x;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($p1x) * _MPDFK, ($this-&gt;h - ($p1c2y)) * _MPDFK, ($p4c2x) * _MPDFK, ($this-&gt;h - ($p4y)) * _MPDFK, ($p4x) * _MPDFK, ($this-&gt;h - ($p4y)) * _MPDFK);&nbsp;</div></li><li><div>              $patch_array[6]['f'] = 2;&nbsp;</div></li><li><div>              $patch_array[6]['points'] = array($p2x, $p2c2y, &nbsp;</div></li><li><div>                  $p3c1x, $p3y, $p3x, $p3y, $p3x, $p3c2y, &nbsp;</div></li><li><div>                  $p4x, $p4y, $p4x, $p4y, $p4c2x, $p4y, &nbsp;</div></li><li><div>                  $p1x, $p1c2y);&nbsp;</div></li><li><div>              $patch_array[6]['colors'] = array($col2, $col1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// TOP</span> - joins on the right (C3-C4 of previous): f = 2</span>&nbsp;</div></li><li><div>              $p1x = $x00 + $d1 + $brbgTL_H; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p3 preceding</span></span></span></span>&nbsp;</div></li><li><div>              $p1y = $y00;&nbsp;</div></li><li><div>              $p2x = $x00 + $d1 + $brbgTL_H; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// control point only matches p4 preceding</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $p2y = $y00 + $bl;&nbsp;</div></li><li><div>              $p3x = $x00 + $w00 - $d1 - $brbgTR_H;&nbsp;</div></li><li><div>              $p3y = $y00 + $bl;&nbsp;</div></li><li><div>              $p4x = $x00 + $w00 - $d1 - $brbgTR_H;&nbsp;</div></li><li><div>              $p4y = $y00;&nbsp;</div></li><li><div>              $p4c1y = $p4y + $bl / 2;&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgTL_H, $brbgTL_V) || $flatten) {&nbsp;</div></li><li><div>                  $p1x = $x00 + $bl;&nbsp;</div></li><li><div>                  $p2x = $x00 + $bl;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (-$d2 &gt; min($brbgTR_H, $brbgTR_V) || $flatten) {&nbsp;</div></li><li><div>                  $p3x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>                  $p4x = $x00 + $w00 - $bl;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $shadow .= sprintf('%.3F %.3F l ', ($p3x ) * _MPDFK, ($this-&gt;h - ($p3y )) * _MPDFK);&nbsp;</div></li><li><div>              $patch_array[7]['f'] = 2;&nbsp;</div></li><li><div>              $patch_array[7]['points'] = array($p2x, $p2y, &nbsp;</div></li><li><div>                  $p3x, $p3y, $p3x, $p3y, $p3x, $p3y, &nbsp;</div></li><li><div>                  $p4x, $p4c1y, $p4x, $p4y, $p4x, $p4y, &nbsp;</div></li><li><div>                  $p1x, $p1y);&nbsp;</div></li><li><div>              $patch_array[7]['colors'] = array($col1, $col2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $shadow .= ' h f Q ' . &quot;\n&quot;; <span class="comment">// Close path and Fill the inner solid shadow</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($bl)&nbsp;</div></li><li><div>                  $shadow .= $this-&gt;grad-&gt;CoonsPatchMesh($x00, $y00, $w00, $h00, $patch_array, $x00, $x00 + $w00, $y00, $y00 + $h00, $colspace, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($sh['x'] || $sh['y'])&nbsp;</div></li><li><div>                  $shadow .= ' Q' . &quot;\n&quot;;  <span class="comment"><span class="comment">// Shadow Offset</span></span>&nbsp;</div></li><li><div>              $shadow .= ' Q' . &quot;\n&quot;; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s .= ' W n '; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Ends path no-op & Sets the clipping path</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;blk[$blvl]['bgcolor']) {&nbsp;</div></li><li><div>          $this-&gt;pageBackgrounds[$blvl][] = array('x' =&gt; $x0, 'y' =&gt; $y0, 'w' =&gt; $w, 'h' =&gt; $h, 'col' =&gt; $this-&gt;blk[$blvl]['bgcolorarray'], 'clippath' =&gt; $s, 'visibility' =&gt; $this-&gt;visibility, 'shadow' =&gt; $shadow, 'z-index' =&gt; $this-&gt;current_layer);&nbsp;</div></li><li><div>      } elseif ($shadow) {&nbsp;</div></li><li><div>          $this-&gt;pageBackgrounds[$blvl][] = array('shadowonly' =&gt; true, 'col' =&gt; '', 'clippath' =&gt; '', 'visibility' =&gt; $this-&gt;visibility, 'shadow' =&gt; $shadow, 'z-index' =&gt; $this-&gt;current_layer);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['gradient'])) {&nbsp;</div></li><li><div>          $g = $this-&gt;grad-&gt;parseBackgroundGradient($this-&gt;blk[$blvl]['gradient']);&nbsp;</div></li><li><div>          if ($g) {&nbsp;</div></li><li><div>              $gx = $x0;&nbsp;</div></li><li><div>              $gy = $y0;&nbsp;</div></li><li><div>              $this-&gt;pageBackgrounds[$blvl][] = array('gradient' =&gt; true, 'x' =&gt; $gx, 'y' =&gt; $gy, 'w' =&gt; $w, 'h' =&gt; $h, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; $s, 'visibility' =&gt; $this-&gt;visibility, 'z-index' =&gt; $this-&gt;current_layer);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$blvl]['background-image'])) {&nbsp;</div></li><li><div>          if (isset($this-&gt;blk[$blvl]['background-image']['gradient']) && $this-&gt;blk[$blvl]['background-image']['gradient'] && preg_match('/(-moz-)*(repeating-)*(linear|radial)-gradient/', $this-&gt;blk[$blvl]['background-image']['gradient'])) {&nbsp;</div></li><li><div>              $g = $this-&gt;grad-&gt;parseMozGradient($this-&gt;blk[$blvl]['background-image']['gradient']);&nbsp;</div></li><li><div>              if ($g) {&nbsp;</div></li><li><div>                  $gx = $x0;&nbsp;</div></li><li><div>                  $gy = $y0;&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// origin specifies the background-positioning-area (bpa)</span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;blk[$blvl]['background-image']['origin'] == 'padding-box') {&nbsp;</div></li><li><div>                      $gx += $this-&gt;blk[$blvl]['border_left']['w'];&nbsp;</div></li><li><div>                      $w -= ($this-&gt;blk[$blvl]['border_left']['w'] + $this-&gt;blk[$blvl]['border_right']['w']);&nbsp;</div></li><li><div>                      if ($this-&gt;blk[$blvl]['border_top'] && $divider != 'pagetop' && !$continuingpage) {&nbsp;</div></li><li><div>                          $gy += $this-&gt;blk[$blvl]['border_top']['w'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($this-&gt;blk[$blvl]['border_bottom'] && $blockstate != 1 && $divider != 'pagebottom') {&nbsp;</div></li><li><div>                          $gy1 = $y1 - $this-&gt;blk[$blvl]['border_bottom']['w'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $gy1 = $y1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $h = $gy1 - $gy;&nbsp;</div></li><li><div>                  } elseif ($this-&gt;blk[$blvl]['background-image']['origin'] == 'content-box') {&nbsp;</div></li><li><div>                      $gx += $this-&gt;blk[$blvl]['border_left']['w'] + $this-&gt;blk[$blvl]['padding_left'];&nbsp;</div></li><li><div>                      $w -= ($this-&gt;blk[$blvl]['border_left']['w'] + $this-&gt;blk[$blvl]['padding_left'] + $this-&gt;blk[$blvl]['border_right']['w'] + $this-&gt;blk[$blvl]['padding_right']);&nbsp;</div></li><li><div>                      if ($this-&gt;blk[$blvl]['border_top'] && $divider != 'pagetop' && !$continuingpage) {&nbsp;</div></li><li><div>                          $gy += $this-&gt;blk[$blvl]['border_top']['w'] + $this-&gt;blk[$blvl]['padding_top'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($this-&gt;blk[$blvl]['border_bottom'] && $blockstate != 1 && $divider != 'pagebottom') {&nbsp;</div></li><li><div>                          $gy1 = $y1 - ($this-&gt;blk[$blvl]['border_bottom']['w'] + $this-&gt;blk[$blvl]['padding_bottom']);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $gy1 = $y1 - $this-&gt;blk[$blvl]['padding_bottom'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $h = $gy1 - $gy;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($this-&gt;blk[$blvl]['background-image']['size']['w']) && $this-&gt;blk[$blvl]['background-image']['size']['w']) {&nbsp;</div></li><li><div>                      $size = $this-&gt;blk[$blvl]['background-image']['size'];&nbsp;</div></li><li><div>                      if ($size['w'] != 'contain' && $size['w'] != 'cover') {&nbsp;</div></li><li><div>                          if (stristr($size['w'], '%')) {&nbsp;</div></li><li><div>                              $size['w'] += 0;&nbsp;</div></li><li><div>                              $size['w'] /= 100;&nbsp;</div></li><li><div>                              $w *= $size['w'];&nbsp;</div></li><li><div>                          } elseif ($size['w'] != 'auto') {&nbsp;</div></li><li><div>                              $w = $size['w'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if (stristr($size['h'], '%')) {&nbsp;</div></li><li><div>                              $size['h'] += 0;&nbsp;</div></li><li><div>                              $size['h'] /= 100;&nbsp;</div></li><li><div>                              $h *= $size['h'];&nbsp;</div></li><li><div>                          } elseif ($size['h'] != 'auto') {&nbsp;</div></li><li><div>                              $h = $size['h'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;pageBackgrounds[$blvl][] = array('gradient' =&gt; true, 'x' =&gt; $gx, 'y' =&gt; $gy, 'w' =&gt; $w, 'h' =&gt; $h, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; $s, 'visibility' =&gt; $this-&gt;visibility, 'z-index' =&gt; $this-&gt;current_layer);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $image_id = $this-&gt;blk[$blvl]['background-image']['image_id'];&nbsp;</div></li><li><div>              $orig_w = $this-&gt;blk[$blvl]['background-image']['orig_w'];&nbsp;</div></li><li><div>              $orig_h = $this-&gt;blk[$blvl]['background-image']['orig_h'];&nbsp;</div></li><li><div>              $x_pos = $this-&gt;blk[$blvl]['background-image']['x_pos'];&nbsp;</div></li><li><div>              $y_pos = $this-&gt;blk[$blvl]['background-image']['y_pos'];&nbsp;</div></li><li><div>              $x_repeat = $this-&gt;blk[$blvl]['background-image']['x_repeat'];&nbsp;</div></li><li><div>              $y_repeat = $this-&gt;blk[$blvl]['background-image']['y_repeat'];&nbsp;</div></li><li><div>              $resize = $this-&gt;blk[$blvl]['background-image']['resize'];&nbsp;</div></li><li><div>              $opacity = $this-&gt;blk[$blvl]['background-image']['opacity'];&nbsp;</div></li><li><div>              $itype = $this-&gt;blk[$blvl]['background-image']['itype'];&nbsp;</div></li><li><div>              $size = $this-&gt;blk[$blvl]['background-image']['size'];&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// origin specifies the background-positioning-area (bpa)</span></span>&nbsp;</div></li><li><div>              $bpa = array('x' =&gt; $x0, 'y' =&gt; $y0, 'w' =&gt; $w, 'h' =&gt; $h);&nbsp;</div></li><li><div>              if ($this-&gt;blk[$blvl]['background-image']['origin'] == 'padding-box') {&nbsp;</div></li><li><div>                  $bpa['x'] = $x0 + $this-&gt;blk[$blvl]['border_left']['w'];&nbsp;</div></li><li><div>                  $bpa['w'] = $w - ($this-&gt;blk[$blvl]['border_left']['w'] + $this-&gt;blk[$blvl]['border_right']['w']);&nbsp;</div></li><li><div>                  if ($this-&gt;blk[$blvl]['border_top'] && $divider != 'pagetop' && !$continuingpage) {&nbsp;</div></li><li><div>                      $bpa['y'] = $y0 + $this-&gt;blk[$blvl]['border_top']['w'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $bpa['y'] = $y0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;blk[$blvl]['border_bottom'] && $blockstate != 1 && $divider != 'pagebottom') {&nbsp;</div></li><li><div>                      $bpay = $y1 - $this-&gt;blk[$blvl]['border_bottom']['w'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $bpay = $y1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $bpa['h'] = $bpay - $bpa['y'];&nbsp;</div></li><li><div>              } elseif ($this-&gt;blk[$blvl]['background-image']['origin'] == 'content-box') {&nbsp;</div></li><li><div>                  $bpa['x'] = $x0 + $this-&gt;blk[$blvl]['border_left']['w'] + $this-&gt;blk[$blvl]['padding_left'];&nbsp;</div></li><li><div>                  $bpa['w'] = $w - ($this-&gt;blk[$blvl]['border_left']['w'] + $this-&gt;blk[$blvl]['padding_left'] + $this-&gt;blk[$blvl]['border_right']['w'] + $this-&gt;blk[$blvl]['padding_right']);&nbsp;</div></li><li><div>                  if ($this-&gt;blk[$blvl]['border_top'] && $divider != 'pagetop' && !$continuingpage) {&nbsp;</div></li><li><div>                      $bpa['y'] = $y0 + $this-&gt;blk[$blvl]['border_top']['w'] + $this-&gt;blk[$blvl]['padding_top'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $bpa['y'] = $y0 + $this-&gt;blk[$blvl]['padding_top'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;blk[$blvl]['border_bottom'] && $blockstate != 1 && $divider != 'pagebottom') {&nbsp;</div></li><li><div>                      $bpay = $y1 - ($this-&gt;blk[$blvl]['border_bottom']['w'] + $this-&gt;blk[$blvl]['padding_bottom']);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $bpay = $y1 - $this-&gt;blk[$blvl]['padding_bottom'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $bpa['h'] = $bpay - $bpa['y'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;pageBackgrounds[$blvl][] = array('x' =&gt; $x0, 'y' =&gt; $y0, 'w' =&gt; $w, 'h' =&gt; $h, 'image_id' =&gt; $image_id, 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $x_pos, 'y_pos' =&gt; $y_pos, 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'clippath' =&gt; $s, 'resize' =&gt; $resize, 'opacity' =&gt; $opacity, 'itype' =&gt; $itype, 'visibility' =&gt; $this-&gt;visibility, 'z-index' =&gt; $this-&gt;current_layer, 'size' =&gt; $size, 'bpa' =&gt; $bpa);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Float DIV</span></span>&nbsp;</div></li><li><div>      $this-&gt;blk[$blvl]['bb_painted'][$this-&gt;page] = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _EllipseArc($x0, $y0, $rx, $ry, $seg = 1, $part = false, $start = false)&nbsp;</div></li><li><div>  { <span class="comment">// Anticlockwise segment 1-4 TR-TL-BL-BR (part=1 or 2)</span>&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>      if ($rx &lt; 0) {&nbsp;</div></li><li><div>          $rx = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($ry &lt; 0) {&nbsp;</div></li><li><div>          $ry = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $rx *= _MPDFK;&nbsp;</div></li><li><div>      $ry *= _MPDFK;&nbsp;</div></li><li><div>      $astart = 0;&nbsp;</div></li><li><div>      if ($seg == 1) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span> Right&nbsp;</div></li><li><div>          $afinish = 90;&nbsp;</div></li><li><div>          $nSeg = 4;&nbsp;</div></li><li><div>      } elseif ($seg == 2) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span> Left&nbsp;</div></li><li><div>          $afinish = 180;&nbsp;</div></li><li><div>          $nSeg = 8;&nbsp;</div></li><li><div>      } elseif ($seg == 3) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span> Left&nbsp;</div></li><li><div>          $afinish = 270;&nbsp;</div></li><li><div>          $nSeg = 12;&nbsp;</div></li><li><div>      } else {   <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span> Right&nbsp;</div></li><li><div>          $afinish = 360;&nbsp;</div></li><li><div>          $nSeg = 16;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $astart = deg2rad((float) $astart);&nbsp;</div></li><li><div>      $afinish = deg2rad((float) $afinish);&nbsp;</div></li><li><div>      $totalAngle = $afinish - $astart;&nbsp;</div></li><li><div>      $dt = $totalAngle / $nSeg; <span class="comment">// segment angle</span>&nbsp;</div></li><li><div>      $dtm = $dt / 3;&nbsp;</div></li><li><div>      $x0 *= _MPDFK;&nbsp;</div></li><li><div>      $y0 = ($this-&gt;h - $y0) * _MPDFK;&nbsp;</div></li><li><div>      $t1 = $astart;&nbsp;</div></li><li><div>      $a0 = $x0 + ($rx * cos($t1));&nbsp;</div></li><li><div>      $b0 = $y0 + ($ry * sin($t1));&nbsp;</div></li><li><div>      $c0 = -$rx * sin($t1);&nbsp;</div></li><li><div>      $d0 = $ry * cos($t1);&nbsp;</div></li><li><div>      $op = false;&nbsp;</div></li><li><div>      for ($i = 1; $i &lt;= $nSeg; $i++) {&nbsp;</div></li><li><div>          <span class="comment">// Draw this bit of the total curve</span>&nbsp;</div></li><li><div>          $t1 = ($i * $dt) + $astart;&nbsp;</div></li><li><div>          $a1 = $x0 + ($rx * cos($t1));&nbsp;</div></li><li><div>          $b1 = $y0 + ($ry * sin($t1));&nbsp;</div></li><li><div>          $c1 = -$rx * sin($t1);&nbsp;</div></li><li><div>          $d1 = $ry * cos($t1);&nbsp;</div></li><li><div>          if ($i &gt; ($nSeg - 4) && (!$part || ($part == 1 && $i &lt;= $nSeg - 2) || ($part == 2 && $i &gt; $nSeg - 2))) {&nbsp;</div></li><li><div>              if ($start && !$op) {&nbsp;</div></li><li><div>                  $s .= sprintf('%.3F %.3F m ', $a0, $b0);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $s .= sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c ', ($a0 + ($c0 * $dtm)), ($b0 + ($d0 * $dtm)), ($a1 - ($c1 * $dtm)), ($b1 - ($d1 * $dtm)), $a1, $b1);&nbsp;</div></li><li><div>              $op = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $a0 = $a1;&nbsp;</div></li><li><div>          $b0 = $b1;&nbsp;</div></li><li><div>          $c0 = $c1;&nbsp;</div></li><li><div>          $d0 = $d1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function PaintDivLnBorder($state = 0, $blvl = 0, $h)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $state = 0 normal; 1 top; 2 bottom; 3 top and bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;ColDetails[$this-&gt;CurrCol]['bottom_margin'] = $this-&gt;y + $h;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $save_y = $this-&gt;y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $w = $this-&gt;blk[$blvl]['width'];&nbsp;</div></li><li><div>      $x0 = $this-&gt;x;    <span class="comment"><span class="comment">// left</span></span>&nbsp;</div></li><li><div>      $y0 = $this-&gt;y;    <span class="comment">// top</span>&nbsp;</div></li><li><div>      $x1 = $this-&gt;x + $w;   <span class="comment"><span class="comment"><span class="comment">// bottom</span></span></span>&nbsp;</div></li><li><div>      $y1 = $this-&gt;y + $h;   <span class="comment"><span class="comment"><span class="comment">// bottom</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;blk[$blvl]['border_top'] && ($state == 1 || $state == 3)) {&nbsp;</div></li><li><div>          $tbd = $this-&gt;blk[$blvl]['border_top'];&nbsp;</div></li><li><div>          if (isset($tbd['s']) && $tbd['s']) {&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd);&nbsp;</div></li><li><div>              $this-&gt;y = $y0 + ($tbd['w'] / 2);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], '', $continuingpage, 'T');&nbsp;</div></li><li><div>                  $this-&gt;Line($x0 + ($tbd['w'] / 2), $this-&gt;y, $x0 + $w - ($tbd['w'] / 2), $this-&gt;y);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>                  $this-&gt;Line($x0, $this-&gt;y, $x0 + $w, $this-&gt;y);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;y += $tbd['w'];&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;blk[$blvl]['border_left']) {&nbsp;</div></li><li><div>          $tbd = $this-&gt;blk[$blvl]['border_left'];&nbsp;</div></li><li><div>          if (isset($tbd['s']) && $tbd['s']) {&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;y = $y0 + ($tbd['w'] / 2);&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], '', $continuingpage, 'L');&nbsp;</div></li><li><div>                  $this-&gt;Line($x0 + ($tbd['w'] / 2), $this-&gt;y, $x0 + ($tbd['w'] / 2), $y0 + $h - ($tbd['w'] / 2));&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;y = $y0;&nbsp;</div></li><li><div>                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>                  $this-&gt;Line($x0 + ($tbd['w'] / 2), $this-&gt;y, $x0 + ($tbd['w'] / 2), $y0 + $h);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;y += $tbd['w'];&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;blk[$blvl]['border_right']) {&nbsp;</div></li><li><div>          $tbd = $this-&gt;blk[$blvl]['border_right'];&nbsp;</div></li><li><div>          if (isset($tbd['s']) && $tbd['s']) {&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;y = $y0 + ($tbd['w'] / 2);&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], '', $continuingpage, 'R');&nbsp;</div></li><li><div>                  $this-&gt;Line($x0 + $w - ($tbd['w'] / 2), $this-&gt;y, $x0 + $w - ($tbd['w'] / 2), $y0 + $h - ($tbd['w'] / 2));&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;y = $y0;&nbsp;</div></li><li><div>                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>                  $this-&gt;Line($x0 + $w - ($tbd['w'] / 2), $this-&gt;y, $x0 + $w - ($tbd['w'] / 2), $y0 + $h);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;y += $tbd['w'];&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;blk[$blvl]['border_bottom'] && $state &gt; 1) {&nbsp;</div></li><li><div>          $tbd = $this-&gt;blk[$blvl]['border_bottom'];&nbsp;</div></li><li><div>          if (isset($tbd['s']) && $tbd['s']) {&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd);&nbsp;</div></li><li><div>              $this-&gt;y = $y0 + $h - ($tbd['w'] / 2);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], '', $continuingpage, 'B');&nbsp;</div></li><li><div>                  $this-&gt;Line($x0 + ($tbd['w'] / 2), $this-&gt;y, $x0 + $w - ($tbd['w'] / 2), $this-&gt;y);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>                  $this-&gt;Line($x0, $this-&gt;y, $x0 + $w, $this-&gt;y);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;y += $tbd['w'];&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetDash();&nbsp;</div></li><li><div>      $this-&gt;y = $save_y;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function PaintImgBorder($objattr, $is_table)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Borders are disabled in columns - messes up the repositioning in printcolumnbuffer</span>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($is_table) {&nbsp;</div></li><li><div>          $k = $this-&gt;shrin_k;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $k = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $h = (isset($objattr['BORDER-HEIGHT']) ? $objattr['BORDER-HEIGHT'] : 0);&nbsp;</div></li><li><div>      $w = (isset($objattr['BORDER-WIDTH']) ? $objattr['BORDER-WIDTH'] : 0);&nbsp;</div></li><li><div>      $x0 = (isset($objattr['BORDER-X']) ? $objattr['BORDER-X'] : 0);&nbsp;</div></li><li><div>      $y0 = (isset($objattr['BORDER-Y']) ? $objattr['BORDER-Y'] : 0);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// BORDERS</span></span></span></span>&nbsp;</div></li><li><div>      if ($objattr['border_top']) {&nbsp;</div></li><li><div>          $tbd = $objattr['border_top'];&nbsp;</div></li><li><div>          if (!empty($tbd['s'])) {&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd, $k);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], '', '', 'T');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;Line($x0, $y0, $x0 + $w, $y0);&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($objattr['border_left']) {&nbsp;</div></li><li><div>          $tbd = $objattr['border_left'];&nbsp;</div></li><li><div>          if (!empty($tbd['s'])) {&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd, $k);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], '', '', 'L');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;Line($x0, $y0, $x0, $y0 + $h);&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($objattr['border_right']) {&nbsp;</div></li><li><div>          $tbd = $objattr['border_right'];&nbsp;</div></li><li><div>          if (!empty($tbd['s'])) {&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd, $k);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], '', '', 'R');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;Line($x0 + $w, $y0, $x0 + $w, $y0 + $h);&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($objattr['border_bottom']) {&nbsp;</div></li><li><div>          $tbd = $objattr['border_bottom'];&nbsp;</div></li><li><div>          if (!empty($tbd['s'])) {&nbsp;</div></li><li><div>              $this-&gt;_setBorderLine($tbd, $k);&nbsp;</div></li><li><div>              if ($tbd['style'] == 'dotted' || $tbd['style'] == 'dashed') {&nbsp;</div></li><li><div>                  $this-&gt;_setDashBorder($tbd['style'], '', '', 'B');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;Line($x0, $y0 + $h, $x0 + $w, $y0 + $h);&nbsp;</div></li><li><div>              <span class="comment">// Reset</span> Corners and Dash off&nbsp;</div></li><li><div>              $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>              $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              $this-&gt;SetDash();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetDash();&nbsp;</div></li><li><div>      $this-&gt;SetAlpha(1);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Reset()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>      $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>      $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>      $this-&gt;SetAlpha(1);&nbsp;</div></li><li><div>      $this-&gt;colorarray = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;spanbgcolorarray = '';&nbsp;</div></li><li><div>      $this-&gt;spanbgcolor = false;&nbsp;</div></li><li><div>      $this-&gt;spanborder = false;&nbsp;</div></li><li><div>      $this-&gt;spanborddet = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;ResetStyles();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;HREF = '';&nbsp;</div></li><li><div>      $this-&gt;textparam = array();&nbsp;</div></li><li><div>      $this-&gt;SetTextOutline();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;textvar = 0x00; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;OTLtags = array();&nbsp;</div></li><li><div>      $this-&gt;textshadow = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;currentLang = $this-&gt;default_lang;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;RestrictUnicodeFonts($this-&gt;default_available_fonts); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;SetFont($this-&gt;default_font, '', 0, false);&nbsp;</div></li><li><div>      $this-&gt;SetFontSize($this-&gt;default_font_size, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;currentfontfamily = '';&nbsp;</div></li><li><div>      $this-&gt;currentfontsize = '';&nbsp;</div></li><li><div>      $this-&gt;currentfontstyle = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;tableLevel && isset($this-&gt;table[1][1]['cellLineHeight'])) {&nbsp;</div></li><li><div>          $this-&gt;SetLineHeight('', $this-&gt;table[1][1]['cellLineHeight']); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($this-&gt;blk[$this-&gt;blklvl]['line_height']) && $this-&gt;blk[$this-&gt;blklvl]['line_height']) {&nbsp;</div></li><li><div>          $this-&gt;SetLineHeight('', $this-&gt;blk[$this-&gt;blklvl]['line_height']); <span class="comment"><span class="comment">// sets default line height</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;lSpacingCSS = '';&nbsp;</div></li><li><div>      $this-&gt;wSpacingCSS = '';&nbsp;</div></li><li><div>      $this-&gt;fixedlSpacing = false;&nbsp;</div></li><li><div>      $this-&gt;minwSpacing = 0;&nbsp;</div></li><li><div>      $this-&gt;SetDash(); <span class="comment">//restore to no dash</span>&nbsp;</div></li><li><div>      $this-&gt;dash_on = false;&nbsp;</div></li><li><div>      $this-&gt;dotted_on = false;&nbsp;</div></li><li><div>      $this-&gt;divwidth = 0;&nbsp;</div></li><li><div>      $this-&gt;divheight = 0;&nbsp;</div></li><li><div>      $this-&gt;cellTextAlign = '';&nbsp;</div></li><li><div>      $this-&gt;cellLineHeight = '';&nbsp;</div></li><li><div>      $this-&gt;cellLineStackingStrategy = '';&nbsp;</div></li><li><div>      $this-&gt;cellLineStackingShift = '';&nbsp;</div></li><li><div>      $this-&gt;oldy = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bodystyle = array();&nbsp;</div></li><li><div>      if (isset($this-&gt;cssmgr-&gt;CSS['BODY']['FONT-STYLE'])) {&nbsp;</div></li><li><div>          $bodystyle['FONT-STYLE'] = $this-&gt;cssmgr-&gt;CSS['BODY']['FONT-STYLE'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;cssmgr-&gt;CSS['BODY']['FONT-WEIGHT'])) {&nbsp;</div></li><li><div>          $bodystyle['FONT-WEIGHT'] = $this-&gt;cssmgr-&gt;CSS['BODY']['FONT-WEIGHT'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($this-&gt;cssmgr-&gt;CSS['BODY']['COLOR'])) {&nbsp;</div></li><li><div>          $bodystyle['COLOR'] = $this-&gt;cssmgr-&gt;CSS['BODY']['COLOR'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($bodystyle)) {&nbsp;</div></li><li><div>          $this-&gt;setCSS($bodystyle, 'BLOCK', 'BODY');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function ReadMetaTags($html)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// changes anykey=anyvalue to anykey=&quot;anyvalue&quot; (only do this when this happens inside tags)</span>&nbsp;</div></li><li><div>      $regexp = '/ (\\w+?)=([^\\s&gt;&quot;]+)/si';&nbsp;</div></li><li><div>      $html = preg_replace($regexp, &quot; \$1=\&quot;\$2\&quot;&quot;, $html);&nbsp;</div></li><li><div>      if (preg_match('/&lt;title&gt;(.*?)&lt;\/title&gt;/si', $html, $m)) {&nbsp;</div></li><li><div>          $this-&gt;SetTitle($m[1]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      preg_match_all('/&lt;meta [^&gt;]*?(name|content)=&quot;([^&gt;]*?)&quot; [^&gt;]*?(name|content)=&quot;([^&gt;]*?)&quot;.*?&gt;/si', $html, $aux);&nbsp;</div></li><li><div>      $firstattr = $aux[1];&nbsp;</div></li><li><div>      $secondattr = $aux[3];&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; count($aux[0]); $i++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $name = ( strtoupper($firstattr[$i]) == &quot;NAME&quot; ) ? strtoupper($aux[2][$i]) : strtoupper($aux[4][$i]);&nbsp;</div></li><li><div>          $content = ( strtoupper($firstattr[$i]) == &quot;CONTENT&quot; ) ? $aux[2][$i] : $aux[4][$i];&nbsp;</div></li><li><div>          switch ($name) {&nbsp;</div></li><li><div>              case &quot;KEYWORDS&quot;: $this-&gt;SetKeywords($content);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case &quot;AUTHOR&quot;: $this-&gt;SetAuthor($content);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case &quot;DESCRIPTION&quot;: $this-&gt;SetSubject($content);&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function ReadCharset($html)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Charset conversion</span>&nbsp;</div></li><li><div>      if ($this-&gt;allow_charset_conversion) {&nbsp;</div></li><li><div>          if (preg_match('/&lt;head.*charset=([^\'\&quot;\s]*).*&lt;\/head&gt;/si', $html, $m)) {&nbsp;</div></li><li><div>              if (strtoupper($m[1]) != 'UTF-8') {&nbsp;</div></li><li><div>                  $this-&gt;charset_in = strtoupper($m[1]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function setCSS($arrayaux, $type = '', $tag = '')&nbsp;</div></li><li><div>  { <span class="comment">// type= INLINE | BLOCK | TABLECELL // tag= BODY</span>&nbsp;</div></li><li><div>      if (!is_array($arrayaux))&nbsp;</div></li><li><div>          return; <span class="comment">//Removes PHP Warning</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>      $preceeding_fontkey = $this-&gt;FontFamily . $this-&gt;FontStyle;&nbsp;</div></li><li><div>      $preceeding_fontsize = $this-&gt;FontSize;&nbsp;</div></li><li><div>      $spanbordset = false;&nbsp;</div></li><li><div>      $spanbgset = false;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $prevlevel = (($this-&gt;blklvl == 0) ? 0 : $this-&gt;blklvl - 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Set font size first so that e.g. MARGIN 0.83em works on font size for this element</span>&nbsp;</div></li><li><div>      if (isset($arrayaux['FONT-SIZE'])) {&nbsp;</div></li><li><div>          $v = $arrayaux['FONT-SIZE'];&nbsp;</div></li><li><div>          if (is_numeric($v[0])) {&nbsp;</div></li><li><div>              if ($type == 'BLOCK' && $this-&gt;blklvl &gt; 0 && isset($this-&gt;blk[$this-&gt;blklvl - 1]['InlineProperties']) && isset($this-&gt;blk[$this-&gt;blklvl - 1]['InlineProperties']['size'])) {&nbsp;</div></li><li><div>                  $mmsize = $this-&gt;ConvertSize($v, $this-&gt;blk[$this-&gt;blklvl - 1]['InlineProperties']['size']);&nbsp;</div></li><li><div>              } elseif ($type == 'TABLECELL') {&nbsp;</div></li><li><div>                  $mmsize = $this-&gt;ConvertSize($v, $this-&gt;default_font_size / _MPDFK);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $mmsize = $this-&gt;ConvertSize($v, $this-&gt;FontSize);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;SetFontSize($mmsize * (_MPDFK), false); <span class="comment">//Get size in points (pt)</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $v = strtoupper($v);&nbsp;</div></li><li><div>              if (isset($this-&gt;fontsizes[$v])) {&nbsp;</div></li><li><div>                  $this-&gt;SetFontSize($this-&gt;fontsizes[$v] * $this-&gt;default_font_size, false);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($tag == 'BODY') {&nbsp;</div></li><li><div>              $this-&gt;SetDefaultFontSize($this-&gt;FontSizePt);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($arrayaux['LANG']) && $arrayaux['LANG']) {&nbsp;</div></li><li><div>          if ($this-&gt;autoLangToFont && !$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>              if ($arrayaux['LANG'] != $this-&gt;default_lang && $arrayaux['LANG'] != 'UTF-8') {&nbsp;</div></li><li><div>                  list ($coreSuitable, $mpdf_pdf_unifont) = GetLangOpts($arrayaux['LANG'], $this-&gt;useAdobeCJK, $this-&gt;fontdata);&nbsp;</div></li><li><div>                  if ($mpdf_pdf_unifont) {&nbsp;</div></li><li><div>                      $arrayaux['FONT-FAMILY'] = $mpdf_pdf_unifont;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($tag == 'BODY') {&nbsp;</div></li><li><div>                      $this-&gt;default_lang = $arrayaux['LANG'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;currentLang = $arrayaux['LANG'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// FOR INLINE and BLOCK</span> OR 'BODY'</span>&nbsp;</div></li><li><div>      if (isset($arrayaux['FONT-FAMILY'])) {&nbsp;</div></li><li><div>          $v = $arrayaux['FONT-FAMILY'];&nbsp;</div></li><li><div>          <span class="comment">//If it is a font list, get all font types</span>&nbsp;</div></li><li><div>          $aux_fontlist = explode(&quot;, &quot;, $v);&nbsp;</div></li><li><div>          $found = 0;&nbsp;</div></li><li><div>          foreach ($aux_fontlist AS $f) {&nbsp;</div></li><li><div>              $fonttype = trim($f);&nbsp;</div></li><li><div>              $fonttype = preg_replace('/[&quot;\']*(.*?)[&quot;\']*/', '\\1', $fonttype);&nbsp;</div></li><li><div>              $fonttype = preg_replace('/ /', '', $fonttype);&nbsp;</div></li><li><div>              $v = strtolower(trim($fonttype));&nbsp;</div></li><li><div>              if (isset($this-&gt;fonttrans[$v]) && $this-&gt;fonttrans[$v]) {&nbsp;</div></li><li><div>                  $v = $this-&gt;fonttrans[$v];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ((!$this-&gt;onlyCoreFonts && in_array($v, $this-&gt;available_unifonts)) ||&nbsp;</div></li><li><div>                  in_array($v, array('ccourier', 'ctimes', 'chelvetica')) ||&nbsp;</div></li><li><div>                  ($this-&gt;onlyCoreFonts && in_array($v, array('courier', 'times', 'helvetica', 'arial'))) ||&nbsp;</div></li><li><div>                  in_array($v, array('sjis', 'uhc', 'big5', 'gb'))) {&nbsp;</div></li><li><div>                  $fonttype = $v;&nbsp;</div></li><li><div>                  $found = 1;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$found) {&nbsp;</div></li><li><div>              foreach ($aux_fontlist AS $f) {&nbsp;</div></li><li><div>                  $fonttype = trim($f);&nbsp;</div></li><li><div>                  $fonttype = preg_replace('/[&quot;\']*(.*?)[&quot;\']*/', '\\1', $fonttype);&nbsp;</div></li><li><div>                  $fonttype = preg_replace('/ /', '', $fonttype);&nbsp;</div></li><li><div>                  $v = strtolower(trim($fonttype));&nbsp;</div></li><li><div>                  if (isset($this-&gt;fonttrans[$v]) && $this-&gt;fonttrans[$v]) {&nbsp;</div></li><li><div>                      $v = $this-&gt;fonttrans[$v];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (in_array($v, $this-&gt;sans_fonts) || in_array($v, $this-&gt;serif_fonts) || in_array($v, $this-&gt;mono_fonts)) {&nbsp;</div></li><li><div>                      $fonttype = $v;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($tag == 'BODY') {&nbsp;</div></li><li><div>              $this-&gt;SetDefaultFont($fonttype);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;SetFont($fonttype, $this-&gt;currentfontstyle, 0, false);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetFont($this-&gt;currentfontfamily, $this-&gt;currentfontstyle, 0, false);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($arrayaux as $k =&gt; $v) {&nbsp;</div></li><li><div>          if ($type != 'INLINE' && $tag != 'BODY' && $type != 'TABLECELL') {&nbsp;</div></li><li><div>              switch ($k) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// BORDERS</span></span></span></span>&nbsp;</div></li><li><div>                  case 'BORDER-TOP':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_top'] = $this-&gt;border_details($v);&nbsp;</div></li><li><div>                      if ($this-&gt;blk[$this-&gt;blklvl]['border_top']['s']) {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['border'] = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-BOTTOM':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_bottom'] = $this-&gt;border_details($v);&nbsp;</div></li><li><div>                      if ($this-&gt;blk[$this-&gt;blklvl]['border_bottom']['s']) {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['border'] = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-LEFT':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_left'] = $this-&gt;border_details($v);&nbsp;</div></li><li><div>                      if ($this-&gt;blk[$this-&gt;blklvl]['border_left']['s']) {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['border'] = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-RIGHT':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_right'] = $this-&gt;border_details($v);&nbsp;</div></li><li><div>                      if ($this-&gt;blk[$this-&gt;blklvl]['border_right']['s']) {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['border'] = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// PADDING</span>&nbsp;</div></li><li><div>                  case 'PADDING-TOP':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['padding_top'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'PADDING-BOTTOM':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'PADDING-LEFT':&nbsp;</div></li><li><div>                      if (($tag == 'UL' || $tag == 'OL') && $v == 'auto') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['padding_left'] = 'auto';&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['padding_left'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'PADDING-RIGHT':&nbsp;</div></li><li><div>                      if (($tag == 'UL' || $tag == 'OL') && $v == 'auto') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['padding_right'] = 'auto';&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['padding_right'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// MARGINS</span>&nbsp;</div></li><li><div>                  case 'MARGIN-TOP':&nbsp;</div></li><li><div>                      $tmp = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      if (isset($this-&gt;blk[$this-&gt;blklvl]['lastbottommargin'])) {&nbsp;</div></li><li><div>                          if ($tmp &gt; $this-&gt;blk[$this-&gt;blklvl]['lastbottommargin']) {&nbsp;</div></li><li><div>                              $tmp -= $this-&gt;blk[$this-&gt;blklvl]['lastbottommargin'];&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $tmp = 0;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['margin_top'] = $tmp;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'MARGIN-BOTTOM':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['margin_bottom'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'MARGIN-LEFT':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['margin_left'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'MARGIN-RIGHT':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['margin_right'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  case 'BORDER-TOP-LEFT-RADIUS-H':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_radius_TL_H'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-TOP-LEFT-RADIUS-V':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_radius_TL_V'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-TOP-RIGHT-RADIUS-H':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_radius_TR_H'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-TOP-RIGHT-RADIUS-V':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_radius_TR_V'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-BOTTOM-LEFT-RADIUS-H':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_radius_BL_H'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-BOTTOM-LEFT-RADIUS-V':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_radius_BL_V'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-BOTTOM-RIGHT-RADIUS-H':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_radius_BR_H'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-BOTTOM-RIGHT-RADIUS-V':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['border_radius_BR_V'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BORDER-RADIUS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'BOX-SHADOW':&nbsp;</div></li><li><div>                      $bs = $this-&gt;cssmgr-&gt;setCSSboxshadow($v);&nbsp;</div></li><li><div>                      if ($bs) {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['box_shadow'] = $bs;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'BACKGROUND-CLIP':&nbsp;</div></li><li><div>                      if (strtoupper($v) == 'PADDING-BOX') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['background_clip'] = 'padding-box';&nbsp;</div></li><li><div>                      } elseif (strtoupper($v) == 'CONTENT-BOX') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['background_clip'] = 'content-box';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'PAGE-BREAK-AFTER':&nbsp;</div></li><li><div>                      if (strtoupper($v) == 'AVOID') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['page_break_after_avoid'] = true;&nbsp;</div></li><li><div>                      } elseif (strtoupper($v) == 'ALWAYS' || strtoupper($v) == 'LEFT' || strtoupper($v) == 'RIGHT') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['page_break_after'] = strtoupper($v);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> pagebreaktype&nbsp;</div></li><li><div>                  case 'BOX-DECORATION-BREAK':&nbsp;</div></li><li><div>                      if (strtoupper($v) == 'CLONE') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['box_decoration_break'] = 'clone';&nbsp;</div></li><li><div>                      } elseif (strtoupper($v) == 'SLICE') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['box_decoration_break'] = 'slice';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'WIDTH':&nbsp;</div></li><li><div>                      if (strtoupper($v) != 'AUTO') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['css_set_width'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Lists&nbsp;</div></li><li><div>                  <span class="comment">// LISTS</span>&nbsp;</div></li><li><div>                  case 'LIST-STYLE-TYPE':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['list_style_type'] = strtolower($v);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'LIST-STYLE-IMAGE':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['list_style_image'] = strtolower($v);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'LIST-STYLE-POSITION':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['list_style_position'] = strtolower($v);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//end of switch($k)</span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($type != 'INLINE' && $type != 'TABLECELL') { <span class="comment">// All block-level, including BODY tag</span>&nbsp;</div></li><li><div>              switch ($k) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'TEXT-INDENT':&nbsp;</div></li><li><div>                      <span class="comment">// Computed value - to inherit</span>&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['text_indent'] = $this-&gt;ConvertSize($v, $this-&gt;blk[$prevlevel]['inner_width'], $this-&gt;FontSize, false) . 'mm';&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'MARGIN-COLLAPSE': <span class="comment">// Custom tag to collapse margins at top and bottom of page</span>&nbsp;</div></li><li><div>                      if (strtoupper($v) == 'COLLAPSE') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['margin_collapse'] = true;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'LINE-HEIGHT':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['line_height'] = $this-&gt;fixLineheight($v);&nbsp;</div></li><li><div>                      if (!$this-&gt;blk[$this-&gt;blklvl]['line_height']) {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['line_height'] = 'N';&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  case 'LINE-STACKING-STRATEGY':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['line_stacking_strategy'] = strtolower($v);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'LINE-STACKING-SHIFT':&nbsp;</div></li><li><div>                      $this-&gt;blk[$this-&gt;blklvl]['line_stacking_shift'] = strtolower($v);&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'TEXT-ALIGN': <span class="comment"><span class="comment">//left right center justify</span></span>&nbsp;</div></li><li><div>                      switch (strtoupper($v)) {&nbsp;</div></li><li><div>                          case 'LEFT':&nbsp;</div></li><li><div>                              $this-&gt;blk[$this-&gt;blklvl]['align'] = &quot;L&quot;;&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                          case 'CENTER':&nbsp;</div></li><li><div>                              $this-&gt;blk[$this-&gt;blklvl]['align'] = &quot;C&quot;;&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                          case 'RIGHT':&nbsp;</div></li><li><div>                              $this-&gt;blk[$this-&gt;blklvl]['align'] = &quot;R&quot;;&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                          case 'JUSTIFY':&nbsp;</div></li><li><div>                              $this-&gt;blk[$this-&gt;blklvl]['align'] = &quot;J&quot;;&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  case 'BACKGROUND-GRADIENT':&nbsp;</div></li><li><div>                      if ($type == 'BLOCK') {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['gradient'] = $v;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'DIRECTION':&nbsp;</div></li><li><div>                      if ($v) {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['direction'] = strtolower($v);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//end of switch($k)</span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// FOR INLINE ONLY</span></span>&nbsp;</div></li><li><div>          if ($type == 'INLINE') {&nbsp;</div></li><li><div>              switch ($k) {&nbsp;</div></li><li><div>                  case 'DISPLAY':&nbsp;</div></li><li><div>                      if (strtoupper($v) == 'NONE') {&nbsp;</div></li><li><div>                          $this-&gt;inlineDisplayOff = true;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'DIRECTION':&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//end of switch($k)</span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// FOR INLINE ONLY</span></span>&nbsp;</div></li><li><div>          if ($type == 'INLINE') {&nbsp;</div></li><li><div>              switch ($k) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// BORDERS</span></span></span></span>&nbsp;</div></li><li><div>                  case 'BORDER-TOP':&nbsp;</div></li><li><div>                      $this-&gt;spanborddet['T'] = $this-&gt;border_details($v);&nbsp;</div></li><li><div>                      $this-&gt;spanborder = true;&nbsp;</div></li><li><div>                      $spanbordset = true;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-BOTTOM':&nbsp;</div></li><li><div>                      $this-&gt;spanborddet['B'] = $this-&gt;border_details($v);&nbsp;</div></li><li><div>                      $this-&gt;spanborder = true;&nbsp;</div></li><li><div>                      $spanbordset = true;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-LEFT':&nbsp;</div></li><li><div>                      $this-&gt;spanborddet['L'] = $this-&gt;border_details($v);&nbsp;</div></li><li><div>                      $this-&gt;spanborder = true;&nbsp;</div></li><li><div>                      $spanbordset = true;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'BORDER-RIGHT':&nbsp;</div></li><li><div>                      $this-&gt;spanborddet['R'] = $this-&gt;border_details($v);&nbsp;</div></li><li><div>                      $this-&gt;spanborder = true;&nbsp;</div></li><li><div>                      $spanbordset = true;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'VISIBILITY': <span class="comment">// block is set in OpenTag</span>&nbsp;</div></li><li><div>                      $v = strtolower($v);&nbsp;</div></li><li><div>                      if ($v == 'visible' || $v == 'hidden' || $v == 'printonly' || $v == 'screenonly') {&nbsp;</div></li><li><div>                          $this-&gt;textparam['visibility'] = $v;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//end of switch($k)</span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($type != 'TABLECELL') {&nbsp;</div></li><li><div>              <span class="comment">// FOR INLINE and BLOCK</span>&nbsp;</div></li><li><div>              switch ($k) {&nbsp;</div></li><li><div>                  case 'TEXT-ALIGN': <span class="comment"><span class="comment">//left right center justify</span></span>&nbsp;</div></li><li><div>                      if (strtoupper($v) == 'NOJUSTIFY' && $this-&gt;blk[$this-&gt;blklvl]['align'] == &quot;J&quot;) {&nbsp;</div></li><li><div>                          $this-&gt;blk[$this-&gt;blklvl]['align'] = &quot;&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  <span class="comment">// bgcolor only - to stay consistent with original html2fpdf</span>&nbsp;</div></li><li><div>                  case 'BACKGROUND':&nbsp;</div></li><li><div>                  case 'BACKGROUND-COLOR':&nbsp;</div></li><li><div>                      $cor = $this-&gt;ConvertColor($v);&nbsp;</div></li><li><div>                      if ($cor) {&nbsp;</div></li><li><div>                          if ($tag == 'BODY') {&nbsp;</div></li><li><div>                              $this-&gt;bodyBackgroundColor = $cor;&nbsp;</div></li><li><div>                          } elseif ($type == 'INLINE') {&nbsp;</div></li><li><div>                              $this-&gt;spanbgcolorarray = $cor;&nbsp;</div></li><li><div>                              $this-&gt;spanbgcolor = true;&nbsp;</div></li><li><div>                              $spanbgset = true;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;blk[$this-&gt;blklvl]['bgcolorarray'] = $cor;&nbsp;</div></li><li><div>                              $this-&gt;blk[$this-&gt;blklvl]['bgcolor'] = true;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif ($type != 'INLINE') {&nbsp;</div></li><li><div>                          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                              $this-&gt;blk[$this-&gt;blklvl]['bgcolorarray'] = $this-&gt;blk[$prevlevel]['bgcolorarray'];&nbsp;</div></li><li><div>                              $this-&gt;blk[$this-&gt;blklvl]['bgcolor'] = $this-&gt;blk[$prevlevel]['bgcolor'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'VERTICAL-ALIGN': <span class="comment">//super and sub only dealt with here e.g. &lt;SUB&gt; and &lt;SUP&gt;</span>&nbsp;</div></li><li><div>                      switch (strtoupper($v)) {&nbsp;</div></li><li><div>                          case 'SUPER':&nbsp;</div></li><li><div>                              $this-&gt;textvar = ($this-&gt;textvar | FA_SUPERSCRIPT); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                              $this-&gt;textvar = ($this-&gt;textvar & ~FA_SUBSCRIPT);&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>                              if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>                                  $this-&gt;textparam['text-baseline'] += ($this-&gt;baselineSup) * $preceeding_fontsize;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;textparam['text-baseline'] = ($this-&gt;baselineSup) * $preceeding_fontsize;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                          case 'SUB':&nbsp;</div></li><li><div>                              $this-&gt;textvar = ($this-&gt;textvar | FA_SUBSCRIPT);&nbsp;</div></li><li><div>                              $this-&gt;textvar = ($this-&gt;textvar & ~FA_SUPERSCRIPT);&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>                              if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>                                  $this-&gt;textparam['text-baseline'] += ($this-&gt;baselineSub) * $preceeding_fontsize;&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;textparam['text-baseline'] = ($this-&gt;baselineSub) * $preceeding_fontsize;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                          case 'BASELINE':&nbsp;</div></li><li><div>                              $this-&gt;textvar = ($this-&gt;textvar & ~FA_SUBSCRIPT);&nbsp;</div></li><li><div>                              $this-&gt;textvar = ($this-&gt;textvar & ~FA_SUPERSCRIPT);&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>                              if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>                                  unset($this-&gt;textparam['text-baseline']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>                          default:&nbsp;</div></li><li><div>                              $lh = $this-&gt;_computeLineheight($this-&gt;blk[$this-&gt;blklvl]['line_height']);&nbsp;</div></li><li><div>                              $sz = $this-&gt;ConvertSize($v, $lh, $this-&gt;FontSize, false);&nbsp;</div></li><li><div>                              $this-&gt;textvar = ($this-&gt;textvar & ~FA_SUBSCRIPT);&nbsp;</div></li><li><div>                              $this-&gt;textvar = ($this-&gt;textvar & ~FA_SUPERSCRIPT);&nbsp;</div></li><li><div>                              if ($sz) {&nbsp;</div></li><li><div>                                  if ($sz &gt; 0) {&nbsp;</div></li><li><div>                                      $this-&gt;textvar = ($this-&gt;textvar | FA_SUPERSCRIPT);&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $this-&gt;textvar = ($this-&gt;textvar | FA_SUBSCRIPT);&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>                                      $this-&gt;textparam['text-baseline'] += $sz;&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $this-&gt;textparam['text-baseline'] = $sz;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//end of switch($k)</span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// FOR ALL</span>&nbsp;</div></li><li><div>          switch ($k) {&nbsp;</div></li><li><div>              case 'LETTER-SPACING':&nbsp;</div></li><li><div>                  $this-&gt;lSpacingCSS = $v;&nbsp;</div></li><li><div>                  if (($this-&gt;lSpacingCSS || $this-&gt;lSpacingCSS === '0') && strtoupper($this-&gt;lSpacingCSS) != 'NORMAL') {&nbsp;</div></li><li><div>                      $this-&gt;fixedlSpacing = $this-&gt;ConvertSize($this-&gt;lSpacingCSS, $this-&gt;FontSize);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'WORD-SPACING':&nbsp;</div></li><li><div>                  $this-&gt;wSpacingCSS = $v;&nbsp;</div></li><li><div>                  if ($this-&gt;wSpacingCSS && strtoupper($this-&gt;wSpacingCSS) != 'NORMAL') {&nbsp;</div></li><li><div>                      $this-&gt;minwSpacing = $this-&gt;ConvertSize($this-&gt;wSpacingCSS, $this-&gt;FontSize);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'FONT-STYLE': <span class="comment">// italic normal oblique</span>&nbsp;</div></li><li><div>                  switch (strtoupper($v)) {&nbsp;</div></li><li><div>                      case 'ITALIC':&nbsp;</div></li><li><div>                      case 'OBLIQUE':&nbsp;</div></li><li><div>                          $this-&gt;SetStyle('I', true);&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'NORMAL':&nbsp;</div></li><li><div>                          $this-&gt;SetStyle('I', false);&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'FONT-WEIGHT': <span class="comment">// normal bold //Does not support: bolder, lighter, 100..900(step value=100)</span>&nbsp;</div></li><li><div>                  switch (strtoupper($v)) {&nbsp;</div></li><li><div>                      case 'BOLD':&nbsp;</div></li><li><div>                          $this-&gt;SetStyle('B', true);&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'NORMAL':&nbsp;</div></li><li><div>                          $this-&gt;SetStyle('B', false);&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'FONT-KERNING':&nbsp;</div></li><li><div>                  if (strtoupper($v) == 'NORMAL' || (strtoupper($v) == 'AUTO' && $this-&gt;useKerning)) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if ($this-&gt;CurrentFont['haskernGPOS']) {&nbsp;</div></li><li><div>                          if (isset($this-&gt;OTLtags['Plus'])) {&nbsp;</div></li><li><div>                              $this-&gt;OTLtags['Plus'] .= ' kern';&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;OTLtags['Plus'] = ' kern';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> else {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar | FC_KERNING);&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  } elseif (strtoupper($v) == 'NONE' || (strtoupper($v) == 'AUTO' && !$this-&gt;useKerning)) {&nbsp;</div></li><li><div>                      if (isset($this-&gt;OTLtags['Plus']))&nbsp;</div></li><li><div>                          $this-&gt;OTLtags['Plus'] = str_replace('kern', '', $this-&gt;OTLtags['Plus']); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($this-&gt;OTLtags['FFPlus']))&nbsp;</div></li><li><div>                          $this-&gt;OTLtags['FFPlus'] = preg_replace('/kern[\d]*/', '', $this-&gt;OTLtags['FFPlus']);&nbsp;</div></li><li><div>                      $this-&gt;textvar = ($this-&gt;textvar & ~FC_KERNING);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              case 'FONT-LANGUAGE-OVERRIDE':&nbsp;</div></li><li><div>                  $v = strtoupper($v);&nbsp;</div></li><li><div>                  if (strpos($v, 'NORMAL') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;fontLanguageOverride = '';&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;fontLanguageOverride = trim($v);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'FONT-VARIANT-POSITION':&nbsp;</div></li><li><div>                  if (isset($this-&gt;OTLtags['Plus']))&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace(array('sups', 'subs'), '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  switch (strtoupper($v)) {&nbsp;</div></li><li><div>                      case 'SUPER':&nbsp;</div></li><li><div>                          $this-&gt;OTLtags['Plus'] .= ' sups';&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'SUB':&nbsp;</div></li><li><div>                          $this-&gt;OTLtags['Plus'] .= ' subs';&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'NORMAL':&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'FONT-VARIANT-CAPS':&nbsp;</div></li><li><div>                  $v = strtoupper($v);&nbsp;</div></li><li><div>                  if (!isset($this-&gt;OTLtags['Plus'])) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;OTLtags['Plus'] = str_replace(array('c2sc', 'smcp', 'c2pc', 'pcap', 'unic', 'titl'), '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  $this-&gt;textvar = ($this-&gt;textvar & ~FC_SMALLCAPS);   <span class="comment"><span class="comment">// ???</span></span>??????????? &lt;small-caps&gt;&nbsp;</div></li><li><div>                  if (strpos($v, 'ALL-SMALL-CAPS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' c2sc smcp';&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'SMALL-CAPS') !== false) {&nbsp;</div></li><li><div>                      if (isset($this-&gt;CurrentFont['hassmallcapsGSUB']) && $this-&gt;CurrentFont['hassmallcapsGSUB']) {&nbsp;</div></li><li><div>                          $this-&gt;OTLtags['Plus'] .= ' smcp';&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar | FC_SMALLCAPS);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'ALL-PETITE-CAPS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' c2pc pcap';&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'PETITE-CAPS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' pcap';&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'UNICASE') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' unic';&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'TITLING-CAPS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' titl';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'FONT-VARIANT-LIGATURES':&nbsp;</div></li><li><div>                  $v = strtoupper($v);&nbsp;</div></li><li><div>                  if (!isset($this-&gt;OTLtags['Plus'])) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!isset($this-&gt;OTLtags['Minus'])) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Minus'] = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'NORMAL') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Minus'] = str_replace(array('liga', 'clig', 'calt'), '', $this-&gt;OTLtags['Minus']);&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace(array('dlig', 'hlig'), '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'NONE') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Minus'] .= ' liga clig calt';&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace(array('dlig', 'hlig'), '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'NO-COMMON-LIGATURES') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Minus'] .= ' liga clig';&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'COMMON-LIGATURES') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Minus'] = str_replace(array('liga', 'clig'), '', $this-&gt;OTLtags['Minus']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'NO-CONTEXTUAL') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Minus'] .= ' calt';&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'CONTEXTUAL') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Minus'] = str_replace('calt', '', $this-&gt;OTLtags['Minus']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'NO-DISCRETIONARY-LIGATURES') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace('dlig', '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'DISCRETIONARY-LIGATURES') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' dlig';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'NO-HISTORICAL-LIGATURES') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace('hlig', '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'HISTORICAL-LIGATURES') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' hlig';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'FONT-VARIANT-NUMERIC':&nbsp;</div></li><li><div>                  $v = strtoupper($v);&nbsp;</div></li><li><div>                  if (!isset($this-&gt;OTLtags['Plus'])) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'NORMAL') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace(array('ordn', 'zero', 'lnum', 'onum', 'pnum', 'tnum', 'frac', 'afrc'), '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'ORDINAL') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' ordn';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'SLASHED-ZERO') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' zero';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'LINING-NUMS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' lnum';&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace('onum', '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'OLDSTYLE-NUMS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' onum';&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace('lnum', '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'PROPORTIONAL-NUMS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' pnum';&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace('tnum', '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'TABULAR-NUMS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' tnum';&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace('pnum', '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'DIAGONAL-FRACTIONS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' frac';&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace('afrc', '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  } elseif (strpos($v, 'STACKED-FRACTIONS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' afrc';&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace('frac', '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'FONT-VARIANT-ALTERNATES':  <span class="comment">// Only supports historical-forms</span>&nbsp;</div></li><li><div>                  $v = strtoupper($v);&nbsp;</div></li><li><div>                  if (!isset($this-&gt;OTLtags['Plus'])) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'NORMAL') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] = str_replace('hist', '', $this-&gt;OTLtags['Plus']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (strpos($v, 'HISTORICAL-FORMS') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['Plus'] .= ' hist';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'FONT-FEATURE-SETTINGS':&nbsp;</div></li><li><div>                  $v = strtolower($v);&nbsp;</div></li><li><div>                  if (strpos($v, 'normal') !== false) {&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['FFMinus'] = '';&nbsp;</div></li><li><div>                      $this-&gt;OTLtags['FFPlus'] = '';&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if (!isset($this-&gt;OTLtags['FFPlus'])) {&nbsp;</div></li><li><div>                          $this-&gt;OTLtags['FFPlus'] = '';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (!isset($this-&gt;OTLtags['FFMinus'])) {&nbsp;</div></li><li><div>                          $this-&gt;OTLtags['FFMinus'] = '';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $tags = preg_split('/[, ]/', $v);&nbsp;</div></li><li><div>                      foreach ($tags AS $t) {&nbsp;</div></li><li><div>                          if (preg_match('/[\&quot;\']([a-zA-Z0-9]{4})[\&quot;\']\s*(on|off|\d*) {0, 1}/', $t, $m)) {&nbsp;</div></li><li><div>                              if ($m[2] == 'off' || $m[2] === '0') {&nbsp;</div></li><li><div>                                  if (strpos($this-&gt;OTLtags['FFMinus'], $m[1]) === false) {&nbsp;</div></li><li><div>                                      $this-&gt;OTLtags['FFMinus'] .= ' ' . $m[1];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;OTLtags['FFPlus'] = preg_replace('/' . $m[1] . '[\d]*/', '', $this-&gt;OTLtags['FFPlus']);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  if ($m[2] == 'on') {&nbsp;</div></li><li><div>                                      $m[2] = '1';&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if (strpos($this-&gt;OTLtags['FFPlus'], $m[1]) === false) {&nbsp;</div></li><li><div>                                      $this-&gt;OTLtags['FFPlus'] .= ' ' . $m[1] . $m[2];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;OTLtags['FFMinus'] = str_replace($m[1], '', $this-&gt;OTLtags['FFMinus']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'TEXT-TRANSFORM': <span class="comment">// none uppercase lowercase //Does support: capitalize</span>&nbsp;</div></li><li><div>                  switch (strtoupper($v)) { <span class="comment">//Not working 100%</span>&nbsp;</div></li><li><div>                      case 'CAPITALIZE':&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar | FT_CAPITALIZE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar & ~FT_UPPERCASE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar & ~FT_LOWERCASE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'UPPERCASE':&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar | FT_UPPERCASE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar & ~FT_LOWERCASE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar & ~FT_CAPITALIZE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'LOWERCASE':&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar | FT_LOWERCASE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar & ~FT_UPPERCASE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar & ~FT_CAPITALIZE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'NONE': break;&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar & ~FT_UPPERCASE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar & ~FT_LOWERCASE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;textvar = ($this-&gt;textvar & ~FT_CAPITALIZE); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'TEXT-SHADOW':&nbsp;</div></li><li><div>                  $ts = $this-&gt;cssmgr-&gt;setCSStextshadow($v);&nbsp;</div></li><li><div>                  if ($ts) {&nbsp;</div></li><li><div>                      $this-&gt;textshadow = $ts;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'HYPHENS':&nbsp;</div></li><li><div>                  if (strtoupper($v) == 'NONE') {&nbsp;</div></li><li><div>                      $this-&gt;textparam['hyphens'] = 2;&nbsp;</div></li><li><div>                  } elseif (strtoupper($v) == 'AUTO') {&nbsp;</div></li><li><div>                      $this-&gt;textparam['hyphens'] = 1;&nbsp;</div></li><li><div>                  } elseif (strtoupper($v) == 'MANUAL') {&nbsp;</div></li><li><div>                      $this-&gt;textparam['hyphens'] = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'TEXT-OUTLINE':&nbsp;</div></li><li><div>                  if (strtoupper($v) == 'NONE') {&nbsp;</div></li><li><div>                      $this-&gt;textparam['outline-s'] = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'TEXT-OUTLINE-WIDTH':&nbsp;</div></li><li><div>              case 'OUTLINE-WIDTH':&nbsp;</div></li><li><div>                  switch (strtoupper($v)) {&nbsp;</div></li><li><div>                      case 'THIN': $v = '0.03em';&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'MEDIUM': $v = '0.05em';&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'THICK': $v = '0.07em';&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $w = $this-&gt;ConvertSize($v, $this-&gt;FontSize, $this-&gt;FontSize);&nbsp;</div></li><li><div>                  if ($w) {&nbsp;</div></li><li><div>                      $this-&gt;textparam['outline-WIDTH'] = $w;&nbsp;</div></li><li><div>                      $this-&gt;textparam['outline-s'] = true;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;textparam['outline-s'] = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'TEXT-OUTLINE-COLOR':&nbsp;</div></li><li><div>              case 'OUTLINE-COLOR':&nbsp;</div></li><li><div>                  if (strtoupper($v) == 'INVERT') {&nbsp;</div></li><li><div>                      if ($this-&gt;colorarray) {&nbsp;</div></li><li><div>                          $cor = $this-&gt;colorarray;&nbsp;</div></li><li><div>                          $this-&gt;textparam['outline-COLOR'] = $this-&gt;_invertColor($cor);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;textparam['outline-COLOR'] = $this-&gt;ConvertColor(255);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $cor = $this-&gt;ConvertColor($v);&nbsp;</div></li><li><div>                      if ($cor) {&nbsp;</div></li><li><div>                          $this-&gt;textparam['outline-COLOR'] = $cor;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'COLOR': <span class="comment">// font color</span>&nbsp;</div></li><li><div>                  $cor = $this-&gt;ConvertColor($v);&nbsp;</div></li><li><div>                  if ($cor) {&nbsp;</div></li><li><div>                      $this-&gt;colorarray = $cor;&nbsp;</div></li><li><div>                      $this-&gt;SetTColor($cor);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//end of switch($k)</span></span></span></span></span></span>&nbsp;</div></li><li><div>      }<span class="comment">//end of foreach</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>      <span class="comment">// Needs to be set at the end - after vertical-align = super/sub, so that textparam['text-baseline'] is set</span>&nbsp;</div></li><li><div>      if (isset($arrayaux['TEXT-DECORATION'])) {&nbsp;</div></li><li><div>          $v = $arrayaux['TEXT-DECORATION']; <span class="comment">// none underline line-through (strikeout) //Does not support: blink</span>&nbsp;</div></li><li><div>          if (stristr($v, 'LINE-THROUGH')) {&nbsp;</div></li><li><div>              $this-&gt;textvar = ($this-&gt;textvar | FD_LINETHROUGH);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>                  $this-&gt;textparam['s-decoration']['baseline'] = $this-&gt;textparam['text-baseline'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;textparam['s-decoration']['baseline'] = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;textparam['s-decoration']['fontkey'] = $this-&gt;FontFamily . $this-&gt;FontStyle;&nbsp;</div></li><li><div>              $this-&gt;textparam['s-decoration']['fontsize'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>              $this-&gt;textparam['s-decoration']['color'] = strtoupper($this-&gt;TextColor); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// change 0 0 0 rg to 0 0 0 RG</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (stristr($v, 'UNDERLINE')) {&nbsp;</div></li><li><div>              $this-&gt;textvar = ($this-&gt;textvar | FD_UNDERLINE);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>                  $this-&gt;textparam['u-decoration']['baseline'] = $this-&gt;textparam['text-baseline'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;textparam['u-decoration']['baseline'] = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;textparam['u-decoration']['fontkey'] = $this-&gt;FontFamily . $this-&gt;FontStyle;&nbsp;</div></li><li><div>              $this-&gt;textparam['u-decoration']['fontsize'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>              $this-&gt;textparam['u-decoration']['color'] = strtoupper($this-&gt;TextColor); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// change 0 0 0 rg to 0 0 0 RG</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (stristr($v, 'OVERLINE')) {&nbsp;</div></li><li><div>              $this-&gt;textvar = ($this-&gt;textvar | FD_OVERLINE);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>                  $this-&gt;textparam['o-decoration']['baseline'] = $this-&gt;textparam['text-baseline'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;textparam['o-decoration']['baseline'] = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;textparam['o-decoration']['fontkey'] = $this-&gt;FontFamily . $this-&gt;FontStyle;&nbsp;</div></li><li><div>              $this-&gt;textparam['o-decoration']['fontsize'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>              $this-&gt;textparam['o-decoration']['color'] = strtoupper($this-&gt;TextColor); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// change 0 0 0 rg to 0 0 0 RG</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (stristr($v, 'NONE')) {&nbsp;</div></li><li><div>              $this-&gt;textvar = ($this-&gt;textvar & ~FD_UNDERLINE);&nbsp;</div></li><li><div>              $this-&gt;textvar = ($this-&gt;textvar & ~FD_LINETHROUGH);&nbsp;</div></li><li><div>              $this-&gt;textvar = ($this-&gt;textvar & ~FD_OVERLINE);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  inline text-decoration parameters</span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;textparam['u-decoration'])) {&nbsp;</div></li><li><div>                  unset($this-&gt;textparam['u-decoration']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($this-&gt;textparam['s-decoration'])) {&nbsp;</div></li><li><div>                  unset($this-&gt;textparam['s-decoration']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($this-&gt;textparam['o-decoration'])) {&nbsp;</div></li><li><div>                  unset($this-&gt;textparam['o-decoration']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($spanbordset) { <span class="comment">// BORDER has been set on this INLINE element</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>              $this-&gt;textparam['bord-decoration']['baseline'] = $this-&gt;textparam['text-baseline'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;textparam['bord-decoration']['baseline'] = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;textparam['bord-decoration']['fontkey'] = $this-&gt;FontFamily . $this-&gt;FontStyle;&nbsp;</div></li><li><div>          $this-&gt;textparam['bord-decoration']['fontsize'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($spanbgset) { <span class="comment">// BACKGROUND[-COLOR] has been set on this INLINE element</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;textparam['text-baseline'])) {&nbsp;</div></li><li><div>              $this-&gt;textparam['bg-decoration']['baseline'] = $this-&gt;textparam['text-baseline'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;textparam['bg-decoration']['baseline'] = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;textparam['bg-decoration']['fontkey'] = $this-&gt;FontFamily . $this-&gt;FontStyle;&nbsp;</div></li><li><div>          $this-&gt;textparam['bg-decoration']['fontsize'] = $this-&gt;FontSize;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END HTML-CSS -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetStyle($tag, $enable)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;$tag = $enable;&nbsp;</div></li><li><div>      $style = '';&nbsp;</div></li><li><div>      foreach (array('B', 'I') as $s) {&nbsp;</div></li><li><div>          if ($this-&gt;$s) {&nbsp;</div></li><li><div>              $style.=$s;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;currentfontstyle = $style;&nbsp;</div></li><li><div>      $this-&gt;SetFont('', $style, 0, false);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set multiple styles at one time</span>&nbsp;</div></li><li><div>  function SetStylesArray($arr)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $style = '';&nbsp;</div></li><li><div>      foreach (array('B', 'I') as $s) {&nbsp;</div></li><li><div>          if (isset($arr[$s])) {&nbsp;</div></li><li><div>              if ($arr[$s]) {&nbsp;</div></li><li><div>                  $this-&gt;$s = true;&nbsp;</div></li><li><div>                  $style.=$s;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;$s = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($this-&gt;$s) {&nbsp;</div></li><li><div>              $style.=$s;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;currentfontstyle = $style;&nbsp;</div></li><li><div>      $this-&gt;SetFont('', $style, 0, false);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set multiple styles at one $str e.g. &quot;BI&quot;</span>&nbsp;</div></li><li><div>  function SetStyles($str)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $style = '';&nbsp;</div></li><li><div>      foreach (array('B', 'I') as $s) {&nbsp;</div></li><li><div>          if (strpos($str, $s) !== false) {&nbsp;</div></li><li><div>              $this-&gt;$s = true;&nbsp;</div></li><li><div>              $style.=$s;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;$s = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;currentfontstyle = $style;&nbsp;</div></li><li><div>      $this-&gt;SetFont('', $style, 0, false);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function ResetStyles()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach (array('B', 'I') as $s) {&nbsp;</div></li><li><div>          $this-&gt;$s = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;currentfontstyle = '';&nbsp;</div></li><li><div>      $this-&gt;SetFont('', '', 0, false);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function DisableTags($str = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($str == '') { <span class="comment">//enable all tags</span>&nbsp;</div></li><li><div>          <span class="comment">//Insert new supported tags in the long string below.</span>&nbsp;</div></li><li><div>          $this-&gt;enabledtags = &quot;&lt;a&gt;&lt;acronym&gt;&lt;address&gt;&lt;article&gt;&lt;aside&gt;&lt;b&gt;&lt;bdi&gt;&lt;bdo&gt;&lt;big&gt;&lt;blockquote&gt;&lt;br&gt;&lt;caption&gt;&lt;center&gt;&lt;cite&gt;&lt;code&gt;&lt;del&gt;&lt;details&gt;&lt;dd&gt;&lt;div&gt;&lt;dl&gt;&lt;dt&gt;&lt;em&gt;&lt;fieldset&gt;&lt;figcaption&gt;&lt;figure&gt;&lt;font&gt;&lt;form&gt;&lt;h1&gt;&lt;h2&gt;&lt;h3&gt;&lt;h4&gt;&lt;h5&gt;&lt;h6&gt;&lt;hgroup&gt;&lt;hr&gt;&lt;i&gt;&lt;img&gt;&lt;input&gt;&lt;ins&gt;&lt;kbd&gt;&lt;legend&gt;&lt;li&gt;&lt;main&gt;&lt;mark&gt;&lt;meter&gt;&lt;nav&gt;&lt;ol&gt;&lt;option&gt;&lt;p&gt;&lt;pre&gt;&lt;progress&gt;&lt;q&gt;&lt;s&gt;&lt;samp&gt;&lt;section&gt;&lt;select&gt;&lt;small&gt;&lt;span&gt;&lt;strike&gt;&lt;strong&gt;&lt;sub&gt;&lt;summary&gt;&lt;sup&gt;&lt;table&gt;&lt;tbody&gt;&lt;td&gt;&lt;template&gt;&lt;textarea&gt;&lt;tfoot&gt;&lt;th&gt;&lt;thead&gt;&lt;time&gt;&lt;tr&gt;&lt;tt&gt;&lt;u&gt;&lt;ul&gt;&lt;var&gt;&lt;footer&gt;&lt;header&gt;&lt;annotation&gt;&lt;bookmark&gt;&lt;jpgraph&gt;&lt;textcircle&gt;&lt;barcode&gt;&lt;dottab&gt;&lt;indexentry&gt;&lt;indexinsert&gt;&lt;watermarktext&gt;&lt;watermarkimage&gt;&lt;tts&gt;&lt;ttz&gt;&lt;tta&gt;&lt;column_break&gt;&lt;columnbreak&gt;&lt;newcolumn&gt;&lt;newpage&gt;&lt;page_break&gt;&lt;pagebreak&gt;&lt;formfeed&gt;&lt;columns&gt;&lt;toc&gt;&lt;tocentry&gt;&lt;tocpagebreak&gt;&lt;pageheader&gt;&lt;pagefooter&gt;&lt;setpageheader&gt;&lt;setpagefooter&gt;&lt;sethtmlpageheader&gt;&lt;sethtmlpagefooter&gt;&quot;;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $str = explode(&quot;, &quot;, $str);&nbsp;</div></li><li><div>          foreach ($str as $v)&nbsp;</div></li><li><div>              $this-&gt;enabledtags = str_replace(trim($v), '', $this-&gt;enabledtags);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function TableCheckMinWidth($maxwidth, $forcewrap = 0, $textbuffer, $checkletter = false)&nbsp;</div></li><li><div>  { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $acclength = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> (accumulated length across &gt; 1 chunk)&nbsp;</div></li><li><div>      $acclongest = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> (accumulated length max across &gt; 1 chunk)&nbsp;</div></li><li><div>      $biggestword = 0;&nbsp;</div></li><li><div>      $toonarrow = false;&nbsp;</div></li><li><div>      if ((count($textbuffer) == 0) or ( (count($textbuffer) == 1) && ($textbuffer[0][0] == ''))) {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($textbuffer as $chunk) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $line = $chunk[0];&nbsp;</div></li><li><div>          $OTLdata = (isset($chunk[18]) ? $chunk[18] : NULL);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF ITERATION</span></span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;iterationCounter)&nbsp;</div></li><li><div>              $line = preg_replace('/{iteration ([a-zA-Z0-9_]+)}/', '\\1', $line);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// IMAGE</span></span>S & FORM ELEMENTS&nbsp;</div></li><li><div>          if (substr($line, 0, 3) == &quot;\xbb\xa4\xac&quot;) { <span class="comment">//inline object - FORM element or IMAGE!</span>&nbsp;</div></li><li><div>              $objattr = $this-&gt;_getObjAttr($line);&nbsp;</div></li><li><div>              if ($objattr['type'] != 'hr' && isset($objattr['width']) && ($objattr['width'] / $this-&gt;shrin_k) &gt; ($maxwidth + 0.0001)) {&nbsp;</div></li><li><div>                  if (($objattr['width'] / $this-&gt;shrin_k) &gt; $biggestword) {&nbsp;</div></li><li><div>                      $biggestword = ($objattr['width'] / $this-&gt;shrin_k);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $toonarrow = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($line == &quot;\n&quot;) {&nbsp;</div></li><li><div>              $acclength = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> (accumulated length across &gt; 1 chunk)&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $line = trim($line);&nbsp;</div></li><li><div>          if (!empty($OTLdata)) {&nbsp;</div></li><li><div>              $this-&gt;otl-&gt;trimOTLdata($OTLdata, true, true);&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment">// SET FONT SIZE/STYLE from $chunk[n]</span>&nbsp;</div></li><li><div>          <span class="comment">// FONTSIZE</span>&nbsp;</div></li><li><div>          if (isset($chunk[11]) and $chunk[11] != '') {&nbsp;</div></li><li><div>              if ($this-&gt;shrin_k) {&nbsp;</div></li><li><div>                  $this-&gt;SetFontSize($chunk[11] / $this-&gt;shrin_k, false);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;SetFontSize($chunk[11], false);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// FONTFAMILY</span>&nbsp;</div></li><li><div>          if (isset($chunk[4]) and $chunk[4] != '') {&nbsp;</div></li><li><div>              $font = $this-&gt;SetFont($chunk[4], $this-&gt;FontStyle, 0, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// B I</span>&nbsp;</div></li><li><div>          if (isset($chunk[2]) and $chunk[2] != '') {&nbsp;</div></li><li><div>              $this-&gt;SetStyles($chunk[2]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lbw = $rbw = 0; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Border widths</span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($chunk[16]) && !empty($chunk[16])) { <span class="comment"><span class="comment">//Border</span></span>&nbsp;</div></li><li><div>              $this-&gt;spanborddet = $chunk[16];&nbsp;</div></li><li><div>              $lbw = (isset($this-&gt;spanborddet['L']['w']) ? $this-&gt;spanborddet['L']['w'] : 0);&nbsp;</div></li><li><div>              $rbw = (isset($this-&gt;spanborddet['R']['w']) ? $this-&gt;spanborddet['R']['w'] : 0);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($chunk[15])) {   <span class="comment"><span class="comment"><span class="comment">// Word spacing</span></span></span>&nbsp;</div></li><li><div>              $this-&gt;wSpacingCSS = $chunk[15];&nbsp;</div></li><li><div>              if ($this-&gt;wSpacingCSS && strtoupper($this-&gt;wSpacingCSS) != 'NORMAL') {&nbsp;</div></li><li><div>                  $this-&gt;minwSpacing = $this-&gt;ConvertSize($this-&gt;wSpacingCSS, $this-&gt;FontSize) / $this-&gt;shrin_k; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($chunk[14])) {   <span class="comment"><span class="comment">// Letter spacing</span></span>&nbsp;</div></li><li><div>              $this-&gt;lSpacingCSS = $chunk[14];&nbsp;</div></li><li><div>              if (($this-&gt;lSpacingCSS || $this-&gt;lSpacingCSS === '0') && strtoupper($this-&gt;lSpacingCSS) != 'NORMAL') {&nbsp;</div></li><li><div>                  $this-&gt;fixedlSpacing = $this-&gt;ConvertSize($this-&gt;lSpacingCSS, $this-&gt;FontSize) / $this-&gt;shrin_k; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($chunk[8])) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;textvar = $chunk[8];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment">// If overflow==wrap ($checkletter) OR (No word breaks and contains CJK)</span>&nbsp;</div></li><li><div>          if ($checkletter || (!preg_match('/(\xe2\x80\x8b| )/', trim($line)) && preg_match(&quot;/([&quot; . $this-&gt;pregCJKchars . &quot;])/u&quot;, $line) )) {&nbsp;</div></li><li><div>              if (preg_match(&quot;/([&quot; . $this-&gt;pregCJKchars . &quot;])/u&quot;, $line)) {&nbsp;</div></li><li><div>                  $checkCJK = true;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $checkCJK = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $letters = preg_split('<span class="comment">//u', $line);</span>&nbsp;</div></li><li><div>              foreach ($letters as $k =&gt; $letter) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($checkCJK) {&nbsp;</div></li><li><div>                      if (preg_match(&quot;/[&quot; . $this-&gt;CJKleading . &quot;]/u&quot;, $letter) && $k &gt; 0) {&nbsp;</div></li><li><div>                          $letter = $letters[$k - 1] . $letter;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (preg_match(&quot;/[&quot; . $this-&gt;CJKfollowing . &quot;]/u&quot;, $letter) && $k &lt; (count($letters) - 1)) {&nbsp;</div></li><li><div>                          $letter = $letter . $letters[$k + 1];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $letterwidth = $this-&gt;GetStringWidth($letter, false, false, $chunk[8]); <span class="comment"><span class="comment">// Pass $textvar ($chunk[8]), but do OTLdata here</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// so don't have to split OTLdata for each word</span></span>&nbsp;</div></li><li><div>                  if ($k == 0) {&nbsp;</div></li><li><div>                      $letterwidth += $lbw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($k == (count($letters) - 1)) {&nbsp;</div></li><li><div>                      $letterwidth += $rbw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//Warn user that maxwidth is insufficient</span></span>&nbsp;</div></li><li><div>                  if ($letterwidth &gt; $maxwidth + 0.0001) {&nbsp;</div></li><li><div>                      if ($letterwidth &gt; $biggestword) {&nbsp;</div></li><li><div>                          $biggestword = $letterwidth;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $toonarrow = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment">// Need to account for any XAdvance in GPOSinfo (OTLdata = $chunk[18])</span>&nbsp;</div></li><li><div>              $wordXAdvance = array();&nbsp;</div></li><li><div>              if (isset($chunk[18]) && $chunk[18]) {&nbsp;</div></li><li><div>                  preg_match_all('/(\xe2\x80\x8b| )/', $line, $spaces, PREG_OFFSET_CAPTURE); <span class="comment"><span class="comment">// U+200B Zero Width word boundary, or space</span></span>&nbsp;</div></li><li><div>                  $lastoffset = 0;&nbsp;</div></li><li><div>                  $k = -1; <span class="comment">// Added so that if no spaces found, &quot;last word&quot; later is calculated for the one and only word</span>&nbsp;</div></li><li><div>                  foreach ($spaces[0] as $k =&gt; $m) {&nbsp;</div></li><li><div>                      $offset = $m[1];&nbsp;</div></li><li><div>                      <span class="comment">// ...TableCheckMinWidth...</span>&nbsp;</div></li><li><div>                      <span class="comment">// At this point, BIDI not applied, Writing direction is not set, and XAdvanceL balances XAdvanceR</span>&nbsp;</div></li><li><div>                      for ($n = $lastoffset; $n &lt; $offset; $n++) {&nbsp;</div></li><li><div>                          if (isset($chunk[18]['GPOSinfo'][$n]['XAdvanceL'])) {&nbsp;</div></li><li><div>                              if (isset($wordXAdvance[$k])) {&nbsp;</div></li><li><div>                                  $wordXAdvance[$k] += $chunk[18]['GPOSinfo'][$n]['XAdvanceL'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $wordXAdvance[$k] = $chunk[18]['GPOSinfo'][$n]['XAdvanceL'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $lastoffset = $offset + 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $k++;  <span class="comment">// last word</span>&nbsp;</div></li><li><div>                  foreach ($chunk[18]['GPOSinfo'] AS $n =&gt; $gpos) {&nbsp;</div></li><li><div>                      if ($n &gt;= $lastoffset && isset($chunk[18]['GPOSinfo'][$n]['XAdvanceL'])) {&nbsp;</div></li><li><div>                          if (isset($wordXAdvance[$k])) {&nbsp;</div></li><li><div>                              $wordXAdvance[$k] += $chunk[18]['GPOSinfo'][$n]['XAdvanceL'];&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $wordXAdvance[$k] = $chunk[18]['GPOSinfo'][$n]['XAdvanceL'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $words = preg_split('/(\xe2\x80\x8b| )/', $line); <span class="comment"><span class="comment">// U+200B Zero Width word boundary, or space</span></span>&nbsp;</div></li><li><div>              foreach ($words as $k =&gt; $word) {&nbsp;</div></li><li><div>                  $word = trim($word);&nbsp;</div></li><li><div>                  $wordwidth = $this-&gt;GetStringWidth($word, false, false, $chunk[8]); <span class="comment"><span class="comment">// Pass $textvar ($chunk[8]), but do OTLdata here</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// so don't have to split OTLdata for each word</span></span>&nbsp;</div></li><li><div>                  if (isset($wordXAdvance[$k])) {&nbsp;</div></li><li><div>                      $wordwidth += ($wordXAdvance[$k] * 1000 / $this-&gt;CurrentFont['unitsPerEm']) * ($this-&gt;FontSize / 1000);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($k == 0) {&nbsp;</div></li><li><div>                      $wordwidth += $lbw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($k == (count($words) - 1)) {&nbsp;</div></li><li><div>                      $wordwidth += $rbw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (count($words) == 1 && substr($chunk[0], 0, 1) != ' ') {&nbsp;</div></li><li><div>                      $acclength += $wordwidth;&nbsp;</div></li><li><div>                  } elseif (count($words) &gt; 1 && $k == 0 && substr($chunk[0], 0, 1) != ' ') {&nbsp;</div></li><li><div>                      $acclength += $wordwidth;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $acclength = $wordwidth;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $acclongest = max($acclongest, $acclength);&nbsp;</div></li><li><div>                  if (count($words) == 1 && substr($chunk[0], -1, 1) == ' ') {&nbsp;</div></li><li><div>                      $acclength = 0;&nbsp;</div></li><li><div>                  } elseif (count($words) &gt; 1 && ($k != (count($words) - 1) || substr($chunk[0], -1, 1) == ' ')) {&nbsp;</div></li><li><div>                      $acclength = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//Warn user that maxwidth is insufficient</span></span>&nbsp;</div></li><li><div>                  if ($wordwidth &gt; $maxwidth + 0.0001) {&nbsp;</div></li><li><div>                      if ($wordwidth &gt; $biggestword) {&nbsp;</div></li><li><div>                          $biggestword = $wordwidth;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $toonarrow = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>  Accumulated length of biggest word - across multiple chunks&nbsp;</div></li><li><div>          if ($acclongest &gt; $maxwidth + 0.0001) {&nbsp;</div></li><li><div>              if ($acclongest &gt; $biggestword) {&nbsp;</div></li><li><div>                  $biggestword = $acclongest;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $toonarrow = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// RESET FONT SIZE/STYLE</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// RESETTING VALUES</span></span>&nbsp;</div></li><li><div>          <span class="comment">//Now we must deactivate what we have used</span>&nbsp;</div></li><li><div>          if (isset($chunk[2]) and $chunk[2] != '') {&nbsp;</div></li><li><div>              $this-&gt;ResetStyles();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($chunk[4]) and $chunk[4] != '') {&nbsp;</div></li><li><div>              $this-&gt;SetFont($this-&gt;default_font, $this-&gt;FontStyle, 0, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($chunk[11]) and $chunk[11] != '') {&nbsp;</div></li><li><div>              $this-&gt;SetFontSize($this-&gt;default_font_size, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;spanborddet = array();&nbsp;</div></li><li><div>          $this-&gt;textvar = 0x00; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;OTLtags = array();&nbsp;</div></li><li><div>          $this-&gt;lSpacingCSS = '';&nbsp;</div></li><li><div>          $this-&gt;wSpacingCSS = '';&nbsp;</div></li><li><div>          $this-&gt;fixedlSpacing = false;&nbsp;</div></li><li><div>          $this-&gt;minwSpacing = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Return -(wordsize) if word is bigger than maxwidth</span>&nbsp;</div></li><li><div>      <span class="comment">// ADDED</span>&nbsp;</div></li><li><div>      if (($toonarrow) && ($this-&gt;table_error_report)) {&nbsp;</div></li><li><div>          throw new MpdfException(&quot;Word is too long to fit in table - &quot; . $this-&gt;table_error_report_param);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($toonarrow)&nbsp;</div></li><li><div>          return -$biggestword;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          return 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function shrinkTable(&$table, $k)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $table['border_spacing_H'] /= $k;&nbsp;</div></li><li><div>      $table['border_spacing_V'] /= $k;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $table['padding']['T'] /= $k;&nbsp;</div></li><li><div>      $table['padding']['R'] /= $k;&nbsp;</div></li><li><div>      $table['padding']['B'] /= $k;&nbsp;</div></li><li><div>      $table['padding']['L'] /= $k;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $table['margin']['T'] /= $k;&nbsp;</div></li><li><div>      $table['margin']['R'] /= $k;&nbsp;</div></li><li><div>      $table['margin']['B'] /= $k;&nbsp;</div></li><li><div>      $table['margin']['L'] /= $k;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $table['border_details']['T']['w'] /= $k;&nbsp;</div></li><li><div>      $table['border_details']['R']['w'] /= $k;&nbsp;</div></li><li><div>      $table['border_details']['B']['w'] /= $k;&nbsp;</div></li><li><div>      $table['border_details']['L']['w'] /= $k;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($table['max_cell_border_width']['T']))&nbsp;</div></li><li><div>          $table['max_cell_border_width']['T'] /= $k;&nbsp;</div></li><li><div>      if (isset($table['max_cell_border_width']['R']))&nbsp;</div></li><li><div>          $table['max_cell_border_width']['R'] /= $k;&nbsp;</div></li><li><div>      if (isset($table['max_cell_border_width']['B']))&nbsp;</div></li><li><div>          $table['max_cell_border_width']['B'] /= $k;&nbsp;</div></li><li><div>      if (isset($table['max_cell_border_width']['L']))&nbsp;</div></li><li><div>          $table['max_cell_border_width']['L'] /= $k;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>          $table['simple']['border_details']['T']['w'] /= $k;&nbsp;</div></li><li><div>          $table['simple']['border_details']['R']['w'] /= $k;&nbsp;</div></li><li><div>          $table['simple']['border_details']['B']['w'] /= $k;&nbsp;</div></li><li><div>          $table['simple']['border_details']['L']['w'] /= $k;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $table['miw'] /= $k;&nbsp;</div></li><li><div>      $table['maw'] /= $k;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($j = 0; $j &lt; $table['nc']; $j++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $table['wc'][$j]['miw'] /= $k;&nbsp;</div></li><li><div>          $table['wc'][$j]['maw'] /= $k;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($table['decimal_align'][$j]['maxs0']) && $table['decimal_align'][$j]['maxs0']) {&nbsp;</div></li><li><div>              $table['decimal_align'][$j]['maxs0'] /= $k;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($table['decimal_align'][$j]['maxs1']) && $table['decimal_align'][$j]['maxs1']) {&nbsp;</div></li><li><div>              $table['decimal_align'][$j]['maxs1'] /= $k;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($table['wc'][$j]['absmiw']) && $table['wc'][$j]['absmiw'])&nbsp;</div></li><li><div>              $table['wc'][$j]['absmiw'] /= $k;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $table['nr']; $i++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//rows</span></span></span></span></span></span>&nbsp;</div></li><li><div>              $c = &$table['cells'][$i][$j];&nbsp;</div></li><li><div>              if (isset($c) && $c) {&nbsp;</div></li><li><div>                  if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                      if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                          $cell = $this-&gt;_unpackCellBorder($c['borderbin']);&nbsp;</div></li><li><div>                          $cell['border_details']['T']['w'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['R']['w'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['B']['w'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['L']['w'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['mbw']['TL'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['mbw']['TR'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['mbw']['BL'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['mbw']['BR'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['mbw']['LT'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['mbw']['LB'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['mbw']['RT'] /= $k;&nbsp;</div></li><li><div>                          $cell['border_details']['mbw']['RB'] /= $k;&nbsp;</div></li><li><div>                          $c['borderbin'] = $this-&gt;_packCellBorder($cell);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $c['border_details']['T']['w'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['R']['w'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['B']['w'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['L']['w'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['mbw']['TL'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['mbw']['TR'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['mbw']['BL'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['mbw']['BR'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['mbw']['LT'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['mbw']['LB'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['mbw']['RT'] /= $k;&nbsp;</div></li><li><div>                          $c['border_details']['mbw']['RB'] /= $k;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $c['padding']['T'] /= $k;&nbsp;</div></li><li><div>                  $c['padding']['R'] /= $k;&nbsp;</div></li><li><div>                  $c['padding']['B'] /= $k;&nbsp;</div></li><li><div>                  $c['padding']['L'] /= $k;&nbsp;</div></li><li><div>                  if (isset($c['maxs'])) {&nbsp;</div></li><li><div>                      $c['maxs'] /= $k;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($c['w'])) {&nbsp;</div></li><li><div>                      $c['w'] /= $k;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $c['s'] /= $k;&nbsp;</div></li><li><div>                  $c['maw'] /= $k;&nbsp;</div></li><li><div>                  $c['miw'] /= $k;&nbsp;</div></li><li><div>                  if (isset($c['h'])) {&nbsp;</div></li><li><div>                      $c['h'] /= $k;&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>                  if (isset($c['absmiw']))&nbsp;</div></li><li><div>                      $c['absmiw'] /= $k;&nbsp;</div></li><li><div>                  if (isset($c['nestedmaw']))&nbsp;</div></li><li><div>                      $c['nestedmaw'] /= $k;&nbsp;</div></li><li><div>                  if (isset($c['nestedmiw']))&nbsp;</div></li><li><div>                      $c['nestedmiw'] /= $k;&nbsp;</div></li><li><div>                  if (isset($c['textbuffer'])) {&nbsp;</div></li><li><div>                      foreach ($c['textbuffer'] AS $n =&gt; $tb) {&nbsp;</div></li><li><div>                          if (!empty($tb[16])) {&nbsp;</div></li><li><div>                              $c['textbuffer'][$n][16]['T']['w'] /= $k;&nbsp;</div></li><li><div>                              $c['textbuffer'][$n][16]['B']['w'] /= $k;&nbsp;</div></li><li><div>                              $c['textbuffer'][$n][16]['L']['w'] /= $k;&nbsp;</div></li><li><div>                              $c['textbuffer'][$n][16]['R']['w'] /= $k;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  unset($c);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//rows</span></span></span></span></span></span>&nbsp;</div></li><li><div>      }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function read_short(&$fh)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = fread($fh, 2);&nbsp;</div></li><li><div>      $a = (ord($s[0]) &lt;&lt; 8) + ord($s[1]);&nbsp;</div></li><li><div>      if ($a & (1 &lt;&lt; 15)) {&nbsp;</div></li><li><div>          $a = ($a - (1 &lt;&lt; 16));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $a;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _packCellBorder($cell)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!is_array($cell) || !isset($cell)) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;packTableData) {&nbsp;</div></li><li><div>          return $cell;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// = 186 bytes</span>&nbsp;</div></li><li><div>      $bindata = pack(&quot;nnda6A10nnda6A10nnda6A10nnda6A10nd9&quot;, $cell['border'], $cell['border_details']['R']['s'], $cell['border_details']['R']['w'], $cell['border_details']['R']['c'], $cell['border_details']['R']['style'], $cell['border_details']['R']['dom'], $cell['border_details']['L']['s'], $cell['border_details']['L']['w'], $cell['border_details']['L']['c'], $cell['border_details']['L']['style'], $cell['border_details']['L']['dom'], $cell['border_details']['T']['s'], $cell['border_details']['T']['w'], $cell['border_details']['T']['c'], $cell['border_details']['T']['style'], $cell['border_details']['T']['dom'], $cell['border_details']['B']['s'], $cell['border_details']['B']['w'], $cell['border_details']['B']['c'], $cell['border_details']['B']['style'], $cell['border_details']['B']['dom'], $cell['border_details']['mbw']['BL'], $cell['border_details']['mbw']['BR'], $cell['border_details']['mbw']['RT'], $cell['border_details']['mbw']['RB'], $cell['border_details']['mbw']['TL'], $cell['border_details']['mbw']['TR'], $cell['border_details']['mbw']['LT'], $cell['border_details']['mbw']['LB'], (isset($cell['border_details']['cellposdom']) ? $cell['border_details']['cellposdom'] : 0)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      return $bindata;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _getBorderWidths($bindata)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$bindata) {&nbsp;</div></li><li><div>          return array(0, 0, 0, 0);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;packTableData) {&nbsp;</div></li><li><div>          return array($bindata['border_details']['T']['w'], $bindata['border_details']['R']['w'], $bindata['border_details']['B']['w'], $bindata['border_details']['L']['w']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bd = unpack(&quot;nbord/nrs/drw/a6rca/A10rst/nrd/nls/dlw/a6lca/A10lst/nld/nts/dtw/a6tca/A10tst/ntd/nbs/dbw/a6bca/A10bst/nbd/dmbl/dmbr/dmrt/dmrb/dmtl/dmtr/dmlt/dmlb/dcpd&quot;, $bindata);&nbsp;</div></li><li><div>      $cell['border_details']['R']['w'] = $bd['rw'];&nbsp;</div></li><li><div>      $cell['border_details']['L']['w'] = $bd['lw'];&nbsp;</div></li><li><div>      $cell['border_details']['T']['w'] = $bd['tw'];&nbsp;</div></li><li><div>      $cell['border_details']['B']['w'] = $bd['bw'];&nbsp;</div></li><li><div>      return array($bd['tw'], $bd['rw'], $bd['bw'], $bd['lw']);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _unpackCellBorder($bindata)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$bindata) {&nbsp;</div></li><li><div>          return array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$this-&gt;packTableData) {&nbsp;</div></li><li><div>          return $bindata;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bd = unpack(&quot;nbord/nrs/drw/a6rca/A10rst/nrd/nls/dlw/a6lca/A10lst/nld/nts/dtw/a6tca/A10tst/ntd/nbs/dbw/a6bca/A10bst/nbd/dmbl/dmbr/dmrt/dmrb/dmtl/dmtr/dmlt/dmlb/dcpd&quot;, $bindata);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cell['border'] = $bd['bord'];&nbsp;</div></li><li><div>      $cell['border_details']['R']['s'] = $bd['rs'];&nbsp;</div></li><li><div>      $cell['border_details']['R']['w'] = $bd['rw'];&nbsp;</div></li><li><div>      $cell['border_details']['R']['c'] = str_pad($bd['rca'], 6, &quot;\x00&quot;);&nbsp;</div></li><li><div>      $cell['border_details']['R']['style'] = trim($bd['rst']);&nbsp;</div></li><li><div>      $cell['border_details']['R']['dom'] = $bd['rd'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cell['border_details']['L']['s'] = $bd['ls'];&nbsp;</div></li><li><div>      $cell['border_details']['L']['w'] = $bd['lw'];&nbsp;</div></li><li><div>      $cell['border_details']['L']['c'] = str_pad($bd['lca'], 6, &quot;\x00&quot;);&nbsp;</div></li><li><div>      $cell['border_details']['L']['style'] = trim($bd['lst']);&nbsp;</div></li><li><div>      $cell['border_details']['L']['dom'] = $bd['ld'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cell['border_details']['T']['s'] = $bd['ts'];&nbsp;</div></li><li><div>      $cell['border_details']['T']['w'] = $bd['tw'];&nbsp;</div></li><li><div>      $cell['border_details']['T']['c'] = str_pad($bd['tca'], 6, &quot;\x00&quot;);&nbsp;</div></li><li><div>      $cell['border_details']['T']['style'] = trim($bd['tst']);&nbsp;</div></li><li><div>      $cell['border_details']['T']['dom'] = $bd['td'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cell['border_details']['B']['s'] = $bd['bs'];&nbsp;</div></li><li><div>      $cell['border_details']['B']['w'] = $bd['bw'];&nbsp;</div></li><li><div>      $cell['border_details']['B']['c'] = str_pad($bd['bca'], 6, &quot;\x00&quot;);&nbsp;</div></li><li><div>      $cell['border_details']['B']['style'] = trim($bd['bst']);&nbsp;</div></li><li><div>      $cell['border_details']['B']['dom'] = $bd['bd'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cell['border_details']['mbw']['BL'] = $bd['mbl'];&nbsp;</div></li><li><div>      $cell['border_details']['mbw']['BR'] = $bd['mbr'];&nbsp;</div></li><li><div>      $cell['border_details']['mbw']['RT'] = $bd['mrt'];&nbsp;</div></li><li><div>      $cell['border_details']['mbw']['RB'] = $bd['mrb'];&nbsp;</div></li><li><div>      $cell['border_details']['mbw']['TL'] = $bd['mtl'];&nbsp;</div></li><li><div>      $cell['border_details']['mbw']['TR'] = $bd['mtr'];&nbsp;</div></li><li><div>      $cell['border_details']['mbw']['LT'] = $bd['mlt'];&nbsp;</div></li><li><div>      $cell['border_details']['mbw']['LB'] = $bd['mlb'];&nbsp;</div></li><li><div>      $cell['border_details']['cellposdom'] = $bd['cpd'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return($cell);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>//TABLE CODE (from PDFTable)<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>//////&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>//TABLE CODE (from PDFTable)<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>//////&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>//TABLE CODE (from PDFTable)<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>//////&nbsp;</div></li><li><div>  <span class="comment">//table        Array of (w, h, bc, nr, wc, hr, cells)</span>&nbsp;</div></li><li><div>  <span class="comment">//w            Width of table</span>&nbsp;</div></li><li><div>  <span class="comment">//h            Height of table</span>&nbsp;</div></li><li><div>  <span class="comment">//nc            Number column</span>&nbsp;</div></li><li><div>  <span class="comment">//nr            Number row</span>&nbsp;</div></li><li><div>  <span class="comment">//hr            List of height of each row</span>&nbsp;</div></li><li><div>  <span class="comment">//wc            List of width of each column</span>&nbsp;</div></li><li><div>  <span class="comment">//cells        List of cells of each rows, cells[i][j] is a cell in the table</span>&nbsp;</div></li><li><div>  function _tableColumnWidth(&$table, $firstpass = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $cs = &$table['cells'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $nc = $table['nc'];&nbsp;</div></li><li><div>      $nr = $table['nr'];&nbsp;</div></li><li><div>      $listspan = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($table['borders_separate']) {&nbsp;</div></li><li><div>          $tblbw = $table['border_details']['L']['w'] + $table['border_details']['R']['w'] + $table['margin']['L'] + $table['margin']['R'] + $table['padding']['L'] + $table['padding']['R'] + $table['border_spacing_H'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tblbw = $table['max_cell_border_width']['L'] / 2 + $table['max_cell_border_width']['R'] / 2 + $table['margin']['L'] + $table['margin']['R'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// ADDED</span> table['l'][colno]&nbsp;</div></li><li><div>      <span class="comment">// = total length of text approx (using $c['s']) in that column - used to approximately distribute col widths in _tableWidth</span>&nbsp;</div></li><li><div>      //&nbsp;</div></li><li><div>  for ($j = 0; $j &lt; $nc; $j++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $wc = &$table['wc'][$j];&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $nr; $i++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//rows</span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($cs[$i][$j]) && $cs[$i][$j]) {&nbsp;</div></li><li><div>                  $c = &$cs[$i][$j];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                      if ($table['borders_separate']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// NB twice border width</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $extrcw = $table['simple']['border_details']['L']['w'] + $table['simple']['border_details']['R']['w'] + $c['padding']['L'] + $c['padding']['R'] + $table['border_spacing_H'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $extrcw = $table['simple']['border_details']['L']['w'] / 2 + $table['simple']['border_details']['R']['w'] / 2 + $c['padding']['L'] + $c['padding']['R'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                          list($bt, $br, $bb, $bl) = $this-&gt;_getBorderWidths($c['borderbin']);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $br = $c['border_details']['R']['w'];&nbsp;</div></li><li><div>                          $bl = $c['border_details']['L']['w'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($table['borders_separate']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// NB twice border width</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $extrcw = $bl + $br + $c['padding']['L'] + $c['padding']['R'] + $table['border_spacing_H'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $extrcw = $bl / 2 + $br / 2 + $c['padding']['L'] + $c['padding']['R'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//$mw = $this-&gt;GetStringWidth('W') + $extrcw ;</span>&nbsp;</div></li><li><div>                  $mw = $extrcw; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (substr($c['a'], 0, 1) == 'D') {&nbsp;</div></li><li><div>                      $mw = $table['decimal_align'][$j]['maxs0'] + $table['decimal_align'][$j]['maxs1'] + $extrcw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $c['absmiw'] = $mw;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($c['R']) && $c['R']) {&nbsp;</div></li><li><div>                      $c['maw'] = $c['miw'] = $this-&gt;FontSize + $extrcw;&nbsp;</div></li><li><div>                      if (isset($c['w'])) { <span class="comment"><span class="comment">// If cell width is specified</span></span>&nbsp;</div></li><li><div>                          if ($c['miw'] &lt; $c['w']) {&nbsp;</div></li><li><div>                              $c['miw'] = $c['w'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (!isset($c['colspan'])) {&nbsp;</div></li><li><div>                          if ($wc['miw'] &lt; $c['miw']) {&nbsp;</div></li><li><div>                              $wc['miw'] = $c['miw'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($wc['maw'] &lt; $c['maw']) {&nbsp;</div></li><li><div>                              $wc['maw'] = $c['maw'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($firstpass) {&nbsp;</div></li><li><div>                              if (isset($table['l'][$j])) {&nbsp;</div></li><li><div>                                  $table['l'][$j] += $c['miw'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $table['l'][$j] = $c['miw'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($c['miw'] &gt; $wc['miw']) {&nbsp;</div></li><li><div>                          $wc['miw'] = $c['miw'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($wc['miw'] &gt; $wc['maw']) {&nbsp;</div></li><li><div>                          $wc['maw'] = $wc['miw'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($firstpass) {&nbsp;</div></li><li><div>                      if (isset($c['s'])) {&nbsp;</div></li><li><div>                          $c['s'] += $extrcw;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (isset($c['maxs'])) {&nbsp;</div></li><li><div>                          $c['maxs'] += $extrcw;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (isset($c['nestedmiw'])) {&nbsp;</div></li><li><div>                          $c['nestedmiw'] += $extrcw;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (isset($c['nestedmaw'])) {&nbsp;</div></li><li><div>                          $c['nestedmaw'] += $extrcw;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// If minimum width has already been set by a nested table or inline object (image/form), use it</span>&nbsp;</div></li><li><div>                  if (isset($c['nestedmiw']) && (!isset($this-&gt;table[1][1]['overflow']) || $this-&gt;table[1][1]['overflow'] != 'visible')) {&nbsp;</div></li><li><div>                      $miw = $c['nestedmiw'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $miw = $mw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($c['maxs']) && $c['maxs'] != '') {&nbsp;</div></li><li><div>                      $c['s'] = $c['maxs'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// If maximum width has already been set by a nested table, use it</span>&nbsp;</div></li><li><div>                  if (isset($c['nestedmaw'])) {&nbsp;</div></li><li><div>                      $c['maw'] = $c['nestedmaw'];&nbsp;</div></li><li><div>                  } else&nbsp;</div></li><li><div>                      $c['maw'] = $c['s'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($table['overflow']) && $table['overflow'] == 'visible' && $table['level'] == 1) {&nbsp;</div></li><li><div>                      if (($c['maw'] + $tblbw) &gt; $this-&gt;blk[$this-&gt;blklvl]['inner_width']) {&nbsp;</div></li><li><div>                          $c['maw'] = $this-&gt;blk[$this-&gt;blklvl]['inner_width'] - $tblbw;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($c['nowrap']) && $c['nowrap']) {&nbsp;</div></li><li><div>                      $miw = $c['maw'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($c['wpercent']) && $firstpass) {&nbsp;</div></li><li><div>                      if (isset($c['colspan'])) { <span class="comment">// Not perfect - but % set on colspan is shared equally on cols.</span>&nbsp;</div></li><li><div>                          for ($k = 0; $k &lt; $c['colspan']; $k++) {&nbsp;</div></li><li><div>                              $table['wc'][($j + $k)]['wpercent'] = $c['wpercent'] / $c['colspan'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          if (isset($table['w']) && $table['w']) {&nbsp;</div></li><li><div>                              $c['w'] = $c['wpercent'] / 100 * ($table['w'] - $tblbw );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $wc['wpercent'] = $c['wpercent'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($table['overflow']) && $table['overflow'] == 'visible' && $table['level'] == 1) {&nbsp;</div></li><li><div>                      if (isset($c['w']) && ($c['w'] + $tblbw) &gt; $this-&gt;blk[$this-&gt;blklvl]['inner_width']) {&nbsp;</div></li><li><div>                          $c['w'] = $this-&gt;blk[$this-&gt;blklvl]['inner_width'] - $tblbw;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($c['w'])) { <span class="comment"><span class="comment">// If cell width is specified</span></span>&nbsp;</div></li><li><div>                      if ($miw &lt; $c['w']) {&nbsp;</div></li><li><div>                          $c['miw'] = $c['w'];&nbsp;</div></li><li><div>                      } <span class="comment">// Cell min width = that specified</span>&nbsp;</div></li><li><div>                      if ($miw &gt; $c['w']) {&nbsp;</div></li><li><div>                          $c['miw'] = $c['w'] = $miw;&nbsp;</div></li><li><div>                      } <span class="comment">// If width specified is less than minimum allowed (W) increase it</span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>  Do not set column width in colspan&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// cf. http://www.mpdf1.com/forum/discussion/2221/colspan-bug</span></span>&nbsp;</div></li><li><div>                      if (!isset($c['colspan'])) {&nbsp;</div></li><li><div>                          if (!isset($wc['w'])) {&nbsp;</div></li><li><div>                              $wc['w'] = 1;&nbsp;</div></li><li><div>                          }  <span class="comment">// If the Col width is not specified = set it to 1</span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>  cf. http://www.mpdf1.com/forum/discussion/1648/nested-table-bug-&nbsp;</div></li><li><div>                      $c['maw'] = $c['w'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $c['miw'] = $miw;&nbsp;</div></li><li><div>                  } <span class="comment">// If cell width not specified -&gt; set Cell min width it to minimum allowed (W)</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($c['miw']) && $c['maw'] &lt; $c['miw']) {&nbsp;</div></li><li><div>                      $c['maw'] = $c['miw'];&nbsp;</div></li><li><div>                  } <span class="comment">// If Cell max width &lt; Minwidth - increase it to =</span>&nbsp;</div></li><li><div>                  if (!isset($c['colspan'])) {&nbsp;</div></li><li><div>                      if (isset($c['miw']) && $wc['miw'] &lt; $c['miw']) {&nbsp;</div></li><li><div>                          $wc['miw'] = $c['miw'];&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment">// Update Col Minimum and maximum widths</span></span>&nbsp;</div></li><li><div>                      if ($wc['maw'] &lt; $c['maw']) {&nbsp;</div></li><li><div>                          $wc['maw'] = $c['maw'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ((isset($wc['absmiw']) && $wc['absmiw'] &lt; $c['absmiw']) || !isset($wc['absmiw'])) {&nbsp;</div></li><li><div>                          $wc['absmiw'] = $c['absmiw'];&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment">// Update Col Minimum and maximum widths</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (isset($table['l'][$j])) {&nbsp;</div></li><li><div>                          $table['l'][$j] += $c['s'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $table['l'][$j] = $c['s'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $listspan[] = array($i, $j);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Check if minimum width of the whole column is big enough for largest word to fit</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($c['textbuffer'])) {&nbsp;</div></li><li><div>                      if (isset($table['overflow']) && $table['overflow'] == 'wrap') {&nbsp;</div></li><li><div>                          $letter = true;&nbsp;</div></li><li><div>                      } <span class="comment">// check for maximum width of letters</span>&nbsp;</div></li><li><div>                      else {&nbsp;</div></li><li><div>                          $letter = false;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $minwidth = $this-&gt;TableCheckMinWidth($wc['miw'] - $extrcw, 0, $c['textbuffer'], $letter);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $minwidth = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($minwidth &lt; 0) {&nbsp;</div></li><li><div>                      <span class="comment">//increase minimum width</span>&nbsp;</div></li><li><div>                      if (!isset($c['colspan'])) {&nbsp;</div></li><li><div>                          $wc['miw'] = max($wc['miw'], ((-$minwidth) + $extrcw));&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $c['miw'] = max($c['miw'], ((-$minwidth) + $extrcw));&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!isset($c['colspan'])) {&nbsp;</div></li><li><div>                      if ($wc['miw'] &gt; $wc['maw']) {&nbsp;</div></li><li><div>                          $wc['maw'] = $wc['miw'];&nbsp;</div></li><li><div>                      } <span class="comment">//update maximum width, if needed</span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              unset($c);&nbsp;</div></li><li><div>          }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//rows</span></span></span></span></span></span>&nbsp;</div></li><li><div>      }<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// COLUMN SPANS</span>&nbsp;</div></li><li><div>      $wc = &$table['wc'];&nbsp;</div></li><li><div>      foreach ($listspan as $span) {&nbsp;</div></li><li><div>          list($i, $j) = $span;&nbsp;</div></li><li><div>          $c = &$cs[$i][$j];&nbsp;</div></li><li><div>          $lc = $j + $c['colspan'];&nbsp;</div></li><li><div>          if ($lc &gt; $nc) {&nbsp;</div></li><li><div>              $lc = $nc;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $wis = $wisa = 0;&nbsp;</div></li><li><div>          $was = $wasa = 0;&nbsp;</div></li><li><div>          $list = array();&nbsp;</div></li><li><div>          for ($k = $j; $k &lt; $lc; $k++) {&nbsp;</div></li><li><div>              if (isset($table['l'][$k])) {&nbsp;</div></li><li><div>                  if ($c['R']) {&nbsp;</div></li><li><div>                      $table['l'][$k] += $c['miw'] / $c['colspan'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $table['l'][$k] += $c['s'] / $c['colspan'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ($c['R']) {&nbsp;</div></li><li><div>                      $table['l'][$k] = $c['miw'] / $c['colspan'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $table['l'][$k] = $c['s'] / $c['colspan'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $wis += $wc[$k]['miw'];   <span class="comment">// $wis is the sum of the column miw in the colspan</span>&nbsp;</div></li><li><div>              $was += $wc[$k]['maw'];   <span class="comment">// $was is the sum of the column maw in the colspan</span>&nbsp;</div></li><li><div>              if (!isset($c['w'])) {&nbsp;</div></li><li><div>                  $list[] = $k;&nbsp;</div></li><li><div>                  $wisa += $wc[$k]['miw']; <span class="comment">// $wisa is the sum of the column miw in cells with no width specified in the colspan</span>&nbsp;</div></li><li><div>                  $wasa += $wc[$k]['maw']; <span class="comment">// $wasa is the sum of the column maw in cells with no width specified in the colspan</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($c['miw'] &gt; $wis) {&nbsp;</div></li><li><div>              if (!$wis) {&nbsp;</div></li><li><div>                  for ($k = $j; $k &lt; $lc; $k++) {&nbsp;</div></li><li><div>                      $wc[$k]['miw'] = $c['miw'] / $c['colspan'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif (!count($list)) {&nbsp;</div></li><li><div>                  $wi = $c['miw'] - $wis;&nbsp;</div></li><li><div>                  for ($k = $j; $k &lt; $lc; $k++) {&nbsp;</div></li><li><div>                      $wc[$k]['miw'] += ($wc[$k]['miw'] / $wis) * $wi;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $wi = $c['miw'] - $wis;&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>   Extra min width distributed proportionately to all cells in colspan without a specified width&nbsp;</div></li><li><div>                  <span class="comment">// cf. http://www.mpdf1.com/forum/discussion/1607#Item_4</span>&nbsp;</div></li><li><div>                  foreach ($list as $k) {&nbsp;</div></li><li><div>                      if (!isset($wc[$k]['w']) || !$wc[$k]['w'])&nbsp;</div></li><li><div>                          $wc[$k]['miw'] += ($wc[$k]['miw'] / $wisa) * $wi;&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($c['maw'] &gt; $was) {&nbsp;</div></li><li><div>              if (!$wis) {&nbsp;</div></li><li><div>                  for ($k = $j; $k &lt; $lc; $k++) {&nbsp;</div></li><li><div>                      $wc[$k]['maw'] = $c['maw'] / $c['colspan'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif (!count($list)) {&nbsp;</div></li><li><div>                  $wi = $c['maw'] - $was;&nbsp;</div></li><li><div>                  for ($k = $j; $k &lt; $lc; $k++) {&nbsp;</div></li><li><div>                      $wc[$k]['maw'] += ($wc[$k]['maw'] / $was) * $wi;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $wi = $c['maw'] - $was;&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>  Extra max width distributed evenly to all cells in colspan without a specified width&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// cf. http://www.mpdf1.com/forum/discussion/2221/colspan-bug</span></span>&nbsp;</div></li><li><div>                  foreach ($list as $k) {&nbsp;</div></li><li><div>                      $wc[$k]['maw'] += $wi / count($list);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset($c);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $checkminwidth = 0;&nbsp;</div></li><li><div>      $checkmaxwidth = 0;&nbsp;</div></li><li><div>      $totallength = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $nc; $i++) {&nbsp;</div></li><li><div>          $checkminwidth += $table['wc'][$i]['miw'];&nbsp;</div></li><li><div>          $checkmaxwidth += $table['wc'][$i]['maw'];&nbsp;</div></li><li><div>          $totallength += $table['l'][$i];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!isset($table['w']) && $firstpass) {&nbsp;</div></li><li><div>          $sumpc = 0;&nbsp;</div></li><li><div>          $notset = 0;&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $nc; $i++) {&nbsp;</div></li><li><div>              if (isset($table['wc'][$i]['wpercent']) && $table['wc'][$i]['wpercent']) {&nbsp;</div></li><li><div>                  $sumpc += $table['wc'][$i]['wpercent'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $notset++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If sum of widths as %  &gt;= 100% and not all columns are set</span>&nbsp;</div></li><li><div>          <span class="comment">// Set a nominal width of 1% for unset columns</span>&nbsp;</div></li><li><div>          if ($sumpc &gt;= 100 && $notset) {&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; $nc; $i++) {&nbsp;</div></li><li><div>                  if ((!isset($table['wc'][$i]['wpercent']) || !$table['wc'][$i]['wpercent']) &&&nbsp;</div></li><li><div>                      (!isset($table['wc'][$i]['w']) || !$table['wc'][$i]['w'])) {&nbsp;</div></li><li><div>                      $table['wc'][$i]['wpercent'] = 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($sumpc) { <span class="comment">// if any percents are set</span>&nbsp;</div></li><li><div>              $sumnonpc = (100 - $sumpc);&nbsp;</div></li><li><div>              $sumpc = max($sumpc, 100);&nbsp;</div></li><li><div>              $miwleft = 0;&nbsp;</div></li><li><div>              $miwleftcount = 0;&nbsp;</div></li><li><div>              $miwsurplusnonpc = 0;&nbsp;</div></li><li><div>              $maxcalcmiw = 0;&nbsp;</div></li><li><div>              $mawleft = 0;&nbsp;</div></li><li><div>              $mawleftcount = 0;&nbsp;</div></li><li><div>              $mawsurplusnonpc = 0;&nbsp;</div></li><li><div>              $maxcalcmaw = 0;&nbsp;</div></li><li><div>              $mawnon = 0;&nbsp;</div></li><li><div>              $miwnon = 0;&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; $nc; $i++) {&nbsp;</div></li><li><div>                  if (isset($table['wc'][$i]['wpercent'])) {&nbsp;</div></li><li><div>                      $maxcalcmiw = max($maxcalcmiw, ($table['wc'][$i]['miw'] * $sumpc / $table['wc'][$i]['wpercent']));&nbsp;</div></li><li><div>                      $maxcalcmaw = max($maxcalcmaw, ($table['wc'][$i]['maw'] * $sumpc / $table['wc'][$i]['wpercent']));&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $miwleft += $table['wc'][$i]['miw'];&nbsp;</div></li><li><div>                      $mawleft += $table['wc'][$i]['maw'];&nbsp;</div></li><li><div>                      if (!isset($table['wc'][$i]['w'])) {&nbsp;</div></li><li><div>                          $miwleftcount++;&nbsp;</div></li><li><div>                          $mawleftcount++;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($miwleft && $sumnonpc &gt; 0) {&nbsp;</div></li><li><div>                  $miwnon = $miwleft * 100 / $sumnonpc;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($mawleft && $sumnonpc &gt; 0) {&nbsp;</div></li><li><div>                  $mawnon = $mawleft * 100 / $sumnonpc;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (($miwnon &gt; $checkminwidth || $maxcalcmiw &gt; $checkminwidth) && $this-&gt;keep_table_proportions) {&nbsp;</div></li><li><div>                  if ($miwnon &gt; $maxcalcmiw) {&nbsp;</div></li><li><div>                      $miwsurplusnonpc = round((($miwnon * $sumnonpc / 100) - $miwleft), 3);&nbsp;</div></li><li><div>                      $checkminwidth = $miwnon;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $checkminwidth = $maxcalcmiw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  for ($i = 0; $i &lt; $nc; $i++) {&nbsp;</div></li><li><div>                      if (isset($table['wc'][$i]['wpercent'])) {&nbsp;</div></li><li><div>                          $newmiw = $checkminwidth * $table['wc'][$i]['wpercent'] / 100;&nbsp;</div></li><li><div>                          if ($table['wc'][$i]['miw'] &lt; $newmiw) {&nbsp;</div></li><li><div>                              $table['wc'][$i]['miw'] = $newmiw;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $table['wc'][$i]['w'] = 1;&nbsp;</div></li><li><div>                      } elseif ($miwsurplusnonpc && !$table['wc'][$i]['w']) {&nbsp;</div></li><li><div>                          $table['wc'][$i]['miw'] += $miwsurplusnonpc / $miwleftcount;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (($mawnon &gt; $checkmaxwidth || $maxcalcmaw &gt; $checkmaxwidth)) {&nbsp;</div></li><li><div>                  if ($mawnon &gt; $maxcalcmaw) {&nbsp;</div></li><li><div>                      $mawsurplusnonpc = round((($mawnon * $sumnonpc / 100) - $mawleft), 3);&nbsp;</div></li><li><div>                      $checkmaxwidth = $mawnon;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $checkmaxwidth = $maxcalcmaw;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  for ($i = 0; $i &lt; $nc; $i++) {&nbsp;</div></li><li><div>                      if (isset($table['wc'][$i]['wpercent'])) {&nbsp;</div></li><li><div>                          $newmaw = $checkmaxwidth * $table['wc'][$i]['wpercent'] / 100;&nbsp;</div></li><li><div>                          if ($table['wc'][$i]['maw'] &lt; $newmaw) {&nbsp;</div></li><li><div>                              $table['wc'][$i]['maw'] = $newmaw;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $table['wc'][$i]['w'] = 1;&nbsp;</div></li><li><div>                      } elseif ($mawsurplusnonpc && !$table['wc'][$i]['w']) {&nbsp;</div></li><li><div>                          $table['wc'][$i]['maw'] += $mawsurplusnonpc / $mawleftcount;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($table['wc'][$i]['maw'] &lt; $table['wc'][$i]['miw']) {&nbsp;</div></li><li><div>                          $table['wc'][$i]['maw'] = $table['wc'][$i]['miw'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($checkminwidth &gt; $checkmaxwidth) {&nbsp;</div></li><li><div>                  $checkmaxwidth = $checkminwidth;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($table['wpercent']) && $table['wpercent']) {&nbsp;</div></li><li><div>          $checkminwidth *= (100 / $table['wpercent']);&nbsp;</div></li><li><div>          $checkmaxwidth *= (100 / $table['wpercent']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $checkminwidth += $tblbw;&nbsp;</div></li><li><div>      $checkmaxwidth += $tblbw;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Table['miw'] set by percent in first pass may be larger than sum of column miw</span>&nbsp;</div></li><li><div>      if ((isset($table['miw']) && $checkminwidth &gt; $table['miw']) || !isset($table['miw'])) {&nbsp;</div></li><li><div>          $table['miw'] = $checkminwidth;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ((isset($table['maw']) && $checkmaxwidth &gt; $table['maw']) || !isset($table['maw'])) {&nbsp;</div></li><li><div>          $table['maw'] = $checkmaxwidth;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $table['tl'] = $totallength;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>          $mxw = $this-&gt;tbrot_maxw;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $mxw = $this-&gt;blk[$this-&gt;blklvl]['inner_width'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($table['overflow'])) {&nbsp;</div></li><li><div>          $table['overflow'] = null;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($table['overflow'] == 'visible') {&nbsp;</div></li><li><div>          return array(0, 0);&nbsp;</div></li><li><div>      } elseif ($table['overflow'] == 'hidden' && !$this-&gt;table_rotate && !$this-&gt;ColActive && $checkminwidth &gt; $mxw) {&nbsp;</div></li><li><div>          $table['w'] = $table['miw'];&nbsp;</div></li><li><div>          return array(0, 0);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      //elseif ($table['overflow']=='wrap') { return array(0, 0); }    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($table['w']) && $table['w']) {&nbsp;</div></li><li><div>          if ($table['w'] &gt;= $checkminwidth && $table['w'] &lt;= $mxw) {&nbsp;</div></li><li><div>              $table['maw'] = $mxw = $table['w'];&nbsp;</div></li><li><div>          } elseif ($table['w'] &gt;= $checkminwidth && $table['w'] &gt; $mxw && $this-&gt;keep_table_proportions) {&nbsp;</div></li><li><div>              $checkminwidth = $table['w'];&nbsp;</div></li><li><div>          } elseif ($table['w'] &lt; $checkminwidth && $checkminwidth &lt; $mxw && $this-&gt;keep_table_proportions) {&nbsp;</div></li><li><div>              $table['maw'] = $table['w'] = $checkminwidth;&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              unset($table['w']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $ratio = $checkminwidth / $mxw;&nbsp;</div></li><li><div>      if ($checkminwidth &gt; $mxw) {&nbsp;</div></li><li><div>          return array(($ratio + 0.001), $checkminwidth);&nbsp;</div></li><li><div>      } <span class="comment">// 0.001 to allow for rounded numbers when resizing</span>&nbsp;</div></li><li><div>      unset($cs);&nbsp;</div></li><li><div>      return array(0, 0);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _tableWidth(&$table)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $widthcols = &$table['wc'];&nbsp;</div></li><li><div>      $numcols = $table['nc'];&nbsp;</div></li><li><div>      $tablewidth = 0;&nbsp;</div></li><li><div>      if ($table['borders_separate']) {&nbsp;</div></li><li><div>          $tblbw = $table['border_details']['L']['w'] + $table['border_details']['R']['w'] + $table['margin']['L'] + $table['margin']['R'] + $table['padding']['L'] + $table['padding']['R'] + $table['border_spacing_H'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tblbw = $table['max_cell_border_width']['L'] / 2 + $table['max_cell_border_width']['R'] / 2 + $table['margin']['L'] + $table['margin']['R'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($table['level'] &gt; 1 && isset($table['w'])) {&nbsp;</div></li><li><div>          if (isset($table['wpercent']) && $table['wpercent']) {&nbsp;</div></li><li><div>              $table['w'] = $temppgwidth = (($table['w'] - $tblbw) * $table['wpercent'] / 100) + $tblbw;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $temppgwidth = $table['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>          $temppgwidth = $this-&gt;tbrot_maxw;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// If it is less than 1/20th of the remaining page height to finish the DIV (i.e. DIV padding + table bottom margin)</span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// then allow for this</span></span>&nbsp;</div></li><li><div>          $enddiv = $this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['border_bottom']['w'];&nbsp;</div></li><li><div>          if ($enddiv / $temppgwidth &lt; 0.05) {&nbsp;</div></li><li><div>              $temppgwidth -= $enddiv;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if (isset($table['w']) && $table['w'] &lt; $this-&gt;blk[$this-&gt;blklvl]['inner_width']) {&nbsp;</div></li><li><div>              $notfullwidth = 1;&nbsp;</div></li><li><div>              $temppgwidth = $table['w'];&nbsp;</div></li><li><div>          } elseif ($table['overflow'] == 'visible' && $table['level'] == 1) {&nbsp;</div></li><li><div>              $temppgwidth = null;&nbsp;</div></li><li><div>          } elseif ($table['overflow'] == 'hidden' && !$this-&gt;ColActive && isset($table['w']) && $table['w'] &gt; $this-&gt;blk[$this-&gt;blklvl]['inner_width'] && $table['w'] == $table['miw']) {&nbsp;</div></li><li><div>              <span class="comment">//$temppgwidth = $this-&gt;blk[$this-&gt;blklvl]['inner_width'];</span>&nbsp;</div></li><li><div>              $temppgwidth = $table['w'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $temppgwidth = $this-&gt;blk[$this-&gt;blklvl]['inner_width'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $totaltextlength = 0; <span class="comment">// Added - to sum $table['l'][colno]</span>&nbsp;</div></li><li><div>      $totalatextlength = 0; <span class="comment">// Added - to sum $table['l'][colno]</span> for those columns where width not set&nbsp;</div></li><li><div>      $percentages_set = 0;&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $numcols; $i++) {&nbsp;</div></li><li><div>          if (isset($widthcols[$i]['wpercent'])) {&nbsp;</div></li><li><div>              $tablewidth += $widthcols[$i]['maw'];&nbsp;</div></li><li><div>              $percentages_set = 1;&nbsp;</div></li><li><div>          } elseif (isset($widthcols[$i]['w'])) {&nbsp;</div></li><li><div>              $tablewidth += $widthcols[$i]['miw'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $tablewidth += $widthcols[$i]['maw'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $totaltextlength += $table['l'][$i];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$totaltextlength) {&nbsp;</div></li><li><div>          $totaltextlength = 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $tablewidth += $tblbw; <span class="comment">// Outer half of table borders</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($tablewidth &gt; $temppgwidth) {&nbsp;</div></li><li><div>          $table['w'] = $temppgwidth;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// if any widths set as percentages and max width fits &lt; page width</span>&nbsp;</div></li><li><div>      elseif ($tablewidth &lt; $temppgwidth && !isset($table['w']) && $percentages_set) {&nbsp;</div></li><li><div>          $table['w'] = $table['maw'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// if table width is set and is &gt; allowed width</span>&nbsp;</div></li><li><div>      if (isset($table['w']) && $table['w'] &gt; $temppgwidth) {&nbsp;</div></li><li><div>          $table['w'] = $temppgwidth;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// IF the table width is now set - Need to distribute columns widths</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>      <span class="comment">// If the table width is already set to the maximum width (e.g. nested table), then use maximum column widths exactly</span>&nbsp;</div></li><li><div>      if (isset($table['w']) && ($table['w'] == $tablewidth) && !$percentages_set) {&nbsp;</div></li><li><div>          <span class="comment">// This sets the columns all to maximum width</span>&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $numcols; $i++) {&nbsp;</div></li><li><div>              $widthcols[$i] = $widthcols[$i]['maw'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// elseif the table width is set distribute width using algorithm</span>&nbsp;</div></li><li><div>      elseif (isset($table['w'])) {&nbsp;</div></li><li><div>          $wis = $wisa = 0;&nbsp;</div></li><li><div>          $list = array();&nbsp;</div></li><li><div>          $notsetlist = array();&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $numcols; $i++) {&nbsp;</div></li><li><div>              $wis += $widthcols[$i]['miw'];&nbsp;</div></li><li><div>              if (!isset($widthcols[$i]['w']) || ($widthcols[$i]['w'] && $table['w'] &gt; $temppgwidth && !$this-&gt;keep_table_proportions && !$notfullwidth )) {&nbsp;</div></li><li><div>                  $list[] = $i;&nbsp;</div></li><li><div>                  $wisa += $widthcols[$i]['miw'];&nbsp;</div></li><li><div>                  $totalatextlength += $table['l'][$i];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$totalatextlength) {&nbsp;</div></li><li><div>              $totalatextlength = 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Allocate spare (more than col's minimum width) across the cols according to their approx total text length</span>&nbsp;</div></li><li><div>          <span class="comment">// Do it by setting minimum width here</span>&nbsp;</div></li><li><div>          if ($table['w'] &gt; $wis + $tblbw) {&nbsp;</div></li><li><div>              <span class="comment">// First set any cell widths set as percentages</span>&nbsp;</div></li><li><div>              if ($table['w'] &lt; $temppgwidth || $this-&gt;keep_table_proportions) {&nbsp;</div></li><li><div>                  for ($k = 0; $k &lt; $numcols; $k++) {&nbsp;</div></li><li><div>                      if (isset($widthcols[$k]['wpercent'])) {&nbsp;</div></li><li><div>                          $curr = $widthcols[$k]['miw'];&nbsp;</div></li><li><div>                          $widthcols[$k]['miw'] = ($table['w'] - $tblbw) * $widthcols[$k]['wpercent'] / 100;&nbsp;</div></li><li><div>                          $wis += $widthcols[$k]['miw'] - $curr;&nbsp;</div></li><li><div>                          $wisa += $widthcols[$k]['miw'] - $curr;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// Now allocate surplus up to maximum width of each column</span>&nbsp;</div></li><li><div>              $surplus = 0;&nbsp;</div></li><li><div>              $ttl = 0; <span class="comment">// number of surplus columns</span>&nbsp;</div></li><li><div>              if (!count($list)) {&nbsp;</div></li><li><div>                  $wi = ($table['w'] - ($wis + $tblbw)); <span class="comment"><span class="comment">//    i.e. extra space to distribute</span></span>&nbsp;</div></li><li><div>                  for ($k = 0; $k &lt; $numcols; $k++) {&nbsp;</div></li><li><div>                      $spareratio = ($table['l'][$k] / $totaltextlength); <span class="comment"><span class="comment">//  gives ratio to divide up free space</span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Don't allocate more than Maximum required width - save rest in surplus</span></span>&nbsp;</div></li><li><div>                      if ($widthcols[$k]['miw'] + ($wi * $spareratio) &gt;= $widthcols[$k]['maw']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>                          $surplus += ($wi * $spareratio) - ($widthcols[$k]['maw'] - $widthcols[$k]['miw']);&nbsp;</div></li><li><div>                          $widthcols[$k]['miw'] = $widthcols[$k]['maw'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $notsetlist[] = $k;&nbsp;</div></li><li><div>                          $ttl += $table['l'][$k];&nbsp;</div></li><li><div>                          $widthcols[$k]['miw'] += ($wi * $spareratio);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $wi = ($table['w'] - ($wis + $tblbw)); <span class="comment"><span class="comment">//    i.e. extra space to distribute</span></span>&nbsp;</div></li><li><div>                  foreach ($list as $k) {&nbsp;</div></li><li><div>                      $spareratio = ($table['l'][$k] / $totalatextlength); <span class="comment"><span class="comment">//  gives ratio to divide up free space</span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Don't allocate more than Maximum required width - save rest in surplus</span></span>&nbsp;</div></li><li><div>                      if ($widthcols[$k]['miw'] + ($wi * $spareratio) &gt;= $widthcols[$k]['maw']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>                          $surplus += ($wi * $spareratio) - ($widthcols[$k]['maw'] - $widthcols[$k]['miw']);&nbsp;</div></li><li><div>                          $widthcols[$k]['miw'] = $widthcols[$k]['maw'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $notsetlist[] = $k;&nbsp;</div></li><li><div>                          $ttl += $table['l'][$k];&nbsp;</div></li><li><div>                          $widthcols[$k]['miw'] += ($wi * $spareratio);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// If surplus still left over apportion it across columns</span>&nbsp;</div></li><li><div>              if ($surplus) {&nbsp;</div></li><li><div>                  <span class="comment">// if some are set only add to remaining - otherwise add to all of them</span>&nbsp;</div></li><li><div>                  if (count($notsetlist) && count($notsetlist) &lt; $numcols) {&nbsp;</div></li><li><div>                      foreach ($notsetlist AS $i) {&nbsp;</div></li><li><div>                          if ($ttl)&nbsp;</div></li><li><div>                              $widthcols[$i]['miw'] += $surplus * $table['l'][$i] / $ttl;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment">// If some widths are defined, and others have been added up to their maxmum</span>&nbsp;</div></li><li><div>                  elseif (count($list) && count($list) &lt; $numcols) {&nbsp;</div></li><li><div>                      foreach ($list AS $i) {&nbsp;</div></li><li><div>                          $widthcols[$i]['miw'] += $surplus / count($list);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ($numcols) { <span class="comment">// If all columns</span>&nbsp;</div></li><li><div>                      $ttl = array_sum($table['l']);&nbsp;</div></li><li><div>                      for ($i = 0; $i &lt; $numcols; $i++) {&nbsp;</div></li><li><div>                          $widthcols[$i]['miw'] += $surplus * $table['l'][$i] / $ttl;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// This sets the columns all to minimum width (which has been increased above if appropriate)</span>&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $numcols; $i++) {&nbsp;</div></li><li><div>              $widthcols[$i] = $widthcols[$i]['miw'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// TABLE</span></span> NOT WIDE ENOUGH EVEN FOR MINIMUM CONTENT WIDTH&nbsp;</div></li><li><div>          <span class="comment">// If sum of column widths set are too wide for table</span>&nbsp;</div></li><li><div>          $checktablewidth = 0;&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $numcols; $i++) {&nbsp;</div></li><li><div>              $checktablewidth += $widthcols[$i];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($checktablewidth &gt; ($temppgwidth + 0.001 - $tblbw)) {&nbsp;</div></li><li><div>              $usedup = 0;&nbsp;</div></li><li><div>              $numleft = 0;&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; $numcols; $i++) {&nbsp;</div></li><li><div>                  if ((isset($widthcols[$i]) && $widthcols[$i] &gt; (($temppgwidth - $tblbw) / $numcols)) && (!isset($widthcols[$i]['w']))) {&nbsp;</div></li><li><div>                      $numleft++;&nbsp;</div></li><li><div>                      unset($widthcols[$i]);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $usedup += $widthcols[$i];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; $numcols; $i++) {&nbsp;</div></li><li><div>                  if (!isset($widthcols[$i]) || !$widthcols[$i]) {&nbsp;</div></li><li><div>                      $widthcols[$i] = ((($temppgwidth - $tblbw) - $usedup) / ($numleft));&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else { <span class="comment">//table has no width defined</span>&nbsp;</div></li><li><div>          $table['w'] = $tablewidth;&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $numcols; $i++) {&nbsp;</div></li><li><div>              if (isset($widthcols[$i]['wpercent']) && $this-&gt;keep_table_proportions) {&nbsp;</div></li><li><div>                  $colwidth = $widthcols[$i]['maw'];&nbsp;</div></li><li><div>              } elseif (isset($widthcols[$i]['w'])) {&nbsp;</div></li><li><div>                  $colwidth = $widthcols[$i]['miw'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $colwidth = $widthcols[$i]['maw'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              unset($widthcols[$i]);&nbsp;</div></li><li><div>              $widthcols[$i] = $colwidth;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($table['overflow'] == 'visible' && $table['level'] == 1) {&nbsp;</div></li><li><div>          if ($tablewidth &gt; $this-&gt;blk[$this-&gt;blklvl]['inner_width']) {&nbsp;</div></li><li><div>              for ($j = 0; $j &lt; $numcols; $j++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  for ($i = 0; $i &lt; $table['nr']; $i++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//rows</span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($table['cells'][$i][$j]) && $table['cells'][$i][$j]) {&nbsp;</div></li><li><div>                          $colspan = (isset($table['cells'][$i][$j]['colspan']) ? $table['cells'][$i][$j]['colspan'] : 1);&nbsp;</div></li><li><div>                          if ($colspan &gt; 1) {&nbsp;</div></li><li><div>                              $w = 0;&nbsp;</div></li><li><div>                              for ($c = $j; $c &lt; ($j + $colspan); $c++) {&nbsp;</div></li><li><div>                                  $w += $widthcols[$c];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($w &gt; $this-&gt;blk[$this-&gt;blklvl]['inner_width']) {&nbsp;</div></li><li><div>                                  $diff = $w - ($this-&gt;blk[$this-&gt;blklvl]['inner_width'] - $tblbw);&nbsp;</div></li><li><div>                                  for ($c = $j; $c &lt; ($j + $colspan); $c++) {&nbsp;</div></li><li><div>                                      $widthcols[$c] -= $diff * ($widthcols[$c] / $w);&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $table['w'] -= $diff;&nbsp;</div></li><li><div>                                  $table['csp'][$j] = $w - $diff;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $pgNo = 0;&nbsp;</div></li><li><div>          $currWc = 0;&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $numcols; $i++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($table['csp'][$i])) {&nbsp;</div></li><li><div>                  $w = $table['csp'][$i];&nbsp;</div></li><li><div>                  unset($table['csp'][$i]);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $w = $widthcols[$i];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (($currWc + $w + $tblbw) &gt; $this-&gt;blk[$this-&gt;blklvl]['inner_width']) {&nbsp;</div></li><li><div>                  $pgNo++;&nbsp;</div></li><li><div>                  $currWc = $widthcols[$i];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $currWc += $widthcols[$i];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $table['colPg'][$i] = $pgNo;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _tableHeight(&$table)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $level = $table['level'];&nbsp;</div></li><li><div>      $levelid = $table['levelid'];&nbsp;</div></li><li><div>      $cells = &$table['cells'];&nbsp;</div></li><li><div>      $numcols = $table['nc'];&nbsp;</div></li><li><div>      $numrows = $table['nr'];&nbsp;</div></li><li><div>      $listspan = array();&nbsp;</div></li><li><div>      $checkmaxheight = 0;&nbsp;</div></li><li><div>      $headerrowheight = 0;&nbsp;</div></li><li><div>      $checkmaxheightplus = 0;&nbsp;</div></li><li><div>      $headerrowheightplus = 0;&nbsp;</div></li><li><div>      $firstrowheight = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $footerrowheight = 0;&nbsp;</div></li><li><div>      $footerrowheightplus = 0;&nbsp;</div></li><li><div>      if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>          $temppgheight = $this-&gt;tbrot_maxh;&nbsp;</div></li><li><div>          $remainingpage = $this-&gt;tbrot_maxh;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $temppgheight = ($this-&gt;h - $this-&gt;bMargin - $this-&gt;tMargin) - $this-&gt;kwt_height;&nbsp;</div></li><li><div>          $remainingpage = ($this-&gt;h - $this-&gt;bMargin - $this-&gt;y) - $this-&gt;kwt_height;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// If it is less than 1/20th of the remaining page height to finish the DIV (i.e. DIV padding + table bottom margin)</span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// then allow for this</span></span>&nbsp;</div></li><li><div>          $enddiv = $this-&gt;blk[$this-&gt;blklvl]['padding_bottom'] + $this-&gt;blk[$this-&gt;blklvl]['border_bottom']['w'] + $table['margin']['B'];&nbsp;</div></li><li><div>          if ($remainingpage &gt; $enddiv && $enddiv / $remainingpage &lt; 0.05) {&nbsp;</div></li><li><div>              $remainingpage -= $enddiv;&nbsp;</div></li><li><div>          } elseif ($remainingpage == 0) {&nbsp;</div></li><li><div>              $remainingpage = 0.001;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($temppgheight &gt; $enddiv && $enddiv / $temppgheight &lt; 0.05) {&nbsp;</div></li><li><div>              $temppgheight -= $enddiv;&nbsp;</div></li><li><div>          } elseif ($temppgheight == 0) {&nbsp;</div></li><li><div>              $temppgheight = 0.001;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($remainingpage &lt; 0) {&nbsp;</div></li><li><div>          $remainingpage = 0.001;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($temppgheight &lt; 0) {&nbsp;</div></li><li><div>          $temppgheight = 0.001;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $numrows; $i++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//rows</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $heightrow = &$table['hr'][$i];&nbsp;</div></li><li><div>          for ($j = 0; $j &lt; $numcols; $j++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($cells[$i][$j]) && $cells[$i][$j]) {&nbsp;</div></li><li><div>                  $c = &$cells[$i][$j];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                      if ($table['borders_separate']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// NB twice border width</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $extraWLR = ($table['simple']['border_details']['L']['w'] + $table['simple']['border_details']['R']['w']) + ($c['padding']['L'] + $c['padding']['R']) + $table['border_spacing_H'];&nbsp;</div></li><li><div>                          $extrh = ($table['simple']['border_details']['T']['w'] + $table['simple']['border_details']['B']['w']) + ($c['padding']['T'] + $c['padding']['B']) + $table['border_spacing_V'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $extraWLR = ($table['simple']['border_details']['L']['w'] + $table['simple']['border_details']['R']['w']) / 2 + ($c['padding']['L'] + $c['padding']['R']);&nbsp;</div></li><li><div>                          $extrh = ($table['simple']['border_details']['T']['w'] + $table['simple']['border_details']['B']['w']) / 2 + ($c['padding']['T'] + $c['padding']['B']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                          list($bt, $br, $bb, $bl) = $this-&gt;_getBorderWidths($c['borderbin']);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $bt = $c['border_details']['T']['w'];&nbsp;</div></li><li><div>                          $bb = $c['border_details']['B']['w'];&nbsp;</div></li><li><div>                          $br = $c['border_details']['R']['w'];&nbsp;</div></li><li><div>                          $bl = $c['border_details']['L']['w'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($table['borders_separate']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// NB twice border width</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $extraWLR = $bl + $br + $c['padding']['L'] + $c['padding']['R'] + $table['border_spacing_H'];&nbsp;</div></li><li><div>                          $extrh = $bt + $bb + $c['padding']['T'] + $c['padding']['B'] + $table['border_spacing_V'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $extraWLR = $bl / 2 + $br / 2 + $c['padding']['L'] + $c['padding']['R'];&nbsp;</div></li><li><div>                          $extrh = $bt / 2 + $bb / 2 + $c['padding']['T'] + $c['padding']['B'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($table['overflow'] == 'visible' && $level == 1)&nbsp;</div></li><li><div>                      list($x, $cw) = $this-&gt;_splitTableGetWidth($table, $i, $j);&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                      list($x, $cw) = $this-&gt;_tableGetWidth($table, $i, $j);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Get CELL HEIGHT</span>&nbsp;</div></li><li><div>                  <span class="comment">// ++ extra parameter forces wrap to break word</span>&nbsp;</div></li><li><div>                  if ($c['R'] && isset($c['textbuffer'])) {&nbsp;</div></li><li><div>                      $str = '';&nbsp;</div></li><li><div>                      foreach ($c['textbuffer'] AS $t) {&nbsp;</div></li><li><div>                          $str .= $t[0] . ' ';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $str = rtrim($str);&nbsp;</div></li><li><div>                      $s_fs = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>                      $s_f = $this-&gt;FontFamily;&nbsp;</div></li><li><div>                      $s_st = $this-&gt;FontStyle;&nbsp;</div></li><li><div>                      $this-&gt;SetFont($c['textbuffer'][0][4], $c['textbuffer'][0][2], $c['textbuffer'][0][11] / $this-&gt;shrin_k, true, true);&nbsp;</div></li><li><div>                      $tempch = $this-&gt;GetStringWidth($str, true, $c['textbuffer'][0][18], $c['textbuffer'][0][8]);&nbsp;</div></li><li><div>                      if ($c['R'] &gt;= 45 && $c['R'] &lt; 90) {&nbsp;</div></li><li><div>                          $tempch = ((sin(deg2rad($c['R']))) * $tempch ) + ((sin(deg2rad($c['R']))) * (($c['textbuffer'][0][11] / _MPDFK) / $this-&gt;shrin_k));&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;SetFont($s_f, $s_st, $s_fs, true, true);&nbsp;</div></li><li><div>                      $ch = ($tempch ) + $extrh;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if (isset($c['textbuffer']) && !empty($c['textbuffer'])) {&nbsp;</div></li><li><div>                          $this-&gt;cellLineHeight = $c['cellLineHeight'];&nbsp;</div></li><li><div>                          $this-&gt;cellLineStackingStrategy = $c['cellLineStackingStrategy'];&nbsp;</div></li><li><div>                          $this-&gt;cellLineStackingShift = $c['cellLineStackingShift'];&nbsp;</div></li><li><div>                          $this-&gt;divwidth = $cw - $extraWLR;&nbsp;</div></li><li><div>                          $tempch = $this-&gt;printbuffer($c['textbuffer'], '', true, true);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $tempch = 0;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Added cellpadding top and bottom. (Lineheight already adjusted)</span>&nbsp;</div></li><li><div>                      $ch = $tempch + $extrh;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment">//If height is defined and it is bigger than calculated $ch then update values</span>&nbsp;</div></li><li><div>                  if (isset($c['h']) && $c['h'] &gt; $ch) {&nbsp;</div></li><li><div>                      $c['mih'] = $ch; <span class="comment">//in order to keep valign working</span>&nbsp;</div></li><li><div>                      $ch = $c['h'];&nbsp;</div></li><li><div>                  } else&nbsp;</div></li><li><div>                      $c['mih'] = $ch;&nbsp;</div></li><li><div>                  if (isset($c['rowspan']))&nbsp;</div></li><li><div>                      $listspan[] = array($i, $j);&nbsp;</div></li><li><div>                  elseif ($heightrow &lt; $ch)&nbsp;</div></li><li><div>                      $heightrow = $ch;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// this is the extra used in _tableWrite to determine whether to trigger a page change</span>&nbsp;</div></li><li><div>                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                      if ($i == ($numrows - 1) || (isset($c['rowspan']) && ($i + $c['rowspan']) == ($numrows))) {&nbsp;</div></li><li><div>                          $extra = $table['margin']['B'] + $table['padding']['B'] + $table['border_details']['B']['w'] + $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $extra = $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                          $extra = $bb / 2;&nbsp;</div></li><li><div>                      } elseif ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                          $extra = $table['simple']['border_details']['B']['w'] / 2;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($table['is_thead'][$i]) && $table['is_thead'][$i]) {&nbsp;</div></li><li><div>                      if ($j == 0) {&nbsp;</div></li><li><div>                          $headerrowheight += $ch;&nbsp;</div></li><li><div>                          $headerrowheightplus += $ch + $extra;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif (isset($table['is_tfoot'][$i]) && $table['is_tfoot'][$i]) {&nbsp;</div></li><li><div>                      if ($j == 0) {&nbsp;</div></li><li><div>                          $footerrowheight += $ch;&nbsp;</div></li><li><div>                          $footerrowheightplus += $ch + $extra;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $checkmaxheight = max($checkmaxheight, $ch);&nbsp;</div></li><li><div>                      $checkmaxheightplus = max($checkmaxheightplus, $ch + $extra);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;tableLevel == 1 && $i == (isset($table['headernrows']) ? $table['headernrows'] : 0)) {&nbsp;</div></li><li><div>                      $firstrowheight = max($ch, $firstrowheight);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  unset($c);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }<span class="comment">//end of columns</span>&nbsp;</div></li><li><div>      }<span class="comment">//end of rows</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $heightrow = &$table['hr'];&nbsp;</div></li><li><div>      foreach ($listspan as $span) {&nbsp;</div></li><li><div>          list($i, $j) = $span;&nbsp;</div></li><li><div>          $c = &$cells[$i][$j];&nbsp;</div></li><li><div>          $lr = $i + $c['rowspan'];&nbsp;</div></li><li><div>          if ($lr &gt; $numrows)&nbsp;</div></li><li><div>              $lr = $numrows;&nbsp;</div></li><li><div>          $hs = $hsa = 0;&nbsp;</div></li><li><div>          $list = array();&nbsp;</div></li><li><div>          for ($k = $i; $k &lt; $lr; $k++) {&nbsp;</div></li><li><div>              $hs += $heightrow[$k];&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $sh = false; <span class="comment">// specified height</span>&nbsp;</div></li><li><div>              for ($m = 0; $m &lt; $numcols; $m++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  $tc = &$cells[$k][$m];&nbsp;</div></li><li><div>                  if (isset($tc['rowspan'])) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($tc['h'])) {&nbsp;</div></li><li><div>                      $sh = true;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!$sh) {&nbsp;</div></li><li><div>                  $list[] = $k;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($table['borders_separate']) {&nbsp;</div></li><li><div>              if ($i == ($numrows - 1) || ($i + $c['rowspan']) == ($numrows)) {&nbsp;</div></li><li><div>                  $extra = $table['margin']['B'] + $table['padding']['B'] + $table['border_details']['B']['w'] + $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $extra = $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                  if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                      list($bt, $br, $bb, $bl) = $this-&gt;_getBorderWidths($c['borderbin']);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $bb = $c['border_details']['B']['w'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $extra = $bb / 2;&nbsp;</div></li><li><div>              } elseif ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                  $extra = $table['simple']['border_details']['B']['w'] / 2;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!empty($table['is_thead'][$i])) {&nbsp;</div></li><li><div>              $headerrowheight = max($headerrowheight, $hs);&nbsp;</div></li><li><div>              $headerrowheightplus = max($headerrowheightplus, $hs + $extra);&nbsp;</div></li><li><div>          } elseif (!empty($table['is_tfoot'][$i])) {&nbsp;</div></li><li><div>              $footerrowheight = max($footerrowheight, $hs);&nbsp;</div></li><li><div>              $footerrowheightplus = max($footerrowheightplus, $hs + $extra);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $checkmaxheight = max($checkmaxheight, $hs);&nbsp;</div></li><li><div>              $checkmaxheightplus = max($checkmaxheightplus, $hs + $extra);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;tableLevel == 1 && $i == (isset($table['headernrows']) ? $table['headernrows'] : 0)) {&nbsp;</div></li><li><div>              $firstrowheight = max($hs, $firstrowheight);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($c['mih'] &gt; $hs) {&nbsp;</div></li><li><div>              if (!$hs) {&nbsp;</div></li><li><div>                  for ($k = $i; $k &lt; $lr; $k++)&nbsp;</div></li><li><div>                      $heightrow[$k] = $c['mih'] / $c['rowspan'];&nbsp;</div></li><li><div>              } elseif (!count($list)) { <span class="comment">// no rows in the rowspan have a height specified, so share amongst all rows equally</span>&nbsp;</div></li><li><div>                  $hi = $c['mih'] - $hs;&nbsp;</div></li><li><div>                  for ($k = $i; $k &lt; $lr; $k++)&nbsp;</div></li><li><div>                      $heightrow[$k] += ($heightrow[$k] / $hs) * $hi;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $hi = $c['mih'] - $hs; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  foreach ($list as $k)&nbsp;</div></li><li><div>                      $heightrow[$k] += $hi / (count($list)); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset($c);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If rowspans overlap so that one or more rows do not have a height set...</span>&nbsp;</div></li><li><div>          <span class="comment">// i.e. for one or more rows, the only cells (explicit) in that row have rowspan&gt;1</span>&nbsp;</div></li><li><div>          <span class="comment">// so heightrow is still == 0</span>&nbsp;</div></li><li><div>          if ($heightrow[$i] == 0) {&nbsp;</div></li><li><div>              <span class="comment">// Get row extent to analyse above and below</span>&nbsp;</div></li><li><div>              $top = $i;&nbsp;</div></li><li><div>              foreach ($listspan as $checkspan) {&nbsp;</div></li><li><div>                  list($cki, $ckj) = $checkspan;&nbsp;</div></li><li><div>                  $c = &$cells[$cki][$ckj];&nbsp;</div></li><li><div>                  if (isset($c['rowspan']) && $c['rowspan'] &gt; 1) {&nbsp;</div></li><li><div>                      if (($cki + $c['rowspan'] - 1) &gt;= $i) {&nbsp;</div></li><li><div>                          $top = min($top, $cki);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $bottom = $i + $c['rowspan'] - 1;&nbsp;</div></li><li><div>              <span class="comment">// Check for overconstrained conditions</span>&nbsp;</div></li><li><div>              for ($k = $top; $k &lt;= $bottom; $k++) {&nbsp;</div></li><li><div>                  <span class="comment">// if ['hr'] for any of the others is also 0, then abort (too complicated)</span>&nbsp;</div></li><li><div>                  if ($k != $i && $heightrow[$k] == 0) {&nbsp;</div></li><li><div>                      break(1);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment">// check again that top and bottom are not crossed by rowspans - or abort (too complicated)</span>&nbsp;</div></li><li><div>                  if ($k == $top) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// ???</span></span>? take account of colspan as well???&nbsp;</div></li><li><div>                      for ($m = 0; $m &lt; $numcols; $m++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          if (!isset($cells[$k][$m]) || $cells[$k][$m] == 0) {&nbsp;</div></li><li><div>                              break(2);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ($k == $bottom) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// ???</span></span>? take account of colspan as well???&nbsp;</div></li><li><div>                      for ($m = 0; $m &lt; $numcols; $m++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $c = &$cells[$k][$m];&nbsp;</div></li><li><div>                          if (isset($c['rowspan']) && $c['rowspan'] &gt; 1) {&nbsp;</div></li><li><div>                              break(2);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// By columns add up col height using ['h'] if set or ['mih'] if not</span>&nbsp;</div></li><li><div>              <span class="comment">// Intentionally do not substract border-spacing</span>&nbsp;</div></li><li><div>              $colH = array();&nbsp;</div></li><li><div>              $extH = 0;&nbsp;</div></li><li><div>              $newhr = array();&nbsp;</div></li><li><div>              for ($m = 0; $m &lt; $numcols; $m++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">//columns</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  for ($k = $top; $k &lt;= $bottom; $k++) {&nbsp;</div></li><li><div>                      if (isset($cells[$k][$m]) && $cells[$k][$m] != 0) {&nbsp;</div></li><li><div>                          $c = &$cells[$k][$m];&nbsp;</div></li><li><div>                          if (isset($c['h']) && $c['h']) {&nbsp;</div></li><li><div>                              $useh = $c['h'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// ???</span></span>? take account of colspan as well???&nbsp;</div></li><li><div>                          else {&nbsp;</div></li><li><div>                              $useh = $c['mih'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if (isset($colH[$m])) {&nbsp;</div></li><li><div>                              $colH[$m] += $useh;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $colH[$m] = $useh;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if (!isset($c['rowspan']) || $c['rowspan'] &lt; 2) {&nbsp;</div></li><li><div>                              $newhr[$k] = max((isset($newhr[$k]) ? $newhr[$k] : 0), $useh);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $extH = max($extH, $colH[$m]); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $newhr[$i] = $extH - array_sum($newhr);&nbsp;</div></li><li><div>              for ($k = $top; $k &lt;= $bottom; $k++) {&nbsp;</div></li><li><div>                  $heightrow[$k] = $newhr[$k];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          unset($c);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $table['h'] = array_sum($heightrow);&nbsp;</div></li><li><div>      unset($heightrow);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($table['borders_separate']) {&nbsp;</div></li><li><div>          $table['h'] += $table['margin']['T'] + $table['margin']['B'] + $table['border_details']['T']['w'] + $table['border_details']['B']['w'] + $table['border_spacing_V'] + $table['padding']['T'] + $table['padding']['B'];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $table['h'] += $table['margin']['T'] + $table['margin']['B'] + $table['max_cell_border_width']['T'] / 2 + $table['max_cell_border_width']['B'] / 2;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $maxrowheight = $checkmaxheightplus + $headerrowheightplus + $footerrowheightplus;&nbsp;</div></li><li><div>      $maxfirstrowheight = $firstrowheight + $headerrowheightplus + $footerrowheightplus; <span class="comment">// includes thead, 1st row and tfoot</span>&nbsp;</div></li><li><div>      return array($table['h'], $maxrowheight, $temppgheight, $remainingpage, $maxfirstrowheight);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _tableGetWidth(&$table, $i, $j)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $cell = &$table['cells'][$i][$j];&nbsp;</div></li><li><div>      if ($cell) {&nbsp;</div></li><li><div>          if (isset($cell['x0'])) {&nbsp;</div></li><li><div>              return array($cell['x0'], $cell['w0']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $x = 0;&nbsp;</div></li><li><div>          $widthcols = &$table['wc'];&nbsp;</div></li><li><div>          for ($k = 0; $k &lt; $j; $k++)&nbsp;</div></li><li><div>              $x += $widthcols[$k];&nbsp;</div></li><li><div>          $w = $widthcols[$j];&nbsp;</div></li><li><div>          if (isset($cell['colspan'])) {&nbsp;</div></li><li><div>              for ($k = $j + $cell['colspan'] - 1; $k &gt; $j; $k--)&nbsp;</div></li><li><div>                  $w += $widthcols[$k];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $cell['x0'] = $x;&nbsp;</div></li><li><div>          $cell['w0'] = $w;&nbsp;</div></li><li><div>          return array($x, $w);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array(0, 0);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _splitTableGetWidth(&$table, $i, $j)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $cell = &$table['cells'][$i][$j];&nbsp;</div></li><li><div>      if ($cell) {&nbsp;</div></li><li><div>          if (isset($cell['x0']))&nbsp;</div></li><li><div>              return array($cell['x0'], $cell['w0']);&nbsp;</div></li><li><div>          $x = 0;&nbsp;</div></li><li><div>          $widthcols = &$table['wc'];&nbsp;</div></li><li><div>          $pg = $table['colPg'][$j];&nbsp;</div></li><li><div>          for ($k = 0; $k &lt; $j; $k++) {&nbsp;</div></li><li><div>              if ($table['colPg'][$k] == $pg)&nbsp;</div></li><li><div>                  $x += $widthcols[$k];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $w = $widthcols[$j];&nbsp;</div></li><li><div>          if (isset($cell['colspan'])) {&nbsp;</div></li><li><div>              for ($k = $j + $cell['colspan'] - 1; $k &gt; $j; $k--)&nbsp;</div></li><li><div>                  if ($table['colPg'][$k] == $pg)&nbsp;</div></li><li><div>                      $w += $widthcols[$k];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $cell['x0'] = $x;&nbsp;</div></li><li><div>          $cell['w0'] = $w;&nbsp;</div></li><li><div>          return array($x, $w);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array(0, 0);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _tableGetHeight(&$table, $i, $j)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $cell = &$table['cells'][$i][$j];&nbsp;</div></li><li><div>      if ($cell) {&nbsp;</div></li><li><div>          if (isset($cell['y0']))&nbsp;</div></li><li><div>              return array($cell['y0'], $cell['h0']);&nbsp;</div></li><li><div>          $y = 0;&nbsp;</div></li><li><div>          $heightrow = &$table['hr'];&nbsp;</div></li><li><div>          for ($k = 0; $k &lt; $i; $k++)&nbsp;</div></li><li><div>              $y += $heightrow[$k];&nbsp;</div></li><li><div>          $h = $heightrow[$i];&nbsp;</div></li><li><div>          if (isset($cell['rowspan'])) {&nbsp;</div></li><li><div>              for ($k = $i + $cell['rowspan'] - 1; $k &gt; $i; $k--)&nbsp;</div></li><li><div>                  $h += $heightrow[$k];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $cell['y0'] = $y;&nbsp;</div></li><li><div>          $cell['h0'] = $h;&nbsp;</div></li><li><div>          return array($y, $h);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array(0, 0);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _tableGetMaxRowHeight($table, $row)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($row == $table['nc'] - 1) {&nbsp;</div></li><li><div>          return $table['hr'][$row];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $maxrowheight = $table['hr'][$row];&nbsp;</div></li><li><div>      for ($i = $row + 1; $i &lt; $table['nr']; $i++) {&nbsp;</div></li><li><div>          $cellsset = 0;&nbsp;</div></li><li><div>          for ($j = 0; $j &lt; $table['nc']; $j++) {&nbsp;</div></li><li><div>              if ($table['cells'][$i][$j]) {&nbsp;</div></li><li><div>                  if (isset($table['cells'][$i][$j]['colspan'])) {&nbsp;</div></li><li><div>                      $cellsset += $table['cells'][$i][$j]['colspan'];&nbsp;</div></li><li><div>                  } else&nbsp;</div></li><li><div>                      $cellsset += 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($cellsset == $table['nc']) {&nbsp;</div></li><li><div>              return $maxrowheight;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $maxrowheight += $table['hr'][$i];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $maxrowheight;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// CHANGED TO ALLOW TABLE BORDER TO BE SPECIFIED CORRECTLY - added border_details</span>&nbsp;</div></li><li><div>  function _tableRect($x, $y, $w, $h, $bord = -1, $details = array(), $buffer = false, $bSeparate = false, $cort = 'cell', $tablecorner = '', $bsv = 0, $bsh = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $cellBorderOverlay = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($bord == -1) {&nbsp;</div></li><li><div>          $this-&gt;Rect($x, $y, $w, $h);&nbsp;</div></li><li><div>      } elseif ($this-&gt;simpleTables && ($cort == 'cell')) {&nbsp;</div></li><li><div>          $this-&gt;SetLineWidth($details['L']['w']);&nbsp;</div></li><li><div>          if ($details['L']['c']) {&nbsp;</div></li><li><div>              $this-&gt;SetDColor($details['L']['c']);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>          $this-&gt;Rect($x, $y, $w, $h);&nbsp;</div></li><li><div>      } elseif ($bord) {&nbsp;</div></li><li><div>          if (!$bSeparate && $buffer) {&nbsp;</div></li><li><div>              $priority = 'LRTB';&nbsp;</div></li><li><div>              for ($p = 0; $p &lt; strlen($priority); $p++) {&nbsp;</div></li><li><div>                  $side = $priority[$p];&nbsp;</div></li><li><div>                  $details['p'] = $side;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $dom = 0;&nbsp;</div></li><li><div>                  if (isset($details[$side]['w'])) {&nbsp;</div></li><li><div>                      $dom += ($details[$side]['w'] * 100000);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($details[$side]['style'])) {&nbsp;</div></li><li><div>                      $dom += (array_search($details[$side]['style'], $this-&gt;borderstyles) * 100);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($details[$side]['dom'])) {&nbsp;</div></li><li><div>                      $dom += ($details[$side]['dom'] * 10);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Precedence to darker colours at joins</span>&nbsp;</div></li><li><div>                  $coldom = 0;&nbsp;</div></li><li><div>                  if (isset($details[$side]['c']) && is_array($details[$side]['c'])) {&nbsp;</div></li><li><div>                      if ($details[$side]['c']{0} == 3) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $coldom = 10 - (((ord($details[$side]['c']{1}) * 1.00) + (ord($details[$side]['c']{2}) * 1.00) + (ord($details[$side]['c']{3}) * 1.00)) / 76.5);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } <span class="comment">// 10 black - 0 white</span>&nbsp;</div></li><li><div>                  if ($coldom) {&nbsp;</div></li><li><div>                      $dom += $coldom;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment">// Lastly precedence to RIGHT and BOTTOM cells at joins</span>&nbsp;</div></li><li><div>                  if (isset($details['cellposdom'])) {&nbsp;</div></li><li><div>                      $dom += $details['cellposdom'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $save = false;&nbsp;</div></li><li><div>                  if ($side == 'T' && $this-&gt;issetBorder($bord, _BORDER_TOP)) {&nbsp;</div></li><li><div>                      $cbord = _BORDER_TOP;&nbsp;</div></li><li><div>                      $save = true;&nbsp;</div></li><li><div>                  } elseif ($side == 'L' && $this-&gt;issetBorder($bord, _BORDER_LEFT)) {&nbsp;</div></li><li><div>                      $cbord = _BORDER_LEFT;&nbsp;</div></li><li><div>                      $save = true;&nbsp;</div></li><li><div>                  } elseif ($side == 'R' && $this-&gt;issetBorder($bord, _BORDER_RIGHT)) {&nbsp;</div></li><li><div>                      $cbord = _BORDER_RIGHT;&nbsp;</div></li><li><div>                      $save = true;&nbsp;</div></li><li><div>                  } elseif ($side == 'B' && $this-&gt;issetBorder($bord, _BORDER_BOTTOM)) {&nbsp;</div></li><li><div>                      $cbord = _BORDER_BOTTOM;&nbsp;</div></li><li><div>                      $save = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($save) {&nbsp;</div></li><li><div>                      $this-&gt;cellBorderBuffer[] = pack(&quot;A16nCnda6A10d14&quot;, str_pad(sprintf(&quot;%08.7f&quot;, $dom), 16, &quot;0&quot;, STR_PAD_LEFT), $cbord, ord($side), $details[$side]['s'], $details[$side]['w'], $details[$side]['c'], $details[$side]['style'], $x, $y, $w, $h, $details['mbw']['BL'], $details['mbw']['BR'], $details['mbw']['RT'], $details['mbw']['RB'], $details['mbw']['TL'], $details['mbw']['TR'], $details['mbw']['LT'], $details['mbw']['LB'], $details['cellposdom'], 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      if ($details[$side]['style'] == 'ridge' || $details[$side]['style'] == 'groove' || $details[$side]['style'] == 'inset' || $details[$side]['style'] == 'outset' || $details[$side]['style'] == 'double') {&nbsp;</div></li><li><div>                          $details[$side]['overlay'] = true;&nbsp;</div></li><li><div>                          $this-&gt;cellBorderBuffer[] = pack(&quot;A16nCnda6A10d14&quot;, str_pad(sprintf(&quot;%08.7f&quot;, ($dom + 4)), 16, &quot;0&quot;, STR_PAD_LEFT), $cbord, ord($side), $details[$side]['s'], $details[$side]['w'], $details[$side]['c'], $details[$side]['style'], $x, $y, $w, $h, $details['mbw']['BL'], $details['mbw']['BR'], $details['mbw']['RT'], $details['mbw']['RB'], $details['mbw']['TL'], $details['mbw']['TR'], $details['mbw']['LT'], $details['mbw']['LB'], $details['cellposdom'], 1&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($details['p']) && strlen($details['p']) &gt; 1) {&nbsp;</div></li><li><div>              $priority = $details['p'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $priority = 'LTRB';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $Tw = 0;&nbsp;</div></li><li><div>          $Rw = 0;&nbsp;</div></li><li><div>          $Bw = 0;&nbsp;</div></li><li><div>          $Lw = 0;&nbsp;</div></li><li><div>          if (isset($details['T']['w'])) {&nbsp;</div></li><li><div>              $Tw = $details['T']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($details['R']['w'])) {&nbsp;</div></li><li><div>              $Rw = $details['R']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($details['B']['w'])) {&nbsp;</div></li><li><div>              $Bw = $details['B']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($details['L']['w'])) {&nbsp;</div></li><li><div>              $Lw = $details['L']['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $x2 = $x + $w;&nbsp;</div></li><li><div>          $y2 = $y + $h;&nbsp;</div></li><li><div>          $oldlinewidth = $this-&gt;LineWidth;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          for ($p = 0; $p &lt; strlen($priority); $p++) {&nbsp;</div></li><li><div>              $side = $priority[$p];&nbsp;</div></li><li><div>              $xadj = 0;&nbsp;</div></li><li><div>              $xadj2 = 0;&nbsp;</div></li><li><div>              $yadj = 0;&nbsp;</div></li><li><div>              $yadj2 = 0;&nbsp;</div></li><li><div>              $print = false;&nbsp;</div></li><li><div>              if ($Tw && $side == 'T' && $this-&gt;issetBorder($bord, _BORDER_TOP)) { <span class="comment">// TOP</span>&nbsp;</div></li><li><div>                  $ly1 = $y;&nbsp;</div></li><li><div>                  $ly2 = $y;&nbsp;</div></li><li><div>                  $lx1 = $x;&nbsp;</div></li><li><div>                  $lx2 = $x2;&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth($Tw);&nbsp;</div></li><li><div>                  if ($cort == 'cell' || strpos($tablecorner, 'L') !== false) {&nbsp;</div></li><li><div>                      if ($Tw &gt; $Lw)&nbsp;</div></li><li><div>                          $xadj = ($Tw - $Lw) / 2;&nbsp;</div></li><li><div>                      if ($Tw &lt; $Lw)&nbsp;</div></li><li><div>                          $xadj = ($Tw + $Lw) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $xadj = $Tw / 2 - $bsh / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($cort == 'cell' || strpos($tablecorner, 'R') !== false) {&nbsp;</div></li><li><div>                      if ($Tw &gt; $Rw)&nbsp;</div></li><li><div>                          $xadj2 = ($Tw - $Rw) / 2;&nbsp;</div></li><li><div>                      if ($Tw &lt; $Rw)&nbsp;</div></li><li><div>                          $xadj2 = ($Tw + $Rw) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $xadj2 = $Tw / 2 - $bsh / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!$bSeparate && $details['mbw']['TL']) {&nbsp;</div></li><li><div>                      $xadj = ($Tw - $details['mbw']['TL']) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!$bSeparate && $details['mbw']['TR']) {&nbsp;</div></li><li><div>                      $xadj2 = ($Tw - $details['mbw']['TR']) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $print = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($Lw && $side == 'L' && $this-&gt;issetBorder($bord, _BORDER_LEFT)) { <span class="comment">// LEFT</span>&nbsp;</div></li><li><div>                  $ly1 = $y;&nbsp;</div></li><li><div>                  $ly2 = $y2;&nbsp;</div></li><li><div>                  $lx1 = $x;&nbsp;</div></li><li><div>                  $lx2 = $x;&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth($Lw);&nbsp;</div></li><li><div>                  if ($cort == 'cell' || strpos($tablecorner, 'T') !== false) {&nbsp;</div></li><li><div>                      if ($Lw &gt; $Tw)&nbsp;</div></li><li><div>                          $yadj = ($Lw - $Tw) / 2;&nbsp;</div></li><li><div>                      if ($Lw &lt; $Tw)&nbsp;</div></li><li><div>                          $yadj = ($Lw + $Tw) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $yadj = $Lw / 2 - $bsv / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($cort == 'cell' || strpos($tablecorner, 'B') !== false) {&nbsp;</div></li><li><div>                      if ($Lw &gt; $Bw)&nbsp;</div></li><li><div>                          $yadj2 = ($Lw - $Bw) / 2;&nbsp;</div></li><li><div>                      if ($Lw &lt; $Bw)&nbsp;</div></li><li><div>                          $yadj2 = ($Lw + $Bw) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $yadj2 = $Lw / 2 - $bsv / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!$bSeparate && $details['mbw']['LT']) {&nbsp;</div></li><li><div>                      $yadj = ($Lw - $details['mbw']['LT']) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!$bSeparate && $details['mbw']['LB']) {&nbsp;</div></li><li><div>                      $yadj2 = ($Lw - $details['mbw']['LB']) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $print = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($Rw && $side == 'R' && $this-&gt;issetBorder($bord, _BORDER_RIGHT)) { <span class="comment"><span class="comment">// RIGHT</span></span>&nbsp;</div></li><li><div>                  $ly1 = $y;&nbsp;</div></li><li><div>                  $ly2 = $y2;&nbsp;</div></li><li><div>                  $lx1 = $x2;&nbsp;</div></li><li><div>                  $lx2 = $x2;&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth($Rw);&nbsp;</div></li><li><div>                  if ($cort == 'cell' || strpos($tablecorner, 'T') !== false) {&nbsp;</div></li><li><div>                      if ($Rw &lt; $Tw)&nbsp;</div></li><li><div>                          $yadj = ($Rw + $Tw) / 2;&nbsp;</div></li><li><div>                      if ($Rw &gt; $Tw)&nbsp;</div></li><li><div>                          $yadj = ($Rw - $Tw) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $yadj = $Rw / 2 - $bsv / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($cort == 'cell' || strpos($tablecorner, 'B') !== false) {&nbsp;</div></li><li><div>                      if ($Rw &gt; $Bw)&nbsp;</div></li><li><div>                          $yadj2 = ($Rw - $Bw) / 2;&nbsp;</div></li><li><div>                      if ($Rw &lt; $Bw)&nbsp;</div></li><li><div>                          $yadj2 = ($Rw + $Bw) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $yadj2 = $Rw / 2 - $bsv / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (!$bSeparate && $details['mbw']['RT']) {&nbsp;</div></li><li><div>                      $yadj = ($Rw - $details['mbw']['RT']) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!$bSeparate && $details['mbw']['RB']) {&nbsp;</div></li><li><div>                      $yadj2 = ($Rw - $details['mbw']['RB']) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $print = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($Bw && $side == 'B' && $this-&gt;issetBorder($bord, _BORDER_BOTTOM)) { <span class="comment"><span class="comment">// BOTTOM</span></span>&nbsp;</div></li><li><div>                  $ly1 = $y2;&nbsp;</div></li><li><div>                  $ly2 = $y2;&nbsp;</div></li><li><div>                  $lx1 = $x;&nbsp;</div></li><li><div>                  $lx2 = $x2;&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth($Bw);&nbsp;</div></li><li><div>                  if ($cort == 'cell' || strpos($tablecorner, 'L') !== false) {&nbsp;</div></li><li><div>                      if ($Bw &gt; $Lw)&nbsp;</div></li><li><div>                          $xadj = ($Bw - $Lw) / 2;&nbsp;</div></li><li><div>                      if ($Bw &lt; $Lw)&nbsp;</div></li><li><div>                          $xadj = ($Bw + $Lw) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $xadj = $Bw / 2 - $bsh / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($cort == 'cell' || strpos($tablecorner, 'R') !== false) {&nbsp;</div></li><li><div>                      if ($Bw &gt; $Rw)&nbsp;</div></li><li><div>                          $xadj2 = ($Bw - $Rw) / 2;&nbsp;</div></li><li><div>                      if ($Bw &lt; $Rw)&nbsp;</div></li><li><div>                          $xadj2 = ($Bw + $Rw) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $xadj2 = $Bw / 2 - $bsh / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!$bSeparate && $details['mbw']['BL']) {&nbsp;</div></li><li><div>                      $xadj = ($Bw - $details['mbw']['BL']) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!$bSeparate && $details['mbw']['BR']) {&nbsp;</div></li><li><div>                      $xadj2 = ($Bw - $details['mbw']['BR']) / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $print = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Now draw line</span>&nbsp;</div></li><li><div>              if ($print) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($details[$side]['style'] == 'double') {&nbsp;</div></li><li><div>                      if (!isset($details[$side]['overlay']) || !$details[$side]['overlay'] || $bSeparate) {&nbsp;</div></li><li><div>                          if ($details[$side]['c']) {&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($details[$side]['c']);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;Line($lx1 + $xadj, $ly1 + $yadj, $lx2 - $xadj2, $ly2 - $yadj2);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ((isset($details[$side]['overlay']) && $details[$side]['overlay']) || $bSeparate) {&nbsp;</div></li><li><div>                          if ($bSeparate && $cort == 'table') {&nbsp;</div></li><li><div>                              if ($side == 'T') {&nbsp;</div></li><li><div>                                  $xadj -= $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $xadj2 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  if ($this-&gt;issetBorder($bord, _BORDER_LEFT)) {&nbsp;</div></li><li><div>                                      $xadj += $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($this-&gt;issetBorder($bord, _BORDER_RIGHT)) {&nbsp;</div></li><li><div>                                      $xadj2 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($side == 'L') {&nbsp;</div></li><li><div>                                  $yadj -= $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $yadj2 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  if ($this-&gt;issetBorder($bord, _BORDER_TOP)) {&nbsp;</div></li><li><div>                                      $yadj += $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($this-&gt;issetBorder($bord, _BORDER_BOTTOM)) {&nbsp;</div></li><li><div>                                      $yadj2 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($side == 'B') {&nbsp;</div></li><li><div>                                  $xadj -= $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $xadj2 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  if ($this-&gt;issetBorder($bord, _BORDER_LEFT)) {&nbsp;</div></li><li><div>                                      $xadj += $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($this-&gt;issetBorder($bord, _BORDER_RIGHT)) {&nbsp;</div></li><li><div>                                      $xadj2 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($side == 'R') {&nbsp;</div></li><li><div>                                  $yadj -= $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $yadj2 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  if ($this-&gt;issetBorder($bord, _BORDER_TOP)) {&nbsp;</div></li><li><div>                                      $yadj += $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($this-&gt;issetBorder($bord, _BORDER_BOTTOM)) {&nbsp;</div></li><li><div>                                      $yadj2 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $this-&gt;SetLineWidth($this-&gt;LineWidth / 3);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $tbcol = $this-&gt;ConvertColor(255);&nbsp;</div></li><li><div>                          for ($l = 0; $l &lt;= $this-&gt;blklvl; $l++) {&nbsp;</div></li><li><div>                              if ($this-&gt;blk[$l]['bgcolor']) {&nbsp;</div></li><li><div>                                  $tbcol = ($this-&gt;blk[$l]['bgcolorarray']);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($bSeparate) {&nbsp;</div></li><li><div>                              $cellBorderOverlay[] = array(&nbsp;</div></li><li><div>                                  'x' =&gt; $lx1 + $xadj, &nbsp;</div></li><li><div>                                  'y' =&gt; $ly1 + $yadj, &nbsp;</div></li><li><div>                                  'x2' =&gt; $lx2 - $xadj2, &nbsp;</div></li><li><div>                                  'y2' =&gt; $ly2 - $yadj2, &nbsp;</div></li><li><div>                                  'col' =&gt; $tbcol, &nbsp;</div></li><li><div>                                  'lw' =&gt; $this-&gt;LineWidth, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($tbcol);&nbsp;</div></li><li><div>                              $this-&gt;Line($lx1 + $xadj, $ly1 + $yadj, $lx2 - $xadj2, $ly2 - $yadj2);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif (isset($details[$side]['style']) && ($details[$side]['style'] == 'ridge' || $details[$side]['style'] == 'groove' || $details[$side]['style'] == 'inset' || $details[$side]['style'] == 'outset')) {&nbsp;</div></li><li><div>                      if (!isset($details[$side]['overlay']) || !$details[$side]['overlay'] || $bSeparate) {&nbsp;</div></li><li><div>                          if ($details[$side]['c']) {&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($details[$side]['c']);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($details[$side]['style'] == 'outset' || $details[$side]['style'] == 'groove') {&nbsp;</div></li><li><div>                              $nc = $this-&gt;_darkenColor($details[$side]['c']);&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($nc);&nbsp;</div></li><li><div>                          } elseif ($details[$side]['style'] == 'ridge' || $details[$side]['style'] == 'inset') {&nbsp;</div></li><li><div>                              $nc = $this-&gt;_lightenColor($details[$side]['c']);&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($nc);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;Line($lx1 + $xadj, $ly1 + $yadj, $lx2 - $xadj2, $ly2 - $yadj2);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ((isset($details[$side]['overlay']) && $details[$side]['overlay']) || $bSeparate) {&nbsp;</div></li><li><div>                          if ($details[$side]['c']) {&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($details[$side]['c']);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $doubleadj = ($this-&gt;LineWidth) / 3;&nbsp;</div></li><li><div>                          $this-&gt;SetLineWidth($this-&gt;LineWidth / 2);&nbsp;</div></li><li><div>                          $xadj3 = $yadj3 = $wadj3 = $hadj3 = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($details[$side]['style'] == 'ridge' || $details[$side]['style'] == 'inset') {&nbsp;</div></li><li><div>                              $nc = $this-&gt;_darkenColor($details[$side]['c']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($bSeparate && $cort == 'table') {&nbsp;</div></li><li><div>                                  if ($side == 'T') {&nbsp;</div></li><li><div>                                      $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $xadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $wadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      if ($this-&gt;issetBorder($bord, _BORDER_LEFT)) {&nbsp;</div></li><li><div>                                          $xadj3 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                          $wadj3 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                      if ($this-&gt;issetBorder($bord, _BORDER_RIGHT)) {&nbsp;</div></li><li><div>                                          $wadj3 -= $this-&gt;LineWidth * 2;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($side == 'L') {&nbsp;</div></li><li><div>                                      $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $yadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $hadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      if ($this-&gt;issetBorder($bord, _BORDER_TOP)) {&nbsp;</div></li><li><div>                                          $yadj3 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                          $hadj3 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                      if ($this-&gt;issetBorder($bord, _BORDER_BOTTOM)) {&nbsp;</div></li><li><div>                                          $hadj3 -= $this-&gt;LineWidth * 2;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($side == 'B') {&nbsp;</div></li><li><div>                                      $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $xadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $wadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($side == 'R') {&nbsp;</div></li><li><div>                                      $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $yadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $hadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              } elseif ($side == 'T') {&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $wadj3 = -$this-&gt;LineWidth * 2;&nbsp;</div></li><li><div>                              } elseif ($side == 'L') {&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $hadj3 = -$this-&gt;LineWidth * 2;&nbsp;</div></li><li><div>                              } elseif ($side == 'B' && $bSeparate) {&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $wadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                              } elseif ($side == 'R' && $bSeparate) {&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $hadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                              } elseif ($side == 'B') {&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                              } elseif ($side == 'R') {&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $nc = $this-&gt;_lightenColor($details[$side]['c']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($bSeparate && $cort == 'table') {&nbsp;</div></li><li><div>                                  if ($side == 'T') {&nbsp;</div></li><li><div>                                      $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $xadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $wadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      if ($this-&gt;issetBorder($bord, _BORDER_LEFT)) {&nbsp;</div></li><li><div>                                          $xadj3 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                          $wadj3 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($side == 'L') {&nbsp;</div></li><li><div>                                      $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $yadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $hadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      if ($this-&gt;issetBorder($bord, _BORDER_TOP)) {&nbsp;</div></li><li><div>                                          $yadj3 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                          $hadj3 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($side == 'B') {&nbsp;</div></li><li><div>                                      $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $xadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $wadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      if ($this-&gt;issetBorder($bord, _BORDER_LEFT)) {&nbsp;</div></li><li><div>                                          $xadj3 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                          $wadj3 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($side == 'R') {&nbsp;</div></li><li><div>                                      $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $yadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                      $hadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      if ($this-&gt;issetBorder($bord, _BORDER_TOP)) {&nbsp;</div></li><li><div>                                          $yadj3 += $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                          $hadj3 -= $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              } elseif ($side == 'T') {&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                              } elseif ($side == 'L') {&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                              } elseif ($side == 'B' && $bSeparate) {&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                              } elseif ($side == 'R' && $bSeparate) {&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                              } elseif ($side == 'B') {&nbsp;</div></li><li><div>                                  $yadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $xadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $wadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                              } elseif ($side == 'R') {&nbsp;</div></li><li><div>                                  $xadj3 = $this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $yadj3 = -$this-&gt;LineWidth / 2;&nbsp;</div></li><li><div>                                  $hadj3 = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($bSeparate) {&nbsp;</div></li><li><div>                              $cellBorderOverlay[] = array(&nbsp;</div></li><li><div>                                  'x' =&gt; $lx1 + $xadj + $xadj3, &nbsp;</div></li><li><div>                                  'y' =&gt; $ly1 + $yadj + $yadj3, &nbsp;</div></li><li><div>                                  'x2' =&gt; $lx2 - $xadj2 + $xadj3 + $wadj3, &nbsp;</div></li><li><div>                                  'y2' =&gt; $ly2 - $yadj2 + $yadj3 + $hadj3, &nbsp;</div></li><li><div>                                  'col' =&gt; $nc, &nbsp;</div></li><li><div>                                  'lw' =&gt; $this-&gt;LineWidth, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;SetDColor($nc);&nbsp;</div></li><li><div>                              $this-&gt;Line($lx1 + $xadj + $xadj3, $ly1 + $yadj + $yadj3, $lx2 - $xadj2 + $xadj3 + $wadj3, $ly2 - $yadj2 + $yadj3 + $hadj3);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>                      if ($details[$side]['style'] == 'dashed') {&nbsp;</div></li><li><div>                          $dashsize = 2; <span class="comment"><span class="comment">// final dash will be this + 1*linewidth</span></span>&nbsp;</div></li><li><div>                          $dashsizek = 1.5; <span class="comment"><span class="comment">// ratio of Dash/Blank</span></span>&nbsp;</div></li><li><div>                          $this-&gt;SetDash($dashsize, ($dashsize / $dashsizek) + ($this-&gt;LineWidth * 2));&nbsp;</div></li><li><div>                      } elseif ($details[$side]['style'] == 'dotted') {&nbsp;</div></li><li><div>                          $this-&gt;SetLineJoin(1);&nbsp;</div></li><li><div>                          $this-&gt;SetLineCap(1);&nbsp;</div></li><li><div>                          $this-&gt;SetDash(0.001, ($this-&gt;LineWidth * 2));&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($details[$side]['c']) {&nbsp;</div></li><li><div>                          $this-&gt;SetDColor($details[$side]['c']);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;Line($lx1 + $xadj, $ly1 + $yadj, $lx2 - $xadj2, $ly2 - $yadj2);&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Reset</span> Corners&nbsp;</div></li><li><div>                  $this-&gt;SetDash();&nbsp;</div></li><li><div>                  <span class="comment">//BUTT style line cap</span>&nbsp;</div></li><li><div>                  $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($bSeparate && count($cellBorderOverlay)) {&nbsp;</div></li><li><div>              foreach ($cellBorderOverlay AS $cbo) {&nbsp;</div></li><li><div>                  $this-&gt;SetLineWidth($cbo['lw']);&nbsp;</div></li><li><div>                  $this-&gt;SetDColor($cbo['col']);&nbsp;</div></li><li><div>                  $this-&gt;Line($cbo['x'], $cbo['y'], $cbo['x2'], $cbo['y2']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// $this-&gt;SetLineWidth($oldlinewidth);</span>&nbsp;</div></li><li><div>          <span class="comment">// $this-&gt;SetDColor($this-&gt;ConvertColor(0));</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _lightenColor($c)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (is_array($c)) {&nbsp;</div></li><li><div>          throw new MpdfException('Color error in _lightencolor');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($c{0} == 3 || $c{0} == 5) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>&nbsp;</div></li><li><div>          list($h, $s, $l) = $this-&gt;rgb2hsl(ord($c{1}) / 255, ord($c{2}) / 255, ord($c{3}) / 255);&nbsp;</div></li><li><div>          $l += ((1 - $l) * 0.8);&nbsp;</div></li><li><div>          list($r, $g, $b) = $this-&gt;hsl2rgb($h, $s, $l);&nbsp;</div></li><li><div>          $ret = array(3, $r, $g, $b);&nbsp;</div></li><li><div>      } elseif ($c{0} == 4 || $c{0} == 6) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $ret = array(4, max(0, (ord($c{1}) - 20)), max(0, (ord($c{2}) - 20)), max(0, (ord($c{3}) - 20)), max(0, (ord($c{4}) - 20)));&nbsp;</div></li><li><div>      } elseif ($c{0} == 1) { <span class="comment"><span class="comment">// Gray</span></span>scale&nbsp;</div></li><li><div>          $ret = array(1, min(255, (ord($c{1}) + 32)));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $c = array_pad($ret, 6, 0);&nbsp;</div></li><li><div>      $cstr = pack(&quot;a1ccccc&quot;, $c[0], ($c[1] & 0xFF), ($c[2] & 0xFF), ($c[3] & 0xFF), ($c[4] & 0xFF), ($c[5] & 0xFF));&nbsp;</div></li><li><div>      return $cstr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _darkenColor($c)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (is_array($c)) {&nbsp;</div></li><li><div>          throw new MpdfException('Color error in _darkenColor');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($c{0} == 3 || $c{0} == 5) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>&nbsp;</div></li><li><div>          list($h, $s, $l) = $this-&gt;rgb2hsl(ord($c{1}) / 255, ord($c{2}) / 255, ord($c{3}) / 255);&nbsp;</div></li><li><div>          $s *= 0.25;&nbsp;</div></li><li><div>          $l *= 0.75;&nbsp;</div></li><li><div>          list($r, $g, $b) = $this-&gt;hsl2rgb($h, $s, $l);&nbsp;</div></li><li><div>          $ret = array(3, $r, $g, $b);&nbsp;</div></li><li><div>      } elseif ($c{0} == 4 || $c{0} == 6) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $ret = array(4, min(100, (ord($c{1}) + 20)), min(100, (ord($c{2}) + 20)), min(100, (ord($c{3}) + 20)), min(100, (ord($c{4}) + 20)));&nbsp;</div></li><li><div>      } elseif ($c{0} == 1) { <span class="comment"><span class="comment">// Gray</span></span>scale&nbsp;</div></li><li><div>          $ret = array(1, max(0, (ord($c{1}) - 32)));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $c = array_pad($ret, 6, 0);&nbsp;</div></li><li><div>      $cstr = pack(&quot;a1ccccc&quot;, $c[0], ($c[1] & 0xFF), ($c[2] & 0xFF), ($c[3] & 0xFF), ($c[4] & 0xFF), ($c[5] & 0xFF));&nbsp;</div></li><li><div>      return $cstr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function setBorder(&$var, $flag, $set = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $flag = intval($flag);&nbsp;</div></li><li><div>      if ($set) {&nbsp;</div></li><li><div>          $set = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $var = intval($var);&nbsp;</div></li><li><div>      $var = $set ? ($var | $flag) : ($var & ~$flag);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function issetBorder($var, $flag)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $flag = intval($flag);&nbsp;</div></li><li><div>      $var = intval($var);&nbsp;</div></li><li><div>      return (($var & $flag) == $flag);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _table2cellBorder(&$tableb, &$cbdb, &$cellb, $bval)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($tableb && $tableb['w'] &gt; $cbdb['w']) {&nbsp;</div></li><li><div>          $cbdb = $tableb;&nbsp;</div></li><li><div>          $this-&gt;setBorder($cellb, $bval);&nbsp;</div></li><li><div>      } elseif ($tableb && $tableb['w'] == $cbdb['w'] && array_search($tableb['style'], $this-&gt;borderstyles) &gt; array_search($cbdb['style'], $this-&gt;borderstyles)) {&nbsp;</div></li><li><div>          $cbdb = $tableb;&nbsp;</div></li><li><div>          $this-&gt;setBorder($cellb, $bval);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// FIX BORDERS ********************************************</span>&nbsp;</div></li><li><div>  function _fixTableBorders(&$table)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$table['borders_separate'] && $table['border_details']['L']['w']) {&nbsp;</div></li><li><div>          $table['max_cell_border_width']['L'] = $table['border_details']['L']['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$table['borders_separate'] && $table['border_details']['R']['w']) {&nbsp;</div></li><li><div>          $table['max_cell_border_width']['R'] = $table['border_details']['R']['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$table['borders_separate'] && $table['border_details']['T']['w']) {&nbsp;</div></li><li><div>          $table['max_cell_border_width']['T'] = $table['border_details']['T']['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$table['borders_separate'] && $table['border_details']['B']['w']) {&nbsp;</div></li><li><div>          $table['max_cell_border_width']['B'] = $table['border_details']['B']['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $cells = &$table['cells'];&nbsp;</div></li><li><div>      $numcols = $table['nc'];&nbsp;</div></li><li><div>      $numrows = $table['nr'];&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>      if (isset($table['topntail']) && $table['topntail']) {&nbsp;</div></li><li><div>          $tntborddet = $this-&gt;border_details($table['topntail']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($table['thead-underline']) && $table['thead-underline']) {&nbsp;</div></li><li><div>          $thuborddet = $this-&gt;border_details($table['thead-underline']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $numrows; $i++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Rows</span></span></span></span>&nbsp;</div></li><li><div>          for ($j = 0; $j &lt; $numcols; $j++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Columns</span></span></span></span>&nbsp;</div></li><li><div>              if (isset($cells[$i][$j]) && $cells[$i][$j]) {&nbsp;</div></li><li><div>                  $cell = &$cells[$i][$j];&nbsp;</div></li><li><div>                  if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                      $cbord = $this-&gt;_unpackCellBorder($cell['borderbin']);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $cbord = &$cells[$i][$j];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>                  if (!$cbord['border'] && $cbord['border'] !== 0 && isset($table['border']) && $table['border'] && $this-&gt;table_border_attr_set) {&nbsp;</div></li><li><div>                      $cbord['border'] = $table['border'];&nbsp;</div></li><li><div>                      $cbord['border_details'] = $table['border_details'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($cell['colspan']) && $cell['colspan'] &gt; 1) {&nbsp;</div></li><li><div>                      $ccolsp = $cell['colspan'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $ccolsp = 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($cell['rowspan']) && $cell['rowspan'] &gt; 1) {&nbsp;</div></li><li><div>                      $crowsp = $cell['rowspan'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $crowsp = 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $cbord['border_details']['cellposdom'] = ((($i + 1) / $numrows) / 10000 ) + ((($j + 1) / $numcols) / 10 );&nbsp;</div></li><li><div>                  <span class="comment">// Inherit Cell border from Table border</span>&nbsp;</div></li><li><div>                  if ($this-&gt;table_border_css_set && !$table['borders_separate']) {&nbsp;</div></li><li><div>                      if ($i == 0) {&nbsp;</div></li><li><div>                          $this-&gt;_table2cellBorder($table['border_details']['T'], $cbord['border_details']['T'], $cbord['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($i == ($numrows - 1) || ($i + $crowsp) == ($numrows)) {&nbsp;</div></li><li><div>                          $this-&gt;_table2cellBorder($table['border_details']['B'], $cbord['border_details']['B'], $cbord['border'], _BORDER_BOTTOM);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($j == 0) {&nbsp;</div></li><li><div>                          $this-&gt;_table2cellBorder($table['border_details']['L'], $cbord['border_details']['L'], $cbord['border'], _BORDER_LEFT);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($j == ($numcols - 1) || ($j + $ccolsp) == ($numcols)) {&nbsp;</div></li><li><div>                          $this-&gt;_table2cellBorder($table['border_details']['R'], $cbord['border_details']['R'], $cbord['border'], _BORDER_RIGHT);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>                  $fixbottom = true;&nbsp;</div></li><li><div>                  if (isset($table['topntail']) && $table['topntail']) {&nbsp;</div></li><li><div>                      if ($i == 0) {&nbsp;</div></li><li><div>                          $cbord['border_details']['T'] = $tntborddet;&nbsp;</div></li><li><div>                          $this-&gt;setBorder($cbord['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($this-&gt;tableLevel == 1 && $table['headernrows'] &gt; 0 && $i == $table['headernrows'] - 1) {&nbsp;</div></li><li><div>                          $cbord['border_details']['B'] = $tntborddet;&nbsp;</div></li><li><div>                          $this-&gt;setBorder($cbord['border'], _BORDER_BOTTOM);&nbsp;</div></li><li><div>                          $fixbottom = false;&nbsp;</div></li><li><div>                      } elseif ($this-&gt;tableLevel == 1 && $table['headernrows'] &gt; 0 && $i == $table['headernrows']) {&nbsp;</div></li><li><div>                          if (!$table['borders_separate']) {&nbsp;</div></li><li><div>                              $cbord['border_details']['T'] = $tntborddet;&nbsp;</div></li><li><div>                              $this-&gt;setBorder($cbord['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($this-&gt;tableLevel == 1 && $table['footernrows'] &gt; 0 && $i == ($numrows - $table['footernrows'] - 1)) {&nbsp;</div></li><li><div>                          if (!$table['borders_separate']) {&nbsp;</div></li><li><div>                              $cbord['border_details']['B'] = $tntborddet;&nbsp;</div></li><li><div>                              $this-&gt;setBorder($cbord['border'], _BORDER_BOTTOM);&nbsp;</div></li><li><div>                              $fixbottom = false;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif ($this-&gt;tableLevel == 1 && $table['footernrows'] &gt; 0 && $i == ($numrows - $table['footernrows'])) {&nbsp;</div></li><li><div>                          $cbord['border_details']['T'] = $tntborddet;&nbsp;</div></li><li><div>                          $this-&gt;setBorder($cbord['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($this-&gt;tabletheadjustfinished) { <span class="comment"><span class="comment">// $this-&gt;tabletheadjustfinished called from tableheader</span></span>&nbsp;</div></li><li><div>                          if (!$table['borders_separate']) {&nbsp;</div></li><li><div>                              $cbord['border_details']['T'] = $tntborddet;&nbsp;</div></li><li><div>                              $this-&gt;setBorder($cbord['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($i == ($numrows - 1) || ($i + $crowsp) == ($numrows)) {&nbsp;</div></li><li><div>                          $cbord['border_details']['B'] = $tntborddet;&nbsp;</div></li><li><div>                          $this-&gt;setBorder($cbord['border'], _BORDER_BOTTOM);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($table['thead-underline']) && $table['thead-underline']) {&nbsp;</div></li><li><div>                      if ($table['borders_separate']) {&nbsp;</div></li><li><div>                          if ($i == 0) {&nbsp;</div></li><li><div>                              $cbord['border_details']['B'] = $thuborddet;&nbsp;</div></li><li><div>                              $this-&gt;setBorder($cbord['border'], _BORDER_BOTTOM);&nbsp;</div></li><li><div>                              $fixbottom = false;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          if ($this-&gt;tableLevel == 1 && $table['headernrows'] &gt; 0 && $i == $table['headernrows'] - 1) {&nbsp;</div></li><li><div>                              $cbord['border_details']['T'] = $thuborddet;&nbsp;</div></li><li><div>                              $this-&gt;setBorder($cbord['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                          } elseif ($this-&gt;tabletheadjustfinished) { <span class="comment"><span class="comment">// $this-&gt;tabletheadjustfinished called from tableheader</span></span>&nbsp;</div></li><li><div>                              $cbord['border_details']['T'] = $thuborddet;&nbsp;</div></li><li><div>                              $this-&gt;setBorder($cbord['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Collapse Border - Algorithm for conflicting borders</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// Hidden</span></span> &gt;&gt; Width &gt;&gt; double&gt;solid&gt;dashed&gt;dotted... &gt;&gt; style set on cell&gt;table &gt;&gt; top/left&gt;bottom/right</span>&nbsp;</div></li><li><div>                  <span class="comment">// Do not turn off border which is overridden</span>&nbsp;</div></li><li><div>                  <span class="comment">// Needed for page break for TOP/BOTTOM both to be defined in Collapsed borders</span>&nbsp;</div></li><li><div>                  <span class="comment">// Means it is painted twice. (Left/Right can still disable overridden border)</span>&nbsp;</div></li><li><div>                  if (!$table['borders_separate']) {&nbsp;</div></li><li><div>                      if (($i &lt; ($numrows - 1) || ($i + $crowsp) &lt; $numrows ) && $fixbottom) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          for ($cspi = 0; $cspi &lt; $ccolsp; $cspi++) {&nbsp;</div></li><li><div>                              <span class="comment">// already defined Top for adjacent cell below</span>&nbsp;</div></li><li><div>                              if (isset($cells[($i + $crowsp)][$j + $cspi])) {&nbsp;</div></li><li><div>                                  if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                                      $adjc = $cells[($i + $crowsp)][$j + $cspi];&nbsp;</div></li><li><div>                                      $celladj = $this-&gt;_unpackCellBorder($adjc['borderbin']);&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $celladj = & $cells[($i + $crowsp)][$j + $cspi];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $celladj = false;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($celladj && $celladj['border_details']['T']['s'] == 1) {&nbsp;</div></li><li><div>                                  $csadj = $celladj['border_details']['T']['w'];&nbsp;</div></li><li><div>                                  $csthis = $cbord['border_details']['B']['w'];&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment">// Hidden</span></span>&nbsp;</div></li><li><div>                                  if ($cbord['border_details']['B']['style'] == 'hidden') {&nbsp;</div></li><li><div>                                      $celladj['border_details']['T'] = $cbord['border_details']['B'];&nbsp;</div></li><li><div>                                      $this-&gt;setBorder($celladj['border'], _BORDER_TOP, false);&nbsp;</div></li><li><div>                                      $this-&gt;setBorder($cbord['border'], _BORDER_BOTTOM, false);&nbsp;</div></li><li><div>                                  } elseif ($celladj['border_details']['T']['style'] == 'hidden') {&nbsp;</div></li><li><div>                                      $cbord['border_details']['B'] = $celladj['border_details']['T'];&nbsp;</div></li><li><div>                                      $this-&gt;setBorder($cbord['border'], _BORDER_BOTTOM, false);&nbsp;</div></li><li><div>                                      $this-&gt;setBorder($celladj['border'], _BORDER_TOP, false);&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment">// Width</span></span>&nbsp;</div></li><li><div>                                  elseif ($csthis &gt; $csadj) {&nbsp;</div></li><li><div>                                      if (!isset($cells[($i + $crowsp)][$j + $cspi]['colspan']) || (isset($cells[($i + $crowsp)][$j + $cspi]['colspan']) && $cells[($i + $crowsp)][$j + $cspi]['colspan'] &lt; 2)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite bordering cells that span</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $celladj['border_details']['T'] = $cbord['border_details']['B'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($cbord['border'], _BORDER_BOTTOM);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  } elseif ($csadj &gt; $csthis) {&nbsp;</div></li><li><div>                                      if ($ccolsp &lt; 2) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite this cell if it spans</span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $cbord['border_details']['B'] = $celladj['border_details']['T'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($celladj['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment">// double&gt;solid&gt;dashed&gt;dotted...</span></span>&nbsp;</div></li><li><div>                                  elseif (array_search($cbord['border_details']['B']['style'], $this-&gt;borderstyles) &gt; array_search($celladj['border_details']['T']['style'], $this-&gt;borderstyles)) {&nbsp;</div></li><li><div>                                      if (!isset($cells[($i + $crowsp)][$j + $cspi]['colspan']) || (isset($cells[($i + $crowsp)][$j + $cspi]['colspan']) && $cells[($i + $crowsp)][$j + $cspi]['colspan'] &lt; 2)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite bordering cells that span</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $celladj['border_details']['T'] = $cbord['border_details']['B'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($cbord['border'], _BORDER_BOTTOM);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  } elseif (array_search($celladj['border_details']['T']['style'], $this-&gt;borderstyles) &gt; array_search($cbord['border_details']['B']['style'], $this-&gt;borderstyles)) {&nbsp;</div></li><li><div>                                      if ($ccolsp &lt; 2) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite this cell if it spans</span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $cbord['border_details']['B'] = $celladj['border_details']['T'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($celladj['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  <span class="comment">// Style</span> set on cell vs. table&nbsp;</div></li><li><div>                                  elseif ($celladj['border_details']['T']['dom'] &gt; $cbord['border_details']['B']['dom']) {&nbsp;</div></li><li><div>                                      if ($ccolsp &lt; 2) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite this cell if it spans</span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $cbord['border_details']['B'] = $celladj['border_details']['T'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($celladj['border'], _BORDER_TOP);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  <span class="comment">// Style</span> set on cell vs. table  - OR - LEFT/TOP (cell) in preference to BOTTOM/RIGHT&nbsp;</div></li><li><div>                                  else {&nbsp;</div></li><li><div>                                      if (!isset($cells[($i + $crowsp)][$j + $cspi]['colspan']) || (isset($cells[($i + $crowsp)][$j + $cspi]['colspan']) && $cells[($i + $crowsp)][$j + $cspi]['colspan'] &lt; 2)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite bordering cells that span</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $celladj['border_details']['T'] = $cbord['border_details']['B'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($cbord['border'], _BORDER_BOTTOM);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              } elseif ($celladj) {&nbsp;</div></li><li><div>                                  if (!isset($cells[($i + $crowsp)][$j + $cspi]['colspan']) || (isset($cells[($i + $crowsp)][$j + $cspi]['colspan']) && $cells[($i + $crowsp)][$j + $cspi]['colspan'] &lt; 2)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite bordering cells that span</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                      $celladj['border_details']['T'] = $cbord['border_details']['B'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>                              if ($celladj && $this-&gt;packTableData) {&nbsp;</div></li><li><div>                                  $cells[$i + $crowsp][$j + $cspi]['borderbin'] = $this-&gt;_packCellBorder($celladj);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              unset($celladj);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($j &lt; ($numcols - 1) || ($j + $ccolsp) &lt; $numcols) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span>-Left&nbsp;</div></li><li><div>                          for ($cspi = 0; $cspi &lt; $crowsp; $cspi++) {&nbsp;</div></li><li><div>                              <span class="comment">// already defined Left for adjacent cell to R</span>&nbsp;</div></li><li><div>                              if (isset($cells[($i + $cspi)][$j + $ccolsp])) {&nbsp;</div></li><li><div>                                  if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                                      $adjc = $cells[($i + $cspi)][$j + $ccolsp];&nbsp;</div></li><li><div>                                      $celladj = $this-&gt;_unpackCellBorder($adjc['borderbin']);&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $celladj = & $cells[$i + $cspi][$j + $ccolsp];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $celladj = false;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($celladj && $celladj['border_details']['L']['s'] == 1) {&nbsp;</div></li><li><div>                                  $csadj = $celladj['border_details']['L']['w'];&nbsp;</div></li><li><div>                                  $csthis = $cbord['border_details']['R']['w'];&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment">// Hidden</span></span>&nbsp;</div></li><li><div>                                  if ($cbord['border_details']['R']['style'] == 'hidden') {&nbsp;</div></li><li><div>                                      $celladj['border_details']['L'] = $cbord['border_details']['R'];&nbsp;</div></li><li><div>                                      $this-&gt;setBorder($celladj['border'], _BORDER_LEFT, false);&nbsp;</div></li><li><div>                                      $this-&gt;setBorder($cbord['border'], _BORDER_RIGHT, false);&nbsp;</div></li><li><div>                                  } elseif ($celladj['border_details']['L']['style'] == 'hidden') {&nbsp;</div></li><li><div>                                      $cbord['border_details']['R'] = $celladj['border_details']['L'];&nbsp;</div></li><li><div>                                      $this-&gt;setBorder($cbord['border'], _BORDER_RIGHT, false);&nbsp;</div></li><li><div>                                      $this-&gt;setBorder($celladj['border'], _BORDER_LEFT, false);&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment">// Width</span></span>&nbsp;</div></li><li><div>                                  elseif ($csthis &gt; $csadj) {&nbsp;</div></li><li><div>                                      if (!isset($cells[($i + $cspi)][$j + $ccolsp]['rowspan']) || (isset($cells[($i + $cspi)][$j + $ccolsp]['rowspan']) && $cells[($i + $cspi)][$j + $ccolsp]['rowspan'] &lt; 2)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite bordering cells that span</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $celladj['border_details']['L'] = $cbord['border_details']['R'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($cbord['border'], _BORDER_RIGHT);&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($celladj['border'], _BORDER_LEFT, false);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  } elseif ($csadj &gt; $csthis) {&nbsp;</div></li><li><div>                                      if ($crowsp &lt; 2) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite this cell if it spans</span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $cbord['border_details']['R'] = $celladj['border_details']['L'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($cbord['border'], _BORDER_RIGHT, false);&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($celladj['border'], _BORDER_LEFT);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment">// double&gt;solid&gt;dashed&gt;dotted...</span></span>&nbsp;</div></li><li><div>                                  elseif (array_search($cbord['border_details']['R']['style'], $this-&gt;borderstyles) &gt; array_search($celladj['border_details']['L']['style'], $this-&gt;borderstyles)) {&nbsp;</div></li><li><div>                                      if (!isset($cells[($i + $cspi)][$j + $ccolsp]['rowspan']) || (isset($cells[($i + $cspi)][$j + $ccolsp]['rowspan']) && $cells[($i + $cspi)][$j + $ccolsp]['rowspan'] &lt; 2)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite bordering cells that span</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $celladj['border_details']['L'] = $cbord['border_details']['R'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($celladj['border'], _BORDER_LEFT, false);&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($cbord['border'], _BORDER_RIGHT);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  } elseif (array_search($celladj['border_details']['L']['style'], $this-&gt;borderstyles) &gt; array_search($cbord['border_details']['R']['style'], $this-&gt;borderstyles)) {&nbsp;</div></li><li><div>                                      if ($crowsp &lt; 2) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite this cell if it spans</span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $cbord['border_details']['R'] = $celladj['border_details']['L'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($cbord['border'], _BORDER_RIGHT, false);&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($celladj['border'], _BORDER_LEFT);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  <span class="comment">// Style</span> set on cell vs. table&nbsp;</div></li><li><div>                                  elseif ($celladj['border_details']['L']['dom'] &gt; $cbord['border_details']['R']['dom']) {&nbsp;</div></li><li><div>                                      if ($crowsp &lt; 2) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite this cell if it spans</span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $cbord['border_details']['R'] = $celladj['border_details']['L'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($celladj['border'], _BORDER_LEFT);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  <span class="comment">// Style</span> set on cell vs. table  - OR - LEFT/TOP (cell) in preference to BOTTOM/RIGHT&nbsp;</div></li><li><div>                                  else {&nbsp;</div></li><li><div>                                      if (!isset($cells[($i + $cspi)][$j + $ccolsp]['rowspan']) || (isset($cells[($i + $cspi)][$j + $ccolsp]['rowspan']) && $cells[($i + $cspi)][$j + $ccolsp]['rowspan'] &lt; 2)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite bordering cells that span</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          $celladj['border_details']['L'] = $cbord['border_details']['R'];&nbsp;</div></li><li><div>                                          $this-&gt;setBorder($cbord['border'], _BORDER_RIGHT);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              } elseif ($celladj) {&nbsp;</div></li><li><div>                                  <span class="comment">// if right-cell border is not set</span>&nbsp;</div></li><li><div>                                  if (!isset($cells[($i + $cspi)][$j + $ccolsp]['rowspan']) || (isset($cells[($i + $cspi)][$j + $ccolsp]['rowspan']) && $cells[($i + $cspi)][$j + $ccolsp]['rowspan'] &lt; 2)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// don't overwrite bordering cells that span</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                      $celladj['border_details']['L'] = $cbord['border_details']['R'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>                              if ($celladj && $this-&gt;packTableData) {&nbsp;</div></li><li><div>                                  $cells[$i + $cspi][$j + $ccolsp]['borderbin'] = $this-&gt;_packCellBorder($celladj);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              unset($celladj);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Set maximum cell border width meeting at LRTB edges of cell - used for extended cell border</span>&nbsp;</div></li><li><div>                  <span class="comment">// ['border_details']['mbw']['LT'] = meeting border width - Left border - Top end</span>&nbsp;</div></li><li><div>                  if (!$table['borders_separate']) {&nbsp;</div></li><li><div>                      $cbord['border_details']['mbw']['BL'] = max($cbord['border_details']['mbw']['BL'], $cbord['border_details']['L']['w']);&nbsp;</div></li><li><div>                      $cbord['border_details']['mbw']['BR'] = max($cbord['border_details']['mbw']['BR'], $cbord['border_details']['R']['w']);&nbsp;</div></li><li><div>                      $cbord['border_details']['mbw']['RT'] = max($cbord['border_details']['mbw']['RT'], $cbord['border_details']['T']['w']);&nbsp;</div></li><li><div>                      $cbord['border_details']['mbw']['RB'] = max($cbord['border_details']['mbw']['RB'], $cbord['border_details']['B']['w']);&nbsp;</div></li><li><div>                      $cbord['border_details']['mbw']['TL'] = max($cbord['border_details']['mbw']['TL'], $cbord['border_details']['L']['w']);&nbsp;</div></li><li><div>                      $cbord['border_details']['mbw']['TR'] = max($cbord['border_details']['mbw']['TR'], $cbord['border_details']['R']['w']);&nbsp;</div></li><li><div>                      $cbord['border_details']['mbw']['LT'] = max($cbord['border_details']['mbw']['LT'], $cbord['border_details']['T']['w']);&nbsp;</div></li><li><div>                      $cbord['border_details']['mbw']['LB'] = max($cbord['border_details']['mbw']['LB'], $cbord['border_details']['B']['w']);&nbsp;</div></li><li><div>                      if (($i + $crowsp) &lt; $numrows && isset($cells[$i + $crowsp][$j])) { <span class="comment">// Has Bottom adjoining cell</span>&nbsp;</div></li><li><div>                          if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                              $adjc = $cells[$i + $crowsp][$j];&nbsp;</div></li><li><div>                              $celladj = $this-&gt;_unpackCellBorder($adjc['borderbin']);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $celladj = & $cells[$i + $crowsp][$j];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['BL'] = max($cbord['border_details']['mbw']['BL'], $celladj['border_details']['L']['w'], $celladj['border_details']['mbw']['TL']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['BR'] = max($cbord['border_details']['mbw']['BR'], $celladj['border_details']['R']['w'], $celladj['border_details']['mbw']['TR']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['LB'] = max($cbord['border_details']['mbw']['LB'], $celladj['border_details']['mbw']['LT']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['RB'] = max($cbord['border_details']['mbw']['RB'], $celladj['border_details']['mbw']['RT']);&nbsp;</div></li><li><div>                          unset($celladj);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (($j + $ccolsp) &lt; $numcols && isset($cells[$i][$j + $ccolsp])) { <span class="comment">// Has Right adjoining cell</span>&nbsp;</div></li><li><div>                          if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                              $adjc = $cells[$i][$j + $ccolsp];&nbsp;</div></li><li><div>                              $celladj = $this-&gt;_unpackCellBorder($adjc['borderbin']);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $celladj = & $cells[$i][$j + $ccolsp];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['RT'] = max($cbord['border_details']['mbw']['RT'], $celladj['border_details']['T']['w'], $celladj['border_details']['mbw']['LT']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['RB'] = max($cbord['border_details']['mbw']['RB'], $celladj['border_details']['B']['w'], $celladj['border_details']['mbw']['LB']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['TR'] = max($cbord['border_details']['mbw']['TR'], $celladj['border_details']['mbw']['TL']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['BR'] = max($cbord['border_details']['mbw']['BR'], $celladj['border_details']['mbw']['BL']);&nbsp;</div></li><li><div>                          unset($celladj);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($i &gt; 0 && isset($cells[$i - 1][$j]) && (($this-&gt;packTableData && $cells[$i - 1][$j]['borderbin']) || $cells[$i - 1][$j]['border'])) { <span class="comment">// Has Top adjoining cell</span>&nbsp;</div></li><li><div>                          if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                              $adjc = $cells[$i - 1][$j];&nbsp;</div></li><li><div>                              $celladj = $this-&gt;_unpackCellBorder($adjc['borderbin']);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $celladj = & $cells[$i - 1][$j];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['TL'] = max($cbord['border_details']['mbw']['TL'], $celladj['border_details']['L']['w'], $celladj['border_details']['mbw']['BL']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['TR'] = max($cbord['border_details']['mbw']['TR'], $celladj['border_details']['R']['w'], $celladj['border_details']['mbw']['BR']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['LT'] = max($cbord['border_details']['mbw']['LT'], $celladj['border_details']['mbw']['LB']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['RT'] = max($cbord['border_details']['mbw']['RT'], $celladj['border_details']['mbw']['RB']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($celladj['border_details']['mbw']['BL']) {&nbsp;</div></li><li><div>                              $celladj['border_details']['mbw']['BL'] = max($cbord['border_details']['mbw']['TL'], $celladj['border_details']['mbw']['BL']);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($celladj['border_details']['mbw']['BR']) {&nbsp;</div></li><li><div>                              $celladj['border_details']['mbw']['BR'] = max($celladj['border_details']['mbw']['BR'], $cbord['border_details']['mbw']['TR']);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                              $cells[$i - 1][$j]['borderbin'] = $this-&gt;_packCellBorder($celladj);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          unset($celladj);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($j &gt; 0 && isset($cells[$i][$j - 1]) && (($this-&gt;packTableData && $cells[$i][$j - 1]['borderbin']) || $cells[$i][$j - 1]['border'])) { <span class="comment">// Has Left adjoining cell</span>&nbsp;</div></li><li><div>                          if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                              $adjc = $cells[$i][$j - 1];&nbsp;</div></li><li><div>                              $celladj = $this-&gt;_unpackCellBorder($adjc['borderbin']);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $celladj = & $cells[$i][$j - 1];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['LT'] = max($cbord['border_details']['mbw']['LT'], $celladj['border_details']['T']['w'], $celladj['border_details']['mbw']['RT']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['LB'] = max($cbord['border_details']['mbw']['LB'], $celladj['border_details']['B']['w'], $celladj['border_details']['mbw']['RB']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['BL'] = max($cbord['border_details']['mbw']['BL'], $celladj['border_details']['mbw']['BR']);&nbsp;</div></li><li><div>                          $cbord['border_details']['mbw']['TL'] = max($cbord['border_details']['mbw']['TL'], $celladj['border_details']['mbw']['TR']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ($celladj['border_details']['mbw']['RT']) {&nbsp;</div></li><li><div>                              $celladj['border_details']['mbw']['RT'] = max($celladj['border_details']['mbw']['RT'], $cbord['border_details']['mbw']['LT']);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($celladj['border_details']['mbw']['RB']) {&nbsp;</div></li><li><div>                              $celladj['border_details']['mbw']['RB'] = max($celladj['border_details']['mbw']['RB'], $cbord['border_details']['mbw']['LB']);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                              $cells[$i][$j - 1]['borderbin'] = $this-&gt;_packCellBorder($celladj);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          unset($celladj);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Update maximum cell border width at LRTB edges of table - used for overall table width</span>&nbsp;</div></li><li><div>                      if ($j == 0 && $cbord['border_details']['L']['w']) {&nbsp;</div></li><li><div>                          $table['max_cell_border_width']['L'] = max($table['max_cell_border_width']['L'], $cbord['border_details']['L']['w']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (($j == ($numcols - 1) || ($j + $ccolsp) == $numcols ) && $cbord['border_details']['R']['w']) {&nbsp;</div></li><li><div>                          $table['max_cell_border_width']['R'] = max($table['max_cell_border_width']['R'], $cbord['border_details']['R']['w']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($i == 0 && $cbord['border_details']['T']['w']) {&nbsp;</div></li><li><div>                          $table['max_cell_border_width']['T'] = max($table['max_cell_border_width']['T'], $cbord['border_details']['T']['w']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (($i == ($numrows - 1) || ($i + $crowsp) == $numrows ) && $cbord['border_details']['B']['w']) {&nbsp;</div></li><li><div>                          $table['max_cell_border_width']['B'] = max($table['max_cell_border_width']['B'], $cbord['border_details']['B']['w']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES-ADVANCED-BORDERS -- */</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                      $cell['borderbin'] = $this-&gt;_packCellBorder($cbord);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  unset($cbord);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  unset($cell);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset($cell);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// END FIX BORDERS ************************************************************************************</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _reverseTableDir(&$table)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $cells = &$table['cells'];&nbsp;</div></li><li><div>      $numcols = $table['nc'];&nbsp;</div></li><li><div>      $numrows = $table['nr'];&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $numrows; $i++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Rows</span></span></span></span>&nbsp;</div></li><li><div>          $row = array();&nbsp;</div></li><li><div>          for ($j = ($numcols - 1); $j &gt;= 0; $j--) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Columns</span></span></span></span>&nbsp;</div></li><li><div>              if (isset($cells[$i][$j]) && $cells[$i][$j]) {&nbsp;</div></li><li><div>                  $cell = &$cells[$i][$j];&nbsp;</div></li><li><div>                  $col = $numcols - $j - 1;&nbsp;</div></li><li><div>                  if (isset($cell['colspan']) && $cell['colspan'] &gt; 1) {&nbsp;</div></li><li><div>                      $col -= ($cell['colspan'] - 1);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment">// Nested content</span>&nbsp;</div></li><li><div>                  if (isset($cell['textbuffer'])) {&nbsp;</div></li><li><div>                      for ($n = 0; $n &lt; count($cell['textbuffer']); $n++) {&nbsp;</div></li><li><div>                          $t = $cell['textbuffer'][$n][0];&nbsp;</div></li><li><div>                          if (substr($t, 0, 19) == &quot;\xbb\xa4\xactype=nestedtable&quot;) {&nbsp;</div></li><li><div>                              $objattr = $this-&gt;_getObjAttr($t);&nbsp;</div></li><li><div>                              $objattr['col'] = $col;&nbsp;</div></li><li><div>                              $cell['textbuffer'][$n][0] = &quot;\xbb\xa4\xactype=nestedtable, objattr=&quot; . serialize($objattr) . &quot;\xbb\xa4\xac&quot;;&nbsp;</div></li><li><div>                              $this-&gt;table[($this-&gt;tableLevel + 1)][$objattr['nestedcontent']]['nestedpos'][1] = $col;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $row[$col] = $cells[$i][$j];&nbsp;</div></li><li><div>                  unset($cell);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          for ($f = 0; $f &lt; $numcols; $f++) {&nbsp;</div></li><li><div>              if (!isset($row[$f])) {&nbsp;</div></li><li><div>                  $row[$f] = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $table['cells'][$i] = $row;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _tableWrite(&$table, $split = false, $startrow = 0, $startcol = 0, $splitpg = 0, $rety = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $level = $table['level'];&nbsp;</div></li><li><div>      $levelid = $table['levelid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cells = &$table['cells'];&nbsp;</div></li><li><div>      $numcols = $table['nc'];&nbsp;</div></li><li><div>      $numrows = $table['nr'];&nbsp;</div></li><li><div>      $maxbwtop = 0;&nbsp;</div></li><li><div>      if ($this-&gt;ColActive && $level == 1) {&nbsp;</div></li><li><div>          $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$split || ($startrow == 0 && $splitpg == 0) || $startrow &gt; 0) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// TABLE</span></span> TOP MARGIN&nbsp;</div></li><li><div>          if ($table['margin']['T']) {&nbsp;</div></li><li><div>              if (!$this-&gt;table_rotate && $level == 1) {&nbsp;</div></li><li><div>                  $this-&gt;DivLn($table['margin']['T'], $this-&gt;blklvl, true, 1);  <span class="comment"><span class="comment">// collapsible</span></span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;y += ($table['margin']['T']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Advance down page</span> by half width of top border</span></span>&nbsp;</div></li><li><div>          if ($table['borders_separate']) {&nbsp;</div></li><li><div>              if ($startrow &gt; 0 && (!isset($table['is_thead']) || count($table['is_thead']) == 0))&nbsp;</div></li><li><div>                  $adv = $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $adv = $table['padding']['T'] + $table['border_details']['T']['w'] + $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $adv = $table['max_cell_border_width']['T'] / 2;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$this-&gt;table_rotate && $level == 1) {&nbsp;</div></li><li><div>              $this-&gt;DivLn($adv);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;y += $adv;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($level == 1) {&nbsp;</div></li><li><div>          $this-&gt;x = $this-&gt;lMargin + $this-&gt;blk[$this-&gt;blklvl]['outer_left_margin'] + $this-&gt;blk[$this-&gt;blklvl]['padding_left'] + $this-&gt;blk[$this-&gt;blklvl]['border_left']['w'];&nbsp;</div></li><li><div>          $x0 = $this-&gt;x;&nbsp;</div></li><li><div>          $y0 = $this-&gt;y;&nbsp;</div></li><li><div>          $right = $x0 + $this-&gt;blk[$this-&gt;blklvl]['inner_width'];&nbsp;</div></li><li><div>          $outerfilled = $this-&gt;y; <span class="comment">// Keep track of how far down the outer DIV bgcolor is painted (NB rowspans)</span>&nbsp;</div></li><li><div>          $this-&gt;outerfilled = $this-&gt;y;&nbsp;</div></li><li><div>          $this-&gt;colsums = array();&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $x0 = $this-&gt;x;&nbsp;</div></li><li><div>          $y0 = $this-&gt;y;&nbsp;</div></li><li><div>          $right = $x0 + $table['w'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>          $temppgwidth = $this-&gt;tbrot_maxw;&nbsp;</div></li><li><div>          $this-&gt;PageBreakTrigger = $pagetrigger = $y0 + ($this-&gt;blk[$this-&gt;blklvl]['inner_width']);&nbsp;</div></li><li><div>          if ($level == 1) {&nbsp;</div></li><li><div>              $this-&gt;tbrot_y0 = $this-&gt;y - $adv - $table['margin']['T'];&nbsp;</div></li><li><div>              $this-&gt;tbrot_x0 = $this-&gt;x;&nbsp;</div></li><li><div>              $this-&gt;tbrot_w = $table['w'];&nbsp;</div></li><li><div>              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                  $this-&gt;tbrot_h = $table['margin']['T'] + $table['padding']['T'] + $table['border_details']['T']['w'] + $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;tbrot_h = $table['margin']['T'] + $table['padding']['T'] + $table['max_cell_border_width']['T'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;PageBreakTrigger = $pagetrigger = ($this-&gt;h - $this-&gt;bMargin);&nbsp;</div></li><li><div>          if ($level == 1) {&nbsp;</div></li><li><div>              $temppgwidth = $this-&gt;blk[$this-&gt;blklvl]['inner_width'];&nbsp;</div></li><li><div>              if (isset($table['a']) and ( $table['w'] &lt; $this-&gt;blk[$this-&gt;blklvl]['inner_width'])) {&nbsp;</div></li><li><div>                  if ($table['a'] == 'C') {&nbsp;</div></li><li><div>                      $x0 += ((($right - $x0) - $table['w']) / 2);&nbsp;</div></li><li><div>                  } elseif ($table['a'] == 'R') {&nbsp;</div></li><li><div>                      $x0 = $right - $table['w'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $temppgwidth = $table['w'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($table['overflow'])) {&nbsp;</div></li><li><div>          $table['overflow'] = null;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($table['overflow'] == 'hidden' && $level == 1 && !$this-&gt;table_rotate && !$this-&gt;ColActive) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Bounding rectangle to clip</span></span>&nbsp;</div></li><li><div>          $this-&gt;tableClipPath = sprintf('q %.3F %.3F %.3F %.3F re W n', $x0 * _MPDFK, $this-&gt;h * _MPDFK, $this-&gt;blk[$this-&gt;blklvl]['inner_width'] * _MPDFK, -$this-&gt;h * _MPDFK);&nbsp;</div></li><li><div>          $this-&gt;_out($this-&gt;tableClipPath);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;tableClipPath = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($table['borders_separate']) {&nbsp;</div></li><li><div>          $indent = $table['margin']['L'] + $table['border_details']['L']['w'] + $table['padding']['L'] + $table['border_spacing_H'] / 2;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $indent = $table['margin']['L'] + $table['max_cell_border_width']['L'] / 2;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $x0 += $indent;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $returny = 0;&nbsp;</div></li><li><div>      $lastCol = 0;&nbsp;</div></li><li><div>      $tableheader = array();&nbsp;</div></li><li><div>      $tablefooter = array();&nbsp;</div></li><li><div>      $tableheaderrowheight = 0;&nbsp;</div></li><li><div>      $tablefooterrowheight = 0;&nbsp;</div></li><li><div>      $footery = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// mPD 3.0 Set the Page & Column where table starts</span>&nbsp;</div></li><li><div>      if (($this-&gt;mirrorMargins) && (($this-&gt;page) % 2 == 0)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $tablestartpage = 'EVEN';&nbsp;</div></li><li><div>      } elseif (($this-&gt;mirrorMargins) && (($this-&gt;page) % 2 == 1)) { <span class="comment"><span class="comment"><span class="comment">// ODD</span></span></span>&nbsp;</div></li><li><div>          $tablestartpage = 'ODD';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tablestartpage = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          $tablestartcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tablestartcolumn = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $y = $h = 0;&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $numrows; $i++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Rows</span></span></span></span>&nbsp;</div></li><li><div>          if (isset($table['is_tfoot'][$i]) && $table['is_tfoot'][$i] && $level == 1) {&nbsp;</div></li><li><div>              $tablefooterrowheight += $table['hr'][$i];&nbsp;</div></li><li><div>              $tablefooter[$i][0]['trbackground-images'] = $table['trbackground-images'][$i];&nbsp;</div></li><li><div>              $tablefooter[$i][0]['trgradients'] = $table['trgradients'][$i];&nbsp;</div></li><li><div>              $tablefooter[$i][0]['trbgcolor'] = $table['bgcolor'][$i];&nbsp;</div></li><li><div>              for ($j = $startcol; $j &lt; $numcols; $j++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Columns</span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($cells[$i][$j]) && $cells[$i][$j]) {&nbsp;</div></li><li><div>                      $cell = &$cells[$i][$j];&nbsp;</div></li><li><div>                      if ($split) {&nbsp;</div></li><li><div>                          if ($table['colPg'][$j] != $splitpg) {&nbsp;</div></li><li><div>                              continue;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          list($x, $w) = $this-&gt;_splitTableGetWidth($table, $i, $j);&nbsp;</div></li><li><div>                          $js = $j - $startcol;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          list($x, $w) = $this-&gt;_tableGetWidth($table, $i, $j);&nbsp;</div></li><li><div>                          $js = $j;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      list($y, $h) = $this-&gt;_tableGetHeight($table, $i, $j);&nbsp;</div></li><li><div>                      $x += $x0;&nbsp;</div></li><li><div>                      $y += $y0;&nbsp;</div></li><li><div>                      <span class="comment">//Get info of tfoot ==&gt;&gt; table footer</span>&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['x'] = $x;&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['y'] = $y;&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['h'] = $h;&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['w'] = $w;&nbsp;</div></li><li><div>                      if (isset($cell['textbuffer'])) {&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['textbuffer'] = $cell['textbuffer'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['textbuffer'] = '';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['a'] = $cell['a'];&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['R'] = $cell['R'];&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['va'] = $cell['va'];&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['mih'] = $cell['mih'];&nbsp;</div></li><li><div>                      if (isset($cell['gradient']))&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['gradient'] = $cell['gradient']; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// *BACKGROUNDS*</span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($cell['background-image']))&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['background-image'] = $cell['background-image']; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// *BACKGROUNDS*</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">//CELL FILL BGCOLOR</span>&nbsp;</div></li><li><div>                      if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                          if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                              $c = $this-&gt;_unpackCellBorder($cell['borderbin']);&nbsp;</div></li><li><div>                              $tablefooter[$i][$js]['border'] = $c['border'];&nbsp;</div></li><li><div>                              $tablefooter[$i][$js]['border_details'] = $c['border_details'];&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $tablefooter[$i][$js]['border'] = $cell['border'];&nbsp;</div></li><li><div>                              $tablefooter[$i][$js]['border_details'] = $cell['border_details'];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['border'] = $table['simple']['border'];&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['border_details'] = $table['simple']['border_details'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['bgcolor'] = $cell['bgcolor'];&nbsp;</div></li><li><div>                      $tablefooter[$i][$js]['padding'] = $cell['padding'];&nbsp;</div></li><li><div>                      if (isset($cell['rowspan']))&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['rowspan'] = $cell['rowspan'];&nbsp;</div></li><li><div>                      if (isset($cell['colspan']))&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['colspan'] = $cell['colspan'];&nbsp;</div></li><li><div>                      if (isset($cell['direction']))&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['direction'] = $cell['direction'];&nbsp;</div></li><li><div>                      if (isset($cell['cellLineHeight']))&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['cellLineHeight'] = $cell['cellLineHeight'];&nbsp;</div></li><li><div>                      if (isset($cell['cellLineStackingStrategy']))&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['cellLineStackingStrategy'] = $cell['cellLineStackingStrategy'];&nbsp;</div></li><li><div>                      if (isset($cell['cellLineStackingShift']))&nbsp;</div></li><li><div>                          $tablefooter[$i][$js]['cellLineStackingShift'] = $cell['cellLineStackingShift'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($level == 1) {&nbsp;</div></li><li><div>          $this-&gt;_out('___TABLE___BACKGROUNDS' . $this-&gt;uniqstr);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $tableheaderadj = 0;&nbsp;</div></li><li><div>      $tablefooteradj = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tablestartpageno = $this-&gt;page;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Draw Table Contents and Borders</span>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $numrows; $i++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Rows</span></span></span></span>&nbsp;</div></li><li><div>          if ($split && $startrow &gt; 0) {&nbsp;</div></li><li><div>              $thnr = (isset($table['is_thead']) ? count($table['is_thead']) : 0);&nbsp;</div></li><li><div>              if ($i &gt;= $thnr && $i &lt; $startrow) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($i == $startrow) {&nbsp;</div></li><li><div>                  $returny = $rety - $tableheaderrowheight;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Get Maximum row/cell height in row - including rowspan&gt;1 + 1 overlapping</span>&nbsp;</div></li><li><div>          $maxrowheight = $this-&gt;_tableGetMaxRowHeight($table, $i);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $skippage = false;&nbsp;</div></li><li><div>          $newpagestarted = false;&nbsp;</div></li><li><div>          for ($j = $startcol; $j &lt; $numcols; $j++) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Columns</span></span></span></span>&nbsp;</div></li><li><div>              if ($split) {&nbsp;</div></li><li><div>                  if ($table['colPg'][$j] &gt; $splitpg) {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $lastCol = $j;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($cells[$i][$j]) && $cells[$i][$j]) {&nbsp;</div></li><li><div>                  $cell = &$cells[$i][$j];&nbsp;</div></li><li><div>                  if ($split) {&nbsp;</div></li><li><div>                      $lastCol = $j + (isset($cell['colspan']) ? ($cell['colspan'] - 1) : 0);&nbsp;</div></li><li><div>                      list($x, $w) = $this-&gt;_splitTableGetWidth($table, $i, $j);&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      list($x, $w) = $this-&gt;_tableGetWidth($table, $i, $j);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  list($y, $h) = $this-&gt;_tableGetHeight($table, $i, $j);&nbsp;</div></li><li><div>                  $x += $x0;&nbsp;</div></li><li><div>                  $y += $y0;&nbsp;</div></li><li><div>                  $y -= $returny;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                      if (!empty($tablefooter) || $i == ($numrows - 1) || (isset($cell['rowspan']) && ($i + $cell['rowspan']) == $numrows) || (!isset($cell['rowspan']) && ($i + 1) == $numrows)) {&nbsp;</div></li><li><div>                          $extra = $table['padding']['B'] + $table['border_details']['B']['w'] + $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>                          <span class="comment">//$extra = $table['margin']['B'] + $table['padding']['B'] + $table['border_details']['B']['w'] + $table['border_spacing_V']/2;</span>&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $extra = $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $extra = $table['max_cell_border_width']['B'] / 2;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($j == $startcol && ((($y + $maxrowheight + $extra ) &gt; ($pagetrigger + 0.001)) || (($this-&gt;keepColumns || !$this-&gt;ColActive) && !empty($tablefooter) && ($y + $maxrowheight + $tablefooterrowheight + $extra) &gt; $pagetrigger) && ($this-&gt;tableLevel == 1 && $i &lt; ($numrows - $table['headernrows']))) && ($y0 &gt; 0 || $x0 &gt; 0) && !$this-&gt;InFooter && $this-&gt;autoPageBreak) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (!$skippage) {&nbsp;</div></li><li><div>                          $finalSpread = true;&nbsp;</div></li><li><div>                          $firstSpread = true;&nbsp;</div></li><li><div>                          if ($split) {&nbsp;</div></li><li><div>                              for ($t = $startcol; $t &lt; $numcols; $t++) {&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment">// Are there more columns to print on a next page?</span></span>&nbsp;</div></li><li><div>                                  if ($table['colPg'][$t] &gt; $splitpg) {&nbsp;</div></li><li><div>                                      $finalSpread = false;&nbsp;</div></li><li><div>                                      break;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($startcol &gt; 0) {&nbsp;</div></li><li><div>                                  $firstSpread = false;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if (($this-&gt;keepColumns || !$this-&gt;ColActive) && !empty($tablefooter) && $i &gt; 0) {&nbsp;</div></li><li><div>                              $this-&gt;y = $y;&nbsp;</div></li><li><div>                              $ya = $this-&gt;y;&nbsp;</div></li><li><div>                              $this-&gt;TableHeaderFooter($tablefooter, $tablestartpage, $tablestartcolumn, 'F', $level, $firstSpread, $finalSpread);&nbsp;</div></li><li><div>                              if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>                                  $this-&gt;tbrot_h += $this-&gt;y - $ya;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $tablefooteradj = $this-&gt;y - $ya;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $y -= $y0;&nbsp;</div></li><li><div>                          $returny += $y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $oldcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>                          if ($this-&gt;AcceptPageBreak()) {&nbsp;</div></li><li><div>                              $newpagestarted = true;&nbsp;</div></li><li><div>                              $this-&gt;y = $y + $y0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// Move down to account for border-spacing or</span>&nbsp;</div></li><li><div>                              <span class="comment">// extra half border width in case page breaks in middle</span>&nbsp;</div></li><li><div>                              if ($i &gt; 0 && !$this-&gt;table_rotate && $level == 1 && !$this-&gt;ColActive) {&nbsp;</div></li><li><div>                                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                      $adv = $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>                                      <span class="comment">// If table footer</span>&nbsp;</div></li><li><div>                                      if (($this-&gt;keepColumns || !$this-&gt;ColActive) && !empty($tablefooter) && $i &gt; 0) {&nbsp;</div></li><li><div>                                          $adv += ($table['padding']['B'] + $table['border_details']['B']['w']);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $maxbwtop = 0;&nbsp;</div></li><li><div>                                      $maxbwbottom = 0;&nbsp;</div></li><li><div>                                      if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                                          if (!empty($tablefooter)) {&nbsp;</div></li><li><div>                                              $maxbwbottom = $table['max_cell_border_width']['B'];&nbsp;</div></li><li><div>                                          } else {&nbsp;</div></li><li><div>                                              $brow = $i - 1;&nbsp;</div></li><li><div>                                              for ($ctj = 0; $ctj &lt; $numcols; $ctj++) {&nbsp;</div></li><li><div>                                                  if (isset($cells[$brow][$ctj]) && $cells[$brow][$ctj]) {&nbsp;</div></li><li><div>                                                      if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                                                          list($bt, $br, $bb, $bl) = $this-&gt;_getBorderWidths($cells[$brow][$ctj]['borderbin']);&nbsp;</div></li><li><div>                                                      } else {&nbsp;</div></li><li><div>                                                          $bb = $cells[$brow][$ctj]['border_details']['B']['w'];&nbsp;</div></li><li><div>                                                      }&nbsp;</div></li><li><div>                                                      $maxbwbottom = max($maxbwbottom, $bb);&nbsp;</div></li><li><div>                                                  }&nbsp;</div></li><li><div>                                              }&nbsp;</div></li><li><div>                                          }&nbsp;</div></li><li><div>                                          if (!empty($tableheader)) {&nbsp;</div></li><li><div>                                              $maxbwtop = $table['max_cell_border_width']['T'];&nbsp;</div></li><li><div>                                          } else {&nbsp;</div></li><li><div>                                              $trow = $i - 1;&nbsp;</div></li><li><div>                                              for ($ctj = 0; $ctj &lt; $numcols; $ctj++) {&nbsp;</div></li><li><div>                                                  if (isset($cells[$trow][$ctj]) && $cells[$trow][$ctj]) {&nbsp;</div></li><li><div>                                                      if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                                                          list($bt, $br, $bb, $bl) = $this-&gt;_getBorderWidths($cells[$trow][$ctj]['borderbin']);&nbsp;</div></li><li><div>                                                      } else {&nbsp;</div></li><li><div>                                                          $bt = $cells[$trow][$ctj]['border_details']['T']['w'];&nbsp;</div></li><li><div>                                                      }&nbsp;</div></li><li><div>                                                      $maxbwtop = max($maxbwtop, $bt);&nbsp;</div></li><li><div>                                                  }&nbsp;</div></li><li><div>                                              }&nbsp;</div></li><li><div>                                          }&nbsp;</div></li><li><div>                                      } elseif ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                                          $maxbwtop = $table['simple']['border_details']['T']['w'];&nbsp;</div></li><li><div>                                          $maxbwbottom = $table['simple']['border_details']['B']['w'];&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                      $adv = $maxbwbottom / 2;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;y += $adv;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// Rotated table split over pages - needs this-&gt;y for borders/backgrounds</span>&nbsp;</div></li><li><div>                              if ($i &gt; 0 && $this-&gt;table_rotate && $level == 1) {&nbsp;</div></li><li><div>                                  <span class="comment">//            $this-&gt;y = $y0 + $this-&gt;tbrot_w;</span>&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($this-&gt;tableClipPath) {&nbsp;</div></li><li><div>                                  $this-&gt;_out(&quot;Q&quot;);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              $bx = $x0;&nbsp;</div></li><li><div>                              $by = $y0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $bx -= ($table['padding']['L'] + $table['border_details']['L']['w'] + $table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  if ($tablestartpageno != $this-&gt;page) { <span class="comment">// IF already broken across a previous pagebreak</span>&nbsp;</div></li><li><div>                                      $by += $table['max_cell_border_width']['T'] / 2;&nbsp;</div></li><li><div>                                      if (empty($tableheader)) {&nbsp;</div></li><li><div>                                          $by -= ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $by -= ($table['padding']['T'] + $table['border_details']['T']['w'] + $table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              } elseif ($tablestartpageno != $this-&gt;page && !empty($tableheader)) {&nbsp;</div></li><li><div>                                  $by += $maxbwtop / 2;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              $by -= $tableheaderadj;&nbsp;</div></li><li><div>                              $bh = $this-&gt;y - $by + $tablefooteradj;&nbsp;</div></li><li><div>                              if (!$table['borders_separate']) {&nbsp;</div></li><li><div>                                  $bh -= $adv;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($split) {&nbsp;</div></li><li><div>                                  $bw = 0;&nbsp;</div></li><li><div>                                  for ($t = $startcol; $t &lt; $numcols; $t++) {&nbsp;</div></li><li><div>                                      if ($table['colPg'][$t] == $splitpg) {&nbsp;</div></li><li><div>                                          $bw += $table['wc'][$t];&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                      if ($table['colPg'][$t] &gt; $splitpg) {&nbsp;</div></li><li><div>                                          break;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                      if ($firstSpread) {&nbsp;</div></li><li><div>                                          $bw += $table['padding']['L'] + $table['border_details']['L']['w'] + $table['border_spacing_H'];&nbsp;</div></li><li><div>                                      } else {&nbsp;</div></li><li><div>                                          $bx += ($table['padding']['L'] + $table['border_details']['L']['w']);&nbsp;</div></li><li><div>                                          $bw += $table['border_spacing_H'];&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                      if ($finalSpread) {&nbsp;</div></li><li><div>                                          $bw += $table['padding']['R'] + $table['border_details']['R']['w'] / 2 + $table['border_spacing_H'];&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $bw = $table['w'] - ($table['max_cell_border_width']['L'] / 2) - ($table['max_cell_border_width']['R'] / 2) - $table['margin']['L'] - $table['margin']['R'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($this-&gt;splitTableBorderWidth && ($this-&gt;keepColumns || !$this-&gt;ColActive) && empty($tablefooter) && $i &gt; 0 && $table['border_details']['B']['w']) {&nbsp;</div></li><li><div>                                  $prevDrawColor = $this-&gt;DrawColor;&nbsp;</div></li><li><div>                                  $lw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  $this-&gt;SetLineWidth($this-&gt;splitTableBorderWidth);&nbsp;</div></li><li><div>                                  $this-&gt;SetDColor($table['border_details']['B']['c']);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>                                  $blx = $bx;&nbsp;</div></li><li><div>                                  $blw = $bw;&nbsp;</div></li><li><div>                                  if (!$table['borders_separate']) {&nbsp;</div></li><li><div>                                      $blx -= ($table['max_cell_border_width']['L'] / 2);&nbsp;</div></li><li><div>                                      $blw += ($table['max_cell_border_width']['L'] / 2 + $table['max_cell_border_width']['R'] / 2);&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;Line($blx, $this-&gt;y + ($this-&gt;splitTableBorderWidth / 2), $blx + $blw, $this-&gt;y + ($this-&gt;splitTableBorderWidth / 2));&nbsp;</div></li><li><div>                                  $this-&gt;DrawColor = $prevDrawColor;&nbsp;</div></li><li><div>                                  $this-&gt;_out($this-&gt;DrawColor);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineWidth($lw);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if (!$this-&gt;ColActive && ($i &gt; 0 || $j &gt; 0)) {&nbsp;</div></li><li><div>                                  if (isset($table['bgcolor'][-1])) {&nbsp;</div></li><li><div>                                      $color = $this-&gt;ConvertColor($table['bgcolor'][-1]);&nbsp;</div></li><li><div>                                      if ($color) {&nbsp;</div></li><li><div>                                          if (!$table['borders_separate']) {&nbsp;</div></li><li><div>                                              $bh -= $table['max_cell_border_width']['B'] / 2;&nbsp;</div></li><li><div>                                          }&nbsp;</div></li><li><div>                                          $this-&gt;tableBackgrounds[$level * 9][] = array('gradient' =&gt; false, 'x' =&gt; $bx, 'y' =&gt; $by, 'w' =&gt; $bw, 'h' =&gt; $bh, 'col' =&gt; $color);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  if (isset($table['gradient'])) {&nbsp;</div></li><li><div>                                      $g = $this-&gt;grad-&gt;parseBackgroundGradient($table['gradient']);&nbsp;</div></li><li><div>                                      if ($g) {&nbsp;</div></li><li><div>                                          $this-&gt;tableBackgrounds[$level * 9 + 1][] = array('gradient' =&gt; true, 'x' =&gt; $bx, 'y' =&gt; $by, 'w' =&gt; $bw, 'h' =&gt; $bh, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  if (isset($table['background-image'])) {&nbsp;</div></li><li><div>                                      if ($table['background-image']['gradient'] && preg_match('/(-moz-)*(repeating-)*(linear|radial)-gradient/', $table['background-image']['gradient'])) {&nbsp;</div></li><li><div>                                          $g = $this-&gt;grad-&gt;parseMozGradient($table['background-image']['gradient']);&nbsp;</div></li><li><div>                                          if ($g) {&nbsp;</div></li><li><div>                                              $this-&gt;tableBackgrounds[$level * 9 + 1][] = array('gradient' =&gt; true, 'x' =&gt; $bx, 'y' =&gt; $by, 'w' =&gt; $bw, 'h' =&gt; $bh, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                                          }&nbsp;</div></li><li><div>                                      } else {&nbsp;</div></li><li><div>                                          $image_id = $table['background-image']['image_id'];&nbsp;</div></li><li><div>                                          $orig_w = $table['background-image']['orig_w'];&nbsp;</div></li><li><div>                                          $orig_h = $table['background-image']['orig_h'];&nbsp;</div></li><li><div>                                          $x_pos = $table['background-image']['x_pos'];&nbsp;</div></li><li><div>                                          $y_pos = $table['background-image']['y_pos'];&nbsp;</div></li><li><div>                                          $x_repeat = $table['background-image']['x_repeat'];&nbsp;</div></li><li><div>                                          $y_repeat = $table['background-image']['y_repeat'];&nbsp;</div></li><li><div>                                          $resize = $table['background-image']['resize'];&nbsp;</div></li><li><div>                                          $opacity = $table['background-image']['opacity'];&nbsp;</div></li><li><div>                                          $itype = $table['background-image']['itype'];&nbsp;</div></li><li><div>                                          $this-&gt;tableBackgrounds[$level * 9 + 2][] = array('x' =&gt; $bx, 'y' =&gt; $by, 'w' =&gt; $bw, 'h' =&gt; $bh, 'image_id' =&gt; $image_id, 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $x_pos, 'y_pos' =&gt; $y_pos, 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'clippath' =&gt; '', 'resize' =&gt; $resize, 'opacity' =&gt; $opacity, 'itype' =&gt; $itype);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// $this-&gt;AcceptPageBreak() has moved tablebuffer to $this-&gt;pages content</span>&nbsp;</div></li><li><div>                              if ($this-&gt;tableBackgrounds) {&nbsp;</div></li><li><div>                                  $s = $this-&gt;PrintTableBackgrounds();&nbsp;</div></li><li><div>                                  if ($this-&gt;bufferoutput) {&nbsp;</div></li><li><div>                                      $this-&gt;headerbuffer = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', '\\1' . &quot;\n&quot; . $s . &quot;\n&quot;, $this-&gt;headerbuffer);&nbsp;</div></li><li><div>                                      $this-&gt;headerbuffer = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', &quot; &quot;, $this-&gt;headerbuffer);&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $this-&gt;pages[$this-&gt;page] = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', '\\1' . &quot;\n&quot; . $s . &quot;\n&quot;, $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>                                      $this-&gt;pages[$this-&gt;page] = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', &quot; &quot;, $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds = array();&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($split) {&nbsp;</div></li><li><div>                                  if ($i == 0 && $j == 0) {&nbsp;</div></li><li><div>                                      $y0 = -1;&nbsp;</div></li><li><div>                                  } elseif ($finalSpread) {&nbsp;</div></li><li><div>                                      $splitpg = 0;&nbsp;</div></li><li><div>                                      $startcol = 0;&nbsp;</div></li><li><div>                                      $startrow = $i;&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $splitpg++;&nbsp;</div></li><li><div>                                      $startcol = $t;&nbsp;</div></li><li><div>                                      $returny -= $y;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  return array(false, $startrow, $startcol, $splitpg, $returny, $y0);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              $this-&gt;_out('___TABLE___BACKGROUNDS' . $this-&gt;uniqstr);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($this-&gt;tableClipPath) {&nbsp;</div></li><li><div>                                  $this-&gt;_out($this-&gt;tableClipPath);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Added to correct for OddEven Margins</span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                              $x = $x + $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                              $x0 = $x0 + $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($this-&gt;splitTableBorderWidth && ($this-&gt;keepColumns || !$this-&gt;ColActive) && empty($tableheader) && $i &gt; 0 && $table['border_details']['T']['w']) {&nbsp;</div></li><li><div>                                  $prevDrawColor = $this-&gt;DrawColor;&nbsp;</div></li><li><div>                                  $lw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>                                  $this-&gt;SetLineWidth($this-&gt;splitTableBorderWidth);&nbsp;</div></li><li><div>                                  $this-&gt;SetDColor($table['border_details']['T']['c']);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineJoin(0);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineCap(0);&nbsp;</div></li><li><div>                                  $blx += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>                                  $this-&gt;Line($blx, $this-&gt;y - ($this-&gt;splitTableBorderWidth / 2), $blx + $blw, $this-&gt;y - ($this-&gt;splitTableBorderWidth / 2));&nbsp;</div></li><li><div>                                  $this-&gt;DrawColor = $prevDrawColor;&nbsp;</div></li><li><div>                                  $this-&gt;_out($this-&gt;DrawColor);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineWidth($lw);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineJoin(2);&nbsp;</div></li><li><div>                                  $this-&gt;SetLineCap(2);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// Move down to account for half of top border-spacing or</span>&nbsp;</div></li><li><div>                              <span class="comment">// extra half border width in case page was broken in middle</span>&nbsp;</div></li><li><div>                              if ($i &gt; 0 && !$this-&gt;table_rotate && $level == 1 && $table['headernrows'] == 0) {&nbsp;</div></li><li><div>                                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                      $adv = $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $maxbwtop = 0;&nbsp;</div></li><li><div>                                      for ($ctj = 0; $ctj &lt; $numcols; $ctj++) {&nbsp;</div></li><li><div>                                          if (isset($cells[$i][$ctj]) && $cells[$i][$ctj]) {&nbsp;</div></li><li><div>                                              if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                                                  if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                                                      list($bt, $br, $bb, $bl) = $this-&gt;_getBorderWidths($cells[$i][$ctj]['borderbin']);&nbsp;</div></li><li><div>                                                  } else {&nbsp;</div></li><li><div>                                                      $bt = $cells[$i][$ctj]['border_details']['T']['w'];&nbsp;</div></li><li><div>                                                  }&nbsp;</div></li><li><div>                                                  $maxbwtop = max($maxbwtop, $bt);&nbsp;</div></li><li><div>                                              } elseif ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                                                  $maxbwtop = max($maxbwtop, $table['simple']['border_details']['T']['w']);&nbsp;</div></li><li><div>                                              }&nbsp;</div></li><li><div>                                          }&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                      $adv = $maxbwtop / 2;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;y += $adv;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>                                  $this-&gt;tbrot_x0 = $this-&gt;lMargin + $this-&gt;blk[$this-&gt;blklvl]['outer_left_margin'] + $this-&gt;blk[$this-&gt;blklvl]['padding_left'] + $this-&gt;blk[$this-&gt;blklvl]['border_left']['w'];&nbsp;</div></li><li><div>                                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                      $this-&gt;tbrot_h = $table['margin']['T'] + $table['padding']['T'] + $table['border_details']['T']['w'] + $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $this-&gt;tbrot_h = $table['margin']['T'] + $table['max_cell_border_width']['T'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;tbrot_y0 = $this-&gt;y;&nbsp;</div></li><li><div>                                  $pagetrigger = $y0 - $tableheaderadj + ($this-&gt;blk[$this-&gt;blklvl]['inner_width']);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $pagetrigger = $this-&gt;PageBreakTrigger;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ($this-&gt;kwt_saved && $level == 1) {&nbsp;</div></li><li><div>                                  $this-&gt;kwt_moved = true;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if (!empty($tableheader)) {&nbsp;</div></li><li><div>                                  $ya = $this-&gt;y;&nbsp;</div></li><li><div>                                  $this-&gt;TableHeaderFooter($tableheader, $tablestartpage, $tablestartcolumn, 'H', $level);&nbsp;</div></li><li><div>                                  if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>                                      $this-&gt;tbrot_h = $this-&gt;y - $ya;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $tableheaderadj = $this-&gt;y - $ya;&nbsp;</div></li><li><div>                              } elseif ($i == 0 && !$this-&gt;table_rotate && $level == 1 && !$this-&gt;ColActive) {&nbsp;</div></li><li><div>                                  <span class="comment">// Advance down page</span>&nbsp;</div></li><li><div>                                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                      $adv = $table['border_spacing_V'] / 2 + $table['border_details']['T']['w'] + $table['padding']['T'];&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $adv = $table['max_cell_border_width']['T'] / 2;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($adv) {&nbsp;</div></li><li><div>                                      if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>                                          $this-&gt;y += ($adv);&nbsp;</div></li><li><div>                                      } else {&nbsp;</div></li><li><div>                                          $this-&gt;DivLn($adv, $this-&gt;blklvl, true);&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              $outerfilled = 0;&nbsp;</div></li><li><div>                              $y = $y0 = $this-&gt;y;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLS</span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// COLUMN CHANGE</span></span></span></span></span>&nbsp;</div></li><li><div>                          if ($this-&gt;CurrCol != $oldcolumn) {&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment">// Added to correct for Columns</span></span>&nbsp;</div></li><li><div>                              $x += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                              $x0 += $this-&gt;ChangeColumn * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                              if ($this-&gt;CurrCol == 0) {  <span class="comment">// just added a page - possibly with tableheader</span>&nbsp;</div></li><li><div>                                  $y0 = $this-&gt;y;  <span class="comment"><span class="comment">// this-&gt;y0 is global used by Columns - $y0 is internal to tablewrite</span></span>&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $y0 = $this-&gt;y0;  <span class="comment"><span class="comment">// this-&gt;y0 is global used by Columns - $y0 is internal to tablewrite</span></span>&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $y = $y0;&nbsp;</div></li><li><div>                              $outerfilled = 0;&nbsp;</div></li><li><div>                              if ($this-&gt;CurrCol != 0 && ($this-&gt;keepColumns && $this-&gt;ColActive) && !empty($tableheader) && $i &gt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;x = $x;&nbsp;</div></li><li><div>                                  $this-&gt;y = $y;&nbsp;</div></li><li><div>                                  $this-&gt;TableHeaderFooter($tableheader, $tablestartpage, $tablestartcolumn, 'H', $level);&nbsp;</div></li><li><div>                                  $y0 = $y = $this-&gt;y;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $skippage = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $this-&gt;x = $x;&nbsp;</div></li><li><div>                  $this-&gt;y = $y;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;kwt_saved && $level == 1) {&nbsp;</div></li><li><div>                      $this-&gt;printkwtbuffer();&nbsp;</div></li><li><div>                      $x0 = $x = $this-&gt;x;&nbsp;</div></li><li><div>                      $y0 = $y = $this-&gt;y;&nbsp;</div></li><li><div>                      $this-&gt;kwt_moved = false;&nbsp;</div></li><li><div>                      $this-&gt;kwt_saved = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Set the Page & Column where table actually starts</span>&nbsp;</div></li><li><div>                  if ($i == 0 && $j == 0 && $level == 1) {&nbsp;</div></li><li><div>                      if (($this-&gt;mirrorMargins) && (($this-&gt;page) % 2 == 0)) {    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $tablestartpage = 'EVEN';&nbsp;</div></li><li><div>                      } elseif (($this-&gt;mirrorMargins) && (($this-&gt;page) % 2 == 1)) {    <span class="comment"><span class="comment"><span class="comment">// ODD</span></span></span>&nbsp;</div></li><li><div>                          $tablestartpage = 'ODD';&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $tablestartpage = '';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $tablestartpageno = $this-&gt;page;&nbsp;</div></li><li><div>                      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                          $tablestartcolumn = $this-&gt;CurrCol;&nbsp;</div></li><li><div>                      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//ALIGN</span>&nbsp;</div></li><li><div>                  $align = $cell['a'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// If outside columns, this is done in PaintDivBB</span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">//OUTER FILL BGCOLOR of DIVS</span></span>&nbsp;</div></li><li><div>                      if ($this-&gt;blklvl &gt; 0 && ($j == 0) && !$this-&gt;table_rotate && $level == 1) {&nbsp;</div></li><li><div>                          $firstblockfill = $this-&gt;GetFirstBlockFill();&nbsp;</div></li><li><div>                          if ($firstblockfill && $this-&gt;blklvl &gt;= $firstblockfill) {&nbsp;</div></li><li><div>                              $divh = $maxrowheight;&nbsp;</div></li><li><div>                              <span class="comment">// Last row</span>&nbsp;</div></li><li><div>                              if ((!isset($cell['rowspan']) && $i == $numrows - 1) || (isset($cell['rowspan']) && (($i == $numrows - 1 && $cell['rowspan'] &lt; 2) || ($cell['rowspan'] &gt; 1 && ($i + $cell['rowspan'] - 1) == $numrows - 1)))) {&nbsp;</div></li><li><div>                                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                      $adv = $table['margin']['B'] + $table['padding']['B'] + $table['border_details']['B']['w'] + $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $adv = $table['margin']['B'] + $table['max_cell_border_width']['B'] / 2;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $divh += $adv;  <span class="comment">//last row: fill bottom half of bottom border (y advanced at end)</span>&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if (($this-&gt;y + $divh) &gt; $outerfilled) { <span class="comment">// if not already painted by previous rowspan</span>&nbsp;</div></li><li><div>                                  $bak_x = $this-&gt;x;&nbsp;</div></li><li><div>                                  $bak_y = $this-&gt;y;&nbsp;</div></li><li><div>                                  if ($outerfilled &gt; $this-&gt;y) {&nbsp;</div></li><li><div>                                      $divh = ($this-&gt;y + $divh) - $outerfilled;&nbsp;</div></li><li><div>                                      $this-&gt;y = $outerfilled;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  $this-&gt;DivLn($divh, -3, false);&nbsp;</div></li><li><div>                                  $outerfilled = $this-&gt;y + $divh;&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment"><span class="comment">// Reset</span> current block fill</span></span>&nbsp;</div></li><li><div>                                  $bcor = $this-&gt;blk[$this-&gt;blklvl]['bgcolorarray'];&nbsp;</div></li><li><div>                                  if ($bcor)&nbsp;</div></li><li><div>                                      $this-&gt;SetFColor($bcor);&nbsp;</div></li><li><div>                                  $this-&gt;x = $bak_x;&nbsp;</div></li><li><div>                                  $this-&gt;y = $bak_y;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//TABLE BACKGROUND FILL BGCOLOR - for cellSpacing</span>&nbsp;</div></li><li><div>                  if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                      if ($table['borders_separate']) {&nbsp;</div></li><li><div>                          $fill = isset($table['bgcolor'][-1]) ? $table['bgcolor'][-1] : 0;&nbsp;</div></li><li><div>                          if ($fill) {&nbsp;</div></li><li><div>                              $color = $this-&gt;ConvertColor($fill);&nbsp;</div></li><li><div>                              if ($color) {&nbsp;</div></li><li><div>                                  $xadj = ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $yadj = ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                  $wadj = $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $hadj = $table['border_spacing_V'];&nbsp;</div></li><li><div>                                  if ($i == 0) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span>&nbsp;</div></li><li><div>                                      $yadj += $table['padding']['T'] + $table['border_details']['T']['w'];&nbsp;</div></li><li><div>                                      $hadj += $table['padding']['T'] + $table['border_details']['T']['w'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($j == 0) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span>&nbsp;</div></li><li><div>                                      $xadj += $table['padding']['L'] + $table['border_details']['L']['w'];&nbsp;</div></li><li><div>                                      $wadj += $table['padding']['L'] + $table['border_details']['L']['w'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($i == ($numrows - 1) || (isset($cell['rowspan']) && ($i + $cell['rowspan']) == $numrows) || (!isset($cell['rowspan']) && ($i + 1) == $numrows)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>                                      $hadj += $table['padding']['B'] + $table['border_details']['B']['w'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  if ($j == ($numcols - 1) || (isset($cell['colspan']) && ($j + $cell['colspan']) == $numcols) || (!isset($cell['colspan']) && ($j + 1) == $numcols)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span>&nbsp;</div></li><li><div>                                      $wadj += $table['padding']['R'] + $table['border_details']['R']['w'];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $this-&gt;SetFColor($color);&nbsp;</div></li><li><div>                                  $this-&gt;Rect($x - $xadj, $y - $yadj, $w + $wadj, $h + $hadj, 'F');&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($table['empty_cells'] != 'hide' || !empty($cell['textbuffer']) || (isset($cell['nestedcontent']) && $cell['nestedcontent']) || !$table['borders_separate']) {&nbsp;</div></li><li><div>                      $paintcell = true;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $paintcell = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Set Borders</span>&nbsp;</div></li><li><div>                  $bord = 0;&nbsp;</div></li><li><div>                  $bord_det = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                      if ($this-&gt;packTableData) {&nbsp;</div></li><li><div>                          $c = $this-&gt;_unpackCellBorder($cell['borderbin']);&nbsp;</div></li><li><div>                          $bord = $c['border'];&nbsp;</div></li><li><div>                          $bord_det = $c['border_details'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $bord = $cell['border'];&nbsp;</div></li><li><div>                          $bord_det = $cell['border_details'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                      $bord = $table['simple']['border'];&nbsp;</div></li><li><div>                      $bord_det = $table['simple']['border_details'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//TABLE ROW OR CELL FILL BGCOLOR</span></span>&nbsp;</div></li><li><div>                  $fill = 0;&nbsp;</div></li><li><div>                  if (isset($cell['bgcolor']) && $cell['bgcolor'] && $cell['bgcolor'] != 'transparent') {&nbsp;</div></li><li><div>                      $fill = $cell['bgcolor'];&nbsp;</div></li><li><div>                      $leveladj = 6;&nbsp;</div></li><li><div>                  } elseif (isset($table['bgcolor'][$i]) && $table['bgcolor'][$i] && $table['bgcolor'][$i] != 'transparent') { <span class="comment"><span class="comment">// Row color</span></span>&nbsp;</div></li><li><div>                      $fill = $table['bgcolor'][$i];&nbsp;</div></li><li><div>                      $leveladj = 3;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($fill && $paintcell) {&nbsp;</div></li><li><div>                      $color = $this-&gt;ConvertColor($fill);&nbsp;</div></li><li><div>                      if ($color) {&nbsp;</div></li><li><div>                          if ($table['borders_separate']) {&nbsp;</div></li><li><div>                              if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                                  $this-&gt;SetFColor($color);&nbsp;</div></li><li><div>                                  $this-&gt;Rect($x + ($table['border_spacing_H'] / 2), $y + ($table['border_spacing_V'] / 2), $w - $table['border_spacing_H'], $h - $table['border_spacing_V'], 'F');&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + $leveladj][] = array('gradient' =&gt; false, 'x' =&gt; ($x + ($table['border_spacing_H'] / 2)), 'y' =&gt; ($y + ($table['border_spacing_V'] / 2)), 'w' =&gt; ($w - $table['border_spacing_H']), 'h' =&gt; ($h - $table['border_spacing_V']), 'col' =&gt; $color);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                                  $this-&gt;SetFColor($color);&nbsp;</div></li><li><div>                                  $this-&gt;Rect($x, $y, $w, $h, 'F');&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + $leveladj][] = array('gradient' =&gt; false, 'x' =&gt; $x, 'y' =&gt; $y, 'w' =&gt; $w, 'h' =&gt; $h, 'col' =&gt; $color);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($cell['gradient']) && $cell['gradient'] && $paintcell) {&nbsp;</div></li><li><div>                      $g = $this-&gt;grad-&gt;parseBackgroundGradient($cell['gradient']);&nbsp;</div></li><li><div>                      if ($g) {&nbsp;</div></li><li><div>                          if ($table['borders_separate']) {&nbsp;</div></li><li><div>                              $px = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                              $py = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                              $pw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                              $ph = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $px = $x;&nbsp;</div></li><li><div>                              $py = $y;&nbsp;</div></li><li><div>                              $pw = $w;&nbsp;</div></li><li><div>                              $ph = $h;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                              $this-&gt;grad-&gt;Gradient($px, $py, $pw, $ph, $g['type'], $g['stops'], $g['colorspace'], $g['coords'], $g['extend']);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;tableBackgrounds[$level * 9 + 7][] = array('gradient' =&gt; true, 'x' =&gt; $px, 'y' =&gt; $py, 'w' =&gt; $pw, 'h' =&gt; $ph, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($cell['background-image']) && $paintcell) {&nbsp;</div></li><li><div>                      if (isset($cell['background-image']['gradient']) && $cell['background-image']['gradient'] && preg_match('/(-moz-)*(repeating-)*(linear|radial)-gradient/', $cell['background-image']['gradient'])) {&nbsp;</div></li><li><div>                          $g = $this-&gt;grad-&gt;parseMozGradient($cell['background-image']['gradient']);&nbsp;</div></li><li><div>                          if ($g) {&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $px = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $py = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                  $pw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $ph = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $px = $x;&nbsp;</div></li><li><div>                                  $py = $y;&nbsp;</div></li><li><div>                                  $pw = $w;&nbsp;</div></li><li><div>                                  $ph = $h;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                                  $this-&gt;grad-&gt;Gradient($px, $py, $pw, $ph, $g['type'], $g['stops'], $g['colorspace'], $g['coords'], $g['extend']);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 7][] = array('gradient' =&gt; true, 'x' =&gt; $px, 'y' =&gt; $py, 'w' =&gt; $pw, 'h' =&gt; $ph, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } elseif (isset($cell['background-image']['image_id']) && $cell['background-image']['image_id']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Background pattern</span></span></span></span>&nbsp;</div></li><li><div>                          $n = count($this-&gt;patterns) + 1;&nbsp;</div></li><li><div>                          if ($table['borders_separate']) {&nbsp;</div></li><li><div>                              $px = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                              $py = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                              $pw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                              $ph = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $px = $x;&nbsp;</div></li><li><div>                              $py = $y;&nbsp;</div></li><li><div>                              $pw = $w;&nbsp;</div></li><li><div>                              $ph = $h;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>                              list($orig_w, $orig_h, $x_repeat, $y_repeat) = $this-&gt;_resizeBackgroundImage($cell['background-image']['orig_w'], $cell['background-image']['orig_h'], $pw, $ph, $cell['background-image']['resize'], $cell['background-image']['x_repeat'], $cell['background-image']['y_repeat']);&nbsp;</div></li><li><div>                              $this-&gt;patterns[$n] = array('x' =&gt; $px, 'y' =&gt; $py, 'w' =&gt; $pw, 'h' =&gt; $ph, 'pgh' =&gt; $this-&gt;h, 'image_id' =&gt; $cell['background-image']['image_id'], 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $cell['background-image']['x_pos'], 'y_pos' =&gt; $cell['background-image']['y_pos'], 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat);&nbsp;</div></li><li><div>                              if ($cell['background-image']['opacity'] &gt; 0 && $cell['background-image']['opacity'] &lt; 1) {&nbsp;</div></li><li><div>                                  $opac = $this-&gt;SetAlpha($cell['background-image']['opacity'], 'Normal', true);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $opac = '';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $this-&gt;_out(sprintf('q /Pattern cs /P%d scn %s %.3F %.3F %.3F %.3F re f Q', $n, $opac, $px * _MPDFK, ($this-&gt;h - $py) * _MPDFK, $pw * _MPDFK, -$ph * _MPDFK));&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $image_id = $cell['background-image']['image_id'];&nbsp;</div></li><li><div>                              $orig_w = $cell['background-image']['orig_w'];&nbsp;</div></li><li><div>                              $orig_h = $cell['background-image']['orig_h'];&nbsp;</div></li><li><div>                              $x_pos = $cell['background-image']['x_pos'];&nbsp;</div></li><li><div>                              $y_pos = $cell['background-image']['y_pos'];&nbsp;</div></li><li><div>                              $x_repeat = $cell['background-image']['x_repeat'];&nbsp;</div></li><li><div>                              $y_repeat = $cell['background-image']['y_repeat'];&nbsp;</div></li><li><div>                              $resize = $cell['background-image']['resize'];&nbsp;</div></li><li><div>                              $opacity = $cell['background-image']['opacity'];&nbsp;</div></li><li><div>                              $itype = $cell['background-image']['itype'];&nbsp;</div></li><li><div>                              $this-&gt;tableBackgrounds[$level * 9 + 8][] = array('x' =&gt; $px, 'y' =&gt; $py, 'w' =&gt; $pw, 'h' =&gt; $ph, 'image_id' =&gt; $image_id, 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $x_pos, 'y_pos' =&gt; $y_pos, 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'clippath' =&gt; '', 'resize' =&gt; $resize, 'opacity' =&gt; $opacity, 'itype' =&gt; $itype);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if (isset($cell['colspan']) && $cell['colspan'] &gt; 1) {&nbsp;</div></li><li><div>                      $ccolsp = $cell['colspan'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $ccolsp = 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($cell['rowspan']) && $cell['rowspan'] &gt; 1) {&nbsp;</div></li><li><div>                      $crowsp = $cell['rowspan'];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $crowsp = 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// but still need to do this for repeated headers...</span>&nbsp;</div></li><li><div>                  if (!$table['borders_separate'] && $this-&gt;tabletheadjustfinished && !$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                      if (isset($table['topntail']) && $table['topntail']) {&nbsp;</div></li><li><div>                          $bord_det['T'] = $this-&gt;border_details($table['topntail']);&nbsp;</div></li><li><div>                          $bord_det['T']['w'] /= $this-&gt;shrin_k;&nbsp;</div></li><li><div>                          $this-&gt;setBorder($bord, _BORDER_TOP);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (isset($table['thead-underline']) && $table['thead-underline']) {&nbsp;</div></li><li><div>                          $bord_det['T'] = $this-&gt;border_details($table['thead-underline']);&nbsp;</div></li><li><div>                          $bord_det['T']['w'] /= $this-&gt;shrin_k;&nbsp;</div></li><li><div>                          $this-&gt;setBorder($bord, _BORDER_TOP);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//Get info of first row ==&gt;&gt; table header</span>&nbsp;</div></li><li><div>                  <span class="comment">//Use &gt; 1 row if THEAD</span>&nbsp;</div></li><li><div>                  if (isset($table['is_thead'][$i]) && $table['is_thead'][$i] && $level == 1) {&nbsp;</div></li><li><div>                      if ($j == 0)&nbsp;</div></li><li><div>                          $tableheaderrowheight += $table['hr'][$i];&nbsp;</div></li><li><div>                      $tableheader[$i][0]['trbackground-images'] = (isset($table['trbackground-images'][$i]) ? $table['trbackground-images'][$i] : null);&nbsp;</div></li><li><div>                      $tableheader[$i][0]['trgradients'] = (isset($table['trgradients'][$i]) ? $table['trgradients'][$i] : null);&nbsp;</div></li><li><div>                      $tableheader[$i][0]['trbgcolor'] = (isset($table['bgcolor'][$i]) ? $table['bgcolor'][$i] : null);&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['x'] = $x;&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['y'] = $y;&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['h'] = $h;&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['w'] = $w;&nbsp;</div></li><li><div>                      if (isset($cell['textbuffer'])) {&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['textbuffer'] = $cell['textbuffer'];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['textbuffer'] = '';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['a'] = $cell['a'];&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['R'] = $cell['R'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['va'] = $cell['va'];&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['mih'] = $cell['mih'];&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['gradient'] = (isset($cell['gradient']) ? $cell['gradient'] : null); <span class="comment"><span class="comment"><span class="comment"><span class="comment">// *BACKGROUNDS*</span></span></span></span>&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['background-image'] = (isset($cell['background-image']) ? $cell['background-image'] : null); <span class="comment"><span class="comment"><span class="comment"><span class="comment">// *BACKGROUNDS*</span></span></span></span>&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['rowspan'] = (isset($cell['rowspan']) ? $cell['rowspan'] : null);&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['colspan'] = (isset($cell['colspan']) ? $cell['colspan'] : null);&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['bgcolor'] = $cell['bgcolor'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['border'] = $bord;&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['border_details'] = $bord_det;&nbsp;</div></li><li><div>                      } elseif ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['border'] = $table['simple']['border'];&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['border_details'] = $table['simple']['border_details'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $tableheader[$i][$j]['padding'] = $cell['padding'];&nbsp;</div></li><li><div>                      if (isset($cell['direction']))&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['direction'] = $cell['direction'];&nbsp;</div></li><li><div>                      if (isset($cell['cellLineHeight']))&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['cellLineHeight'] = $cell['cellLineHeight'];&nbsp;</div></li><li><div>                      if (isset($cell['cellLineStackingStrategy']))&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['cellLineStackingStrategy'] = $cell['cellLineStackingStrategy'];&nbsp;</div></li><li><div>                      if (isset($cell['cellLineStackingShift']))&nbsp;</div></li><li><div>                          $tableheader[$i][$j]['cellLineStackingShift'] = $cell['cellLineStackingShift'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// CELL BORDER</span>&nbsp;</div></li><li><div>                  if ($bord) {&nbsp;</div></li><li><div>                      if ($table['borders_separate'] && $paintcell) {&nbsp;</div></li><li><div>                          $this-&gt;_tableRect($x + ($table['border_spacing_H'] / 2) + ($bord_det['L']['w'] / 2), $y + ($table['border_spacing_V'] / 2) + ($bord_det['T']['w'] / 2), $w - $table['border_spacing_H'] - ($bord_det['L']['w'] / 2) - ($bord_det['R']['w'] / 2), $h - $table['border_spacing_V'] - ($bord_det['T']['w'] / 2) - ($bord_det['B']['w'] / 2), $bord, $bord_det, false, $table['borders_separate']);&nbsp;</div></li><li><div>                      } elseif (!$table['borders_separate']) {&nbsp;</div></li><li><div>                          $this-&gt;_tableRect($x, $y, $w, $h, $bord, $bord_det, true, $table['borders_separate']);  <span class="comment"><span class="comment">// true causes buffer</span></span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">//VERTICAL ALIGN</span>&nbsp;</div></li><li><div>                  if ($cell['R'] && INTVAL($cell['R']) &gt; 0 && INTVAL($cell['R']) &lt; 90 && isset($cell['va']) && $cell['va'] != 'B') {&nbsp;</div></li><li><div>                      $cell['va'] = 'B';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (!isset($cell['va']) || $cell['va'] == 'M')&nbsp;</div></li><li><div>                      $this-&gt;y += ($h - $cell['mih']) / 2;&nbsp;</div></li><li><div>                  elseif (isset($cell['va']) && $cell['va'] == 'B')&nbsp;</div></li><li><div>                      $this-&gt;y += $h - $cell['mih'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// NESTED CONTENT</span>&nbsp;</div></li><li><div>                  <span class="comment">// TEXT</span> (and nested tables)&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $this-&gt;divwidth = $w;&nbsp;</div></li><li><div>                  if (!empty($cell['textbuffer'])) {&nbsp;</div></li><li><div>                      $this-&gt;cellTextAlign = $align;&nbsp;</div></li><li><div>                      $this-&gt;cellLineHeight = $cell['cellLineHeight'];&nbsp;</div></li><li><div>                      $this-&gt;cellLineStackingStrategy = $cell['cellLineStackingStrategy'];&nbsp;</div></li><li><div>                      $this-&gt;cellLineStackingShift = $cell['cellLineStackingShift'];&nbsp;</div></li><li><div>                      if ($level == 1) {&nbsp;</div></li><li><div>                          if (isset($table['is_tfoot'][$i]) && $table['is_tfoot'][$i]) {&nbsp;</div></li><li><div>                              if (preg_match('/{colsum([0-9]*)[_]*}/', $cell['textbuffer'][0][0], $m)) {&nbsp;</div></li><li><div>                                  $rep = sprintf(&quot;%01.&quot; . intval($m[1]) . &quot;f&quot;, $this-&gt;colsums[$j]);&nbsp;</div></li><li><div>                                  $cell['textbuffer'][0][0] = preg_replace('/{colsum[0-9_]*}/', $rep, $cell['textbuffer'][0][0]);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } elseif (!isset($table['is_thead'][$i])) {&nbsp;</div></li><li><div>                              if (isset($this-&gt;colsums[$j])) {&nbsp;</div></li><li><div>                                  $this-&gt;colsums[$j] += floatval(preg_replace('/^[^0-9\.\, ]*/', '', $cell['textbuffer'][0][0]));&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;colsums[$j] = floatval(preg_replace('/^[^0-9\.\, ]*/', '', $cell['textbuffer'][0][0]));&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $opy = $this-&gt;y;&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF ITERATION</span></span></span></span>&nbsp;</div></li><li><div>                      if ($this-&gt;iterationCounter) {&nbsp;</div></li><li><div>                          foreach ($cell['textbuffer'] AS $k =&gt; $t) {&nbsp;</div></li><li><div>                              if (preg_match('/{iteration ([a-zA-Z0-9_]+)}/', $t[0], $m)) {&nbsp;</div></li><li><div>                                  $vname = '__' . $m[1] . '_';&nbsp;</div></li><li><div>                                  if (!isset($this-&gt;$vname)) {&nbsp;</div></li><li><div>                                      $this-&gt;$vname = 1;&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $this-&gt;$vname++;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $cell['textbuffer'][$k][0] = preg_replace('/{iteration ' . $m[1] . '}/', $this-&gt;$vname, $cell['textbuffer'][$k][0]);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ($cell['R']) {&nbsp;</div></li><li><div>                          $cellPtSize = $cell['textbuffer'][0][11] / $this-&gt;shrin_k;&nbsp;</div></li><li><div>                          if (!$cellPtSize) {&nbsp;</div></li><li><div>                              $cellPtSize = $this-&gt;default_font_size;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $cellFontHeight = ($cellPtSize / _MPDFK);&nbsp;</div></li><li><div>                          $opx = $this-&gt;x;&nbsp;</div></li><li><div>                          $angle = INTVAL($cell['R']);&nbsp;</div></li><li><div>                          <span class="comment">// Only allow 45 to 89 degrees (when bottom-aligned) or exactly 90 or -90</span>&nbsp;</div></li><li><div>                          if ($angle &gt; 90) {&nbsp;</div></li><li><div>                              $angle = 90;&nbsp;</div></li><li><div>                          } elseif ($angle &gt; 0 && $angle &lt; 45) {&nbsp;</div></li><li><div>                              $angle = 45;&nbsp;</div></li><li><div>                          } elseif ($angle &lt; 0) {&nbsp;</div></li><li><div>                              $angle = -90;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $offset = ((sin(deg2rad($angle))) * 0.37 * $cellFontHeight);&nbsp;</div></li><li><div>                          if (isset($cell['a']) && $cell['a'] == 'R') {&nbsp;</div></li><li><div>                              $this-&gt;x += ($w) + ($offset) - ($cellFontHeight / 3) - ($cell['padding']['R'] + ($table['border_spacing_H'] / 2));&nbsp;</div></li><li><div>                          } elseif (!isset($cell['a']) || $cell['a'] == 'C') {&nbsp;</div></li><li><div>                              $this-&gt;x += ($w / 2) + ($offset);&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;x += ($offset) + ($cellFontHeight / 3) + ($cell['padding']['L'] + ($table['border_spacing_H'] / 2));&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $str = '';&nbsp;</div></li><li><div>                          foreach ($cell['textbuffer'] AS $t) {&nbsp;</div></li><li><div>                              $str .= $t[0] . ' ';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $str = rtrim($str);&nbsp;</div></li><li><div>                          if (!isset($cell['va']) || $cell['va'] == 'M') {&nbsp;</div></li><li><div>                              $this-&gt;y -= ($h - $cell['mih']) / 2; <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Undo what was added earlier VERTICAL ALIGN</span></span></span></span>&nbsp;</div></li><li><div>                              if ($angle &gt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += (($h - $cell['mih']) / 2) + $cell['padding']['T'] + ($cell['mih'] - ($cell['padding']['T'] + $cell['padding']['B']));&nbsp;</div></li><li><div>                              } elseif ($angle &lt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += (($h - $cell['mih']) / 2) + ($cell['padding']['T'] + ($table['border_spacing_V'] / 2));&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } elseif (isset($cell['va']) && $cell['va'] == 'B') {&nbsp;</div></li><li><div>                              $this-&gt;y -= $h - $cell['mih']; <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Undo what was added earlier VERTICAL ALIGN</span></span></span></span>&nbsp;</div></li><li><div>                              if ($angle &gt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += $h - ($cell['padding']['B'] + ($table['border_spacing_V'] / 2));&nbsp;</div></li><li><div>                              } elseif ($angle &lt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += $h - $cell['mih'] + ($cell['padding']['T'] + ($table['border_spacing_V'] / 2));&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } elseif (isset($cell['va']) && $cell['va'] == 'T') {&nbsp;</div></li><li><div>                              if ($angle &gt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += $cell['mih'] - ($cell['padding']['B'] + ($table['border_spacing_V'] / 2));&nbsp;</div></li><li><div>                              } elseif ($angle &lt; 0) {&nbsp;</div></li><li><div>                                  $this-&gt;y += ($cell['padding']['T'] + ($table['border_spacing_V'] / 2));&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;Rotate($angle, $this-&gt;x, $this-&gt;y);&nbsp;</div></li><li><div>                          $s_fs = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>                          $s_f = $this-&gt;FontFamily;&nbsp;</div></li><li><div>                          $s_st = $this-&gt;FontStyle;&nbsp;</div></li><li><div>                          if (!empty($cell['textbuffer'][0][3])) { <span class="comment"><span class="comment"><span class="comment">//Font Color</span></span></span>&nbsp;</div></li><li><div>                              $cor = $cell['textbuffer'][0][3];&nbsp;</div></li><li><div>                              $this-&gt;SetTColor($cor);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;SetFont($cell['textbuffer'][0][4], $cell['textbuffer'][0][2], $cellPtSize, true, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $this-&gt;magic_reverse_dir($str, $this-&gt;directionality, $cell['textbuffer'][0][18]);&nbsp;</div></li><li><div>                          $this-&gt;Text($this-&gt;x, $this-&gt;y, $str, $cell['textbuffer'][0][18], $cell['textbuffer'][0][8]); <span class="comment"><span class="comment">// textvar</span></span>&nbsp;</div></li><li><div>                          $this-&gt;Rotate(0);&nbsp;</div></li><li><div>                          $this-&gt;SetFont($s_f, $s_st, $s_fs, true, true);&nbsp;</div></li><li><div>                          $this-&gt;SetTColor(0);&nbsp;</div></li><li><div>                          $this-&gt;x = $opx;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if (!$this-&gt;simpleTables) {&nbsp;</div></li><li><div>                              if ($bord_det) {&nbsp;</div></li><li><div>                                  $btlw = $bord_det['L']['w'];&nbsp;</div></li><li><div>                                  $btrw = $bord_det['R']['w'];&nbsp;</div></li><li><div>                                  $bttw = $bord_det['T']['w'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $btlw = 0;&nbsp;</div></li><li><div>                                  $btrw = 0;&nbsp;</div></li><li><div>                                  $bttw = 0;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $xadj = $btlw + $cell['padding']['L'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $wadj = $btlw + $btrw + $cell['padding']['L'] + $cell['padding']['R'] + $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $yadj = $bttw + $cell['padding']['T'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $xadj = $btlw / 2 + $cell['padding']['L'];&nbsp;</div></li><li><div>                                  $wadj = ($btlw + $btrw) / 2 + $cell['padding']['L'] + $cell['padding']['R'];&nbsp;</div></li><li><div>                                  $yadj = $bttw / 2 + $cell['padding']['T'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } elseif ($this-&gt;simpleTables) {&nbsp;</div></li><li><div>                              if ($table['borders_separate']) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// NB twice border width</span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  $xadj = $table['simple']['border_details']['L']['w'] + $cell['padding']['L'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $wadj = $table['simple']['border_details']['L']['w'] + $table['simple']['border_details']['R']['w'] + $cell['padding']['L'] + $cell['padding']['R'] + $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $yadj = $table['simple']['border_details']['T']['w'] + $cell['padding']['T'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $xadj = $table['simple']['border_details']['L']['w'] / 2 + $cell['padding']['L'];&nbsp;</div></li><li><div>                                  $wadj = ($table['simple']['border_details']['L']['w'] + $table['simple']['border_details']['R']['w']) / 2 + $cell['padding']['L'] + $cell['padding']['R'];&nbsp;</div></li><li><div>                                  $yadj = $table['simple']['border_details']['T']['w'] / 2 + $cell['padding']['T'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;decimal_offset = 0;&nbsp;</div></li><li><div>                          if (substr($cell['a'], 0, 1) == 'D') {&nbsp;</div></li><li><div>                              if (isset($cell['colspan']) && $cell['colspan'] &gt; 1) {&nbsp;</div></li><li><div>                                  $this-&gt;cellTextAlign = $c['a'] = substr($cell['a'], 2, 1);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $smax = $table['decimal_align'][$j]['maxs0'];&nbsp;</div></li><li><div>                                  $d_content = $table['decimal_align'][$j]['maxs0'] + $table['decimal_align'][$j]['maxs1'];&nbsp;</div></li><li><div>                                  $this-&gt;decimal_offset = $smax;&nbsp;</div></li><li><div>                                  $extra = ($w - $d_content - $wadj);&nbsp;</div></li><li><div>                                  if ($extra &gt; 0) {&nbsp;</div></li><li><div>                                      if (substr($cell['a'], 2, 1) == 'R') {&nbsp;</div></li><li><div>                                          $this-&gt;decimal_offset += $extra;&nbsp;</div></li><li><div>                                      } elseif (substr($cell['a'], 2, 1) == 'C') {&nbsp;</div></li><li><div>                                          $this-&gt;decimal_offset += ($extra) / 2;&nbsp;</div></li><li><div>                                      }&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;divwidth = $w - $wadj;&nbsp;</div></li><li><div>                          if ($this-&gt;divwidth == 0) {&nbsp;</div></li><li><div>                              $this-&gt;divwidth = 0.0001;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $this-&gt;x += $xadj;&nbsp;</div></li><li><div>                          $this-&gt;y += $yadj;&nbsp;</div></li><li><div>                          $this-&gt;printbuffer($cell['textbuffer'], '', true, false, $cell['direction']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;y = $opy;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (!$this-&gt;ColActive) {&nbsp;</div></li><li><div>                      if (isset($table['trgradients'][$i]) && ($j == 0 || $table['borders_separate'])) {&nbsp;</div></li><li><div>                          $g = $this-&gt;grad-&gt;parseBackgroundGradient($table['trgradients'][$i]);&nbsp;</div></li><li><div>                          if ($g) {&nbsp;</div></li><li><div>                              $gx = $x0;&nbsp;</div></li><li><div>                              $gy = $y;&nbsp;</div></li><li><div>                              $gh = $h;&nbsp;</div></li><li><div>                              $gw = $table['w'] - ($table['max_cell_border_width']['L'] / 2) - ($table['max_cell_border_width']['R'] / 2) - $table['margin']['L'] - $table['margin']['R'];&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $gw -= ($table['padding']['L'] + $table['border_details']['L']['w'] + $table['padding']['R'] + $table['border_details']['R']['w'] + $table['border_spacing_H']);&nbsp;</div></li><li><div>                                  $clx = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $cly = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                  $clw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $clh = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set clipping path</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  $s = $this-&gt;_setClippingPath($clx, $cly, $clw, $clh); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 4][] = array('gradient' =&gt; true, 'x' =&gt; $gx + ($table['border_spacing_H'] / 2), 'y' =&gt; $gy + ($table['border_spacing_V'] / 2), 'w' =&gt; $gw - $table['border_spacing_V'], 'h' =&gt; $gh - $table['border_spacing_H'], 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; $s);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 4][] = array('gradient' =&gt; true, 'x' =&gt; $gx, 'y' =&gt; $gy, 'w' =&gt; $gw, 'h' =&gt; $gh, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (isset($table['trbackground-images'][$i]) && ($j == 0 || $table['borders_separate'])) {&nbsp;</div></li><li><div>                          if (isset($table['trbackground-images'][$i]['gradient']) && preg_match('/(-moz-)*(repeating-)*(linear|radial)-gradient/', $table['trbackground-images'][$i]['gradient'])) {&nbsp;</div></li><li><div>                              $g = $this-&gt;grad-&gt;parseMozGradient($table['trbackground-images'][$i]['gradient']);&nbsp;</div></li><li><div>                              if ($g) {&nbsp;</div></li><li><div>                                  $gx = $x0;&nbsp;</div></li><li><div>                                  $gy = $y;&nbsp;</div></li><li><div>                                  $gh = $h;&nbsp;</div></li><li><div>                                  $gw = $table['w'] - ($table['max_cell_border_width']['L'] / 2) - ($table['max_cell_border_width']['R'] / 2) - $table['margin']['L'] - $table['margin']['R'];&nbsp;</div></li><li><div>                                  if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                      $gw -= ($table['padding']['L'] + $table['border_details']['L']['w'] + $table['padding']['R'] + $table['border_details']['R']['w'] + $table['border_spacing_H']);&nbsp;</div></li><li><div>                                      $clx = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                      $cly = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                      $clw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                                      $clh = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set clipping path</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                      $s = $this-&gt;_setClippingPath($clx, $cly, $clw, $clh); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                      $this-&gt;tableBackgrounds[$level * 9 + 4][] = array('gradient' =&gt; true, 'x' =&gt; $gx + ($table['border_spacing_H'] / 2), 'y' =&gt; $gy + ($table['border_spacing_V'] / 2), 'w' =&gt; $gw - $table['border_spacing_V'], 'h' =&gt; $gh - $table['border_spacing_H'], 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; $s);&nbsp;</div></li><li><div>                                  } else {&nbsp;</div></li><li><div>                                      $this-&gt;tableBackgrounds[$level * 9 + 4][] = array('gradient' =&gt; true, 'x' =&gt; $gx, 'y' =&gt; $gy, 'w' =&gt; $gw, 'h' =&gt; $gh, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $image_id = $table['trbackground-images'][$i]['image_id'];&nbsp;</div></li><li><div>                              $orig_w = $table['trbackground-images'][$i]['orig_w'];&nbsp;</div></li><li><div>                              $orig_h = $table['trbackground-images'][$i]['orig_h'];&nbsp;</div></li><li><div>                              $x_pos = $table['trbackground-images'][$i]['x_pos'];&nbsp;</div></li><li><div>                              $y_pos = $table['trbackground-images'][$i]['y_pos'];&nbsp;</div></li><li><div>                              $x_repeat = $table['trbackground-images'][$i]['x_repeat'];&nbsp;</div></li><li><div>                              $y_repeat = $table['trbackground-images'][$i]['y_repeat'];&nbsp;</div></li><li><div>                              $resize = $table['trbackground-images'][$i]['resize'];&nbsp;</div></li><li><div>                              $opacity = $table['trbackground-images'][$i]['opacity'];&nbsp;</div></li><li><div>                              $itype = $table['trbackground-images'][$i]['itype'];&nbsp;</div></li><li><div>                              $clippath = '';&nbsp;</div></li><li><div>                              $gx = $x0;&nbsp;</div></li><li><div>                              $gy = $y;&nbsp;</div></li><li><div>                              $gh = $h;&nbsp;</div></li><li><div>                              $gw = $table['w'] - ($table['max_cell_border_width']['L'] / 2) - ($table['max_cell_border_width']['R'] / 2) - $table['margin']['L'] - $table['margin']['R'];&nbsp;</div></li><li><div>                              if ($table['borders_separate']) {&nbsp;</div></li><li><div>                                  $gw -= ($table['padding']['L'] + $table['border_details']['L']['w'] + $table['padding']['R'] + $table['border_details']['R']['w'] + $table['border_spacing_H']);&nbsp;</div></li><li><div>                                  $clx = $x + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                                  $cly = $y + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                                  $clw = $w - $table['border_spacing_H'];&nbsp;</div></li><li><div>                                  $clh = $h - $table['border_spacing_V'];&nbsp;</div></li><li><div>                                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set clipping path</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  $s = $this-&gt;_setClippingPath($clx, $cly, $clw, $clh); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 5][] = array('x' =&gt; $gx + ($table['border_spacing_H'] / 2), 'y' =&gt; $gy + ($table['border_spacing_V'] / 2), 'w' =&gt; $gw - $table['border_spacing_V'], 'h' =&gt; $gh - $table['border_spacing_H'], 'image_id' =&gt; $image_id, 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $x_pos, 'y_pos' =&gt; $y_pos, 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'clippath' =&gt; $s, 'resize' =&gt; $resize, 'opacity' =&gt; $opacity, 'itype' =&gt; $itype);&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;tableBackgrounds[$level * 9 + 5][] = array('x' =&gt; $gx, 'y' =&gt; $gy, 'w' =&gt; $gw, 'h' =&gt; $gh, 'image_id' =&gt; $image_id, 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $x_pos, 'y_pos' =&gt; $y_pos, 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'clippath' =&gt; '', 'resize' =&gt; $resize, 'opacity' =&gt; $opacity, 'itype' =&gt; $itype);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// TABLE</span></span> BORDER - if separate&nbsp;</div></li><li><div>                  if (($table['borders_separate'] || ($this-&gt;simpleTables && !$table['simple']['border'])) && $table['border']) {&nbsp;</div></li><li><div>                      $halfspaceL = $table['padding']['L'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                      $halfspaceR = $table['padding']['R'] + ($table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>                      $halfspaceT = $table['padding']['T'] + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                      $halfspaceB = $table['padding']['B'] + ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>                      $tbx = $x;&nbsp;</div></li><li><div>                      $tby = $y;&nbsp;</div></li><li><div>                      $tbw = $w;&nbsp;</div></li><li><div>                      $tbh = $h;&nbsp;</div></li><li><div>                      $tab_bord = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $corner = '';&nbsp;</div></li><li><div>                      if ($i == 0) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span>&nbsp;</div></li><li><div>                          $tby -= $halfspaceT + ($table['border_details']['T']['w'] / 2);&nbsp;</div></li><li><div>                          $tbh += $halfspaceT + ($table['border_details']['T']['w'] / 2);&nbsp;</div></li><li><div>                          $this-&gt;setBorder($tab_bord, _BORDER_TOP);&nbsp;</div></li><li><div>                          $corner .= 'T';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($i == ($numrows - 1) || (isset($cell['rowspan']) && ($i + $cell['rowspan']) == $numrows)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span>&nbsp;</div></li><li><div>                          $tbh += $halfspaceB + ($table['border_details']['B']['w'] / 2);&nbsp;</div></li><li><div>                          $this-&gt;setBorder($tab_bord, _BORDER_BOTTOM);&nbsp;</div></li><li><div>                          $corner .= 'B';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($j == 0) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span>&nbsp;</div></li><li><div>                          $tbx -= $halfspaceL + ($table['border_details']['L']['w'] / 2);&nbsp;</div></li><li><div>                          $tbw += $halfspaceL + ($table['border_details']['L']['w'] / 2);&nbsp;</div></li><li><div>                          $this-&gt;setBorder($tab_bord, _BORDER_LEFT);&nbsp;</div></li><li><div>                          $corner .= 'L';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($j == ($numcols - 1) || (isset($cell['colspan']) && ($j + $cell['colspan']) == $numcols)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span>&nbsp;</div></li><li><div>                          $tbw += $halfspaceR + ($table['border_details']['R']['w'] / 2);&nbsp;</div></li><li><div>                          $this-&gt;setBorder($tab_bord, _BORDER_RIGHT);&nbsp;</div></li><li><div>                          $corner .= 'R';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;_tableRect($tbx, $tby, $tbw, $tbh, $tab_bord, $table['border_details'], false, $table['borders_separate'], 'table', $corner, $table['border_spacing_V'], $table['border_spacing_H']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  unset($cell);&nbsp;</div></li><li><div>                  <span class="comment">//Reset values</span>&nbsp;</div></li><li><div>                  $this-&gt;Reset();&nbsp;</div></li><li><div>              }<span class="comment">//end of (if isset(cells)...)</span>&nbsp;</div></li><li><div>          }<span class="comment">// end of columns</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $newpagestarted = false;&nbsp;</div></li><li><div>          $this-&gt;tabletheadjustfinished = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>              if (!$this-&gt;table_keep_together && $i &lt; $numrows - 1 && $level == 1) {&nbsp;</div></li><li><div>                  $this-&gt;breakpoints[$this-&gt;CurrCol][] = $y + $h;&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (count($this-&gt;cellBorderBuffer)) {&nbsp;</div></li><li><div>                  $this-&gt;printcellbuffer();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($i == $numrows - 1) {&nbsp;</div></li><li><div>              $this-&gt;y = $y + $h;&nbsp;</div></li><li><div>          } <span class="comment">//last row jump (update this-&gt;y position)</span>&nbsp;</div></li><li><div>          if ($this-&gt;table_rotate && $level == 1) {&nbsp;</div></li><li><div>              $this-&gt;tbrot_h += $h;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }<span class="comment">// end of rows</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (count($this-&gt;cellBorderBuffer)) {&nbsp;</div></li><li><div>          $this-&gt;printcellbuffer();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;tableClipPath) {&nbsp;</div></li><li><div>          $this-&gt;_out(&quot;Q&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;tableClipPath = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Advance down page</span> by half width of bottom border&nbsp;</div></li><li><div>      if ($table['borders_separate']) {&nbsp;</div></li><li><div>          $this-&gt;y += $table['padding']['B'] + $table['border_details']['B']['w'] + $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;y += $table['max_cell_border_width']['B'] / 2;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($table['borders_separate'] && $level == 1) {&nbsp;</div></li><li><div>          $this-&gt;tbrot_h += $table['margin']['B'] + $table['padding']['B'] + $table['border_details']['B']['w'] + $table['border_spacing_V'] / 2;&nbsp;</div></li><li><div>      } elseif ($level == 1) {&nbsp;</div></li><li><div>          $this-&gt;tbrot_h += $table['margin']['B'] + $table['max_cell_border_width']['B'] / 2;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bx = $x0;&nbsp;</div></li><li><div>      $by = $y0;&nbsp;</div></li><li><div>      if ($table['borders_separate']) {&nbsp;</div></li><li><div>          $bx -= ($table['padding']['L'] + $table['border_details']['L']['w'] + $table['border_spacing_H'] / 2);&nbsp;</div></li><li><div>          if ($tablestartpageno != $this-&gt;page) { <span class="comment">// IF broken across page</span>&nbsp;</div></li><li><div>              $by += $table['max_cell_border_width']['T'] / 2;&nbsp;</div></li><li><div>              if (empty($tableheader)) {&nbsp;</div></li><li><div>                  $by -= ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($split && $startrow &gt; 0 && empty($tableheader)) {&nbsp;</div></li><li><div>              $by -= ($table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $by -= ($table['padding']['T'] + $table['border_details']['T']['w'] + $table['border_spacing_V'] / 2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($tablestartpageno != $this-&gt;page && !empty($tableheader)) {&nbsp;</div></li><li><div>          $by += $maxbwtop / 2;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $by -= $tableheaderadj;&nbsp;</div></li><li><div>      $bh = $this-&gt;y - $by;&nbsp;</div></li><li><div>      if (!$table['borders_separate']) {&nbsp;</div></li><li><div>          $bh -= $table['max_cell_border_width']['B'] / 2;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($split) {&nbsp;</div></li><li><div>          $bw = 0;&nbsp;</div></li><li><div>          $finalSpread = true;&nbsp;</div></li><li><div>          for ($t = $startcol; $t &lt; $numcols; $t++) {&nbsp;</div></li><li><div>              if ($table['colPg'][$t] == $splitpg) {&nbsp;</div></li><li><div>                  $bw += $table['wc'][$t];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($table['colPg'][$t] &gt; $splitpg) {&nbsp;</div></li><li><div>                  $finalSpread = false;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($startcol == 0) {&nbsp;</div></li><li><div>              $firstSpread = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $firstSpread = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($table['borders_separate']) {&nbsp;</div></li><li><div>              $bw += $table['border_spacing_H'];&nbsp;</div></li><li><div>              if ($firstSpread) {&nbsp;</div></li><li><div>                  $bw += $table['padding']['L'] + $table['border_details']['L']['w'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $bx += ($table['padding']['L'] + $table['border_details']['L']['w']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($finalSpread) {&nbsp;</div></li><li><div>                  $bw += $table['padding']['R'] + $table['border_details']['R']['w'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $bw = $table['w'] - ($table['max_cell_border_width']['L'] / 2) - ($table['max_cell_border_width']['R'] / 2) - $table['margin']['L'] - $table['margin']['R'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;ColActive) {&nbsp;</div></li><li><div>          if (isset($table['bgcolor'][-1])) {&nbsp;</div></li><li><div>              $color = $this-&gt;ConvertColor($table['bgcolor'][-1]);&nbsp;</div></li><li><div>              if ($color) {&nbsp;</div></li><li><div>                  $this-&gt;tableBackgrounds[$level * 9][] = array('gradient' =&gt; false, 'x' =&gt; $bx, 'y' =&gt; $by, 'w' =&gt; $bw, 'h' =&gt; $bh, 'col' =&gt; $color);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if (isset($table['gradient'])) {&nbsp;</div></li><li><div>              $g = $this-&gt;grad-&gt;parseBackgroundGradient($table['gradient']);&nbsp;</div></li><li><div>              if ($g) {&nbsp;</div></li><li><div>                  $this-&gt;tableBackgrounds[$level * 9 + 1][] = array('gradient' =&gt; true, 'x' =&gt; $bx, 'y' =&gt; $by, 'w' =&gt; $bw, 'h' =&gt; $bh, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($table['background-image'])) {&nbsp;</div></li><li><div>              if (isset($table['background-image']['gradient']) && $table['background-image']['gradient'] && preg_match('/(-moz-)*(repeating-)*(linear|radial)-gradient/', $table['background-image']['gradient'])) {&nbsp;</div></li><li><div>                  $g = $this-&gt;grad-&gt;parseMozGradient($table['background-image']['gradient']);&nbsp;</div></li><li><div>                  if ($g) {&nbsp;</div></li><li><div>                      $this-&gt;tableBackgrounds[$level * 9 + 1][] = array('gradient' =&gt; true, 'x' =&gt; $bx, 'y' =&gt; $by, 'w' =&gt; $bw, 'h' =&gt; $bh, 'gradtype' =&gt; $g['type'], 'stops' =&gt; $g['stops'], 'colorspace' =&gt; $g['colorspace'], 'coords' =&gt; $g['coords'], 'extend' =&gt; $g['extend'], 'clippath' =&gt; '');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $image_id = $table['background-image']['image_id'];&nbsp;</div></li><li><div>                  $orig_w = $table['background-image']['orig_w'];&nbsp;</div></li><li><div>                  $orig_h = $table['background-image']['orig_h'];&nbsp;</div></li><li><div>                  $x_pos = $table['background-image']['x_pos'];&nbsp;</div></li><li><div>                  $y_pos = $table['background-image']['y_pos'];&nbsp;</div></li><li><div>                  $x_repeat = $table['background-image']['x_repeat'];&nbsp;</div></li><li><div>                  $y_repeat = $table['background-image']['y_repeat'];&nbsp;</div></li><li><div>                  $resize = $table['background-image']['resize'];&nbsp;</div></li><li><div>                  $opacity = $table['background-image']['opacity'];&nbsp;</div></li><li><div>                  $itype = $table['background-image']['itype'];&nbsp;</div></li><li><div>                  $this-&gt;tableBackgrounds[$level * 9 + 2][] = array('x' =&gt; $bx, 'y' =&gt; $by, 'w' =&gt; $bw, 'h' =&gt; $bh, 'image_id' =&gt; $image_id, 'orig_w' =&gt; $orig_w, 'orig_h' =&gt; $orig_h, 'x_pos' =&gt; $x_pos, 'y_pos' =&gt; $y_pos, 'x_repeat' =&gt; $x_repeat, 'y_repeat' =&gt; $y_repeat, 'clippath' =&gt; '', 'resize' =&gt; $resize, 'opacity' =&gt; $opacity, 'itype' =&gt; $itype);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;tableBackgrounds && $level == 1) {&nbsp;</div></li><li><div>          $s = $this-&gt;PrintTableBackgrounds();&nbsp;</div></li><li><div>          if ($this-&gt;table_rotate && !$this-&gt;processingHeader && !$this-&gt;processingFooter) {&nbsp;</div></li><li><div>              $this-&gt;tablebuffer = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', '\\1' . &quot;\n&quot; . $s . &quot;\n&quot;, $this-&gt;tablebuffer);&nbsp;</div></li><li><div>              if ($level == 1) {&nbsp;</div></li><li><div>                  $this-&gt;tablebuffer = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', &quot; &quot;, $this-&gt;tablebuffer);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ($this-&gt;bufferoutput) {&nbsp;</div></li><li><div>              $this-&gt;headerbuffer = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', '\\1' . &quot;\n&quot; . $s . &quot;\n&quot;, $this-&gt;headerbuffer);&nbsp;</div></li><li><div>              if ($level == 1) {&nbsp;</div></li><li><div>                  $this-&gt;headerbuffer = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', &quot; &quot;, $this-&gt;headerbuffer);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;pages[$this-&gt;page] = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', '\\1' . &quot;\n&quot; . $s . &quot;\n&quot;, $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>              if ($level == 1) {&nbsp;</div></li><li><div>                  $this-&gt;pages[$this-&gt;page] = preg_replace('/(___TABLE___BACKGROUNDS' . $this-&gt;uniqstr . ')/', &quot; &quot;, $this-&gt;pages[$this-&gt;page]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;tableBackgrounds = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// TABLE</span></span> BOTTOM MARGIN&nbsp;</div></li><li><div>      if ($table['margin']['B']) {&nbsp;</div></li><li><div>          if (!$this-&gt;table_rotate && $level == 1) {&nbsp;</div></li><li><div>              $this-&gt;DivLn($table['margin']['B'], $this-&gt;blklvl, true);  <span class="comment"><span class="comment">// collapsible</span></span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;y += ($table['margin']['B']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive && $level == 1) {&nbsp;</div></li><li><div>          $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($split) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Are there more columns to print on a next page?</span></span>&nbsp;</div></li><li><div>          if ($lastCol &lt; $numcols - 1) {&nbsp;</div></li><li><div>              $splitpg++;&nbsp;</div></li><li><div>              $startcol = $lastCol + 1;&nbsp;</div></li><li><div>              return array(false, $startrow, $startcol, $splitpg, $returny, $y0);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return array(true, 0, 0, 0, false, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//END OF FUNCTION _tableWrite()</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>///END OF TABLE CODE<span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">///////////////////</span></span></span></span></span></span>//</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>/</span></span></span></span>/////////</span></span>///&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putextgstates()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      for ($i = 1; $i &lt;= count($this-&gt;extgstates); $i++) {&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;extgstates[$i]['n'] = $this-&gt;n;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/Type /ExtGState');&nbsp;</div></li><li><div>          foreach ($this-&gt;extgstates[$i]['parms'] as $k =&gt; $v)&nbsp;</div></li><li><div>              $this-&gt;_out('/' . $k . ' ' . $v);&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putocg()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;hasOC) {&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;n_ocg_print = $this-&gt;n;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/Type /OCG /Name ' . $this-&gt;_textstring('Print only'));&nbsp;</div></li><li><div>          $this-&gt;_out('/Usage &lt;&lt;/Print &lt;&lt;/PrintState /ON&gt;&gt; /View &lt;&lt;/ViewState /OFF&gt;&gt;&gt;&gt;&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;n_ocg_view = $this-&gt;n;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/Type /OCG /Name ' . $this-&gt;_textstring('Screen only'));&nbsp;</div></li><li><div>          $this-&gt;_out('/Usage &lt;&lt;/Print &lt;&lt;/PrintState /OFF&gt;&gt; /View &lt;&lt;/ViewState /ON&gt;&gt;&gt;&gt;&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;n_ocg_hidden = $this-&gt;n;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/Type /OCG /Name ' . $this-&gt;_textstring('Hidden'));&nbsp;</div></li><li><div>          $this-&gt;_out('/Usage &lt;&lt;/Print &lt;&lt;/PrintState /OFF&gt;&gt; /View &lt;&lt;/ViewState /OFF&gt;&gt;&gt;&gt;&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (count($this-&gt;layers)) {&nbsp;</div></li><li><div>          ksort($this-&gt;layers);&nbsp;</div></li><li><div>          foreach ($this-&gt;layers as $id =&gt; $layer) {&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;layers[$id]['n'] = $this-&gt;n;&nbsp;</div></li><li><div>              if (isset($this-&gt;layerDetails[$id]['name']) && $this-&gt;layerDetails[$id]['name']) {&nbsp;</div></li><li><div>                  $name = $this-&gt;layerDetails[$id]['name'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $name = $layer['name'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/Type /OCG /Name ' . $this-&gt;_UTF16BEtextstring($name) . '&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// from mPDFI</span></span>&nbsp;</div></li><li><div>  function _putimportedobjects()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (is_array($this-&gt;parsers) && count($this-&gt;parsers) &gt; 0) {&nbsp;</div></li><li><div>          foreach ($this-&gt;parsers AS $filename =&gt; $p) {&nbsp;</div></li><li><div>              $this-&gt;current_parser = $this-&gt;parsers[$filename];&nbsp;</div></li><li><div>              if (is_array($this-&gt;_obj_stack[$filename])) {&nbsp;</div></li><li><div>                  while ($n = key($this-&gt;_obj_stack[$filename])) {&nbsp;</div></li><li><div>                      $nObj = $this-&gt;current_parser-&gt;resolveObject($this-&gt;_obj_stack[$filename][$n][1]);&nbsp;</div></li><li><div>                      $this-&gt;_newobj($this-&gt;_obj_stack[$filename][$n][0]);&nbsp;</div></li><li><div>                      if ($nObj[0] == pdf_parser::TYPE_STREAM) {&nbsp;</div></li><li><div>                          $this-&gt;pdf_write_value($nObj);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;pdf_write_value($nObj[1]);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>                      $this-&gt;_obj_stack[$filename][$n] = null; <span class="comment">// free memory</span>&nbsp;</div></li><li><div>                      unset($this-&gt;_obj_stack[$filename][$n]);&nbsp;</div></li><li><div>                      reset($this-&gt;_obj_stack[$filename]);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putformxobjects()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $filter = ($this-&gt;compress) ? '/Filter /FlateDecode ' : '';&nbsp;</div></li><li><div>      reset($this-&gt;tpls);&nbsp;</div></li><li><div>      foreach ($this-&gt;tpls AS $tplidx =&gt; $tpl) {&nbsp;</div></li><li><div>          $p = ($this-&gt;compress) ? gzcompress($tpl['buffer']) : $tpl['buffer'];&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;tpls[$tplidx]['n'] = $this-&gt;n;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;' . $filter . '/Type /XObject');&nbsp;</div></li><li><div>          $this-&gt;_out('/Subtype /Form');&nbsp;</div></li><li><div>          $this-&gt;_out('/FormType 1');&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span>/Bottom/Right/Top&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('/BBox [%.2F %.2F %.2F %.2F]', $tpl['box']['x'] * _MPDFK, $tpl['box']['y'] * _MPDFK, ($tpl['box']['x'] + $tpl['box']['w']) * _MPDFK, ($tpl['box']['y'] + $tpl['box']['h']) * _MPDFK)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($tpl['box']))&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/Matrix [1 0 0 1 %.5F %.5F]', -$tpl['box']['x'] * _MPDFK, -$tpl['box']['y'] * _MPDFK));&nbsp;</div></li><li><div>          $this-&gt;_out('/Resources ');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($tpl['resources'])) {&nbsp;</div></li><li><div>              $this-&gt;current_parser = $tpl['parser'];&nbsp;</div></li><li><div>              $this-&gt;pdf_write_value($tpl['resources']);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]');&nbsp;</div></li><li><div>              if (isset($this-&gt;_res['tpl'][$tplidx]['fonts']) && count($this-&gt;_res['tpl'][$tplidx]['fonts'])) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/Font &lt;&lt;');&nbsp;</div></li><li><div>                  foreach ($this-&gt;_res['tpl'][$tplidx]['fonts'] as $font)&nbsp;</div></li><li><div>                      $this-&gt;_out('/F' . $font['i'] . ' ' . $font['n'] . ' 0 R');&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (isset($this-&gt;_res['tpl'][$tplidx]['images']) && count($this-&gt;_res['tpl'][$tplidx]['images']) ||&nbsp;</div></li><li><div>                  isset($this-&gt;_res['tpl'][$tplidx]['tpls']) && count($this-&gt;_res['tpl'][$tplidx]['tpls'])) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/XObject &lt;&lt;');&nbsp;</div></li><li><div>                  if (isset($this-&gt;_res['tpl'][$tplidx]['images']) && count($this-&gt;_res['tpl'][$tplidx]['images'])) {&nbsp;</div></li><li><div>                      foreach ($this-&gt;_res['tpl'][$tplidx]['images'] as $image)&nbsp;</div></li><li><div>                          $this-&gt;_out('/I' . $image['i'] . ' ' . $image['n'] . ' 0 R');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($this-&gt;_res['tpl'][$tplidx]['tpls']) && count($this-&gt;_res['tpl'][$tplidx]['tpls'])) {&nbsp;</div></li><li><div>                      foreach ($this-&gt;_res['tpl'][$tplidx]['tpls'] as $i =&gt; $itpl)&nbsp;</div></li><li><div>                          $this-&gt;_out($this-&gt;tplprefix . $i . ' ' . $itpl['n'] . ' 0 R');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;_out('/Length ' . strlen($p) . ' &gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_putstream($p);&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putpatterns()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      for ($i = 1; $i &lt;= count($this-&gt;patterns); $i++) {&nbsp;</div></li><li><div>          $x = $this-&gt;patterns[$i]['x'];&nbsp;</div></li><li><div>          $y = $this-&gt;patterns[$i]['y'];&nbsp;</div></li><li><div>          $w = $this-&gt;patterns[$i]['w'];&nbsp;</div></li><li><div>          $h = $this-&gt;patterns[$i]['h'];&nbsp;</div></li><li><div>          $pgh = $this-&gt;patterns[$i]['pgh'];&nbsp;</div></li><li><div>          $orig_w = $this-&gt;patterns[$i]['orig_w'];&nbsp;</div></li><li><div>          $orig_h = $this-&gt;patterns[$i]['orig_h'];&nbsp;</div></li><li><div>          $image_id = $this-&gt;patterns[$i]['image_id'];&nbsp;</div></li><li><div>          $itype = $this-&gt;patterns[$i]['itype'];&nbsp;</div></li><li><div>          if (isset($this-&gt;patterns[$i]['bpa'])) {&nbsp;</div></li><li><div>              $bpa = $this-&gt;patterns[$i]['bpa'];&nbsp;</div></li><li><div>          } <span class="comment">// background positioning area</span>&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $bpa = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;patterns[$i]['x_repeat']) {&nbsp;</div></li><li><div>              $x_repeat = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $x_repeat = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;patterns[$i]['y_repeat']) {&nbsp;</div></li><li><div>              $y_repeat = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $y_repeat = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $x_pos = $this-&gt;patterns[$i]['x_pos'];&nbsp;</div></li><li><div>          if (stristr($x_pos, '%')) {&nbsp;</div></li><li><div>              $x_pos += 0;&nbsp;</div></li><li><div>              $x_pos /= 100;&nbsp;</div></li><li><div>              if (isset($bpa['w']) && $bpa['w'])&nbsp;</div></li><li><div>                  $x_pos = ($bpa['w'] * $x_pos) - ($orig_w / _MPDFK * $x_pos);&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $x_pos = ($w * $x_pos) - ($orig_w / _MPDFK * $x_pos);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $y_pos = $this-&gt;patterns[$i]['y_pos'];&nbsp;</div></li><li><div>          if (stristr($y_pos, '%')) {&nbsp;</div></li><li><div>              $y_pos += 0;&nbsp;</div></li><li><div>              $y_pos /= 100;&nbsp;</div></li><li><div>              if (isset($bpa['h']) && $bpa['h'])&nbsp;</div></li><li><div>                  $y_pos = ($bpa['h'] * $y_pos) - ($orig_h / _MPDFK * $y_pos);&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $y_pos = ($h * $y_pos) - ($orig_h / _MPDFK * $y_pos);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($bpa['x']) && $bpa['x'])&nbsp;</div></li><li><div>              $adj_x = ($x_pos + $bpa['x']) * _MPDFK;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $adj_x = ($x_pos + $x) * _MPDFK;&nbsp;</div></li><li><div>          if (isset($bpa['y']) && $bpa['y'])&nbsp;</div></li><li><div>              $adj_y = (($pgh - $y_pos - $bpa['y']) * _MPDFK) - $orig_h;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $adj_y = (($pgh - $y_pos - $y) * _MPDFK) - $orig_h;&nbsp;</div></li><li><div>          $img_obj = false;&nbsp;</div></li><li><div>          if ($itype == 'svg' || $itype == 'wmf') {&nbsp;</div></li><li><div>              foreach ($this-&gt;formobjects AS $fo) {&nbsp;</div></li><li><div>                  if ($fo['i'] == $image_id) {&nbsp;</div></li><li><div>                      $img_obj = $fo['n'];&nbsp;</div></li><li><div>                      $fo_w = $fo['w'];&nbsp;</div></li><li><div>                      $fo_h = -$fo['h'];&nbsp;</div></li><li><div>                      $wmf_x = $fo['x'];&nbsp;</div></li><li><div>                      $wmf_y = $fo['y'];&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              foreach ($this-&gt;images AS $img) {&nbsp;</div></li><li><div>                  if ($img['i'] == $image_id) {&nbsp;</div></li><li><div>                      $img_obj = $img['n'];&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$img_obj) {&nbsp;</div></li><li><div>              echo &quot;Problem: Image object not found for background pattern &quot; . $img['i'];&nbsp;</div></li><li><div>              exit;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]');&nbsp;</div></li><li><div>          if ($itype == 'svg' || $itype == 'wmf') {&nbsp;</div></li><li><div>              $this-&gt;_out('/XObject &lt;&lt;/FO' . $image_id . ' ' . $img_obj . ' 0 R &gt;&gt;');&nbsp;</div></li><li><div>              <span class="comment">// ****</span>*** ADD ANY ExtGStates, Shading AND Fonts needed for the FormObject&nbsp;</div></li><li><div>              <span class="comment">// Set in classes/svg array['fo'] = true</span>&nbsp;</div></li><li><div>              <span class="comment">// Required that _putshaders comes before _putpatterns in _putresources</span>&nbsp;</div></li><li><div>              <span class="comment">// This adds any resources associated with any FormObject to every Formobject - overkill but works!</span>&nbsp;</div></li><li><div>              if (count($this-&gt;extgstates)) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/ExtGState &lt;&lt;');&nbsp;</div></li><li><div>                  foreach ($this-&gt;extgstates as $k =&gt; $extgstate)&nbsp;</div></li><li><div>                      if (isset($extgstate['fo']) && $extgstate['fo']) {&nbsp;</div></li><li><div>                          if (isset($extgstate['trans']))&nbsp;</div></li><li><div>                              $this-&gt;_out('/' . $extgstate['trans'] . ' ' . $extgstate['n'] . ' 0 R');&nbsp;</div></li><li><div>                          else&nbsp;</div></li><li><div>                              $this-&gt;_out('/GS' . $k . ' ' . $extgstate['n'] . ' 0 R');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;gradients) AND ( count($this-&gt;gradients) &gt; 0)) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/Shading &lt;&lt;');&nbsp;</div></li><li><div>                  foreach ($this-&gt;gradients as $id =&gt; $grad) {&nbsp;</div></li><li><div>                      if (isset($grad['fo']) && $grad['fo']) {&nbsp;</div></li><li><div>                          $this-&gt;_out('/Sh' . $id . ' ' . $grad['id'] . ' 0 R');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;_out('/Font &lt;&lt;');&nbsp;</div></li><li><div>              foreach ($this-&gt;fonts as $font) {&nbsp;</div></li><li><div>                  if (!$font['used'] && $font['type'] == 'TTF') {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (isset($font['fo']) && $font['fo']) {&nbsp;</div></li><li><div>                      if ($font['type'] == 'TTF' && ($font['sip'] || $font['smp'])) {&nbsp;</div></li><li><div>                          foreach ($font['n'] AS $k =&gt; $fid) {&nbsp;</div></li><li><div>                              $this-&gt;_out('/F' . $font['subsetfontids'][$k] . ' ' . $font['n'][$k] . ' 0 R');&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;_out('/F' . $font['i'] . ' ' . $font['n'] . ' 0 R');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out('/XObject &lt;&lt;/I' . $image_id . ' ' . $img_obj . ' 0 R &gt;&gt;');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;patterns[$i]['n'] = $this-&gt;n;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt; /Type /Pattern /PatternType 1 /PaintType 1 /TilingType 2');&nbsp;</div></li><li><div>          $this-&gt;_out('/Resources ' . ($this-&gt;n - 1) . ' 0 R');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('/BBox [0 0 %.3F %.3F]', $orig_w, $orig_h));&nbsp;</div></li><li><div>          if ($x_repeat) {&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/XStep %.3F', $orig_w));&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/XStep %d', 99999));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($y_repeat) {&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/YStep %.3F', $orig_h));&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/YStep %d', 99999));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($itype == 'svg' || $itype == 'wmf') {&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/Matrix [1 0 0 -1 %.3F %.3F]', $adj_x, ($adj_y + $orig_h)));&nbsp;</div></li><li><div>              $s = sprintf(&quot;q %.3F 0 0 %.3F %.3F %.3F cm /FO%d Do Q&quot;, ($orig_w / $fo_w), (-$orig_h / $fo_h), -($orig_w / $fo_w) * $wmf_x, ($orig_w / $fo_w) * $wmf_y, $image_id);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/Matrix [1 0 0 1 %.3F %.3F]', $adj_x, $adj_y));&nbsp;</div></li><li><div>              $s = sprintf(&quot;q %.3F 0 0 %.3F 0 0 cm /I%d Do Q&quot;, $orig_w, $orig_h, $image_id);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;compress) {&nbsp;</div></li><li><div>              $this-&gt;_out('/Filter /FlateDecode');&nbsp;</div></li><li><div>              $s = gzcompress($s);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out('/Length ' . strlen($s) . '&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_putstream($s);&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putshaders()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $maxid = count($this-&gt;gradients); <span class="comment">//index for transparency gradients</span>&nbsp;</div></li><li><div>      foreach ($this-&gt;gradients as $id =&gt; $grad) {&nbsp;</div></li><li><div>          if (($grad['type'] == 2 || $grad['type'] == 3) && empty($grad['is_mask'])) {&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>              $this-&gt;_out('/FunctionType 3');&nbsp;</div></li><li><div>              $this-&gt;_out('/Domain [0 1]');&nbsp;</div></li><li><div>              $fn = array();&nbsp;</div></li><li><div>              $bd = array();&nbsp;</div></li><li><div>              $en = array();&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; (count($grad['stops']) - 1); $i++) {&nbsp;</div></li><li><div>                  $fn[] = ($this-&gt;n + 1 + $i) . ' 0 R';&nbsp;</div></li><li><div>                  $en[] = '0 1';&nbsp;</div></li><li><div>                  if ($i &gt; 0) {&nbsp;</div></li><li><div>                      $bd[] = sprintf('%.3F', $grad['stops'][$i]['offset']);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out('/Functions [' . implode(' ', $fn) . ']');&nbsp;</div></li><li><div>              $this-&gt;_out('/Bounds [' . implode(' ', $bd) . ']');&nbsp;</div></li><li><div>              $this-&gt;_out('/Encode [' . implode(' ', $en) . ']');&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>              $f1 = $this-&gt;n;&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; (count($grad['stops']) - 1); $i++) {&nbsp;</div></li><li><div>                  $this-&gt;_newobj();&nbsp;</div></li><li><div>                  $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>                  $this-&gt;_out('/FunctionType 2');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Domain [0 1]');&nbsp;</div></li><li><div>                  $this-&gt;_out('/C0 [' . $grad['stops'][$i]['col'] . ']');&nbsp;</div></li><li><div>                  $this-&gt;_out('/C1 [' . $grad['stops'][$i + 1]['col'] . ']');&nbsp;</div></li><li><div>                  $this-&gt;_out('/N 1');&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_out('endobj');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($grad['type'] == 2 || $grad['type'] == 3) {&nbsp;</div></li><li><div>              if (isset($grad['trans']) && $grad['trans']) {&nbsp;</div></li><li><div>                  $this-&gt;_newobj();&nbsp;</div></li><li><div>                  $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>                  $this-&gt;_out('/FunctionType 3');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Domain [0 1]');&nbsp;</div></li><li><div>                  $fn = array();&nbsp;</div></li><li><div>                  $bd = array();&nbsp;</div></li><li><div>                  $en = array();&nbsp;</div></li><li><div>                  for ($i = 0; $i &lt; (count($grad['stops']) - 1); $i++) {&nbsp;</div></li><li><div>                      $fn[] = ($this-&gt;n + 1 + $i) . ' 0 R';&nbsp;</div></li><li><div>                      $en[] = '0 1';&nbsp;</div></li><li><div>                      if ($i &gt; 0) {&nbsp;</div></li><li><div>                          $bd[] = sprintf('%.3F', $grad['stops'][$i]['offset']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;_out('/Functions [' . implode(' ', $fn) . ']');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Bounds [' . implode(' ', $bd) . ']');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Encode [' . implode(' ', $en) . ']');&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_out('endobj');&nbsp;</div></li><li><div>                  $f2 = $this-&gt;n;&nbsp;</div></li><li><div>                  for ($i = 0; $i &lt; (count($grad['stops']) - 1); $i++) {&nbsp;</div></li><li><div>                      $this-&gt;_newobj();&nbsp;</div></li><li><div>                      $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>                      $this-&gt;_out('/FunctionType 2');&nbsp;</div></li><li><div>                      $this-&gt;_out('/Domain [0 1]');&nbsp;</div></li><li><div>                      $this-&gt;_out(sprintf('/C0 [%.3F]', $grad['stops'][$i]['opacity']));&nbsp;</div></li><li><div>                      $this-&gt;_out(sprintf('/C1 [%.3F]', $grad['stops'][$i + 1]['opacity']));&nbsp;</div></li><li><div>                      $this-&gt;_out('/N 1');&nbsp;</div></li><li><div>                      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (empty($grad['is_mask'])) {&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>              $this-&gt;_out('/ShadingType ' . $grad['type']);&nbsp;</div></li><li><div>              if (isset($grad['colorspace'])) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/ColorSpace /Device' . $grad['colorspace']);  <span class="comment">// Can use CMYK if all C0 and C1 above have 4 values</span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;_out('/ColorSpace /DeviceRGB');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($grad['type'] == 2) {&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('/Coords [%.3F %.3F %.3F %.3F]', $grad['coords'][0], $grad['coords'][1], $grad['coords'][2], $grad['coords'][3]));&nbsp;</div></li><li><div>                  $this-&gt;_out('/Function ' . $f1 . ' 0 R');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Extend [' . $grad['extend'][0] . ' ' . $grad['extend'][1] . '] ');&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              } elseif ($grad['type'] == 3) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//x0, y0, r0, x1, y1, r1</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//at this this time radius of inner circle is 0</span></span>&nbsp;</div></li><li><div>                  $ir = 0;&nbsp;</div></li><li><div>                  if (isset($grad['coords'][5]) && $grad['coords'][5]) {&nbsp;</div></li><li><div>                      $ir = $grad['coords'][5];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('/Coords [%.3F %.3F %.3F %.3F %.3F %.3F]', $grad['coords'][0], $grad['coords'][1], $ir, $grad['coords'][2], $grad['coords'][3], $grad['coords'][4]));&nbsp;</div></li><li><div>                  $this-&gt;_out('/Function ' . $f1 . ' 0 R');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Extend [' . $grad['extend'][0] . ' ' . $grad['extend'][1] . '] ');&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              } elseif ($grad['type'] == 6) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/BitsPerCoordinate 16');&nbsp;</div></li><li><div>                  $this-&gt;_out('/BitsPerComponent 8');&nbsp;</div></li><li><div>                  if ($grad['colorspace'] == 'CMYK') {&nbsp;</div></li><li><div>                      $this-&gt;_out('/Decode[0 1 0 1 0 1 0 1 0 1 0 1]');&nbsp;</div></li><li><div>                  } elseif ($grad['colorspace'] == 'Gray') {&nbsp;</div></li><li><div>                      $this-&gt;_out('/Decode[0 1 0 1 0 1]');&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;_out('/Decode[0 1 0 1 0 1 0 1 0 1]');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;_out('/BitsPerFlag 8');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Length ' . strlen($grad['stream']));&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_putstream($grad['stream']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;gradients[$id]['id'] = $this-&gt;n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// set pattern object</span>&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $out = '&lt;&lt; /Type /Pattern /PatternType 2';&nbsp;</div></li><li><div>          $out .= ' /Shading ' . $this-&gt;gradients[$id]['id'] . ' 0 R';&nbsp;</div></li><li><div>          $out .= ' &gt;&gt;';&nbsp;</div></li><li><div>          $out .= &quot;\n&quot; . 'endobj';&nbsp;</div></li><li><div>          $this-&gt;_out($out);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;gradients[$id]['pattern'] = $this-&gt;n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($grad['trans']) && $grad['trans']) {&nbsp;</div></li><li><div>              <span class="comment">// luminosity pattern</span>&nbsp;</div></li><li><div>              $transid = $id + $maxid;&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>              $this-&gt;_out('/ShadingType ' . $grad['type']);&nbsp;</div></li><li><div>              $this-&gt;_out('/ColorSpace /DeviceGray');&nbsp;</div></li><li><div>              if ($grad['type'] == 2) {&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('/Coords [%.3F %.3F %.3F %.3F]', $grad['coords'][0], $grad['coords'][1], $grad['coords'][2], $grad['coords'][3]));&nbsp;</div></li><li><div>                  $this-&gt;_out('/Function ' . $f2 . ' 0 R');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Extend [' . $grad['extend'][0] . ' ' . $grad['extend'][1] . '] ');&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              } elseif ($grad['type'] == 3) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//x0, y0, r0, x1, y1, r1</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//at this this time radius of inner circle is 0</span></span>&nbsp;</div></li><li><div>                  $ir = 0;&nbsp;</div></li><li><div>                  if (isset($grad['coords'][5]) && $grad['coords'][5]) {&nbsp;</div></li><li><div>                      $ir = $grad['coords'][5];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('/Coords [%.3F %.3F %.3F %.3F %.3F %.3F]', $grad['coords'][0], $grad['coords'][1], $ir, $grad['coords'][2], $grad['coords'][3], $grad['coords'][4]));&nbsp;</div></li><li><div>                  $this-&gt;_out('/Function ' . $f2 . ' 0 R');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Extend [' . $grad['extend'][0] . ' ' . $grad['extend'][1] . '] ');&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              } elseif ($grad['type'] == 6) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/BitsPerCoordinate 16');&nbsp;</div></li><li><div>                  $this-&gt;_out('/BitsPerComponent 8');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Decode[0 1 0 1 0 1]');&nbsp;</div></li><li><div>                  $this-&gt;_out('/BitsPerFlag 8');&nbsp;</div></li><li><div>                  $this-&gt;_out('/Length ' . strlen($grad['stream_trans']));&nbsp;</div></li><li><div>                  $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>                  $this-&gt;_putstream($grad['stream_trans']);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;gradients[$transid]['id'] = $this-&gt;n;&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt; /Type /Pattern /PatternType 2');&nbsp;</div></li><li><div>              $this-&gt;_out('/Shading ' . $this-&gt;gradients[$transid]['id'] . ' 0 R');&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>              $this-&gt;gradients[$transid]['pattern'] = $this-&gt;n;&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              <span class="comment">// Need to extend size of viewing box in case of transformations</span>&nbsp;</div></li><li><div>              $str = 'q /a0 gs /Pattern cs /p' . $transid . ' scn -' . ($this-&gt;wPt / 2) . ' -' . ($this-&gt;hPt / 2) . ' ' . (2 * $this-&gt;wPt) . ' ' . (2 * $this-&gt;hPt) . ' re f Q';&nbsp;</div></li><li><div>              $filter = ($this-&gt;compress) ? '/Filter /FlateDecode ' : '';&nbsp;</div></li><li><div>              $p = ($this-&gt;compress) ? gzcompress($str) : $str;&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt; /Type /XObject /Subtype /Form /FormType 1 ' . $filter);&nbsp;</div></li><li><div>              $this-&gt;_out('/Length ' . strlen($p));&nbsp;</div></li><li><div>              $this-&gt;_out('/BBox [-' . ($this-&gt;wPt / 2) . ' -' . ($this-&gt;hPt / 2) . ' ' . (2 * $this-&gt;wPt) . ' ' . (2 * $this-&gt;hPt) . ']');&nbsp;</div></li><li><div>              $this-&gt;_out('/Group &lt;&lt; /Type /Group /S /Transparency /CS /DeviceGray &gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('/Resources &lt;&lt;');&nbsp;</div></li><li><div>              $this-&gt;_out('/ExtGState &lt;&lt; /a0 &lt;&lt; /ca 1 /CA 1 &gt;&gt; &gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('/Pattern &lt;&lt; /p' . $transid . ' ' . $this-&gt;gradients[$transid]['pattern'] . ' 0 R &gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>              $this-&gt;_putstream($p);&nbsp;</div></li><li><div>              $this-&gt;_out('endobj');&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt; /Type /Mask /S /Luminosity /G ' . ($this-&gt;n - 1) . ' 0 R &gt;&gt;' . &quot;\n&quot; . 'endobj');&nbsp;</div></li><li><div>              $this-&gt;_newobj();&nbsp;</div></li><li><div>              $this-&gt;_out('&lt;&lt; /Type /ExtGState /SMask ' . ($this-&gt;n - 1) . ' 0 R /AIS false &gt;&gt;' . &quot;\n&quot; . 'endobj');&nbsp;</div></li><li><div>              if (isset($grad['fo']) && $grad['fo']) {&nbsp;</div></li><li><div>                  $this-&gt;extgstates[] = array('n' =&gt; $this-&gt;n, 'trans' =&gt; 'TGS' . $id, 'fo' =&gt; true);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;extgstates[] = array('n' =&gt; $this-&gt;n, 'trans' =&gt; 'TGS' . $id);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putspotcolors()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach ($this-&gt;spotColors as $name =&gt; $color) {&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;_out('[/Separation /' . str_replace(' ', '#20', $name));&nbsp;</div></li><li><div>          $this-&gt;_out('/DeviceCMYK &lt;&lt;');&nbsp;</div></li><li><div>          $this-&gt;_out('/Range [0 1 0 1 0 1 0 1] /C0 [0 0 0 0] ');&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('/C1 [%.3F %.3F %.3F %.3F] ', $color['c'] / 100, $color['m'] / 100, $color['y'] / 100, $color['k'] / 100));&nbsp;</div></li><li><div>          $this-&gt;_out('/FunctionType 2 /Domain [0 1] /N 1&gt;&gt;]');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>          $this-&gt;spotColors[$name]['n'] = $this-&gt;n;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putresources()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;hasOC || count($this-&gt;layers))&nbsp;</div></li><li><div>          $this-&gt;_putocg();&nbsp;</div></li><li><div>      $this-&gt;_putextgstates();&nbsp;</div></li><li><div>      $this-&gt;_putspotcolors();&nbsp;</div></li><li><div>      $this-&gt;_putfonts();&nbsp;</div></li><li><div>      $this-&gt;_putimages();&nbsp;</div></li><li><div>      $this-&gt;_putformobjects(); <span class="comment">// *IMAGES-CORE*</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;enableImports) {&nbsp;</div></li><li><div>          $this-&gt;_putformxobjects();&nbsp;</div></li><li><div>          $this-&gt;_putimportedobjects();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;_putshaders();&nbsp;</div></li><li><div>      $this-&gt;_putpatterns();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Resource dictionary</span>&nbsp;</div></li><li><div>      $this-&gt;offsets[2] = strlen($this-&gt;buffer);&nbsp;</div></li><li><div>      $this-&gt;_out('2 0 obj');&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_out('/Font &lt;&lt;');&nbsp;</div></li><li><div>      foreach ($this-&gt;fonts as $font) {&nbsp;</div></li><li><div>          if (isset($font['type']) && $font['type'] == 'TTF' && !$font['used']) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($font['type']) && $font['type'] == 'TTF' && ($font['sip'] || $font['smp'])) {&nbsp;</div></li><li><div>              foreach ($font['n'] AS $k =&gt; $fid) {&nbsp;</div></li><li><div>                  $this-&gt;_out('/F' . $font['subsetfontids'][$k] . ' ' . $font['n'][$k] . ' 0 R');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;_out('/F' . $font['i'] . ' ' . $font['n'] . ' 0 R');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (count($this-&gt;spotColors)) {&nbsp;</div></li><li><div>          $this-&gt;_out('/ColorSpace &lt;&lt;');&nbsp;</div></li><li><div>          foreach ($this-&gt;spotColors as $color)&nbsp;</div></li><li><div>              $this-&gt;_out('/CS' . $color['i'] . ' ' . $color['n'] . ' 0 R');&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (count($this-&gt;extgstates)) {&nbsp;</div></li><li><div>          $this-&gt;_out('/ExtGState &lt;&lt;');&nbsp;</div></li><li><div>          foreach ($this-&gt;extgstates as $k =&gt; $extgstate)&nbsp;</div></li><li><div>              if (isset($extgstate['trans']))&nbsp;</div></li><li><div>                  $this-&gt;_out('/' . $extgstate['trans'] . ' ' . $extgstate['n'] . ' 0 R');&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $this-&gt;_out('/GS' . $k . ' ' . $extgstate['n'] . ' 0 R');&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ((isset($this-&gt;gradients) AND ( count($this-&gt;gradients) &gt; 0)) || ($this-&gt;enableImports && count($this-&gt;tpls))) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>          $this-&gt;_out('/Shading &lt;&lt;');&nbsp;</div></li><li><div>          foreach ($this-&gt;gradients as $id =&gt; $grad) {&nbsp;</div></li><li><div>              $this-&gt;_out('/Sh' . $id . ' ' . $grad['id'] . ' 0 R');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>          <span class="comment">// If a shading dictionary is in an object (tpl) imported from another PDF, it needs to be included</span>&nbsp;</div></li><li><div>          <span class="comment">// in the document resources, as well as the object resources</span>&nbsp;</div></li><li><div>          <span class="comment">// Otherwise get an error in some PDF viewers</span>&nbsp;</div></li><li><div>          if ($this-&gt;enableImports && count($this-&gt;tpls)) {&nbsp;</div></li><li><div>              foreach ($this-&gt;tpls as $tplidx =&gt; $tpl) {&nbsp;</div></li><li><div>                  if (isset($tpl['resources'])) {&nbsp;</div></li><li><div>                      $this-&gt;current_parser = $tpl['parser'];&nbsp;</div></li><li><div>                      reset($tpl['resources'][1]);&nbsp;</div></li><li><div>                      while (list($k, $v) = each($tpl['resources'][1])) {&nbsp;</div></li><li><div>                          if ($k == '/Shading') {&nbsp;</div></li><li><div>                              while (list($k2, $v2) = each($v[1])) {&nbsp;</div></li><li><div>                                  $this-&gt;_out($k2 . &quot; &quot;, false);&nbsp;</div></li><li><div>                                  $this-&gt;pdf_write_value($v2);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>          /**&nbsp;</div></li><li><div>            <span class="comment"><span class="comment">// ???</span></span> Not needed !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!&nbsp;</div></li><li><div>            $this-&gt;_out('/Pattern &lt;&lt;');&nbsp;</div></li><li><div>            foreach ($this-&gt;gradients as $id =&gt; $grad) {&nbsp;</div></li><li><div>            $this-&gt;_out('/P'.$id.' '.$grad['pattern'].' 0 R');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>           */&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (count($this-&gt;images) || count($this-&gt;formobjects) || ($this-&gt;enableImports && count($this-&gt;tpls))) {&nbsp;</div></li><li><div>          $this-&gt;_out('/XObject &lt;&lt;');&nbsp;</div></li><li><div>          foreach ($this-&gt;images as $image)&nbsp;</div></li><li><div>              $this-&gt;_out('/I' . $image['i'] . ' ' . $image['n'] . ' 0 R');&nbsp;</div></li><li><div>          foreach ($this-&gt;formobjects as $formobject)&nbsp;</div></li><li><div>              $this-&gt;_out('/FO' . $formobject['i'] . ' ' . $formobject['n'] . ' 0 R');&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;enableImports && count($this-&gt;tpls)) {&nbsp;</div></li><li><div>              foreach ($this-&gt;tpls as $tplidx =&gt; $tpl) {&nbsp;</div></li><li><div>                  $this-&gt;_out($this-&gt;tplprefix . $tplidx . ' ' . $tpl['n'] . ' 0 R');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (count($this-&gt;patterns)) {&nbsp;</div></li><li><div>          $this-&gt;_out('/Pattern &lt;&lt;');&nbsp;</div></li><li><div>          foreach ($this-&gt;patterns as $k =&gt; $patterns)&nbsp;</div></li><li><div>              $this-&gt;_out('/P' . $k . ' ' . $patterns['n'] . ' 0 R');&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BACKGROUNDS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;hasOC || count($this-&gt;layers)) {&nbsp;</div></li><li><div>          $this-&gt;_out('/Properties &lt;&lt;');&nbsp;</div></li><li><div>          if ($this-&gt;hasOC) {&nbsp;</div></li><li><div>              $this-&gt;_out('/OC1 ' . $this-&gt;n_ocg_print . ' 0 R /OC2 ' . $this-&gt;n_ocg_view . ' 0 R /OC3 ' . $this-&gt;n_ocg_hidden . ' 0 R ');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (count($this-&gt;layers)) {&nbsp;</div></li><li><div>              foreach ($this-&gt;layers as $id =&gt; $layer)&nbsp;</div></li><li><div>                  $this-&gt;_out('/ZI' . $id . ' ' . $layer['n'] . ' 0 R');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj'); <span class="comment">// end resource dictionary</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_putbookmarks();  <span class="comment"><span class="comment">// *BOOKMARKS*</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($this-&gt;js) && $this-&gt;js) {&nbsp;</div></li><li><div>          $this-&gt;_putjavascript();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;enc_obj_id = $this-&gt;n;&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>          $this-&gt;_putencryption();&nbsp;</div></li><li><div>          $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putjavascript()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $this-&gt;n_js = $this-&gt;n;&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>      $this-&gt;_out('/Names [(EmbeddedJS) ' . (1 + $this-&gt;n) . ' 0 R ]');&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>      $this-&gt;_out('/S /JavaScript');&nbsp;</div></li><li><div>      $this-&gt;_out('/JS ' . $this-&gt;_textstring($this-&gt;js));&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putencryption()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;_out('/Filter /Standard');&nbsp;</div></li><li><div>      if ($this-&gt;useRC128encryption) {&nbsp;</div></li><li><div>          $this-&gt;_out('/V 2');&nbsp;</div></li><li><div>          $this-&gt;_out('/R 3');&nbsp;</div></li><li><div>          $this-&gt;_out('/Length 128');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_out('/V 1');&nbsp;</div></li><li><div>          $this-&gt;_out('/R 2');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;_out('/O (' . $this-&gt;_escape($this-&gt;Ovalue) . ')');&nbsp;</div></li><li><div>      $this-&gt;_out('/U (' . $this-&gt;_escape($this-&gt;Uvalue) . ')');&nbsp;</div></li><li><div>      $this-&gt;_out('/P ' . $this-&gt;Pvalue);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _puttrailer()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;_out('/Size ' . ($this-&gt;n + 1));&nbsp;</div></li><li><div>      $this-&gt;_out('/Root ' . $this-&gt;n . ' 0 R');&nbsp;</div></li><li><div>      $this-&gt;_out('/Info ' . $this-&gt;InfoRoot . ' 0 R');&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>          $this-&gt;_out('/Encrypt ' . $this-&gt;enc_obj_id . ' 0 R');&nbsp;</div></li><li><div>          $this-&gt;_out('/ID [&lt;' . $this-&gt;uniqid . '&gt; &lt;' . $this-&gt;uniqid . '&gt;]');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $uniqid = md5(time() . $this-&gt;buffer);&nbsp;</div></li><li><div>          $this-&gt;_out('/ID [&lt;' . $uniqid . '&gt; &lt;' . $uniqid . '&gt;]');&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetProtection($permissions = array(), $user_pass = '', $owner_pass = null, $length = 40)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;encrypted = false;&nbsp;</div></li><li><div>      if (is_string($permissions) && strlen($permissions) &gt; 0) {&nbsp;</div></li><li><div>          $permissions = array($permissions);&nbsp;</div></li><li><div>      } elseif (!is_array($permissions)) {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;last_rc4_key = '';&nbsp;</div></li><li><div>      $this-&gt;padding = &quot;\x28\xBF\x4E\x5E\x4E\x75\x8A\x41\x64\x00\x4E\x56\xFF\xFA\x01\x08&quot; .&nbsp;</div></li><li><div>          &quot;\x2E\x2E\x00\xB6\xD0\x68\x3E\x80\x2F\x0C\xA9\xFE\x64\x53\x69\x7A&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $options = array(&nbsp;</div></li><li><div>          'print' =&gt; 4, <span class="comment">// bit 3</span>&nbsp;</div></li><li><div>          'modify' =&gt; 8, <span class="comment">// bit 4</span>&nbsp;</div></li><li><div>          'copy' =&gt; 16, <span class="comment">// bit 5</span>&nbsp;</div></li><li><div>          'annot-forms' =&gt; 32, <span class="comment">// bit 6</span>&nbsp;</div></li><li><div>          'fill-forms' =&gt; 256, <span class="comment">// bit 9</span>&nbsp;</div></li><li><div>          'extract' =&gt; 512, <span class="comment">// bit 10</span>&nbsp;</div></li><li><div>          'assemble' =&gt; 1024, <span class="comment">// bit 11</span>&nbsp;</div></li><li><div>          'print-highres' =&gt; 2048 <span class="comment">// bit 12</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      <span class="comment">// bit 3</span>1 = 1073741824&nbsp;</div></li><li><div>      <span class="comment">// bit 3</span>2 = 2147483648&nbsp;</div></li><li><div>      <span class="comment">// bits 13-31 = 2147479552</span>&nbsp;</div></li><li><div>      <span class="comment">// bits 13-32 = 4294963200 + 192 = 4294963392</span>&nbsp;</div></li><li><div>      $protection = 4294963392; <span class="comment">// bits 7, 8, 13-32</span>&nbsp;</div></li><li><div>      foreach ($permissions as $permission) {&nbsp;</div></li><li><div>          if (!isset($options[$permission]))&nbsp;</div></li><li><div>              throw new MpdfException('Incorrect permission: ' . $permission);&nbsp;</div></li><li><div>          if ($options[$permission] &gt; 32) {&nbsp;</div></li><li><div>              $this-&gt;useRC128encryption = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($options[$permission]))&nbsp;</div></li><li><div>              $protection += $options[$permission];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($length == 128) {&nbsp;</div></li><li><div>          $this-&gt;useRC128encryption = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($owner_pass === null)&nbsp;</div></li><li><div>          $owner_pass = uniqid(rand());&nbsp;</div></li><li><div>      $this-&gt;encrypted = true;&nbsp;</div></li><li><div>      $this-&gt;_generateencryptionkey($user_pass, $owner_pass, $protection);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Compute key depending on object number where the encrypted data is stored</span>&nbsp;</div></li><li><div>  function _objectkey($n)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;useRC128encryption)&nbsp;</div></li><li><div>          $len = 16;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $len = 10;&nbsp;</div></li><li><div>      return substr($this-&gt;_md5_16($this-&gt;encryption_key . pack('VXxx', $n)), 0, $len);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// RC4 is the standard encryption algorithm used in PDF format</span>&nbsp;</div></li><li><div>  function _RC4($key, $text)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;last_rc4_key != $key) {&nbsp;</div></li><li><div>          $k = str_repeat($key, 256 / strlen($key) + 1);&nbsp;</div></li><li><div>          $rc4 = range(0, 255);&nbsp;</div></li><li><div>          $j = 0;&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; 256; $i++) {&nbsp;</div></li><li><div>              $t = $rc4[$i];&nbsp;</div></li><li><div>              $j = ($j + $t + ord($k[$i])) % 256;&nbsp;</div></li><li><div>              $rc4[$i] = $rc4[$j];&nbsp;</div></li><li><div>              $rc4[$j] = $t;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;last_rc4_key = $key;&nbsp;</div></li><li><div>          $this-&gt;last_rc4_key_c = $rc4;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $rc4 = $this-&gt;last_rc4_key_c;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $len = strlen($text);&nbsp;</div></li><li><div>      $a = 0;&nbsp;</div></li><li><div>      $b = 0;&nbsp;</div></li><li><div>      $out = '';&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $len; $i++) {&nbsp;</div></li><li><div>          $a = ($a + 1) % 256;&nbsp;</div></li><li><div>          $t = $rc4[$a];&nbsp;</div></li><li><div>          $b = ($b + $t) % 256;&nbsp;</div></li><li><div>          $rc4[$a] = $rc4[$b];&nbsp;</div></li><li><div>          $rc4[$b] = $t;&nbsp;</div></li><li><div>          $k = $rc4[($rc4[$a] + $rc4[$b]) % 256];&nbsp;</div></li><li><div>          $out.= chr(ord($text[$i]) ^ $k);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $out;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get MD5 as binary string</span>&nbsp;</div></li><li><div>  function _md5_16($string)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return pack('H*', md5($string));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Compute O value</span></span>&nbsp;</div></li><li><div>  function _Ovalue($user_pass, $owner_pass)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $tmp = $this-&gt;_md5_16($owner_pass);&nbsp;</div></li><li><div>      if ($this-&gt;useRC128encryption) {&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; 50; ++$i) {&nbsp;</div></li><li><div>              $tmp = $this-&gt;_md5_16($tmp);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;useRC128encryption)&nbsp;</div></li><li><div>          $keybytelen = (128 / 8);&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $keybytelen = (40 / 8);&nbsp;</div></li><li><div>      $owner_RC4_key = substr($tmp, 0, $keybytelen);&nbsp;</div></li><li><div>      $enc = $this-&gt;_RC4($owner_RC4_key, $user_pass);&nbsp;</div></li><li><div>      if ($this-&gt;useRC128encryption) {&nbsp;</div></li><li><div>          $len = strlen($owner_RC4_key);&nbsp;</div></li><li><div>          for ($i = 1; $i &lt;= 19; ++$i) {&nbsp;</div></li><li><div>              $key = '';&nbsp;</div></li><li><div>              for ($j = 0; $j &lt; $len; ++$j) {&nbsp;</div></li><li><div>                  $key .= chr(ord($owner_RC4_key{$j}) ^ $i);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $enc = $this-&gt;_RC4($key, $enc);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $enc;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Compute U value</span></span>&nbsp;</div></li><li><div>  function _Uvalue()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;useRC128encryption) {&nbsp;</div></li><li><div>          $tmp = $this-&gt;_md5_16($this-&gt;padding . $this-&gt;_hexToString($this-&gt;uniqid));&nbsp;</div></li><li><div>          $enc = $this-&gt;_RC4($this-&gt;encryption_key, $tmp);&nbsp;</div></li><li><div>          $len = strlen($tmp);&nbsp;</div></li><li><div>          for ($i = 1; $i &lt;= 19; ++$i) {&nbsp;</div></li><li><div>              $key = '';&nbsp;</div></li><li><div>              for ($j = 0; $j &lt; $len; ++$j) {&nbsp;</div></li><li><div>                  $key .= chr(ord($this-&gt;encryption_key{$j}) ^ $i);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $enc = $this-&gt;_RC4($key, $enc);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $enc .= str_repeat(&quot;\x00&quot;, 16);&nbsp;</div></li><li><div>          return substr($enc, 0, 32);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return $this-&gt;_RC4($this-&gt;encryption_key, $this-&gt;padding);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Compute encryption key</span>&nbsp;</div></li><li><div>  function _generateencryptionkey($user_pass, $owner_pass, $protection)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Pad passwords</span>&nbsp;</div></li><li><div>      $user_pass = substr($user_pass . $this-&gt;padding, 0, 32);&nbsp;</div></li><li><div>      $owner_pass = substr($owner_pass . $this-&gt;padding, 0, 32);&nbsp;</div></li><li><div>      $chars = 'ABCDEF1234567890';&nbsp;</div></li><li><div>      $id = '';&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; 32; $i++) {&nbsp;</div></li><li><div>          $id .= $chars{rand(0, 15)};&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;uniqid = md5($id);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Compute O value</span></span>&nbsp;</div></li><li><div>      $this-&gt;Ovalue = $this-&gt;_Ovalue($user_pass, $owner_pass);&nbsp;</div></li><li><div>      <span class="comment">// Compute encyption key</span>&nbsp;</div></li><li><div>      if ($this-&gt;useRC128encryption)&nbsp;</div></li><li><div>          $keybytelen = (128 / 8);&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $keybytelen = (40 / 8);&nbsp;</div></li><li><div>      $prot = sprintf('%032b', $protection);&nbsp;</div></li><li><div>      $perms = chr(bindec(substr($prot, 24, 8)));&nbsp;</div></li><li><div>      $perms .= chr(bindec(substr($prot, 16, 8)));&nbsp;</div></li><li><div>      $perms .= chr(bindec(substr($prot, 8, 8)));&nbsp;</div></li><li><div>      $perms .= chr(bindec(substr($prot, 0, 8)));&nbsp;</div></li><li><div>      $tmp = $this-&gt;_md5_16($user_pass . $this-&gt;Ovalue . $perms . $this-&gt;_hexToString($this-&gt;uniqid));&nbsp;</div></li><li><div>      if ($this-&gt;useRC128encryption) {&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; 50; ++$i) {&nbsp;</div></li><li><div>              $tmp = $this-&gt;_md5_16(substr($tmp, 0, $keybytelen));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;encryption_key = substr($tmp, 0, $keybytelen);&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Compute U value</span></span>&nbsp;</div></li><li><div>      $this-&gt;Uvalue = $this-&gt;_Uvalue();&nbsp;</div></li><li><div>      <span class="comment">// Compute P value</span>&nbsp;</div></li><li><div>      $this-&gt;Pvalue = $protection;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _hexToString($hs)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>      $len = strlen($hs);&nbsp;</div></li><li><div>      if (($len % 2) != 0) {&nbsp;</div></li><li><div>          $hs .= '0';&nbsp;</div></li><li><div>          ++$len;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $len; $i += 2) {&nbsp;</div></li><li><div>          $s .= chr(hexdec($hs{$i} . $hs{($i + 1)}));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ENCRYPTION -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>===========&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment">// FROM class PDF_Bookmark</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Bookmark($txt, $level = 0, $y = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $txt = $this-&gt;purify_utf8_text($txt);&nbsp;</div></li><li><div>      if ($this-&gt;text_input_as_HTML) {&nbsp;</div></li><li><div>          $txt = $this-&gt;all_entities_to_utf8($txt);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($y == -1) {&nbsp;</div></li><li><div>          if (!$this-&gt;ColActive) {&nbsp;</div></li><li><div>              $y = $this-&gt;y;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $y = $this-&gt;y0;&nbsp;</div></li><li><div>          } <span class="comment">// If columns are on - mark top of columns</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// else y is used as set, or =0 i.e. top of page</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span> RTL&nbsp;</div></li><li><div>      $bmo = array('t' =&gt; $txt, 'l' =&gt; $level, 'y' =&gt; $y, 'p' =&gt; $this-&gt;page);&nbsp;</div></li><li><div>      if ($this-&gt;keep_block_together) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// do nothing</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>          $this-&gt;tbrot_BMoutlines[] = $bmo;&nbsp;</div></li><li><div>      } elseif ($this-&gt;kwt) {&nbsp;</div></li><li><div>          $this-&gt;kwt_BMoutlines[] = $bmo;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif ($this-&gt;ColActive) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;col_BMoutlines[] = $bmo; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $this-&gt;BMoutlines[] = $bmo;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _putbookmarks()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $nb = count($this-&gt;BMoutlines);&nbsp;</div></li><li><div>      if ($nb == 0)&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bmo = $this-&gt;BMoutlines;&nbsp;</div></li><li><div>      $this-&gt;BMoutlines = array();&nbsp;</div></li><li><div>      $lastlevel = -1;&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; count($bmo); $i++) {&nbsp;</div></li><li><div>          if ($bmo[$i]['l'] &gt; 0) {&nbsp;</div></li><li><div>              while ($bmo[$i]['l'] - $lastlevel &gt; 1) { <span class="comment">// If jump down more than one level, insert a new entry</span>&nbsp;</div></li><li><div>                  $new = $bmo[$i];&nbsp;</div></li><li><div>                  $new['t'] = &quot;[&quot; . $new['t'] . &quot;]&quot;; <span class="comment">// Put [] around text/title to highlight</span>&nbsp;</div></li><li><div>                  $new['l'] = $lastlevel + 1;&nbsp;</div></li><li><div>                  $lastlevel++;&nbsp;</div></li><li><div>                  $this-&gt;BMoutlines[] = $new;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;BMoutlines[] = $bmo[$i];&nbsp;</div></li><li><div>          $lastlevel = $bmo[$i]['l'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $nb = count($this-&gt;BMoutlines);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $lru = array();&nbsp;</div></li><li><div>      $level = 0;&nbsp;</div></li><li><div>      foreach ($this-&gt;BMoutlines as $i =&gt; $o) {&nbsp;</div></li><li><div>          if ($o['l'] &gt; 0) {&nbsp;</div></li><li><div>              $parent = $lru[$o['l'] - 1];&nbsp;</div></li><li><div>              <span class="comment">//Set parent and last pointers</span>&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[$i]['parent'] = $parent;&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[$parent]['last'] = $i;&nbsp;</div></li><li><div>              if ($o['l'] &gt; $level) {&nbsp;</div></li><li><div>                  <span class="comment">//Level increasing: set first pointer</span>&nbsp;</div></li><li><div>                  $this-&gt;BMoutlines[$parent]['first'] = $i;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[$i]['parent'] = $nb;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($o['l'] &lt;= $level and $i &gt; 0) {&nbsp;</div></li><li><div>              <span class="comment">//Set prev and next pointers</span>&nbsp;</div></li><li><div>              $prev = $lru[$o['l']];&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[$prev]['next'] = $i;&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[$i]['prev'] = $prev;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $lru[$o['l']] = $i;&nbsp;</div></li><li><div>          $level = $o['l'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Outline items</span>&nbsp;</div></li><li><div>      $n = $this-&gt;n + 1;&nbsp;</div></li><li><div>      foreach ($this-&gt;BMoutlines as $i =&gt; $o) {&nbsp;</div></li><li><div>          $this-&gt;_newobj();&nbsp;</div></li><li><div>          $this-&gt;_out('&lt;&lt;/Title ' . $this-&gt;_UTF16BEtextstring($o['t']));&nbsp;</div></li><li><div>          $this-&gt;_out('/Parent ' . ($n + $o['parent']) . ' 0 R');&nbsp;</div></li><li><div>          if (isset($o['prev']))&nbsp;</div></li><li><div>              $this-&gt;_out('/Prev ' . ($n + $o['prev']) . ' 0 R');&nbsp;</div></li><li><div>          if (isset($o['next']))&nbsp;</div></li><li><div>              $this-&gt;_out('/Next ' . ($n + $o['next']) . ' 0 R');&nbsp;</div></li><li><div>          if (isset($o['first']))&nbsp;</div></li><li><div>              $this-&gt;_out('/First ' . ($n + $o['first']) . ' 0 R');&nbsp;</div></li><li><div>          if (isset($o['last']))&nbsp;</div></li><li><div>              $this-&gt;_out('/Last ' . ($n + $o['last']) . ' 0 R');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($this-&gt;pageDim[$o['p']]['h'])) {&nbsp;</div></li><li><div>              $h = $this-&gt;pageDim[$o['p']]['h'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $h = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('/Dest [%d 0 R /XYZ 0 %.3F null]', 1 + 2 * ($o['p']), ($h - $o['y']) * _MPDFK));&nbsp;</div></li><li><div>          if (isset($this-&gt;bookmarkStyles) && isset($this-&gt;bookmarkStyles[$o['l']])) {&nbsp;</div></li><li><div>              <span class="comment">// font style</span>&nbsp;</div></li><li><div>              $bms = $this-&gt;bookmarkStyles[$o['l']]['style'];&nbsp;</div></li><li><div>              $style = 0;&nbsp;</div></li><li><div>              if (strpos($bms, 'B') !== false) {&nbsp;</div></li><li><div>                  $style += 2;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (strpos($bms, 'I') !== false) {&nbsp;</div></li><li><div>                  $style += 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out(sprintf('/F %d', $style));&nbsp;</div></li><li><div>              <span class="comment">// Colour</span>&nbsp;</div></li><li><div>              $col = $this-&gt;bookmarkStyles[$o['l']]['color'];&nbsp;</div></li><li><div>              if (isset($col) && is_array($col) && count($col) == 3) {&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('/C [%.3F %.3F %.3F]', ($col[0] / 255), ($col[1] / 255), ($col[2] / 255)));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;_out('/Count 0&gt;&gt;');&nbsp;</div></li><li><div>          $this-&gt;_out('endobj');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Outline root</span>&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $this-&gt;OutlineRoot = $this-&gt;n;&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;/Type /BMoutlines /First ' . $n . ' 0 R');&nbsp;</div></li><li><div>      $this-&gt;_out('/Last ' . ($n + $lru[0]) . ' 0 R&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>========================&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment">// ToC TABLE OF CONTENTS</span>&nbsp;</div></li><li><div>  <span class="comment">// Initiate, and Mark a place for the Table of Contents to be inserted</span>&nbsp;</div></li><li><div>  function TOC($tocfont = '', $tocfontsize = 0, $tocindent = 0, $resetpagenum = '', $pagenumstyle = '', $suppress = '', $toc_orientation = '', $TOCusePaging = true, $TOCuseLinking = false, $toc_id = 0, $tocoutdent = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('tocontents', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/tocontents.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;tocontents)) {&nbsp;</div></li><li><div>          $this-&gt;tocontents = new tocontents($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;tocontents-&gt;TOC($tocfont, $tocfontsize, $tocindent, $resetpagenum, $pagenumstyle, $suppress, $toc_orientation, $TOCusePaging, $TOCuseLinking, $toc_id, $tocoutdent);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function TOCpagebreakByArray($a)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!is_array($a)) {&nbsp;</div></li><li><div>          $a = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!class_exists('tocontents', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/tocontents.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;tocontents)) {&nbsp;</div></li><li><div>          $this-&gt;tocontents = new tocontents($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $tocoutdent = (isset($a['tocoutdent']) ? $a['tocoutdent'] : (isset($a['outdent']) ? $a['outdent'] : ''));&nbsp;</div></li><li><div>      $TOCusePaging = (isset($a['TOCusePaging']) ? $a['TOCusePaging'] : (isset($a['paging']) ? $a['paging'] : true));&nbsp;</div></li><li><div>      $TOCuseLinking = (isset($a['TOCuseLinking']) ? $a['TOCuseLinking'] : (isset($a['links']) ? $a['links'] : ''));&nbsp;</div></li><li><div>      $toc_orientation = (isset($a['toc_orientation']) ? $a['toc_orientation'] : (isset($a['toc-orientation']) ? $a['toc-orientation'] : ''));&nbsp;</div></li><li><div>      $toc_mgl = (isset($a['toc_mgl']) ? $a['toc_mgl'] : (isset($a['toc-margin-left']) ? $a['toc-margin-left'] : ''));&nbsp;</div></li><li><div>      $toc_mgr = (isset($a['toc_mgr']) ? $a['toc_mgr'] : (isset($a['toc-margin-right']) ? $a['toc-margin-right'] : ''));&nbsp;</div></li><li><div>      $toc_mgt = (isset($a['toc_mgt']) ? $a['toc_mgt'] : (isset($a['toc-margin-top']) ? $a['toc-margin-top'] : ''));&nbsp;</div></li><li><div>      $toc_mgb = (isset($a['toc_mgb']) ? $a['toc_mgb'] : (isset($a['toc-margin-bottom']) ? $a['toc-margin-bottom'] : ''));&nbsp;</div></li><li><div>      $toc_mgh = (isset($a['toc_mgh']) ? $a['toc_mgh'] : (isset($a['toc-margin-header']) ? $a['toc-margin-header'] : ''));&nbsp;</div></li><li><div>      $toc_mgf = (isset($a['toc_mgf']) ? $a['toc_mgf'] : (isset($a['toc-margin-footer']) ? $a['toc-margin-footer'] : ''));&nbsp;</div></li><li><div>      $toc_ohname = (isset($a['toc_ohname']) ? $a['toc_ohname'] : (isset($a['toc-odd-header-name']) ? $a['toc-odd-header-name'] : ''));&nbsp;</div></li><li><div>      $toc_ehname = (isset($a['toc_ehname']) ? $a['toc_ehname'] : (isset($a['toc-even-header-name']) ? $a['toc-even-header-name'] : ''));&nbsp;</div></li><li><div>      $toc_ofname = (isset($a['toc_ofname']) ? $a['toc_ofname'] : (isset($a['toc-odd-footer-name']) ? $a['toc-odd-footer-name'] : ''));&nbsp;</div></li><li><div>      $toc_efname = (isset($a['toc_efname']) ? $a['toc_efname'] : (isset($a['toc-even-footer-name']) ? $a['toc-even-footer-name'] : ''));&nbsp;</div></li><li><div>      $toc_ohvalue = (isset($a['toc_ohvalue']) ? $a['toc_ohvalue'] : (isset($a['toc-odd-header-value']) ? $a['toc-odd-header-value'] : 0));&nbsp;</div></li><li><div>      $toc_ehvalue = (isset($a['toc_ehvalue']) ? $a['toc_ehvalue'] : (isset($a['toc-even-header-value']) ? $a['toc-even-header-value'] : 0));&nbsp;</div></li><li><div>      $toc_ofvalue = (isset($a['toc_ofvalue']) ? $a['toc_ofvalue'] : (isset($a['toc-odd-footer-value']) ? $a['toc-odd-footer-value'] : 0));&nbsp;</div></li><li><div>      $toc_efvalue = (isset($a['toc_efvalue']) ? $a['toc_efvalue'] : (isset($a['toc-even-footer-value']) ? $a['toc-even-footer-value'] : 0));&nbsp;</div></li><li><div>      $toc_preHTML = (isset($a['toc_preHTML']) ? $a['toc_preHTML'] : (isset($a['toc-preHTML']) ? $a['toc-preHTML'] : ''));&nbsp;</div></li><li><div>      $toc_postHTML = (isset($a['toc_postHTML']) ? $a['toc_postHTML'] : (isset($a['toc-postHTML']) ? $a['toc-postHTML'] : ''));&nbsp;</div></li><li><div>      $toc_bookmarkText = (isset($a['toc_bookmarkText']) ? $a['toc_bookmarkText'] : (isset($a['toc-bookmarkText']) ? $a['toc-bookmarkText'] : ''));&nbsp;</div></li><li><div>      $resetpagenum = (isset($a['resetpagenum']) ? $a['resetpagenum'] : '');&nbsp;</div></li><li><div>      $pagenumstyle = (isset($a['pagenumstyle']) ? $a['pagenumstyle'] : '');&nbsp;</div></li><li><div>      $suppress = (isset($a['suppress']) ? $a['suppress'] : '');&nbsp;</div></li><li><div>      $orientation = (isset($a['orientation']) ? $a['orientation'] : '');&nbsp;</div></li><li><div>      $mgl = (isset($a['mgl']) ? $a['mgl'] : (isset($a['margin-left']) ? $a['margin-left'] : ''));&nbsp;</div></li><li><div>      $mgr = (isset($a['mgr']) ? $a['mgr'] : (isset($a['margin-right']) ? $a['margin-right'] : ''));&nbsp;</div></li><li><div>      $mgt = (isset($a['mgt']) ? $a['mgt'] : (isset($a['margin-top']) ? $a['margin-top'] : ''));&nbsp;</div></li><li><div>      $mgb = (isset($a['mgb']) ? $a['mgb'] : (isset($a['margin-bottom']) ? $a['margin-bottom'] : ''));&nbsp;</div></li><li><div>      $mgh = (isset($a['mgh']) ? $a['mgh'] : (isset($a['margin-header']) ? $a['margin-header'] : ''));&nbsp;</div></li><li><div>      $mgf = (isset($a['mgf']) ? $a['mgf'] : (isset($a['margin-footer']) ? $a['margin-footer'] : ''));&nbsp;</div></li><li><div>      $ohname = (isset($a['ohname']) ? $a['ohname'] : (isset($a['odd-header-name']) ? $a['odd-header-name'] : ''));&nbsp;</div></li><li><div>      $ehname = (isset($a['ehname']) ? $a['ehname'] : (isset($a['even-header-name']) ? $a['even-header-name'] : ''));&nbsp;</div></li><li><div>      $ofname = (isset($a['ofname']) ? $a['ofname'] : (isset($a['odd-footer-name']) ? $a['odd-footer-name'] : ''));&nbsp;</div></li><li><div>      $efname = (isset($a['efname']) ? $a['efname'] : (isset($a['even-footer-name']) ? $a['even-footer-name'] : ''));&nbsp;</div></li><li><div>      $ohvalue = (isset($a['ohvalue']) ? $a['ohvalue'] : (isset($a['odd-header-value']) ? $a['odd-header-value'] : 0));&nbsp;</div></li><li><div>      $ehvalue = (isset($a['ehvalue']) ? $a['ehvalue'] : (isset($a['even-header-value']) ? $a['even-header-value'] : 0));&nbsp;</div></li><li><div>      $ofvalue = (isset($a['ofvalue']) ? $a['ofvalue'] : (isset($a['odd-footer-value']) ? $a['odd-footer-value'] : 0));&nbsp;</div></li><li><div>      $efvalue = (isset($a['efvalue']) ? $a['efvalue'] : (isset($a['even-footer-value']) ? $a['even-footer-value'] : 0));&nbsp;</div></li><li><div>      $toc_id = (isset($a['toc_id']) ? $a['toc_id'] : (isset($a['name']) ? $a['name'] : 0));&nbsp;</div></li><li><div>      $pagesel = (isset($a['pagesel']) ? $a['pagesel'] : (isset($a['pageselector']) ? $a['pageselector'] : ''));&nbsp;</div></li><li><div>      $toc_pagesel = (isset($a['toc_pagesel']) ? $a['toc_pagesel'] : (isset($a['toc-pageselector']) ? $a['toc-pageselector'] : ''));&nbsp;</div></li><li><div>      $sheetsize = (isset($a['sheetsize']) ? $a['sheetsize'] : (isset($a['sheet-size']) ? $a['sheet-size'] : ''));&nbsp;</div></li><li><div>      $toc_sheetsize = (isset($a['toc_sheetsize']) ? $a['toc_sheetsize'] : (isset($a['toc-sheet-size']) ? $a['toc-sheet-size'] : ''));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;TOCpagebreak($tocfont, $tocfontsize, $tocindent, $TOCusePaging, $TOCuseLinking, $toc_orientation, $toc_mgl, $toc_mgr, $toc_mgt, $toc_mgb, $toc_mgh, $toc_mgf, $toc_ohname, $toc_ehname, $toc_ofname, $toc_efname, $toc_ohvalue, $toc_ehvalue, $toc_ofvalue, $toc_efvalue, $toc_preHTML, $toc_postHTML, $toc_bookmarkText, $resetpagenum, $pagenumstyle, $suppress, $orientation, $mgl, $mgr, $mgt, $mgb, $mgh, $mgf, $ohname, $ehname, $ofname, $efname, $ohvalue, $ehvalue, $ofvalue, $efvalue, $toc_id, $pagesel, $toc_pagesel, $sheetsize, $toc_sheetsize, $tocoutdent);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function TOCpagebreak($tocfont = '', $tocfontsize = '', $tocindent = '', $TOCusePaging = true, $TOCuseLinking = '', $toc_orientation = '', $toc_mgl = '', $toc_mgr = '', $toc_mgt = '', $toc_mgb = '', $toc_mgh = '', $toc_mgf = '', $toc_ohname = '', $toc_ehname = '', $toc_ofname = '', $toc_efname = '', $toc_ohvalue = 0, $toc_ehvalue = 0, $toc_ofvalue = 0, $toc_efvalue = 0, $toc_preHTML = '', $toc_postHTML = '', $toc_bookmarkText = '', $resetpagenum = '', $pagenumstyle = '', $suppress = '', $orientation = '', $mgl = '', $mgr = '', $mgt = '', $mgb = '', $mgh = '', $mgf = '', $ohname = '', $ehname = '', $ofname = '', $efname = '', $ohvalue = 0, $ehvalue = 0, $ofvalue = 0, $efvalue = 0, $toc_id = 0, $pagesel = '', $toc_pagesel = '', $sheetsize = '', $toc_sheetsize = '', $tocoutdent = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('tocontents', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/tocontents.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;tocontents)) {&nbsp;</div></li><li><div>          $this-&gt;tocontents = new tocontents($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$resetpagenum) {&nbsp;</div></li><li><div>          $resetpagenum = 1;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Start a new page</span></span>&nbsp;</div></li><li><div>      if ($this-&gt;state == 0)&nbsp;</div></li><li><div>          $this-&gt;AddPage();&nbsp;</div></li><li><div>      if ($this-&gt;y == $this-&gt;tMargin && (!$this-&gt;mirrorMargins || ($this-&gt;mirrorMargins && $this-&gt;page % 2 == 1))) {&nbsp;</div></li><li><div>          <span class="comment">// Don't add a page</span>&nbsp;</div></li><li><div>          if ($this-&gt;page == 1 && count($this-&gt;PageNumSubstitutions) == 0) {&nbsp;</div></li><li><div>              if (!$suppress) {&nbsp;</div></li><li><div>                  $suppress = 'off';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">//$this-&gt;PageNumSubstitutions[] = array('from'=&gt;1, 'reset'=&gt; $resetpagenum, 'type'=&gt;$pagenumstyle, 'suppress'=&gt; $suppress);</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;PageNumSubstitutions[] = array('from' =&gt; $this-&gt;page, 'reset' =&gt; $resetpagenum, 'type' =&gt; $pagenumstyle, 'suppress' =&gt; $suppress);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;AddPage($orientation, 'NEXT-ODD', $resetpagenum, $pagenumstyle, $suppress, $mgl, $mgr, $mgt, $mgb, $mgh, $mgf, $ohname, $ehname, $ofname, $efname, $ohvalue, $ehvalue, $ofvalue, $efvalue, $pagesel, $sheetsize);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;tocontents-&gt;TOCpagebreak($tocfont, $tocfontsize, $tocindent, $TOCusePaging, $TOCuseLinking, $toc_orientation, $toc_mgl, $toc_mgr, $toc_mgt, $toc_mgb, $toc_mgh, $toc_mgf, $toc_ohname, $toc_ehname, $toc_ofname, $toc_efname, $toc_ohvalue, $toc_ehvalue, $toc_ofvalue, $toc_efvalue, $toc_preHTML, $toc_postHTML, $toc_bookmarkText, $resetpagenum, $pagenumstyle, $suppress, $orientation, $mgl, $mgr, $mgt, $mgb, $mgh, $mgf, $ohname, $ehname, $ofname, $efname, $ohvalue, $ehvalue, $ofvalue, $efvalue, $toc_id, $pagesel, $toc_pagesel, $sheetsize, $toc_sheetsize, $tocoutdent);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function TOC_Entry($txt, $level = 0, $toc_id = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          $ily = $this-&gt;y0;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $ily = $this-&gt;y;&nbsp;</div></li><li><div>      } <span class="comment">// use top of columns</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!class_exists('tocontents', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/tocontents.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;tocontents)) {&nbsp;</div></li><li><div>          $this-&gt;tocontents = new tocontents($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $linkn = $this-&gt;AddLink();&nbsp;</div></li><li><div>      $uid = '__mpdfinternallink_' . $linkn;&nbsp;</div></li><li><div>      if ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>          $this-&gt;internallink[$uid] = array(&quot;Y&quot; =&gt; $ily, &quot;PAGE&quot; =&gt; $this-&gt;page, &quot;tbrot&quot; =&gt; true);&nbsp;</div></li><li><div>      } elseif ($this-&gt;kwt) {&nbsp;</div></li><li><div>          $this-&gt;internallink[$uid] = array(&quot;Y&quot; =&gt; $ily, &quot;PAGE&quot; =&gt; $this-&gt;page, &quot;kwt&quot; =&gt; true);&nbsp;</div></li><li><div>      } elseif ($this-&gt;ColActive) {&nbsp;</div></li><li><div>          $this-&gt;internallink[$uid] = array(&quot;Y&quot; =&gt; $ily, &quot;PAGE&quot; =&gt; $this-&gt;page, &quot;col&quot; =&gt; $this-&gt;CurrCol);&nbsp;</div></li><li><div>      } elseif (!$this-&gt;keep_block_together) {&nbsp;</div></li><li><div>          $this-&gt;internallink[$uid] = array(&quot;Y&quot; =&gt; $ily, &quot;PAGE&quot; =&gt; $this-&gt;page);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;internallink['#' . $uid] = $linkn;&nbsp;</div></li><li><div>      $this-&gt;SetLink($linkn, $ily, $this-&gt;page);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (strtoupper($toc_id) == 'ALL') {&nbsp;</div></li><li><div>          $toc_id = '_mpdf_all';&nbsp;</div></li><li><div>      } elseif (!$toc_id) {&nbsp;</div></li><li><div>          $toc_id = 0;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $toc_id = strtolower($toc_id);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $btoc = array('t' =&gt; $txt, 'l' =&gt; $level, 'p' =&gt; $this-&gt;page, 'link' =&gt; $linkn, 'toc_id' =&gt; $toc_id);&nbsp;</div></li><li><div>      if ($this-&gt;keep_block_together) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// do nothing</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>          $this-&gt;tbrot_toc[] = $btoc;&nbsp;</div></li><li><div>      } elseif ($this-&gt;kwt) {&nbsp;</div></li><li><div>          $this-&gt;kwt_toc[] = $btoc;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif ($this-&gt;ColActive) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;col_toc[] = $btoc; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $this-&gt;tocontents-&gt;_toc[] = $btoc;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>========================&nbsp;</div></li><li><div>  function MovePages($target_page, $start_page, $end_page = -1)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// move a page/pages EARLIER in the document</span></span>&nbsp;</div></li><li><div>      if ($end_page &lt; 1) {&nbsp;</div></li><li><div>          $end_page = $start_page;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $n_toc = $end_page - $start_page + 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Set/Update PageNumSubstitutions changes before moving anything</span>&nbsp;</div></li><li><div>      if (count($this-&gt;PageNumSubstitutions)) {&nbsp;</div></li><li><div>          $tp_present = false;&nbsp;</div></li><li><div>          $sp_present = false;&nbsp;</div></li><li><div>          $ep_present = false;&nbsp;</div></li><li><div>          foreach ($this-&gt;PageNumSubstitutions AS $k =&gt; $v) {&nbsp;</div></li><li><div>              if ($this-&gt;PageNumSubstitutions[$k]['from'] == $target_page) {&nbsp;</div></li><li><div>                  $tp_present = true;&nbsp;</div></li><li><div>                  if ($this-&gt;PageNumSubstitutions[$k]['suppress'] != 'on' && $this-&gt;PageNumSubstitutions[$k]['suppress'] != 1) {&nbsp;</div></li><li><div>                      $this-&gt;PageNumSubstitutions[$k]['suppress'] = 'off';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;PageNumSubstitutions[$k]['from'] == $start_page) {&nbsp;</div></li><li><div>                  $sp_present = true;&nbsp;</div></li><li><div>                  if ($this-&gt;PageNumSubstitutions[$k]['suppress'] != 'on' && $this-&gt;PageNumSubstitutions[$k]['suppress'] != 1) {&nbsp;</div></li><li><div>                      $this-&gt;PageNumSubstitutions[$k]['suppress'] = 'off';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($this-&gt;PageNumSubstitutions[$k]['from'] == ($end_page + 1)) {&nbsp;</div></li><li><div>                  $ep_present = true;&nbsp;</div></li><li><div>                  if ($this-&gt;PageNumSubstitutions[$k]['suppress'] != 'on' && $this-&gt;PageNumSubstitutions[$k]['suppress'] != 1) {&nbsp;</div></li><li><div>                      $this-&gt;PageNumSubstitutions[$k]['suppress'] = 'off';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (!$tp_present) {&nbsp;</div></li><li><div>              list($tp_type, $tp_suppress, $tp_reset) = $this-&gt;docPageSettings($target_page);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$sp_present) {&nbsp;</div></li><li><div>              list($sp_type, $sp_suppress, $sp_reset) = $this-&gt;docPageSettings($start_page);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$ep_present) {&nbsp;</div></li><li><div>              list($ep_type, $ep_suppress, $ep_reset) = $this-&gt;docPageSettings($start_page - 1);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $last = array();&nbsp;</div></li><li><div>      <span class="comment">//store pages</span>&nbsp;</div></li><li><div>      for ($i = $start_page; $i &lt;= $end_page; $i++)&nbsp;</div></li><li><div>          $last[] = $this-&gt;pages[$i];&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//move pages</span></span>&nbsp;</div></li><li><div>      for ($i = $start_page - 1; $i &gt;= ($target_page); $i--) {&nbsp;</div></li><li><div>          $this-&gt;pages[$i + $n_toc] = $this-&gt;pages[$i];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Put toc pages at insert point</span>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $n_toc; $i++) {&nbsp;</div></li><li><div>          $this-&gt;pages[$target_page + $i] = $last[$i];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Bookmarks</span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;BMoutlines as $i =&gt; $o) {&nbsp;</div></li><li><div>          if ($o['p'] &gt;= $target_page) {&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[$i]['p'] += $n_toc;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Page Links</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;PageLinks)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;PageLinks as $i =&gt; $o) {&nbsp;</div></li><li><div>              foreach ($this-&gt;PageLinks[$i] as $key =&gt; $pl) {&nbsp;</div></li><li><div>                  if (strpos($pl[4], '@') === 0) {&nbsp;</div></li><li><div>                      $p = substr($pl[4], 1);&nbsp;</div></li><li><div>                      if ($p &gt;= $start_page && $p &lt;= $end_page) {&nbsp;</div></li><li><div>                          $this-&gt;PageLinks[$i][$key][4] = '@' . ($p + ($target_page - $start_page));&nbsp;</div></li><li><div>                      } elseif ($p &gt;= $target_page && $p &lt; $start_page) {&nbsp;</div></li><li><div>                          $this-&gt;PageLinks[$i][$key][4] = '@' . ($p + $n_toc);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($i &gt;= $start_page && $i &lt;= $end_page) {&nbsp;</div></li><li><div>                  $newarr[($i + ($target_page - $start_page))] = $this-&gt;PageLinks[$i];&nbsp;</div></li><li><div>              } elseif ($i &gt;= $target_page && $i &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[($i + $n_toc)] = $this-&gt;PageLinks[$i];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $newarr[$i] = $this-&gt;PageLinks[$i];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;PageLinks = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// OrientationChanges</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;OrientationChanges)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;OrientationChanges AS $p =&gt; $v) {&nbsp;</div></li><li><div>              if ($p &gt;= $start_page && $p &lt;= $end_page) {&nbsp;</div></li><li><div>                  $newarr[($p + ($target_page - $start_page))] = $this-&gt;OrientationChanges[$p];&nbsp;</div></li><li><div>              } elseif ($p &gt;= $target_page && $p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$p + $n_toc] = $this-&gt;OrientationChanges[$p];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;OrientationChanges[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;OrientationChanges = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Page Dimensions</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;pageDim)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;pageDim AS $p =&gt; $v) {&nbsp;</div></li><li><div>              if ($p &gt;= $start_page && $p &lt;= $end_page) {&nbsp;</div></li><li><div>                  $newarr[($p + ($target_page - $start_page))] = $this-&gt;pageDim[$p];&nbsp;</div></li><li><div>              } elseif ($p &gt;= $target_page && $p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$p + $n_toc] = $this-&gt;pageDim[$p];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;pageDim[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;pageDim = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// HTML Headers & Footers</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;saveHTMLHeader)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;saveHTMLHeader AS $p =&gt; $v) {&nbsp;</div></li><li><div>              if ($p &gt;= $start_page && $p &lt;= $end_page) {&nbsp;</div></li><li><div>                  $newarr[($p + ($target_page - $start_page))] = $this-&gt;saveHTMLHeader[$p];&nbsp;</div></li><li><div>              } elseif ($p &gt;= $target_page && $p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$p + $n_toc] = $this-&gt;saveHTMLHeader[$p];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;saveHTMLHeader[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (count($this-&gt;saveHTMLFooter)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;saveHTMLFooter AS $p =&gt; $v) {&nbsp;</div></li><li><div>              if ($p &gt;= $start_page && $p &lt;= $end_page) {&nbsp;</div></li><li><div>                  $newarr[($p + ($target_page - $start_page))] = $this-&gt;saveHTMLFooter[$p];&nbsp;</div></li><li><div>              } elseif ($p &gt;= $target_page && $p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$p + $n_toc] = $this-&gt;saveHTMLFooter[$p];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;saveHTMLFooter[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Internal Links</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;internallink)) {&nbsp;</div></li><li><div>          foreach ($this-&gt;internallink as $key =&gt; $o) {&nbsp;</div></li><li><div>              if ($o['PAGE'] &gt;= $start_page && $o['PAGE'] &lt;= $end_page) {&nbsp;</div></li><li><div>                  $this-&gt;internallink[$key]['PAGE'] += ($target_page - $start_page);&nbsp;</div></li><li><div>              } elseif ($o['PAGE'] &gt;= $target_page && $o['PAGE'] &lt; $start_page) {&nbsp;</div></li><li><div>                  $this-&gt;internallink[$key]['PAGE'] += $n_toc;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Links</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;links)) {&nbsp;</div></li><li><div>          foreach ($this-&gt;links as $key =&gt; $o) {&nbsp;</div></li><li><div>              if ($o[0] &gt;= $start_page && $o[0] &lt;= $end_page) {&nbsp;</div></li><li><div>                  $this-&gt;links[$key][0] += ($target_page - $start_page);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($o[0] &gt;= $target_page && $o[0] &lt; $start_page) {&nbsp;</div></li><li><div>                  $this-&gt;links[$key][0] += $n_toc;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Form fields</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;mpdfform-&gt;forms)) {&nbsp;</div></li><li><div>          foreach ($this-&gt;mpdfform-&gt;forms as $key =&gt; $f) {&nbsp;</div></li><li><div>              if ($f['page'] &gt;= $start_page && $f['page'] &lt;= $end_page) {&nbsp;</div></li><li><div>                  $this-&gt;mpdfform-&gt;forms[$key]['page'] += ($target_page - $start_page);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($f['page'] &gt;= $target_page && $f['page'] &lt; $start_page) {&nbsp;</div></li><li><div>                  $this-&gt;mpdfform-&gt;forms[$key]['page'] += $n_toc;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Annotations</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;PageAnnots)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;PageAnnots as $p =&gt; $anno) {&nbsp;</div></li><li><div>              if ($p &gt;= $start_page && $p &lt;= $end_page) {&nbsp;</div></li><li><div>                  $np = $p + ($target_page - $start_page);&nbsp;</div></li><li><div>                  foreach ($anno as $o) {&nbsp;</div></li><li><div>                      $newarr[$np][] = $o;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ($p &gt;= $target_page && $p &lt; $start_page) {&nbsp;</div></li><li><div>                  $np = $p + $n_toc;&nbsp;</div></li><li><div>                  foreach ($anno as $o) {&nbsp;</div></li><li><div>                      $newarr[$np][] = $o;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;PageAnnots[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;PageAnnots = $newarr;&nbsp;</div></li><li><div>          unset($newarr);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update PageNumSubstitutions</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;PageNumSubstitutions)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;PageNumSubstitutions AS $k =&gt; $v) {&nbsp;</div></li><li><div>              if ($this-&gt;PageNumSubstitutions[$k]['from'] &gt;= $start_page && $this-&gt;PageNumSubstitutions[$k]['from'] &lt;= $end_page) {&nbsp;</div></li><li><div>                  $this-&gt;PageNumSubstitutions[$k]['from'] += ($target_page - $start_page);&nbsp;</div></li><li><div>                  $newarr[$this-&gt;PageNumSubstitutions[$k]['from']] = $this-&gt;PageNumSubstitutions[$k];&nbsp;</div></li><li><div>              } elseif ($this-&gt;PageNumSubstitutions[$k]['from'] &gt;= $target_page && $this-&gt;PageNumSubstitutions[$k]['from'] &lt; $start_page) {&nbsp;</div></li><li><div>                  $this-&gt;PageNumSubstitutions[$k]['from'] += $n_toc;&nbsp;</div></li><li><div>                  $newarr[$this-&gt;PageNumSubstitutions[$k]['from']] = $this-&gt;PageNumSubstitutions[$k];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $newarr[$this-&gt;PageNumSubstitutions[$k]['from']] = $this-&gt;PageNumSubstitutions[$k];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (!$sp_present) {&nbsp;</div></li><li><div>              $newarr[$target_page] = array('from' =&gt; $target_page, 'suppress' =&gt; $sp_suppress, 'reset' =&gt; $sp_reset, 'type' =&gt; $sp_type);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$tp_present) {&nbsp;</div></li><li><div>              $newarr[($target_page + $n_toc)] = array('from' =&gt; ($target_page + $n_toc), 'suppress' =&gt; $tp_suppress, 'reset' =&gt; $tp_reset, 'type' =&gt; $tp_type);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$ep_present && $end_page &gt; count($this-&gt;pages)) {&nbsp;</div></li><li><div>              $newarr[($end_page + 1)] = array('from' =&gt; ($end_page + 1), 'suppress' =&gt; $ep_suppress, 'reset' =&gt; $ep_reset, 'type' =&gt; $ep_type);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;PageNumSubstitutions = array();&nbsp;</div></li><li><div>          foreach ($newarr as $v) {&nbsp;</div></li><li><div>              $this-&gt;PageNumSubstitutions[] = $v;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>========================&nbsp;</div></li><li><div>  function DeletePages($start_page, $end_page = -1)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// move a page/pages EARLIER in the document</span></span>&nbsp;</div></li><li><div>      if ($end_page &lt; 1) {&nbsp;</div></li><li><div>          $end_page = $start_page;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $n_tod = $end_page - $start_page + 1;&nbsp;</div></li><li><div>      $last_page = count($this-&gt;pages);&nbsp;</div></li><li><div>      $n_atend = $last_page - $end_page + 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//move pages</span></span>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $n_atend; $i++) {&nbsp;</div></li><li><div>          $this-&gt;pages[$start_page + $i] = $this-&gt;pages[$end_page + 1 + $i];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//delete pages</span>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $n_tod; $i++)&nbsp;</div></li><li><div>          unset($this-&gt;pages[$last_page - $i]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Bookmarks</span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;BMoutlines as $i =&gt; $o) {&nbsp;</div></li><li><div>          if ($o['p'] &gt;= $end_page) {&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[$i]['p'] -= $n_tod;&nbsp;</div></li><li><div>          } elseif ($p &lt; $start_page) {&nbsp;</div></li><li><div>              unset($this-&gt;BMoutlines[$i]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Page Links</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;PageLinks)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;PageLinks as $i =&gt; $o) {&nbsp;</div></li><li><div>              foreach ($this-&gt;PageLinks[$i] as $key =&gt; $pl) {&nbsp;</div></li><li><div>                  if (strpos($pl[4], '@') === 0) {&nbsp;</div></li><li><div>                      $p = substr($pl[4], 1);&nbsp;</div></li><li><div>                      if ($p &gt; $end_page) {&nbsp;</div></li><li><div>                          $this-&gt;PageLinks[$i][$key][4] = '@' . ($p - $n_tod);&nbsp;</div></li><li><div>                      } elseif ($p &lt; $start_page) {&nbsp;</div></li><li><div>                          unset($this-&gt;PageLinks[$i][$key]);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($i &gt; $end_page) {&nbsp;</div></li><li><div>                  $newarr[($i - $n_tod)] = $this-&gt;PageLinks[$i];&nbsp;</div></li><li><div>              } elseif ($p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$i] = $this-&gt;PageLinks[$i];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;PageLinks = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// OrientationChanges</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;OrientationChanges)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;OrientationChanges AS $p =&gt; $v) {&nbsp;</div></li><li><div>              if ($p &gt; $end_page) {&nbsp;</div></li><li><div>                  $newarr[($p - $t_tod)] = $this-&gt;OrientationChanges[$p];&nbsp;</div></li><li><div>              } elseif ($p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;OrientationChanges[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;OrientationChanges = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Page Dimensions</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;pageDim)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;pageDim AS $p =&gt; $v) {&nbsp;</div></li><li><div>              if ($p &gt; $end_page) {&nbsp;</div></li><li><div>                  $newarr[($p - $n_tod)] = $this-&gt;pageDim[$p];&nbsp;</div></li><li><div>              } elseif ($p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;pageDim[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;pageDim = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// HTML Headers & Footers</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;saveHTMLHeader)) {&nbsp;</div></li><li><div>          foreach ($this-&gt;saveHTMLHeader AS $p =&gt; $v) {&nbsp;</div></li><li><div>              if ($p &gt; $end_page) {&nbsp;</div></li><li><div>                  $newarr[($p - $n_tod)] = $this-&gt;saveHTMLHeader[$p];&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>              elseif ($p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;saveHTMLHeader[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;saveHTMLHeader = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (count($this-&gt;saveHTMLFooter)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;saveHTMLFooter AS $p =&gt; $v) {&nbsp;</div></li><li><div>              if ($p &gt; $end_page) {&nbsp;</div></li><li><div>                  $newarr[($p - $n_tod)] = $this-&gt;saveHTMLFooter[$p];&nbsp;</div></li><li><div>              } elseif ($p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;saveHTMLFooter[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;saveHTMLFooter = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Internal Links</span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;internallink as $key =&gt; $o) {&nbsp;</div></li><li><div>          if ($o['PAGE'] &gt; $end_page) {&nbsp;</div></li><li><div>              $this-&gt;internallink[$key]['PAGE'] -= $n_tod;&nbsp;</div></li><li><div>          } elseif ($o['PAGE'] &lt; $start_page) {&nbsp;</div></li><li><div>              unset($this-&gt;internallink[$key]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Links</span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;links as $key =&gt; $o) {&nbsp;</div></li><li><div>          if ($o[0] &gt; $end_page) {&nbsp;</div></li><li><div>              $this-&gt;links[$key][0] -= $n_tod;&nbsp;</div></li><li><div>          } elseif ($o[0] &lt; $start_page) {&nbsp;</div></li><li><div>              unset($this-&gt;links[$key]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Form fields</span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;mpdfform-&gt;forms as $key =&gt; $f) {&nbsp;</div></li><li><div>          if ($f['page'] &gt; $end_page) {&nbsp;</div></li><li><div>              $this-&gt;mpdfform-&gt;forms[$key]['page'] -= $n_tod;&nbsp;</div></li><li><div>          } elseif ($f['page'] &lt; $start_page) {&nbsp;</div></li><li><div>              unset($this-&gt;mpdfform-&gt;forms[$key]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update Annotations</span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;PageAnnots)) {&nbsp;</div></li><li><div>          $newarr = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;PageAnnots as $p =&gt; $anno) {&nbsp;</div></li><li><div>              if ($p &gt; $end_page) {&nbsp;</div></li><li><div>                  foreach ($anno as $o) {&nbsp;</div></li><li><div>                      $newarr[($p - $n_tod)][] = $o;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ($p &lt; $start_page) {&nbsp;</div></li><li><div>                  $newarr[$p] = $this-&gt;PageAnnots[$p];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort($newarr);&nbsp;</div></li><li><div>          $this-&gt;PageAnnots = $newarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Update PageNumSubstitutions</span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;PageNumSubstitutions AS $k =&gt; $v) {&nbsp;</div></li><li><div>          if ($this-&gt;PageNumSubstitutions[$k]['from'] &gt; $end_page) {&nbsp;</div></li><li><div>              $this-&gt;PageNumSubstitutions[$k]['from'] -= $n_tod;&nbsp;</div></li><li><div>          } elseif ($this-&gt;PageNumSubstitutions[$k]['from'] &lt; $start_page) {&nbsp;</div></li><li><div>              unset($this-&gt;PageNumSubstitutions[$k]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unset($newarr);&nbsp;</div></li><li><div>      $this-&gt;page = count($this-&gt;pages);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>========================&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">/** -- INDEX -- */</span></span></span>&nbsp;</div></li><li><div>  <span class="comment">// FROM class PDF_Ref == INDEX</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function IndexEntry($txt, $xref = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($xref) {&nbsp;</div></li><li><div>          $this-&gt;IndexEntrySee($txt, $xref);&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//Search the reference (AND Ref/PageNo) in the array</span></span>&nbsp;</div></li><li><div>      $Present = false;&nbsp;</div></li><li><div>      if ($this-&gt;keep_block_together) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// do nothing</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif ($this-&gt;kwt) {&nbsp;</div></li><li><div>          $size = count($this-&gt;kwt_Reference);&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $size; $i++) {&nbsp;</div></li><li><div>              if (isset($this-&gt;kwt_Reference[$i]['t']) && $this-&gt;kwt_Reference[$i]['t'] == $txt) {&nbsp;</div></li><li><div>                  $Present = true;&nbsp;</div></li><li><div>                  if ($this-&gt;page != $this-&gt;kwt_Reference[$i]['op']) {&nbsp;</div></li><li><div>                      $this-&gt;kwt_Reference[$i]['op'] = $this-&gt;page;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$Present) { <span class="comment"><span class="comment">//If not found, add it</span></span>&nbsp;</div></li><li><div>              $this-&gt;kwt_Reference[] = array('t' =&gt; $txt, 'op' =&gt; $this-&gt;page);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> else {&nbsp;</div></li><li><div>          $size = count($this-&gt;Reference);&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $size; $i++) {&nbsp;</div></li><li><div>              if (isset($this-&gt;Reference[$i]['t']) && $this-&gt;Reference[$i]['t'] == $txt) {&nbsp;</div></li><li><div>                  $Present = true;&nbsp;</div></li><li><div>                  if (!in_array($this-&gt;page, $this-&gt;Reference[$i]['p'])) {&nbsp;</div></li><li><div>                      $this-&gt;Reference[$i]['p'][] = $this-&gt;page;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$Present) { <span class="comment"><span class="comment">//If not found, add it</span></span>&nbsp;</div></li><li><div>              $this-&gt;Reference[] = array('t' =&gt; $txt, 'p' =&gt; array($this-&gt;page));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Added function to add a reference &quot;Elephants. See Chickens&quot;</span>&nbsp;</div></li><li><div>  function IndexEntrySee($txta, $txtb)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;directionality == 'rtl') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment">// ONLY DO THIS IF NOT IN TAGS</span>&nbsp;</div></li><li><div>          if ($txta == strip_tags($txta))&nbsp;</div></li><li><div>              $txta = str_replace(':', ' - ', $txta); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($txtb == strip_tags($txtb))&nbsp;</div></li><li><div>              $txtb = str_replace(':', ' - ', $txtb); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($txta == strip_tags($txta))&nbsp;</div></li><li><div>              $txta = str_replace(':', ', ', $txta);&nbsp;</div></li><li><div>          if ($txtb == strip_tags($txtb))&nbsp;</div></li><li><div>              $txtb = str_replace(':', ', ', $txtb);&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;Reference[] = array('t' =&gt; $txta . ' - see ' . $txtb, 'p' =&gt; array());&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function InsertIndex($usedivletters = 1, $useLinking = false, $indexCollationLocale = '', $indexCollationGroup = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $size = count($this-&gt;Reference);&nbsp;</div></li><li><div>      if ($size == 0) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// $spacer used after named entry</span>&nbsp;</div></li><li><div>      <span class="comment">// $sep  separates number [groups], $joiner joins numbers in range</span>&nbsp;</div></li><li><div>      <span class="comment">//  e.g. &quot;elephant 73, 97-99&quot; =  elephant[$spacer]73[$sep]97[$joiner]99</span>&nbsp;</div></li><li><div>      <span class="comment">// $subEntrySeparator separates main and subentry (if $this-&gt;indexUseSubentries == false;) e.g.</span>&nbsp;</div></li><li><div>      <span class="comment">// Mammal:elephant =&gt; Mammal[$subEntrySeparator]elephant</span>&nbsp;</div></li><li><div>      <span class="comment">// $subEntryInset specifies what precedes a subentry (if $this-&gt;indexUseSubentries == true;) e.g.</span>&nbsp;</div></li><li><div>      <span class="comment">// Mammal:elephant =&gt; [$subEntryInset]elephant</span>&nbsp;</div></li><li><div>      $spacer = &quot;\xc2\xa0 &quot;;&nbsp;</div></li><li><div>      if ($this-&gt;directionality == 'rtl') {&nbsp;</div></li><li><div>          $sep = '&#x060c; ';&nbsp;</div></li><li><div>          $joiner = '-';&nbsp;</div></li><li><div>          $subEntrySeparator = '&#x060c; ';&nbsp;</div></li><li><div>          $subEntryInset = ' - ';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $sep = ', ';&nbsp;</div></li><li><div>          $joiner = '-';&nbsp;</div></li><li><div>          $subEntrySeparator = ', ';&nbsp;</div></li><li><div>          $subEntryInset = ' - ';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $size; $i++) {&nbsp;</div></li><li><div>          $txt = $this-&gt;Reference[$i]['t'];&nbsp;</div></li><li><div>          $txt = strip_tags($txt); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $txt = $this-&gt;purify_utf8($txt);&nbsp;</div></li><li><div>          $this-&gt;Reference[$i]['uf'] = $txt; <span class="comment">// Unformatted e.g. pure utf-8 encoded characters, no mark-up/tags</span>&nbsp;</div></li><li><div>          <span class="comment">// Used for ordering and collation</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($usedivletters) {&nbsp;</div></li><li><div>          if ($indexCollationGroup) {&nbsp;</div></li><li><div>              require_once(_MPDF_PATH . 'collations/' . $indexCollationGroup . '.php');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $collation = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; $size; $i++) {&nbsp;</div></li><li><div>              if ($this-&gt;Reference[$i]['uf']) {&nbsp;</div></li><li><div>                  $l = mb_substr($this-&gt;Reference[$i]['uf'], 0, 1, 'UTF-8');&nbsp;</div></li><li><div>                  if (isset($this-&gt;indexCollationGroup) && $this-&gt;indexCollationGroup) {&nbsp;</div></li><li><div>                      $uni = $this-&gt;UTF8StringToArray($l);&nbsp;</div></li><li><div>                      $ucode = $uni[0];&nbsp;</div></li><li><div>                      if (isset($collation[$ucode])) {&nbsp;</div></li><li><div>                          $this-&gt;Reference[$i]['d'] = code2utf($collation[$ucode]);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;Reference[$i]['d'] = mb_strtolower($l, 'UTF-8');&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;Reference[$i]['d'] = mb_strtolower($l, 'UTF-8');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!function_exists('cmp')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          function cmp($a, $b)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              return strcoll(strtolower($a['uf']), strtolower($b['uf']));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Alphabetic sort of the references</span>&nbsp;</div></li><li><div>      $originalLocale = setlocale(LC_COLLATE, 0);&nbsp;</div></li><li><div>      if ($indexCollationLocale) {&nbsp;</div></li><li><div>          setlocale(LC_COLLATE, $indexCollationLocale);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      usort($this-&gt;Reference, 'cmp');&nbsp;</div></li><li><div>      if ($indexCollationLocale) {&nbsp;</div></li><li><div>          setlocale(LC_COLLATE, $originalLocale);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = '&lt;div class=&quot;mpdf_index_main&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $lett = '';&nbsp;</div></li><li><div>      $last_lett = '';&nbsp;</div></li><li><div>      $mainentry = '';&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; $size; $i++) {&nbsp;</div></li><li><div>          if ($this-&gt;Reference[$i]['t']) {&nbsp;</div></li><li><div>              if ($usedivletters) {&nbsp;</div></li><li><div>                  $lett = $this-&gt;Reference[$i]['d'];&nbsp;</div></li><li><div>                  if ($lett != $last_lett) {&nbsp;</div></li><li><div>                      $html .= '&lt;div class=&quot;mpdf_index_letter&quot;&gt;' . $lett . '&lt;/div&gt;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $txt = $this-&gt;Reference[$i]['t'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Sub-entries e.g. Mammals:elephant</span>&nbsp;</div></li><li><div>              <span class="comment">// But allow for tags e.g. &lt;b&gt;Mammal&lt;/b&gt;:elephants</span>&nbsp;</div></li><li><div>              $a = preg_split('/(&lt;.*?&gt;)/', $txt, -1, PREG_SPLIT_DELIM_CAPTURE);&nbsp;</div></li><li><div>              $txt = '';&nbsp;</div></li><li><div>              $marker = false;&nbsp;</div></li><li><div>              foreach ($a as $k =&gt; $e) {&nbsp;</div></li><li><div>                  if ($k % 2 == 0 && !$marker) {&nbsp;</div></li><li><div>                      if (strpos($e, ':') !== false) { <span class="comment">// == SubEntry</span>&nbsp;</div></li><li><div>                          if ($this-&gt;indexUseSubentries) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// If the Main entry does not have any page numbers associated with it</span>&nbsp;</div></li><li><div>                              <span class="comment">// create and insert an entry</span>&nbsp;</div></li><li><div>                              list($txtmain, $sub) = preg_split('/[:]/', $e, 2);&nbsp;</div></li><li><div>                              if (strip_tags($txt . $txtmain) != $mainentry) {&nbsp;</div></li><li><div>                                  $html .= '&lt;div class=&quot;mpdf_index_entry&quot;&gt;' . $txt . $txtmain . '&lt;/div&gt;';&nbsp;</div></li><li><div>                                  $mainentry = strip_tags($txt . $txtmain);&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              $txt = $subEntryInset;&nbsp;</div></li><li><div>                              $e = $sub; <span class="comment"><span class="comment">// Only replace first one</span></span>&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $e = preg_replace('/[:]/', $subEntrySeparator, $e, 1); <span class="comment"><span class="comment">// Only replace first one</span></span>&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $marker = true; <span class="comment">// Don't replace any more once the subentry marker has been found</span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $txt .= $e;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if (!$marker) {&nbsp;</div></li><li><div>                  $mainentry = strip_tags($txt);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $html .= '&lt;div class=&quot;mpdf_index_entry&quot;&gt;';&nbsp;</div></li><li><div>              $html .= $txt;&nbsp;</div></li><li><div>              $ppp = $this-&gt;Reference[$i]['p']; <span class="comment">// = array of page numbers to point to</span>&nbsp;</div></li><li><div>              if (count($ppp)) {&nbsp;</div></li><li><div>                  sort($ppp);&nbsp;</div></li><li><div>                  $newarr = array();&nbsp;</div></li><li><div>                  $range_start = $ppp[0];&nbsp;</div></li><li><div>                  $range_end = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $html .= $spacer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  for ($zi = 1; $zi &lt; count($ppp); $zi++) {&nbsp;</div></li><li><div>                      if ($ppp[$zi] == ($ppp[($zi - 1)] + 1)) {&nbsp;</div></li><li><div>                          $range_end = $ppp[$zi];&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          if ($range_end) {&nbsp;</div></li><li><div>                              if ($range_end == $range_start + 1) {&nbsp;</div></li><li><div>                                  if ($useLinking) {&nbsp;</div></li><li><div>                                      $html .= '&lt;a class=&quot;mpdf_index_link&quot; href=&quot;@' . $range_start . '&quot;&gt;';&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $html .= $this-&gt;docPageNum($range_start);&nbsp;</div></li><li><div>                                  if ($useLinking) {&nbsp;</div></li><li><div>                                      $html .= '&lt;/a&gt;';&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $html .= $sep;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  if ($useLinking) {&nbsp;</div></li><li><div>                                      $html .= '&lt;a class=&quot;mpdf_index_link&quot; href=&quot;@' . $ppp[$zi - 1] . '&quot;&gt;';&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $html .= $this-&gt;docPageNum($ppp[$zi - 1]);&nbsp;</div></li><li><div>                                  if ($useLinking) {&nbsp;</div></li><li><div>                                      $html .= '&lt;/a&gt;';&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  $html .= $sep;&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              if ($useLinking) {&nbsp;</div></li><li><div>                                  $html .= '&lt;a class=&quot;mpdf_index_link&quot; href=&quot;@' . $ppp[$zi - 1] . '&quot;&gt;';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $html .= $this-&gt;docPageNum($ppp[$zi - 1]);&nbsp;</div></li><li><div>                              if ($useLinking) {&nbsp;</div></li><li><div>                                  $html .= '&lt;/a&gt;';&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                              $html .= $sep;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $range_start = $ppp[$zi];&nbsp;</div></li><li><div>                          $range_end = 0;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($range_end) {&nbsp;</div></li><li><div>                      if ($useLinking) {&nbsp;</div></li><li><div>                          $html .= '&lt;a class=&quot;mpdf_index_link&quot; href=&quot;@' . $range_start . '&quot;&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $html .= $this-&gt;docPageNum($range_start);&nbsp;</div></li><li><div>                      if ($range_end == $range_start + 1) {&nbsp;</div></li><li><div>                          if ($useLinking) {&nbsp;</div></li><li><div>                              $html .= '&lt;/a&gt;';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $html .= $sep;&nbsp;</div></li><li><div>                          if ($useLinking) {&nbsp;</div></li><li><div>                              $html .= '&lt;a class=&quot;mpdf_index_link&quot; href=&quot;@' . $range_end . '&quot;&gt;';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $html .= $this-&gt;docPageNum($range_end);&nbsp;</div></li><li><div>                          if ($useLinking) {&nbsp;</div></li><li><div>                              $html .= '&lt;/a&gt;';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $html .= $joiner;&nbsp;</div></li><li><div>                          $html .= $this-&gt;docPageNum($range_end);&nbsp;</div></li><li><div>                          if ($useLinking) {&nbsp;</div></li><li><div>                              $html .= '&lt;/a&gt;';&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ($useLinking) {&nbsp;</div></li><li><div>                          $html .= '&lt;a class=&quot;mpdf_index_link&quot; href=&quot;@' . $ppp[(count($ppp) - 1)] . '&quot;&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $html .= $this-&gt;docPageNum($ppp[(count($ppp) - 1)]);&nbsp;</div></li><li><div>                      if ($useLinking) {&nbsp;</div></li><li><div>                          $html .= '&lt;/a&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>          $last_lett = $lett;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html .= '&lt;/div&gt;';&nbsp;</div></li><li><div>      $save_fpb = $this-&gt;fixedPosBlockSave;&nbsp;</div></li><li><div>      $this-&gt;WriteHTML($html);&nbsp;</div></li><li><div>      $this-&gt;fixedPosBlockSave = $save_fpb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;breakpoints[$this-&gt;CurrCol][] = $this-&gt;y;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">/** -- END INDEX -- */</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AcceptPageBreak()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (count($this-&gt;cellBorderBuffer)) {&nbsp;</div></li><li><div>          $this-&gt;printcellbuffer();&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;ColActive == 1) {&nbsp;</div></li><li><div>          if ($this-&gt;CurrCol &lt; $this-&gt;NbCol - 1) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Go to the next column</span></span>&nbsp;</div></li><li><div>              $this-&gt;CurrCol++;&nbsp;</div></li><li><div>              $this-&gt;SetCol($this-&gt;CurrCol);&nbsp;</div></li><li><div>              $this-&gt;y = $this-&gt;y0;&nbsp;</div></li><li><div>              $this-&gt;ChangeColumn = 1; <span class="comment">// Number (and direction) of columns changed +1, +2, -2 etc.</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span> RTL&nbsp;</div></li><li><div>              if ($this-&gt;directionality == 'rtl') {&nbsp;</div></li><li><div>                  $this-&gt;ChangeColumn = -($this-&gt;ChangeColumn);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Stay on the page</span></span>&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Go back to the first column</span> - NEW PAGE</span>&nbsp;</div></li><li><div>              if (count($this-&gt;columnbuffer)) {&nbsp;</div></li><li><div>                  $this-&gt;printcolumnbuffer();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;SetCol(0);&nbsp;</div></li><li><div>              $this-&gt;y0 = $this-&gt;tMargin;&nbsp;</div></li><li><div>              $this-&gt;ChangeColumn = -($this-&gt;NbCol - 1);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span> RTL&nbsp;</div></li><li><div>              if ($this-&gt;directionality == 'rtl') {&nbsp;</div></li><li><div>                  $this-&gt;ChangeColumn = -($this-&gt;ChangeColumn);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment">//Page</span> break&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> elseif ($this-&gt;table_rotate) {&nbsp;</div></li><li><div>          if ($this-&gt;tablebuffer) {&nbsp;</div></li><li><div>              $this-&gt;printtablebuffer();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;ChangeColumn = 0;&nbsp;</div></li><li><div>          return $this-&gt;autoPageBreak;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *COLUMNS*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      return $this-&gt;autoPageBreak;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//----------- COLUMNS ---------------------</span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetColumns($NbCol, $vAlign = '', $gap = 5)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// NbCol = number of columns</span>&nbsp;</div></li><li><div>      <span class="comment">// Anything less than 2 turns columns off</span>&nbsp;</div></li><li><div>      if ($NbCol &lt; 2) { <span class="comment">// SET COLUMNS OFF</span>&nbsp;</div></li><li><div>          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>              $this-&gt;ColActive = 0;&nbsp;</div></li><li><div>              if (count($this-&gt;columnbuffer)) {&nbsp;</div></li><li><div>                  $this-&gt;printcolumnbuffer();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;NbCol = 1;&nbsp;</div></li><li><div>              $this-&gt;ResetMargins();&nbsp;</div></li><li><div>              $this-&gt;pgwidth = $this-&gt;w - $this-&gt;lMargin - $this-&gt;rMargin;&nbsp;</div></li><li><div>              $this-&gt;divwidth = 0;&nbsp;</div></li><li><div>              $this-&gt;Ln();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;ColActive = 0;&nbsp;</div></li><li><div>          $this-&gt;columnbuffer = array();&nbsp;</div></li><li><div>          $this-&gt;ColDetails = array();&nbsp;</div></li><li><div>          $this-&gt;columnLinks = array();&nbsp;</div></li><li><div>          $this-&gt;columnAnnots = array();&nbsp;</div></li><li><div>          $this-&gt;columnForms = array();&nbsp;</div></li><li><div>          $this-&gt;col_BMoutlines = array();&nbsp;</div></li><li><div>          $this-&gt;col_toc = array();&nbsp;</div></li><li><div>          $this-&gt;breakpoints = array();&nbsp;</div></li><li><div>      } else { <span class="comment">// SET COLUMNS ON</span>&nbsp;</div></li><li><div>          if ($this-&gt;ColActive) {&nbsp;</div></li><li><div>              $this-&gt;ColActive = 0;&nbsp;</div></li><li><div>              if (count($this-&gt;columnbuffer)) {&nbsp;</div></li><li><div>                  $this-&gt;printcolumnbuffer();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;ResetMargins();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;y) && $this-&gt;y &gt; $this-&gt;tMargin)&nbsp;</div></li><li><div>              $this-&gt;Ln();&nbsp;</div></li><li><div>          $this-&gt;NbCol = $NbCol;&nbsp;</div></li><li><div>          $this-&gt;ColGap = $gap;&nbsp;</div></li><li><div>          $this-&gt;divwidth = 0;&nbsp;</div></li><li><div>          $this-&gt;ColActive = 1;&nbsp;</div></li><li><div>          $this-&gt;ColumnAdjust = true; <span class="comment"><span class="comment">// enables column height adjustment for the page</span></span>&nbsp;</div></li><li><div>          $this-&gt;columnbuffer = array();&nbsp;</div></li><li><div>          $this-&gt;ColDetails = array();&nbsp;</div></li><li><div>          $this-&gt;columnLinks = array();&nbsp;</div></li><li><div>          $this-&gt;columnAnnots = array();&nbsp;</div></li><li><div>          $this-&gt;columnForms = array();&nbsp;</div></li><li><div>          $this-&gt;col_BMoutlines = array();&nbsp;</div></li><li><div>          $this-&gt;col_toc = array();&nbsp;</div></li><li><div>          $this-&gt;breakpoints = array();&nbsp;</div></li><li><div>          if ((strtoupper($vAlign) == 'J') || (strtoupper($vAlign) == 'JUSTIFY')) {&nbsp;</div></li><li><div>              $vAlign = 'J';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $vAlign = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;colvAlign = $vAlign;&nbsp;</div></li><li><div>          <span class="comment">//Save the ordinate</span>&nbsp;</div></li><li><div>          $absL = $this-&gt;DeflMargin - ($gap / 2);&nbsp;</div></li><li><div>          $absR = $this-&gt;DefrMargin - ($gap / 2);&nbsp;</div></li><li><div>          $PageWidth = $this-&gt;w - $absL - $absR; <span class="comment">// virtual pagewidth for calculation only</span>&nbsp;</div></li><li><div>          $ColWidth = (($PageWidth - ($gap * ($NbCol))) / $NbCol);&nbsp;</div></li><li><div>          $this-&gt;ColWidth = $ColWidth;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($this-&gt;directionality == 'rtl') {&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; $this-&gt;NbCol; $i++) {&nbsp;</div></li><li><div>                  $this-&gt;ColL[$i] = $absL + ($gap / 2) + (($NbCol - ($i + 1)) * ($PageWidth / $NbCol));&nbsp;</div></li><li><div>                  $this-&gt;ColR[$i] = $this-&gt;ColL[$i] + $ColWidth; <span class="comment"><span class="comment"><span class="comment">// NB This is not R margin -&gt; R pos</span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; $this-&gt;NbCol; $i++) {&nbsp;</div></li><li><div>                  $this-&gt;ColL[$i] = $absL + ($gap / 2) + ($i * ($PageWidth / $NbCol) );&nbsp;</div></li><li><div>                  $this-&gt;ColR[$i] = $this-&gt;ColL[$i] + $ColWidth; <span class="comment"><span class="comment"><span class="comment">// NB This is not R margin -&gt; R pos</span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;pgwidth = $ColWidth;&nbsp;</div></li><li><div>          $this-&gt;SetCol(0);&nbsp;</div></li><li><div>          $this-&gt;y0 = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetCol($CurrCol)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Used internally to set column by number: 0 is 1st column</span>&nbsp;</div></li><li><div>      <span class="comment">//Set position on a column</span>&nbsp;</div></li><li><div>      $this-&gt;CurrCol = $CurrCol;&nbsp;</div></li><li><div>      $x = $this-&gt;ColL[$CurrCol];&nbsp;</div></li><li><div>      $xR = $this-&gt;ColR[$CurrCol]; <span class="comment"><span class="comment"><span class="comment">// NB This is not R margin -&gt; R pos</span></span></span>&nbsp;</div></li><li><div>      if (($this-&gt;mirrorMargins) && (($this-&gt;page) % 2 == 0)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// EVEN</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $x += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>          $xR += $this-&gt;MarginCorrection;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetMargins($x, ($this-&gt;w - $xR), $this-&gt;tMargin);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AddColumn()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;NewColumn();&nbsp;</div></li><li><div>      $this-&gt;ColumnAdjust = false; <span class="comment">// disables all column height adjustment for the page.</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function NewColumn()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;ColActive == 1) {&nbsp;</div></li><li><div>          if ($this-&gt;CurrCol &lt; $this-&gt;NbCol - 1) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Go to the next column</span></span>&nbsp;</div></li><li><div>              $this-&gt;CurrCol++;&nbsp;</div></li><li><div>              $this-&gt;SetCol($this-&gt;CurrCol);&nbsp;</div></li><li><div>              $this-&gt;y = $this-&gt;y0;&nbsp;</div></li><li><div>              $this-&gt;ChangeColumn = 1;&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span> RTL&nbsp;</div></li><li><div>              if ($this-&gt;directionality == 'rtl') {&nbsp;</div></li><li><div>                  $this-&gt;ChangeColumn = -($this-&gt;ChangeColumn);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Stay on the page</span></span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">//Go back to the first column</span>&nbsp;</div></li><li><div>              <span class="comment">//Page</span> break&nbsp;</div></li><li><div>              if (count($this-&gt;columnbuffer)) {&nbsp;</div></li><li><div>                  $this-&gt;printcolumnbuffer();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>              $this-&gt;SetCol(0);&nbsp;</div></li><li><div>              $this-&gt;y0 = $this-&gt;tMargin;&nbsp;</div></li><li><div>              $this-&gt;ChangeColumn = -($this-&gt;NbCol - 1);&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span> RTL&nbsp;</div></li><li><div>              if ($this-&gt;directionality == 'rtl') {&nbsp;</div></li><li><div>                  $this-&gt;ChangeColumn = -($this-&gt;ChangeColumn);&nbsp;</div></li><li><div>              } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;AddPage($this-&gt;CurOrientation);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function printcolumnbuffer()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Columns ended (but page not ended) -&gt; try to match all columns - unless disabled by using a custom column-break</span>&nbsp;</div></li><li><div>      if (!$this-&gt;ColActive && $this-&gt;ColumnAdjust && !$this-&gt;keepColumns) {&nbsp;</div></li><li><div>          <span class="comment">// Calculate adjustment to add to each column to calculate rel_y value</span>&nbsp;</div></li><li><div>          $this-&gt;ColDetails[0]['add_y'] = 0;&nbsp;</div></li><li><div>          $last_col = 0;&nbsp;</div></li><li><div>          <span class="comment">// Recursively add previous column's height</span>&nbsp;</div></li><li><div>          for ($i = 1; $i &lt; $this-&gt;NbCol; $i++) {&nbsp;</div></li><li><div>              if (isset($this-&gt;ColDetails[$i]['bottom_margin']) && $this-&gt;ColDetails[$i]['bottom_margin']) { <span class="comment">// If any entries in the column</span>&nbsp;</div></li><li><div>                  $this-&gt;ColDetails[$i]['add_y'] = ($this-&gt;ColDetails[$i - 1]['bottom_margin'] - $this-&gt;y0) + $this-&gt;ColDetails[$i - 1]['add_y'];&nbsp;</div></li><li><div>                  $last_col = $i;  <span class="comment">// Last column actually printed</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Calculate value for each position sensitive entry as though for one column</span>&nbsp;</div></li><li><div>          foreach ($this-&gt;columnbuffer AS $key =&gt; $s) {&nbsp;</div></li><li><div>              $t = $s['s'];&nbsp;</div></li><li><div>              if ($t == 'ACROFORM') {&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['rel_y'] = $s['y'] + $this-&gt;ColDetails[$s['col']]['add_y'] - $this-&gt;y0;&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['s'] = '';&nbsp;</div></li><li><div>              } elseif (preg_match('/BT \d+\.\d\d+ (\d+\.\d\d+) Td/', $t)) {&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['rel_y'] = $s['y'] + $this-&gt;ColDetails[$s['col']]['add_y'] - $this-&gt;y0;&nbsp;</div></li><li><div>              } elseif (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) \d+\.\d\d+ [\-]{0, 1}\d+\.\d\d+ re/', $t)) {&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['rel_y'] = $s['y'] + $this-&gt;ColDetails[$s['col']]['add_y'] - $this-&gt;y0;&nbsp;</div></li><li><div>              } elseif (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) m/', $t)) {&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['rel_y'] = $s['y'] + $this-&gt;ColDetails[$s['col']]['add_y'] - $this-&gt;y0;&nbsp;</div></li><li><div>              } elseif (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) l/', $t)) {&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['rel_y'] = $s['y'] + $this-&gt;ColDetails[$s['col']]['add_y'] - $this-&gt;y0;&nbsp;</div></li><li><div>              } elseif (preg_match('/q \d+\.\d\d+ 0 0 \d+\.\d\d+ \d+\.\d\d+ (\d+\.\d\d+) cm \/(I|FO)\d+ Do Q/', $t)) {&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['rel_y'] = $s['y'] + $this-&gt;ColDetails[$s['col']]['add_y'] - $this-&gt;y0;&nbsp;</div></li><li><div>              } elseif (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) \d+\.\d\d+ \d+\.\d\d+ \d+\.\d\d+ \d+\.\d\d+ c/', $t)) {&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['rel_y'] = $s['y'] + $this-&gt;ColDetails[$s['col']]['add_y'] - $this-&gt;y0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          foreach ($this-&gt;internallink AS $key =&gt; $f) {&nbsp;</div></li><li><div>              if (is_array($f) && isset($f['col'])) {&nbsp;</div></li><li><div>                  $this-&gt;internallink[$key]['rel_y'] = $f['Y'] + $this-&gt;ColDetails[$f['col']]['add_y'] - $this-&gt;y0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $breaks = array();&nbsp;</div></li><li><div>          foreach ($this-&gt;breakpoints AS $c =&gt; $bpa) {&nbsp;</div></li><li><div>              foreach ($bpa AS $rely) {&nbsp;</div></li><li><div>                  $breaks[] = $rely + $this-&gt;ColDetails[$c]['add_y'] - $this-&gt;y0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($this-&gt;ColDetails[$last_col]['bottom_margin'])) {&nbsp;</div></li><li><div>              $lcbm = $this-&gt;ColDetails[$last_col]['bottom_margin'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $lcbm = 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $sum_h = $this-&gt;ColDetails[$last_col]['add_y'] + $lcbm - $this-&gt;y0;&nbsp;</div></li><li><div>          <span class="comment">//$sum_h = max($this-&gt;ColDetails[$last_col]['add_y'] + $this-&gt;ColDetails[$last_col]['bottom_margin'] - $this-&gt;y0, end($breaks));</span>&nbsp;</div></li><li><div>          $target_h = ($sum_h / $this-&gt;NbCol);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $cbr = array();&nbsp;</div></li><li><div>          for ($i = 1; $i &lt; $this-&gt;NbCol; $i++) {&nbsp;</div></li><li><div>              $th = ($sum_h * $i / $this-&gt;NbCol);&nbsp;</div></li><li><div>              foreach ($breaks AS $bk =&gt; $val) {&nbsp;</div></li><li><div>                  if ($val &gt; $th) {&nbsp;</div></li><li><div>                      if (($val - $th) &lt; ($th - $breaks[$bk - 1])) {&nbsp;</div></li><li><div>                          $cbr[$i - 1] = $val;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $cbr[$i - 1] = $breaks[$bk - 1];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $cbr[($this-&gt;NbCol - 1)] = $sum_h;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment">// Avoid outputing with 1st column empty</span>&nbsp;</div></li><li><div>          if (isset($cbr[0]) && $cbr[0] == 0) {&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; $this-&gt;NbCol - 1; $i++) {&nbsp;</div></li><li><div>                  $cbr[$i] = $cbr[$i + 1];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Now update the columns - divide into columns of approximately equal value</span>&nbsp;</div></li><li><div>          $last_new_col = 0;&nbsp;</div></li><li><div>          $yadj = 0; <span class="comment">// mm</span>&nbsp;</div></li><li><div>          $xadj = 0;&nbsp;</div></li><li><div>          $last_col_bottom = 0;&nbsp;</div></li><li><div>          $lowest_bottom_y = 0;&nbsp;</div></li><li><div>          $block_bottom = 0;&nbsp;</div></li><li><div>          $newcolumn = 0;&nbsp;</div></li><li><div>          foreach ($this-&gt;columnbuffer AS $key =&gt; $s) {&nbsp;</div></li><li><div>              if (isset($s['rel_y'])) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// only process position sensitive data</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if ($s['rel_y'] &gt;= $cbr[$newcolumn]) {&nbsp;</div></li><li><div>                      $newcolumn++;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $newcolumn = $last_new_col;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $block_bottom = max($block_bottom, ($s['rel_y'] + $s['h']));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($this-&gt;directionality == 'rtl') { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $xadj = -(($newcolumn - $s['col']) * ($this-&gt;ColWidth + $this-&gt;ColGap)); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  else { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $xadj = ($newcolumn - $s['col']) * ($this-&gt;ColWidth + $this-&gt;ColGap);&nbsp;</div></li><li><div>                  } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($last_new_col != $newcolumn) { <span class="comment">// Added new column</span>&nbsp;</div></li><li><div>                      $last_col_bottom = $this-&gt;columnbuffer[$key]['rel_y'];&nbsp;</div></li><li><div>                      $block_bottom = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $yadj = ($s['rel_y'] - $s['y']) - ($last_col_bottom) + $this-&gt;y0;&nbsp;</div></li><li><div>                  <span class="comment">// callback function</span>&nbsp;</div></li><li><div>                  $t = $s['s'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>+&nbsp;</div></li><li><div>                  $t = $this-&gt;columnAdjustPregReplace('Td', $xadj, $yadj, '/BT (\d+\.\d\d+) (\d+\.\d\d+) Td/', $t);&nbsp;</div></li><li><div>                  $t = $this-&gt;columnAdjustPregReplace('re', $xadj, $yadj, '/(\d+\.\d\d+) (\d+\.\d\d+) (\d+\.\d\d+) ([\-]{0, 1}\d+\.\d\d+) re/', $t);&nbsp;</div></li><li><div>                  $t = $this-&gt;columnAdjustPregReplace('l', $xadj, $yadj, '/(\d+\.\d\d+) (\d+\.\d\d+) l/', $t);&nbsp;</div></li><li><div>                  $t = $this-&gt;columnAdjustPregReplace('img', $xadj, $yadj, '/q (\d+\.\d\d+) 0 0 (\d+\.\d\d+) (\d+\.\d\d+) (\d+\.\d\d+) cm \/(I|FO)/', $t);&nbsp;</div></li><li><div>                  $t = $this-&gt;columnAdjustPregReplace('draw', $xadj, $yadj, '/(\d+\.\d\d+) (\d+\.\d\d+) m/', $t);&nbsp;</div></li><li><div>                  $t = $this-&gt;columnAdjustPregReplace('bezier', $xadj, $yadj, '/(\d+\.\d\d+) (\d+\.\d\d+) (\d+\.\d\d+) (\d+\.\d\d+) (\d+\.\d\d+) (\d+\.\d\d+) c/', $t);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['s'] = $t;&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['newcol'] = $newcolumn;&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['newy'] = $s['y'] + $yadj;&nbsp;</div></li><li><div>                  $last_new_col = $newcolumn;&nbsp;</div></li><li><div>                  $clb = $s['y'] + $yadj + $s['h']; <span class="comment"><span class="comment"><span class="comment">// bottom</span></span></span>_margin of current&nbsp;</div></li><li><div>                  if ((isset($this-&gt;ColDetails[$newcolumn]['max_bottom']) && $clb &gt; $this-&gt;ColDetails[$newcolumn]['max_bottom']) || (!isset($this-&gt;ColDetails[$newcolumn]['max_bottom']) && $clb)) {&nbsp;</div></li><li><div>                      $this-&gt;ColDetails[$newcolumn]['max_bottom'] = $clb;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($clb &gt; $lowest_bottom_y) {&nbsp;</div></li><li><div>                      $lowest_bottom_y = $clb;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// Adjust LINKS</span></span></span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;columnLinks[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])])) {&nbsp;</div></li><li><div>                      $ref = $this-&gt;columnLinks[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])];&nbsp;</div></li><li><div>                      $this-&gt;PageLinks[$this-&gt;page][$ref][0] += ($xadj * _MPDFK);&nbsp;</div></li><li><div>                      $this-&gt;PageLinks[$this-&gt;page][$ref][1] -= ($yadj * _MPDFK);&nbsp;</div></li><li><div>                      unset($this-&gt;columnLinks[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])]);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// Adjust FORM FIELDS</span></span></span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;columnForms[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])])) {&nbsp;</div></li><li><div>                      $ref = $this-&gt;columnForms[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])];&nbsp;</div></li><li><div>                      $this-&gt;mpdfform-&gt;forms[$ref]['x'] += ($xadj);&nbsp;</div></li><li><div>                      $this-&gt;mpdfform-&gt;forms[$ref]['y'] += ($yadj);&nbsp;</div></li><li><div>                      unset($this-&gt;columnForms[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])]);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  if (isset($this-&gt;columnAnnots[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])])) {&nbsp;</div></li><li><div>                      $ref = $this-&gt;columnAnnots[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])];&nbsp;</div></li><li><div>                      if ($this-&gt;PageAnnots[$this-&gt;page][$ref]['x'] &lt; 0) {&nbsp;</div></li><li><div>                          $this-&gt;PageAnnots[$this-&gt;page][$ref]['x'] -= ($xadj);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;PageAnnots[$this-&gt;page][$ref]['x'] += ($xadj);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;PageAnnots[$this-&gt;page][$ref]['y'] += ($yadj); <span class="comment">// unlike PageLinks, Page annots has y values from top in mm</span>&nbsp;</div></li><li><div>                      unset($this-&gt;columnAnnots[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])]);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Adjust Bookmarks</span></span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;col_BMoutlines AS $v) {&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'y' =&gt; $this-&gt;y0, 'p' =&gt; $v['p']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Adjust ToC</span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;col_toc AS $v) {&nbsp;</div></li><li><div>              $this-&gt;tocontents-&gt;_toc[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'p' =&gt; $v['p'], 'link' =&gt; $v['link'], 'toc_id' =&gt; $v['toc_id']);&nbsp;</div></li><li><div>              $this-&gt;links[$v['link']][1] = $this-&gt;y0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Adjust column length to be equal</span>&nbsp;</div></li><li><div>          if ($this-&gt;colvAlign == 'J') {&nbsp;</div></li><li><div>              foreach ($this-&gt;columnbuffer AS $key =&gt; $s) {&nbsp;</div></li><li><div>                  if (isset($s['rel_y'])) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// only process position sensitive data</span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set ratio to expand y values or heights</span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($this-&gt;ColDetails[$s['newcol']]['max_bottom']) && $this-&gt;ColDetails[$s['newcol']]['max_bottom'] && $this-&gt;ColDetails[$s['newcol']]['max_bottom'] != $this-&gt;y0) {&nbsp;</div></li><li><div>                          $ratio = ($lowest_bottom_y - ($this-&gt;y0)) / ($this-&gt;ColDetails[$s['newcol']]['max_bottom'] - ($this-&gt;y0));&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $ratio = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (($ratio &gt; 1) && ($ratio &lt;= $this-&gt;max_colH_correction)) {&nbsp;</div></li><li><div>                          $yadj = ($s['newy'] - $this-&gt;y0) * ($ratio - 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment">// Adjust LINKS</span></span></span>&nbsp;</div></li><li><div>                          if (isset($this-&gt;columnLinks[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])])) {&nbsp;</div></li><li><div>                              $ref = $this-&gt;columnLinks[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])];&nbsp;</div></li><li><div>                              $this-&gt;PageLinks[$this-&gt;page][$ref][1] -= ($yadj * _MPDFK); <span class="comment"><span class="comment">// y value</span></span>&nbsp;</div></li><li><div>                              $this-&gt;PageLinks[$this-&gt;page][$ref][3] *= $ratio; <span class="comment"><span class="comment"><span class="comment">// height</span></span></span>&nbsp;</div></li><li><div>                              unset($this-&gt;columnLinks[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])]);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment">// Adjust FORM FIELDS</span></span></span>&nbsp;</div></li><li><div>                          if (isset($this-&gt;columnForms[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])])) {&nbsp;</div></li><li><div>                              $ref = $this-&gt;columnForms[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])];&nbsp;</div></li><li><div>                              $this-&gt;mpdfform-&gt;forms[$ref]['x'] += ($xadj);&nbsp;</div></li><li><div>                              $this-&gt;mpdfform-&gt;forms[$ref]['y'] += ($yadj);&nbsp;</div></li><li><div>                              unset($this-&gt;columnForms[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])]);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          if (isset($this-&gt;columnAnnots[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])])) {&nbsp;</div></li><li><div>                              $ref = $this-&gt;columnAnnots[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])];&nbsp;</div></li><li><div>                              $this-&gt;PageAnnots[$this-&gt;page][$ref]['y'] += ($yadj);&nbsp;</div></li><li><div>                              unset($this-&gt;columnAnnots[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])]);&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              foreach ($this-&gt;internallink AS $key =&gt; $f) {&nbsp;</div></li><li><div>                  if (is_array($f) && isset($f['col'])) {&nbsp;</div></li><li><div>                      $last_col_bottom = 0;&nbsp;</div></li><li><div>                      for ($nbc = 0; $nbc &lt; $this-&gt;NbCol; $nbc++) {&nbsp;</div></li><li><div>                          if ($f['rel_y'] &gt;= $cbr[$nbc]) {&nbsp;</div></li><li><div>                              $last_col_bottom = $cbr[$nbc];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $yadj = ($f['rel_y'] - $f['Y']) - $last_col_bottom + $this-&gt;y0;&nbsp;</div></li><li><div>                      $f['Y'] += $yadj;&nbsp;</div></li><li><div>                      unset($f['col']);&nbsp;</div></li><li><div>                      unset($f['rel_y']);&nbsp;</div></li><li><div>                      $this-&gt;internallink[$key] = $f;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $last_col = -1;&nbsp;</div></li><li><div>              $trans_on = false;&nbsp;</div></li><li><div>              foreach ($this-&gt;columnbuffer AS $key =&gt; $s) {&nbsp;</div></li><li><div>                  if (isset($s['rel_y'])) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// only process position sensitive data</span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set ratio to expand y values or heights</span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($this-&gt;ColDetails[$s['newcol']]['max_bottom']) && $this-&gt;ColDetails[$s['newcol']]['max_bottom'] && $this-&gt;ColDetails[$s['newcol']]['max_bottom'] != $this-&gt;y0) {&nbsp;</div></li><li><div>                          $ratio = ($lowest_bottom_y - ($this-&gt;y0)) / ($this-&gt;ColDetails[$s['newcol']]['max_bottom'] - ($this-&gt;y0));&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $ratio = 1;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if (($ratio &gt; 1) && ($ratio &lt;= $this-&gt;max_colH_correction)) {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Start Transformation</span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;pages[$this-&gt;page] .= $this-&gt;StartTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>                          $this-&gt;pages[$this-&gt;page] .= $this-&gt;transformScale(100, $ratio * 100, $x = '', $this-&gt;y0, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>                          $trans_on = true;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Now output the adjusted values</span></span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;pages[$this-&gt;page] .= $s['s'] . &quot;\n&quot;;&nbsp;</div></li><li><div>                  if (isset($s['rel_y']) && ($ratio &gt; 1) && ($ratio &lt;= $this-&gt;max_colH_correction)) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// only process position sensitive data</span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Stop Transformation</span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;pages[$this-&gt;page] .= $this-&gt;StopTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>                      $trans_on = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($trans_on) {&nbsp;</div></li><li><div>                  $this-&gt;pages[$this-&gt;page] .= $this-&gt;StopTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else { <span class="comment">// if NOT $this-&gt;colvAlign == 'J'</span>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Now output the adjusted values</span></span></span></span></span>&nbsp;</div></li><li><div>              foreach ($this-&gt;columnbuffer AS $s) {&nbsp;</div></li><li><div>                  $this-&gt;pages[$this-&gt;page] .= $s['s'] . &quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($lowest_bottom_y &gt; 0) {&nbsp;</div></li><li><div>              $this-&gt;y = $lowest_bottom_y;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Columns not ended but new page -&gt; align columns (can leave the columns alone - just tidy up the height)</span>&nbsp;</div></li><li><div>      elseif ($this-&gt;colvAlign == 'J' && $this-&gt;ColumnAdjust && !$this-&gt;keepColumns) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// calculate the lowest bottom margin</span></span>&nbsp;</div></li><li><div>          $lowest_bottom_y = 0;&nbsp;</div></li><li><div>          foreach ($this-&gt;columnbuffer AS $key =&gt; $s) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Only process output data</span></span>&nbsp;</div></li><li><div>              $t = $s['s'];&nbsp;</div></li><li><div>              if ($t == 'ACROFORM' || (preg_match('/BT \d+\.\d\d+ (\d+\.\d\d+) Td/', $t)) || (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) \d+\.\d\d+ [\-]{0, 1}\d+\.\d\d+ re/', $t)) ||&nbsp;</div></li><li><div>                  (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) l/', $t)) ||&nbsp;</div></li><li><div>                  (preg_match('/q \d+\.\d\d+ 0 0 \d+\.\d\d+ \d+\.\d\d+ (\d+\.\d\d+) cm \/(I|FO)\d+ Do Q/', $t)) ||&nbsp;</div></li><li><div>                  (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) m/', $t)) ||&nbsp;</div></li><li><div>                  (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) \d+\.\d\d+ \d+\.\d\d+ \d+\.\d\d+ \d+\.\d\d+ c/', $t))) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $clb = $s['y'] + $s['h'];&nbsp;</div></li><li><div>                  if ((isset($this-&gt;ColDetails[$s['col']]['max_bottom']) && $clb &gt; $this-&gt;ColDetails[$s['col']]['max_bottom']) || !isset($this-&gt;ColDetails[$s['col']]['max_bottom'])) {&nbsp;</div></li><li><div>                      $this-&gt;ColDetails[$s['col']]['max_bottom'] = $clb;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($clb &gt; $lowest_bottom_y) {&nbsp;</div></li><li><div>                      $lowest_bottom_y = $clb;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;columnbuffer[$key]['rel_y'] = $s['y']; <span class="comment">// Marks position sensitive data to process later</span>&nbsp;</div></li><li><div>                  if ($t == 'ACROFORM') {&nbsp;</div></li><li><div>                      $this-&gt;columnbuffer[$key]['s'] = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Adjust column length equal</span>&nbsp;</div></li><li><div>          foreach ($this-&gt;columnbuffer AS $key =&gt; $s) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set ratio to expand y values or heights</span></span></span></span>&nbsp;</div></li><li><div>              if (isset($this-&gt;ColDetails[$s['col']]['max_bottom']) && $this-&gt;ColDetails[$s['col']]['max_bottom']) {&nbsp;</div></li><li><div>                  $ratio = ($lowest_bottom_y - ($this-&gt;y0)) / ($this-&gt;ColDetails[$s['col']]['max_bottom'] - ($this-&gt;y0));&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $ratio = 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (($ratio &gt; 1) && ($ratio &lt;= $this-&gt;max_colH_correction)) {&nbsp;</div></li><li><div>                  $yadj = ($s['y'] - $this-&gt;y0) * ($ratio - 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// Adjust LINKS</span></span></span>&nbsp;</div></li><li><div>                  if (isset($s['rel_y'])) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// only process position sensitive data</span></span></span></span></span></span>&nbsp;</div></li><li><div>                      <span class="comment">// otherwise triggers for all entries in column buffer (.e.g. formatting) and makes below adjustments more than once</span>&nbsp;</div></li><li><div>                      if (isset($this-&gt;columnLinks[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])])) {&nbsp;</div></li><li><div>                          $ref = $this-&gt;columnLinks[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])];&nbsp;</div></li><li><div>                          $this-&gt;PageLinks[$this-&gt;page][$ref][1] -= ($yadj * _MPDFK); <span class="comment"><span class="comment">// y value</span></span>&nbsp;</div></li><li><div>                          $this-&gt;PageLinks[$this-&gt;page][$ref][3] *= $ratio; <span class="comment"><span class="comment"><span class="comment">// height</span></span></span>&nbsp;</div></li><li><div>                          unset($this-&gt;columnLinks[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])]);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment">// Adjust FORM FIELDS</span></span></span>&nbsp;</div></li><li><div>                      if (isset($this-&gt;columnForms[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])])) {&nbsp;</div></li><li><div>                          $ref = $this-&gt;columnForms[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])];&nbsp;</div></li><li><div>                          $this-&gt;mpdfform-&gt;forms[$ref]['x'] += ($xadj);&nbsp;</div></li><li><div>                          $this-&gt;mpdfform-&gt;forms[$ref]['y'] += ($yadj);&nbsp;</div></li><li><div>                          unset($this-&gt;columnForms[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])]);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      if (isset($this-&gt;columnAnnots[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])])) {&nbsp;</div></li><li><div>                          $ref = $this-&gt;columnAnnots[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])];&nbsp;</div></li><li><div>                          $this-&gt;PageAnnots[$this-&gt;page][$ref]['y'] += ($yadj);&nbsp;</div></li><li><div>                          unset($this-&gt;columnAnnots[$s['col']][INTVAL($s['x'])][INTVAL($s['y'])]);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Adjust Bookmarks</span></span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;col_BMoutlines AS $v) {&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'y' =&gt; $this-&gt;y0, 'p' =&gt; $v['p']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Adjust ToC</span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;col_toc AS $v) {&nbsp;</div></li><li><div>              $this-&gt;tocontents-&gt;_toc[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'p' =&gt; $v['p'], 'link' =&gt; $v['link'], 'toc_id' =&gt; $v['toc_id']);&nbsp;</div></li><li><div>              $this-&gt;links[$v['link']][1] = $this-&gt;y0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $trans_on = false;&nbsp;</div></li><li><div>          foreach ($this-&gt;columnbuffer AS $key =&gt; $s) {&nbsp;</div></li><li><div>              if (isset($s['rel_y'])) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// only process position sensitive data</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Set ratio to expand y values or heights</span></span></span></span>&nbsp;</div></li><li><div>                  if ($this-&gt;ColDetails[$s['col']]['max_bottom']) {&nbsp;</div></li><li><div>                      $ratio = ($lowest_bottom_y - ($this-&gt;y0)) / ($this-&gt;ColDetails[$s['col']]['max_bottom'] - ($this-&gt;y0));&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $ratio = 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if (($ratio &gt; 1) && ($ratio &lt;= $this-&gt;max_colH_correction)) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Start Transformation</span></span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;pages[$this-&gt;page] .= $this-&gt;StartTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>                      $this-&gt;pages[$this-&gt;page] .= $this-&gt;transformScale(100, $ratio * 100, $x = '', $this-&gt;y0, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>                      $trans_on = true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Now output the adjusted values</span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;pages[$this-&gt;page] .= $s['s'] . &quot;\n&quot;;&nbsp;</div></li><li><div>              if (isset($s['rel_y']) && ($ratio &gt; 1) && ($ratio &lt;= $this-&gt;max_colH_correction)) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Stop Transformation</span></span></span></span>&nbsp;</div></li><li><div>                  $this-&gt;pages[$this-&gt;page] .= $this-&gt;StopTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>                  $trans_on = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($trans_on) {&nbsp;</div></li><li><div>              $this-&gt;pages[$this-&gt;page] .= $this-&gt;StopTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($lowest_bottom_y &gt; 0) {&nbsp;</div></li><li><div>              $this-&gt;y = $lowest_bottom_y;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Just reproduce the page as it was</span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          <span class="comment">// If page has not ended but height adjustment was disabled by custom column-break - adjust y</span>&nbsp;</div></li><li><div>          $lowest_bottom_y = 0;&nbsp;</div></li><li><div>          if (!$this-&gt;ColActive && (!$this-&gt;ColumnAdjust || $this-&gt;keepColumns)) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// calculate the lowest bottom margin</span></span>&nbsp;</div></li><li><div>              foreach ($this-&gt;columnbuffer AS $key =&gt; $s) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Only process output data</span></span>&nbsp;</div></li><li><div>                  $t = $s['s'];&nbsp;</div></li><li><div>                  if ($t == 'ACROFORM' || (preg_match('/BT \d+\.\d\d+ (\d+\.\d\d+) Td/', $t)) || (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) \d+\.\d\d+ [\-]{0, 1}\d+\.\d\d+ re/', $t)) ||&nbsp;</div></li><li><div>                      (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) l/', $t)) ||&nbsp;</div></li><li><div>                      (preg_match('/q \d+\.\d\d+ 0 0 \d+\.\d\d+ \d+\.\d\d+ (\d+\.\d\d+) cm \/(I|FO)\d+ Do Q/', $t)) ||&nbsp;</div></li><li><div>                      (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) m/', $t)) ||&nbsp;</div></li><li><div>                      (preg_match('/\d+\.\d\d+ (\d+\.\d\d+) \d+\.\d\d+ \d+\.\d\d+ \d+\.\d\d+ \d+\.\d\d+ c/', $t))) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $clb = $s['y'] + $s['h'];&nbsp;</div></li><li><div>                      if ($clb &gt; $this-&gt;ColDetails[$s['col']]['max_bottom']) {&nbsp;</div></li><li><div>                          $this-&gt;ColDetails[$s['col']]['max_bottom'] = $clb;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($clb &gt; $lowest_bottom_y) {&nbsp;</div></li><li><div>                          $lowest_bottom_y = $clb;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          foreach ($this-&gt;columnbuffer AS $key =&gt; $s) {&nbsp;</div></li><li><div>              if ($s['s'] != 'ACROFORM')&nbsp;</div></li><li><div>                  $this-&gt;pages[$this-&gt;page] .= $s['s'] . &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($lowest_bottom_y &gt; 0) {&nbsp;</div></li><li><div>              $this-&gt;y = $lowest_bottom_y;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Output Bookmarks</span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;col_BMoutlines AS $v) {&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'y' =&gt; $v['y'], 'p' =&gt; $v['p']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Output ToC</span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;col_toc AS $v) {&nbsp;</div></li><li><div>              $this-&gt;tocontents-&gt;_toc[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'p' =&gt; $v['p'], 'link' =&gt; $v['link'], 'toc_id' =&gt; $v['toc_id']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ($this-&gt;internallink AS $key =&gt; $f) {&nbsp;</div></li><li><div>          if (isset($this-&gt;internallink[$key]['col']))&nbsp;</div></li><li><div>              unset($this-&gt;internallink[$key]['col']);&nbsp;</div></li><li><div>          if (isset($this-&gt;internallink[$key]['rel_y']))&nbsp;</div></li><li><div>              unset($this-&gt;internallink[$key]['rel_y']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;columnbuffer = array();&nbsp;</div></li><li><div>      $this-&gt;ColDetails = array();&nbsp;</div></li><li><div>      $this-&gt;columnLinks = array();&nbsp;</div></li><li><div>      $this-&gt;columnAnnots = array();&nbsp;</div></li><li><div>      $this-&gt;columnForms = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;col_BMoutlines = array();&nbsp;</div></li><li><div>      $this-&gt;col_toc = array();&nbsp;</div></li><li><div>      $this-&gt;breakpoints = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>+&nbsp;</div></li><li><div>  function columnAdjustPregReplace($type, $xadj, $yadj, $pattern, $subject)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      preg_match($pattern, $subject, $matches);&nbsp;</div></li><li><div>      if (!count($matches)) {&nbsp;</div></li><li><div>          return $subject;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($matches[3])) {&nbsp;</div></li><li><div>          $matches[3] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($matches[4])) {&nbsp;</div></li><li><div>          $matches[4] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($matches[5])) {&nbsp;</div></li><li><div>          $matches[5] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!isset($matches[6])) {&nbsp;</div></li><li><div>          $matches[6] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return str_replace($matches[0], $this-&gt;columnAdjustAdd($type, _MPDFK, $xadj, $yadj, $matches[1], $matches[2], $matches[3], $matches[4], $matches[5], $matches[6]), $subject);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>====================================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  function printcellbuffer()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (count($this-&gt;cellBorderBuffer)) {&nbsp;</div></li><li><div>          sort($this-&gt;cellBorderBuffer);&nbsp;</div></li><li><div>          foreach ($this-&gt;cellBorderBuffer AS $cbb) {&nbsp;</div></li><li><div>              $cba = unpack(&quot;A16dom/nbord/A1side/ns/dbw/a6ca/A10style/dx/dy/dw/dh/dmbl/dmbr/dmrt/dmrb/dmtl/dmtr/dmlt/dmlb/dcpd/dover/&quot;, $cbb);&nbsp;</div></li><li><div>              $side = $cba['side'];&nbsp;</div></li><li><div>              $color = str_pad($cba['ca'], 6, &quot;\x00&quot;);&nbsp;</div></li><li><div>              $details = array();&nbsp;</div></li><li><div>              $details[$side]['dom'] = (float) $cba['dom'];&nbsp;</div></li><li><div>              $details[$side]['s'] = $cba['s'];&nbsp;</div></li><li><div>              $details[$side]['w'] = $cba['bw'];&nbsp;</div></li><li><div>              $details[$side]['c'] = $color;&nbsp;</div></li><li><div>              $details[$side]['style'] = trim($cba['style']);&nbsp;</div></li><li><div>              $details['mbw']['BL'] = $cba['mbl'];&nbsp;</div></li><li><div>              $details['mbw']['BR'] = $cba['mbr'];&nbsp;</div></li><li><div>              $details['mbw']['RT'] = $cba['mrt'];&nbsp;</div></li><li><div>              $details['mbw']['RB'] = $cba['mrb'];&nbsp;</div></li><li><div>              $details['mbw']['TL'] = $cba['mtl'];&nbsp;</div></li><li><div>              $details['mbw']['TR'] = $cba['mtr'];&nbsp;</div></li><li><div>              $details['mbw']['LT'] = $cba['mlt'];&nbsp;</div></li><li><div>              $details['mbw']['LB'] = $cba['mlb'];&nbsp;</div></li><li><div>              $details['cellposdom'] = $cba['cpd'];&nbsp;</div></li><li><div>              $details['p'] = $side;&nbsp;</div></li><li><div>              if ($cba['over'] == 1) {&nbsp;</div></li><li><div>                  $details[$side]['overlay'] = true;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $details[$side]['overlay'] = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_tableRect($cba['x'], $cba['y'], $cba['w'], $cba['h'], $cba['bord'], $details, false, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;cellBorderBuffer = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>====================================&nbsp;</div></li><li><div>  function printtablebuffer()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;table_rotate) {&nbsp;</div></li><li><div>          $this-&gt;pages[$this-&gt;page] .= $this-&gt;tablebuffer;&nbsp;</div></li><li><div>          foreach ($this-&gt;tbrot_Links AS $p =&gt; $l) {&nbsp;</div></li><li><div>              foreach ($l AS $v) {&nbsp;</div></li><li><div>                  $this-&gt;PageLinks[$p][] = $v;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;tbrot_Links = array();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;tbrot_Annots AS $p =&gt; $l) {&nbsp;</div></li><li><div>              foreach ($l AS $v) {&nbsp;</div></li><li><div>                  $this-&gt;PageAnnots[$p][] = $v;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;tbrot_Annots = array();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Output Bookmarks</span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;tbrot_BMoutlines AS $v) {&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'y' =&gt; $v['y'], 'p' =&gt; $v['p']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;tbrot_BMoutlines = array();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Output ToC</span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;tbrot_toc AS $v) {&nbsp;</div></li><li><div>              $this-&gt;tocontents-&gt;_toc[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'p' =&gt; $v['p'], 'link' =&gt; $v['link'], 'toc_id' =&gt; $v['toc_id']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;tbrot_toc = array();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// elseif rotated</span>&nbsp;</div></li><li><div>      $lm = $this-&gt;lMargin + $this-&gt;blk[$this-&gt;blklvl]['outer_left_margin'] + $this-&gt;blk[$this-&gt;blklvl]['border_left']['w'] + $this-&gt;blk[$this-&gt;blklvl]['padding_left'];&nbsp;</div></li><li><div>      $pw = $this-&gt;blk[$this-&gt;blklvl]['inner_width'];&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Start Transformation</span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] .= $this-&gt;StartTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;table_rotate &gt; 1) { <span class="comment"><span class="comment"><span class="comment">// clockwise</span></span></span>&nbsp;</div></li><li><div>          if ($this-&gt;tbrot_align == 'L') {&nbsp;</div></li><li><div>              $xadj = $this-&gt;tbrot_h; <span class="comment"><span class="comment">// align L (as is)</span></span>&nbsp;</div></li><li><div>          } elseif ($this-&gt;tbrot_align == 'R') {&nbsp;</div></li><li><div>              $xadj = $lm - $this-&gt;tbrot_x0 + ($pw); <span class="comment"><span class="comment">// align R</span></span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $xadj = $lm - $this-&gt;tbrot_x0 + (($pw + $this-&gt;tbrot_h) / 2); <span class="comment"><span class="comment">// align C</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $yadj = 0;&nbsp;</div></li><li><div>      } else { <span class="comment">// anti-clockwise</span>&nbsp;</div></li><li><div>          if ($this-&gt;tbrot_align == 'L') {&nbsp;</div></li><li><div>              $xadj = 0; <span class="comment"><span class="comment">// align L (as is)</span></span>&nbsp;</div></li><li><div>          } elseif ($this-&gt;tbrot_align == 'R') {&nbsp;</div></li><li><div>              $xadj = $lm - $this-&gt;tbrot_x0 + ($pw - $this-&gt;tbrot_h); <span class="comment"><span class="comment">// align R</span></span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $xadj = $lm - $this-&gt;tbrot_x0 + (($pw - $this-&gt;tbrot_h) / 2); <span class="comment"><span class="comment">// align C</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $yadj = $this-&gt;tbrot_w;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] .= $this-&gt;transformTranslate($xadj, $yadj, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] .= $this-&gt;transformRotate($this-&gt;table_rotate, $this-&gt;tbrot_x0, $this-&gt;tbrot_y0, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Now output the adjusted values</span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] .= $this-&gt;tablebuffer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($this-&gt;tbrot_Links AS $p =&gt; $l) {&nbsp;</div></li><li><div>          foreach ($l AS $v) {&nbsp;</div></li><li><div>              $w = $v[2] / _MPDFK;&nbsp;</div></li><li><div>              $h = $v[3] / _MPDFK;&nbsp;</div></li><li><div>              $ax = ($v[0] / _MPDFK) - $this-&gt;tbrot_x0;&nbsp;</div></li><li><div>              $ay = (($this-&gt;hPt - $v[1]) / _MPDFK) - $this-&gt;tbrot_y0;&nbsp;</div></li><li><div>              if ($this-&gt;table_rotate &gt; 1) { <span class="comment"><span class="comment"><span class="comment">// clockwise</span></span></span>&nbsp;</div></li><li><div>                  $bx = $this-&gt;tbrot_x0 + $xadj - $ay - $h;&nbsp;</div></li><li><div>                  $by = $this-&gt;tbrot_y0 + $yadj + $ax;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $bx = $this-&gt;tbrot_x0 + $xadj + $ay;&nbsp;</div></li><li><div>                  $by = $this-&gt;tbrot_y0 + $yadj - $ax - $w;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $v[0] = $bx * _MPDFK;&nbsp;</div></li><li><div>              $v[1] = ($this-&gt;h - $by) * _MPDFK;&nbsp;</div></li><li><div>              $v[2] = $h * _MPDFK; <span class="comment"><span class="comment"><span class="comment">// swap width and height</span></span></span>&nbsp;</div></li><li><div>              $v[3] = $w * _MPDFK;&nbsp;</div></li><li><div>              $this-&gt;PageLinks[$p][] = $v;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;tbrot_Links = array();&nbsp;</div></li><li><div>      foreach ($this-&gt;internallink AS $key =&gt; $f) {&nbsp;</div></li><li><div>          if (is_array($f) && isset($f['tbrot'])) {&nbsp;</div></li><li><div>              $f['Y'] = $this-&gt;tbrot_y0;&nbsp;</div></li><li><div>              $f['PAGE'] = $this-&gt;page;&nbsp;</div></li><li><div>              unset($f['tbrot']);&nbsp;</div></li><li><div>              $this-&gt;internallink[$key] = $f;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;tbrot_Annots AS $p =&gt; $l) {&nbsp;</div></li><li><div>          foreach ($l AS $v) {&nbsp;</div></li><li><div>              $ax = abs($v['x']) - $this-&gt;tbrot_x0; <span class="comment">// abs because -ve values are internally set and held for reference if annotMargin set</span>&nbsp;</div></li><li><div>              $ay = $v['y'] - $this-&gt;tbrot_y0;&nbsp;</div></li><li><div>              if ($this-&gt;table_rotate &gt; 1) { <span class="comment"><span class="comment"><span class="comment">// clockwise</span></span></span>&nbsp;</div></li><li><div>                  $bx = $this-&gt;tbrot_x0 + $xadj - $ay;&nbsp;</div></li><li><div>                  $by = $this-&gt;tbrot_y0 + $yadj + $ax;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $bx = $this-&gt;tbrot_x0 + $xadj + $ay;&nbsp;</div></li><li><div>                  $by = $this-&gt;tbrot_y0 + $yadj - $ax;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($v['x'] &lt; 0) {&nbsp;</div></li><li><div>                  $v['x'] = -$bx;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $v['x'] = $bx;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $v['y'] = ($by);&nbsp;</div></li><li><div>              $this-&gt;PageAnnots[$p][] = $v;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;tbrot_Annots = array();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Adjust Bookmarks</span></span></span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;tbrot_BMoutlines AS $v) {&nbsp;</div></li><li><div>          $v['y'] = $this-&gt;tbrot_y0;&nbsp;</div></li><li><div>          $this-&gt;BMoutlines[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'y' =&gt; $v['y'], 'p' =&gt; $this-&gt;page);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Adjust ToC</span></span></span> - uses document page number&nbsp;</div></li><li><div>      foreach ($this-&gt;tbrot_toc AS $v) {&nbsp;</div></li><li><div>          $this-&gt;tocontents-&gt;_toc[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'p' =&gt; $this-&gt;page, 'link' =&gt; $v['link'], 'toc_id' =&gt; $v['toc_id']);&nbsp;</div></li><li><div>          $this-&gt;links[$v['link']][1] = $this-&gt;tbrot_y0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;tbrot_BMoutlines = array();&nbsp;</div></li><li><div>      $this-&gt;tbrot_toc = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Stop Transformation</span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] .= $this-&gt;StopTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;y = $this-&gt;tbrot_y0 + $this-&gt;tbrot_w;&nbsp;</div></li><li><div>      $this-&gt;x = $this-&gt;lMargin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;tablebuffer = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>====================================&nbsp;</div></li><li><div>  <span class="comment">// Keep-with-table This buffers contents of h1-6 to keep on page with table</span>&nbsp;</div></li><li><div>  function printkwtbuffer()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$this-&gt;kwt_moved) {&nbsp;</div></li><li><div>          foreach ($this-&gt;kwt_buffer AS $s) {&nbsp;</div></li><li><div>              $this-&gt;pages[$this-&gt;page] .= $s['s'] . &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          foreach ($this-&gt;kwt_Links AS $p =&gt; $l) {&nbsp;</div></li><li><div>              foreach ($l AS $v) {&nbsp;</div></li><li><div>                  $this-&gt;PageLinks[$p][] = $v;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;kwt_Links = array();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;kwt_Annots AS $p =&gt; $l) {&nbsp;</div></li><li><div>              foreach ($l AS $v) {&nbsp;</div></li><li><div>                  $this-&gt;PageAnnots[$p][] = $v;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;kwt_Annots = array();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">/** -- INDEX -- */</span></span></span>&nbsp;</div></li><li><div>          <span class="comment">// Output Reference (index)</span>&nbsp;</div></li><li><div>          foreach ($this-&gt;kwt_Reference AS $v) {&nbsp;</div></li><li><div>              $Present = 0;&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; count($this-&gt;Reference); $i++) {&nbsp;</div></li><li><div>                  if ($this-&gt;Reference[$i]['t'] == $v['t']) {&nbsp;</div></li><li><div>                      $Present = 1;&nbsp;</div></li><li><div>                      if (!in_array($v['op'], $this-&gt;Reference[$i]['p'])) {&nbsp;</div></li><li><div>                          $this-&gt;Reference[$i]['p'][] = $v['op'];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($Present == 0) {&nbsp;</div></li><li><div>                  $this-&gt;Reference[] = array('t' =&gt; $v['t'], 'p' =&gt; array($v['op']));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;kwt_Reference = array();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">/** -- END INDEX -- */</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Output Bookmarks</span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;kwt_BMoutlines AS $v) {&nbsp;</div></li><li><div>              $this-&gt;BMoutlines[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'y' =&gt; $v['y'], 'p' =&gt; $v['p']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;kwt_BMoutlines = array();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Output ToC</span></span></span>&nbsp;</div></li><li><div>          foreach ($this-&gt;kwt_toc AS $v) {&nbsp;</div></li><li><div>              $this-&gt;tocontents-&gt;_toc[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'p' =&gt; $v['p'], 'link' =&gt; $v['link'], 'toc_id' =&gt; $v['toc_id']);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;kwt_toc = array();&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;pageoutput[$this-&gt;page] = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Start Transformation</span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] .= $this-&gt;StartTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>      $xadj = $this-&gt;lMargin - $this-&gt;kwt_x0;&nbsp;</div></li><li><div>      <span class="comment">//$yadj = $this-&gt;y - $this-&gt;kwt_y0 ;</span>&nbsp;</div></li><li><div>      $yadj = $this-&gt;tMargin - $this-&gt;kwt_y0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] .= $this-&gt;transformTranslate($xadj, $yadj, true) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Now output the adjusted values</span></span></span></span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;kwt_buffer AS $s) {&nbsp;</div></li><li><div>          $this-&gt;pages[$this-&gt;page] .= $s['s'] . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Adjust hyperLinks</span>&nbsp;</div></li><li><div>      foreach ($this-&gt;kwt_Links AS $p =&gt; $l) {&nbsp;</div></li><li><div>          foreach ($l AS $v) {&nbsp;</div></li><li><div>              $bx = $this-&gt;kwt_x0 + $xadj;&nbsp;</div></li><li><div>              $by = $this-&gt;kwt_y0 + $yadj;&nbsp;</div></li><li><div>              $v[0] = $bx * _MPDFK;&nbsp;</div></li><li><div>              $v[1] = ($this-&gt;h - $by) * _MPDFK;&nbsp;</div></li><li><div>              $this-&gt;PageLinks[$p][] = $v;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ($this-&gt;internallink AS $key =&gt; $f) {&nbsp;</div></li><li><div>          if (is_array($f) && isset($f['kwt'])) {&nbsp;</div></li><li><div>              $f['Y'] += $yadj;&nbsp;</div></li><li><div>              $f['PAGE'] = $this-&gt;page;&nbsp;</div></li><li><div>              unset($f['kwt']);&nbsp;</div></li><li><div>              $this-&gt;internallink[$key] = $f;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;kwt_Annots AS $p =&gt; $l) {&nbsp;</div></li><li><div>          foreach ($l AS $v) {&nbsp;</div></li><li><div>              $bx = $this-&gt;kwt_x0 + $xadj;&nbsp;</div></li><li><div>              $by = $this-&gt;kwt_y0 + $yadj;&nbsp;</div></li><li><div>              if ($v['x'] &lt; 0) {&nbsp;</div></li><li><div>                  $v['x'] = -$bx;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $v['x'] = $bx;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $v['y'] = $by;&nbsp;</div></li><li><div>              $this-&gt;PageAnnots[$p][] = $v;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Adjust Bookmarks</span></span></span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;kwt_BMoutlines AS $v) {&nbsp;</div></li><li><div>          if ($v['y'] != 0) {&nbsp;</div></li><li><div>              $v['y'] += $yadj;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;BMoutlines[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'y' =&gt; $v['y'], 'p' =&gt; $this-&gt;page);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END BOOKMARKS -- */</span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">/** -- INDEX -- */</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Adjust Reference (index)</span>&nbsp;</div></li><li><div>      foreach ($this-&gt;kwt_Reference AS $v) {&nbsp;</div></li><li><div>          $Present = 0;&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Search the reference (AND Ref/PageNo) in the array</span></span>&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; count($this-&gt;Reference); $i++) {&nbsp;</div></li><li><div>              if ($this-&gt;Reference[$i]['t'] == $v['t']) {&nbsp;</div></li><li><div>                  $Present = 1;&nbsp;</div></li><li><div>                  if (!in_array($this-&gt;page, $this-&gt;Reference[$i]['p'])) {&nbsp;</div></li><li><div>                      $this-&gt;Reference[$i]['p'][] = $this-&gt;page;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($Present == 0) {&nbsp;</div></li><li><div>              $this-&gt;Reference[] = array('t' =&gt; $v['t'], 'p' =&gt; array($this-&gt;page));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">/** -- END INDEX -- */</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Adjust ToC</span></span></span>&nbsp;</div></li><li><div>      foreach ($this-&gt;kwt_toc AS $v) {&nbsp;</div></li><li><div>          $this-&gt;tocontents-&gt;_toc[] = array('t' =&gt; $v['t'], 'l' =&gt; $v['l'], 'p' =&gt; $this-&gt;page, 'link' =&gt; $v['link'], 'toc_id' =&gt; $v['toc_id']);&nbsp;</div></li><li><div>          $this-&gt;links[$v['link']][0] = $this-&gt;page;&nbsp;</div></li><li><div>          $this-&gt;links[$v['link']][1] += $yadj;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TOC -- */</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;kwt_Links = array();&nbsp;</div></li><li><div>      $this-&gt;kwt_Annots = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;kwt_Reference = array();&nbsp;</div></li><li><div>      $this-&gt;kwt_BMoutlines = array();&nbsp;</div></li><li><div>      $this-&gt;kwt_toc = array();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//Stop Transformation</span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] .= $this-&gt;StopTransform(true) . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;kwt_buffer = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;y += $this-&gt;kwt_height;&nbsp;</div></li><li><div>      $this-&gt;pageoutput[$this-&gt;page] = array(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END TABLES -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>====================================&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function printfloatbuffer()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (count($this-&gt;floatbuffer)) {&nbsp;</div></li><li><div>          $this-&gt;objectbuffer = $this-&gt;floatbuffer;&nbsp;</div></li><li><div>          $this-&gt;printobjectbuffer(false);&nbsp;</div></li><li><div>          $this-&gt;objectbuffer = array();&nbsp;</div></li><li><div>          $this-&gt;floatbuffer = array();&nbsp;</div></li><li><div>          $this-&gt;floatmargins = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>====================================&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">//===========================</span></span>===</span>====================================&nbsp;</div></li><li><div>  <span class="comment">// Added ELLIPSES and CIRCLES</span>&nbsp;</div></li><li><div>  function Circle($x, $y, $r, $style = 'S')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;Ellipse($x, $y, $r, $r, $style);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Ellipse($x, $y, $rx, $ry, $style = 'S')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($style == 'F') {&nbsp;</div></li><li><div>          $op = 'f';&nbsp;</div></li><li><div>      } elseif ($style == 'FD' or $style == 'DF') {&nbsp;</div></li><li><div>          $op = 'B';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $op = 'S';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $lx = 4 / 3 * (M_SQRT2 - 1) * $rx;&nbsp;</div></li><li><div>      $ly = 4 / 3 * (M_SQRT2 - 1) * $ry;&nbsp;</div></li><li><div>      $h = $this-&gt;h;&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F m %.3F %.3F %.3F %.3F %.3F %.3F c', ($x + $rx) * _MPDFK, ($h - $y) * _MPDFK, ($x + $rx) * _MPDFK, ($h - ($y - $ly)) * _MPDFK, ($x + $lx) * _MPDFK, ($h - ($y - $ry)) * _MPDFK, $x * _MPDFK, ($h - ($y - $ry)) * _MPDFK));&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c', ($x - $lx) * _MPDFK, ($h - ($y - $ry)) * _MPDFK, ($x - $rx) * _MPDFK, ($h - ($y - $ly)) * _MPDFK, ($x - $rx) * _MPDFK, ($h - $y) * _MPDFK));&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c', ($x - $rx) * _MPDFK, ($h - ($y + $ly)) * _MPDFK, ($x - $lx) * _MPDFK, ($h - ($y + $ry)) * _MPDFK, $x * _MPDFK, ($h - ($y + $ry)) * _MPDFK));&nbsp;</div></li><li><div>      $this-&gt;_out(sprintf('%.3F %.3F %.3F %.3F %.3F %.3F c %s', ($x + $lx) * _MPDFK, ($h - ($y + $ry)) * _MPDFK, ($x + $rx) * _MPDFK, ($h - ($y + $ly)) * _MPDFK, ($x + $rx) * _MPDFK, ($h - $y) * _MPDFK, $op));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- DIRECTW -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Added adaptation of shaded_box = AUTOSIZE-TEXT</span>&nbsp;</div></li><li><div>  function AutosizeText($text, $w, $font, $style, $szfont = 72)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $text = ' ' . $text . ' ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetFont($font, $style, $szfont, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $text = $this-&gt;purify_utf8_text($text);&nbsp;</div></li><li><div>      if ($this-&gt;text_input_as_HTML) {&nbsp;</div></li><li><div>          $text = $this-&gt;all_entities_to_utf8($text);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $text = mb_convert_encoding($text, $this-&gt;mb_enc, 'UTF-8');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// DIRECTIONALITY</span></span></span></span>&nbsp;</div></li><li><div>      if (preg_match(&quot;/([&quot; . $this-&gt;pregRTLchars . &quot;])/u&quot;, $text)) {&nbsp;</div></li><li><div>          $this-&gt;biDirectional = true;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *OTL*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $textvar = 0;&nbsp;</div></li><li><div>      $save_OTLtags = $this-&gt;OTLtags;&nbsp;</div></li><li><div>      $this-&gt;OTLtags = array();&nbsp;</div></li><li><div>      if ($this-&gt;useKerning) {&nbsp;</div></li><li><div>          if ($this-&gt;CurrentFont['haskernGPOS']) {&nbsp;</div></li><li><div>              $this-&gt;OTLtags['Plus'] .= ' kern';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $textvar = ($textvar | FC_KERNING);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Use OTL OpenType Table Layout - GSUB</span> & GPOS&nbsp;</div></li><li><div>      if (isset($this-&gt;CurrentFont['useOTL']) && $this-&gt;CurrentFont['useOTL']) {&nbsp;</div></li><li><div>          $text = $this-&gt;otl-&gt;applyOTL($text, $this-&gt;CurrentFont['useOTL']);&nbsp;</div></li><li><div>          $OTLdata = $this-&gt;otl-&gt;OTLdata;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $this-&gt;OTLtags = $save_OTLtags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;magic_reverse_dir($text, $this-&gt;directionality, $OTLdata);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $width = $this-&gt;ConvertSize($w);&nbsp;</div></li><li><div>      $loop = 0;&nbsp;</div></li><li><div>      while ($loop == 0) {&nbsp;</div></li><li><div>          $this-&gt;SetFont($font, $style, $szfont, false);&nbsp;</div></li><li><div>          $sz = $this-&gt;GetStringWidth($text, true, $OTLdata, $textvar);&nbsp;</div></li><li><div>          if ($sz &gt; $w) {&nbsp;</div></li><li><div>              $szfont --;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $loop ++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetFont($font, $style, $szfont, true, true);&nbsp;</div></li><li><div>      $this-&gt;Cell($w, 0, $text, 0, 0, &quot;C&quot;, 0, '', 0, 0, 0, 'M', 0, false, $OTLdata, $textvar);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END DIRECTW -- */</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ====================================================</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ====================================================</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function magic_reverse_dir(&$chunk, $dir, &$chunkOTLdata)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ($this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($chunk == '') {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;biDirectional || $dir == 'rtl') {&nbsp;</div></li><li><div>          <span class="comment">// check if string contains RTL text</span>&nbsp;</div></li><li><div>          <span class="comment">// including any added from OTL tables (in PUA)</span>&nbsp;</div></li><li><div>          $pregRTLchars = $this-&gt;pregRTLchars;&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['rtlPUAstr']) && $this-&gt;CurrentFont['rtlPUAstr']) {&nbsp;</div></li><li><div>              $pregRTLchars .= $this-&gt;CurrentFont['rtlPUAstr'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!preg_match(&quot;/[&quot; . $pregRTLchars . &quot;]/u&quot;, $chunk) && $dir != 'rtl') {&nbsp;</div></li><li><div>              return 0;&nbsp;</div></li><li><div>          }   <span class="comment">// Chunk doesn't contain RTL characters</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $unicode = $this-&gt;UTF8StringToArray($chunk, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $is_strong = false;&nbsp;</div></li><li><div>          if (empty($chunkOTLdata)) {&nbsp;</div></li><li><div>              $this-&gt;getBasicOTLdata($chunkOTLdata, $unicode, $is_strong);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['useOTL']) && ($this-&gt;CurrentFont['useOTL'] & 0x80)) {&nbsp;</div></li><li><div>              $useGPOS = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $useGPOS = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// NB Returned $chunk may be a shorter string (with adjusted $cOTLdata) by removal of LRE, RLE etc embedding codes.</span>&nbsp;</div></li><li><div>          list($chunk, $rtl_content) = $this-&gt;otl-&gt;_bidiSort($unicode, $chunk, $dir, $chunkOTLdata, $useGPOS);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $rtl_content;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function getBasicOTLdata(&$chunkOTLdata, $unicode, &$is_strong)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('otl', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/otl.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($this-&gt;otl)) {&nbsp;</div></li><li><div>          $this-&gt;otl = new otl($this);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $chunkOTLdata['group'] = '';&nbsp;</div></li><li><div>      $chunkOTLdata['GPOSinfo'] = array();&nbsp;</div></li><li><div>      $chunkOTLdata['char_data'] = array();&nbsp;</div></li><li><div>      foreach ($unicode as $char) {&nbsp;</div></li><li><div>          $ucd_record = UCDN::get_ucd_record($char);&nbsp;</div></li><li><div>          $chunkOTLdata['char_data'][] = array('bidi_class' =&gt; $ucd_record[2], 'uni' =&gt; $char);&nbsp;</div></li><li><div>          if ($ucd_record[2] == 0 || $ucd_record[2] == 3 || $ucd_record[2] == 4) {&nbsp;</div></li><li><div>              $is_strong = true;&nbsp;</div></li><li><div>          } <span class="comment">// contains strong character</span>&nbsp;</div></li><li><div>          if ($ucd_record[0] == UCDN::UNICODE_GENERAL_CATEGORY_NON_SPACING_MARK) {&nbsp;</div></li><li><div>              $chunkOTLdata['group'] .= 'M';&nbsp;</div></li><li><div>          } elseif ($char == 32 || $char == 12288) {&nbsp;</div></li><li><div>              $chunkOTLdata['group'] .= 'S';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $chunkOTLdata['group'] .= 'C';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _setBidiCodes($mode = 'start', $bdf)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>      if ($mode == 'end') {&nbsp;</div></li><li><div>          <span class="comment">// PDF comes before PDI to close isolate-override (e.g. &quot;LRILROPDFPDI&quot;)</span>&nbsp;</div></li><li><div>          if (strpos($bdf, 'PDF') !== false) {&nbsp;</div></li><li><div>              $s .= code2utf(0x202C);&nbsp;</div></li><li><div>          } <span class="comment">// POP DIRECTIONAL FORMATTING</span>&nbsp;</div></li><li><div>          if (strpos($bdf, 'PDI') !== false) {&nbsp;</div></li><li><div>              $s .= code2utf(0x2069);&nbsp;</div></li><li><div>          } <span class="comment">// POP DIRECTIONAL ISOLATE</span>&nbsp;</div></li><li><div>      } elseif ($mode == 'start') {&nbsp;</div></li><li><div>          <span class="comment">// LRI comes before LRO to open isolate-override (e.g. &quot;LRILROPDFPDI&quot;)</span>&nbsp;</div></li><li><div>          if (strpos($bdf, 'LRI') !== false) {&nbsp;</div></li><li><div>              $s .= code2utf(0x2066);&nbsp;</div></li><li><div>          } <span class="comment">// U+2066 LRI</span>&nbsp;</div></li><li><div>          elseif (strpos($bdf, 'RLI') !== false) {&nbsp;</div></li><li><div>              $s .= code2utf(0x2067);&nbsp;</div></li><li><div>          } <span class="comment">// U+2067 RLI</span>&nbsp;</div></li><li><div>          elseif (strpos($bdf, 'FSI') !== false) {&nbsp;</div></li><li><div>              $s .= code2utf(0x2068);&nbsp;</div></li><li><div>          } <span class="comment">// U+2068 FSI</span>&nbsp;</div></li><li><div>          if (strpos($bdf, 'LRO') !== false) {&nbsp;</div></li><li><div>              $s .= code2utf(0x202D);&nbsp;</div></li><li><div>          } <span class="comment">// U+202D LRO</span>&nbsp;</div></li><li><div>          elseif (strpos($bdf, 'RLO') !== false) {&nbsp;</div></li><li><div>              $s .= code2utf(0x202E);&nbsp;</div></li><li><div>          } <span class="comment">// U+202E RLO</span>&nbsp;</div></li><li><div>          elseif (strpos($bdf, 'LRE') !== false) {&nbsp;</div></li><li><div>              $s .= code2utf(0x202A);&nbsp;</div></li><li><div>          } <span class="comment">// U+202A LRE</span>&nbsp;</div></li><li><div>          elseif (strpos($bdf, 'RLE') !== false) {&nbsp;</div></li><li><div>              $s .= code2utf(0x202B);&nbsp;</div></li><li><div>          } <span class="comment">// U+202B RLE</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END OTL -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  //&nbsp;</div></li><li><div>  <span class="comment">// ****</span>************************&nbsp;</div></li><li><div>  <span class="comment">// ****</span>************************&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetSubstitutions()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $subsarray = array();&nbsp;</div></li><li><div>      @include(_MPDF_PATH . 'includes/subs_win-1252.php');&nbsp;</div></li><li><div>      $this-&gt;substitute = array();&nbsp;</div></li><li><div>      foreach ($subsarray AS $key =&gt; $val) {&nbsp;</div></li><li><div>          $this-&gt;substitute[code2utf($key)] = $val;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SubstituteChars($html)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// only substitute characters between tags</span>&nbsp;</div></li><li><div>      if (count($this-&gt;substitute)) {&nbsp;</div></li><li><div>          $a = preg_split('/(&lt;.*?&gt;)/ms', $html, -1, PREG_SPLIT_DELIM_CAPTURE);&nbsp;</div></li><li><div>          $html = '';&nbsp;</div></li><li><div>          foreach ($a as $i =&gt; $e) {&nbsp;</div></li><li><div>              if ($i % 2 == 0) {&nbsp;</div></li><li><div>                  $e = strtr($e, $this-&gt;substitute);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $html .= $e;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $html;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SubstituteCharsSIP(&$writehtml_a, &$writehtml_i, &$writehtml_e)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (preg_match(&quot;/^(.*?)([\x{20000}-\x{2FFFF}]+)(.*)/u&quot;, $writehtml_e, $m)) {&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['sipext']) && $this-&gt;CurrentFont['sipext']) {&nbsp;</div></li><li><div>              $font = $this-&gt;CurrentFont['sipext'];&nbsp;</div></li><li><div>              if (!in_array($font, $this-&gt;available_unifonts)) {&nbsp;</div></li><li><div>                  return 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $writehtml_a[$writehtml_i] = $writehtml_e = $m[1];&nbsp;</div></li><li><div>              array_splice($writehtml_a, $writehtml_i + 1, 0, array('span style=&quot;font-family: ' . $font . '&quot;', $m[2], '/span', $m[3]));&nbsp;</div></li><li><div>              $this-&gt;subPos = $writehtml_i;&nbsp;</div></li><li><div>              return 4;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// If core font is selected in document which is not onlyCoreFonts - substitute with non-core font</span></span>&nbsp;</div></li><li><div>  function SubstituteCharsNonCore(&$writehtml_a, &$writehtml_i, &$writehtml_e)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Ignore if in Textarea</span></span>&nbsp;</div></li><li><div>      if ($writehtml_i &gt; 0 && strtolower(substr($writehtml_a[$writehtml_i - 1], 0, 8)) == 'textarea') {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (mb_convert_encoding(mb_convert_encoding($writehtml_e, $this-&gt;mb_enc, &quot;UTF-8&quot;), &quot;UTF-8&quot;, $this-&gt;mb_enc) == $writehtml_e) {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $cw = &$this-&gt;CurrentFont['cw'];&nbsp;</div></li><li><div>      $unicode = $this-&gt;UTF8StringToArray($writehtml_e, false);&nbsp;</div></li><li><div>      $start = -1;&nbsp;</div></li><li><div>      $end = 0;&nbsp;</div></li><li><div>      $flag = 0;&nbsp;</div></li><li><div>      $ftype = '';&nbsp;</div></li><li><div>      $u = array();&nbsp;</div></li><li><div>      if (!$this-&gt;subArrMB) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'includes/subs_core.php');&nbsp;</div></li><li><div>          $this-&gt;subArrMB['a'] = $aarr;&nbsp;</div></li><li><div>          $this-&gt;subArrMB['s'] = $sarr;&nbsp;</div></li><li><div>          $this-&gt;subArrMB['z'] = $zarr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ($unicode AS $c =&gt; $char) {&nbsp;</div></li><li><div>          if (($char &gt; 127 || ($flag == 1 && $char == 32)) && $char != 173 && (!isset($this-&gt;subArrMB['a'][$char]) || ($flag == 1 && $char == 32)) && ($char &lt; 1536 || ($char &gt; 1791 && $char &lt; 2304) || $char &gt; 3455)) {&nbsp;</div></li><li><div>              if ($flag == 0) {&nbsp;</div></li><li><div>                  $start = $c;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $flag = 1;&nbsp;</div></li><li><div>              $u[] = $char;&nbsp;</div></li><li><div>          } elseif ($flag &gt; 0) {&nbsp;</div></li><li><div>              $end = $c - 1;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($flag &gt; 0 && !$end) {&nbsp;</div></li><li><div>          $end = count($unicode) - 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($start == -1) {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// TRY IN BACKUP SUBS FONT</span>&nbsp;</div></li><li><div>      if (!is_array($this-&gt;backupSubsFont)) {&nbsp;</div></li><li><div>          $this-&gt;backupSubsFont = array(&quot;$this-&gt;backupSubsFont&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ($this-&gt;backupSubsFont AS $bsfctr =&gt; $bsf) {&nbsp;</div></li><li><div>          if ($this-&gt;fonttrans[$bsf] == 'chelvetica' || $this-&gt;fonttrans[$bsf] == 'ctimes' || $this-&gt;fonttrans[$bsf] == 'ccourier') {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $font = $bsf;&nbsp;</div></li><li><div>          unset($cw);&nbsp;</div></li><li><div>          $cw = '';&nbsp;</div></li><li><div>          if (isset($this-&gt;fonts[$font])) {&nbsp;</div></li><li><div>              $cw = &$this-&gt;fonts[$font]['cw'];&nbsp;</div></li><li><div>          } elseif (file_exists(_MPDF_TTFONTDATAPATH . $font . '.cw.dat')) {&nbsp;</div></li><li><div>              $cw = @file_get_contents(_MPDF_TTFONTDATAPATH . $font . '.cw.dat');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $prevFontFamily = $this-&gt;FontFamily;&nbsp;</div></li><li><div>              $prevFontStyle = $this-&gt;currentfontstyle;&nbsp;</div></li><li><div>              $prevFontSizePt = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>              $this-&gt;SetFont($bsf, '', '', false);&nbsp;</div></li><li><div>              $cw = @file_get_contents(_MPDF_TTFONTDATAPATH . $font . '.cw.dat');&nbsp;</div></li><li><div>              $this-&gt;SetFont($prevFontFamily, $prevFontStyle, $prevFontSizePt, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$cw) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $l = 0;&nbsp;</div></li><li><div>          foreach ($u AS $char) {&nbsp;</div></li><li><div>              if ($char == 173 || $this-&gt;_charDefined($cw, $char) || ($char &gt; 1536 && $char &lt; 1791) || ($char &gt; 2304 && $char &lt; 3455 )) {&nbsp;</div></li><li><div>                  $l++;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ($l == 0 && $bsfctr == (count($this-&gt;backupSubsFont) - 1)) { <span class="comment"><span class="comment">// Not found even in last backup font</span></span>&nbsp;</div></li><li><div>                      $cont = mb_substr($writehtml_e, $start + 1);&nbsp;</div></li><li><div>                      $writehtml_e = mb_substr($writehtml_e, 0, $start + 1, 'UTF-8');&nbsp;</div></li><li><div>                      array_splice($writehtml_a, $writehtml_i + 1, 0, array('', $cont));&nbsp;</div></li><li><div>                      $this-&gt;subPos = $writehtml_i + 1;&nbsp;</div></li><li><div>                      return 2;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($l &gt; 0) {&nbsp;</div></li><li><div>              $patt = mb_substr($writehtml_e, $start, $l, 'UTF-8');&nbsp;</div></li><li><div>              if (preg_match(&quot;/(.*?)(&quot; . preg_quote($patt, '/') . &quot;)(.*)/u&quot;, $writehtml_e, $m)) {&nbsp;</div></li><li><div>                  $writehtml_e = $m[1];&nbsp;</div></li><li><div>                  array_splice($writehtml_a, $writehtml_i + 1, 0, array('span style=&quot;font-family: ' . $font . '&quot;', $m[2], '/span', $m[3]));&nbsp;</div></li><li><div>                  $this-&gt;subPos = $writehtml_i + 3;&nbsp;</div></li><li><div>                  return 4;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unset($cw);&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SubstituteCharsMB(&$writehtml_a, &$writehtml_i, &$writehtml_e)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Ignore if in Textarea</span></span>&nbsp;</div></li><li><div>      if ($writehtml_i &gt; 0 && strtolower(substr($writehtml_a[$writehtml_i - 1], 0, 8)) == 'textarea') {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $cw = &$this-&gt;CurrentFont['cw'];&nbsp;</div></li><li><div>      $unicode = $this-&gt;UTF8StringToArray($writehtml_e, false);&nbsp;</div></li><li><div>      $start = -1;&nbsp;</div></li><li><div>      $end = 0;&nbsp;</div></li><li><div>      $flag = 0;&nbsp;</div></li><li><div>      $ftype = '';&nbsp;</div></li><li><div>      $u = array();&nbsp;</div></li><li><div>      foreach ($unicode AS $c =&gt; $char) {&nbsp;</div></li><li><div>          if (($flag == 0 || $flag == 2) && (!$this-&gt;_charDefined($cw, $char) || ($flag == 2 && $char == 32)) && $this-&gt;checkSIP && $char &gt; 131071) {  <span class="comment">// Unicode Plane 2 (SIP)</span>&nbsp;</div></li><li><div>              if (in_array($this-&gt;FontFamily, $this-&gt;available_CJK_fonts)) {&nbsp;</div></li><li><div>                  return 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($flag == 0) {&nbsp;</div></li><li><div>                  $start = $c;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $flag = 2;&nbsp;</div></li><li><div>              $u[] = $char;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//elseif (($flag == 0 || $flag==1) && $char != 173 && !$this-&gt;_charDefined($cw, $char) && ($char&lt;1423 ||  ($char&gt;3583 && $char &lt; 11263))) {</span>&nbsp;</div></li><li><div>          elseif (($flag == 0 || $flag == 1) && $char != 173 && (!$this-&gt;_charDefined($cw, $char) || ($flag == 1 && $char == 32)) && ($char &lt; 1536 || ($char &gt; 1791 && $char &lt; 2304) || $char &gt; 3455)) {&nbsp;</div></li><li><div>              if ($flag == 0) {&nbsp;</div></li><li><div>                  $start = $c;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $flag = 1;&nbsp;</div></li><li><div>              $u[] = $char;&nbsp;</div></li><li><div>          } elseif ($flag &gt; 0) {&nbsp;</div></li><li><div>              $end = $c - 1;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($flag &gt; 0 && !$end) {&nbsp;</div></li><li><div>          $end = count($unicode) - 1;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($start == -1) {&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($flag == 2) {  <span class="comment">// SIP</span>&nbsp;</div></li><li><div>          <span class="comment">// Check if current CJK font has a ext-B related font</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;CurrentFont['sipext']) && $this-&gt;CurrentFont['sipext']) {&nbsp;</div></li><li><div>              $font = $this-&gt;CurrentFont['sipext'];&nbsp;</div></li><li><div>              unset($cw);&nbsp;</div></li><li><div>              $cw = '';&nbsp;</div></li><li><div>              if (isset($this-&gt;fonts[$font])) {&nbsp;</div></li><li><div>                  $cw = &$this-&gt;fonts[$font]['cw'];&nbsp;</div></li><li><div>              } elseif (file_exists(_MPDF_TTFONTDATAPATH . $font . '.cw.dat')) {&nbsp;</div></li><li><div>                  $cw = @file_get_contents(_MPDF_TTFONTDATAPATH . $font . '.cw.dat');&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $prevFontFamily = $this-&gt;FontFamily;&nbsp;</div></li><li><div>                  $prevFontStyle = $this-&gt;currentfontstyle;&nbsp;</div></li><li><div>                  $prevFontSizePt = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>                  $this-&gt;SetFont($font, '', '', false);&nbsp;</div></li><li><div>                  $cw = @file_get_contents(_MPDF_TTFONTDATAPATH . $font . '.cw.dat');&nbsp;</div></li><li><div>                  $this-&gt;SetFont($prevFontFamily, $prevFontStyle, $prevFontSizePt, false);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!$cw) {&nbsp;</div></li><li><div>                  return 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $l = 0;&nbsp;</div></li><li><div>              foreach ($u AS $char) {&nbsp;</div></li><li><div>                  if ($this-&gt;_charDefined($cw, $char) || $char &gt; 131071) {&nbsp;</div></li><li><div>                      $l++;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($l &gt; 0) {&nbsp;</div></li><li><div>                  $patt = mb_substr($writehtml_e, $start, $l);&nbsp;</div></li><li><div>                  if (preg_match(&quot;/(.*?)(&quot; . preg_quote($patt, '/') . &quot;)(.*)/u&quot;, $writehtml_e, $m)) {&nbsp;</div></li><li><div>                      $writehtml_e = $m[1];&nbsp;</div></li><li><div>                      array_splice($writehtml_a, $writehtml_i + 1, 0, array('span style=&quot;font-family: ' . $font . '&quot;', $m[2], '/span', $m[3]));&nbsp;</div></li><li><div>                      $this-&gt;subPos = $writehtml_i + 3;&nbsp;</div></li><li><div>                      return 4;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Check Backup SIP font (defined in config_fonts.php)</span>&nbsp;</div></li><li><div>          if (isset($this-&gt;backupSIPFont) && $this-&gt;backupSIPFont) {&nbsp;</div></li><li><div>              if ($this-&gt;currentfontfamily != $this-&gt;backupSIPFont) {&nbsp;</div></li><li><div>                  $font = $this-&gt;backupSIPFont;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  unset($cw);&nbsp;</div></li><li><div>                  return 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              unset($cw);&nbsp;</div></li><li><div>              $cw = '';&nbsp;</div></li><li><div>              if (isset($this-&gt;fonts[$font])) {&nbsp;</div></li><li><div>                  $cw = &$this-&gt;fonts[$font]['cw'];&nbsp;</div></li><li><div>              } elseif (file_exists(_MPDF_TTFONTDATAPATH . $font . '.cw.dat')) {&nbsp;</div></li><li><div>                  $cw = @file_get_contents(_MPDF_TTFONTDATAPATH . $font . '.cw.dat');&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $prevFontFamily = $this-&gt;FontFamily;&nbsp;</div></li><li><div>                  $prevFontStyle = $this-&gt;currentfontstyle;&nbsp;</div></li><li><div>                  $prevFontSizePt = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>                  $this-&gt;SetFont($this-&gt;backupSIPFont, '', '', false);&nbsp;</div></li><li><div>                  $cw = @file_get_contents(_MPDF_TTFONTDATAPATH . $font . '.cw.dat');&nbsp;</div></li><li><div>                  $this-&gt;SetFont($prevFontFamily, $prevFontStyle, $prevFontSizePt, false);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if (!$cw) {&nbsp;</div></li><li><div>                  return 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $l = 0;&nbsp;</div></li><li><div>              foreach ($u AS $char) {&nbsp;</div></li><li><div>                  if ($this-&gt;_charDefined($cw, $char) || $char &gt; 131071) {&nbsp;</div></li><li><div>                      $l++;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($l &gt; 0) {&nbsp;</div></li><li><div>                  $patt = mb_substr($writehtml_e, $start, $l);&nbsp;</div></li><li><div>                  if (preg_match(&quot;/(.*?)(&quot; . preg_quote($patt, '/') . &quot;)(.*)/u&quot;, $writehtml_e, $m)) {&nbsp;</div></li><li><div>                      $writehtml_e = $m[1];&nbsp;</div></li><li><div>                      array_splice($writehtml_a, $writehtml_i + 1, 0, array('span style=&quot;font-family: ' . $font . '&quot;', $m[2], '/span', $m[3]));&nbsp;</div></li><li><div>                      $this-&gt;subPos = $writehtml_i + 3;&nbsp;</div></li><li><div>                      return 4;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// FIRST TRY CORE FONTS (when appropriate)</span>&nbsp;</div></li><li><div>      if (!$this-&gt;PDFA && !$this-&gt;PDFX && !$this-&gt;biDirectional) {  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          $repl = array();&nbsp;</div></li><li><div>          if (!$this-&gt;subArrMB) {&nbsp;</div></li><li><div>              include(_MPDF_PATH . 'includes/subs_core.php');&nbsp;</div></li><li><div>              $this-&gt;subArrMB['a'] = $aarr;&nbsp;</div></li><li><div>              $this-&gt;subArrMB['s'] = $sarr;&nbsp;</div></li><li><div>              $this-&gt;subArrMB['z'] = $zarr;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (isset($this-&gt;subArrMB['a'][$u[0]])) {&nbsp;</div></li><li><div>              $font = 'tta';&nbsp;</div></li><li><div>              $ftype = 'C';&nbsp;</div></li><li><div>              foreach ($u AS $char) {&nbsp;</div></li><li><div>                  if (isset($this-&gt;subArrMB['a'][$char])) {&nbsp;</div></li><li><div>                      $repl[] = $this-&gt;subArrMB['a'][$char];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif (isset($this-&gt;subArrMB['z'][$u[0]])) {&nbsp;</div></li><li><div>              $font = 'ttz';&nbsp;</div></li><li><div>              $ftype = 'C';&nbsp;</div></li><li><div>              foreach ($u AS $char) {&nbsp;</div></li><li><div>                  if (isset($this-&gt;subArrMB['z'][$char])) {&nbsp;</div></li><li><div>                      $repl[] = $this-&gt;subArrMB['z'][$char];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif (isset($this-&gt;subArrMB['s'][$u[0]])) {&nbsp;</div></li><li><div>              $font = 'tts';&nbsp;</div></li><li><div>              $ftype = 'C';&nbsp;</div></li><li><div>              foreach ($u AS $char) {&nbsp;</div></li><li><div>                  if (isset($this-&gt;subArrMB['s'][$char])) {&nbsp;</div></li><li><div>                      $repl[] = $this-&gt;subArrMB['s'][$char];&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($ftype == 'C') {&nbsp;</div></li><li><div>              $patt = mb_substr($writehtml_e, $start, count($repl));&nbsp;</div></li><li><div>              if (preg_match(&quot;/(.*?)(&quot; . preg_quote($patt, '/') . &quot;)(.*)/u&quot;, $writehtml_e, $m)) {&nbsp;</div></li><li><div>                  $writehtml_e = $m[1];&nbsp;</div></li><li><div>                  array_splice($writehtml_a, $writehtml_i + 1, 0, array($font, implode('|', $repl), '/' . $font, $m[3])); <span class="comment">// e.g. &lt;tts&gt;</span>&nbsp;</div></li><li><div>                  $this-&gt;subPos = $writehtml_i + 3;&nbsp;</div></li><li><div>                  return 4;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return 0;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// LASTLY TRY IN BACKUP SUBS FONT</span>&nbsp;</div></li><li><div>      if (!is_array($this-&gt;backupSubsFont)) {&nbsp;</div></li><li><div>          $this-&gt;backupSubsFont = array(&quot;$this-&gt;backupSubsFont&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ($this-&gt;backupSubsFont AS $bsfctr =&gt; $bsf) {&nbsp;</div></li><li><div>          if ($this-&gt;currentfontfamily != $bsf) {&nbsp;</div></li><li><div>              $font = $bsf;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset($cw);&nbsp;</div></li><li><div>          $cw = '';&nbsp;</div></li><li><div>          if (isset($this-&gt;fonts[$font])) {&nbsp;</div></li><li><div>              $cw = &$this-&gt;fonts[$font]['cw'];&nbsp;</div></li><li><div>          } elseif (file_exists(_MPDF_TTFONTDATAPATH . $font . '.cw.dat')) {&nbsp;</div></li><li><div>              $cw = @file_get_contents(_MPDF_TTFONTDATAPATH . $font . '.cw.dat');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $prevFontFamily = $this-&gt;FontFamily;&nbsp;</div></li><li><div>              $prevFontStyle = $this-&gt;currentfontstyle;&nbsp;</div></li><li><div>              $prevFontSizePt = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>              $this-&gt;SetFont($bsf, '', '', false);&nbsp;</div></li><li><div>              $cw = @file_get_contents(_MPDF_TTFONTDATAPATH . $font . '.cw.dat');&nbsp;</div></li><li><div>              $this-&gt;SetFont($prevFontFamily, $prevFontStyle, $prevFontSizePt, false);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (!$cw) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $l = 0;&nbsp;</div></li><li><div>          foreach ($u AS $char) {&nbsp;</div></li><li><div>              if ($char == 173 || $this-&gt;_charDefined($cw, $char) || ($char &gt; 1536 && $char &lt; 1791) || ($char &gt; 2304 && $char &lt; 3455 )) {  <span class="comment">// Arabic and Indic</span>&nbsp;</div></li><li><div>                  $l++;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ($l == 0 && $bsfctr == (count($this-&gt;backupSubsFont) - 1)) { <span class="comment"><span class="comment">// Not found even in last backup font</span></span>&nbsp;</div></li><li><div>                      $cont = mb_substr($writehtml_e, $start + 1);&nbsp;</div></li><li><div>                      $writehtml_e = mb_substr($writehtml_e, 0, $start + 1);&nbsp;</div></li><li><div>                      array_splice($writehtml_a, $writehtml_i + 1, 0, array('', $cont));&nbsp;</div></li><li><div>                      $this-&gt;subPos = $writehtml_i + 1;&nbsp;</div></li><li><div>                      return 2;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($l &gt; 0) {&nbsp;</div></li><li><div>              $patt = mb_substr($writehtml_e, $start, $l);&nbsp;</div></li><li><div>              if (preg_match(&quot;/(.*?)(&quot; . preg_quote($patt, '/') . &quot;)(.*)/u&quot;, $writehtml_e, $m)) {&nbsp;</div></li><li><div>                  $writehtml_e = $m[1];&nbsp;</div></li><li><div>                  array_splice($writehtml_a, $writehtml_i + 1, 0, array('span style=&quot;font-family: ' . $font . '&quot;', $m[2], '/span', $m[3]));&nbsp;</div></li><li><div>                  $this-&gt;subPos = $writehtml_i + 3;&nbsp;</div></li><li><div>                  return 4;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unset($cw);&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function setHiEntitySubstitutions()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $entarr = array(&nbsp;</div></li><li><div>          'nbsp' =&gt; '160', 'iexcl' =&gt; '161', 'cent' =&gt; '162', 'pound' =&gt; '163', 'curren' =&gt; '164', 'yen' =&gt; '165', 'brvbar' =&gt; '166', 'sect' =&gt; '167', &nbsp;</div></li><li><div>          'uml' =&gt; '168', 'copy' =&gt; '169', 'ordf' =&gt; '170', 'laquo' =&gt; '171', 'not' =&gt; '172', 'shy' =&gt; '173', 'reg' =&gt; '174', 'macr' =&gt; '175', &nbsp;</div></li><li><div>          'deg' =&gt; '176', 'plusmn' =&gt; '177', 'sup2' =&gt; '178', 'sup3' =&gt; '179', 'acute' =&gt; '180', 'micro' =&gt; '181', 'para' =&gt; '182', 'middot' =&gt; '183', &nbsp;</div></li><li><div>          'cedil' =&gt; '184', 'sup1' =&gt; '185', 'ordm' =&gt; '186', 'raquo' =&gt; '187', 'frac14' =&gt; '188', 'frac12' =&gt; '189', 'frac34' =&gt; '190', &nbsp;</div></li><li><div>          'iquest' =&gt; '191', 'Agrave' =&gt; '192', 'Aacute' =&gt; '193', 'Acirc' =&gt; '194', 'Atilde' =&gt; '195', 'Auml' =&gt; '196', 'Aring' =&gt; '197', &nbsp;</div></li><li><div>          'AElig' =&gt; '198', 'Ccedil' =&gt; '199', 'Egrave' =&gt; '200', 'Eacute' =&gt; '201', 'Ecirc' =&gt; '202', 'Euml' =&gt; '203', 'Igrave' =&gt; '204', &nbsp;</div></li><li><div>          'Iacute' =&gt; '205', 'Icirc' =&gt; '206', 'Iuml' =&gt; '207', 'ETH' =&gt; '208', 'Ntilde' =&gt; '209', 'Ograve' =&gt; '210', 'Oacute' =&gt; '211', &nbsp;</div></li><li><div>          'Ocirc' =&gt; '212', 'Otilde' =&gt; '213', 'Ouml' =&gt; '214', 'times' =&gt; '215', 'Oslash' =&gt; '216', 'Ugrave' =&gt; '217', 'Uacute' =&gt; '218', &nbsp;</div></li><li><div>          'Ucirc' =&gt; '219', 'Uuml' =&gt; '220', 'Yacute' =&gt; '221', 'THORN' =&gt; '222', 'szlig' =&gt; '223', 'agrave' =&gt; '224', 'aacute' =&gt; '225', &nbsp;</div></li><li><div>          'acirc' =&gt; '226', 'atilde' =&gt; '227', 'auml' =&gt; '228', 'aring' =&gt; '229', 'aelig' =&gt; '230', 'ccedil' =&gt; '231', 'egrave' =&gt; '232', &nbsp;</div></li><li><div>          'eacute' =&gt; '233', 'ecirc' =&gt; '234', 'euml' =&gt; '235', 'igrave' =&gt; '236', 'iacute' =&gt; '237', 'icirc' =&gt; '238', 'iuml' =&gt; '239', &nbsp;</div></li><li><div>          'eth' =&gt; '240', 'ntilde' =&gt; '241', 'ograve' =&gt; '242', 'oacute' =&gt; '243', 'ocirc' =&gt; '244', 'otilde' =&gt; '245', 'ouml' =&gt; '246', &nbsp;</div></li><li><div>          'divide' =&gt; '247', 'oslash' =&gt; '248', 'ugrave' =&gt; '249', 'uacute' =&gt; '250', 'ucirc' =&gt; '251', 'uuml' =&gt; '252', 'yacute' =&gt; '253', &nbsp;</div></li><li><div>          'thorn' =&gt; '254', 'yuml' =&gt; '255', 'OElig' =&gt; '338', 'oelig' =&gt; '339', 'Scaron' =&gt; '352', 'scaron' =&gt; '353', 'Yuml' =&gt; '376', &nbsp;</div></li><li><div>          'fnof' =&gt; '402', 'circ' =&gt; '710', 'tilde' =&gt; '732', 'Alpha' =&gt; '913', 'Beta' =&gt; '914', 'Gamma' =&gt; '915', 'Delta' =&gt; '916', &nbsp;</div></li><li><div>          'Epsilon' =&gt; '917', 'Zeta' =&gt; '918', 'Eta' =&gt; '919', 'Theta' =&gt; '920', 'Iota' =&gt; '921', 'Kappa' =&gt; '922', 'Lambda' =&gt; '923', &nbsp;</div></li><li><div>          'Mu' =&gt; '924', 'Nu' =&gt; '925', 'Xi' =&gt; '926', 'Omicron' =&gt; '927', 'Pi' =&gt; '928', 'Rho' =&gt; '929', 'Sigma' =&gt; '931', 'Tau' =&gt; '932', &nbsp;</div></li><li><div>          'Upsilon' =&gt; '933', 'Phi' =&gt; '934', 'Chi' =&gt; '935', 'Psi' =&gt; '936', 'Omega' =&gt; '937', 'alpha' =&gt; '945', 'beta' =&gt; '946', 'gamma' =&gt; '947', &nbsp;</div></li><li><div>          'delta' =&gt; '948', 'epsilon' =&gt; '949', 'zeta' =&gt; '950', 'eta' =&gt; '951', 'theta' =&gt; '952', 'iota' =&gt; '953', 'kappa' =&gt; '954', &nbsp;</div></li><li><div>          'lambda' =&gt; '955', 'mu' =&gt; '956', 'nu' =&gt; '957', 'xi' =&gt; '958', 'omicron' =&gt; '959', 'pi' =&gt; '960', 'rho' =&gt; '961', 'sigmaf' =&gt; '962', &nbsp;</div></li><li><div>          'sigma' =&gt; '963', 'tau' =&gt; '964', 'upsilon' =&gt; '965', 'phi' =&gt; '966', 'chi' =&gt; '967', 'psi' =&gt; '968', 'omega' =&gt; '969', &nbsp;</div></li><li><div>          'thetasym' =&gt; '977', 'upsih' =&gt; '978', 'piv' =&gt; '982', 'ensp' =&gt; '8194', 'emsp' =&gt; '8195', 'thinsp' =&gt; '8201', 'zwnj' =&gt; '8204', &nbsp;</div></li><li><div>          'zwj' =&gt; '8205', 'lrm' =&gt; '8206', 'rlm' =&gt; '8207', 'ndash' =&gt; '8211', 'mdash' =&gt; '8212', 'lsquo' =&gt; '8216', 'rsquo' =&gt; '8217', &nbsp;</div></li><li><div>          'sbquo' =&gt; '8218', 'ldquo' =&gt; '8220', 'rdquo' =&gt; '8221', 'bdquo' =&gt; '8222', 'dagger' =&gt; '8224', 'Dagger' =&gt; '8225', 'bull' =&gt; '8226', &nbsp;</div></li><li><div>          'hellip' =&gt; '8230', 'permil' =&gt; '8240', 'prime' =&gt; '8242', 'Prime' =&gt; '8243', 'lsaquo' =&gt; '8249', 'rsaquo' =&gt; '8250', 'oline' =&gt; '8254', &nbsp;</div></li><li><div>          'frasl' =&gt; '8260', 'euro' =&gt; '8364', 'image' =&gt; '8465', 'weierp' =&gt; '8472', 'real' =&gt; '8476', 'trade' =&gt; '8482', 'alefsym' =&gt; '8501', &nbsp;</div></li><li><div>          'larr' =&gt; '8592', 'uarr' =&gt; '8593', 'rarr' =&gt; '8594', 'darr' =&gt; '8595', 'harr' =&gt; '8596', 'crarr' =&gt; '8629', 'lArr' =&gt; '8656', &nbsp;</div></li><li><div>          'uArr' =&gt; '8657', 'rArr' =&gt; '8658', 'dArr' =&gt; '8659', 'hArr' =&gt; '8660', 'forall' =&gt; '8704', 'part' =&gt; '8706', 'exist' =&gt; '8707', &nbsp;</div></li><li><div>          'empty' =&gt; '8709', 'nabla' =&gt; '8711', 'isin' =&gt; '8712', 'notin' =&gt; '8713', 'ni' =&gt; '8715', 'prod' =&gt; '8719', 'sum' =&gt; '8721', &nbsp;</div></li><li><div>          'minus' =&gt; '8722', 'lowast' =&gt; '8727', 'radic' =&gt; '8730', 'prop' =&gt; '8733', 'infin' =&gt; '8734', 'ang' =&gt; '8736', 'and' =&gt; '8743', &nbsp;</div></li><li><div>          'or' =&gt; '8744', 'cap' =&gt; '8745', 'cup' =&gt; '8746', 'int' =&gt; '8747', 'there4' =&gt; '8756', 'sim' =&gt; '8764', 'cong' =&gt; '8773', &nbsp;</div></li><li><div>          'asymp' =&gt; '8776', 'ne' =&gt; '8800', 'equiv' =&gt; '8801', 'le' =&gt; '8804', 'ge' =&gt; '8805', 'sub' =&gt; '8834', 'sup' =&gt; '8835', 'nsub' =&gt; '8836', &nbsp;</div></li><li><div>          'sube' =&gt; '8838', 'supe' =&gt; '8839', 'oplus' =&gt; '8853', 'otimes' =&gt; '8855', 'perp' =&gt; '8869', 'sdot' =&gt; '8901', 'lceil' =&gt; '8968', &nbsp;</div></li><li><div>          'rceil' =&gt; '8969', 'lfloor' =&gt; '8970', 'rfloor' =&gt; '8971', 'lang' =&gt; '9001', 'rang' =&gt; '9002', 'loz' =&gt; '9674', 'spades' =&gt; '9824', &nbsp;</div></li><li><div>          'clubs' =&gt; '9827', 'hearts' =&gt; '9829', 'diams' =&gt; '9830', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      foreach ($entarr AS $key =&gt; $val) {&nbsp;</div></li><li><div>          $this-&gt;entsearch[] = '&' . $key . ';';&nbsp;</div></li><li><div>          $this-&gt;entsubstitute[] = code2utf($val);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SubstituteHiEntities($html)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// converts html_entities &gt; ASCII 127 to unicode</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Leaves in particular &lt; to distinguish from tag marker</span></span></span></span>&nbsp;</div></li><li><div>      if (count($this-&gt;entsearch)) {&nbsp;</div></li><li><div>          $html = str_replace($this-&gt;entsearch, $this-&gt;entsubstitute, $html);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $html;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Edited v1.2 Pass by reference; option to continue if invalid UTF-8 chars</span>&nbsp;</div></li><li><div>  function is_utf8(&$string)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($string === mb_convert_encoding(mb_convert_encoding($string, &quot;UTF-32&quot;, &quot;UTF-8&quot;), &quot;UTF-8&quot;, &quot;UTF-32&quot;)) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ($this-&gt;ignore_invalid_utf8) {&nbsp;</div></li><li><div>              $string = mb_convert_encoding(mb_convert_encoding($string, &quot;UTF-32&quot;, &quot;UTF-8&quot;), &quot;UTF-8&quot;, &quot;UTF-32&quot;);&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function purify_utf8($html, $lo = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// For HTML</span>&nbsp;</div></li><li><div>      <span class="comment">// Checks string is valid UTF-8 encoded</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// converts html_entities &gt; ASCII 127 to UTF-8</span></span>&nbsp;</div></li><li><div>      <span class="comment">// Only exception - leaves low ASCII entities e.g. &lt; &amp; etc.</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Leaves in particular &lt; to distinguish from tag marker</span></span></span></span>&nbsp;</div></li><li><div>      if (!$this-&gt;is_utf8($html)) {&nbsp;</div></li><li><div>          echo &quot;&lt;p&gt;&lt;b&gt;HTML contains invalid UTF-8 character(s)&lt;/b&gt;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>          while (mb_convert_encoding(mb_convert_encoding($html, &quot;UTF-32&quot;, &quot;UTF-8&quot;), &quot;UTF-8&quot;, &quot;UTF-32&quot;) != $html) {&nbsp;</div></li><li><div>              $a = iconv('UTF-8', 'UTF-8', $html);&nbsp;</div></li><li><div>              echo ($a);&nbsp;</div></li><li><div>              $pos = $start = strlen($a);&nbsp;</div></li><li><div>              $err = '';&nbsp;</div></li><li><div>              while (ord(substr($html, $pos, 1)) &gt; 128) {&nbsp;</div></li><li><div>                  $err .= '[[#' . ord(substr($html, $pos, 1)) . ']]';&nbsp;</div></li><li><div>                  $pos++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              echo '&lt;span style=&quot;color:red; font-weight:bold&quot;&gt;' . $err . '&lt;/span&gt;';&nbsp;</div></li><li><div>              $html = substr($html, $pos);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo $html;&nbsp;</div></li><li><div>          throw new MpdfException(&quot;&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $html = preg_replace(&quot;/\r/&quot;, &quot;&quot;, $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// converts html_entities &gt; ASCII 127 to UTF-8</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Leaves in particular &lt; to distinguish from tag marker</span></span></span></span>&nbsp;</div></li><li><div>      $html = $this-&gt;SubstituteHiEntities($html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// converts all &#nnn; or &#xHHH; to UTF-8 multibyte</span></span>&nbsp;</div></li><li><div>      <span class="comment">// If $lo==true then includes ASCII &lt; 128</span>&nbsp;</div></li><li><div>      $html = strcode2utf($html, $lo);&nbsp;</div></li><li><div>      return ($html);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function purify_utf8_text($txt)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// For TEXT</span>&nbsp;</div></li><li><div>      <span class="comment">// Make sure UTF-8 string of characters</span>&nbsp;</div></li><li><div>      if (!$this-&gt;is_utf8($txt)) {&nbsp;</div></li><li><div>          throw new MpdfException(&quot;Text contains invalid UTF-8 character(s)&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $txt = preg_replace(&quot;/\r/&quot;, &quot;&quot;, $txt);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return ($txt);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function all_entities_to_utf8($txt)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// converts txt_entities &gt; ASCII 127 to UTF-8</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Leaves in particular &lt; to distinguish from tag marker</span></span></span></span>&nbsp;</div></li><li><div>      $txt = $this-&gt;SubstituteHiEntities($txt);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// converts all &#nnn; or &#xHHH; to UTF-8 multibyte</span></span>&nbsp;</div></li><li><div>      $txt = strcode2utf($txt);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $txt = $this-&gt;lesser_entity_decode($txt);&nbsp;</div></li><li><div>      return ($txt);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ====================================================</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">/** -- BARCODES -- */</span></span>&nbsp;</div></li><li><div>  <span class="comment">// UPC/EAN barcode</span>&nbsp;</div></li><li><div>  <span class="comment">// EAN13, EAN8, UPCA, UPCE, ISBN, ISSN</span>&nbsp;</div></li><li><div>  <span class="comment">// Accepts 12 or 13 digits with or without - hyphens</span>&nbsp;</div></li><li><div>  function WriteBarcode($code, $showtext = 1, $x = '', $y = '', $size = 1, $border = 0, $paddingL = 1, $paddingR = 1, $paddingT = 2, $paddingB = 2, $height = 1, $bgcol = false, $col = false, $btype = 'ISBN', $supplement = '0', $supplement_code = '', $k = 1)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (empty($code)) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $codestr = $code;&nbsp;</div></li><li><div>      $code = preg_replace('/\-/', '', $code);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!class_exists('PDFBarcode', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/barcode.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;barcode = new PDFBarcode();&nbsp;</div></li><li><div>      if ($btype == 'ISSN' || $btype == 'ISBN') {&nbsp;</div></li><li><div>          $arrcode = $this-&gt;barcode-&gt;getBarcodeArray($code, 'EAN13');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $arrcode = $this-&gt;barcode-&gt;getBarcodeArray($code, $btype);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($arrcode === false) {&nbsp;</div></li><li><div>          throw new MpdfException('Error in barcode string: ' . $codestr);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ((($btype == 'EAN13' || $btype == 'ISBN' || $btype == 'ISSN') && strlen($code) == 12) || ($btype == 'UPCA' && strlen($code) == 11) || ($btype == 'UPCE' && strlen($code) == 11) || ($btype == 'EAN8' && strlen($code) == 7)) {&nbsp;</div></li><li><div>          $code .= $arrcode['checkdigit'];&nbsp;</div></li><li><div>          if (stristr($codestr, '-')) {&nbsp;</div></li><li><div>              $codestr .= '-' . $arrcode['checkdigit'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $codestr .= $arrcode['checkdigit'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($btype == 'ISBN') {&nbsp;</div></li><li><div>          $codestr = 'ISBN ' . $codestr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($btype == 'ISSN') {&nbsp;</div></li><li><div>          $codestr = 'ISSN ' . $codestr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (empty($x)) {&nbsp;</div></li><li><div>          $x = $this-&gt;x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($y)) {&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// set foreground color</span>&nbsp;</div></li><li><div>      $prevDrawColor = $this-&gt;DrawColor;&nbsp;</div></li><li><div>      $prevTextColor = $this-&gt;TextColor;&nbsp;</div></li><li><div>      $prevFillColor = $this-&gt;FillColor;&nbsp;</div></li><li><div>      $lw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>      $this-&gt;SetLineWidth(0.01);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $size /= $k; <span class="comment"><span class="comment">// in case resized in a table</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $xres = $arrcode['nom-X'] * $size;&nbsp;</div></li><li><div>      $llm = $arrcode['lightmL'] * $arrcode['nom-X'] * $size; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Light margin&nbsp;</div></li><li><div>      $rlm = $arrcode['lightmR'] * $arrcode['nom-X'] * $size; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Light margin&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bcw = ($arrcode[&quot;maxw&quot;] * $xres); <span class="comment"><span class="comment">// Barcode width = Should always be 31.35mm * $size</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $fbw = $bcw + $llm + $rlm; <span class="comment"><span class="comment"><span class="comment">// Full barcode width incl. light margins</span></span></span>&nbsp;</div></li><li><div>      $ow = $fbw + $paddingL + $paddingR; <span class="comment"><span class="comment">// Full overall width incl. user-defined padding</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $fbwi = $fbw - 2; <span class="comment"><span class="comment"><span class="comment">// Full barcode width incl. light margins</span></span></span> - 2mm - for isbn string&nbsp;</div></li><li><div>      <span class="comment">// cf. http://www.gs1uk.org/downloads/bar_code/Bar coding getting it right.pdf</span>&nbsp;</div></li><li><div>      $num_height = 3 * $size;     <span class="comment">// Height of numerals</span>&nbsp;</div></li><li><div>      $fbh = $arrcode['nom-H'] * $size * $height;  <span class="comment"><span class="comment">// Full barcode height</span> incl. numerals</span>&nbsp;</div></li><li><div>      $bch = $fbh - (1.5 * $size);     <span class="comment"><span class="comment">// Barcode height of bars     (3mm for numerals)</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (($btype == 'EAN13' && $showtext) || $btype == 'ISSN' || $btype == 'ISBN') { <span class="comment">// Add height for ISBN string + margin from top of bars</span>&nbsp;</div></li><li><div>          $tisbnm = 1.5 * $size; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Top</span></span></span></span></span> margin between isbn (if shown) & bars&nbsp;</div></li><li><div>          $codestr_fontsize = 2.1 * $size;&nbsp;</div></li><li><div>          $paddingT += $codestr_fontsize + $tisbnm;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $oh = $fbh + $paddingT + $paddingB;  <span class="comment">// Full overall height incl. user-defined padding</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// PRINT border background color</span></span>&nbsp;</div></li><li><div>      $xpos = $x;&nbsp;</div></li><li><div>      $ypos = $y;&nbsp;</div></li><li><div>      if ($col) {&nbsp;</div></li><li><div>          $this-&gt;SetDColor($col);&nbsp;</div></li><li><div>          $this-&gt;SetTColor($col);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($bgcol) {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($bgcol);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!$bgcol && !$col) { <span class="comment">// fn. called directly - not via HTML</span>&nbsp;</div></li><li><div>          if ($border) {&nbsp;</div></li><li><div>              $fillb = 'DF';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $fillb = 'F';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;Rect($xpos, $ypos, $ow, $oh, $fillb);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// PRINT BARS</span></span></span>&nbsp;</div></li><li><div>      $xpos = $x + $paddingL + $llm;&nbsp;</div></li><li><div>      $ypos = $y + $paddingT;&nbsp;</div></li><li><div>      if ($col) {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($col);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($arrcode !== false) {&nbsp;</div></li><li><div>          foreach ($arrcode[&quot;bcode&quot;] AS $v) {&nbsp;</div></li><li><div>              $bw = ($v[&quot;w&quot;] * $xres);&nbsp;</div></li><li><div>              if ($v[&quot;t&quot;]) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// draw a vertical bar</span></span>&nbsp;</div></li><li><div>                  $this-&gt;Rect($xpos, $ypos, $bw, $bch, 'F');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $xpos += $bw;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// print text</span>&nbsp;</div></li><li><div>      $prevFontFamily = $this-&gt;FontFamily;&nbsp;</div></li><li><div>      $prevFontStyle = $this-&gt;FontStyle;&nbsp;</div></li><li><div>      $prevFontSizePt = $this-&gt;FontSizePt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// ISBN string</span>&nbsp;</div></li><li><div>      if (($btype == 'EAN13' && $showtext) || $btype == 'ISBN' || $btype == 'ISSN') {&nbsp;</div></li><li><div>          if ($this-&gt;onlyCoreFonts) {&nbsp;</div></li><li><div>              $this-&gt;SetFont('chelvetica');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;SetFont('sans');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($bgcol) {&nbsp;</div></li><li><div>              $this-&gt;SetFColor($bgcol);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;x = $x + $paddingL + 1; <span class="comment">// 1mm left margin (cf. $fbwi above)</span>&nbsp;</div></li><li><div>          <span class="comment">// max width is $fbwi</span>&nbsp;</div></li><li><div>          $loop = 0;&nbsp;</div></li><li><div>          while ($loop == 0) {&nbsp;</div></li><li><div>              $this-&gt;SetFontSize($codestr_fontsize * 1.4 * _MPDFK, false); <span class="comment">// don't write</span>&nbsp;</div></li><li><div>              $sz = $this-&gt;GetStringWidth($codestr);&nbsp;</div></li><li><div>              if ($sz &gt; $fbwi)&nbsp;</div></li><li><div>                  $codestr_fontsize -= 0.1;&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $loop ++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;SetFont('', '', $codestr_fontsize * 1.4 * _MPDFK, true, true); <span class="comment">// * 1.4 because font height is only 7/10 of given mm</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ($fbwi &gt; $sz) {&nbsp;</div></li><li><div>              $xtra = $fbwi - $sz;&nbsp;</div></li><li><div>              $charspacing = $xtra / (strlen($codestr) - 1);&nbsp;</div></li><li><div>              if ($charspacing) {&nbsp;</div></li><li><div>                  $this-&gt;_out(sprintf('BT %.3F Tc ET', $charspacing * _MPDFK));&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;y = $y + $paddingT - ($codestr_fontsize ) - $tisbnm;&nbsp;</div></li><li><div>          $this-&gt;Cell($fbw, $codestr_fontsize, $codestr);&nbsp;</div></li><li><div>          if ($charspacing) {&nbsp;</div></li><li><div>              $this-&gt;_out('BT 0 Tc ET');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Bottom</span></span></span></span></span></span> NUMERALS&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>      if ($this-&gt;onlyCoreFonts) {&nbsp;</div></li><li><div>          $this-&gt;SetFont('ccourier');&nbsp;</div></li><li><div>          $fh = 1.3;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetFont('ocrb');&nbsp;</div></li><li><div>          $fh = 1.06;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $charRO = '';&nbsp;</div></li><li><div>      if ($btype == 'EAN13' || $btype == 'ISBN' || $btype == 'ISSN') {&nbsp;</div></li><li><div>          $outerfontsize = 3; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Inner fontsize = 3</span></span></span></span>&nbsp;</div></li><li><div>          $outerp = $xres * 4;&nbsp;</div></li><li><div>          $innerp = $xres * 2.5;&nbsp;</div></li><li><div>          $textw = ($bcw * 0.5) - $outerp - $innerp;&nbsp;</div></li><li><div>          $chars = 6; <span class="comment">// number of numerals in each half</span>&nbsp;</div></li><li><div>          $charLO = substr($code, 0, 1); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Outer&nbsp;</div></li><li><div>          $charLI = substr($code, 1, 6); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Inner&nbsp;</div></li><li><div>          $charRI = substr($code, 7, 6); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Inner&nbsp;</div></li><li><div>          if (!$supplement)&nbsp;</div></li><li><div>              $charRO = '&gt;'; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Outer&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ($btype == 'UPCA') {&nbsp;</div></li><li><div>          $outerfontsize = 2.3; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Inner fontsize = 3</span></span></span></span>&nbsp;</div></li><li><div>          $outerp = $xres * 10;&nbsp;</div></li><li><div>          $innerp = $xres * 2.5;&nbsp;</div></li><li><div>          $textw = ($bcw * 0.5) - $outerp - $innerp;&nbsp;</div></li><li><div>          $chars = 5;&nbsp;</div></li><li><div>          $charLO = substr($code, 0, 1); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Outer&nbsp;</div></li><li><div>          $charLI = substr($code, 1, 5); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Inner&nbsp;</div></li><li><div>          $charRI = substr($code, 6, 5); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Inner&nbsp;</div></li><li><div>          $charRO = substr($code, 11, 1); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Outer&nbsp;</div></li><li><div>      } elseif ($btype == 'UPCE') {&nbsp;</div></li><li><div>          $outerfontsize = 2.3; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Inner fontsize = 3</span></span></span></span>&nbsp;</div></li><li><div>          $outerp = $xres * 4;&nbsp;</div></li><li><div>          $innerp = 0;&nbsp;</div></li><li><div>          $textw = ($bcw * 0.5) - $outerp - $innerp;&nbsp;</div></li><li><div>          $chars = 3;&nbsp;</div></li><li><div>          $upce_code = $arrcode['code'];&nbsp;</div></li><li><div>          $charLO = substr($code, 0, 1); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Outer&nbsp;</div></li><li><div>          $charLI = substr($upce_code, 0, 3); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Inner&nbsp;</div></li><li><div>          $charRI = substr($upce_code, 3, 3); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Inner&nbsp;</div></li><li><div>          $charRO = substr($code, 11, 1); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Outer&nbsp;</div></li><li><div>      } elseif ($btype == 'EAN8') {&nbsp;</div></li><li><div>          $outerfontsize = 3; <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Inner fontsize = 3</span></span></span></span>&nbsp;</div></li><li><div>          $outerp = $xres * 4;&nbsp;</div></li><li><div>          $innerp = $xres * 2.5;&nbsp;</div></li><li><div>          $textw = ($bcw * 0.5) - $outerp - $innerp;&nbsp;</div></li><li><div>          $chars = 4;&nbsp;</div></li><li><div>          $charLO = '&lt;'; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Outer&nbsp;</div></li><li><div>          $charLI = substr($code, 0, 4); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Inner&nbsp;</div></li><li><div>          $charRI = substr($code, 4, 4); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Inner&nbsp;</div></li><li><div>          if (!$supplement)&nbsp;</div></li><li><div>              $charRO = '&gt;'; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Outer&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetFontSize(($outerfontsize / 3) * 3 * $fh * $size * _MPDFK); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// 3mm numerals (FontSize is larger to account for space above/below characters)</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          $cw = $this-&gt;_getCharWidth($this-&gt;CurrentFont['cw'], 32) * 3 * $fh * $size / 1000;&nbsp;</div></li><li><div>      } <span class="comment">// character width at 3mm</span>&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $cw = 600 * 3 * $fh * $size / 1000;&nbsp;</div></li><li><div>      } <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>      <span class="comment">// Outer left character</span>&nbsp;</div></li><li><div>      $y_text = $y + $paddingT + $bch - ($num_height / 2);&nbsp;</div></li><li><div>      $y_text_outer = $y + $paddingT + $bch - ($num_height * ($outerfontsize / 3) / 2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;x = $x + $paddingL - ($cw * ($outerfontsize / 3) * 0.1); <span class="comment">// 0.1 is correction as char does not fill full width;</span>&nbsp;</div></li><li><div>      $this-&gt;y = $y_text_outer;&nbsp;</div></li><li><div>      $this-&gt;Cell($cw, $num_height, $charLO);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// WORD SPACING</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> for inner chars&nbsp;</div></li><li><div>      $xtra = $textw - ($cw * $chars);&nbsp;</div></li><li><div>      $charspacing = $xtra / ($chars - 1);&nbsp;</div></li><li><div>      if ($charspacing) {&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('BT %.3F Tc ET', $charspacing * _MPDFK));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($bgcol) {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($bgcol);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;SetFontSize(3 * $fh * $size * _MPDFK); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// 3mm numerals (FontSize is larger to account for space above/below characters)</span></span></span></span></span>&nbsp;</div></li><li><div>      <span class="comment">// Inner left half characters</span>&nbsp;</div></li><li><div>      $this-&gt;x = $x + $paddingL + $llm + $outerp;&nbsp;</div></li><li><div>      $this-&gt;y = $y_text;&nbsp;</div></li><li><div>      $this-&gt;Cell($textw, $num_height, $charLI, 0, 0, '', 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Inner right half characters</span>&nbsp;</div></li><li><div>      $this-&gt;x = $x + $paddingL + $llm + ($bcw * 0.5) + $innerp;&nbsp;</div></li><li><div>      $this-&gt;y = $y_text;&nbsp;</div></li><li><div>      $this-&gt;Cell($textw, $num_height, $charRI, 0, 0, '', 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($charspacing) {&nbsp;</div></li><li><div>          $this-&gt;_out('BT 0 Tc ET');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Outer Right character</span>&nbsp;</div></li><li><div>      $this-&gt;SetFontSize(($outerfontsize / 3) * 3 * $fh * $size * _MPDFK); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// 3mm numerals (FontSize is larger to account for space above/below characters)</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;x = $x + $paddingL + $llm + $bcw + $rlm - ($cw * ($outerfontsize / 3) * 0.9); <span class="comment"><span class="comment">// 0.9 is correction as char does not fill full width</span></span>&nbsp;</div></li><li><div>      $this-&gt;y = $y_text_outer;&nbsp;</div></li><li><div>      $this-&gt;Cell($cw * ($outerfontsize / 3), $num_height, $charRO, 0, 0, 'R');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($supplement) { <span class="comment">// EAN-2 or -5 Supplement</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// PRINT BARS</span></span></span>&nbsp;</div></li><li><div>          $supparrcode = $this-&gt;barcode-&gt;getBarcodeArray($supplement_code, 'EAN' . $supplement);&nbsp;</div></li><li><div>          if ($supparrcode === false) {&nbsp;</div></li><li><div>              throw new MpdfException('Error in barcode string (supplement): ' . $codestr . ' ' . $supplement_code);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (strlen($supplement_code) != $supplement) {&nbsp;</div></li><li><div>              throw new MpdfException('Barcode supplement incorrect: ' . $supplement_code);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $llm = $fbw - (($arrcode['lightmR'] - $supparrcode['sepM']) * $arrcode['nom-X'] * $size); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Light margin&nbsp;</div></li><li><div>          $rlm = $arrcode['lightmR'] * $arrcode['nom-X'] * $size; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Light margin&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $bcw = ($supparrcode[&quot;maxw&quot;] * $xres); <span class="comment"><span class="comment">// Barcode width = Should always be 31.35mm * $size</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $fbw = $bcw + $llm + $rlm; <span class="comment"><span class="comment"><span class="comment">// Full barcode width incl. light margins</span></span></span>&nbsp;</div></li><li><div>          $ow = $fbw + $paddingL + $paddingR; <span class="comment"><span class="comment">// Full overall width incl. user-defined padding</span></span>&nbsp;</div></li><li><div>          $bch = $fbh - (1.5 * $size) - ($num_height + 0.5);  <span class="comment"><span class="comment">// Barcode height of bars     (3mm for numerals)</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $xpos = $x + $paddingL + $llm;&nbsp;</div></li><li><div>          $ypos = $y + $paddingT + $num_height + 0.5;&nbsp;</div></li><li><div>          if ($col) {&nbsp;</div></li><li><div>              $this-&gt;SetFColor($col);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;SetFColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($supparrcode !== false) {&nbsp;</div></li><li><div>              foreach ($supparrcode[&quot;bcode&quot;] AS $v) {&nbsp;</div></li><li><div>                  $bw = ($v[&quot;w&quot;] * $xres);&nbsp;</div></li><li><div>                  if ($v[&quot;t&quot;]) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// draw a vertical bar</span></span>&nbsp;</div></li><li><div>                      $this-&gt;Rect($xpos, $ypos, $bw, $bch, 'F');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $xpos += $bw;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Characters</span>&nbsp;</div></li><li><div>          if ($bgcol) {&nbsp;</div></li><li><div>              $this-&gt;SetFColor($bgcol);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;SetFontSize(3 * $fh * $size * _MPDFK); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// 3mm numerals (FontSize is larger to account for space above/below characters)</span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;x = $x + $paddingL + $llm;&nbsp;</div></li><li><div>          $this-&gt;y = $y + $paddingT;&nbsp;</div></li><li><div>          $this-&gt;Cell($bcw, $num_height, $supplement_code, 0, 0, 'C');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Outer Right character</span> (light margin)&nbsp;</div></li><li><div>          $this-&gt;SetFontSize(($outerfontsize / 3) * 3 * $fh * $size * _MPDFK); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// 3mm numerals (FontSize is larger to account for space above/below characters)</span></span></span></span></span>&nbsp;</div></li><li><div>          $this-&gt;x = $x + $paddingL + $llm + $bcw + $rlm - ($cw * 0.9); <span class="comment"><span class="comment">// 0.9 is correction as char does not fill full width</span></span>&nbsp;</div></li><li><div>          $this-&gt;y = $y + $paddingT;&nbsp;</div></li><li><div>          $this-&gt;Cell($cw * ($outerfontsize / 3), $num_height, '&gt;', 0, 0, 'R');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Restore</span> **************&nbsp;</div></li><li><div>      $this-&gt;SetFont($prevFontFamily, $prevFontStyle, $prevFontSizePt);&nbsp;</div></li><li><div>      $this-&gt;DrawColor = $prevDrawColor;&nbsp;</div></li><li><div>      $this-&gt;TextColor = $prevTextColor;&nbsp;</div></li><li><div>      $this-&gt;FillColor = $prevFillColor;&nbsp;</div></li><li><div>      $this-&gt;SetLineWidth($lw);&nbsp;</div></li><li><div>      $this-&gt;SetY($y);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ====================================================</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment">// POSTAL and OTHER barcodes</span>&nbsp;</div></li><li><div>  function WriteBarcode2($code, $x = '', $y = '', $size = 1, $height = 1, $bgcol = false, $col = false, $btype = 'IMB', $print_ratio = '', $k = 1)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (empty($code)) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!class_exists('PDFBarcode', false)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'classes/barcode.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;barcode = new PDFBarcode();&nbsp;</div></li><li><div>      $arrcode = $this-&gt;barcode-&gt;getBarcodeArray($code, $btype, $print_ratio);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($arrcode === false) {&nbsp;</div></li><li><div>          throw new MpdfException('Error in barcode string: ' . $code);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($x)) {&nbsp;</div></li><li><div>          $x = $this-&gt;x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (empty($y)) {&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $prevDrawColor = $this-&gt;DrawColor;&nbsp;</div></li><li><div>      $prevTextColor = $this-&gt;TextColor;&nbsp;</div></li><li><div>      $prevFillColor = $this-&gt;FillColor;&nbsp;</div></li><li><div>      $lw = $this-&gt;LineWidth;&nbsp;</div></li><li><div>      $this-&gt;SetLineWidth(0.01);&nbsp;</div></li><li><div>      $size /= $k; <span class="comment"><span class="comment">// in case resized in a table</span></span>&nbsp;</div></li><li><div>      $xres = $arrcode['nom-X'] * $size;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($btype == 'IMB' || $btype == 'RM4SCC' || $btype == 'KIX' || $btype == 'POSTNET' || $btype == 'PLANET') {&nbsp;</div></li><li><div>          $llm = $arrcode['quietL'] / $k; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Quiet margin&nbsp;</div></li><li><div>          $rlm = $arrcode['quietR'] / $k; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Quiet margin&nbsp;</div></li><li><div>          $tlm = $blm = $arrcode['quietTB'] / $k;&nbsp;</div></li><li><div>          $height = 1;  <span class="comment">// Overrides</span>&nbsp;</div></li><li><div>      } elseif (in_array($btype, array('C128A', 'C128B', 'C128C', 'EAN128A', 'EAN128B', 'EAN128C', 'C39', 'C39+', 'C39E', 'C39E+', 'S25', 'S25+', 'I25', 'I25+', 'I25B', 'I25B+', 'C93', 'MSI', 'MSI+', 'CODABAR', 'CODE11'))) {&nbsp;</div></li><li><div>          $llm = $arrcode['lightmL'] * $xres; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Left</span></span></span></span></span> Quiet margin&nbsp;</div></li><li><div>          $rlm = $arrcode['lightmR'] * $xres; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Right</span></span></span></span></span> Quiet margin&nbsp;</div></li><li><div>          $tlm = $blm = $arrcode['lightTB'] * $xres * $height;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bcw = ($arrcode[&quot;maxw&quot;] * $xres);&nbsp;</div></li><li><div>      $fbw = $bcw + $llm + $rlm;  <span class="comment"><span class="comment"><span class="comment">// Full barcode width incl. light margins</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bch = ($arrcode[&quot;nom-H&quot;] * $size * $height);&nbsp;</div></li><li><div>      $fbh = $bch + $tlm + $blm;  <span class="comment">// Full barcode height</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// PRINT border background color</span></span>&nbsp;</div></li><li><div>      $xpos = $x;&nbsp;</div></li><li><div>      $ypos = $y;&nbsp;</div></li><li><div>      if ($col) {&nbsp;</div></li><li><div>          $this-&gt;SetDColor($col);&nbsp;</div></li><li><div>          $this-&gt;SetTColor($col);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>          $this-&gt;SetTColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($bgcol) {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($bgcol);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($this-&gt;ConvertColor(255));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// PRINT BARS</span></span></span>&nbsp;</div></li><li><div>      if ($col) {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($col);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;SetFColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $xpos = $x + $llm;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($arrcode !== false) {&nbsp;</div></li><li><div>          foreach ($arrcode[&quot;bcode&quot;] AS $v) {&nbsp;</div></li><li><div>              $bw = ($v[&quot;w&quot;] * $xres);&nbsp;</div></li><li><div>              if ($v[&quot;t&quot;]) {&nbsp;</div></li><li><div>                  $ypos = $y + $tlm + ($bch * $v['p'] / $arrcode['maxh']);&nbsp;</div></li><li><div>                  $this-&gt;Rect($xpos, $ypos, $bw, ($v['h'] * $bch / $arrcode['maxh']), 'F');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $xpos += $bw;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// PRINT BEARER BARS</span>&nbsp;</div></li><li><div>      if ($btype == 'I25B' || $btype == 'I25B+') {&nbsp;</div></li><li><div>          $this-&gt;Rect($x, $y, $fbw, ($arrcode['lightTB'] * $xres * $height), 'F');&nbsp;</div></li><li><div>          $this-&gt;Rect($x, $y + $tlm + $bch, $fbw, ($arrcode['lightTB'] * $xres * $height), 'F');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Restore</span> **************&nbsp;</div></li><li><div>      $this-&gt;DrawColor = $prevDrawColor;&nbsp;</div></li><li><div>      $this-&gt;TextColor = $prevTextColor;&nbsp;</div></li><li><div>      $this-&gt;FillColor = $prevFillColor;&nbsp;</div></li><li><div>      $this-&gt;SetLineWidth($lw);&nbsp;</div></li><li><div>      $this-&gt;SetY($y);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">/** -- END BARCODES -- */</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ====================================================</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// ====================================================</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function StartTransform($returnstring = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($returnstring) {&nbsp;</div></li><li><div>          return('q');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_out('q');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function StopTransform($returnstring = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($returnstring) {&nbsp;</div></li><li><div>          return('Q');&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_out('Q');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function transformScale($s_x, $s_y, $x = '', $y = '', $returnstring = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($x === '') {&nbsp;</div></li><li><div>          $x = $this-&gt;x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($y === '') {&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (($s_x == 0) OR ( $s_y == 0)) {&nbsp;</div></li><li><div>          throw new MpdfException('Please do not use values equal to zero for scaling');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $y = ($this-&gt;h - $y) * _MPDFK;&nbsp;</div></li><li><div>      $x *= _MPDFK;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//calculate elements of transformation matrix</span></span></span></span>&nbsp;</div></li><li><div>      $s_x /= 100;&nbsp;</div></li><li><div>      $s_y /= 100;&nbsp;</div></li><li><div>      $tm = array();&nbsp;</div></li><li><div>      $tm[0] = $s_x;&nbsp;</div></li><li><div>      $tm[1] = 0;&nbsp;</div></li><li><div>      $tm[2] = 0;&nbsp;</div></li><li><div>      $tm[3] = $s_y;&nbsp;</div></li><li><div>      $tm[4] = $x * (1 - $s_x);&nbsp;</div></li><li><div>      $tm[5] = $y * (1 - $s_y);&nbsp;</div></li><li><div>      <span class="comment">//scale the coordinate system</span>&nbsp;</div></li><li><div>      if ($returnstring) {&nbsp;</div></li><li><div>          return($this-&gt;_transform($tm, true));&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_transform($tm);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function transformTranslate($t_x, $t_y, $returnstring = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//calculate elements of transformation matrix</span></span></span></span>&nbsp;</div></li><li><div>      $tm = array();&nbsp;</div></li><li><div>      $tm[0] = 1;&nbsp;</div></li><li><div>      $tm[1] = 0;&nbsp;</div></li><li><div>      $tm[2] = 0;&nbsp;</div></li><li><div>      $tm[3] = 1;&nbsp;</div></li><li><div>      $tm[4] = $t_x * _MPDFK;&nbsp;</div></li><li><div>      $tm[5] = -$t_y * _MPDFK;&nbsp;</div></li><li><div>      <span class="comment">//translate the coordinate system</span>&nbsp;</div></li><li><div>      if ($returnstring) {&nbsp;</div></li><li><div>          return($this-&gt;_transform($tm, true));&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_transform($tm);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function transformRotate($angle, $x = '', $y = '', $returnstring = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($x === '') {&nbsp;</div></li><li><div>          $x = $this-&gt;x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($y === '') {&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $angle = -$angle;&nbsp;</div></li><li><div>      $y = ($this-&gt;h - $y) * _MPDFK;&nbsp;</div></li><li><div>      $x *= _MPDFK;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//calculate elements of transformation matrix</span></span></span></span>&nbsp;</div></li><li><div>      $tm = array();&nbsp;</div></li><li><div>      $tm[0] = cos(deg2rad($angle));&nbsp;</div></li><li><div>      $tm[1] = sin(deg2rad($angle));&nbsp;</div></li><li><div>      $tm[2] = -$tm[1];&nbsp;</div></li><li><div>      $tm[3] = $tm[0];&nbsp;</div></li><li><div>      $tm[4] = $x + $tm[1] * $y - $tm[0] * $x;&nbsp;</div></li><li><div>      $tm[5] = $y - $tm[0] * $y - $tm[1] * $x;&nbsp;</div></li><li><div>      <span class="comment">//rotate the coordinate system around ($x, $y)</span>&nbsp;</div></li><li><div>      if ($returnstring) {&nbsp;</div></li><li><div>          return($this-&gt;_transform($tm, true));&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_transform($tm);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>  function transformSkew($angle_x, $angle_y, $x = '', $y = '', $returnstring = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($x === '') {&nbsp;</div></li><li><div>          $x = $this-&gt;x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($y === '') {&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $angle_x = -$angle_x;&nbsp;</div></li><li><div>      $angle_y = -$angle_y;&nbsp;</div></li><li><div>      $x *= _MPDFK;&nbsp;</div></li><li><div>      $y = ($this-&gt;h - $y) * _MPDFK;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">//calculate elements of transformation matrix</span></span></span></span>&nbsp;</div></li><li><div>      $tm = array();&nbsp;</div></li><li><div>      $tm[0] = 1;&nbsp;</div></li><li><div>      $tm[1] = tan(deg2rad($angle_y));&nbsp;</div></li><li><div>      $tm[2] = tan(deg2rad($angle_x));&nbsp;</div></li><li><div>      $tm[3] = 1;&nbsp;</div></li><li><div>      $tm[4] = -$tm[2] * $y;&nbsp;</div></li><li><div>      $tm[5] = -$tm[1] * $x;&nbsp;</div></li><li><div>      <span class="comment">//skew the coordinate system</span>&nbsp;</div></li><li><div>      if ($returnstring) {&nbsp;</div></li><li><div>          return($this-&gt;_transform($tm, true));&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_transform($tm);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _transform($tm, $returnstring = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($returnstring) {&nbsp;</div></li><li><div>          return(sprintf('%.4F %.4F %.4F %.4F %.4F %.4F cm', $tm[0], $tm[1], $tm[2], $tm[3], $tm[4], $tm[5]));&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;_out(sprintf('%.4F %.4F %.4F %.4F %.4F %.4F cm', $tm[0], $tm[1], $tm[2], $tm[3], $tm[4], $tm[5]));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// AUTOFONT =========================</span>&nbsp;</div></li><li><div>  function markScriptToLang($html)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($this-&gt;onlyCoreFonts) {&nbsp;</div></li><li><div>          return $html;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// sets $this-&gt;script2lang</span>&nbsp;</div></li><li><div>      if (empty($this-&gt;script2lang)) {&nbsp;</div></li><li><div>          include(_MPDF_PATH . 'config_script2lang.php');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $n = '';&nbsp;</div></li><li><div>      $a = preg_split('/&lt;(.*?)&gt;/ms', $html, -1, PREG_SPLIT_DELIM_CAPTURE);&nbsp;</div></li><li><div>      foreach ($a as $i =&gt; $e) {&nbsp;</div></li><li><div>          if ($i % 2 == 0) {&nbsp;</div></li><li><div>              <span class="comment">//ignore</span> if in Textarea&nbsp;</div></li><li><div>              if ($i &gt; 0 && strtolower(substr($a[$i - 1], 1, 8)) == 'textarea') {&nbsp;</div></li><li><div>                  $a[$i] = $e;&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $e = strcode2utf($e);&nbsp;</div></li><li><div>              $e = $this-&gt;lesser_entity_decode($e);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $earr = $this-&gt;UTF8StringToArray($e, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $scriptblock = 0;&nbsp;</div></li><li><div>              $scriptblocks = array();&nbsp;</div></li><li><div>              $scriptblocks[0] = 0;&nbsp;</div></li><li><div>              $chardata = array();&nbsp;</div></li><li><div>              $subchunk = 0;&nbsp;</div></li><li><div>              $charctr = 0;&nbsp;</div></li><li><div>              foreach ($earr as $char) {&nbsp;</div></li><li><div>                  $ucd_record = UCDN::get_ucd_record($char);&nbsp;</div></li><li><div>                  $sbl = $ucd_record[6];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ($sbl && $sbl != 40 && $sbl != 102) {&nbsp;</div></li><li><div>                      if ($scriptblock == 0) {&nbsp;</div></li><li><div>                          $scriptblock = $sbl;&nbsp;</div></li><li><div>                          $scriptblocks[$subchunk] = $scriptblock;&nbsp;</div></li><li><div>                      } elseif ($scriptblock &gt; 0 && $scriptblock != $sbl) {&nbsp;</div></li><li><div>                          <span class="comment">// NEW (non-common) Script encountered in this chunk.</span>&nbsp;</div></li><li><div>                          <span class="comment">// Start a new subchunk</span>&nbsp;</div></li><li><div>                          $subchunk++;&nbsp;</div></li><li><div>                          $scriptblock = $sbl;&nbsp;</div></li><li><div>                          $charctr = 0;&nbsp;</div></li><li><div>                          $scriptblocks[$subchunk] = $scriptblock;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $chardata[$subchunk][$charctr]['script'] = $sbl;&nbsp;</div></li><li><div>                  $chardata[$subchunk][$charctr]['uni'] = $char;&nbsp;</div></li><li><div>                  $charctr++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// If scriptblock[x] = common & non-baseScript</span>&nbsp;</div></li><li><div>              <span class="comment">// and scriptblock[x+1] = baseScript</span>&nbsp;</div></li><li><div>              <span class="comment">// Move common script from end of x to start of x+1</span>&nbsp;</div></li><li><div>              for ($sch = 0; $sch &lt; $subchunk; $sch++) {&nbsp;</div></li><li><div>                  if ($scriptblocks[$sch] &gt; 0 && $scriptblocks[$sch] != $this-&gt;baseScript && $scriptblocks[$sch + 1] == $this-&gt;baseScript) {&nbsp;</div></li><li><div>                      $end = count($chardata[$sch]) - 1;&nbsp;</div></li><li><div>                      while ($chardata[$sch][$end]['script'] == 0 && $end &gt; 1) { <span class="comment">// common script</span>&nbsp;</div></li><li><div>                          $tmp = array_pop($chardata[$sch]);&nbsp;</div></li><li><div>                          array_unshift($chardata[$sch + 1], $tmp);&nbsp;</div></li><li><div>                          $end--;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $o = '';&nbsp;</div></li><li><div>              for ($sch = 0; $sch &lt;= $subchunk; $sch++) {&nbsp;</div></li><li><div>                  if (isset($chardata[$sch])) {&nbsp;</div></li><li><div>                      $s = '';&nbsp;</div></li><li><div>                      for ($j = 0; $j &lt; count($chardata[$sch]); $j++) {&nbsp;</div></li><li><div>                          $s.=code2utf($chardata[$sch][$j]['uni']);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment">// ZZZ99 Undo lesser_entity_decode as above - but only for &lt;&gt;&</span>&nbsp;</div></li><li><div>                      $s = str_replace(&quot;&&quot;, &quot;&amp;&quot;, $s);&nbsp;</div></li><li><div>                      $s = str_replace(&quot;&lt;&quot;, &quot;&lt;&quot;, $s);&nbsp;</div></li><li><div>                      $s = str_replace(&quot;&gt;&quot;, &quot;&gt;&quot;, $s);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Check Vietnamese if Latin script - even if Basescript</span>&nbsp;</div></li><li><div>                      if ($scriptblocks[$sch] == UCDN::SCRIPT_LATIN && $this-&gt;autoVietnamese && preg_match(&quot;/([&quot; . $this-&gt;viet . &quot;])/u&quot;, $s)) {&nbsp;</div></li><li><div>                          $o .= '&lt;span lang=&quot;vi&quot; class=&quot;lang_vi&quot;&gt;' . $s . '&lt;/span&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment">// Check Arabic for different languages if Arabic script - even if Basescript</span>&nbsp;</div></li><li><div>                      elseif ($scriptblocks[$sch] == UCDN::SCRIPT_ARABIC && $this-&gt;autoArabic) {&nbsp;</div></li><li><div>                          if (preg_match(&quot;/[&quot; . $this-&gt;sindhi . &quot;]/u&quot;, $s)) {&nbsp;</div></li><li><div>                              $o .= '&lt;span lang=&quot;sd&quot; class=&quot;lang_sd&quot;&gt;' . $s . '&lt;/span&gt;';&nbsp;</div></li><li><div>                          } elseif (preg_match(&quot;/[&quot; . $this-&gt;urdu . &quot;]/u&quot;, $s)) {&nbsp;</div></li><li><div>                              $o .= '&lt;span lang=&quot;ur&quot; class=&quot;lang_ur&quot;&gt;' . $s . '&lt;/span&gt;';&nbsp;</div></li><li><div>                          } elseif (preg_match(&quot;/[&quot; . $this-&gt;pashto . &quot;]/u&quot;, $s)) {&nbsp;</div></li><li><div>                              $o .= '&lt;span lang=&quot;ps&quot; class=&quot;lang_ps&quot;&gt;' . $s . '&lt;/span&gt;';&nbsp;</div></li><li><div>                          } elseif (preg_match(&quot;/[&quot; . $this-&gt;persian . &quot;]/u&quot;, $s)) {&nbsp;</div></li><li><div>                              $o .= '&lt;span lang=&quot;fa&quot; class=&quot;lang_fa&quot;&gt;' . $s . '&lt;/span&gt;';&nbsp;</div></li><li><div>                          } elseif ($this-&gt;baseScript != UCDN::SCRIPT_ARABIC && isset($this-&gt;script2lang[$scriptblocks[$sch]])) {&nbsp;</div></li><li><div>                              $o .= '&lt;span lang=&quot;' . $this-&gt;script2lang[$scriptblocks[$sch]] . '&quot; class=&quot;lang_' . $this-&gt;script2lang[$scriptblocks[$sch]] . '&quot;&gt;' . $s . '&lt;/span&gt;';&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment">// Just output chars</span></span>&nbsp;</div></li><li><div>                              $o .= $s;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment">// Identify Script block if not Basescript, and mark up as language</span>&nbsp;</div></li><li><div>                      elseif ($scriptblocks[$sch] &gt; 0 && $scriptblocks[$sch] != $this-&gt;baseScript && isset($this-&gt;script2lang[$scriptblocks[$sch]])) {&nbsp;</div></li><li><div>                          <span class="comment">// Encase in &lt;span&gt;</span>&nbsp;</div></li><li><div>                          $o .= '&lt;span lang=&quot;' . $this-&gt;script2lang[$scriptblocks[$sch]] . '&quot; class=&quot;lang_' . $this-&gt;script2lang[$scriptblocks[$sch]] . '&quot;&gt;';&nbsp;</div></li><li><div>                          $o .= $s;&nbsp;</div></li><li><div>                          $o .= '&lt;/span&gt;';&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// Just output chars</span></span>&nbsp;</div></li><li><div>                          $o .= $s;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $a[$i] = $o;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $a[$i] = '&lt;' . $e . '&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $n = implode('', $a);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $n;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//===========================</span></span>&nbsp;</div></li><li><div>  <span class="comment">// Functions</span>&nbsp;</div></li><li><div>  <span class="comment">// Call-back function Used for usort in fn _tableWrite</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _cmpdom($a, $b)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return ($a[&quot;dom&quot;] &lt; $b[&quot;dom&quot;]) ? -1 : 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function mb_strrev($str, $enc = 'utf-8')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $ch = array();&nbsp;</div></li><li><div>      $ch = preg_split('<span class="comment">//u', $str);</span>&nbsp;</div></li><li><div>      $revch = array_reverse($ch);&nbsp;</div></li><li><div>      return implode('', $revch);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Callback function from function printcolumnbuffer in mpdf</span>&nbsp;</div></li><li><div>  function columnAdjustAdd($type, $k, $xadj, $yadj, $a, $b, $c = 0, $d = 0, $e = 0, $f = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($type == 'Td') {  <span class="comment"><span class="comment">// xpos, ypos</span></span>&nbsp;</div></li><li><div>          $a += ($xadj * $k);&nbsp;</div></li><li><div>          $b -= ($yadj * $k);&nbsp;</div></li><li><div>          return 'BT ' . sprintf('%.3F %.3F', $a, $b) . ' Td';&nbsp;</div></li><li><div>      } elseif ($type == 're') {  <span class="comment"><span class="comment">// xpos, ypos</span></span>, width, height&nbsp;</div></li><li><div>          $a += ($xadj * $k);&nbsp;</div></li><li><div>          $b -= ($yadj * $k);&nbsp;</div></li><li><div>          return sprintf('%.3F %.3F %.3F %.3F', $a, $b, $c, $d) . ' re';&nbsp;</div></li><li><div>      } elseif ($type == 'l') {  <span class="comment"><span class="comment">// xpos, ypos</span></span>, x2pos, y2pos&nbsp;</div></li><li><div>          $a += ($xadj * $k);&nbsp;</div></li><li><div>          $b -= ($yadj * $k);&nbsp;</div></li><li><div>          return sprintf('%.3F %.3F l', $a, $b);&nbsp;</div></li><li><div>      } elseif ($type == 'img') {  <span class="comment">// width</span>, height, xpos, ypos&nbsp;</div></li><li><div>          $c += ($xadj * $k);&nbsp;</div></li><li><div>          $d -= ($yadj * $k);&nbsp;</div></li><li><div>          return sprintf('q %.3F 0 0 %.3F %.3F %.3F', $a, $b, $c, $d) . ' cm /' . $e;&nbsp;</div></li><li><div>      } elseif ($type == 'draw') {  <span class="comment"><span class="comment">// xpos, ypos</span></span>&nbsp;</div></li><li><div>          $a += ($xadj * $k);&nbsp;</div></li><li><div>          $b -= ($yadj * $k);&nbsp;</div></li><li><div>          return sprintf('%.3F %.3F m', $a, $b);&nbsp;</div></li><li><div>      } elseif ($type == 'bezier') {  <span class="comment"><span class="comment">// xpos, ypos</span></span>, x2pos, y2pos, x3pos, y3pos&nbsp;</div></li><li><div>          $a += ($xadj * $k);&nbsp;</div></li><li><div>          $b -= ($yadj * $k);&nbsp;</div></li><li><div>          $c += ($xadj * $k);&nbsp;</div></li><li><div>          $d -= ($yadj * $k);&nbsp;</div></li><li><div>          $e += ($xadj * $k);&nbsp;</div></li><li><div>          $f -= ($yadj * $k);&nbsp;</div></li><li><div>          return sprintf('%.3F %.3F %.3F %.3F %.3F %.3F', $a, $b, $c, $d, $e, $f) . ' c';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END COLUMNS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function ConvertColor($color = &quot;#000000&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      static $cache;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $color = trim(strtolower($color));&nbsp;</div></li><li><div>      $c = false;&nbsp;</div></li><li><div>      $cstr = '';&nbsp;</div></li><li><div>      if ($color == 'transparent') {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      } elseif ($color == 'inherit') {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      } elseif (isset($this-&gt;SVGcolors[$color]))&nbsp;</div></li><li><div>          $color = $this-&gt;SVGcolors[$color];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!isset($cache[$color])) {&nbsp;</div></li><li><div>          if (preg_match('/^[\d]+$/', $color)) {&nbsp;</div></li><li><div>              $c = (array(1, $color));&nbsp;</div></li><li><div>          } <span class="comment">// i.e. integer only</span>&nbsp;</div></li><li><div>          elseif ($color[0] == '#') { <span class="comment">//case of #nnnnnn or #nnn</span>&nbsp;</div></li><li><div>              $cor = preg_replace('/\s+.*/', '', $color); <span class="comment">// in case of Background: #CCC url() x-repeat etc.</span>&nbsp;</div></li><li><div>              if (strlen($cor) == 4) { <span class="comment">// Turn #RGB into #RRGGBB</span>&nbsp;</div></li><li><div>                  $cor = &quot;#&quot; . $cor[1] . $cor[1] . $cor[2] . $cor[2] . $cor[3] . $cor[3];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $r = hexdec(substr($cor, 1, 2));&nbsp;</div></li><li><div>              $g = hexdec(substr($cor, 3, 2));&nbsp;</div></li><li><div>              $b = hexdec(substr($cor, 5, 2));&nbsp;</div></li><li><div>              $c = array(3, $r, $g, $b);&nbsp;</div></li><li><div>          } elseif (preg_match('/(rgba|rgb|device-cmyka|cmyka|device-cmyk|cmyk|hsla|hsl|spot)\((.*?)\)/', $color, $m)) {&nbsp;</div></li><li><div>              $type = $m[1];&nbsp;</div></li><li><div>              $cores = explode(&quot;, &quot;, $m[2]);&nbsp;</div></li><li><div>              $ncores = count($cores);&nbsp;</div></li><li><div>              if (stristr($cores[0], '%')) {&nbsp;</div></li><li><div>                  $cores[0] += 0;&nbsp;</div></li><li><div>                  if ($type == 'rgb' || $type == 'rgba') {&nbsp;</div></li><li><div>                      $cores[0] = intval($cores[0] * 255 / 100);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($ncores &gt; 1 && stristr($cores[1], '%')) {&nbsp;</div></li><li><div>                  $cores[1] += 0;&nbsp;</div></li><li><div>                  if ($type == 'rgb' || $type == 'rgba') {&nbsp;</div></li><li><div>                      $cores[1] = intval($cores[1] * 255 / 100);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($type == 'hsl' || $type == 'hsla') {&nbsp;</div></li><li><div>                      $cores[1] = $cores[1] / 100;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($ncores &gt; 2 && stristr($cores[2], '%')) {&nbsp;</div></li><li><div>                  $cores[2] += 0;&nbsp;</div></li><li><div>                  if ($type == 'rgb' || $type == 'rgba') {&nbsp;</div></li><li><div>                      $cores[2] = intval($cores[2] * 255 / 100);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($type == 'hsl' || $type == 'hsla') {&nbsp;</div></li><li><div>                      $cores[2] = $cores[2] / 100;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ($ncores &gt; 3 && stristr($cores[3], '%')) {&nbsp;</div></li><li><div>                  $cores[3] += 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ($type == 'rgb') {&nbsp;</div></li><li><div>                  $c = array(3, $cores[0], $cores[1], $cores[2]);&nbsp;</div></li><li><div>              } elseif ($type == 'rgba') {&nbsp;</div></li><li><div>                  $c = array(5, $cores[0], $cores[1], $cores[2], $cores[3] * 100);&nbsp;</div></li><li><div>              } elseif ($type == 'cmyk' || $type == 'device-cmyk') {&nbsp;</div></li><li><div>                  $c = array(4, $cores[0], $cores[1], $cores[2], $cores[3]);&nbsp;</div></li><li><div>              } elseif ($type == 'cmyka' || $type == 'device-cmyka') {&nbsp;</div></li><li><div>                  $c = array(6, $cores[0], $cores[1], $cores[2], $cores[3], $cores[4] * 100);&nbsp;</div></li><li><div>              } elseif ($type == 'hsl' || $type == 'hsla') {&nbsp;</div></li><li><div>                  $conv = $this-&gt;hsl2rgb($cores[0] / 360, $cores[1], $cores[2]);&nbsp;</div></li><li><div>                  if ($type == 'hsl') {&nbsp;</div></li><li><div>                      $c = array(3, $conv[0], $conv[1], $conv[2]);&nbsp;</div></li><li><div>                  } elseif ($type == 'hsla') {&nbsp;</div></li><li><div>                      $c = array(5, $conv[0], $conv[1], $conv[2], $cores[3] * 100);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ($type == 'spot') {&nbsp;</div></li><li><div>                  $name = strtoupper(trim($cores[0]));&nbsp;</div></li><li><div>                  if (!isset($this-&gt;spotColors[$name])) {&nbsp;</div></li><li><div>                      if (isset($cores[5])) {&nbsp;</div></li><li><div>                          $this-&gt;AddSpotColor($cores[0], $cores[2], $cores[3], $cores[4], $cores[5]);&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          throw new MpdfException('Undefined spot color: ' . $name);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $c = array(2, $this-&gt;spotColors[$name]['i'], $cores[1]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// $this-&gt;restrictColorSpace</span>&nbsp;</div></li><li><div>          <span class="comment">// 1 - allow GRAYSCALE only [convert CMYK/RGB-&gt;gray]</span>&nbsp;</div></li><li><div>          <span class="comment">// 2 - allow RGB / SPOT COLOR / Grayscale [convert CMYK-&gt;RGB]</span>&nbsp;</div></li><li><div>          <span class="comment">// 3 - allow CMYK / SPOT COLOR / Grayscale [convert RGB-&gt;CMYK]</span>&nbsp;</div></li><li><div>          if ($this-&gt;PDFA || $this-&gt;PDFX || $this-&gt;restrictColorSpace) {&nbsp;</div></li><li><div>              if ($c[0] == 1) { <span class="comment"><span class="comment">// GRAYSCALE</span></span>&nbsp;</div></li><li><div>              } elseif ($c[0] == 2) { <span class="comment"><span class="comment"><span class="comment">// SPOT COLOR</span></span></span>&nbsp;</div></li><li><div>                  if (!isset($this-&gt;spotColorIDs[$c[1]])) {&nbsp;</div></li><li><div>                      throw new MpdfException('Error: Spot colour has not been defined - ' . $this-&gt;spotColorIDs[$c[1]]);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ($this-&gt;PDFA) {&nbsp;</div></li><li><div>                      if ($this-&gt;PDFA && !$this-&gt;PDFAauto) {&nbsp;</div></li><li><div>                          $this-&gt;PDFAXwarnings[] = &quot;Spot color specified '&quot; . $this-&gt;spotColorIDs[$c[1]] . &quot;' (converted to process color)&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ($this-&gt;restrictColorSpace != 3) {&nbsp;</div></li><li><div>                          $sp = $this-&gt;spotColors[$this-&gt;spotColorIDs[$c[1]]];&nbsp;</div></li><li><div>                          $c = $this-&gt;cmyk2rgb(array(4, $sp['c'], $sp['m'], $sp['y'], $sp['k']));&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ($this-&gt;restrictColorSpace == 1) {&nbsp;</div></li><li><div>                      $sp = $this-&gt;spotColors[$this-&gt;spotColorIDs[$c[1]]];&nbsp;</div></li><li><div>                      $c = $this-&gt;cmyk2gray(array(4, $sp['c'], $sp['m'], $sp['y'], $sp['k']));&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>&nbsp;</div></li><li><div>              elseif ($c[0] == 3) {&nbsp;</div></li><li><div>                  if ($this-&gt;PDFX || ($this-&gt;PDFA && $this-&gt;restrictColorSpace == 3)) {&nbsp;</div></li><li><div>                      if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>                          $this-&gt;PDFAXwarnings[] = &quot;RGB color specified '&quot; . $color . &quot;' (converted to CMYK)&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $c = $this-&gt;rgb2cmyk($c);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;restrictColorSpace == 1) {&nbsp;</div></li><li><div>                      $c = $this-&gt;rgb2gray($c);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;restrictColorSpace == 3) {&nbsp;</div></li><li><div>                      $c = $this-&gt;rgb2cmyk($c);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>&nbsp;</div></li><li><div>              elseif ($c[0] == 4) {&nbsp;</div></li><li><div>                  if ($this-&gt;PDFA && $this-&gt;restrictColorSpace != 3) {&nbsp;</div></li><li><div>                      if ($this-&gt;PDFA && !$this-&gt;PDFAauto) {&nbsp;</div></li><li><div>                          $this-&gt;PDFAXwarnings[] = &quot;CMYK color specified '&quot; . $color . &quot;' (converted to RGB)&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $c = $this-&gt;cmyk2rgb($c);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;restrictColorSpace == 1) {&nbsp;</div></li><li><div>                      $c = $this-&gt;cmyk2gray($c);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;restrictColorSpace == 2) {&nbsp;</div></li><li><div>                      $c = $this-&gt;cmyk2rgb($c);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>              elseif ($c[0] == 5) {&nbsp;</div></li><li><div>                  if ($this-&gt;PDFX || ($this-&gt;PDFA && $this-&gt;restrictColorSpace == 3)) {&nbsp;</div></li><li><div>                      if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>                          $this-&gt;PDFAXwarnings[] = &quot;RGB color with transparency specified '&quot; . $color . &quot;' (converted to CMYK without transparency)&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $c = $this-&gt;rgb2cmyk($c);&nbsp;</div></li><li><div>                      $c = array(4, $c[1], $c[2], $c[3], $c[4]);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;PDFA && $this-&gt;restrictColorSpace != 3) {&nbsp;</div></li><li><div>                      if (!$this-&gt;PDFAauto) {&nbsp;</div></li><li><div>                          $this-&gt;PDFAXwarnings[] = &quot;RGB color with transparency specified '&quot; . $color . &quot;' (converted to RGB without transparency)&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $c = $this-&gt;rgb2cmyk($c);&nbsp;</div></li><li><div>                      $c = array(4, $c[1], $c[2], $c[3], $c[4]);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;restrictColorSpace == 1) {&nbsp;</div></li><li><div>                      $c = $this-&gt;rgb2gray($c);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;restrictColorSpace == 3) {&nbsp;</div></li><li><div>                      $c = $this-&gt;rgb2cmyk($c);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>a</span></span></span></span>&nbsp;</div></li><li><div>              elseif ($c[0] == 6) {&nbsp;</div></li><li><div>                  if ($this-&gt;PDFA && $this-&gt;restrictColorSpace != 3) {&nbsp;</div></li><li><div>                      if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>                          $this-&gt;PDFAXwarnings[] = &quot;CMYK color with transparency specified '&quot; . $color . &quot;' (converted to RGB without transparency)&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $c = $this-&gt;cmyk2rgb($c);&nbsp;</div></li><li><div>                      $c = array(3, $c[1], $c[2], $c[3]);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;PDFX || ($this-&gt;PDFA && $this-&gt;restrictColorSpace == 3)) {&nbsp;</div></li><li><div>                      if (($this-&gt;PDFA && !$this-&gt;PDFAauto) || ($this-&gt;PDFX && !$this-&gt;PDFXauto)) {&nbsp;</div></li><li><div>                          $this-&gt;PDFAXwarnings[] = &quot;CMYK color with transparency specified '&quot; . $color . &quot;' (converted to CMYK without transparency)&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $c = $this-&gt;cmyk2rgb($c);&nbsp;</div></li><li><div>                      $c = array(3, $c[1], $c[2], $c[3]);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;restrictColorSpace == 1) {&nbsp;</div></li><li><div>                      $c = $this-&gt;cmyk2gray($c);&nbsp;</div></li><li><div>                  } elseif ($this-&gt;restrictColorSpace == 2) {&nbsp;</div></li><li><div>                      $c = $this-&gt;cmyk2rgb($c);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (is_array($c)) {&nbsp;</div></li><li><div>              $c = array_pad($c, 6, 0);&nbsp;</div></li><li><div>              $cstr = pack(&quot;a1ccccc&quot;, $c[0], ($c[1] & 0xFF), ($c[2] & 0xFF), ($c[3] & 0xFF), ($c[4] & 0xFF), ($c[5] & 0xFF));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $cache[$color] = $cstr;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $cache[$color];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function rgb2gray($c)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (isset($c[4])) {&nbsp;</div></li><li><div>          return array(1, (($c[1] * .21) + ($c[2] * .71) + ($c[3] * .07)), ord(1), $c[4]);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return array(1, (($c[1] * .21) + ($c[2] * .71) + ($c[3] * .07)));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function cmyk2gray($c)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $rgb = $this-&gt;cmyk2rgb($c);&nbsp;</div></li><li><div>      return $this-&gt;rgb2gray($rgb);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function rgb2cmyk($c)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $cyan = 1 - ($c[1] / 255);&nbsp;</div></li><li><div>      $magenta = 1 - ($c[2] / 255);&nbsp;</div></li><li><div>      $yellow = 1 - ($c[3] / 255);&nbsp;</div></li><li><div>      $min = min($cyan, $magenta, $yellow);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($min == 1) {&nbsp;</div></li><li><div>          if ($c[0] == 5) {&nbsp;</div></li><li><div>              return array(6, 100, 100, 100, 100, $c[4]);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return array(4, 100, 100, 100, 100);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// For K-Black</span>&nbsp;</div></li><li><div>          <span class="comment">//if ($c[0]==5) { return array (6, 0, 0, 0, 100, $c[4]); }</span>&nbsp;</div></li><li><div>          <span class="comment">//else { return array (4, 0, 0, 0, 100); }</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $K = $min;&nbsp;</div></li><li><div>      $black = 1 - $K;&nbsp;</div></li><li><div>      if ($c[0] == 5) {&nbsp;</div></li><li><div>          return array(6, ($cyan - $K) * 100 / $black, ($magenta - $K) * 100 / $black, ($yellow - $K) * 100 / $black, $K * 100, $c[4]);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return array(4, ($cyan - $K) * 100 / $black, ($magenta - $K) * 100 / $black, ($yellow - $K) * 100 / $black, $K * 100);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function cmyk2rgb($c)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $rgb = array();&nbsp;</div></li><li><div>      $colors = 255 - ($c[4] * 2.55);&nbsp;</div></li><li><div>      $rgb[0] = intval($colors * (255 - ($c[1] * 2.55)) / 255);&nbsp;</div></li><li><div>      $rgb[1] = intval($colors * (255 - ($c[2] * 2.55)) / 255);&nbsp;</div></li><li><div>      $rgb[2] = intval($colors * (255 - ($c[3] * 2.55)) / 255);&nbsp;</div></li><li><div>      if ($c[0] == 6) {&nbsp;</div></li><li><div>          return array(5, $rgb[0], $rgb[1], $rgb[2], $c[5]);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return array(3, $rgb[0], $rgb[1], $rgb[2]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function rgb2hsl($var_r, $var_g, $var_b)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $var_min = min($var_r, $var_g, $var_b);&nbsp;</div></li><li><div>      $var_max = max($var_r, $var_g, $var_b);&nbsp;</div></li><li><div>      $del_max = $var_max - $var_min;&nbsp;</div></li><li><div>      $l = ($var_max + $var_min) / 2;&nbsp;</div></li><li><div>      if ($del_max == 0) {&nbsp;</div></li><li><div>          $h = 0;&nbsp;</div></li><li><div>          $s = 0;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ($l &lt; 0.5) {&nbsp;</div></li><li><div>              $s = $del_max / ($var_max + $var_min);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $s = $del_max / (2 - $var_max - $var_min);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $del_r = ((($var_max - $var_r) / 6) + ($del_max / 2)) / $del_max;&nbsp;</div></li><li><div>          $del_g = ((($var_max - $var_g) / 6) + ($del_max / 2)) / $del_max;&nbsp;</div></li><li><div>          $del_b = ((($var_max - $var_b) / 6) + ($del_max / 2)) / $del_max;&nbsp;</div></li><li><div>          if ($var_r == $var_max) {&nbsp;</div></li><li><div>              $h = $del_b - $del_g;&nbsp;</div></li><li><div>          } elseif ($var_g == $var_max) {&nbsp;</div></li><li><div>              $h = (1 / 3) + $del_r - $del_b;&nbsp;</div></li><li><div>          } elseif ($var_b == $var_max) {&nbsp;</div></li><li><div>              $h = (2 / 3) + $del_g - $del_r;&nbsp;</div></li><li><div>          };&nbsp;</div></li><li><div>          if ($h &lt; 0) {&nbsp;</div></li><li><div>              $h += 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($h &gt; 1) {&nbsp;</div></li><li><div>              $h -= 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array($h, $s, $l);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function hsl2rgb($h2, $s2, $l2)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Input is HSL value of complementary colour, held in $h2, $s, $l as fractions of 1</span>&nbsp;</div></li><li><div>      <span class="comment">// Output is RGB in normal 255 255 255 format, held in $r, $g, $b</span>&nbsp;</div></li><li><div>      <span class="comment">// Hue is converted using function hue_2_rgb, shown at the end of this code</span>&nbsp;</div></li><li><div>      if ($s2 == 0) {&nbsp;</div></li><li><div>          $r = $l2 * 255;&nbsp;</div></li><li><div>          $g = $l2 * 255;&nbsp;</div></li><li><div>          $b = $l2 * 255;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ($l2 &lt; 0.5) {&nbsp;</div></li><li><div>              $var_2 = $l2 * (1 + $s2);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $var_2 = ($l2 + $s2) - ($s2 * $l2);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $var_1 = 2 * $l2 - $var_2;&nbsp;</div></li><li><div>          $r = round(255 * $this-&gt;hue_2_rgb($var_1, $var_2, $h2 + (1 / 3)));&nbsp;</div></li><li><div>          $g = round(255 * $this-&gt;hue_2_rgb($var_1, $var_2, $h2));&nbsp;</div></li><li><div>          $b = round(255 * $this-&gt;hue_2_rgb($var_1, $var_2, $h2 - (1 / 3)));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return array($r, $g, $b);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function hue_2_rgb($v1, $v2, $vh)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Function to convert hue to RGB, called from above</span>&nbsp;</div></li><li><div>      if ($vh &lt; 0) {&nbsp;</div></li><li><div>          $vh += 1;&nbsp;</div></li><li><div>      };&nbsp;</div></li><li><div>      if ($vh &gt; 1) {&nbsp;</div></li><li><div>          $vh -= 1;&nbsp;</div></li><li><div>      };&nbsp;</div></li><li><div>      if ((6 * $vh) &lt; 1) {&nbsp;</div></li><li><div>          return ($v1 + ($v2 - $v1) * 6 * $vh);&nbsp;</div></li><li><div>      };&nbsp;</div></li><li><div>      if ((2 * $vh) &lt; 1) {&nbsp;</div></li><li><div>          return ($v2);&nbsp;</div></li><li><div>      };&nbsp;</div></li><li><div>      if ((3 * $vh) &lt; 2) {&nbsp;</div></li><li><div>          return ($v1 + ($v2 - $v1) * ((2 / 3 - $vh) * 6));&nbsp;</div></li><li><div>      };&nbsp;</div></li><li><div>      return ($v1);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _invertColor($cor)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ($cor[0] == 3 || $cor[0] == 5) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// RGB</span></span></span></span></span></span>&nbsp;</div></li><li><div>          return array(3, (255 - $cor[1]), (255 - $cor[2]), (255 - $cor[3]));&nbsp;</div></li><li><div>      } elseif ($cor[0] == 4 || $cor[0] == 6) { <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// CMYK</span></span></span></span></span></span>&nbsp;</div></li><li><div>          return array(4, (100 - $cor[1]), (100 - $cor[2]), (100 - $cor[3]), (100 - $cor[4]));&nbsp;</div></li><li><div>      } elseif ($cor[0] == 1) { <span class="comment"><span class="comment">// Gray</span></span>scale&nbsp;</div></li><li><div>          return array(1, (255 - $cor[1]));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">// Cannot cope with non-RGB colors at present</span>&nbsp;</div></li><li><div>      throw new MpdfException('Error in _invertColor - trying to invert non-RGB color');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _colAtoString($cor)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $s = '';&nbsp;</div></li><li><div>      if ($cor{0} == 1)&nbsp;</div></li><li><div>          $s = 'rgb(' . ord($cor{1}) . ', ' . ord($cor{1}) . ', ' . ord($cor{1}) . ')';&nbsp;</div></li><li><div>      elseif ($cor{0} == 2)&nbsp;</div></li><li><div>          $s = 'spot(' . ord($cor{1}) . ', ' . ord($cor{2}) . ')';  <span class="comment"><span class="comment"><span class="comment">// SPOT COLOR</span></span></span>&nbsp;</div></li><li><div>      elseif ($cor{0} == 3)&nbsp;</div></li><li><div>          $s = 'rgb(' . ord($cor{1}) . ', ' . ord($cor{2}) . ', ' . ord($cor{3}) . ')';&nbsp;</div></li><li><div>      elseif ($cor{0} == 4)&nbsp;</div></li><li><div>          $s = 'cmyk(' . ord($cor{1}) . ', ' . ord($cor{2}) . ', ' . ord($cor{3}) . ', ' . ord($cor{4}) . ')';&nbsp;</div></li><li><div>      elseif ($cor{0} == 5)&nbsp;</div></li><li><div>          $s = 'rgba(' . ord($cor{1}) . ', ' . ord($cor{2}) . ', ' . ord($cor{3}) . ', ' . sprintf('%0.2F', ord($cor{4}) / 100) . ')';&nbsp;</div></li><li><div>      elseif ($cor{0} == 6)&nbsp;</div></li><li><div>          $s = 'cmyka(' . ord($cor{1}) . ', ' . ord($cor{2}) . ', ' . ord($cor{3}) . ', ' . ord($cor{4}) . ', ' . sprintf('%0.2F', ord($cor{5}) / 100) . ')';&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function ConvertSize($size = 5, $maxsize = 0, $fontsize = false, $usefontsize = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// usefontsize - set false for e.g. margins - will ignore fontsize for % values</span>&nbsp;</div></li><li><div>      <span class="comment">// Depends of maxsize value to make % work properly. Usually maxsize == pagewidth</span>&nbsp;</div></li><li><div>      <span class="comment">// For text $maxsize = Fontsize</span>&nbsp;</div></li><li><div>      <span class="comment">// Setting e.g. margin % will use maxsize (pagewidth) and em will use fontsize</span>&nbsp;</div></li><li><div>      <span class="comment">// Returns values using 'mm' units</span>&nbsp;</div></li><li><div>      $size = trim(strtolower($size));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($size == 'thin')&nbsp;</div></li><li><div>          $size = 1 * (25.4 / $this-&gt;dpi); <span class="comment">//1 pixel width for table borders</span>&nbsp;</div></li><li><div>      elseif (stristr($size, 'px'))&nbsp;</div></li><li><div>          $size *= (25.4 / $this-&gt;dpi); <span class="comment">//pixels</span>&nbsp;</div></li><li><div>      elseif (stristr($size, 'cm'))&nbsp;</div></li><li><div>          $size *= 10; <span class="comment">//centimeters</span>&nbsp;</div></li><li><div>      elseif (stristr($size, 'mm'))&nbsp;</div></li><li><div>          $size += 0; <span class="comment">//millimeters</span>&nbsp;</div></li><li><div>      elseif (stristr($size, 'pt'))&nbsp;</div></li><li><div>          $size *= 25.4 / 72; <span class="comment">//72 pts/inch</span>&nbsp;</div></li><li><div>      elseif (stristr($size, 'rem')) {&nbsp;</div></li><li><div>          $size += 0; <span class="comment">//make &quot;0.83rem&quot; become simply &quot;0.83&quot;</span>&nbsp;</div></li><li><div>          $size *= ($this-&gt;default_font_size / _MPDFK);&nbsp;</div></li><li><div>      } elseif (stristr($size, 'em')) {&nbsp;</div></li><li><div>          $size += 0; <span class="comment">//make &quot;0.83em&quot; become simply &quot;0.83&quot;</span>&nbsp;</div></li><li><div>          if ($fontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (stristr($size, '%')) {&nbsp;</div></li><li><div>          $size += 0; <span class="comment">//make &quot;90%&quot; become simply &quot;90&quot;</span>&nbsp;</div></li><li><div>          if ($fontsize && $usefontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize / 100;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize / 100;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif (stristr($size, 'in'))&nbsp;</div></li><li><div>          $size *= 25.4; <span class="comment">//inches</span>&nbsp;</div></li><li><div>      elseif (stristr($size, 'pc'))&nbsp;</div></li><li><div>          $size *= 38.1 / 9; <span class="comment">//PostScript picas</span>&nbsp;</div></li><li><div>      elseif (stristr($size, 'ex')) { <span class="comment">// Approximates &quot;ex&quot; as half of font height</span>&nbsp;</div></li><li><div>          $size += 0; <span class="comment">//make &quot;3.5ex&quot; become simply &quot;3.5&quot;</span>&nbsp;</div></li><li><div>          if ($fontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize / 2;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize / 2;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($size == 'medium')&nbsp;</div></li><li><div>          $size = 3 * (25.4 / $this-&gt;dpi); <span class="comment">//3 pixel width for table borders</span>&nbsp;</div></li><li><div>      elseif ($size == 'thick')&nbsp;</div></li><li><div>          $size = 5 * (25.4 / $this-&gt;dpi); <span class="comment">//5 pixel width for table borders</span>&nbsp;</div></li><li><div>      elseif ($size == 'xx-small') {&nbsp;</div></li><li><div>          if ($fontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize * 0.7;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize * 0.7;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($size == 'x-small') {&nbsp;</div></li><li><div>          if ($fontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize * 0.77;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize * 0.77;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($size == 'small') {&nbsp;</div></li><li><div>          if ($fontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize * 0.86;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize * 0.86;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($size == 'medium') {&nbsp;</div></li><li><div>          if ($fontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($size == 'large') {&nbsp;</div></li><li><div>          if ($fontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize * 1.2;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize * 1.2;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($size == 'x-large') {&nbsp;</div></li><li><div>          if ($fontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize * 1.5;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize * 1.5;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } elseif ($size == 'xx-large') {&nbsp;</div></li><li><div>          if ($fontsize) {&nbsp;</div></li><li><div>              $size *= $fontsize * 2;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $size *= $maxsize * 2;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $size = (int) $size; <span class="comment">/** fix height: auto issue - https://github.com/mpdf/mpdf/issues/294 */</span>&nbsp;</div></li><li><div>          $size *= (25.4 / $this-&gt;dpi); <span class="comment">//nothing == px</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $size;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span> TRANSFORMS&nbsp;</div></li><li><div>  function ConvertAngle($s, $makepositive = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (preg_match('/([\-]*[0-9\.]+)(deg|grad|rad)/i', $s, $m)) {&nbsp;</div></li><li><div>          $angle = $m[1] + 0;&nbsp;</div></li><li><div>          if (strtolower($m[2]) == 'deg') {&nbsp;</div></li><li><div>              $angle = $angle;&nbsp;</div></li><li><div>          } elseif (strtolower($m[2]) == 'grad') {&nbsp;</div></li><li><div>              $angle *= (360 / 400);&nbsp;</div></li><li><div>          } elseif (strtolower($m[2]) == 'rad') {&nbsp;</div></li><li><div>              $angle = rad2deg($angle);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          while ($angle &gt;= 360) {&nbsp;</div></li><li><div>              $angle -= 360;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          while ($angle &lt;= -360) {&nbsp;</div></li><li><div>              $angle += 360;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($makepositive) { <span class="comment">// always returns an angle between 0 and 360deg</span>&nbsp;</div></li><li><div>              if ($angle &lt; 0) {&nbsp;</div></li><li><div>                  $angle += 360;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $angle = $s + 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $angle;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function lesser_entity_decode($html)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//supports the most used entity codes (only does ascii safe characters)</span>&nbsp;</div></li><li><div>      $html = str_replace(&quot;&lt;&quot;, &quot;&lt;&quot;, $html);&nbsp;</div></li><li><div>      $html = str_replace(&quot;&gt;&quot;, &quot;&gt;&quot;, $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = str_replace(&quot;&apos;&quot;, &quot;'&quot;, $html);&nbsp;</div></li><li><div>      $html = str_replace(&quot;&quot;&quot;, '&quot;', $html);&nbsp;</div></li><li><div>      $html = str_replace(&quot;&amp;&quot;, &quot;&&quot;, $html);&nbsp;</div></li><li><div>      return $html;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function AdjustHTML($html, $tabSpaces = 8)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//Try to make the html text more manageable (turning it into XHTML)</span>&nbsp;</div></li><li><div>      if (PHP_VERSION_ID &lt; 50307) {&nbsp;</div></li><li><div>          if (strlen($html) &gt; 100000) {&nbsp;</div></li><li><div>              if (PHP_VERSION_ID &lt; 50200)&nbsp;</div></li><li><div>                  throw new MpdfException(&quot;The HTML code is more than 100, 000 characters. You should use WriteHTML() with smaller string lengths.&quot;);&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  ini_set(&quot;pcre.backtrack_limit&quot;, &quot;1000000&quot;);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      preg_match_all(&quot;/(&lt;annotation.*?&gt;)/si&quot;, $html, $m);&nbsp;</div></li><li><div>      if (count($m[1])) {&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; count($m[1]); $i++) {&nbsp;</div></li><li><div>              $sub = preg_replace(&quot;/\n/si&quot;, &quot;\xbb\xa4\xac&quot;, $m[1][$i]);&nbsp;</div></li><li><div>              $html = preg_replace('/' . preg_quote($m[1][$i], '/') . '/si', $sub, $html);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END ANNOTATIONS -- */</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      preg_match_all(&quot;/(&lt;svg.*?&lt;\/svg&gt;)/si&quot;, $html, $svgi);&nbsp;</div></li><li><div>      if (count($svgi[0])) {&nbsp;</div></li><li><div>          for ($i = 0; $i &lt; count($svgi[0]); $i++) {&nbsp;</div></li><li><div>              $file = _MPDF_TEMP_PATH . '_tempSVG' . uniqid(rand(1, 100000), true) . '_' . $i . '.svg';&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">//Save to local file</span></span></span>&nbsp;</div></li><li><div>              file_put_contents($file, $svgi[0][$i]);&nbsp;</div></li><li><div>              $html = str_replace($svgi[0][$i], '&lt;img src=&quot;' . $file . '&quot; /&gt;', $html);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Remove javascript code from HTML (should not appear in the PDF file)</span>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;script.*?&lt;\/script&gt;/is', '', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Remove special comments</span>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;!--mpdf/i', '', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/mpdf--&gt;/i', '', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//Remove comments from HTML (should not appear in the PDF file)</span>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;!--.*?--&gt;/s', '', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = preg_replace('/\f/', '', $html); <span class="comment">//replace formfeed by nothing</span>&nbsp;</div></li><li><div>      $html = preg_replace('/\r/', '', $html); <span class="comment">//replace carriage return by nothing</span>&nbsp;</div></li><li><div>      <span class="comment">// Well formed XHTML end tags</span>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;(br|hr)&gt;/i', &quot;&lt;\\1 /&gt;&quot;, $html); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;(br|hr)\/&gt;/i', &quot;&lt;\\1 /&gt;&quot;, $html);&nbsp;</div></li><li><div>      <span class="comment">// Get rid of empty &lt;thead&gt;&lt;/thead&gt; etc</span>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;tr&gt;\s*&lt;\/tr&gt;/i', '', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;thead&gt;\s*&lt;\/thead&gt;/i', '', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;tfoot&gt;\s*&lt;\/tfoot&gt;/i', '', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;table[^&gt;]*&gt;\s*&lt;\/table&gt;/i', '', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Remove spaces at end of table cells</span>&nbsp;</div></li><li><div>      $html = preg_replace(&quot;/[ \n\r]+&lt;\/t(d|h)/&quot;, '&lt;/t\\1', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = preg_replace(&quot;/[ ]*&lt;dottab\s*[\/]*&gt;[ ]*/&quot;, '&lt;dottab /&gt;', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Concatenates any Substitute characters from symbols/dingbats</span>&nbsp;</div></li><li><div>      $html = str_replace('&lt;/tts&gt;&lt;tts&gt;', '|', $html);&nbsp;</div></li><li><div>      $html = str_replace('&lt;/ttz&gt;&lt;ttz&gt;', '|', $html);&nbsp;</div></li><li><div>      $html = str_replace('&lt;/tta&gt;&lt;tta&gt;', '|', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;br \/&gt;\s*/is', &quot;&lt;br /&gt;&quot;, $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;wbr[ \/]*&gt;\s*/is', &quot;&#173;&quot;, $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Preserve '\n's in content between the tags &lt;pre&gt; and &lt;/pre&gt;</span>&nbsp;</div></li><li><div>      if (preg_match('/&lt;pre/', $html)) {&nbsp;</div></li><li><div>          $html_a = preg_split('/(\&lt;\/?pre[^\&gt;]*\&gt;)/', $html, -1, 2);&nbsp;</div></li><li><div>          $h = array();&nbsp;</div></li><li><div>          $c = 0;&nbsp;</div></li><li><div>          foreach ($html_a AS $s) {&nbsp;</div></li><li><div>              if ($c &gt; 1 && preg_match('/^&lt;\/pre/i', $s)) {&nbsp;</div></li><li><div>                  $c--;&nbsp;</div></li><li><div>                  $s = preg_replace('/&lt;\/pre/i', '&lt;/innerpre', $s);&nbsp;</div></li><li><div>              } elseif ($c &gt; 0 && preg_match('/^&lt;pre/i', $s)) {&nbsp;</div></li><li><div>                  $c++;&nbsp;</div></li><li><div>                  $s = preg_replace('/&lt;pre/i', '&lt;innerpre', $s);&nbsp;</div></li><li><div>              } elseif (preg_match('/^&lt;pre/i', $s)) {&nbsp;</div></li><li><div>                  $c++;&nbsp;</div></li><li><div>              } elseif (preg_match('/^&lt;\/pre/i', $s)) {&nbsp;</div></li><li><div>                  $c--;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              array_push($h, $s);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $html = implode(&quot;&quot;, $h);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $thereispre = preg_match_all('#&lt;pre(.*?)&gt;(.*?)&lt;/pre&gt;#si', $html, $temp);&nbsp;</div></li><li><div>      <span class="comment">// Preserve '\n's in content between the tags &lt;textarea&gt; and &lt;/textarea&gt;</span>&nbsp;</div></li><li><div>      $thereistextarea = preg_match_all('#&lt;textarea(.*?)&gt;(.*?)&lt;/textarea&gt;#si', $html, $temp2);&nbsp;</div></li><li><div>      $html = preg_replace('/[\n]/', ' ', $html); <span class="comment">//replace linefeed by spaces</span>&nbsp;</div></li><li><div>      $html = preg_replace('/[\t]/', ' ', $html); <span class="comment">//replace tabs by spaces</span>&nbsp;</div></li><li><div>      <span class="comment">// Converts &lt; to &lt; when not a tag</span>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;([^!\/a-zA-Z_:])/i', '&lt;\\1', $html); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>      $html = preg_replace(&quot;/[ ]+/&quot;, ' ', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = preg_replace('/\/li&gt;\s+&lt;\/(u|o)l/i', '/li&gt;&lt;/\\1l', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/\/(u|o)l&gt;\s+&lt;\/li/i', '/\\1l&gt;&lt;/li', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/\/li&gt;\s+&lt;\/(u|o)l/i', '/li&gt;&lt;/\\1l', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/\/li&gt;\s+&lt;li/i', '/li&gt;&lt;li', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;(u|o)l([^&gt;]*)&gt;[ ]+/i', '&lt;\\1l\\2&gt;', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/[ ]+&lt;(u|o)l/i', '&lt;\\1l', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Make self closing tabs valid XHTML</span>&nbsp;</div></li><li><div>      <span class="comment">// Tags which are self-closing: 1) Replaceable and 2) Non-replaced items</span>&nbsp;</div></li><li><div>      $selftabs = 'input|hr|img|br|jpgraph|barcode|dottab';&nbsp;</div></li><li><div>      $selftabs2 = 'indexentry|indexinsert|bookmark|watermarktext|watermarkimage|column_break|columnbreak|newcolumn|newpage|page_break|pagebreak|formfeed|columns|toc|tocpagebreak|setpageheader|setpagefooter|sethtmlpageheader|sethtmlpagefooter|annotation';&nbsp;</div></li><li><div>      $html = preg_replace('/(&lt;(' . $selftabs . '|' . $selftabs2 . ')[^&gt;\/]*)&gt;/i', '\\1 /&gt;', $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $iterator = 0;&nbsp;</div></li><li><div>      while ($thereispre) { <span class="comment">//Recover &lt;pre attributes&gt;content&lt;/pre&gt;</span>&nbsp;</div></li><li><div>          $temp[2][$iterator] = preg_replace('/&lt;([^!\/a-zA-Z_:])/', '&lt;\\1', $temp[2][$iterator]); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.2</span></span></span></span></span>    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.3</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $temp[2][$iterator] = preg_replace_callback(&quot;/^([^\n\t]*?)\t/m&quot;, array($this, 'tabs2spaces_callback'), $temp[2][$iterator]); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>+&nbsp;</div></li><li><div>          $temp[2][$iterator] = preg_replace('/\t/', str_repeat(&quot; &quot;, $tabSpaces), $temp[2][$iterator]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $temp[2][$iterator] = preg_replace('/\n/', &quot;&lt;br /&gt;&quot;, $temp[2][$iterator]);&nbsp;</div></li><li><div>          $temp[2][$iterator] = str_replace('\\', &quot;\\\\&quot;, $temp[2][$iterator]);&nbsp;</div></li><li><div>          <span class="comment">//$html = preg_replace('#&lt;pre(.*?)&gt;(.*?)&lt;/pre&gt;#si', '&lt;erp'.$temp[1][$iterator].'&gt;'.$temp[2][$iterator].'&lt;/erp&gt;', $html, 1);</span>&nbsp;</div></li><li><div>          $html = preg_replace('#&lt;pre(.*?)&gt;(.*?)&lt;/pre&gt;#si', '&lt;erp' . $temp[1][$iterator] . '&gt;' . str_replace('$', '\$', $temp[2][$iterator]) . '&lt;/erp&gt;', $html, 1); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>+&nbsp;</div></li><li><div>          $thereispre--;&nbsp;</div></li><li><div>          $iterator++;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $iterator = 0;&nbsp;</div></li><li><div>      while ($thereistextarea) { <span class="comment">//Recover &lt;textarea attributes&gt;content&lt;/textarea&gt;</span>&nbsp;</div></li><li><div>          $temp2[2][$iterator] = preg_replace('/\t/', str_repeat(&quot; &quot;, $tabSpaces), $temp2[2][$iterator]);&nbsp;</div></li><li><div>          $temp2[2][$iterator] = str_replace('\\', &quot;\\\\&quot;, $temp2[2][$iterator]);&nbsp;</div></li><li><div>          $html = preg_replace('#&lt;textarea(.*?)&gt;(.*?)&lt;/textarea&gt;#si', '&lt;aeratxet' . $temp2[1][$iterator] . '&gt;' . trim($temp2[2][$iterator]) . '&lt;/aeratxet&gt;', $html, 1);&nbsp;</div></li><li><div>          $thereistextarea--;&nbsp;</div></li><li><div>          $iterator++;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Restore original tag names</span>&nbsp;</div></li><li><div>      $html = str_replace(&quot;&lt;erp&quot;, &quot;&lt;pre&quot;, $html);&nbsp;</div></li><li><div>      $html = str_replace(&quot;&lt;/erp&gt;&quot;, &quot;&lt;/pre&gt;&quot;, $html);&nbsp;</div></li><li><div>      $html = str_replace(&quot;&lt;aeratxet&quot;, &quot;&lt;textarea&quot;, $html);&nbsp;</div></li><li><div>      $html = str_replace(&quot;&lt;/aeratxet&gt;&quot;, &quot;&lt;/textarea&gt;&quot;, $html);&nbsp;</div></li><li><div>      $html = str_replace(&quot;&lt;/innerpre&quot;, &quot;&lt;/pre&quot;, $html);&nbsp;</div></li><li><div>      $html = str_replace(&quot;&lt;innerpre&quot;, &quot;&lt;pre&quot;, $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;textarea([^&gt;]*)&gt;&lt;\/textarea&gt;/si', '&lt;textarea\\1&gt; &lt;/textarea&gt;', $html);&nbsp;</div></li><li><div>      $html = preg_replace('/(&lt;table[^&gt;]*&gt;)\s*(&lt;caption)(.*?&lt;\/caption&gt;)(.*?&lt;\/table&gt;)/si', '\\2 position=&quot;top&quot;\\3\\1\\4\\2 position=&quot;bottom&quot;\\3', $html); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $html = preg_replace('/&lt;(h[1-6])([^&gt;]*)(&gt;(?:(?!h[1-6]).)*?&lt;\/\\1&gt;\s*&lt;table)/si', '&lt;\\1\\2 keep-with-table=&quot;1&quot;\\3', $html); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// *TABLES*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      $html = preg_replace(&quot;/\xbb\xa4\xac/&quot;, &quot;\n&quot;, $html);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fixes &lt;p&gt;&#8377&lt;/p&gt; which browser copes with even though it is wrong!</span>&nbsp;</div></li><li><div>      $html = preg_replace(&quot;/(&#[x]{0, 1}[0-9a-f]{1, 5})&lt;/i&quot;, &quot;\\1;&lt;&quot;, $html);&nbsp;</div></li><li><div>      return $html;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>+&nbsp;</div></li><li><div>  function tabs2spaces_callback($matches)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return (stripslashes($matches[1]) . str_repeat(' ', $this-&gt;tabSpaces - (mb_strlen(stripslashes($matches[1])) % $this-&gt;tabSpaces)));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>+&nbsp;</div></li><li><div>  function date_callback($matches)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return date($matches[1]);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function dec2other($num, $cp, $check = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// From printlistbuffer: font is set, so check if character is available</span>&nbsp;</div></li><li><div>      <span class="comment">// From docPageNum: font is not set, so no check</span>&nbsp;</div></li><li><div>      $nstr = (string) $num;&nbsp;</div></li><li><div>      $rnum = '';&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; strlen($nstr); $i++) {&nbsp;</div></li><li><div>          if (!$check || $this-&gt;_charDefined($this-&gt;CurrentFont['cw'], $cp + intval($nstr[$i]))) {&nbsp;</div></li><li><div>              $rnum .= code2utf($cp + intval($nstr[$i]));&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $rnum .= $nstr[$i];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $rnum;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function dec2cjk($num)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $nstr = (string) $num;&nbsp;</div></li><li><div>      $rnum = '';&nbsp;</div></li><li><div>      $glyphs = array(0x3007, 0x4E00, 0x4E8C, 0x4E09, 0x56DB, 0x4E94, 0x516D, 0x4E03, 0x516B, 0x4E5D);&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; strlen($nstr); $i++) {&nbsp;</div></li><li><div>          $rnum .= code2utf($glyphs[intval($nstr[$i])]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $rnum;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function dec2alpha($valor, $toupper = &quot;true&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// returns a string from A-Z to AA-ZZ to AAA-ZZZ</span>&nbsp;</div></li><li><div>      <span class="comment">// OBS: A = 65 ASCII TABLE VALUE</span>&nbsp;</div></li><li><div>      if (($valor &lt; 1) || ($valor &gt; 18278))&nbsp;</div></li><li><div>          return &quot;?&quot;; <span class="comment">//supports 'only' up to 18278</span>&nbsp;</div></li><li><div>      $c1 = $c2 = $c3 = '';&nbsp;</div></li><li><div>      if ($valor &gt; 702) { <span class="comment">// 3 letters (up to 18278)</span>&nbsp;</div></li><li><div>          $c1 = 65 + floor(($valor - 703) / 676);&nbsp;</div></li><li><div>          $c2 = 65 + floor((($valor - 703) % 676) / 26);&nbsp;</div></li><li><div>          $c3 = 65 + floor((($valor - 703) % 676) % 26);&nbsp;</div></li><li><div>      } elseif ($valor &gt; 26) { <span class="comment">// 2 letters (up to 702)</span>&nbsp;</div></li><li><div>          $c1 = (64 + (int) (($valor - 1) / 26));&nbsp;</div></li><li><div>          $c2 = (64 + (int) ($valor % 26));&nbsp;</div></li><li><div>          if ($c2 == 64)&nbsp;</div></li><li><div>              $c2 += 26;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else { <span class="comment">// 1 letter (up to 26)</span>&nbsp;</div></li><li><div>          $c1 = (64 + $valor);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $alpha = chr($c1);&nbsp;</div></li><li><div>      if ($c2 != '')&nbsp;</div></li><li><div>          $alpha .= chr($c2);&nbsp;</div></li><li><div>      if ($c3 != '')&nbsp;</div></li><li><div>          $alpha .= chr($c3);&nbsp;</div></li><li><div>      if (!$toupper)&nbsp;</div></li><li><div>          $alpha = strtolower($alpha);&nbsp;</div></li><li><div>      return $alpha;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 6</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  function dec2hebrew($in, $reverse = false)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// reverse is used when called from Lists, as these do not pass through bidi-algorithm</span>&nbsp;</div></li><li><div>      $i = intval($in); <span class="comment">// I initially be the counter value</span>&nbsp;</div></li><li><div>      $s = ''; <span class="comment">// S initially be the empty string</span>&nbsp;</div></li><li><div>      <span class="comment">//and glyph list initially be the list of additive tuples.</span>&nbsp;</div></li><li><div>      $additive_nums = array(400, 300, 200, 100, 90, 80, 70, 60, 50, 40, 30, 20, 19, 18, 17, 16, 15, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1);&nbsp;</div></li><li><div>      $additive_glyphs = array(0x05EA, 0x05E9, 0x05E8, 0x05E7, 0x05E6, 0x05E4, 0x05E2, 0x05E1, 0x05E0, 0x05DE, 0x05DC, 0x05DB, &nbsp;</div></li><li><div>          array(0x05D9, 0x05D8), array(0x05D9, 0x05D7), array(0x05D9, 0x05D6), array(0x05D8, 0x05D6), array(0x05D8, 0x05D5), 0x05D9, &nbsp;</div></li><li><div>          0x05D8, 0x05D7, 0x05D6, 0x05D5, 0x05D4, 0x05D3, 0x05D2, 0x05D1, 0x05D0);&nbsp;</div></li><li><div>      <span class="comment">/** NB This system manually specifies the values for 19-15 to force the correct display of 15 and 16, which are commonly</span>&nbsp;</div></li><li><div><span class="comment">        rewritten to avoid a close resemblance to the Tetragrammaton. */</span>&nbsp;</div></li><li><div>      <span class="comment">// This function only works up to 1, 000</span>&nbsp;</div></li><li><div>      if ($i &gt; 999) {&nbsp;</div></li><li><div>          return $in;&nbsp;</div></li><li><div>      } <span class="comment">// return as initial numeric string</span>&nbsp;</div></li><li><div>      <span class="comment">// If I is initially 0, and there is an additive tuple with a weight of 0, append that tuple's counter glyph to S and return S.</span>&nbsp;</div></li><li><div>      if ($i == 0) {&nbsp;</div></li><li><div>          return '0';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Otherwise, while I is greater than 0 and there are elements left in the glyph list:</span>&nbsp;</div></li><li><div>      for ($t = 0; $t &lt; count($additive_nums); $t++) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Pop the first additive tuple from the glyph list. This is the current tuple.</span>&nbsp;</div></li><li><div>          $ct = $additive_nums[$t];&nbsp;</div></li><li><div>          <span class="comment">// Append the current tuple's counter glyph to S x floor( I / current tuple's weight ) times (this may be 0).</span>&nbsp;</div></li><li><div>          $n = floor($i / $ct);&nbsp;</div></li><li><div>          for ($j = 0; $j &lt; $n; $j++) {&nbsp;</div></li><li><div>              if (is_array($additive_glyphs[$t])) {&nbsp;</div></li><li><div>                  foreach ($additive_glyphs[$t] AS $ag) {&nbsp;</div></li><li><div>                      if ($reverse) {&nbsp;</div></li><li><div>                          $s = code2utf($ag) . $s;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $s .= code2utf($ag);&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ($reverse) {&nbsp;</div></li><li><div>                      $s = code2utf($additive_glyphs[$t]) . $s;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $s .= code2utf($additive_glyphs[$t]);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $i -= ($ct * $n);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($i == 0) {&nbsp;</div></li><li><div>              return $s;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $in; <span class="comment">// return as initial string</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function dec2roman($valor, $toupper = true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//returns a string as a roman numeral</span>&nbsp;</div></li><li><div>      $r1 = $r2 = $r3 = $r4 = '';&nbsp;</div></li><li><div>      if (($valor &gt;= 5000) || ($valor &lt; 1))&nbsp;</div></li><li><div>          return &quot;?&quot;; <span class="comment">//supports 'only' up to 4999</span>&nbsp;</div></li><li><div>      $aux = (int) ($valor / 1000);&nbsp;</div></li><li><div>      if ($aux !== 0) {&nbsp;</div></li><li><div>          $valor %= 1000;&nbsp;</div></li><li><div>          while ($aux !== 0) {&nbsp;</div></li><li><div>              $r1 .= &quot;M&quot;;&nbsp;</div></li><li><div>              $aux--;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $aux = (int) ($valor / 100);&nbsp;</div></li><li><div>      if ($aux !== 0) {&nbsp;</div></li><li><div>          $valor %= 100;&nbsp;</div></li><li><div>          switch ($aux) {&nbsp;</div></li><li><div>              case 3: $r2 = &quot;C&quot;;&nbsp;</div></li><li><div>              case 2: $r2.=&quot;C&quot;;&nbsp;</div></li><li><div>              case 1: $r2.=&quot;C&quot;;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 9: $r2 = &quot;CM&quot;;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 8: $r2 = &quot;C&quot;;&nbsp;</div></li><li><div>              case 7: $r2.=&quot;C&quot;;&nbsp;</div></li><li><div>              case 6: $r2.=&quot;C&quot;;&nbsp;</div></li><li><div>              case 5: $r2 = &quot;D&quot; . $r2;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 4: $r2 = &quot;CD&quot;;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              default: break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $aux = (int) ($valor / 10);&nbsp;</div></li><li><div>      if ($aux !== 0) {&nbsp;</div></li><li><div>          $valor %= 10;&nbsp;</div></li><li><div>          switch ($aux) {&nbsp;</div></li><li><div>              case 3: $r3 = &quot;X&quot;;&nbsp;</div></li><li><div>              case 2: $r3.=&quot;X&quot;;&nbsp;</div></li><li><div>              case 1: $r3.=&quot;X&quot;;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 9: $r3 = &quot;XC&quot;;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 8: $r3 = &quot;X&quot;;&nbsp;</div></li><li><div>              case 7: $r3.=&quot;X&quot;;&nbsp;</div></li><li><div>              case 6: $r3.=&quot;X&quot;;&nbsp;</div></li><li><div>              case 5: $r3 = &quot;L&quot; . $r3;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 4: $r3 = &quot;XL&quot;;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              default: break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      switch ($valor) {&nbsp;</div></li><li><div>          case 3: $r4 = &quot;I&quot;;&nbsp;</div></li><li><div>          case 2: $r4.=&quot;I&quot;;&nbsp;</div></li><li><div>          case 1: $r4.=&quot;I&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 9: $r4 = &quot;IX&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 8: $r4 = &quot;I&quot;;&nbsp;</div></li><li><div>          case 7: $r4.=&quot;I&quot;;&nbsp;</div></li><li><div>          case 6: $r4.=&quot;I&quot;;&nbsp;</div></li><li><div>          case 5: $r4 = &quot;V&quot; . $r4;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 4: $r4 = &quot;IV&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default: break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $roman = $r1 . $r2 . $r3 . $r4;&nbsp;</div></li><li><div>      if (!$toupper)&nbsp;</div></li><li><div>          $roman = strtolower($roman);&nbsp;</div></li><li><div>      return $roman;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//===========================</span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>  function SetImportUse()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!class_exists('fpdi_pdf_parser')) {&nbsp;</div></li><li><div>          throw new MpdfException('Class fpdi_pdf_parser not found. Please run composer update or require setasign/fpdi 1.6.* manually');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;enableImports = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// from mPDFI</span></span>&nbsp;</div></li><li><div>  function hex2str($hex)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return pack(&quot;H*&quot;, str_replace(array(&quot;\r&quot;, &quot;\n&quot;, &quot; &quot;), &quot;&quot;, $hex));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function str2hex($str)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return current(unpack(&quot;H*&quot;, $str));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function pdf_write_value(&$value)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      switch ($value[0]) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_TOKEN:&nbsp;</div></li><li><div>              $this-&gt;_out($value[1] . ' ', false);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_NUMERIC:&nbsp;</div></li><li><div>          case pdf_parser::TYPE_REAL:&nbsp;</div></li><li><div>              if (is_float($value[1]) && $value[1] != 0) {&nbsp;</div></li><li><div>                  $this-&gt;_out(rtrim(rtrim(sprintf('%F', $value[1]), '0'), '.') . ' ', false);&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;_out($value[1] . ' ', false);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_ARRAY :&nbsp;</div></li><li><div>              <span class="comment">// An array. Output the proper</span>&nbsp;</div></li><li><div>              <span class="comment">// structure and move on.</span>&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;[&quot;, false);&nbsp;</div></li><li><div>              for ($i = 0; $i &lt; count($value[1]); $i++) {&nbsp;</div></li><li><div>                  $this-&gt;pdf_write_value($value[1][$i]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;]&quot;);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_DICTIONARY :&nbsp;</div></li><li><div>              <span class="comment">// A dictionary.</span>&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;&lt;&lt;&quot;, false);&nbsp;</div></li><li><div>              reset($value[1]);&nbsp;</div></li><li><div>              while (list($k, $v) = each($value[1])) {&nbsp;</div></li><li><div>                  $this-&gt;_out($k . ' ', false);&nbsp;</div></li><li><div>                  $this-&gt;pdf_write_value($v);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;&gt;&gt;&quot;);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_OBJREF :&nbsp;</div></li><li><div>              <span class="comment">// An indirect object reference</span>&nbsp;</div></li><li><div>              <span class="comment">// Fill</span> the object stack if needed&nbsp;</div></li><li><div>              $cpfn = $this-&gt;current_parser-&gt;filename;&nbsp;</div></li><li><div>              if (!isset($this-&gt;_don_obj_stack[$cpfn][$value[1]])) {&nbsp;</div></li><li><div>                  $this-&gt;_newobj(false, true);&nbsp;</div></li><li><div>                  $this-&gt;_obj_stack[$cpfn][$value[1]] = array($this-&gt;n, $value);&nbsp;</div></li><li><div>                  $this-&gt;_don_obj_stack[$cpfn][$value[1]] = array($this-&gt;n, $value);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $objid = $this-&gt;_don_obj_stack[$cpfn][$value[1]][0];&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;{$objid} 0 R&quot;); <span class="comment">//{$value[2]}</span>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_STRING :&nbsp;</div></li><li><div>              if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>                  $value[1] = $this-&gt;_RC4($this-&gt;_objectkey($this-&gt;_current_obj_id), $value[1]);&nbsp;</div></li><li><div>                  $value[1] = $this-&gt;_escape($value[1]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">// A string.</span>&nbsp;</div></li><li><div>              $this-&gt;_out('(' . $value[1] . ')');&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_STREAM :&nbsp;</div></li><li><div>              <span class="comment">// A stream. First, output the</span>&nbsp;</div></li><li><div>              <span class="comment">// stream dictionary, then the</span>&nbsp;</div></li><li><div>              <span class="comment">// stream data itself.</span>&nbsp;</div></li><li><div>              $this-&gt;pdf_write_value($value[1]);&nbsp;</div></li><li><div>              if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>                  $value[2][1] = $this-&gt;_RC4($this-&gt;_objectkey($this-&gt;_current_obj_id), $value[2][1]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;stream&quot;);&nbsp;</div></li><li><div>              $this-&gt;_out($value[2][1]);&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;endstream&quot;);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_HEX :&nbsp;</div></li><li><div>              if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>                  $value[1] = $this-&gt;hex2str($value[1]);&nbsp;</div></li><li><div>                  $value[1] = $this-&gt;_RC4($this-&gt;_objectkey($this-&gt;_current_obj_id), $value[1]);&nbsp;</div></li><li><div>                  <span class="comment">// remake hexstring of encrypted string</span>&nbsp;</div></li><li><div>                  $value[1] = $this-&gt;str2hex($value[1]);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;&lt;&quot; . $value[1] . &quot;&gt;&quot;);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_BOOLEAN :&nbsp;</div></li><li><div>              $this-&gt;_out($value[1] ? 'true' : 'false');&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case pdf_parser::TYPE_NULL :&nbsp;</div></li><li><div>              <span class="comment">// The null object.</span>&nbsp;</div></li><li><div>              $this-&gt;_out(&quot;null&quot;);&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// ========== OVERWRITE SEARCH STRING IN A PDF FILE ================</span>&nbsp;</div></li><li><div>  function OverWrite($file_in, $search, $replacement, $dest = &quot;D&quot;, $file_out = &quot;mpdf&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $pdf = file_get_contents($file_in);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!is_array($search)) {&nbsp;</div></li><li><div>          $x = $search;&nbsp;</div></li><li><div>          $search = array($x);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (!is_array($replacement)) {&nbsp;</div></li><li><div>          $x = $replacement;&nbsp;</div></li><li><div>          $replacement = array($x); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// mPDF 5.7</span></span></span></span></span></span></span></span></span></span>.4</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;onlyCoreFonts && !$this-&gt;usingCoreFont) {&nbsp;</div></li><li><div>          foreach ($search AS $k =&gt; $val) {&nbsp;</div></li><li><div>              $search[$k] = $this-&gt;UTF8ToUTF16BE($search[$k], false);&nbsp;</div></li><li><div>              $search[$k] = $this-&gt;_escape($search[$k]);&nbsp;</div></li><li><div>              $replacement[$k] = $this-&gt;UTF8ToUTF16BE($replacement[$k], false);&nbsp;</div></li><li><div>              $replacement[$k] = $this-&gt;_escape($replacement[$k]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          foreach ($replacement AS $k =&gt; $val) {&nbsp;</div></li><li><div>              $replacement[$k] = mb_convert_encoding($replacement[$k], $this-&gt;mb_enc, 'utf-8');&nbsp;</div></li><li><div>              $replacement[$k] = $this-&gt;_escape($replacement[$k]);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get xref into array</span>&nbsp;</div></li><li><div>      $xref = array();&nbsp;</div></li><li><div>      preg_match(&quot;/xref\n0 (\d+)\n(.*?)\ntrailer/s&quot;, $pdf, $m);&nbsp;</div></li><li><div>      $xref_objid = $m[1];&nbsp;</div></li><li><div>      preg_match_all('/(\d{10}) (\d{5}) (f|n)/', $m[2], $x);&nbsp;</div></li><li><div>      for ($i = 0; $i &lt; count($x[0]); $i++) {&nbsp;</div></li><li><div>          $xref[] = array(intval($x[1][$i]), $x[2][$i], $x[3][$i]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $changes = array();&nbsp;</div></li><li><div>      preg_match(&quot;/&lt;&lt;\s*\/Type\s*\/Pages\s*\/Kids\s*\[(.*?)\]\s*\/Count/s&quot;, $pdf, $m);&nbsp;</div></li><li><div>      preg_match_all(&quot;/(\d+) 0 R /s&quot;, $m[1], $o);&nbsp;</div></li><li><div>      $objlist = $o[1];&nbsp;</div></li><li><div>      foreach ($objlist AS $obj) {&nbsp;</div></li><li><div>          if ($this-&gt;compress) {&nbsp;</div></li><li><div>              preg_match(&quot;/&quot; . ($obj + 1) . &quot; 0 obj\n&lt;&lt;\s*\/Filter\s*\/FlateDecode\s*\/Length (\d+)&gt;&gt;\nstream\n(.*?)\nendstream\n/s&quot;, $pdf, $m);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              preg_match(&quot;/&quot; . ($obj + 1) . &quot; 0 obj\n&lt;&lt;\s*\/Length (\d+)&gt;&gt;\nstream\n(.*?)\nendstream\n/s&quot;, $pdf, $m);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $s = $m[2];&nbsp;</div></li><li><div>          if (!$s) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $oldlen = $m[1];&nbsp;</div></li><li><div>          if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>              $s = $this-&gt;_RC4($this-&gt;_objectkey($obj + 1), $s);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;compress) {&nbsp;</div></li><li><div>              $s = gzuncompress($s);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          foreach ($search AS $k =&gt; $val) {&nbsp;</div></li><li><div>              $s = str_replace($search[$k], $replacement[$k], $s);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;compress) {&nbsp;</div></li><li><div>              $s = gzcompress($s);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ($this-&gt;encrypted) {&nbsp;</div></li><li><div>              $s = $this-&gt;_RC4($this-&gt;_objectkey($obj + 1), $s);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $newlen = strlen($s);&nbsp;</div></li><li><div>          $changes[($xref[$obj + 1][0])] = ($newlen - $oldlen) + (strlen($newlen) - strlen($oldlen));&nbsp;</div></li><li><div>          if ($this-&gt;compress) {&nbsp;</div></li><li><div>              $newstr = ($obj + 1) . &quot; 0 obj\n&lt;&lt;/Filter /FlateDecode /Length &quot; . $newlen . &quot;&gt;&gt;\nstream\n&quot; . $s . &quot;\nendstream\n&quot;;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $newstr = ($obj + 1) . &quot; 0 obj\n&lt;&lt;/Length &quot; . $newlen . &quot;&gt;&gt;\nstream\n&quot; . $s . &quot;\nendstream\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $pdf = str_replace($m[0], $newstr, $pdf);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Update xref in PDF</span>&nbsp;</div></li><li><div>      krsort($changes);&nbsp;</div></li><li><div>      $newxref = &quot;xref\n0 &quot; . $xref_objid . &quot;\n&quot;;&nbsp;</div></li><li><div>      foreach ($xref AS $v) {&nbsp;</div></li><li><div>          foreach ($changes AS $ck =&gt; $cv) {&nbsp;</div></li><li><div>              if ($v[0] &gt; $ck) {&nbsp;</div></li><li><div>                  $v[0] += $cv;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $newxref .= sprintf('%010d', $v[0]) . ' ' . $v[1] . ' ' . $v[2] . &quot; \n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $newxref .= &quot;trailer&quot;;&nbsp;</div></li><li><div>      $pdf = preg_replace(&quot;/xref\n0 \d+\n.*?\ntrailer/s&quot;, $newxref, $pdf);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Update startxref in PDF</span>&nbsp;</div></li><li><div>      preg_match(&quot;/startxref\n(\d+)\n%%EOF/s&quot;, $pdf, $m);&nbsp;</div></li><li><div>      $startxref = $m[1];&nbsp;</div></li><li><div>      $startxref += array_sum($changes);&nbsp;</div></li><li><div>      $pdf = preg_replace(&quot;/startxref\n(\d+)\n%%EOF/s&quot;, &quot;startxref\n&quot; . $startxref . &quot;\n%%EOF&quot;, $pdf);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// OUTPUT</span>&nbsp;</div></li><li><div>      switch ($dest) {&nbsp;</div></li><li><div>          case 'I':&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Send to standard output</span></span>&nbsp;</div></li><li><div>              if (isset($_SERVER['SERVER_NAME'])) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">//We send to a browser</span></span>&nbsp;</div></li><li><div>                  Header('Content-Type: application/pdf');&nbsp;</div></li><li><div>                  Header('Content-Length: ' . strlen($pdf));&nbsp;</div></li><li><div>                  Header('Content-disposition: inline; filename=' . $file_out);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              echo $pdf;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'F':&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">//Save to local file</span></span></span>&nbsp;</div></li><li><div>              if (!$file_out) {&nbsp;</div></li><li><div>                  $file_out = 'mpdf.pdf';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $f = fopen($file_out, 'wb');&nbsp;</div></li><li><div>              if (!$f)&nbsp;</div></li><li><div>                  throw new MpdfException('Unable to create output file: ' . $file_out);&nbsp;</div></li><li><div>              fwrite($f, $pdf, strlen($pdf));&nbsp;</div></li><li><div>              fclose($f);&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'S':&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Return as a string</span></span>&nbsp;</div></li><li><div>              return $pdf;&nbsp;</div></li><li><div>          case 'D':&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">//Download file</span></span>&nbsp;</div></li><li><div>              if (isset($_SERVER['HTTP_USER_AGENT']) and strpos($_SERVER['HTTP_USER_AGENT'], 'MSIE'))&nbsp;</div></li><li><div>                  Header('Content-Type: application/force-download');&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  Header('Content-Type: application/octet-stream');&nbsp;</div></li><li><div>              Header('Content-Length: ' . strlen($pdf));&nbsp;</div></li><li><div>              Header('Content-disposition: attachment; filename=' . $file_out);&nbsp;</div></li><li><div>              echo $pdf;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function GetTemplateSize($tplidx, $_w = 0, $_h = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!$this-&gt;tpls[$tplidx])&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      $w = $this-&gt;tpls[$tplidx]['box']['w'];&nbsp;</div></li><li><div>      $h = $this-&gt;tpls[$tplidx]['box']['h'];&nbsp;</div></li><li><div>      if ($_w == 0 and $_h == 0) {&nbsp;</div></li><li><div>          $_w = $w;&nbsp;</div></li><li><div>          $_h = $h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($_w == 0)&nbsp;</div></li><li><div>          $_w = $_h * $w / $h;&nbsp;</div></li><li><div>      if ($_h == 0)&nbsp;</div></li><li><div>          $_h = $_w * $h / $w;&nbsp;</div></li><li><div>      return array(&quot;w&quot; =&gt; $_w, &quot;h&quot; =&gt; $_h);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function Thumbnail($file, $npr = 3, $spacing = 10)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">//$npr = number per row</span>&nbsp;</div></li><li><div>      $w = (($this-&gt;pgwidth + $spacing) / $npr) - $spacing;&nbsp;</div></li><li><div>      $oldlinewidth = $this-&gt;LineWidth;&nbsp;</div></li><li><div>      $this-&gt;SetLineWidth(0.02);&nbsp;</div></li><li><div>      $this-&gt;SetDColor($this-&gt;ConvertColor(0));&nbsp;</div></li><li><div>      $h = 0;&nbsp;</div></li><li><div>      $maxh = 0;&nbsp;</div></li><li><div>      $x = $_x = $this-&gt;lMargin;&nbsp;</div></li><li><div>      $_y = $this-&gt;tMargin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;y == 0) {&nbsp;</div></li><li><div>          $y = $_y;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $y = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $pagecount = $this-&gt;SetSourceFile($file);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ($n = 1; $n &lt;= $pagecount; $n++) {&nbsp;</div></li><li><div>          $tplidx = $this-&gt;ImportPage($n);&nbsp;</div></li><li><div>          $size = $this-&gt;useTemplate($tplidx, $x, $y, $w);&nbsp;</div></li><li><div>          $this-&gt;Rect($x, $y, $size['w'], $size['h']);&nbsp;</div></li><li><div>          $h = max($h, $size['h']);&nbsp;</div></li><li><div>          $maxh = max($h, $maxh);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ($n % $npr == 0) {&nbsp;</div></li><li><div>              if (($y + $h + $spacing + $maxh) &gt; $this-&gt;PageBreakTrigger && $n != $pagecount) {&nbsp;</div></li><li><div>                  $this-&gt;AddPage();&nbsp;</div></li><li><div>                  $x = $_x;&nbsp;</div></li><li><div>                  $y = $_y;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $y += $h + $spacing;&nbsp;</div></li><li><div>                  $x = $_x;&nbsp;</div></li><li><div>                  $h = 0;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $x += $w + $spacing;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;SetLineWidth($oldlinewidth);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetSourceFile($filename)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;current_filename = $filename;&nbsp;</div></li><li><div>      $fn = $this-&gt;current_filename;&nbsp;</div></li><li><div>      if (!isset($this-&gt;parsers[$fn])) {&nbsp;</div></li><li><div>          <span class="comment">// $this-&gt;parsers[$fn] =& new fpdi_pdf_parser($fn, $this);</span>&nbsp;</div></li><li><div>          try {&nbsp;</div></li><li><div>              $this-&gt;parsers[$fn] = new fpdi_pdf_parser($fn, $this);&nbsp;</div></li><li><div>          } catch (Exception $e) {&nbsp;</div></li><li><div>              throw new MpdfException($e-&gt;getMessage()); <span class="comment">// Delete this line to return false on fail</span>&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;current_parser = $this-&gt;parsers[$fn];&nbsp;</div></li><li><div>      return $this-&gt;parsers[$fn]-&gt;getPageCount();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function ImportPage($pageno = 1, $crop_x = null, $crop_y = null, $crop_w = 0, $crop_h = 0, $boxName = '/CropBox')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $fn = $this-&gt;current_filename;&nbsp;</div></li><li><div>      $parser = $this-&gt;parsers[$fn];&nbsp;</div></li><li><div>      $parser-&gt;setPageno($pageno);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;tpl++;&nbsp;</div></li><li><div>      $this-&gt;tpls[$this-&gt;tpl] = array();&nbsp;</div></li><li><div>      $tpl = & $this-&gt;tpls[$this-&gt;tpl];&nbsp;</div></li><li><div>      $tpl['parser'] = $parser;&nbsp;</div></li><li><div>      $tpl['resources'] = $parser-&gt;getPageResources();&nbsp;</div></li><li><div>      $tpl['buffer'] = $parser-&gt;getContent();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!in_array($boxName, $parser-&gt;availableBoxes)) {&nbsp;</div></li><li><div>          throw new MpdfException(sprintf(&quot;Unknown box: %s&quot;, $boxName));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $pageboxes = $parser-&gt;getPageBoxes($pageno, _MPDFK);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * MediaBox</span>&nbsp;</div></li><li><div><span class="comment">       * CropBox: Default -&gt; MediaBox</span>&nbsp;</div></li><li><div><span class="comment">       * BleedBox: Default -&gt; CropBox</span>&nbsp;</div></li><li><div><span class="comment">       * TrimBox: Default -&gt; CropBox</span>&nbsp;</div></li><li><div><span class="comment">       * ArtBox: Default -&gt; CropBox</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if (!isset($pageboxes[$boxName]) && ($boxName == &quot;/BleedBox&quot; || $boxName == &quot;/TrimBox&quot; || $boxName == &quot;/ArtBox&quot;)) {&nbsp;</div></li><li><div>          $boxName = &quot;/CropBox&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!isset($pageboxes[$boxName]) && $boxName == &quot;/CropBox&quot;) {&nbsp;</div></li><li><div>          $boxName = &quot;/MediaBox&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!isset($pageboxes[$boxName])) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $box = $pageboxes[$boxName];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tpl['box'] = $box;&nbsp;</div></li><li><div>      <span class="comment">// To build an array that can be used by useTemplate()</span>&nbsp;</div></li><li><div>      $this-&gt;tpls[$this-&gt;tpl] = array_merge($this-&gt;tpls[$this-&gt;tpl], $box);&nbsp;</div></li><li><div>      <span class="comment">// An imported page will start at 0, 0 everytime. Translation will be set in _putformxobjects()</span>&nbsp;</div></li><li><div>      $tpl['x'] = 0;&nbsp;</div></li><li><div>      $tpl['y'] = 0;&nbsp;</div></li><li><div>      $tpl['w'] = $tpl['box']['w'];&nbsp;</div></li><li><div>      $tpl['h'] = $tpl['box']['h'];&nbsp;</div></li><li><div>      if ($crop_w) {&nbsp;</div></li><li><div>          $tpl['box']['w'] = $crop_w;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ($crop_h) {&nbsp;</div></li><li><div>          $tpl['box']['h'] = $crop_h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($crop_x)) {&nbsp;</div></li><li><div>          $tpl['box']['x'] = $crop_x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if (isset($crop_y)) {&nbsp;</div></li><li><div>          $tpl['box']['y'] = $tpl['h'] - $crop_y - $crop_h;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// fix for rotated pages</span>&nbsp;</div></li><li><div>      $rotation = $parser-&gt;getPageRotation($pageno);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($rotation[1]) && ($angle = $rotation[1] % 360) != 0 && $tpl['box']['w'] == $tpl['w']) {&nbsp;</div></li><li><div>          $steps = $angle / 90;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $_w = $tpl['w'];&nbsp;</div></li><li><div>          $_h = $tpl['h'];&nbsp;</div></li><li><div>          $tpl['w'] = $steps % 2 == 0 ? $_w : $_h;&nbsp;</div></li><li><div>          $tpl['h'] = $steps % 2 == 0 ? $_h : $_w;&nbsp;</div></li><li><div>          if ($steps % 2 != 0) {&nbsp;</div></li><li><div>              $x = $y = ($steps == 1 || $steps == -3) ? $tpl['h'] : $tpl['w'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $x = $tpl['w'];&nbsp;</div></li><li><div>              $y = $tpl['h'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $cx = ($x / 2 + $tpl['box']['x']) * _MPDFK;&nbsp;</div></li><li><div>          $cy = ($y / 2 + $tpl['box']['y']) * _MPDFK;&nbsp;</div></li><li><div>          $angle*=-1;&nbsp;</div></li><li><div>          $angle*=M_PI / 180;&nbsp;</div></li><li><div>          $c = cos($angle);&nbsp;</div></li><li><div>          $s = sin($angle);&nbsp;</div></li><li><div>          $tpl['box']['w'] = $tpl['w'];&nbsp;</div></li><li><div>          $tpl['box']['h'] = $tpl['h'];&nbsp;</div></li><li><div>          $tpl['buffer'] = sprintf('q %.5F %.5F %.5F %.5F %.2F %.2F cm 1 0 0 1 %.2F %.2F cm %s Q', $c, $s, -$s, $c, $cx, $cy, -$cx, -$cy, $tpl['buffer']);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $this-&gt;tpl;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function UseTemplate($tplidx, $_x = null, $_y = null, $_w = 0, $_h = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!isset($this-&gt;tpls[$tplidx])) {&nbsp;</div></li><li><div>          throw new MpdfException(&quot;Template does not exist!&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($this-&gt;state == 0) {&nbsp;</div></li><li><div>          $this-&gt;AddPage();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $out = 'q 0 J 1 w 0 j 0 G' . &quot;\n&quot;; <span class="comment">// reset</span> standard values&nbsp;</div></li><li><div>      $x = $this-&gt;tpls[$tplidx]['x'];&nbsp;</div></li><li><div>      $y = $this-&gt;tpls[$tplidx]['y'];&nbsp;</div></li><li><div>      $w = $this-&gt;tpls[$tplidx]['w'];&nbsp;</div></li><li><div>      $h = $this-&gt;tpls[$tplidx]['h'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($_x == null) {&nbsp;</div></li><li><div>          $_x = $x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($_y == null) {&nbsp;</div></li><li><div>          $_y = $y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($_x === -1) {&nbsp;</div></li><li><div>          $_x = $this-&gt;x;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($_y === -1) {&nbsp;</div></li><li><div>          $_y = $this-&gt;y;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wh = $this-&gt;getTemplateSize($tplidx, $_w, $_h);&nbsp;</div></li><li><div>      $_w = $wh['w'];&nbsp;</div></li><li><div>      $_h = $wh['h'];&nbsp;</div></li><li><div>      $out .= sprintf(&quot;q %.4F 0 0 %.4F %.2F %.2F cm&quot;, ($_w / $this-&gt;tpls[$tplidx]['box']['w']), ($_h / $this-&gt;tpls[$tplidx]['box']['h']), $_x * _MPDFK, ($this-&gt;h - ($_y + $_h)) * _MPDFK) . &quot;\n&quot;;&nbsp;</div></li><li><div>      $out .= $this-&gt;tplprefix . $tplidx . &quot; Do Q\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $s = array(&quot;w&quot; =&gt; $_w, &quot;h&quot; =&gt; $_h);&nbsp;</div></li><li><div>      $out .= &quot;Q\n&quot;;&nbsp;</div></li><li><div>      $this-&gt;pages[$this-&gt;page] = $out . $this-&gt;pages[$this-&gt;page];&nbsp;</div></li><li><div>      return $s;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetPageTemplate($tplidx = '')&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if (!isset($this-&gt;tpls[$tplidx])) {&nbsp;</div></li><li><div>          $this-&gt;pageTemplate = '';&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;pageTemplate = $tplidx;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetDocTemplate($file = '', $continue = 0)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;docTemplate = $file;&nbsp;</div></li><li><div>      $this-&gt;docTemplateContinue = $continue;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** -- END IMPORTS -- */</span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** ---------------------------------------------- */</span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** ---------------------------------------------- */</span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** ---------------------------------------------- */</span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** ---------------------------------------------- */</span></span></span></span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** ---------------------------------------------- */</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// JAVASCRIPT</span>&nbsp;</div></li><li><div>  function _set_object_javascript($string)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;_newobj();&nbsp;</div></li><li><div>      $this-&gt;_out('&lt;&lt;');&nbsp;</div></li><li><div>      $this-&gt;_out('/S /JavaScript ');&nbsp;</div></li><li><div>      $this-&gt;_out('/JS ' . $this-&gt;_textstring($string));&nbsp;</div></li><li><div>      $this-&gt;_out('&gt;&gt;');&nbsp;</div></li><li><div>      $this-&gt;_out('endobj');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function SetJS($script)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;js = $script;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Gravity PDF</li><li><span></span>4.1.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>