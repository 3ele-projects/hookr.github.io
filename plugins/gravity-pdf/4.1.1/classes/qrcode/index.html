<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="4.1.1" data-slug="gravity-pdf" data-type="class" data-id="20888"><head xmlns="http://www.w3.org/1999/xhtml"><title> qrcode | class | Gravity Pdf | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="QRcode, class, plugin, gravity-pdf, 4.1.1" /><meta name="description" content="The Gravity PDF QRcode class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.12"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=0bd7ba0512715a5496ada920d418903f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.12' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/qrcode/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fqrcode%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fqrcode%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-gravity-pdf-4.1.1-class-qrcode","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="qrcode" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to gravity-pdf." href="http://hookr.io/plugins/gravity-pdf/" class="plugin"><span property="name">gravity-pdf</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.1.1." href="http://hookr.io/plugins/gravity-pdf/4.1.1/" class="H_VERSION"><span property="name">4.1.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/gravity-pdf/4.1.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">qrcode</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="696"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/all/" title="All">All <span class="count badge">696</span></a></li><li class="" data-id="new" data-count="2"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/new/" title="New">New <span class="count badge">2</span></a></li><li class="" data-id="hooks" data-count="177"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/hooks/" title="Hooks">Hooks <span class="count badge">177</span></a></li><li class="" data-id="action" data-count="15"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/actions/" title="Actions">Actions <span class="count badge">15</span></a></li><li class="" data-id="filter" data-count="162"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/filters/" title="Filters">Filters <span class="count badge">162</span></a></li><li class="active" data-id="class" data-count="411"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/classes/" title="Classes">Classes <span class="count badge">411</span></a></li><li class="" data-id="constant" data-count="64"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/constants/" title="Constants">Constants <span class="count badge">64</span></a></li><li class="" data-id="function" data-count="43"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/functions/" title="Functions">Functions <span class="count badge">43</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>QRcode</strong></h1><p>The Gravity PDF <strong>QRcode</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/files/vendor-blueliquiddesigns-mpdf-qrcode-qrcode-class/" class="file">/vendor/blueliquiddesigns/mpdf/qrcode/qrcode.class.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="17" class="block" start="17"><li><div>class QRcode&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    private $version_mx = 40;        // numero de version maximal autoris&nbsp;</div></li><li><div>    private $type = 'bin';    // type de donne&nbsp;</div></li><li><div>    private $level = 'L';        // ECC&nbsp;</div></li><li><div>    private $value = '';        // valeur a encoder&nbsp;</div></li><li><div>    private $length = 0;        // taille de la valeur&nbsp;</div></li><li><div>    private $version = 0;        // version&nbsp;</div></li><li><div>    private $size = 0;        // dimension de la zone data&nbsp;</div></li><li><div>    private $qr_size = 0;        // dimension du QRcode&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private $data_bit = array();    // nb de bit de chacune des valeurs&nbsp;</div></li><li><div>    private $data_val = array();    // liste des valeurs de bit diffrents&nbsp;</div></li><li><div>    private $data_word = array();    // liste des valeurs tout ramen  8bit&nbsp;</div></li><li><div>    private $data_cur = 0;        // position courante&nbsp;</div></li><li><div>    private $data_num = 0;        // position de la dimension&nbsp;</div></li><li><div>    private $data_bits = 0;        // nom de bit au total&nbsp;</div></li><li><div>    private $max_data_bit = 0;    // lilmite de nombre de bit maximal pour les datas&nbsp;</div></li><li><div>    private $max_data_word = 0;    // lilmite de nombre de mot maximal pour les datas&nbsp;</div></li><li><div>    private $max_word = 0;        // lilmite de nombre de mot maximal en global&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private $ec = 0;&nbsp;</div></li><li><div>    private $matrix = array();&nbsp;</div></li><li><div>    private $matrix_remain = 0; &nbsp;</div></li><li><div>    private $matrix_x_array = array();&nbsp;</div></li><li><div>    private $matrix_y_array = array();&nbsp;</div></li><li><div>    private $mask_array = array();&nbsp;</div></li><li><div>    private $format_information_x1 = array();&nbsp;</div></li><li><div>    private $format_information_y1 = array();&nbsp;</div></li><li><div>    private $format_information_x2 = array();&nbsp;</div></li><li><div>    private $format_information_y2 = array();&nbsp;</div></li><li><div>    private $rs_block_order = array();&nbsp;</div></li><li><div>    private $rs_ecc_codewords = 0;&nbsp;</div></li><li><div>    private $byte_num = 0;&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private $final = array();&nbsp;</div></li><li><div>    private $disable_border = false;&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructeur&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param    string        message a encoder&nbsp;</div></li><li><div>     * @param    string        niveau de correction d'erreur (ECC) : L, M, Q, H&nbsp;</div></li><li><div>     * @return    null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct($value, $level='L')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!in_array($level, array('L', 'M', 'Q', 'H')))&nbsp;</div></li><li><div>            $this-&gt;ERROR('ECC non reconnu : L, M, Q, H');&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $this-&gt;length = strlen($value);&nbsp;</div></li><li><div>        if (!$this-&gt;length)&nbsp;</div></li><li><div>            $this-&gt;ERROR('pas de data...');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;level = $level;&nbsp;</div></li><li><div>        $this-&gt;value = &$value;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $this-&gt;data_bit = array();&nbsp;</div></li><li><div>        $this-&gt;data_val = array();&nbsp;</div></li><li><div>        $this-&gt;data_cur = 0;&nbsp;</div></li><li><div>        $this-&gt;data_bits= 0;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $this-&gt;encode();&nbsp;</div></li><li><div>        $this-&gt;loadECC();&nbsp;</div></li><li><div>        $this-&gt;makeECC();&nbsp;</div></li><li><div>        $this-&gt;makeMatrix();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * permet de recuperer la taille du QRcode (le nombre de case de ct)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return    int    size of qrcode&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function getQrSize()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;disable_border)&nbsp;</div></li><li><div>            return $this-&gt;qr_size-8;    &nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return $this-&gt;qr_size;    &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function disableBorder()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;disable_border = true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * permet d'afficher le QRcode dans un pdf via FPDF&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param    FPDF    objet fpdf&nbsp;</div></li><li><div>     * @param    float    position X&nbsp;</div></li><li><div>     * @param    float    position Y&nbsp;</div></li><li><div>     * @param    float    taille du qrcode&nbsp;</div></li><li><div>     * @param    array    couleur du background (R, V, B)&nbsp;</div></li><li><div>     * @param    array    couleur des cases et du border (R, V, B)&nbsp;</div></li><li><div>     * @return    boolean true;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function displayFPDF(&$fpdf, $x, $y, $w, $background=array(255, 255, 255), $color=array(0, 0, 0))&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $size = $w;&nbsp;</div></li><li><div>        $s = $size/$this-&gt;getQrSize();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fpdf-&gt;SetDrawColor($color[0], $color[1], $color[2]);&nbsp;</div></li><li><div>        $fpdf-&gt;SetFillColor($background[0], $background[1], $background[2]);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // rectangle de fond&nbsp;</div></li><li><div>        if ($this-&gt;disable_border)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $s_min = 4;&nbsp;</div></li><li><div>            $s_max = $this-&gt;qr_size-4;&nbsp;</div></li><li><div>            $fpdf-&gt;Rect($x, $y, $size, $size, 'F');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $s_min = 0;&nbsp;</div></li><li><div>            $s_max = $this-&gt;qr_size;&nbsp;</div></li><li><div>            $fpdf-&gt;Rect($x, $y, $size, $size, 'FD');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $fpdf-&gt;SetFillColor($color[0], $color[1], $color[2]);&nbsp;</div></li><li><div>        for($j=$s_min; $j&lt;$s_max; $j++)&nbsp;</div></li><li><div>            for($i=$s_min; $i&lt;$s_max; $i++)&nbsp;</div></li><li><div>                if ($this-&gt;final[$i + $j*$this-&gt;qr_size+1])&nbsp;</div></li><li><div>                    $fpdf-&gt;Rect($x+($i-$s_min)*$s, $y+($j-$s_min)*$s, $s, $s, 'F');&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * permet d'afficher le QRcode au format HTML, utiliser avec un style CSS&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return    boolean true;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function displayHTML()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;disable_border)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $s_min = 4;&nbsp;</div></li><li><div>            $s_max = $this-&gt;qr_size-4;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $s_min = 0;&nbsp;</div></li><li><div>            $s_max = $this-&gt;qr_size;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        echo '&lt;table class=&quot;qr&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>        for($y=$s_min; $y&lt;$s_max; $y++)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            echo '&lt;tr&gt;';&nbsp;</div></li><li><div>            for($x=$s_min; $x&lt;$s_max; $x++)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                echo '&lt;td class=&quot;'.($this-&gt;final[$x + $y*$this-&gt;qr_size+1] ? 'on' : 'off').'&quot;&gt;&lt;/td&gt;';    &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            echo '&lt;/tr&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        echo '&lt;/table&gt;';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * permet d'obtenir une image PNG&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param    float    taille du qrcode&nbsp;</div></li><li><div>     * @param    array    couleur du background (R, V, B)&nbsp;</div></li><li><div>     * @param    array    couleur des cases et du border (R, V, B)&nbsp;</div></li><li><div>     * @param    string    nom du fichier de sortie. si null : sortie directe&nbsp;</div></li><li><div>     * @param    integer    qualit de 0 (aucune compression) a 9&nbsp;</div></li><li><div>     * @return    boolean    true;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function displayPNG($w=100, $background=array(255, 255, 255), $color=array(0, 0, 0), $filename = null, $quality = 0)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;disable_border)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $s_min = 4;&nbsp;</div></li><li><div>            $s_max = $this-&gt;qr_size-4;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $s_min = 0;&nbsp;</div></li><li><div>            $s_max = $this-&gt;qr_size;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $size = $w;&nbsp;</div></li><li><div>        $s = $size/($s_max-$s_min);&nbsp;</div></li><li><div>         &nbsp;</div></li><li><div>        // rectangle de fond&nbsp;</div></li><li><div>        $im = imagecreatetruecolor($size, $size);&nbsp;</div></li><li><div>        $c_case = imagecolorallocate($im, $color[0], $color[1], $color[2]);&nbsp;</div></li><li><div>        $c_back = imagecolorallocate($im, $background[0], $background[1], $background[2]);&nbsp;</div></li><li><div>        imagefilledrectangle($im, 0, 0, $size, $size, $c_back);&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>        for($j=$s_min; $j&lt;$s_max; $j++)&nbsp;</div></li><li><div>            for($i=$s_min; $i&lt;$s_max; $i++)&nbsp;</div></li><li><div>                if ($this-&gt;final[$i + $j*$this-&gt;qr_size+1])&nbsp;</div></li><li><div>                    imagefilledrectangle($im, ($i-$s_min)*$s, ($j-$s_min)*$s, ($i-$s_min+1)*$s-1, ($j-$s_min+1)*$s-1, $c_case);&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>        if ($filename)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            imagepng($im, $filename, $quality);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            header(&quot;Content-type: image/png&quot;);&nbsp;</div></li><li><div>            imagepng($im);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        imagedestroy($im);&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private function ERROR($msg)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        echo 'ERROR : '.$msg;&nbsp;</div></li><li><div>        exit;    &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private function addData($val, $bit, $next = true)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;data_val[$this-&gt;data_cur] = $val;&nbsp;</div></li><li><div>        $this-&gt;data_bit[$this-&gt;data_cur] = $bit;&nbsp;</div></li><li><div>        if ($next)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;data_cur++;&nbsp;</div></li><li><div>            return $this-&gt;data_cur-1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            return $this-&gt;data_cur;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private function encode()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // conversion des datas&nbsp;</div></li><li><div>        if (preg_match('/[^0-9]/', $this-&gt;value))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if (preg_match('/[^0-9A-Z \$\*\%\+\-\.\/\:]/', $this-&gt;value))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // type : bin&nbsp;</div></li><li><div>                $this-&gt;type = 'bin';&nbsp;</div></li><li><div>                $this-&gt;addData(4, 4);&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                // taille. il faut garder l'indice, car besoin de correction&nbsp;</div></li><li><div>                $this-&gt;data_num = $this-&gt;addData($this-&gt;length, 8); /** #version 1-9 */&nbsp;</div></li><li><div>                $data_num_correction=array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8);&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                // datas&nbsp;</div></li><li><div>                for ($i=0; $i&lt;$this-&gt;length; $i++)&nbsp;</div></li><li><div>                    $this-&gt;addData(ord(substr($this-&gt;value, $i, 1)), 8);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // type : alphanum    &nbsp;</div></li><li><div>                $this-&gt;type = 'alphanum';&nbsp;</div></li><li><div>                $this-&gt;addData(2, 4);&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                // taille. il faut garder l'indice, car besoin de correction&nbsp;</div></li><li><div>                $this-&gt;data_num = $this-&gt;addData($this-&gt;length, 9); /** #version 1-9 */&nbsp;</div></li><li><div>                $data_num_correction=array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4);&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                // datas&nbsp;</div></li><li><div>                $an_hash=array(&nbsp;</div></li><li><div>                    '0'=&gt;0, '1'=&gt;1, '2'=&gt;2, '3'=&gt;3, '4'=&gt;4, '5'=&gt;5, '6'=&gt;6, '7'=&gt;7, '8'=&gt;8, '9'=&gt;9, &nbsp;</div></li><li><div>                    'A'=&gt;10, 'B'=&gt;11, 'C'=&gt;12, 'D'=&gt;13, 'E'=&gt;14, 'F'=&gt;15, 'G'=&gt;16, 'H'=&gt;17, 'I'=&gt;18, 'J'=&gt;19, 'K'=&gt;20, 'L'=&gt;21, 'M'=&gt;22, &nbsp;</div></li><li><div>                    'N'=&gt;23, 'O'=&gt;24, 'P'=&gt;25, 'Q'=&gt;26, 'R'=&gt;27, 'S'=&gt;28, 'T'=&gt;29, 'U'=&gt;30, 'V'=&gt;31, 'W'=&gt;32, 'X'=&gt;33, 'Y'=&gt;34, 'Z'=&gt;35, &nbsp;</div></li><li><div>                    ' '=&gt;36, '$'=&gt;37, '%'=&gt;38, '*'=&gt;39, '+'=&gt;40, '-'=&gt;41, '.'=&gt;42, '/'=&gt;43, ':'=&gt;44);&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                for ($i=0; $i&lt;$this-&gt;length; $i++)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    if (($i %2)==0)&nbsp;</div></li><li><div>                        $this-&gt;addData($an_hash[substr($this-&gt;value, $i, 1)], 6, false);&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $this-&gt;addData($this-&gt;data_val[$this-&gt;data_cur]*45+$an_hash[substr($this-&gt;value, $i, 1)], 11, true);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                unset($an_hash);&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                if (isset($this-&gt;data_bit[$this-&gt;data_cur]))&nbsp;</div></li><li><div>                    $this-&gt;data_cur++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // type : num    &nbsp;</div></li><li><div>            $this-&gt;type = 'num';&nbsp;</div></li><li><div>            $this-&gt;addData(1, 4);&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            //taille. il faut garder l'indice, car besoin de correction&nbsp;</div></li><li><div>            $this-&gt;data_num = $this-&gt;addData($this-&gt;length, 10); /** #version 1-9 */&nbsp;</div></li><li><div>            $data_num_correction=array(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4);&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // datas&nbsp;</div></li><li><div>            for ($i=0; $i&lt;$this-&gt;length; $i++)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                if (($i % 3)==0)&nbsp;</div></li><li><div>                    $this-&gt;addData(substr($this-&gt;value, $i, 1), 4, false);&nbsp;</div></li><li><div>                else if (($i % 3)==1)&nbsp;</div></li><li><div>                    $this-&gt;addData($this-&gt;data_val[$this-&gt;data_cur]*10+substr($this-&gt;value, $i, 1), 7, false);&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $this-&gt;addData($this-&gt;data_val[$this-&gt;data_cur]*10+substr($this-&gt;value, $i, 1), 10);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if (isset($this-&gt;data_bit[$this-&gt;data_cur]))&nbsp;</div></li><li><div>                $this-&gt;data_cur++;&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // calcul du nombre de bits&nbsp;</div></li><li><div>        $this-&gt;data_bits=0;&nbsp;</div></li><li><div>        foreach($this-&gt;data_bit as $bit)&nbsp;</div></li><li><div>            $this-&gt;data_bits+= $bit;&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>        // code ECC&nbsp;</div></li><li><div>        $ec_hash = array('L'=&gt;1, 'M'=&gt;0, 'Q'=&gt;3, 'H'=&gt;2);&nbsp;</div></li><li><div>        $this-&gt;ec = $ec_hash[$this-&gt;level];&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // tableau de taille limite de bits&nbsp;</div></li><li><div>        $max_bits = array(&nbsp;</div></li><li><div>        0, 128, 224, 352, 512, 688, 864, 992, 1232, 1456, 1728, 2032, 2320, 2672, 2920, 3320, 3624, 4056, 4504, 5016, 5352, &nbsp;</div></li><li><div>        5712, 6256, 6880, 7312, 8000, 8496, 9024, 9544, 10136, 10984, 11640, 12328, 13048, 13800, 14496, 15312, 15936, 16816, 17728, 18672, &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        152, 272, 440, 640, 864, 1088, 1248, 1552, 1856, 2192, 2592, 2960, 3424, 3688, 4184, 4712, 5176, 5768, 6360, 6888, &nbsp;</div></li><li><div>        7456, 8048, 8752, 9392, 10208, 10960, 11744, 12248, 13048, 13880, 14744, 15640, 16568, 17528, 18448, 19472, 20528, 21616, 22496, 23648, &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        72, 128, 208, 288, 368, 480, 528, 688, 800, 976, 1120, 1264, 1440, 1576, 1784, 2024, 2264, 2504, 2728, 3080, &nbsp;</div></li><li><div>        3248, 3536, 3712, 4112, 4304, 4768, 5024, 5288, 5608, 5960, 6344, 6760, 7208, 7688, 7888, 8432, 8768, 9136, 9776, 10208, &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        104, 176, 272, 384, 496, 608, 704, 880, 1056, 1232, 1440, 1648, 1952, 2088, 2360, 2600, 2936, 3176, 3560, 3880, &nbsp;</div></li><li><div>        4096, 4544, 4912, 5312, 5744, 6032, 6464, 6968, 7288, 7880, 8264, 8920, 9368, 9848, 10288, 10832, 11408, 12016, 12656, 13328&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // determination automatique de la version necessaire&nbsp;</div></li><li><div>        $this-&gt;version=1; &nbsp;</div></li><li><div>        $i=1+40*$this-&gt;ec;&nbsp;</div></li><li><div>        $j=$i+39;&nbsp;</div></li><li><div>        while ($i&lt;=$j)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if ($max_bits[$i]&gt;=$this-&gt;data_bits+$data_num_correction[$this-&gt;version])&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;max_data_bit=$max_bits[$i];&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $i++;&nbsp;</div></li><li><div>            $this-&gt;version++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // verification max version&nbsp;</div></li><li><div>        if ($this-&gt;version&gt;$this-&gt;version_mx)&nbsp;</div></li><li><div>            $this-&gt;ERROR('too large version.');&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>        // correctif sur le nombre de bits du strlen de la valeur&nbsp;</div></li><li><div>        $this-&gt;data_bits+=$data_num_correction[$this-&gt;version];&nbsp;</div></li><li><div>        $this-&gt;data_bit[$this-&gt;data_num]+=$data_num_correction[$this-&gt;version];&nbsp;</div></li><li><div>        $this-&gt;max_data_word = ($this-&gt;max_data_bit/8);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // nombre de mots maximal&nbsp;</div></li><li><div>        $max_words_array=array(0, 26, 44, 70, 100, 134, 172, 196, 242, 292, 346, 404, 466, 532, 581, 655, 733, 815, 901, 991, 1085, 1156, &nbsp;</div></li><li><div>                        1258, 1364, 1474, 1588, 1706, 1828, 1921, 2051, 2185, 2323, 2465, 2611, 2761, 2876, 3034, 3196, 3362, 3532, 3706);&nbsp;</div></li><li><div>        $this-&gt;max_word = $max_words_array[$this-&gt;version];&nbsp;</div></li><li><div>        $this-&gt;size = 17 + 4*$this-&gt;version;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // nettoyages divers&nbsp;</div></li><li><div>        unset($max_bits);&nbsp;</div></li><li><div>        unset($data_num_correction);&nbsp;</div></li><li><div>        unset($max_words_array);&nbsp;</div></li><li><div>        unset($ec_hash);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // terminator&nbsp;</div></li><li><div>        if ($this-&gt;data_bits&lt;=$this-&gt;max_data_bit-4)&nbsp;</div></li><li><div>            $this-&gt;addData(0, 4);&nbsp;</div></li><li><div>        elseif ($this-&gt;data_bits&lt;$this-&gt;max_data_bit)&nbsp;</div></li><li><div>            $this-&gt;addData(0, $this-&gt;max_data_bit-$this-&gt;data_bits);&nbsp;</div></li><li><div>        elseif ($this-&gt;data_bits&gt;$this-&gt;max_data_bit)&nbsp;</div></li><li><div>            $this-&gt;ERROR('Overflow error');&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>        // construction des mots de 8 bit&nbsp;</div></li><li><div>        $this-&gt;data_word = array();&nbsp;</div></li><li><div>        $this-&gt;data_word[0] = 0;&nbsp;</div></li><li><div>        $nb_word = 0;            &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $remaining_bit=8;&nbsp;</div></li><li><div>        for($i=0; $i&lt;$this-&gt;data_cur; $i++)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $buffer_val=$this-&gt;data_val[$i];&nbsp;</div></li><li><div>            $buffer_bit=$this-&gt;data_bit[$i];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $flag = true;&nbsp;</div></li><li><div>            while ($flag)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                if ($remaining_bit&gt;$buffer_bit)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $this-&gt;data_word[$nb_word]=((@$this-&gt;data_word[$nb_word]&lt;&lt;$buffer_bit) | $buffer_val);&nbsp;</div></li><li><div>                    $remaining_bit-=$buffer_bit;&nbsp;</div></li><li><div>                    $flag=false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $buffer_bit-=$remaining_bit;&nbsp;</div></li><li><div>                    $this-&gt;data_word[$nb_word]=((@$this-&gt;data_word[$nb_word] &lt;&lt; $remaining_bit) | ($buffer_val &gt;&gt; $buffer_bit));&nbsp;</div></li><li><div>                    $nb_word++;&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                    if ($buffer_bit==0)&nbsp;</div></li><li><div>                        $flag=false;&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $buffer_val= ($buffer_val & ((1 &lt;&lt; $buffer_bit)-1) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($nb_word&lt;$this-&gt;max_data_word-1)&nbsp;</div></li><li><div>                        $this-&gt;data_word[$nb_word]=0;&nbsp;</div></li><li><div>                    $remaining_bit=8;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // completion du dernier mot si incomplet&nbsp;</div></li><li><div>        if ($remaining_bit&lt;8)&nbsp;</div></li><li><div>            $this-&gt;data_word[$nb_word]=$this-&gt;data_word[$nb_word] &lt;&lt; $remaining_bit;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $nb_word--;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // remplissage du reste&nbsp;</div></li><li><div>        if ($nb_word&lt;$this-&gt;max_data_word-1)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $flag=true;&nbsp;</div></li><li><div>            while ($nb_word&lt;$this-&gt;max_data_word-1)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $nb_word++;&nbsp;</div></li><li><div>                if ($flag)&nbsp;</div></li><li><div>                    $this-&gt;data_word[$nb_word]=236;&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $this-&gt;data_word[$nb_word]=17;&nbsp;</div></li><li><div>                $flag=!$flag;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private function loadECC()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $matrix_remain_bit=array(0, 0, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0, 0);&nbsp;</div></li><li><div>        $this-&gt;matrix_remain = $matrix_remain_bit[$this-&gt;version];&nbsp;</div></li><li><div>        unset($matrix_remain_bit);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // lecture du fichier : data file of geometry & mask for version V , ecc level N            &nbsp;</div></li><li><div>        $this-&gt;byte_num = $this-&gt;matrix_remain+ 8*$this-&gt;max_word;&nbsp;</div></li><li><div>        $filename = dirname(__FILE__).&quot;/data/qrv&quot;.$this-&gt;version.&quot;_&quot;.$this-&gt;ec.&quot;.dat&quot;;&nbsp;</div></li><li><div>        $fp1 = fopen ($filename, &quot;rb&quot;);&nbsp;</div></li><li><div>            $this-&gt;matrix_x_array = unpack(&quot;C*&quot;, fread($fp1, $this-&gt;byte_num));&nbsp;</div></li><li><div>            $this-&gt;matrix_y_array = unpack(&quot;C*&quot;, fread($fp1, $this-&gt;byte_num));&nbsp;</div></li><li><div>            $this-&gt;mask_array = unpack(&quot;C*&quot;, fread($fp1, $this-&gt;byte_num));&nbsp;</div></li><li><div>            $this-&gt;format_information_x2 = unpack(&quot;C*&quot;, fread($fp1, 15));&nbsp;</div></li><li><div>            $this-&gt;format_information_y2 = unpack(&quot;C*&quot;, fread($fp1, 15));&nbsp;</div></li><li><div>            $this-&gt;rs_ecc_codewords = ord(fread($fp1, 1));&nbsp;</div></li><li><div>            $this-&gt;rs_block_order = unpack(&quot;C*&quot;, fread($fp1, 128));&nbsp;</div></li><li><div>        fclose($fp1);&nbsp;</div></li><li><div>        $this-&gt;format_information_x1 = array(0, 1, 2, 3, 4, 5, 7, 8, 8, 8, 8, 8, 8, 8, 8);&nbsp;</div></li><li><div>        $this-&gt;format_information_y1 = array(8, 8, 8, 8, 8, 8, 8, 8, 7, 5, 4, 3, 2, 1, 0);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private function makeECC()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // lecture du fichier : data file of caluclatin tables for RS encoding&nbsp;</div></li><li><div>        $rs_cal_table_array = array();&nbsp;</div></li><li><div>        $filename = dirname(__FILE__).&quot;/data/rsc&quot;.$this-&gt;rs_ecc_codewords.&quot;.dat&quot;;&nbsp;</div></li><li><div>        $fp0 = fopen ($filename, &quot;rb&quot;);&nbsp;</div></li><li><div>        for($i=0; $i&lt;256; $i++)&nbsp;</div></li><li><div>            $rs_cal_table_array[$i]=fread ($fp0, $this-&gt;rs_ecc_codewords);&nbsp;</div></li><li><div>        fclose ($fp0);    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $max_data_codewords = count($this-&gt;data_word);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // preparation&nbsp;</div></li><li><div>        $j=0;&nbsp;</div></li><li><div>        $rs_block_number=0;&nbsp;</div></li><li><div>        $rs_temp[0]=&quot;&quot;;&nbsp;</div></li><li><div>        for($i=0; $i&lt;$max_data_codewords; $i++)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $rs_temp[$rs_block_number].=chr($this-&gt;data_word[$i]);&nbsp;</div></li><li><div>            $j++;&nbsp;</div></li><li><div>            if ($j&gt;=$this-&gt;rs_block_order[$rs_block_number+1]-$this-&gt;rs_ecc_codewords)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $j=0;&nbsp;</div></li><li><div>                $rs_block_number++;&nbsp;</div></li><li><div>                $rs_temp[$rs_block_number]=&quot;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // make&nbsp;</div></li><li><div>        $rs_block_order_num=count($this-&gt;rs_block_order);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        for($rs_block_number=0; $rs_block_number&lt;$rs_block_order_num; $rs_block_number++)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $rs_codewords=$this-&gt;rs_block_order[$rs_block_number+1];&nbsp;</div></li><li><div>            $rs_data_codewords=$rs_codewords-$this-&gt;rs_ecc_codewords;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $rstemp=$rs_temp[$rs_block_number].str_repeat(chr(0), $this-&gt;rs_ecc_codewords);&nbsp;</div></li><li><div>            $padding_data=str_repeat(chr(0), $rs_data_codewords);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $j=$rs_data_codewords;&nbsp;</div></li><li><div>            while($j&gt;0)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $first=ord(substr($rstemp, 0, 1));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($first)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $left_chr=substr($rstemp, 1);&nbsp;</div></li><li><div>                    $cal=$rs_cal_table_array[$first].$padding_data;&nbsp;</div></li><li><div>                    $rstemp=$left_chr ^ $cal;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $rstemp=substr($rstemp, 1);&nbsp;</div></li><li><div>                $j--;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $this-&gt;data_word=array_merge($this-&gt;data_word, unpack(&quot;C*&quot;, $rstemp));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    private function makeMatrix()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // preparation&nbsp;</div></li><li><div>        $this-&gt;matrix = array_fill(0, $this-&gt;size, array_fill(0, $this-&gt;size, 0));&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // mettre les words&nbsp;</div></li><li><div>        for($i=0; $i&lt;$this-&gt;max_word; $i++)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $word = $this-&gt;data_word[$i];&nbsp;</div></li><li><div>            for($j=8; $j&gt;0; $j--)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $bit_pos = ($i&lt;&lt;3) + $j;&nbsp;</div></li><li><div>                $this-&gt;matrix[ $this-&gt;matrix_x_array[$bit_pos] ][ $this-&gt;matrix_y_array[$bit_pos] ] = ((255*($word & 1)) ^ $this-&gt;mask_array[$bit_pos] ); &nbsp;</div></li><li><div>                $word = $word &gt;&gt; 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        for($k=$this-&gt;matrix_remain; $k&gt;0; $k--)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $bit_pos = $k + ( $this-&gt;max_word &lt;&lt;3);&nbsp;</div></li><li><div>            $this-&gt;matrix[ $this-&gt;matrix_x_array[$bit_pos] ][ $this-&gt;matrix_y_array[$bit_pos] ] = ( 255 ^ $this-&gt;mask_array[$bit_pos] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // mask select&nbsp;</div></li><li><div>        $min_demerit_score=0;&nbsp;</div></li><li><div>        $hor_master=&quot;&quot;;&nbsp;</div></li><li><div>        $ver_master=&quot;&quot;;&nbsp;</div></li><li><div>        $k=0;&nbsp;</div></li><li><div>        while($k&lt;$this-&gt;size)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $l=0;&nbsp;</div></li><li><div>            while($l&lt;$this-&gt;size)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $hor_master=$hor_master.chr($this-&gt;matrix[$l][$k]);&nbsp;</div></li><li><div>                $ver_master=$ver_master.chr($this-&gt;matrix[$k][$l]);&nbsp;</div></li><li><div>                $l++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $k++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $i=0;&nbsp;</div></li><li><div>        $all_matrix=$this-&gt;size * $this-&gt;size;&nbsp;</div></li><li><div>         &nbsp;</div></li><li><div>        while ($i&lt;8)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $demerit_n1=0;&nbsp;</div></li><li><div>            $ptn_temp=array();&nbsp;</div></li><li><div>            $bit= 1&lt;&lt; $i;&nbsp;</div></li><li><div>            $bit_r=(~$bit)&255;&nbsp;</div></li><li><div>            $bit_mask=str_repeat(chr($bit), $all_matrix);&nbsp;</div></li><li><div>            $hor = $hor_master & $bit_mask;&nbsp;</div></li><li><div>            $ver = $ver_master & $bit_mask;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $ver_shift1=$ver.str_repeat(chr(170), $this-&gt;size);&nbsp;</div></li><li><div>            $ver_shift2=str_repeat(chr(170), $this-&gt;size).$ver;&nbsp;</div></li><li><div>            $ver_shift1_0=$ver.str_repeat(chr(0), $this-&gt;size);&nbsp;</div></li><li><div>            $ver_shift2_0=str_repeat(chr(0), $this-&gt;size).$ver;&nbsp;</div></li><li><div>            $ver_or=chunk_split(~($ver_shift1 | $ver_shift2), $this-&gt;size, chr(170));&nbsp;</div></li><li><div>            $ver_and=chunk_split(~($ver_shift1_0 & $ver_shift2_0), $this-&gt;size, chr(170));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $hor=chunk_split(~$hor, $this-&gt;size, chr(170));&nbsp;</div></li><li><div>            $ver=chunk_split(~$ver, $this-&gt;size, chr(170));&nbsp;</div></li><li><div>            $hor=$hor.chr(170).$ver;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $n1_search=&quot;/&quot;.str_repeat(chr(255), 5).&quot;+|&quot;.str_repeat(chr($bit_r), 5).&quot;+/&quot;;&nbsp;</div></li><li><div>            $n3_search=chr($bit_r).chr(255).chr($bit_r).chr($bit_r).chr($bit_r).chr(255).chr($bit_r);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $demerit_n3=substr_count($hor, $n3_search)*40;&nbsp;</div></li><li><div>            $demerit_n4=floor(abs(( (100* (substr_count($ver, chr($bit_r))/($this-&gt;byte_num)) )-50)/5))*10;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $n2_search1=&quot;/&quot;.chr($bit_r).chr($bit_r).&quot;+/&quot;;&nbsp;</div></li><li><div>            $n2_search2=&quot;/&quot;.chr(255).chr(255).&quot;+/&quot;;&nbsp;</div></li><li><div>            $demerit_n2=0;&nbsp;</div></li><li><div>            preg_match_all($n2_search1, $ver_and, $ptn_temp);&nbsp;</div></li><li><div>            foreach($ptn_temp[0] as $str_temp)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $demerit_n2+=(strlen($str_temp)-1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $ptn_temp=array();&nbsp;</div></li><li><div>            preg_match_all($n2_search2, $ver_or, $ptn_temp);&nbsp;</div></li><li><div>            foreach($ptn_temp[0] as $str_temp)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $demerit_n2+=(strlen($str_temp)-1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $demerit_n2*=3;&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $ptn_temp=array();&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            preg_match_all($n1_search, $hor, $ptn_temp);&nbsp;</div></li><li><div>            foreach($ptn_temp[0] as $str_temp)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $demerit_n1+=(strlen($str_temp)-2);&nbsp;</div></li><li><div>            }    &nbsp;</div></li><li><div>            $demerit_score=$demerit_n1+$demerit_n2+$demerit_n3+$demerit_n4;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($demerit_score&lt;=$min_demerit_score || $i==0)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $mask_number=$i;&nbsp;</div></li><li><div>                $min_demerit_score=$demerit_score;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $i++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $mask_content=1 &lt;&lt; $mask_number;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $format_information_value=(($this-&gt;ec &lt;&lt; 3) | $mask_number);&nbsp;</div></li><li><div>        $format_information_array=array(&quot;101010000010010&quot;, &quot;101000100100101&quot;, &nbsp;</div></li><li><div>        &quot;101111001111100&quot;, &quot;101101101001011&quot;, &quot;100010111111001&quot;, &quot;100000011001110&quot;, &nbsp;</div></li><li><div>        &quot;100111110010111&quot;, &quot;100101010100000&quot;, &quot;111011111000100&quot;, &quot;111001011110011&quot;, &nbsp;</div></li><li><div>        &quot;111110110101010&quot;, &quot;111100010011101&quot;, &quot;110011000101111&quot;, &quot;110001100011000&quot;, &nbsp;</div></li><li><div>        &quot;110110001000001&quot;, &quot;110100101110110&quot;, &quot;001011010001001&quot;, &quot;001001110111110&quot;, &nbsp;</div></li><li><div>        &quot;001110011100111&quot;, &quot;001100111010000&quot;, &quot;000011101100010&quot;, &quot;000001001010101&quot;, &nbsp;</div></li><li><div>        &quot;000110100001100&quot;, &quot;000100000111011&quot;, &quot;011010101011111&quot;, &quot;011000001101000&quot;, &nbsp;</div></li><li><div>        &quot;011111100110001&quot;, &quot;011101000000110&quot;, &quot;010010010110100&quot;, &quot;010000110000011&quot;, &nbsp;</div></li><li><div>        &quot;010111011011010&quot;, &quot;010101111101101&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        for($i=0; $i&lt;15; $i++)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $content=substr($format_information_array[$format_information_value], $i, 1);&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $this-&gt;matrix[$this-&gt;format_information_x1[$i]][$this-&gt;format_information_y1[$i]]=$content * 255;&nbsp;</div></li><li><div>            $this-&gt;matrix[$this-&gt;format_information_x2[$i+1]][$this-&gt;format_information_y2[$i+1]]=$content * 255;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        $this-&gt;final = unpack(&quot;C*&quot;, file_get_contents(dirname(__FILE__).'/data/modele'.$this-&gt;version.'.dat'));&nbsp;</div></li><li><div>        $this-&gt;qr_size = $this-&gt;size+8;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        for($x=0; $x&lt;$this-&gt;size; $x++)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            for($y=0; $y&lt;$this-&gt;size; $y++)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                if ($this-&gt;matrix[$x][$y] & $mask_content)&nbsp;</div></li><li><div>                    $this-&gt;final[($x+4) + ($y+4)*$this-&gt;qr_size+1] = true; &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 4.0.4</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/gravity-pdf/4.1.1/classes/qrcode/" class="active">4.1.1</a></li><li><a href="http://hookr.io/plugins/gravity-pdf/4.1.0/classes/qrcode/" class="">4.1.0</a></li><li><a href="http://hookr.io/plugins/gravity-pdf/4.0.6/classes/qrcode/" class="">4.0.6</a></li><li><a href="http://hookr.io/plugins/gravity-pdf/4.0.5/classes/qrcode/" class="">4.0.5</a></li><li><a href="http://hookr.io/plugins/gravity-pdf/4.0.4/classes/qrcode/" class="">4.0.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>QRcode</li><li><span></span>Gravity PDF</li><li><span></span>4.1.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>