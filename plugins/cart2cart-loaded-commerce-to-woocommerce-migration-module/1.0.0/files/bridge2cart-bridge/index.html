<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="1.0.0" data-slug="cart2cart-loaded-commerce-to-woocommerce-migration-module" data-type="file" data-id="92639"><head xmlns="http://www.w3.org/1999/xhtml"><title> bridge2cart-bridge | file | Cart2cart Loaded Commerce To Woocommerce Migration Module | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, cart2cart-loaded-commerce-to-woocommerce-migration-module, 1.0.0" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=1efde6243570bd96a8b7329a6bfbda9a' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bridge2cart-bridge/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbridge2cart-bridge%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbridge2cart-bridge%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-cart2cart-loaded-commerce-to-woocommerce-migration-module-1.0.0-file-bridge2cart-bridge","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bridge2cart-bridge" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to cart2cart-loaded-commerce-to-&hellip;." href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/" class="plugin"><span property="name">cart2cart-loaded-commerce-to-&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><span property="name">1.0.0</span><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bridge2cart-bridge</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="86"><a href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/all/" title="All">All <span class="count badge">86</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="" data-id="class" data-count="56"><a href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/classes/" title="Classes">Classes <span class="count badge">56</span></a></li><li class="" data-id="constant" data-count="24"><a href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/constants/" title="Constants">Constants <span class="count badge">24</span></a></li><li class="" data-id="function" data-count="6"><a href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/functions/" title="Functions">Functions <span class="count badge">6</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/cart2cart-loaded-commerce-to-woocommerce-migration-module/1.0.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bridge2cart/bridge.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**------------------------------------------------------------------------------+</span>&nbsp;</div></li><li><div><span class="comment">| MagneticOne                                                                   |</span>&nbsp;</div></li><li><div><span class="comment">| Copyright (c) 2013 MagneticOne.com &lt;contact@magneticone.com&gt;                  |</span>&nbsp;</div></li><li><div><span class="comment">| All rights reserved                                                           |</span>&nbsp;</div></li><li><div><span class="comment">+-------------------------------------------------------------------------------+</span>&nbsp;</div></li><li><div><span class="comment">| PLEASE READ  THE FULL TEXT OF SOFTWARE LICENSE AGREEMENT IN THE &quot;license.txt&quot; |</span>&nbsp;</div></li><li><div><span class="comment">| FILE PROVIDED WITH THIS DISTRIBUTION. THE AGREEMENT TEXT IS ALSO AVAILABLE AT |</span>&nbsp;</div></li><li><div><span class="comment">| THE FOLLOWING URL: http://www.shopping-cart-migration.com/license-agreement   |</span>&nbsp;</div></li><li><div><span class="comment">|                                                                               |</span>&nbsp;</div></li><li><div><span class="comment">| THIS  AGREEMENT  EXPRESSES  THE  TERMS  AND CONDITIONS  ON WHICH YOU MAY USE  |</span>&nbsp;</div></li><li><div><span class="comment">| THIS SOFTWARE   PROGRAM   AND  ASSOCIATED  DOCUMENTATION   THAT  MAGNETICONE  |</span>&nbsp;</div></li><li><div><span class="comment">| (hereinafter  referred to as &quot;THE AUTHOR&quot;) IS FURNISHING  OR MAKING AVAILABLE |</span>&nbsp;</div></li><li><div><span class="comment">| AVAILABLE  TO YOU WITH  THIS  AGREEMENT  (COLLECTIVELY, THE  &quot;SOFTWARE&quot;).    |</span>&nbsp;</div></li><li><div><span class="comment">| PLEASE   REVIEW   THE  TERMS   AND   CONDITIONS  OF  THIS  LICENSE AGREEMENT  |</span>&nbsp;</div></li><li><div><span class="comment">| CAREFULLY   BEFORE   INSTALLING   OR   USING  THE  SOFTWARE.  BY INSTALLING, |</span>&nbsp;</div></li><li><div><span class="comment">| COPYING   OR   OTHERWISE   USING   THE   SOFTWARE, YOU  AND  YOUR  COMPANY  |</span>&nbsp;</div></li><li><div><span class="comment">| (COLLECTIVELY, &quot;YOU&quot;)  ARE  ACCEPTING  AND  AGREEING  TO  THE TERMS OF THIS  |</span>&nbsp;</div></li><li><div><span class="comment">| LICENSE   AGREEMENT.   IF  YOU    ARE  NOT  WILLING   TO  BE  BOUND  BY THIS  |</span>&nbsp;</div></li><li><div><span class="comment">| AGREEMENT, DO  NOT  INSTALL OR USE THE SOFTWARE.  VARIOUS   COPYRIGHTS   AND  |</span>&nbsp;</div></li><li><div><span class="comment">| OTHER   INTELLECTUAL   PROPERTY   RIGHTS    PROTECT   THE   SOFTWARE.   THIS  |</span>&nbsp;</div></li><li><div><span class="comment">| AGREEMENT IS A LICENSE AGREEMENT THAT GIVES  YOU  LIMITED  RIGHTS   TO   USE  |</span>&nbsp;</div></li><li><div><span class="comment">| THE  SOFTWARE   AND   NOT  AN  AGREEMENT  FOR SALE OR FOR  TRANSFER OF TITLE. |</span>&nbsp;</div></li><li><div><span class="comment">| THE AUTHOR RETAINS ALL RIGHTS NOT EXPRESSLY GRANTED BY THIS AGREEMENT.        |</span>&nbsp;</div></li><li><div><span class="comment">|                                                                               |</span>&nbsp;</div></li><li><div><span class="comment">| The Developer of the Code is MagneticOne, |</span>&nbsp;</div></li><li><div><span class="comment">| Copyright (C) 2006 - 2013 All Rights Reserved.                                |</span>&nbsp;</div></li><li><div><span class="comment">+-------------------------------------------------------------------------------+</span>&nbsp;</div></li><li><div><span class="comment">|                                                                               |</span>&nbsp;</div></li><li><div><span class="comment">|                            ATTENTION!                                         |</span>&nbsp;</div></li><li><div><span class="comment">+-------------------------------------------------------------------------------+</span>&nbsp;</div></li><li><div><span class="comment">| By our Terms of Use you agreed not to change, modify, add, or remove portions |</span>&nbsp;</div></li><li><div><span class="comment">| of Bridge Script source code as it is owned by MagneticOne company.           |</span>&nbsp;</div></li><li><div><span class="comment">| You agreed not to use, reproduce, modify, adapt, publish, translate           |</span>&nbsp;</div></li><li><div><span class="comment">| the Bridge Script source code into any form, medium, or technology            |</span>&nbsp;</div></li><li><div><span class="comment">| now known or later developed throughout the universe.                         |</span>&nbsp;</div></li><li><div><span class="comment">|                                                                               |</span>&nbsp;</div></li><li><div><span class="comment">| Full text of our TOS located at                                               |</span>&nbsp;</div></li><li><div><span class="comment">|                     http://www.shopping-cart-migration.com/terms-of-service   |</span>&nbsp;</div></li><li><div><span class="comment">+------------------------------------------------------------------------------*/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>var $_link = null; <span class="comment">//mysql connection link</span>&nbsp;</div></li><li><div>var $_res = null; <span class="comment">// mysql query result</span>&nbsp;</div></li><li><div>var $_tblPrefix = ''; <span class="comment">// table prefix</span>&nbsp;</div></li><li><div>var $config = null; <span class="comment">// config adapter</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Bridge constructor</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param M1_Config_Adapter $config</span>&nbsp;</div></li><li><div><span class="comment"> * @return M1_Bridge</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function M1_Bridge($config)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;config = $config;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($this-&gt;getAction() != 'savefile' && $this-&gt;getAction() != 'update') {&nbsp;</div></li><li><div>    $this-&gt;_link = $this-&gt;config-&gt;connect();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function getTablesPrefix()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return $this-&gt;_tblPrefix;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function getLink()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return $this-&gt;_link;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function query($sql, $fetchMode)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $result = array(&nbsp;</div></li><li><div>    'result' =&gt; null, &nbsp;</div></li><li><div>    'message' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!$this-&gt;_link) {&nbsp;</div></li><li><div>    $result['message'] = '[ERROR] MySQL Query Error: Can not connect to DB';&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (isset($_GET['disable_checks'])) {&nbsp;</div></li><li><div>    mysql_query('SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0', $this-&gt;_link);&nbsp;</div></li><li><div>    mysql_query(&quot;SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO'&quot;, $this-&gt;_link);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (isset($_REQUEST['set_names'])) {&nbsp;</div></li><li><div>    @mysql_query(&quot;SET NAMES &quot; . @mysql_real_escape_string($_REQUEST['set_names']), $this-&gt;_link);&nbsp;</div></li><li><div>    @mysql_query(&quot;SET CHARACTER SET &quot; . @mysql_real_escape_string($_REQUEST['set_names']), $this-&gt;_link);&nbsp;</div></li><li><div>    @mysql_query(&quot;SET CHARACTER_SET_CONNECTION=&quot; . @mysql_real_escape_string($_REQUEST['set_names']), $this-&gt;_link);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fetch_mode = MYSQL_ASSOC;&nbsp;</div></li><li><div>  switch ($fetchMode) {&nbsp;</div></li><li><div>    case 3:&nbsp;</div></li><li><div>      $fetch_mode = MYSQL_BOTH;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    case 2:&nbsp;</div></li><li><div>      $fetch_mode = MYSQL_NUM;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    case 1:&nbsp;</div></li><li><div>      $fetch_mode = MYSQL_ASSOC;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    default:&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_res = mysql_query($sql, $this-&gt;_link);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $triesCount = 10;&nbsp;</div></li><li><div>  while (mysql_errno($this-&gt;_link) == 2013) {&nbsp;</div></li><li><div>    if (!$triesCount--) {&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    <span class="comment">// reconnect</span>&nbsp;</div></li><li><div>    $this-&gt;_link = $this-&gt;config-&gt;connect();&nbsp;</div></li><li><div>    if ($this-&gt;_link) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (isset($_REQUEST['set_names'])) {&nbsp;</div></li><li><div>        @mysql_query(&quot;SET NAMES &quot; . @mysql_real_escape_string($_REQUEST['set_names']), $this-&gt;_link);&nbsp;</div></li><li><div>        @mysql_query(&quot;SET CHARACTER SET &quot; . @mysql_real_escape_string($_REQUEST['set_names']), $this-&gt;_link);&nbsp;</div></li><li><div>        @mysql_query(&quot;SET CHARACTER_SET_CONNECTION=&quot; . @mysql_real_escape_string($_REQUEST['set_names']), $this-&gt;_link);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// execute query once again</span>&nbsp;</div></li><li><div>      $this-&gt;_res = mysql_query($sql, $this-&gt;_link);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (($errno = mysql_errno($this-&gt;_link)) != 0) {&nbsp;</div></li><li><div>    $result['message'] = '[ERROR] Mysql Query Error: ' . $errno . ', ' . mysql_error($this-&gt;_link);&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!is_resource($this-&gt;_res)) {&nbsp;</div></li><li><div>    $result['result'] = $this-&gt;_res;&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fetchedFields = array();&nbsp;</div></li><li><div>  while (($field = mysql_fetch_field($this-&gt;_res)) !== false) {&nbsp;</div></li><li><div>    $fetchedFields[] = $field;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rows = array();&nbsp;</div></li><li><div>  while (($row = mysql_fetch_array($this-&gt;_res, $fetch_mode)) !== false) {&nbsp;</div></li><li><div>    $rows[] = $row;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  mysql_free_result($this-&gt;_res);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (isset($_GET['disable_checks'])) {&nbsp;</div></li><li><div>    mysql_query(&quot;SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '')&quot;, $this-&gt;_link);&nbsp;</div></li><li><div>    mysql_query(&quot;SET FOREIGN_KEY_CHECKS=IFNULL(@OLD_FOREIGN_KEY_CHECKS, 0)&quot;, $this-&gt;_link);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result['result'] = $rows;&nbsp;</div></li><li><div>  $result['fetchedFields'] = $fetchedFields;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function getAction()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (isset($_GET['action'])) {&nbsp;</div></li><li><div>    return str_replace('.', '', $_GET['action']);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function run()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $action = $this-&gt;getAction();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($action != 'update') {&nbsp;</div></li><li><div>    $this-&gt;_selfTest();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($action == 'checkbridge') {&nbsp;</div></li><li><div>    echo 'BRIDGE_OK';&nbsp;</div></li><li><div>    return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($action == 'update') {&nbsp;</div></li><li><div>    $this-&gt;_checkPossibilityUpdate();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $class_name = 'M1_Bridge_Action_' . ucfirst($action);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!class_exists($class_name)) {&nbsp;</div></li><li><div>    echo 'ACTION_DO_NOT EXIST' . PHP_EOL;&nbsp;</div></li><li><div>    die;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $action_obj = new $class_name();&nbsp;</div></li><li><div>  @$action_obj-&gt;cartType = @$this-&gt;config-&gt;cartType;&nbsp;</div></li><li><div>  $action_obj-&gt;perform($this);&nbsp;</div></li><li><div>  $this-&gt;_destroy();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function isWritable($dir)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (!@is_dir($dir)) {&nbsp;</div></li><li><div>    return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $dh = @opendir($dir);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($dh === false) {&nbsp;</div></li><li><div>    return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  while (($entry = readdir($dh)) !== false) {&nbsp;</div></li><li><div>    if ($entry == '.' || $entry == '..' || !@is_dir($dir . DIRECTORY_SEPARATOR . $entry)) {&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (!$this-&gt;isWritable($dir . DIRECTORY_SEPARATOR . $entry)) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!is_writable($dir)) {&nbsp;</div></li><li><div>    return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _destroy()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ($this-&gt;getAction() != 'savefile') {&nbsp;</div></li><li><div>    mysql_close($this-&gt;_link);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _checkPossibilityUpdate()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (!is_writable(M1_STORE_BASE_DIR . '/' . M1_BRIDGE_DIRECTORY_NAME . '/')) {&nbsp;</div></li><li><div>    die('ERROR_TRIED_TO_PERMISSION_CART2CART' . M1_STORE_BASE_DIR . '/' . M1_BRIDGE_DIRECTORY_NAME . '/');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!is_writable(M1_STORE_BASE_DIR . '/' . M1_BRIDGE_DIRECTORY_NAME . '/bridge.php')) {&nbsp;</div></li><li><div>    die('ERROR_TRIED_TO_PERMISSION_BRIDGE_FILE' . M1_STORE_BASE_DIR . '/' . M1_BRIDGE_DIRECTORY_NAME . '/bridge.php');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _selfTest()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (!isset($_GET['ver']) && !isset($_GET['token'])) {&nbsp;</div></li><li><div>    die('BRIDGE_INSTALLED');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!isset($_GET['ver']) || (isset($_GET['ver']) && $_GET['ver'] != M1_BRIDGE_VERSION)) {&nbsp;</div></li><li><div>    die('ERROR_BRIDGE_VERSION_NOT_SUPPORTED');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (isset($_GET['token']) && $_GET['token'] == M1_TOKEN) {&nbsp;</div></li><li><div>    <span class="comment">// good :)</span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    die('ERROR_INVALID_TOKEN');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ((!isset($_GET['storetype']) || $_GET['storetype'] == 'target') && $this-&gt;getAction() == 'checkbridge') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (trim($this-&gt;config-&gt;imagesDir) != '') {&nbsp;</div></li><li><div>      if (!file_exists(M1_STORE_BASE_DIR . $this-&gt;config-&gt;imagesDir) && is_writable(M1_STORE_BASE_DIR)) {&nbsp;</div></li><li><div>        if (!@mkdir(M1_STORE_BASE_DIR . $this-&gt;config-&gt;imagesDir, 0777, true)) {&nbsp;</div></li><li><div>          die('ERROR_TRIED_TO_CREATE_IMAGE_DIR' . M1_STORE_BASE_DIR . $this-&gt;config-&gt;imagesDir);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;isWritable(M1_STORE_BASE_DIR . $this-&gt;config-&gt;imagesDir)) {&nbsp;</div></li><li><div>        die('ERROR_NO_IMAGES_DIR ' . M1_STORE_BASE_DIR . $this-&gt;config-&gt;imagesDir);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (trim($this-&gt;config-&gt;categoriesImagesDir) != '') {&nbsp;</div></li><li><div>      if (!file_exists(M1_STORE_BASE_DIR . $this-&gt;config-&gt;categoriesImagesDir) && is_writable(M1_STORE_BASE_DIR)) {&nbsp;</div></li><li><div>        if (!@mkdir(M1_STORE_BASE_DIR . $this-&gt;config-&gt;categoriesImagesDir, 0777, true)) {&nbsp;</div></li><li><div>          die('ERROR_TRIED_TO_CREATE_IMAGE_DIR' . M1_STORE_BASE_DIR . $this-&gt;config-&gt;categoriesImagesDir);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;isWritable(M1_STORE_BASE_DIR . $this-&gt;config-&gt;categoriesImagesDir)) {&nbsp;</div></li><li><div>        die('ERROR_NO_IMAGES_DIR ' . M1_STORE_BASE_DIR . $this-&gt;config-&gt;categoriesImagesDir);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (trim($this-&gt;config-&gt;productsImagesDir) != '') {&nbsp;</div></li><li><div>      if (!file_exists(M1_STORE_BASE_DIR . $this-&gt;config-&gt;productsImagesDir) && is_writable(M1_STORE_BASE_DIR)) {&nbsp;</div></li><li><div>        if (!@mkdir(M1_STORE_BASE_DIR . $this-&gt;config-&gt;productsImagesDir, 0777, true)) {&nbsp;</div></li><li><div>          die('ERROR_TRIED_TO_CREATE_IMAGE_DIR' . M1_STORE_BASE_DIR . $this-&gt;config-&gt;productsImagesDir);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;isWritable(M1_STORE_BASE_DIR . $this-&gt;config-&gt;productsImagesDir)) {&nbsp;</div></li><li><div>        die('ERROR_NO_IMAGES_DIR ' . M1_STORE_BASE_DIR . $this-&gt;config-&gt;productsImagesDir);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (trim($this-&gt;config-&gt;manufacturersImagesDir) != '') {&nbsp;</div></li><li><div>      if (!file_exists(M1_STORE_BASE_DIR . $this-&gt;config-&gt;manufacturersImagesDir) && is_writable(M1_STORE_BASE_DIR)) {&nbsp;</div></li><li><div>        if (!@mkdir(M1_STORE_BASE_DIR . $this-&gt;config-&gt;manufacturersImagesDir, 0777, true)) {&nbsp;</div></li><li><div>          die('ERROR_TRIED_TO_CREATE_IMAGE_DIR' . M1_STORE_BASE_DIR . $this-&gt;config-&gt;manufacturersImagesDir);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!$this-&gt;isWritable(M1_STORE_BASE_DIR . $this-&gt;config-&gt;manufacturersImagesDir)) {&nbsp;</div></li><li><div>        die('ERROR_NO_IMAGES_DIR ' . M1_STORE_BASE_DIR . $this-&gt;config-&gt;manufacturersImagesDir);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Oxid extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Oxid()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment">//@include_once M1_STORE_BASE_DIR . &quot;config.inc.php&quot;;</span>&nbsp;</div></li><li><div>  $config = file_get_contents(M1_STORE_BASE_DIR . 'config.inc.php');&nbsp;</div></li><li><div>  preg_match(&quot;/dbName(.+)?=(.+)?\'(.+)\';/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $match[3];&nbsp;</div></li><li><div>  preg_match(&quot;/dbUser(.+)?=(.+)?\'(.+)\';/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Username = $match[3];&nbsp;</div></li><li><div>  preg_match(&quot;/dbPwd(.+)?=(.+)?\'(.+)\';/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Password = isset($match[3])?$match[3]:'';&nbsp;</div></li><li><div>  preg_match(&quot;/dbHost(.+)?=(.+)?\'(.*)\';/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;setHostPort($match[3]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//check about last slash</span>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'out/pictures/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//add key for decoding config values in oxid db</span>&nbsp;</div></li><li><div>  <span class="comment">//check slash</span>&nbsp;</div></li><li><div>  $key_config_file = file_get_contents(M1_STORE_BASE_DIR . '/core/oxconfk.php');&nbsp;</div></li><li><div>  preg_match(&quot;/sConfigKey(.+)?=(.+)?\&quot;(.+)?\&quot;;/&quot;, $key_config_file, $match);&nbsp;</div></li><li><div>  $this-&gt;cartVars['sConfigKey'] = $match[3];&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('OXVERSION', 'oxshops', 'OXACTIVE=1 LIMIT 1');&nbsp;</div></li><li><div>  if ($version != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  } &nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Virtuemart113 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Virtuemart113()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . '/configuration.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (class_exists('JConfig')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $jconfig = new JConfig();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;setHostPort($jconfig-&gt;host);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $jconfig-&gt;db;&nbsp;</div></li><li><div>    $this-&gt;Username = $jconfig-&gt;user;&nbsp;</div></li><li><div>    $this-&gt;Password = $jconfig-&gt;password;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;setHostPort($mosConfig_host);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $mosConfig_db;&nbsp;</div></li><li><div>    $this-&gt;Username = $mosConfig_user;&nbsp;</div></li><li><div>    $this-&gt;Password = $mosConfig_password;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . '/administrator/components/com_virtuemart/version.php')) {&nbsp;</div></li><li><div>    $ver = file_get_contents(M1_STORE_BASE_DIR . '/administrator/components/com_virtuemart/version.php');&nbsp;</div></li><li><div>    if (preg_match('/\$RELEASE.+\'(.+)\'/', $ver, $match) != 0) {&nbsp;</div></li><li><div>      $this-&gt;cartVars['dbVersion'] = $match[1];&nbsp;</div></li><li><div>      unset($match);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'components/com_virtuemart/shop_image/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (is_dir( M1_STORE_BASE_DIR . 'images/stories/virtuemart/product')) {&nbsp;</div></li><li><div>    $this-&gt;imagesDir = 'images/stories/virtuemart/';&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = $this-&gt;imagesDir . 'product/';&nbsp;</div></li><li><div>    $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . 'category/';&nbsp;</div></li><li><div>    $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir . 'manufacturer/';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Litecommerce extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Litecommerce()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ((file_exists(M1_STORE_BASE_DIR .'/etc/config.php'))) {&nbsp;</div></li><li><div>    $file = M1_STORE_BASE_DIR .'/etc/config.php';&nbsp;</div></li><li><div>    $this-&gt;imagesDir = '/images';&nbsp;</div></li><li><div>    $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . '/category';&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = $this-&gt;imagesDir . '/product';&nbsp;</div></li><li><div>    $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  } elseif (file_exists(M1_STORE_BASE_DIR .'/modules/lc_connector/litecommerce/etc/config.php')) {&nbsp;</div></li><li><div>    $file = M1_STORE_BASE_DIR .'/modules/lc_connector/litecommerce/etc/config.php';&nbsp;</div></li><li><div>    $this-&gt;imagesDir = '/modules/lc_connector/litecommerce/images';&nbsp;</div></li><li><div>    $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . '/category';&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = $this-&gt;imagesDir . '/product';&nbsp;</div></li><li><div>    $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $settings = parse_ini_file($file);&nbsp;</div></li><li><div>  $this-&gt;Host = $settings['hostspec'];&nbsp;</div></li><li><div>  $this-&gt;setHostPort($settings['hostspec']);&nbsp;</div></li><li><div>  $this-&gt;Username = $settings['username'];&nbsp;</div></li><li><div>  $this-&gt;Password = $settings['password'];&nbsp;</div></li><li><div>  $this-&gt;Dbname = $settings['database'];&nbsp;</div></li><li><div>  $this-&gt;TblPrefix = $settings['table_prefix'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('value', 'config', &quot;name = 'version'&quot;);&nbsp;</div></li><li><div>  if ($version != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Oscommerce3 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Oscommerce3()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $file = M1_STORE_BASE_DIR . '/osCommerce/OM/Config/settings.ini';&nbsp;</div></li><li><div>  $settings=parse_ini_file($file);&nbsp;</div></li><li><div>  $this-&gt;imagesDir = '/public/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . '/categories';&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir . '/products';&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;Host = $settings['db_server'];&nbsp;</div></li><li><div>  $this-&gt;setHostPort($settings['db_server_port']);&nbsp;</div></li><li><div>  $this-&gt;Username = $settings['db_server_username'];&nbsp;</div></li><li><div>  $this-&gt;Password = $settings['db_server_password'];&nbsp;</div></li><li><div>  $this-&gt;Dbname = $settings['db_database'];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Created by JetBrains PhpStorm.</span>&nbsp;</div></li><li><div><span class="comment"> * User: nazar.k</span>&nbsp;</div></li><li><div><span class="comment"> * Date: 27.07.13</span>&nbsp;</div></li><li><div><span class="comment"> * Time: 17:27</span>&nbsp;</div></li><li><div><span class="comment"> * To change this template use File | Settings | File Templates.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Loaded7 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Loaded7()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  include_once( M1_STORE_BASE_DIR . '/includes/config.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort(DB_SERVER);&nbsp;</div></li><li><div>  $this-&gt;Username = DB_SERVER_USERNAME;&nbsp;</div></li><li><div>  $this-&gt;Password = DB_SERVER_PASSWORD;&nbsp;</div></li><li><div>  $this-&gt;Dbname = DB_DATABASE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = '/' . DIR_WS_IMAGES;&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . 'categories/';&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir . 'products/';&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir . 'manufacturers/';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_MijoShop extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_MijoShop()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . '/configuration.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (class_exists('JConfig')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $jconfig = new JConfig();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;setHostPort($jconfig-&gt;host);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $jconfig-&gt;db;&nbsp;</div></li><li><div>    $this-&gt;Username = $jconfig-&gt;user;&nbsp;</div></li><li><div>    $this-&gt;Password = $jconfig-&gt;password;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;setHostPort($mosConfig_host);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $mosConfig_db;&nbsp;</div></li><li><div>    $this-&gt;Username = $mosConfig_user;&nbsp;</div></li><li><div>    $this-&gt;Password = $mosConfig_password;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'components/com_mijoshop/opencart/image/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Shopscriptfree extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Shopscriptfree()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $config = file_get_contents(M1_STORE_BASE_DIR . 'cfg/connect.inc.php');&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_NAME\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $match[1];&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_USER\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Username = $match[1];&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_PASS\', \'(.*)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Password = $match[1];&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_HOST\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;setHostPort( $match[1] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'products_pictures/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $generalInc = file_get_contents(M1_STORE_BASE_DIR . 'cfg/general.inc.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'CONF_CURRENCY_ISO3\', \'(.+)\'\);/&quot;, $generalInc, $match);&nbsp;</div></li><li><div>  if (count($match) != 0) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['iso3Currency'] = $match[1];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'CONF_CURRENCY_ID_LEFT\', \'(.+)\'\);/&quot;, $generalInc, $match);&nbsp;</div></li><li><div>  if (count($match) != 0) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['currencySymbolLeft'] = $match[1];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'CONF_CURRENCY_ID_RIGHT\', \'(.+)\'\);/&quot;, $generalInc, $match);&nbsp;</div></li><li><div>  if (count($match) != 0) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['currencySymbolRight'] = $match[1];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_XtcommerceVeyton extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_XtcommerceVeyton()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  define('_VALID_CALL', 'TRUE');&nbsp;</div></li><li><div>  define('_SRV_WEBROOT', 'TRUE');&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . 'conf' . DIRECTORY_SEPARATOR . 'config.php';&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . 'conf' . DIRECTORY_SEPARATOR . 'paths.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort(_SYSTEM_DATABASE_HOST);&nbsp;</div></li><li><div>  $this-&gt;Dbname = _SYSTEM_DATABASE_DATABASE;&nbsp;</div></li><li><div>  $this-&gt;Username = _SYSTEM_DATABASE_USER;&nbsp;</div></li><li><div>  $this-&gt;Password = _SYSTEM_DATABASE_PWD;&nbsp;</div></li><li><div>  $this-&gt;imagesDir = _SRV_WEB_IMAGES;&nbsp;</div></li><li><div>  $this-&gt;TblPrefix = DB_PREFIX . '_';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('config_value', 'config', &quot;config_key = '_SYSTEM_VERSION'&quot;);&nbsp;</div></li><li><div>  if ($version != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_XCart extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_XCart()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  define('XCART_START', 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $config = file_get_contents(M1_STORE_BASE_DIR . 'config.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match('/\$sql_host.+\'(.+)\';/', $config, $match);&nbsp;</div></li><li><div>  $this-&gt;setHostPort($match[1]);&nbsp;</div></li><li><div>  preg_match('/\$sql_user.+\'(.+)\';/', $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Username = $match[1];&nbsp;</div></li><li><div>  preg_match('/\$sql_db.+\'(.+)\';/', $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $match[1];&nbsp;</div></li><li><div>  preg_match('/\$sql_password.+\'(.*)\';/', $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Password = $match[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'images/'; <span class="comment">// xcart starting from 4.1.x hardcodes images location</span>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'VERSION')) {&nbsp;</div></li><li><div>    $version = file_get_contents(M1_STORE_BASE_DIR . 'VERSION');&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = preg_replace('/(Version| |\\n)/', '', $version);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Hhgmultistore extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Hhgmultistore()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  define('SITE_PATH', '');&nbsp;</div></li><li><div>  define('WEB_PATH', '');&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . 'core/config/configure.php';&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . 'core/config/paths.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $baseDir = '/store_files/1/';&nbsp;</div></li><li><div>  $this-&gt;imagesDir = $baseDir . DIR_WS_IMAGES;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $baseDir . DIR_WS_CATEGORIE_IMAGES;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDirs['info'] = $baseDir . DIR_WS_PRODUCT_INFO_IMAGES;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDirs['org'] = $baseDir . DIR_WS_PRODUCT_ORG_IMAGES;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDirs['thumb'] = $baseDir . DIR_WS_PRODUCT_THUMBNAIL_IMAGES;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDirs['popup'] = $baseDir . DIR_WS_PRODUCT_POPUP_IMAGES;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDirs['img'] = $baseDir . DIR_WS_MANUFACTURERS_IMAGES;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDirs['org'] = $baseDir . DIR_WS_MANUFACTURERS_ORG_IMAGES;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;Host = DB_SERVER;&nbsp;</div></li><li><div>  $this-&gt;Username = DB_SERVER_USERNAME;&nbsp;</div></li><li><div>  $this-&gt;Password = DB_SERVER_PASSWORD;&nbsp;</div></li><li><div>  $this-&gt;Dbname = DB_DATABASE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . '/core/config/conf.hhg_startup.php')) {&nbsp;</div></li><li><div>    $ver = file_get_contents(M1_STORE_BASE_DIR . '/core/config/conf.hhg_startup.php');&nbsp;</div></li><li><div>    if (preg_match('/PROJECT_VERSION.+\((.+)\)\'\)/', $ver, $match) != 0) {&nbsp;</div></li><li><div>      $this-&gt;cartVars['dbVersion'] = $match[1];&nbsp;</div></li><li><div>      unset($match);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Squirrelcart242 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Squirrelcart242()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  include_once(M1_STORE_BASE_DIR . 'squirrelcart/config.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($sql_host);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $db;&nbsp;</div></li><li><div>  $this-&gt;Username = $sql_username;&nbsp;</div></li><li><div>  $this-&gt;Password = $sql_password;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = $img_path;&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $img_path . '/categories';&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $img_path . '/products';&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $img_path;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('DB_Version', 'Store_Information', 'record_number = 1');&nbsp;</div></li><li><div>  if ($version != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Zencart137 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Zencart137()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $cur_dir = getcwd();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  chdir(M1_STORE_BASE_DIR);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  @require_once M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'configure.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  chdir($cur_dir);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = DIR_WS_IMAGES;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('DIR_WS_PRODUCT_IMAGES')) {&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = DIR_WS_PRODUCT_IMAGES;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('DIR_WS_ORIGINAL_IMAGES')) {&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = DIR_WS_ORIGINAL_IMAGES;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort(DB_SERVER);&nbsp;</div></li><li><div>  $this-&gt;Username = DB_SERVER_USERNAME;&nbsp;</div></li><li><div>  $this-&gt;Password = DB_SERVER_PASSWORD;&nbsp;</div></li><li><div>  $this-&gt;Dbname = DB_DATABASE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'version.php')) {&nbsp;</div></li><li><div>     @require_once M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'version.php';&nbsp;</div></li><li><div>    $major = PROJECT_VERSION_MAJOR;&nbsp;</div></li><li><div>    $minor = PROJECT_VERSION_MINOR;&nbsp;</div></li><li><div>    if (defined('EXPECTED_DATABASE_VERSION_MAJOR') && EXPECTED_DATABASE_VERSION_MAJOR != '') {&nbsp;</div></li><li><div>      $major = EXPECTED_DATABASE_VERSION_MAJOR;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (defined('EXPECTED_DATABASE_VERSION_MINOR') && EXPECTED_DATABASE_VERSION_MINOR != '') {&nbsp;</div></li><li><div>      $minor = EXPECTED_DATABASE_VERSION_MINOR;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ($major != '' && $minor != '') {&nbsp;</div></li><li><div>      $this-&gt;cartVars['dbVersion'] = $major . '.' . $minor;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Ubercart3 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Ubercart3()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  @include_once M1_STORE_BASE_DIR . 'sites/default/settings.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url = $databases['default']['default']; &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url['username'] = urldecode($url['username']);&nbsp;</div></li><li><div>  $url['password'] = isset($url['password']) ? urldecode($url['password']) : '';&nbsp;</div></li><li><div>  $url['host'] = urldecode($url['host']);&nbsp;</div></li><li><div>  $url['database'] = urldecode($url['database']);&nbsp;</div></li><li><div>  if (isset($url['port'])) {&nbsp;</div></li><li><div>    $url['host'] = $url['host'] . ':' . $url['port'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($url['host']);&nbsp;</div></li><li><div>  $this-&gt;Dbname = ltrim($url['database'], '/');&nbsp;</div></li><li><div>  $this-&gt;Username = $url['username'];&nbsp;</div></li><li><div>  $this-&gt;Password = $url['password'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = '/sites/default/files/';&nbsp;</div></li><li><div>  if (!file_exists(M1_STORE_BASE_DIR . $this-&gt;imagesDir)) {&nbsp;</div></li><li><div>    $this-&gt;imagesDir = '/files';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fileInfo = M1_STORE_BASE_DIR . '/sites/all/modules/ubercart/uc_cart/uc_cart.info';&nbsp;</div></li><li><div>  if (file_exists($fileInfo)) {&nbsp;</div></li><li><div>    $str = file_get_contents($fileInfo);&nbsp;</div></li><li><div>    if (preg_match('/version\s+=\s+&quot;.+-(.+)&quot;/', $str, $match) != 0) {&nbsp;</div></li><li><div>      $this-&gt;cartVars['dbVersion'] = $match[1];&nbsp;</div></li><li><div>      unset($match);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Interspire extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Interspire()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . 'config/config.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($GLOBALS['ISC_CFG']['dbServer']);&nbsp;</div></li><li><div>  $this-&gt;Username = $GLOBALS['ISC_CFG']['dbUser'];&nbsp;</div></li><li><div>  $this-&gt;Password = $GLOBALS['ISC_CFG']['dbPass'];&nbsp;</div></li><li><div>  $this-&gt;Dbname = $GLOBALS['ISC_CFG']['dbDatabase'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = $GLOBALS['ISC_CFG']['ImageDirectory'];&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  define('DEFAULT_LANGUAGE_ISO2', $GLOBALS['ISC_CFG']['Language']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('database_version', $GLOBALS['ISC_CFG']['tablePrefix'] . 'config', '1');&nbsp;</div></li><li><div>  if ($version != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Prestashop15 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Prestashop15()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $conf_file1 = file_get_contents(M1_STORE_BASE_DIR . '/config/settings.inc.php');&nbsp;</div></li><li><div>  $conf_file2 = file_get_contents(M1_STORE_BASE_DIR . '/config/config.inc.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $files_lines = array_merge(explode(&quot;\n&quot;, $conf_file1), explode(&quot;\n&quot;, $conf_file2));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $execute = '$currentDir = \'\';';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ($files_lines as $line) {&nbsp;</div></li><li><div>    if (preg_match(&quot;/^(\s*)define\(/i&quot;, $line)) {&nbsp;</div></li><li><div>      if ((strpos($line, '_DB_') !== false)&nbsp;</div></li><li><div>          || (strpos($line, '_PS_IMG_DIR_') !== false)&nbsp;</div></li><li><div>          || (strpos($line, '_PS_VERSION_') !== false)&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>        $execute .= ' ' . $line;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  define('_PS_ROOT_DIR_', M1_STORE_BASE_DIR);&nbsp;</div></li><li><div>  eval($execute);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort(_DB_SERVER_);&nbsp;</div></li><li><div>  $this-&gt;Dbname = _DB_NAME_;&nbsp;</div></li><li><div>  $this-&gt;Username = _DB_USER_;&nbsp;</div></li><li><div>  $this-&gt;Password = _DB_PASSWD_;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('_PS_IMG_DIR_') && defined('_PS_ROOT_DIR_')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    preg_match(&quot;/(\/\w+\/)$/i&quot;, _PS_IMG_DIR_, $m);&nbsp;</div></li><li><div>    $this-&gt;imagesDir = $m[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $this-&gt;imagesDir = '/img/';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('_PS_VERSION_')) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = _PS_VERSION_;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Pinnacle361 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Pinnacle361()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  include_once M1_STORE_BASE_DIR . 'content/engine/engine_config.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'images/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//$this-&gt;Host = DB_HOST;</span>&nbsp;</div></li><li><div>  $this-&gt;setHostPort(DB_HOST);&nbsp;</div></li><li><div>  $this-&gt;Dbname = DB_NAME;&nbsp;</div></li><li><div>  $this-&gt;Username = DB_USER;&nbsp;</div></li><li><div>  $this-&gt;Password = DB_PASSWORD;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('value', (defined('DB_PREFIX') ? DB_PREFIX : '') . 'settings', &quot;name = 'AppVer'&quot;);&nbsp;</div></li><li><div>  if ($version != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Cscart203 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Cscart203()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  define('IN_CSCART', 1);&nbsp;</div></li><li><div>  define('CSCART_DIR', M1_STORE_BASE_DIR);&nbsp;</div></li><li><div>  define('AREA', 1);&nbsp;</div></li><li><div>  define('BOOTSTRAP', 1);&nbsp;</div></li><li><div>  define('DIR_ROOT', M1_STORE_BASE_DIR);&nbsp;</div></li><li><div>  define('DIR_CSCART', M1_STORE_BASE_DIR);&nbsp;</div></li><li><div>  define('DS', DIRECTORY_SEPARATOR);&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . 'config.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//For CS CART 1.3.x</span>&nbsp;</div></li><li><div>  if (isset($db_host) && isset($db_name) && isset($db_user) && isset($db_password)) {&nbsp;</div></li><li><div>    $this-&gt;setHostPort($db_host);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $db_name;&nbsp;</div></li><li><div>    $this-&gt;Username = $db_user;&nbsp;</div></li><li><div>    $this-&gt;Password = $db_password;&nbsp;</div></li><li><div>    $this-&gt;imagesDir = str_replace(M1_STORE_BASE_DIR, '', IMAGES_STORAGE_DIR);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $this-&gt;setHostPort($config['db_host']);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $config['db_name'];&nbsp;</div></li><li><div>    $this-&gt;Username = $config['db_user'];&nbsp;</div></li><li><div>    $this-&gt;Password = $config['db_password'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (defined('DIR_IMAGES')) {&nbsp;</div></li><li><div>      $imagesDir = DIR_IMAGES;&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $imagesDir = $config['storage']['images']['dir'] . '/' . $config['storage']['images']['prefix'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;imagesDir = str_replace(M1_STORE_BASE_DIR, '', $imagesDir);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('MAX_FILES_IN_DIR')) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['cs_max_files_in_dir'] = MAX_FILES_IN_DIR;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('PRODUCT_VERSION')) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = PRODUCT_VERSION;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Shopscript282 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Shopscript282()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $config = simplexml_load_file(M1_STORE_BASE_DIR . 'kernel/wbs.xml');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $dbKey = (string)$config-&gt;FRONTEND['dbkey'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $config = simplexml_load_file(M1_STORE_BASE_DIR . 'dblist'. '/' . strtoupper($dbKey) . '.xml');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $host = (string)$config-&gt;DBSETTINGS['SQLSERVER'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($host);&nbsp;</div></li><li><div>  $this-&gt;Dbname = (string)$config-&gt;DBSETTINGS['DB_NAME'];&nbsp;</div></li><li><div>  $this-&gt;Username = (string)$config-&gt;DBSETTINGS['DB_USER'];&nbsp;</div></li><li><div>  $this-&gt;Password = (string)$config-&gt;DBSETTINGS['DB_PASSWORD'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'published/publicdata/' . strtoupper($dbKey) . '/attachments/SC/products_pictures';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (isset($config-&gt;VERSIONS['SYSTEM'])) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = (string)$config-&gt;VERSIONS['SYSTEM'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_WPecommerce extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_WPecommerce()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//@include_once M1_STORE_BASE_DIR . &quot;wp-config.php&quot;;</span></span>&nbsp;</div></li><li><div>  $config = file_get_contents(M1_STORE_BASE_DIR . 'wp-config.php');&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_NAME\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $match[1];&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_USER\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Username = $match[1];&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_PASSWORD\', \'(.*)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Password = $match[1];&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_HOST\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;setHostPort( $match[1] );&nbsp;</div></li><li><div>  preg_match(&quot;/(table_prefix)(.*)(')(.*)(')(.*)/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;TblPrefix = $match[4];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('option_value', 'options', &quot;option_name = 'wpsc_version'&quot;);&nbsp;</div></li><li><div>  if ($version != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    if (file_exists(M1_STORE_BASE_DIR . 'wp-content' . DIRECTORY_SEPARATOR . 'plugins' . DIRECTORY_SEPARATOR . 'wp-shopping-cart' . DIRECTORY_SEPARATOR . 'wp-shopping-cart.php')) {&nbsp;</div></li><li><div>      $conf = file_get_contents(M1_STORE_BASE_DIR . 'wp-content' . DIRECTORY_SEPARATOR . 'plugins' . DIRECTORY_SEPARATOR . 'wp-shopping-cart' . DIRECTORY_SEPARATOR . 'wp-shopping-cart.php');&nbsp;</div></li><li><div>      preg_match(&quot;/define\('WPSC_VERSION.*/&quot;, $conf, $match);&nbsp;</div></li><li><div>      if (isset($match[0]) && !empty($match[0])) {&nbsp;</div></li><li><div>        preg_match(&quot;/\d.*/&quot;, $match[0], $project);&nbsp;</div></li><li><div>        if (isset($project[0]) && !empty($project[0])) {&nbsp;</div></li><li><div>          $version = $project[0];&nbsp;</div></li><li><div>          $version = str_replace(array(' ', '-', '_', &quot;'&quot;, ');', ')', ';'), '', $version);&nbsp;</div></li><li><div>          if ($version != '') {&nbsp;</div></li><li><div>            $this-&gt;cartVars['dbVersion'] = strtolower($version);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'wp-content/plugins/shopp/Shopp.php')&nbsp;</div></li><li><div>      || file_exists(M1_STORE_BASE_DIR . 'wp-content/plugins/wp-e-commerce/editor.php')&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    $this-&gt;imagesDir = 'wp-content/uploads/wpsc/';&nbsp;</div></li><li><div>    $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . 'category_images/';&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = $this-&gt;imagesDir . 'product_images/';&nbsp;</div></li><li><div>    $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  } elseif (file_exists(M1_STORE_BASE_DIR . 'wp-content/plugins/wp-e-commerce/wp-shopping-cart.php')) {&nbsp;</div></li><li><div>    $this-&gt;imagesDir = 'wp-content/uploads/';&nbsp;</div></li><li><div>    $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . 'wpsc/category_images/';&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>    $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $this-&gt;imagesDir = 'images/';&nbsp;</div></li><li><div>    $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>    $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Opencart14 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Opencart14()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  include_once( M1_STORE_BASE_DIR . '/config.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('DB_HOST')) {&nbsp;</div></li><li><div>    $this-&gt;setHostPort(DB_HOST);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $this-&gt;setHostPort(DB_HOSTNAME);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('DB_USER')) {&nbsp;</div></li><li><div>    $this-&gt;Username = DB_USER;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $this-&gt;Username = DB_USERNAME;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;Password = DB_PASSWORD;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('DB_NAME')) {&nbsp;</div></li><li><div>    $this-&gt;Dbname = DB_NAME;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $this-&gt;Dbname = DB_DATABASE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $indexFileContent = '';&nbsp;</div></li><li><div>  $startupFileContent = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . '/index.php')) {&nbsp;</div></li><li><div>    $indexFileContent = file_get_contents(M1_STORE_BASE_DIR . '/index.php');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . '/system/startup.php')) {&nbsp;</div></li><li><div>    $startupFileContent = file_get_contents(M1_STORE_BASE_DIR . '/system/startup.php');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (preg_match(&quot;/define\('\VERSION\'\, \'(.+)\'\)/&quot;, $indexFileContent, $match) == 0) {&nbsp;</div></li><li><div>    preg_match(&quot;/define\('\VERSION\'\, \'(.+)\'\)/&quot;, $startupFileContent, $match);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (count($match) &gt; 0) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $match[1];&nbsp;</div></li><li><div>    unset($match);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = '/image/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_AceShop extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_AceShop()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . '/configuration.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (class_exists('JConfig')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $jconfig = new JConfig();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;setHostPort($jconfig-&gt;host);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $jconfig-&gt;db;&nbsp;</div></li><li><div>    $this-&gt;Username = $jconfig-&gt;user;&nbsp;</div></li><li><div>    $this-&gt;Password = $jconfig-&gt;password;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;setHostPort($mosConfig_host);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $mosConfig_db;&nbsp;</div></li><li><div>    $this-&gt;Username = $mosConfig_user;&nbsp;</div></li><li><div>    $this-&gt;Password = $mosConfig_password;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'components/com_aceshop/opencart/image/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Oscommerce22ms2 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Oscommerce22ms2()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $cur_dir = getcwd();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  chdir(M1_STORE_BASE_DIR);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  @require_once M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'configure.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  chdir($cur_dir);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = DIR_WS_IMAGES;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('DIR_WS_PRODUCT_IMAGES')) {&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = DIR_WS_PRODUCT_IMAGES;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('DIR_WS_ORIGINAL_IMAGES')) {&nbsp;</div></li><li><div>    $this-&gt;productsImagesDir = DIR_WS_ORIGINAL_IMAGES;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort(DB_SERVER);&nbsp;</div></li><li><div>  $this-&gt;Username = DB_SERVER_USERNAME;&nbsp;</div></li><li><div>  $this-&gt;Password = DB_SERVER_PASSWORD;&nbsp;</div></li><li><div>  $this-&gt;Dbname = DB_DATABASE;&nbsp;</div></li><li><div>  chdir(M1_STORE_BASE_DIR);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR  . 'includes' . DIRECTORY_SEPARATOR . 'application_top.php')) {&nbsp;</div></li><li><div>    $conf = file_get_contents(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'application_top.php');&nbsp;</div></li><li><div>    preg_match(&quot;/define\('PROJECT_VERSION.*/&quot;, $conf, $match);&nbsp;</div></li><li><div>    if (isset($match[0]) && !empty($match[0])) {&nbsp;</div></li><li><div>      preg_match(&quot;/\d.*/&quot;, $match[0], $project);&nbsp;</div></li><li><div>      if (isset($project[0]) && !empty($project[0])) {&nbsp;</div></li><li><div>        $version = $project[0];&nbsp;</div></li><li><div>        $version = str_replace(array(' ', '-', '_', &quot;'&quot;, ');'), '', $version);&nbsp;</div></li><li><div>        if ($version != '') {&nbsp;</div></li><li><div>          $this-&gt;cartVars['dbVersion'] = strtolower($version);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      <span class="comment">//if another oscommerce based cart</span>&nbsp;</div></li><li><div>      if (file_exists(M1_STORE_BASE_DIR  . 'includes' . DIRECTORY_SEPARATOR . 'version.php')) {&nbsp;</div></li><li><div>        @require_once M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'version.php';&nbsp;</div></li><li><div>        if (defined('PROJECT_VERSION') && PROJECT_VERSION != '') {&nbsp;</div></li><li><div>          $version = PROJECT_VERSION;&nbsp;</div></li><li><div>          preg_match(&quot;/\d.*/&quot;, $version, $vers);&nbsp;</div></li><li><div>          if (isset($vers[0]) && !empty($vers[0])) {&nbsp;</div></li><li><div>            $version = $vers[0];&nbsp;</div></li><li><div>            $version = str_replace(array(' ', '-', '_'), '', $version);&nbsp;</div></li><li><div>            if ($version != '') {&nbsp;</div></li><li><div>              $this-&gt;cartVars['dbVersion'] = strtolower($version);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">//if zen_cart</span>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>          if (defined('PROJECT_VERSION_MAJOR') && PROJECT_VERSION_MAJOR != '') {&nbsp;</div></li><li><div>            $this-&gt;cartVars['dbVersion'] = PROJECT_VERSION_MAJOR;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (defined('PROJECT_VERSION_MINOR') && PROJECT_VERSION_MINOR != '') {&nbsp;</div></li><li><div>            $this-&gt;cartVars['dbVersion'] .= '.' . PROJECT_VERSION_MINOR;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  chdir($cur_dir);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Prostores extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Prostores()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $config = file_get_contents(M1_STORE_BASE_DIR . 'ps_config.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match('/\$db_host.+\'(.+)\';/', $config, $matches);&nbsp;</div></li><li><div>  $this-&gt;setHostPort($matches[1]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match('/\$db_user.+\'(.+)\';/', $config, $matches);&nbsp;</div></li><li><div>  $this-&gt;Username = $matches[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match('/\$db_name.+\'(.+)\';/', $config, $matches);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $matches[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match('/\$db_password.+\'(.*)\';/', $config, $matches);&nbsp;</div></li><li><div>  $this-&gt;Password = $matches[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  unset($matches);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'catalog/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (($version = $this-&gt;getCartVersionFromDb('SchemaVersion', 'DatabaseShard', 'Status = 1')) != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Cubecart extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Cubecart()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  include_once(M1_STORE_BASE_DIR . 'includes/global.inc.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($glob['dbhost']);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $glob['dbdatabase'];&nbsp;</div></li><li><div>  $this-&gt;Username = $glob['dbusername'];&nbsp;</div></li><li><div>  $this-&gt;Password = $glob['dbpassword'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'images';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $dirHandle = opendir(M1_STORE_BASE_DIR . 'language/');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//settings for cube 5</span>&nbsp;</div></li><li><div>  $languages = array();&nbsp;</div></li><li><div>  while ($dirEntry = readdir($dirHandle)) {&nbsp;</div></li><li><div>    $info = pathinfo($dirEntry);&nbsp;</div></li><li><div>    $xmlflag = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (isset($info['extension'])) {&nbsp;</div></li><li><div>      $xmlflag = strtoupper($info['extension']) != 'XML' ? true : false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (is_dir(M1_STORE_BASE_DIR . 'language/' . $dirEntry)&nbsp;</div></li><li><div>        || $dirEntry == '.'&nbsp;</div></li><li><div>        || $dirEntry == '..'&nbsp;</div></li><li><div>        || strpos($dirEntry, '_') !== false&nbsp;</div></li><li><div>        || $xmlflag&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $configXml = simplexml_load_file(M1_STORE_BASE_DIR . 'language/' . $dirEntry);&nbsp;</div></li><li><div>    if ($configXml-&gt;info-&gt;title) {&nbsp;</div></li><li><div>      $lang['name'] = (string)$configXml-&gt;info-&gt;title;&nbsp;</div></li><li><div>      $lang['code'] = substr((string)$configXml-&gt;info-&gt;code, 0, 2);&nbsp;</div></li><li><div>      $lang['locale'] = substr((string)$configXml-&gt;info-&gt;code, 0, 2);&nbsp;</div></li><li><div>      $lang['currency'] = (string)$configXml-&gt;info-&gt;default_currency;&nbsp;</div></li><li><div>      $lang['fileName'] = str_replace('.xml', '', $dirEntry);&nbsp;</div></li><li><div>      $languages[] = $lang;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!empty($languages)) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['languages'] = $languages;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR  . 'ini.inc.php')) {&nbsp;</div></li><li><div>    $conf = file_get_contents (M1_STORE_BASE_DIR . 'ini.inc.php');&nbsp;</div></li><li><div>    preg_match(&quot;/ini\['ver'\].*/&quot;, $conf, $match);&nbsp;</div></li><li><div>    if (isset($match[0]) && !empty($match[0])) {&nbsp;</div></li><li><div>      preg_match(&quot;/\d.*/&quot;, $match[0], $project);&nbsp;</div></li><li><div>      if (isset($project[0]) && !empty($project[0])) {&nbsp;</div></li><li><div>        $version = $project[0];&nbsp;</div></li><li><div>        $version = str_replace(array(' ', '-', '_', &quot;'&quot;, ');', ';', ')'), '', $version);&nbsp;</div></li><li><div>        if ($version != '') {&nbsp;</div></li><li><div>          $this-&gt;cartVars['dbVersion'] = strtolower($version);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      preg_match(&quot;/define\('CC_VERSION.*/&quot;, $conf, $match);&nbsp;</div></li><li><div>      if (isset($match[0]) && !empty($match[0])) {&nbsp;</div></li><li><div>        preg_match(&quot;/\d.*/&quot;, $match[0], $project);&nbsp;</div></li><li><div>        if (isset($project[0]) && !empty($project[0])) {&nbsp;</div></li><li><div>          $version = $project[0];&nbsp;</div></li><li><div>          $version = str_replace(array(' ', '-', '_', &quot;'&quot;, ');', ';', ')'), '', $version);&nbsp;</div></li><li><div>          if ($version != '') {&nbsp;</div></li><li><div>            $this-&gt;cartVars['dbVersion'] = strtolower($version);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  } elseif (file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'ini.inc.php')) {&nbsp;</div></li><li><div>    $conf = file_get_contents (M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'ini.inc.php');&nbsp;</div></li><li><div>    preg_match(&quot;/ini\['ver'\].*/&quot;, $conf, $match);&nbsp;</div></li><li><div>    if (isset($match[0]) && !empty($match[0])) {&nbsp;</div></li><li><div>      preg_match(&quot;/\d.*/&quot;, $match[0], $project);&nbsp;</div></li><li><div>      if (isset($project[0]) && !empty($project[0])) {&nbsp;</div></li><li><div>        $version = $project[0];&nbsp;</div></li><li><div>        $version = str_replace(array(' ', '-', '_', &quot;'&quot;, ');', ';', ')'), '', $version);&nbsp;</div></li><li><div>        if ($version != '') {&nbsp;</div></li><li><div>          $this-&gt;cartVars['dbVersion'] = strtolower($version);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      preg_match(&quot;/define\('CC_VERSION.*/&quot;, $conf, $match);&nbsp;</div></li><li><div>      if (isset($match[0]) && !empty($match[0])) {&nbsp;</div></li><li><div>        preg_match(&quot;/\d.*/&quot;, $match[0], $project);&nbsp;</div></li><li><div>        if (isset($project[0]) && !empty($project[0])) {&nbsp;</div></li><li><div>          $version = $project[0];&nbsp;</div></li><li><div>          $version = str_replace(array(' ', '-', '_', &quot;'&quot;, ');', ';', ')'), '', $version);&nbsp;</div></li><li><div>          if ($version != '') {&nbsp;</div></li><li><div>            $this-&gt;cartVars['dbVersion'] = strtolower($version);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Tomatocart extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Tomatocart()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $config = file_get_contents(M1_STORE_BASE_DIR . 'includes/configure.php');&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_DATABASE\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $match[1];&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_SERVER_USERNAME\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Username = $match[1];&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_SERVER_PASSWORD\', \'(.*)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Password = $match[1];&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DB_SERVER\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;setHostPort( $match[1] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match(&quot;/define\(\'DIR_WS_IMAGES\', \'(.+)\'\);/&quot;, $config, $match);&nbsp;</div></li><li><div>  $this-&gt;imagesDir = $match[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . 'categories/';&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir . 'products/';&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir . 'manufacturers/';&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'application_top.php')) {&nbsp;</div></li><li><div>    $conf = file_get_contents(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'application_top.php');&nbsp;</div></li><li><div>    preg_match(&quot;/define\('PROJECT_VERSION.*/&quot;, $conf, $match);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (isset($match[0]) && !empty($match[0])) {&nbsp;</div></li><li><div>      preg_match(&quot;/\d.*/&quot;, $match[0], $project);&nbsp;</div></li><li><div>      if (isset($project[0]) && !empty($project[0])) {&nbsp;</div></li><li><div>        $version = $project[0];&nbsp;</div></li><li><div>        $version = str_replace(array(' ', '-', '_', &quot;'&quot;, ');'), '', $version);&nbsp;</div></li><li><div>        if ($version != '') {&nbsp;</div></li><li><div>          $this-&gt;cartVars['dbVersion'] = strtolower($version);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      <span class="comment">//if another version</span>&nbsp;</div></li><li><div>      if (file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'version.php')) {&nbsp;</div></li><li><div>        @require_once M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'version.php';&nbsp;</div></li><li><div>        if (defined('PROJECT_VERSION') && PROJECT_VERSION != '') {&nbsp;</div></li><li><div>          $version = PROJECT_VERSION;&nbsp;</div></li><li><div>          preg_match(&quot;/\d.*/&quot;, $version, $vers);&nbsp;</div></li><li><div>          if (isset($vers[0]) && !empty($vers[0])) {&nbsp;</div></li><li><div>            $version = $vers[0];&nbsp;</div></li><li><div>            $version = str_replace(array(' ', '-', '_'), '', $version);&nbsp;</div></li><li><div>            if ($version != '') {&nbsp;</div></li><li><div>              $this-&gt;cartVars['dbVersion'] = strtolower($version);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_DrupalCommerce extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function M1_Config_Adapter_DrupalCommerce()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  @include_once M1_STORE_BASE_DIR . &quot;sites/default/settings.php&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url = $databases['default']['default'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url['username'] = urldecode($url['username']);&nbsp;</div></li><li><div>  $url['password'] = isset($url['password']) ? urldecode($url['password']) : '';&nbsp;</div></li><li><div>  $url['host'] = urldecode($url['host']);&nbsp;</div></li><li><div>  $url['database'] = urldecode($url['database']);&nbsp;</div></li><li><div>  if (isset($url['port'])) {&nbsp;</div></li><li><div>    $url['host'] = $url['host'] .':'. $url['port'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($url['host']);&nbsp;</div></li><li><div>  $this-&gt;Dbname = ltrim($url['database'], '/');&nbsp;</div></li><li><div>  $this-&gt;Username = $url['username'];&nbsp;</div></li><li><div>  $this-&gt;Password = $url['password'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = '/sites/default/files/';&nbsp;</div></li><li><div>  if (!file_exists(M1_STORE_BASE_DIR . $this-&gt;imagesDir)) {&nbsp;</div></li><li><div>    $this-&gt;imagesDir = '/files';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fileInfo = M1_STORE_BASE_DIR . '/sites/all/modules/commerce/commerce.info';&nbsp;</div></li><li><div>  if (file_exists($fileInfo)) {&nbsp;</div></li><li><div>    $str = file_get_contents($fileInfo);&nbsp;</div></li><li><div>    if (preg_match('/version\s+=\s+&quot;.+-(.+)&quot;/', $str, $match) != 0) {&nbsp;</div></li><li><div>      $this-&gt;cartVars['dbVersion'] = $match[1];&nbsp;</div></li><li><div>      unset($match);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_JooCart extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_JooCart()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  require_once M1_STORE_BASE_DIR . '/configuration.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (class_exists('JConfig')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $jconfig = new JConfig();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;setHostPort($jconfig-&gt;host);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $jconfig-&gt;db;&nbsp;</div></li><li><div>    $this-&gt;Username = $jconfig-&gt;user;&nbsp;</div></li><li><div>    $this-&gt;Password = $jconfig-&gt;password;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;setHostPort($mosConfig_host);&nbsp;</div></li><li><div>    $this-&gt;Dbname = $mosConfig_db;&nbsp;</div></li><li><div>    $this-&gt;Username = $mosConfig_user;&nbsp;</div></li><li><div>    $this-&gt;Password = $mosConfig_password;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'components/com_opencart/image/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Prestashop11 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Prestashop11()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $conf_file1 = file_get_contents(M1_STORE_BASE_DIR . '/config/settings.inc.php');&nbsp;</div></li><li><div>  $conf_file2 = file_get_contents(M1_STORE_BASE_DIR . '/config/config.inc.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $files_lines = array_merge(explode(&quot;\n&quot;, $conf_file1), explode(&quot;\n&quot;, $conf_file2));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $execute = '$currentDir = \'\';';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ($files_lines as $line) {&nbsp;</div></li><li><div>    if (preg_match(&quot;/^(\s*)define\(/i&quot;, $line)) {&nbsp;</div></li><li><div>      if ((strpos($line, '_DB_') !== false)&nbsp;</div></li><li><div>          || (strpos($line, '_PS_IMG_DIR_') !== false)&nbsp;</div></li><li><div>          || (strpos($line, '_PS_VERSION_') !== false)&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>        $execute .= ' ' . $line;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  define('_PS_ROOT_DIR_', M1_STORE_BASE_DIR);&nbsp;</div></li><li><div>  eval($execute);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort(_DB_SERVER_);&nbsp;</div></li><li><div>  $this-&gt;Dbname = _DB_NAME_;&nbsp;</div></li><li><div>  $this-&gt;Username = _DB_USER_;&nbsp;</div></li><li><div>  $this-&gt;Password = _DB_PASSWD_;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('_PS_IMG_DIR_') && defined('_PS_ROOT_DIR_')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    preg_match(&quot;/(\/\w+\/)$/i&quot;, _PS_IMG_DIR_, $m);&nbsp;</div></li><li><div>    $this-&gt;imagesDir = $m[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $this-&gt;imagesDir = '/img/';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('_PS_VERSION_')) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = _PS_VERSION_;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class miSettings {&nbsp;</div></li><li><div>var $arr;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function singleton()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  static $instance = null;&nbsp;</div></li><li><div>  if ($instance == null) {&nbsp;</div></li><li><div>    $instance = new miSettings();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $instance;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function setArray($arr)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;arr[] = $arr;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function getArray()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return $this-&gt;arr;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Summercart3 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Summercart3()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  @include_once M1_STORE_BASE_DIR . 'include/miphpf/Config.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $instance = miSettings::singleton();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $data = $instance-&gt;getArray();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($data[0]['MI_DEFAULT_DB_HOST']);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $data[0]['MI_DEFAULT_DB_NAME'];&nbsp;</div></li><li><div>  $this-&gt;Username = $data[0]['MI_DEFAULT_DB_USER'];&nbsp;</div></li><li><div>  $this-&gt;Password = $data[0]['MI_DEFAULT_DB_PASS'];&nbsp;</div></li><li><div>  $this-&gt;imagesDir = '/userfiles/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . 'categoryimages';&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir . 'productimages';&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir . 'manufacturer';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . '/include/VERSION')) {&nbsp;</div></li><li><div>    $indexFileContent = file_get_contents(M1_STORE_BASE_DIR . '/include/VERSION');&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = trim($indexFileContent);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Ubercart extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Ubercart()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  @include_once M1_STORE_BASE_DIR . 'sites/default/settings.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url = parse_url($db_url);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url['user'] = urldecode($url['user']);&nbsp;</div></li><li><div>  <span class="comment">// Test if database url has a password.</span>&nbsp;</div></li><li><div>  $url['pass'] = isset($url['pass']) ? urldecode($url['pass']) : '';&nbsp;</div></li><li><div>  $url['host'] = urldecode($url['host']);&nbsp;</div></li><li><div>  $url['path'] = urldecode($url['path']);&nbsp;</div></li><li><div>  <span class="comment">// Allow for non-standard MySQL port.</span>&nbsp;</div></li><li><div>  if (isset($url['port'])) {&nbsp;</div></li><li><div>    $url['host'] = $url['host'] . ':' . $url['port'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($url['host']);&nbsp;</div></li><li><div>  $this-&gt;Dbname = ltrim($url['path'], '/');&nbsp;</div></li><li><div>  $this-&gt;Username = $url['user'];&nbsp;</div></li><li><div>  $this-&gt;Password = $url['pass'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = '/sites/default/files/';&nbsp;</div></li><li><div>  if (!file_exists(M1_STORE_BASE_DIR . $this-&gt;imagesDir)) {&nbsp;</div></li><li><div>    $this-&gt;imagesDir = '/files';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . '/modules/ubercart/uc_cart/uc_cart.info')) {&nbsp;</div></li><li><div>    $str = file_get_contents(M1_STORE_BASE_DIR . '/modules/ubercart/uc_cart/uc_cart.info');&nbsp;</div></li><li><div>    if (preg_match('/version\s+=\s+&quot;.+-(.+)&quot;/', $str, $match) != 0) {&nbsp;</div></li><li><div>      $this-&gt;cartVars['dbVersion'] = $match[1];&nbsp;</div></li><li><div>      unset($match);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Woocommerce extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Woocommerce()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//@include_once M1_STORE_BASE_DIR . &quot;wp-config.php&quot;;</span></span>&nbsp;</div></li><li><div>  $config = file_get_contents(M1_STORE_BASE_DIR . 'wp-config.php');&nbsp;</div></li><li><div>  preg_match('/define\s*\(\s*\'DB_NAME\', \s*\'(.+)\'\s*\)\s*;/', $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $match[1];&nbsp;</div></li><li><div>  preg_match('/define\s*\(\s*\'DB_USER\', \s*\'(.+)\'\s*\)\s*;/', $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Username = $match[1];&nbsp;</div></li><li><div>  preg_match('/define\s*\(\s*\'DB_PASSWORD\', \s*\'(.*)\'\s*\)\s*;/', $config, $match);&nbsp;</div></li><li><div>  $this-&gt;Password = $match[1];&nbsp;</div></li><li><div>  preg_match('/define\s*\(\s*\'DB_HOST\', \s*\'(.+)\'\s*\)\s*;/', $config, $match);&nbsp;</div></li><li><div>  $this-&gt;setHostPort($match[1]);&nbsp;</div></li><li><div>  preg_match('/\$table_prefix\s*=\s*\'(.*)\'\s*;/', $config, $match);&nbsp;</div></li><li><div>  $this-&gt;TblPrefix = $match[1];&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('option_value', 'options', &quot;option_name = 'woocommerce_db_version'&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($version != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;cartVars['categoriesDirRelative'] = 'images/categories/';&nbsp;</div></li><li><div>  $this-&gt;cartVars['productsDirRelative'] = 'images/products/';    &nbsp;</div></li><li><div>  $this-&gt;imagesDir = &quot;wp-content/uploads/images/&quot;;&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . 'categories/';&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir . 'products/';&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Cubecart3 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Cubecart3()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  include_once(M1_STORE_BASE_DIR . 'includes/global.inc.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($glob['dbhost']);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $glob['dbdatabase'];&nbsp;</div></li><li><div>  $this-&gt;Username = $glob['dbusername'];&nbsp;</div></li><li><div>  $this-&gt;Password = $glob['dbpassword'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'images/uploads';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Magento1212 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Magento1212()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var SimpleXMLElement</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $config = simplexml_load_file(M1_STORE_BASE_DIR . 'app/etc/local.xml');&nbsp;</div></li><li><div>  $statuses = simplexml_load_file(M1_STORE_BASE_DIR . 'app/code/core/Mage/Sales/etc/config.xml');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version =  $statuses-&gt;modules-&gt;Mage_Sales-&gt;version;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (version_compare($version, '1.4.0.25') &lt; 0) {&nbsp;</div></li><li><div>    $statuses = $statuses-&gt;global-&gt;sales-&gt;order-&gt;statuses;&nbsp;</div></li><li><div>    foreach ($statuses-&gt;children() as $status) {&nbsp;</div></li><li><div>      $result[$status-&gt;getName()] = (string)$status-&gt;label;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'app/Mage.php')) {&nbsp;</div></li><li><div>    $ver = file_get_contents(M1_STORE_BASE_DIR . 'app/Mage.php');&nbsp;</div></li><li><div>    if (preg_match(&quot;/getVersionInfo[^}]+\'major\' *=&gt; *\'(\d+)\'[^}]+\'minor\' *=&gt; *\'(\d+)\'[^}]+\'revision\' *=&gt; *\'(\d+)\'[^}]+\'patch\' *=&gt; *\'(\d+)\'[^}]+}/s&quot;, $ver, $match) == 1) {&nbsp;</div></li><li><div>      $mageVersion = $match[1] . '.' . $match[2] . '.' . $match[3] . '.' . $match[4];&nbsp;</div></li><li><div>      $this-&gt;cartVars['dbVersion'] = $mageVersion;&nbsp;</div></li><li><div>      unset($match);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;cartVars['orderStatus'] = $result;&nbsp;</div></li><li><div>  $this-&gt;cartVars['AdminUrl'] = (string)$config-&gt;admin-&gt;routers-&gt;adminhtml-&gt;args-&gt;frontName;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort((string)$config-&gt;global-&gt;resources-&gt;default_setup-&gt;connection-&gt;host);&nbsp;</div></li><li><div>  $this-&gt;Username = (string)$config-&gt;global-&gt;resources-&gt;default_setup-&gt;connection-&gt;username;&nbsp;</div></li><li><div>  $this-&gt;Dbname = (string)$config-&gt;global-&gt;resources-&gt;default_setup-&gt;connection-&gt;dbname;&nbsp;</div></li><li><div>  $this-&gt;Password = (string)$config-&gt;global-&gt;resources-&gt;default_setup-&gt;connection-&gt;password;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'media/';&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir . 'catalog/category/';&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir . 'catalog/product/';&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  @unlink(M1_STORE_BASE_DIR . 'app/etc/use_cache.ser');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_LemonStand extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_LemonStand()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  include (M1_STORE_BASE_DIR . 'phproad/system/phpr.php');&nbsp;</div></li><li><div>  include (M1_STORE_BASE_DIR . 'phproad/modules/phpr/classes/phpr_securityframework.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  define('PATH_APP', '');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (phpversion() &gt; 5) {&nbsp;</div></li><li><div>    eval ('Phpr::$config = new MockConfig();&nbsp;</div></li><li><div>    Phpr::$config-&gt;set(&quot;SECURE_CONFIG_PATH&quot;, M1_STORE_BASE_DIR . &quot;config/config.dat&quot;);&nbsp;</div></li><li><div>    $framework = Phpr_SecurityFramework::create();');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $config_content = $framework-&gt;get_config_content();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($config_content['mysql_params']['host']);&nbsp;</div></li><li><div>  $this-&gt;Dbname = $config_content['mysql_params']['database'];&nbsp;</div></li><li><div>  $this-&gt;Username = $config_content['mysql_params']['user'];&nbsp;</div></li><li><div>  $this-&gt;Password = $config_content['mysql_params']['password'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = '/uploaded/thumbnails/';&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = '/uploaded/';&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = '/uploaded/thumbnails/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('version_str', 'core_versions', &quot;moduleId = 'shop'&quot;);&nbsp;</div></li><li><div>  $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class MockConfig {&nbsp;</div></li><li><div>var $_data = array();&nbsp;</div></li><li><div>function set($key, $value)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;_data[$key] = $value;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get($key, $default = 'default')&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return isset($this-&gt;_data[$key]) ? $this-&gt;_data[$key] : $default;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter_Sunshop4 extends M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function M1_Config_Adapter_Sunshop4()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  @require_once M1_STORE_BASE_DIR . 'include' . DIRECTORY_SEPARATOR . 'config.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;imagesDir = 'images/products/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;categoriesImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;productsImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>  $this-&gt;manufacturersImagesDir = $this-&gt;imagesDir;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (defined('ADMIN_DIR')) {&nbsp;</div></li><li><div>    $this-&gt;cartVars['AdminUrl'] = ADMIN_DIR;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setHostPort($servername);&nbsp;</div></li><li><div>  $this-&gt;Username = $dbusername;&nbsp;</div></li><li><div>  $this-&gt;Password = $dbpassword;&nbsp;</div></li><li><div>  $this-&gt;Dbname = $dbname;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (isset($dbprefix)) {&nbsp;</div></li><li><div>    $this-&gt;TblPrefix = $dbprefix;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $version = $this-&gt;getCartVersionFromDb('value', 'settings', &quot;name = 'version'&quot;);&nbsp;</div></li><li><div>  if ($version != '') {&nbsp;</div></li><li><div>    $this-&gt;cartVars['dbVersion'] = $version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Config_Adapter&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>var $Host = 'localhost';&nbsp;</div></li><li><div>var $Port = '3306';&nbsp;</div></li><li><div>var $Username = 'root';&nbsp;</div></li><li><div>var $Password = '';&nbsp;</div></li><li><div>var $Dbname = '';&nbsp;</div></li><li><div>var $TblPrefix = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>var $cartType = 'Oscommerce22ms2';&nbsp;</div></li><li><div>var $imagesDir = '';&nbsp;</div></li><li><div>var $categoriesImagesDir = '';&nbsp;</div></li><li><div>var $productsImagesDir = '';&nbsp;</div></li><li><div>var $manufacturersImagesDir = '';&nbsp;</div></li><li><div>var $categoriesImagesDirs = '';&nbsp;</div></li><li><div>var $productsImagesDirs = '';&nbsp;</div></li><li><div>var $manufacturersImagesDirs = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>var $languages = array();&nbsp;</div></li><li><div>var $cartVars = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function create()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (isset($_GET['action']) && $_GET['action'] == 'update') {&nbsp;</div></li><li><div>    return null;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $cartType = M1_Config_Adapter::detectCartType();&nbsp;</div></li><li><div>  $className =  'M1_Config_Adapter_' . $cartType;&nbsp;</div></li><li><div>  $obj = new $className();&nbsp;</div></li><li><div>  $obj-&gt;cartType = $cartType;&nbsp;</div></li><li><div>  return $obj;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function detectCartType()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment">// Zencart137</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'configure.php')&nbsp;</div></li><li><div>      && file_exists(M1_STORE_BASE_DIR . 'ipn_main_handler.php')&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    return 'Zencart137';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//osCommerce</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'configure.php')&nbsp;</div></li><li><div>      && !file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'toc_constants.php')<span class="comment">/** is if not tomatocart */</span>&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    return 'Oscommerce22ms2';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//JooCart</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . '/components/com_opencart/opencart.php')) {&nbsp;</div></li><li><div>    return 'JooCart';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//ACEShop</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . '/components/com_aceshop/aceshop.php')) {&nbsp;</div></li><li><div>    return 'AceShop';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//MijoShop</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . '/components/com_mijoshop/mijoshop.php')) {&nbsp;</div></li><li><div>    return 'MijoShop';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Litecommerce</span>&nbsp;</div></li><li><div>  if ((file_exists(M1_STORE_BASE_DIR . '/etc/config.php'))&nbsp;</div></li><li><div>      || (file_exists(M1_STORE_BASE_DIR .'/modules/lc_connector/litecommerce/etc/config.php'))&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    return 'Litecommerce';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Prestashop11</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'config/config.inc.php')) {&nbsp;</div></li><li><div>    if (file_exists(M1_STORE_BASE_DIR . 'cache/class_index.php')) {&nbsp;</div></li><li><div>      return 'Prestashop15';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return 'Prestashop11';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Virtuemart113</span>&nbsp;</div></li><li><div>  if ((file_exists(M1_STORE_BASE_DIR . 'configuration.php'))&nbsp;</div></li><li><div>      && (!file_exists(M1_STORE_BASE_DIR . '/components/com_mijoshop/mijoshop.php'))&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    return 'Virtuemart113';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Pinnacle361</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'content/engine/engine_config.php')) {&nbsp;</div></li><li><div>    return 'Pinnacle361';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Magento1212, we can be sure that PHP is &gt;= 5.2.0</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'app/etc/local.xml')) {&nbsp;</div></li><li><div>    return 'Magento1212';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Cubecart3</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'includes/global.inc.php')) {&nbsp;</div></li><li><div>    return 'Cubecart';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Cscart203 - 3</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'config.local.php')&nbsp;</div></li><li><div>      || file_exists(M1_STORE_BASE_DIR . 'partner.php')&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    return 'Cscart203';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Opencart14</span>&nbsp;</div></li><li><div>  if ((file_exists(M1_STORE_BASE_DIR . 'system/startup.php')&nbsp;</div></li><li><div>      || (file_exists(M1_STORE_BASE_DIR . 'common.php'))&nbsp;</div></li><li><div>      || (file_exists(M1_STORE_BASE_DIR . 'library/locator.php')))&nbsp;</div></li><li><div>      && file_exists(M1_STORE_BASE_DIR . 'config.php')&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    return 'Opencart14';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//XCart</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'config.php')) {&nbsp;</div></li><li><div>    return 'XCart';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//LemonStand</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'boot.php')) {&nbsp;</div></li><li><div>    return 'LemonStand';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Interspire</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'config/config.php')) {&nbsp;</div></li><li><div>    return 'Interspire';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Squirrelcart242</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'squirrelcart/config.php')) {&nbsp;</div></li><li><div>    return 'Squirrelcart242';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Shopscript282</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'kernel/wbs.xml')) {&nbsp;</div></li><li><div>    return 'Shopscript282';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Shopscriptfree</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'cfg/connect.inc.php')) {&nbsp;</div></li><li><div>    return 'Shopscriptfree';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Summercart3</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'sclic.lic')&nbsp;</div></li><li><div>      && file_exists(M1_STORE_BASE_DIR . 'include/miphpf/Config.php')&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    return 'Summercart3';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//XtcommerceVeyton</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'conf/config.php')) {&nbsp;</div></li><li><div>    return 'XtcommerceVeyton';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Ubercart</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'sites/default/settings.php')) {&nbsp;</div></li><li><div>    if (file_exists(M1_STORE_BASE_DIR . 'sites/all/modules/ubercart/uc_store/includes/coder_review_uc3x.inc')) {&nbsp;</div></li><li><div>      return 'Ubercart3';&nbsp;</div></li><li><div>    } elseif (file_exists(M1_STORE_BASE_DIR . 'sites/all/modules/commerce/includes/commerce.controller.inc')) {&nbsp;</div></li><li><div>      return 'DrupalCommerce';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return 'Ubercart';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//WPecommerce</span></span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'wp-config.php')&nbsp;</div></li><li><div>      && file_exists(M1_STORE_BASE_DIR . 'wp-content/plugins/woocommerce/woocommerce.php')) {&nbsp;</div></li><li><div>    return 'Woocommerce';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">//WPecommerce</span></span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'wp-config.php')) {&nbsp;</div></li><li><div>    return 'WPecommerce';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//OXID e-shop</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'oxid.php')&nbsp;</div></li><li><div>      || file_exists(M1_STORE_BASE_DIR . '/core/oxid.php')) {&nbsp;</div></li><li><div>    return 'Oxid';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//HHGMultistore</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'core/config/configure.php')) {&nbsp;</div></li><li><div>    return 'Hhgmultistore';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//SunShop</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'include' . DIRECTORY_SEPARATOR . 'config.php')&nbsp;</div></li><li><div>      || file_exists(M1_STORE_BASE_DIR . 'include' . DIRECTORY_SEPARATOR . 'db_mysql.php')&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    return 'Sunshop4';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Tomatocart</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'configure.php')&nbsp;</div></li><li><div>      && file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'toc_constants.php')&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>    return 'Tomatocart';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//Loaded7</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'includes' . DIRECTORY_SEPARATOR . 'config.php')) {&nbsp;</div></li><li><div>    return 'Loaded7';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//PS</span>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'ps_config.php')) {&nbsp;</div></li><li><div>    return 'Prostores';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  die ('BRIDGE_ERROR_CONFIGURATION_NOT_FOUND');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function getAdapterPath($cartType)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return M1_STORE_BASE_DIR .&nbsp;</div></li><li><div>                 M1_BRIDGE_DIRECTORY_NAME . DIRECTORY_SEPARATOR .&nbsp;</div></li><li><div>                 'app' . DIRECTORY_SEPARATOR .&nbsp;</div></li><li><div>                 'class' . DIRECTORY_SEPARATOR .&nbsp;</div></li><li><div>                 'config_adapter' . DIRECTORY_SEPARATOR . $cartType . '.php';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function setHostPort($source)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $source = trim($source);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($source == '') {&nbsp;</div></li><li><div>    $this-&gt;Host = 'localhost';&nbsp;</div></li><li><div>    return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $conf = explode(':', $source);&nbsp;</div></li><li><div>  if (isset($conf[0]) && isset($conf[1])) {&nbsp;</div></li><li><div>    $this-&gt;Host = $conf[0];&nbsp;</div></li><li><div>    $this-&gt;Port = $conf[1];&nbsp;</div></li><li><div>  } elseif ($source[0] == '/') {&nbsp;</div></li><li><div>    $this-&gt;Host = 'localhost';&nbsp;</div></li><li><div>    $this-&gt;Port = $source;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $this-&gt;Host = $source;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function connect()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $triesCount = 10;&nbsp;</div></li><li><div>  $link = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $host = $this-&gt;Host.($this-&gt;Port? ':'.$this-&gt;Port : '');&nbsp;</div></li><li><div>  while (!$link) {&nbsp;</div></li><li><div>    if (!$triesCount--) {&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $link = @mysql_connect($host, $this-&gt;Username, $this-&gt;Password);&nbsp;</div></li><li><div>    if (!$link) {&nbsp;</div></li><li><div>      sleep(5);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($link) {&nbsp;</div></li><li><div>    mysql_select_db($this-&gt;Dbname, $link);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $link;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function getCartVersionFromDb($field, $tableName, $where)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $_link = null;&nbsp;</div></li><li><div>  $version = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_link = $this-&gt;connect();&nbsp;</div></li><li><div>  if (!$_link) {&nbsp;</div></li><li><div>    return '[ERROR] MySQL Query Error: Can not connect to DB';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sql = 'SELECT ' . $field . ' AS version FROM ' . $this-&gt;TblPrefix . $tableName . ' WHERE ' . $where;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $query = mysql_query($sql, $_link);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($query !== false) {&nbsp;</div></li><li><div>    $row = mysql_fetch_assoc($query);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $version = $row['version'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $version;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Clearcache&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  switch ($bridge-&gt;config-&gt;cartType) {&nbsp;</div></li><li><div>    case 'Cubecart':&nbsp;</div></li><li><div>      $this-&gt;_CubecartClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Prestashop11':&nbsp;</div></li><li><div>      $this-&gt;_PrestashopClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Interspire':&nbsp;</div></li><li><div>      $this-&gt;_InterspireClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Opencart14' :&nbsp;</div></li><li><div>      $this-&gt;_OpencartClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'XtcommerceVeyton' :&nbsp;</div></li><li><div>      $this-&gt;_Xtcommerce4ClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Ubercart' :&nbsp;</div></li><li><div>      $this-&gt;_ubercartClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Tomatocart' :&nbsp;</div></li><li><div>      $this-&gt;_tomatocartClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Virtuemart113' :&nbsp;</div></li><li><div>      $this-&gt;_virtuemartClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Magento1212' :&nbsp;</div></li><li><div>      <span class="comment">//$this-&gt;_magentoClearCache();</span>&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Oscommerce3':&nbsp;</div></li><li><div>      $this-&gt;_Oscommerce3ClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Oxid':&nbsp;</div></li><li><div>      $this-&gt;_OxidClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'XCart':&nbsp;</div></li><li><div>      $this-&gt;_XcartClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Cscart203':&nbsp;</div></li><li><div>      $this-&gt;_CscartClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Prestashop15':&nbsp;</div></li><li><div>      $this-&gt;_Prestashop15ClearCache();&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _removeGarbage($dirs = array(), $fileExclude = '')&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $result = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ($dirs as $dir) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (!file_exists($dir)) {&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $dirHandle = opendir($dir);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    while (false !== ($file = readdir($dirHandle))) {&nbsp;</div></li><li><div>      if ($file == '.' || $file == '..') {&nbsp;</div></li><li><div>        continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ((trim($fileExclude) != '') && preg_match('/^' . $fileExclude . '?$/', $file)) {&nbsp;</div></li><li><div>        continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (is_dir($dir . $file)) {&nbsp;</div></li><li><div>        continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!unlink($dir . $file)) {&nbsp;</div></li><li><div>        $result = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    closedir($dirHandle);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($result) {&nbsp;</div></li><li><div>    print 'OK';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    print 'ERROR';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _magentoClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  chdir('../');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $indexes = array(&nbsp;</div></li><li><div>    'catalog_product_attribute', &nbsp;</div></li><li><div>    'catalog_product_price', &nbsp;</div></li><li><div>    'catalog_url', &nbsp;</div></li><li><div>    'catalog_product_flat', &nbsp;</div></li><li><div>    'catalog_category_flat', &nbsp;</div></li><li><div>    'catalog_category_product', &nbsp;</div></li><li><div>    'catalogsearch_fulltext', &nbsp;</div></li><li><div>    'cataloginventory_stock', &nbsp;</div></li><li><div>    'tag_summary'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $phpExecutable = getPHPExecutable();&nbsp;</div></li><li><div>  if ($phpExecutable) {&nbsp;</div></li><li><div>    foreach ($indexes as $index) {&nbsp;</div></li><li><div>      exec($phpExecutable . &quot; shell/indexer.php --reindex $index&quot;, $out);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    print &quot;OK&quot;;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    echo 'Error: can not find PHP executable file.';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  print 'OK';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _InterspireClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $res = true;&nbsp;</div></li><li><div>  $file = M1_STORE_BASE_DIR . 'cache' . DIRECTORY_SEPARATOR . 'datastore' . DIRECTORY_SEPARATOR . 'RootCategories.php';&nbsp;</div></li><li><div>  if (file_exists($file)) {&nbsp;</div></li><li><div>    if (!unlink($file)) {&nbsp;</div></li><li><div>      $res = false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($res === true) {&nbsp;</div></li><li><div>    echo 'OK';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    echo 'ERROR';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _CubecartClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $ok = true;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'cache')) {&nbsp;</div></li><li><div>    $dirHandle = opendir(M1_STORE_BASE_DIR . 'cache/');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    while (false !== ($file = readdir($dirHandle))) {&nbsp;</div></li><li><div>      if ($file != '.' && $file != '..' && !preg_match(&quot;/^index\.html?$/&quot;, $file) && !preg_match(&quot;/^\.htaccess?$/&quot;, $file) ) {&nbsp;</div></li><li><div>        if (is_file(M1_STORE_BASE_DIR . 'cache/' . $file)) {&nbsp;</div></li><li><div>          if (!unlink(M1_STORE_BASE_DIR . 'cache/' . $file)) {&nbsp;</div></li><li><div>            $ok = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    closedir($dirHandle);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (file_exists(M1_STORE_BASE_DIR . 'includes/extra/admin_cat_cache.txt')) {&nbsp;</div></li><li><div>    unlink(M1_STORE_BASE_DIR . 'includes/extra/admin_cat_cache.txt');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($ok) {&nbsp;</div></li><li><div>    print 'OK';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    print 'ERROR';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _PrestashopClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'tools/smarty/compile/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'tools/smarty/cache/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'img/tmp/'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_removeGarbage($dirs, 'index\.php');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _OpencartClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'system/cache/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_removeGarbage($dirs, 'index\.html');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _Xtcommerce4ClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'cache/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_removeGarbage($dirs, 'index\.html');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _ubercartClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'sites/default/files/imagecache/product/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'sites/default/files/imagecache/product_full/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'sites/default/files/imagecache/product_list/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'sites/default/files/imagecache/uc_category/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'sites/default/files/imagecache/uc_thumbnail/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_removeGarbage($dirs);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _tomatocartClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'includes/work/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_removeGarbage($dirs, '\.htaccess');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Try to change permissions actually :)</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _virtuemartClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $pathToImages = 'components/com_virtuemart/shop_image';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $dir_parts = explode('/', $pathToImages);&nbsp;</div></li><li><div>  $path = M1_STORE_BASE_DIR;&nbsp;</div></li><li><div>  foreach ($dir_parts as $item) {&nbsp;</div></li><li><div>    if ($item == '') {&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $path .= $item . DIRECTORY_SEPARATOR;&nbsp;</div></li><li><div>    @chmod($path, 0755);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _Oscommerce3ClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'osCommerce/OM/Work/Cache/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_removeGarbage($dirs, '\.htaccess');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _OxidClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'tmp/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_removeGarbage($dirs, '\.htaccess');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _XcartClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'var/cache/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_removeGarbage($dirs, '\.htaccess');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _CscartClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dir = M1_STORE_BASE_DIR . 'var/cache/';&nbsp;</div></li><li><div>  $res = $this-&gt;removeDirRec($dir);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($res) {&nbsp;</div></li><li><div>    print &quot;OK\n&quot;;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    print &quot;ERROR\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _Prestashop15ClearCache()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'cache/smarty/compile/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'cache/smarty/cache/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . 'img/tmp/'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_removeGarbage($dirs, 'index\.php');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function removeDirRec($dir)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $result = true;&nbsp;</div></li><li><div>  if ($objs = glob($dir . '<span class="comment">/*')) {</span>&nbsp;</div></li><li><div><span class="comment">    foreach ($objs as $obj) {</span>&nbsp;</div></li><li><div><span class="comment">      if (is_dir($obj)) {</span>&nbsp;</div></li><li><div><span class="comment">        $this-&gt;removeDirRec($obj);</span>&nbsp;</div></li><li><div><span class="comment">      } else {</span>&nbsp;</div></li><li><div><span class="comment">        if(!unlink($obj)) {</span>&nbsp;</div></li><li><div><span class="comment">          $result = false;</span>&nbsp;</div></li><li><div><span class="comment">        }</span>&nbsp;</div></li><li><div><span class="comment">      }</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if (!rmdir($dir)) {</span>&nbsp;</div></li><li><div><span class="comment">    $result = false;</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  return $result;</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">class M1_Bridge_Action_Getmagentolog</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">var $dir = 'var/log';</span>&nbsp;</div></li><li><div><span class="comment">var $files = array(</span>&nbsp;</div></li><li><div><span class="comment">  'exception.log', </span>&nbsp;</div></li><li><div><span class="comment">  'system.log'</span>&nbsp;</div></li><li><div><span class="comment"> );</span>&nbsp;</div></li><li><div><span class="comment">var $maxReadLines = 200;</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function perform($bridge)</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  if (!file_exists(M1_STORE_BASE_DIR . $this-&gt;dir)) {</span>&nbsp;</div></li><li><div><span class="comment">    die('ERROR_LOG_DIR_NOT_EXIST');</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  foreach ($this-&gt;files as $file) {</span>&nbsp;</div></li><li><div><span class="comment">    $filename = M1_STORE_BASE_DIR . $this-&gt;dir . '/' . $file;</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    echo '&lt;h2&gt;Read file &quot;' . $filename . '&quot;: &lt;/h2&gt;';</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    if (!is_file($filename)) {</span>&nbsp;</div></li><li><div><span class="comment">      echo 'ERROR_FILE_NOT_EXISTS&lt;br /&gt;';</span>&nbsp;</div></li><li><div><span class="comment">      continue;</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    if (filesize($filename) == 0) {</span>&nbsp;</div></li><li><div><span class="comment">      echo 'ERROR_FILE_IS_EMPTY&lt;br /&gt;';</span>&nbsp;</div></li><li><div><span class="comment">      continue;</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    $lines = file($filename);</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    if (count($lines) &gt; $this-&gt;maxReadLines) {</span>&nbsp;</div></li><li><div><span class="comment">      $lines = array_slice($lines, count($lines) - $this-&gt;maxReadLines, $this-&gt;maxReadLines);</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    echo nl2br(implode('', $lines));</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">class M1_Bridge_Action_Savefile</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">var $_imageType = null;</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function perform($bridge)</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  $source = $_POST['src'];</span>&nbsp;</div></li><li><div><span class="comment">  $destination = $_POST['dst'];</span>&nbsp;</div></li><li><div><span class="comment">  $width = (int)$_POST['width'];</span>&nbsp;</div></li><li><div><span class="comment">  $height = (int)$_POST['height'];</span>&nbsp;</div></li><li><div><span class="comment">  $local = $_POST['local_source'];</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  echo $this-&gt;_saveFile($source, $destination, $width, $height, $local);</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function _saveFile($source, $destination, $width, $height, $local = '')</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  if (trim($local) != '') {</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    if ($this-&gt;_copyLocal($local, $destination, $width, $height)) {</span>&nbsp;</div></li><li><div><span class="comment">      return 'OK';</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if ($this-&gt;_isSameHost($source)) {</span>&nbsp;</div></li><li><div><span class="comment">    $result = $this-&gt;_saveFileLocal($source, $destination);</span>&nbsp;</div></li><li><div><span class="comment">  } else {</span>&nbsp;</div></li><li><div><span class="comment">    $result = $this-&gt;_saveFileCurl($source, $destination);</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if ($result != 'OK') {</span>&nbsp;</div></li><li><div><span class="comment">    return $result;</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  $destination = M1_STORE_BASE_DIR . $destination;</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if ($width != 0 && $height != 0) {</span>&nbsp;</div></li><li><div><span class="comment">    $this-&gt;_scaled2($destination, $width, $height);</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">  </span>&nbsp;</div></li><li><div><span class="comment">  if ($this-&gt;cartType == 'Prestashop11' || $this-&gt;cartType == 'Prestashop15') {</span>&nbsp;</div></li><li><div><span class="comment">    // convert destination.gif(png) to destination.jpg</span>&nbsp;</div></li><li><div><span class="comment">    $imageGd = $this-&gt;_loadImage($destination);</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    if ($imageGd === false) {</span>&nbsp;</div></li><li><div><span class="comment">      return $result;</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    if (!$this-&gt;_convert($imageGd, $destination, IMAGETYPE_JPEG, 'jpg')) {</span>&nbsp;</div></li><li><div><span class="comment">      return 'CONVERT FAILED';</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  return $result;</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function _copyLocal($source, $destination, $width, $height)</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  $source = M1_STORE_BASE_DIR . $source;</span>&nbsp;</div></li><li><div><span class="comment">  $destination = M1_STORE_BASE_DIR . $destination;</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if (!@copy($source, $destination)) {</span>&nbsp;</div></li><li><div><span class="comment">    return false;</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if ($width != 0 && $height != 0) {</span>&nbsp;</div></li><li><div><span class="comment">    $this-&gt;_scaled2($destination, $width, $height);</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  return true;</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function _loadImage($filename, $skipJpg = true)</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  $image_info = @getimagesize($filename);</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if ($image_info === false) {</span>&nbsp;</div></li><li><div><span class="comment">    return false;</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  $this-&gt;_imageType = $image_info[2];</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  switch ($this-&gt;_imageType) {</span>&nbsp;</div></li><li><div><span class="comment">    case IMAGETYPE_JPEG :</span>&nbsp;</div></li><li><div><span class="comment">      $image = imagecreatefromjpeg($filename);</span>&nbsp;</div></li><li><div><span class="comment">      break;</span>&nbsp;</div></li><li><div><span class="comment">    case IMAGETYPE_GIF  :</span>&nbsp;</div></li><li><div><span class="comment">      $image = imagecreatefromgif($filename);</span>&nbsp;</div></li><li><div><span class="comment">      break;</span>&nbsp;</div></li><li><div><span class="comment">    case IMAGETYPE_PNG  :</span>&nbsp;</div></li><li><div><span class="comment">      $image = imagecreatefrompng($filename);</span>&nbsp;</div></li><li><div><span class="comment">      break;</span>&nbsp;</div></li><li><div><span class="comment">    default:</span>&nbsp;</div></li><li><div><span class="comment">      return false;</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if ($skipJpg && ($this-&gt;_imageType == IMAGETYPE_JPEG)) {</span>&nbsp;</div></li><li><div><span class="comment">    return false;</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  return $image;</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function _saveImage($image, $filename, $image_type = IMAGETYPE_JPEG, $compression = 85, $permissions = null)</span>&nbsp;</div></li><li><div><span class="comment">{    </span>&nbsp;</div></li><li><div><span class="comment">  $result = true;</span>&nbsp;</div></li><li><div><span class="comment">  if ($image_type == IMAGETYPE_JPEG) {</span>&nbsp;</div></li><li><div><span class="comment">    $result = imagejpeg($image, $filename, $compression);</span>&nbsp;</div></li><li><div><span class="comment">  } elseif ($image_type == IMAGETYPE_GIF) {</span>&nbsp;</div></li><li><div><span class="comment">    $result = imagegif($image, $filename);</span>&nbsp;</div></li><li><div><span class="comment">  } elseif ($image_type == IMAGETYPE_PNG) {</span>&nbsp;</div></li><li><div><span class="comment">    $result = imagepng($image, $filename);</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if ($permissions != null) {</span>&nbsp;</div></li><li><div><span class="comment">    chmod($filename, $permissions);</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  imagedestroy($image);</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  return $result;</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function _saveFileLocal($source, $destination)</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  $srcInfo = parse_url($source);</span>&nbsp;</div></li><li><div><span class="comment">  $src = rtrim($_SERVER['DOCUMENT_ROOT'], '/') . $srcInfo['path'];</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if ($this-&gt;_create_dir(dirname($destination)) !== false) {</span>&nbsp;</div></li><li><div><span class="comment">    $dst = M1_STORE_BASE_DIR . $destination;</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    if (!@copy($src, $dst)) {</span>&nbsp;</div></li><li><div><span class="comment">      return $this-&gt;_saveFileCurl($source, $destination);</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">  } else {</span>&nbsp;</div></li><li><div><span class="comment">    return '[BRIDGE ERROR] Deirectory creation failed!';</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  return 'OK';</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function _saveFileCurl($source, $destination)</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  $source = $this-&gt;_escapeSource($source);</span>&nbsp;</div></li><li><div><span class="comment">  if ($this-&gt;_create_dir(dirname($destination)) !== false) {</span>&nbsp;</div></li><li><div><span class="comment">    $destination = M1_STORE_BASE_DIR . $destination;</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    $ch = curl_init();</span>&nbsp;</div></li><li><div><span class="comment">    curl_setopt($ch, CURLOPT_URL, $source);</span>&nbsp;</div></li><li><div><span class="comment">    curl_setopt($ch, CURLOPT_HEADER, 0);</span>&nbsp;</div></li><li><div><span class="comment">    curl_setopt($ch, CURLOPT_TIMEOUT, 60);</span>&nbsp;</div></li><li><div><span class="comment">    curl_setopt($ch, CURLOPT_USERAGENT, &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1&quot;);</span>&nbsp;</div></li><li><div><span class="comment">    curl_setopt($ch, CURLOPT_NOBODY, true);</span>&nbsp;</div></li><li><div><span class="comment">    curl_exec($ch);</span>&nbsp;</div></li><li><div><span class="comment">    $httpResponseCode = (int)curl_getinfo($ch, CURLINFO_HTTP_CODE);</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    if ($httpResponseCode != 200) {</span>&nbsp;</div></li><li><div><span class="comment">       curl_close($ch);</span>&nbsp;</div></li><li><div><span class="comment">      return '[BRIDGE ERROR] Bad response received from source, HTTP code ' . $httpResponseCode . '!';</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    $dst = @fopen($destination, 'wb');</span>&nbsp;</div></li><li><div><span class="comment">    if ($dst === false) {</span>&nbsp;</div></li><li><div><span class="comment">      return '[BRIDGE ERROR] Can\'t create ' . $destination . '!';</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    curl_setopt($ch, CURLOPT_NOBODY, false);</span>&nbsp;</div></li><li><div><span class="comment">    curl_setopt($ch, CURLOPT_FILE, $dst);</span>&nbsp;</div></li><li><div><span class="comment">    curl_setopt($ch, CURLOPT_HTTPGET, true);</span>&nbsp;</div></li><li><div><span class="comment">    curl_exec($ch);</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    if (($error_no = curl_errno($ch)) != CURLE_OK) {</span>&nbsp;</div></li><li><div><span class="comment">      return '[BRIDGE ERROR] ' . $error_no . ': ' . curl_error($ch);</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    curl_close($ch);</span>&nbsp;</div></li><li><div><span class="comment">    @chmod($destination, 0777);</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    return 'OK';</span>&nbsp;</div></li><li><div><span class="comment">  } else {</span>&nbsp;</div></li><li><div><span class="comment">    return '[BRIDGE ERROR] Directory creation failed!';</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function _escapeSource($source)</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  return str_replace(' ', '%20', $source);</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function _create_dir($dir)</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  $dir_parts = explode('/', $dir);</span>&nbsp;</div></li><li><div><span class="comment">  $path = M1_STORE_BASE_DIR;</span>&nbsp;</div></li><li><div><span class="comment">  foreach ($dir_parts as $item) {</span>&nbsp;</div></li><li><div><span class="comment">    if ($item == '') {</span>&nbsp;</div></li><li><div><span class="comment">      continue;</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    $path .= $item . DIRECTORY_SEPARATOR;</span>&nbsp;</div></li><li><div><span class="comment">    if (!is_dir($path)) {</span>&nbsp;</div></li><li><div><span class="comment">      $res = @mkdir($path);</span>&nbsp;</div></li><li><div><span class="comment">      if (!$res) {</span>&nbsp;</div></li><li><div><span class="comment">        return false;</span>&nbsp;</div></li><li><div><span class="comment">      }</span>&nbsp;</div></li><li><div><span class="comment">    }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">    @chmod($path, 0777);</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  return true;</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">function _isSameHost($source)</span>&nbsp;</div></li><li><div><span class="comment">{</span>&nbsp;</div></li><li><div><span class="comment">  $srcInfo = parse_url($source);</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  if (preg_match('/\.php$/', $srcInfo['path'])) {</span>&nbsp;</div></li><li><div><span class="comment">    return false;</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  $hostInfo = parse_url('http://' . $_SERVER['HTTP_HOST']);</span>&nbsp;</div></li><li><div><span class="comment">  if (@$srcInfo['host'] == $hostInfo['host']) {</span>&nbsp;</div></li><li><div><span class="comment">    return true;</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  return false;</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @param $image     - GD image object</span>&nbsp;</div></li><li><div><span class="comment"> * @param $filename  - store sorce pathfile ex. M1_STORE_BASE_DIR . '/img/c/2.gif';</span>&nbsp;</div></li><li><div><span class="comment"> * @param $type      - IMAGETYPE_JPEG, IMAGETYPE_GIF or IMAGETYPE_PNG</span>&nbsp;</div></li><li><div><span class="comment"> * @param $extension - file extension, this use for jpg or jpeg extension in prestashop</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return true if success or false if no</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _convert($image, $filename, $type = IMAGETYPE_JPEG, $extension = '')&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $end = pathinfo($filename, PATHINFO_EXTENSION);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($extension == '') {&nbsp;</div></li><li><div>    $extension = image_type_to_extension($type, false);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($end == $extension) {&nbsp;</div></li><li><div>    return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $width = imagesx($image);&nbsp;</div></li><li><div>  $height = imagesy($image);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $newImage = imagecreatetruecolor($width, $height);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** Allow to keep nice look even if resized */</span>&nbsp;</div></li><li><div>  $white = imagecolorallocate($newImage, 255, 255, 255);&nbsp;</div></li><li><div>  imagefill($newImage, 0, 0, $white);&nbsp;</div></li><li><div>  imagecopyresampled($newImage, $image, 0, 0, 0, 0, $width, $height, $width, $height);&nbsp;</div></li><li><div>  imagecolortransparent($newImage, $white);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pathSave = rtrim($filename, $end);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pathSave .= $extension;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $this-&gt;_saveImage($newImage, $pathSave, $type);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _scaled($destination, $width, $height)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $image = $this-&gt;_loadImage($destination, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($image === false) {&nbsp;</div></li><li><div>    return 'IMAGE NOT SUPPORTED';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $originWidth = imagesx($image);&nbsp;</div></li><li><div>  $originHeight = imagesy($image);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $rw = (int)$height * (int)$originWidth / (int)$originHeight;&nbsp;</div></li><li><div>  $useHeight = ($rw &lt;= $width);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($useHeight) {&nbsp;</div></li><li><div>    $width = (int)$rw;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $height = (int)((int)($width) * (int)($originHeight) / (int)($originWidth));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $new_image = imagecreatetruecolor($width, $height);&nbsp;</div></li><li><div>  $white = imagecolorallocate($new_image, 255, 255, 255);&nbsp;</div></li><li><div>  imagefill($new_image, 0, 0, $white);&nbsp;</div></li><li><div>  imagecopyresampled($new_image, $image, 0, 0, 0, 0, $width, $height, $originWidth, $originHeight);&nbsp;</div></li><li><div>  imagecolortransparent($new_image, $white);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $this-&gt;_saveImage($new_image, $destination, $this-&gt;_imageType, 100) ? 'OK' : 'CAN\'T SCALE IMAGE';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//scaled2 method optimizet for prestashop</span>&nbsp;</div></li><li><div>function _scaled2($destination, $destWidth, $destHeight)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $method = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sourceImage = $this-&gt;_loadImage($destination, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($sourceImage === false) {&nbsp;</div></li><li><div>    return 'IMAGE NOT SUPPORTED';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sourceWidth = imagesx($sourceImage);&nbsp;</div></li><li><div>  $sourceHeight = imagesy($sourceImage);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $widthDiff = $destWidth / $sourceWidth;&nbsp;</div></li><li><div>  $heightDiff = $destHeight / $sourceHeight;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($widthDiff &gt; 1 && $heightDiff &gt; 1) {&nbsp;</div></li><li><div>    $nextWidth = $sourceWidth;&nbsp;</div></li><li><div>    $nextHeight = $sourceHeight;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    if (intval($method) == 2 || (intval($method) == 0 AND $widthDiff &gt; $heightDiff)) {&nbsp;</div></li><li><div>      $nextHeight = $destHeight;&nbsp;</div></li><li><div>      $nextWidth = intval(($sourceWidth * $nextHeight) / $sourceHeight);&nbsp;</div></li><li><div>      $destWidth = ((intval($method) == 0) ? $destWidth : $nextWidth);&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $nextWidth = $destWidth;&nbsp;</div></li><li><div>      $nextHeight = intval($sourceHeight * $destWidth / $sourceWidth);&nbsp;</div></li><li><div>      $destHeight = (intval($method) == 0 ? $destHeight : $nextHeight);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $borderWidth = intval(($destWidth - $nextWidth) / 2);&nbsp;</div></li><li><div>  $borderHeight = intval(($destHeight - $nextHeight) / 2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $destImage = imagecreatetruecolor($destWidth, $destHeight);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $white = imagecolorallocate($destImage, 255, 255, 255);&nbsp;</div></li><li><div>  imagefill($destImage, 0, 0, $white);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  imagecopyresampled($destImage, $sourceImage, $borderWidth, $borderHeight, 0, 0, $nextWidth, $nextHeight, $sourceWidth, $sourceHeight);&nbsp;</div></li><li><div>  imagecolortransparent($destImage, $white);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $this-&gt;_saveImage($destImage, $destination, $this-&gt;_imageType, 100) ? 'OK' : 'CAN\'T SCALE IMAGE';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Mysqlver&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $m = array();&nbsp;</div></li><li><div>  preg_match('/^(\d+)\.(\d+)\.(\d+)/', mysql_get_server_info($bridge-&gt;getLink()), $m);&nbsp;</div></li><li><div>  echo sprintf(&quot;%d%02d%02d&quot;, $m[1], $m[2], $m[3]);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>define('MSG_INFO', 0);&nbsp;</div></li><li><div>define('MSG_WARN', 1);&nbsp;</div></li><li><div>define('MSG_ERROR', 2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Dump&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>var $_backupFolder = 'backup';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>var $_dbname = null;&nbsp;</div></li><li><div>var $_dbhost = null;&nbsp;</div></li><li><div>var $_dbuser = null;&nbsp;</div></li><li><div>var $_dbpass = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>var $_link = null;&nbsp;</div></li><li><div>var $_maxAllowedPacket = null;&nbsp;</div></li><li><div>var $_file = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;_dbname = $bridge-&gt;config-&gt;Dbname;&nbsp;</div></li><li><div>  $this-&gt;_dbhost = $bridge-&gt;config-&gt;Host;&nbsp;</div></li><li><div>  $this-&gt;_dbuser = $bridge-&gt;config-&gt;Username;&nbsp;</div></li><li><div>  $this-&gt;_dbpass = $bridge-&gt;config-&gt;Password;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $method = isset($_GET['method']) ? $_GET['method'] : 'none';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ($method) {&nbsp;</div></li><li><div>    case 'backup':&nbsp;</div></li><li><div>      $this-&gt;_checkFolder($bridge);&nbsp;</div></li><li><div>      $this-&gt;backup();&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    case 'restore':&nbsp;</div></li><li><div>      $this-&gt;_checkFolder($bridge);&nbsp;</div></li><li><div>      $backup = isset($_GET['file']) ? str_replace('/', '', $_GET['file']) : '';&nbsp;</div></li><li><div>      $this-&gt;restore($backup);&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    case 'list':&nbsp;</div></li><li><div>      $this-&gt;_checkFolder($bridge, false);&nbsp;</div></li><li><div>      $this-&gt;listdb();&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    default:&nbsp;</div></li><li><div>      $this-&gt;log('Backup not created!', '', MSG_ERROR);&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Backup db store</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function backup()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;_connect_mysql();&nbsp;</div></li><li><div>  $this-&gt;setNames();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = $this-&gt;query('SHOW TABLES');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $listTables = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $nameFile = $this-&gt;_backupFolder .'/' . $this-&gt;_dbname . '_' . date('Y_m_d_H_i') . '.sql';&nbsp;</div></li><li><div>  $this-&gt;open($nameFile, 'w');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  while (($res = mysql_fetch_row($result)) !== FALSE) {&nbsp;</div></li><li><div>    $listTables[] = $res[0];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $backup = &quot;<span class="comment">/*  Backup Database &quot; . $this-&gt;_dbname . &quot;  */</span>\n&quot;&nbsp;</div></li><li><div>            . &quot;<span class="comment">/*  Date: &quot; . date('Y-m-d H:i'). &quot;  */</span>&quot;;&nbsp;</div></li><li><div>  fwrite($this-&gt;_file, $backup);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;log('Start create backup database');&nbsp;</div></li><li><div>  foreach ($listTables as $table) {&nbsp;</div></li><li><div>    $backup = $this-&gt;createTable($table);&nbsp;</div></li><li><div>    fwrite($this-&gt;_file, $backup);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;insertsTable($table);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;log('Write backup in file', $nameFile);&nbsp;</div></li><li><div>  fclose($this-&gt;_file);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;log('End backup');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @param M1_Bridge $bridge</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $viewsError</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _checkFolder($bridge, $viewsError = true)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $message = '';&nbsp;</div></li><li><div>  $type = 0;&nbsp;</div></li><li><div>  if (!is_dir($this-&gt;_backupFolder)) {&nbsp;</div></li><li><div>    if (!@mkdir($this-&gt;_backupFolder)) {&nbsp;</div></li><li><div>      $message = 'Failed to create a folder for backup!';&nbsp;</div></li><li><div>      $type = MSG_ERROR;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;_backupFolder = M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'BACKUP_DB';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (!is_dir($this-&gt;_backupFolder)) {&nbsp;</div></li><li><div>        if (!@mkdir($this-&gt;_backupFolder)) {&nbsp;</div></li><li><div>          $message = 'Failed to create a folder for backup in the IMAGES folder!';&nbsp;</div></li><li><div>          $type = MSG_ERROR;&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>          $message = 'Created a folder for backup in the IMAGES folder!';&nbsp;</div></li><li><div>          $type = MSG_WARN;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        $message = 'Created a folder for backup in the IMAGES folder!';&nbsp;</div></li><li><div>        $type = MSG_WARN;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($viewsError) {&nbsp;</div></li><li><div>    $this-&gt;log($message, '', $type);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Restore db store</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $file</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function restore($file)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;_connect_mysql();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;log('Open backup');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $nameFile = $this-&gt;_backupFolder . '/' . $file . '.sql';&nbsp;</div></li><li><div>  if (!file_exists($this-&gt;_backupFolder . '/' . $file . '.sql')) {&nbsp;</div></li><li><div>    $this-&gt;log('Backup not exists ', $file, 2);&nbsp;</div></li><li><div>    return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;open($nameFile, 'r');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;log('Start restore backup database');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sql = null;&nbsp;</div></li><li><div>  $currentTable = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setNames();&nbsp;</div></li><li><div>  $this-&gt;setForeignKeyChecks();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  while (($row = fgets($this-&gt;_file)) !== false) {&nbsp;</div></li><li><div>    if (preg_match('/DROP TABLE IF EXISTS/', $row)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($sql !== NULL) {&nbsp;</div></li><li><div>        $this-&gt;query($sql);&nbsp;</div></li><li><div>        $sql = null;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;query($row);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $row = str_replace('DROP TABLE IF EXISTS', '', $row);&nbsp;</div></li><li><div>      $row = str_replace(';', '', $row);&nbsp;</div></li><li><div>      $currentTable = trim($row);&nbsp;</div></li><li><div>      $this-&gt;log('&nbsp;&nbsp;Drop table ', $currentTable);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (preg_match('/CREATE TABLE/', $row)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($sql !== NULL) {&nbsp;</div></li><li><div>        $this-&gt;query($sql);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;log('&nbsp;&nbsp;Create table ', $currentTable);&nbsp;</div></li><li><div>      $sql = $row;&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (preg_match('/INSERT INTO/', $row)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ($sql !== NULL) {&nbsp;</div></li><li><div>        $this-&gt;query($sql);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;log('&nbsp;&nbsp;Insert table ', $currentTable);&nbsp;</div></li><li><div>      $sql = $row;&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $sql .= $row;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;setForeignKeyChecks(1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  fclose($this-&gt;_file);&nbsp;</div></li><li><div>  $this-&gt;log('End restore');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Open backup in UTF-8</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $nameFile</span>&nbsp;</div></li><li><div><span class="comment"> * @param $mode</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function open($nameFile, $mode)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  iconv_set_encoding('input_encoding', 'UTF-8');&nbsp;</div></li><li><div>  iconv_set_encoding('output_encoding', 'UTF-8');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;_file = fopen($nameFile, $mode);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Set names</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $charset</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function setNames($charset = 'utf8')&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;log('Set names', $charset);&nbsp;</div></li><li><div>  $this-&gt;query('SET NAMES ' . $charset);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Set foreign key checks</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $check</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function setForeignKeyChecks($check = 0)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;log('Set foreign key checks', $check);&nbsp;</div></li><li><div>  $this-&gt;query('SET FOREIGN_KEY_CHECKS = ' . $check);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Echo list backup</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function listdb()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $list = glob($this-&gt;_backupFolder . '<span class="comment">/*.sql');</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  foreach ($list as $id =&gt; $file) {</span>&nbsp;</div></li><li><div><span class="comment">    $res = str_replace($this-&gt;_backupFolder . '/', '', $file);</span>&nbsp;</div></li><li><div><span class="comment">    $list[$id] = str_replace('.sql', '', $res);</span>&nbsp;</div></li><li><div><span class="comment">  }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  $result = implode('|', $list);</span>&nbsp;</div></li><li><div><span class="comment">  echo $result;</span>&nbsp;</div></li><li><div><span class="comment">}</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Connect to Mysql Server</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _connect_mysql()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;log('Connect to host', $this-&gt;_dbhost);&nbsp;</div></li><li><div>  $this-&gt;_link = @mysql_connect($this-&gt;_dbhost, $this-&gt;_dbuser, $this-&gt;_dbpass);&nbsp;</div></li><li><div>  if (!$this-&gt;_link) {&nbsp;</div></li><li><div>    $this-&gt;log('Can not connect to host ', $this-&gt;_dbhost, MSG_ERROR);&nbsp;</div></li><li><div>    exit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;log('Select database', $this-&gt;_dbname);&nbsp;</div></li><li><div>  if (!@mysql_select_db($this-&gt;_dbname)) {&nbsp;</div></li><li><div>    $this-&gt;log('Error #' . mysql_errno($this-&gt;_link) . ' ' . mysql_error($this-&gt;_link), '', MSG_ERROR);&nbsp;</div></li><li><div>    exit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return structure create table</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $table</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function createTable($table)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $result = $this-&gt;query('SHOW CREATE TABLE ' . $table);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $this-&gt;log('&nbsp;&nbsp;Backup table', $table);&nbsp;</div></li><li><div>  $res = mysql_fetch_array($result);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $comment = &quot;\n\n<span class="comment">/*  Table `{$table}`  */</span>\n&quot;;&nbsp;</div></li><li><div>  $drop = &quot;DROP TABLE IF EXISTS `{$table}`;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $create = $res['Create Table'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $comment . $drop . $create . ';';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return inserts data form table</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $table</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function insertsTable($table)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $start = 0;&nbsp;</div></li><li><div>  $limit = 5000;&nbsp;</div></li><li><div>  $count = $this-&gt;countRows(&quot;SELECT count(*) FROM {$table}&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($count == 0) {&nbsp;</div></li><li><div>    return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $insertQuery = $this-&gt;getInsertHeader($table);&nbsp;</div></li><li><div>  fwrite($this-&gt;_file, $insertQuery);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $counter = (int)($count / $limit) + 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  for ($i = 1; $i &lt;= $counter; $i++) {&nbsp;</div></li><li><div>    $result = $this-&gt;query(&quot;SELECT * FROM {$table} LIMIT {$start}, {$limit}&quot;);&nbsp;</div></li><li><div>    $temp = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    while (($res = mysql_fetch_assoc($result)) !== false) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $value = array();&nbsp;</div></li><li><div>      foreach ($res as $val) {&nbsp;</div></li><li><div>        $value[] = &quot;'&quot; . mysql_real_escape_string($val) . &quot;'&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $comma = ', ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $count--;&nbsp;</div></li><li><div>      if ($count == 0) {&nbsp;</div></li><li><div>        $comma = ';';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $value = &quot;\n(&quot; . implode(', ', $value) . &quot;)&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if(serialize(strlen($temp) + strlen($value)) &gt;= $this-&gt;getMaxAllowedPacket()) {&nbsp;</div></li><li><div>        $temp = substr($temp, 0, strlen($temp)-1) . ';';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        fwrite($this-&gt;_file, $temp);&nbsp;</div></li><li><div>        $temp = $this-&gt;getInsertHeader($table);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $temp .= $value.&quot;{$comma}&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    fwrite($this-&gt;_file, $temp);&nbsp;</div></li><li><div>    $start += $limit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return INSERT Header</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $table</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function getInsertHeader($table)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $insert = &quot;\n\nINSERT INTO `{$table}` (&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = $this-&gt;query(&quot;SHOW COLUMNS FROM {$table}&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fields = array();&nbsp;</div></li><li><div>  while (($res = mysql_fetch_assoc($result)) !== FALSE) {&nbsp;</div></li><li><div>    $fields[] = &quot; `{$res[&quot;Field&quot;]}`&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $insert .= implode(', ', $fields);&nbsp;</div></li><li><div>  $insert .= ') VALUES';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $insert;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Run query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param $sql</span>&nbsp;</div></li><li><div><span class="comment"> * @return resource</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function query($sql)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (!$result = @mysql_query($sql, $this-&gt;_link)) {&nbsp;</div></li><li><div>    $this-&gt;log('Error #' . mysql_errno() . ' ' . mysql_error(), &quot;({$sql})&quot;, MSG_ERROR);&nbsp;</div></li><li><div>    exit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Input and output log</span>&nbsp;</div></li><li><div><span class="comment"> * 0 - Message Info</span>&nbsp;</div></li><li><div><span class="comment"> * 1 - Message Warning</span>&nbsp;</div></li><li><div><span class="comment"> * 2 - Message Error</span>&nbsp;</div></li><li><div><span class="comment"> * @param $msg</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $additionalValue</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $type</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function log($msg, $additionalValue = '', $type = 0)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $font = 'font-family: Verdana;font-size: 12px;';&nbsp;</div></li><li><div>  $color = '#000000';&nbsp;</div></li><li><div>  switch ($type) {&nbsp;</div></li><li><div>    case 0:&nbsp;</div></li><li><div>      $color = '#000000';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    case 1:&nbsp;</div></li><li><div>      $color = '#FFAB00';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    case 2;&nbsp;</div></li><li><div>      $color = '#FF0000';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    default:&nbsp;</div></li><li><div>      $color = '#000000';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo &quot;&lt;div style='color:{$color};{$font}'&gt;&lt;b&gt;&quot; . date('Y-m-d H:i:s') . &quot;:&lt;/b&gt; &quot; . $msg . &quot; &lt;i&gt;&quot; . $additionalValue . &quot;&lt;/i&gt;.&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return Mysql max_allowed_packet</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function getMaxAllowedPacket()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ($this-&gt;_maxAllowedPacket === null) {&nbsp;</div></li><li><div>    $result = $this-&gt;query(&quot;SELECT @@max_allowed_packet&quot;);&nbsp;</div></li><li><div>    $result = mysql_fetch_array($result);&nbsp;</div></li><li><div>    $this-&gt;_maxAllowedPacket = (int)$result[0];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return (int)$this-&gt;_maxAllowedPacket;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @param $sql</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function countRows($sql)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $result = $this-&gt;query($sql);&nbsp;</div></li><li><div>  $result = mysql_fetch_array($result);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return (int)$result[0];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Batchsavefile extends M1_Bridge_Action_Savefile&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $result = array();&nbsp;</div></li><li><div>  foreach ($_POST['files'] as $fileInfo) {&nbsp;</div></li><li><div>    $result[$fileInfo['id']] = $this-&gt;_saveFile($fileInfo['source'], $fileInfo['target'], (int)$fileInfo['width'], (int)$fileInfo['height'], $fileInfo['local_source']);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo serialize($result);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Update&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>var $uri = 'BRIDGE_DOWNLOAD_LINK';&nbsp;</div></li><li><div>var $pathToTmpDir;&nbsp;</div></li><li><div>var $pathToFile = __FILE__;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function M1_Bridge_Action_Update()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $this-&gt;pathToTmpDir = dirname(__FILE__) . DIRECTORY_SEPARATOR . 'temp_c2c';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $response = new stdClass();&nbsp;</div></li><li><div>  if (!($this-&gt;_checkBridgeDirPermission() && $this-&gt;_checkBridgeFilePermission())) {&nbsp;</div></li><li><div>    $response-&gt;is_error = true;&nbsp;</div></li><li><div>    $response-&gt;message = &quot;Bridge Update couldn't be performed. Please change permission for bridge folder to 777 and bridge.php file inside it to 666&quot;;&nbsp;</div></li><li><div>    echo serialize($response);&nbsp;</div></li><li><div>    die;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (($data = $this-&gt;_downloadFile()) === false) {&nbsp;</div></li><li><div>    $response-&gt;is_error = true;&nbsp;</div></li><li><div>    $response-&gt;message = &quot;Bridge Version is outdated. Files couldn't be updated automatically. Please set write permission or re-upload files manually.&quot;;&nbsp;</div></li><li><div>    echo serialize($response);&nbsp;</div></li><li><div>    die;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!$this-&gt;_writeToFile($data, $this-&gt;pathToFile)) {&nbsp;</div></li><li><div>    $response-&gt;is_error = true;&nbsp;</div></li><li><div>    $response-&gt;message = &quot;Couln't create file in temporary folder or file is write protected.&quot;;&nbsp;</div></li><li><div>    echo serialize($response);&nbsp;</div></li><li><div>    die;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $response-&gt;is_error = false;&nbsp;</div></li><li><div>  $response-&gt;message = 'Bridge successfully updated to latest version.';&nbsp;</div></li><li><div>  echo serialize($response);&nbsp;</div></li><li><div>  die;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _fetch($uri)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $ch = curl_init();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  curl_setopt($ch, CURLOPT_URL, $uri);&nbsp;</div></li><li><div>  curl_setopt($ch, CURLOPT_HEADER, 0);&nbsp;</div></li><li><div>  curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $response = new stdClass();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $response-&gt;body = curl_exec($ch);&nbsp;</div></li><li><div>  $response-&gt;http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);&nbsp;</div></li><li><div>  $response-&gt;content_type = curl_getinfo($ch, CURLINFO_CONTENT_TYPE);&nbsp;</div></li><li><div>  $response-&gt;content_length = curl_getinfo($ch, CURLINFO_CONTENT_LENGTH_DOWNLOAD);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  curl_close($ch);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $response;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _checkBridgeDirPermission()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (!is_writeable(dirname(__FILE__))) {&nbsp;</div></li><li><div>    @chmod(dirname(__FILE__), 0777);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return is_writeable(dirname(__FILE__));&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _checkBridgeFilePermission()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $pathToFile = dirname(__FILE__) . DIRECTORY_SEPARATOR . 'bridge.php';&nbsp;</div></li><li><div>  if (!is_writeable($pathToFile)) {&nbsp;</div></li><li><div>    @chmod($pathToFile, 0666);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return is_writeable($pathToFile);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _createTempDir()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  @mkdir($this-&gt;pathToTmpDir, 0777);&nbsp;</div></li><li><div>  return file_exists($this-&gt;pathToTmpDir);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _removeTempDir()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  @unlink($this-&gt;pathToTmpDir . DIRECTORY_SEPARATOR . 'bridge.php_c2c');&nbsp;</div></li><li><div>  @rmdir($this-&gt;pathToTmpDir);&nbsp;</div></li><li><div>  return !file_exists($this-&gt;pathToTmpDir);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _downloadFile()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $file = $this-&gt;_fetch($this-&gt;uri);&nbsp;</div></li><li><div>  if ($file-&gt;http_code == 200) {&nbsp;</div></li><li><div>    return $file;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _writeToFile($data, $file)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (function_exists('file_put_contents')) {&nbsp;</div></li><li><div>    $bytes = file_put_contents($file, $data-&gt;body);&nbsp;</div></li><li><div>    return $bytes == $data-&gt;content_length;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $handle = @fopen($file, 'w+');&nbsp;</div></li><li><div>  $bytes = fwrite($handle, $data-&gt;body);&nbsp;</div></li><li><div>  @fclose($handle);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $bytes == $data-&gt;content_length;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Query&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (isset($_POST['query']) && isset($_POST['fetchMode'])) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $query = base64_decode($_POST['query']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $res = $bridge-&gt;query($query, (int)$_POST['fetchMode']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (is_array($res['result']) || is_bool($res['result'])) {&nbsp;</div></li><li><div>      $result = serialize(array(&nbsp;</div></li><li><div>        'res' =&gt; $res['result'], &nbsp;</div></li><li><div>        'fetchedFields' =&gt; @$res['fetchedFields'], &nbsp;</div></li><li><div>        'insertId' =&gt; mysql_insert_id($bridge-&gt;getLink()), &nbsp;</div></li><li><div>        'affectedRows' =&gt; mysql_affected_rows($bridge-&gt;getLink()), &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      echo base64_encode($result);&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      echo base64_encode($res['message']);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Getfsfile&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $products_image = (string)$_POST['product_image'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $images_array = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($products_image != '') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $products_image_extension = substr($products_image, strrpos($products_image, '.'));&nbsp;</div></li><li><div>    $products_image_base = str_replace($products_image_extension, '', $products_image);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (strrpos($products_image, '/')) {&nbsp;</div></li><li><div>      $products_image_match = substr($products_image, strrpos($products_image, '/') + 1);&nbsp;</div></li><li><div>      $products_image_match = str_replace($products_image_extension, '', $products_image_match) . '_';&nbsp;</div></li><li><div>      $products_image_base = $products_image_match;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $products_image_directory = str_replace($products_image, '', substr($products_image, strrpos($products_image, '/')));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ($products_image_directory != '') {&nbsp;</div></li><li><div>      $products_image_directory = DIR_WS_IMAGES . str_replace($products_image_directory, '', $products_image) . '/';&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $products_image_directory = DIR_WS_IMAGES;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $file_extension = $products_image_extension;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ($dir = dir(M1_STORE_BASE_DIR . $products_image_directory)) {&nbsp;</div></li><li><div>      while ($file = $dir-&gt;read()) {&nbsp;</div></li><li><div>        if (!is_dir($products_image_directory . $file)) {&nbsp;</div></li><li><div>          if (substr($file, strrpos($file, '.')) == $file_extension) {&nbsp;</div></li><li><div>            if (preg_match('/' . $products_image_base . '/i', $file) == '1') {&nbsp;</div></li><li><div>              if ($file != $products_image) {&nbsp;</div></li><li><div>                if ($products_image_base . str_replace($products_image_base, '', $file) == $file) {&nbsp;</div></li><li><div>                  $images_array[] = $products_image_directory . $file;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (sizeof($images_array)) {&nbsp;</div></li><li><div>        sort($images_array);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $dir-&gt;close();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo serialize($images_array);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Basedirfs&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo M1_STORE_BASE_DIR;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Deleteimages&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  switch ($bridge-&gt;config-&gt;cartType) {&nbsp;</div></li><li><div>    case 'Pinnacle361':&nbsp;</div></li><li><div>      $this-&gt;_PinnacleDeleteImages($bridge);&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Prestashop11':&nbsp;</div></li><li><div>      $this-&gt;_PrestaShopDeleteImages($bridge);&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>    case 'Summercart3' :&nbsp;</div></li><li><div>      $this-&gt;_SummercartDeleteImages($bridge);&nbsp;</div></li><li><div>    break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _PinnacleDeleteImages($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'catalog/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'manufacturers/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'products/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'products/thumbs/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'products/secondary/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'products/preview/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $ok = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ($dirs as $dir) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (!file_exists($dir)) {&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $dirHandle = opendir($dir);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    while (false !== ($file = readdir($dirHandle))) {&nbsp;</div></li><li><div>      if ($file != '.' && $file != '..' && !preg_match(&quot;/^readme\.txt?$/&quot;, $file) && !preg_match(&quot;/\.bak$/i&quot;, $file)) {&nbsp;</div></li><li><div>        $file_path = $dir . $file;&nbsp;</div></li><li><div>        if (is_file($file_path)) {&nbsp;</div></li><li><div>          if (!rename($file_path, $file_path . '.bak')) {&nbsp;</div></li><li><div>            $ok = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    closedir($dirHandle);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($ok) {&nbsp;</div></li><li><div>    print 'OK';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    print 'ERROR';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _PrestaShopDeleteImages($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'c/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'p/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'm/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $ok = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ($dirs as $dir) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (!file_exists($dir)) {&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $dirHandle = opendir($dir);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    while (false !== ($file = readdir($dirHandle))) {&nbsp;</div></li><li><div>      if ($file != '.' && $file != '..' && preg_match(&quot;/(\d+).*\.jpg?$/&quot;, $file)) {&nbsp;</div></li><li><div>        $file_path = $dir . $file;&nbsp;</div></li><li><div>        if (is_file($file_path)) {&nbsp;</div></li><li><div>          if (!rename($file_path, $file_path . '.bak')) {&nbsp;</div></li><li><div>            $ok = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    closedir($dirHandle);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($ok) {&nbsp;</div></li><li><div>    print 'OK';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    print 'ERROR';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _SummercartDeleteImages($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirs = array(&nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'categoryimages/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'manufacturer/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'productimages/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'productthumbs/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'productboximages/', &nbsp;</div></li><li><div>    M1_STORE_BASE_DIR . $bridge-&gt;config-&gt;imagesDir . 'productlargeimages/', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $ok = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ($dirs as $dir) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (!file_exists($dir)) {&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $dirHandle = opendir($dir);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    while (false !== ($file = readdir($dirHandle))) {&nbsp;</div></li><li><div>      if (($file != '.') && ($file != '..') && !preg_match(&quot;/\.bak$/i&quot;, $file)) {&nbsp;</div></li><li><div>        $file_path = $dir . $file;&nbsp;</div></li><li><div>        if (is_file($file_path)) {&nbsp;</div></li><li><div>          if (!rename($file_path, $file_path . '.bak')) {&nbsp;</div></li><li><div>            $ok = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    closedir($dirHandle);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($ok) {&nbsp;</div></li><li><div>    print 'OK';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    print 'ERROR';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Cubecart&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $dirHandle = opendir(M1_STORE_BASE_DIR . 'language/');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $languages = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  while ($dirEntry = readdir($dirHandle)) {&nbsp;</div></li><li><div>    if (!is_dir(M1_STORE_BASE_DIR . 'language/' . $dirEntry)&nbsp;</div></li><li><div>        || $dirEntry == '.'&nbsp;</div></li><li><div>        || $dirEntry == '..'&nbsp;</div></li><li><div>        || strpos($dirEntry, '_') !== false&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $lang['id'] = $dirEntry;&nbsp;</div></li><li><div>    $lang['iso2'] = $dirEntry;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $cnfile = 'config.inc.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (!file_exists(M1_STORE_BASE_DIR . 'language/' . $dirEntry . '/'. $cnfile)) {&nbsp;</div></li><li><div>      $cnfile = 'config.php';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (!file_exists( M1_STORE_BASE_DIR . 'language/' . $dirEntry . '/'. $cnfile)) {&nbsp;</div></li><li><div>      continue;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $str = file_get_contents(M1_STORE_BASE_DIR . 'language/' . $dirEntry . '/' . $cnfile);&nbsp;</div></li><li><div>    preg_match('/' . preg_quote('$langName') . &quot;[\s]*=[\s]*[\&quot;\'](.*)[\&quot;\'];/&quot;, $str, $match);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (isset($match[1])) {&nbsp;</div></li><li><div>      $lang['name'] = $match[1];&nbsp;</div></li><li><div>      $languages[] = $lang;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo serialize($languages);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Phpinfo&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  phpinfo();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Carttype&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo $bridge-&gt;config-&gt;cartType;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class M1_Bridge_Action_Getconfig&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>function parseMemoryLimit($val)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $last = strtolower($val[strlen($val)-1]);&nbsp;</div></li><li><div>  switch ($last) {&nbsp;</div></li><li><div>    case 'g':&nbsp;</div></li><li><div>      $val *= 1024;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    case 'm':&nbsp;</div></li><li><div>      $val *= 1024;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>    case 'k':&nbsp;</div></li><li><div>      $val *= 1024;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $val;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function getMemoryLimit()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $memoryLimit = trim(@ini_get('memory_limit'));&nbsp;</div></li><li><div>  if (strlen($memoryLimit) === 0) {&nbsp;</div></li><li><div>    $memoryLimit = '0';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $memoryLimit = $this-&gt;parseMemoryLimit($memoryLimit);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $maxPostSize = trim(@ini_get('post_max_size'));&nbsp;</div></li><li><div>  if (strlen($maxPostSize) === 0) {&nbsp;</div></li><li><div>    $maxPostSize = '0';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $maxPostSize = $this-&gt;parseMemoryLimit($maxPostSize);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $suhosinMaxPostSize = trim(@ini_get('suhosin.post.max_value_length'));&nbsp;</div></li><li><div>  if (strlen($suhosinMaxPostSize) === 0) {&nbsp;</div></li><li><div>    $suhosinMaxPostSize = '0';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $suhosinMaxPostSize = $this-&gt;parseMemoryLimit($suhosinMaxPostSize);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($suhosinMaxPostSize == 0) {&nbsp;</div></li><li><div>    $suhosinMaxPostSize = $maxPostSize;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($maxPostSize == 0) {&nbsp;</div></li><li><div>    $suhosinMaxPostSize = $maxPostSize = $memoryLimit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return min($suhosinMaxPostSize, $maxPostSize, $memoryLimit);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function isZlibSupported()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return function_exists('gzdecode');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function perform($bridge)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (!defined('DEFAULT_LANGUAGE_ISO2')) {&nbsp;</div></li><li><div>    define('DEFAULT_LANGUAGE_ISO2', ''); <span class="comment">//variable for Interspire cart</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $result = array(&nbsp;</div></li><li><div>    'images' =&gt; array(&nbsp;</div></li><li><div>      'imagesPath' =&gt; $bridge-&gt;config-&gt;imagesDir, <span class="comment">// path to images folder - relative to store root</span>&nbsp;</div></li><li><div>      'categoriesImagesPath' =&gt; $bridge-&gt;config-&gt;categoriesImagesDir, &nbsp;</div></li><li><div>      'categoriesImagesPaths' =&gt; $bridge-&gt;config-&gt;categoriesImagesDirs, &nbsp;</div></li><li><div>      'productsImagesPath' =&gt; $bridge-&gt;config-&gt;productsImagesDir, &nbsp;</div></li><li><div>      'productsImagesPaths' =&gt; $bridge-&gt;config-&gt;productsImagesDirs, &nbsp;</div></li><li><div>      'manufacturersImagesPath' =&gt; $bridge-&gt;config-&gt;manufacturersImagesDir, &nbsp;</div></li><li><div>      'manufacturersImagesPaths' =&gt; $bridge-&gt;config-&gt;manufacturersImagesDirs, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>    'languages' =&gt; $bridge-&gt;config-&gt;languages, &nbsp;</div></li><li><div>    'baseDirFs' =&gt; M1_STORE_BASE_DIR, <span class="comment">// filesystem path to store root</span>&nbsp;</div></li><li><div>    'defaultLanguageIso2' =&gt; DEFAULT_LANGUAGE_ISO2, &nbsp;</div></li><li><div>    'databaseName' =&gt; $bridge-&gt;config-&gt;Dbname, &nbsp;</div></li><li><div>    'memoryLimit' =&gt; $this-&gt;getMemoryLimit(), &nbsp;</div></li><li><div>    'zlibSupported' =&gt; $this-&gt;isZlibSupported(), &nbsp;</div></li><li><div>    <span class="comment">//'orderStatus' =&gt; $bridge-&gt;config-&gt;orderStatus, </span>&nbsp;</div></li><li><div>    'cartVars' =&gt; $bridge-&gt;config-&gt;cartVars, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo serialize($result);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>define('M1_BRIDGE_VERSION', '21');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>define('M1_BRIDGE_DIRECTORY_NAME', basename(getcwd()));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>ini_set('display_errors', 1);&nbsp;</div></li><li><div>if (substr(phpversion(), 0, 1) == 5) {&nbsp;</div></li><li><div>error_reporting(E_ALL & ~E_STRICT);&nbsp;</div></li><li><div>} else {&nbsp;</div></li><li><div>error_reporting(E_ALL);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>require_once 'config.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function stripslashes_array($array)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>return is_array($array) ? array_map('stripslashes_array', $array) : stripslashes($array);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function getPHPExecutable() {&nbsp;</div></li><li><div>$paths = explode(PATH_SEPARATOR, getenv('PATH'));&nbsp;</div></li><li><div>$paths[] = PHP_BINDIR;&nbsp;</div></li><li><div>foreach ($paths as $path) {&nbsp;</div></li><li><div>  <span class="comment">// we need this for XAMPP (Windows)</span>&nbsp;</div></li><li><div>  if (isset($_SERVER[&quot;WINDIR&quot;]) && strstr($path, 'php.exe') && file_exists($path) && is_file($path)) {&nbsp;</div></li><li><div>    return $path;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else {&nbsp;</div></li><li><div>    $phpExecutable = $path . DIRECTORY_SEPARATOR . &quot;php&quot; . (isset($_SERVER[&quot;WINDIR&quot;]) ? &quot;.exe&quot; : &quot;&quot;);&nbsp;</div></li><li><div>    if (file_exists($phpExecutable) && is_file($phpExecutable)) {&nbsp;</div></li><li><div>      return $phpExecutable;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>return FALSE;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!isset($_SERVER)) {&nbsp;</div></li><li><div>$_GET = &$HTTP_GET_VARS;&nbsp;</div></li><li><div>$_POST = &$HTTP_POST_VARS;&nbsp;</div></li><li><div>$_ENV = &$HTTP_ENV_VARS;&nbsp;</div></li><li><div>$_SERVER = &$HTTP_SERVER_VARS;&nbsp;</div></li><li><div>$_COOKIE = &$HTTP_COOKIE_VARS;&nbsp;</div></li><li><div>$_REQUEST = array_merge($_GET, $_POST, $_COOKIE);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (get_magic_quotes_gpc()) {&nbsp;</div></li><li><div>$_COOKIE = stripslashes_array($_COOKIE);&nbsp;</div></li><li><div>$_FILES = stripslashes_array($_FILES);&nbsp;</div></li><li><div>$_GET = stripslashes_array($_GET);&nbsp;</div></li><li><div>$_POST = stripslashes_array($_POST);&nbsp;</div></li><li><div>$_REQUEST = stripslashes_array($_REQUEST);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>define('M1_STORE_BASE_DIR', dirname(__FILE__) . DIRECTORY_SEPARATOR . '..' . DIRECTORY_SEPARATOR);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$bridge = new M1_Bridge(M1_Config_Adapter::create());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if (!$bridge-&gt;getLink()) {&nbsp;</div></li><li><div>die('ERROR_BRIDGE_CANT_CONNECT_DB');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>$bridge-&gt;run();&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Cart2Cart: Loaded Commerce to WooCommerce Migration Module</li><li><span></span>1.0.0</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>