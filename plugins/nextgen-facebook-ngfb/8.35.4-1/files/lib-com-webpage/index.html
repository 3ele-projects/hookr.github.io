<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="8.35.4-1" data-slug="nextgen-facebook-ngfb" data-type="file" data-id="7366"><head xmlns="http://www.w3.org/1999/xhtml"><title> lib-com-webpage | file | Nextgen Facebook Ngfb | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, nextgen-facebook-ngfb, 8.35.4-1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.8"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=f339830d3bda7b461167415a794b1fdd' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.8' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/lib-com-webpage/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Flib-com-webpage%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Flib-com-webpage%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-nextgen-facebook-ngfb-8.35.4-1-file-lib-com-webpage","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="lib-com-webpage" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to nextgen-facebook-ngfb." href="http://hookr.io/plugins/nextgen-facebook-ngfb/" class="plugin"><span property="name">nextgen-facebook-ngfb</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 8.35.4-1." href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/" class="H_VERSION"><span property="name">8.35.4-1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">lib-com-webpage</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="371"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/all/" title="All">All <span class="count badge">371</span></a></li><li class="" data-id="new" data-count="145"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/new/" title="New">New <span class="count badge">145</span></a></li><li class="" data-id="hooks" data-count="255"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/hooks/" title="Hooks">Hooks <span class="count badge">255</span></a></li><li class="" data-id="action" data-count="11"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/actions/" title="Actions">Actions <span class="count badge">11</span></a></li><li class="" data-id="filter" data-count="244"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/filters/" title="Filters">Filters <span class="count badge">244</span></a></li><li class="" data-id="class" data-count="93"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/classes/" title="Classes">Classes <span class="count badge">93</span></a></li><li class="" data-id="constant" data-count="13"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/constants/" title="Constants">Constants <span class="count badge">13</span></a></li><li class="" data-id="function" data-count="9"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/functions/" title="Functions">Functions <span class="count badge">9</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.35.4-1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/lib/com/webpage.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * License: GPLv3</span>&nbsp;</div></li><li><div><span class="comment"> * License URI: http://www.gnu.org/licenses/gpl.txt</span>&nbsp;</div></li><li><div><span class="comment"> * Copyright 2012-2016 Jean-Sebastien Morisset (http://surniaulula.com/)</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) &nbsp;</div></li><li><div>  die( 'These aren\'t the droids you\'re looking for...' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! class_exists( 'SucomWebpage' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  class SucomWebpage {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private $p;&nbsp;</div></li><li><div>      private $shortcode = array();&nbsp;</div></li><li><div>      private $saved_title = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function __construct( &$plugin ) {&nbsp;</div></li><li><div>          $this-&gt;p =& $plugin;&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          $this-&gt;set_objects();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private function set_objects() {&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;options['plugin_shortcodes'] ) ) {&nbsp;</div></li><li><div>              foreach ( $this-&gt;p-&gt;cf['plugin'] as $lca =&gt; $info ) {&nbsp;</div></li><li><div>                  if ( isset( $info['lib']['shortcode'] ) && is_array( $info['lib']['shortcode'] ) ) {&nbsp;</div></li><li><div>                      foreach ( $info['lib']['shortcode'] as $id =&gt; $name ) {&nbsp;</div></li><li><div>                          $classname = apply_filters( $lca.'_load_lib', false, 'shortcode/'.$id );&nbsp;</div></li><li><div>                          if ( $classname !== false && class_exists( $classname ) )&nbsp;</div></li><li><div>                              $this-&gt;shortcode[$id] = new $classname( $this-&gt;p );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;options['plugin_page_excerpt'] ) )&nbsp;</div></li><li><div>              add_post_type_support( 'page', array( 'excerpt' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;options['plugin_page_tags'] ) )&nbsp;</div></li><li><div>              register_taxonomy_for_object_type( 'post_tag', 'page' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_quote( array &$mod ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $quote = apply_filters( $this-&gt;p-&gt;cf['lca'].'_quote_seed', '', $mod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $quote != '' ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'quote seed = &quot;'.$quote.'&quot;' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( has_excerpt( $mod['id'] ) ) &nbsp;</div></li><li><div>                  $quote = get_the_excerpt( $mod['id'] );&nbsp;</div></li><li><div>              else $quote = get_post_field( 'post_content', $mod['id'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// remove shortcodes, etc., but don't strip html tags</span>&nbsp;</div></li><li><div>          $quote = $this-&gt;p-&gt;util-&gt;cleanup_html_tags( $quote, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;p-&gt;cf['lca'].'_quote', $quote, $mod );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// $type = title | excerpt | both</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $mod = true | false | post_id | $mod array</span></span></span></span></span></span>&nbsp;</div></li><li><div>      public function get_caption( $type = 'title', $textlen = 200, $mod = true, $use_cache = true, &nbsp;</div></li><li><div>          $add_hashtags = true, $encode = true, $md_idx = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                  'type' =&gt; $type, &nbsp;</div></li><li><div>                  'textlen' =&gt; $textlen, &nbsp;</div></li><li><div>                  'mod' =&gt; $mod, &nbsp;</div></li><li><div>                  'use_cache' =&gt; $use_cache, &nbsp;</div></li><li><div>                  'add_hashtags' =&gt; $add_hashtags, <span class="comment"><span class="comment">// true/false/numeric</span></span>&nbsp;</div></li><li><div>                  'encode' =&gt; $encode, &nbsp;</div></li><li><div>                  'md_idx' =&gt; $md_idx, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $mod = true | false | post_id | $mod array</span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( ! is_array( $mod ) )&nbsp;</div></li><li><div>              $mod = $this-&gt;p-&gt;util-&gt;get_page_mod( $mod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $caption = false;&nbsp;</div></li><li><div>          $separator = html_entity_decode( $this-&gt;p-&gt;options['og_title_sep'], ENT_QUOTES, get_bloginfo( 'charset' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $md_idx === true ) {&nbsp;</div></li><li><div>              switch ( $type ) {&nbsp;</div></li><li><div>                  case 'title':&nbsp;</div></li><li><div>                      $md_idx = 'og_title';&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'excerpt':&nbsp;</div></li><li><div>                      $md_idx = 'og_desc';&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'both':&nbsp;</div></li><li><div>                      $md_idx = 'og_caption';&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// skip if no metadata index / key name</span></span></span>&nbsp;</div></li><li><div>          if ( ! empty( $md_idx ) ) {&nbsp;</div></li><li><div>              $caption = $mod['obj'] ?&nbsp;</div></li><li><div>                  $mod['obj']-&gt;get_options_multi( $mod['id'], $md_idx ) : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// maybe add hashtags to a post caption</span>&nbsp;</div></li><li><div>              if ( $mod['is_post'] ) {&nbsp;</div></li><li><div>                  if ( ! empty( $caption ) && ! empty( $add_hashtags ) && ! preg_match( '/( #[a-z0-9\-]+)+$/U', $caption ) ) {&nbsp;</div></li><li><div>                      $hashtags = $this-&gt;get_hashtags( $mod['id'], $add_hashtags );&nbsp;</div></li><li><div>                      if ( ! empty( $hashtags ) ) &nbsp;</div></li><li><div>                          $caption = $this-&gt;p-&gt;util-&gt;limit_text_length( $caption, &nbsp;</div></li><li><div>                              $textlen - strlen( $hashtags ) - 1, '...', false ).    <span class="comment"><span class="comment"><span class="comment">// don't run cleanup_html_tags()</span></span></span>&nbsp;</div></li><li><div>                                  ' '.$hashtags;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  if ( empty( $caption ) )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'no custom caption found for '.$md_idx );&nbsp;</div></li><li><div>                  else $this-&gt;p-&gt;debug-&gt;log( 'custom caption = &quot;'.$caption.'&quot;' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'custom caption skipped: no md_idx value' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $caption ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $md_idx ) ) {&nbsp;</div></li><li><div>                  $md_prefix = preg_replace( '/_(title|desc|caption)$/', '', $md_idx );&nbsp;</div></li><li><div>                  $md_title = $md_prefix.'_title';&nbsp;</div></li><li><div>                  $md_desc = $md_prefix.'_desc';&nbsp;</div></li><li><div>              } else $md_title = $md_desc = $md_idx;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// request all values un-encoded, then encode once we have the complete caption text</span>&nbsp;</div></li><li><div>              switch ( $type ) {&nbsp;</div></li><li><div>                  case 'title':&nbsp;</div></li><li><div>                      $caption = $this-&gt;get_title( $textlen, '...', $mod, $use_cache, $add_hashtags, false, $md_title );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'excerpt':&nbsp;</div></li><li><div>                      $caption = $this-&gt;get_description( $textlen, '...', $mod, $use_cache, $add_hashtags, false, $md_desc );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  case 'both':&nbsp;</div></li><li><div>                      <span class="comment">// get the title first</span>&nbsp;</div></li><li><div>                      $caption = $this-&gt;get_title( 0, '', $mod, $use_cache, false, false, $md_title );    <span class="comment">// $add_hashtags = false</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// add a separator between title and description</span>&nbsp;</div></li><li><div>                      if ( ! empty( $caption ) )&nbsp;</div></li><li><div>                          $caption .= ' '.$separator.' ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// reduce the requested $textlen by the title text length we already have</span>&nbsp;</div></li><li><div>                      $caption .= $this-&gt;get_description( $textlen - strlen( $caption ), &nbsp;</div></li><li><div>                          '...', $mod, $use_cache, $add_hashtags, false, $md_desc );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $encode === true )&nbsp;</div></li><li><div>              $caption = SucomUtil::encode_emoji( htmlentities( $caption, &nbsp;</div></li><li><div>                  ENT_QUOTES, get_bloginfo( 'charset' ), false ) );    <span class="comment"><span class="comment"><span class="comment">// double_encode = false</span></span></span>&nbsp;</div></li><li><div>          else {    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span>&nbsp;</div></li><li><div>              $charset = get_bloginfo( 'charset' );&nbsp;</div></li><li><div>              $caption = html_entity_decode( SucomUtil::decode_utf8( $caption ), ENT_QUOTES, $charset );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;p-&gt;cf['lca'].'_caption', $caption, $mod, $add_hashtags, $md_idx );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $mod = true | false | post_id | $mod array</span></span></span></span></span></span>&nbsp;</div></li><li><div>      public function get_title( $textlen = 70, $trailing = '', $mod = false, $use_cache = true, &nbsp;</div></li><li><div>          $add_hashtags = false, $encode = true, $md_idx = 'og_title' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                  'textlen' =&gt; $textlen, &nbsp;</div></li><li><div>                  'trailing' =&gt; $trailing, &nbsp;</div></li><li><div>                  'mod' =&gt; $mod, &nbsp;</div></li><li><div>                  'use_cache' =&gt; $use_cache, &nbsp;</div></li><li><div>                  'add_hashtags' =&gt; $add_hashtags, <span class="comment"><span class="comment">// true/false/numeric</span></span>&nbsp;</div></li><li><div>                  'encode' =&gt; $encode, &nbsp;</div></li><li><div>                  'md_idx' =&gt; $md_idx, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $mod = true | false | post_id | $mod array</span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( ! is_array( $mod ) )&nbsp;</div></li><li><div>              $mod = $this-&gt;p-&gt;util-&gt;get_page_mod( $mod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $title = false;&nbsp;</div></li><li><div>          $hashtags = '';&nbsp;</div></li><li><div>          $paged_suffix = '';&nbsp;</div></li><li><div>          $separator = html_entity_decode( $this-&gt;p-&gt;options['og_title_sep'], ENT_QUOTES, get_bloginfo( 'charset' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// setup filters to save and restore original / pre-filtered title value</span>&nbsp;</div></li><li><div>          if ( empty( $this-&gt;p-&gt;options['plugin_filter_title'] ) )&nbsp;</div></li><li><div>              SucomUtil::protect_filter_start( 'wp_title' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// skip if no metadata index / key name</span></span></span>&nbsp;</div></li><li><div>          if ( ! empty( $md_idx ) ) {&nbsp;</div></li><li><div>              $title = $mod['obj'] ?&nbsp;</div></li><li><div>                  $mod['obj']-&gt;get_options_multi( $mod['id'], ( $mod['is_post'] ? &nbsp;</div></li><li><div>                      array( $md_idx, 'og_title' ) : $md_idx ) ) : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  if ( empty( $title ) )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'no custom title found for '.$md_idx );&nbsp;</div></li><li><div>                  else $this-&gt;p-&gt;debug-&gt;log( 'custom title = &quot;'.$title.'&quot;' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'custom title skipped: no md_idx value' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// get seed if no custom meta title</span>&nbsp;</div></li><li><div>          if ( empty( $title ) ) {&nbsp;</div></li><li><div>              $title = apply_filters( $this-&gt;p-&gt;cf['lca'].'_title_seed', '', $mod, $add_hashtags, $md_idx );&nbsp;</div></li><li><div>              if ( ! empty( $title ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'title seed = &quot;'.$title.'&quot;' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// check for hashtags in meta or seed title, remove and then add again after shorten</span>&nbsp;</div></li><li><div>          if ( preg_match( '/(.*)(( #[a-z0-9\-]+)+)$/U', $title, $match ) ) {&nbsp;</div></li><li><div>              $title = $match[1];&nbsp;</div></li><li><div>              $hashtags = trim( $match[2] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( $mod['is_post'] ) {&nbsp;</div></li><li><div>              if ( ! empty( $add_hashtags ) && &nbsp;</div></li><li><div>                  ! empty( $this-&gt;p-&gt;options['og_desc_hashtags'] ) )&nbsp;</div></li><li><div>                      $hashtags = $this-&gt;get_hashtags( $mod['id'], $add_hashtags );    <span class="comment">// $add_hashtags = true | false | numeric</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $hashtags && $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'hashtags found = &quot;'.$hashtags.'&quot;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// construct a title of our own</span>&nbsp;</div></li><li><div>          if ( empty( $title ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $mod['is_post'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( is_singular() ) {&nbsp;</div></li><li><div>                      $title = wp_title( $separator, false, 'right' );&nbsp;</div></li><li><div>                      if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;debug-&gt;log( 'is_singular wp_title() = &quot;'.$title.'&quot;' );&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">//if ( $this-&gt;p-&gt;options['plugin_filter_title'] )</span></span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">//    $this-&gt;p-&gt;debug-&gt;log( SucomDebug::get_hooks( 'wp_title' ) );</span></span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ( ! empty( $mod['id'] ) ) {&nbsp;</div></li><li><div>                      $title = apply_filters( 'wp_title', get_the_title( $mod['id'] ).&nbsp;</div></li><li><div>                          ' '.$separator.' ', $separator, 'right' );&nbsp;</div></li><li><div>                      if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;debug-&gt;log( 'post ID get_the_title() = &quot;'.$title.'&quot;' );&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">//if ( $this-&gt;p-&gt;options['plugin_filter_title'] )</span></span>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">//    $this-&gt;p-&gt;debug-&gt;log( SucomDebug::get_hooks( 'wp_title' ) );</span></span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// if we're using filtered titles, and an seo plugin is available, </span>&nbsp;</div></li><li><div>              <span class="comment">// the use the wordpress title (provided by the seo plugin)</span>&nbsp;</div></li><li><div>              } elseif ( $this-&gt;p-&gt;options['plugin_filter_title'] &&&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;is_avail['seo']['*'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $title = wp_title( $separator, false, 'right' );    <span class="comment">// on right for compatibility with aioseo</span>&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'seo wp_title() = &quot;'.$title.'&quot;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } elseif ( $mod['is_term'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $term_obj = SucomUtil::get_term_object( $mod['id'], $mod['tax_slug'] );&nbsp;</div></li><li><div>                  if ( SucomUtil::is_category_page() )&nbsp;</div></li><li><div>                      $title = $this-&gt;get_category_title( $term_obj );    <span class="comment">// includes parents in title string</span>&nbsp;</div></li><li><div>                  elseif ( isset( $term_obj-&gt;name ) )&nbsp;</div></li><li><div>                      $title = apply_filters( 'wp_title', $term_obj-&gt;name.' '.$separator.' ', $separator, 'right' );&nbsp;</div></li><li><div>                  elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'name property missing in term object' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } elseif ( $mod['is_user'] ) { &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $user_obj = SucomUtil::get_user_object( $mod['id'] );&nbsp;</div></li><li><div>                  $title = apply_filters( 'wp_title', $user_obj-&gt;display_name.' '.$separator.' ', $separator, 'right' );&nbsp;</div></li><li><div>                  $title = apply_filters( $this-&gt;p-&gt;cf['lca'].'_user_object_title', $title, $user_obj );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment">/** The title text depends on the query:</span>&nbsp;</div></li><li><div><span class="comment">                   *    single post = the title of the post </span>&nbsp;</div></li><li><div><span class="comment">                   *    date-based archive = the date (e.g., &quot;2006&quot;, &quot;2006 - January&quot;) </span>&nbsp;</div></li><li><div><span class="comment">                   *    category = the name of the category </span>&nbsp;</div></li><li><div><span class="comment">                   *    author page = the public name of the user </span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  $title = wp_title( $separator, false, 'right' );&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'default wp_title() = &quot;'.$title.'&quot;' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span>&nbsp;</div></li><li><div>              if ( empty( $title ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'fallback get_bloginfo() = &quot;'.$title.'&quot;' );&nbsp;</div></li><li><div>                  if ( ! ( $title = get_bloginfo( 'name', 'display' ) ) )&nbsp;</div></li><li><div>                      $title = 'No Title';    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $this-&gt;p-&gt;options['plugin_filter_title'] ) )&nbsp;</div></li><li><div>              SucomUtil::protect_filter_stop( 'wp_title' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $title = $this-&gt;p-&gt;util-&gt;cleanup_html_tags( $title );    <span class="comment">// strip html tags before removing separator</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $separator ) )&nbsp;</div></li><li><div>              $title = preg_replace( '/ *'.preg_quote( $separator, '/' ).' *$/', '', $title );    <span class="comment">// trim excess separator</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// apply title filter before adjusting it's length</span>&nbsp;</div></li><li><div>          $title = apply_filters( $this-&gt;p-&gt;cf['lca'].'_title_pre_limit', $title );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// check title against string length limits</span>&nbsp;</div></li><li><div>          if ( $textlen &gt; 0 ) {&nbsp;</div></li><li><div>              <span class="comment">// seo-like title modifications</span>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;is_avail['seo']['*'] === false ) {&nbsp;</div></li><li><div>                  $paged = get_query_var( 'paged' );&nbsp;</div></li><li><div>                  if ( $paged &gt; 1 ) {&nbsp;</div></li><li><div>                      if ( ! empty( $separator ) )&nbsp;</div></li><li><div>                          $paged_suffix .= $separator.' ';&nbsp;</div></li><li><div>                      $paged_suffix .= sprintf( 'Page %s', $paged );&nbsp;</div></li><li><div>                      $textlen = $textlen - strlen( $paged_suffix ) - 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! empty( $add_hashtags ) && &nbsp;</div></li><li><div>                  ! empty( $hashtags ) ) &nbsp;</div></li><li><div>                      $textlen = $textlen - strlen( $hashtags ) - 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $title = $this-&gt;p-&gt;util-&gt;limit_text_length( $title, $textlen, $trailing, false );    <span class="comment"><span class="comment"><span class="comment">// don't run cleanup_html_tags()</span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $paged_suffix ) ) &nbsp;</div></li><li><div>              $title .= ' '.$paged_suffix;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $add_hashtags ) && &nbsp;</div></li><li><div>              ! empty( $hashtags ) ) &nbsp;</div></li><li><div>                  $title .= ' '.$hashtags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $encode === true )&nbsp;</div></li><li><div>              $title = SucomUtil::encode_emoji( htmlentities( $title, &nbsp;</div></li><li><div>                  ENT_QUOTES, get_bloginfo( 'charset' ), false ) );    <span class="comment"><span class="comment"><span class="comment">// double_encode = false</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;p-&gt;cf['lca'].'_title', $title, $mod, $add_hashtags, $md_idx );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $mod = true | false | post_id | $mod array</span></span></span></span></span></span>&nbsp;</div></li><li><div>      public function get_description( $textlen = 156, $trailing = '...', $mod = false, $use_cache = true, &nbsp;</div></li><li><div>          $add_hashtags = true, $encode = true, $md_idx = 'og_desc' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark( 'render description' );    <span class="comment">// begin timer</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                  'textlen' =&gt; $textlen, &nbsp;</div></li><li><div>                  'trailing' =&gt; $trailing, &nbsp;</div></li><li><div>                  'mod' =&gt; $mod, &nbsp;</div></li><li><div>                  'use_cache' =&gt; $use_cache, &nbsp;</div></li><li><div>                  'add_hashtags' =&gt; $add_hashtags, <span class="comment">// true | false | numeric</span>&nbsp;</div></li><li><div>                  'encode' =&gt; $encode, &nbsp;</div></li><li><div>                  'md_idx' =&gt; $md_idx, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// $mod = true | false | post_id | $mod array</span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( ! is_array( $mod ) )&nbsp;</div></li><li><div>              $mod = $this-&gt;p-&gt;util-&gt;get_page_mod( $mod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $desc = false;&nbsp;</div></li><li><div>          $hashtags = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// skip if no metadata index / key name</span></span></span>&nbsp;</div></li><li><div>          if ( ! empty( $md_idx ) ) {&nbsp;</div></li><li><div>              <span class="comment">// fallback to og_desc value</span>&nbsp;</div></li><li><div>              $desc = is_object( $mod['obj'] ) ?&nbsp;</div></li><li><div>                  $mod['obj']-&gt;get_options_multi( $mod['id'], array( $md_idx, 'og_desc' ) ) : null;&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  if ( empty( $desc ) )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'no custom description found for '.$md_idx );&nbsp;</div></li><li><div>                  else $this-&gt;p-&gt;debug-&gt;log( 'custom description = &quot;'.$desc.'&quot;' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'custom description skipped: no md_idx value' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// get seed if no custom meta description</span>&nbsp;</div></li><li><div>          if ( empty( $desc ) ) {&nbsp;</div></li><li><div>              $desc = apply_filters( $this-&gt;p-&gt;cf['lca'].'_description_seed', '', $mod, $add_hashtags, $md_idx );&nbsp;</div></li><li><div>              if ( ! empty( $desc ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'description seed = &quot;'.$desc.'&quot;' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// check for hashtags in meta or seed desc, remove and then add again after shorten</span>&nbsp;</div></li><li><div>          if ( preg_match( '/^(.*)(( *#[a-z][a-z0-9\-]+)+)$/U', $desc, $match ) ) {&nbsp;</div></li><li><div>              $desc = $match[1];&nbsp;</div></li><li><div>              $hashtags = trim( $match[2] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( $mod['is_post'] ) {&nbsp;</div></li><li><div>              if ( ! empty( $add_hashtags ) && &nbsp;</div></li><li><div>                  ! empty( $this-&gt;p-&gt;options['og_desc_hashtags'] ) )&nbsp;</div></li><li><div>                      $hashtags = $this-&gt;get_hashtags( $mod['id'], $add_hashtags );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $hashtags && $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'hashtags found = &quot;'.$hashtags.'&quot;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// if there's no custom description, and no pre-seed, </span>&nbsp;</div></li><li><div>          <span class="comment">// then go ahead and generate the description value</span>&nbsp;</div></li><li><div>          if ( empty( $desc ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $mod['is_post'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// use the excerpt, if we have one</span>&nbsp;</div></li><li><div>                  if ( has_excerpt( $mod['id'] ) ) {&nbsp;</div></li><li><div>                      $desc = get_post_field( 'post_excerpt', $mod['id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( ! empty( $this-&gt;p-&gt;options['plugin_filter_excerpt'] ) ) {&nbsp;</div></li><li><div>                          $filters_changed = apply_filters( $this-&gt;p-&gt;cf['lca'].'_text_filter_has_changes_before', false, 'get_the_excerpt' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// apply the content filters</span></span>&nbsp;</div></li><li><div>                          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                              $this-&gt;p-&gt;debug-&gt;log( 'applying the WordPress get_the_excerpt filters' );&nbsp;</div></li><li><div>                              <span class="comment">//$this-&gt;p-&gt;debug-&gt;log( SucomDebug::get_hooks( 'get_the_excerpt' ) );</span>&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $desc = apply_filters( 'get_the_excerpt', $desc );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( $filters_changed )&nbsp;</div></li><li><div>                              apply_filters( $this-&gt;p-&gt;cf['lca'].'_text_filter_has_changes_after', false, 'get_the_excerpt' );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'fetching content: no post_excerpt for post ID '.$mod['id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// if there's no excerpt, then fallback to the content</span>&nbsp;</div></li><li><div>                  if ( empty( $desc ) )&nbsp;</div></li><li><div>                      $desc = $this-&gt;get_content( $mod, $use_cache, $md_idx );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// ignore everything before the first paragraph if true</span>&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;options['plugin_p_strip'] ) {&nbsp;</div></li><li><div>                      if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;debug-&gt;log( 'removing all text before the first paragraph' );&nbsp;</div></li><li><div>                      $desc = preg_replace( '/^.*?&lt;p&gt;/i', '', $desc );    <span class="comment">// question mark makes regex un-greedy</span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } elseif ( $mod['is_term'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( is_tag() ) {&nbsp;</div></li><li><div>                      if ( ! $desc = tag_description() )&nbsp;</div></li><li><div>                          $desc = sprintf( 'Tagged with %s', single_tag_title( '', false ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  } elseif ( is_category() ) { &nbsp;</div></li><li><div>                      if ( ! $desc = category_description() )&nbsp;</div></li><li><div>                          $desc = sprintf( '%s Category', single_cat_title( '', false ) ); &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  } else {     <span class="comment">// other taxonomies</span>&nbsp;</div></li><li><div>                      $term_obj = SucomUtil::get_term_object( $mod['id'], $mod['tax_slug'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( ! empty( $term_obj-&gt;description ) )&nbsp;</div></li><li><div>                          $desc = $term_obj-&gt;description;&nbsp;</div></li><li><div>                      elseif ( ! empty( $term_obj-&gt;name ) )&nbsp;</div></li><li><div>                          $desc = $term_obj-&gt;name.' Archives';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } elseif ( $mod['is_user'] ) { &nbsp;</div></li><li><div>                  $user_obj = SucomUtil::get_user_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $user_obj-&gt;description ) )&nbsp;</div></li><li><div>                      $desc = $user_obj-&gt;description;&nbsp;</div></li><li><div>                  elseif ( ! empty( $user_obj-&gt;display_name ) )&nbsp;</div></li><li><div>                      $desc = sprintf( 'Authored by %s', $user_obj-&gt;display_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $desc = apply_filters( $this-&gt;p-&gt;cf['lca'].'_user_object_description', $desc, $user_obj );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } elseif ( is_day() ) &nbsp;</div></li><li><div>                  $desc = sprintf( 'Daily Archives for %s', get_the_date() );&nbsp;</div></li><li><div>              elseif ( is_month() ) &nbsp;</div></li><li><div>                  $desc = sprintf( 'Monthly Archives for %s', get_the_date('F Y') );&nbsp;</div></li><li><div>              elseif ( is_year() ) &nbsp;</div></li><li><div>                  $desc = sprintf( 'Yearly Archives for %s', get_the_date('Y') );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// if there's still no description, then fallback to a generic version</span>&nbsp;</div></li><li><div>          if ( empty( $desc ) ) {&nbsp;</div></li><li><div>              if ( $mod['post_status'] === 'auto-draft' ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'post_status is auto-draft: using empty description' );&nbsp;</div></li><li><div>              } elseif ( ! ( $desc = SucomUtil::get_site_description( $this-&gt;p-&gt;options, $mod ) ) )&nbsp;</div></li><li><div>                  $desc = 'No Description';    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $strlen_before_cleanup = $this-&gt;p-&gt;debug-&gt;enabled ? strlen( $desc ) : 0;&nbsp;</div></li><li><div>          $desc = $this-&gt;p-&gt;util-&gt;cleanup_html_tags( $desc, true, $this-&gt;p-&gt;options['plugin_use_img_alt'] );&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'description strlen before html cleanup '.$strlen_before_cleanup.' and after '.strlen( $desc ) );&nbsp;</div></li><li><div>          $desc = apply_filters( $this-&gt;p-&gt;cf['lca'].'_description_pre_limit', $desc );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $textlen &gt; 0 ) {&nbsp;</div></li><li><div>              if ( ! empty( $add_hashtags ) && &nbsp;</div></li><li><div>                  ! empty( $hashtags ) ) &nbsp;</div></li><li><div>                      $textlen = $textlen - strlen( $hashtags ) -1;&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'description strlen before limit length '.strlen( $desc ).' (limiting to '.$textlen.' chars)' );&nbsp;</div></li><li><div>              $desc = $this-&gt;p-&gt;util-&gt;limit_text_length( $desc, $textlen, $trailing, false );    <span class="comment"><span class="comment"><span class="comment">// don't run cleanup_html_tags()</span></span></span>&nbsp;</div></li><li><div>          } elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'description limit text length skipped' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $add_hashtags ) && &nbsp;</div></li><li><div>              ! empty( $hashtags ) ) &nbsp;</div></li><li><div>                  $desc .= ' '.$hashtags;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $encode === true )&nbsp;</div></li><li><div>              $desc = SucomUtil::encode_emoji( htmlentities( $desc, &nbsp;</div></li><li><div>                  ENT_QUOTES, get_bloginfo( 'charset' ), false ) );    <span class="comment"><span class="comment"><span class="comment">// double_encode = false</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark( 'render description' );    <span class="comment">// end timer</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;p-&gt;cf['lca'].'_description', $desc, $mod, $add_hashtags, $md_idx );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_content( array $mod, $use_cache = true, $md_idx = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                  'mod' =&gt; $mod, &nbsp;</div></li><li><div>                  'use_cache' =&gt; $use_cache, &nbsp;</div></li><li><div>                  'md_idx' =&gt; $md_idx, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $content = false;&nbsp;</div></li><li><div>          $filter_content = empty( $this-&gt;p-&gt;options['plugin_filter_content'] ) ? false : true;&nbsp;</div></li><li><div>          $filter_status = $filter_content ? 'filtered' : 'unfiltered';&nbsp;</div></li><li><div>          $caption_prefix = isset( $this-&gt;p-&gt;options['plugin_p_cap_prefix'] ) ?&nbsp;</div></li><li><div>              $this-&gt;p-&gt;options['plugin_p_cap_prefix'] : 'Caption:';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * retrieve the content</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;is_avail['cache']['object'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// if the post id is 0, then add the sharing url to ensure a unique salt string</span>&nbsp;</div></li><li><div>              if ( empty( $mod['id'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'adding sharing_url to cache_salt for mod id 0' );&nbsp;</div></li><li><div>                  $url_salt = '_url:'.$this-&gt;p-&gt;util-&gt;get_sharing_url( $mod, true );&nbsp;</div></li><li><div>              } else $url_salt = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $cache_salt = __METHOD__.'('.SucomUtil::get_mod_salt( $mod ).'_'.$filter_status.$url_salt.')';&nbsp;</div></li><li><div>              $cache_id = $this-&gt;p-&gt;cf['lca'].'_'.md5( $cache_salt );&nbsp;</div></li><li><div>              $cache_type = 'object cache';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $use_cache === true ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $cache_type.': wp_cache salt '.$cache_salt );&nbsp;</div></li><li><div>                  $content = wp_cache_get( $cache_id, __METHOD__ );&nbsp;</div></li><li><div>                  if ( $content !== false ) {&nbsp;</div></li><li><div>                      if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;debug-&gt;log( $cache_type.': '.$filter_status.&nbsp;</div></li><li><div>                              ' content retrieved from wp_cache '.$cache_id );&nbsp;</div></li><li><div>                      return $content;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'use_cache = false' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $content = apply_filters( $this-&gt;p-&gt;cf['lca'].'_content_seed', '', $mod, $use_cache, $md_idx );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $content ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'content seed = &quot;'.$content.'&quot;' );&nbsp;</div></li><li><div>          } elseif ( $mod['is_post'] ) {&nbsp;</div></li><li><div>              $content = get_post_field( 'post_content', $mod['id'] );&nbsp;</div></li><li><div>              if ( empty( $content ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'exiting early: no post_content for post ID '.$mod['id'] );&nbsp;</div></li><li><div>                  return $content;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * modify the content</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// save content length (for comparison) before making changes</span>&nbsp;</div></li><li><div>          $content_strlen_before = strlen( $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// remove singlepics, which we detect and use before-hand </span>&nbsp;</div></li><li><div>          $content = preg_replace( '/\[singlepic[^\]]+\]/', '', $content, -1, $count );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $count &gt; 0 ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( $count.' [singlepic] shortcode(s) removed from content' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $filter_content ) {&nbsp;</div></li><li><div>              $filters_changed = apply_filters( $this-&gt;p-&gt;cf['lca'].'_text_filter_has_changes_before', false, 'the_content' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// remove all of our shortcodes</span>&nbsp;</div></li><li><div>              if ( isset( $this-&gt;p-&gt;cf['*']['lib']['shortcode'] ) && &nbsp;</div></li><li><div>                  is_array( $this-&gt;p-&gt;cf['*']['lib']['shortcode'] ) )&nbsp;</div></li><li><div>                      foreach ( $this-&gt;p-&gt;cf['*']['lib']['shortcode'] as $id =&gt; $name )&nbsp;</div></li><li><div>                          if ( array_key_exists( $id, $this-&gt;shortcode ) && &nbsp;</div></li><li><div>                              is_object( $this-&gt;shortcode[$id] ) )&nbsp;</div></li><li><div>                                  $this-&gt;shortcode[$id]-&gt;remove();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              global $post;&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'saving the original $post object' );&nbsp;</div></li><li><div>              $post_saved = $post;    <span class="comment">// save the original GLOBAL post object</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// WordPress oEmbed needs a $post ID, so make sure we have one</span>&nbsp;</div></li><li><div>              <span class="comment">// see shortcode() in WP_Embed class (wp-includes/class-wp-embed.php)</span>&nbsp;</div></li><li><div>              if ( empty( $post-&gt;ID ) && $mod['is_post'] ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( '$post ID property empty: setting $post from mod ID '.$mod['id'] );&nbsp;</div></li><li><div>                  $post = SucomUtil::get_post_object( $mod['id'] );    <span class="comment">// redefine $post global</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// apply the content filters</span></span>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'applying the WordPress the_content filters' );&nbsp;</div></li><li><div>                  <span class="comment">//$this-&gt;p-&gt;debug-&gt;log( SucomDebug::get_hooks( 'the_content' ) );</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $content = apply_filters( 'the_content', $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'restoring the original $post object' );&nbsp;</div></li><li><div>              $post = $post_saved;    <span class="comment">// restore the original GLOBAL post object</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// cleanup for NGG pre-v2 album shortcode</span>&nbsp;</div></li><li><div>              unset ( $GLOBALS['subalbum'] );&nbsp;</div></li><li><div>              unset ( $GLOBALS['nggShowGallery'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $filters_changed )&nbsp;</div></li><li><div>                  apply_filters( $this-&gt;p-&gt;cf['lca'].'_text_filter_has_changes_after', false, 'the_content' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// add our shortcodes back</span>&nbsp;</div></li><li><div>              if ( isset( $this-&gt;p-&gt;cf['*']['lib']['shortcode'] ) && &nbsp;</div></li><li><div>                  is_array( $this-&gt;p-&gt;cf['*']['lib']['shortcode'] ) )&nbsp;</div></li><li><div>                      foreach ( $this-&gt;p-&gt;cf['*']['lib']['shortcode'] as $id =&gt; $name )&nbsp;</div></li><li><div>                          if ( array_key_exists( $id, $this-&gt;shortcode ) && &nbsp;</div></li><li><div>                              is_object( $this-&gt;shortcode[$id] ) )&nbsp;</div></li><li><div>                                  $this-&gt;shortcode[$id]-&gt;add();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'the_content filters skipped (shortcodes not expanded)' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $content = preg_replace( '/[\s\n\r]+/s', ' ', $content );        <span class="comment">// put everything on one line</span>&nbsp;</div></li><li><div>          $content = preg_replace( '/^.*&lt;!--'.$this-&gt;p-&gt;cf['lca'].'-content--&gt;(.*)&lt;!--\/'.&nbsp;</div></li><li><div>              $this-&gt;p-&gt;cf['lca'].'-content--&gt;.*$/', '$1', $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( strpos( $content, '&gt;Google+&lt;' ) !== false )&nbsp;</div></li><li><div>              $content = preg_replace( '/&lt;a +rel=&quot;author&quot; +href=&quot;&quot; +style=&quot;display:none;&quot;&gt;Google\+&lt;\/a&gt;/', ' ', $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $caption_prefix ) &&&nbsp;</div></li><li><div>              strpos( $content, '&lt;p class=&quot;wp-caption-text&quot;&gt;' ) !== false )&nbsp;</div></li><li><div>                  $content = preg_replace( '/&lt;p class=&quot;wp-caption-text&quot;&gt;/', '${0}'.$caption_prefix.' ', $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( strpos( $content, ']]&gt;' ) !== false )&nbsp;</div></li><li><div>              $content = str_replace( ']]&gt;', ']]&gt;', $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $content_strlen_after = strlen( $content );&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'content strlen before '.$content_strlen_before.' and after changes / filters '.$content_strlen_after );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// apply filters before caching</span>&nbsp;</div></li><li><div>          $content = apply_filters( $this-&gt;p-&gt;cf['lca'].'_content', $content, $mod, $use_cache, $md_idx );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $cache_id ) ) {&nbsp;</div></li><li><div>              <span class="comment">// only some caching plugins implement this function</span>&nbsp;</div></li><li><div>              wp_cache_add_non_persistent_groups( array( __METHOD__ ) );&nbsp;</div></li><li><div>              wp_cache_set( $cache_id, $content, __METHOD__, $this-&gt;p-&gt;options['plugin_object_cache_exp'] );&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( $cache_type.': '.$filter_status.' content saved to wp_cache '.&nbsp;</div></li><li><div>                      $cache_id.' ('.$this-&gt;p-&gt;options['plugin_object_cache_exp'].' seconds)');&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $content;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_article_section( $post_id ) {&nbsp;</div></li><li><div>          $section = '';&nbsp;</div></li><li><div>          if ( ! empty( $post_id ) )&nbsp;</div></li><li><div>              $section = $this-&gt;p-&gt;m['util']['post']-&gt;get_options( $post_id, 'og_art_section' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $section ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'found custom meta article section = '.$section );&nbsp;</div></li><li><div>          } else $section = $this-&gt;p-&gt;options['og_art_section'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $section === 'none' )&nbsp;</div></li><li><div>              $section = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;p-&gt;cf['lca'].'_article_section', $section, $post_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_hashtags( $post_id, $add_hashtags = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $add_hashtags ) )    <span class="comment">// check for false or 0</span>&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          elseif ( is_numeric( $add_hashtags ) )&nbsp;</div></li><li><div>              $max_hashtags = $add_hashtags;&nbsp;</div></li><li><div>          elseif ( ! empty( $this-&gt;p-&gt;options['og_desc_hashtags'] ) )&nbsp;</div></li><li><div>              $max_hashtags = $this-&gt;p-&gt;options['og_desc_hashtags'];&nbsp;</div></li><li><div>          else return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $hashtags = apply_filters( $this-&gt;p-&gt;cf['lca'].'_hashtags_seed', '', $post_id, $add_hashtags );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $hashtags ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'hashtags seed = &quot;'.$hashtags.'&quot;' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $tags = array_slice( $this-&gt;get_tags( $post_id ), 0, $max_hashtags );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $tags ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// remove special character incompatible with Twitter</span>&nbsp;</div></li><li><div>                  $hashtags = SucomUtil::array_to_hashtags( $tags );&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'hashtags (max '.$max_hashtags.') = &quot;'.$hashtags.'&quot;' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;p-&gt;cf['lca'].'_hashtags', $hashtags, $post_id, $add_hashtags );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_tags( $post_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $tags = apply_filters( $this-&gt;p-&gt;cf['lca'].'_tags_seed', array(), $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $tags ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'tags seed = &quot;'.implode( ', ', $tags ).'&quot;' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( is_singular() || ! empty( $post_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $tags = $this-&gt;get_wp_tags( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( isset( $this-&gt;p-&gt;m['media']['ngg'] ) && &nbsp;</div></li><li><div>                      $this-&gt;p-&gt;options['og_ngg_tags'] && &nbsp;</div></li><li><div>                          $this-&gt;p-&gt;is_avail['post_thumbnail'] && &nbsp;</div></li><li><div>                              has_post_thumbnail( $post_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $pid = get_post_thumbnail_id( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// featured images from ngg pre-v2 had 'ngg-' prefix</span>&nbsp;</div></li><li><div>                      if ( is_string( $pid ) && substr( $pid, 0, 4 ) == 'ngg-' )&nbsp;</div></li><li><div>                          $tags = array_merge( $tags, $this-&gt;p-&gt;m['media']['ngg']-&gt;get_tags( $pid ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } elseif ( is_search() )&nbsp;</div></li><li><div>                  $tags = preg_split( '/ *, */', get_search_query( false ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'raw tags = &quot;'.implode( ', ', $tags ).'&quot;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $tags = array_unique( array_map( array( 'SucomUtil', 'sanitize_tag' ), $tags ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'sanitized tags = &quot;'.implode( ', ', $tags ).'&quot;' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;p-&gt;cf['lca'].'_tags', $tags, $post_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_wp_tags( $post_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $tags = apply_filters( $this-&gt;p-&gt;cf['lca'].'_wp_tags_seed', array(), $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $tags ) )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'wp tags seed = &quot;'.implode( ', ', $tags ).'&quot;' );&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $post_ids = array ( $post_id );    <span class="comment">// array of one</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// add the parent tags if option is enabled</span>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;options['og_page_parent_tags'] && is_page( $post_id ) )&nbsp;</div></li><li><div>                  $post_ids = array_merge( $post_ids, get_post_ancestors( $post_id ) );&nbsp;</div></li><li><div>              foreach ( $post_ids as $id ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;options['og_page_title_tag'] && is_page( $id ) )&nbsp;</div></li><li><div>                      $tags[] = SucomUtil::sanitize_tag( get_the_title( $id ) );&nbsp;</div></li><li><div>                  foreach ( wp_get_post_tags( $id, array( 'fields' =&gt; 'names') ) as $tag_name )&nbsp;</div></li><li><div>                      $tags[] = $tag_name;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return apply_filters( $this-&gt;p-&gt;cf['lca'].'_wp_tags', $tags, $post_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_category_title( $term_obj = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_object( $term_obj ) )&nbsp;</div></li><li><div>              $term_obj = SucomUtil::get_term_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $separator = html_entity_decode( $this-&gt;p-&gt;options['og_title_sep'], &nbsp;</div></li><li><div>              ENT_QUOTES, get_bloginfo( 'charset' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $term_obj-&gt;name ) )&nbsp;</div></li><li><div>              $title = $term_obj-&gt;name.' Archives '.$separator.' ';    <span class="comment">// default value</span>&nbsp;</div></li><li><div>          elseif ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'name property missing in term object' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $cat = get_category( $term_obj-&gt;term_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $cat-&gt;category_parent ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $cat_parents = get_category_parents( $term_obj-&gt;term_id, false, ' '.$separator.' ', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_wp_error( $cat_parents ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'get_category_parents error: '.$cat_parents-&gt;get_error_message() );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'get_category_parents() = &quot;'.$cat_parents.'&quot;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $cat_parents ) ) {&nbsp;</div></li><li><div>                      $title = $cat_parents;&nbsp;</div></li><li><div>                      $title = preg_replace( '/\.\.\. '.preg_quote( $separator, '/' ).' /', '... ', $title );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( 'wp_title', $title, $separator, 'right' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>NextGEN Facebook (NGFB)</li><li><span></span>8.35.4-1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>