<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="8.43.0" data-slug="nextgen-facebook-ngfb" data-type="file" data-id="7646"><head xmlns="http://www.w3.org/1999/xhtml"><title> lib-head | file | Nextgen Facebook Ngfb | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, nextgen-facebook-ngfb, 8.43.0" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.25"}};!function(e,n,t){var a;function i(e){var t=n.createElement("canvas"),a=t.getContext&&t.getContext("2d"),i=String.fromCharCode;return!(!a||!a.fillText)&&(a.textBaseline="top",a.font="600 32px Arial","flag"===e?(a.fillText(i(55356,56806,55356,56826),0,0),3e3<t.toDataURL().length):"diversity"===e?(a.fillText(i(55356,57221),0,0),t=a.getImageData(16,16,1,1).data,a.fillText(i(55356,57221,55356,57343),0,0),(t=a.getImageData(16,16,1,1).data)[0],t[1],t[2],t[3],!0):("simple"===e?a.fillText(i(55357,56835),0,0):a.fillText(i(55356,57135),0,0),0!==a.getImageData(16,16,1,1).data[0]))}function o(e){var t=n.createElement("script");t.src=e,t.type="text/javascript",n.getElementsByTagName("head")[0].appendChild(t)}t.supports={simple:i("simple"),flag:i("flag"),unicode8:i("unicode8"),diversity:i("diversity")},t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.simple&&t.supports.flag&&t.supports.unicode8&&t.supports.diversity||(a=function(){t.readyCallback()},n.addEventListener?(n.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(e.attachEvent("onload",a),n.attachEvent("onreadystatechange",function(){"complete"===n.readyState&&t.readyCallback()})),(a=t.source||{}).concatemoji?o(a.concatemoji):a.wpemoji&&a.twemoji&&(o(a.twemoji),o(a.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=262cc1ca879d66bb3191b5f3755857e7' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.25' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/lib-head/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Flib-head%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Flib-head%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-nextgen-facebook-ngfb-8.43.0-file-lib-head","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="lib-head" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to nextgen-facebook-ngfb." href="http://hookr.io/plugins/nextgen-facebook-ngfb/" class="plugin"><span property="name">nextgen-facebook-ngfb</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 8.43.0." href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/" class="H_VERSION"><span property="name">8.43.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">lib-head</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="406"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/all/" title="All">All <span class="count badge">406</span></a></li><li class="" data-id="new" data-count="86"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/new/" title="New">New <span class="count badge">86</span></a></li><li class="" data-id="hooks" data-count="283"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/hooks/" title="Hooks">Hooks <span class="count badge">283</span></a></li><li class="" data-id="action" data-count="12"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/actions/" title="Actions">Actions <span class="count badge">12</span></a></li><li class="" data-id="filter" data-count="271"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/filters/" title="Filters">Filters <span class="count badge">271</span></a></li><li class="" data-id="class" data-count="95"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/classes/" title="Classes">Classes <span class="count badge">95</span></a></li><li class="" data-id="constant" data-count="14"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/constants/" title="Constants">Constants <span class="count badge">14</span></a></li><li class="" data-id="function" data-count="13"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/functions/" title="Functions">Functions <span class="count badge">13</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/lib/head.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * License: GPLv3</span>&nbsp;</div></li><li><div><span class="comment"> * License URI: https://www.gnu.org/licenses/gpl.txt</span>&nbsp;</div></li><li><div><span class="comment"> * Copyright 2012-2017 Jean-Sebastien Morisset (https://surniaulula.com/)</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) {&nbsp;</div></li><li><div>  die( 'These aren\'t the droids you\'re looking for...' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! class_exists( 'NgfbHead' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  class NgfbHead {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private $p;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function __construct( &$plugin ) {&nbsp;</div></li><li><div>          $this-&gt;p =& $plugin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          add_action( 'wp_head', array( &$this, 'show_head' ), NGFB_HEAD_PRIORITY );&nbsp;</div></li><li><div>          add_action( 'amp_post_template_head', array( &$this, 'show_head' ), NGFB_HEAD_PRIORITY );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// remove the 'wp_shortlink_wp_head' hook so we can add our own shortlink meta tag</span>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;options['add_link_rel_shortlink'] ) ) {&nbsp;</div></li><li><div>              remove_action( 'wp_head', 'wp_shortlink_wp_head' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// crawlers are only seen on the front-end, so skip if in back-end</span></span>&nbsp;</div></li><li><div>          if ( ! is_admin() && $this-&gt;p-&gt;avail['*']['vary_ua'] ) {&nbsp;</div></li><li><div>              $this-&gt;vary_user_agent_check();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function vary_user_agent_check() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// query argument used to bust external caches</span>&nbsp;</div></li><li><div>          $crawler_arg = 'uaid';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( strpos( $this-&gt;get_head_cache_index( false ), 'uaid:' ) !== false ) {    <span class="comment">// custom crawler found</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $crawler_name = SucomUtil::get_crawler_name();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'custom crawler cache index found for '.$crawler_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! defined( 'DONOTCACHEPAGE' ) ) {    <span class="comment">// define as true</span>&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'defining DONOTCACHEPAGE as true' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  define( 'DONOTCACHEPAGE', true );&nbsp;</div></li><li><div>              } elseif ( DONOTCACHEPAGE ) {    <span class="comment">// already defined as true</span>&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'DONOTCACHEPAGE already defined as true' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {    <span class="comment">// already defined as false</span>&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'error defining DONOTCACHEPAGE - constant already defined as false' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// add a query argument for this crawler and redirect to bust external caches</span>&nbsp;</div></li><li><div>              if ( empty( $_GET[$crawler_arg] ) || $_GET[$crawler_arg] !== $crawler_name ) {&nbsp;</div></li><li><div>                  wp_redirect( add_query_arg( $crawler_arg, $crawler_name, &nbsp;</div></li><li><div>                      remove_query_arg( $crawler_arg ) ) );    <span class="comment"><span class="comment">// 302 by default</span></span>&nbsp;</div></li><li><div>                  exit;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// if not a custom crawler, then remove the query (if set) and redirect</span>&nbsp;</div></li><li><div>          } elseif ( isset( $_GET[$crawler_arg] ) ) {&nbsp;</div></li><li><div>              wp_redirect( remove_query_arg( $crawler_arg ) );    <span class="comment"><span class="comment">// 302 by default</span></span>&nbsp;</div></li><li><div>              exit;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          add_filter( 'wp_headers', array( &$this, 'add_vary_user_agent_header' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function add_vary_user_agent_header( $headers ) {&nbsp;</div></li><li><div>          $headers['Vary'] = 'User-Agent';&nbsp;</div></li><li><div>          return $headers;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_head_cache_index( $mixed = 'current', $sharing_url = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $head_index = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $mixed !== false ) {    <span class="comment">// optimize for __construct()</span>&nbsp;</div></li><li><div>              $head_index = 'locale:'.SucomUtil::get_locale( $mixed );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $sharing_url !== false ) {&nbsp;</div></li><li><div>              $head_index .= '_url:'.$sharing_url;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( SucomUtil::is_amp() ) {&nbsp;</div></li><li><div>              $head_index .= '_amp:true';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// crawlers are only seen on the front-end, so skip if in back-end</span></span>&nbsp;</div></li><li><div>          if ( ! is_admin() && $this-&gt;p-&gt;avail['*']['vary_ua'] ) {&nbsp;</div></li><li><div>              $crawler_name = SucomUtil::get_crawler_name();&nbsp;</div></li><li><div>              switch ( $crawler_name ) {&nbsp;</div></li><li><div>                  case 'pinterest':&nbsp;</div></li><li><div>                      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                       * Pinterest can get a different custom image, image sizes, </span>&nbsp;</div></li><li><div><span class="comment">                       * and does not read json markup. Create a unique meta tags </span>&nbsp;</div></li><li><div><span class="comment">                       * and index key for Pinterest. </span>&nbsp;</div></li><li><div><span class="comment">                       */</span>&nbsp;</div></li><li><div>                      if ( ! SucomUtil::get_const( 'NGFB_RICH_PIN_DISABLE' ) ) {&nbsp;</div></li><li><div>                          $head_index .= '_uaid:'.$crawler_name;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return ltrim( $head_index, '_' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// called by wp_head action</span>&nbsp;</div></li><li><div>      public function show_head() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $use_post = apply_filters( $lca.'_use_post', false );    <span class="comment">// used by woocommerce with is_shop()</span>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'required call to get_page_mod()' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $mod = $this-&gt;p-&gt;util-&gt;get_page_mod( $use_post );    <span class="comment"><span class="comment"><span class="comment">// get post/user/term id, module name, and module object reference</span></span></span>&nbsp;</div></li><li><div>          $read_cache = true;&nbsp;</div></li><li><div>          $mt_og = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'home url = '.get_option( 'home' ) );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'locale default = '.SucomUtil::get_locale( 'default' ) );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'locale current = '.SucomUtil::get_locale( 'current' ) );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'locale mod = '.SucomUtil::get_locale( $mod ) );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;util-&gt;log_is_functions();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $add_head_html = apply_filters( $lca.'_add_head_html', $this-&gt;p-&gt;avail['*']['head_html'], $mod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'avail head_html = '.( $this-&gt;p-&gt;avail['*']['head_html'] ? 'true' : 'false' ) );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'add_head_html = '.( $add_head_html ? 'true' : 'false' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $add_head_html ) {&nbsp;</div></li><li><div>              echo $this-&gt;get_head_html( $use_post, $mod, $read_cache, $mt_og );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              echo &quot;\n&lt;!-- &quot;.$lca.&quot; head html is disabled --&gt;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'end of get_head_html' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// extract certain key fields for display and sanity checks</span>&nbsp;</div></li><li><div>      public function extract_head_info( array $mod, array $head_mt ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $head_mt as $mt ) {&nbsp;</div></li><li><div>              if ( ! isset( $mt[2] ) ||&nbsp;</div></li><li><div>                  ! isset( $mt[3] ) )&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $mt_match = $mt[2].'-'.$mt[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              switch ( $mt_match ) {&nbsp;</div></li><li><div>                  case 'property-og:type':&nbsp;</div></li><li><div>                  case 'property-og:title':&nbsp;</div></li><li><div>                  case 'property-og:description':&nbsp;</div></li><li><div>                  case 'property-article:author:name':&nbsp;</div></li><li><div>                  case ( strpos( $mt_match, 'name-schema:' ) === 0 ? true : false ):&nbsp;</div></li><li><div>                      if ( ! isset( $head_info[$mt[3]] ) )    <span class="comment">// only save the first meta tag value</span>&nbsp;</div></li><li><div>                          $head_info[$mt[3]] = $mt[5];&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case ( preg_match( '/^property-((og|p):(image|video))(:secure_url|:url)?$/', $mt_match, $m ) ? true : false ):&nbsp;</div></li><li><div>                      if ( ! empty( $mt[5] ) )&nbsp;</div></li><li><div>                          $has_media[$m[1]] = true;    <span class="comment">// optimize media loop</span>&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Save the first image and video information found. Assumes array key order</span>&nbsp;</div></li><li><div><span class="comment">           * defined by SucomUtil::get_mt_prop_image() and SucomUtil::get_mt_prop_video().</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          foreach ( array( 'og:image', 'og:video', 'p:image' ) as $prefix ) {&nbsp;</div></li><li><div>              if ( empty( $has_media[$prefix] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $is_first = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( $head_mt as $mt ) {&nbsp;</div></li><li><div>                  if ( ! isset( $mt[2] ) || ! isset( $mt[3] ) ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( strpos( $mt[3], $prefix ) !== 0 ) {&nbsp;</div></li><li><div>                      $is_first = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// if we already found media, then skip to the next media prefix</span>&nbsp;</div></li><li><div>                      if ( ! empty( $head_info[$prefix] ) ) {&nbsp;</div></li><li><div>                          continue 2;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          continue;    <span class="comment">// skip meta tags without matching prefix</span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $mt_match = $mt[2].'-'.$mt[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  switch ( $mt_match ) {&nbsp;</div></li><li><div>                      case ( preg_match( '/^property-'.$prefix.'(:secure_url|:url)?$/', $mt_match, $m ) ? true : false ):&nbsp;</div></li><li><div>                          if ( ! empty( $head_info[$prefix] ) )    <span class="comment">// only save the media URL once</span>&nbsp;</div></li><li><div>                              continue 2;            <span class="comment"><span class="comment">// get the next meta tag</span></span>&nbsp;</div></li><li><div>                          if ( ! empty( $mt[5] ) ) {&nbsp;</div></li><li><div>                              $head_info[$prefix] = $mt[5];    <span class="comment">// save the media URL</span>&nbsp;</div></li><li><div>                              $is_first = true;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case ( preg_match( '/^property-'.$prefix.':(width|height|cropped|id|title|description)$/', $mt_match, $m ) ? true : false ):&nbsp;</div></li><li><div>                          if ( $is_first !== true )        <span class="comment">// only save for first media found</span>&nbsp;</div></li><li><div>                              continue 2;            <span class="comment"><span class="comment">// get the next meta tag</span></span>&nbsp;</div></li><li><div>                          $head_info[$mt[3]] = $mt[5];&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Save meta tag values for later sorting in list tables.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          foreach ( NgfbMeta::get_sortable_columns() as $col_idx =&gt; $col_info ) {&nbsp;</div></li><li><div>              if ( empty( $col_info['meta_key'] ) )    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              $meta_value = 'none';&nbsp;</div></li><li><div>              switch ( $col_idx ) {&nbsp;</div></li><li><div>                   case 'schema_type':&nbsp;</div></li><li><div>                      if ( isset( $head_info['schema:type:id'] ) )&nbsp;</div></li><li><div>                          $meta_value = $head_info['schema:type:id'];&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'og_img':&nbsp;</div></li><li><div>                      if ( $og_img = $mod['obj']-&gt;get_og_img_column_html( $head_info, $mod ) )&nbsp;</div></li><li><div>                          $meta_value = $og_img;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'og_desc':&nbsp;</div></li><li><div>                      if ( isset( $head_info['og:description'] ) )&nbsp;</div></li><li><div>                          $meta_value = $head_info['og:description'];&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'sortable meta for '.$mod['name'].' id '.$mod['id'].' '.$col_idx.' = '.$meta_value );&nbsp;</div></li><li><div>              $mod['obj']-&gt;update_sortable_meta( $mod['id'], $col_idx, $meta_value );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $head_info;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_head_html( $use_post = false, &$mod = false, $read_cache = true, array &$mt_og ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_array( $mod ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'optional call to get_page_mod()' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $mod = $this-&gt;p-&gt;util-&gt;get_page_mod( $use_post );    <span class="comment"><span class="comment"><span class="comment">// get post/user/term id, module name, and module object reference</span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $start_time = microtime( true );&nbsp;</div></li><li><div>          $crawler_name = SucomUtil::get_crawler_name();&nbsp;</div></li><li><div>          $add_mt_mark = apply_filters( $lca.'_add_meta_name_'.$lca.':mark', &nbsp;</div></li><li><div>              ( empty( $this-&gt;p-&gt;options['plugin_check_head'] ) ? false : true ) );&nbsp;</div></li><li><div>          $added_on = 'added on '.date( 'c' ).( $crawler_name !== 'none' ? ' for '.$crawler_name : '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// extra begin/end meta tag for duplicate meta tags check</span>&nbsp;</div></li><li><div>          $html = &quot;\n\n&quot;.'&lt;!-- '.$lca.' meta tags begin --&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $add_mt_mark ) {&nbsp;</div></li><li><div>              $html .= '&lt;meta name=&quot;'.$lca.':mark:begin&quot; content=&quot;'.$lca.' meta tags begin&quot;/&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// first element of returned array is the html tag</span>&nbsp;</div></li><li><div>          $indent = 0;&nbsp;</div></li><li><div>          foreach ( $this-&gt;get_head_array( $use_post, $mod, $read_cache, $mt_og ) as $mt ) {&nbsp;</div></li><li><div>              if ( ! empty( $mt[0] ) ) {&nbsp;</div></li><li><div>                  if ( $indent && strpos( $mt[0], '&lt;/noscript' ) === 0 ) {&nbsp;</div></li><li><div>                      $indent = 0;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $html .= str_repeat( &quot;\t&quot;, (int) $indent ).$mt[0];&nbsp;</div></li><li><div>                  if ( strpos( $mt[0], '&lt;noscript' ) === 0 ) {&nbsp;</div></li><li><div>                      $indent = 1;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// extra begin / end meta tag for duplicate meta tags check</span>&nbsp;</div></li><li><div>          if ( $add_mt_mark ) {&nbsp;</div></li><li><div>              $html .= '&lt;meta name=&quot;'.$lca.':mark:end&quot; content=&quot;'.$lca.' meta tags end&quot;/&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $html .= '&lt;!-- '.$added_on.' in '.sprintf( '%f secs', &nbsp;</div></li><li><div>              microtime( true ) - $start_time ).' --&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $html .= '&lt;!-- '.$lca.' meta tags end --&gt;'.&quot;\n\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $html;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// $read_cache is false when called by post/term/user load_meta_page() method</span>&nbsp;</div></li><li><div>      public function get_head_array( $use_post = false, &$mod = false, $read_cache = true, &$mt_og = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark( 'build head array' );    <span class="comment">// begin timer</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// $mod is preferred but not required</span>&nbsp;</div></li><li><div>          <span class="comment">// $mod = true | false | post_id | $mod array</span>&nbsp;</div></li><li><div>          if ( ! is_array( $mod ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'optional call to get_page_mod()' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $mod = $this-&gt;p-&gt;util-&gt;get_page_mod( $use_post );    <span class="comment"><span class="comment"><span class="comment">// get post/user/term id, module name, and module object reference</span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $sharing_url = $this-&gt;p-&gt;util-&gt;get_sharing_url( $mod );&nbsp;</div></li><li><div>          $crawler_name = SucomUtil::get_crawler_name();&nbsp;</div></li><li><div>          $head_array = array();&nbsp;</div></li><li><div>          $head_index = $this-&gt;get_head_cache_index( $mod, $sharing_url );&nbsp;</div></li><li><div>          $cache_salt = __METHOD__.'('.SucomUtil::get_mod_salt( $mod, $sharing_url ).')';&nbsp;</div></li><li><div>          $cache_id = $lca.'_'.md5( $cache_salt );&nbsp;</div></li><li><div>          $cache_exp = (int) apply_filters( $lca.'_cache_expire_head_array', &nbsp;</div></li><li><div>              $this-&gt;p-&gt;options['plugin_head_cache_exp'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'sharing url = '.$sharing_url );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'crawler name = '.$crawler_name );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'head index = '.$head_index );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'transient expire = '.$cache_exp );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'transient salt = '.$cache_salt );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $cache_exp &gt; 0 ) {&nbsp;</div></li><li><div>              if ( $read_cache ) {    <span class="comment">// false when called by post/term/user load_meta_page() method</span>&nbsp;</div></li><li><div>                  $head_array = get_transient( $cache_id );&nbsp;</div></li><li><div>                  if ( isset( $head_array[$head_index] ) ) {&nbsp;</div></li><li><div>                      if ( is_array( $head_array[$head_index] ) ) {    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span>&nbsp;</div></li><li><div>                          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                              $this-&gt;p-&gt;debug-&gt;log( 'head index found in array from transient '.$cache_id );&nbsp;</div></li><li><div>                              $this-&gt;p-&gt;debug-&gt;mark( 'build head array' );    <span class="comment"><span class="comment">// end timer</span></span>&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          return $head_array[$head_index];    <span class="comment">// stop here</span>&nbsp;</div></li><li><div>                      } elseif ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;debug-&gt;log( 'head index is not an array' );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } elseif ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'head index not in transient '.$cache_id );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'read cache for head is disabled' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'head array transient is disabled' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// set the reference url for admin notices</span>&nbsp;</div></li><li><div>          if ( is_admin() ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;set_reference_url( $sharing_url );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// define the author_id (if one is available)</span>&nbsp;</div></li><li><div>          $author_id = NgfbUser::get_author_id( $mod );&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'author_id = '.( $author_id === false ? 'false' : $author_id ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Open Graph</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $mt_og = $this-&gt;p-&gt;og-&gt;get_array( $mod, $mt_og, $crawler_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Weibo</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $mt_weibo = $this-&gt;p-&gt;weibo-&gt;get_array( $mod, $mt_og, $crawler_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Twitter Cards</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $mt_tc = $this-&gt;p-&gt;tc-&gt;get_array( $mod, $mt_og, $crawler_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Name / SEO meta tags</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $mt_name = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;options['add_meta_name_author'] ) ) {&nbsp;</div></li><li><div>              <span class="comment">// fallback for authors without a Facebook page URL in their user profile</span>&nbsp;</div></li><li><div>              if ( empty( $mt_og['article:author'] ) &&&nbsp;</div></li><li><div>                  is_object( $this-&gt;p-&gt;m['util']['user'] ) ) {    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $mt_name['author'] = $this-&gt;p-&gt;m['util']['user']-&gt;get_author_meta( $author_id, &nbsp;</div></li><li><div>                      $this-&gt;p-&gt;options['fb_author_name'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( apply_filters( $lca.'_add_meta_name_description', &nbsp;</div></li><li><div>              ( empty( $this-&gt;p-&gt;options['add_meta_name_description'] ) ? false : true ) ) ) {&nbsp;</div></li><li><div>              $mt_name['description'] = $this-&gt;p-&gt;page-&gt;get_description( $this-&gt;p-&gt;options['seo_desc_len'], &nbsp;</div></li><li><div>                  '...', $mod, true, false, true, 'seo_desc' );    <span class="comment">// add_hashtags = false</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;options['add_meta_name_p:domain_verify'] ) ) {&nbsp;</div></li><li><div>              if ( ! empty( $this-&gt;p-&gt;options['p_dom_verify'] ) ) {&nbsp;</div></li><li><div>                  $mt_name['p:domain_verify'] = $this-&gt;p-&gt;options['p_dom_verify'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $mt_name = (array) apply_filters( $lca.'_meta_name', $mt_name, $mod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Link relation tags</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $link_rel = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;options['add_link_rel_author'] ) ) {&nbsp;</div></li><li><div>              if ( ! empty( $author_id ) && is_object( $this-&gt;p-&gt;m['util']['user'] ) ) {    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span>&nbsp;</div></li><li><div>                  $link_rel['author'] = $this-&gt;p-&gt;m['util']['user']-&gt;get_author_website( $author_id, &nbsp;</div></li><li><div>                      $this-&gt;p-&gt;options['seo_author_field'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( apply_filters( $lca.'_add_link_rel_canonical', &nbsp;</div></li><li><div>              ( empty( $this-&gt;p-&gt;options['add_link_rel_canonical'] ) ? false : true ) ) ) {&nbsp;</div></li><li><div>              $link_rel['canonical'] = $this-&gt;p-&gt;util-&gt;get_canonical_url( $mod );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;options['add_link_rel_publisher'] ) ) {&nbsp;</div></li><li><div>              if ( ! empty( $this-&gt;p-&gt;options['seo_publisher_url'] ) ) {&nbsp;</div></li><li><div>                  $link_rel['publisher'] = $this-&gt;p-&gt;options['seo_publisher_url'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;options['add_link_rel_shortlink'] ) ) {&nbsp;</div></li><li><div>              if ( $mod['is_post'] ) {&nbsp;</div></li><li><div>                  $link_rel['shortlink'] = wp_get_shortlink( $mod['id'], 'post' );    <span class="comment">// $context = post</span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $link_rel['shortlink'] = apply_filters( $lca.'_shorten_url', &nbsp;</div></li><li><div>                      $mt_og['og:url'], $this-&gt;p-&gt;options['plugin_shortener'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $link_rel = (array) apply_filters( $lca.'_link_rel', $link_rel, $mod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Schema meta tags</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $mt_schema = $this-&gt;p-&gt;schema-&gt;get_meta_array( $mod, $mt_og, $crawler_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * JSON-LD script</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $mt_json_array = $this-&gt;p-&gt;schema-&gt;get_json_array( $mod, $mt_og, $crawler_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Generator meta tags</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $mt_gen['generator'] = $this-&gt;p-&gt;check-&gt;get_ext_list();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Combine and return all meta tags</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $mt_og = $this-&gt;p-&gt;og-&gt;sanitize_array( $mod, $mt_og );    <span class="comment">// unset mis-matched og_type meta tags</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $head_array[$head_index] = array_merge(&nbsp;</div></li><li><div>              $this-&gt;get_mt_array( 'meta', 'name', $mt_gen, $mod ), &nbsp;</div></li><li><div>              $this-&gt;get_mt_array( 'link', 'rel', $link_rel, $mod ), &nbsp;</div></li><li><div>              $this-&gt;get_mt_array( 'meta', 'property', $mt_og, $mod ), &nbsp;</div></li><li><div>              $this-&gt;get_mt_array( 'meta', 'name', $mt_weibo, $mod ), &nbsp;</div></li><li><div>              $this-&gt;get_mt_array( 'meta', 'name', $mt_tc, $mod ), &nbsp;</div></li><li><div>              $this-&gt;get_mt_array( 'meta', 'itemprop', $mt_schema, $mod ), &nbsp;</div></li><li><div>              $this-&gt;get_mt_array( 'meta', 'name', $mt_name, $mod ), <span class="comment">// seo description is last</span>&nbsp;</div></li><li><div>              $this-&gt;p-&gt;schema-&gt;get_noscript_array( $mod, $mt_og, $crawler_name ), &nbsp;</div></li><li><div>              $mt_json_array&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $cache_exp &gt; 0 ) {&nbsp;</div></li><li><div>              <span class="comment">// update the transient array and keep the original expiration time</span>&nbsp;</div></li><li><div>              $cache_exp = SucomUtil::update_transient_array( $cache_id, $head_array, $cache_exp );&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'head array saved to transient '.$cache_id.' ('.$cache_exp.' seconds)' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// reset the reference url for admin notices</span>&nbsp;</div></li><li><div>          if ( is_admin() ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;set_reference_url( null );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark( 'build head array' );    <span class="comment"><span class="comment">// end timer</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $head_array[$head_index];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Loops through the arrays and calls get_single_mt() for each</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      private function get_mt_array( $tag, $type, array &$mt_array, array &$mod ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( count( $mt_array ).' '.$tag.' '.$type.' to process' );&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( $mt_array );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $mt_array ) )&nbsp;</div></li><li><div>              return array();&nbsp;</div></li><li><div>          elseif ( ! is_array( $mt_array ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'exiting early: mt_array argument is not an array' );&nbsp;</div></li><li><div>              return array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $singles = array();&nbsp;</div></li><li><div>          foreach ( $mt_array as $d_name =&gt; $d_val ) {    <span class="comment">// first dimension array (associative)</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_array( $d_val ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// skip product offer and review arrays</span>&nbsp;</div></li><li><div>                  if ( preg_match( '/:(offers|reviews)$/', $d_name ) ) {&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  } elseif ( empty( $d_val ) ) {    <span class="comment">// allow hooks to modify the value</span>&nbsp;</div></li><li><div>                      $singles[] = $this-&gt;get_single_mt( $tag, &nbsp;</div></li><li><div>                          $type, $d_name, null, '', $mod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  } else foreach ( $d_val as $dd_num =&gt; $dd_val ) {    <span class="comment">// second dimension array</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( SucomUtil::is_assoc( $dd_val ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment">// prevent duplicates - ignore images from text/html video</span></span>&nbsp;</div></li><li><div>                          if ( isset( $dd_val['og:video:type'] ) &&&nbsp;</div></li><li><div>                              $dd_val['og:video:type'] === 'text/html' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// skip if text/html video markup is disabled</span>&nbsp;</div></li><li><div>                              if ( empty( $this-&gt;p-&gt;options['og_vid_html_type'] ) )&nbsp;</div></li><li><div>                                  continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              unset( $dd_val['og:video:embed_url'] );    <span class="comment">// redundant - just in case</span>&nbsp;</div></li><li><div>                              $ignore_images = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          } else $ignore_images = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          foreach ( $dd_val as $ddd_name =&gt; $ddd_val ) {    <span class="comment">// third dimension array (associative)</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment">// prevent duplicates - ignore images from text/html video</span></span>&nbsp;</div></li><li><div>                              if ( $ignore_images && strpos( $ddd_name, 'og:image' ) !== false )&nbsp;</div></li><li><div>                                  continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ( is_array( $ddd_val ) ) {&nbsp;</div></li><li><div>                                  if ( empty( $ddd_val ) ) {&nbsp;</div></li><li><div>                                      $singles[] = $this-&gt;get_single_mt( $tag, &nbsp;</div></li><li><div>                                          $type, $ddd_name, null, '', $mod );&nbsp;</div></li><li><div>                                  } else foreach ( $ddd_val as $dddd_num =&gt; $dddd_val ) {    <span class="comment">// fourth dimension array</span>&nbsp;</div></li><li><div>                                      $singles[] = $this-&gt;get_single_mt( $tag, &nbsp;</div></li><li><div>                                          $type, $ddd_name, $dddd_val, $d_name.':'.&nbsp;</div></li><li><div>                                              ( $dd_num + 1 ), $mod );&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              } else $singles[] = $this-&gt;get_single_mt( $tag, &nbsp;</div></li><li><div>                                  $type, $ddd_name, $ddd_val, $d_name.':'.&nbsp;</div></li><li><div>                                      ( $dd_num + 1 ), $mod );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } else $singles[] = $this-&gt;get_single_mt( $tag, &nbsp;</div></li><li><div>                          $type, $d_name, $dd_val, $d_name.':'.&nbsp;</div></li><li><div>                              ( $dd_num + 1 ), $mod );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else $singles[] = $this-&gt;get_single_mt( $tag, &nbsp;</div></li><li><div>                  $type, $d_name, $d_val, '', $mod );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $merged = array();&nbsp;</div></li><li><div>          foreach ( $singles as $num =&gt; $element ) {&nbsp;</div></li><li><div>              foreach ( $element as $parts )&nbsp;</div></li><li><div>                  $merged[] = $parts;&nbsp;</div></li><li><div>              unset ( $singles[$num] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $merged;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_single_mt( $tag, $type, $name, $value, $cmt, array &$mod ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// check for known exceptions for the 'property' $type</span>&nbsp;</div></li><li><div>          if ( $tag === 'meta' && $type === 'property' ) {&nbsp;</div></li><li><div>              switch ( $name ) {&nbsp;</div></li><li><div>                  <span class="comment">// optimize by matching known values first</span>&nbsp;</div></li><li><div>                  case ( strpos( $name, 'og:' ) === 0 ? true : false ):&nbsp;</div></li><li><div>                  case ( strpos( $name, 'article:' ) === 0 ? true : false ):&nbsp;</div></li><li><div>                      break;    <span class="comment">// $type is already property</span>&nbsp;</div></li><li><div>                  case ( strpos( $name, ':' ) === false ? true : false ):&nbsp;</div></li><li><div>                  case ( strpos( $name, 'twitter:' ) === 0 ? true : false ):&nbsp;</div></li><li><div>                  case ( strpos( $name, 'schema:' ) === 0 ? true : false ):    <span class="comment">// internal meta tags</span>&nbsp;</div></li><li><div>                      $type = 'name';&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $ret = array();&nbsp;</div></li><li><div>          $attr = $tag === 'link' ? 'href' : 'content';&nbsp;</div></li><li><div>          $log_prefix = $tag.' '.$type.' '.$name;&nbsp;</div></li><li><div>          $charset = get_bloginfo( 'charset' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_array( $value ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' value is an array (skipped)' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return $ret;&nbsp;</div></li><li><div>          } elseif ( is_object( $value ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' value is an object (skipped)' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return $ret;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( strpos( $value, '%%' ) ) {&nbsp;</div></li><li><div>              $value = $this-&gt;p-&gt;util-&gt;replace_inline_vars( $value, $mod );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          switch ( $name ) {&nbsp;</div></li><li><div>              case 'og:image:secure_url':&nbsp;</div></li><li><div>              case 'og:video:secure_url':&nbsp;</div></li><li><div>                  if ( strpos( $value, 'https:' ) !== 0 ) {    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span>&nbsp;</div></li><li><div>                      if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' is not https (skipped)' );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      return $ret;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $ret[] = array( '', $tag, $type, $name, $attr, $value, $cmt );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// $parts = array( $html, $tag, $type, $name, $attr, $value, $cmt );</span></span>&nbsp;</div></li><li><div>          foreach ( $ret as $num =&gt; $parts ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! isset( $parts[6] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'parts array is incomplete (skipped)' );&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log_arr( '$parts', $parts );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// filtering of single meta tags can be enabled by defining NGFB_FILTER_SINGLE_TAGS as true</span></span>&nbsp;</div></li><li><div>              if ( SucomUtil::get_const( 'NGFB_FILTER_SINGLE_TAGS' ) ) {&nbsp;</div></li><li><div>                  $parts = $this-&gt;filter_single_mt( $parts, $mod );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $log_prefix = $parts[1].' '.$parts[2].' '.$parts[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' = &quot;'.$parts[5].'&quot;' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $parts[5] === '' || $parts[5] === null ) {    <span class="comment">// allow for 0</span>&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' value is empty (skipped)' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ( $parts[5] === NGFB_UNDEF_INT || $parts[5] === (string) NGFB_UNDEF_INT ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' value is '.NGFB_UNDEF_INT.' (skipped)' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Encode and escape all values, regardless if the meta tag is enabled or not.</span>&nbsp;</div></li><li><div><span class="comment">                   * If the meta tag is enabled, HTML will be created and saved in $parts[0].</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  if ( $parts[1] === 'meta' && $parts[2] === 'itemprop' && strpos( $parts[3], '.' ) !== 0 ) {&nbsp;</div></li><li><div>                      $match_name = preg_replace( '/^.*\./', '', $parts[3] );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $match_name = $parts[3];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// boolean values are converted to their string equivalent</span>&nbsp;</div></li><li><div>                  if ( is_bool( $parts[5] ) ) {&nbsp;</div></li><li><div>                      $parts[5] = $parts[5] ? 'true' : 'false';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  switch ( $match_name ) {&nbsp;</div></li><li><div>                      case 'og:url':&nbsp;</div></li><li><div>                      case 'og:secure_url':&nbsp;</div></li><li><div>                      case 'og:image':&nbsp;</div></li><li><div>                      case 'og:image:url':&nbsp;</div></li><li><div>                      case 'og:image:secure_url':&nbsp;</div></li><li><div>                      case 'og:video':&nbsp;</div></li><li><div>                      case 'og:video:url':&nbsp;</div></li><li><div>                      case 'og:video:secure_url':&nbsp;</div></li><li><div>                      case 'og:video:embed_url':&nbsp;</div></li><li><div>                      case 'place:business:menu_url':&nbsp;</div></li><li><div>                      case 'place:business:order_url':&nbsp;</div></li><li><div>                      case 'twitter:image':&nbsp;</div></li><li><div>                      case 'twitter:player':&nbsp;</div></li><li><div>                      case 'canonical':&nbsp;</div></li><li><div>                      case 'shortlink':&nbsp;</div></li><li><div>                      case 'menu':    <span class="comment">// place menu url</span>&nbsp;</div></li><li><div>                      case 'url':&nbsp;</div></li><li><div>                          $parts[5] = SucomUtil::esc_url_encode( $parts[5] );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'og:title':&nbsp;</div></li><li><div>                      case 'og:description':&nbsp;</div></li><li><div>                      case 'twitter:title':&nbsp;</div></li><li><div>                      case 'twitter:description':&nbsp;</div></li><li><div>                      case 'description':&nbsp;</div></li><li><div>                      case 'name':&nbsp;</div></li><li><div>                          $parts[5] = SucomUtil::encode_emoji( htmlentities( $parts[5], &nbsp;</div></li><li><div>                              ENT_QUOTES, $charset, false ) );    <span class="comment"><span class="comment">// double_encode = false</span></span>&nbsp;</div></li><li><div>                      default:&nbsp;</div></li><li><div>                          $parts[5] = htmlentities( $parts[5], &nbsp;</div></li><li><div>                              ENT_QUOTES, $charset, false );        <span class="comment"><span class="comment">// double_encode = false</span></span>&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// convert mixed case itemprop names (for example) to lower case</span>&nbsp;</div></li><li><div>                  $opt_name = strtolower( 'add_'.$parts[1].'_'.$parts[2].'_'.$parts[3] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $this-&gt;p-&gt;options[$opt_name] ) ) {&nbsp;</div></li><li><div>                      $parts[0] = ( empty( $parts[6] ) ? '' : '&lt;!-- '.$parts[6].' --&gt;' ).&nbsp;</div></li><li><div>                          '&lt;'.$parts[1].' '.$parts[2].'=&quot;'.$match_name.'&quot; '.$parts[4].'=&quot;'.$parts[5].'&quot;/&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>                  } elseif ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' is disabled (skipped)' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $ret[$num] = $parts;    <span class="comment">// save the HTML and encoded value</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $ret;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// filtering of single meta tags can be enabled by defining NGFB_FILTER_SINGLE_TAGS as true</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// $parts = array( $html, $tag, $type, $name, $attr, $value, $cmt );</span></span>&nbsp;</div></li><li><div>      private function filter_single_mt( array &$parts, array &$mod ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $log_prefix = $parts[1].' '.$parts[2].' '.$parts[3];&nbsp;</div></li><li><div>          $filter_name = $this-&gt;p-&gt;cf['lca'].'_'.$parts[1].'_'.$parts[2].'_'.$parts[3].'_'.$parts[4];&nbsp;</div></li><li><div>          $new_value = apply_filters( $filter_name, $parts[5], $parts[6], $mod );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $parts[5] !== $new_value ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' (original) = &quot;'.$parts[5].'&quot;' );&nbsp;</div></li><li><div>              if ( is_array( $new_value ) ) {&nbsp;</div></li><li><div>                  foreach( $new_value as $key =&gt; $value ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' (filtered:'.$key.') = &quot;'.$value.'&quot;' );&nbsp;</div></li><li><div>                      $parts[6] = $parts[3].':'.( is_numeric( $key ) ? $key + 1 : $key );&nbsp;</div></li><li><div>                      $parts[5] = $value;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( $log_prefix.' (filtered) = &quot;'.$new_value.'&quot;' );&nbsp;</div></li><li><div>                  $parts[5] = $new_value;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $parts;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>NextGEN Facebook (NGFB)</li><li><span></span>8.43.0</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>