<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="8.43.0" data-slug="nextgen-facebook-ngfb" data-type="file" data-id="7615"><head xmlns="http://www.w3.org/1999/xhtml"><title> lib-admin | file | Nextgen Facebook Ngfb | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, nextgen-facebook-ngfb, 8.43.0" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.25"}};!function(e,n,t){var a;function i(e){var t=n.createElement("canvas"),a=t.getContext&&t.getContext("2d"),i=String.fromCharCode;return!(!a||!a.fillText)&&(a.textBaseline="top",a.font="600 32px Arial","flag"===e?(a.fillText(i(55356,56806,55356,56826),0,0),3e3<t.toDataURL().length):"diversity"===e?(a.fillText(i(55356,57221),0,0),t=a.getImageData(16,16,1,1).data,a.fillText(i(55356,57221,55356,57343),0,0),(t=a.getImageData(16,16,1,1).data)[0],t[1],t[2],t[3],!0):("simple"===e?a.fillText(i(55357,56835),0,0):a.fillText(i(55356,57135),0,0),0!==a.getImageData(16,16,1,1).data[0]))}function o(e){var t=n.createElement("script");t.src=e,t.type="text/javascript",n.getElementsByTagName("head")[0].appendChild(t)}t.supports={simple:i("simple"),flag:i("flag"),unicode8:i("unicode8"),diversity:i("diversity")},t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.simple&&t.supports.flag&&t.supports.unicode8&&t.supports.diversity||(a=function(){t.readyCallback()},n.addEventListener?(n.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(e.attachEvent("onload",a),n.attachEvent("onreadystatechange",function(){"complete"===n.readyState&&t.readyCallback()})),(a=t.source||{}).concatemoji?o(a.concatemoji):a.wpemoji&&a.twemoji&&(o(a.twemoji),o(a.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=5829bbfe349c4988d93cf640f6624262' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.25' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/lib-admin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Flib-admin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Flib-admin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-nextgen-facebook-ngfb-8.43.0-file-lib-admin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="lib-admin" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to nextgen-facebook-ngfb." href="http://hookr.io/plugins/nextgen-facebook-ngfb/" class="plugin"><span property="name">nextgen-facebook-ngfb</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 8.43.0." href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/" class="H_VERSION"><span property="name">8.43.0</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">lib-admin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="406"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/all/" title="All">All <span class="count badge">406</span></a></li><li class="" data-id="new" data-count="86"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/new/" title="New">New <span class="count badge">86</span></a></li><li class="" data-id="hooks" data-count="283"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/hooks/" title="Hooks">Hooks <span class="count badge">283</span></a></li><li class="" data-id="action" data-count="12"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/actions/" title="Actions">Actions <span class="count badge">12</span></a></li><li class="" data-id="filter" data-count="271"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/filters/" title="Filters">Filters <span class="count badge">271</span></a></li><li class="" data-id="class" data-count="95"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/classes/" title="Classes">Classes <span class="count badge">95</span></a></li><li class="" data-id="constant" data-count="14"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/constants/" title="Constants">Constants <span class="count badge">14</span></a></li><li class="" data-id="function" data-count="13"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/functions/" title="Functions">Functions <span class="count badge">13</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/nextgen-facebook-ngfb/8.43.0/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/lib/admin.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * License: GPLv3</span>&nbsp;</div></li><li><div><span class="comment"> * License URI: https://www.gnu.org/licenses/gpl.txt</span>&nbsp;</div></li><li><div><span class="comment"> * Copyright 2012-2017 Jean-Sebastien Morisset (https://surniaulula.com/)</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) {&nbsp;</div></li><li><div>  die( 'These aren\'t the droids you\'re looking for...' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! class_exists( 'NgfbAdmin' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  class NgfbAdmin {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected $p;&nbsp;</div></li><li><div>      protected $menu_id;&nbsp;</div></li><li><div>      protected $menu_name;&nbsp;</div></li><li><div>      protected $menu_lib;&nbsp;</div></li><li><div>      protected $menu_ext;    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// lowercase acronyn for plugin or extension</span></span></span></span>&nbsp;</div></li><li><div>      protected $pagehook;&nbsp;</div></li><li><div>      protected $pageref_url;&nbsp;</div></li><li><div>      protected $pageref_title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public static $pkg = array();&nbsp;</div></li><li><div>      public static $readme = array();    <span class="comment">// array for the readme of each extension</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public $form = null;&nbsp;</div></li><li><div>      public $lang = array();&nbsp;</div></li><li><div>      public $submenu = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function __construct( &$plugin ) {&nbsp;</div></li><li><div>          $this-&gt;p =& $plugin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * The NgfbScript add_plugin_install_script() method includes jQuery in the thickbox iframe </span>&nbsp;</div></li><li><div><span class="comment">           * to add the iframe_parent arguments when the Install or Update button is clicked.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * These class properties are used by both the NgfbAdmin plugin_complete_actions() and </span>&nbsp;</div></li><li><div><span class="comment">           * plugin_complete_redirect() methods to direct the user back to the thickbox iframe parent</span>&nbsp;</div></li><li><div><span class="comment">           * (aka the plugin licenses settings page) after plugin installation / activation / update.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          foreach ( array(&nbsp;</div></li><li><div>              'pageref_url' =&gt; 'esc_url', &nbsp;</div></li><li><div>              'pageref_title' =&gt; 'esc_html', &nbsp;</div></li><li><div> ) as $pageref =&gt; $esc_func ) {&nbsp;</div></li><li><div>              if ( ! empty( $_GET[$lca.'_'.$pageref] ) ) {&nbsp;</div></li><li><div>                  $this-&gt;$pageref = call_user_func( $esc_func, &nbsp;</div></li><li><div>                      urldecode( $_GET[$lca.'_'.$pageref] ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( SucomUtil::get_const( 'DOING_AJAX' ) ) {&nbsp;</div></li><li><div>              <span class="comment">// nothing to do</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">// admin_menu is run before admin_init</span>&nbsp;</div></li><li><div>              add_action( 'admin_menu', array( &$this, 'load_menu_objects' ), -1000 );&nbsp;</div></li><li><div>              add_action( 'admin_menu', array( &$this, 'add_admin_menus' ), NGFB_ADD_MENU_PRIORITY );&nbsp;</div></li><li><div>              add_action( 'admin_menu', array( &$this, 'add_admin_submenus' ), NGFB_ADD_SUBMENU_PRIORITY );&nbsp;</div></li><li><div>              add_action( 'admin_init', array( &$this, 'register_setting' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// hook in_admin_header to allow for setting changes, plugin activation / loading, etc.</span>&nbsp;</div></li><li><div>              add_action( 'in_admin_header', array( &$this, 'conflict_warnings' ), 10 );&nbsp;</div></li><li><div>              add_action( 'in_admin_header', array( &$this, 'required_notices' ), 20 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_action( 'after_switch_theme', array( &$this, 'reset_check_head_count' ), 10 );&nbsp;</div></li><li><div>              add_action( 'upgrader_process_complete', array( &$this, 'reset_check_head_count' ), 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_action( 'after_switch_theme', array( &$this, 'check_tmpl_head_attributes' ), 20 );&nbsp;</div></li><li><div>              add_action( 'upgrader_process_complete', array( &$this, 'check_tmpl_head_attributes' ), 20 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_filter( 'plugin_action_links', array( &$this, 'add_plugin_action_links' ), 10, 2 );&nbsp;</div></li><li><div>              add_filter( 'wp_redirect', array( &$this, 'profile_updated_redirect' ), -100, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_multisite() ) {&nbsp;</div></li><li><div>                  add_action( 'network_admin_menu', array( &$this, 'load_network_menu_objects' ), -1000 );&nbsp;</div></li><li><div>                  add_action( 'network_admin_menu', array( &$this, 'add_network_admin_menus' ), NGFB_ADD_MENU_PRIORITY );&nbsp;</div></li><li><div>                  add_action( 'network_admin_edit_'.NGFB_SITE_OPTIONS_NAME, array( &$this, 'save_site_options' ) );&nbsp;</div></li><li><div>                  add_filter( 'network_admin_plugin_action_links', array( &$this, 'add_plugin_action_links' ), 10, 2 );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>               <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Provide plugin data from the readme for extensions not hosted on wordpress.org.</span>&nbsp;</div></li><li><div><span class="comment">               * Skip if the update manager extension is active, since it provides more complete </span>&nbsp;</div></li><li><div><span class="comment">               * plugin data than what's available from the readme.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * Note: Update manager versions before 1.6.0 hooked the 'plugins_api' filter, </span>&nbsp;</div></li><li><div><span class="comment">               * which is fired before 'plugins_api_result'. external_plugin_data() returns</span>&nbsp;</div></li><li><div><span class="comment">               * the plugin object as-is if the slug is defined properly, so it should work</span>&nbsp;</div></li><li><div><span class="comment">               * fine with older versions (we require 1.6.0 anyway, just in case).</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              if ( empty( $this-&gt;p-&gt;avail['p_ext']['um'] ) ) {    <span class="comment"><span class="comment">// since um v1.6.0</span></span>&nbsp;</div></li><li><div>                  add_filter( 'plugins_api_result', array( &$this, 'external_plugin_data' ), 1000, 3 );    <span class="comment">// since wp v2.7</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_filter( 'http_request_args', array( &$this, 'add_expect_header' ), 1000, 2 );&nbsp;</div></li><li><div>              add_filter( 'http_request_host_is_external', array( &$this, 'allow_install_hosts' ), 1000, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_filter( 'install_plugin_complete_actions', array( &$this, 'plugin_complete_actions' ), 1000, 1 );&nbsp;</div></li><li><div>              add_filter( 'update_plugin_complete_actions', array( &$this, 'plugin_complete_actions' ), 1000, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_filter( 'wp_redirect', array( &$this, 'plugin_complete_redirect' ), 1000, 1 );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function load_network_menu_objects() {&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// some network menu pages extend the site menu pages</span>&nbsp;</div></li><li><div>          $this-&gt;load_menu_objects( array( 'submenu', 'sitesubmenu' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function load_menu_objects( $menu_libs = array() ) {&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $menu_libs ) ) {&nbsp;</div></li><li><div>              <span class="comment">// 'setting' must follow 'submenu' to extend submenu/advanced.php</span>&nbsp;</div></li><li><div>              $menu_libs = array( 'submenu', 'setting', 'profile' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>              self::$pkg[$ext]['pdir'] = $this-&gt;p-&gt;check-&gt;aop( $ext, false, $this-&gt;p-&gt;avail['*']['p_dir'] );&nbsp;</div></li><li><div>              self::$pkg[$ext]['aop'] = ! empty( $this-&gt;p-&gt;options['plugin_'.$ext.'_tid'] ) &&&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;check-&gt;aop( $lca, true, $this-&gt;p-&gt;avail['*']['p_dir'] ) &&&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;check-&gt;aop( $ext, true, NGFB_UNDEF_INT ) === NGFB_UNDEF_INT ?&nbsp;</div></li><li><div>                          true : false;&nbsp;</div></li><li><div>              self::$pkg[$ext]['type'] = self::$pkg[$ext]['aop'] ?&nbsp;</div></li><li><div>                  _x( 'Pro', 'package type', 'nextgen-facebook' ) :&nbsp;</div></li><li><div>                  _x( 'Free', 'package type', 'nextgen-facebook' );&nbsp;</div></li><li><div>              self::$pkg[$ext]['short'] = $info['short'].' '.self::$pkg[$ext]['type'];&nbsp;</div></li><li><div>              self::$pkg[$ext]['name'] = $info['name'].' '.self::$pkg[$ext]['type'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $menu_libs as $menu_lib ) {&nbsp;</div></li><li><div>              foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>                  if ( ! isset( $info['lib'][$menu_lib] ) )    <span class="comment"><span class="comment"><span class="comment">// not all extensions have submenus</span></span></span>&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  foreach ( $info['lib'][$menu_lib] as $menu_id =&gt; $menu_name ) {&nbsp;</div></li><li><div>                      $classname = apply_filters( $ext.'_load_lib', false, $menu_lib.'/'.$menu_id );&nbsp;</div></li><li><div>                      if ( is_string( $classname ) && class_exists( $classname ) ) {&nbsp;</div></li><li><div>                          if ( ! empty( $info['text_domain'] ) )&nbsp;</div></li><li><div>                              $menu_name = _x( $menu_name, 'lib file description', $info['text_domain'] );&nbsp;</div></li><li><div>                          $this-&gt;submenu[$menu_id] = new $classname( $this-&gt;p, &nbsp;</div></li><li><div>                              $menu_id, $menu_name, $menu_lib, $ext );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function add_network_admin_menus() {&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;add_admin_menus( 'sitesubmenu' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// add a new main menu, and its sub-menu items</span>&nbsp;</div></li><li><div>      public function add_admin_menus( $menu_lib = '' ) {&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $menu_lib ) ) {&nbsp;</div></li><li><div>              $menu_lib = 'submenu';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $libs = $this-&gt;p-&gt;cf['*']['lib'][$menu_lib];&nbsp;</div></li><li><div>          $this-&gt;menu_id = key( $libs );&nbsp;</div></li><li><div>          $this-&gt;menu_name = $libs[$this-&gt;menu_id];&nbsp;</div></li><li><div>          $this-&gt;menu_lib = $menu_lib;&nbsp;</div></li><li><div>          $this-&gt;menu_ext = $lca;    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// lowercase acronyn for plugin or extension</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $this-&gt;submenu[$this-&gt;menu_id] ) ) {&nbsp;</div></li><li><div>              $menu_slug = $lca.'-'.$this-&gt;menu_id;&nbsp;</div></li><li><div>              $this-&gt;submenu[$this-&gt;menu_id]-&gt;add_menu_page( $menu_slug );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $sorted_menu = array();&nbsp;</div></li><li><div>          $unsorted_menu = array();&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>              if ( ! isset( $info['lib'][$menu_lib] ) )    <span class="comment"><span class="comment"><span class="comment">// not all extensions have submenus</span></span></span>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              foreach ( $info['lib'][$menu_lib] as $menu_id =&gt; $menu_name ) {&nbsp;</div></li><li><div>                  $parent_slug = $this-&gt;p-&gt;cf['lca'].'-'.$this-&gt;menu_id;&nbsp;</div></li><li><div>                  if ( $lca === $ext )&nbsp;</div></li><li><div>                      $unsorted_menu[] = array( $parent_slug, $menu_id, $menu_name, $menu_lib, $ext );&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $name_text = wp_strip_all_tags( $menu_name, true );    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $sorted_key = $name_text.'-'.$menu_id;&nbsp;</div></li><li><div>                      $sorted_menu[$sorted_key] = array( $parent_slug, $menu_id, $menu_name, $menu_lib, $ext );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ksort( $sorted_menu );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( array_merge( $unsorted_menu, $sorted_menu ) as $key =&gt; $arg ) {&nbsp;</div></li><li><div>              if ( isset( $this-&gt;submenu[$arg[1]] ) )&nbsp;</div></li><li><div>                  $this-&gt;submenu[$arg[1]]-&gt;add_submenu_page( $arg[0] );&nbsp;</div></li><li><div>              else $this-&gt;add_submenu_page( $arg[0], $arg[1], $arg[2], $arg[3], $arg[4] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// add sub-menu items to existing menus (profile and setting)</span>&nbsp;</div></li><li><div>      public function add_admin_submenus() {&nbsp;</div></li><li><div>          foreach ( array( 'profile', 'setting' ) as $menu_lib ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// match wordpress behavior (users page for admins, profile page for everyone else)</span></span></span>&nbsp;</div></li><li><div>              if ( $menu_lib === 'profile' && current_user_can( 'list_users' ) ) {&nbsp;</div></li><li><div>                  $parent_slug = $this-&gt;p-&gt;cf['wp']['admin']['users']['page'];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $parent_slug = $this-&gt;p-&gt;cf['wp']['admin'][$menu_lib]['page'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sorted_menu = array();&nbsp;</div></li><li><div>              foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>                  if ( ! isset( $info['lib'][$menu_lib] ) )    <span class="comment"><span class="comment"><span class="comment">// not all extensions have submenus</span></span></span>&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  foreach ( $info['lib'][$menu_lib] as $menu_id =&gt; $menu_name ) {&nbsp;</div></li><li><div>                      $name_text = wp_strip_all_tags( $menu_name, true );    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      $sorted_menu[$name_text.'-'.$menu_id] = array( $parent_slug, &nbsp;</div></li><li><div>                          $menu_id, $menu_name, $menu_lib, $ext );    <span class="comment">// add_submenu_page() args</span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              ksort( $sorted_menu );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( $sorted_menu as $key =&gt; $arg ) {&nbsp;</div></li><li><div>                  if ( isset( $this-&gt;submenu[$arg[1]] ) )&nbsp;</div></li><li><div>                      $this-&gt;submenu[$arg[1]]-&gt;add_submenu_page( $arg[0] );&nbsp;</div></li><li><div>                  else $this-&gt;add_submenu_page( $arg[0], $arg[1], $arg[2], $arg[3], $arg[4] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Called by the show_setting_page() method, and extended by the </span>&nbsp;</div></li><li><div><span class="comment">       * sitesubmenu classes to load the site options instead.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function set_form_object( $menu_ext ) {    <span class="comment"><span class="comment">// $menu_ext required for text_domain</span></span>&nbsp;</div></li><li><div>          $def_opts = $this-&gt;p-&gt;opt-&gt;get_defaults();&nbsp;</div></li><li><div>          $this-&gt;form = new SucomForm( $this-&gt;p, NGFB_OPTIONS_NAME, &nbsp;</div></li><li><div>              $this-&gt;p-&gt;options, $def_opts, $menu_ext );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function &get_form_object( $menu_ext ) {    <span class="comment"><span class="comment">// $menu_ext required for text_domain</span></span>&nbsp;</div></li><li><div>          if ( ! isset( $this-&gt;form ) ||&nbsp;</div></li><li><div>              $this-&gt;form-&gt;get_menu_ext() !== $menu_ext ) {    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              $this-&gt;set_form_object( $menu_ext );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $this-&gt;form;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function register_setting() {&nbsp;</div></li><li><div>          register_setting( $this-&gt;p-&gt;cf['lca'].'_setting', NGFB_OPTIONS_NAME, &nbsp;</div></li><li><div>              array( &$this, 'registered_setting_sanitation' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function add_menu_page( $menu_slug ) {&nbsp;</div></li><li><div>          global $wp_version;&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// add_menu_page( $page_title, $menu_title, $capability, $menu_slug, $function, $icon_url, $position );</span>&nbsp;</div></li><li><div>          $this-&gt;pagehook = add_menu_page(&nbsp;</div></li><li><div>              self::$pkg[$lca]['short'].' &mdash; '.$this-&gt;menu_name, &nbsp;</div></li><li><div>              $this-&gt;p-&gt;cf['menu']['label'].' '.self::$pkg[$lca]['type'], &nbsp;</div></li><li><div>              ( isset( $this-&gt;p-&gt;cf['wp']['admin'][$this-&gt;menu_lib]['cap'] ) ?&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;cf['wp']['admin'][$this-&gt;menu_lib]['cap'] :&nbsp;</div></li><li><div>                  'manage_options' ), <span class="comment">// fallback to manage_options capability</span>&nbsp;</div></li><li><div>              $menu_slug, &nbsp;</div></li><li><div>              array( &$this, 'show_setting_page' ), &nbsp;</div></li><li><div>              ( version_compare( $wp_version, 3.8, '&lt;' ) ? null : 'dashicons-share' ), &nbsp;</div></li><li><div>              NGFB_MENU_ORDER&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          add_action( 'load-'.$this-&gt;pagehook, array( &$this, 'load_setting_page' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function add_submenu_page( $parent_slug, $menu_id = '', $menu_name = '', $menu_lib = '', $menu_ext = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $menu_id ) ) {&nbsp;</div></li><li><div>              $menu_id = $this-&gt;menu_id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( empty( $menu_name ) ) {&nbsp;</div></li><li><div>              $menu_name = $this-&gt;menu_name;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( empty( $menu_lib ) ) {&nbsp;</div></li><li><div>              $menu_lib = $this-&gt;menu_lib;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( empty( $menu_ext ) ) {&nbsp;</div></li><li><div>              $menu_ext = $this-&gt;menu_ext;    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// lowercase acronyn for plugin or extension</span></span></span></span>&nbsp;</div></li><li><div>              if ( empty( $menu_ext ) ) {&nbsp;</div></li><li><div>                  $menu_ext = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          global $wp_version;&nbsp;</div></li><li><div>          if ( $menu_ext === $this-&gt;p-&gt;cf['lca'] ||        <span class="comment">// plugin menu and sub-menu items</span>&nbsp;</div></li><li><div>              version_compare( $wp_version, 3.8, '&lt;' ) ) {    <span class="comment">// wp v3.8 required for dashicons</span>&nbsp;</div></li><li><div>              $menu_title = $menu_name;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $menu_title = '&lt;div class=&quot;extension-plugin'.    <span class="comment">// add plugin icon for extensions</span>&nbsp;</div></li><li><div>                  ' dashicons-before dashicons-admin-plugins&quot;&gt;&lt;/div&gt;'.&nbsp;</div></li><li><div>                  '&lt;div class=&quot;extension-plugin&quot;&gt;'.$menu_name.'&lt;/div&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( strpos( $menu_title, '&lt;color&gt;' ) !== false )&nbsp;</div></li><li><div>              $menu_title = preg_replace( array( '/&lt;color&gt;/', '/&lt;\/color&gt;/' ), &nbsp;</div></li><li><div>                  array( '&lt;span style=&quot;color:#'.$this-&gt;p-&gt;cf['menu']['color'].';&quot;&gt;', '&lt;/span&gt;' ), $menu_title );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $page_title = self::$pkg[$menu_ext]['short'].' &mdash; '.$menu_title;&nbsp;</div></li><li><div>          $capability = isset( $this-&gt;p-&gt;cf['wp']['admin'][$menu_lib]['cap'] ) ?&nbsp;</div></li><li><div>              $this-&gt;p-&gt;cf['wp']['admin'][$menu_lib]['cap'] : 'manage_options';&nbsp;</div></li><li><div>          $menu_slug = $this-&gt;p-&gt;cf['lca'].'-'.$menu_id;&nbsp;</div></li><li><div>          $function = array( &$this, 'show_setting_page' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;pagehook = add_submenu_page( $parent_slug, $page_title, $menu_title, &nbsp;</div></li><li><div>              $capability, $menu_slug, $function );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $function ) {&nbsp;</div></li><li><div>              add_action( 'load-'.$this-&gt;pagehook, array( &$this, 'load_setting_page' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// add links on the main plugins page</span>&nbsp;</div></li><li><div>      public function add_plugin_action_links( $links, $plugin_base, $utm_source = 'plugin-action-links', &$tabindex = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! isset( $this-&gt;p-&gt;cf['*']['base'][$plugin_base] ) ) {&nbsp;</div></li><li><div>              return $links;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $ext = $this-&gt;p-&gt;cf['*']['base'][$plugin_base];&nbsp;</div></li><li><div>          $info = $this-&gt;p-&gt;cf['plugin'][$ext];&nbsp;</div></li><li><div>          $tabindex = is_integer( $tabindex ) ? $tabindex : false;    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $links as $num =&gt; $val ) {&nbsp;</div></li><li><div>              if ( strpos( $val, '&gt;Edit&lt;' ) !== false ) {&nbsp;</div></li><li><div>                  unset ( $links[$num] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $info['url']['faqs'] ) ) {&nbsp;</div></li><li><div>              $links[] = '&lt;a href=&quot;'.$info['url']['faqs'].'&quot;'.&nbsp;</div></li><li><div>                  ( $tabindex !== false ? ' tabindex=&quot;'.++$tabindex.'&quot;' : '' ).'&gt;'.&nbsp;</div></li><li><div>                  _x( 'FAQ', 'plugin action link', 'nextgen-facebook' ).'&lt;/a&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $info['url']['notes'] ) ) {&nbsp;</div></li><li><div>              $links[] = '&lt;a href=&quot;'.$info['url']['notes'].'&quot;'.&nbsp;</div></li><li><div>                  ( $tabindex !== false ? ' tabindex=&quot;'.++$tabindex.'&quot;' : '' ).'&gt;'.&nbsp;</div></li><li><div>                  _x( 'Notes', 'plugin action link', 'nextgen-facebook' ).'&lt;/a&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $info['url']['support'] ) && self::$pkg[$ext]['aop'] ) {&nbsp;</div></li><li><div>              $links[] = '&lt;a href=&quot;'.$info['url']['support'].'&quot;'.&nbsp;</div></li><li><div>                  ( $tabindex !== false ? ' tabindex=&quot;'.++$tabindex.'&quot;' : '' ).'&gt;'.&nbsp;</div></li><li><div>                  _x( 'Support', 'plugin action link', 'nextgen-facebook' ).'&lt;/a&gt;';&nbsp;</div></li><li><div>          } elseif ( ! empty( $info['url']['forum'] ) ) {&nbsp;</div></li><li><div>              $links[] = '&lt;a href=&quot;'.$info['url']['forum'].'&quot;'.&nbsp;</div></li><li><div>                  ( $tabindex !== false ? ' tabindex=&quot;'.++$tabindex.'&quot;' : '' ).'&gt;'.&nbsp;</div></li><li><div>                  _x( 'Forum', 'plugin action link', 'nextgen-facebook' ).'&lt;/a&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $info['url']['purchase'] ) ) {&nbsp;</div></li><li><div>              if ( ! empty( $utm_source ) ) {&nbsp;</div></li><li><div>                  $purchase_url = add_query_arg( 'utm_source', $utm_source, $info['url']['purchase'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $links[] = $this-&gt;p-&gt;msgs-&gt;get( 'pro-purchase-text', &nbsp;</div></li><li><div>                  array( 'ext' =&gt; $ext, 'url' =&gt; $purchase_url, &nbsp;</div></li><li><div>                      'tabindex' =&gt; ( $tabindex !== false ? ++$tabindex : false ) ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $links;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// define and disable the &quot;Expect: 100-continue&quot; header</span>&nbsp;</div></li><li><div>      <span class="comment">// use checks to make sure other filters aren't giving us a string or boolean</span>&nbsp;</div></li><li><div>      public function add_expect_header( $req, $url ) {&nbsp;</div></li><li><div>          if ( ! is_array( $req ) ) {&nbsp;</div></li><li><div>              $req = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! isset( $req['headers'] ) || ! is_array( $req['headers'] ) ) {&nbsp;</div></li><li><div>              $req['headers'] = array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $req['headers']['Expect'] = '';&nbsp;</div></li><li><div>          return $req;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function allow_install_hosts( $is_allowed, $ip, $url ) {&nbsp;</div></li><li><div>          if ( ! $is_allowed ) {    <span class="comment">// don't bother if already allowed</span>&nbsp;</div></li><li><div>              if ( isset( $this-&gt;p-&gt;cf['install_hosts'] ) ) {&nbsp;</div></li><li><div>                  foreach ( $this-&gt;p-&gt;cf['install_hosts'] as $host ) {&nbsp;</div></li><li><div>                      if ( strpos( $url, $host ) === 0 ) {&nbsp;</div></li><li><div>                          return true;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $is_allowed;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Provide plugin data from the readme for extensions not hosted on wordpress.org.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function external_plugin_data( $res, $action = null, $args = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// this filter only provides plugin data</span>&nbsp;</div></li><li><div>          if ( $action !== 'plugin_information' ) {&nbsp;</div></li><li><div>              return $res;&nbsp;</div></li><li><div>          <span class="comment">// make sure we have a slug in the request</span>&nbsp;</div></li><li><div>          } elseif ( empty( $args-&gt;slug ) ) {&nbsp;</div></li><li><div>              return $res;&nbsp;</div></li><li><div>          <span class="comment">// make sure the plugin slug is one of ours</span>&nbsp;</div></li><li><div>          } elseif ( empty( $this-&gt;p-&gt;cf['*']['slug'][$args-&gt;slug] ) ) {&nbsp;</div></li><li><div>              return $res;&nbsp;</div></li><li><div>          <span class="comment">// if the object from wordpress looks complete, return it as-is</span>&nbsp;</div></li><li><div>          } elseif ( isset( $res-&gt;slug ) && $res-&gt;slug === $args-&gt;slug ) {&nbsp;</div></li><li><div>              return $res;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// get the extension acronym for the config</span>&nbsp;</div></li><li><div>          $ext = $this-&gt;p-&gt;cf['*']['slug'][$args-&gt;slug];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// make sure we have a config for that slug</span>&nbsp;</div></li><li><div>          if ( empty( $this-&gt;p-&gt;cf['plugin'][$ext] ) ) {&nbsp;</div></li><li><div>              return $res;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// get plugin data from the plugin readme</span>&nbsp;</div></li><li><div>          $plugin_data = $this-&gt;get_plugin_data( $ext );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// make sure we have something to return</span>&nbsp;</div></li><li><div>          if ( empty( $plugin_data ) ) {&nbsp;</div></li><li><div>              return $res;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// let wordpress known that this is not a wordpress.org plugin</span>&nbsp;</div></li><li><div>          $plugin_data-&gt;external = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $plugin_data;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get the plugin readme and cache on disk. Convert the readme array to a plugin data object.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_plugin_data( $ext, $use_cache = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $data = new StdClass;&nbsp;</div></li><li><div>          $info = $this-&gt;p-&gt;cf['plugin'][$ext];&nbsp;</div></li><li><div>          $readme = $this-&gt;get_readme_info( $ext, $use_cache );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// make sure we got something back</span>&nbsp;</div></li><li><div>          if ( empty( $readme ) ) {&nbsp;</div></li><li><div>              return array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( array(&nbsp;</div></li><li><div>              <span class="comment">// readme array =&gt; plugin object</span>&nbsp;</div></li><li><div>              'plugin_name' =&gt; 'name', &nbsp;</div></li><li><div>              'plugin_slug' =&gt; 'slug', &nbsp;</div></li><li><div>              'base' =&gt; 'plugin', &nbsp;</div></li><li><div>              'stable_tag' =&gt; 'version', &nbsp;</div></li><li><div>              'tested_up_to' =&gt; 'tested', &nbsp;</div></li><li><div>              'requires_at_least' =&gt; 'requires', &nbsp;</div></li><li><div>              'home' =&gt; 'homepage', &nbsp;</div></li><li><div>              'latest' =&gt; 'download_link', &nbsp;</div></li><li><div>              'author' =&gt; 'author', &nbsp;</div></li><li><div>              'upgrade_notice' =&gt; 'upgrade_notice', &nbsp;</div></li><li><div>              'downloaded' =&gt; 'downloaded', &nbsp;</div></li><li><div>              'last_updated' =&gt; 'last_updated', &nbsp;</div></li><li><div>              'sections' =&gt; 'sections', &nbsp;</div></li><li><div>              'remaining_content' =&gt; 'other_notes', <span class="comment">// added to sections</span>&nbsp;</div></li><li><div>              'banners' =&gt; 'banners', &nbsp;</div></li><li><div> ) as $key_name =&gt; $prop_name ) {&nbsp;</div></li><li><div>              switch ( $key_name ) {&nbsp;</div></li><li><div>                  case 'base':    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// from plugin config</span></span></span></span>&nbsp;</div></li><li><div>                      if ( ! empty( $info[$key_name] ) ) {&nbsp;</div></li><li><div>                          $data-&gt;$prop_name = $info[$key_name];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'home':    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// from plugin config</span></span></span></span>&nbsp;</div></li><li><div>                      if ( ! empty( $info['url']['purchase'] ) ) {    <span class="comment">// check for purchase url first</span>&nbsp;</div></li><li><div>                          $data-&gt;$prop_name = $info['url']['purchase'];&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      <span class="comment">// no break - override with home url (if one is defined)</span>&nbsp;</div></li><li><div>                  case 'latest':    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// from plugin config</span></span></span></span>&nbsp;</div></li><li><div>                      if ( ! empty( $info['url'][$key_name] ) ) {&nbsp;</div></li><li><div>                          $data-&gt;$prop_name = $info['url'][$key_name];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'banners':    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// from plugin config</span></span></span></span>&nbsp;</div></li><li><div>                      if ( ! empty( $info['img'][$key_name] ) ) {&nbsp;</div></li><li><div>                          $data-&gt;$prop_name = $info['img'][$key_name];    <span class="comment">// array with low/high images</span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'remaining_content':&nbsp;</div></li><li><div>                      if ( ! empty( $readme[$key_name] ) ) {&nbsp;</div></li><li><div>                          $data-&gt;sections[$prop_name] = $readme[$key_name];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  default:&nbsp;</div></li><li><div>                      if ( ! empty( $readme[$key_name] ) ) {&nbsp;</div></li><li><div>                          $data-&gt;$prop_name = $readme[$key_name];&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $data;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * This method receives only a partial options array, so re-create a full one.</span>&nbsp;</div></li><li><div><span class="comment">       * WordPress handles the actual saving of the options to the database table.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function registered_setting_sanitation( $opts ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $network = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_array( $opts ) ) {&nbsp;</div></li><li><div>              add_settings_error( NGFB_OPTIONS_NAME, 'notarray', '&lt;b&gt;'.strtoupper( $lca ).' Error&lt;/b&gt; : '.&nbsp;</div></li><li><div>                  __( 'Submitted options are not an array.', 'nextgen-facebook' ), 'error' );&nbsp;</div></li><li><div>              return $opts;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// get default values, including css from default stylesheets</span>&nbsp;</div></li><li><div>          $def_opts = $this-&gt;p-&gt;opt-&gt;get_defaults();&nbsp;</div></li><li><div>          $opts = SucomUtil::restore_checkboxes( $opts );&nbsp;</div></li><li><div>          $opts = array_merge( $this-&gt;p-&gt;options, $opts );&nbsp;</div></li><li><div>          $this-&gt;p-&gt;notice-&gt;trunc();    <span class="comment"><span class="comment">// clear all messages before sanitation checks</span></span>&nbsp;</div></li><li><div>          $opts = $this-&gt;p-&gt;opt-&gt;sanitize( $opts, $def_opts, $network );&nbsp;</div></li><li><div>          $opts = apply_filters( $lca.'_save_options', $opts, NGFB_OPTIONS_NAME, $network );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $this-&gt;p-&gt;options['plugin_clear_on_save'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// admin url will redirect to the essential settings since we're not on a settings page</span>&nbsp;</div></li><li><div>              $clear_cache_link = $this-&gt;p-&gt;util-&gt;get_admin_url( wp_nonce_url( '?'.$lca.'-action=clear_all_cache', &nbsp;</div></li><li><div>                  NgfbAdmin::get_nonce(), NGFB_NONCE ), _x( 'Clear All Caches', 'submit button', 'nextgen-facebook' ) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;upd( '&lt;strong&gt;'.__( 'Plugin settings have been saved.', 'nextgen-facebook' ).'&lt;/strong&gt; &lt;em&gt;'.&nbsp;</div></li><li><div>                  __( 'Please note that webpage content may take several days to reflect changes.', 'nextgen-facebook' ).' '.&nbsp;</div></li><li><div>                  sprintf( __( '%s now to force a refresh.', 'nextgen-facebook' ), $clear_cache_link ).'&lt;/em&gt;' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;util-&gt;clear_all_cache( true, __FUNCTION__.'_clear_all_cache', true );    <span class="comment"><span class="comment"><span class="comment">// can be dismissed</span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;upd( '&lt;strong&gt;'.__( 'Plugin settings have been saved.', 'nextgen-facebook' ).'&lt;/strong&gt; &lt;em&gt;'.&nbsp;</div></li><li><div>                  sprintf( __( 'All caches have also been cleared (the %s option is enabled).', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                      $this-&gt;p-&gt;util-&gt;get_admin_url( 'advanced#sucom-tabset_plugin-tab_cache', &nbsp;</div></li><li><div>                          _x( 'Clear All Cache on Save Settings', 'option label', 'nextgen-facebook' ) ) ).'&lt;/em&gt;' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $opts['plugin_filter_content'] ) ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;warn( $this-&gt;p-&gt;msgs-&gt;get( 'notice-content-filters-disabled' ), &nbsp;</div></li><li><div>                  true, 'notice-content-filters-disabled', true );    <span class="comment"><span class="comment"><span class="comment">// can be dismissed</span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;check_tmpl_head_attributes();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $opts;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function save_site_options() {&nbsp;</div></li><li><div>          $network = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $page = SucomUtil::get_request_value( 'page', 'POST' ) ) {    <span class="comment">// uses sanitize_text_field</span>&nbsp;</div></li><li><div>              $page = key( $this-&gt;p-&gt;cf['*']['lib']['sitesubmenu'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $_POST[ NGFB_NONCE ] ) ) {    <span class="comment"><span class="comment"><span class="comment">// NGFB_NONCE is an md5() string</span></span></span>&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'nonce token validation post field missing' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              wp_redirect( $this-&gt;p-&gt;util-&gt;get_admin_url( $page ) );&nbsp;</div></li><li><div>              exit;&nbsp;</div></li><li><div>          } elseif ( ! wp_verify_nonce( $_POST[ NGFB_NONCE ], NgfbAdmin::get_nonce() ) ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;err( __( 'Nonce token validation failed for network options (update ignored).', &nbsp;</div></li><li><div>                  'nextgen-facebook' ) );&nbsp;</div></li><li><div>              wp_redirect( $this-&gt;p-&gt;util-&gt;get_admin_url( $page ) );&nbsp;</div></li><li><div>              exit;&nbsp;</div></li><li><div>          } elseif ( ! current_user_can( 'manage_network_options' ) ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;err( __( 'Insufficient privileges to modify network options.', &nbsp;</div></li><li><div>                  'nextgen-facebook' ) );&nbsp;</div></li><li><div>              wp_redirect( $this-&gt;p-&gt;util-&gt;get_admin_url( $page ) );&nbsp;</div></li><li><div>              exit;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $def_opts = $this-&gt;p-&gt;opt-&gt;get_site_defaults();&nbsp;</div></li><li><div>          $opts = empty( $_POST[NGFB_SITE_OPTIONS_NAME] ) ? $def_opts :&nbsp;</div></li><li><div>              SucomUtil::restore_checkboxes( $_POST[NGFB_SITE_OPTIONS_NAME] );&nbsp;</div></li><li><div>          $opts = array_merge( $this-&gt;p-&gt;site_options, $opts );&nbsp;</div></li><li><div>          $this-&gt;p-&gt;notice-&gt;trunc();    <span class="comment"><span class="comment">// clear all messages before sanitation checks</span></span>&nbsp;</div></li><li><div>          $opts = $this-&gt;p-&gt;opt-&gt;sanitize( $opts, $def_opts, $network );&nbsp;</div></li><li><div>          $opts = apply_filters( $this-&gt;p-&gt;cf['lca'].'_save_site_options', $opts, $def_opts, $network );&nbsp;</div></li><li><div>          update_site_option( NGFB_SITE_OPTIONS_NAME, $opts );&nbsp;</div></li><li><div>          $this-&gt;p-&gt;notice-&gt;upd( '&lt;strong&gt;'.__( 'Plugin settings have been saved.', <span class="comment"><span class="comment"><span class="comment">// green</span> status w check mark</span></span>&nbsp;</div></li><li><div>              'nextgen-facebook' ).'&lt;/strong&gt;' );&nbsp;</div></li><li><div>          wp_redirect( $this-&gt;p-&gt;util-&gt;get_admin_url( $page ).'&settings-updated=true' );&nbsp;</div></li><li><div>          exit;    <span class="comment"><span class="comment">// stop here</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function load_setting_page() {&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $action_query = $lca.'-action';&nbsp;</div></li><li><div>          wp_enqueue_script( 'postbox' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $_GET[$action_query] ) ) {&nbsp;</div></li><li><div>              $action_name = SucomUtil::sanitize_hookname( $_GET[$action_query] );&nbsp;</div></li><li><div>              if ( empty( $_GET[ NGFB_NONCE ] ) ) {    <span class="comment"><span class="comment"><span class="comment">// NGFB_NONCE is an md5() string</span></span></span>&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'nonce token validation query field missing' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ( ! wp_verify_nonce( $_GET[ NGFB_NONCE ], NgfbAdmin::get_nonce() ) ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( sprintf( __( 'Nonce token validation failed for %1$s action &quot;%2$s&quot;.', &nbsp;</div></li><li><div>                      'nextgen-facebook' ), 'admin', $action_name ) );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $_SERVER['REQUEST_URI'] = remove_query_arg( array( $action_query, NGFB_NONCE ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  switch ( $action_name ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      case 'check_for_updates':&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $info = $this-&gt;p-&gt;cf['plugin']['ngfb'];&nbsp;</div></li><li><div>                          $um_info = $this-&gt;p-&gt;cf['plugin']['ngfbum'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( SucomUtil::active_plugins( $um_info['base'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// refresh the readme for all extensions</span>&nbsp;</div></li><li><div>                              foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>                                  $this-&gt;get_readme_info( $ext, false );    <span class="comment"><span class="comment">// $use_cache = false</span></span>&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              $ngfbum =& NgfbUm::get_instance();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ( isset( $ngfbum-&gt;update ) ) {    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                                   * Check for updates for all extensions, show a notice for success or failure, </span>&nbsp;</div></li><li><div><span class="comment">                                   * and don't use cached update data from the options table (fetch new update json).</span>&nbsp;</div></li><li><div><span class="comment">                                   */</span>&nbsp;</div></li><li><div>                                  $ngfbum-&gt;update-&gt;check_for_updates( null, true, false );    <span class="comment"><span class="comment">// $use_cache = false</span></span>&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;p-&gt;notice-&gt;err( sprintf( __( 'The &lt;b&gt;%2$s&lt;/b&gt; extension is not initialized properly. Please make sure you are using the latest versions of %1$s and %2$s.', 'nextgen-facebook' ), $info['name'], $um_info['name'] ) );&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;p-&gt;notice-&gt;err( sprintf( __( 'The &lt;b&gt;%1$s&lt;/b&gt; extension must be active in order to check for Pro version updates.', 'nextgen-facebook' ), $um_info['name'] ) );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      case 'clear_all_cache':&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;util-&gt;clear_all_cache( true );    <span class="comment">// $clear_ext = true</span>&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      case 'clear_metabox_prefs':&nbsp;</div></li><li><div>                          $user_id = get_current_user_id();&nbsp;</div></li><li><div>                          $user = get_userdata( $user_id );&nbsp;</div></li><li><div>                          $user_name = $user-&gt;display_name;&nbsp;</div></li><li><div>                          NgfbUser::delete_metabox_prefs( $user_id );&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;notice-&gt;upd( sprintf( __( 'Metabox layout preferences for user ID #%d &quot;%s&quot; have been reset.', &nbsp;</div></li><li><div>                              'nextgen-facebook' ), $user_id, $user_name ) );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      case 'clear_hidden_notices':&nbsp;</div></li><li><div>                          $user_id = get_current_user_id();&nbsp;</div></li><li><div>                          $user = get_userdata( $user_id );&nbsp;</div></li><li><div>                          <span class="comment">//$user_name = trim( $user-&gt;first_name.' '.$user-&gt;last_name );</span>&nbsp;</div></li><li><div>                          $user_name = $user-&gt;display_name;&nbsp;</div></li><li><div>                          delete_user_option( $user_id, NGFB_DISMISS_NAME );&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;notice-&gt;upd( sprintf( __( 'Hidden notices for user ID #%d &quot;%s&quot; have been cleared.', &nbsp;</div></li><li><div>                              'nextgen-facebook' ), $user_id, $user_name ) );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      case 'change_show_options':&nbsp;</div></li><li><div>                          if ( isset( $this-&gt;p-&gt;cf['form']['show_options'][$_GET['show-opts']] ) ) {&nbsp;</div></li><li><div>                              $this-&gt;p-&gt;notice-&gt;upd( sprintf( 'Option preference saved &mdash; viewing &quot;%s&quot; by default.', &nbsp;</div></li><li><div>                                  $this-&gt;p-&gt;cf['form']['show_options'][$_GET['show-opts']] ) );&nbsp;</div></li><li><div>                              NgfbUser::save_pref( array( 'show_opts' =&gt; $_GET['show-opts'] ) );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          $_SERVER['REQUEST_URI'] = remove_query_arg( array( 'show-opts' ) );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      case 'modify_tmpl_head_attributes':&nbsp;</div></li><li><div>                          $this-&gt;modify_tmpl_head_attributes();&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      case 'reload_default_sizes':&nbsp;</div></li><li><div>                          $opts =& $this-&gt;p-&gt;options;    <span class="comment">// update the existing options array</span>&nbsp;</div></li><li><div>                          $def_opts = $this-&gt;p-&gt;opt-&gt;get_defaults();&nbsp;</div></li><li><div>                          $img_opts = SucomUtil::preg_grep_keys( '/_img_(width|height|crop|crop_x|crop_y)$/', $def_opts );&nbsp;</div></li><li><div>                          $opts = array_merge( $this-&gt;p-&gt;options, $img_opts );&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;opt-&gt;save_options( NGFB_OPTIONS_NAME, $opts, false );&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;notice-&gt;upd( __( 'All image dimensions have been reloaded with their default value and saved.', &nbsp;</div></li><li><div>                              'nextgen-facebook' ) );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      default:&nbsp;</div></li><li><div>                          do_action( $lca.'_load_setting_page_'.$action_name, &nbsp;</div></li><li><div>                              $this-&gt;pagehook, $this-&gt;menu_id, $this-&gt;menu_name, $this-&gt;menu_lib );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;add_plugin_hooks();&nbsp;</div></li><li><div>          $this-&gt;add_meta_boxes();&nbsp;</div></li><li><div>          $this-&gt;add_side_meta_boxes();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function add_side_meta_boxes() {&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          if ( ! self::$pkg[$lca]['aop'] ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_meta_box( $this-&gt;pagehook.'_purchase_pro', &nbsp;</div></li><li><div>                  _x( 'Pro Version Available', 'metabox title', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                      array( &$this, 'show_metabox_purchase_pro' ), $this-&gt;pagehook, 'side_fixed' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_meta_box( $this-&gt;pagehook.'_about_free', &nbsp;</div></li><li><div>                  _x( 'About the Free Version', 'metabox title', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                      array( &$this, 'show_metabox_about_free' ), $this-&gt;pagehook, 'side' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_meta_box( $this-&gt;pagehook.'_install_pro', &nbsp;</div></li><li><div>                  _x( 'Updating to Pro is Easy', 'metabox title', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                      array( &$this, 'show_metabox_install_pro' ), $this-&gt;pagehook, 'side' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              NgfbUser::reset_metabox_prefs( $this-&gt;pagehook, array( 'purchase_pro' ), '', '', true );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function add_plugin_hooks() {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// method is extended by each submenu page</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function add_meta_boxes() {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// method is extended by each submenu page</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function show_setting_page() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $this-&gt;is_setting() ) {&nbsp;</div></li><li><div>              settings_errors( NGFB_OPTIONS_NAME );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $menu_ext = $this-&gt;menu_ext;    <span class="comment"><span class="comment"><span class="comment"><span class="comment">// lowercase acronyn for plugin or extension</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $menu_ext ) ) {&nbsp;</div></li><li><div>              $menu_ext = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// set the form for side boxes and show_form_content()</span>&nbsp;</div></li><li><div>          $this-&gt;set_form_object( $menu_ext );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;div class=&quot;wrap&quot; id=&quot;'.$this-&gt;pagehook.'&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>          echo '&lt;h1&gt;'.self::$pkg[$this-&gt;menu_ext]['short'].' &ndash; '.$this-&gt;menu_name.'&lt;/h1&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! self::$pkg[$lca]['aop'] ) {&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;poststuff&quot; class=&quot;metabox-holder has-right-sidebar&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;side-info-column&quot; class=&quot;inner-sidebar&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              do_meta_boxes( $this-&gt;pagehook, 'side_fixed', null );&nbsp;</div></li><li><div>              do_meta_boxes( $this-&gt;pagehook, 'side', null );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/div&gt;&lt;!-- #side-info-column --&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;post-body&quot; class=&quot;has-sidebar&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;post-body-content&quot; class=&quot;has-sidebar-content&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;poststuff&quot; class=&quot;metabox-holder no-right-sidebar&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;post-body&quot; class=&quot;no-sidebar&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;post-body-content&quot; class=&quot;no-sidebar-content&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;show_form_content(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      &lt;/div&gt;&lt;!-- #post-body-content --&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&lt;!-- #post-body --&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&lt;!-- #poststuff --&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&lt;!-- .wrap --&gt;&nbsp;</div></li><li><div>          &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>              <span class="comment">//&lt;![CDATA[</span>&nbsp;</div></li><li><div>              jQuery(document).ready(&nbsp;</div></li><li><div>                  function($) {&nbsp;</div></li><li><div>                      <span class="comment">// close postboxes that should be closed</span>&nbsp;</div></li><li><div>                      $('.if-js-closed').removeClass('if-js-closed').addClass('closed');&nbsp;</div></li><li><div>                      <span class="comment">// postboxes setup</span>&nbsp;</div></li><li><div>                      postboxes.add_postbox_toggles('&lt;?php echo $this-&gt;pagehook; ?&gt;');&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              <span class="comment">//]]&gt;</span>&nbsp;</div></li><li><div>          &lt;/script&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function profile_updated_redirect( $url, $status ) {&nbsp;</div></li><li><div>          if ( strpos( $url, 'updated=' ) !== false && strpos( $url, 'wp_http_referer=' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// match wordpress behavior (users page for admins, profile page for everyone else)</span></span></span>&nbsp;</div></li><li><div>              $menu_lib = current_user_can( 'list_users' ) ? 'users' : 'profile';&nbsp;</div></li><li><div>              $parent_slug = $this-&gt;p-&gt;cf['wp']['admin'][$menu_lib]['page'];&nbsp;</div></li><li><div>              $referer_match = '/'.$parent_slug.'?page='.$this-&gt;p-&gt;cf['lca'].'-';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              parse_str( parse_url( $url, PHP_URL_QUERY ), $parts );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( strpos( $parts['wp_http_referer'], $referer_match ) ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;upd( __( 'Profile updated.' ) );    <span class="comment"><span class="comment"><span class="comment">// green</span> status w check mark</span></span>&nbsp;</div></li><li><div>                  $url = add_query_arg( 'updated', true, $parts['wp_http_referer'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $url;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function show_form_content() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;menu_lib === 'profile' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $user_id = get_current_user_id();&nbsp;</div></li><li><div>              $profileuser = get_user_to_edit( $user_id );&nbsp;</div></li><li><div>              $current_color = get_user_option( 'admin_color', $user_id );&nbsp;</div></li><li><div>              if ( empty( $current_color ) )&nbsp;</div></li><li><div>                  $current_color = 'fresh';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">// match wordpress behavior (users page for admins, profile page for everyone else)</span></span></span>&nbsp;</div></li><li><div>              $admin_url = current_user_can( 'list_users' ) ?&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;util-&gt;get_admin_url( $this-&gt;menu_id, null, 'users' ) :&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;util-&gt;get_admin_url( $this-&gt;menu_id, null, $this-&gt;menu_lib );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;form name=&quot;'.$lca.'&quot; id=&quot;'.$lca.'_setting_form&quot; action=&quot;user-edit.php&quot; method=&quot;post&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;wp_http_referer&quot; value=&quot;'.$admin_url.'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;update&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;user_id&quot; value=&quot;'.$user_id.'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;nickname&quot; value=&quot;'.$profileuser-&gt;nickname.'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;email&quot; value=&quot;'.$profileuser-&gt;user_email.'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;admin_color&quot; value=&quot;'.$current_color.'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;rich_editing&quot; value=&quot;'.$profileuser-&gt;rich_editing.'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;comment_shortcuts&quot; value=&quot;'.$profileuser-&gt;comment_shortcuts.'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;admin_bar_front&quot; value=&quot;'._get_admin_bar_pref( 'front', $user_id ).'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              wp_nonce_field( 'update-user_'.$user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( $this-&gt;menu_lib === 'setting' || $this-&gt;menu_lib === 'submenu' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;form name=&quot;'.$lca.'&quot; id=&quot;'.$lca.'_setting_form&quot; action=&quot;options.php&quot; method=&quot;post&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              settings_fields( $lca.'_setting' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( $this-&gt;menu_lib === 'sitesubmenu' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;form name=&quot;'.$lca.'&quot; id=&quot;'.$lca.'_setting_form&quot; action=&quot;edit.php?action='.&nbsp;</div></li><li><div>                  NGFB_SITE_OPTIONS_NAME.'&quot; method=&quot;post&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo '&lt;input type=&quot;hidden&quot; name=&quot;page&quot; value=&quot;'.$this-&gt;menu_id.'&quot; /&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_nonce_field( NgfbAdmin::get_nonce(), NGFB_NONCE );    <span class="comment"><span class="comment"><span class="comment">// NGFB_NONCE is an md5() string</span></span></span>&nbsp;</div></li><li><div>          wp_nonce_field( 'closedpostboxes', 'closedpostboxesnonce', false );&nbsp;</div></li><li><div>          wp_nonce_field( 'meta-box-order', 'meta-box-order-nonce', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          do_meta_boxes( $this-&gt;pagehook, 'normal', null );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          do_action( $this-&gt;p-&gt;cf['lca'].'_form_content_metaboxes_'.&nbsp;</div></li><li><div>              SucomUtil::sanitize_hookname( $this-&gt;menu_id ), $this-&gt;pagehook );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;menu_lib === 'profile' ) {&nbsp;</div></li><li><div>              echo $this-&gt;get_submit_buttons( _x( 'Save All Profile Settings', &nbsp;</div></li><li><div>                  'submit button', 'nextgen-facebook' ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              echo $this-&gt;get_submit_buttons();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;/form&gt;', &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function get_submit_buttons( $submit_label = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $submit_label ) ) {&nbsp;</div></li><li><div>              $submit_label = _x( 'Save All Plugin Settings', 'submit button', 'nextgen-facebook' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $view_next = SucomUtil::next_key( NgfbUser::show_opts(), $this-&gt;p-&gt;cf['form']['show_options'] );&nbsp;</div></li><li><div>          $view_name = _x( $this-&gt;p-&gt;cf['form']['show_options'][$view_next], 'option value', 'nextgen-facebook' );&nbsp;</div></li><li><div>          $view_label = sprintf( _x( 'View %s by Default', 'submit button', 'nextgen-facebook' ), $view_name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_multisite() ) {&nbsp;</div></li><li><div>              $clear_label = sprintf( _x( 'Clear All Caches for Site %d', &nbsp;</div></li><li><div>                  'submit button', 'nextgen-facebook' ), get_current_blog_id() );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $clear_label = _x( 'Clear All Caches', &nbsp;</div></li><li><div>                  'submit button', 'nextgen-facebook' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $action_buttons = apply_filters( $lca.'_action_buttons', array(&nbsp;</div></li><li><div>              array(&nbsp;</div></li><li><div>                  'submit' =&gt; $submit_label, &nbsp;</div></li><li><div>                  'change_show_options&show-opts='.$view_next =&gt; $view_label, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              array(&nbsp;</div></li><li><div>                  'clear_all_cache' =&gt; $clear_label, &nbsp;</div></li><li><div>                  'clear_metabox_prefs' =&gt; _x( 'Reset Metabox Layout', 'submit button', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                  'clear_hidden_notices' =&gt; _x( 'Reset Hidden Notices', 'submit button', 'nextgen-facebook' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), $this-&gt;menu_id, $this-&gt;menu_name, $this-&gt;menu_lib );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $submit_buttons = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $action_buttons as $row =&gt; $row_buttons ) {&nbsp;</div></li><li><div>              $css_class = $row ?&nbsp;</div></li><li><div>                  'button-secondary' :&nbsp;</div></li><li><div>                  'button-secondary button-highlight';    <span class="comment">// highlight the first row</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( $row_buttons as $action_arg =&gt; $button_label ) {&nbsp;</div></li><li><div>                  if ( $action_arg === 'submit' ) {&nbsp;</div></li><li><div>                      $submit_buttons .= '&lt;input type=&quot;'.$action_arg.'&quot; class=&quot;button-primary&quot; value=&quot;'.$button_label.'&quot; /&gt;';&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $button_url = wp_nonce_url( $this-&gt;p-&gt;util-&gt;get_admin_url( '?'.$lca.'-action='.$action_arg ), &nbsp;</div></li><li><div>                          NgfbAdmin::get_nonce(), NGFB_NONCE );&nbsp;</div></li><li><div>                      $submit_buttons .= $this-&gt;form-&gt;get_button( $button_label, $css_class, '', $button_url );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $submit_buttons .= '&lt;br/&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return '&lt;div class=&quot;submit-buttons&quot;&gt;'.$submit_buttons.'&lt;/div&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function show_metabox_version_info() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;table class=&quot;sucom-settings '.$lca.' column-metabox version-info&quot; style=&quot;table-layout:fixed;&quot;&gt;';&nbsp;</div></li><li><div>          echo '&lt;colgroup&gt;&lt;col style=&quot;width:70px;&quot;/&gt;&lt;col/&gt;&lt;/colgroup&gt;';    <span class="comment">// required for chrome to display fixed table layout</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( empty( $info['version'] ) ) {    <span class="comment">// only active extensions</span>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $installed_version = $info['version'];    <span class="comment">// static value from config</span>&nbsp;</div></li><li><div>              $installed_style = '';&nbsp;</div></li><li><div>              $stable_version = __( 'Not Available', 'nextgen-facebook' );    <span class="comment"><span class="comment">// default value</span></span>&nbsp;</div></li><li><div>              $latest_version = __( 'Not Available', 'nextgen-facebook' );    <span class="comment"><span class="comment">// default value</span></span>&nbsp;</div></li><li><div>              $latest_notice = '';&nbsp;</div></li><li><div>              $changelog_url = $info['url']['changelog'];&nbsp;</div></li><li><div>              $readme_info = $this-&gt;get_readme_info( $ext, true );    <span class="comment">// $use_cache = true</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $readme_info['stable_tag'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $stable_version = $readme_info['stable_tag'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( is_array( $readme_info['upgrade_notice'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// hooked by the update manager to apply the version filter</span>&nbsp;</div></li><li><div>                      $upgrade_notice = apply_filters( $lca.'_readme_upgrade_notices', &nbsp;</div></li><li><div>                          $readme_info['upgrade_notice'], $ext );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      reset( $upgrade_notice );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $latest_version = key( $upgrade_notice );&nbsp;</div></li><li><div>                      $latest_notice = $upgrade_notice[$latest_version];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// hooked by the update manager to check installed version against</span>&nbsp;</div></li><li><div>                  <span class="comment">// the latest version, if a non-stable filter is selected for that</span>&nbsp;</div></li><li><div>                  <span class="comment">// plugin / extension</span>&nbsp;</div></li><li><div>                  if ( apply_filters( $lca.'_newer_version_available', &nbsp;</div></li><li><div>                      version_compare( $installed_version, $stable_version, '&lt;' ), &nbsp;</div></li><li><div>                          $ext, $installed_version, $stable_version, $latest_version ) ) {&nbsp;</div></li><li><div>                      $installed_style = 'style=&quot;background-color:#f00;&quot;';    <span class="comment">// red</span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// version is current</span> but not stable (alpha characters found in version string)</span>&nbsp;</div></li><li><div>                  } elseif ( preg_match( '/[a-z]/', $installed_version ) ) {&nbsp;</div></li><li><div>                      $installed_style = 'style=&quot;background-color:#ff0;&quot;';    <span class="comment">// yellow</span>&nbsp;</div></li><li><div>                  <span class="comment">// version is current</span>&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $installed_style = 'style=&quot;background-color:#0f0;&quot;';    <span class="comment">// green</span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;&lt;h4&gt;'.self::$pkg[$ext]['short'].'&lt;/h4&gt;&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;tr&gt;&lt;th class=&quot;version-label&quot;&gt;'._x( 'Installed', 'option label', 'nextgen-facebook' ).':&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;td class=&quot;version-number&quot; '.$installed_style.'&gt;'.$installed_version.'&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;tr&gt;&lt;th class=&quot;version-label&quot;&gt;'._x( 'Stable', 'option label', 'nextgen-facebook' ).':&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;td class=&quot;version-number&quot;&gt;'.$stable_version.'&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;tr&gt;&lt;th class=&quot;version-label&quot;&gt;'._x( 'Latest', 'option label', 'nextgen-facebook' ).':&lt;/th&gt;&nbsp;</div></li><li><div>                  &lt;td class=&quot;version-number&quot;&gt;'.$latest_version.'&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;tr&gt;&lt;td colspan=&quot;2&quot; class=&quot;latest-notice&quot;&gt;'.&nbsp;</div></li><li><div>                  '&lt;p&gt;&lt;em&gt;&lt;strong&gt;Version '.$latest_version.'&lt;/strong&gt; '.$latest_notice.'&lt;/em&gt;&lt;/p&gt;'.&nbsp;</div></li><li><div>                  '&lt;p&gt;&lt;a href=&quot;'.$changelog_url.'&quot; target=&quot;_blank&quot;&gt;'.&nbsp;</div></li><li><div>                      sprintf( __( 'View %s changelog...', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                          $info['short'] ).'&lt;/a&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;avail['p_ext']['um'] ) ) {    <span class="comment"><span class="comment">// since um v1.6.0</span></span>&nbsp;</div></li><li><div>              echo '&lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>              echo $this-&gt;form-&gt;get_button( _x( 'Check for Updates', 'submit button', 'nextgen-facebook' ), 'button-secondary', &nbsp;</div></li><li><div>                  'column-check-for-updates', wp_nonce_url( $this-&gt;p-&gt;util-&gt;get_admin_url( '?'.$lca.'-action=check_for_updates' ), &nbsp;</div></li><li><div>                      NgfbAdmin::get_nonce(), NGFB_NONCE ) );&nbsp;</div></li><li><div>              echo '&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;/table&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function show_metabox_status_gpl() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $ext_num = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;table class=&quot;sucom-settings '.$lca.' column-metabox module-status&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * GPL version features</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! isset( $info['lib']['gpl'] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $ext_num++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $ext === $lca ) {    <span class="comment">// features for this plugin</span>&nbsp;</div></li><li><div>                  $features = array(&nbsp;</div></li><li><div>                      '(tool) Debug Logging Enabled' =&gt; array(&nbsp;</div></li><li><div>                          'classname' =&gt; 'SucomDebug', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      '(code) Facebook / Open Graph Meta Tags' =&gt; array(&nbsp;</div></li><li><div>                          'status' =&gt; class_exists( $lca.'opengraph' ) ? 'on' : 'rec', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      '(code) Google Author / Person Markup' =&gt; array(&nbsp;</div></li><li><div>                          'status' =&gt; $this-&gt;p-&gt;options['schema_person_json'] ? 'on' : 'off', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      '(code) Google Publisher / Organization Markup' =&gt; array(&nbsp;</div></li><li><div>                          'status' =&gt; $this-&gt;p-&gt;options['schema_organization_json'] ? 'on' : 'off', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      '(code) Google Website Markup' =&gt; array(&nbsp;</div></li><li><div>                          'status' =&gt; $this-&gt;p-&gt;options['schema_website_json'] ? 'on' : 'rec', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      '(code) Schema Meta Property Containers' =&gt; array(&nbsp;</div></li><li><div>                          'status' =&gt; apply_filters( $lca.'_add_schema_noscript_array', &nbsp;</div></li><li><div>                              $this-&gt;p-&gt;options['schema_add_noscript'] ) ? 'on' : 'off', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      '(code) Twitter Card Meta Tags' =&gt; array(&nbsp;</div></li><li><div>                          'status' =&gt; class_exists( $lca.'twittercard' ) ? 'on' : 'rec', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $features = array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              self::$pkg[$ext]['purchase'] = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $features = apply_filters( $ext.'_status_gpl_features', $features, $ext, $info, self::$pkg[$ext] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $features ) ) {&nbsp;</div></li><li><div>                  echo '&lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;&lt;h4'.( $ext_num &gt; 1 ? ' style=&quot;margin-top:10px;&quot;' : '' ).'&gt;'.&nbsp;</div></li><li><div>                      $info['short'].'&lt;/h4&gt;&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>                  $this-&gt;show_plugin_status( $ext, $info, $features );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;/table&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function show_metabox_status_pro() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $ext_num = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;table class=&quot;sucom-settings '.$lca.' column-metabox module-status&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Pro version features</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! isset( $info['lib']['pro'] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $ext_num++;&nbsp;</div></li><li><div>              $features = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              self::$pkg[$ext]['purchase'] = empty( $info['url']['purchase'] ) ?&nbsp;</div></li><li><div>                  '' : add_query_arg( 'utm_source', 'status-pro-feature', $info['url']['purchase'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              foreach ( $info['lib']['pro'] as $sub =&gt; $libs ) {&nbsp;</div></li><li><div>                  if ( $sub === 'admin' )    <span class="comment">// skip status for admin menus and tabs</span>&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  foreach ( $libs as $id_key =&gt; $label ) {&nbsp;</div></li><li><div>                      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                       * Example:</span>&nbsp;</div></li><li><div><span class="comment">                       *    'article' =&gt; 'Item Type Article', </span>&nbsp;</div></li><li><div><span class="comment">                       *    'article#news:no_load' =&gt; 'Item Type NewsArticle', </span>&nbsp;</div></li><li><div><span class="comment">                       *    'article#tech:no_load' =&gt; 'Item Type TechArticle', </span>&nbsp;</div></li><li><div><span class="comment">                       */</span>&nbsp;</div></li><li><div>                      list( $id, $stub, $action ) = SucomUtil::get_lib_stub_action( $id_key );&nbsp;</div></li><li><div>                      $classname = SucomUtil::sanitize_classname( $ext.'pro'.$sub.$id, false );    <span class="comment">// $underscore = false</span>&nbsp;</div></li><li><div>                      $status_off = $this-&gt;p-&gt;avail[$sub][$id] ? 'rec' : 'off';&nbsp;</div></li><li><div>                      $features[$label] = array(&nbsp;</div></li><li><div>                          'td_class' =&gt; self::$pkg[$ext]['aop'] ? '' : 'blank', &nbsp;</div></li><li><div>                          'purchase' =&gt; self::$pkg[$ext]['purchase'], &nbsp;</div></li><li><div>                          'status' =&gt; class_exists( $classname ) ?&nbsp;</div></li><li><div>                              ( self::$pkg[$ext]['aop'] ?&nbsp;</div></li><li><div>                                  'on' : $status_off ) : $status_off, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $features = apply_filters( $ext.'_status_pro_features', $features, $ext, $info, self::$pkg[$ext] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $features ) ) {&nbsp;</div></li><li><div>                  echo '&lt;tr&gt;&lt;td colspan=&quot;3&quot;&gt;&lt;h4'.( $ext_num &gt; 1 ? ' style=&quot;margin-top:10px;&quot;' : '' ).'&gt;'.&nbsp;</div></li><li><div>                      $info['short'].'&lt;/h4&gt;&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>                  $this-&gt;show_plugin_status( $ext, $info, $features );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;/table&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private function show_plugin_status( &$ext = '', &$info = array(), &$features = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $status_info = array(&nbsp;</div></li><li><div>              'on' =&gt; array(&nbsp;</div></li><li><div>                  'img' =&gt; 'green-circle.png', &nbsp;</div></li><li><div>                  'title' =&gt; __( 'Module is enabled', 'nextgen-facebook' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'off' =&gt; array(&nbsp;</div></li><li><div>                  'img' =&gt; 'gray-circle.png', &nbsp;</div></li><li><div>                  'title' =&gt; __( 'Module is disabled / not loaded', 'nextgen-facebook' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'rec' =&gt; array(&nbsp;</div></li><li><div>                  'img' =&gt; 'red-circle.png', &nbsp;</div></li><li><div>                  'title' =&gt; __( 'Module recommended but disabled / not available', 'nextgen-facebook' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          uksort( $features, array( __CLASS__, 'sort_plugin_features' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $features as $label =&gt; $arr ) {&nbsp;</div></li><li><div>              if ( isset( $arr['classname'] ) )&nbsp;</div></li><li><div>                  $status_key = class_exists( $arr['classname'] ) ? 'on' : 'off';&nbsp;</div></li><li><div>              elseif ( isset( $arr['constant'] ) )&nbsp;</div></li><li><div>                  $status_key = SucomUtil::get_const( $arr['constant'] ) ? 'on' : 'off';&nbsp;</div></li><li><div>              elseif ( isset( $arr['status'] ) )&nbsp;</div></li><li><div>                  $status_key = $arr['status'];&nbsp;</div></li><li><div>              else $status_key = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $status_key ) ) {&nbsp;</div></li><li><div>                  $td_class = empty( $arr['td_class'] ) ? '' : ' '.$arr['td_class'];&nbsp;</div></li><li><div>                  $icon_type = preg_match( '/^\(([a-z\-]+)\) (.*)/', $label, $match ) ? $match[1] : 'admin-generic';&nbsp;</div></li><li><div>                  $icon_title = __( 'Generic feature module', 'nextgen-facebook' );&nbsp;</div></li><li><div>                  $label_text = empty( $match[2] ) ? $label : $match[2];&nbsp;</div></li><li><div>                  $label_text = empty( $arr['label'] ) ? $label_text : $arr['label'];&nbsp;</div></li><li><div>                  $purchase_url = $status_key === 'rec' && ! empty( $arr['purchase'] ) ? $arr['purchase'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  switch ( $icon_type ) {&nbsp;</div></li><li><div>                      case 'api':&nbsp;</div></li><li><div>                          $icon_type = 'controls-repeat';&nbsp;</div></li><li><div>                          $icon_title = __( 'Service API module', 'nextgen-facebook' );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'code':&nbsp;</div></li><li><div>                          $icon_type = 'editor-code';&nbsp;</div></li><li><div>                          $icon_title = __( 'Meta tag and markup module', 'nextgen-facebook' );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'plugin':&nbsp;</div></li><li><div>                          $icon_type = 'admin-plugins';&nbsp;</div></li><li><div>                          $icon_title = __( 'Plugin integration module', 'nextgen-facebook' );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'sharing':&nbsp;</div></li><li><div>                          $icon_type = 'screenoptions';&nbsp;</div></li><li><div>                          $icon_title = __( 'Sharing functionality module', 'nextgen-facebook' );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'tool':&nbsp;</div></li><li><div>                          $icon_type = 'admin-tools';&nbsp;</div></li><li><div>                          $icon_title = __( 'Additional functionality module', 'nextgen-facebook' );&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  echo '&lt;tr&gt;'.&nbsp;</div></li><li><div>                  '&lt;td&gt;&lt;span class=&quot;dashicons dashicons-'.$icon_type.'&quot; title=&quot;'.$icon_title.'&quot;&gt;&lt;/span&gt;&lt;/td&gt;'.&nbsp;</div></li><li><div>                  '&lt;td class=&quot;'.trim( $td_class ).'&quot;&gt;'.$label_text.'&lt;/td&gt;'.&nbsp;</div></li><li><div>                  '&lt;td&gt;'.&nbsp;</div></li><li><div>                      ( $purchase_url ? '&lt;a href=&quot;'.$purchase_url.'&quot; target=&quot;_blank&quot;&gt;' : '' ).&nbsp;</div></li><li><div>                      '&lt;img src=&quot;'.NGFB_URLPATH.'images/'.&nbsp;</div></li><li><div>                          $status_info[$status_key]['img'].'&quot; width=&quot;12&quot; height=&quot;12&quot; title=&quot;'.&nbsp;</div></li><li><div>                          $status_info[$status_key]['title'].'&quot;/&gt;'.&nbsp;</div></li><li><div>                      ( $purchase_url ? '&lt;/a&gt;' : '' ).&nbsp;</div></li><li><div>                  '&lt;/td&gt;'.&nbsp;</div></li><li><div>                  '&lt;/tr&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private static function sort_plugin_features( $feature_a, $feature_b ) {&nbsp;</div></li><li><div>          return strcasecmp( self::feature_priority( $feature_a ), &nbsp;</div></li><li><div>              self::feature_priority( $feature_b ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private static function feature_priority( $feature ) {&nbsp;</div></li><li><div>          if ( strpos( $feature, '(tool)' ) === 0 )&nbsp;</div></li><li><div>              return '(10) '.$feature;&nbsp;</div></li><li><div>          else return $feature;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function show_metabox_about_free() {&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          echo '&lt;table class=&quot;sucom-settings '.$lca.' column-metabox&quot;&gt;&lt;tr&gt;&lt;td&gt;';&nbsp;</div></li><li><div>          echo '&lt;div class=&quot;column-metabox-icon&quot;&gt;';&nbsp;</div></li><li><div>          echo $this-&gt;get_ext_img_icon( $lca );&nbsp;</div></li><li><div>          echo '&lt;/div&gt;';&nbsp;</div></li><li><div>          echo '&lt;div class=&quot;column-metabox-content&quot;&gt;';&nbsp;</div></li><li><div>          echo $this-&gt;p-&gt;msgs-&gt;get( 'column-about-free' );&nbsp;</div></li><li><div>          echo '&lt;/div&gt;';&nbsp;</div></li><li><div>          echo '&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function show_metabox_purchase_pro() {&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $info =& $this-&gt;p-&gt;cf['plugin'][$lca];&nbsp;</div></li><li><div>          $purchase_url = empty( $info['url']['purchase'] ) ?&nbsp;</div></li><li><div>              '' : add_query_arg( 'utm_source', 'column-purchase-pro', $info['url']['purchase'] );&nbsp;</div></li><li><div>          echo '&lt;table class=&quot;sucom-settings '.$lca.' column-metabox&quot;&gt;&lt;tr&gt;&lt;td&gt;';&nbsp;</div></li><li><div>          echo '&lt;div class=&quot;column-metabox-content has-buttons&quot;&gt;';&nbsp;</div></li><li><div>          echo $this-&gt;p-&gt;msgs-&gt;get( 'column-purchase-pro' );&nbsp;</div></li><li><div>          echo '&lt;/div&gt;';&nbsp;</div></li><li><div>          echo '&lt;div class=&quot;column-metabox-buttons&quot;&gt;';&nbsp;</div></li><li><div>          echo $this-&gt;form-&gt;get_button( _x( 'Purchase Pro Version', 'plugin action link', 'nextgen-facebook' ), &nbsp;</div></li><li><div>              'button-primary', 'column-purchase-pro', $purchase_url, true );&nbsp;</div></li><li><div>          echo '&lt;/div&gt;';&nbsp;</div></li><li><div>          echo '&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function show_metabox_install_pro() {&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          echo '&lt;table class=&quot;sucom-settings '.$lca.' column-metabox&quot;&gt;&lt;tr&gt;&lt;td&gt;';&nbsp;</div></li><li><div>          echo '&lt;div class=&quot;column-metabox-content&quot;&gt;';&nbsp;</div></li><li><div>          echo $this-&gt;p-&gt;msgs-&gt;get( 'column-install-pro' );&nbsp;</div></li><li><div>          echo '&lt;/div&gt;';&nbsp;</div></li><li><div>          echo '&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function show_metabox_help_support() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          echo '&lt;table class=&quot;sucom-settings '.$lca.' column-metabox&quot;&gt;&lt;tr&gt;&lt;td&gt;';&nbsp;</div></li><li><div>          $this-&gt;show_follow_icons();&nbsp;</div></li><li><div>          echo $this-&gt;p-&gt;msgs-&gt;get( 'column-help-support' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( empty( $info['version'] ) ) {    <span class="comment"><span class="comment">// filter out extensions that are not installed</span></span>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $links = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $info['url']['faqs'] ) ) {&nbsp;</div></li><li><div>                  $links[] = sprintf( __( 'Read the &lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;Frequently Asked Questions&lt;/a&gt;', &nbsp;</div></li><li><div>                      'nextgen-facebook' ), $info['url']['faqs'] ).( ! empty( $info['url']['notes'] ) ?&nbsp;</div></li><li><div>                          ' '.sprintf( __( 'and &lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;Other Notes&lt;/a&gt;', &nbsp;</div></li><li><div>                              'nextgen-facebook' ), $info['url']['notes'] ) : '' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $info['url']['support'] ) && self::$pkg[$ext]['aop'] ) {&nbsp;</div></li><li><div>                  $links[] = sprintf( __( 'Open a &lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;Priority Support Ticket&lt;/a&gt;', &nbsp;</div></li><li><div>                      'nextgen-facebook' ), $info['url']['support'] ).' ('.__( 'Pro version', 'nextgen-facebook' ).')';&nbsp;</div></li><li><div>              } elseif ( ! empty( $info['url']['forum'] ) ) {&nbsp;</div></li><li><div>                  $links[] = sprintf( __( 'Post in the &lt;a href=&quot;%s&quot; target=&quot;_blank&quot;&gt;Community Support Forum&lt;/a&gt;', &nbsp;</div></li><li><div>                      'nextgen-facebook' ), $info['url']['forum'] ).' ('.__( 'Free version', 'nextgen-facebook' ).')';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $links ) ) {&nbsp;</div></li><li><div>                  echo '&lt;h4&gt;'.$info['short'].'&lt;/h4&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>                  echo '&lt;ul&gt;&lt;li&gt;'.implode( '&lt;/li&gt;&lt;li&gt;', $links ).'&lt;/li&gt;&lt;/ul&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function show_metabox_rate_review() {&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          echo '&lt;table class=&quot;sucom-settings '.$lca.' column-metabox&quot;&gt;&lt;tr&gt;&lt;td&gt;';&nbsp;</div></li><li><div>          echo $this-&gt;p-&gt;msgs-&gt;get( 'column-rate-review' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>              if ( empty( $info['version'] ) ) {    <span class="comment"><span class="comment">// filter out extensions that are not installed</span></span>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $links = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $info['url']['review'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $rate_stars = '&lt;span class=&quot;ngfb-rate-stars&quot;&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>                  $plugin_name = '&lt;em&gt;'.$info['name'].'&lt;/em&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $links[] = '&lt;a href=&quot;'.$info['url']['review'].'&quot; target=&quot;_blank&quot;&gt;'.&nbsp;</div></li><li><div>                      sprintf( __( 'Rate %1$s the %2$s plugin.', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                          $rate_stars, $plugin_name ).'&lt;/a&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $links ) ) {&nbsp;</div></li><li><div>                  echo '&lt;ul&gt;&lt;li&gt;'.implode( '&lt;/li&gt;&lt;li&gt;', $links ).'&lt;/li&gt;&lt;/ul&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function show_follow_icons() {&nbsp;</div></li><li><div>          echo '&lt;div class=&quot;follow-icons&quot;&gt;';&nbsp;</div></li><li><div>          $img_size = $this-&gt;p-&gt;cf['follow']['size'];&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['follow']['src'] as $img_rel =&gt; $url ) {&nbsp;</div></li><li><div>              echo '&lt;a href=&quot;'.$url.'&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;'.NGFB_URLPATH.$img_rel.'&quot;&nbsp;</div></li><li><div>                  width=&quot;'.$img_size.'&quot; height=&quot;'.$img_size.'&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;/div&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public static function get_nonce() {&nbsp;</div></li><li><div>          return __FILE__.'::'.&nbsp;</div></li><li><div>              SucomUtil::get_const( 'NONCE_KEY' ).'::'.&nbsp;</div></li><li><div>              SucomUtil::get_const( 'NONCE_SALT' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private function is_profile( $menu_id = false ) {&nbsp;</div></li><li><div>          return $this-&gt;is_lib( 'profile', $menu_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private function is_setting( $menu_id = false ) {&nbsp;</div></li><li><div>          return $this-&gt;is_lib( 'setting', $menu_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private function is_submenu( $menu_id = false ) {&nbsp;</div></li><li><div>          return $this-&gt;is_lib( 'submenu', $menu_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private function is_sitesubmenu( $menu_id = false ) {&nbsp;</div></li><li><div>          return $this-&gt;is_lib( 'sitesubmenu', $menu_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      private function is_lib( $lib_name, $menu_id = false ) {&nbsp;</div></li><li><div>          if ( $menu_id === false ) {&nbsp;</div></li><li><div>              $menu_id = $this-&gt;menu_id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return isset( $this-&gt;p-&gt;cf['*']['lib'][$lib_name][$menu_id] ) ? true : false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function licenses_metabox_content( $network = false ) {&nbsp;</div></li><li><div>          $num = 0;&nbsp;</div></li><li><div>          $tabindex = 0;&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $total = count( $this-&gt;p-&gt;cf['plugin'] );&nbsp;</div></li><li><div>          $row_span = $network ? 4 : 3;&nbsp;</div></li><li><div>          $col_span = $network ? 2 : 3;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;table class=&quot;sucom-settings '.$lca.' licenses-metabox&quot;&nbsp;</div></li><li><div>              style=&quot;padding-bottom:10px&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;tr&gt;&lt;td colspan=&quot;'.( $col_span + 1 ).'&quot;&gt;'.&nbsp;</div></li><li><div>              $this-&gt;p-&gt;msgs-&gt;get( 'info-plugin-tid'.( $network ? '-network' : '' ) ).&nbsp;</div></li><li><div>                  '&lt;/td&gt;&lt;/tr&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( NgfbConfig::get_ext_sorted( true ) as $ext =&gt; $info ) {&nbsp;</div></li><li><div>              $num++;&nbsp;</div></li><li><div>              $links = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $info['base'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $details_url = add_query_arg( array(&nbsp;</div></li><li><div>                      'tab' =&gt; 'plugin-information', &nbsp;</div></li><li><div>                      'plugin' =&gt; $info['slug'], &nbsp;</div></li><li><div>                      'TB_iframe' =&gt; 'true', &nbsp;</div></li><li><div>                      'width' =&gt; $this-&gt;p-&gt;cf['wp']['tb_iframe']['width'], &nbsp;</div></li><li><div>                      'height' =&gt; $this-&gt;p-&gt;cf['wp']['tb_iframe']['height']&nbsp;</div></li><li><div> ), is_multisite() ?&nbsp;</div></li><li><div>                      network_admin_url( 'plugin-install.php', null ) :&nbsp;</div></li><li><div>                      get_admin_url( null, 'plugin-install.php' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( SucomUtil::installed_plugins( $info['base'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( SucomUtil::plugin_has_update( $info['base'] ) ) {&nbsp;</div></li><li><div>                          $links[] = '&lt;a href=&quot;'.$details_url.'&quot; class=&quot;thickbox&quot; tabindex=&quot;'.++$tabindex.'&quot;&gt;'.&nbsp;</div></li><li><div>                              '&lt;font color=&quot;red&quot;&gt;'._x( 'Plugin Details and Update', 'plugin action link', &nbsp;</div></li><li><div>                                  'nextgen-facebook' ).'&lt;/font&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $links[] = '&lt;a href=&quot;'.$details_url.'&quot; class=&quot;thickbox&quot; tabindex=&quot;'.++$tabindex.'&quot;&gt;'.&nbsp;</div></li><li><div>                              _x( 'Plugin Details', 'plugin action link', 'nextgen-facebook' ).'&lt;/a&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $links[] = '&lt;a href=&quot;'.$details_url.'&quot; class=&quot;thickbox&quot; tabindex=&quot;'.++$tabindex.'&quot;&gt;'.&nbsp;</div></li><li><div>                          _x( 'Plugin Details and Install', 'plugin action link', 'nextgen-facebook' ).'&lt;/a&gt;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              } elseif ( ! empty( $info['url']['home'] ) ) {&nbsp;</div></li><li><div>                  $links[] = '&lt;a href=&quot;'.$info['url']['home'].'&quot; target=&quot;_blank&quot; tabindex=&quot;'.++$tabindex.'&quot;&gt;'.&nbsp;</div></li><li><div>                      _x( 'Plugin Description', 'plugin action link', 'nextgen-facebook' ).'&lt;/a&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $info['base'] ) ) {&nbsp;</div></li><li><div>                  $links = $this-&gt;add_plugin_action_links( $links, $info['base'], 'license-action-links', $tabindex );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// logo image</span>&nbsp;</div></li><li><div>              echo '&lt;tr&gt;&lt;td style=&quot;width:168px; padding:10px 30px 10px 10px; vertical-align:top;&quot;'.&nbsp;</div></li><li><div>                  ' width=&quot;168&quot; rowspan=&quot;'.$row_span.'&quot; valign=&quot;top&quot; align=&quot;left&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              echo $this-&gt;get_ext_img_icon( $ext );&nbsp;</div></li><li><div>              echo '&lt;/td&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// plugin name</span>&nbsp;</div></li><li><div>              echo '&lt;td colspan=&quot;'.$col_span.'&quot; style=&quot;padding:10px 0 0 0; width:100%;&quot;&gt;&lt;p&gt;&lt;strong&gt;'.$info['name'].'&lt;/strong&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $info['desc'] ) ) {&nbsp;</div></li><li><div>                  echo '&lt;p&gt;'._x( $info['desc'], 'plugin description', 'nextgen-facebook' ).'&lt;/p&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $links ) ) {&nbsp;</div></li><li><div>                  echo '&lt;div class=&quot;row-actions visible&quot;&gt;'.implode( ' | ', $links ).'&lt;/div&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/td&gt;&lt;/tr&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $info['update_auth'] ) ||&nbsp;</div></li><li><div>                  ! empty( $this-&gt;p-&gt;options['plugin_'.$ext.'_tid'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  echo '&lt;tr&gt;';&nbsp;</div></li><li><div>                  echo $this-&gt;form-&gt;get_th_html( sprintf( _x( '%s Authentication ID', &nbsp;</div></li><li><div>                      'option label', 'nextgen-facebook' ), $info['short'] ), 'medium nowrap' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( $lca === $ext || self::$pkg[$lca]['aop'] ) {&nbsp;</div></li><li><div>                      echo '&lt;td'.( $network ? ' width=&quot;100%&quot;' : '' ).'&gt;'.&nbsp;</div></li><li><div>                          $this-&gt;form-&gt;get_input( 'plugin_'.$ext.'_tid', &nbsp;</div></li><li><div>                              'tid mono', '', 0, '', false, ++$tabindex ).'&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( $network ) {&nbsp;</div></li><li><div>                          echo '&lt;/tr&gt;&lt;tr&gt;';&nbsp;</div></li><li><div>                          echo self::get_option_site_use( 'plugin_'.$ext.'_tid', &nbsp;</div></li><li><div>                              $this-&gt;form, $network, true );    <span class="comment">// th and td</span>&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $qty_used = class_exists( 'SucomUpdate' ) ?&nbsp;</div></li><li><div>                              SucomUpdate::get_option( $ext, 'qty_used' ) : false;&nbsp;</div></li><li><div>                          echo '&lt;td width=&quot;100%&quot;&gt;&lt;p&gt;'.( empty( $qty_used ) ?&nbsp;</div></li><li><div>                              '' : $qty_used.' Licenses Assigned' ).'&lt;/p&gt;&lt;/td&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      echo '&lt;td class=&quot;blank&quot;&gt;'.( empty( $this-&gt;p-&gt;options['plugin_'.$ext.'_tid'] ) ?&nbsp;</div></li><li><div>                          $this-&gt;form-&gt;get_no_input( 'plugin_'.$ext.'_tid', 'tid mono' ) :&nbsp;</div></li><li><div>                          $this-&gt;form-&gt;get_input( 'plugin_'.$ext.'_tid', &nbsp;</div></li><li><div>                              'tid mono', '', 0, '', false, ++$tabindex ) ).'&lt;/td&gt;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  echo '&lt;/tr&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ( $network ) {&nbsp;</div></li><li><div>                      echo '&lt;tr&gt;&lt;/tr&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>                      echo '&lt;tr&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      echo '&lt;tr&gt;&lt;td&gt;&nbsp;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td width=&quot;100%&quot;&gt;&lt;/td&gt;&lt;/tr&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;tr&gt;&lt;td'.( $num &lt; $total ? ' style=&quot;border-bottom:1px dotted #ddd; height:5px;&quot;' : '' ).&nbsp;</div></li><li><div>                  ' colspan=&quot;'.$col_span.'&quot;&gt;&lt;/td&gt;&lt;/tr&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo '&lt;/table&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function conflict_warnings() {&nbsp;</div></li><li><div>          if ( ! is_admin() )     <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $err_pre =  __( 'Plugin conflict detected', 'nextgen-facebook' ) . ' &mdash; ';&nbsp;</div></li><li><div>          $log_pre = 'plugin conflict detected - ';    <span class="comment">// don't translate the debug</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// PHP</span>&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['php']['extensions'] as $php_ext =&gt; $php_label ) {&nbsp;</div></li><li><div>              if ( ! extension_loaded( $php_ext ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'php '.$php_ext.' extension is not loaded' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( sprintf( __( 'The PHP &lt;a href=&quot;%1$s&quot; target=&quot;_blank&quot;&gt;%2$s extension&lt;/a&gt; is not loaded.', &nbsp;</div></li><li><div>                      'nextgen-facebook' ), 'https:<span class="comment">//secure.php.net/manual/en/book.'.$php_ext.'.php', $php_label ).' '.</span>&nbsp;</div></li><li><div>                  __( 'Please contact your hosting provider to have the missing PHP extension installed and/or enabled.', &nbsp;</div></li><li><div>                      'nextgen-facebook' ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// WordPress</span>&nbsp;</div></li><li><div>          if ( ! get_option( 'blog_public' ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'blog_public option is disabled' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $warn_dis_key = 'wordpress-search-engine-visibility-disabled';&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;notice-&gt;is_admin_pre_notices( $warn_dis_key ) ) {    <span class="comment">// don't bother if already dismissed</span>&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;warn( sprintf( __( 'The WordPress &lt;a href=&quot;%s&quot;&gt;Search Engine Visibility&lt;/a&gt; option is set to discourage search engine and social crawlers from indexing this site. This is not compatible with the purpose of sharing content on social sites &mdash; please uncheck the option to allow search engines and social crawlers to access your content.', 'nextgen-facebook' ), get_admin_url( null, 'options-reading.php' ) ), true, $warn_dis_key, MONTH_IN_SECONDS * 3 );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Yoast SEO</span>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;avail['seo']['wpseo'] ) {&nbsp;</div></li><li><div>              $opts = get_option( 'wpseo_social' );&nbsp;</div></li><li><div>              if ( ! empty( $opts['opengraph'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'wpseo opengraph meta data option is enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;Add Open Graph meta data&lt;/strong&gt; option under the &lt;a href=&quot;%s&quot;&gt;Yoast SEO / Social / Facebook&lt;/a&gt; settings tab.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=wpseo_social#top#facebook' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! empty( $opts['twitter'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'wpseo twitter meta data option is enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;Add Twitter card meta data&lt;/strong&gt; option under the &lt;a href=&quot;%s&quot;&gt;Yoast SEO / Social / Twitter&lt;/a&gt; settings tab.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=wpseo_social#top#twitterbox' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! empty( $opts['googleplus'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'wpseo googleplus meta data option is enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;Add Google+ specific post meta data&lt;/strong&gt; option under the &lt;a href=&quot;%s&quot;&gt;Yoast SEO / Social / Google+&lt;/a&gt; settings tab.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=wpseo_social#top#google' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! empty( $opts['plus-publisher'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'wpseo google plus publisher option is defined' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please remove the &lt;strong&gt;Google Publisher Page&lt;/strong&gt; value entered under the &lt;a href=&quot;%s&quot;&gt;Yoast SEO / Social / Google+&lt;/a&gt; settings tab.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=wpseo_social#top#google' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// SEO Ultimate</span>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;avail['seo']['seou'] ) {&nbsp;</div></li><li><div>              $opts = get_option( 'seo_ultimate' );&nbsp;</div></li><li><div>              if ( ! empty( $opts['modules'] ) && is_array( $opts['modules'] ) ) {&nbsp;</div></li><li><div>                  if ( array_key_exists( 'opengraph', $opts['modules'] ) && $opts['modules']['opengraph'] !== -10 ) {&nbsp;</div></li><li><div>                      if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;debug-&gt;log( $log_pre.'seo ultimate opengraph module is enabled' );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please disable the &lt;strong&gt;Open Graph Integrator&lt;/strong&gt; module in the &lt;a href=&quot;%s&quot;&gt;SEO Ultimate Module Manager&lt;/a&gt;.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=seo' ) ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// All in One SEO Pack</span>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;avail['seo']['aioseop'] ) {&nbsp;</div></li><li><div>              $opts = get_option( 'aioseop_options' );&nbsp;</div></li><li><div>              if ( ! empty( $opts['modules']['aiosp_feature_manager_options']['aiosp_feature_manager_enable_opengraph'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'aioseop social meta feature is enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please deactivate the &lt;strong&gt;Social Meta&lt;/strong&gt; feature in the &lt;a href=&quot;%s&quot;&gt;All in One SEO Pack Feature Manager&lt;/a&gt;.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=all-in-one-seo-pack/modules/aioseop_feature_manager.php' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( isset( $opts['aiosp_google_disable_profile'] ) && empty( $opts['aiosp_google_disable_profile'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'aioseop google plus profile is enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please check the &lt;strong&gt;Disable Google Plus Profile&lt;/strong&gt; option in the &lt;a href=&quot;%s&quot;&gt;All in One SEO Pack General Settings&lt;/a&gt;.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=all-in-one-seo-pack/aioseop_class.php' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( isset( $opts['aiosp_schema_markup'] ) && ! empty( $opts['aiosp_schema_markup'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'aioseop schema markup is enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;Use Schema.org Markup&lt;/strong&gt; option in the &lt;a href=&quot;%s&quot;&gt;All in One SEO Pack General Settings&lt;/a&gt;.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=all-in-one-seo-pack/aioseop_class.php' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// The SEO Framework</span>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;avail['seo']['autodescription'] ) {&nbsp;</div></li><li><div>              $the_seo_framework = the_seo_framework();&nbsp;</div></li><li><div>              if ( $the_seo_framework-&gt;use_og_tags() ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'autodescription open graph meta tags are enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;%1$s&lt;/strong&gt; option in &lt;a href=&quot;%2$s&quot;&gt;The SEO Framework&lt;/a&gt; Social Meta Settings.', 'nextgen-facebook' ), 'Output Open Graph meta tags?', get_admin_url( null, 'admin.php?page=theseoframework-settings' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $the_seo_framework-&gt;use_facebook_tags() ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'autodescription facebook meta tags are enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;%1$s&lt;/strong&gt; option in &lt;a href=&quot;%2$s&quot;&gt;The SEO Framework&lt;/a&gt; Social Meta Settings.', 'nextgen-facebook' ), 'Output Facebook meta tags?', get_admin_url( null, 'admin.php?page=theseoframework-settings' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $the_seo_framework-&gt;use_twitter_tags() ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'autodescription twitter meta tags are enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;%1$s&lt;/strong&gt; option in &lt;a href=&quot;%2$s&quot;&gt;The SEO Framework&lt;/a&gt; Social Meta Settings.', 'nextgen-facebook' ), 'Output Twitter meta tags?', get_admin_url( null, 'admin.php?page=theseoframework-settings' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $the_seo_framework-&gt;is_option_checked( 'knowledge_output' ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'autodescription knowledge graph is enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;Output Authorized Presence?&lt;/strong&gt; option in &lt;a href=&quot;%s&quot;&gt;The SEO Framework&lt;/a&gt; Schema Settings.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=theseoframework-settings' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              foreach ( array(&nbsp;</div></li><li><div>                  'post_publish_time' =&gt; 'Add article:published_time to Posts', &nbsp;</div></li><li><div>                  'page_publish_time' =&gt; 'Add article:published_time to Pages', &nbsp;</div></li><li><div>                  'home_publish_time' =&gt; 'Add article:published_time to Home Page', &nbsp;</div></li><li><div>                  'post_modify_time' =&gt; 'Add article:modified_time to Posts', &nbsp;</div></li><li><div>                  'page_modify_time' =&gt; 'Add article:modified_time to Pages', &nbsp;</div></li><li><div>                  'home_modify_time' =&gt; 'Add article:modified_time to Home Page', &nbsp;</div></li><li><div> ) as $key =&gt; $label ) {&nbsp;</div></li><li><div>                  if ( $the_seo_framework-&gt;get_option( $key ) ) {&nbsp;</div></li><li><div>                      if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;debug-&gt;log( $log_pre.'autodescription '.$key.' option is enabled' );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;%1$s&lt;/strong&gt; option in &lt;a href=&quot;%2$s&quot;&gt;The SEO Framework&lt;/a&gt; Social Meta Settings.', 'nextgen-facebook' ), $label, get_admin_url( null, 'admin.php?page=theseoframework-settings' ) ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Squirrly SEO</span>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;avail['seo']['sq'] ) {&nbsp;</div></li><li><div>              $opts = json_decode( get_option( 'sq_options' ), true );&nbsp;</div></li><li><div>              if ( ! empty( $opts['sq_auto_facebook'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'squirrly seo open graph meta tags are enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck &lt;strong&gt;Add the Social Open Graph objects&lt;/strong&gt; in the &lt;a href=&quot;%s&quot;&gt;Squirrly SEO&lt;/a&gt; Social Media Options.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=sq_seo' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! empty( $opts['sq_auto_twitter'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'squirrly seo twitter card meta tags are enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck &lt;strong&gt;Add the Twitter card in your tweets&lt;/strong&gt; in the &lt;a href=&quot;%s&quot;&gt;Squirrly SEO&lt;/a&gt; Social Media Options.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=sq_seo' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! empty( $opts['sq_auto_jsonld'] ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( $log_pre.'squirrly seo json-ld markup is enabled' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( $err_pre.sprintf( __( 'please uncheck the &lt;strong&gt;adds the JSON-LD metas for Semantic SEO&lt;/strong&gt; option in the &lt;a href=&quot;%s&quot;&gt;Squirrly SEO&lt;/a&gt; settings.', 'nextgen-facebook' ), get_admin_url( null, 'admin.php?page=sq_seo' ) ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function required_notices() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $version = $this-&gt;p-&gt;cf['plugin'][$lca]['version'];&nbsp;</div></li><li><div>          $have_ext_tid = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;avail['*']['p_dir'] === true &&&nbsp;</div></li><li><div>              empty( $this-&gt;p-&gt;options['plugin_'.$lca.'_tid'] ) &&&nbsp;</div></li><li><div>                  ( empty( $this-&gt;p-&gt;options['plugin_'.$lca.'_tid:is'] ) ||&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;options['plugin_'.$lca.'_tid:is'] !== 'disabled' ) ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;nag( $this-&gt;p-&gt;msgs-&gt;get( 'notice-pro-tid-missing' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;p-&gt;cf['plugin'] as $ext =&gt; $info ) {&nbsp;</div></li><li><div>              if ( ! empty( $this-&gt;p-&gt;options['plugin_'.$ext.'_tid'] ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// found at least one plugin with an auth id</span>&nbsp;</div></li><li><div>                  $have_ext_tid = true;&nbsp;</div></li><li><div>                  if ( ! self::$pkg[$ext]['pdir'] ) {&nbsp;</div></li><li><div>                      if ( ! empty( $info['base'] ) && ! SucomUtil::installed_plugins( $info['base'] ) ) {&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;notice-&gt;warn( $this-&gt;p-&gt;msgs-&gt;get( 'notice-pro-not-installed', &nbsp;</div></li><li><div>                              array( 'lca' =&gt; $ext ) ) );&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;notice-&gt;warn( $this-&gt;p-&gt;msgs-&gt;get( 'notice-pro-not-updated', &nbsp;</div></li><li><div>                              array( 'lca' =&gt; $ext ) ) );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $have_ext_tid === true ) {&nbsp;</div></li><li><div>              $um_info = $this-&gt;p-&gt;cf['plugin']['ngfbum'];&nbsp;</div></li><li><div>              <span class="comment">// if the update manager is active, the version should be available</span>&nbsp;</div></li><li><div>              if ( ! empty( $um_info['version'] ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// check for minimum update manager version required</span>&nbsp;</div></li><li><div>                  $min_version = NgfbConfig::$cf['um']['min_version'];&nbsp;</div></li><li><div>                  if ( version_compare( $um_info['version'], $min_version, '&lt;' ) ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;notice-&gt;err( $this-&gt;p-&gt;msgs-&gt;get( 'notice-um-version-required', &nbsp;</div></li><li><div>                          array( 'min_version' =&gt; $min_version ) ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              <span class="comment">// if the update manager is not active, check if installed</span>&nbsp;</div></li><li><div>              } elseif ( SucomUtil::installed_plugins( $um_info['base'] ) ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;nag( $this-&gt;p-&gt;msgs-&gt;get( 'notice-um-activate-extension' ) );&nbsp;</div></li><li><div>              <span class="comment">// update manager is not active or installed</span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;nag( $this-&gt;p-&gt;msgs-&gt;get( 'notice-um-extension-required' ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( current_user_can( 'manage_options' ) ) {&nbsp;</div></li><li><div>              foreach ( array( 'wp', 'php' ) as $key ) {&nbsp;</div></li><li><div>                  if ( isset( NgfbConfig::$cf[$key]['rec_version'] ) ) {&nbsp;</div></li><li><div>                      switch ( $key ) {&nbsp;</div></li><li><div>                          case 'wp':&nbsp;</div></li><li><div>                              global $wp_version;&nbsp;</div></li><li><div>                              $app_version = $wp_version;&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                          case 'php':&nbsp;</div></li><li><div>                              $app_version = phpversion();&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      $app_label = NgfbConfig::$cf[$key]['label'];&nbsp;</div></li><li><div>                      $rec_version = NgfbConfig::$cf[$key]['rec_version'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( version_compare( $app_version, $rec_version, '&lt;' ) ) {&nbsp;</div></li><li><div>                          $warn_msg = $this-&gt;p-&gt;msgs-&gt;get( 'notice-recommend-version', array(&nbsp;</div></li><li><div>                              'app_label' =&gt; $app_label, &nbsp;</div></li><li><div>                              'app_version' =&gt; $app_version, &nbsp;</div></li><li><div>                              'rec_version' =&gt; NgfbConfig::$cf[$key]['rec_version'], &nbsp;</div></li><li><div>                              'version_url' =&gt; NgfbConfig::$cf[$key]['version_url'], &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                          $warn_dis_key = 'notice-recommend-version-'.$lca.'-'.$version.'-'.$app_label.'-'.$app_version;&nbsp;</div></li><li><div>                          $this-&gt;p-&gt;notice-&gt;warn( $warn_msg, true, $warn_dis_key, MONTH_IN_SECONDS, true );    <span class="comment">// $silent = true</span>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function reset_check_head_count() {&nbsp;</div></li><li><div>          delete_option( NGFB_POST_CHECK_NAME );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function check_tmpl_head_attributes() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;mark();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// only check if using the default filter name</span>&nbsp;</div></li><li><div>          if ( empty( $this-&gt;p-&gt;options['plugin_head_attr_filter_name'] ) ||&nbsp;</div></li><li><div>              $this-&gt;p-&gt;options['plugin_head_attr_filter_name'] !== 'head_attributes' ||&nbsp;</div></li><li><div>                  ! apply_filters( $this-&gt;p-&gt;cf['lca'].'_add_schema_head_attributes', true ) ) {&nbsp;</div></li><li><div>              return;    <span class="comment"><span class="comment">// exit early</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( SucomUtil::get_header_files() as $tmpl_file ) {&nbsp;</div></li><li><div>              if ( ( $html = SucomUtil::get_stripped_php( $tmpl_file ) ) === false ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              } elseif ( strpos( $html, '&lt;head&gt;' ) !== false ) {&nbsp;</div></li><li><div>                  <span class="comment">// skip if notices already shown</span>&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;notice-&gt;is_admin_pre_notices() ) {&nbsp;</div></li><li><div>                      <span class="comment">// allow warning to be dismissed until the next theme update</span>&nbsp;</div></li><li><div>                      $warn_dis_key = 'notice-header-tmpl-no-head-attr-'.SucomUtil::get_theme_slug_version();&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;notice-&gt;warn( $this-&gt;p-&gt;msgs-&gt;get( 'notice-header-tmpl-no-head-attr' ), &nbsp;</div></li><li><div>                          true, $warn_dis_key, true );    <span class="comment"><span class="comment"><span class="comment">// can be dismissed</span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function modify_tmpl_head_attributes() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $have_changes = false;&nbsp;</div></li><li><div>          $header_files = SucomUtil::get_header_files();&nbsp;</div></li><li><div>          $head_action_php = '&lt;head &lt;?php do_action( \'add_head_attributes\' ); ?'.'&gt;&gt;';    <span class="comment">// breakup closing php for vim syntax highlighting</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $header_files ) ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;err( __( 'No header templates found in the parent or child theme directories.', &nbsp;</div></li><li><div>                  'nextgen-facebook' ) );&nbsp;</div></li><li><div>              return;    <span class="comment"><span class="comment">// exit early</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $header_files as $tmpl_file ) {&nbsp;</div></li><li><div>              $tmpl_base = basename( $tmpl_file );&nbsp;</div></li><li><div>              $backup_file = $tmpl_file.'~backup-'.date( 'Ymd-His' );&nbsp;</div></li><li><div>              $backup_base = basename( $backup_file );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>              <span class="comment">// double check in case of reloads etc.</span>&nbsp;</div></li><li><div>              if ( ( $html = SucomUtil::get_stripped_php( $tmpl_file ) ) === false ||&nbsp;</div></li><li><div>                  strpos( $html, '&lt;head&gt;' ) === false ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( sprintf( __( 'No &lt;head&gt; HTML element found in the %s template.', &nbsp;</div></li><li><div>                      'nextgen-facebook' ), $tmpl_file ) );&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// make a backup of the original</span>&nbsp;</div></li><li><div>              if ( ! copy( $tmpl_file, $backup_file ) ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( sprintf( __( 'Error copying %1$s to %2$s.', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                      $tmpl_file, $backup_base ) );&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $tmpl_contents = file_get_contents( $tmpl_file );&nbsp;</div></li><li><div>              $tmpl_contents = str_replace( '&lt;head&gt;', $head_action_php, $tmpl_contents );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! $tmpl_fh = @fopen( $tmpl_file, 'wb' ) ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( sprintf( __( 'Failed to open %s for writing.', &nbsp;</div></li><li><div>                      'nextgen-facebook' ), $tmpl_file ) );&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( fwrite( $tmpl_fh, $tmpl_contents ) ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;upd( sprintf( __( 'The %1$s template has been successfully modified and saved. A backup copy of the original template is available as %2$s in the same folder.', 'nextgen-facebook' ), $tmpl_file, $backup_base ) );&nbsp;</div></li><li><div>                  $have_changes = true;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;err( sprintf( __( 'Failed to write the %1$s template. You may need to restore the original template saved as %2$s in the same folder.', 'nextgen-facebook' ), $tmpl_file, $backup_base ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              fclose( $tmpl_fh );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $have_changes ) {&nbsp;</div></li><li><div>              $dis_key = 'notice-header-tmpl-no-head-attr-'.SucomUtil::get_theme_slug_version();&nbsp;</div></li><li><div>              $this-&gt;p-&gt;notice-&gt;trunc_key( $dis_key, 'all' );    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// called from the NgfbSubmenuEssential and NgfbSubmenuAdvanced classes</span>&nbsp;</div></li><li><div>      protected function add_essential_advanced_table_rows( array &$table_rows, $form, $network = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $table_rows['plugin_preserve'] = $form-&gt;get_th_html( _x( 'Preserve Settings on Uninstall', &nbsp;</div></li><li><div>              'option label', 'nextgen-facebook' ), '', 'plugin_preserve' ).&nbsp;</div></li><li><div>          '&lt;td&gt;'.$form-&gt;get_checkbox( 'plugin_preserve' ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>          self::get_option_site_use( 'plugin_preserve', $form, $network, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $table_rows['plugin_debug'] = $form-&gt;get_th_html( _x( 'Add Hidden Debug Messages', &nbsp;</div></li><li><div>              'option label', 'nextgen-facebook' ), '', 'plugin_debug' ).&nbsp;</div></li><li><div>          '&lt;td&gt;'.( ! $network && SucomUtil::get_const( 'NGFB_HTML_DEBUG' ) ?&nbsp;</div></li><li><div>              $form-&gt;get_no_checkbox( 'plugin_debug' ).' &lt;em&gt;NGFB_HTML_DEBUG constant is true&lt;/em&gt;' :&nbsp;</div></li><li><div>              $form-&gt;get_checkbox( 'plugin_debug' ) ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>          self::get_option_site_use( 'plugin_debug', $form, $network, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $network || ! $this-&gt;p-&gt;check-&gt;aop( $this-&gt;p-&gt;cf['lca'], true, $this-&gt;p-&gt;avail['*']['p_dir'] ) ) {&nbsp;</div></li><li><div>              $table_rows['plugin_hide_pro'] = $form-&gt;get_th_html( _x( 'Hide All Pro Version Options', &nbsp;</div></li><li><div>                  'option label', 'nextgen-facebook' ), null, 'plugin_hide_pro' ).&nbsp;</div></li><li><div>              '&lt;td&gt;'.$form-&gt;get_checkbox( 'plugin_hide_pro' ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>              self::get_option_site_use( 'plugin_show_opts', $form, $network, true );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $form-&gt;get_hidden( 'plugin_hide_pro', 0, true );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $table_rows['plugin_show_opts'] = $form-&gt;get_th_html( _x( 'Options to Show by Default', &nbsp;</div></li><li><div>              'option label', 'nextgen-facebook' ), null, 'plugin_show_opts' ).&nbsp;</div></li><li><div>          '&lt;td&gt;'.$form-&gt;get_select( 'plugin_show_opts', $this-&gt;p-&gt;cf['form']['show_options'] ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>          self::get_option_site_use( 'plugin_show_opts', $form, $network, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;cf['*']['lib']['shortcode'] ) ) {&nbsp;</div></li><li><div>              $table_rows['plugin_shortcodes'] = '&lt;tr class=&quot;hide_in_basic&quot;&gt;'.&nbsp;</div></li><li><div>              $form-&gt;get_th_html( _x( 'Enable Plugin Shortcode(s)', &nbsp;</div></li><li><div>                  'option label', 'nextgen-facebook' ), '', 'plugin_shortcodes' ).&nbsp;</div></li><li><div>              '&lt;td&gt;'.$form-&gt;get_checkbox( 'plugin_shortcodes' ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>              self::get_option_site_use( 'plugin_shortcodes', $form, $network, true );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;cf['*']['lib']['widget'] ) ) {&nbsp;</div></li><li><div>              $table_rows['plugin_widgets'] = '&lt;tr class=&quot;hide_in_basic&quot;&gt;'.&nbsp;</div></li><li><div>              $form-&gt;get_th_html( _x( 'Enable Plugin Widget(s)', &nbsp;</div></li><li><div>                  'option label', 'nextgen-facebook' ), '', 'plugin_widgets' ).&nbsp;</div></li><li><div>              '&lt;td&gt;'.$form-&gt;get_checkbox( 'plugin_widgets' ).'&lt;/td&gt;'.&nbsp;</div></li><li><div>              self::get_option_site_use( 'plugin_widgets', $form, $network, true );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// deprecated on 2017/04/02</span>&nbsp;</div></li><li><div>      public function get_site_use( $form, $network, $name, $enabled = false ) {&nbsp;</div></li><li><div>          return self::get_option_site_use( $name, $form, $network, $enabled );    <span class="comment">// note the different arg order</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public static function get_option_site_use( $name, $form, $network = false, $enabled = false ) {&nbsp;</div></li><li><div>          if ( $network ) {&nbsp;</div></li><li><div>              return $form-&gt;get_th_html( _x( 'Site Use', &nbsp;</div></li><li><div>                  'option label (very short)', 'nextgen-facebook' ), &nbsp;</div></li><li><div>                      'site_use' ).( $enabled || self::$pkg['ngfb']['aop'] ?&nbsp;</div></li><li><div>                  '&lt;td class=&quot;site_use&quot;&gt;'.$form-&gt;get_select( $name.':use', &nbsp;</div></li><li><div>                      NgfbConfig::$cf['form']['site_option_use'], 'site_use' ).'&lt;/td&gt;' :&nbsp;</div></li><li><div>                  '&lt;td class=&quot;blank site_use&quot;&gt;'.$form-&gt;get_select( $name.':use', &nbsp;</div></li><li><div>                      NgfbConfig::$cf['form']['site_option_use'], 'site_use', '', true, true ).'&lt;/td&gt;' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_readme_info( $ext, $use_cache = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                  'ext' =&gt; $ext, &nbsp;</div></li><li><div>                  'use_cache' =&gt; $use_cache, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $readme_info = array();&nbsp;</div></li><li><div>          $readme_url = isset( $this-&gt;p-&gt;cf['plugin'][$ext]['url']['readme_txt'] ) ?&nbsp;</div></li><li><div>              $this-&gt;p-&gt;cf['plugin'][$ext]['url']['readme_txt'] : '';&nbsp;</div></li><li><div>          $readme_file = defined( strtoupper( $ext ).'_PLUGINDIR' ) ?&nbsp;</div></li><li><div>              constant( strtoupper( $ext ).'_PLUGINDIR' ).'readme.txt' : '';&nbsp;</div></li><li><div>          $use_remote = strpos( $readme_url, ':<span class="comment"><span class="comment">//' ) ? true : false;</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $cache_salt = __METHOD__.'(url:'.$readme_url.'_file:'.$readme_file.')';&nbsp;</div></li><li><div>          $cache_id = $ext.'_'.md5( $cache_salt );&nbsp;</div></li><li><div>          $cache_exp = (int) apply_filters( $lca.'_cache_expire_readme_txt', &nbsp;</div></li><li><div>              $this-&gt;p-&gt;cf['readme_cache_exp'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log( 'transient cache salt '.$cache_salt );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $cache_exp &gt; 0 ) {&nbsp;</div></li><li><div>              <span class="comment">// check the transient cache, if reading the cache is allowed</span>&nbsp;</div></li><li><div>              $readme_info = $use_cache ? get_transient( $cache_id ) : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_array( $readme_info ) ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;debug-&gt;log( 'readme_info retrieved from transient '.$cache_id );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  return $readme_info;    <span class="comment"><span class="comment">// stop here</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// get the remote readme</span>&nbsp;</div></li><li><div>              if ( $use_remote ) {&nbsp;</div></li><li><div>                  <span class="comment">// clear the cache first if reading the cache is disabled</span>&nbsp;</div></li><li><div>                  if ( ! $use_cache ) {&nbsp;</div></li><li><div>                      $this-&gt;p-&gt;cache-&gt;clear( $readme_url );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  <span class="comment">// get the readme and save it to the disk cache</span>&nbsp;</div></li><li><div>                  $content = $this-&gt;p-&gt;cache-&gt;get( $readme_url, 'raw', 'file', $cache_exp );&nbsp;</div></li><li><div>                  if ( empty( $content ) ) {&nbsp;</div></li><li><div>                      $use_remote = false;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $use_remote = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// fallback to reading the local readme.txt file</span>&nbsp;</div></li><li><div>          if ( $use_remote === false && ! empty( $readme_file ) && $fh = @fopen( $readme_file, 'rb' ) ) {&nbsp;</div></li><li><div>              $content = fread( $fh, filesize( $readme_file ) );&nbsp;</div></li><li><div>              fclose( $fh );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $content ) ) {&nbsp;</div></li><li><div>              $readme_info = array();    <span class="comment">// save an empty array</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $parser = new SuextParseReadme( $this-&gt;p-&gt;debug );&nbsp;</div></li><li><div>              $readme_info = $parser-&gt;parse_readme_contents( $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// remove possibly inaccurate information from local file</span>&nbsp;</div></li><li><div>              if ( $use_remote === false && is_array( $readme_info ) ) {&nbsp;</div></li><li><div>                  foreach ( array( 'stable_tag', 'upgrade_notice' ) as $key ) {&nbsp;</div></li><li><div>                      unset ( $readme_info[$key] );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// save the parsed readme to the transient cache</span>&nbsp;</div></li><li><div>          if ( $cache_exp &gt; 0 ) {&nbsp;</div></li><li><div>              set_transient( $cache_id, $readme_info, $cache_exp );&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( 'readme_info saved to transient '.$cache_id.' ('.$cache_exp.' seconds)');&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return (array) $readme_info;    <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// just in case</span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_setup_content( $ext, $read_cache = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;p-&gt;debug-&gt;enabled ) {&nbsp;</div></li><li><div>              $this-&gt;p-&gt;debug-&gt;log_args( array( &nbsp;</div></li><li><div>                  'ext' =&gt; $ext, &nbsp;</div></li><li><div>                  'read_cache' =&gt; $read_cache, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! defined( strtoupper( $ext ).'_PLUGINDIR' ) ) {&nbsp;</div></li><li><div>              if ( $this-&gt;p-&gt;debug-&gt;enabled )&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;debug-&gt;log( strtoupper( $ext ).'_PLUGINDIR is undefined and required' );&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>          $cache_exp = (int) apply_filters( $lca.'_cache_expire_setup_html', &nbsp;</div></li><li><div>              $this-&gt;p-&gt;cf['setup_cache_exp'] );&nbsp;</div></li><li><div>          $file_url = isset( $this-&gt;p-&gt;cf['plugin'][$ext]['url']['setup_html'] ) ?&nbsp;</div></li><li><div>              $this-&gt;p-&gt;cf['plugin'][$ext]['url']['setup_html'] : '';&nbsp;</div></li><li><div>          $file_path = constant( strtoupper( $ext ).'_PLUGINDIR' ).'setup.html';&nbsp;</div></li><li><div>          $get_remote = strpos( $file_url, ':<span class="comment"><span class="comment">//' ) ? true : false;</span></span>&nbsp;</div></li><li><div>          $content = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// get remote setup.html file</span>&nbsp;</div></li><li><div>          if ( $cache_exp &gt; 0 && $get_remote ) {&nbsp;</div></li><li><div>              if ( ! $read_cache ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;cache-&gt;clear( $file_url );    <span class="comment">// clear the wp object, transient, and file cache</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $content = $this-&gt;p-&gt;cache-&gt;get( $file_url, 'raw', 'file', $cache_exp );&nbsp;</div></li><li><div>              if ( empty( $content ) ) {&nbsp;</div></li><li><div>                  $get_remote = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $get_remote = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// fallback to local setup.html file</span>&nbsp;</div></li><li><div>          if ( $get_remote === false && ! empty( $file_path ) && $fh = @fopen( $file_path, 'rb' ) ) {&nbsp;</div></li><li><div>              $content = fread( $fh, filesize( $file_path ) );&nbsp;</div></li><li><div>              fclose( $fh );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $content;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function plugin_complete_actions( $actions ) {&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;pageref_url ) && ! empty( $this-&gt;pageref_title ) ) {&nbsp;</div></li><li><div>              foreach ( $actions as $action =&gt; &$html ) {&nbsp;</div></li><li><div>                  switch ( $action ) {&nbsp;</div></li><li><div>                      case 'plugins_page':&nbsp;</div></li><li><div>                          $html = '&lt;a href=&quot;'.$this-&gt;pageref_url.'&quot; target=&quot;_parent&quot;&gt;'.&nbsp;</div></li><li><div>                              sprintf( __( 'Return to %s', 'nextgen-facebook' ), $this-&gt;pageref_title ).'&lt;/a&gt;';&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      default:&nbsp;</div></li><li><div>                          if ( preg_match( '/^(.*href=&quot;)([^&quot;]+)(&quot;.*)$/', $html, $matches ) ) {&nbsp;</div></li><li><div>                              $url = add_query_arg( array(&nbsp;</div></li><li><div>                                  $lca.'_pageref_url' =&gt; urlencode( $this-&gt;pageref_url ), &nbsp;</div></li><li><div>                                  $lca.'_pageref_title' =&gt; urlencode( $this-&gt;pageref_title ), &nbsp;</div></li><li><div> ), $matches[2] );&nbsp;</div></li><li><div>                              $html = $matches[1].$url.$matches[3];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $actions;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function plugin_complete_redirect( $url ) {&nbsp;</div></li><li><div>          $lca = $this-&gt;p-&gt;cf['lca'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( strpos( $url, '?activate=true' ) ) {&nbsp;</div></li><li><div>              if ( ! empty( $this-&gt;pageref_url ) ) {&nbsp;</div></li><li><div>                  $this-&gt;p-&gt;notice-&gt;upd( __( 'Plugin &lt;strong&gt;activated&lt;/strong&gt;.' ) );    <span class="comment"><span class="comment"><span class="comment">// green</span> status w check mark</span></span>&nbsp;</div></li><li><div>                  $url = $this-&gt;pageref_url;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $url;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function get_ext_img_icon( $ext, $fallback = true ) {&nbsp;</div></li><li><div>          $img_src = 'src=&quot;data:image/gif;base64, R0lGODlhAQABAIAAAP<span class="comment">///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==&quot;';</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;p-&gt;cf['plugin'][$ext]['img']['icons'] ) ) {&nbsp;</div></li><li><div>              $icons = $this-&gt;p-&gt;cf['plugin'][$ext]['img']['icons'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $icons['low'] ) ) {&nbsp;</div></li><li><div>                  $img_src = 'src=&quot;'.$icons['low'].'&quot;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( ! empty( $icons['high'] ) ) {&nbsp;</div></li><li><div>                  $img_src .= ' srcset=&quot;'.$icons['high'].' 256w&quot;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return '&lt;img '.$img_src.' width=&quot;128&quot; height=&quot;128&quot; /&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>NextGEN Facebook (NGFB)</li><li><span></span>8.43.0</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>