<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="3.0.5" data-slug="google-photos-picasa-viewer" data-type="class" data-id="39805"><head xmlns="http://www.w3.org/1999/xhtml"><title> cws_google_picasa_pro_admin | class | Google Photos Picasa Viewer | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="CWS_Google_Picasa_Pro_Admin, class, plugin, google-photos-picasa-viewer, 3.0.5" /><meta name="description" content="The admin-specific functionality of the plugin." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=6ca9cb736777796d1490010a4b653135' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/cws_google_picasa_pro_admin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcws_google_picasa_pro_admin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcws_google_picasa_pro_admin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-google-photos-picasa-viewer-3.0.5-class-cws_google_picasa_pro_admin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="cws_google_picasa_pro_admin" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to google-photos-picasa-viewer." href="http://hookr.io/plugins/google-photos-picasa-viewer/" class="plugin"><span property="name">google-photos-picasa-viewer</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 3.0.5." href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/" class="H_VERSION"><span property="name">3.0.5</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">cws_google_picasa_pro_admin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="2814"><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/all/" title="All">All <span class="count badge">2814</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="7"><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/hooks/" title="Hooks">Hooks <span class="count badge">7</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="7"><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/filters/" title="Filters">Filters <span class="count badge">7</span></a></li><li class="active" data-id="class" data-count="2791"><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/classes/" title="Classes">Classes <span class="count badge">2791</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="13"><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/functions/" title="Functions">Functions <span class="count badge">13</span></a></li><li class="" data-id="shortcode" data-count="3"><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">3</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>CWS_Google_Picasa_Pro_Admin</strong></h1><p>The admin-specific functionality of the plugin.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/files/admin-class-cws-google-picasa-pro-admin/" class="file">/admin/class-cws-google-picasa-pro-admin.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="23" class="block" start="23"><li><div>class CWS_Google_Picasa_Pro_Admin {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $debug = false;&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The ID of this plugin.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     * @access   private&nbsp;</div></li><li><div>     * @var      string    $plugin_name    The ID of this plugin.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $plugin_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The version of this plugin.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     * @access   private&nbsp;</div></li><li><div>     * @var      string    $version    The current version of this plugin.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private $version;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The is user authenticated with Google.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     * @access   private&nbsp;</div></li><li><div>     * @var      int    $authenticated    Check is user authenticated with Google.&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    private $authenticated = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The check is this a Pro version.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     * @access   private&nbsp;</div></li><li><div>     * @var      int    $isPro    Check is if this is pro version.&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    private $isPro ;  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * User Id used to check ignore upgrade notice.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.1.1&nbsp;</div></li><li><div>     * @access   private&nbsp;</div></li><li><div>     * @var      int    $userId    User Id of loggedin user.&nbsp;</div></li><li><div>     */ &nbsp;</div></li><li><div>    private $userId;&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    var $client; // Used for Google Client&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initialize the class and set its properties.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     * @param      string    $plugin_name       The name of this plugin.&nbsp;</div></li><li><div>     * @param      string    $version    The version of this plugin.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct( $plugin_name, $version, $isPro ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;plugin_name = $plugin_name;&nbsp;</div></li><li><div>        $this-&gt;version = $version;&nbsp;</div></li><li><div>        $this-&gt;isPro = $isPro;&nbsp;</div></li><li><div>        $this-&gt;client = new Google_Client();&nbsp;</div></li><li><div>        $this-&gt;client-&gt;setApplicationName(&quot;Client_Library_Examples&quot;);&nbsp;</div></li><li><div>        $this-&gt;client-&gt;setDeveloperKey(&quot;AIzaSyCP9XMYoQdxXfI-gK1bvZDW2RxyfvYENuM&quot;);  &nbsp;</div></li><li><div>        $this-&gt;client-&gt;setClientId('806353319710-g782kn9ed0gm77ucl0meen5ohs84qgqm.apps.googleusercontent.com');&nbsp;</div></li><li><div>        $this-&gt;client-&gt;setClientSecret('P6BMMEWLKUSoxB48X2Tzu8ds');&nbsp;</div></li><li><div>        $this-&gt;client-&gt;setRedirectUri('urn:ietf:wg:oauth:2.0:oob');&nbsp;</div></li><li><div>        $this-&gt;client-&gt;setScopes('https://picasaweb.google.com/data/');&nbsp;</div></li><li><div>        $this-&gt;client-&gt;setAccessType('offline');&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Include required files&nbsp;</div></li><li><div>        $this-&gt;includes();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //$this-&gt;cws_gpp_admin_installed_notice();&nbsp;</div></li><li><div>        //$this-&gt;cws_gpp_admin_notices_styles();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register the stylesheets for the admin area.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    1.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function includes() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $this-&gt;debug ) error_log( 'Inside: CWS_WPPicasaPro::includes()' );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if ( is_admin() ) $this-&gt;admin_includes();&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        include_once( dirname(__FILE__) . '/../cws-gpp-functions.php' );                // TODO: split file out in admin and non-admin functions&nbsp;</div></li><li><div>        include_once( dirname(__FILE__) . '/../shortcodes/shortcode-init.php' );        // Init the shortcodes&nbsp;</div></li><li><div>        include_once( dirname(__FILE__) . '/../widgets/widget-init.php' );                // Widget classes        &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $this-&gt;isPro ==1 ) {&nbsp;</div></li><li><div>            // TODO: change this into an include for Pro shortcodes...&nbsp;</div></li><li><div>            add_shortcode( 'cws_gpp_images_by_albumid', 'cws_gpp_shortcode_images_in_album' );  // new one, shortcode provides album id&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function admin_includes() {&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        if( $this-&gt;debug ) error_log( 'Inside: CWS_WPPicasaPro::admin_includes()' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        include_once( dirname(__FILE__) . '/../cws-gpp-functions.php' );                // TODO: split file out in admin and non-admin functions&nbsp;</div></li><li><div>    }    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register the stylesheets for the admin area.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function enqueue_styles() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * This function is provided for demonstration purposes only.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * An instance of this class should be passed to the run() function&nbsp;</div></li><li><div>         * defined in Plugin_Name_Loader as all of the hooks are defined&nbsp;</div></li><li><div>         * in that particular class.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * The Plugin_Name_Loader will then create the relationship&nbsp;</div></li><li><div>         * between the defined hooks and the functions defined in this&nbsp;</div></li><li><div>         * class.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_enqueue_style( $this-&gt;plugin_name, plugin_dir_url( __FILE__ ) . 'css/cws-google-picasa-pro-admin.css', array(), $this-&gt;version, 'all' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register the JavaScript for the admin area.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function enqueue_scripts() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * This function is provided for demonstration purposes only.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * An instance of this class should be passed to the run() function&nbsp;</div></li><li><div>         * defined in Plugin_Name_Loader as all of the hooks are defined&nbsp;</div></li><li><div>         * in that particular class.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * The Plugin_Name_Loader will then create the relationship&nbsp;</div></li><li><div>         * between the defined hooks and the functions defined in this&nbsp;</div></li><li><div>         * class.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_enqueue_script( $this-&gt;plugin_name, plugin_dir_url( __FILE__ ) . 'js/cws-google-picasa-pro-admin.js', array( 'jquery' ), $this-&gt;version, false );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if the plugin is a Pro version.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */  &nbsp;</div></li><li><div>    private function get_Pro( $isPro ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $isPro == 1 ) { return &quot;Pro&quot;; }&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register the Options for the admin area.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    public function add_options_page() {&nbsp;</div></li><li><div>       &nbsp;</div></li><li><div>        $strIsPro = $this-&gt;get_Pro( $this-&gt;isPro );&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>        // add_options_page( $page_title, $menu_title, $capability, $menu_slug, $function);&nbsp;</div></li><li><div>        add_options_page( 'Google Picasa ' . $strIsPro, 'Google Picasa '. $strIsPro, 'manage_options', 'cws_gpp', array( $this, 'options_page') );  &nbsp;</div></li><li><div>    } */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register the Top Level Menu Page for the admin area.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.3.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    public function add_menu_page() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $strIsPro = $this-&gt;get_Pro( $this-&gt;isPro );&nbsp;</div></li><li><div>        // add_menu_page('Page Title', 'Google Photos', 10, 'cws_gpp', 'section');&nbsp;</div></li><li><div>        add_menu_page( 'Page Title', 'Google Photos', 'manage_options', 'cws_gpp', array( $this, 'options_page') );&nbsp;</div></li><li><div>        add_submenu_page( 'cws_gpp', 'Google Photos Settings', 'Settings', 'manage_options', 'cws_gpp', array( $this, 'options_page') );&nbsp;</div></li><li><div>    }    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register the Options for the admin area.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.3.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    public function add_options_sc_page() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //$strIsPro = $this-&gt;get_Pro( $this-&gt;isPro );&nbsp;</div></li><li><div>        add_submenu_page( 'cws_gpp', 'Google Photos Album Shortcodes', 'Album Shortcodes', 'manage_options', 'cws_sc', array( $this, 'options_page_sc') );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Draw the Options page for the admin area. This contains simple shortcode snippets for *** PRO ONLY ***&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.3.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function options_page_sc() {&nbsp;</div></li><li><div> ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>        &lt;?php screen_icon(); ?&gt;&nbsp;</div></li><li><div>            &lt;h2&gt;Google Picasa &lt;?php echo $this-&gt;get_Pro( $this-&gt;isPro );?&gt; Settings&lt;/h2&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;!-- &lt;div class=&quot;widget-liquid-left&quot;&gt; --&gt;&nbsp;</div></li><li><div>            &lt;div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php &nbsp;</div></li><li><div>                // Step 1:  The user has not authenticated we give them a link to login    &nbsp;</div></li><li><div>                if( $this-&gt;isAuthenticated() !== true ) {&nbsp;</div></li><li><div>                    // settings_fields( $option_group )&nbsp;</div></li><li><div>                    // Output nonce, action, and option_page fields for a settings page. Please note that this function must be called inside of the form tag for the options page.&nbsp;</div></li><li><div>                    // $option_group - A settings group name. This should match the group name used in register_setting(). &nbsp;</div></li><li><div>                    ////settings_fields( 'cws_gpp_code' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // do_settings_sections( $page );&nbsp;</div></li><li><div>                    // Prints out all settings sections added to a particular settings page.&nbsp;</div></li><li><div>                    // The slug name of the page whose settings sections you want to output. This should match the page name used in add_settings_section().&nbsp;</div></li><li><div>                    ////do_settings_sections( 'cws_gpp' ); &nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    Not authenticated...&nbsp;</div></li><li><div>                    &lt;!-- &lt;input name=&quot;Submit&quot; type=&quot;submit&quot; value=&quot;Save Changes&quot; /&gt;  --&gt;&nbsp;</div></li><li><div>                    &lt;/form&gt; &nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;div style=&quot;width: 95%;&quot; class=&quot;postbox-container&quot;&gt;&nbsp;</div></li><li><div>                    &lt;h2&gt;Google Photo Album Details&lt;/h2&gt;&nbsp;</div></li><li><div>                    &lt;p&gt;Use this shortcode to display photos in a album specified by the ID.&lt;/p&gt;&nbsp;</div></li><li><div>                        &lt;div class=&quot;metabox-holder&quot;&gt;&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>                            &lt;div class=&quot;postbox&quot; id=&quot;settings&quot;&gt;&nbsp;</div></li><li><div>                                &lt;?php&nbsp;</div></li><li><div>                                // $plugin = new CWS_Google_Picasa_Pro( $plugin_name, $version, $isPro );&nbsp;</div></li><li><div>                                $plugin = new CWS_Google_Picasa_Pro();&nbsp;</div></li><li><div>                                $plugin_admin = new CWS_Google_Picasa_Pro_Admin( $plugin-&gt;get_plugin_name(), $plugin-&gt;get_version(), $plugin-&gt;get_isPro() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                // Only display shortcode snippets to Pro users...&nbsp;</div></li><li><div>                                if( $plugin-&gt;isPro == 1 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // Grab options stored in db&nbsp;</div></li><li><div>                                    $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // set some defaults...&nbsp;</div></li><li><div>                                    $options['results_page'] = isset($options['results_page']) ? $options['results_page'] : &quot;&quot;;&nbsp;</div></li><li><div>                                    $options['hide_albums'] = isset($options['hide_albums']) ? $options['hide_albums'] : &quot;&quot;;&nbsp;</div></li><li><div>                                    $options['theme'] = isset($options['theme']) ? $options['theme'] : &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // Extract the options from db and overwrite with any set in the shortcode&nbsp;</div></li><li><div>                                   // extract( shortcode_atts( array(&nbsp;</div></li><li><div>                                    extract( array(&nbsp;</div></li><li><div>                                        'thumb_size' =&gt; $options['thumb_size'], &nbsp;</div></li><li><div>                                        'album_thumb_size' =&gt; $options['album_thumb_size'], &nbsp;</div></li><li><div>                                        'show_title' =&gt; $options['show_album_title'], &nbsp;</div></li><li><div>                                        'show_details' =&gt; $options['show_album_details'], &nbsp;</div></li><li><div>                                        'num_results' =&gt; $options['num_album_results'], &nbsp;</div></li><li><div>                                        'visibility' =&gt; $options['private_albums'], &nbsp;</div></li><li><div>                                        'results_page' =&gt; $options['results_page'], &nbsp;</div></li><li><div>                                        'hide_albums' =&gt; $options['hide_albums'], &nbsp;</div></li><li><div>                                        'theme' =&gt; $options['theme'], &nbsp;</div></li><li><div>                                        'imgmax' =&gt; $options['lightbox_image_size'], &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>                                    // ), $atts ) );&nbsp;</div></li><li><div>                                    // Map albums names to hide to array and trim white space&nbsp;</div></li><li><div>                                    //$hide_albums = array_map( 'trim', explode( ', ', $hide_albums ) );&nbsp;</div></li><li><div>                            /**&nbsp;</div></li><li><div>                                        if( isset( $hide_albums ) ) {&nbsp;</div></li><li><div>                                            $hide_albums[] = 'Auto Backup';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        else {&nbsp;</div></li><li><div>                                            $hide_albums = 'Auto Backup';&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                            */&nbsp;</div></li><li><div>                                    // TODO: cast other vars to int if required&nbsp;</div></li><li><div>                                    $thumb_size = (int) $thumb_size;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( $show_title === 'false' ) $show_title = false; // just to be sure...&nbsp;</div></li><li><div>                                    if ( $show_title === 'true' ) $show_title = true; // just to be sure...&nbsp;</div></li><li><div>                                    if ( $show_title === '0' ) $show_title = false; // just to be sure...&nbsp;</div></li><li><div>                                    if ( $show_title === '1' ) $show_title = true; // just to be sure...&nbsp;</div></li><li><div>                                    $show_title = (bool) $show_title;  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if ( $show_details === 'false' ) $show_details = false; // just to be sure...&nbsp;</div></li><li><div>                                    if ( $show_details === 'true' ) $show_details = true; // just to be sure...&nbsp;</div></li><li><div>                                    if ( $show_details === '0' ) $show_details = false; // just to be sure...&nbsp;</div></li><li><div>                                    if ( $show_details === '1' ) $show_details = true; // just to be sure...&nbsp;</div></li><li><div>                                    $show_details = (bool) $show_details;  &nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>                                    // Grab page from url&nbsp;</div></li><li><div>                                    $cws_page = get_query_var( 'cws_page' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // Grab the access token&nbsp;</div></li><li><div>                                    $AccessToken = get_option( 'cws_gpp_access_token' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // Get Albums&nbsp;</div></li><li><div>                                    $response = $plugin_admin-&gt;getAlbumList( $AccessToken, $album_thumb_size, $show_title, 0, 0, $visibility );  &nbsp;</div></li><li><div>                                    // $response = $plugin_admin-&gt;getAlbumList( $AccessToken, $album_thumb_size, $show_title, 0, 0 );             &nbsp;</div></li><li><div>                              &nbsp;</div></li><li><div>                                    // var_dump($response);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    #----------------------------------------------------------------------------&nbsp;</div></li><li><div>                                    # Convert the XML response into SimpleXML Object&nbsp;</div></li><li><div>                                    #----------------------------------------------------------------------------&nbsp;</div></li><li><div>                                    if (!function_exists('produce_XML_object_tree')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        function produce_XML_object_tree( $response ) {&nbsp;</div></li><li><div>                                            libxml_use_internal_errors( true );&nbsp;</div></li><li><div>                                            try {&nbsp;</div></li><li><div>                                                // Create simplexml object from feed&nbsp;</div></li><li><div>                                                $xml = new SimpleXMLElement( $response );&nbsp;</div></li><li><div>                                            }  catch ( Exception $e ) {&nbsp;</div></li><li><div>                                                // Something went wrong.&nbsp;</div></li><li><div>                                                $error_message = 'SimpleXMLElement threw an exception.';&nbsp;</div></li><li><div>                                                foreach( libxml_get_errors() as $error_line ) {&nbsp;</div></li><li><div>                                                    $error_message .= &quot;\t&quot; . $error_line-&gt;message;&nbsp;</div></li><li><div>                                                }&nbsp;</div></li><li><div>                                                trigger_error( $error_message );&nbsp;</div></li><li><div>                                                return false;&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                            return $xml;&nbsp;</div></li><li><div>                                        } // end function produce&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // Create SimpleXML Object&nbsp;</div></li><li><div>                                    $xml = produce_XML_object_tree ( $response );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    if( $xml === false ) {&nbsp;</div></li><li><div>                                        echo 'Sorry there has been a problem with your feed.';&nbsp;</div></li><li><div>                                    } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // TODO: create a helper function&nbsp;</div></li><li><div>        $cws_debug = get_query_var( 'cws_debug' );&nbsp;</div></li><li><div>        if( $_GET[&quot;cws_debug&quot;] == &quot;1&quot; ) { &nbsp;</div></li><li><div>            echo &quot;&lt;pre&gt;&quot; . print_r( $xml, true ) . &quot;&lt;/pre&gt;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        $xml-&gt;registerXPathNamespace('gphoto', 'http://schemas.google.com/photos/2007');&nbsp;</div></li><li><div>                                        $xml-&gt;registerXPathNamespace('media', 'http://search.yahoo.com/mrss/');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                        // register namespace to get access to total number of albums found&nbsp;</div></li><li><div>                                        $xml-&gt;registerXPathNamespace('opensearch', 'http://a9.com/-/spec/opensearch/1.1/');&nbsp;</div></li><li><div>                                        $totalResults = $xml-&gt;xpath( &quot;opensearch:totalResults&quot; );&nbsp;</div></li><li><div>                                        $total_num_albums = $totalResults[0]; &nbsp;</div></li><li><div>                                    ?&gt;&nbsp;</div></li><li><div>                                        &lt;table class=&quot;wp-list-table widefat fixed posts&quot;&gt;&nbsp;</div></li><li><div>                                            &lt;thead&gt;&nbsp;</div></li><li><div>                                             &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                                                  &lt;th scope=&quot;row&quot; width=&quot;100&quot;&gt;Album Name &lt;/th&gt;&nbsp;</div></li><li><div>                                                  &lt;!--&lt;th scope=&quot;row&quot; width=&quot;70&quot;&gt;Published&lt;/th&gt;&nbsp;</div></li><li><div>                                                  &lt;th scope=&quot;row&quot; width=&quot;50&quot;&gt;Num Photos &lt;/th&gt; --&gt;&nbsp;</div></li><li><div>                                                  &lt;th scope=&quot;row&quot; width=&quot;100&quot;&gt;Album ID &lt;/th&gt;&nbsp;</div></li><li><div>                                                  &lt;th scope=&quot;row&quot;&gt;Example shortcode&lt;/th&gt;&nbsp;</div></li><li><div>                                             &lt;/tr&gt;&nbsp;</div></li><li><div>                                            &lt;/thead&gt;&nbsp;</div></li><li><div>                                    &lt;?php&nbsp;</div></li><li><div>                                        // loop over the albums&nbsp;</div></li><li><div>                                        foreach( $xml-&gt;entry as $feed ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                            // get the data we need&nbsp;</div></li><li><div>                                            $title = $feed-&gt;title;&nbsp;</div></li><li><div>                                            &nbsp;</div></li><li><div>                                            $gphoto = $feed-&gt;children( 'http://schemas.google.com/photos/2007' );&nbsp;</div></li><li><div>                                            $num_photos = $gphoto-&gt;numphotos; &nbsp;</div></li><li><div>                                            $published = $feed-&gt;published; &nbsp;</div></li><li><div>                                            $published = trim( $published );&nbsp;</div></li><li><div>                                            $published = substr( $published, 0, 10 );      &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                            $group = $feed-&gt;xpath( './media:group/media:thumbnail' );&nbsp;</div></li><li><div>                                            $a = $group[0]-&gt;attributes(); // we need thumbnail path&nbsp;</div></li><li><div>                                            $id = $feed-&gt;xpath( './gphoto:id' ); // and album id for our thumbnail&nbsp;</div></li><li><div>                                            ?&gt;&nbsp;</div></li><li><div>                                                &lt;tbody data-wp-lists=&quot;list:post&quot; id=&quot;the-list&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                    &lt;tr&gt;&nbsp;</div></li><li><div>                                                        &lt;td class=&quot;title column-title&quot;&gt;&nbsp;</div></li><li><div>                                                            &lt;strong&gt;&lt;?php echo $title;?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>                                                        &lt;/td&gt;&nbsp;</div></li><li><div>                                                        &lt;td class=&quot;shortcode column-deescription&quot;&gt;&lt;?php echo $id[0];?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                                                        &lt;td class=&quot;shortcode column-shortcode&quot;&gt;&nbsp;</div></li><li><div>                                                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_images_by_albumid id=&quot;&lt;?php echo $id[0];?&gt;&quot;]&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;                                     &nbsp;</div></li><li><div>                                                    &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                                 &lt;/tbody&gt;&nbsp;</div></li><li><div>                                            &lt;?php&nbsp;</div></li><li><div>                                        } // end foreach&nbsp;</div></li><li><div>                                    ?&gt;&nbsp;</div></li><li><div>                                            &lt;foot&gt;&nbsp;</div></li><li><div>                                             &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                                                  &lt;th scope=&quot;row&quot;&gt;Album Name &lt;/th&gt;&nbsp;</div></li><li><div>                                                  &lt;!-- &lt;th scope=&quot;row&quot;&gt;Published&lt;/th&gt;&nbsp;</div></li><li><div>                                                  &lt;th scope=&quot;row&quot;&gt;Num Photos &lt;/th&gt; --&gt;                               &nbsp;</div></li><li><div>                                                  &lt;th scope=&quot;row&quot;&gt;Album ID &lt;/th&gt;&nbsp;</div></li><li><div>                                                  &lt;th scope=&quot;row&quot;&gt;Example shortcode &lt;/th&gt;&nbsp;</div></li><li><div>                                             &lt;/tr&gt;&nbsp;</div></li><li><div>                                            &lt;/foot&gt;                                  &nbsp;</div></li><li><div>                                        &lt;/table&gt;                        &nbsp;</div></li><li><div>                                    &lt;?php&nbsp;</div></li><li><div>                                    } // end else&nbsp;</div></li><li><div>                                    ?&gt;&nbsp;</div></li><li><div>                            &lt;/div&gt; &lt;!-- / . postbox --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            &lt;h3&gt;Shortcode Usage Examples&lt;/h3&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            &lt;h4&gt;Display Albums Covers in a Carousel&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_albums theme='carousel' results_page='page-slug-here' show_titles=1]&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;       &nbsp;</div></li><li><div>                                &nbsp;</div></li><li><div>                            &lt;h4&gt;Display Album Covers in a Grid View&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_albums theme='grid' results_page='page-slug-here' show_details='1' num_results=5]&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            &lt;h4&gt;Display Album Covers in a List View&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_albums theme='list' results_page='page-slug-here' show_title='1' show_details='1' thumb_size='250' num_results='3' visibility='all']&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            &lt;h4&gt;Display Images from Clicked Album Cover in a Carousel View&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_images_in_album theme='carousel' show_title=0 thumbsize='150']&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            &lt;h4&gt;Display Images from Clicked Album Cover in a Grid View&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_images_in_album theme='grid' show_title=1 show_details='1']&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            &lt;h4&gt;Display Images from Clicked Album Cover in a List View&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_images_in_album theme='list' show_title=1 show_details=1 num_results='13' thumb_size='250']&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;  &nbsp;</div></li><li><div>                            &lt;!--&nbsp;</div></li><li><div>                            &lt;h4&gt;Display Images from Clicked Album Cover in a Expander View, great for when there are long Captions.&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_images_in_album theme='expander' show_title=0]&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;  &nbsp;</div></li><li><div>                            --&gt;&nbsp;</div></li><li><div>                            &lt;h4&gt;Display Images in a Specific Album. Only one album per page.&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_images_by_albumid id='05218507736478682657' theme='grid' show_title='0' show_details='0']&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            &lt;!-- &lt;h4&gt;Display Album Images in Photo Booth Strips&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_albums theme='propbs' show_details='1' num_results='4']&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            &lt;h4&gt;Display Album Covers in Polaroid Scatter Grid&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;input size=&quot;80&quot; type=&quot;text&quot; class=&quot;shortcode-in-list-table wp-ui-text-highlight code&quot; value=&quot;[cws_gpp_albums theme='propsg' results_page='results-grid' show_details='1']&quot; readonly=&quot;readonly&quot; onfocus=&quot;this.select();&quot;&gt;  &nbsp;</div></li><li><div>                            &lt;p&gt;Theme options supported by the results page for this are 'grid', 'list', 'carousel' &lt;/p&gt; --&gt;&nbsp;</div></li><li><div>                        &lt;/div&gt; &lt;!-- / meta holder --&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt; &lt;!-- / .postbox-container --&gt;&nbsp;</div></li><li><div>            &lt;?php   } else { ?&gt;&nbsp;</div></li><li><div>            &lt;?php       // Display upgrade content if not Pro&nbsp;</div></li><li><div>                        echo $plugin_admin-&gt;cws_gpp_upgrade_content(); &nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>               } &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;/div&gt;&lt;!-- / left --&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        } // end function options_page_sc()&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Draw the Options page for the admin area.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function options_page() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $this-&gt;deauthorizeGoogleAccount() ) {&nbsp;</div></li><li><div>            // TODO: finsish this delete_option unset()&nbsp;</div></li><li><div>            delete_option( 'cws_gpp_reset' );&nbsp;</div></li><li><div>            delete_option( 'cws_gpp_token_expires' );&nbsp;</div></li><li><div>            delete_option( 'cws_gpp_code' );&nbsp;</div></li><li><div>            delete_option( 'cws_gpp_access_token' );&nbsp;</div></li><li><div>        } ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>        &lt;?php screen_icon(); ?&gt;&nbsp;</div></li><li><div>            &lt;h2&gt;Google Picasa &lt;?php echo $this-&gt;get_Pro( $this-&gt;isPro );?&gt; Settings&lt;/h2&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;div class=&quot;widget-liquid-left&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php &nbsp;</div></li><li><div>                // Step 1:  The user has not authenticated we give them a link to login    &nbsp;</div></li><li><div>                if( $this-&gt;isAuthenticated() !== true ) {&nbsp;</div></li><li><div>                    // settings_fields( $option_group )&nbsp;</div></li><li><div>                    // Output nonce, action, and option_page fields for a settings page. Please note that this function must be called inside of the form tag for the options page.&nbsp;</div></li><li><div>                    // $option_group - A settings group name. This should match the group name used in register_setting(). &nbsp;</div></li><li><div>                    settings_fields( 'cws_gpp_code' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // do_settings_sections( $page );&nbsp;</div></li><li><div>                    // Prints out all settings sections added to a particular settings page.&nbsp;</div></li><li><div>                    // The slug name of the page whose settings sections you want to output. This should match the page name used in add_settings_section().&nbsp;</div></li><li><div>                    do_settings_sections( 'cws_gpp' ); &nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;input name=&quot;Submit&quot; type=&quot;submit&quot; value=&quot;Save Changes&quot; /&gt;  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;/form&gt; &nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>                } &nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    /**&nbsp;</div></li><li><div>                     * User is authenticated so display plugin config settings&nbsp;</div></li><li><div>                     * &nbsp;</div></li><li><div>                     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Get Access Token&nbsp;</div></li><li><div>                    $token = $this-&gt;getAccessToken();&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                    settings_fields( 'cws_gpp_options' );&nbsp;</div></li><li><div>                    do_settings_sections( 'cws_gpp_defaults' );&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;input name=&quot;Submit&quot; type=&quot;submit&quot; value=&quot;Save Changes&quot; /&gt;  &nbsp;</div></li><li><div>                &lt;/form&gt; &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;form action=&quot;options.php&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php   settings_fields( 'cws_gpp_reset' );&nbsp;</div></li><li><div>                    do_settings_sections( 'cws_gpp_reset' );  &nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>                    &lt;input name=&quot;Submit&quot; type=&quot;submit&quot; value=&quot;Deauthorise&quot; onclick=&quot;if(!this.form.reset.checked) {alert('You must click the checkbox to confirm you want to deauthorize current Google account.');return false}&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;/form&gt;                             &nbsp;</div></li><li><div>            &lt;?php                      &nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;/div&gt;&lt;!-- / left --&gt;&nbsp;</div></li><li><div>                &lt;?php $this-&gt;cws_gpp_meta_box_feedback(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>                if( !$this-&gt;isPro == 1 ) {&nbsp;</div></li><li><div>                    // Only call for the upgrade meta box if this is not a Pro install&nbsp;</div></li><li><div>                    $this-&gt;cws_gpp_meta_box_pro(); &nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Display a feedback links&nbsp;</div></li><li><div>    public function cws_gpp_meta_box_feedback() {&nbsp;</div></li><li><div>    ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;div class=&quot;widget-liquid-right&quot;&gt;&nbsp;</div></li><li><div>            &lt;div id=&quot;widgets-right&quot;&gt;    &nbsp;</div></li><li><div>                &lt;div style=&quot;width:20%;&quot; class=&quot;postbox-container side&quot;&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;metabox-holder&quot;&gt;&nbsp;</div></li><li><div>                        &lt;div class=&quot;postbox&quot; id=&quot;feedback&quot;&gt;&nbsp;</div></li><li><div>                            &lt;h3&gt;&lt;span&gt;Please rate the plugin!&lt;/span&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>                            &lt;div class=&quot;inside&quot;&gt;                            &nbsp;</div></li><li><div>                                &lt;p&gt;If you have found this useful please leave us a &lt;a href=&quot;http://wordpress.org/extend/plugins/google-picasa-albums-viewer/&quot;&gt;good rating&lt;/a&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                                &lt;p&gt;&raquo; Share it with your friends &lt;a href=&quot;&lt;?php echo &quot;http://twitter.com/share?url=http://bit.ly/q4nqNA&text=Check out this awesome WordPress Plugin I'm using - Google Picasa Viewer&quot; ?&gt;&quot;&gt;Tweet It&lt;/a&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                                &lt;p&gt;If you have found a bug please email me &lt;a href=&quot;mailto:info@cheshirewebsolutions.com?subject=Feedback%20Google%20Picasa%20Viewer&quot;&gt;info@cheshirewebsolutions.com&lt;/a&gt;&lt;/p&gt;                               &nbsp;</div></li><li><div>                        &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;  &nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>    &lt;/div&gt;  &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>    &lt;?php&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Display a Picasa Pro Promo Box&nbsp;</div></li><li><div>    function cws_gpp_meta_box_pro() {&nbsp;</div></li><li><div>    ?&gt;&nbsp;</div></li><li><div>    &lt;div class=&quot;widget-liquid-right&quot;&gt;&nbsp;</div></li><li><div>        &lt;div id=&quot;widgets-right&quot;&gt;&nbsp;</div></li><li><div>            &lt;!-- &lt;div style=&quot;width:20%;&quot; class=&quot;postbox-container side&quot;&gt; --&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;postbox-container side&quot;&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;metabox-holder&quot;&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;postbox&quot; id=&quot;donate&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php echo $this-&gt;cws_gpp_upgrade_content(); ?&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>    &lt;/div&gt;&lt;?php   &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // seperate upgrade content from markup so can use content in more places, like shortcode snippets page and pro shortcodes in the frontend&nbsp;</div></li><li><div>    function cws_gpp_upgrade_content() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $strOutput = &quot;&lt;h3&gt;&lt;span&gt;Get Google Picasa Pro!&lt;/span&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>                    &lt;div class=\&quot;inside\&quot;&gt;&nbsp;</div></li><li><div>                        &lt;p&gt;Grab yourself the &lt;a href=\&quot;http://www.cheshirewebsolutions.com/?utm_source=cws_gpp_config&utm_medium=text-link&utm_content=meta_box_pro&utm_campaign=cws_gpp_plugin\&quot;&gt;Pro&lt;/a&gt; version of the plugin.                        &nbsp;</div></li><li><div>                        &lt;a href=\&quot;http://www.cheshirewebsolutions.com/?utm_source=wp_gp_viewer&utm_medium=wp_plugin&utm_content=meta_box_download_it_here&utm_campaign=plugin_upgrade\&quot;&gt;Download it here&lt;/a&gt; &lt;span&gt;&lt;strong&gt;GET 25% OFF!&lt;/strong&gt; * use discount code &lt;strong&gt;WPMEGA25&lt;/strong&gt; on checkout&lt;/span&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                        &lt;h3&gt;&nbsp;</div></li><li><div>                            Reasons to UPGRADE!&nbsp;</div></li><li><div>                        &lt;/h3&gt;&nbsp;</div></li><li><div>                        &lt;ol&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Priority Email Support!&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;It*s much faster! We cache the Google Feed&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Justified Image Grid Layout&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Touch enabled lightbox, flick to the next or previous image, spread to zoom in etc&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Native HTML5 full screen lightbox&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Display image description as caption in lightbox&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Social sharing&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Customisable Lightbox Dimensions! have it as big as you like&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Fantastic hover style effects&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Display images in a specific album! just supply the album id&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Helpful Shortcode Snippets Admin page!&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Powered by link has been removed!&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;Included Download Original Image link&lt;/li&gt;&nbsp;</div></li><li><div>                        &lt;/ol&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;/div&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $strOutput;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register Settings, Settings Section and Settings Fileds.&nbsp;</div></li><li><div>     * &nbsp;</div></li><li><div>     * @link    https://codex.wordpress.org/Function_Reference/register_setting&nbsp;</div></li><li><div>     * @link    https://codex.wordpress.org/Function_Reference/add_settings_section&nbsp;</div></li><li><div>     * @link    https://codex.wordpress.org/Function_Reference/add_settings_field&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    public function register_plugin_settings() {&nbsp;</div></li><li><div>        // register_setting( $option_group, $option_name, $sanitize_callback ).&nbsp;</div></li><li><div>        // $option_group - A settings group name. Must exist prior to the register_setting call. This must match the group name in settings_fields().&nbsp;</div></li><li><div>        // $option_name - The name of an option to sanitize and save.&nbsp;</div></li><li><div>        // $sanitize_callback - A callback function that sanitizes the option's value.&nbsp;</div></li><li><div>        register_setting( 'cws_gpp_code', 'cws_gpp_code', array( $this, 'validate_options' ) );&nbsp;</div></li><li><div>        register_setting( 'cws_gpp_options', 'cws_gpp_options', array( $this, 'validate_main_options' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        register_setting( 'cws_gpp_reset', 'cws_gpp_reset', array( $this, 'validate_reset_options' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // add_settings_section( $id, $title, $callback, $page )&nbsp;</div></li><li><div>        // $id - String for use in the 'id' attribute of tags&nbsp;</div></li><li><div>        // $title - Title of the section&nbsp;</div></li><li><div>        // $callback - Function that fills the section with the desired content. The function should echo its output.&nbsp;</div></li><li><div>        // $page - The menu page on which to display this section. Should match $menu_slug in add_options_page();&nbsp;</div></li><li><div>        add_settings_section( 'cws_gpp_add_code', 'Authenticate with Google', array( $this, 'section_text' ), 'cws_gpp' );&nbsp;</div></li><li><div>        add_settings_section( 'cws_gpp_add_options', 'Default Settings', array( $this, 'section_main_text' ), 'cws_gpp_defaults' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_settings_section( 'cws_gpp_add_reset', 'Deauthorise Plugin from your Google Account', array( $this, 'section_reset_text' ), 'cws_gpp_reset' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // add_settings_field( $id, $title, $callback, $page, $section, $args );&nbsp;</div></li><li><div>        // $id - String for use in the 'id' attribute of tags&nbsp;</div></li><li><div>        // $title - Title of the field&nbsp;</div></li><li><div>        // $callback - Function that fills the field with the desired inputs as part of the larger form. Passed a single argument, &nbsp;</div></li><li><div>        // the $args array. Name and id of the input should match the $id given to this function. The function should echo its output.&nbsp;</div></li><li><div>        // $page - The menu page on which to display this field. Should match $menu_slug in add_options_page();&nbsp;</div></li><li><div>        // $section - (optional) The section of the settings page in which to show the box. A section added with add_settings_section() [optional]&nbsp;</div></li><li><div>        // $args - (optional) Additional arguments that are passed to the $callback function&nbsp;</div></li><li><div>        add_settings_field( 'cws_myplugin_oauth2_code', 'Enter Google Access Code here', array( $this, 'setting_input' ), 'cws_gpp', 'cws_gpp_add_code' );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add default option field - Thumbnail Size &nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_thumbnail_size', 'Thumbnail Size (px)', array( $this, 'options_thumbnail_size' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add default option field - Album Thumbnail Size &nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_album_thumbnail_size', 'Album Thumbnail Size (px)', array( $this, 'options_album_thumbnail_size' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $this-&gt;isPro ) {&nbsp;</div></li><li><div>            // PRO ONLY&nbsp;</div></li><li><div>            // Add default option field - Lighbox Image Size &nbsp;</div></li><li><div>            add_settings_field( 'cws_gpp_lightbox_image_size', 'Lightbox Image Size (px)', array( $this, 'options_lightbox_image_size' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );        &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Add default option field - Number of image results&nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_num_image_results', 'Number of images per page', array( $this, 'options_num_image_results' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add default option field - Number of album results&nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_num_album_results', 'Number of albums per page', array( $this, 'options_num_album_results' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Add default option checkbox - Show private albums checkbox&nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_show_private_albums', 'Show which albums', array( $this, 'options_show_private_albums' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );        &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add default option checkbox - Show album title&nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_show_album_title', 'Show Album Title', array( $this, 'options_show_album_title' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );   &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add default option checkbox - Show image title&nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_show_image_title', 'Show Image Title', array( $this, 'options_show_image_title' ), 'cws_gpp_defaults', 'cws_gpp_add_options' ); &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add default option checkbox - Show album details&nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_show_album_details', 'Show Album Details', array( $this, 'options_show_album_details' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );   &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add default option checkbox - Show image details&nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_show_image_details', 'Show Image Details', array( $this, 'options_show_image_details' ), 'cws_gpp_defaults', 'cws_gpp_add_options' ); &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if( $this-&gt;isPro ) {&nbsp;</div></li><li><div>            // PRO ONLY&nbsp;</div></li><li><div>            // Add default option checkbox - Enable Cache&nbsp;</div></li><li><div>            add_settings_field( 'cws_gpp_enable_cache', 'Enable Cache', array( $this, 'options_enable_cache' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );&nbsp;</div></li><li><div>            // Add default option checkbox - Expose Original file&nbsp;</div></li><li><div>            add_settings_field( 'cws_gpp_enable_download', 'Download Original Image Link', array( $this, 'options_enable_download' ), 'cws_gpp_defaults', 'cws_gpp_add_options' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add reset option&nbsp;</div></li><li><div>        add_settings_field( 'cws_gpp_reset', 'Click here to confirm you want to deauthorise plugin from your google account', array( $this, 'options_reset' ), 'cws_gpp_reset', 'cws_gpp_add_reset' );   &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Draw the Section Header for the admin area.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function section_text() {&nbsp;</div></li><li><div>        echo 'You need to click here to authorize access and paste the Access Code provided by Google in the field below.';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // get the google authorisation url&nbsp;</div></li><li><div>        $authUrl = $this-&gt;client-&gt;createAuthUrl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // display the google authorisation url&nbsp;</div></li><li><div>        echo $this-&gt;createAuthLink( $authUrl );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $code = get_option( 'cws_gpp_code' );&nbsp;</div></li><li><div>        $oauth2_code = $code['oauth2_code'];&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $token = get_option( 'cws_gpp_access_token' );&nbsp;</div></li><li><div>        $token = $token['access_token'];&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>        if ( isset( $code['oauth2_code'] ) ) {&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $this-&gt;client-&gt;authenticate( $code['oauth2_code'] );  &nbsp;</div></li><li><div>            $AccessToken = $this-&gt;client-&gt;getAccessToken();&nbsp;</div></li><li><div>            $AccessToken = json_decode( $AccessToken, TRUE );&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // delete code&nbsp;</div></li><li><div>               $code = get_option( 'cws_gpp_code' );&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if ( $code ) {&nbsp;</div></li><li><div>                unset($code['oauth2_code']);&nbsp;</div></li><li><div>                update_option( 'cws_gpp_code', $code );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>            // store access token&nbsp;</div></li><li><div>            if( update_option( 'cws_gpp_access_token', $AccessToken ) )&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                if( $this-&gt;debug ) error_log( 'Update option: cws_gpp_access_token' );&nbsp;</div></li><li><div>               &nbsp;</div></li><li><div>                // store token expires&nbsp;</div></li><li><div>                $now = date(&quot;U&quot;);&nbsp;</div></li><li><div>                $token_expires = $now + $AccessToken['expires_in'];&nbsp;</div></li><li><div>                add_option( 'cws_gpp_token_expires', $token_expires );      &nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                $url = admin_url( &quot;options-general.php?page=&quot;.$_GET[&quot;page&quot;] );&nbsp;</div></li><li><div>                // error_log($url);&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                wp_redirect( &quot;$url&quot; );&nbsp;</div></li><li><div>                exit;               &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }        &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function section_main_text() {&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    //&nbsp;</div></li><li><div>    function section_reset_text() {&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>    }   &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function section() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    } &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the Access Token stored in db.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    public function getAccessToken() {&nbsp;</div></li><li><div>        $token = get_option( 'cws_gpp_access_token' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $token;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the authourisation link.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */     &nbsp;</div></li><li><div>    public function createAuthLink( $authUrl ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $authUrl ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $output = &quot;&lt;br&gt;&lt;br&gt;&lt;a class='login' href='$authUrl' target='_blank'&gt;Connect My Google Account&lt;/a&gt;&quot;; &nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $output = &quot;There was a problem generating the Google Autherisation link&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** GOOD WORKFLOW OF STEPS https://www.domsammut.com/code/php-server-side-youtube-v3-oauth-api-video-upload-guide **/   &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the Reset option stored in db.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */  &nbsp;</div></li><li><div>    public function deauthorizeGoogleAccount() {&nbsp;</div></li><li><div>        // get options from db&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( get_option( 'cws_gpp_reset' ) ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        } &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function isAuthenticated() {&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // get options from db&nbsp;</div></li><li><div>        $code = get_option( 'cws_gpp_code' );&nbsp;</div></li><li><div>        $token = get_option( 'cws_gpp_access_token' );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if ( !isset( $token['access_token'] ) ) {&nbsp;</div></li><li><div>            // get oauth2 code&nbsp;</div></li><li><div>            //$this-&gt;getOAuthToken();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else{&nbsp;</div></li><li><div>            // check if it needs refreshing&nbsp;</div></li><li><div>            $now = date(&quot;U&quot;);&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // get cws_gpp_token_expires&nbsp;</div></li><li><div>            $token_expires = get_option( 'cws_gpp_token_expires' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // check if $now is greater than cws_gpp_token_expires&nbsp;</div></li><li><div>            if ( $now &gt; $token_expires ) {&nbsp;</div></li><li><div>                $this-&gt;refreshToken(); &nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }   &nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    public function refreshToken() {&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if($this-&gt;debug) { error_log('Inside refreshToken()'); }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $GOOGLE_OAUTH2_REFERER = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get access token and refresh it      &nbsp;</div></li><li><div>        $now = date( &quot;U&quot; );&nbsp;</div></li><li><div>        $clientId = '806353319710-g782kn9ed0gm77ucl0meen5ohs84qgqm.apps.googleusercontent.com';&nbsp;</div></li><li><div>        $clientSecret = 'P6BMMEWLKUSoxB48X2Tzu8ds';&nbsp;</div></li><li><div>        $token = get_option( 'cws_gpp_access_token' );&nbsp;</div></li><li><div>        $refreshToken = $token['refresh_token'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $postBody = 'client_id='.urlencode($clientId)&nbsp;</div></li><li><div>                  .'&client_secret='.urlencode($clientSecret)&nbsp;</div></li><li><div>                  .'&refresh_token='.urlencode($refreshToken)&nbsp;</div></li><li><div>                  .'&grant_type=refresh_token';&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>        $curl = curl_init();&nbsp;</div></li><li><div>        curl_setopt_array( $curl, &nbsp;</div></li><li><div>                         array( CURLOPT_CUSTOMREQUEST =&gt; 'POST'&nbsp;</div></li><li><div> , CURLOPT_URL =&gt; 'https://www.googleapis.com/oauth2/v3/token'&nbsp;</div></li><li><div> , CURLOPT_HTTPHEADER =&gt; array( 'Content-Type: application/x-www-form-urlencoded'&nbsp;</div></li><li><div> , 'Content-Length: '.strlen($postBody)&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> , CURLOPT_POSTFIELDS =&gt; $postBody                              &nbsp;</div></li><li><div> , CURLOPT_REFERER =&gt; $GOOGLE_OAUTH2_REFERER&nbsp;</div></li><li><div> , CURLOPT_RETURNTRANSFER =&gt; 1    // means output will be a return value from curl_exec() instead of simply echoed&nbsp;</div></li><li><div> , CURLOPT_TIMEOUT =&gt; 12          // max seconds to wait&nbsp;</div></li><li><div> , CURLOPT_FOLLOWLOCATION =&gt; 0    // don't follow any Location headers, use only the CURLOPT_URL, this is for security&nbsp;</div></li><li><div> , CURLOPT_FAILONERROR =&gt; 0       // do not fail verbosely fi the http_code is an error, this is for security&nbsp;</div></li><li><div> , CURLOPT_SSL_VERIFYPEER =&gt; 0    // do verify the SSL of CURLOPT_URL, this is for security&nbsp;</div></li><li><div> , CURLOPT_VERBOSE =&gt; 0           // don't output verbosely to stderr, this is for security&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $orig_response = curl_exec( $curl );&nbsp;</div></li><li><div>        $response = json_decode( $orig_response, true );        // convert returned objects into associative arrays&nbsp;</div></li><li><div>        $token_expires = $now + $response['expires_in'];&nbsp;</div></li><li><div>        $http_code = curl_getinfo( $curl, CURLINFO_HTTP_CODE );&nbsp;</div></li><li><div>        curl_close( $curl );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $response['access_token'] ) {            &nbsp;</div></li><li><div>            // get options update access token part&nbsp;</div></li><li><div>            $token = get_option( 'cws_gpp_access_token' );&nbsp;</div></li><li><div>            $token['access_token'] = $response['access_token'];&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            update_option(&quot;cws_gpp_access_token&quot;, $token);                            # save the access token&nbsp;</div></li><li><div>            update_option(&quot;cws_gpp_token_expires&quot;, $token_expires);                   # save the epoch when the token expires&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            if( $this-&gt;debug ) { error_log( 'Refresh Access Token...' ); }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $url = $this-&gt;getUrl();&nbsp;</div></li><li><div>            wp_redirect( &quot;$url&quot; );&nbsp;</div></li><li><div>            exit;        &nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // echo &quot;refreshOAuth2Token got the following response:&lt;br /&gt;&quot;;&nbsp;</div></li><li><div>            // echo $orig_response;&nbsp;</div></li><li><div>            // echo &quot;using refreshToken $refreshToken&quot;;&nbsp;</div></li><li><div>        }  &nbsp;</div></li><li><div>        // TODO: Improve error handling here for various curl error codes etc      &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get current url.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.3.0&nbsp;</div></li><li><div>     */ &nbsp;</div></li><li><div>    function getUrl() {&nbsp;</div></li><li><div>        $url = ( $_SERVER[&quot;HTTPS&quot;] != 'on' ) ? 'http://'.$_SERVER[&quot;SERVER_NAME&quot;] :  'https://'.$_SERVER[&quot;SERVER_NAME&quot;];&nbsp;</div></li><li><div>        $url .= ( $_SERVER[&quot;SERVER_PORT&quot;] != 80 ) ? &quot;:&quot;.$_SERVER[&quot;SERVER_PORT&quot;] : &quot;&quot;;&nbsp;</div></li><li><div>        $url .= $_SERVER[&quot;REQUEST_URI&quot;];&nbsp;</div></li><li><div>        return $url;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get list of Albums for authenticated user.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */     &nbsp;</div></li><li><div>    public function getAlbumList( $AccessToken, $album_thumb_size, $show_title, $cws_page, $num_image_results, $visibility) {    &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if( $this-&gt;debug ) { error_log( 'Inside getAlbumList()' ); }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Work out pagination variables&nbsp;</div></li><li><div>        if ( !( isset( $cws_page ) ) ) {&nbsp;</div></li><li><div>            $cws_page = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $cws_page &gt; 1 ) {&nbsp;</div></li><li><div>            $start_index = ( ( $cws_page - 1 ) * $num_image_results ) + 1;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $start_index = 1;&nbsp;</div></li><li><div>        }            &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $visibility = strtolower( $visibility );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // https://developers.google.com/accounts/docs/OAuth2WebServer#callinganapi&nbsp;</div></li><li><div>        $curl = curl_init();&nbsp;</div></li><li><div>        // https://developers.google.com/picasa-web/docs/2.0/reference#Visibility&nbsp;</div></li><li><div>        // http://picasaweb.google.com/data/feed/api/user/userID?kind=photo&q=penguin&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // limit results or not&nbsp;</div></li><li><div>        if( $num_image_results &gt; 0 ) {&nbsp;</div></li><li><div>            $url = &quot;https://picasaweb.google.com/data/feed/api/user/default?kind=album&thumbsize=&quot; . $album_thumb_size . &quot;c&max-results=&quot; . $num_image_results . &quot;&start-index=&quot; . $start_index . &quot;&access=&quot; . $visibility;&nbsp;</div></li><li><div>            //$url = &quot;https://picasaweb.google.com/data/feed/api/user/default?kind=album&thumbsize=&quot; . $album_thumb_size . &quot;c&max-results=&quot; . $num_image_results . &quot;&start-index=&quot; . $start_index ;            &nbsp;</div></li><li><div>            //$url = &quot;https://picasaweb.google.com/data/feed/api/user/default?kind=album&thumbsize=&quot; . $album_thumb_size . &quot;c&max-results=&quot; . $num_image_results . &quot;&start-index=&quot; . $start_index . &quot;&access=all&quot;;                  &nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $url = &quot;https://picasaweb.google.com/data/feed/api/user/default?kind=album&thumbsize=&quot; . $album_thumb_size . &quot;c&access=&quot; . $visibility;&nbsp;</div></li><li><div>            // $url = &quot;https://picasaweb.google.com/data/feed/api/user/default?kind=album&thumbsize=&quot; . $album_thumb_size . &quot;c&quot;;&nbsp;</div></li><li><div>            //$url = &quot;https://picasaweb.google.com/data/feed/api/user/default?kind=album&thumbsize=&quot; . $album_thumb_size . &quot;c&access=visible&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // TODO: create a helper function&nbsp;</div></li><li><div>        $cws_debug = get_query_var( 'cws_debug' );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if( $cws_debug == &quot;1&quot; ) { &nbsp;</div></li><li><div>            echo &quot;url = $url&lt;br&gt;&quot;; &nbsp;</div></li><li><div>            echo &quot;show_title = $show_title&lt;br&gt;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        curl_setopt_array( $curl, &nbsp;</div></li><li><div>                         array( CURLOPT_CUSTOMREQUEST =&gt; 'GET'&nbsp;</div></li><li><div> , CURLOPT_URL =&gt; $url&nbsp;</div></li><li><div> , CURLOPT_HTTPHEADER =&gt; array( 'GData-Version: 2'&nbsp;</div></li><li><div> , 'Authorization: Bearer '.$AccessToken['access_token'] )&nbsp;</div></li><li><div> , CURLOPT_REFERER =&gt; 'http://wp-picasa-pro.wordpress.dev/wp-admin/options-general.php?page=cws_gpp'&nbsp;</div></li><li><div> , CURLOPT_RETURNTRANSFER =&gt; 1 // means output will be a return value from curl_exec() instead of simply echoed&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        $response = curl_exec($curl);&nbsp;</div></li><li><div>        $http_code = curl_getinfo($curl, CURLINFO_HTTP_CODE);&nbsp;</div></li><li><div>        curl_close($curl);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Return $response to shortcode if http_code is 200&nbsp;</div></li><li><div>        if( $http_code == 200 ) { return $response; }&nbsp;</div></li><li><div>        // TODO: Add in some error handling better reporting of http code&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get list of Images in a specific Album for authenticated user.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    // public function getAlbumImages( $AccessToken, $album_thumb_size, $show_album_ttl, $cws_page, $num_image_results, $cws_album, $imgmax='450' ) {&nbsp;</div></li><li><div>    public function getAlbumImages( $AccessToken, $album_thumb_size, $show_album_ttl, $cws_page, $num_image_results, $cws_album, $imgmax='450', $theme ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Crop the image or not, projig wants not cropped...&nbsp;</div></li><li><div>        if ( $theme != 'projig' ) { $crop = 'c'; } else { $crop = ''; }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $imgmax == 0 || $imgmax == 0 ) { $imgmax = 450; }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $this-&gt;debug ) { error_log( 'Inside getAlbumImages()' ); }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Work out pagination variables&nbsp;</div></li><li><div>        if ( !( isset( $cws_page ) ) ) {&nbsp;</div></li><li><div>            $cws_page = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $cws_page &gt; 1 ) {&nbsp;</div></li><li><div>            $start_index = ( ( $cws_page - 1 ) * $num_image_results ) + 1;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $start_index = 1;&nbsp;</div></li><li><div>        }   &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $curl = curl_init();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $num_image_results &gt; 0 ) {&nbsp;</div></li><li><div>            // $url = &quot;https://picasaweb.google.com/data/feed/api/user/default/albumid/&quot; . $cws_album . &quot;?thumbsize=&quot; . $album_thumb_size . &quot;c&max-results=&quot; . $num_image_results . &quot;&start-index=&quot; . $start_index . &quot;&imgmax=&quot; . $imgmax;                    &nbsp;</div></li><li><div>            $url = &quot;https://picasaweb.google.com/data/feed/api/user/default/albumid/&quot; . $cws_album . &quot;?thumbsize=&quot; . $album_thumb_size . $crop . &quot;&max-results=&quot; . $num_image_results . &quot;&start-index=&quot; . $start_index . &quot;&imgmax=&quot; . $imgmax;            &nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // $url = &quot;https://picasaweb.google.com/data/feed/api/user/default/albumid/&quot; . $cws_album . &quot;?thumbsize=&quot; . $album_thumb_size . &quot;c&imgmax=&quot; . $imgmax;&nbsp;</div></li><li><div>            $url = &quot;https://picasaweb.google.com/data/feed/api/user/default/albumid/&quot; . $cws_album . &quot;?thumbsize=&quot; . $album_thumb_size . $crop . &quot;&imgmax=&quot; . $imgmax;            &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // TODO: create a helper function&nbsp;</div></li><li><div>        $cws_debug = get_query_var( 'cws_debug' );&nbsp;</div></li><li><div>//, CURLOPT_REFERER =&gt; 'http://wp-picasa-pro.wordpress.dev/wp-admin/options-general.php?page=cws_gpp'&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        curl_setopt_array( $curl, &nbsp;</div></li><li><div>                         array( CURLOPT_CUSTOMREQUEST =&gt; 'GET'&nbsp;</div></li><li><div> , CURLOPT_URL =&gt; $url&nbsp;</div></li><li><div> , CURLOPT_HTTPHEADER =&gt; array( 'GData-Version: 2'&nbsp;</div></li><li><div> , 'Authorization: Bearer '.$AccessToken['access_token'] )&nbsp;</div></li><li><div> , CURLOPT_RETURNTRANSFER =&gt; 1 // means output will be a return value from curl_exec() instead of simply echoed&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        $response = curl_exec( $curl );&nbsp;</div></li><li><div>        $http_code = curl_getinfo( $curl, CURLINFO_HTTP_CODE );&nbsp;</div></li><li><div>        curl_close( $curl );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( $cws_debug == &quot;1&quot; ) { &nbsp;</div></li><li><div>            echo &quot;url = $url&quot;;&nbsp;</div></li><li><div>            echo &quot;http code: $http_code&lt;br&gt;&quot;;&nbsp;</div></li><li><div>            echo '&lt;pre&gt;';&nbsp;</div></li><li><div>            print_r($response);&nbsp;</div></li><li><div>            echo '&lt;/pre&gt;'; &nbsp;</div></li><li><div>            var_dump($imgmax);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return $response to shortcode if http_code is 200&nbsp;</div></li><li><div>        if( $http_code == 200 ) { return $response; }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Pagination Helper&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $num_pages, int&nbsp;</div></li><li><div>     * $current_page, int&nbsp;</div></li><li><div>     * $album_id&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * return string&nbsp;</div></li><li><div>     */     &nbsp;</div></li><li><div>    public function get_pagination( $total_num_albums, $num_image_results, $cws_page, $album_id=NULL ) {&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>// global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>// echo $post-&gt;post_name;&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        if( $this-&gt;debug ) error_log( 'Inside: CWS_Google_Picasa_Pro_Admin::get_pagination()' ); &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Calcualte how many pages we need, total number of albums / number of images to display per page as set in settings of shortcode&nbsp;</div></li><li><div>        if( $num_image_results &gt; 0 ) {&nbsp;</div></li><li><div>            $num_pages = ceil( $total_num_albums / $num_image_results );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If ony need one page then do not display pagination&nbsp;</div></li><li><div>            if ( $num_pages &lt;= 1 ) {&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( ! isset( $cws_page ) || $cws_page &lt; 1 ) { $cws_page = 1; } // TODO: Do we need this check?&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Create page links&nbsp;</div></li><li><div>        $html[] = &quot;&lt;div class=\&quot;cws-pagination\&quot;&gt;&lt;ul class=\&quot;page-nav\&quot;&gt;\n&quot;;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $previous = $cws_page - 1;&nbsp;</div></li><li><div>        $next = $cws_page + 1;&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Previous link&nbsp;</div></li><li><div>        if( $previous &gt; 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // if have album id, i.e. display this on the results page&nbsp;</div></li><li><div>            if( $album_id ) {&nbsp;</div></li><li><div>                $html[] = &quot;&lt;li&gt;&lt;a href=\&quot;?cws_page=$previous&cws_album=$album_id\&quot; id='prev_page'&gt;Previous&lt;/a&gt;&lt;/li&gt;&quot;;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $html[] = &quot;&lt;li&gt;&lt;a href=\&quot;?cws_page=$previous\&quot; id='prev_page'&gt;Previous&lt;/a&gt;&lt;/li&gt;&quot;;                &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        for( $i=1; $i &lt;= $num_pages; $i++ ) {&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>            $class = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Add class to current page&nbsp;</div></li><li><div>            if( $i == $cws_page) {&nbsp;</div></li><li><div>                $class = &quot; class='selected'&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $html[] = &quot;&lt;li&quot;.$class.&quot;&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if( $album_id ) {&nbsp;</div></li><li><div>                $html[] = &quot;&lt;a href=\&quot;?cws_page=$i&cws_album=$album_id\&quot; id='page_&quot;.$i.&quot;'&gt;&quot;.$i.&quot;&lt;/a&gt;&lt;/li&gt;\n&quot;;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $html[] = &quot;&lt;a href=\&quot;?cws_page=$i\&quot; id='page_&quot;.$i.&quot;'&gt;&quot;.$i.&quot;&lt;/a&gt;&lt;/li&gt;\n&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Next link&nbsp;</div></li><li><div>        if( $next &lt;= $num_pages ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // if have album id&nbsp;</div></li><li><div>            if( $album_id ) {&nbsp;</div></li><li><div>                $html[] = &quot;&lt;li&gt;&lt;a href=\&quot;?cws_page=$next&cws_album=$album_id\&quot; id='next_page'&gt;Next&lt;/a&gt;&lt;/li&gt;&quot;;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $html[] = &quot;&lt;li&gt;&lt;a href=\&quot;?cws_page=$next\&quot; id='next_page'&gt;Next&lt;/a&gt;&lt;/li&gt;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Display Powered by link if not Pro&nbsp;</div></li><li><div>        if( !$this-&gt;isPro == 1 ) {&nbsp;</div></li><li><div>            // $html[] = &quot;&lt;/ul&gt;&lt;span&gt;Powered by: &lt;a href=\&quot;http://www.cheshirewebsolutions.com/\&quot;&gt;Cheshire Web Solutions&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;\n&quot;;&nbsp;</div></li><li><div>            $html[] = &quot;&lt;/ul&gt;&lt;span&gt;Powered by: &lt;a href=\&quot;http://www.cheshirewebsolutions.com/\&quot;&gt;Google Photos for WordPress Plugin&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;\n&quot;;            &nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $html[] = &quot;&lt;/ul&gt;&lt;/div&gt;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return implode( &quot;\n&quot;, $html );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form field.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function setting_input() {&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // get option 'oauth2_code' value from the database&nbsp;</div></li><li><div>        $code = get_option( 'cws_gpp_code' );&nbsp;</div></li><li><div>        $oauth2_code = $code['oauth2_code'];&nbsp;</div></li><li><div>        // echo the field&nbsp;</div></li><li><div>        echo &quot;&lt;input id='oauth2_code' name='cws_gpp_code[oauth2_code]' type='text' value='$oauth2_code' &gt;&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Thumbnail Size in pixels&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_thumbnail_size() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'thumb_size' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $thumb_size = $options['thumb_size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo &quot;&lt;input id='thumb_size' name='cws_gpp_options[thumb_size]' type='text' value='$thumb_size' &gt;&quot;;&nbsp;</div></li><li><div>    }    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div> &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Album Thumbnail Size in pixels&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_album_thumbnail_size() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'album_thumb_size' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $album_thumb_size = $options['album_thumb_size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo &quot;&lt;input id='album_thumb_size' name='cws_gpp_options[album_thumb_size]' type='text' value='$album_thumb_size' &gt;&quot;;&nbsp;</div></li><li><div>    }  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Lightbox Image Size in pixels&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.3.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_lightbox_image_size() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'lightbox_image_size' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $lightbox_image_size = $options['lightbox_image_size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo &quot;&lt;input id='lightbox_image_size' name='cws_gpp_options[lightbox_image_size]' type='text' value='$lightbox_image_size' &gt;&quot;;&nbsp;</div></li><li><div>    }      &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enable Cache&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * caches feed and stores for 1 hour&nbsp;</div></li><li><div>     * Pro Only&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.3.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_enable_cache() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set some defaults...&nbsp;</div></li><li><div>        $checked = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'enable_cache' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $enable_cache = $options['enable_cache'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($options['enable_cache']) { $checked = ' checked=&quot;checked&quot; '; }&nbsp;</div></li><li><div>        echo &quot;&lt;input &quot;.$checked.&quot; id='enable_cache' name='cws_gpp_options[enable_cache]' type='checkbox' /&gt;&lt;small&gt;Only check this once you are happy with other settings.&lt;/small&gt;&quot;;&nbsp;</div></li><li><div>    }  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enable Download&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Exposes download link next to each thumbnail to allow user to access original image file&nbsp;</div></li><li><div>     * Pro Only&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.3.1&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_enable_download() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set some defaults...&nbsp;</div></li><li><div>        $checked = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'enable_download' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $options['enable_download'] = isset($options['enable_download']) ? $options['enable_download'] : &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $enable_cache = $options['enable_download'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($options['enable_download']) { $checked = ' checked=&quot;checked&quot; '; }&nbsp;</div></li><li><div>        echo &quot;&lt;input &quot;.$checked.&quot; id='enable_download' name='cws_gpp_options[enable_download]' type='checkbox' /&gt;&lt;small&gt;Allow user to download original image file.&lt;/small&gt;&quot;;&nbsp;</div></li><li><div>    }  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Number of images results to display per page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_num_image_results() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'num_image_results' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $num_image_results = $options['num_image_results'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo &quot;&lt;input id='num_image_results' name='cws_gpp_options[num_image_results]' type='text' value='$num_image_results' &gt;&quot;;&nbsp;</div></li><li><div>    }       &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Number of albums results to display per page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_num_album_results() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'num_album_results' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $num_album_results = $options['num_album_results'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo &quot;&lt;input id='num_album_results' name='cws_gpp_options[num_album_results]' type='text' value='$num_album_results' &gt;&quot;;&nbsp;</div></li><li><div>    } &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Show Private Albums&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    function options_show_private_albums() {&nbsp;</div></li><li><div>        $options = get_option('cws_gpp_options'); &nbsp;</div></li><li><div>        $options['private_albums'] = isset($options['private_albums']) ? $options['private_albums'] : &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // DROP-DOWN-BOX - Name: plugin_options[dropdown1]&nbsp;</div></li><li><div>        $items = array(&quot;All&quot;, &quot;Private&quot;, &quot;Public&quot;, &quot;Visible&quot;);&nbsp;</div></li><li><div>        echo &quot;&lt;select id='cws_gpp_show_private_albums' name='cws_gpp_options[private_albums]'&gt;&quot;;&nbsp;</div></li><li><div>        foreach($items as $item) {&nbsp;</div></li><li><div>            $selected = ($options['private_albums']==$item) ? 'selected=&quot;selected&quot;' : '';&nbsp;</div></li><li><div>            echo &quot;&lt;option value='$item' $selected&gt;$item&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        echo &quot;&lt;/select&gt;&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Show Album Title&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_show_album_title() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set some defaults...&nbsp;</div></li><li><div>        $checked = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'show_album_title' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $show_album_title = $options['show_album_title'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($options['show_album_title']) { $checked = ' checked=&quot;checked&quot; '; }&nbsp;</div></li><li><div>        echo &quot;&lt;input &quot;.$checked.&quot; id='show_album_title' name='cws_gpp_options[show_album_title]' type='checkbox' /&gt;&quot;;&nbsp;</div></li><li><div>    }  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Show Image Title&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_show_image_title() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set some defaults...&nbsp;</div></li><li><div>        $checked = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'show_image_title' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $show_album_title = $options['show_image_title'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($options['show_image_title']) { $checked = ' checked=&quot;checked&quot; '; }&nbsp;</div></li><li><div>        echo &quot;&lt;input &quot;.$checked.&quot; id='show_image_title' name='cws_gpp_options[show_image_title]' type='checkbox' /&gt;&quot;;&nbsp;</div></li><li><div>    } &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Show Album Details&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    function options_show_album_details() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set some defaults...&nbsp;</div></li><li><div>        $checked = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'show_album_details' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $show_album_details = $options['show_album_details'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($options['show_album_details']) { $checked = ' checked=&quot;checked&quot; '; }&nbsp;</div></li><li><div>        echo &quot;&lt;input &quot;.$checked.&quot; id='show_album_details' name='cws_gpp_options[show_album_details]' type='checkbox' /&gt;&quot;;&nbsp;</div></li><li><div>    } &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Show Image Details&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_show_image_details() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set some defaults...&nbsp;</div></li><li><div>        $checked = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get option 'show_album_details' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_options' );&nbsp;</div></li><li><div>        $options['show_image_details'] = isset($options['show_image_details']) ? $options['show_image_details'] : &quot;&quot;;&nbsp;</div></li><li><div>        $show_image_details = $options['show_image_details'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($options['show_image_details']) { $checked = ' checked=&quot;checked&quot; '; }&nbsp;</div></li><li><div>        echo &quot;&lt;input &quot;.$checked.&quot; id='show_image_details' name='cws_gpp_options[show_image_details]' type='checkbox' /&gt;&quot;;&nbsp;</div></li><li><div>    } &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display and fill the form fields for storing defaults.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Show Album Details&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */    &nbsp;</div></li><li><div>    function options_reset() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set some defaults...&nbsp;</div></li><li><div>        $checked = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>         // get option 'show_album_details' value from the database&nbsp;</div></li><li><div>        $options = get_option( 'cws_gpp_reset' );       &nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        if($options['cws_gpp_reset']) { $checked = ' checked=&quot;checked&quot; '; }&nbsp;</div></li><li><div>        echo &quot;&lt;input &quot;.$checked.&quot; id='reset' name='cws_gpp_reset[reset]' type='checkbox' required /&gt;&quot;;&nbsp;</div></li><li><div>    } &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validate user input (we want text only).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */        &nbsp;</div></li><li><div>    function validate_options( $input ) {&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $valid['oauth2_code'] = esc_attr ( $input['oauth2_code'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $valid;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validate user input.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */         &nbsp;</div></li><li><div>    function validate_main_options( $input ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $valid['thumb_size'] = esc_attr( $input['thumb_size'] );&nbsp;</div></li><li><div>        $valid['album_thumb_size'] = esc_attr( $input['album_thumb_size'] );&nbsp;</div></li><li><div>        $valid['num_image_results'] = esc_attr( $input['num_image_results'] );&nbsp;</div></li><li><div>        $valid['num_album_results'] = esc_attr( $input['num_album_results'] );&nbsp;</div></li><li><div>        $valid['lightbox_image_size'] = esc_attr( $input['lightbox_image_size'] );&nbsp;</div></li><li><div>        $valid['private_albums'] = esc_attr( $input['private_albums'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Correct validation of checkboxes&nbsp;</div></li><li><div>        $valid['show_album_title'] = ( isset( $input['show_album_title'] ) && true == $input['show_album_title'] ? true : false );&nbsp;</div></li><li><div>        $valid['show_album_details'] = ( isset( $input['show_album_details'] ) && true == $input['show_album_details'] ? true : false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $valid['show_image_title'] = ( isset( $input['show_image_title'] ) && true == $input['show_image_title'] ? true : false );&nbsp;</div></li><li><div>        $valid['enable_cache'] = ( isset( $input['enable_cache'] ) && true == $input['enable_cache'] ? true : false );&nbsp;</div></li><li><div>        $valid['show_image_details'] = ( isset( $input['show_image_details'] ) && true == $input['show_image_details'] ? true : false );&nbsp;</div></li><li><div>        $valid['enable_download'] = ( isset( $input['enable_download'] ) && true == $input['enable_download'] ? true : false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $valid;&nbsp;</div></li><li><div>    } &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validate user input.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    2.0.0&nbsp;</div></li><li><div>     */         &nbsp;</div></li><li><div>    function validate_reset_options( $input ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Correct validation of checkboxes&nbsp;</div></li><li><div>        $valid['reset'] = ( isset( $input['reset'] ) && true == $input['reset'] ? true : false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $valid;&nbsp;</div></li><li><div>    } &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Dispay upgrade notice&nbsp;</div></li><li><div>    function cws_gpp_admin_installed_notice( $userObj ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // var_dump($userObj-&gt;ID);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // check if already Pro&nbsp;</div></li><li><div>            if( !$this-&gt;isPro ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Check if user has dismissed notice previously&nbsp;</div></li><li><div>                // if ( ! get_user_meta( $current_user-&gt;getID(), 'cws_gpp_ignore_upgrade' ) ) &nbsp;</div></li><li><div>                if ( ! get_user_meta( $userObj-&gt;ID, 'cws_gpp_ignore_upgrade' ) ) {&nbsp;</div></li><li><div>                    global $pagenow;&nbsp;</div></li><li><div>                    // Only show upgrade notice if on this page&nbsp;</div></li><li><div>                    if ( $pagenow == 'options-general.php' || $pagenow == 'admin.php' ) {&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;div id=&quot;message&quot; class=&quot;updated cws-gpp-message&quot;&gt;&nbsp;</div></li><li><div>                        &lt;div class=&quot;squeezer&quot;&gt;&nbsp;</div></li><li><div>                            &lt;h4&gt;&lt;?php _e( '&lt;strong&gt;Google Photos Viewer has been installed &#8211; Get the Pro version&lt;/strong&gt;', 'cws_gpp_' ); ?&gt;&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;h4&gt;&lt;?php _e( '&lt;strong&gt;GET 25% OFF! &#8211; use discount code WPMEGA25 on checkout&lt;/strong&gt;', 'cws_gpp_' ); ?&gt;&lt;/h4&gt;&nbsp;</div></li><li><div>                            &lt;p class=&quot;submit&quot;&gt;&nbsp;</div></li><li><div>                                &lt;a href=&quot;http://www.cheshirewebsolutions.com/?utm_source=cws_gpp_config&utm_medium=button&utm_content=upgrade_notice_message&utm_campaign=cws_gpp_plugin&quot; class=&quot;button-primary&quot;&gt;&lt;?php _e( 'Visit Site', 'cws_gpp_' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                                &lt;a href=&quot;&lt;?php echo admin_url('admin.php?page=cws_gpp'); ?&gt;&quot; class=&quot;button-primary&quot;&gt;&lt;?php _e( 'Settings', 'cws_gpp_' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                                &lt;a href=&quot;?cws_gpp_ignore_upgrade=0&quot; class=&quot;secondary-button&quot;&gt;Hide Notice&lt;/a&gt;&nbsp;</div></li><li><div>                            &lt;/p&gt;&nbsp;</div></li><li><div>                        &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    }                &nbsp;</div></li><li><div>                } // end check if already dismissed&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } // end isPro check&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Set installed option&nbsp;</div></li><li><div>            //update_option( 'cws_gpp_installed', 0);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>    // If installed display upgrade notice&nbsp;</div></li><li><div>    function cws_gpp_admin_notices_styles() {&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>        // Installed notices&nbsp;</div></li><li><div>        if ( get_option( 'cws_gpp_installed' ) == 1 ) {&nbsp;</div></li><li><div>            // error_log(&quot;****** ADDING ACTION ADMIN NOTICES ********&quot;);&nbsp;</div></li><li><div>            //add_action( 'admin_notices', 'cws_gpp_admin_installed_notice' );     &nbsp;</div></li><li><div>            add_action( 'admin_notices', $this-&gt;cws_gpp_admin_installed_notice() );  &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>    // Allow user to dismiss upgrade notice :)&nbsp;</div></li><li><div>    function cws_gpp_ignore_upgrade( $userObj2 ) {   &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** If user clicks to ignore the notice, add that to their user meta */&nbsp;</div></li><li><div>        if ( isset( $_GET['cws_gpp_ignore_upgrade'] ) && '0' == $_GET['cws_gpp_ignore_upgrade'] ) {&nbsp;</div></li><li><div>            // add_user_meta($current_user-&gt;ID, 'cws_gpp_ignore_upgrade', 'true', true);&nbsp;</div></li><li><div>            add_user_meta($userObj2-&gt;ID, 'cws_gpp_ignore_upgrade', 'true', true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Redirect to plugin settings page&nbsp;</div></li><li><div>            wp_redirect( admin_url( 'admin.php?page=cws_gpp' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }   &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>//&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.2.3</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.8/classes/cws_google_picasa_pro_admin/" class="">3.0.8</a></li><li><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.5/classes/cws_google_picasa_pro_admin/" class="active">3.0.5</a></li><li><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.4/classes/cws_google_picasa_pro_admin/" class="">3.0.4</a></li><li><a href="http://hookr.io/plugins/google-photos-picasa-viewer/3.0.12/classes/cws_google_picasa_pro_admin/" class="">3.0.12</a></li><li><a href="http://hookr.io/plugins/google-photos-picasa-viewer/2.2.3/classes/cws_google_picasa_pro_admin/" class="">2.2.3</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>CWS_Google_Picasa_Pro_Admin</li><li><span></span>Google Photos &amp; Picasa Viewer</li><li><span></span>3.0.8</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>