<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.3" data-slug="woocommerce-products-designer" data-type="class" data-id="58774"><head xmlns="http://www.w3.org/1999/xhtml"><title> tcpdfbarcode | class | Woocommerce Products Designer | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="TCPDFBarcode, class, plugin, woocommerce-products-designer, 2.3" /><meta name="description" content="The Woocommerce Products Designer TCPDFBarcode class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=b228125538fc6371063c56b7c0e69b3d' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/tcpdfbarcode/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Ftcpdfbarcode%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Ftcpdfbarcode%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-products-designer-2.3-class-tcpdfbarcode","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="tcpdfbarcode" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce-products-designer." href="http://hookr.io/plugins/woocommerce-products-designer/" class="plugin"><span property="name">woocommerce-products-designer</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.3." href="http://hookr.io/plugins/woocommerce-products-designer/2.3/" class="H_VERSION"><span property="name">2.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/woocommerce-products-designer/2.3/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">tcpdfbarcode</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="208"><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/all/" title="All">All <span class="count badge">208</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="8"><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/hooks/" title="Hooks">Hooks <span class="count badge">8</span></a></li><li class="" data-id="action" data-count="8"><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/actions/" title="Actions">Actions <span class="count badge">8</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="active" data-id="class" data-count="52"><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/classes/" title="Classes">Classes <span class="count badge">52</span></a></li><li class="" data-id="constant" data-count="120"><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/constants/" title="Constants">Constants <span class="count badge">120</span></a></li><li class="" data-id="function" data-count="22"><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/functions/" title="Functions">Functions <span class="count badge">22</span></a></li><li class="" data-id="shortcode" data-count="6"><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">6</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>TCPDFBarcode</strong></h1><p>The Woocommerce Products Designer <strong>TCPDFBarcode</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(2)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/files/includes-tcpdf-tcpdf-barcodes-1d/" class="file">/includes/tcpdf/tcpdf_barcodes_1d.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="44" class="block" start="50"><li><div>/* @class TCPDFBarcode&nbsp;</div></li><li><div> * PHP class to creates array representations for common 1D barcodes to be used with TCPDF (http://www.tcpdf.org).&lt;br&gt;&nbsp;</div></li><li><div> * @package com.tecnick.tcpdf&nbsp;</div></li><li><div> * @version 3.026&nbsp;</div></li><li><div> * @author Nicola Asuni&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>class TCPDFBarcode {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Array representation of barcode.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected $barcode_array;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * This is the class constructor.&nbsp;</div></li><li><div> * Return an array representations for common 1D barcodes:&lt;ul&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['code'] code to be printed on text label&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['maxh'] max barcode height&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['maxw'] max barcode width&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k] single bar or space in $k position&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k]['t'] bar type: true = bar, false = space.&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k]['w'] bar width in units.&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k]['h'] bar height in units.&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k]['p'] bar top position (0 = top, 1 = middle)&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div> * @param $code (string) code to print&nbsp;</div></li><li><div>  * @param $type (string) type of barcode: &lt;ul&gt;&lt;li&gt;C39 : CODE 39 - ANSI MH10.8M-1983 - USD-3 - 3 of 9.&lt;/li&gt;&lt;li&gt;C39+ : CODE 39 with checksum&lt;/li&gt;&lt;li&gt;C39E : CODE 39 EXTENDED&lt;/li&gt;&lt;li&gt;C39E+ : CODE 39 EXTENDED + CHECKSUM&lt;/li&gt;&lt;li&gt;C93 : CODE 93 - USS-93&lt;/li&gt;&lt;li&gt;S25 : Standard 2 of 5&lt;/li&gt;&lt;li&gt;S25+ : Standard 2 of 5 + CHECKSUM&lt;/li&gt;&lt;li&gt;I25 : Interleaved 2 of 5&lt;/li&gt;&lt;li&gt;I25+ : Interleaved 2 of 5 + CHECKSUM&lt;/li&gt;&lt;li&gt;C128 : CODE 128&lt;/li&gt;&lt;li&gt;C128A : CODE 128 A&lt;/li&gt;&lt;li&gt;C128B : CODE 128 B&lt;/li&gt;&lt;li&gt;C128C : CODE 128 C&lt;/li&gt;&lt;li&gt;EAN2 : 2-Digits UPC-Based Extention&lt;/li&gt;&lt;li&gt;EAN5 : 5-Digits UPC-Based Extention&lt;/li&gt;&lt;li&gt;EAN8 : EAN 8&lt;/li&gt;&lt;li&gt;EAN13 : EAN 13&lt;/li&gt;&lt;li&gt;UPCA : UPC-A&lt;/li&gt;&lt;li&gt;UPCE : UPC-E&lt;/li&gt;&lt;li&gt;MSI : MSI (Variation of Plessey code)&lt;/li&gt;&lt;li&gt;MSI+ : MSI + CHECKSUM (modulo 11)&lt;/li&gt;&lt;li&gt;POSTNET : POSTNET&lt;/li&gt;&lt;li&gt;PLANET : PLANET&lt;/li&gt;&lt;li&gt;RMS4CC : RMS4CC (Royal Mail 4-state Customer Code) - CBC (Customer Bar Code)&lt;/li&gt;&lt;li&gt;KIX : KIX (Klant index - Customer index)&lt;/li&gt;&lt;li&gt;IMB: Intelligent Mail Barcode - Onecode - USPS-B-3200&lt;/li&gt;&lt;li&gt;CODABAR : CODABAR&lt;/li&gt;&lt;li&gt;CODE11 : CODE 11&lt;/li&gt;&lt;li&gt;PHARMA : PHARMACODE&lt;/li&gt;&lt;li&gt;PHARMA2T : PHARMACODE TWO-TRACKS&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function __construct($code, $type) {&nbsp;</div></li><li><div>    $this-&gt;setBarcode($code, $type);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Return an array representations of barcode.&nbsp;</div></li><li><div>  * @return array&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodeArray() {&nbsp;</div></li><li><div>    return $this-&gt;barcode_array;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Send barcode as SVG image object to the standard output.&nbsp;</div></li><li><div> * @param $w (int) Minimum width of a single bar in user units.&nbsp;</div></li><li><div> * @param $h (int) Height of barcode in user units.&nbsp;</div></li><li><div> * @param $color (string) Foreground color (in SVG format) for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodeSVG($w=2, $h=30, $color='black') {&nbsp;</div></li><li><div>    // send headers&nbsp;</div></li><li><div>    $code = $this-&gt;getBarcodeSVGcode($w, $h, $color);&nbsp;</div></li><li><div>    header('Content-Type: application/svg+xml');&nbsp;</div></li><li><div>    header('Cache-Control: public, must-revalidate, max-age=0'); // HTTP/1.1&nbsp;</div></li><li><div>    header('Pragma: public');&nbsp;</div></li><li><div>    header('Expires: Sat, 26 Jul 1997 05:00:00 GMT'); // Date in the past&nbsp;</div></li><li><div>    header('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT');&nbsp;</div></li><li><div>    header('Content-Disposition: inline; filename=&quot;'.md5($code).'.svg&quot;;');&nbsp;</div></li><li><div>    //header('Content-Length: '.strlen($code));&nbsp;</div></li><li><div>    echo $code;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Return a SVG string representation of barcode.&nbsp;</div></li><li><div> * @param $w (int) Minimum width of a single bar in user units.&nbsp;</div></li><li><div> * @param $h (int) Height of barcode in user units.&nbsp;</div></li><li><div> * @param $color (string) Foreground color (in SVG format) for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @return string SVG code.&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodeSVGcode($w=2, $h=30, $color='black') {&nbsp;</div></li><li><div>    // replace table for special characters&nbsp;</div></li><li><div>    $repstr = array(&quot;\0&quot; =&gt; '', '&' =&gt; '&amp;', '&lt;' =&gt; '&lt;', '&gt;' =&gt; '&gt;');&nbsp;</div></li><li><div>    $svg = '&lt;'.'?'.'xml version=&quot;1.0&quot; standalone=&quot;no&quot;'.'?'.'&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= '&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot; &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= '&lt;svg width=&quot;'.round(($this-&gt;barcode_array['maxw'] * $w), 3).'&quot; height=&quot;'.$h.'&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= &quot;\t&quot;.'&lt;desc&gt;'.strtr($this-&gt;barcode_array['code'], $repstr).'&lt;/desc&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= &quot;\t&quot;.'&lt;g id=&quot;bars&quot; fill=&quot;'.$color.'&quot; stroke=&quot;none&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    // print bars&nbsp;</div></li><li><div>    $x = 0;&nbsp;</div></li><li><div>    foreach ($this-&gt;barcode_array['bcode'] as $k =&gt; $v) {&nbsp;</div></li><li><div>        $bw = round(($v['w'] * $w), 3);&nbsp;</div></li><li><div>        $bh = round(($v['h'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>        if ($v['t']) {&nbsp;</div></li><li><div>            $y = round(($v['p'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>            // draw a vertical bar&nbsp;</div></li><li><div>            $svg .= &quot;\t\t&quot;.'&lt;rect x=&quot;'.$x.'&quot; y=&quot;'.$y.'&quot; width=&quot;'.$bw.'&quot; height=&quot;'.$bh.'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $x += $bw;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $svg .= &quot;\t&quot;.'&lt;/g&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= '&lt;/svg&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    return $svg;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Return an HTML representation of barcode.&nbsp;</div></li><li><div> * @param $w (int) Width of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $h (int) Height of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $color (string) Foreground color for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @return string HTML code.&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodeHTML($w=2, $h=30, $color='black') {&nbsp;</div></li><li><div>    $html = '&lt;div style=&quot;font-size:0;position:relative;width:'.($this-&gt;barcode_array['maxw'] * $w).'px;height:'.($h).'px;&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    // print bars&nbsp;</div></li><li><div>    $x = 0;&nbsp;</div></li><li><div>    foreach ($this-&gt;barcode_array['bcode'] as $k =&gt; $v) {&nbsp;</div></li><li><div>        $bw = round(($v['w'] * $w), 3);&nbsp;</div></li><li><div>        $bh = round(($v['h'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>        if ($v['t']) {&nbsp;</div></li><li><div>            $y = round(($v['p'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>            // draw a vertical bar&nbsp;</div></li><li><div>            $html .= '&lt;div style=&quot;background-color:'.$color.';width:'.$bw.'px;height:'.$bh.'px;position:absolute;left:'.$x.'px;top:'.$y.'px;&quot;&gt;&nbsp;&lt;/div&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $x += $bw;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $html .= '&lt;/div&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Send a PNG image representation of barcode (requires GD or Imagick library).&nbsp;</div></li><li><div> * @param $w (int) Width of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $h (int) Height of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $color (array) RGB (0-255) foreground color for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodePNG($w=2, $h=30, $color=array(0, 0, 0)) {&nbsp;</div></li><li><div>    $data = $this-&gt;getBarcodePngData($w, $h, $color);&nbsp;</div></li><li><div>    // send headers&nbsp;</div></li><li><div>    header('Content-Type: image/png');&nbsp;</div></li><li><div>    header('Cache-Control: public, must-revalidate, max-age=0'); // HTTP/1.1&nbsp;</div></li><li><div>    header('Pragma: public');&nbsp;</div></li><li><div>    header('Expires: Sat, 26 Jul 1997 05:00:00 GMT'); // Date in the past&nbsp;</div></li><li><div>    header('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT');&nbsp;</div></li><li><div>    //header('Content-Length: '.strlen($data));&nbsp;</div></li><li><div>    echo $data;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Return a PNG image representation of barcode (requires GD or Imagick library).&nbsp;</div></li><li><div> * @param $w (int) Width of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $h (int) Height of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $color (array) RGB (0-255) foreground color for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @return image or false in case of error.&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodePngData($w=2, $h=30, $color=array(0, 0, 0)) {&nbsp;</div></li><li><div>    // calculate image size&nbsp;</div></li><li><div>    $width = ($this-&gt;barcode_array['maxw'] * $w);&nbsp;</div></li><li><div>    $height = $h;&nbsp;</div></li><li><div>    if (function_exists('imagecreate')) {&nbsp;</div></li><li><div>        // GD library&nbsp;</div></li><li><div>        $imagick = false;&nbsp;</div></li><li><div>        $png = imagecreate($width, $height);&nbsp;</div></li><li><div>        $bgcol = imagecolorallocate($png, 255, 255, 255);&nbsp;</div></li><li><div>        imagecolortransparent($png, $bgcol);&nbsp;</div></li><li><div>        $fgcol = imagecolorallocate($png, $color[0], $color[1], $color[2]);&nbsp;</div></li><li><div>    } elseif (extension_loaded('imagick')) {&nbsp;</div></li><li><div>        $imagick = true;&nbsp;</div></li><li><div>        $bgcol = new imagickpixel('rgb(255, 255, 255');&nbsp;</div></li><li><div>        $fgcol = new imagickpixel('rgb('.$color[0].', '.$color[1].', '.$color[2].')');&nbsp;</div></li><li><div>        $png = new Imagick();&nbsp;</div></li><li><div>        $png-&gt;newImage($width, $height, 'none', 'png');&nbsp;</div></li><li><div>        $bar = new imagickdraw();&nbsp;</div></li><li><div>        $bar-&gt;setfillcolor($fgcol);&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // print bars&nbsp;</div></li><li><div>    $x = 0;&nbsp;</div></li><li><div>    foreach ($this-&gt;barcode_array['bcode'] as $k =&gt; $v) {&nbsp;</div></li><li><div>        $bw = round(($v['w'] * $w), 3);&nbsp;</div></li><li><div>        $bh = round(($v['h'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>        if ($v['t']) {&nbsp;</div></li><li><div>            $y = round(($v['p'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>            // draw a vertical bar&nbsp;</div></li><li><div>            if ($imagick) {&nbsp;</div></li><li><div>                $bar-&gt;rectangle($x, $y, ($x + $bw - 1), ($y + $bh - 1));&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                imagefilledrectangle($png, $x, $y, ($x + $bw - 1), ($y + $bh - 1), $fgcol);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $x += $bw;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($imagick) {&nbsp;</div></li><li><div>        $png-&gt;drawimage($bar);&nbsp;</div></li><li><div>        return $png;&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        ob_start();&nbsp;</div></li><li><div>        imagepng($png);&nbsp;</div></li><li><div>        $imagedata = ob_get_clean();&nbsp;</div></li><li><div>        imagedestroy($png);&nbsp;</div></li><li><div>        return $imagedata;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Set the barcode.&nbsp;</div></li><li><div> * @param $code (string) code to print&nbsp;</div></li><li><div>  * @param $type (string) type of barcode: &lt;ul&gt;&lt;li&gt;C39 : CODE 39 - ANSI MH10.8M-1983 - USD-3 - 3 of 9.&lt;/li&gt;&lt;li&gt;C39+ : CODE 39 with checksum&lt;/li&gt;&lt;li&gt;C39E : CODE 39 EXTENDED&lt;/li&gt;&lt;li&gt;C39E+ : CODE 39 EXTENDED + CHECKSUM&lt;/li&gt;&lt;li&gt;C93 : CODE 93 - USS-93&lt;/li&gt;&lt;li&gt;S25 : Standard 2 of 5&lt;/li&gt;&lt;li&gt;S25+ : Standard 2 of 5 + CHECKSUM&lt;/li&gt;&lt;li&gt;I25 : Interleaved 2 of 5&lt;/li&gt;&lt;li&gt;I25+ : Interleaved 2 of 5 + CHECKSUM&lt;/li&gt;&lt;li&gt;C128 : CODE 128&lt;/li&gt;&lt;li&gt;C128A : CODE 128 A&lt;/li&gt;&lt;li&gt;C128B : CODE 128 B&lt;/li&gt;&lt;li&gt;C128C : CODE 128 C&lt;/li&gt;&lt;li&gt;EAN2 : 2-Digits UPC-Based Extention&lt;/li&gt;&lt;li&gt;EAN5 : 5-Digits UPC-Based Extention&lt;/li&gt;&lt;li&gt;EAN8 : EAN 8&lt;/li&gt;&lt;li&gt;EAN13 : EAN 13&lt;/li&gt;&lt;li&gt;UPCA : UPC-A&lt;/li&gt;&lt;li&gt;UPCE : UPC-E&lt;/li&gt;&lt;li&gt;MSI : MSI (Variation of Plessey code)&lt;/li&gt;&lt;li&gt;MSI+ : MSI + CHECKSUM (modulo 11)&lt;/li&gt;&lt;li&gt;POSTNET : POSTNET&lt;/li&gt;&lt;li&gt;PLANET : PLANET&lt;/li&gt;&lt;li&gt;RMS4CC : RMS4CC (Royal Mail 4-state Customer Code) - CBC (Customer Bar Code)&lt;/li&gt;&lt;li&gt;KIX : KIX (Klant index - Customer index)&lt;/li&gt;&lt;li&gt;IMB: Intelligent Mail Barcode - Onecode - USPS-B-3200&lt;/li&gt;&lt;li&gt;CODABAR : CODABAR&lt;/li&gt;&lt;li&gt;CODE11 : CODE 11&lt;/li&gt;&lt;li&gt;PHARMA : PHARMACODE&lt;/li&gt;&lt;li&gt;PHARMA2T : PHARMACODE TWO-TRACKS&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>  * @return array barcode array&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function setBarcode($code, $type) {&nbsp;</div></li><li><div>    switch (strtoupper($type)) {&nbsp;</div></li><li><div>        case 'C39': { // CODE 39 - ANSI MH10.8M-1983 - USD-3 - 3 of 9.&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code39($code, false, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C39+': { // CODE 39 with checksum&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code39($code, false, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C39E': { // CODE 39 EXTENDED&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code39($code, true, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C39E+': { // CODE 39 EXTENDED + CHECKSUM&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code39($code, true, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C93': { // CODE 93 - USS-93&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code93($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'S25': { // Standard 2 of 5&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_s25($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'S25+': { // Standard 2 of 5 + CHECKSUM&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_s25($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'I25': { // Interleaved 2 of 5&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_i25($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'I25+': { // Interleaved 2 of 5 + CHECKSUM&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_i25($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C128': { // CODE 128&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_c128($code, '');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C128A': { // CODE 128 A&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_c128($code, 'A');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C128B': { // CODE 128 B&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_c128($code, 'B');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C128C': { // CODE 128 C&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_c128($code, 'C');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'EAN2': { // 2-Digits UPC-Based Extention&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanext($code, 2);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'EAN5': { // 5-Digits UPC-Based Extention&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanext($code, 5);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'EAN8': { // EAN 8&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanupc($code, 8);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'EAN13': { // EAN 13&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanupc($code, 13);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'UPCA': { // UPC-A&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanupc($code, 12);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'UPCE': { // UPC-E&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanupc($code, 6);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'MSI': { // MSI (Variation of Plessey code)&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_msi($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'MSI+': { // MSI + CHECKSUM (modulo 11)&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_msi($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'POSTNET': { // POSTNET&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_postnet($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'PLANET': { // PLANET&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_postnet($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'RMS4CC': { // RMS4CC (Royal Mail 4-state Customer Code) - CBC (Customer Bar Code)&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_rms4cc($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'KIX': { // KIX (Klant index - Customer index)&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_rms4cc($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'IMB': { // IMB - Intelligent Mail Barcode - Onecode - USPS-B-3200&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_imb($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'CODABAR': { // CODABAR&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_codabar($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'CODE11': { // CODE 11&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code11($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'PHARMA': { // PHARMACODE&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_pharmacode($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'PHARMA2T': { // PHARMACODE TWO-TRACKS&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_pharmacode2t($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        default: {&nbsp;</div></li><li><div>            $this-&gt;barcode_array = false;&nbsp;</div></li><li><div>            $arrcode = false;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $this-&gt;barcode_array = $arrcode;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * CODE 39 - ANSI MH10.8M-1983 - USD-3 - 3 of 9.&nbsp;</div></li><li><div> * General-purpose code in very wide use world-wide&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $extended (boolean) if true uses the extended mode.&nbsp;</div></li><li><div> * @param $checksum (boolean) if true add a checksum to the code.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_code39($code, $extended=false, $checksum=false) {&nbsp;</div></li><li><div>    $chr['0'] = '111331311';&nbsp;</div></li><li><div>    $chr['1'] = '311311113';&nbsp;</div></li><li><div>    $chr['2'] = '113311113';&nbsp;</div></li><li><div>    $chr['3'] = '313311111';&nbsp;</div></li><li><div>    $chr['4'] = '111331113';&nbsp;</div></li><li><div>    $chr['5'] = '311331111';&nbsp;</div></li><li><div>    $chr['6'] = '113331111';&nbsp;</div></li><li><div>    $chr['7'] = '111311313';&nbsp;</div></li><li><div>    $chr['8'] = '311311311';&nbsp;</div></li><li><div>    $chr['9'] = '113311311';&nbsp;</div></li><li><div>    $chr['A'] = '311113113';&nbsp;</div></li><li><div>    $chr['B'] = '113113113';&nbsp;</div></li><li><div>    $chr['C'] = '313113111';&nbsp;</div></li><li><div>    $chr['D'] = '111133113';&nbsp;</div></li><li><div>    $chr['E'] = '311133111';&nbsp;</div></li><li><div>    $chr['F'] = '113133111';&nbsp;</div></li><li><div>    $chr['G'] = '111113313';&nbsp;</div></li><li><div>    $chr['H'] = '311113311';&nbsp;</div></li><li><div>    $chr['I'] = '113113311';&nbsp;</div></li><li><div>    $chr['J'] = '111133311';&nbsp;</div></li><li><div>    $chr['K'] = '311111133';&nbsp;</div></li><li><div>    $chr['L'] = '113111133';&nbsp;</div></li><li><div>    $chr['M'] = '313111131';&nbsp;</div></li><li><div>    $chr['N'] = '111131133';&nbsp;</div></li><li><div>    $chr['O'] = '311131131';&nbsp;</div></li><li><div>    $chr['P'] = '113131131';&nbsp;</div></li><li><div>    $chr['Q'] = '111111333';&nbsp;</div></li><li><div>    $chr['R'] = '311111331';&nbsp;</div></li><li><div>    $chr['S'] = '113111331';&nbsp;</div></li><li><div>    $chr['T'] = '111131331';&nbsp;</div></li><li><div>    $chr['U'] = '331111113';&nbsp;</div></li><li><div>    $chr['V'] = '133111113';&nbsp;</div></li><li><div>    $chr['W'] = '333111111';&nbsp;</div></li><li><div>    $chr['X'] = '131131113';&nbsp;</div></li><li><div>    $chr['Y'] = '331131111';&nbsp;</div></li><li><div>    $chr['Z'] = '133131111';&nbsp;</div></li><li><div>    $chr['-'] = '131111313';&nbsp;</div></li><li><div>    $chr['.'] = '331111311';&nbsp;</div></li><li><div>    $chr[' '] = '133111311';&nbsp;</div></li><li><div>    $chr['$'] = '131313111';&nbsp;</div></li><li><div>    $chr['/'] = '131311131';&nbsp;</div></li><li><div>    $chr['+'] = '131113131';&nbsp;</div></li><li><div>    $chr['%'] = '111313131';&nbsp;</div></li><li><div>    $chr['*'] = '131131311';&nbsp;</div></li><li><div>    $code = strtoupper($code);&nbsp;</div></li><li><div>    if ($extended) {&nbsp;</div></li><li><div>        // extended mode&nbsp;</div></li><li><div>        $code = $this-&gt;encode_code39_ext($code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($code === false) {&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($checksum) {&nbsp;</div></li><li><div>        // checksum&nbsp;</div></li><li><div>        $code .= $this-&gt;checksum_code39($code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // add start and stop codes&nbsp;</div></li><li><div>    $code = '*'.$code.'*';&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $char = $code{$i};&nbsp;</div></li><li><div>        if(!isset($chr[$char])) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 9; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $chr[$char]{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // intercharacter gap&nbsp;</div></li><li><div>        $bararray['bcode'][$k] = array('t' =&gt; false, 'w' =&gt; 1, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 1;&nbsp;</div></li><li><div>        ++$k;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Encode a string to be used for CODE 39 Extended mode.&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return encoded string.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function encode_code39_ext($code) {&nbsp;</div></li><li><div>    $encode = array(&nbsp;</div></li><li><div>        chr(0) =&gt; '%U', chr(1) =&gt; '$A', chr(2) =&gt; '$B', chr(3) =&gt; '$C', &nbsp;</div></li><li><div>        chr(4) =&gt; '$D', chr(5) =&gt; '$E', chr(6) =&gt; '$F', chr(7) =&gt; '$G', &nbsp;</div></li><li><div>        chr(8) =&gt; '$H', chr(9) =&gt; '$I', chr(10) =&gt; '$J', chr(11) =&gt; 'K', &nbsp;</div></li><li><div>        chr(12) =&gt; '$L', chr(13) =&gt; '$M', chr(14) =&gt; '$N', chr(15) =&gt; '$O', &nbsp;</div></li><li><div>        chr(16) =&gt; '$P', chr(17) =&gt; '$Q', chr(18) =&gt; '$R', chr(19) =&gt; '$S', &nbsp;</div></li><li><div>        chr(20) =&gt; '$T', chr(21) =&gt; '$U', chr(22) =&gt; '$V', chr(23) =&gt; '$W', &nbsp;</div></li><li><div>        chr(24) =&gt; '$X', chr(25) =&gt; '$Y', chr(26) =&gt; '$Z', chr(27) =&gt; '%A', &nbsp;</div></li><li><div>        chr(28) =&gt; '%B', chr(29) =&gt; '%C', chr(30) =&gt; '%D', chr(31) =&gt; '%E', &nbsp;</div></li><li><div>        chr(32) =&gt; ' ', chr(33) =&gt; '/A', chr(34) =&gt; '/B', chr(35) =&gt; '/C', &nbsp;</div></li><li><div>        chr(36) =&gt; '/D', chr(37) =&gt; '/E', chr(38) =&gt; '/F', chr(39) =&gt; '/G', &nbsp;</div></li><li><div>        chr(40) =&gt; '/H', chr(41) =&gt; '/I', chr(42) =&gt; '/J', chr(43) =&gt; '/K', &nbsp;</div></li><li><div>        chr(44) =&gt; '/L', chr(45) =&gt; '-', chr(46) =&gt; '.', chr(47) =&gt; '/O', &nbsp;</div></li><li><div>        chr(48) =&gt; '0', chr(49) =&gt; '1', chr(50) =&gt; '2', chr(51) =&gt; '3', &nbsp;</div></li><li><div>        chr(52) =&gt; '4', chr(53) =&gt; '5', chr(54) =&gt; '6', chr(55) =&gt; '7', &nbsp;</div></li><li><div>        chr(56) =&gt; '8', chr(57) =&gt; '9', chr(58) =&gt; '/Z', chr(59) =&gt; '%F', &nbsp;</div></li><li><div>        chr(60) =&gt; '%G', chr(61) =&gt; '%H', chr(62) =&gt; '%I', chr(63) =&gt; '%J', &nbsp;</div></li><li><div>        chr(64) =&gt; '%V', chr(65) =&gt; 'A', chr(66) =&gt; 'B', chr(67) =&gt; 'C', &nbsp;</div></li><li><div>        chr(68) =&gt; 'D', chr(69) =&gt; 'E', chr(70) =&gt; 'F', chr(71) =&gt; 'G', &nbsp;</div></li><li><div>        chr(72) =&gt; 'H', chr(73) =&gt; 'I', chr(74) =&gt; 'J', chr(75) =&gt; 'K', &nbsp;</div></li><li><div>        chr(76) =&gt; 'L', chr(77) =&gt; 'M', chr(78) =&gt; 'N', chr(79) =&gt; 'O', &nbsp;</div></li><li><div>        chr(80) =&gt; 'P', chr(81) =&gt; 'Q', chr(82) =&gt; 'R', chr(83) =&gt; 'S', &nbsp;</div></li><li><div>        chr(84) =&gt; 'T', chr(85) =&gt; 'U', chr(86) =&gt; 'V', chr(87) =&gt; 'W', &nbsp;</div></li><li><div>        chr(88) =&gt; 'X', chr(89) =&gt; 'Y', chr(90) =&gt; 'Z', chr(91) =&gt; '%K', &nbsp;</div></li><li><div>        chr(92) =&gt; '%L', chr(93) =&gt; '%M', chr(94) =&gt; '%N', chr(95) =&gt; '%O', &nbsp;</div></li><li><div>        chr(96) =&gt; '%W', chr(97) =&gt; '+A', chr(98) =&gt; '+B', chr(99) =&gt; '+C', &nbsp;</div></li><li><div>        chr(100) =&gt; '+D', chr(101) =&gt; '+E', chr(102) =&gt; '+F', chr(103) =&gt; '+G', &nbsp;</div></li><li><div>        chr(104) =&gt; '+H', chr(105) =&gt; '+I', chr(106) =&gt; '+J', chr(107) =&gt; '+K', &nbsp;</div></li><li><div>        chr(108) =&gt; '+L', chr(109) =&gt; '+M', chr(110) =&gt; '+N', chr(111) =&gt; '+O', &nbsp;</div></li><li><div>        chr(112) =&gt; '+P', chr(113) =&gt; '+Q', chr(114) =&gt; '+R', chr(115) =&gt; '+S', &nbsp;</div></li><li><div>        chr(116) =&gt; '+T', chr(117) =&gt; '+U', chr(118) =&gt; '+V', chr(119) =&gt; '+W', &nbsp;</div></li><li><div>        chr(120) =&gt; '+X', chr(121) =&gt; '+Y', chr(122) =&gt; '+Z', chr(123) =&gt; '%P', &nbsp;</div></li><li><div>        chr(124) =&gt; '%Q', chr(125) =&gt; '%R', chr(126) =&gt; '%S', chr(127) =&gt; '%T');&nbsp;</div></li><li><div>    $code_ext = '';&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0 ; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        if (ord($code{$i}) &gt; 127) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $code_ext .= $encode[$code{$i}];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $code_ext;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Calculate CODE 39 checksum (modulo 43).&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return char checksum.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function checksum_code39($code) {&nbsp;</div></li><li><div>    $chars = array(&nbsp;</div></li><li><div>        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', &nbsp;</div></li><li><div>        'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', &nbsp;</div></li><li><div>        'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', &nbsp;</div></li><li><div>        'W', 'X', 'Y', 'Z', '-', '.', ' ', '$', '/', '+', '%');&nbsp;</div></li><li><div>    $sum = 0;&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0 ; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $k = array_keys($chars, $code{$i});&nbsp;</div></li><li><div>        $sum += $k[0];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $j = ($sum % 43);&nbsp;</div></li><li><div>    return $chars[$j];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * CODE 93 - USS-93&nbsp;</div></li><li><div> * Compact code similar to Code 39&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_code93($code) {&nbsp;</div></li><li><div>    $chr[48] = '131112'; // 0&nbsp;</div></li><li><div>    $chr[49] = '111213'; // 1&nbsp;</div></li><li><div>    $chr[50] = '111312'; // 2&nbsp;</div></li><li><div>    $chr[51] = '111411'; // 3&nbsp;</div></li><li><div>    $chr[52] = '121113'; // 4&nbsp;</div></li><li><div>    $chr[53] = '121212'; // 5&nbsp;</div></li><li><div>    $chr[54] = '121311'; // 6&nbsp;</div></li><li><div>    $chr[55] = '111114'; // 7&nbsp;</div></li><li><div>    $chr[56] = '131211'; // 8&nbsp;</div></li><li><div>    $chr[57] = '141111'; // 9&nbsp;</div></li><li><div>    $chr[65] = '211113'; // A&nbsp;</div></li><li><div>    $chr[66] = '211212'; // B&nbsp;</div></li><li><div>    $chr[67] = '211311'; // C&nbsp;</div></li><li><div>    $chr[68] = '221112'; // D&nbsp;</div></li><li><div>    $chr[69] = '221211'; // E&nbsp;</div></li><li><div>    $chr[70] = '231111'; // F&nbsp;</div></li><li><div>    $chr[71] = '112113'; // G&nbsp;</div></li><li><div>    $chr[72] = '112212'; // H&nbsp;</div></li><li><div>    $chr[73] = '112311'; // I&nbsp;</div></li><li><div>    $chr[74] = '122112'; // J&nbsp;</div></li><li><div>    $chr[75] = '132111'; // K&nbsp;</div></li><li><div>    $chr[76] = '111123'; // L&nbsp;</div></li><li><div>    $chr[77] = '111222'; // M&nbsp;</div></li><li><div>    $chr[78] = '111321'; // N&nbsp;</div></li><li><div>    $chr[79] = '121122'; // O&nbsp;</div></li><li><div>    $chr[80] = '131121'; // P&nbsp;</div></li><li><div>    $chr[81] = '212112'; // Q&nbsp;</div></li><li><div>    $chr[82] = '212211'; // R&nbsp;</div></li><li><div>    $chr[83] = '211122'; // S&nbsp;</div></li><li><div>    $chr[84] = '211221'; // T&nbsp;</div></li><li><div>    $chr[85] = '221121'; // U&nbsp;</div></li><li><div>    $chr[86] = '222111'; // V&nbsp;</div></li><li><div>    $chr[87] = '112122'; // W&nbsp;</div></li><li><div>    $chr[88] = '112221'; // X&nbsp;</div></li><li><div>    $chr[89] = '122121'; // Y&nbsp;</div></li><li><div>    $chr[90] = '123111'; // Z&nbsp;</div></li><li><div>    $chr[45] = '121131'; // -&nbsp;</div></li><li><div>    $chr[46] = '311112'; // .&nbsp;</div></li><li><div>    $chr[32] = '311211'; //&nbsp;</div></li><li><div>    $chr[36] = '321111'; // $&nbsp;</div></li><li><div>    $chr[47] = '112131'; // /&nbsp;</div></li><li><div>    $chr[43] = '113121'; // +&nbsp;</div></li><li><div>    $chr[37] = '211131'; // %&nbsp;</div></li><li><div>    $chr[128] = '121221'; // ($)&nbsp;</div></li><li><div>    $chr[129] = '311121'; // (/)&nbsp;</div></li><li><div>    $chr[130] = '122211'; // (+)&nbsp;</div></li><li><div>    $chr[131] = '312111'; // (%)&nbsp;</div></li><li><div>    $chr[42] = '111141'; // start-stop&nbsp;</div></li><li><div>    $code = strtoupper($code);&nbsp;</div></li><li><div>    $encode = array(&nbsp;</div></li><li><div>        chr(0) =&gt; chr(131).'U', chr(1) =&gt; chr(128).'A', chr(2) =&gt; chr(128).'B', chr(3) =&gt; chr(128).'C', &nbsp;</div></li><li><div>        chr(4) =&gt; chr(128).'D', chr(5) =&gt; chr(128).'E', chr(6) =&gt; chr(128).'F', chr(7) =&gt; chr(128).'G', &nbsp;</div></li><li><div>        chr(8) =&gt; chr(128).'H', chr(9) =&gt; chr(128).'I', chr(10) =&gt; chr(128).'J', chr(11) =&gt; 'K', &nbsp;</div></li><li><div>        chr(12) =&gt; chr(128).'L', chr(13) =&gt; chr(128).'M', chr(14) =&gt; chr(128).'N', chr(15) =&gt; chr(128).'O', &nbsp;</div></li><li><div>        chr(16) =&gt; chr(128).'P', chr(17) =&gt; chr(128).'Q', chr(18) =&gt; chr(128).'R', chr(19) =&gt; chr(128).'S', &nbsp;</div></li><li><div>        chr(20) =&gt; chr(128).'T', chr(21) =&gt; chr(128).'U', chr(22) =&gt; chr(128).'V', chr(23) =&gt; chr(128).'W', &nbsp;</div></li><li><div>        chr(24) =&gt; chr(128).'X', chr(25) =&gt; chr(128).'Y', chr(26) =&gt; chr(128).'Z', chr(27) =&gt; chr(131).'A', &nbsp;</div></li><li><div>        chr(28) =&gt; chr(131).'B', chr(29) =&gt; chr(131).'C', chr(30) =&gt; chr(131).'D', chr(31) =&gt; chr(131).'E', &nbsp;</div></li><li><div>        chr(32) =&gt; ' ', chr(33) =&gt; chr(129).'A', chr(34) =&gt; chr(129).'B', chr(35) =&gt; chr(129).'C', &nbsp;</div></li><li><div>        chr(36) =&gt; chr(129).'D', chr(37) =&gt; chr(129).'E', chr(38) =&gt; chr(129).'F', chr(39) =&gt; chr(129).'G', &nbsp;</div></li><li><div>        chr(40) =&gt; chr(129).'H', chr(41) =&gt; chr(129).'I', chr(42) =&gt; chr(129).'J', chr(43) =&gt; chr(129).'K', &nbsp;</div></li><li><div>        chr(44) =&gt; chr(129).'L', chr(45) =&gt; '-', chr(46) =&gt; '.', chr(47) =&gt; chr(129).'O', &nbsp;</div></li><li><div>        chr(48) =&gt; '0', chr(49) =&gt; '1', chr(50) =&gt; '2', chr(51) =&gt; '3', &nbsp;</div></li><li><div>        chr(52) =&gt; '4', chr(53) =&gt; '5', chr(54) =&gt; '6', chr(55) =&gt; '7', &nbsp;</div></li><li><div>        chr(56) =&gt; '8', chr(57) =&gt; '9', chr(58) =&gt; chr(129).'Z', chr(59) =&gt; chr(131).'F', &nbsp;</div></li><li><div>        chr(60) =&gt; chr(131).'G', chr(61) =&gt; chr(131).'H', chr(62) =&gt; chr(131).'I', chr(63) =&gt; chr(131).'J', &nbsp;</div></li><li><div>        chr(64) =&gt; chr(131).'V', chr(65) =&gt; 'A', chr(66) =&gt; 'B', chr(67) =&gt; 'C', &nbsp;</div></li><li><div>        chr(68) =&gt; 'D', chr(69) =&gt; 'E', chr(70) =&gt; 'F', chr(71) =&gt; 'G', &nbsp;</div></li><li><div>        chr(72) =&gt; 'H', chr(73) =&gt; 'I', chr(74) =&gt; 'J', chr(75) =&gt; 'K', &nbsp;</div></li><li><div>        chr(76) =&gt; 'L', chr(77) =&gt; 'M', chr(78) =&gt; 'N', chr(79) =&gt; 'O', &nbsp;</div></li><li><div>        chr(80) =&gt; 'P', chr(81) =&gt; 'Q', chr(82) =&gt; 'R', chr(83) =&gt; 'S', &nbsp;</div></li><li><div>        chr(84) =&gt; 'T', chr(85) =&gt; 'U', chr(86) =&gt; 'V', chr(87) =&gt; 'W', &nbsp;</div></li><li><div>        chr(88) =&gt; 'X', chr(89) =&gt; 'Y', chr(90) =&gt; 'Z', chr(91) =&gt; chr(131).'K', &nbsp;</div></li><li><div>        chr(92) =&gt; chr(131).'L', chr(93) =&gt; chr(131).'M', chr(94) =&gt; chr(131).'N', chr(95) =&gt; chr(131).'O', &nbsp;</div></li><li><div>        chr(96) =&gt; chr(131).'W', chr(97) =&gt; chr(130).'A', chr(98) =&gt; chr(130).'B', chr(99) =&gt; chr(130).'C', &nbsp;</div></li><li><div>        chr(100) =&gt; chr(130).'D', chr(101) =&gt; chr(130).'E', chr(102) =&gt; chr(130).'F', chr(103) =&gt; chr(130).'G', &nbsp;</div></li><li><div>        chr(104) =&gt; chr(130).'H', chr(105) =&gt; chr(130).'I', chr(106) =&gt; chr(130).'J', chr(107) =&gt; chr(130).'K', &nbsp;</div></li><li><div>        chr(108) =&gt; chr(130).'L', chr(109) =&gt; chr(130).'M', chr(110) =&gt; chr(130).'N', chr(111) =&gt; chr(130).'O', &nbsp;</div></li><li><div>        chr(112) =&gt; chr(130).'P', chr(113) =&gt; chr(130).'Q', chr(114) =&gt; chr(130).'R', chr(115) =&gt; chr(130).'S', &nbsp;</div></li><li><div>        chr(116) =&gt; chr(130).'T', chr(117) =&gt; chr(130).'U', chr(118) =&gt; chr(130).'V', chr(119) =&gt; chr(130).'W', &nbsp;</div></li><li><div>        chr(120) =&gt; chr(130).'X', chr(121) =&gt; chr(130).'Y', chr(122) =&gt; chr(130).'Z', chr(123) =&gt; chr(131).'P', &nbsp;</div></li><li><div>        chr(124) =&gt; chr(131).'Q', chr(125) =&gt; chr(131).'R', chr(126) =&gt; chr(131).'S', chr(127) =&gt; chr(131).'T');&nbsp;</div></li><li><div>    $code_ext = '';&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0 ; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        if (ord($code{$i}) &gt; 127) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $code_ext .= $encode[$code{$i}];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // checksum&nbsp;</div></li><li><div>    $code_ext .= $this-&gt;checksum_code93($code_ext);&nbsp;</div></li><li><div>    // add start and stop codes&nbsp;</div></li><li><div>    $code = '*'.$code_ext.'*';&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $char = ord($code{$i});&nbsp;</div></li><li><div>        if(!isset($chr[$char])) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 6; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $chr[$char]{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $bararray['bcode'][$k] = array('t' =&gt; true, 'w' =&gt; 1, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>    $bararray['maxw'] += 1;&nbsp;</div></li><li><div>    ++$k;&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Calculate CODE 93 checksum (modulo 47).&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return string checksum code.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function checksum_code93($code) {&nbsp;</div></li><li><div>    $chars = array(&nbsp;</div></li><li><div>        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', &nbsp;</div></li><li><div>        'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', &nbsp;</div></li><li><div>        'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', &nbsp;</div></li><li><div>        'W', 'X', 'Y', 'Z', '-', '.', ' ', '$', '/', '+', '%', &nbsp;</div></li><li><div>        '&lt;', '=', '&gt;', '?');&nbsp;</div></li><li><div>    // translate special characters&nbsp;</div></li><li><div>    $code = strtr($code, chr(128).chr(131).chr(129).chr(130), '&lt;=&gt;?');&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    // calculate check digit C&nbsp;</div></li><li><div>    $p = 1;&nbsp;</div></li><li><div>    $check = 0;&nbsp;</div></li><li><div>    for ($i = ($len - 1); $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>        $k = array_keys($chars, $code{$i});&nbsp;</div></li><li><div>        $check += ($k[0] * $p);&nbsp;</div></li><li><div>        ++$p;&nbsp;</div></li><li><div>        if ($p &gt; 20) {&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $check %= 47;&nbsp;</div></li><li><div>    $c = $chars[$check];&nbsp;</div></li><li><div>    $code .= $c;&nbsp;</div></li><li><div>    // calculate check digit K&nbsp;</div></li><li><div>    $p = 1;&nbsp;</div></li><li><div>    $check = 0;&nbsp;</div></li><li><div>    for ($i = $len; $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>        $k = array_keys($chars, $code{$i});&nbsp;</div></li><li><div>        $check += ($k[0] * $p);&nbsp;</div></li><li><div>        ++$p;&nbsp;</div></li><li><div>        if ($p &gt; 15) {&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $check %= 47;&nbsp;</div></li><li><div>    $k = $chars[$check];&nbsp;</div></li><li><div>    $checksum = $c.$k;&nbsp;</div></li><li><div>    // resto respecial characters&nbsp;</div></li><li><div>    $checksum = strtr($checksum, '&lt;=&gt;?', chr(128).chr(131).chr(129).chr(130));&nbsp;</div></li><li><div>    return $checksum;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Checksum for standard 2 of 5 barcodes.&nbsp;</div></li><li><div> * @param $code (string) code to process.&nbsp;</div></li><li><div> * @return int checksum.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function checksum_s25($code) {&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    $sum = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; $i+=2) {&nbsp;</div></li><li><div>        $sum += $code{$i};&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $sum *= 3;&nbsp;</div></li><li><div>    for ($i = 1; $i &lt; $len; $i+=2) {&nbsp;</div></li><li><div>        $sum += ($code{$i});&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $r = $sum % 10;&nbsp;</div></li><li><div>    if($r &gt; 0) {&nbsp;</div></li><li><div>        $r = (10 - $r);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * MSI.&nbsp;</div></li><li><div> * Variation of Plessey code, with similar applications&nbsp;</div></li><li><div> * Contains digits (0 to 9) and encodes the data only in the width of bars.&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $checksum (boolean) if true add a checksum to the code (modulo 11)&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_msi($code, $checksum=false) {&nbsp;</div></li><li><div>    $chr['0'] = '100100100100';&nbsp;</div></li><li><div>    $chr['1'] = '100100100110';&nbsp;</div></li><li><div>    $chr['2'] = '100100110100';&nbsp;</div></li><li><div>    $chr['3'] = '100100110110';&nbsp;</div></li><li><div>    $chr['4'] = '100110100100';&nbsp;</div></li><li><div>    $chr['5'] = '100110100110';&nbsp;</div></li><li><div>    $chr['6'] = '100110110100';&nbsp;</div></li><li><div>    $chr['7'] = '100110110110';&nbsp;</div></li><li><div>    $chr['8'] = '110100100100';&nbsp;</div></li><li><div>    $chr['9'] = '110100100110';&nbsp;</div></li><li><div>    $chr['A'] = '110100110100';&nbsp;</div></li><li><div>    $chr['B'] = '110100110110';&nbsp;</div></li><li><div>    $chr['C'] = '110110100100';&nbsp;</div></li><li><div>    $chr['D'] = '110110100110';&nbsp;</div></li><li><div>    $chr['E'] = '110110110100';&nbsp;</div></li><li><div>    $chr['F'] = '110110110110';&nbsp;</div></li><li><div>    if ($checksum) {&nbsp;</div></li><li><div>        // add checksum&nbsp;</div></li><li><div>        $clen = strlen($code);&nbsp;</div></li><li><div>        $p = 2;&nbsp;</div></li><li><div>        $check = 0;&nbsp;</div></li><li><div>        for ($i = ($clen - 1); $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>            $check += (hexdec($code{$i}) * $p);&nbsp;</div></li><li><div>            ++$p;&nbsp;</div></li><li><div>            if ($p &gt; 7) {&nbsp;</div></li><li><div>                $p = 2;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $check %= 11;&nbsp;</div></li><li><div>        if ($check &gt; 0) {&nbsp;</div></li><li><div>            $check = 11 - $check;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $code .= $check;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq = '110'; // left guard&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $digit = $code{$i};&nbsp;</div></li><li><div>        if (!isset($chr[$digit])) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= $chr[$digit];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq .= '1001'; // right guard&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    return $this-&gt;binseq_to_array($seq, $bararray);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Standard 2 of 5 barcodes.&nbsp;</div></li><li><div> * Used in airline ticket marking, photofinishing&nbsp;</div></li><li><div> * Contains digits (0 to 9) and encodes the data only in the width of bars.&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $checksum (boolean) if true add a checksum to the code&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_s25($code, $checksum=false) {&nbsp;</div></li><li><div>    $chr['0'] = '10101110111010';&nbsp;</div></li><li><div>    $chr['1'] = '11101010101110';&nbsp;</div></li><li><div>    $chr['2'] = '10111010101110';&nbsp;</div></li><li><div>    $chr['3'] = '11101110101010';&nbsp;</div></li><li><div>    $chr['4'] = '10101110101110';&nbsp;</div></li><li><div>    $chr['5'] = '11101011101010';&nbsp;</div></li><li><div>    $chr['6'] = '10111011101010';&nbsp;</div></li><li><div>    $chr['7'] = '10101011101110';&nbsp;</div></li><li><div>    $chr['8'] = '10101110111010';&nbsp;</div></li><li><div>    $chr['9'] = '10111010111010';&nbsp;</div></li><li><div>    if ($checksum) {&nbsp;</div></li><li><div>        // add checksum&nbsp;</div></li><li><div>        $code .= $this-&gt;checksum_s25($code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if((strlen($code) % 2) != 0) {&nbsp;</div></li><li><div>        // add leading zero if code-length is odd&nbsp;</div></li><li><div>        $code = '0'.$code;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq = '11011010';&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $digit = $code{$i};&nbsp;</div></li><li><div>        if (!isset($chr[$digit])) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= $chr[$digit];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq .= '1101011';&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    return $this-&gt;binseq_to_array($seq, $bararray);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Convert binary barcode sequence to TCPDF barcode array.&nbsp;</div></li><li><div> * @param $seq (string) barcode as binary sequence.&nbsp;</div></li><li><div> * @param $bararray (array) barcode array.&nbsp;</div></li><li><div> * param array $bararray TCPDF barcode array to fill up&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function binseq_to_array($seq, $bararray) {&nbsp;</div></li><li><div>    $len = strlen($seq);&nbsp;</div></li><li><div>    $w = 0;&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        $w += 1;&nbsp;</div></li><li><div>        if (($i == ($len - 1)) OR (($i &lt; ($len - 1)) AND ($seq{$i} != $seq{($i+1)}))) {&nbsp;</div></li><li><div>            if ($seq{$i} == '1') {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>            $w = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Interleaved 2 of 5 barcodes.&nbsp;</div></li><li><div> * Compact numeric code, widely used in industry, air cargo&nbsp;</div></li><li><div> * Contains digits (0 to 9) and encodes the data in the width of both bars and spaces.&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $checksum (boolean) if true add a checksum to the code&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_i25($code, $checksum=false) {&nbsp;</div></li><li><div>    $chr['0'] = '11221';&nbsp;</div></li><li><div>    $chr['1'] = '21112';&nbsp;</div></li><li><div>    $chr['2'] = '12112';&nbsp;</div></li><li><div>    $chr['3'] = '22111';&nbsp;</div></li><li><div>    $chr['4'] = '11212';&nbsp;</div></li><li><div>    $chr['5'] = '21211';&nbsp;</div></li><li><div>    $chr['6'] = '12211';&nbsp;</div></li><li><div>    $chr['7'] = '11122';&nbsp;</div></li><li><div>    $chr['8'] = '21121';&nbsp;</div></li><li><div>    $chr['9'] = '12121';&nbsp;</div></li><li><div>    $chr['A'] = '11';&nbsp;</div></li><li><div>    $chr['Z'] = '21';&nbsp;</div></li><li><div>    if ($checksum) {&nbsp;</div></li><li><div>        // add checksum&nbsp;</div></li><li><div>        $code .= $this-&gt;checksum_s25($code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if((strlen($code) % 2) != 0) {&nbsp;</div></li><li><div>        // add leading zero if code-length is odd&nbsp;</div></li><li><div>        $code = '0'.$code;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // add start and stop codes&nbsp;</div></li><li><div>    $code = 'AA'.strtolower($code).'ZA';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; $i = ($i + 2)) {&nbsp;</div></li><li><div>        $char_bar = $code{$i};&nbsp;</div></li><li><div>        $char_space = $code{$i+1};&nbsp;</div></li><li><div>        if((!isset($chr[$char_bar])) OR (!isset($chr[$char_space]))) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // create a bar-space sequence&nbsp;</div></li><li><div>        $seq = '';&nbsp;</div></li><li><div>        $chrlen = strlen($chr[$char_bar]);&nbsp;</div></li><li><div>        for ($s = 0; $s &lt; $chrlen; $s++) {&nbsp;</div></li><li><div>            $seq .= $chr[$char_bar]{$s} . $chr[$char_space]{$s};&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seqlen = strlen($seq);&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; $seqlen; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $seq{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * C128 barcodes.&nbsp;</div></li><li><div> * Very capable code, excellent density, high reliability; in very wide use world-wide&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $type (string) barcode type: A, B, C or empty for automatic switch (AUTO mode)&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_c128($code, $type='') {&nbsp;</div></li><li><div>    $chr = array(&nbsp;</div></li><li><div>        '212222', /** 00 */&nbsp;</div></li><li><div>        '222122', /** 01 */&nbsp;</div></li><li><div>        '222221', /** 02 */&nbsp;</div></li><li><div>        '121223', /** 03 */&nbsp;</div></li><li><div>        '121322', /** 04 */&nbsp;</div></li><li><div>        '131222', /** 05 */&nbsp;</div></li><li><div>        '122213', /** 06 */&nbsp;</div></li><li><div>        '122312', /** 07 */&nbsp;</div></li><li><div>        '132212', /** 08 */&nbsp;</div></li><li><div>        '221213', /** 09 */&nbsp;</div></li><li><div>        '221312', /** 10 */&nbsp;</div></li><li><div>        '231212', /** 11 */&nbsp;</div></li><li><div>        '112232', /** 12 */&nbsp;</div></li><li><div>        '122132', /** 13 */&nbsp;</div></li><li><div>        '122231', /** 14 */&nbsp;</div></li><li><div>        '113222', /** 15 */&nbsp;</div></li><li><div>        '123122', /** 16 */&nbsp;</div></li><li><div>        '123221', /** 17 */&nbsp;</div></li><li><div>        '223211', /** 18 */&nbsp;</div></li><li><div>        '221132', /** 19 */&nbsp;</div></li><li><div>        '221231', /** 20 */&nbsp;</div></li><li><div>        '213212', /** 21 */&nbsp;</div></li><li><div>        '223112', /** 22 */&nbsp;</div></li><li><div>        '312131', /** 23 */&nbsp;</div></li><li><div>        '311222', /** 24 */&nbsp;</div></li><li><div>        '321122', /** 25 */&nbsp;</div></li><li><div>        '321221', /** 26 */&nbsp;</div></li><li><div>        '312212', /** 27 */&nbsp;</div></li><li><div>        '322112', /** 28 */&nbsp;</div></li><li><div>        '322211', /** 29 */&nbsp;</div></li><li><div>        '212123', /** 30 */&nbsp;</div></li><li><div>        '212321', /** 31 */&nbsp;</div></li><li><div>        '232121', /** 32 */&nbsp;</div></li><li><div>        '111323', /** 33 */&nbsp;</div></li><li><div>        '131123', /** 34 */&nbsp;</div></li><li><div>        '131321', /** 35 */&nbsp;</div></li><li><div>        '112313', /** 36 */&nbsp;</div></li><li><div>        '132113', /** 37 */&nbsp;</div></li><li><div>        '132311', /** 38 */&nbsp;</div></li><li><div>        '211313', /** 39 */&nbsp;</div></li><li><div>        '231113', /** 40 */&nbsp;</div></li><li><div>        '231311', /** 41 */&nbsp;</div></li><li><div>        '112133', /** 42 */&nbsp;</div></li><li><div>        '112331', /** 43 */&nbsp;</div></li><li><div>        '132131', /** 44 */&nbsp;</div></li><li><div>        '113123', /** 45 */&nbsp;</div></li><li><div>        '113321', /** 46 */&nbsp;</div></li><li><div>        '133121', /** 47 */&nbsp;</div></li><li><div>        '313121', /** 48 */&nbsp;</div></li><li><div>        '211331', /** 49 */&nbsp;</div></li><li><div>        '231131', /** 50 */&nbsp;</div></li><li><div>        '213113', /** 51 */&nbsp;</div></li><li><div>        '213311', /** 52 */&nbsp;</div></li><li><div>        '213131', /** 53 */&nbsp;</div></li><li><div>        '311123', /** 54 */&nbsp;</div></li><li><div>        '311321', /** 55 */&nbsp;</div></li><li><div>        '331121', /** 56 */&nbsp;</div></li><li><div>        '312113', /** 57 */&nbsp;</div></li><li><div>        '312311', /** 58 */&nbsp;</div></li><li><div>        '332111', /** 59 */&nbsp;</div></li><li><div>        '314111', /** 60 */&nbsp;</div></li><li><div>        '221411', /** 61 */&nbsp;</div></li><li><div>        '431111', /** 62 */&nbsp;</div></li><li><div>        '111224', /** 63 */&nbsp;</div></li><li><div>        '111422', /** 64 */&nbsp;</div></li><li><div>        '121124', /** 65 */&nbsp;</div></li><li><div>        '121421', /** 66 */&nbsp;</div></li><li><div>        '141122', /** 67 */&nbsp;</div></li><li><div>        '141221', /** 68 */&nbsp;</div></li><li><div>        '112214', /** 69 */&nbsp;</div></li><li><div>        '112412', /** 70 */&nbsp;</div></li><li><div>        '122114', /** 71 */&nbsp;</div></li><li><div>        '122411', /** 72 */&nbsp;</div></li><li><div>        '142112', /** 73 */&nbsp;</div></li><li><div>        '142211', /** 74 */&nbsp;</div></li><li><div>        '241211', /** 75 */&nbsp;</div></li><li><div>        '221114', /** 76 */&nbsp;</div></li><li><div>        '413111', /** 77 */&nbsp;</div></li><li><div>        '241112', /** 78 */&nbsp;</div></li><li><div>        '134111', /** 79 */&nbsp;</div></li><li><div>        '111242', /** 80 */&nbsp;</div></li><li><div>        '121142', /** 81 */&nbsp;</div></li><li><div>        '121241', /** 82 */&nbsp;</div></li><li><div>        '114212', /** 83 */&nbsp;</div></li><li><div>        '124112', /** 84 */&nbsp;</div></li><li><div>        '124211', /** 85 */&nbsp;</div></li><li><div>        '411212', /** 86 */&nbsp;</div></li><li><div>        '421112', /** 87 */&nbsp;</div></li><li><div>        '421211', /** 88 */&nbsp;</div></li><li><div>        '212141', /** 89 */&nbsp;</div></li><li><div>        '214121', /** 90 */&nbsp;</div></li><li><div>        '412121', /** 91 */&nbsp;</div></li><li><div>        '111143', /** 92 */&nbsp;</div></li><li><div>        '111341', /** 93 */&nbsp;</div></li><li><div>        '131141', /** 94 */&nbsp;</div></li><li><div>        '114113', /** 95 */&nbsp;</div></li><li><div>        '114311', /** 96 */&nbsp;</div></li><li><div>        '411113', /** 97 */&nbsp;</div></li><li><div>        '411311', /** 98 */&nbsp;</div></li><li><div>        '113141', /** 99 */&nbsp;</div></li><li><div>        '114131', /** 100 */&nbsp;</div></li><li><div>        '311141', /** 101 */&nbsp;</div></li><li><div>        '411131', /** 102 */&nbsp;</div></li><li><div>        '211412', /** 103 START A */&nbsp;</div></li><li><div>        '211214', /** 104 START B */&nbsp;</div></li><li><div>        '211232', /** 105 START C */&nbsp;</div></li><li><div>        '233111', /** STOP */&nbsp;</div></li><li><div>        '200000'  /** END */&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    // ASCII characters for code A (ASCII 00 - 95)&nbsp;</div></li><li><div>    $keys_a = ' !&quot;#$%&\'()*+, -./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_';&nbsp;</div></li><li><div>    $keys_a .= chr(0).chr(1).chr(2).chr(3).chr(4).chr(5).chr(6).chr(7).chr(8).chr(9);&nbsp;</div></li><li><div>    $keys_a .= chr(10).chr(11).chr(12).chr(13).chr(14).chr(15).chr(16).chr(17).chr(18).chr(19);&nbsp;</div></li><li><div>    $keys_a .= chr(20).chr(21).chr(22).chr(23).chr(24).chr(25).chr(26).chr(27).chr(28).chr(29);&nbsp;</div></li><li><div>    $keys_a .= chr(30).chr(31);&nbsp;</div></li><li><div>    // ASCII characters for code B (ASCII 32 - 127)&nbsp;</div></li><li><div>    $keys_b = ' !&quot;#$%&\'()*+, -./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~'.chr(127);&nbsp;</div></li><li><div>    // special codes&nbsp;</div></li><li><div>    $fnc_a = array(241 =&gt; 102, 242 =&gt; 97, 243 =&gt; 96, 244 =&gt; 101);&nbsp;</div></li><li><div>    $fnc_b = array(241 =&gt; 102, 242 =&gt; 97, 243 =&gt; 96, 244 =&gt; 100);&nbsp;</div></li><li><div>    // array of symbols&nbsp;</div></li><li><div>    $code_data = array();&nbsp;</div></li><li><div>    // lenght of the code&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    switch(strtoupper($type)) {&nbsp;</div></li><li><div>        case 'A': { // MODE A&nbsp;</div></li><li><div>            $startid = 103;&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>                $char = $code{$i};&nbsp;</div></li><li><div>                $char_id = ord($char);&nbsp;</div></li><li><div>                if (($char_id &gt;= 241) AND ($char_id &lt;= 244)) {&nbsp;</div></li><li><div>                    $code_data[] = $fnc_a[$char_id];&nbsp;</div></li><li><div>                } elseif (($char_id &gt;= 0) AND ($char_id &lt;= 95)) {&nbsp;</div></li><li><div>                    $code_data[] = strpos($keys_a, $char);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'B': { // MODE B&nbsp;</div></li><li><div>            $startid = 104;&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>                $char = $code{$i};&nbsp;</div></li><li><div>                $char_id = ord($char);&nbsp;</div></li><li><div>                if (($char_id &gt;= 241) AND ($char_id &lt;= 244)) {&nbsp;</div></li><li><div>                    $code_data[] = $fnc_b[$char_id];&nbsp;</div></li><li><div>                } elseif (($char_id &gt;= 32) AND ($char_id &lt;= 127)) {&nbsp;</div></li><li><div>                    $code_data[] = strpos($keys_b, $char);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C': { // MODE C&nbsp;</div></li><li><div>            $startid = 105;&nbsp;</div></li><li><div>            if (ord($code[0]) == 241) {&nbsp;</div></li><li><div>                $code_data[] = 102;&nbsp;</div></li><li><div>                $code = substr($code, 1);&nbsp;</div></li><li><div>                --$len;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (($len % 2) != 0) {&nbsp;</div></li><li><div>                // the length must be even&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $len; $i+=2) {&nbsp;</div></li><li><div>                $chrnum = $code{$i}.$code{$i+1};&nbsp;</div></li><li><div>                if (preg_match('/([0-9]{2})/', $chrnum) &gt; 0) {&nbsp;</div></li><li><div>                    $code_data[] = intval($chrnum);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        default: { // MODE AUTO&nbsp;</div></li><li><div>            // split code into sequences&nbsp;</div></li><li><div>            $sequence = array();&nbsp;</div></li><li><div>            // get numeric sequences (if any)&nbsp;</div></li><li><div>            $numseq = array();&nbsp;</div></li><li><div>            preg_match_all('/([0-9]{4, })/', $code, $numseq, PREG_OFFSET_CAPTURE);&nbsp;</div></li><li><div>            if (isset($numseq[1]) AND !empty($numseq[1])) {&nbsp;</div></li><li><div>                $end_offset = 0;&nbsp;</div></li><li><div>                foreach ($numseq[1] as $val) {&nbsp;</div></li><li><div>                    $offset = $val[1];&nbsp;</div></li><li><div>                    if ($offset &gt; $end_offset) {&nbsp;</div></li><li><div>                        // non numeric sequence&nbsp;</div></li><li><div>                        $sequence = array_merge($sequence, $this-&gt;get128ABsequence(substr($code, $end_offset, ($offset - $end_offset))));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // numeric sequence&nbsp;</div></li><li><div>                    $slen = strlen($val[0]);&nbsp;</div></li><li><div>                    if (($slen % 2) != 0) {&nbsp;</div></li><li><div>                        // the length must be even&nbsp;</div></li><li><div>                        --$slen;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $sequence[] = array('C', substr($code, $offset, $slen), $slen);&nbsp;</div></li><li><div>                    $end_offset = $offset + $slen;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($end_offset &lt; $len) {&nbsp;</div></li><li><div>                    $sequence = array_merge($sequence, $this-&gt;get128ABsequence(substr($code, $end_offset)));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // text code (non C mode)&nbsp;</div></li><li><div>                $sequence = array_merge($sequence, $this-&gt;get128ABsequence($code));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // process the sequence&nbsp;</div></li><li><div>            foreach ($sequence as $key =&gt; $seq) {&nbsp;</div></li><li><div>                switch($seq[0]) {&nbsp;</div></li><li><div>                    case 'A': {&nbsp;</div></li><li><div>                        if ($key == 0) {&nbsp;</div></li><li><div>                            $startid = 103;&nbsp;</div></li><li><div>                        } elseif ($sequence[($key - 1)][0] != 'A') {&nbsp;</div></li><li><div>                            if (($seq[2] == 1) AND ($key &gt; 0) AND ($sequence[($key - 1)][0] == 'B') AND (!isset($sequence[($key - 1)][3]))) {&nbsp;</div></li><li><div>                                // single character shift&nbsp;</div></li><li><div>                                $code_data[] = 98;&nbsp;</div></li><li><div>                                // mark shift&nbsp;</div></li><li><div>                                $sequence[$key][3] = true;&nbsp;</div></li><li><div>                            } elseif (!isset($sequence[($key - 1)][3])) {&nbsp;</div></li><li><div>                                $code_data[] = 101;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; $seq[2]; ++$i) {&nbsp;</div></li><li><div>                            $char = $seq[1]{$i};&nbsp;</div></li><li><div>                            $char_id = ord($char);&nbsp;</div></li><li><div>                            if (($char_id &gt;= 241) AND ($char_id &lt;= 244)) {&nbsp;</div></li><li><div>                                $code_data[] = $fnc_a[$char_id];&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $code_data[] = strpos($keys_a, $char);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    case 'B': {&nbsp;</div></li><li><div>                        if ($key == 0) {&nbsp;</div></li><li><div>                            $tmpchr = ord($seq[1][0]);&nbsp;</div></li><li><div>                            if (($seq[2] == 1) AND ($tmpchr &gt;= 241) AND ($tmpchr &lt;= 244) AND isset($sequence[($key + 1)]) AND ($sequence[($key + 1)][0] != 'B')) {&nbsp;</div></li><li><div>                                switch ($sequence[($key + 1)][0]) {&nbsp;</div></li><li><div>                                    case 'A': {&nbsp;</div></li><li><div>                                        $startid = 103;&nbsp;</div></li><li><div>                                        $sequence[$key][0] = 'A';&nbsp;</div></li><li><div>                                        $code_data[] = $fnc_a[$tmpchr];&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    case 'C': {&nbsp;</div></li><li><div>                                        $startid = 105;&nbsp;</div></li><li><div>                                        $sequence[$key][0] = 'C';&nbsp;</div></li><li><div>                                        $code_data[] = $fnc_a[$tmpchr];&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $startid = 104;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } elseif ($sequence[($key - 1)][0] != 'B') {&nbsp;</div></li><li><div>                            if (($seq[2] == 1) AND ($key &gt; 0) AND ($sequence[($key - 1)][0] == 'A') AND (!isset($sequence[($key - 1)][3]))) {&nbsp;</div></li><li><div>                                // single character shift&nbsp;</div></li><li><div>                                $code_data[] = 98;&nbsp;</div></li><li><div>                                // mark shift&nbsp;</div></li><li><div>                                $sequence[$key][3] = true;&nbsp;</div></li><li><div>                            } elseif (!isset($sequence[($key - 1)][3])) {&nbsp;</div></li><li><div>                                $code_data[] = 100;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; $seq[2]; ++$i) {&nbsp;</div></li><li><div>                            $char = $seq[1]{$i};&nbsp;</div></li><li><div>                            $char_id = ord($char);&nbsp;</div></li><li><div>                            if (($char_id &gt;= 241) AND ($char_id &lt;= 244)) {&nbsp;</div></li><li><div>                                $code_data[] = $fnc_b[$char_id];&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $code_data[] = strpos($keys_b, $char);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    case 'C': {&nbsp;</div></li><li><div>                        if ($key == 0) {&nbsp;</div></li><li><div>                            $startid = 105;&nbsp;</div></li><li><div>                        } elseif ($sequence[($key - 1)][0] != 'C') {&nbsp;</div></li><li><div>                            $code_data[] = 99;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; $seq[2]; $i+=2) {&nbsp;</div></li><li><div>                            $chrnum = $seq[1]{$i}.$seq[1]{$i+1};&nbsp;</div></li><li><div>                            $code_data[] = intval($chrnum);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // calculate check character&nbsp;</div></li><li><div>    $sum = $startid;&nbsp;</div></li><li><div>    foreach ($code_data as $key =&gt; $val) {&nbsp;</div></li><li><div>        $sum += ($val * ($key + 1));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // add check character&nbsp;</div></li><li><div>    $code_data[] = ($sum % 103);&nbsp;</div></li><li><div>    // add stop sequence&nbsp;</div></li><li><div>    $code_data[] = 106;&nbsp;</div></li><li><div>    $code_data[] = 107;&nbsp;</div></li><li><div>    // add start code at the beginning&nbsp;</div></li><li><div>    array_unshift($code_data, $startid);&nbsp;</div></li><li><div>    // build barcode array&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    foreach ($code_data as $val) {&nbsp;</div></li><li><div>        $seq = $chr[$val];&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 6; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $seq{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Split text code in A/B sequence for 128 code&nbsp;</div></li><li><div> * @param $code (string) code to split.&nbsp;</div></li><li><div> * @return array sequence&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function get128ABsequence($code) {&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    $sequence = array();&nbsp;</div></li><li><div>    // get A sequences (if any)&nbsp;</div></li><li><div>    $numseq = array();&nbsp;</div></li><li><div>    preg_match_all('/([\0-\31])/', $code, $numseq, PREG_OFFSET_CAPTURE);&nbsp;</div></li><li><div>    if (isset($numseq[1]) AND !empty($numseq[1])) {&nbsp;</div></li><li><div>        $end_offset = 0;&nbsp;</div></li><li><div>        foreach ($numseq[1] as $val) {&nbsp;</div></li><li><div>            $offset = $val[1];&nbsp;</div></li><li><div>            if ($offset &gt; $end_offset) {&nbsp;</div></li><li><div>                // B sequence&nbsp;</div></li><li><div>                $sequence[] = array('B', substr($code, $end_offset, ($offset - $end_offset)), ($offset - $end_offset));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // A sequence&nbsp;</div></li><li><div>            $slen = strlen($val[0]);&nbsp;</div></li><li><div>            $sequence[] = array('A', substr($code, $offset, $slen), $slen);&nbsp;</div></li><li><div>            $end_offset = $offset + $slen;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($end_offset &lt; $len) {&nbsp;</div></li><li><div>            $sequence[] = array('B', substr($code, $end_offset), ($len - $end_offset));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        // only B sequence&nbsp;</div></li><li><div>        $sequence[] = array('B', $code, $len);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $sequence;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * EAN13 and UPC-A barcodes.&nbsp;</div></li><li><div> * EAN13: European Article Numbering international retail product code&nbsp;</div></li><li><div> * UPC-A: Universal product code seen on almost all retail products in the USA and Canada&nbsp;</div></li><li><div> * UPC-E: Short version of UPC symbol&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $len (string) barcode type: 6 = UPC-E, 8 = EAN8, 13 = EAN13, 12 = UPC-A&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_eanupc($code, $len=13) {&nbsp;</div></li><li><div>    $upce = false;&nbsp;</div></li><li><div>    if ($len == 6) {&nbsp;</div></li><li><div>        $len = 12; // UPC-A&nbsp;</div></li><li><div>        $upce = true; // UPC-E mode&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $data_len = $len - 1;&nbsp;</div></li><li><div>    //Padding&nbsp;</div></li><li><div>    $code = str_pad($code, $data_len, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>    $code_len = strlen($code);&nbsp;</div></li><li><div>    // calculate check digit&nbsp;</div></li><li><div>    $sum_a = 0;&nbsp;</div></li><li><div>    for ($i = 1; $i &lt; $data_len; $i+=2) {&nbsp;</div></li><li><div>        $sum_a += $code{$i};&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($len &gt; 12) {&nbsp;</div></li><li><div>        $sum_a *= 3;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $sum_b = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $data_len; $i+=2) {&nbsp;</div></li><li><div>        $sum_b += ($code{$i});&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($len &lt; 13) {&nbsp;</div></li><li><div>        $sum_b *= 3;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $r = ($sum_a + $sum_b) % 10;&nbsp;</div></li><li><div>    if($r &gt; 0) {&nbsp;</div></li><li><div>        $r = (10 - $r);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($code_len == $data_len) {&nbsp;</div></li><li><div>        // add check digit&nbsp;</div></li><li><div>        $code .= $r;&nbsp;</div></li><li><div>    } elseif ($r !== intval($code{$data_len})) {&nbsp;</div></li><li><div>        // wrong checkdigit&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($len == 12) {&nbsp;</div></li><li><div>        // UPC-A&nbsp;</div></li><li><div>        $code = '0'.$code;&nbsp;</div></li><li><div>        ++$len;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($upce) {&nbsp;</div></li><li><div>        // convert UPC-A to UPC-E&nbsp;</div></li><li><div>        $tmp = substr($code, 4, 3);&nbsp;</div></li><li><div>        if (($tmp == '000') OR ($tmp == '100') OR ($tmp == '200')) {&nbsp;</div></li><li><div>            // manufacturer code ends in 000, 100, or 200&nbsp;</div></li><li><div>            $upce_code = substr($code, 2, 2).substr($code, 9, 3).substr($code, 4, 1);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $tmp = substr($code, 5, 2);&nbsp;</div></li><li><div>            if ($tmp == '00') {&nbsp;</div></li><li><div>                // manufacturer code ends in 00&nbsp;</div></li><li><div>                $upce_code = substr($code, 2, 3).substr($code, 10, 2).'3';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tmp = substr($code, 6, 1);&nbsp;</div></li><li><div>                if ($tmp == '0') {&nbsp;</div></li><li><div>                    // manufacturer code ends in 0&nbsp;</div></li><li><div>                    $upce_code = substr($code, 2, 4).substr($code, 11, 1).'4';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // manufacturer code does not end in zero&nbsp;</div></li><li><div>                    $upce_code = substr($code, 2, 5).substr($code, 11, 1);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    //Convert digits to bars&nbsp;</div></li><li><div>    $codes = array(&nbsp;</div></li><li><div>        'A'=&gt;array( // left odd parity&nbsp;</div></li><li><div>            '0'=&gt;'0001101', &nbsp;</div></li><li><div>            '1'=&gt;'0011001', &nbsp;</div></li><li><div>            '2'=&gt;'0010011', &nbsp;</div></li><li><div>            '3'=&gt;'0111101', &nbsp;</div></li><li><div>            '4'=&gt;'0100011', &nbsp;</div></li><li><div>            '5'=&gt;'0110001', &nbsp;</div></li><li><div>            '6'=&gt;'0101111', &nbsp;</div></li><li><div>            '7'=&gt;'0111011', &nbsp;</div></li><li><div>            '8'=&gt;'0110111', &nbsp;</div></li><li><div>            '9'=&gt;'0001011'), &nbsp;</div></li><li><div>        'B'=&gt;array( // left even parity&nbsp;</div></li><li><div>            '0'=&gt;'0100111', &nbsp;</div></li><li><div>            '1'=&gt;'0110011', &nbsp;</div></li><li><div>            '2'=&gt;'0011011', &nbsp;</div></li><li><div>            '3'=&gt;'0100001', &nbsp;</div></li><li><div>            '4'=&gt;'0011101', &nbsp;</div></li><li><div>            '5'=&gt;'0111001', &nbsp;</div></li><li><div>            '6'=&gt;'0000101', &nbsp;</div></li><li><div>            '7'=&gt;'0010001', &nbsp;</div></li><li><div>            '8'=&gt;'0001001', &nbsp;</div></li><li><div>            '9'=&gt;'0010111'), &nbsp;</div></li><li><div>        'C'=&gt;array( // right&nbsp;</div></li><li><div>            '0'=&gt;'1110010', &nbsp;</div></li><li><div>            '1'=&gt;'1100110', &nbsp;</div></li><li><div>            '2'=&gt;'1101100', &nbsp;</div></li><li><div>            '3'=&gt;'1000010', &nbsp;</div></li><li><div>            '4'=&gt;'1011100', &nbsp;</div></li><li><div>            '5'=&gt;'1001110', &nbsp;</div></li><li><div>            '6'=&gt;'1010000', &nbsp;</div></li><li><div>            '7'=&gt;'1000100', &nbsp;</div></li><li><div>            '8'=&gt;'1001000', &nbsp;</div></li><li><div>            '9'=&gt;'1110100')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $parities = array(&nbsp;</div></li><li><div>        '0'=&gt;array('A', 'A', 'A', 'A', 'A', 'A'), &nbsp;</div></li><li><div>        '1'=&gt;array('A', 'A', 'B', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '2'=&gt;array('A', 'A', 'B', 'B', 'A', 'B'), &nbsp;</div></li><li><div>        '3'=&gt;array('A', 'A', 'B', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '4'=&gt;array('A', 'B', 'A', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '5'=&gt;array('A', 'B', 'B', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '6'=&gt;array('A', 'B', 'B', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '7'=&gt;array('A', 'B', 'A', 'B', 'A', 'B'), &nbsp;</div></li><li><div>        '8'=&gt;array('A', 'B', 'A', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '9'=&gt;array('A', 'B', 'B', 'A', 'B', 'A')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $upce_parities = array();&nbsp;</div></li><li><div>    $upce_parities[0] = array(&nbsp;</div></li><li><div>        '0'=&gt;array('B', 'B', 'B', 'A', 'A', 'A'), &nbsp;</div></li><li><div>        '1'=&gt;array('B', 'B', 'A', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '2'=&gt;array('B', 'B', 'A', 'A', 'B', 'A'), &nbsp;</div></li><li><div>        '3'=&gt;array('B', 'B', 'A', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '4'=&gt;array('B', 'A', 'B', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '5'=&gt;array('B', 'A', 'A', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '6'=&gt;array('B', 'A', 'A', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '7'=&gt;array('B', 'A', 'B', 'A', 'B', 'A'), &nbsp;</div></li><li><div>        '8'=&gt;array('B', 'A', 'B', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '9'=&gt;array('B', 'A', 'A', 'B', 'A', 'B')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $upce_parities[1] = array(&nbsp;</div></li><li><div>        '0'=&gt;array('A', 'A', 'A', 'B', 'B', 'B'), &nbsp;</div></li><li><div>        '1'=&gt;array('A', 'A', 'B', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '2'=&gt;array('A', 'A', 'B', 'B', 'A', 'B'), &nbsp;</div></li><li><div>        '3'=&gt;array('A', 'A', 'B', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '4'=&gt;array('A', 'B', 'A', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '5'=&gt;array('A', 'B', 'B', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '6'=&gt;array('A', 'B', 'B', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '7'=&gt;array('A', 'B', 'A', 'B', 'A', 'B'), &nbsp;</div></li><li><div>        '8'=&gt;array('A', 'B', 'A', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '9'=&gt;array('A', 'B', 'B', 'A', 'B', 'A')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $seq = '101'; // left guard bar&nbsp;</div></li><li><div>    if ($upce) {&nbsp;</div></li><li><div>        $bararray = array('code' =&gt; $upce_code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>        $p = $upce_parities[$code[1]][$r];&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; 6; ++$i) {&nbsp;</div></li><li><div>            $seq .= $codes[$p[$i]][$upce_code{$i}];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= '010101'; // right guard bar&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>        $half_len = intval(ceil($len / 2));&nbsp;</div></li><li><div>        if ($len == 8) {&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $half_len; ++$i) {&nbsp;</div></li><li><div>                $seq .= $codes['A'][$code{$i}];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $p = $parities[$code[0]];&nbsp;</div></li><li><div>            for ($i = 1; $i &lt; $half_len; ++$i) {&nbsp;</div></li><li><div>                $seq .= $codes[$p[$i-1]][$code{$i}];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= '01010'; // center guard bar&nbsp;</div></li><li><div>        for ($i = $half_len; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>            $seq .= $codes['C'][$code{$i}];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= '101'; // right guard bar&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $clen = strlen($seq);&nbsp;</div></li><li><div>    $w = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $w += 1;&nbsp;</div></li><li><div>        if (($i == ($clen - 1)) OR (($i &lt; ($clen - 1)) AND ($seq{$i} != $seq{($i+1)}))) {&nbsp;</div></li><li><div>            if ($seq{$i} == '1') {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>            $w = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * UPC-Based Extentions&nbsp;</div></li><li><div> * 2-Digit Ext.: Used to indicate magazines and newspaper issue numbers&nbsp;</div></li><li><div> * 5-Digit Ext.: Used to mark suggested retail price of books&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $len (string) barcode type: 2 = 2-Digit, 5 = 5-Digit&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_eanext($code, $len=5) {&nbsp;</div></li><li><div>    //Padding&nbsp;</div></li><li><div>    $code = str_pad($code, $len, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>    // calculate check digit&nbsp;</div></li><li><div>    if ($len == 2) {&nbsp;</div></li><li><div>        $r = $code % 4;&nbsp;</div></li><li><div>    } elseif ($len == 5) {&nbsp;</div></li><li><div>        $r = (3 * ($code[0] + $code[2] + $code[4])) + (9 * ($code[1] + $code[3]));&nbsp;</div></li><li><div>        $r %= 10;&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    //Convert digits to bars&nbsp;</div></li><li><div>    $codes = array(&nbsp;</div></li><li><div>        'A'=&gt;array( // left odd parity&nbsp;</div></li><li><div>            '0'=&gt;'0001101', &nbsp;</div></li><li><div>            '1'=&gt;'0011001', &nbsp;</div></li><li><div>            '2'=&gt;'0010011', &nbsp;</div></li><li><div>            '3'=&gt;'0111101', &nbsp;</div></li><li><div>            '4'=&gt;'0100011', &nbsp;</div></li><li><div>            '5'=&gt;'0110001', &nbsp;</div></li><li><div>            '6'=&gt;'0101111', &nbsp;</div></li><li><div>            '7'=&gt;'0111011', &nbsp;</div></li><li><div>            '8'=&gt;'0110111', &nbsp;</div></li><li><div>            '9'=&gt;'0001011'), &nbsp;</div></li><li><div>        'B'=&gt;array( // left even parity&nbsp;</div></li><li><div>            '0'=&gt;'0100111', &nbsp;</div></li><li><div>            '1'=&gt;'0110011', &nbsp;</div></li><li><div>            '2'=&gt;'0011011', &nbsp;</div></li><li><div>            '3'=&gt;'0100001', &nbsp;</div></li><li><div>            '4'=&gt;'0011101', &nbsp;</div></li><li><div>            '5'=&gt;'0111001', &nbsp;</div></li><li><div>            '6'=&gt;'0000101', &nbsp;</div></li><li><div>            '7'=&gt;'0010001', &nbsp;</div></li><li><div>            '8'=&gt;'0001001', &nbsp;</div></li><li><div>            '9'=&gt;'0010111')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $parities = array();&nbsp;</div></li><li><div>    $parities[2] = array(&nbsp;</div></li><li><div>        '0'=&gt;array('A', 'A'), &nbsp;</div></li><li><div>        '1'=&gt;array('A', 'B'), &nbsp;</div></li><li><div>        '2'=&gt;array('B', 'A'), &nbsp;</div></li><li><div>        '3'=&gt;array('B', 'B')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $parities[5] = array(&nbsp;</div></li><li><div>        '0'=&gt;array('B', 'B', 'A', 'A', 'A'), &nbsp;</div></li><li><div>        '1'=&gt;array('B', 'A', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '2'=&gt;array('B', 'A', 'A', 'B', 'A'), &nbsp;</div></li><li><div>        '3'=&gt;array('B', 'A', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '4'=&gt;array('A', 'B', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '5'=&gt;array('A', 'A', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '6'=&gt;array('A', 'A', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '7'=&gt;array('A', 'B', 'A', 'B', 'A'), &nbsp;</div></li><li><div>        '8'=&gt;array('A', 'B', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '9'=&gt;array('A', 'A', 'B', 'A', 'B')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $p = $parities[$len][$r];&nbsp;</div></li><li><div>    $seq = '1011'; // left guard bar&nbsp;</div></li><li><div>    $seq .= $codes[$p[0]][$code[0]];&nbsp;</div></li><li><div>    for ($i = 1; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        $seq .= '01'; // separator&nbsp;</div></li><li><div>        $seq .= $codes[$p[$i]][$code{$i}];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    return $this-&gt;binseq_to_array($seq, $bararray);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * POSTNET and PLANET barcodes.&nbsp;</div></li><li><div> * Used by U.S. Postal Service for automated mail sorting&nbsp;</div></li><li><div> * @param $code (string) zip code to represent. Must be a string containing a zip code of the form DDDDD or DDDDD-DDDD.&nbsp;</div></li><li><div> * @param $planet (boolean) if true print the PLANET barcode, otherwise print POSTNET&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_postnet($code, $planet=false) {&nbsp;</div></li><li><div>    // bar lenght&nbsp;</div></li><li><div>    if ($planet) {&nbsp;</div></li><li><div>        $barlen = Array(&nbsp;</div></li><li><div>            0 =&gt; Array(1, 1, 2, 2, 2), &nbsp;</div></li><li><div>            1 =&gt; Array(2, 2, 2, 1, 1), &nbsp;</div></li><li><div>            2 =&gt; Array(2, 2, 1, 2, 1), &nbsp;</div></li><li><div>            3 =&gt; Array(2, 2, 1, 1, 2), &nbsp;</div></li><li><div>            4 =&gt; Array(2, 1, 2, 2, 1), &nbsp;</div></li><li><div>            5 =&gt; Array(2, 1, 2, 1, 2), &nbsp;</div></li><li><div>            6 =&gt; Array(2, 1, 1, 2, 2), &nbsp;</div></li><li><div>            7 =&gt; Array(1, 2, 2, 2, 1), &nbsp;</div></li><li><div>            8 =&gt; Array(1, 2, 2, 1, 2), &nbsp;</div></li><li><div>            9 =&gt; Array(1, 2, 1, 2, 2)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        $barlen = Array(&nbsp;</div></li><li><div>            0 =&gt; Array(2, 2, 1, 1, 1), &nbsp;</div></li><li><div>            1 =&gt; Array(1, 1, 1, 2, 2), &nbsp;</div></li><li><div>            2 =&gt; Array(1, 1, 2, 1, 2), &nbsp;</div></li><li><div>            3 =&gt; Array(1, 1, 2, 2, 1), &nbsp;</div></li><li><div>            4 =&gt; Array(1, 2, 1, 1, 2), &nbsp;</div></li><li><div>            5 =&gt; Array(1, 2, 1, 2, 1), &nbsp;</div></li><li><div>            6 =&gt; Array(1, 2, 2, 1, 1), &nbsp;</div></li><li><div>            7 =&gt; Array(2, 1, 1, 1, 2), &nbsp;</div></li><li><div>            8 =&gt; Array(2, 1, 1, 2, 1), &nbsp;</div></li><li><div>            9 =&gt; Array(2, 1, 2, 1, 1)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 2, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $code = str_replace('-', '', $code);&nbsp;</div></li><li><div>    $code = str_replace(' ', '', $code);&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    // calculate checksum&nbsp;</div></li><li><div>    $sum = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        $sum += intval($code{$i});&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $chkd = ($sum % 10);&nbsp;</div></li><li><div>    if($chkd &gt; 0) {&nbsp;</div></li><li><div>        $chkd = (10 - $chkd);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $code .= $chkd;&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    // start bar&nbsp;</div></li><li><div>    $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>    $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>    $bararray['maxw'] += 2;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 5; ++$j) {&nbsp;</div></li><li><div>            $h = $barlen[$code{$i}][$j];&nbsp;</div></li><li><div>            $p = floor(1 / $h);&nbsp;</div></li><li><div>            $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; $h, 'p' =&gt; $p);&nbsp;</div></li><li><div>            $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += 2;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // end bar&nbsp;</div></li><li><div>    $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>    $bararray['maxw'] += 1;&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * RMS4CC - CBC - KIX&nbsp;</div></li><li><div> * RMS4CC (Royal Mail 4-state Customer Code) - CBC (Customer Bar Code) - KIX (Klant index - Customer index)&nbsp;</div></li><li><div> * RM4SCC is the name of the barcode symbology used by the Royal Mail for its Cleanmail service.&nbsp;</div></li><li><div> * @param $code (string) code to print&nbsp;</div></li><li><div> * @param $kix (boolean) if true prints the KIX variation (doesn't use the start and end symbols, and the checksum) - in this case the house number must be sufficed with an X and placed at the end of the code.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_rms4cc($code, $kix=false) {&nbsp;</div></li><li><div>    $notkix = !$kix;&nbsp;</div></li><li><div>    // bar mode&nbsp;</div></li><li><div>    // 1 = pos 1, length 2&nbsp;</div></li><li><div>    // 2 = pos 1, length 3&nbsp;</div></li><li><div>    // 3 = pos 2, length 1&nbsp;</div></li><li><div>    // 4 = pos 2, length 2&nbsp;</div></li><li><div>    $barmode = array(&nbsp;</div></li><li><div>        '0' =&gt; array(3, 3, 2, 2), &nbsp;</div></li><li><div>        '1' =&gt; array(3, 4, 1, 2), &nbsp;</div></li><li><div>        '2' =&gt; array(3, 4, 2, 1), &nbsp;</div></li><li><div>        '3' =&gt; array(4, 3, 1, 2), &nbsp;</div></li><li><div>        '4' =&gt; array(4, 3, 2, 1), &nbsp;</div></li><li><div>        '5' =&gt; array(4, 4, 1, 1), &nbsp;</div></li><li><div>        '6' =&gt; array(3, 1, 4, 2), &nbsp;</div></li><li><div>        '7' =&gt; array(3, 2, 3, 2), &nbsp;</div></li><li><div>        '8' =&gt; array(3, 2, 4, 1), &nbsp;</div></li><li><div>        '9' =&gt; array(4, 1, 3, 2), &nbsp;</div></li><li><div>        'A' =&gt; array(4, 1, 4, 1), &nbsp;</div></li><li><div>        'B' =&gt; array(4, 2, 3, 1), &nbsp;</div></li><li><div>        'C' =&gt; array(3, 1, 2, 4), &nbsp;</div></li><li><div>        'D' =&gt; array(3, 2, 1, 4), &nbsp;</div></li><li><div>        'E' =&gt; array(3, 2, 2, 3), &nbsp;</div></li><li><div>        'F' =&gt; array(4, 1, 1, 4), &nbsp;</div></li><li><div>        'G' =&gt; array(4, 1, 2, 3), &nbsp;</div></li><li><div>        'H' =&gt; array(4, 2, 1, 3), &nbsp;</div></li><li><div>        'I' =&gt; array(1, 3, 4, 2), &nbsp;</div></li><li><div>        'J' =&gt; array(1, 4, 3, 2), &nbsp;</div></li><li><div>        'K' =&gt; array(1, 4, 4, 1), &nbsp;</div></li><li><div>        'L' =&gt; array(2, 3, 3, 2), &nbsp;</div></li><li><div>        'M' =&gt; array(2, 3, 4, 1), &nbsp;</div></li><li><div>        'N' =&gt; array(2, 4, 3, 1), &nbsp;</div></li><li><div>        'O' =&gt; array(1, 3, 2, 4), &nbsp;</div></li><li><div>        'P' =&gt; array(1, 4, 1, 4), &nbsp;</div></li><li><div>        'Q' =&gt; array(1, 4, 2, 3), &nbsp;</div></li><li><div>        'R' =&gt; array(2, 3, 1, 4), &nbsp;</div></li><li><div>        'S' =&gt; array(2, 3, 2, 3), &nbsp;</div></li><li><div>        'T' =&gt; array(2, 4, 1, 3), &nbsp;</div></li><li><div>        'U' =&gt; array(1, 1, 4, 4), &nbsp;</div></li><li><div>        'V' =&gt; array(1, 2, 3, 4), &nbsp;</div></li><li><div>        'W' =&gt; array(1, 2, 4, 3), &nbsp;</div></li><li><div>        'X' =&gt; array(2, 1, 3, 4), &nbsp;</div></li><li><div>        'Y' =&gt; array(2, 1, 4, 3), &nbsp;</div></li><li><div>        'Z' =&gt; array(2, 2, 3, 3)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $code = strtoupper($code);&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 3, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    if ($notkix) {&nbsp;</div></li><li><div>        // table for checksum calculation (row, col)&nbsp;</div></li><li><div>        $checktable = array(&nbsp;</div></li><li><div>            '0' =&gt; array(1, 1), &nbsp;</div></li><li><div>            '1' =&gt; array(1, 2), &nbsp;</div></li><li><div>            '2' =&gt; array(1, 3), &nbsp;</div></li><li><div>            '3' =&gt; array(1, 4), &nbsp;</div></li><li><div>            '4' =&gt; array(1, 5), &nbsp;</div></li><li><div>            '5' =&gt; array(1, 0), &nbsp;</div></li><li><div>            '6' =&gt; array(2, 1), &nbsp;</div></li><li><div>            '7' =&gt; array(2, 2), &nbsp;</div></li><li><div>            '8' =&gt; array(2, 3), &nbsp;</div></li><li><div>            '9' =&gt; array(2, 4), &nbsp;</div></li><li><div>            'A' =&gt; array(2, 5), &nbsp;</div></li><li><div>            'B' =&gt; array(2, 0), &nbsp;</div></li><li><div>            'C' =&gt; array(3, 1), &nbsp;</div></li><li><div>            'D' =&gt; array(3, 2), &nbsp;</div></li><li><div>            'E' =&gt; array(3, 3), &nbsp;</div></li><li><div>            'F' =&gt; array(3, 4), &nbsp;</div></li><li><div>            'G' =&gt; array(3, 5), &nbsp;</div></li><li><div>            'H' =&gt; array(3, 0), &nbsp;</div></li><li><div>            'I' =&gt; array(4, 1), &nbsp;</div></li><li><div>            'J' =&gt; array(4, 2), &nbsp;</div></li><li><div>            'K' =&gt; array(4, 3), &nbsp;</div></li><li><div>            'L' =&gt; array(4, 4), &nbsp;</div></li><li><div>            'M' =&gt; array(4, 5), &nbsp;</div></li><li><div>            'N' =&gt; array(4, 0), &nbsp;</div></li><li><div>            'O' =&gt; array(5, 1), &nbsp;</div></li><li><div>            'P' =&gt; array(5, 2), &nbsp;</div></li><li><div>            'Q' =&gt; array(5, 3), &nbsp;</div></li><li><div>            'R' =&gt; array(5, 4), &nbsp;</div></li><li><div>            'S' =&gt; array(5, 5), &nbsp;</div></li><li><div>            'T' =&gt; array(5, 0), &nbsp;</div></li><li><div>            'U' =&gt; array(0, 1), &nbsp;</div></li><li><div>            'V' =&gt; array(0, 2), &nbsp;</div></li><li><div>            'W' =&gt; array(0, 3), &nbsp;</div></li><li><div>            'X' =&gt; array(0, 4), &nbsp;</div></li><li><div>            'Y' =&gt; array(0, 5), &nbsp;</div></li><li><div>            'Z' =&gt; array(0, 0)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $row = 0;&nbsp;</div></li><li><div>        $col = 0;&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>            $row += $checktable[$code{$i}][0];&nbsp;</div></li><li><div>            $col += $checktable[$code{$i}][1];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $row %= 6;&nbsp;</div></li><li><div>        $col %= 6;&nbsp;</div></li><li><div>        $chk = array_keys($checktable, array($row, $col));&nbsp;</div></li><li><div>        $code .= $chk[0];&nbsp;</div></li><li><div>        ++$len;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    if ($notkix) {&nbsp;</div></li><li><div>        // start bar&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 4; ++$j) {&nbsp;</div></li><li><div>            switch ($barmode[$code{$i}][$j]) {&nbsp;</div></li><li><div>                case 1: {&nbsp;</div></li><li><div>                    $p = 0;&nbsp;</div></li><li><div>                    $h = 2;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                case 2: {&nbsp;</div></li><li><div>                    $p = 0;&nbsp;</div></li><li><div>                    $h = 3;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                case 3: {&nbsp;</div></li><li><div>                    $p = 1;&nbsp;</div></li><li><div>                    $h = 1;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                case 4: {&nbsp;</div></li><li><div>                    $p = 1;&nbsp;</div></li><li><div>                    $h = 2;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; $h, 'p' =&gt; $p);&nbsp;</div></li><li><div>            $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += 2;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($notkix) {&nbsp;</div></li><li><div>        // stop bar&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; 3, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * CODABAR barcodes.&nbsp;</div></li><li><div> * Older code often used in library systems, sometimes in blood banks&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_codabar($code) {&nbsp;</div></li><li><div>    $chr = array(&nbsp;</div></li><li><div>        '0' =&gt; '11111221', &nbsp;</div></li><li><div>        '1' =&gt; '11112211', &nbsp;</div></li><li><div>        '2' =&gt; '11121121', &nbsp;</div></li><li><div>        '3' =&gt; '22111111', &nbsp;</div></li><li><div>        '4' =&gt; '11211211', &nbsp;</div></li><li><div>        '5' =&gt; '21111211', &nbsp;</div></li><li><div>        '6' =&gt; '12111121', &nbsp;</div></li><li><div>        '7' =&gt; '12112111', &nbsp;</div></li><li><div>        '8' =&gt; '12211111', &nbsp;</div></li><li><div>        '9' =&gt; '21121111', &nbsp;</div></li><li><div>        '-' =&gt; '11122111', &nbsp;</div></li><li><div>        '$' =&gt; '11221111', &nbsp;</div></li><li><div>        ':' =&gt; '21112121', &nbsp;</div></li><li><div>        '/' =&gt; '21211121', &nbsp;</div></li><li><div>        '.' =&gt; '21212111', &nbsp;</div></li><li><div>        '+' =&gt; '11222221', &nbsp;</div></li><li><div>        'A' =&gt; '11221211', &nbsp;</div></li><li><div>        'B' =&gt; '12121121', &nbsp;</div></li><li><div>        'C' =&gt; '11121221', &nbsp;</div></li><li><div>        'D' =&gt; '11122211'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $w = 0;&nbsp;</div></li><li><div>    $seq = '';&nbsp;</div></li><li><div>    $code = 'A'.strtoupper($code).'A';&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        if (!isset($chr[$code{$i}])) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq = $chr[$code{$i}];&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 8; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $seq{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * CODE11 barcodes.&nbsp;</div></li><li><div> * Used primarily for labeling telecommunications equipment&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_code11($code) {&nbsp;</div></li><li><div>    $chr = array(&nbsp;</div></li><li><div>        '0' =&gt; '111121', &nbsp;</div></li><li><div>        '1' =&gt; '211121', &nbsp;</div></li><li><div>        '2' =&gt; '121121', &nbsp;</div></li><li><div>        '3' =&gt; '221111', &nbsp;</div></li><li><div>        '4' =&gt; '112121', &nbsp;</div></li><li><div>        '5' =&gt; '212111', &nbsp;</div></li><li><div>        '6' =&gt; '122111', &nbsp;</div></li><li><div>        '7' =&gt; '111221', &nbsp;</div></li><li><div>        '8' =&gt; '211211', &nbsp;</div></li><li><div>        '9' =&gt; '211111', &nbsp;</div></li><li><div>        '-' =&gt; '112111', &nbsp;</div></li><li><div>        'S' =&gt; '112211'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $w = 0;&nbsp;</div></li><li><div>    $seq = '';&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    // calculate check digit C&nbsp;</div></li><li><div>    $p = 1;&nbsp;</div></li><li><div>    $check = 0;&nbsp;</div></li><li><div>    for ($i = ($len - 1); $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>        $digit = $code{$i};&nbsp;</div></li><li><div>        if ($digit == '-') {&nbsp;</div></li><li><div>            $dval = 10;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $dval = intval($digit);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $check += ($dval * $p);&nbsp;</div></li><li><div>        ++$p;&nbsp;</div></li><li><div>        if ($p &gt; 10) {&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $check %= 11;&nbsp;</div></li><li><div>    if ($check == 10) {&nbsp;</div></li><li><div>        $check = '-';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $code .= $check;&nbsp;</div></li><li><div>    if ($len &gt; 10) {&nbsp;</div></li><li><div>        // calculate check digit K&nbsp;</div></li><li><div>        $p = 1;&nbsp;</div></li><li><div>        $check = 0;&nbsp;</div></li><li><div>        for ($i = $len; $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>            $digit = $code{$i};&nbsp;</div></li><li><div>            if ($digit == '-') {&nbsp;</div></li><li><div>                $dval = 10;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $dval = intval($digit);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $check += ($dval * $p);&nbsp;</div></li><li><div>            ++$p;&nbsp;</div></li><li><div>            if ($p &gt; 9) {&nbsp;</div></li><li><div>                $p = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $check %= 11;&nbsp;</div></li><li><div>        $code .= $check;&nbsp;</div></li><li><div>        ++$len;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $code = 'S'.$code.'S';&nbsp;</div></li><li><div>    $len += 3;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        if (!isset($chr[$code{$i}])) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq = $chr[$code{$i}];&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 6; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $seq{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Pharmacode&nbsp;</div></li><li><div> * Contains digits (0 to 9)&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_pharmacode($code) {&nbsp;</div></li><li><div>    $seq = '';&nbsp;</div></li><li><div>    $code = intval($code);&nbsp;</div></li><li><div>    while ($code &gt; 0) {&nbsp;</div></li><li><div>        if (($code % 2) == 0) {&nbsp;</div></li><li><div>            $seq .= '11100';&nbsp;</div></li><li><div>            $code -= 2;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $seq .= '100';&nbsp;</div></li><li><div>            $code -= 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $code /= 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq = substr($seq, 0, -2);&nbsp;</div></li><li><div>    $seq = strrev($seq);&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    return $this-&gt;binseq_to_array($seq, $bararray);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Pharmacode two-track&nbsp;</div></li><li><div> * Contains digits (0 to 9)&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_pharmacode2t($code) {&nbsp;</div></li><li><div>    $seq = '';&nbsp;</div></li><li><div>    $code = intval($code);&nbsp;</div></li><li><div>    do {&nbsp;</div></li><li><div>        switch ($code % 3) {&nbsp;</div></li><li><div>            case 0: {&nbsp;</div></li><li><div>                $seq .= '3';&nbsp;</div></li><li><div>                $code = ($code - 3) / 3;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            case 1: {&nbsp;</div></li><li><div>                $seq .= '1';&nbsp;</div></li><li><div>                $code = ($code - 1) / 3;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            case 2: {&nbsp;</div></li><li><div>                $seq .= '2';&nbsp;</div></li><li><div>                $code = ($code - 2) / 3;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } while($code != 0);&nbsp;</div></li><li><div>    $seq = strrev($seq);&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 2, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $len = strlen($seq);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        switch ($seq{$i}) {&nbsp;</div></li><li><div>            case '1': {&nbsp;</div></li><li><div>                $p = 1;&nbsp;</div></li><li><div>                $h = 1;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            case '2': {&nbsp;</div></li><li><div>                $p = 0;&nbsp;</div></li><li><div>                $h = 1;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            case '3': {&nbsp;</div></li><li><div>                $p = 0;&nbsp;</div></li><li><div>                $h = 2;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; $h, 'p' =&gt; $p);&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    unset($bararray['bcode'][($k - 1)]);&nbsp;</div></li><li><div>    --$bararray['maxw'];&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * IMB - Intelligent Mail Barcode - Onecode - USPS-B-3200&nbsp;</div></li><li><div> * (requires PHP bcmath extension)&nbsp;</div></li><li><div> * Intelligent Mail barcode is a 65-bar code for use on mail in the United States.&nbsp;</div></li><li><div> * The fields are described as follows:&lt;ul&gt;&lt;li&gt;The Barcode Identifier shall be assigned by USPS to encode the presort identification that is currently printed in human readable form on the optional endorsement line (OEL) as well as for future USPS use. This shall be two digits, with the second digit in the range of 0*4. The allowable encoding ranges shall be 00*04, 10*14, 20*24, 30*34, 40*44, 50*54, 60*64, 70*74, 80*84, and 90*94.&lt;/li&gt;&lt;li&gt;The Service Type Identifier shall be assigned by USPS for any combination of services requested on the mailpiece. The allowable encoding range shall be 000http://it2.php.net/manual/en/function.dechex.php*999. Each 3-digit value shall correspond to a particular mail class with a particular combination of service(s). Each service program, such as OneCode Confirm and OneCode ACS, shall provide the list of Service Type Identifier values.&lt;/li&gt;&lt;li&gt;The Mailer or Customer Identifier shall be assigned by USPS as a unique, 6 or 9 digit number that identifies a business entity. The allowable encoding range for the 6 digit Mailer ID shall be 000000- 899999, while the allowable encoding range for the 9 digit Mailer ID shall be 900000000-999999999.&lt;/li&gt;&lt;li&gt;The Serial or Sequence Number shall be assigned by the mailer for uniquely identifying and tracking mailpieces. The allowable encoding range shall be 000000000*999999999 when used with a 6 digit Mailer ID and 000000-999999 when used with a 9 digit Mailer ID. e. The Delivery Point ZIP Code shall be assigned by the mailer for routing the mailpiece. This shall replace POSTNET for routing the mailpiece to its final delivery point. The length may be 0, 5, 9, or 11 digits. The allowable encoding ranges shall be no ZIP Code, 00000*99999, 000000000*999999999, and 00000000000*99999999999.&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div> * @param $code (string) code to print, separate the ZIP (routing code) from the rest using a minus char '-' (BarcodeID_ServiceTypeID_MailerID_SerialNumber-RoutingCode)&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_imb($code) {&nbsp;</div></li><li><div>    $asc_chr = array(4, 0, 2, 6, 3, 5, 1, 9, 8, 7, 1, 2, 0, 6, 4, 8, 2, 9, 5, 3, 0, 1, 3, 7, 4, 6, 8, 9, 2, 0, 5, 1, 9, 4, 3, 8, 6, 7, 1, 2, 4, 3, 9, 5, 7, 8, 3, 0, 2, 1, 4, 0, 9, 1, 7, 0, 2, 4, 6, 3, 7, 1, 9, 5, 8);&nbsp;</div></li><li><div>    $dsc_chr = array(7, 1, 9, 5, 8, 0, 2, 4, 6, 3, 5, 8, 9, 7, 3, 0, 6, 1, 7, 4, 6, 8, 9, 2, 5, 1, 7, 5, 4, 3, 8, 7, 6, 0, 2, 5, 4, 9, 3, 0, 1, 6, 8, 2, 0, 4, 5, 9, 6, 7, 5, 2, 6, 3, 8, 5, 1, 9, 8, 7, 4, 0, 2, 6, 3);&nbsp;</div></li><li><div>    $asc_pos = array(3, 0, 8, 11, 1, 12, 8, 11, 10, 6, 4, 12, 2, 7, 9, 6, 7, 9, 2, 8, 4, 0, 12, 7, 10, 9, 0, 7, 10, 5, 7, 9, 6, 8, 2, 12, 1, 4, 2, 0, 1, 5, 4, 6, 12, 1, 0, 9, 4, 7, 5, 10, 2, 6, 9, 11, 2, 12, 6, 7, 5, 11, 0, 3, 2);&nbsp;</div></li><li><div>    $dsc_pos = array(2, 10, 12, 5, 9, 1, 5, 4, 3, 9, 11, 5, 10, 1, 6, 3, 4, 1, 10, 0, 2, 11, 8, 6, 1, 12, 3, 8, 6, 4, 4, 11, 0, 6, 1, 9, 11, 5, 3, 7, 3, 10, 7, 11, 8, 2, 10, 3, 5, 8, 0, 3, 12, 11, 8, 4, 5, 1, 3, 0, 7, 12, 9, 8, 10);&nbsp;</div></li><li><div>    $code_arr = explode('-', $code);&nbsp;</div></li><li><div>    $tracking_number = $code_arr[0];&nbsp;</div></li><li><div>    if (isset($code_arr[1])) {&nbsp;</div></li><li><div>        $routing_code = $code_arr[1];&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        $routing_code = '';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // Conversion of Routing Code&nbsp;</div></li><li><div>    switch (strlen($routing_code)) {&nbsp;</div></li><li><div>        case 0: {&nbsp;</div></li><li><div>            $binary_code = 0;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 5: {&nbsp;</div></li><li><div>            $binary_code = bcadd($routing_code, '1');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 9: {&nbsp;</div></li><li><div>            $binary_code = bcadd($routing_code, '100001');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 11: {&nbsp;</div></li><li><div>            $binary_code = bcadd($routing_code, '1000100001');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        default: {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $binary_code = bcmul($binary_code, 10);&nbsp;</div></li><li><div>    $binary_code = bcadd($binary_code, $tracking_number[0]);&nbsp;</div></li><li><div>    $binary_code = bcmul($binary_code, 5);&nbsp;</div></li><li><div>    $binary_code = bcadd($binary_code, $tracking_number[1]);&nbsp;</div></li><li><div>    $binary_code .= substr($tracking_number, 2, 18);&nbsp;</div></li><li><div>    // convert to hexadecimal&nbsp;</div></li><li><div>    $binary_code = $this-&gt;dec_to_hex($binary_code);&nbsp;</div></li><li><div>    // pad to get 13 bytes&nbsp;</div></li><li><div>    $binary_code = str_pad($binary_code, 26, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>    // convert string to array of bytes&nbsp;</div></li><li><div>    $binary_code_arr = chunk_split($binary_code, 2, &quot;\r&quot;);&nbsp;</div></li><li><div>    $binary_code_arr = substr($binary_code_arr, 0, -1);&nbsp;</div></li><li><div>    $binary_code_arr = explode(&quot;\r&quot;, $binary_code_arr);&nbsp;</div></li><li><div>    // calculate frame check sequence&nbsp;</div></li><li><div>    $fcs = $this-&gt;imb_crc11fcs($binary_code_arr);&nbsp;</div></li><li><div>    // exclude first 2 bits from first byte&nbsp;</div></li><li><div>    $first_byte = sprintf('%2s', dechex((hexdec($binary_code_arr[0]) &lt;&lt; 2) &gt;&gt; 2));&nbsp;</div></li><li><div>    $binary_code_102bit = $first_byte.substr($binary_code, 2);&nbsp;</div></li><li><div>    // convert binary data to codewords&nbsp;</div></li><li><div>    $codewords = array();&nbsp;</div></li><li><div>    $data = $this-&gt;hex_to_dec($binary_code_102bit);&nbsp;</div></li><li><div>    $codewords[0] = bcmod($data, 636) * 2;&nbsp;</div></li><li><div>    $data = bcdiv($data, 636);&nbsp;</div></li><li><div>    for ($i = 1; $i &lt; 9; ++$i) {&nbsp;</div></li><li><div>        $codewords[$i] = bcmod($data, 1365);&nbsp;</div></li><li><div>        $data = bcdiv($data, 1365);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $codewords[9] = $data;&nbsp;</div></li><li><div>    if (($fcs &gt;&gt; 10) == 1) {&nbsp;</div></li><li><div>        $codewords[9] += 659;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // generate lookup tables&nbsp;</div></li><li><div>    $table2of13 = $this-&gt;imb_tables(2, 78);&nbsp;</div></li><li><div>    $table5of13 = $this-&gt;imb_tables(5, 1287);&nbsp;</div></li><li><div>    // convert codewords to characters&nbsp;</div></li><li><div>    $characters = array();&nbsp;</div></li><li><div>    $bitmask = 512;&nbsp;</div></li><li><div>    foreach($codewords as $k =&gt; $val) {&nbsp;</div></li><li><div>        if ($val &lt;= 1286) {&nbsp;</div></li><li><div>            $chrcode = $table5of13[$val];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $chrcode = $table2of13[($val - 1287)];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (($fcs & $bitmask) &gt; 0) {&nbsp;</div></li><li><div>            // bitwise invert&nbsp;</div></li><li><div>            $chrcode = ((~$chrcode) & 8191);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $characters[] = $chrcode;&nbsp;</div></li><li><div>        $bitmask /= 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $characters = array_reverse($characters);&nbsp;</div></li><li><div>    // build bars&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 3, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; 65; ++$i) {&nbsp;</div></li><li><div>        $asc = (($characters[$asc_chr[$i]] & pow(2, $asc_pos[$i])) &gt; 0);&nbsp;</div></li><li><div>        $dsc = (($characters[$dsc_chr[$i]] & pow(2, $dsc_pos[$i])) &gt; 0);&nbsp;</div></li><li><div>        if ($asc AND $dsc) {&nbsp;</div></li><li><div>            // full bar (F)&nbsp;</div></li><li><div>            $p = 0;&nbsp;</div></li><li><div>            $h = 3;&nbsp;</div></li><li><div>        } elseif ($asc) {&nbsp;</div></li><li><div>            // ascender (A)&nbsp;</div></li><li><div>            $p = 0;&nbsp;</div></li><li><div>            $h = 2;&nbsp;</div></li><li><div>        } elseif ($dsc) {&nbsp;</div></li><li><div>            // descender (D)&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>            $h = 2;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // tracker (T)&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>            $h = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; $h, 'p' =&gt; $p);&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    unset($bararray['bcode'][($k - 1)]);&nbsp;</div></li><li><div>    --$bararray['maxw'];&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Convert large integer number to hexadecimal representation.&nbsp;</div></li><li><div> * (requires PHP bcmath extension)&nbsp;</div></li><li><div> * @param $number (string) number to convert specified as a string&nbsp;</div></li><li><div> * @return string hexadecimal representation&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function dec_to_hex($number) {&nbsp;</div></li><li><div>    $i = 0;&nbsp;</div></li><li><div>    $hex = array();&nbsp;</div></li><li><div>    if($number == 0) {&nbsp;</div></li><li><div>        return '00';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    while($number &gt; 0) {&nbsp;</div></li><li><div>        if($number == 0) {&nbsp;</div></li><li><div>            array_push($hex, '0');&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            array_push($hex, strtoupper(dechex(bcmod($number, '16'))));&nbsp;</div></li><li><div>            $number = bcdiv($number, '16', 0);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $hex = array_reverse($hex);&nbsp;</div></li><li><div>    return implode($hex);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Convert large hexadecimal number to decimal representation (string).&nbsp;</div></li><li><div> * (requires PHP bcmath extension)&nbsp;</div></li><li><div> * @param $hex (string) hexadecimal number to convert specified as a string&nbsp;</div></li><li><div> * @return string hexadecimal representation&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function hex_to_dec($hex) {&nbsp;</div></li><li><div>    $dec = 0;&nbsp;</div></li><li><div>    $bitval = 1;&nbsp;</div></li><li><div>    $len = strlen($hex);&nbsp;</div></li><li><div>    for($pos = ($len - 1); $pos &gt;= 0; --$pos) {&nbsp;</div></li><li><div>        $dec = bcadd($dec, bcmul(hexdec($hex{$pos}), $bitval));&nbsp;</div></li><li><div>        $bitval = bcmul($bitval, 16);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $dec;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Intelligent Mail Barcode calculation of Frame Check Sequence&nbsp;</div></li><li><div> * @param $code_arr (string) array of hexadecimal values (13 bytes holding 102 bits right justified).&nbsp;</div></li><li><div> * @return int 11 bit Frame Check Sequence as integer (decimal base)&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function imb_crc11fcs($code_arr) {&nbsp;</div></li><li><div>    $genpoly = 0x0F35; // generator polynomial&nbsp;</div></li><li><div>    $fcs = 0x07FF; // Frame Check Sequence&nbsp;</div></li><li><div>    // do most significant byte skipping the 2 most significant bits&nbsp;</div></li><li><div>    $data = hexdec($code_arr[0]) &lt;&lt; 5;&nbsp;</div></li><li><div>    for ($bit = 2; $bit &lt; 8; ++$bit) {&nbsp;</div></li><li><div>        if (($fcs ^ $data) & 0x400) {&nbsp;</div></li><li><div>            $fcs = ($fcs &lt;&lt; 1) ^ $genpoly;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $fcs = ($fcs &lt;&lt; 1);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $fcs &= 0x7FF;&nbsp;</div></li><li><div>        $data &lt;&lt;= 1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // do rest of bytes&nbsp;</div></li><li><div>    for ($byte = 1; $byte &lt; 13; ++$byte) {&nbsp;</div></li><li><div>        $data = hexdec($code_arr[$byte]) &lt;&lt; 3;&nbsp;</div></li><li><div>        for ($bit = 0; $bit &lt; 8; ++$bit) {&nbsp;</div></li><li><div>            if (($fcs ^ $data) & 0x400) {&nbsp;</div></li><li><div>                $fcs = ($fcs &lt;&lt; 1) ^ $genpoly;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $fcs = ($fcs &lt;&lt; 1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $fcs &= 0x7FF;&nbsp;</div></li><li><div>            $data &lt;&lt;= 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $fcs;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Reverse unsigned short value&nbsp;</div></li><li><div> * @param $num (int) value to reversr&nbsp;</div></li><li><div> * @return int reversed value&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function imb_reverse_us($num) {&nbsp;</div></li><li><div>    $rev = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; 16; ++$i) {&nbsp;</div></li><li><div>        $rev &lt;&lt;= 1;&nbsp;</div></li><li><div>        $rev |= ($num & 1);&nbsp;</div></li><li><div>        $num &gt;&gt;= 1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $rev;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * generate Nof13 tables used for Intelligent Mail Barcode&nbsp;</div></li><li><div> * @param $n (int) is the type of table: 2 for 2of13 table, 5 for 5of13table&nbsp;</div></li><li><div> * @param $size (int) size of table (78 for n=2 and 1287 for n=5)&nbsp;</div></li><li><div> * @return array requested table&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function imb_tables($n, $size) {&nbsp;</div></li><li><div>    $table = array();&nbsp;</div></li><li><div>    $lli = 0; // LUT lower index&nbsp;</div></li><li><div>    $lui = $size - 1; // LUT upper index&nbsp;</div></li><li><div>    for ($count = 0; $count &lt; 8192; ++$count) {&nbsp;</div></li><li><div>        $bit_count = 0;&nbsp;</div></li><li><div>        for ($bit_index = 0; $bit_index &lt; 13; ++$bit_index) {&nbsp;</div></li><li><div>            $bit_count += intval(($count & (1 &lt;&lt; $bit_index)) != 0);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // if we don't have the right number of bits on, go on to the next value&nbsp;</div></li><li><div>        if ($bit_count == $n) {&nbsp;</div></li><li><div>            $reverse = ($this-&gt;imb_reverse_us($count) &gt;&gt; 3);&nbsp;</div></li><li><div>            // if the reverse is less than count, we have already visited this pair before&nbsp;</div></li><li><div>            if ($reverse &gt;= $count) {&nbsp;</div></li><li><div>                // If count is symmetric, place it at the first free slot from the end of the list.&nbsp;</div></li><li><div>                // Otherwise, place it at the first free slot from the beginning of the list AND place $reverse ath the next free slot from the beginning of the list&nbsp;</div></li><li><div>                if ($reverse == $count) {&nbsp;</div></li><li><div>                    $table[$lui] = $count;&nbsp;</div></li><li><div>                    --$lui;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $table[$lli] = $count;&nbsp;</div></li><li><div>                    ++$lli;&nbsp;</div></li><li><div>                    $table[$lli] = $reverse;&nbsp;</div></li><li><div>                    ++$lli;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li></ol></pre><pre><ol data-line="44" class="block" start="50"><li><div>/* @class TCPDFBarcode&nbsp;</div></li><li><div> * PHP class to creates array representations for common 1D barcodes to be used with TCPDF (http://www.tcpdf.org).&lt;br&gt;&nbsp;</div></li><li><div> * @package com.tecnick.tcpdf&nbsp;</div></li><li><div> * @version 3.026&nbsp;</div></li><li><div> * @author Nicola Asuni&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>class TCPDFBarcode {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Array representation of barcode.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected $barcode_array;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * This is the class constructor.&nbsp;</div></li><li><div> * Return an array representations for common 1D barcodes:&lt;ul&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['code'] code to be printed on text label&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['maxh'] max barcode height&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['maxw'] max barcode width&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k] single bar or space in $k position&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k]['t'] bar type: true = bar, false = space.&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k]['w'] bar width in units.&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k]['h'] bar height in units.&lt;/li&gt;&nbsp;</div></li><li><div> * &lt;li&gt;$arrcode['bcode'][$k]['p'] bar top position (0 = top, 1 = middle)&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div> * @param $code (string) code to print&nbsp;</div></li><li><div>  * @param $type (string) type of barcode: &lt;ul&gt;&lt;li&gt;C39 : CODE 39 - ANSI MH10.8M-1983 - USD-3 - 3 of 9.&lt;/li&gt;&lt;li&gt;C39+ : CODE 39 with checksum&lt;/li&gt;&lt;li&gt;C39E : CODE 39 EXTENDED&lt;/li&gt;&lt;li&gt;C39E+ : CODE 39 EXTENDED + CHECKSUM&lt;/li&gt;&lt;li&gt;C93 : CODE 93 - USS-93&lt;/li&gt;&lt;li&gt;S25 : Standard 2 of 5&lt;/li&gt;&lt;li&gt;S25+ : Standard 2 of 5 + CHECKSUM&lt;/li&gt;&lt;li&gt;I25 : Interleaved 2 of 5&lt;/li&gt;&lt;li&gt;I25+ : Interleaved 2 of 5 + CHECKSUM&lt;/li&gt;&lt;li&gt;C128 : CODE 128&lt;/li&gt;&lt;li&gt;C128A : CODE 128 A&lt;/li&gt;&lt;li&gt;C128B : CODE 128 B&lt;/li&gt;&lt;li&gt;C128C : CODE 128 C&lt;/li&gt;&lt;li&gt;EAN2 : 2-Digits UPC-Based Extention&lt;/li&gt;&lt;li&gt;EAN5 : 5-Digits UPC-Based Extention&lt;/li&gt;&lt;li&gt;EAN8 : EAN 8&lt;/li&gt;&lt;li&gt;EAN13 : EAN 13&lt;/li&gt;&lt;li&gt;UPCA : UPC-A&lt;/li&gt;&lt;li&gt;UPCE : UPC-E&lt;/li&gt;&lt;li&gt;MSI : MSI (Variation of Plessey code)&lt;/li&gt;&lt;li&gt;MSI+ : MSI + CHECKSUM (modulo 11)&lt;/li&gt;&lt;li&gt;POSTNET : POSTNET&lt;/li&gt;&lt;li&gt;PLANET : PLANET&lt;/li&gt;&lt;li&gt;RMS4CC : RMS4CC (Royal Mail 4-state Customer Code) - CBC (Customer Bar Code)&lt;/li&gt;&lt;li&gt;KIX : KIX (Klant index - Customer index)&lt;/li&gt;&lt;li&gt;IMB: Intelligent Mail Barcode - Onecode - USPS-B-3200&lt;/li&gt;&lt;li&gt;CODABAR : CODABAR&lt;/li&gt;&lt;li&gt;CODE11 : CODE 11&lt;/li&gt;&lt;li&gt;PHARMA : PHARMACODE&lt;/li&gt;&lt;li&gt;PHARMA2T : PHARMACODE TWO-TRACKS&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function __construct($code, $type) {&nbsp;</div></li><li><div>    $this-&gt;setBarcode($code, $type);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Return an array representations of barcode.&nbsp;</div></li><li><div>  * @return array&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodeArray() {&nbsp;</div></li><li><div>    return $this-&gt;barcode_array;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Send barcode as SVG image object to the standard output.&nbsp;</div></li><li><div> * @param $w (int) Minimum width of a single bar in user units.&nbsp;</div></li><li><div> * @param $h (int) Height of barcode in user units.&nbsp;</div></li><li><div> * @param $color (string) Foreground color (in SVG format) for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodeSVG($w=2, $h=30, $color='black') {&nbsp;</div></li><li><div>    // send headers&nbsp;</div></li><li><div>    $code = $this-&gt;getBarcodeSVGcode($w, $h, $color);&nbsp;</div></li><li><div>    header('Content-Type: application/svg+xml');&nbsp;</div></li><li><div>    header('Cache-Control: public, must-revalidate, max-age=0'); // HTTP/1.1&nbsp;</div></li><li><div>    header('Pragma: public');&nbsp;</div></li><li><div>    header('Expires: Sat, 26 Jul 1997 05:00:00 GMT'); // Date in the past&nbsp;</div></li><li><div>    header('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT');&nbsp;</div></li><li><div>    header('Content-Disposition: inline; filename=&quot;'.md5($code).'.svg&quot;;');&nbsp;</div></li><li><div>    //header('Content-Length: '.strlen($code));&nbsp;</div></li><li><div>    echo $code;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Return a SVG string representation of barcode.&nbsp;</div></li><li><div> * @param $w (int) Minimum width of a single bar in user units.&nbsp;</div></li><li><div> * @param $h (int) Height of barcode in user units.&nbsp;</div></li><li><div> * @param $color (string) Foreground color (in SVG format) for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @return string SVG code.&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodeSVGcode($w=2, $h=30, $color='black') {&nbsp;</div></li><li><div>    // replace table for special characters&nbsp;</div></li><li><div>    $repstr = array(&quot;\0&quot; =&gt; '', '&' =&gt; '&amp;', '&lt;' =&gt; '&lt;', '&gt;' =&gt; '&gt;');&nbsp;</div></li><li><div>    $svg = '&lt;'.'?'.'xml version=&quot;1.0&quot; standalone=&quot;no&quot;'.'?'.'&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= '&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot; &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= '&lt;svg width=&quot;'.round(($this-&gt;barcode_array['maxw'] * $w), 3).'&quot; height=&quot;'.$h.'&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= &quot;\t&quot;.'&lt;desc&gt;'.strtr($this-&gt;barcode_array['code'], $repstr).'&lt;/desc&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= &quot;\t&quot;.'&lt;g id=&quot;bars&quot; fill=&quot;'.$color.'&quot; stroke=&quot;none&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    // print bars&nbsp;</div></li><li><div>    $x = 0;&nbsp;</div></li><li><div>    foreach ($this-&gt;barcode_array['bcode'] as $k =&gt; $v) {&nbsp;</div></li><li><div>        $bw = round(($v['w'] * $w), 3);&nbsp;</div></li><li><div>        $bh = round(($v['h'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>        if ($v['t']) {&nbsp;</div></li><li><div>            $y = round(($v['p'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>            // draw a vertical bar&nbsp;</div></li><li><div>            $svg .= &quot;\t\t&quot;.'&lt;rect x=&quot;'.$x.'&quot; y=&quot;'.$y.'&quot; width=&quot;'.$bw.'&quot; height=&quot;'.$bh.'&quot; /&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $x += $bw;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $svg .= &quot;\t&quot;.'&lt;/g&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    $svg .= '&lt;/svg&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    return $svg;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Return an HTML representation of barcode.&nbsp;</div></li><li><div> * @param $w (int) Width of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $h (int) Height of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $color (string) Foreground color for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @return string HTML code.&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodeHTML($w=2, $h=30, $color='black') {&nbsp;</div></li><li><div>    $html = '&lt;div style=&quot;font-size:0;position:relative;width:'.($this-&gt;barcode_array['maxw'] * $w).'px;height:'.($h).'px;&quot;&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    // print bars&nbsp;</div></li><li><div>    $x = 0;&nbsp;</div></li><li><div>    foreach ($this-&gt;barcode_array['bcode'] as $k =&gt; $v) {&nbsp;</div></li><li><div>        $bw = round(($v['w'] * $w), 3);&nbsp;</div></li><li><div>        $bh = round(($v['h'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>        if ($v['t']) {&nbsp;</div></li><li><div>            $y = round(($v['p'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>            // draw a vertical bar&nbsp;</div></li><li><div>            $html .= '&lt;div style=&quot;background-color:'.$color.';width:'.$bw.'px;height:'.$bh.'px;position:absolute;left:'.$x.'px;top:'.$y.'px;&quot;&gt;&nbsp;&lt;/div&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $x += $bw;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $html .= '&lt;/div&gt;'.&quot;\n&quot;;&nbsp;</div></li><li><div>    return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Send a PNG image representation of barcode (requires GD or Imagick library).&nbsp;</div></li><li><div> * @param $w (int) Width of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $h (int) Height of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $color (array) RGB (0-255) foreground color for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodePNG($w=2, $h=30, $color=array(0, 0, 0)) {&nbsp;</div></li><li><div>    $data = $this-&gt;getBarcodePngData($w, $h, $color);&nbsp;</div></li><li><div>    // send headers&nbsp;</div></li><li><div>    header('Content-Type: image/png');&nbsp;</div></li><li><div>    header('Cache-Control: public, must-revalidate, max-age=0'); // HTTP/1.1&nbsp;</div></li><li><div>    header('Pragma: public');&nbsp;</div></li><li><div>    header('Expires: Sat, 26 Jul 1997 05:00:00 GMT'); // Date in the past&nbsp;</div></li><li><div>    header('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT');&nbsp;</div></li><li><div>    //header('Content-Length: '.strlen($data));&nbsp;</div></li><li><div>    echo $data;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Return a PNG image representation of barcode (requires GD or Imagick library).&nbsp;</div></li><li><div> * @param $w (int) Width of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $h (int) Height of a single bar element in pixels.&nbsp;</div></li><li><div> * @param $color (array) RGB (0-255) foreground color for bar elements (background is transparent).&nbsp;</div></li><li><div>  * @return image or false in case of error.&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function getBarcodePngData($w=2, $h=30, $color=array(0, 0, 0)) {&nbsp;</div></li><li><div>    // calculate image size&nbsp;</div></li><li><div>    $width = ($this-&gt;barcode_array['maxw'] * $w);&nbsp;</div></li><li><div>    $height = $h;&nbsp;</div></li><li><div>    if (function_exists('imagecreate')) {&nbsp;</div></li><li><div>        // GD library&nbsp;</div></li><li><div>        $imagick = false;&nbsp;</div></li><li><div>        $png = imagecreate($width, $height);&nbsp;</div></li><li><div>        $bgcol = imagecolorallocate($png, 255, 255, 255);&nbsp;</div></li><li><div>        imagecolortransparent($png, $bgcol);&nbsp;</div></li><li><div>        $fgcol = imagecolorallocate($png, $color[0], $color[1], $color[2]);&nbsp;</div></li><li><div>    } elseif (extension_loaded('imagick')) {&nbsp;</div></li><li><div>        $imagick = true;&nbsp;</div></li><li><div>        $bgcol = new imagickpixel('rgb(255, 255, 255');&nbsp;</div></li><li><div>        $fgcol = new imagickpixel('rgb('.$color[0].', '.$color[1].', '.$color[2].')');&nbsp;</div></li><li><div>        $png = new Imagick();&nbsp;</div></li><li><div>        $png-&gt;newImage($width, $height, 'none', 'png');&nbsp;</div></li><li><div>        $bar = new imagickdraw();&nbsp;</div></li><li><div>        $bar-&gt;setfillcolor($fgcol);&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // print bars&nbsp;</div></li><li><div>    $x = 0;&nbsp;</div></li><li><div>    foreach ($this-&gt;barcode_array['bcode'] as $k =&gt; $v) {&nbsp;</div></li><li><div>        $bw = round(($v['w'] * $w), 3);&nbsp;</div></li><li><div>        $bh = round(($v['h'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>        if ($v['t']) {&nbsp;</div></li><li><div>            $y = round(($v['p'] * $h / $this-&gt;barcode_array['maxh']), 3);&nbsp;</div></li><li><div>            // draw a vertical bar&nbsp;</div></li><li><div>            if ($imagick) {&nbsp;</div></li><li><div>                $bar-&gt;rectangle($x, $y, ($x + $bw - 1), ($y + $bh - 1));&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                imagefilledrectangle($png, $x, $y, ($x + $bw - 1), ($y + $bh - 1), $fgcol);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $x += $bw;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($imagick) {&nbsp;</div></li><li><div>        $png-&gt;drawimage($bar);&nbsp;</div></li><li><div>        return $png;&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        ob_start();&nbsp;</div></li><li><div>        imagepng($png);&nbsp;</div></li><li><div>        $imagedata = ob_get_clean();&nbsp;</div></li><li><div>        imagedestroy($png);&nbsp;</div></li><li><div>        return $imagedata;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Set the barcode.&nbsp;</div></li><li><div> * @param $code (string) code to print&nbsp;</div></li><li><div>  * @param $type (string) type of barcode: &lt;ul&gt;&lt;li&gt;C39 : CODE 39 - ANSI MH10.8M-1983 - USD-3 - 3 of 9.&lt;/li&gt;&lt;li&gt;C39+ : CODE 39 with checksum&lt;/li&gt;&lt;li&gt;C39E : CODE 39 EXTENDED&lt;/li&gt;&lt;li&gt;C39E+ : CODE 39 EXTENDED + CHECKSUM&lt;/li&gt;&lt;li&gt;C93 : CODE 93 - USS-93&lt;/li&gt;&lt;li&gt;S25 : Standard 2 of 5&lt;/li&gt;&lt;li&gt;S25+ : Standard 2 of 5 + CHECKSUM&lt;/li&gt;&lt;li&gt;I25 : Interleaved 2 of 5&lt;/li&gt;&lt;li&gt;I25+ : Interleaved 2 of 5 + CHECKSUM&lt;/li&gt;&lt;li&gt;C128 : CODE 128&lt;/li&gt;&lt;li&gt;C128A : CODE 128 A&lt;/li&gt;&lt;li&gt;C128B : CODE 128 B&lt;/li&gt;&lt;li&gt;C128C : CODE 128 C&lt;/li&gt;&lt;li&gt;EAN2 : 2-Digits UPC-Based Extention&lt;/li&gt;&lt;li&gt;EAN5 : 5-Digits UPC-Based Extention&lt;/li&gt;&lt;li&gt;EAN8 : EAN 8&lt;/li&gt;&lt;li&gt;EAN13 : EAN 13&lt;/li&gt;&lt;li&gt;UPCA : UPC-A&lt;/li&gt;&lt;li&gt;UPCE : UPC-E&lt;/li&gt;&lt;li&gt;MSI : MSI (Variation of Plessey code)&lt;/li&gt;&lt;li&gt;MSI+ : MSI + CHECKSUM (modulo 11)&lt;/li&gt;&lt;li&gt;POSTNET : POSTNET&lt;/li&gt;&lt;li&gt;PLANET : PLANET&lt;/li&gt;&lt;li&gt;RMS4CC : RMS4CC (Royal Mail 4-state Customer Code) - CBC (Customer Bar Code)&lt;/li&gt;&lt;li&gt;KIX : KIX (Klant index - Customer index)&lt;/li&gt;&lt;li&gt;IMB: Intelligent Mail Barcode - Onecode - USPS-B-3200&lt;/li&gt;&lt;li&gt;CODABAR : CODABAR&lt;/li&gt;&lt;li&gt;CODE11 : CODE 11&lt;/li&gt;&lt;li&gt;PHARMA : PHARMACODE&lt;/li&gt;&lt;li&gt;PHARMA2T : PHARMACODE TWO-TRACKS&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>  * @return array barcode array&nbsp;</div></li><li><div>  * @public&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function setBarcode($code, $type) {&nbsp;</div></li><li><div>    switch (strtoupper($type)) {&nbsp;</div></li><li><div>        case 'C39': { // CODE 39 - ANSI MH10.8M-1983 - USD-3 - 3 of 9.&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code39($code, false, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C39+': { // CODE 39 with checksum&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code39($code, false, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C39E': { // CODE 39 EXTENDED&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code39($code, true, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C39E+': { // CODE 39 EXTENDED + CHECKSUM&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code39($code, true, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C93': { // CODE 93 - USS-93&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code93($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'S25': { // Standard 2 of 5&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_s25($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'S25+': { // Standard 2 of 5 + CHECKSUM&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_s25($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'I25': { // Interleaved 2 of 5&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_i25($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'I25+': { // Interleaved 2 of 5 + CHECKSUM&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_i25($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C128': { // CODE 128&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_c128($code, '');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C128A': { // CODE 128 A&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_c128($code, 'A');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C128B': { // CODE 128 B&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_c128($code, 'B');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C128C': { // CODE 128 C&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_c128($code, 'C');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'EAN2': { // 2-Digits UPC-Based Extention&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanext($code, 2);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'EAN5': { // 5-Digits UPC-Based Extention&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanext($code, 5);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'EAN8': { // EAN 8&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanupc($code, 8);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'EAN13': { // EAN 13&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanupc($code, 13);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'UPCA': { // UPC-A&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanupc($code, 12);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'UPCE': { // UPC-E&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_eanupc($code, 6);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'MSI': { // MSI (Variation of Plessey code)&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_msi($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'MSI+': { // MSI + CHECKSUM (modulo 11)&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_msi($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'POSTNET': { // POSTNET&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_postnet($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'PLANET': { // PLANET&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_postnet($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'RMS4CC': { // RMS4CC (Royal Mail 4-state Customer Code) - CBC (Customer Bar Code)&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_rms4cc($code, false);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'KIX': { // KIX (Klant index - Customer index)&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_rms4cc($code, true);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'IMB': { // IMB - Intelligent Mail Barcode - Onecode - USPS-B-3200&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_imb($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'CODABAR': { // CODABAR&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_codabar($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'CODE11': { // CODE 11&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_code11($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'PHARMA': { // PHARMACODE&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_pharmacode($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'PHARMA2T': { // PHARMACODE TWO-TRACKS&nbsp;</div></li><li><div>            $arrcode = $this-&gt;barcode_pharmacode2t($code);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        default: {&nbsp;</div></li><li><div>            $this-&gt;barcode_array = false;&nbsp;</div></li><li><div>            $arrcode = false;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $this-&gt;barcode_array = $arrcode;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * CODE 39 - ANSI MH10.8M-1983 - USD-3 - 3 of 9.&nbsp;</div></li><li><div> * General-purpose code in very wide use world-wide&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $extended (boolean) if true uses the extended mode.&nbsp;</div></li><li><div> * @param $checksum (boolean) if true add a checksum to the code.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_code39($code, $extended=false, $checksum=false) {&nbsp;</div></li><li><div>    $chr['0'] = '111331311';&nbsp;</div></li><li><div>    $chr['1'] = '311311113';&nbsp;</div></li><li><div>    $chr['2'] = '113311113';&nbsp;</div></li><li><div>    $chr['3'] = '313311111';&nbsp;</div></li><li><div>    $chr['4'] = '111331113';&nbsp;</div></li><li><div>    $chr['5'] = '311331111';&nbsp;</div></li><li><div>    $chr['6'] = '113331111';&nbsp;</div></li><li><div>    $chr['7'] = '111311313';&nbsp;</div></li><li><div>    $chr['8'] = '311311311';&nbsp;</div></li><li><div>    $chr['9'] = '113311311';&nbsp;</div></li><li><div>    $chr['A'] = '311113113';&nbsp;</div></li><li><div>    $chr['B'] = '113113113';&nbsp;</div></li><li><div>    $chr['C'] = '313113111';&nbsp;</div></li><li><div>    $chr['D'] = '111133113';&nbsp;</div></li><li><div>    $chr['E'] = '311133111';&nbsp;</div></li><li><div>    $chr['F'] = '113133111';&nbsp;</div></li><li><div>    $chr['G'] = '111113313';&nbsp;</div></li><li><div>    $chr['H'] = '311113311';&nbsp;</div></li><li><div>    $chr['I'] = '113113311';&nbsp;</div></li><li><div>    $chr['J'] = '111133311';&nbsp;</div></li><li><div>    $chr['K'] = '311111133';&nbsp;</div></li><li><div>    $chr['L'] = '113111133';&nbsp;</div></li><li><div>    $chr['M'] = '313111131';&nbsp;</div></li><li><div>    $chr['N'] = '111131133';&nbsp;</div></li><li><div>    $chr['O'] = '311131131';&nbsp;</div></li><li><div>    $chr['P'] = '113131131';&nbsp;</div></li><li><div>    $chr['Q'] = '111111333';&nbsp;</div></li><li><div>    $chr['R'] = '311111331';&nbsp;</div></li><li><div>    $chr['S'] = '113111331';&nbsp;</div></li><li><div>    $chr['T'] = '111131331';&nbsp;</div></li><li><div>    $chr['U'] = '331111113';&nbsp;</div></li><li><div>    $chr['V'] = '133111113';&nbsp;</div></li><li><div>    $chr['W'] = '333111111';&nbsp;</div></li><li><div>    $chr['X'] = '131131113';&nbsp;</div></li><li><div>    $chr['Y'] = '331131111';&nbsp;</div></li><li><div>    $chr['Z'] = '133131111';&nbsp;</div></li><li><div>    $chr['-'] = '131111313';&nbsp;</div></li><li><div>    $chr['.'] = '331111311';&nbsp;</div></li><li><div>    $chr[' '] = '133111311';&nbsp;</div></li><li><div>    $chr['$'] = '131313111';&nbsp;</div></li><li><div>    $chr['/'] = '131311131';&nbsp;</div></li><li><div>    $chr['+'] = '131113131';&nbsp;</div></li><li><div>    $chr['%'] = '111313131';&nbsp;</div></li><li><div>    $chr['*'] = '131131311';&nbsp;</div></li><li><div>    $code = strtoupper($code);&nbsp;</div></li><li><div>    if ($extended) {&nbsp;</div></li><li><div>        // extended mode&nbsp;</div></li><li><div>        $code = $this-&gt;encode_code39_ext($code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($code === false) {&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($checksum) {&nbsp;</div></li><li><div>        // checksum&nbsp;</div></li><li><div>        $code .= $this-&gt;checksum_code39($code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // add start and stop codes&nbsp;</div></li><li><div>    $code = '*'.$code.'*';&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $char = $code{$i};&nbsp;</div></li><li><div>        if(!isset($chr[$char])) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 9; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $chr[$char]{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // intercharacter gap&nbsp;</div></li><li><div>        $bararray['bcode'][$k] = array('t' =&gt; false, 'w' =&gt; 1, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 1;&nbsp;</div></li><li><div>        ++$k;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Encode a string to be used for CODE 39 Extended mode.&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return encoded string.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function encode_code39_ext($code) {&nbsp;</div></li><li><div>    $encode = array(&nbsp;</div></li><li><div>        chr(0) =&gt; '%U', chr(1) =&gt; '$A', chr(2) =&gt; '$B', chr(3) =&gt; '$C', &nbsp;</div></li><li><div>        chr(4) =&gt; '$D', chr(5) =&gt; '$E', chr(6) =&gt; '$F', chr(7) =&gt; '$G', &nbsp;</div></li><li><div>        chr(8) =&gt; '$H', chr(9) =&gt; '$I', chr(10) =&gt; '$J', chr(11) =&gt; 'K', &nbsp;</div></li><li><div>        chr(12) =&gt; '$L', chr(13) =&gt; '$M', chr(14) =&gt; '$N', chr(15) =&gt; '$O', &nbsp;</div></li><li><div>        chr(16) =&gt; '$P', chr(17) =&gt; '$Q', chr(18) =&gt; '$R', chr(19) =&gt; '$S', &nbsp;</div></li><li><div>        chr(20) =&gt; '$T', chr(21) =&gt; '$U', chr(22) =&gt; '$V', chr(23) =&gt; '$W', &nbsp;</div></li><li><div>        chr(24) =&gt; '$X', chr(25) =&gt; '$Y', chr(26) =&gt; '$Z', chr(27) =&gt; '%A', &nbsp;</div></li><li><div>        chr(28) =&gt; '%B', chr(29) =&gt; '%C', chr(30) =&gt; '%D', chr(31) =&gt; '%E', &nbsp;</div></li><li><div>        chr(32) =&gt; ' ', chr(33) =&gt; '/A', chr(34) =&gt; '/B', chr(35) =&gt; '/C', &nbsp;</div></li><li><div>        chr(36) =&gt; '/D', chr(37) =&gt; '/E', chr(38) =&gt; '/F', chr(39) =&gt; '/G', &nbsp;</div></li><li><div>        chr(40) =&gt; '/H', chr(41) =&gt; '/I', chr(42) =&gt; '/J', chr(43) =&gt; '/K', &nbsp;</div></li><li><div>        chr(44) =&gt; '/L', chr(45) =&gt; '-', chr(46) =&gt; '.', chr(47) =&gt; '/O', &nbsp;</div></li><li><div>        chr(48) =&gt; '0', chr(49) =&gt; '1', chr(50) =&gt; '2', chr(51) =&gt; '3', &nbsp;</div></li><li><div>        chr(52) =&gt; '4', chr(53) =&gt; '5', chr(54) =&gt; '6', chr(55) =&gt; '7', &nbsp;</div></li><li><div>        chr(56) =&gt; '8', chr(57) =&gt; '9', chr(58) =&gt; '/Z', chr(59) =&gt; '%F', &nbsp;</div></li><li><div>        chr(60) =&gt; '%G', chr(61) =&gt; '%H', chr(62) =&gt; '%I', chr(63) =&gt; '%J', &nbsp;</div></li><li><div>        chr(64) =&gt; '%V', chr(65) =&gt; 'A', chr(66) =&gt; 'B', chr(67) =&gt; 'C', &nbsp;</div></li><li><div>        chr(68) =&gt; 'D', chr(69) =&gt; 'E', chr(70) =&gt; 'F', chr(71) =&gt; 'G', &nbsp;</div></li><li><div>        chr(72) =&gt; 'H', chr(73) =&gt; 'I', chr(74) =&gt; 'J', chr(75) =&gt; 'K', &nbsp;</div></li><li><div>        chr(76) =&gt; 'L', chr(77) =&gt; 'M', chr(78) =&gt; 'N', chr(79) =&gt; 'O', &nbsp;</div></li><li><div>        chr(80) =&gt; 'P', chr(81) =&gt; 'Q', chr(82) =&gt; 'R', chr(83) =&gt; 'S', &nbsp;</div></li><li><div>        chr(84) =&gt; 'T', chr(85) =&gt; 'U', chr(86) =&gt; 'V', chr(87) =&gt; 'W', &nbsp;</div></li><li><div>        chr(88) =&gt; 'X', chr(89) =&gt; 'Y', chr(90) =&gt; 'Z', chr(91) =&gt; '%K', &nbsp;</div></li><li><div>        chr(92) =&gt; '%L', chr(93) =&gt; '%M', chr(94) =&gt; '%N', chr(95) =&gt; '%O', &nbsp;</div></li><li><div>        chr(96) =&gt; '%W', chr(97) =&gt; '+A', chr(98) =&gt; '+B', chr(99) =&gt; '+C', &nbsp;</div></li><li><div>        chr(100) =&gt; '+D', chr(101) =&gt; '+E', chr(102) =&gt; '+F', chr(103) =&gt; '+G', &nbsp;</div></li><li><div>        chr(104) =&gt; '+H', chr(105) =&gt; '+I', chr(106) =&gt; '+J', chr(107) =&gt; '+K', &nbsp;</div></li><li><div>        chr(108) =&gt; '+L', chr(109) =&gt; '+M', chr(110) =&gt; '+N', chr(111) =&gt; '+O', &nbsp;</div></li><li><div>        chr(112) =&gt; '+P', chr(113) =&gt; '+Q', chr(114) =&gt; '+R', chr(115) =&gt; '+S', &nbsp;</div></li><li><div>        chr(116) =&gt; '+T', chr(117) =&gt; '+U', chr(118) =&gt; '+V', chr(119) =&gt; '+W', &nbsp;</div></li><li><div>        chr(120) =&gt; '+X', chr(121) =&gt; '+Y', chr(122) =&gt; '+Z', chr(123) =&gt; '%P', &nbsp;</div></li><li><div>        chr(124) =&gt; '%Q', chr(125) =&gt; '%R', chr(126) =&gt; '%S', chr(127) =&gt; '%T');&nbsp;</div></li><li><div>    $code_ext = '';&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0 ; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        if (ord($code{$i}) &gt; 127) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $code_ext .= $encode[$code{$i}];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $code_ext;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Calculate CODE 39 checksum (modulo 43).&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return char checksum.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function checksum_code39($code) {&nbsp;</div></li><li><div>    $chars = array(&nbsp;</div></li><li><div>        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', &nbsp;</div></li><li><div>        'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', &nbsp;</div></li><li><div>        'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', &nbsp;</div></li><li><div>        'W', 'X', 'Y', 'Z', '-', '.', ' ', '$', '/', '+', '%');&nbsp;</div></li><li><div>    $sum = 0;&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0 ; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $k = array_keys($chars, $code{$i});&nbsp;</div></li><li><div>        $sum += $k[0];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $j = ($sum % 43);&nbsp;</div></li><li><div>    return $chars[$j];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * CODE 93 - USS-93&nbsp;</div></li><li><div> * Compact code similar to Code 39&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_code93($code) {&nbsp;</div></li><li><div>    $chr[48] = '131112'; // 0&nbsp;</div></li><li><div>    $chr[49] = '111213'; // 1&nbsp;</div></li><li><div>    $chr[50] = '111312'; // 2&nbsp;</div></li><li><div>    $chr[51] = '111411'; // 3&nbsp;</div></li><li><div>    $chr[52] = '121113'; // 4&nbsp;</div></li><li><div>    $chr[53] = '121212'; // 5&nbsp;</div></li><li><div>    $chr[54] = '121311'; // 6&nbsp;</div></li><li><div>    $chr[55] = '111114'; // 7&nbsp;</div></li><li><div>    $chr[56] = '131211'; // 8&nbsp;</div></li><li><div>    $chr[57] = '141111'; // 9&nbsp;</div></li><li><div>    $chr[65] = '211113'; // A&nbsp;</div></li><li><div>    $chr[66] = '211212'; // B&nbsp;</div></li><li><div>    $chr[67] = '211311'; // C&nbsp;</div></li><li><div>    $chr[68] = '221112'; // D&nbsp;</div></li><li><div>    $chr[69] = '221211'; // E&nbsp;</div></li><li><div>    $chr[70] = '231111'; // F&nbsp;</div></li><li><div>    $chr[71] = '112113'; // G&nbsp;</div></li><li><div>    $chr[72] = '112212'; // H&nbsp;</div></li><li><div>    $chr[73] = '112311'; // I&nbsp;</div></li><li><div>    $chr[74] = '122112'; // J&nbsp;</div></li><li><div>    $chr[75] = '132111'; // K&nbsp;</div></li><li><div>    $chr[76] = '111123'; // L&nbsp;</div></li><li><div>    $chr[77] = '111222'; // M&nbsp;</div></li><li><div>    $chr[78] = '111321'; // N&nbsp;</div></li><li><div>    $chr[79] = '121122'; // O&nbsp;</div></li><li><div>    $chr[80] = '131121'; // P&nbsp;</div></li><li><div>    $chr[81] = '212112'; // Q&nbsp;</div></li><li><div>    $chr[82] = '212211'; // R&nbsp;</div></li><li><div>    $chr[83] = '211122'; // S&nbsp;</div></li><li><div>    $chr[84] = '211221'; // T&nbsp;</div></li><li><div>    $chr[85] = '221121'; // U&nbsp;</div></li><li><div>    $chr[86] = '222111'; // V&nbsp;</div></li><li><div>    $chr[87] = '112122'; // W&nbsp;</div></li><li><div>    $chr[88] = '112221'; // X&nbsp;</div></li><li><div>    $chr[89] = '122121'; // Y&nbsp;</div></li><li><div>    $chr[90] = '123111'; // Z&nbsp;</div></li><li><div>    $chr[45] = '121131'; // -&nbsp;</div></li><li><div>    $chr[46] = '311112'; // .&nbsp;</div></li><li><div>    $chr[32] = '311211'; //&nbsp;</div></li><li><div>    $chr[36] = '321111'; // $&nbsp;</div></li><li><div>    $chr[47] = '112131'; // /&nbsp;</div></li><li><div>    $chr[43] = '113121'; // +&nbsp;</div></li><li><div>    $chr[37] = '211131'; // %&nbsp;</div></li><li><div>    $chr[128] = '121221'; // ($)&nbsp;</div></li><li><div>    $chr[129] = '311121'; // (/)&nbsp;</div></li><li><div>    $chr[130] = '122211'; // (+)&nbsp;</div></li><li><div>    $chr[131] = '312111'; // (%)&nbsp;</div></li><li><div>    $chr[42] = '111141'; // start-stop&nbsp;</div></li><li><div>    $code = strtoupper($code);&nbsp;</div></li><li><div>    $encode = array(&nbsp;</div></li><li><div>        chr(0) =&gt; chr(131).'U', chr(1) =&gt; chr(128).'A', chr(2) =&gt; chr(128).'B', chr(3) =&gt; chr(128).'C', &nbsp;</div></li><li><div>        chr(4) =&gt; chr(128).'D', chr(5) =&gt; chr(128).'E', chr(6) =&gt; chr(128).'F', chr(7) =&gt; chr(128).'G', &nbsp;</div></li><li><div>        chr(8) =&gt; chr(128).'H', chr(9) =&gt; chr(128).'I', chr(10) =&gt; chr(128).'J', chr(11) =&gt; 'K', &nbsp;</div></li><li><div>        chr(12) =&gt; chr(128).'L', chr(13) =&gt; chr(128).'M', chr(14) =&gt; chr(128).'N', chr(15) =&gt; chr(128).'O', &nbsp;</div></li><li><div>        chr(16) =&gt; chr(128).'P', chr(17) =&gt; chr(128).'Q', chr(18) =&gt; chr(128).'R', chr(19) =&gt; chr(128).'S', &nbsp;</div></li><li><div>        chr(20) =&gt; chr(128).'T', chr(21) =&gt; chr(128).'U', chr(22) =&gt; chr(128).'V', chr(23) =&gt; chr(128).'W', &nbsp;</div></li><li><div>        chr(24) =&gt; chr(128).'X', chr(25) =&gt; chr(128).'Y', chr(26) =&gt; chr(128).'Z', chr(27) =&gt; chr(131).'A', &nbsp;</div></li><li><div>        chr(28) =&gt; chr(131).'B', chr(29) =&gt; chr(131).'C', chr(30) =&gt; chr(131).'D', chr(31) =&gt; chr(131).'E', &nbsp;</div></li><li><div>        chr(32) =&gt; ' ', chr(33) =&gt; chr(129).'A', chr(34) =&gt; chr(129).'B', chr(35) =&gt; chr(129).'C', &nbsp;</div></li><li><div>        chr(36) =&gt; chr(129).'D', chr(37) =&gt; chr(129).'E', chr(38) =&gt; chr(129).'F', chr(39) =&gt; chr(129).'G', &nbsp;</div></li><li><div>        chr(40) =&gt; chr(129).'H', chr(41) =&gt; chr(129).'I', chr(42) =&gt; chr(129).'J', chr(43) =&gt; chr(129).'K', &nbsp;</div></li><li><div>        chr(44) =&gt; chr(129).'L', chr(45) =&gt; '-', chr(46) =&gt; '.', chr(47) =&gt; chr(129).'O', &nbsp;</div></li><li><div>        chr(48) =&gt; '0', chr(49) =&gt; '1', chr(50) =&gt; '2', chr(51) =&gt; '3', &nbsp;</div></li><li><div>        chr(52) =&gt; '4', chr(53) =&gt; '5', chr(54) =&gt; '6', chr(55) =&gt; '7', &nbsp;</div></li><li><div>        chr(56) =&gt; '8', chr(57) =&gt; '9', chr(58) =&gt; chr(129).'Z', chr(59) =&gt; chr(131).'F', &nbsp;</div></li><li><div>        chr(60) =&gt; chr(131).'G', chr(61) =&gt; chr(131).'H', chr(62) =&gt; chr(131).'I', chr(63) =&gt; chr(131).'J', &nbsp;</div></li><li><div>        chr(64) =&gt; chr(131).'V', chr(65) =&gt; 'A', chr(66) =&gt; 'B', chr(67) =&gt; 'C', &nbsp;</div></li><li><div>        chr(68) =&gt; 'D', chr(69) =&gt; 'E', chr(70) =&gt; 'F', chr(71) =&gt; 'G', &nbsp;</div></li><li><div>        chr(72) =&gt; 'H', chr(73) =&gt; 'I', chr(74) =&gt; 'J', chr(75) =&gt; 'K', &nbsp;</div></li><li><div>        chr(76) =&gt; 'L', chr(77) =&gt; 'M', chr(78) =&gt; 'N', chr(79) =&gt; 'O', &nbsp;</div></li><li><div>        chr(80) =&gt; 'P', chr(81) =&gt; 'Q', chr(82) =&gt; 'R', chr(83) =&gt; 'S', &nbsp;</div></li><li><div>        chr(84) =&gt; 'T', chr(85) =&gt; 'U', chr(86) =&gt; 'V', chr(87) =&gt; 'W', &nbsp;</div></li><li><div>        chr(88) =&gt; 'X', chr(89) =&gt; 'Y', chr(90) =&gt; 'Z', chr(91) =&gt; chr(131).'K', &nbsp;</div></li><li><div>        chr(92) =&gt; chr(131).'L', chr(93) =&gt; chr(131).'M', chr(94) =&gt; chr(131).'N', chr(95) =&gt; chr(131).'O', &nbsp;</div></li><li><div>        chr(96) =&gt; chr(131).'W', chr(97) =&gt; chr(130).'A', chr(98) =&gt; chr(130).'B', chr(99) =&gt; chr(130).'C', &nbsp;</div></li><li><div>        chr(100) =&gt; chr(130).'D', chr(101) =&gt; chr(130).'E', chr(102) =&gt; chr(130).'F', chr(103) =&gt; chr(130).'G', &nbsp;</div></li><li><div>        chr(104) =&gt; chr(130).'H', chr(105) =&gt; chr(130).'I', chr(106) =&gt; chr(130).'J', chr(107) =&gt; chr(130).'K', &nbsp;</div></li><li><div>        chr(108) =&gt; chr(130).'L', chr(109) =&gt; chr(130).'M', chr(110) =&gt; chr(130).'N', chr(111) =&gt; chr(130).'O', &nbsp;</div></li><li><div>        chr(112) =&gt; chr(130).'P', chr(113) =&gt; chr(130).'Q', chr(114) =&gt; chr(130).'R', chr(115) =&gt; chr(130).'S', &nbsp;</div></li><li><div>        chr(116) =&gt; chr(130).'T', chr(117) =&gt; chr(130).'U', chr(118) =&gt; chr(130).'V', chr(119) =&gt; chr(130).'W', &nbsp;</div></li><li><div>        chr(120) =&gt; chr(130).'X', chr(121) =&gt; chr(130).'Y', chr(122) =&gt; chr(130).'Z', chr(123) =&gt; chr(131).'P', &nbsp;</div></li><li><div>        chr(124) =&gt; chr(131).'Q', chr(125) =&gt; chr(131).'R', chr(126) =&gt; chr(131).'S', chr(127) =&gt; chr(131).'T');&nbsp;</div></li><li><div>    $code_ext = '';&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0 ; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        if (ord($code{$i}) &gt; 127) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $code_ext .= $encode[$code{$i}];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // checksum&nbsp;</div></li><li><div>    $code_ext .= $this-&gt;checksum_code93($code_ext);&nbsp;</div></li><li><div>    // add start and stop codes&nbsp;</div></li><li><div>    $code = '*'.$code_ext.'*';&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $char = ord($code{$i});&nbsp;</div></li><li><div>        if(!isset($chr[$char])) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 6; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $chr[$char]{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $bararray['bcode'][$k] = array('t' =&gt; true, 'w' =&gt; 1, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>    $bararray['maxw'] += 1;&nbsp;</div></li><li><div>    ++$k;&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Calculate CODE 93 checksum (modulo 47).&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return string checksum code.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function checksum_code93($code) {&nbsp;</div></li><li><div>    $chars = array(&nbsp;</div></li><li><div>        '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', &nbsp;</div></li><li><div>        'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', &nbsp;</div></li><li><div>        'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', &nbsp;</div></li><li><div>        'W', 'X', 'Y', 'Z', '-', '.', ' ', '$', '/', '+', '%', &nbsp;</div></li><li><div>        '&lt;', '=', '&gt;', '?');&nbsp;</div></li><li><div>    // translate special characters&nbsp;</div></li><li><div>    $code = strtr($code, chr(128).chr(131).chr(129).chr(130), '&lt;=&gt;?');&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    // calculate check digit C&nbsp;</div></li><li><div>    $p = 1;&nbsp;</div></li><li><div>    $check = 0;&nbsp;</div></li><li><div>    for ($i = ($len - 1); $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>        $k = array_keys($chars, $code{$i});&nbsp;</div></li><li><div>        $check += ($k[0] * $p);&nbsp;</div></li><li><div>        ++$p;&nbsp;</div></li><li><div>        if ($p &gt; 20) {&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $check %= 47;&nbsp;</div></li><li><div>    $c = $chars[$check];&nbsp;</div></li><li><div>    $code .= $c;&nbsp;</div></li><li><div>    // calculate check digit K&nbsp;</div></li><li><div>    $p = 1;&nbsp;</div></li><li><div>    $check = 0;&nbsp;</div></li><li><div>    for ($i = $len; $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>        $k = array_keys($chars, $code{$i});&nbsp;</div></li><li><div>        $check += ($k[0] * $p);&nbsp;</div></li><li><div>        ++$p;&nbsp;</div></li><li><div>        if ($p &gt; 15) {&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $check %= 47;&nbsp;</div></li><li><div>    $k = $chars[$check];&nbsp;</div></li><li><div>    $checksum = $c.$k;&nbsp;</div></li><li><div>    // resto respecial characters&nbsp;</div></li><li><div>    $checksum = strtr($checksum, '&lt;=&gt;?', chr(128).chr(131).chr(129).chr(130));&nbsp;</div></li><li><div>    return $checksum;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Checksum for standard 2 of 5 barcodes.&nbsp;</div></li><li><div> * @param $code (string) code to process.&nbsp;</div></li><li><div> * @return int checksum.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function checksum_s25($code) {&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    $sum = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; $i+=2) {&nbsp;</div></li><li><div>        $sum += $code{$i};&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $sum *= 3;&nbsp;</div></li><li><div>    for ($i = 1; $i &lt; $len; $i+=2) {&nbsp;</div></li><li><div>        $sum += ($code{$i});&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $r = $sum % 10;&nbsp;</div></li><li><div>    if($r &gt; 0) {&nbsp;</div></li><li><div>        $r = (10 - $r);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * MSI.&nbsp;</div></li><li><div> * Variation of Plessey code, with similar applications&nbsp;</div></li><li><div> * Contains digits (0 to 9) and encodes the data only in the width of bars.&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $checksum (boolean) if true add a checksum to the code (modulo 11)&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_msi($code, $checksum=false) {&nbsp;</div></li><li><div>    $chr['0'] = '100100100100';&nbsp;</div></li><li><div>    $chr['1'] = '100100100110';&nbsp;</div></li><li><div>    $chr['2'] = '100100110100';&nbsp;</div></li><li><div>    $chr['3'] = '100100110110';&nbsp;</div></li><li><div>    $chr['4'] = '100110100100';&nbsp;</div></li><li><div>    $chr['5'] = '100110100110';&nbsp;</div></li><li><div>    $chr['6'] = '100110110100';&nbsp;</div></li><li><div>    $chr['7'] = '100110110110';&nbsp;</div></li><li><div>    $chr['8'] = '110100100100';&nbsp;</div></li><li><div>    $chr['9'] = '110100100110';&nbsp;</div></li><li><div>    $chr['A'] = '110100110100';&nbsp;</div></li><li><div>    $chr['B'] = '110100110110';&nbsp;</div></li><li><div>    $chr['C'] = '110110100100';&nbsp;</div></li><li><div>    $chr['D'] = '110110100110';&nbsp;</div></li><li><div>    $chr['E'] = '110110110100';&nbsp;</div></li><li><div>    $chr['F'] = '110110110110';&nbsp;</div></li><li><div>    if ($checksum) {&nbsp;</div></li><li><div>        // add checksum&nbsp;</div></li><li><div>        $clen = strlen($code);&nbsp;</div></li><li><div>        $p = 2;&nbsp;</div></li><li><div>        $check = 0;&nbsp;</div></li><li><div>        for ($i = ($clen - 1); $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>            $check += (hexdec($code{$i}) * $p);&nbsp;</div></li><li><div>            ++$p;&nbsp;</div></li><li><div>            if ($p &gt; 7) {&nbsp;</div></li><li><div>                $p = 2;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $check %= 11;&nbsp;</div></li><li><div>        if ($check &gt; 0) {&nbsp;</div></li><li><div>            $check = 11 - $check;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $code .= $check;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq = '110'; // left guard&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $digit = $code{$i};&nbsp;</div></li><li><div>        if (!isset($chr[$digit])) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= $chr[$digit];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq .= '1001'; // right guard&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    return $this-&gt;binseq_to_array($seq, $bararray);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Standard 2 of 5 barcodes.&nbsp;</div></li><li><div> * Used in airline ticket marking, photofinishing&nbsp;</div></li><li><div> * Contains digits (0 to 9) and encodes the data only in the width of bars.&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $checksum (boolean) if true add a checksum to the code&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_s25($code, $checksum=false) {&nbsp;</div></li><li><div>    $chr['0'] = '10101110111010';&nbsp;</div></li><li><div>    $chr['1'] = '11101010101110';&nbsp;</div></li><li><div>    $chr['2'] = '10111010101110';&nbsp;</div></li><li><div>    $chr['3'] = '11101110101010';&nbsp;</div></li><li><div>    $chr['4'] = '10101110101110';&nbsp;</div></li><li><div>    $chr['5'] = '11101011101010';&nbsp;</div></li><li><div>    $chr['6'] = '10111011101010';&nbsp;</div></li><li><div>    $chr['7'] = '10101011101110';&nbsp;</div></li><li><div>    $chr['8'] = '10101110111010';&nbsp;</div></li><li><div>    $chr['9'] = '10111010111010';&nbsp;</div></li><li><div>    if ($checksum) {&nbsp;</div></li><li><div>        // add checksum&nbsp;</div></li><li><div>        $code .= $this-&gt;checksum_s25($code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if((strlen($code) % 2) != 0) {&nbsp;</div></li><li><div>        // add leading zero if code-length is odd&nbsp;</div></li><li><div>        $code = '0'.$code;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq = '11011010';&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $digit = $code{$i};&nbsp;</div></li><li><div>        if (!isset($chr[$digit])) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= $chr[$digit];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq .= '1101011';&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    return $this-&gt;binseq_to_array($seq, $bararray);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Convert binary barcode sequence to TCPDF barcode array.&nbsp;</div></li><li><div> * @param $seq (string) barcode as binary sequence.&nbsp;</div></li><li><div> * @param $bararray (array) barcode array.&nbsp;</div></li><li><div> * param array $bararray TCPDF barcode array to fill up&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function binseq_to_array($seq, $bararray) {&nbsp;</div></li><li><div>    $len = strlen($seq);&nbsp;</div></li><li><div>    $w = 0;&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        $w += 1;&nbsp;</div></li><li><div>        if (($i == ($len - 1)) OR (($i &lt; ($len - 1)) AND ($seq{$i} != $seq{($i+1)}))) {&nbsp;</div></li><li><div>            if ($seq{$i} == '1') {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>            $w = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Interleaved 2 of 5 barcodes.&nbsp;</div></li><li><div> * Compact numeric code, widely used in industry, air cargo&nbsp;</div></li><li><div> * Contains digits (0 to 9) and encodes the data in the width of both bars and spaces.&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $checksum (boolean) if true add a checksum to the code&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_i25($code, $checksum=false) {&nbsp;</div></li><li><div>    $chr['0'] = '11221';&nbsp;</div></li><li><div>    $chr['1'] = '21112';&nbsp;</div></li><li><div>    $chr['2'] = '12112';&nbsp;</div></li><li><div>    $chr['3'] = '22111';&nbsp;</div></li><li><div>    $chr['4'] = '11212';&nbsp;</div></li><li><div>    $chr['5'] = '21211';&nbsp;</div></li><li><div>    $chr['6'] = '12211';&nbsp;</div></li><li><div>    $chr['7'] = '11122';&nbsp;</div></li><li><div>    $chr['8'] = '21121';&nbsp;</div></li><li><div>    $chr['9'] = '12121';&nbsp;</div></li><li><div>    $chr['A'] = '11';&nbsp;</div></li><li><div>    $chr['Z'] = '21';&nbsp;</div></li><li><div>    if ($checksum) {&nbsp;</div></li><li><div>        // add checksum&nbsp;</div></li><li><div>        $code .= $this-&gt;checksum_s25($code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if((strlen($code) % 2) != 0) {&nbsp;</div></li><li><div>        // add leading zero if code-length is odd&nbsp;</div></li><li><div>        $code = '0'.$code;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // add start and stop codes&nbsp;</div></li><li><div>    $code = 'AA'.strtolower($code).'ZA';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $clen = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; $i = ($i + 2)) {&nbsp;</div></li><li><div>        $char_bar = $code{$i};&nbsp;</div></li><li><div>        $char_space = $code{$i+1};&nbsp;</div></li><li><div>        if((!isset($chr[$char_bar])) OR (!isset($chr[$char_space]))) {&nbsp;</div></li><li><div>            // invalid character&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // create a bar-space sequence&nbsp;</div></li><li><div>        $seq = '';&nbsp;</div></li><li><div>        $chrlen = strlen($chr[$char_bar]);&nbsp;</div></li><li><div>        for ($s = 0; $s &lt; $chrlen; $s++) {&nbsp;</div></li><li><div>            $seq .= $chr[$char_bar]{$s} . $chr[$char_space]{$s};&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seqlen = strlen($seq);&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; $seqlen; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $seq{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * C128 barcodes.&nbsp;</div></li><li><div> * Very capable code, excellent density, high reliability; in very wide use world-wide&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $type (string) barcode type: A, B, C or empty for automatic switch (AUTO mode)&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_c128($code, $type='') {&nbsp;</div></li><li><div>    $chr = array(&nbsp;</div></li><li><div>        '212222', /** 00 */&nbsp;</div></li><li><div>        '222122', /** 01 */&nbsp;</div></li><li><div>        '222221', /** 02 */&nbsp;</div></li><li><div>        '121223', /** 03 */&nbsp;</div></li><li><div>        '121322', /** 04 */&nbsp;</div></li><li><div>        '131222', /** 05 */&nbsp;</div></li><li><div>        '122213', /** 06 */&nbsp;</div></li><li><div>        '122312', /** 07 */&nbsp;</div></li><li><div>        '132212', /** 08 */&nbsp;</div></li><li><div>        '221213', /** 09 */&nbsp;</div></li><li><div>        '221312', /** 10 */&nbsp;</div></li><li><div>        '231212', /** 11 */&nbsp;</div></li><li><div>        '112232', /** 12 */&nbsp;</div></li><li><div>        '122132', /** 13 */&nbsp;</div></li><li><div>        '122231', /** 14 */&nbsp;</div></li><li><div>        '113222', /** 15 */&nbsp;</div></li><li><div>        '123122', /** 16 */&nbsp;</div></li><li><div>        '123221', /** 17 */&nbsp;</div></li><li><div>        '223211', /** 18 */&nbsp;</div></li><li><div>        '221132', /** 19 */&nbsp;</div></li><li><div>        '221231', /** 20 */&nbsp;</div></li><li><div>        '213212', /** 21 */&nbsp;</div></li><li><div>        '223112', /** 22 */&nbsp;</div></li><li><div>        '312131', /** 23 */&nbsp;</div></li><li><div>        '311222', /** 24 */&nbsp;</div></li><li><div>        '321122', /** 25 */&nbsp;</div></li><li><div>        '321221', /** 26 */&nbsp;</div></li><li><div>        '312212', /** 27 */&nbsp;</div></li><li><div>        '322112', /** 28 */&nbsp;</div></li><li><div>        '322211', /** 29 */&nbsp;</div></li><li><div>        '212123', /** 30 */&nbsp;</div></li><li><div>        '212321', /** 31 */&nbsp;</div></li><li><div>        '232121', /** 32 */&nbsp;</div></li><li><div>        '111323', /** 33 */&nbsp;</div></li><li><div>        '131123', /** 34 */&nbsp;</div></li><li><div>        '131321', /** 35 */&nbsp;</div></li><li><div>        '112313', /** 36 */&nbsp;</div></li><li><div>        '132113', /** 37 */&nbsp;</div></li><li><div>        '132311', /** 38 */&nbsp;</div></li><li><div>        '211313', /** 39 */&nbsp;</div></li><li><div>        '231113', /** 40 */&nbsp;</div></li><li><div>        '231311', /** 41 */&nbsp;</div></li><li><div>        '112133', /** 42 */&nbsp;</div></li><li><div>        '112331', /** 43 */&nbsp;</div></li><li><div>        '132131', /** 44 */&nbsp;</div></li><li><div>        '113123', /** 45 */&nbsp;</div></li><li><div>        '113321', /** 46 */&nbsp;</div></li><li><div>        '133121', /** 47 */&nbsp;</div></li><li><div>        '313121', /** 48 */&nbsp;</div></li><li><div>        '211331', /** 49 */&nbsp;</div></li><li><div>        '231131', /** 50 */&nbsp;</div></li><li><div>        '213113', /** 51 */&nbsp;</div></li><li><div>        '213311', /** 52 */&nbsp;</div></li><li><div>        '213131', /** 53 */&nbsp;</div></li><li><div>        '311123', /** 54 */&nbsp;</div></li><li><div>        '311321', /** 55 */&nbsp;</div></li><li><div>        '331121', /** 56 */&nbsp;</div></li><li><div>        '312113', /** 57 */&nbsp;</div></li><li><div>        '312311', /** 58 */&nbsp;</div></li><li><div>        '332111', /** 59 */&nbsp;</div></li><li><div>        '314111', /** 60 */&nbsp;</div></li><li><div>        '221411', /** 61 */&nbsp;</div></li><li><div>        '431111', /** 62 */&nbsp;</div></li><li><div>        '111224', /** 63 */&nbsp;</div></li><li><div>        '111422', /** 64 */&nbsp;</div></li><li><div>        '121124', /** 65 */&nbsp;</div></li><li><div>        '121421', /** 66 */&nbsp;</div></li><li><div>        '141122', /** 67 */&nbsp;</div></li><li><div>        '141221', /** 68 */&nbsp;</div></li><li><div>        '112214', /** 69 */&nbsp;</div></li><li><div>        '112412', /** 70 */&nbsp;</div></li><li><div>        '122114', /** 71 */&nbsp;</div></li><li><div>        '122411', /** 72 */&nbsp;</div></li><li><div>        '142112', /** 73 */&nbsp;</div></li><li><div>        '142211', /** 74 */&nbsp;</div></li><li><div>        '241211', /** 75 */&nbsp;</div></li><li><div>        '221114', /** 76 */&nbsp;</div></li><li><div>        '413111', /** 77 */&nbsp;</div></li><li><div>        '241112', /** 78 */&nbsp;</div></li><li><div>        '134111', /** 79 */&nbsp;</div></li><li><div>        '111242', /** 80 */&nbsp;</div></li><li><div>        '121142', /** 81 */&nbsp;</div></li><li><div>        '121241', /** 82 */&nbsp;</div></li><li><div>        '114212', /** 83 */&nbsp;</div></li><li><div>        '124112', /** 84 */&nbsp;</div></li><li><div>        '124211', /** 85 */&nbsp;</div></li><li><div>        '411212', /** 86 */&nbsp;</div></li><li><div>        '421112', /** 87 */&nbsp;</div></li><li><div>        '421211', /** 88 */&nbsp;</div></li><li><div>        '212141', /** 89 */&nbsp;</div></li><li><div>        '214121', /** 90 */&nbsp;</div></li><li><div>        '412121', /** 91 */&nbsp;</div></li><li><div>        '111143', /** 92 */&nbsp;</div></li><li><div>        '111341', /** 93 */&nbsp;</div></li><li><div>        '131141', /** 94 */&nbsp;</div></li><li><div>        '114113', /** 95 */&nbsp;</div></li><li><div>        '114311', /** 96 */&nbsp;</div></li><li><div>        '411113', /** 97 */&nbsp;</div></li><li><div>        '411311', /** 98 */&nbsp;</div></li><li><div>        '113141', /** 99 */&nbsp;</div></li><li><div>        '114131', /** 100 */&nbsp;</div></li><li><div>        '311141', /** 101 */&nbsp;</div></li><li><div>        '411131', /** 102 */&nbsp;</div></li><li><div>        '211412', /** 103 START A */&nbsp;</div></li><li><div>        '211214', /** 104 START B */&nbsp;</div></li><li><div>        '211232', /** 105 START C */&nbsp;</div></li><li><div>        '233111', /** STOP */&nbsp;</div></li><li><div>        '200000'  /** END */&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    // ASCII characters for code A (ASCII 00 - 95)&nbsp;</div></li><li><div>    $keys_a = ' !&quot;#$%&\'()*+, -./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_';&nbsp;</div></li><li><div>    $keys_a .= chr(0).chr(1).chr(2).chr(3).chr(4).chr(5).chr(6).chr(7).chr(8).chr(9);&nbsp;</div></li><li><div>    $keys_a .= chr(10).chr(11).chr(12).chr(13).chr(14).chr(15).chr(16).chr(17).chr(18).chr(19);&nbsp;</div></li><li><div>    $keys_a .= chr(20).chr(21).chr(22).chr(23).chr(24).chr(25).chr(26).chr(27).chr(28).chr(29);&nbsp;</div></li><li><div>    $keys_a .= chr(30).chr(31);&nbsp;</div></li><li><div>    // ASCII characters for code B (ASCII 32 - 127)&nbsp;</div></li><li><div>    $keys_b = ' !&quot;#$%&\'()*+, -./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~'.chr(127);&nbsp;</div></li><li><div>    // special codes&nbsp;</div></li><li><div>    $fnc_a = array(241 =&gt; 102, 242 =&gt; 97, 243 =&gt; 96, 244 =&gt; 101);&nbsp;</div></li><li><div>    $fnc_b = array(241 =&gt; 102, 242 =&gt; 97, 243 =&gt; 96, 244 =&gt; 100);&nbsp;</div></li><li><div>    // array of symbols&nbsp;</div></li><li><div>    $code_data = array();&nbsp;</div></li><li><div>    // lenght of the code&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    switch(strtoupper($type)) {&nbsp;</div></li><li><div>        case 'A': { // MODE A&nbsp;</div></li><li><div>            $startid = 103;&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>                $char = $code{$i};&nbsp;</div></li><li><div>                $char_id = ord($char);&nbsp;</div></li><li><div>                if (($char_id &gt;= 241) AND ($char_id &lt;= 244)) {&nbsp;</div></li><li><div>                    $code_data[] = $fnc_a[$char_id];&nbsp;</div></li><li><div>                } elseif (($char_id &gt;= 0) AND ($char_id &lt;= 95)) {&nbsp;</div></li><li><div>                    $code_data[] = strpos($keys_a, $char);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'B': { // MODE B&nbsp;</div></li><li><div>            $startid = 104;&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>                $char = $code{$i};&nbsp;</div></li><li><div>                $char_id = ord($char);&nbsp;</div></li><li><div>                if (($char_id &gt;= 241) AND ($char_id &lt;= 244)) {&nbsp;</div></li><li><div>                    $code_data[] = $fnc_b[$char_id];&nbsp;</div></li><li><div>                } elseif (($char_id &gt;= 32) AND ($char_id &lt;= 127)) {&nbsp;</div></li><li><div>                    $code_data[] = strpos($keys_b, $char);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 'C': { // MODE C&nbsp;</div></li><li><div>            $startid = 105;&nbsp;</div></li><li><div>            if (ord($code[0]) == 241) {&nbsp;</div></li><li><div>                $code_data[] = 102;&nbsp;</div></li><li><div>                $code = substr($code, 1);&nbsp;</div></li><li><div>                --$len;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (($len % 2) != 0) {&nbsp;</div></li><li><div>                // the length must be even&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $len; $i+=2) {&nbsp;</div></li><li><div>                $chrnum = $code{$i}.$code{$i+1};&nbsp;</div></li><li><div>                if (preg_match('/([0-9]{2})/', $chrnum) &gt; 0) {&nbsp;</div></li><li><div>                    $code_data[] = intval($chrnum);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        default: { // MODE AUTO&nbsp;</div></li><li><div>            // split code into sequences&nbsp;</div></li><li><div>            $sequence = array();&nbsp;</div></li><li><div>            // get numeric sequences (if any)&nbsp;</div></li><li><div>            $numseq = array();&nbsp;</div></li><li><div>            preg_match_all('/([0-9]{4, })/', $code, $numseq, PREG_OFFSET_CAPTURE);&nbsp;</div></li><li><div>            if (isset($numseq[1]) AND !empty($numseq[1])) {&nbsp;</div></li><li><div>                $end_offset = 0;&nbsp;</div></li><li><div>                foreach ($numseq[1] as $val) {&nbsp;</div></li><li><div>                    $offset = $val[1];&nbsp;</div></li><li><div>                    if ($offset &gt; $end_offset) {&nbsp;</div></li><li><div>                        // non numeric sequence&nbsp;</div></li><li><div>                        $sequence = array_merge($sequence, $this-&gt;get128ABsequence(substr($code, $end_offset, ($offset - $end_offset))));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // numeric sequence&nbsp;</div></li><li><div>                    $slen = strlen($val[0]);&nbsp;</div></li><li><div>                    if (($slen % 2) != 0) {&nbsp;</div></li><li><div>                        // the length must be even&nbsp;</div></li><li><div>                        --$slen;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $sequence[] = array('C', substr($code, $offset, $slen), $slen);&nbsp;</div></li><li><div>                    $end_offset = $offset + $slen;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ($end_offset &lt; $len) {&nbsp;</div></li><li><div>                    $sequence = array_merge($sequence, $this-&gt;get128ABsequence(substr($code, $end_offset)));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // text code (non C mode)&nbsp;</div></li><li><div>                $sequence = array_merge($sequence, $this-&gt;get128ABsequence($code));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // process the sequence&nbsp;</div></li><li><div>            foreach ($sequence as $key =&gt; $seq) {&nbsp;</div></li><li><div>                switch($seq[0]) {&nbsp;</div></li><li><div>                    case 'A': {&nbsp;</div></li><li><div>                        if ($key == 0) {&nbsp;</div></li><li><div>                            $startid = 103;&nbsp;</div></li><li><div>                        } elseif ($sequence[($key - 1)][0] != 'A') {&nbsp;</div></li><li><div>                            if (($seq[2] == 1) AND ($key &gt; 0) AND ($sequence[($key - 1)][0] == 'B') AND (!isset($sequence[($key - 1)][3]))) {&nbsp;</div></li><li><div>                                // single character shift&nbsp;</div></li><li><div>                                $code_data[] = 98;&nbsp;</div></li><li><div>                                // mark shift&nbsp;</div></li><li><div>                                $sequence[$key][3] = true;&nbsp;</div></li><li><div>                            } elseif (!isset($sequence[($key - 1)][3])) {&nbsp;</div></li><li><div>                                $code_data[] = 101;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; $seq[2]; ++$i) {&nbsp;</div></li><li><div>                            $char = $seq[1]{$i};&nbsp;</div></li><li><div>                            $char_id = ord($char);&nbsp;</div></li><li><div>                            if (($char_id &gt;= 241) AND ($char_id &lt;= 244)) {&nbsp;</div></li><li><div>                                $code_data[] = $fnc_a[$char_id];&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $code_data[] = strpos($keys_a, $char);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    case 'B': {&nbsp;</div></li><li><div>                        if ($key == 0) {&nbsp;</div></li><li><div>                            $tmpchr = ord($seq[1][0]);&nbsp;</div></li><li><div>                            if (($seq[2] == 1) AND ($tmpchr &gt;= 241) AND ($tmpchr &lt;= 244) AND isset($sequence[($key + 1)]) AND ($sequence[($key + 1)][0] != 'B')) {&nbsp;</div></li><li><div>                                switch ($sequence[($key + 1)][0]) {&nbsp;</div></li><li><div>                                    case 'A': {&nbsp;</div></li><li><div>                                        $startid = 103;&nbsp;</div></li><li><div>                                        $sequence[$key][0] = 'A';&nbsp;</div></li><li><div>                                        $code_data[] = $fnc_a[$tmpchr];&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    case 'C': {&nbsp;</div></li><li><div>                                        $startid = 105;&nbsp;</div></li><li><div>                                        $sequence[$key][0] = 'C';&nbsp;</div></li><li><div>                                        $code_data[] = $fnc_a[$tmpchr];&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $startid = 104;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } elseif ($sequence[($key - 1)][0] != 'B') {&nbsp;</div></li><li><div>                            if (($seq[2] == 1) AND ($key &gt; 0) AND ($sequence[($key - 1)][0] == 'A') AND (!isset($sequence[($key - 1)][3]))) {&nbsp;</div></li><li><div>                                // single character shift&nbsp;</div></li><li><div>                                $code_data[] = 98;&nbsp;</div></li><li><div>                                // mark shift&nbsp;</div></li><li><div>                                $sequence[$key][3] = true;&nbsp;</div></li><li><div>                            } elseif (!isset($sequence[($key - 1)][3])) {&nbsp;</div></li><li><div>                                $code_data[] = 100;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; $seq[2]; ++$i) {&nbsp;</div></li><li><div>                            $char = $seq[1]{$i};&nbsp;</div></li><li><div>                            $char_id = ord($char);&nbsp;</div></li><li><div>                            if (($char_id &gt;= 241) AND ($char_id &lt;= 244)) {&nbsp;</div></li><li><div>                                $code_data[] = $fnc_b[$char_id];&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                $code_data[] = strpos($keys_b, $char);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    case 'C': {&nbsp;</div></li><li><div>                        if ($key == 0) {&nbsp;</div></li><li><div>                            $startid = 105;&nbsp;</div></li><li><div>                        } elseif ($sequence[($key - 1)][0] != 'C') {&nbsp;</div></li><li><div>                            $code_data[] = 99;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        for ($i = 0; $i &lt; $seq[2]; $i+=2) {&nbsp;</div></li><li><div>                            $chrnum = $seq[1]{$i}.$seq[1]{$i+1};&nbsp;</div></li><li><div>                            $code_data[] = intval($chrnum);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // calculate check character&nbsp;</div></li><li><div>    $sum = $startid;&nbsp;</div></li><li><div>    foreach ($code_data as $key =&gt; $val) {&nbsp;</div></li><li><div>        $sum += ($val * ($key + 1));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // add check character&nbsp;</div></li><li><div>    $code_data[] = ($sum % 103);&nbsp;</div></li><li><div>    // add stop sequence&nbsp;</div></li><li><div>    $code_data[] = 106;&nbsp;</div></li><li><div>    $code_data[] = 107;&nbsp;</div></li><li><div>    // add start code at the beginning&nbsp;</div></li><li><div>    array_unshift($code_data, $startid);&nbsp;</div></li><li><div>    // build barcode array&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    foreach ($code_data as $val) {&nbsp;</div></li><li><div>        $seq = $chr[$val];&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 6; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $seq{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Split text code in A/B sequence for 128 code&nbsp;</div></li><li><div> * @param $code (string) code to split.&nbsp;</div></li><li><div> * @return array sequence&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function get128ABsequence($code) {&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    $sequence = array();&nbsp;</div></li><li><div>    // get A sequences (if any)&nbsp;</div></li><li><div>    $numseq = array();&nbsp;</div></li><li><div>    preg_match_all('/([\0-\31])/', $code, $numseq, PREG_OFFSET_CAPTURE);&nbsp;</div></li><li><div>    if (isset($numseq[1]) AND !empty($numseq[1])) {&nbsp;</div></li><li><div>        $end_offset = 0;&nbsp;</div></li><li><div>        foreach ($numseq[1] as $val) {&nbsp;</div></li><li><div>            $offset = $val[1];&nbsp;</div></li><li><div>            if ($offset &gt; $end_offset) {&nbsp;</div></li><li><div>                // B sequence&nbsp;</div></li><li><div>                $sequence[] = array('B', substr($code, $end_offset, ($offset - $end_offset)), ($offset - $end_offset));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // A sequence&nbsp;</div></li><li><div>            $slen = strlen($val[0]);&nbsp;</div></li><li><div>            $sequence[] = array('A', substr($code, $offset, $slen), $slen);&nbsp;</div></li><li><div>            $end_offset = $offset + $slen;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($end_offset &lt; $len) {&nbsp;</div></li><li><div>            $sequence[] = array('B', substr($code, $end_offset), ($len - $end_offset));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        // only B sequence&nbsp;</div></li><li><div>        $sequence[] = array('B', $code, $len);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $sequence;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * EAN13 and UPC-A barcodes.&nbsp;</div></li><li><div> * EAN13: European Article Numbering international retail product code&nbsp;</div></li><li><div> * UPC-A: Universal product code seen on almost all retail products in the USA and Canada&nbsp;</div></li><li><div> * UPC-E: Short version of UPC symbol&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $len (string) barcode type: 6 = UPC-E, 8 = EAN8, 13 = EAN13, 12 = UPC-A&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_eanupc($code, $len=13) {&nbsp;</div></li><li><div>    $upce = false;&nbsp;</div></li><li><div>    if ($len == 6) {&nbsp;</div></li><li><div>        $len = 12; // UPC-A&nbsp;</div></li><li><div>        $upce = true; // UPC-E mode&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $data_len = $len - 1;&nbsp;</div></li><li><div>    //Padding&nbsp;</div></li><li><div>    $code = str_pad($code, $data_len, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>    $code_len = strlen($code);&nbsp;</div></li><li><div>    // calculate check digit&nbsp;</div></li><li><div>    $sum_a = 0;&nbsp;</div></li><li><div>    for ($i = 1; $i &lt; $data_len; $i+=2) {&nbsp;</div></li><li><div>        $sum_a += $code{$i};&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($len &gt; 12) {&nbsp;</div></li><li><div>        $sum_a *= 3;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $sum_b = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $data_len; $i+=2) {&nbsp;</div></li><li><div>        $sum_b += ($code{$i});&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($len &lt; 13) {&nbsp;</div></li><li><div>        $sum_b *= 3;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $r = ($sum_a + $sum_b) % 10;&nbsp;</div></li><li><div>    if($r &gt; 0) {&nbsp;</div></li><li><div>        $r = (10 - $r);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($code_len == $data_len) {&nbsp;</div></li><li><div>        // add check digit&nbsp;</div></li><li><div>        $code .= $r;&nbsp;</div></li><li><div>    } elseif ($r !== intval($code{$data_len})) {&nbsp;</div></li><li><div>        // wrong checkdigit&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($len == 12) {&nbsp;</div></li><li><div>        // UPC-A&nbsp;</div></li><li><div>        $code = '0'.$code;&nbsp;</div></li><li><div>        ++$len;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($upce) {&nbsp;</div></li><li><div>        // convert UPC-A to UPC-E&nbsp;</div></li><li><div>        $tmp = substr($code, 4, 3);&nbsp;</div></li><li><div>        if (($tmp == '000') OR ($tmp == '100') OR ($tmp == '200')) {&nbsp;</div></li><li><div>            // manufacturer code ends in 000, 100, or 200&nbsp;</div></li><li><div>            $upce_code = substr($code, 2, 2).substr($code, 9, 3).substr($code, 4, 1);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $tmp = substr($code, 5, 2);&nbsp;</div></li><li><div>            if ($tmp == '00') {&nbsp;</div></li><li><div>                // manufacturer code ends in 00&nbsp;</div></li><li><div>                $upce_code = substr($code, 2, 3).substr($code, 10, 2).'3';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $tmp = substr($code, 6, 1);&nbsp;</div></li><li><div>                if ($tmp == '0') {&nbsp;</div></li><li><div>                    // manufacturer code ends in 0&nbsp;</div></li><li><div>                    $upce_code = substr($code, 2, 4).substr($code, 11, 1).'4';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // manufacturer code does not end in zero&nbsp;</div></li><li><div>                    $upce_code = substr($code, 2, 5).substr($code, 11, 1);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    //Convert digits to bars&nbsp;</div></li><li><div>    $codes = array(&nbsp;</div></li><li><div>        'A'=&gt;array( // left odd parity&nbsp;</div></li><li><div>            '0'=&gt;'0001101', &nbsp;</div></li><li><div>            '1'=&gt;'0011001', &nbsp;</div></li><li><div>            '2'=&gt;'0010011', &nbsp;</div></li><li><div>            '3'=&gt;'0111101', &nbsp;</div></li><li><div>            '4'=&gt;'0100011', &nbsp;</div></li><li><div>            '5'=&gt;'0110001', &nbsp;</div></li><li><div>            '6'=&gt;'0101111', &nbsp;</div></li><li><div>            '7'=&gt;'0111011', &nbsp;</div></li><li><div>            '8'=&gt;'0110111', &nbsp;</div></li><li><div>            '9'=&gt;'0001011'), &nbsp;</div></li><li><div>        'B'=&gt;array( // left even parity&nbsp;</div></li><li><div>            '0'=&gt;'0100111', &nbsp;</div></li><li><div>            '1'=&gt;'0110011', &nbsp;</div></li><li><div>            '2'=&gt;'0011011', &nbsp;</div></li><li><div>            '3'=&gt;'0100001', &nbsp;</div></li><li><div>            '4'=&gt;'0011101', &nbsp;</div></li><li><div>            '5'=&gt;'0111001', &nbsp;</div></li><li><div>            '6'=&gt;'0000101', &nbsp;</div></li><li><div>            '7'=&gt;'0010001', &nbsp;</div></li><li><div>            '8'=&gt;'0001001', &nbsp;</div></li><li><div>            '9'=&gt;'0010111'), &nbsp;</div></li><li><div>        'C'=&gt;array( // right&nbsp;</div></li><li><div>            '0'=&gt;'1110010', &nbsp;</div></li><li><div>            '1'=&gt;'1100110', &nbsp;</div></li><li><div>            '2'=&gt;'1101100', &nbsp;</div></li><li><div>            '3'=&gt;'1000010', &nbsp;</div></li><li><div>            '4'=&gt;'1011100', &nbsp;</div></li><li><div>            '5'=&gt;'1001110', &nbsp;</div></li><li><div>            '6'=&gt;'1010000', &nbsp;</div></li><li><div>            '7'=&gt;'1000100', &nbsp;</div></li><li><div>            '8'=&gt;'1001000', &nbsp;</div></li><li><div>            '9'=&gt;'1110100')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $parities = array(&nbsp;</div></li><li><div>        '0'=&gt;array('A', 'A', 'A', 'A', 'A', 'A'), &nbsp;</div></li><li><div>        '1'=&gt;array('A', 'A', 'B', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '2'=&gt;array('A', 'A', 'B', 'B', 'A', 'B'), &nbsp;</div></li><li><div>        '3'=&gt;array('A', 'A', 'B', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '4'=&gt;array('A', 'B', 'A', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '5'=&gt;array('A', 'B', 'B', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '6'=&gt;array('A', 'B', 'B', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '7'=&gt;array('A', 'B', 'A', 'B', 'A', 'B'), &nbsp;</div></li><li><div>        '8'=&gt;array('A', 'B', 'A', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '9'=&gt;array('A', 'B', 'B', 'A', 'B', 'A')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $upce_parities = array();&nbsp;</div></li><li><div>    $upce_parities[0] = array(&nbsp;</div></li><li><div>        '0'=&gt;array('B', 'B', 'B', 'A', 'A', 'A'), &nbsp;</div></li><li><div>        '1'=&gt;array('B', 'B', 'A', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '2'=&gt;array('B', 'B', 'A', 'A', 'B', 'A'), &nbsp;</div></li><li><div>        '3'=&gt;array('B', 'B', 'A', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '4'=&gt;array('B', 'A', 'B', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '5'=&gt;array('B', 'A', 'A', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '6'=&gt;array('B', 'A', 'A', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '7'=&gt;array('B', 'A', 'B', 'A', 'B', 'A'), &nbsp;</div></li><li><div>        '8'=&gt;array('B', 'A', 'B', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '9'=&gt;array('B', 'A', 'A', 'B', 'A', 'B')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $upce_parities[1] = array(&nbsp;</div></li><li><div>        '0'=&gt;array('A', 'A', 'A', 'B', 'B', 'B'), &nbsp;</div></li><li><div>        '1'=&gt;array('A', 'A', 'B', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '2'=&gt;array('A', 'A', 'B', 'B', 'A', 'B'), &nbsp;</div></li><li><div>        '3'=&gt;array('A', 'A', 'B', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '4'=&gt;array('A', 'B', 'A', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '5'=&gt;array('A', 'B', 'B', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '6'=&gt;array('A', 'B', 'B', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '7'=&gt;array('A', 'B', 'A', 'B', 'A', 'B'), &nbsp;</div></li><li><div>        '8'=&gt;array('A', 'B', 'A', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '9'=&gt;array('A', 'B', 'B', 'A', 'B', 'A')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $seq = '101'; // left guard bar&nbsp;</div></li><li><div>    if ($upce) {&nbsp;</div></li><li><div>        $bararray = array('code' =&gt; $upce_code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>        $p = $upce_parities[$code[1]][$r];&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; 6; ++$i) {&nbsp;</div></li><li><div>            $seq .= $codes[$p[$i]][$upce_code{$i}];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= '010101'; // right guard bar&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>        $half_len = intval(ceil($len / 2));&nbsp;</div></li><li><div>        if ($len == 8) {&nbsp;</div></li><li><div>            for ($i = 0; $i &lt; $half_len; ++$i) {&nbsp;</div></li><li><div>                $seq .= $codes['A'][$code{$i}];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $p = $parities[$code[0]];&nbsp;</div></li><li><div>            for ($i = 1; $i &lt; $half_len; ++$i) {&nbsp;</div></li><li><div>                $seq .= $codes[$p[$i-1]][$code{$i}];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= '01010'; // center guard bar&nbsp;</div></li><li><div>        for ($i = $half_len; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>            $seq .= $codes['C'][$code{$i}];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq .= '101'; // right guard bar&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $clen = strlen($seq);&nbsp;</div></li><li><div>    $w = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $clen; ++$i) {&nbsp;</div></li><li><div>        $w += 1;&nbsp;</div></li><li><div>        if (($i == ($clen - 1)) OR (($i &lt; ($clen - 1)) AND ($seq{$i} != $seq{($i+1)}))) {&nbsp;</div></li><li><div>            if ($seq{$i} == '1') {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>            $w = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * UPC-Based Extentions&nbsp;</div></li><li><div> * 2-Digit Ext.: Used to indicate magazines and newspaper issue numbers&nbsp;</div></li><li><div> * 5-Digit Ext.: Used to mark suggested retail price of books&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @param $len (string) barcode type: 2 = 2-Digit, 5 = 5-Digit&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_eanext($code, $len=5) {&nbsp;</div></li><li><div>    //Padding&nbsp;</div></li><li><div>    $code = str_pad($code, $len, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>    // calculate check digit&nbsp;</div></li><li><div>    if ($len == 2) {&nbsp;</div></li><li><div>        $r = $code % 4;&nbsp;</div></li><li><div>    } elseif ($len == 5) {&nbsp;</div></li><li><div>        $r = (3 * ($code[0] + $code[2] + $code[4])) + (9 * ($code[1] + $code[3]));&nbsp;</div></li><li><div>        $r %= 10;&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    //Convert digits to bars&nbsp;</div></li><li><div>    $codes = array(&nbsp;</div></li><li><div>        'A'=&gt;array( // left odd parity&nbsp;</div></li><li><div>            '0'=&gt;'0001101', &nbsp;</div></li><li><div>            '1'=&gt;'0011001', &nbsp;</div></li><li><div>            '2'=&gt;'0010011', &nbsp;</div></li><li><div>            '3'=&gt;'0111101', &nbsp;</div></li><li><div>            '4'=&gt;'0100011', &nbsp;</div></li><li><div>            '5'=&gt;'0110001', &nbsp;</div></li><li><div>            '6'=&gt;'0101111', &nbsp;</div></li><li><div>            '7'=&gt;'0111011', &nbsp;</div></li><li><div>            '8'=&gt;'0110111', &nbsp;</div></li><li><div>            '9'=&gt;'0001011'), &nbsp;</div></li><li><div>        'B'=&gt;array( // left even parity&nbsp;</div></li><li><div>            '0'=&gt;'0100111', &nbsp;</div></li><li><div>            '1'=&gt;'0110011', &nbsp;</div></li><li><div>            '2'=&gt;'0011011', &nbsp;</div></li><li><div>            '3'=&gt;'0100001', &nbsp;</div></li><li><div>            '4'=&gt;'0011101', &nbsp;</div></li><li><div>            '5'=&gt;'0111001', &nbsp;</div></li><li><div>            '6'=&gt;'0000101', &nbsp;</div></li><li><div>            '7'=&gt;'0010001', &nbsp;</div></li><li><div>            '8'=&gt;'0001001', &nbsp;</div></li><li><div>            '9'=&gt;'0010111')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $parities = array();&nbsp;</div></li><li><div>    $parities[2] = array(&nbsp;</div></li><li><div>        '0'=&gt;array('A', 'A'), &nbsp;</div></li><li><div>        '1'=&gt;array('A', 'B'), &nbsp;</div></li><li><div>        '2'=&gt;array('B', 'A'), &nbsp;</div></li><li><div>        '3'=&gt;array('B', 'B')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $parities[5] = array(&nbsp;</div></li><li><div>        '0'=&gt;array('B', 'B', 'A', 'A', 'A'), &nbsp;</div></li><li><div>        '1'=&gt;array('B', 'A', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '2'=&gt;array('B', 'A', 'A', 'B', 'A'), &nbsp;</div></li><li><div>        '3'=&gt;array('B', 'A', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '4'=&gt;array('A', 'B', 'B', 'A', 'A'), &nbsp;</div></li><li><div>        '5'=&gt;array('A', 'A', 'B', 'B', 'A'), &nbsp;</div></li><li><div>        '6'=&gt;array('A', 'A', 'A', 'B', 'B'), &nbsp;</div></li><li><div>        '7'=&gt;array('A', 'B', 'A', 'B', 'A'), &nbsp;</div></li><li><div>        '8'=&gt;array('A', 'B', 'A', 'A', 'B'), &nbsp;</div></li><li><div>        '9'=&gt;array('A', 'A', 'B', 'A', 'B')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $p = $parities[$len][$r];&nbsp;</div></li><li><div>    $seq = '1011'; // left guard bar&nbsp;</div></li><li><div>    $seq .= $codes[$p[0]][$code[0]];&nbsp;</div></li><li><div>    for ($i = 1; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        $seq .= '01'; // separator&nbsp;</div></li><li><div>        $seq .= $codes[$p[$i]][$code{$i}];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    return $this-&gt;binseq_to_array($seq, $bararray);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * POSTNET and PLANET barcodes.&nbsp;</div></li><li><div> * Used by U.S. Postal Service for automated mail sorting&nbsp;</div></li><li><div> * @param $code (string) zip code to represent. Must be a string containing a zip code of the form DDDDD or DDDDD-DDDD.&nbsp;</div></li><li><div> * @param $planet (boolean) if true print the PLANET barcode, otherwise print POSTNET&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_postnet($code, $planet=false) {&nbsp;</div></li><li><div>    // bar lenght&nbsp;</div></li><li><div>    if ($planet) {&nbsp;</div></li><li><div>        $barlen = Array(&nbsp;</div></li><li><div>            0 =&gt; Array(1, 1, 2, 2, 2), &nbsp;</div></li><li><div>            1 =&gt; Array(2, 2, 2, 1, 1), &nbsp;</div></li><li><div>            2 =&gt; Array(2, 2, 1, 2, 1), &nbsp;</div></li><li><div>            3 =&gt; Array(2, 2, 1, 1, 2), &nbsp;</div></li><li><div>            4 =&gt; Array(2, 1, 2, 2, 1), &nbsp;</div></li><li><div>            5 =&gt; Array(2, 1, 2, 1, 2), &nbsp;</div></li><li><div>            6 =&gt; Array(2, 1, 1, 2, 2), &nbsp;</div></li><li><div>            7 =&gt; Array(1, 2, 2, 2, 1), &nbsp;</div></li><li><div>            8 =&gt; Array(1, 2, 2, 1, 2), &nbsp;</div></li><li><div>            9 =&gt; Array(1, 2, 1, 2, 2)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        $barlen = Array(&nbsp;</div></li><li><div>            0 =&gt; Array(2, 2, 1, 1, 1), &nbsp;</div></li><li><div>            1 =&gt; Array(1, 1, 1, 2, 2), &nbsp;</div></li><li><div>            2 =&gt; Array(1, 1, 2, 1, 2), &nbsp;</div></li><li><div>            3 =&gt; Array(1, 1, 2, 2, 1), &nbsp;</div></li><li><div>            4 =&gt; Array(1, 2, 1, 1, 2), &nbsp;</div></li><li><div>            5 =&gt; Array(1, 2, 1, 2, 1), &nbsp;</div></li><li><div>            6 =&gt; Array(1, 2, 2, 1, 1), &nbsp;</div></li><li><div>            7 =&gt; Array(2, 1, 1, 1, 2), &nbsp;</div></li><li><div>            8 =&gt; Array(2, 1, 1, 2, 1), &nbsp;</div></li><li><div>            9 =&gt; Array(2, 1, 2, 1, 1)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 2, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $code = str_replace('-', '', $code);&nbsp;</div></li><li><div>    $code = str_replace(' ', '', $code);&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    // calculate checksum&nbsp;</div></li><li><div>    $sum = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        $sum += intval($code{$i});&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $chkd = ($sum % 10);&nbsp;</div></li><li><div>    if($chkd &gt; 0) {&nbsp;</div></li><li><div>        $chkd = (10 - $chkd);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $code .= $chkd;&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    // start bar&nbsp;</div></li><li><div>    $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>    $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>    $bararray['maxw'] += 2;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 5; ++$j) {&nbsp;</div></li><li><div>            $h = $barlen[$code{$i}][$j];&nbsp;</div></li><li><div>            $p = floor(1 / $h);&nbsp;</div></li><li><div>            $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; $h, 'p' =&gt; $p);&nbsp;</div></li><li><div>            $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += 2;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // end bar&nbsp;</div></li><li><div>    $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>    $bararray['maxw'] += 1;&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * RMS4CC - CBC - KIX&nbsp;</div></li><li><div> * RMS4CC (Royal Mail 4-state Customer Code) - CBC (Customer Bar Code) - KIX (Klant index - Customer index)&nbsp;</div></li><li><div> * RM4SCC is the name of the barcode symbology used by the Royal Mail for its Cleanmail service.&nbsp;</div></li><li><div> * @param $code (string) code to print&nbsp;</div></li><li><div> * @param $kix (boolean) if true prints the KIX variation (doesn't use the start and end symbols, and the checksum) - in this case the house number must be sufficed with an X and placed at the end of the code.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_rms4cc($code, $kix=false) {&nbsp;</div></li><li><div>    $notkix = !$kix;&nbsp;</div></li><li><div>    // bar mode&nbsp;</div></li><li><div>    // 1 = pos 1, length 2&nbsp;</div></li><li><div>    // 2 = pos 1, length 3&nbsp;</div></li><li><div>    // 3 = pos 2, length 1&nbsp;</div></li><li><div>    // 4 = pos 2, length 2&nbsp;</div></li><li><div>    $barmode = array(&nbsp;</div></li><li><div>        '0' =&gt; array(3, 3, 2, 2), &nbsp;</div></li><li><div>        '1' =&gt; array(3, 4, 1, 2), &nbsp;</div></li><li><div>        '2' =&gt; array(3, 4, 2, 1), &nbsp;</div></li><li><div>        '3' =&gt; array(4, 3, 1, 2), &nbsp;</div></li><li><div>        '4' =&gt; array(4, 3, 2, 1), &nbsp;</div></li><li><div>        '5' =&gt; array(4, 4, 1, 1), &nbsp;</div></li><li><div>        '6' =&gt; array(3, 1, 4, 2), &nbsp;</div></li><li><div>        '7' =&gt; array(3, 2, 3, 2), &nbsp;</div></li><li><div>        '8' =&gt; array(3, 2, 4, 1), &nbsp;</div></li><li><div>        '9' =&gt; array(4, 1, 3, 2), &nbsp;</div></li><li><div>        'A' =&gt; array(4, 1, 4, 1), &nbsp;</div></li><li><div>        'B' =&gt; array(4, 2, 3, 1), &nbsp;</div></li><li><div>        'C' =&gt; array(3, 1, 2, 4), &nbsp;</div></li><li><div>        'D' =&gt; array(3, 2, 1, 4), &nbsp;</div></li><li><div>        'E' =&gt; array(3, 2, 2, 3), &nbsp;</div></li><li><div>        'F' =&gt; array(4, 1, 1, 4), &nbsp;</div></li><li><div>        'G' =&gt; array(4, 1, 2, 3), &nbsp;</div></li><li><div>        'H' =&gt; array(4, 2, 1, 3), &nbsp;</div></li><li><div>        'I' =&gt; array(1, 3, 4, 2), &nbsp;</div></li><li><div>        'J' =&gt; array(1, 4, 3, 2), &nbsp;</div></li><li><div>        'K' =&gt; array(1, 4, 4, 1), &nbsp;</div></li><li><div>        'L' =&gt; array(2, 3, 3, 2), &nbsp;</div></li><li><div>        'M' =&gt; array(2, 3, 4, 1), &nbsp;</div></li><li><div>        'N' =&gt; array(2, 4, 3, 1), &nbsp;</div></li><li><div>        'O' =&gt; array(1, 3, 2, 4), &nbsp;</div></li><li><div>        'P' =&gt; array(1, 4, 1, 4), &nbsp;</div></li><li><div>        'Q' =&gt; array(1, 4, 2, 3), &nbsp;</div></li><li><div>        'R' =&gt; array(2, 3, 1, 4), &nbsp;</div></li><li><div>        'S' =&gt; array(2, 3, 2, 3), &nbsp;</div></li><li><div>        'T' =&gt; array(2, 4, 1, 3), &nbsp;</div></li><li><div>        'U' =&gt; array(1, 1, 4, 4), &nbsp;</div></li><li><div>        'V' =&gt; array(1, 2, 3, 4), &nbsp;</div></li><li><div>        'W' =&gt; array(1, 2, 4, 3), &nbsp;</div></li><li><div>        'X' =&gt; array(2, 1, 3, 4), &nbsp;</div></li><li><div>        'Y' =&gt; array(2, 1, 4, 3), &nbsp;</div></li><li><div>        'Z' =&gt; array(2, 2, 3, 3)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $code = strtoupper($code);&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 3, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    if ($notkix) {&nbsp;</div></li><li><div>        // table for checksum calculation (row, col)&nbsp;</div></li><li><div>        $checktable = array(&nbsp;</div></li><li><div>            '0' =&gt; array(1, 1), &nbsp;</div></li><li><div>            '1' =&gt; array(1, 2), &nbsp;</div></li><li><div>            '2' =&gt; array(1, 3), &nbsp;</div></li><li><div>            '3' =&gt; array(1, 4), &nbsp;</div></li><li><div>            '4' =&gt; array(1, 5), &nbsp;</div></li><li><div>            '5' =&gt; array(1, 0), &nbsp;</div></li><li><div>            '6' =&gt; array(2, 1), &nbsp;</div></li><li><div>            '7' =&gt; array(2, 2), &nbsp;</div></li><li><div>            '8' =&gt; array(2, 3), &nbsp;</div></li><li><div>            '9' =&gt; array(2, 4), &nbsp;</div></li><li><div>            'A' =&gt; array(2, 5), &nbsp;</div></li><li><div>            'B' =&gt; array(2, 0), &nbsp;</div></li><li><div>            'C' =&gt; array(3, 1), &nbsp;</div></li><li><div>            'D' =&gt; array(3, 2), &nbsp;</div></li><li><div>            'E' =&gt; array(3, 3), &nbsp;</div></li><li><div>            'F' =&gt; array(3, 4), &nbsp;</div></li><li><div>            'G' =&gt; array(3, 5), &nbsp;</div></li><li><div>            'H' =&gt; array(3, 0), &nbsp;</div></li><li><div>            'I' =&gt; array(4, 1), &nbsp;</div></li><li><div>            'J' =&gt; array(4, 2), &nbsp;</div></li><li><div>            'K' =&gt; array(4, 3), &nbsp;</div></li><li><div>            'L' =&gt; array(4, 4), &nbsp;</div></li><li><div>            'M' =&gt; array(4, 5), &nbsp;</div></li><li><div>            'N' =&gt; array(4, 0), &nbsp;</div></li><li><div>            'O' =&gt; array(5, 1), &nbsp;</div></li><li><div>            'P' =&gt; array(5, 2), &nbsp;</div></li><li><div>            'Q' =&gt; array(5, 3), &nbsp;</div></li><li><div>            'R' =&gt; array(5, 4), &nbsp;</div></li><li><div>            'S' =&gt; array(5, 5), &nbsp;</div></li><li><div>            'T' =&gt; array(5, 0), &nbsp;</div></li><li><div>            'U' =&gt; array(0, 1), &nbsp;</div></li><li><div>            'V' =&gt; array(0, 2), &nbsp;</div></li><li><div>            'W' =&gt; array(0, 3), &nbsp;</div></li><li><div>            'X' =&gt; array(0, 4), &nbsp;</div></li><li><div>            'Y' =&gt; array(0, 5), &nbsp;</div></li><li><div>            'Z' =&gt; array(0, 0)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $row = 0;&nbsp;</div></li><li><div>        $col = 0;&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>            $row += $checktable[$code{$i}][0];&nbsp;</div></li><li><div>            $col += $checktable[$code{$i}][1];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $row %= 6;&nbsp;</div></li><li><div>        $col %= 6;&nbsp;</div></li><li><div>        $chk = array_keys($checktable, array($row, $col));&nbsp;</div></li><li><div>        $code .= $chk[0];&nbsp;</div></li><li><div>        ++$len;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    if ($notkix) {&nbsp;</div></li><li><div>        // start bar&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 4; ++$j) {&nbsp;</div></li><li><div>            switch ($barmode[$code{$i}][$j]) {&nbsp;</div></li><li><div>                case 1: {&nbsp;</div></li><li><div>                    $p = 0;&nbsp;</div></li><li><div>                    $h = 2;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                case 2: {&nbsp;</div></li><li><div>                    $p = 0;&nbsp;</div></li><li><div>                    $h = 3;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                case 3: {&nbsp;</div></li><li><div>                    $p = 1;&nbsp;</div></li><li><div>                    $h = 1;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                case 4: {&nbsp;</div></li><li><div>                    $p = 1;&nbsp;</div></li><li><div>                    $h = 2;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; $h, 'p' =&gt; $p);&nbsp;</div></li><li><div>            $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += 2;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ($notkix) {&nbsp;</div></li><li><div>        // stop bar&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; 3, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * CODABAR barcodes.&nbsp;</div></li><li><div> * Older code often used in library systems, sometimes in blood banks&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_codabar($code) {&nbsp;</div></li><li><div>    $chr = array(&nbsp;</div></li><li><div>        '0' =&gt; '11111221', &nbsp;</div></li><li><div>        '1' =&gt; '11112211', &nbsp;</div></li><li><div>        '2' =&gt; '11121121', &nbsp;</div></li><li><div>        '3' =&gt; '22111111', &nbsp;</div></li><li><div>        '4' =&gt; '11211211', &nbsp;</div></li><li><div>        '5' =&gt; '21111211', &nbsp;</div></li><li><div>        '6' =&gt; '12111121', &nbsp;</div></li><li><div>        '7' =&gt; '12112111', &nbsp;</div></li><li><div>        '8' =&gt; '12211111', &nbsp;</div></li><li><div>        '9' =&gt; '21121111', &nbsp;</div></li><li><div>        '-' =&gt; '11122111', &nbsp;</div></li><li><div>        '$' =&gt; '11221111', &nbsp;</div></li><li><div>        ':' =&gt; '21112121', &nbsp;</div></li><li><div>        '/' =&gt; '21211121', &nbsp;</div></li><li><div>        '.' =&gt; '21212111', &nbsp;</div></li><li><div>        '+' =&gt; '11222221', &nbsp;</div></li><li><div>        'A' =&gt; '11221211', &nbsp;</div></li><li><div>        'B' =&gt; '12121121', &nbsp;</div></li><li><div>        'C' =&gt; '11121221', &nbsp;</div></li><li><div>        'D' =&gt; '11122211'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $w = 0;&nbsp;</div></li><li><div>    $seq = '';&nbsp;</div></li><li><div>    $code = 'A'.strtoupper($code).'A';&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        if (!isset($chr[$code{$i}])) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq = $chr[$code{$i}];&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 8; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $seq{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * CODE11 barcodes.&nbsp;</div></li><li><div> * Used primarily for labeling telecommunications equipment&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_code11($code) {&nbsp;</div></li><li><div>    $chr = array(&nbsp;</div></li><li><div>        '0' =&gt; '111121', &nbsp;</div></li><li><div>        '1' =&gt; '211121', &nbsp;</div></li><li><div>        '2' =&gt; '121121', &nbsp;</div></li><li><div>        '3' =&gt; '221111', &nbsp;</div></li><li><div>        '4' =&gt; '112121', &nbsp;</div></li><li><div>        '5' =&gt; '212111', &nbsp;</div></li><li><div>        '6' =&gt; '122111', &nbsp;</div></li><li><div>        '7' =&gt; '111221', &nbsp;</div></li><li><div>        '8' =&gt; '211211', &nbsp;</div></li><li><div>        '9' =&gt; '211111', &nbsp;</div></li><li><div>        '-' =&gt; '112111', &nbsp;</div></li><li><div>        'S' =&gt; '112211'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $w = 0;&nbsp;</div></li><li><div>    $seq = '';&nbsp;</div></li><li><div>    $len = strlen($code);&nbsp;</div></li><li><div>    // calculate check digit C&nbsp;</div></li><li><div>    $p = 1;&nbsp;</div></li><li><div>    $check = 0;&nbsp;</div></li><li><div>    for ($i = ($len - 1); $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>        $digit = $code{$i};&nbsp;</div></li><li><div>        if ($digit == '-') {&nbsp;</div></li><li><div>            $dval = 10;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $dval = intval($digit);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $check += ($dval * $p);&nbsp;</div></li><li><div>        ++$p;&nbsp;</div></li><li><div>        if ($p &gt; 10) {&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $check %= 11;&nbsp;</div></li><li><div>    if ($check == 10) {&nbsp;</div></li><li><div>        $check = '-';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $code .= $check;&nbsp;</div></li><li><div>    if ($len &gt; 10) {&nbsp;</div></li><li><div>        // calculate check digit K&nbsp;</div></li><li><div>        $p = 1;&nbsp;</div></li><li><div>        $check = 0;&nbsp;</div></li><li><div>        for ($i = $len; $i &gt;= 0; --$i) {&nbsp;</div></li><li><div>            $digit = $code{$i};&nbsp;</div></li><li><div>            if ($digit == '-') {&nbsp;</div></li><li><div>                $dval = 10;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $dval = intval($digit);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $check += ($dval * $p);&nbsp;</div></li><li><div>            ++$p;&nbsp;</div></li><li><div>            if ($p &gt; 9) {&nbsp;</div></li><li><div>                $p = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $check %= 11;&nbsp;</div></li><li><div>        $code .= $check;&nbsp;</div></li><li><div>        ++$len;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $code = 'S'.$code.'S';&nbsp;</div></li><li><div>    $len += 3;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        if (!isset($chr[$code{$i}])) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $seq = $chr[$code{$i}];&nbsp;</div></li><li><div>        for ($j = 0; $j &lt; 6; ++$j) {&nbsp;</div></li><li><div>            if (($j % 2) == 0) {&nbsp;</div></li><li><div>                $t = true; // bar&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $t = false; // space&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $w = $seq{$j};&nbsp;</div></li><li><div>            $bararray['bcode'][$k] = array('t' =&gt; $t, 'w' =&gt; $w, 'h' =&gt; 1, 'p' =&gt; 0);&nbsp;</div></li><li><div>            $bararray['maxw'] += $w;&nbsp;</div></li><li><div>            ++$k;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Pharmacode&nbsp;</div></li><li><div> * Contains digits (0 to 9)&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_pharmacode($code) {&nbsp;</div></li><li><div>    $seq = '';&nbsp;</div></li><li><div>    $code = intval($code);&nbsp;</div></li><li><div>    while ($code &gt; 0) {&nbsp;</div></li><li><div>        if (($code % 2) == 0) {&nbsp;</div></li><li><div>            $seq .= '11100';&nbsp;</div></li><li><div>            $code -= 2;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $seq .= '100';&nbsp;</div></li><li><div>            $code -= 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $code /= 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $seq = substr($seq, 0, -2);&nbsp;</div></li><li><div>    $seq = strrev($seq);&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 1, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    return $this-&gt;binseq_to_array($seq, $bararray);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Pharmacode two-track&nbsp;</div></li><li><div> * Contains digits (0 to 9)&nbsp;</div></li><li><div> * @param $code (string) code to represent.&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_pharmacode2t($code) {&nbsp;</div></li><li><div>    $seq = '';&nbsp;</div></li><li><div>    $code = intval($code);&nbsp;</div></li><li><div>    do {&nbsp;</div></li><li><div>        switch ($code % 3) {&nbsp;</div></li><li><div>            case 0: {&nbsp;</div></li><li><div>                $seq .= '3';&nbsp;</div></li><li><div>                $code = ($code - 3) / 3;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            case 1: {&nbsp;</div></li><li><div>                $seq .= '1';&nbsp;</div></li><li><div>                $code = ($code - 1) / 3;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            case 2: {&nbsp;</div></li><li><div>                $seq .= '2';&nbsp;</div></li><li><div>                $code = ($code - 2) / 3;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    } while($code != 0);&nbsp;</div></li><li><div>    $seq = strrev($seq);&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 2, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    $len = strlen($seq);&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $len; ++$i) {&nbsp;</div></li><li><div>        switch ($seq{$i}) {&nbsp;</div></li><li><div>            case '1': {&nbsp;</div></li><li><div>                $p = 1;&nbsp;</div></li><li><div>                $h = 1;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            case '2': {&nbsp;</div></li><li><div>                $p = 0;&nbsp;</div></li><li><div>                $h = 1;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            case '3': {&nbsp;</div></li><li><div>                $p = 0;&nbsp;</div></li><li><div>                $h = 2;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; $h, 'p' =&gt; $p);&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    unset($bararray['bcode'][($k - 1)]);&nbsp;</div></li><li><div>    --$bararray['maxw'];&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * IMB - Intelligent Mail Barcode - Onecode - USPS-B-3200&nbsp;</div></li><li><div> * (requires PHP bcmath extension)&nbsp;</div></li><li><div> * Intelligent Mail barcode is a 65-bar code for use on mail in the United States.&nbsp;</div></li><li><div> * The fields are described as follows:&lt;ul&gt;&lt;li&gt;The Barcode Identifier shall be assigned by USPS to encode the presort identification that is currently printed in human readable form on the optional endorsement line (OEL) as well as for future USPS use. This shall be two digits, with the second digit in the range of 0*4. The allowable encoding ranges shall be 00*04, 10*14, 20*24, 30*34, 40*44, 50*54, 60*64, 70*74, 80*84, and 90*94.&lt;/li&gt;&lt;li&gt;The Service Type Identifier shall be assigned by USPS for any combination of services requested on the mailpiece. The allowable encoding range shall be 000http://it2.php.net/manual/en/function.dechex.php*999. Each 3-digit value shall correspond to a particular mail class with a particular combination of service(s). Each service program, such as OneCode Confirm and OneCode ACS, shall provide the list of Service Type Identifier values.&lt;/li&gt;&lt;li&gt;The Mailer or Customer Identifier shall be assigned by USPS as a unique, 6 or 9 digit number that identifies a business entity. The allowable encoding range for the 6 digit Mailer ID shall be 000000- 899999, while the allowable encoding range for the 9 digit Mailer ID shall be 900000000-999999999.&lt;/li&gt;&lt;li&gt;The Serial or Sequence Number shall be assigned by the mailer for uniquely identifying and tracking mailpieces. The allowable encoding range shall be 000000000*999999999 when used with a 6 digit Mailer ID and 000000-999999 when used with a 9 digit Mailer ID. e. The Delivery Point ZIP Code shall be assigned by the mailer for routing the mailpiece. This shall replace POSTNET for routing the mailpiece to its final delivery point. The length may be 0, 5, 9, or 11 digits. The allowable encoding ranges shall be no ZIP Code, 00000*99999, 000000000*999999999, and 00000000000*99999999999.&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div> * @param $code (string) code to print, separate the ZIP (routing code) from the rest using a minus char '-' (BarcodeID_ServiceTypeID_MailerID_SerialNumber-RoutingCode)&nbsp;</div></li><li><div> * @return array barcode representation.&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function barcode_imb($code) {&nbsp;</div></li><li><div>    $asc_chr = array(4, 0, 2, 6, 3, 5, 1, 9, 8, 7, 1, 2, 0, 6, 4, 8, 2, 9, 5, 3, 0, 1, 3, 7, 4, 6, 8, 9, 2, 0, 5, 1, 9, 4, 3, 8, 6, 7, 1, 2, 4, 3, 9, 5, 7, 8, 3, 0, 2, 1, 4, 0, 9, 1, 7, 0, 2, 4, 6, 3, 7, 1, 9, 5, 8);&nbsp;</div></li><li><div>    $dsc_chr = array(7, 1, 9, 5, 8, 0, 2, 4, 6, 3, 5, 8, 9, 7, 3, 0, 6, 1, 7, 4, 6, 8, 9, 2, 5, 1, 7, 5, 4, 3, 8, 7, 6, 0, 2, 5, 4, 9, 3, 0, 1, 6, 8, 2, 0, 4, 5, 9, 6, 7, 5, 2, 6, 3, 8, 5, 1, 9, 8, 7, 4, 0, 2, 6, 3);&nbsp;</div></li><li><div>    $asc_pos = array(3, 0, 8, 11, 1, 12, 8, 11, 10, 6, 4, 12, 2, 7, 9, 6, 7, 9, 2, 8, 4, 0, 12, 7, 10, 9, 0, 7, 10, 5, 7, 9, 6, 8, 2, 12, 1, 4, 2, 0, 1, 5, 4, 6, 12, 1, 0, 9, 4, 7, 5, 10, 2, 6, 9, 11, 2, 12, 6, 7, 5, 11, 0, 3, 2);&nbsp;</div></li><li><div>    $dsc_pos = array(2, 10, 12, 5, 9, 1, 5, 4, 3, 9, 11, 5, 10, 1, 6, 3, 4, 1, 10, 0, 2, 11, 8, 6, 1, 12, 3, 8, 6, 4, 4, 11, 0, 6, 1, 9, 11, 5, 3, 7, 3, 10, 7, 11, 8, 2, 10, 3, 5, 8, 0, 3, 12, 11, 8, 4, 5, 1, 3, 0, 7, 12, 9, 8, 10);&nbsp;</div></li><li><div>    $code_arr = explode('-', $code);&nbsp;</div></li><li><div>    $tracking_number = $code_arr[0];&nbsp;</div></li><li><div>    if (isset($code_arr[1])) {&nbsp;</div></li><li><div>        $routing_code = $code_arr[1];&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>        $routing_code = '';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // Conversion of Routing Code&nbsp;</div></li><li><div>    switch (strlen($routing_code)) {&nbsp;</div></li><li><div>        case 0: {&nbsp;</div></li><li><div>            $binary_code = 0;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 5: {&nbsp;</div></li><li><div>            $binary_code = bcadd($routing_code, '1');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 9: {&nbsp;</div></li><li><div>            $binary_code = bcadd($routing_code, '100001');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        case 11: {&nbsp;</div></li><li><div>            $binary_code = bcadd($routing_code, '1000100001');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        default: {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $binary_code = bcmul($binary_code, 10);&nbsp;</div></li><li><div>    $binary_code = bcadd($binary_code, $tracking_number[0]);&nbsp;</div></li><li><div>    $binary_code = bcmul($binary_code, 5);&nbsp;</div></li><li><div>    $binary_code = bcadd($binary_code, $tracking_number[1]);&nbsp;</div></li><li><div>    $binary_code .= substr($tracking_number, 2, 18);&nbsp;</div></li><li><div>    // convert to hexadecimal&nbsp;</div></li><li><div>    $binary_code = $this-&gt;dec_to_hex($binary_code);&nbsp;</div></li><li><div>    // pad to get 13 bytes&nbsp;</div></li><li><div>    $binary_code = str_pad($binary_code, 26, '0', STR_PAD_LEFT);&nbsp;</div></li><li><div>    // convert string to array of bytes&nbsp;</div></li><li><div>    $binary_code_arr = chunk_split($binary_code, 2, &quot;\r&quot;);&nbsp;</div></li><li><div>    $binary_code_arr = substr($binary_code_arr, 0, -1);&nbsp;</div></li><li><div>    $binary_code_arr = explode(&quot;\r&quot;, $binary_code_arr);&nbsp;</div></li><li><div>    // calculate frame check sequence&nbsp;</div></li><li><div>    $fcs = $this-&gt;imb_crc11fcs($binary_code_arr);&nbsp;</div></li><li><div>    // exclude first 2 bits from first byte&nbsp;</div></li><li><div>    $first_byte = sprintf('%2s', dechex((hexdec($binary_code_arr[0]) &lt;&lt; 2) &gt;&gt; 2));&nbsp;</div></li><li><div>    $binary_code_102bit = $first_byte.substr($binary_code, 2);&nbsp;</div></li><li><div>    // convert binary data to codewords&nbsp;</div></li><li><div>    $codewords = array();&nbsp;</div></li><li><div>    $data = $this-&gt;hex_to_dec($binary_code_102bit);&nbsp;</div></li><li><div>    $codewords[0] = bcmod($data, 636) * 2;&nbsp;</div></li><li><div>    $data = bcdiv($data, 636);&nbsp;</div></li><li><div>    for ($i = 1; $i &lt; 9; ++$i) {&nbsp;</div></li><li><div>        $codewords[$i] = bcmod($data, 1365);&nbsp;</div></li><li><div>        $data = bcdiv($data, 1365);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $codewords[9] = $data;&nbsp;</div></li><li><div>    if (($fcs &gt;&gt; 10) == 1) {&nbsp;</div></li><li><div>        $codewords[9] += 659;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // generate lookup tables&nbsp;</div></li><li><div>    $table2of13 = $this-&gt;imb_tables(2, 78);&nbsp;</div></li><li><div>    $table5of13 = $this-&gt;imb_tables(5, 1287);&nbsp;</div></li><li><div>    // convert codewords to characters&nbsp;</div></li><li><div>    $characters = array();&nbsp;</div></li><li><div>    $bitmask = 512;&nbsp;</div></li><li><div>    foreach($codewords as $k =&gt; $val) {&nbsp;</div></li><li><div>        if ($val &lt;= 1286) {&nbsp;</div></li><li><div>            $chrcode = $table5of13[$val];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $chrcode = $table2of13[($val - 1287)];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (($fcs & $bitmask) &gt; 0) {&nbsp;</div></li><li><div>            // bitwise invert&nbsp;</div></li><li><div>            $chrcode = ((~$chrcode) & 8191);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $characters[] = $chrcode;&nbsp;</div></li><li><div>        $bitmask /= 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $characters = array_reverse($characters);&nbsp;</div></li><li><div>    // build bars&nbsp;</div></li><li><div>    $k = 0;&nbsp;</div></li><li><div>    $bararray = array('code' =&gt; $code, 'maxw' =&gt; 0, 'maxh' =&gt; 3, 'bcode' =&gt; array());&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; 65; ++$i) {&nbsp;</div></li><li><div>        $asc = (($characters[$asc_chr[$i]] & pow(2, $asc_pos[$i])) &gt; 0);&nbsp;</div></li><li><div>        $dsc = (($characters[$dsc_chr[$i]] & pow(2, $dsc_pos[$i])) &gt; 0);&nbsp;</div></li><li><div>        if ($asc AND $dsc) {&nbsp;</div></li><li><div>            // full bar (F)&nbsp;</div></li><li><div>            $p = 0;&nbsp;</div></li><li><div>            $h = 3;&nbsp;</div></li><li><div>        } elseif ($asc) {&nbsp;</div></li><li><div>            // ascender (A)&nbsp;</div></li><li><div>            $p = 0;&nbsp;</div></li><li><div>            $h = 2;&nbsp;</div></li><li><div>        } elseif ($dsc) {&nbsp;</div></li><li><div>            // descender (D)&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>            $h = 2;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // tracker (T)&nbsp;</div></li><li><div>            $p = 1;&nbsp;</div></li><li><div>            $h = 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 1, 'w' =&gt; 1, 'h' =&gt; $h, 'p' =&gt; $p);&nbsp;</div></li><li><div>        $bararray['bcode'][$k++] = array('t' =&gt; 0, 'w' =&gt; 1, 'h' =&gt; 2, 'p' =&gt; 0);&nbsp;</div></li><li><div>        $bararray['maxw'] += 2;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    unset($bararray['bcode'][($k - 1)]);&nbsp;</div></li><li><div>    --$bararray['maxw'];&nbsp;</div></li><li><div>    return $bararray;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Convert large integer number to hexadecimal representation.&nbsp;</div></li><li><div> * (requires PHP bcmath extension)&nbsp;</div></li><li><div> * @param $number (string) number to convert specified as a string&nbsp;</div></li><li><div> * @return string hexadecimal representation&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function dec_to_hex($number) {&nbsp;</div></li><li><div>    $i = 0;&nbsp;</div></li><li><div>    $hex = array();&nbsp;</div></li><li><div>    if($number == 0) {&nbsp;</div></li><li><div>        return '00';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    while($number &gt; 0) {&nbsp;</div></li><li><div>        if($number == 0) {&nbsp;</div></li><li><div>            array_push($hex, '0');&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            array_push($hex, strtoupper(dechex(bcmod($number, '16'))));&nbsp;</div></li><li><div>            $number = bcdiv($number, '16', 0);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $hex = array_reverse($hex);&nbsp;</div></li><li><div>    return implode($hex);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Convert large hexadecimal number to decimal representation (string).&nbsp;</div></li><li><div> * (requires PHP bcmath extension)&nbsp;</div></li><li><div> * @param $hex (string) hexadecimal number to convert specified as a string&nbsp;</div></li><li><div> * @return string hexadecimal representation&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>public function hex_to_dec($hex) {&nbsp;</div></li><li><div>    $dec = 0;&nbsp;</div></li><li><div>    $bitval = 1;&nbsp;</div></li><li><div>    $len = strlen($hex);&nbsp;</div></li><li><div>    for($pos = ($len - 1); $pos &gt;= 0; --$pos) {&nbsp;</div></li><li><div>        $dec = bcadd($dec, bcmul(hexdec($hex{$pos}), $bitval));&nbsp;</div></li><li><div>        $bitval = bcmul($bitval, 16);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $dec;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Intelligent Mail Barcode calculation of Frame Check Sequence&nbsp;</div></li><li><div> * @param $code_arr (string) array of hexadecimal values (13 bytes holding 102 bits right justified).&nbsp;</div></li><li><div> * @return int 11 bit Frame Check Sequence as integer (decimal base)&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function imb_crc11fcs($code_arr) {&nbsp;</div></li><li><div>    $genpoly = 0x0F35; // generator polynomial&nbsp;</div></li><li><div>    $fcs = 0x07FF; // Frame Check Sequence&nbsp;</div></li><li><div>    // do most significant byte skipping the 2 most significant bits&nbsp;</div></li><li><div>    $data = hexdec($code_arr[0]) &lt;&lt; 5;&nbsp;</div></li><li><div>    for ($bit = 2; $bit &lt; 8; ++$bit) {&nbsp;</div></li><li><div>        if (($fcs ^ $data) & 0x400) {&nbsp;</div></li><li><div>            $fcs = ($fcs &lt;&lt; 1) ^ $genpoly;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $fcs = ($fcs &lt;&lt; 1);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $fcs &= 0x7FF;&nbsp;</div></li><li><div>        $data &lt;&lt;= 1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    // do rest of bytes&nbsp;</div></li><li><div>    for ($byte = 1; $byte &lt; 13; ++$byte) {&nbsp;</div></li><li><div>        $data = hexdec($code_arr[$byte]) &lt;&lt; 3;&nbsp;</div></li><li><div>        for ($bit = 0; $bit &lt; 8; ++$bit) {&nbsp;</div></li><li><div>            if (($fcs ^ $data) & 0x400) {&nbsp;</div></li><li><div>                $fcs = ($fcs &lt;&lt; 1) ^ $genpoly;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $fcs = ($fcs &lt;&lt; 1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $fcs &= 0x7FF;&nbsp;</div></li><li><div>            $data &lt;&lt;= 1;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $fcs;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * Reverse unsigned short value&nbsp;</div></li><li><div> * @param $num (int) value to reversr&nbsp;</div></li><li><div> * @return int reversed value&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function imb_reverse_us($num) {&nbsp;</div></li><li><div>    $rev = 0;&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; 16; ++$i) {&nbsp;</div></li><li><div>        $rev &lt;&lt;= 1;&nbsp;</div></li><li><div>        $rev |= ($num & 1);&nbsp;</div></li><li><div>        $num &gt;&gt;= 1;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $rev;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>/**&nbsp;</div></li><li><div> * generate Nof13 tables used for Intelligent Mail Barcode&nbsp;</div></li><li><div> * @param $n (int) is the type of table: 2 for 2of13 table, 5 for 5of13table&nbsp;</div></li><li><div> * @param $size (int) size of table (78 for n=2 and 1287 for n=5)&nbsp;</div></li><li><div> * @return array requested table&nbsp;</div></li><li><div> * @protected&nbsp;</div></li><li><div> */&nbsp;</div></li><li><div>protected function imb_tables($n, $size) {&nbsp;</div></li><li><div>    $table = array();&nbsp;</div></li><li><div>    $lli = 0; // LUT lower index&nbsp;</div></li><li><div>    $lui = $size - 1; // LUT upper index&nbsp;</div></li><li><div>    for ($count = 0; $count &lt; 8192; ++$count) {&nbsp;</div></li><li><div>        $bit_count = 0;&nbsp;</div></li><li><div>        for ($bit_index = 0; $bit_index &lt; 13; ++$bit_index) {&nbsp;</div></li><li><div>            $bit_count += intval(($count & (1 &lt;&lt; $bit_index)) != 0);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // if we don't have the right number of bits on, go on to the next value&nbsp;</div></li><li><div>        if ($bit_count == $n) {&nbsp;</div></li><li><div>            $reverse = ($this-&gt;imb_reverse_us($count) &gt;&gt; 3);&nbsp;</div></li><li><div>            // if the reverse is less than count, we have already visited this pair before&nbsp;</div></li><li><div>            if ($reverse &gt;= $count) {&nbsp;</div></li><li><div>                // If count is symmetric, place it at the first free slot from the end of the list.&nbsp;</div></li><li><div>                // Otherwise, place it at the first free slot from the beginning of the list AND place $reverse ath the next free slot from the beginning of the list&nbsp;</div></li><li><div>                if ($reverse == $count) {&nbsp;</div></li><li><div>                    $table[$lui] = $count;&nbsp;</div></li><li><div>                    --$lui;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $table[$lli] = $count;&nbsp;</div></li><li><div>                    ++$lli;&nbsp;</div></li><li><div>                    $table[$lli] = $reverse;&nbsp;</div></li><li><div>                    ++$lli;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/woocommerce-products-designer/2.3/classes/tcpdfbarcode/" class="active">2.3</a></li><li><a href="http://hookr.io/plugins/woocommerce-products-designer/2.2/classes/tcpdfbarcode/" class="">2.2</a></li><li><a href="http://hookr.io/plugins/woocommerce-products-designer/2.1/classes/tcpdfbarcode/" class="">2.1</a></li><li><a href="http://hookr.io/plugins/woocommerce-products-designer/2.0/classes/tcpdfbarcode/" class="">2.0</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>TCPDFBarcode</li><li><span></span>Woocommerce Products Designer</li><li><span></span>2.3</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>