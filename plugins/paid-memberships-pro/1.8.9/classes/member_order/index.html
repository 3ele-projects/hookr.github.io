<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="1.8.9" data-slug="paid-memberships-pro" data-type="class" data-id="74094"><head xmlns="http://www.w3.org/1999/xhtml"><title> memberorder | class | Paid Memberships Pro | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="MemberOrder, class, plugin, paid-memberships-pro, 1.8.9" /><meta name="description" content="The Paid Memberships Pro MemberOrder class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=2f10b6c7e7c99b68e1598bdbfbcd2402' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/member_order/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fmember_order%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fmember_order%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-paid-memberships-pro-1.8.9-class-member_order","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="member_order" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to paid-memberships-pro." href="http://hookr.io/plugins/paid-memberships-pro/" class="plugin"><span property="name">paid-memberships-pro</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.8.9." href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/" class="H_VERSION"><span property="name">1.8.9</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">member_order</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="773"><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/all/" title="All">All <span class="count badge">773</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="342"><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/hooks/" title="Hooks">Hooks <span class="count badge">342</span></a></li><li class="" data-id="action" data-count="83"><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/actions/" title="Actions">Actions <span class="count badge">83</span></a></li><li class="" data-id="filter" data-count="259"><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/filters/" title="Filters">Filters <span class="count badge">259</span></a></li><li class="active" data-id="class" data-count="130"><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/classes/" title="Classes">Classes <span class="count badge">130</span></a></li><li class="" data-id="constant" data-count="24"><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/constants/" title="Constants">Constants <span class="count badge">24</span></a></li><li class="" data-id="function" data-count="272"><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/functions/" title="Functions">Functions <span class="count badge">272</span></a></li><li class="" data-id="shortcode" data-count="5"><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">5</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>MemberOrder</strong></h1><p>The Paid Memberships Pro <strong>MemberOrder</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/files/classes-class-memberorder/" class="file">/classes/class.memberorder.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="2" class="block" start="2"><li><div>class MemberOrder&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __construct($id = NULL)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        //set up the gateway&nbsp;</div></li><li><div>        $this-&gt;setGateway(pmpro_getOption(&quot;gateway&quot;));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //get data if an id was passed&nbsp;</div></li><li><div>        if($id)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(is_numeric($id))&nbsp;</div></li><li><div>                return $this-&gt;getMemberOrderByID($id);&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                return $this-&gt;getMemberOrderByCode($id);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return $this-&gt;getEmptyMemberOrder();    //blank constructor&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns an empty (but complete) order object.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return stdClass $order - a 'clean' order object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since: 1.8.6.8&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getEmptyMemberOrder()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //defaults&nbsp;</div></li><li><div>        $order = new stdClass();&nbsp;</div></li><li><div>        $order-&gt;code = $this-&gt;getRandomCode();&nbsp;</div></li><li><div>        $order-&gt;user_id = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;membership_id = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;subtotal = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;tax = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;couponamount = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;total = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;payment_type = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;cardtype = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;accountnumber = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;expirationmonth = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;expirationyear = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;status = &quot;success&quot;;&nbsp;</div></li><li><div>        $order-&gt;gateway = pmpro_getOption(&quot;gateway&quot;);&nbsp;</div></li><li><div>        $order-&gt;gateway_environment = pmpro_getOption(&quot;gateway_environment&quot;);&nbsp;</div></li><li><div>        $order-&gt;payment_transaction_id = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;subscription_transaction_id = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;affiliate_id = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;affiliate_subid = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;notes = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $order-&gt;billing = new stdClass();&nbsp;</div></li><li><div>        $order-&gt;billing-&gt;name = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;billing-&gt;street = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;billing-&gt;city = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;billing-&gt;state = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;billing-&gt;zip = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;billing-&gt;country = &quot;&quot;;&nbsp;</div></li><li><div>        $order-&gt;billing-&gt;phone = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $order;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a member order from the DB by ID&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getMemberOrderByID($id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!$id)&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $gmt_offset = get_option('gmt_offset');&nbsp;</div></li><li><div>        $dbobj = $wpdb-&gt;get_row(&quot;SELECT *, UNIX_TIMESTAMP(timestamp) + &quot; . ($gmt_offset * 3600) . &quot;  as timestamp FROM $wpdb-&gt;pmpro_membership_orders WHERE id = '$id' LIMIT 1&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($dbobj)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;id = $dbobj-&gt;id;&nbsp;</div></li><li><div>            $this-&gt;code = $dbobj-&gt;code;&nbsp;</div></li><li><div>            $this-&gt;session_id = $dbobj-&gt;session_id;&nbsp;</div></li><li><div>            $this-&gt;user_id = $dbobj-&gt;user_id;&nbsp;</div></li><li><div>            $this-&gt;membership_id = $dbobj-&gt;membership_id;&nbsp;</div></li><li><div>            $this-&gt;paypal_token = $dbobj-&gt;paypal_token;&nbsp;</div></li><li><div>            $this-&gt;billing = new stdClass();&nbsp;</div></li><li><div>            $this-&gt;billing-&gt;name = $dbobj-&gt;billing_name;&nbsp;</div></li><li><div>            $this-&gt;billing-&gt;street = $dbobj-&gt;billing_street;&nbsp;</div></li><li><div>            $this-&gt;billing-&gt;city = $dbobj-&gt;billing_city;&nbsp;</div></li><li><div>            $this-&gt;billing-&gt;state = $dbobj-&gt;billing_state;&nbsp;</div></li><li><div>            $this-&gt;billing-&gt;zip = $dbobj-&gt;billing_zip;&nbsp;</div></li><li><div>            $this-&gt;billing-&gt;country = $dbobj-&gt;billing_country;&nbsp;</div></li><li><div>            $this-&gt;billing-&gt;phone = $dbobj-&gt;billing_phone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //split up some values&nbsp;</div></li><li><div>            $nameparts = pnp_split_full_name($this-&gt;billing-&gt;name);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(!empty($nameparts['fname']))&nbsp;</div></li><li><div>                $this-&gt;FirstName = $nameparts['fname'];&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $this-&gt;FirstName = &quot;&quot;;&nbsp;</div></li><li><div>            if(!empty($nameparts['lname']))&nbsp;</div></li><li><div>                $this-&gt;LastName = $nameparts['lname'];&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $this-&gt;LastName = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;Address1 = $this-&gt;billing-&gt;street;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //get email from user_id&nbsp;</div></li><li><div>            $this-&gt;Email = $wpdb-&gt;get_var(&quot;SELECT user_email FROM $wpdb-&gt;users WHERE ID = '&quot; . $this-&gt;user_id . &quot;' LIMIT 1&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;subtotal = $dbobj-&gt;subtotal;&nbsp;</div></li><li><div>            $this-&gt;tax = $dbobj-&gt;tax;&nbsp;</div></li><li><div>            $this-&gt;couponamount = $dbobj-&gt;couponamount;&nbsp;</div></li><li><div>            $this-&gt;certificate_id = $dbobj-&gt;certificate_id;&nbsp;</div></li><li><div>            $this-&gt;certificateamount = $dbobj-&gt;certificateamount;&nbsp;</div></li><li><div>            $this-&gt;total = $dbobj-&gt;total;&nbsp;</div></li><li><div>            $this-&gt;payment_type = $dbobj-&gt;payment_type;&nbsp;</div></li><li><div>            $this-&gt;cardtype = $dbobj-&gt;cardtype;&nbsp;</div></li><li><div>            $this-&gt;accountnumber = trim($dbobj-&gt;accountnumber);&nbsp;</div></li><li><div>            $this-&gt;expirationmonth = $dbobj-&gt;expirationmonth;&nbsp;</div></li><li><div>            $this-&gt;expirationyear = $dbobj-&gt;expirationyear;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //date formats sometimes useful&nbsp;</div></li><li><div>            $this-&gt;ExpirationDate = $this-&gt;expirationmonth . $this-&gt;expirationyear;&nbsp;</div></li><li><div>            $this-&gt;ExpirationDate_YdashM = $this-&gt;expirationyear . &quot;-&quot; . $this-&gt;expirationmonth;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;status = $dbobj-&gt;status;&nbsp;</div></li><li><div>            $this-&gt;gateway = $dbobj-&gt;gateway;&nbsp;</div></li><li><div>            $this-&gt;gateway_environment = $dbobj-&gt;gateway_environment;&nbsp;</div></li><li><div>            $this-&gt;payment_transaction_id = $dbobj-&gt;payment_transaction_id;&nbsp;</div></li><li><div>            $this-&gt;subscription_transaction_id = $dbobj-&gt;subscription_transaction_id;&nbsp;</div></li><li><div>            $this-&gt;timestamp = $dbobj-&gt;timestamp;&nbsp;</div></li><li><div>            $this-&gt;affiliate_id = $dbobj-&gt;affiliate_id;&nbsp;</div></li><li><div>            $this-&gt;affiliate_subid = $dbobj-&gt;affiliate_subid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;notes = $dbobj-&gt;notes;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //reset the gateway&nbsp;</div></li><li><div>            if(empty($this-&gt;nogateway))&nbsp;</div></li><li><div>                $this-&gt;setGateway();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $this-&gt;id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;    //didn't find it in the DB&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set up the Gateway class to use with this order.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $gateway Name/label for the gateway to set.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function setGateway($gateway = NULL)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        //set the gateway property&nbsp;</div></li><li><div>        if(isset($gateway))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;gateway = $gateway;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //which one to load?&nbsp;</div></li><li><div>        $classname = &quot;PMProGateway&quot;;    //default test gateway&nbsp;</div></li><li><div>        if(!empty($this-&gt;gateway) && $this-&gt;gateway != &quot;free&quot;)&nbsp;</div></li><li><div>            $classname .= &quot;_&quot; . $this-&gt;gateway;    //adding the gateway suffix&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(class_exists($classname))&nbsp;</div></li><li><div>            $this-&gt;Gateway = new $classname($this-&gt;gateway);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $error = new WP_Error(&quot;PMPro1001&quot;, &quot;Could not locate the gateway class file with class name = &quot; . $classname . &quot;.&quot;);&nbsp;</div></li><li><div>            //die(&quot;Could not locate the gateway class file with class name = &quot; . $classname . &quot;.&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;Gateway;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the most recent order for a user.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $user_id ID of user to find order for.&nbsp;</div></li><li><div>     * @param string $status Limit search to only orders with this status. Defaults to &quot;success&quot;.&nbsp;</div></li><li><div>     * @param id $membership_id Limit search to only orders for this membership level. Defaults to NULL to find orders for any level.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getLastMemberOrder($user_id = NULL, $status = 'success', $membership_id = NULL)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $current_user, $wpdb;&nbsp;</div></li><li><div>        if(!$user_id)&nbsp;</div></li><li><div>            $user_id = $current_user-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!$user_id)&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //build query&nbsp;</div></li><li><div>        $this-&gt;sqlQuery = &quot;SELECT id FROM $wpdb-&gt;pmpro_membership_orders WHERE user_id = '&quot; . $user_id . &quot;' &quot;;&nbsp;</div></li><li><div>        if(!empty($status) && is_array($status))&nbsp;</div></li><li><div>            $this-&gt;sqlQuery .= &quot;AND status IN('&quot; . implode(&quot;', '&quot;, $status) . &quot;') &quot;;&nbsp;</div></li><li><div>        elseif(!empty($status))&nbsp;</div></li><li><div>            $this-&gt;sqlQuery .= &quot;AND status = '&quot; . esc_sql($status) . &quot;' &quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!empty($membership_id))&nbsp;</div></li><li><div>            $this-&gt;sqlQuery .= &quot;AND membership_id = '&quot; . $membership_id . &quot;' &quot;;&nbsp;</div></li><li><div>        $this-&gt;sqlQuery .= &quot;ORDER BY timestamp DESC LIMIT 1&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //get id&nbsp;</div></li><li><div>        $id = $wpdb-&gt;get_var($this-&gt;sqlQuery);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;getMemberOrderByID($id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>        Returns the order using the given order code.&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function getMemberOrderByCode($code)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $id = $wpdb-&gt;get_var(&quot;SELECT id FROM $wpdb-&gt;pmpro_membership_orders WHERE code = '&quot; . $code . &quot;' LIMIT 1&quot;);&nbsp;</div></li><li><div>        if($id)&nbsp;</div></li><li><div>            return $this-&gt;getMemberOrderByID($id);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>        Returns the last order using the given payment_transaction_id.&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function getMemberOrderByPaymentTransactionID($payment_transaction_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        //did they pass a trans id?&nbsp;</div></li><li><div>        if(empty($payment_transaction_id))&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $id = $wpdb-&gt;get_var(&quot;SELECT id FROM $wpdb-&gt;pmpro_membership_orders WHERE payment_transaction_id = '&quot; . esc_sql($payment_transaction_id) . &quot;' LIMIT 1&quot;);&nbsp;</div></li><li><div>        if($id)&nbsp;</div></li><li><div>            return $this-&gt;getMemberOrderByID($id);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the last order using the given subscription_transaction_id.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getLastMemberOrderBySubscriptionTransactionID($subscription_transaction_id)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        //did they pass a sub id?&nbsp;</div></li><li><div>        if(empty($subscription_transaction_id))&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $id = $wpdb-&gt;get_var(&quot;SELECT id FROM $wpdb-&gt;pmpro_membership_orders WHERE subscription_transaction_id = '&quot; . esc_sql($subscription_transaction_id) . &quot;' ORDER BY id DESC LIMIT 1&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($id)&nbsp;</div></li><li><div>            return $this-&gt;getMemberOrderByID($id);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the last order using the given paypal token.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getMemberOrderByPayPalToken($token)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $id = $wpdb-&gt;get_var(&quot;SELECT id FROM $wpdb-&gt;pmpro_membership_orders WHERE paypal_token = '&quot; . $token . &quot;' LIMIT 1&quot;);&nbsp;</div></li><li><div>        if($id)&nbsp;</div></li><li><div>            return $this-&gt;getMemberOrderByID($id);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a discount code object for the code used in this order.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool $force If true, it will query the database again.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getDiscountCode($force = false)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if(!empty($this-&gt;discount_code) && !$force)&nbsp;</div></li><li><div>            return $this-&gt;discount_code;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $this-&gt;discount_code = $wpdb-&gt;get_row(&quot;SELECT dc.* FROM $wpdb-&gt;pmpro_discount_codes dc LEFT JOIN $wpdb-&gt;pmpro_discount_codes_uses dcu ON dc.id = dcu.code_id WHERE dcu.order_id = '&quot; . $this-&gt;id . &quot;' LIMIT 1&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //filter @since v1.7.14&nbsp;</div></li><li><div>        $this-&gt;discount_code = apply_filters(&quot;pmpro_order_discount_code&quot;, $this-&gt;discount_code, $this);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;discount_code;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a user object for the user associated with this order.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getUser()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!empty($this-&gt;user))&nbsp;</div></li><li><div>            return $this-&gt;user;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $gmt_offset = get_option('gmt_offset');&nbsp;</div></li><li><div>        $this-&gt;user = $wpdb-&gt;get_row(&quot;SELECT *, UNIX_TIMESTAMP(user_registered) + &quot; . ($gmt_offset * 3600) . &quot;  as user_registered FROM $wpdb-&gt;users WHERE ID = '&quot; . $this-&gt;user_id . &quot;' LIMIT 1&quot;);&nbsp;</div></li><li><div>        return $this-&gt;user;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a membership level object for the level associated with this order.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool $force If true, it will query the database again.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getMembershipLevel($force = false)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!empty($this-&gt;membership_level) && empty($force))&nbsp;</div></li><li><div>            return $this-&gt;membership_level;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //check if there is an entry in memberships_users first&nbsp;</div></li><li><div>        if(!empty($this-&gt;user_id))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;membership_level = $wpdb-&gt;get_row(&quot;SELECT l.id as level_id, l.name, l.description, l.allow_signups, l.expiration_number, l.expiration_period, mu.*, UNIX_TIMESTAMP(mu.startdate) as startdate, UNIX_TIMESTAMP(mu.enddate) as enddate, l.name, l.description, l.allow_signups FROM $wpdb-&gt;pmpro_membership_levels l LEFT JOIN $wpdb-&gt;pmpro_memberships_users mu ON l.id = mu.membership_id WHERE mu.status = 'active' AND l.id = '&quot; . $this-&gt;membership_id . &quot;' AND mu.user_id = '&quot; . $this-&gt;user_id . &quot;' LIMIT 1&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //fix the membership level id&nbsp;</div></li><li><div>            if(!empty($this-&gt;membership_level-&gt;level_id))&nbsp;</div></li><li><div>                $this-&gt;membership_level-&gt;id = $this-&gt;membership_level-&gt;level_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //okay, do I have a discount code to check? (if there is no membership_level-&gt;membership_id value, that means there was no entry in memberships_users)&nbsp;</div></li><li><div>        if(!empty($this-&gt;discount_code) && empty($this-&gt;membership_level-&gt;membership_id))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(!empty($this-&gt;discount_code-&gt;code))&nbsp;</div></li><li><div>                $discount_code = $this-&gt;discount_code-&gt;code;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $discount_code = $this-&gt;discount_code;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sqlQuery = &quot;SELECT l.id, cl.*, l.name, l.description, l.allow_signups FROM $wpdb-&gt;pmpro_discount_codes_levels cl LEFT JOIN $wpdb-&gt;pmpro_membership_levels l ON cl.level_id = l.id LEFT JOIN $wpdb-&gt;pmpro_discount_codes dc ON dc.id = cl.code_id WHERE dc.code = '&quot; . $discount_code . &quot;' AND cl.level_id = '&quot; . $this-&gt;membership_id . &quot;' LIMIT 1&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;membership_level = $wpdb-&gt;get_row($sqlQuery);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //just get the info from the membership table    (sigh, I really need to standardize the column names for membership_id/level_id) but we're checking if we got the information already or not&nbsp;</div></li><li><div>        if(empty($this-&gt;membership_level-&gt;membership_id) && empty($this-&gt;membership_level-&gt;level_id))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;membership_level = $wpdb-&gt;get_row(&quot;SELECT l.* FROM $wpdb-&gt;pmpro_membership_levels l WHERE l.id = '&quot; . $this-&gt;membership_id . &quot;' LIMIT 1&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;membership_level;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Apply tax rules for the price given.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getTaxForPrice($price)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        //get options&nbsp;</div></li><li><div>        $tax_state = pmpro_getOption(&quot;tax_state&quot;);&nbsp;</div></li><li><div>        $tax_rate = pmpro_getOption(&quot;tax_rate&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //default&nbsp;</div></li><li><div>        $tax = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //calculate tax&nbsp;</div></li><li><div>        if($tax_state && $tax_rate)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            //we have values, is this order in the tax state?&nbsp;</div></li><li><div>            if(!empty($this-&gt;billing) && trim(strtoupper($this-&gt;billing-&gt;state)) == trim(strtoupper($tax_state)))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                //return value, pass through filter&nbsp;</div></li><li><div>                $tax = round((float)$price * (float)$tax_rate, 2);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //set values array for filter&nbsp;</div></li><li><div>        $values = array(&quot;price&quot; =&gt; $price, &quot;tax_state&quot; =&gt; $tax_state, &quot;tax_rate&quot; =&gt; $tax_rate);&nbsp;</div></li><li><div>        if(!empty($this-&gt;billing-&gt;state))&nbsp;</div></li><li><div>            $values['billing_state'] = $this-&gt;billing-&gt;state;&nbsp;</div></li><li><div>        if(!empty($this-&gt;billing-&gt;city))&nbsp;</div></li><li><div>            $values['billing_city'] = $this-&gt;billing-&gt;city;&nbsp;</div></li><li><div>        if(!empty($this-&gt;billing-&gt;zip))&nbsp;</div></li><li><div>            $values['billing_zip'] = $this-&gt;billing-&gt;zip;&nbsp;</div></li><li><div>        if(!empty($this-&gt;billing-&gt;country))&nbsp;</div></li><li><div>            $values['billing_country'] = $this-&gt;billing-&gt;country;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //filter&nbsp;</div></li><li><div>        $tax = apply_filters(&quot;pmpro_tax&quot;, $tax, $values, $this);&nbsp;</div></li><li><div>        return $tax;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get the tax amount for this order.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getTax($force = false)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if(!empty($this-&gt;tax) && !$force)&nbsp;</div></li><li><div>            return $this-&gt;tax;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //reset&nbsp;</div></li><li><div>        $this-&gt;tax = $this-&gt;getTaxForPrice($this-&gt;subtotal);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;tax;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Change the timestamp of an order by passing in year, month, day, time&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function updateTimestamp($year, $month, $day, $time = NULL)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if(empty($this-&gt;id))&nbsp;</div></li><li><div>            return false;        //need a saved order&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($time))&nbsp;</div></li><li><div>            $time = &quot;00:00:00&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $date = $year . &quot;-&quot; . $month . &quot;-&quot; . $day . &quot; &quot; . $time;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $this-&gt;sqlQuery = &quot;UPDATE $wpdb-&gt;pmpro_membership_orders SET timestamp = '&quot; . $date . &quot;' WHERE id = '&quot; . $this-&gt;id . &quot;' LIMIT 1&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($wpdb-&gt;query($this-&gt;sqlQuery) !== &quot;false&quot;)&nbsp;</div></li><li><div>            return $this-&gt;getMemberOrderByID($this-&gt;id);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save/update the values of the order in the database.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function saveOrder()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $current_user, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //get a random code to use for the public ID&nbsp;</div></li><li><div>        if(empty($this-&gt;code))&nbsp;</div></li><li><div>            $this-&gt;code = $this-&gt;getRandomCode();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //figure out how much we charged&nbsp;</div></li><li><div>        if(!empty($this-&gt;InitialPayment))&nbsp;</div></li><li><div>            $amount = $this-&gt;InitialPayment;&nbsp;</div></li><li><div>        elseif(!empty($this-&gt;subtotal))&nbsp;</div></li><li><div>            $amount = $this-&gt;subtotal;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $amount = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Todo: Tax?!, Coupons, Certificates, affiliates&nbsp;</div></li><li><div>        if(empty($this-&gt;subtotal))&nbsp;</div></li><li><div>            $this-&gt;subtotal = $amount;&nbsp;</div></li><li><div>        if(isset($this-&gt;tax))&nbsp;</div></li><li><div>            $tax = $this-&gt;tax;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $tax = $this-&gt;getTax(true);&nbsp;</div></li><li><div>        $this-&gt;certificate_id = &quot;&quot;;&nbsp;</div></li><li><div>        $this-&gt;certificateamount = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //calculate total&nbsp;</div></li><li><div>        if(!empty($this-&gt;total))&nbsp;</div></li><li><div>            $total = $this-&gt;total;&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $total = (float)$amount + (float)$tax;&nbsp;</div></li><li><div>            $this-&gt;total = $total;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //these fix some warnings/notices&nbsp;</div></li><li><div>        if(empty($this-&gt;billing))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;billing = new stdClass();&nbsp;</div></li><li><div>            $this-&gt;billing-&gt;name = $this-&gt;billing-&gt;street = $this-&gt;billing-&gt;city = $this-&gt;billing-&gt;state = $this-&gt;billing-&gt;zip = $this-&gt;billing-&gt;country = $this-&gt;billing-&gt;phone = &quot;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(empty($this-&gt;user_id))&nbsp;</div></li><li><div>            $this-&gt;user_id = 0;&nbsp;</div></li><li><div>        if(empty($this-&gt;paypal_token))&nbsp;</div></li><li><div>            $this-&gt;paypal_token = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;couponamount))&nbsp;</div></li><li><div>            $this-&gt;couponamount = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;payment_type))&nbsp;</div></li><li><div>            $this-&gt;payment_type = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;payment_transaction_id))&nbsp;</div></li><li><div>            $this-&gt;payment_transaction_id = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;subscription_transaction_id))&nbsp;</div></li><li><div>            $this-&gt;subscription_transaction_id = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;affiliate_id))&nbsp;</div></li><li><div>            $this-&gt;affiliate_id = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;affiliate_subid))&nbsp;</div></li><li><div>            $this-&gt;affiliate_subid = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;session_id))&nbsp;</div></li><li><div>            $this-&gt;session_id = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;accountnumber))&nbsp;</div></li><li><div>            $this-&gt;accountnumber = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;cardtype))&nbsp;</div></li><li><div>            $this-&gt;cardtype = &quot;&quot;;&nbsp;</div></li><li><div>        if(empty($this-&gt;ExpirationDate))&nbsp;</div></li><li><div>            $this-&gt;ExpirationDate = &quot;&quot;;&nbsp;</div></li><li><div>        if (empty($this-&gt;status))&nbsp;</div></li><li><div>            $this-&gt;status = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($this-&gt;gateway))&nbsp;</div></li><li><div>            $this-&gt;gateway = pmpro_getOption(&quot;gateway&quot;);&nbsp;</div></li><li><div>        if(empty($this-&gt;gateway_environment))&nbsp;</div></li><li><div>            $this-&gt;gateway_environment = pmpro_getOption(&quot;gateway_environment&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($this-&gt;datetime) && empty($this-&gt;timestamp))&nbsp;</div></li><li><div>            $this-&gt;datetime = date(&quot;Y-m-d H:s:i&quot;, current_time(&quot;timestamp&quot;));        //use current time&nbsp;</div></li><li><div>        elseif(empty($this-&gt;datetime) && !empty($this-&gt;timestamp) && is_numeric($this-&gt;timestamp))&nbsp;</div></li><li><div>            $this-&gt;datetime = date(&quot;Y-m-d H:s:i&quot;, $this-&gt;timestamp);    //get datetime from timestamp&nbsp;</div></li><li><div>        elseif(empty($this-&gt;datetime) && !empty($this-&gt;timestamp))&nbsp;</div></li><li><div>            $this-&gt;datetime = $this-&gt;timestamp;        //must have a datetime in it&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($this-&gt;notes))&nbsp;</div></li><li><div>            $this-&gt;notes = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //build query&nbsp;</div></li><li><div>        if(!empty($this-&gt;id))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            //set up actions&nbsp;</div></li><li><div>            $before_action = &quot;pmpro_update_order&quot;;&nbsp;</div></li><li><div>            $after_action = &quot;pmpro_updated_order&quot;;&nbsp;</div></li><li><div>            //update&nbsp;</div></li><li><div>            $this-&gt;sqlQuery = &quot;UPDATE $wpdb-&gt;pmpro_membership_orders&nbsp;</div></li><li><div>                                SET `code` = '&quot; . $this-&gt;code . &quot;', &nbsp;</div></li><li><div>                                `session_id` = '&quot; . $this-&gt;session_id . &quot;', &nbsp;</div></li><li><div>                                `user_id` = &quot; . intval($this-&gt;user_id) . &quot;, &nbsp;</div></li><li><div>                                `membership_id` = &quot; . intval($this-&gt;membership_id) . &quot;, &nbsp;</div></li><li><div>                                `paypal_token` = '&quot; . $this-&gt;paypal_token . &quot;', &nbsp;</div></li><li><div>                                `billing_name` = '&quot; . esc_sql($this-&gt;billing-&gt;name) . &quot;', &nbsp;</div></li><li><div>                                `billing_street` = '&quot; . esc_sql($this-&gt;billing-&gt;street) . &quot;', &nbsp;</div></li><li><div>                                `billing_city` = '&quot; . esc_sql($this-&gt;billing-&gt;city) . &quot;', &nbsp;</div></li><li><div>                                `billing_state` = '&quot; . esc_sql($this-&gt;billing-&gt;state) . &quot;', &nbsp;</div></li><li><div>                                `billing_zip` = '&quot; . esc_sql($this-&gt;billing-&gt;zip) . &quot;', &nbsp;</div></li><li><div>                                `billing_country` = '&quot; . esc_sql($this-&gt;billing-&gt;country) . &quot;', &nbsp;</div></li><li><div>                                `billing_phone` = '&quot; . esc_sql($this-&gt;billing-&gt;phone) . &quot;', &nbsp;</div></li><li><div>                                `subtotal` = '&quot; . $this-&gt;subtotal . &quot;', &nbsp;</div></li><li><div>                                `tax` = '&quot; . $this-&gt;tax . &quot;', &nbsp;</div></li><li><div>                                `couponamount` = '&quot; . $this-&gt;couponamount . &quot;', &nbsp;</div></li><li><div>                                `certificate_id` = &quot; . intval($this-&gt;certificate_id) . &quot;, &nbsp;</div></li><li><div>                                `certificateamount` = '&quot; . $this-&gt;certificateamount . &quot;', &nbsp;</div></li><li><div>                                `total` = '&quot; . $this-&gt;total . &quot;', &nbsp;</div></li><li><div>                                `payment_type` = '&quot; . $this-&gt;payment_type . &quot;', &nbsp;</div></li><li><div>                                `cardtype` = '&quot; . $this-&gt;cardtype . &quot;', &nbsp;</div></li><li><div>                                `accountnumber` = '&quot; . $this-&gt;accountnumber . &quot;', &nbsp;</div></li><li><div>                                `expirationmonth` = '&quot; . $this-&gt;expirationmonth . &quot;', &nbsp;</div></li><li><div>                                `expirationyear` = '&quot; . $this-&gt;expirationyear . &quot;', &nbsp;</div></li><li><div>                                `status` = '&quot; . esc_sql($this-&gt;status) . &quot;', &nbsp;</div></li><li><div>                                `gateway` = '&quot; . $this-&gt;gateway . &quot;', &nbsp;</div></li><li><div>                                `gateway_environment` = '&quot; . $this-&gt;gateway_environment . &quot;', &nbsp;</div></li><li><div>                                `payment_transaction_id` = '&quot; . esc_sql($this-&gt;payment_transaction_id) . &quot;', &nbsp;</div></li><li><div>                                `subscription_transaction_id` = '&quot; . esc_sql($this-&gt;subscription_transaction_id) . &quot;', &nbsp;</div></li><li><div>                                `timestamp` = '&quot; . esc_sql($this-&gt;datetime) . &quot;', &nbsp;</div></li><li><div>                                `affiliate_id` = '&quot; . esc_sql($this-&gt;affiliate_id) . &quot;', &nbsp;</div></li><li><div>                                `affiliate_subid` = '&quot; . esc_sql($this-&gt;affiliate_subid) . &quot;', &nbsp;</div></li><li><div>                                `notes` = '&quot; . esc_sql($this-&gt;notes) . &quot;'&nbsp;</div></li><li><div>                                WHERE id = '&quot; . $this-&gt;id . &quot;'&nbsp;</div></li><li><div>                                LIMIT 1&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            //set up actions&nbsp;</div></li><li><div>            $before_action = &quot;pmpro_add_order&quot;;&nbsp;</div></li><li><div>            $after_action = &quot;pmpro_added_order&quot;;&nbsp;</div></li><li><div>            //insert&nbsp;</div></li><li><div>            $this-&gt;sqlQuery = &quot;INSERT INTO $wpdb-&gt;pmpro_membership_orders&nbsp;</div></li><li><div>                            (`code`, `session_id`, `user_id`, `membership_id`, `paypal_token`, `billing_name`, `billing_street`, `billing_city`, `billing_state`, `billing_zip`, `billing_country`, `billing_phone`, `subtotal`, `tax`, `couponamount`, `certificate_id`, `certificateamount`, `total`, `payment_type`, `cardtype`, `accountnumber`, `expirationmonth`, `expirationyear`, `status`, `gateway`, `gateway_environment`, `payment_transaction_id`, `subscription_transaction_id`, `timestamp`, `affiliate_id`, `affiliate_subid`, `notes`)&nbsp;</div></li><li><div>                            VALUES('&quot; . $this-&gt;code . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . session_id() . &quot;', &nbsp;</div></li><li><div>                                   &quot; . intval($this-&gt;user_id) . &quot;, &nbsp;</div></li><li><div>                                   &quot; . intval($this-&gt;membership_id) . &quot;, &nbsp;</div></li><li><div>                                   '&quot; . $this-&gt;paypal_token . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql(trim($this-&gt;billing-&gt;name)) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql(trim($this-&gt;billing-&gt;street)) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;billing-&gt;city) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;billing-&gt;state) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;billing-&gt;zip) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;billing-&gt;country) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . cleanPhone($this-&gt;billing-&gt;phone) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . $this-&gt;subtotal . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . $tax . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . $this-&gt;couponamount. &quot;', &nbsp;</div></li><li><div>                                   &quot; . intval($this-&gt;certificate_id) . &quot;, &nbsp;</div></li><li><div>                                   '&quot; . $this-&gt;certificateamount . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . $total . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . $this-&gt;payment_type . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . $this-&gt;cardtype . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . hideCardNumber($this-&gt;accountnumber, false) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . substr($this-&gt;ExpirationDate, 0, 2) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . substr($this-&gt;ExpirationDate, 2, 4) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;status) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . $this-&gt;gateway . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . $this-&gt;gateway_environment . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;payment_transaction_id) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;subscription_transaction_id) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;datetime) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;affiliate_id) . &quot;', &nbsp;</div></li><li><div>                                   '&quot; . esc_sql($this-&gt;affiliate_subid) . &quot;', &nbsp;</div></li><li><div>                                    '&quot; . esc_sql($this-&gt;notes) . &quot;'&nbsp;</div></li><li><div> )&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action($before_action, $this);&nbsp;</div></li><li><div>        if($wpdb-&gt;query($this-&gt;sqlQuery) !== false)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if(empty($this-&gt;id))&nbsp;</div></li><li><div>                $this-&gt;id = $wpdb-&gt;insert_id;&nbsp;</div></li><li><div>            do_action($after_action, $this);&nbsp;</div></li><li><div>            return $this-&gt;getMemberOrderByID($this-&gt;id);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get a random code to use as the order code.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getRandomCode()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while(empty($code))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $scramble = md5(AUTH_KEY . current_time('timestamp') . SECURE_AUTH_KEY);&nbsp;</div></li><li><div>            $code = substr($scramble, 0, 10);&nbsp;</div></li><li><div>            $code = apply_filters(&quot;pmpro_random_code&quot;, $code, $this);    //filter&nbsp;</div></li><li><div>            $check = $wpdb-&gt;get_var(&quot;SELECT id FROM $wpdb-&gt;pmpro_membership_orders WHERE code = '$code' LIMIT 1&quot;);&nbsp;</div></li><li><div>            if($check || is_numeric($code))&nbsp;</div></li><li><div>                $code = NULL;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return strtoupper($code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update the status of the order in the database.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function updateStatus($newstatus)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($this-&gt;id))&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;status = $newstatus;&nbsp;</div></li><li><div>        $this-&gt;sqlQuery = &quot;UPDATE $wpdb-&gt;pmpro_membership_orders SET status = '&quot; . esc_sql($newstatus) . &quot;' WHERE id = '&quot; . $this-&gt;id . &quot;' LIMIT 1&quot;;&nbsp;</div></li><li><div>        if($wpdb-&gt;query($this-&gt;sqlQuery) !== false)&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Call the process step of the gateway class.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function process()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;Gateway-&gt;process($this);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * For offsite gateways with a confirm step.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.8&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function confirm()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;Gateway-&gt;confirm($this);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Cancel an order and call the cancel step of the gateway class if needed.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function cancel()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        //only need to cancel on the gateway if there is a subscription id&nbsp;</div></li><li><div>        if(empty($this-&gt;subscription_transaction_id))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            //just mark as cancelled&nbsp;</div></li><li><div>            $this-&gt;updateStatus(&quot;cancelled&quot;);&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            //cancel the gateway subscription first&nbsp;</div></li><li><div>            $result = $this-&gt;Gateway-&gt;cancel($this);&nbsp;</div></li><li><div>            if($result == false)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                //there was an error, but cancel the order no matter what&nbsp;</div></li><li><div>                $this-&gt;updateStatus(&quot;cancelled&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                //we should probably notify the admin&nbsp;</div></li><li><div>                $pmproemail = new PMProEmail();&nbsp;</div></li><li><div>                $pmproemail-&gt;template = &quot;subscription_cancel_error&quot;;&nbsp;</div></li><li><div>                $pmproemail-&gt;data = array(&quot;body&quot;=&gt;&quot;&lt;p&gt;&quot; . sprintf(__(&quot;There was an error canceling the subscription for user with ID=%s. You will want to check your payment gateway to see if their subscription is still active.&quot;, &quot;pmpro&quot;), strval($this-&gt;user_id)) . &quot;&lt;/p&gt;&lt;p&gt;Error: &quot; . $this-&gt;error . &quot;&lt;/p&gt;&quot;);&nbsp;</div></li><li><div>                $pmproemail-&gt;data[&quot;body&quot;] .= &quot;&lt;p&gt;Associated Order:&lt;br /&gt;&quot; . nl2br(var_export($this, true)) . &quot;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>                $pmproemail-&gt;sendEmail(get_bloginfo(&quot;admin_email&quot;));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                //Note: status would have been set to cancelled by the gateway class. So we don't have to update it here.&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                //remove billing numbers in pmpro_memberships_users if the membership is still active&nbsp;</div></li><li><div>                global $wpdb;&nbsp;</div></li><li><div>                $sqlQuery = &quot;UPDATE $wpdb-&gt;pmpro_memberships_users SET initial_payment = 0, billing_amount = 0, cycle_number = 0 WHERE user_id = '&quot; . $this-&gt;user_id . &quot;' AND membership_id = '&quot; . $this-&gt;membership_id . &quot;' AND status = 'active'&quot;;&nbsp;</div></li><li><div>                $wpdb-&gt;query($sqlQuery);&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                return $result;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Call the update method of the gateway class.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function updateBilling()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;Gateway-&gt;update($this);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Call the getSubscriptionStatus method of the gateway class.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getGatewaySubscriptionStatus()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;Gateway-&gt;getSubscriptionStatus($this);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Call the getTransactionStatus method of the gateway class.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function getGatewayTransactionStatus()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;Gateway-&gt;getTransactionStatus($this);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete an order and associated data.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function deleteMe()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if(empty($this-&gt;id))&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $this-&gt;sqlQuery = &quot;DELETE FROM $wpdb-&gt;pmpro_membership_orders WHERE id = '&quot; . $this-&gt;id . &quot;' LIMIT 1&quot;;&nbsp;</div></li><li><div>        if($wpdb-&gt;query($this-&gt;sqlQuery) !== false)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            do_action(&quot;pmpro_delete_order&quot;, $this-&gt;id, $this);&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.8.9</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/classes/member_order/" class="">1.9</a></li><li><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9.3/classes/member_order/" class="">1.8.9.3</a></li><li><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9.2/classes/member_order/" class="">1.8.9.2</a></li><li><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9.1/classes/member_order/" class="">1.8.9.1</a></li><li><a href="http://hookr.io/plugins/paid-memberships-pro/1.8.9/classes/member_order/" class="active">1.8.9</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>MemberOrder</li><li><span></span>Paid Memberships Pro</li><li><span></span>1.9</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>