<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="1.9" data-slug="paid-memberships-pro" data-type="class" data-id="74844"><head xmlns="http://www.w3.org/1999/xhtml"><title> testintegrationtransactiontest | class | Paid Memberships Pro | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Test\Integration\TransactionTest, class, plugin, paid-memberships-pro, 1.9" /><meta name="description" content="The Paid Memberships Pro Test Integration TransactionTest class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.10"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=c6727fa9821c7716cb4fa5aafb17f43e' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.10' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/test_integration_transaction_test/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Ftest_integration_transaction_test%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Ftest_integration_transaction_test%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-paid-memberships-pro-1.9-class-test_integration_transaction_test","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="test_integration_transaction_test" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to paid-memberships-pro." href="http://hookr.io/plugins/paid-memberships-pro/" class="plugin"><span property="name">paid-memberships-pro</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.9." href="http://hookr.io/plugins/paid-memberships-pro/1.9/" class="H_VERSION"><span property="name">1.9</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/paid-memberships-pro/1.9/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">test_integration_transaction_&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="1062"><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/all/" title="All">All <span class="count badge">1062</span></a></li><li class="" data-id="new" data-count="186"><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/new/" title="New">New <span class="count badge">186</span></a></li><li class="" data-id="hooks" data-count="398"><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/hooks/" title="Hooks">Hooks <span class="count badge">398</span></a></li><li class="" data-id="action" data-count="92"><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/actions/" title="Actions">Actions <span class="count badge">92</span></a></li><li class="" data-id="filter" data-count="306"><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/filters/" title="Filters">Filters <span class="count badge">306</span></a></li><li class="active" data-id="class" data-count="346"><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/classes/" title="Classes">Classes <span class="count badge">346</span></a></li><li class="" data-id="constant" data-count="29"><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/constants/" title="Constants">Constants <span class="count badge">29</span></a></li><li class="" data-id="function" data-count="282"><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/functions/" title="Functions">Functions <span class="count badge">282</span></a></li><li class="" data-id="shortcode" data-count="7"><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">7</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>TestIntegrationTransactionTest</strong></h1><p>The Paid Memberships Pro <strong>Test Integration TransactionTest</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/paid-memberships-pro/1.9/files/includes-lib-braintree-tests-integration-transactiontest/" class="file">/includes/lib/Braintree/tests/integration/TransactionTest.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="12" class="block" start="12"><li><div>class TransactionTest extends Setup&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  public function testCloneTransaction()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'orderId' =&gt; '123', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/2011', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'customer' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Dan', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'billing' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Carl', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'shipping' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Andrew', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>      $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>      $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cloneResult = Braintree\Transaction::cloneTransaction(&nbsp;</div></li><li><div>          $transaction-&gt;id, &nbsp;</div></li><li><div>          [&nbsp;</div></li><li><div>              'amount' =&gt; '123.45', &nbsp;</div></li><li><div>              'channel' =&gt; 'MyShoppingCartProvider', &nbsp;</div></li><li><div>              'options' =&gt; ['submitForSettlement' =&gt; false]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      Test\Helper::assertPrintable($cloneResult);&nbsp;</div></li><li><div>      $this-&gt;assertTrue($cloneResult-&gt;success);&nbsp;</div></li><li><div>      $cloneTransaction = $cloneResult-&gt;transaction;&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Dan', $cloneTransaction-&gt;customerDetails-&gt;firstName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Carl', $cloneTransaction-&gt;billingDetails-&gt;firstName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Andrew', $cloneTransaction-&gt;shippingDetails-&gt;firstName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('510510******5100', $cloneTransaction-&gt;creditCardDetails-&gt;maskedNumber);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('authorized', $cloneTransaction-&gt;status);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('123.45', $cloneTransaction-&gt;amount);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('MyShoppingCartProvider', $cloneTransaction-&gt;channel);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateTransactionUsingNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonce_for_new_card([&nbsp;</div></li><li><div>            &quot;creditCard&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;number&quot; =&gt; &quot;4111111111111111&quot;, &nbsp;</div></li><li><div>                &quot;expirationMonth&quot; =&gt; &quot;11&quot;, &nbsp;</div></li><li><div>                &quot;expirationYear&quot; =&gt; &quot;2099&quot;&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            &quot;share&quot; =&gt; true&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('47.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testGatewayCreateTransactionUsingNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonce_for_new_card([&nbsp;</div></li><li><div>            &quot;creditCard&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;number&quot; =&gt; &quot;4111111111111111&quot;, &nbsp;</div></li><li><div>                &quot;expirationMonth&quot; =&gt; &quot;11&quot;, &nbsp;</div></li><li><div>                &quot;expirationYear&quot; =&gt; &quot;2099&quot;&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            &quot;share&quot; =&gt; true&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $gateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'environment' =&gt; 'development', &nbsp;</div></li><li><div>            'merchantId' =&gt; 'integration_merchant_id', &nbsp;</div></li><li><div>            'publicKey' =&gt; 'integration_public_key', &nbsp;</div></li><li><div>            'privateKey' =&gt; 'integration_private_key'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $result = $gateway-&gt;transaction()-&gt;sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('47.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateTransactionUsingEuropeBankAccountNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $gateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'environment' =&gt; 'development', &nbsp;</div></li><li><div>            'merchantId' =&gt; 'altpay_merchant', &nbsp;</div></li><li><div>            'publicKey' =&gt; 'altpay_merchant_public_key', &nbsp;</div></li><li><div>            'privateKey' =&gt; 'altpay_merchant_private_key'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;customer()-&gt;create();&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $customer = $result-&gt;customer;&nbsp;</div></li><li><div>        $clientApi = new HttpClientApi($gateway-&gt;config);&nbsp;</div></li><li><div>        $nonce = $clientApi-&gt;nonceForNewEuropeanBankAccount([&nbsp;</div></li><li><div>            &quot;customerId&quot; =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            &quot;sepa_mandate&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;locale&quot; =&gt; &quot;de-DE&quot;, &nbsp;</div></li><li><div>                &quot;bic&quot; =&gt; &quot;DEUTDEFF&quot;, &nbsp;</div></li><li><div>                &quot;iban&quot; =&gt; &quot;DE89370400440532013000&quot;, &nbsp;</div></li><li><div>                &quot;accountHolderName&quot; =&gt; &quot;Bob Holder&quot;, &nbsp;</div></li><li><div>                &quot;billingAddress&quot; =&gt; [&nbsp;</div></li><li><div>                    &quot;streetAddress&quot; =&gt; &quot;123 Currywurst Way&quot;, &nbsp;</div></li><li><div>                    &quot;extendedAddress&quot; =&gt; &quot;Lager Suite&quot;, &nbsp;</div></li><li><div>                    &quot;firstName&quot; =&gt; &quot;Wilhelm&quot;, &nbsp;</div></li><li><div>                    &quot;lastName&quot; =&gt; &quot;Dix&quot;, &nbsp;</div></li><li><div>                    &quot;locality&quot; =&gt; &quot;Frankfurt&quot;, &nbsp;</div></li><li><div>                    &quot;postalCode&quot; =&gt; &quot;60001&quot;, &nbsp;</div></li><li><div>                    &quot;countryCodeAlpha2&quot; =&gt; &quot;DE&quot;, &nbsp;</div></li><li><div>                    &quot;region&quot; =&gt; &quot;Hesse&quot;&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;transaction()-&gt;sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; 'fake_sepa_ma', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('47.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('DEUTDEFF', $transaction-&gt;europeBankAccount-&gt;bic);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSaleWithUsBankAccountNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; 'us_bank_merchant_account', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; Test\Helper::generateValidUsBankAccountNonce(), &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true, &nbsp;</div></li><li><div>                'storeInVault' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SETTLEMENT_PENDING, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('021000021', $transaction-&gt;usBankAccount-&gt;routingNumber);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('1234', $transaction-&gt;usBankAccount-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('checking', $transaction-&gt;usBankAccount-&gt;accountType);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Dan Schulman', $transaction-&gt;usBankAccount-&gt;accountHolderName);&nbsp;</div></li><li><div>        $this-&gt;assertRegExp('/CHASE/', $transaction-&gt;usBankAccount-&gt;bankName);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('cl mandate text', $transaction-&gt;usBankAccount-&gt;achMandate-&gt;text);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('DateTime', get_class($transaction-&gt;usBankAccount-&gt;achMandate-&gt;acceptedAt));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSaleWithUsBankAccountNonceAndVaultedToken()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; 'us_bank_merchant_account', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; Test\Helper::generateValidUsBankAccountNonce(), &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true, &nbsp;</div></li><li><div>                'storeInVault' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SETTLEMENT_PENDING, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('021000021', $transaction-&gt;usBankAccount-&gt;routingNumber);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('1234', $transaction-&gt;usBankAccount-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('checking', $transaction-&gt;usBankAccount-&gt;accountType);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Dan Schulman', $transaction-&gt;usBankAccount-&gt;accountHolderName);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('cl mandate text', $transaction-&gt;usBankAccount-&gt;achMandate-&gt;text);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('DateTime', get_class($transaction-&gt;usBankAccount-&gt;achMandate-&gt;acceptedAt));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; 'us_bank_merchant_account', &nbsp;</div></li><li><div>            'paymentMethodToken' =&gt; $transaction-&gt;usBankAccount-&gt;token, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true, &nbsp;</div></li><li><div>                'storeInVault' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SETTLEMENT_PENDING, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('021000021', $transaction-&gt;usBankAccount-&gt;routingNumber);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('1234', $transaction-&gt;usBankAccount-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('checking', $transaction-&gt;usBankAccount-&gt;accountType);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Dan Schulman', $transaction-&gt;usBankAccount-&gt;accountHolderName);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('cl mandate text', $transaction-&gt;usBankAccount-&gt;achMandate-&gt;text);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('DateTime', get_class($transaction-&gt;usBankAccount-&gt;achMandate-&gt;acceptedAt));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSaleWithInvalidUsBankAccountNonce()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>          'amount' =&gt; '100.00', &nbsp;</div></li><li><div>          'merchantAccountId' =&gt; 'us_bank_merchant_account', &nbsp;</div></li><li><div>          'paymentMethodNonce' =&gt; Test\Helper::generateInvalidUsBankAccountNonce(), &nbsp;</div></li><li><div>          'options' =&gt; [&nbsp;</div></li><li><div>              'submitForSettlement' =&gt; true, &nbsp;</div></li><li><div>              'storeInVault' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>      $baseErrors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('paymentMethodNonce');&nbsp;</div></li><li><div>      $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_PAYMENT_METHOD_NONCE_UNKNOWN, $baseErrors[0]-&gt;code);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSaleAndSkipAdvancedFraudChecking()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>          'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>          'creditCard' =&gt; [&nbsp;</div></li><li><div>              'number' =&gt; Braintree\Test\CreditCardNumbers::$visa, &nbsp;</div></li><li><div>              'expirationDate' =&gt; '05/2009', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>          'options' =&gt; [&nbsp;</div></li><li><div>              'skipAdvancedFraudChecking' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>      $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>      $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>      $this-&gt;assertNull($transaction-&gt;riskData-&gt;id);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSettleAltPayTransaction()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $gateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'environment' =&gt; 'development', &nbsp;</div></li><li><div>            'merchantId' =&gt; 'altpay_merchant', &nbsp;</div></li><li><div>            'publicKey' =&gt; 'altpay_merchant_public_key', &nbsp;</div></li><li><div>            'privateKey' =&gt; 'altpay_merchant_private_key'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;customer()-&gt;create();&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $customer = $result-&gt;customer;&nbsp;</div></li><li><div>        $clientApi = new HttpClientApi($gateway-&gt;config);&nbsp;</div></li><li><div>        $nonce = $clientApi-&gt;nonceForNewEuropeanBankAccount([&nbsp;</div></li><li><div>            &quot;customerId&quot; =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            &quot;sepa_mandate&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;locale&quot; =&gt; &quot;de-DE&quot;, &nbsp;</div></li><li><div>                &quot;bic&quot; =&gt; &quot;DEUTDEFF&quot;, &nbsp;</div></li><li><div>                &quot;iban&quot; =&gt; &quot;DE89370400440532013000&quot;, &nbsp;</div></li><li><div>                &quot;accountHolderName&quot; =&gt; &quot;Bob Holder&quot;, &nbsp;</div></li><li><div>                &quot;billingAddress&quot; =&gt; [&nbsp;</div></li><li><div>                    &quot;streetAddress&quot; =&gt; &quot;123 Currywurst Way&quot;, &nbsp;</div></li><li><div>                    &quot;extendedAddress&quot; =&gt; &quot;Lager Suite&quot;, &nbsp;</div></li><li><div>                    &quot;firstName&quot; =&gt; &quot;Wilhelm&quot;, &nbsp;</div></li><li><div>                    &quot;lastName&quot; =&gt; &quot;Dix&quot;, &nbsp;</div></li><li><div>                    &quot;locality&quot; =&gt; &quot;Frankfurt&quot;, &nbsp;</div></li><li><div>                    &quot;postalCode&quot; =&gt; &quot;60001&quot;, &nbsp;</div></li><li><div>                    &quot;countryCodeAlpha2&quot; =&gt; &quot;DE&quot;, &nbsp;</div></li><li><div>                    &quot;region&quot; =&gt; &quot;Hesse&quot;&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;transaction()-&gt;sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; 'fake_sepa_ma', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $gateway-&gt;testing()-&gt;settle($transaction-&gt;id);&nbsp;</div></li><li><div>        $transaction = $gateway-&gt;transaction()-&gt;find($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\Transaction::SETTLED, $transaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSettlementConfirmAltPayTransaction()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $gateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'environment' =&gt; 'development', &nbsp;</div></li><li><div>            'merchantId' =&gt; 'altpay_merchant', &nbsp;</div></li><li><div>            'publicKey' =&gt; 'altpay_merchant_public_key', &nbsp;</div></li><li><div>            'privateKey' =&gt; 'altpay_merchant_private_key'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;customer()-&gt;create();&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $customer = $result-&gt;customer;&nbsp;</div></li><li><div>        $clientApi = new HttpClientApi($gateway-&gt;config);&nbsp;</div></li><li><div>        $nonce = $clientApi-&gt;nonceForNewEuropeanBankAccount([&nbsp;</div></li><li><div>            &quot;customerId&quot; =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            &quot;sepa_mandate&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;locale&quot; =&gt; &quot;de-DE&quot;, &nbsp;</div></li><li><div>                &quot;bic&quot; =&gt; &quot;DEUTDEFF&quot;, &nbsp;</div></li><li><div>                &quot;iban&quot; =&gt; &quot;DE89370400440532013000&quot;, &nbsp;</div></li><li><div>                &quot;accountHolderName&quot; =&gt; &quot;Bob Holder&quot;, &nbsp;</div></li><li><div>                &quot;billingAddress&quot; =&gt; [&nbsp;</div></li><li><div>                    &quot;streetAddress&quot; =&gt; &quot;123 Currywurst Way&quot;, &nbsp;</div></li><li><div>                    &quot;extendedAddress&quot; =&gt; &quot;Lager Suite&quot;, &nbsp;</div></li><li><div>                    &quot;firstName&quot; =&gt; &quot;Wilhelm&quot;, &nbsp;</div></li><li><div>                    &quot;lastName&quot; =&gt; &quot;Dix&quot;, &nbsp;</div></li><li><div>                    &quot;locality&quot; =&gt; &quot;Frankfurt&quot;, &nbsp;</div></li><li><div>                    &quot;postalCode&quot; =&gt; &quot;60001&quot;, &nbsp;</div></li><li><div>                    &quot;countryCodeAlpha2&quot; =&gt; &quot;DE&quot;, &nbsp;</div></li><li><div>                    &quot;region&quot; =&gt; &quot;Hesse&quot;&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;transaction()-&gt;sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; 'fake_sepa_ma', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $gateway-&gt;testing()-&gt;settlementConfirm($transaction-&gt;id);&nbsp;</div></li><li><div>        $transaction = $gateway-&gt;transaction()-&gt;find($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\Transaction::SETTLEMENT_CONFIRMED, $transaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSettlementDeclineAltPayTransaction()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $gateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'environment' =&gt; 'development', &nbsp;</div></li><li><div>            'merchantId' =&gt; 'altpay_merchant', &nbsp;</div></li><li><div>            'publicKey' =&gt; 'altpay_merchant_public_key', &nbsp;</div></li><li><div>            'privateKey' =&gt; 'altpay_merchant_private_key'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;customer()-&gt;create();&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $customer = $result-&gt;customer;&nbsp;</div></li><li><div>        $clientApi = new HttpClientApi($gateway-&gt;config);&nbsp;</div></li><li><div>        $nonce = $clientApi-&gt;nonceForNewEuropeanBankAccount([&nbsp;</div></li><li><div>            &quot;customerId&quot; =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            &quot;sepa_mandate&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;locale&quot; =&gt; &quot;de-DE&quot;, &nbsp;</div></li><li><div>                &quot;bic&quot; =&gt; &quot;DEUTDEFF&quot;, &nbsp;</div></li><li><div>                &quot;iban&quot; =&gt; &quot;DE89370400440532013000&quot;, &nbsp;</div></li><li><div>                &quot;accountHolderName&quot; =&gt; &quot;Bob Holder&quot;, &nbsp;</div></li><li><div>                &quot;billingAddress&quot; =&gt; [&nbsp;</div></li><li><div>                    &quot;streetAddress&quot; =&gt; &quot;123 Currywurst Way&quot;, &nbsp;</div></li><li><div>                    &quot;extendedAddress&quot; =&gt; &quot;Lager Suite&quot;, &nbsp;</div></li><li><div>                    &quot;firstName&quot; =&gt; &quot;Wilhelm&quot;, &nbsp;</div></li><li><div>                    &quot;lastName&quot; =&gt; &quot;Dix&quot;, &nbsp;</div></li><li><div>                    &quot;locality&quot; =&gt; &quot;Frankfurt&quot;, &nbsp;</div></li><li><div>                    &quot;postalCode&quot; =&gt; &quot;60001&quot;, &nbsp;</div></li><li><div>                    &quot;countryCodeAlpha2&quot; =&gt; &quot;DE&quot;, &nbsp;</div></li><li><div>                    &quot;region&quot; =&gt; &quot;Hesse&quot;&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;transaction()-&gt;sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; 'fake_sepa_ma', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $gateway-&gt;testing()-&gt;settlementConfirm($transaction-&gt;id);&nbsp;</div></li><li><div>        $gateway-&gt;testing()-&gt;settlementDecline($transaction-&gt;id);&nbsp;</div></li><li><div>        $transaction = $gateway-&gt;transaction()-&gt;find($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\Transaction::SETTLEMENT_DECLINED, $transaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateTransactionUsingFakeApplePayNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; Braintree\Test\Nonces::$applePayAmEx&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('47.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $applePayDetails = $transaction-&gt;applePayCardDetails;&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\ApplePayCard::AMEX, $applePayDetails-&gt;cardType);&nbsp;</div></li><li><div>        $this-&gt;assertContains(&quot;AmEx &quot;, $applePayDetails-&gt;sourceDescription);&nbsp;</div></li><li><div>        $this-&gt;assertContains(&quot;AmEx &quot;, $applePayDetails-&gt;paymentInstrumentName);&nbsp;</div></li><li><div>        $this-&gt;assertTrue(intval($applePayDetails-&gt;expirationMonth) &gt; 0);&nbsp;</div></li><li><div>        $this-&gt;assertTrue(intval($applePayDetails-&gt;expirationYear) &gt; 0);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($applePayDetails-&gt;cardholderName);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateTransactionUsingRawApplePayParams()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '1.02', &nbsp;</div></li><li><div>            'applePayCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; &quot;370295001292109&quot;, &nbsp;</div></li><li><div>                'cardholderName' =&gt; &quot;JANE SMITH&quot;, &nbsp;</div></li><li><div>                'cryptogram' =&gt; &quot;AAAAAAAA/COBt84dnIEcwAA3gAAGhgEDoLABAAhAgAABAAAALnNCLw==&quot;, &nbsp;</div></li><li><div>                'expirationMonth' =&gt; &quot;10&quot;, &nbsp;</div></li><li><div>                'expirationYear' =&gt; &quot;17&quot;&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateTransactionUsingRawApplePayParamsInSnakeCaseForBackwardsCompatibility()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '1.02', &nbsp;</div></li><li><div>            'apple_pay_card' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; &quot;370295001292109&quot;, &nbsp;</div></li><li><div>                'cardholder_name' =&gt; &quot;JANE SMITH&quot;, &nbsp;</div></li><li><div>                'cryptogram' =&gt; &quot;AAAAAAAA/COBt84dnIEcwAA3gAAGhgEDoLABAAhAgAABAAAALnNCLw==&quot;, &nbsp;</div></li><li><div>                'expiration_month' =&gt; &quot;10&quot;, &nbsp;</div></li><li><div>                'expiration_year' =&gt; &quot;17&quot;&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateTransactionUsingFakeAndroidPayProxyCardNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; Braintree\Test\Nonces::$androidPayDiscover&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('47.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $androidPayCardDetails = $transaction-&gt;androidPayCardDetails;&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\CreditCard::DISCOVER, $androidPayCardDetails-&gt;cardType);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;1117&quot;, $androidPayCardDetails-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertNull($androidPayCardDetails-&gt;token);&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\CreditCard::DISCOVER, $androidPayCardDetails-&gt;virtualCardType);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;1117&quot;, $androidPayCardDetails-&gt;virtualCardLast4);&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\CreditCard::VISA, $androidPayCardDetails-&gt;sourceCardType);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;1111&quot;, $androidPayCardDetails-&gt;sourceCardLast4);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;Visa 1111&quot;, $androidPayCardDetails-&gt;sourceDescription);&nbsp;</div></li><li><div>        $this-&gt;assertContains('android_pay', $androidPayCardDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertTrue(intval($androidPayCardDetails-&gt;expirationMonth) &gt; 0);&nbsp;</div></li><li><div>        $this-&gt;assertTrue(intval($androidPayCardDetails-&gt;expirationYear) &gt; 0);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateTransactionUsingFakeAndroidPayNetworkTokenNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; Braintree\Test\Nonces::$androidPayMasterCard&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('47.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $androidPayCardDetails = $transaction-&gt;androidPayCardDetails;&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\CreditCard::MASTER_CARD, $androidPayCardDetails-&gt;cardType);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;4444&quot;, $androidPayCardDetails-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertNull($androidPayCardDetails-&gt;token);&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\CreditCard::MASTER_CARD, $androidPayCardDetails-&gt;virtualCardType);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;4444&quot;, $androidPayCardDetails-&gt;virtualCardLast4);&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\CreditCard::MASTER_CARD, $androidPayCardDetails-&gt;sourceCardType);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;4444&quot;, $androidPayCardDetails-&gt;sourceCardLast4);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;MasterCard 4444&quot;, $androidPayCardDetails-&gt;sourceDescription);&nbsp;</div></li><li><div>        $this-&gt;assertContains('android_pay', $androidPayCardDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertTrue(intval($androidPayCardDetails-&gt;expirationMonth) &gt; 0);&nbsp;</div></li><li><div>        $this-&gt;assertTrue(intval($androidPayCardDetails-&gt;expirationYear) &gt; 0);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function testCreateTransactionUsingFakeAmexExpressCheckoutNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::fakeAmexDirectMerchantAccountId(), &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; Braintree\Test\Nonces::$amexExpressCheckout&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('47.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $amexExpressCheckoutCardDetails = $transaction-&gt;amexExpressCheckoutCardDetails;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertSame(Braintree\CreditCard::AMEX, $amexExpressCheckoutCardDetails-&gt;cardType);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;341111&quot;, $amexExpressCheckoutCardDetails-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;12/21&quot;, $amexExpressCheckoutCardDetails-&gt;cardMemberExpiryDate);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;0005&quot;, $amexExpressCheckoutCardDetails-&gt;cardMemberNumber);&nbsp;</div></li><li><div>        $this-&gt;assertNull($amexExpressCheckoutCardDetails-&gt;token);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($amexExpressCheckoutCardDetails-&gt;sourceDescription);&nbsp;</div></li><li><div>        $this-&gt;assertContains(&quot;.png&quot;, $amexExpressCheckoutCardDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertTrue(intval($amexExpressCheckoutCardDetails-&gt;expirationMonth) &gt; 0);&nbsp;</div></li><li><div>        $this-&gt;assertTrue(intval($amexExpressCheckoutCardDetails-&gt;expirationYear) &gt; 0);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function testCreateTransactionUsingFakeVenmoAccountNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale(array(&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::fakeVenmoAccountMerchantAccountId(), &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; Braintree\Test\Nonces::$venmoAccount&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('47.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\PaymentInstrumentType::VENMO_ACCOUNT, $transaction-&gt;paymentInstrumentType);&nbsp;</div></li><li><div>        $venmoAccountDetails = $transaction-&gt;venmoAccountDetails;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertNull($venmoAccountDetails-&gt;token);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($venmoAccountDetails-&gt;sourceDescription);&nbsp;</div></li><li><div>        $this-&gt;assertContains(&quot;.png&quot;, $venmoAccountDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;venmojoe&quot;, $venmoAccountDetails-&gt;username);&nbsp;</div></li><li><div>        $this-&gt;assertSame(&quot;Venmo-Joe-1&quot;, $venmoAccountDetails-&gt;venmoUserId);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function testCreateTransactionUsingFakeCoinbaseNonce()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '17.00', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; Braintree\Test\Nonces::$coinbase&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;coinbaseDetails);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;coinbaseDetails-&gt;userId);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;coinbaseDetails-&gt;userName);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;coinbaseDetails-&gt;userEmail);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateTransactionReturnsPaymentInstrumentType()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonce_for_new_card([&nbsp;</div></li><li><div>            &quot;creditCard&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;number&quot; =&gt; &quot;4111111111111111&quot;, &nbsp;</div></li><li><div>                &quot;expirationMonth&quot; =&gt; &quot;11&quot;, &nbsp;</div></li><li><div>                &quot;expirationYear&quot; =&gt; &quot;2099&quot;&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            &quot;share&quot; =&gt; true&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\PaymentInstrumentType::CREDIT_CARD, $transaction-&gt;paymentInstrumentType);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCloneTransactionAndSubmitForSettlement()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/2011', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>      $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cloneResult = Braintree\Transaction::cloneTransaction($transaction-&gt;id, ['amount' =&gt; '123.45', 'options' =&gt; ['submitForSettlement' =&gt; true]]);&nbsp;</div></li><li><div>      $cloneTransaction = $cloneResult-&gt;transaction;&nbsp;</div></li><li><div>      $this-&gt;assertEquals('submitted_for_settlement', $cloneTransaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCloneWithValidations()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::credit([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/2011'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>      $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>      $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cloneResult = Braintree\Transaction::cloneTransaction($transaction-&gt;id, ['amount' =&gt; '123.45']);&nbsp;</div></li><li><div>      $this-&gt;assertFalse($cloneResult-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $baseErrors = $cloneResult-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_CANNOT_CLONE_CREDIT, $baseErrors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;processorAuthorizationCode);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $transaction-&gt;creditCardDetails-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $transaction-&gt;creditCardDetails-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('The Cardholder', $transaction-&gt;creditCardDetails-&gt;cardholderName);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSaleWithAccessToken()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $credentials = Test\Braintree\OAuthTestHelper::createCredentials([&nbsp;</div></li><li><div>            'clientId' =&gt; 'client_id$development$integration_client_id', &nbsp;</div></li><li><div>            'clientSecret' =&gt; 'client_secret$development$integration_client_secret', &nbsp;</div></li><li><div>            'merchantId' =&gt; 'integration_merchant_id', &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $gateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'accessToken' =&gt; $credentials-&gt;accessToken, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;transaction()-&gt;sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;processorAuthorizationCode);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $transaction-&gt;creditCardDetails-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $transaction-&gt;creditCardDetails-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('The Cardholder', $transaction-&gt;creditCardDetails-&gt;cardholderName);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSaleWithRiskData()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;riskData);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;riskData-&gt;decision);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRecurring()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'recurring' =&gt; true, &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $transaction-&gt;recurring);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testTransactionSourceWithRecurring()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'transactionSource' =&gt; 'recurring', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $transaction-&gt;recurring);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testTransactionSourceWithMoto()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'transactionSource' =&gt; 'moto', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(False, $transaction-&gt;recurring);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withServiceFee()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '10.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultSubMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'serviceFeeAmount' =&gt; '1.00'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('1.00', $transaction-&gt;serviceFeeAmount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_isInvalidIfTransactionMerchantAccountIsNotSub()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '10.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'serviceFeeAmount' =&gt; '1.00'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $serviceFeeErrors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('serviceFeeAmount');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_SERVICE_FEE_AMOUNT_NOT_ALLOWED_ON_MASTER_MERCHANT_ACCOUNT, $serviceFeeErrors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_isInvalidIfSubMerchantAccountHasNoServiceFee()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '10.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultSubMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $serviceFeeErrors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('merchantAccountId');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_SUB_MERCHANT_ACCOUNT_REQUIRES_SERVICE_FEE_AMOUNT, $serviceFeeErrors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withVenmoSdkSession()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '10.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'venmoSdkSession' =&gt; Braintree\Test\VenmoSdk::getTestSession()&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $transaction-&gt;creditCardDetails-&gt;venmoSdk);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withVenmoSdkPaymentMethodCode()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '10.00', &nbsp;</div></li><li><div>            'venmoSdkPaymentMethodCode' =&gt; Braintree\Test\VenmoSdk::$visaPaymentMethodCode&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;411111&quot;, $transaction-&gt;creditCardDetails-&gt;bin);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withLevel2Attributes()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/2011', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'taxExempt' =&gt; true, &nbsp;</div></li><li><div>            'taxAmount' =&gt; '10.00', &nbsp;</div></li><li><div>            'purchaseOrderNumber' =&gt; '12345'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($transaction-&gt;taxExempt);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('10.00', $transaction-&gt;taxAmount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('12345', $transaction-&gt;purchaseOrderNumber);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withInvalidTaxAmountAttribute()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/2011', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'taxAmount' =&gt; 'abc'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $taxAmountErrors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('taxAmount');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_TAX_AMOUNT_FORMAT_IS_INVALID, $taxAmountErrors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withServiceFeeTooLarge()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '10.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultSubMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'serviceFeeAmount' =&gt; '20.00'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('serviceFeeAmount');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_SERVICE_FEE_AMOUNT_IS_TOO_LARGE, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withTooLongPurchaseOrderAttribute()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/2011', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'purchaseOrderNumber' =&gt; 'aaaaaaaaaaaaaaaaaa'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $purchaseOrderNumberErrors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('purchaseOrderNumber');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_PURCHASE_ORDER_NUMBER_IS_TOO_LONG, $purchaseOrderNumberErrors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withInvalidPurchaseOrderNumber()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/2011', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'purchaseOrderNumber' =&gt; &quot;\x80\x90\xA0&quot;&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $purchaseOrderNumberErrors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('purchaseOrderNumber');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_PURCHASE_ORDER_NUMBER_IS_INVALID, $purchaseOrderNumberErrors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withAllAttributes()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'orderId' =&gt; '123', &nbsp;</div></li><li><div>            'channel' =&gt; 'MyShoppingCardProvider', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/2011', &nbsp;</div></li><li><div>                'cvv' =&gt; '123'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'customer' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Dan', &nbsp;</div></li><li><div>                'lastName' =&gt; 'Smith', &nbsp;</div></li><li><div>                'company' =&gt; 'Braintree', &nbsp;</div></li><li><div>                'email' =&gt; 'dan@example.com', &nbsp;</div></li><li><div>                'phone' =&gt; '419-555-1234', &nbsp;</div></li><li><div>                'fax' =&gt; '419-555-1235', &nbsp;</div></li><li><div>                'website' =&gt; 'http://braintreepayments.com'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'billing' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Carl', &nbsp;</div></li><li><div>                'lastName' =&gt; 'Jones', &nbsp;</div></li><li><div>                'company' =&gt; 'Braintree', &nbsp;</div></li><li><div>                'streetAddress' =&gt; '123 E Main St', &nbsp;</div></li><li><div>                'extendedAddress' =&gt; 'Suite 403', &nbsp;</div></li><li><div>                'locality' =&gt; 'Chicago', &nbsp;</div></li><li><div>                'region' =&gt; 'IL', &nbsp;</div></li><li><div>                'postalCode' =&gt; '60622', &nbsp;</div></li><li><div>                'countryName' =&gt; 'United States of America', &nbsp;</div></li><li><div>                'countryCodeAlpha2' =&gt; 'US', &nbsp;</div></li><li><div>                'countryCodeAlpha3' =&gt; 'USA', &nbsp;</div></li><li><div>                'countryCodeNumeric' =&gt; '840'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'shipping' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Andrew', &nbsp;</div></li><li><div>                'lastName' =&gt; 'Mason', &nbsp;</div></li><li><div>                'company' =&gt; 'Braintree', &nbsp;</div></li><li><div>                'streetAddress' =&gt; '456 W Main St', &nbsp;</div></li><li><div>                'extendedAddress' =&gt; 'Apt 2F', &nbsp;</div></li><li><div>                'locality' =&gt; 'Bartlett', &nbsp;</div></li><li><div>                'region' =&gt; 'IL', &nbsp;</div></li><li><div>                'postalCode' =&gt; '60103', &nbsp;</div></li><li><div>                'countryName' =&gt; 'United States of America', &nbsp;</div></li><li><div>                'countryCodeAlpha2' =&gt; 'US', &nbsp;</div></li><li><div>                'countryCodeAlpha3' =&gt; 'USA', &nbsp;</div></li><li><div>                'countryCodeNumeric' =&gt; '840'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        Test\Helper::assertPrintable($result);&nbsp;</div></li><li><div>      $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>      $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertNotNull($transaction-&gt;id);&nbsp;</div></li><li><div>      $this-&gt;assertNotNull($transaction-&gt;createdAt);&nbsp;</div></li><li><div>      $this-&gt;assertNotNull($transaction-&gt;updatedAt);&nbsp;</div></li><li><div>      $this-&gt;assertNull($transaction-&gt;refundId);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertEquals(Test\Helper::defaultMerchantAccountId(), $transaction-&gt;merchantAccountId);&nbsp;</div></li><li><div>      $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>      $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('USD', $transaction-&gt;currencyIsoCode);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('123', $transaction-&gt;orderId);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('MyShoppingCardProvider', $transaction-&gt;channel);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('MasterCard', $transaction-&gt;creditCardDetails-&gt;cardType);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('1000', $transaction-&gt;processorResponseCode);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Approved', $transaction-&gt;processorResponseText);&nbsp;</div></li><li><div>      $this-&gt;assertNull($transaction-&gt;voiceReferralNumber);&nbsp;</div></li><li><div>      $this-&gt;assertFalse($transaction-&gt;taxExempt);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertEquals('M', $transaction-&gt;avsPostalCodeResponseCode);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('M', $transaction-&gt;avsStreetAddressResponseCode);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('M', $transaction-&gt;cvvResponseCode);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Dan', $transaction-&gt;customerDetails-&gt;firstName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Smith', $transaction-&gt;customerDetails-&gt;lastName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Braintree', $transaction-&gt;customerDetails-&gt;company);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('dan@example.com', $transaction-&gt;customerDetails-&gt;email);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('419-555-1234', $transaction-&gt;customerDetails-&gt;phone);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('419-555-1235', $transaction-&gt;customerDetails-&gt;fax);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('http://braintreepayments.com', $transaction-&gt;customerDetails-&gt;website);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Carl', $transaction-&gt;billingDetails-&gt;firstName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Jones', $transaction-&gt;billingDetails-&gt;lastName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Braintree', $transaction-&gt;billingDetails-&gt;company);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('123 E Main St', $transaction-&gt;billingDetails-&gt;streetAddress);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Suite 403', $transaction-&gt;billingDetails-&gt;extendedAddress);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Chicago', $transaction-&gt;billingDetails-&gt;locality);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('IL', $transaction-&gt;billingDetails-&gt;region);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('60622', $transaction-&gt;billingDetails-&gt;postalCode);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('United States of America', $transaction-&gt;billingDetails-&gt;countryName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('US', $transaction-&gt;billingDetails-&gt;countryCodeAlpha2);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('USA', $transaction-&gt;billingDetails-&gt;countryCodeAlpha3);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('840', $transaction-&gt;billingDetails-&gt;countryCodeNumeric);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Andrew', $transaction-&gt;shippingDetails-&gt;firstName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Mason', $transaction-&gt;shippingDetails-&gt;lastName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Braintree', $transaction-&gt;shippingDetails-&gt;company);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('456 W Main St', $transaction-&gt;shippingDetails-&gt;streetAddress);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Apt 2F', $transaction-&gt;shippingDetails-&gt;extendedAddress);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('Bartlett', $transaction-&gt;shippingDetails-&gt;locality);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('IL', $transaction-&gt;shippingDetails-&gt;region);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('60103', $transaction-&gt;shippingDetails-&gt;postalCode);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('United States of America', $transaction-&gt;shippingDetails-&gt;countryName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('US', $transaction-&gt;shippingDetails-&gt;countryCodeAlpha2);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('USA', $transaction-&gt;shippingDetails-&gt;countryCodeAlpha3);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('840', $transaction-&gt;shippingDetails-&gt;countryCodeNumeric);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;assertNotNull($transaction-&gt;processorAuthorizationCode);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('510510', $transaction-&gt;creditCardDetails-&gt;bin);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('5100', $transaction-&gt;creditCardDetails-&gt;last4);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('510510******5100', $transaction-&gt;creditCardDetails-&gt;maskedNumber);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('The Cardholder', $transaction-&gt;creditCardDetails-&gt;cardholderName);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('05', $transaction-&gt;creditCardDetails-&gt;expirationMonth);&nbsp;</div></li><li><div>      $this-&gt;assertEquals('2011', $transaction-&gt;creditCardDetails-&gt;expirationYear);&nbsp;</div></li><li><div>      $this-&gt;assertNotNull($transaction-&gt;creditCardDetails-&gt;imageUrl);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withCustomFields()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'customFields' =&gt; [&nbsp;</div></li><li><div>                'store_me' =&gt; 'custom value'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $customFields = $transaction-&gt;customFields;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('custom value', $customFields['store_me']);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withExpirationMonthAndYear()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationMonth' =&gt; '5', &nbsp;</div></li><li><div>                'expirationYear' =&gt; '2012'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('05', $transaction-&gt;creditCardDetails-&gt;expirationMonth);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('2012', $transaction-&gt;creditCardDetails-&gt;expirationYear);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_underscoresAllCustomFields()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'customFields' =&gt; [&nbsp;</div></li><li><div>                'storeMe' =&gt; 'custom value'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $customFields = $transaction-&gt;customFields;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('custom value', $customFields['store_me']);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withInvalidCustomField()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'customFields' =&gt; [&nbsp;</div></li><li><div>                'invalidKey' =&gt; 'custom value'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('customFields');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_CUSTOM_FIELD_IS_INVALID, $errors[0]-&gt;code);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Custom field is invalid: invalidKey.', $errors[0]-&gt;message);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withMerchantAccountId()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Test\Helper::nonDefaultMerchantAccountId(), $transaction-&gt;merchantAccountId);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withoutMerchantAccountIdFallsBackToDefault()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Test\Helper::defaultMerchantAccountId(), $transaction-&gt;merchantAccountId);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withShippingAddressId()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $customer = Braintree\Customer::create([&nbsp;</div></li><li><div>            'firstName' =&gt; 'Mike', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$visa, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ])-&gt;customer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $address = Braintree\Address::create([&nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'streetAddress' =&gt; '123 Fake St.'&nbsp;</div></li><li><div> ])-&gt;address;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'shippingAddressId' =&gt; $address-&gt;id&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('123 Fake St.', $transaction-&gt;shippingDetails-&gt;streetAddress);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($address-&gt;id, $transaction-&gt;shippingDetails-&gt;id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withBillingAddressId()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $customer = Braintree\Customer::create([&nbsp;</div></li><li><div>            'firstName' =&gt; 'Mike', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$visa, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ])-&gt;customer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $address = Braintree\Address::create([&nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'streetAddress' =&gt; '123 Fake St.'&nbsp;</div></li><li><div> ])-&gt;address;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'billingAddressId' =&gt; $address-&gt;id&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('123 Fake St.', $transaction-&gt;billingDetails-&gt;streetAddress);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($address-&gt;id, $transaction-&gt;billingDetails-&gt;id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSaleNoValidate()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $transaction-&gt;creditCardDetails-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $transaction-&gt;creditCardDetails-&gt;last4);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withProcessorDecline()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$decline, &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::PROCESSOR_DECLINED, $result-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(2000, $result-&gt;transaction-&gt;processorResponseCode);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;Do Not Honor&quot;, $result-&gt;transaction-&gt;processorResponseText);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;2000 : Do Not Honor&quot;, $result-&gt;transaction-&gt;additionalProcessorResponse);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withExistingCustomer()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $customer = Braintree\Customer::create([&nbsp;</div></li><li><div>            'firstName' =&gt; 'Mike', &nbsp;</div></li><li><div>            'lastName' =&gt; 'Jones', &nbsp;</div></li><li><div>            'company' =&gt; 'Jones Co.', &nbsp;</div></li><li><div>            'email' =&gt; 'mike.jones@example.com', &nbsp;</div></li><li><div>            'phone' =&gt; '419.555.1234', &nbsp;</div></li><li><div>            'fax' =&gt; '419.555.1235', &nbsp;</div></li><li><div>            'website' =&gt; 'http://example.com'&nbsp;</div></li><li><div> ])-&gt;customer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$visa, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ])-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals($transaction-&gt;creditCardDetails-&gt;maskedNumber, '401288******1881');&nbsp;</div></li><li><div>        $this-&gt;assertNull($transaction-&gt;vaultCreditCard());&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_andStoreShippingAddressInVault()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $customer = Braintree\Customer::create([&nbsp;</div></li><li><div>            'firstName' =&gt; 'Mike', &nbsp;</div></li><li><div>            'lastName' =&gt; 'Jones', &nbsp;</div></li><li><div>            'company' =&gt; 'Jones Co.', &nbsp;</div></li><li><div>            'email' =&gt; 'mike.jones@example.com', &nbsp;</div></li><li><div>            'phone' =&gt; '419.555.1234', &nbsp;</div></li><li><div>            'fax' =&gt; '419.555.1235', &nbsp;</div></li><li><div>            'website' =&gt; 'http://example.com'&nbsp;</div></li><li><div> ])-&gt;customer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$visa, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'shipping' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Darren', &nbsp;</div></li><li><div>                'lastName' =&gt; 'Stevens'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'storeInVault' =&gt; true, &nbsp;</div></li><li><div>                'storeShippingAddressInVault' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ])-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $customer = Braintree\Customer::find($customer-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Darren', $customer-&gt;addresses[0]-&gt;firstName);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Stevens', $customer-&gt;addresses[0]-&gt;lastName);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withExistingCustomer_storeInVault()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $customer = Braintree\Customer::create([&nbsp;</div></li><li><div>            'firstName' =&gt; 'Mike', &nbsp;</div></li><li><div>            'lastName' =&gt; 'Jones', &nbsp;</div></li><li><div>            'company' =&gt; 'Jones Co.', &nbsp;</div></li><li><div>            'email' =&gt; 'mike.jones@example.com', &nbsp;</div></li><li><div>            'phone' =&gt; '419.555.1234', &nbsp;</div></li><li><div>            'fax' =&gt; '419.555.1235', &nbsp;</div></li><li><div>            'website' =&gt; 'http://example.com'&nbsp;</div></li><li><div> ])-&gt;customer;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$visa, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'storeInVault' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ])-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals($transaction-&gt;creditCardDetails-&gt;maskedNumber, '401288******1881');&nbsp;</div></li><li><div>        $this-&gt;assertEquals($transaction-&gt;vaultCreditCard()-&gt;maskedNumber, '401288******1881');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCredit()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::credit([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::CREDIT, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $transaction-&gt;creditCardDetails-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $transaction-&gt;creditCardDetails-&gt;last4);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreditNoValidate()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::creditNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::CREDIT, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $transaction-&gt;creditCardDetails-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $transaction-&gt;creditCardDetails-&gt;last4);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCredit_withMerchantAccountId()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::credit([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Test\Helper::nonDefaultMerchantAccountId(), $transaction-&gt;merchantAccountId);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCredit_withoutMerchantAccountIdFallsBackToDefault()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::credit([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Test\Helper::defaultMerchantAccountId(), $transaction-&gt;merchantAccountId);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCredit_withServiceFeeNotAllowed()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::credit([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'serviceFeeAmount' =&gt; '12.75'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_SERVICE_FEE_IS_NOT_ALLOWED_ON_CREDITS, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlement_nullAmount()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForSettlement($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $submitResult-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submitResult-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $submitResult-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlement_amountLessThanServiceFee()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '10.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultSubMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'serviceFeeAmount' =&gt; '5.00'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForSettlement($transaction-&gt;id, '1.00');&nbsp;</div></li><li><div>        $errors = $submitResult-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('amount');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_SETTLEMENT_AMOUNT_IS_LESS_THAN_SERVICE_FEE_AMOUNT, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlement_withAmount()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForSettlement($transaction-&gt;id, '50.00');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $submitResult-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submitResult-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('50.00', $submitResult-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlement_withOrderId()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForSettlement($transaction-&gt;id, '67.00', ['orderId' =&gt; 'ABC123']);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $submitResult-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submitResult-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('ABC123', $submitResult-&gt;transaction-&gt;orderId);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('67.00', $submitResult-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlement_withDescriptor()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = [&nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; '123*123456789012345678', &nbsp;</div></li><li><div>                'phone' =&gt; '3334445555', &nbsp;</div></li><li><div>                'url' =&gt; 'ebay.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForSettlement($transaction-&gt;id, '67.00', $params);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $submitResult-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submitResult-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('123*123456789012345678', $submitResult-&gt;transaction-&gt;descriptor-&gt;name);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('3334445555', $submitResult-&gt;transaction-&gt;descriptor-&gt;phone);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('ebay.com', $submitResult-&gt;transaction-&gt;descriptor-&gt;url);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlement_withInvalidParams()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = ['invalid' =&gt; 'invalid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('InvalidArgumentException', 'invalid keys: invalid');&nbsp;</div></li><li><div>        Braintree\Transaction::submitForSettlement($transaction-&gt;id, '67.00', $params);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlementNoValidate_whenValidWithoutAmount()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $submittedTransaction = Braintree\Transaction::submitForSettlementNoValidate($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submittedTransaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $submittedTransaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlementNoValidate_whenValidWithAmount()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $submittedTransaction = Braintree\Transaction::submitForSettlementNoValidate($transaction-&gt;id, '99.00');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submittedTransaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('99.00', $submittedTransaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlementNoValidate_whenInvalid()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\ValidationsFailed');&nbsp;</div></li><li><div>        $submittedTransaction = Braintree\Transaction::submitForSettlementNoValidate($transaction-&gt;id, '101.00');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testUpdateDetails()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $updateOptions = [&nbsp;</div></li><li><div>            'amount' =&gt; '90.00', &nbsp;</div></li><li><div>            'orderId' =&gt; '123', &nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; '123*123456789012345678', &nbsp;</div></li><li><div>                'phone' =&gt; '3334445555', &nbsp;</div></li><li><div>                'url' =&gt; 'ebay.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::updateDetails($transaction-&gt;id, $updateOptions);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $result-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('90.00', $result-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testUpdateDetails_withInvalidParams()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $updateOptions = [&nbsp;</div></li><li><div>            'amount' =&gt; '90.00', &nbsp;</div></li><li><div>            'invalid' =&gt; 'some value'&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('InvalidArgumentException', 'invalid keys: invalid');&nbsp;</div></li><li><div>        Braintree\Transaction::updateDetails($transaction-&gt;id, $updateOptions);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testUpdateDetails_withInvalidAmount()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $updateOptions = [&nbsp;</div></li><li><div>            'amount' =&gt; '900.00', &nbsp;</div></li><li><div>            'orderId' =&gt; '123', &nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; '123*123456789012345678', &nbsp;</div></li><li><div>                'phone' =&gt; '3334445555', &nbsp;</div></li><li><div>                'url' =&gt; 'ebay.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::updateDetails($transaction-&gt;id, $updateOptions);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('amount');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_SETTLEMENT_AMOUNT_IS_TOO_LARGE, $errors[0]-&gt;code);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testUpdateDetails_withInvalidDescriptor()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $updateOptions = [&nbsp;</div></li><li><div>            'amount' =&gt; '90.00', &nbsp;</div></li><li><div>            'orderId' =&gt; '123', &nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; 'invalid name', &nbsp;</div></li><li><div>                'phone' =&gt; 'invalid phone', &nbsp;</div></li><li><div>                'url' =&gt; 'invalid way too long url'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::updateDetails($transaction-&gt;id, $updateOptions);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('descriptor')-&gt;onAttribute('name');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::DESCRIPTOR_NAME_FORMAT_IS_INVALID, $errors[0]-&gt;code);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('descriptor')-&gt;onAttribute('phone');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::DESCRIPTOR_PHONE_FORMAT_IS_INVALID, $errors[0]-&gt;code);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('descriptor')-&gt;onAttribute('url');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::DESCRIPTOR_URL_FORMAT_IS_INVALID, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testUpdateDetails_withInvalidOrderId()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $updateOptions = [&nbsp;</div></li><li><div>            'amount' =&gt; '90.00', &nbsp;</div></li><li><div>            'orderId' =&gt; str_repeat('x', 256), &nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; '123*123456789012345678', &nbsp;</div></li><li><div>                'phone' =&gt; '3334445555', &nbsp;</div></li><li><div>                'url' =&gt; 'ebay.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::updateDetails($transaction-&gt;id, $updateOptions);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('orderId');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_ORDER_ID_IS_TOO_LONG, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testUpdateDetails_withInvalidProcessor()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::fakeAmexDirectMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$amexPayWithPoints['Success'], &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $updateOptions = [&nbsp;</div></li><li><div>            'amount' =&gt; '90.00', &nbsp;</div></li><li><div>            'orderId' =&gt; '123', &nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; '123*123456789012345678', &nbsp;</div></li><li><div>                'phone' =&gt; '3334445555', &nbsp;</div></li><li><div>                'url' =&gt; 'ebay.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::updateDetails($transaction-&gt;id, $updateOptions);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_PROCESSOR_DOES_NOT_SUPPORT_UPDATING_DETAILS, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testUpdateDetails_withBadStatus()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $updateOptions = [&nbsp;</div></li><li><div>            'amount' =&gt; '90.00', &nbsp;</div></li><li><div>            'orderId' =&gt; '123', &nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; '123*123456789012345678', &nbsp;</div></li><li><div>                'phone' =&gt; '3334445555', &nbsp;</div></li><li><div>                'url' =&gt; 'ebay.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::updateDetails($transaction-&gt;id, $updateOptions);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_CANNOT_UPDATE_DETAILS_NOT_SUBMITTED_FOR_SETTLEMENT, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testVoid()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $voidResult = Braintree\Transaction::void($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $voidResult-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::VOIDED, $voidResult-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function test_countryValidationError_inconsistency()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'billing' =&gt; [&nbsp;</div></li><li><div>                'countryCodeAlpha2' =&gt; 'AS', &nbsp;</div></li><li><div>                'countryCodeAlpha3' =&gt; 'USA'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('billing')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::ADDRESS_INCONSISTENT_COUNTRY, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function test_countryValidationError_incorrectAlpha2()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'billing' =&gt; [&nbsp;</div></li><li><div>                'countryCodeAlpha2' =&gt; 'ZZ'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('billing')-&gt;onAttribute('countryCodeAlpha2');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::ADDRESS_COUNTRY_CODE_ALPHA2_IS_NOT_ACCEPTED, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function test_countryValidationError_incorrectAlpha3()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'billing' =&gt; [&nbsp;</div></li><li><div>                'countryCodeAlpha3' =&gt; 'ZZZ'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('billing')-&gt;onAttribute('countryCodeAlpha3');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::ADDRESS_COUNTRY_CODE_ALPHA3_IS_NOT_ACCEPTED, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function test_countryValidationError_incorrectNumericCode()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'billing' =&gt; [&nbsp;</div></li><li><div>                'countryCodeNumeric' =&gt; '000'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('billing')-&gt;onAttribute('countryCodeNumeric');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::ADDRESS_COUNTRY_CODE_NUMERIC_IS_NOT_ACCEPTED, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testVoid_withValidationError()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $voided = Braintree\Transaction::voidNoValidate($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::VOIDED, $voided-&gt;status);&nbsp;</div></li><li><div>        $result = Braintree\Transaction::void($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(false, $result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_CANNOT_BE_VOIDED, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testVoidNoValidate()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $voided = Braintree\Transaction::voidNoValidate($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::VOIDED, $voided-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testVoidNoValidate_throwsIfNotInvalid()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $voided = Braintree\Transaction::voidNoValidate($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::VOIDED, $voided-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\ValidationsFailed');&nbsp;</div></li><li><div>        $voided = Braintree\Transaction::voidNoValidate($transaction-&gt;id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testFind()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::find($result-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $transaction-&gt;creditCardDetails-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $transaction-&gt;creditCardDetails-&gt;last4);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testFindExposesDisbursementDetails()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::find(&quot;deposittransaction&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $transaction-&gt;isDisbursed());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $disbursementDetails = $transaction-&gt;disbursementDetails;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $disbursementDetails-&gt;settlementAmount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('USD', $disbursementDetails-&gt;settlementCurrencyIsoCode);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('1', $disbursementDetails-&gt;settlementCurrencyExchangeRate);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(false, $disbursementDetails-&gt;fundsHeld);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $disbursementDetails-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(new DateTime('2013-04-10'), $disbursementDetails-&gt;disbursementDate);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testFindExposesDisputes()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::find(&quot;disputedtransaction&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $dispute = $transaction-&gt;disputes[0];&nbsp;</div></li><li><div>        $this-&gt;assertEquals('250.00', $dispute-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('USD', $dispute-&gt;currencyIsoCode);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Dispute::FRAUD, $dispute-&gt;reason);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Dispute::WON, $dispute-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(new DateTime('2014-03-01'), $dispute-&gt;receivedDate);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(new DateTime('2014-03-21'), $dispute-&gt;replyByDate);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;disputedtransaction&quot;, $dispute-&gt;transactionDetails-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;1000.00&quot;, $dispute-&gt;transactionDetails-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Dispute::CHARGEBACK, $dispute-&gt;kind);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(new DateTime('2014-03-01'), $dispute-&gt;dateOpened);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(new DateTime('2014-03-07'), $dispute-&gt;dateWon);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testFindExposesThreeDSecureInfo()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::find(&quot;threedsecuredtransaction&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $info = $transaction-&gt;threeDSecureInfo;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;Y&quot;, $info-&gt;enrolled);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;authenticate_successful&quot;, $info-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($info-&gt;liabilityShifted);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($info-&gt;liabilityShiftPossible);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testFindExposesNullThreeDSecureInfo()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::find(&quot;settledtransaction&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertNull($transaction-&gt;threeDSecureInfo);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testFindExposesRetrievals()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::find(&quot;retrievaltransaction&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $dispute = $transaction-&gt;disputes[0];&nbsp;</div></li><li><div>        $this-&gt;assertEquals('1000.00', $dispute-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('USD', $dispute-&gt;currencyIsoCode);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Dispute::RETRIEVAL, $dispute-&gt;reason);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Dispute::OPEN, $dispute-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;retrievaltransaction&quot;, $dispute-&gt;transactionDetails-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;1000.00&quot;, $dispute-&gt;transactionDetails-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testFindExposesPayPalDetails()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::find(&quot;settledtransaction&quot;);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;payerEmail);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;authorizationId);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;payerId);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;payerFirstName);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;payerLastName);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;payerStatus);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;sellerProtectionStatus);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;captureId);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;refundId);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;transactionFeeAmount);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;transactionFeeCurrencyIsoCode);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_storeInVault()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'Card Holder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'customer' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Dan', &nbsp;</div></li><li><div>                'lastName' =&gt; 'Smith', &nbsp;</div></li><li><div>                'company' =&gt; 'Braintree', &nbsp;</div></li><li><div>                'email' =&gt; 'dan@example.com', &nbsp;</div></li><li><div>                'phone' =&gt; '419-555-1234', &nbsp;</div></li><li><div>                'fax' =&gt; '419-555-1235', &nbsp;</div></li><li><div>                'website' =&gt; 'http://getbraintree.com'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'storeInVault' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;creditCardDetails-&gt;token);&nbsp;</div></li><li><div>        $creditCard = $transaction-&gt;vaultCreditCard();&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $creditCard-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $creditCard-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('05/2012', $creditCard-&gt;expirationDate);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Card Holder', $creditCard-&gt;cardholderName);&nbsp;</div></li><li><div>        $customer = $transaction-&gt;vaultCustomer();&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Dan', $customer-&gt;firstName);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Smith', $customer-&gt;lastName);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Braintree', $customer-&gt;company);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('dan@example.com', $customer-&gt;email);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('419-555-1234', $customer-&gt;phone);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('419-555-1235', $customer-&gt;fax);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('http://getbraintree.com', $customer-&gt;website);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_storeInVaultOnSuccessWithSuccessfulTransaction()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'Card Holder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'customer' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Dan', &nbsp;</div></li><li><div>                'lastName' =&gt; 'Smith', &nbsp;</div></li><li><div>                'company' =&gt; 'Braintree', &nbsp;</div></li><li><div>                'email' =&gt; 'dan@example.com', &nbsp;</div></li><li><div>                'phone' =&gt; '419-555-1234', &nbsp;</div></li><li><div>                'fax' =&gt; '419-555-1235', &nbsp;</div></li><li><div>                'website' =&gt; 'http://getbraintree.com'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'storeInVaultOnSuccess' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;creditCardDetails-&gt;token);&nbsp;</div></li><li><div>        $creditCard = $transaction-&gt;vaultCreditCard();&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $creditCard-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $creditCard-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('05/2012', $creditCard-&gt;expirationDate);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Card Holder', $creditCard-&gt;cardholderName);&nbsp;</div></li><li><div>        $customer = $transaction-&gt;vaultCustomer();&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Dan', $customer-&gt;firstName);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Smith', $customer-&gt;lastName);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Braintree', $customer-&gt;company);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('dan@example.com', $customer-&gt;email);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('419-555-1234', $customer-&gt;phone);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('419-555-1235', $customer-&gt;fax);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('http://getbraintree.com', $customer-&gt;website);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_storeInVaultOnSuccessWithFailedTransaction()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$decline, &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'Card Holder', &nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'customer' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Dan', &nbsp;</div></li><li><div>                'lastName' =&gt; 'Smith', &nbsp;</div></li><li><div>                'company' =&gt; 'Braintree', &nbsp;</div></li><li><div>                'email' =&gt; 'dan@example.com', &nbsp;</div></li><li><div>                'phone' =&gt; '419-555-1234', &nbsp;</div></li><li><div>                'fax' =&gt; '419-555-1235', &nbsp;</div></li><li><div>                'website' =&gt; 'http://getbraintree.com'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'storeInVaultOnSuccess' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertNull($transaction-&gt;creditCardDetails-&gt;token);&nbsp;</div></li><li><div>        $this-&gt;assertNull($transaction-&gt;vaultCreditCard());&nbsp;</div></li><li><div>        $this-&gt;assertNull($transaction-&gt;customerDetails-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertNull($transaction-&gt;vaultCustomer());&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withFraudParams()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'deviceSessionId' =&gt; '123abc', &nbsp;</div></li><li><div>            'fraudMerchantId' =&gt; '456', &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withRiskData()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'riskData' =&gt; [&nbsp;</div></li><li><div>                'customer_browser' =&gt; 'IE5', &nbsp;</div></li><li><div>                'customer_ip' =&gt; '192.168.0.1'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withDescriptor()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; '123*123456789012345678', &nbsp;</div></li><li><div>                'phone' =&gt; '3334445555', &nbsp;</div></li><li><div>                'url' =&gt; 'ebay.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('123*123456789012345678', $transaction-&gt;descriptor-&gt;name);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('3334445555', $transaction-&gt;descriptor-&gt;phone);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('ebay.com', $transaction-&gt;descriptor-&gt;url);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withDescriptorValidation()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; 'badcompanyname12*badproduct12', &nbsp;</div></li><li><div>                'phone' =&gt; '%bad4445555', &nbsp;</div></li><li><div>                'url' =&gt; '12345678901234'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('descriptor')-&gt;onAttribute('name');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::DESCRIPTOR_NAME_FORMAT_IS_INVALID, $errors[0]-&gt;code);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('descriptor')-&gt;onAttribute('phone');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::DESCRIPTOR_PHONE_FORMAT_IS_INVALID, $errors[0]-&gt;code);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('descriptor')-&gt;onAttribute('url');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::DESCRIPTOR_URL_FORMAT_IS_INVALID, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withHoldInEscrow()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultSubMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'holdInEscrow' =&gt; true&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'serviceFeeAmount' =&gt; '1.00'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::ESCROW_HOLD_PENDING, $transaction-&gt;escrowStatus);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withHoldInEscrowFailsForMasterMerchantAccount()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'holdInEscrow' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_CANNOT_HOLD_IN_ESCROW, &nbsp;</div></li><li><div>            $errors[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withThreeDSecureOptionRequired()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonce_for_new_card([&nbsp;</div></li><li><div>            &quot;creditCard&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;number&quot; =&gt; &quot;4111111111111111&quot;, &nbsp;</div></li><li><div>                &quot;expirationMonth&quot; =&gt; &quot;11&quot;, &nbsp;</div></li><li><div>                &quot;expirationYear&quot; =&gt; &quot;2099&quot;&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'threeDSecure' =&gt; [&nbsp;</div></li><li><div>                    'required' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::THREE_D_SECURE, $result-&gt;transaction-&gt;gatewayRejectionReason);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withThreeDSecureOptionRequiredInSnakeCase()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonce_for_new_card([&nbsp;</div></li><li><div>            &quot;creditCard&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;number&quot; =&gt; &quot;4111111111111111&quot;, &nbsp;</div></li><li><div>                &quot;expirationMonth&quot; =&gt; &quot;11&quot;, &nbsp;</div></li><li><div>                &quot;expirationYear&quot; =&gt; &quot;2099&quot;&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'three_d_secure' =&gt; [&nbsp;</div></li><li><div>                    'required' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::THREE_D_SECURE, $result-&gt;transaction-&gt;gatewayRejectionReason);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withThreeDSecureToken()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $threeDSecureToken = Test\Helper::create3DSVerification(&nbsp;</div></li><li><div>            Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div>                'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>                'expirationMonth' =&gt; '05', &nbsp;</div></li><li><div>                'expirationYear' =&gt; '2009'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'threeDSecureToken' =&gt; $threeDSecureToken&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_returnsErrorIfThreeDSecureToken()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'threeDSecureToken' =&gt; NULL&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('threeDSecureToken');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_THREE_D_SECURE_TOKEN_IS_INVALID, &nbsp;</div></li><li><div>            $errors[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_returnsErrorIf3dsLookupDataDoesNotMatchTransactionData()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $threeDSecureToken = Test\Helper::create3DSVerification(&nbsp;</div></li><li><div>            Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div>                'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>                'expirationMonth' =&gt; '05', &nbsp;</div></li><li><div>                'expirationYear' =&gt; '2009'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'threeDSecureToken' =&gt; $threeDSecureToken&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('threeDSecureToken');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_THREE_D_SECURE_TRANSACTION_DATA_DOESNT_MATCH_VERIFY, &nbsp;</div></li><li><div>            $errors[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withThreeDSecurePassThru()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'threeDSecurePassThru' =&gt; [&nbsp;</div></li><li><div>                'eciFlag' =&gt; '02', &nbsp;</div></li><li><div>                'cavv' =&gt; 'some_cavv', &nbsp;</div></li><li><div>                'xid' =&gt; 'some_xid'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $result-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_returnsErrorsWhenThreeDSecurePassThruMerchantAcountDoesNotSupportCardType()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; 'adyen_ma', &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'threeDSecurePassThru' =&gt; [&nbsp;</div></li><li><div>                'eciFlag' =&gt; '02', &nbsp;</div></li><li><div>                'cavv' =&gt; 'some_cavv', &nbsp;</div></li><li><div>                'xid' =&gt; 'some_xid'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_THREE_D_SECURE_MERCHANT_ACCOUNT_DOES_NOT_SUPPORT_CARD_TYPE, &nbsp;</div></li><li><div>            $errors-&gt;onAttribute(&quot;merchantAccountId&quot;)[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_returnsErrorsWhenThreeDSecurePassThruIsMissingEciFlag()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'threeDSecurePassThru' =&gt; [&nbsp;</div></li><li><div>                'eciFlag' =&gt; '', &nbsp;</div></li><li><div>                'cavv' =&gt; 'some_cavv', &nbsp;</div></li><li><div>                'xid' =&gt; 'some_xid'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('threeDSecurePassThru');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_THREE_D_SECURE_ECI_FLAG_IS_REQUIRED, &nbsp;</div></li><li><div>            $errors-&gt;onAttribute(&quot;eciFlag&quot;)[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_returnsErrorsWhenThreeDSecurePassThruIsMissingCavvOrXid()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'threeDSecurePassThru' =&gt; [&nbsp;</div></li><li><div>                'eciFlag' =&gt; '06', &nbsp;</div></li><li><div>                'cavv' =&gt; '', &nbsp;</div></li><li><div>                'xid' =&gt; ''&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('threeDSecurePassThru');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_THREE_D_SECURE_CAVV_IS_REQUIRED, &nbsp;</div></li><li><div>            $errors-&gt;onAttribute(&quot;cavv&quot;)[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_THREE_D_SECURE_XID_IS_REQUIRED, &nbsp;</div></li><li><div>            $errors-&gt;onAttribute(&quot;xid&quot;)[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_returnsErrorsWhenThreeDSecurePassThruEciFlagIsInvalid()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::threeDSecureMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/09'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'threeDSecurePassThru' =&gt; [&nbsp;</div></li><li><div>                'eciFlag' =&gt; 'bad_eci_flag', &nbsp;</div></li><li><div>                'cavv' =&gt; 'some_cavv', &nbsp;</div></li><li><div>                'xid' =&gt; 'some_xid'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('threeDSecurePassThru');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_THREE_D_SECURE_ECI_FLAG_IS_INVALID, &nbsp;</div></li><li><div>            $errors-&gt;onAttribute(&quot;eciFlag&quot;)[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testHoldInEscrow_afterSale()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultSubMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'serviceFeeAmount' =&gt; '1.00'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $result = Braintree\Transaction::holdInEscrow($result-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::ESCROW_HOLD_PENDING, $result-&gt;transaction-&gt;escrowStatus);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testHoldInEscrow_afterSaleFailsWithMasterMerchantAccount()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $result = Braintree\Transaction::holdInEscrow($result-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_CANNOT_HOLD_IN_ESCROW, &nbsp;</div></li><li><div>            $errors[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForRelease_FromEscrow()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = $this-&gt;createEscrowedTransaction();&nbsp;</div></li><li><div>        $result = Braintree\Transaction::releaseFromEscrow($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::ESCROW_RELEASE_PENDING, $result-&gt;transaction-&gt;escrowStatus);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForRelease_fromEscrowFailsForTransactionsNotHeldInEscrow()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $result = Braintree\Transaction::releaseFromEscrow($result-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_CANNOT_RELEASE_FROM_ESCROW, &nbsp;</div></li><li><div>            $errors[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCancelRelease_fromEscrow()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = $this-&gt;createEscrowedTransaction();&nbsp;</div></li><li><div>        $result = Braintree\Transaction::releaseFromEscrow($transaction-&gt;id);&nbsp;</div></li><li><div>        $result = Braintree\Transaction::cancelRelease($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Transaction::ESCROW_HELD, &nbsp;</div></li><li><div>            $result-&gt;transaction-&gt;escrowStatus&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCancelRelease_fromEscrowFailsIfTransactionNotSubmittedForRelease()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = $this-&gt;createEscrowedTransaction();&nbsp;</div></li><li><div>        $result = Braintree\Transaction::cancelRelease($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_CANNOT_CANCEL_RELEASE, &nbsp;</div></li><li><div>            $errors[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateFromTransparentRedirect()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        Test\Helper::suppressDeprecationWarnings();&nbsp;</div></li><li><div>        $queryString = $this-&gt;createTransactionViaTr(&nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div>                'transaction' =&gt; [&nbsp;</div></li><li><div>                    'customer' =&gt; [&nbsp;</div></li><li><div>                        'first_name' =&gt; 'First'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>                    'credit_card' =&gt; [&nbsp;</div></li><li><div>                        'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                        'expiration_date' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div>                'transaction' =&gt; [&nbsp;</div></li><li><div>                    'type' =&gt; Braintree\Transaction::SALE, &nbsp;</div></li><li><div>                    'amount' =&gt; '100.00'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $result = Braintree\Transaction::createFromTransparentRedirect($queryString);&nbsp;</div></li><li><div>        Test\Helper::assertPrintable($result);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $result-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $result-&gt;transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $result-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $creditCard = $result-&gt;transaction-&gt;creditCardDetails;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $creditCard-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $creditCard-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('US', $creditCard-&gt;customerLocation);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('MasterCard', $creditCard-&gt;cardType);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('05/2012', $creditCard-&gt;expirationDate);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510******5100', $creditCard-&gt;maskedNumber);&nbsp;</div></li><li><div>        $customer = $result-&gt;transaction-&gt;customerDetails;&nbsp;</div></li><li><div>        $this-&gt;assertequals('First', $customer-&gt;firstName);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateFromTransparentRedirectWithInvalidParams()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        Test\Helper::suppressDeprecationWarnings();&nbsp;</div></li><li><div>        $queryString = $this-&gt;createTransactionViaTr(&nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div>                'transaction' =&gt; [&nbsp;</div></li><li><div>                    'bad_key' =&gt; 'bad_value', &nbsp;</div></li><li><div>                    'customer' =&gt; [&nbsp;</div></li><li><div>                        'first_name' =&gt; 'First'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>                    'credit_card' =&gt; [&nbsp;</div></li><li><div>                        'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                        'expiration_date' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div>                'transaction' =&gt; [&nbsp;</div></li><li><div>                    'type' =&gt; Braintree\Transaction::SALE, &nbsp;</div></li><li><div>                    'amount' =&gt; '100.00'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        try {&nbsp;</div></li><li><div>            $result = Braintree\Transaction::createFromTransparentRedirect($queryString);&nbsp;</div></li><li><div>            $this-&gt;fail();&nbsp;</div></li><li><div>        } catch (Braintree\Exception\Authorization $e) {&nbsp;</div></li><li><div>            $this-&gt;assertEquals(&quot;Invalid params: transaction[bad_key]&quot;, $e-&gt;getMessage());&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateFromTransparentRedirect_withParamsInTrData()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        Test\Helper::suppressDeprecationWarnings();&nbsp;</div></li><li><div>        $queryString = $this-&gt;createTransactionViaTr(&nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div>                'transaction' =&gt; [&nbsp;</div></li><li><div>                    'type' =&gt; Braintree\Transaction::SALE, &nbsp;</div></li><li><div>                    'amount' =&gt; '100.00', &nbsp;</div></li><li><div>                    'customer' =&gt; [&nbsp;</div></li><li><div>                        'firstName' =&gt; 'First'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>                    'creditCard' =&gt; [&nbsp;</div></li><li><div>                        'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                        'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $result = Braintree\Transaction::createFromTransparentRedirect($queryString);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('100.00', $result-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $result-&gt;transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $result-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $creditCard = $result-&gt;transaction-&gt;creditCardDetails;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510', $creditCard-&gt;bin);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('5100', $creditCard-&gt;last4);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('US', $creditCard-&gt;customerLocation);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('MasterCard', $creditCard-&gt;cardType);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('05/2012', $creditCard-&gt;expirationDate);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('510510******5100', $creditCard-&gt;maskedNumber);&nbsp;</div></li><li><div>        $customer = $result-&gt;transaction-&gt;customerDetails;&nbsp;</div></li><li><div>        $this-&gt;assertequals('First', $customer-&gt;firstName);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreateFromTransparentRedirect_withValidationErrors()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        Test\Helper::suppressDeprecationWarnings();&nbsp;</div></li><li><div>        $queryString = $this-&gt;createTransactionViaTr(&nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div>                'transaction' =&gt; [&nbsp;</div></li><li><div>                    'customer' =&gt; [&nbsp;</div></li><li><div>                        'first_name' =&gt; str_repeat('x', 256), &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>                    'credit_card' =&gt; [&nbsp;</div></li><li><div>                        'number' =&gt; 'invalid', &nbsp;</div></li><li><div>                        'expiration_date' =&gt; ''&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            [&nbsp;</div></li><li><div>                'transaction' =&gt; ['type' =&gt; Braintree\Transaction::SALE]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $result = Braintree\Transaction::createFromTransparentRedirect($queryString);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('customer')-&gt;onAttribute('firstName');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::CUSTOMER_FIRST_NAME_IS_TOO_LONG, $errors[0]-&gt;code);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('creditCard')-&gt;onAttribute('number');&nbsp;</div></li><li><div>        $this-&gt;assertTrue(count($errors) &gt; 0);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('creditCard')-&gt;onAttribute('expirationDate');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::CREDIT_CARD_EXPIRATION_DATE_IS_REQUIRED, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefund()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = $this-&gt;createTransactionToRefund();&nbsp;</div></li><li><div>        $result = Braintree\Transaction::refund($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $refund = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::CREDIT, $refund-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($transaction-&gt;id, $refund-&gt;refundedTransactionId);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($refund-&gt;id, Braintree\Transaction::find($transaction-&gt;id)-&gt;refundId);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefundWithPartialAmount()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = $this-&gt;createTransactionToRefund();&nbsp;</div></li><li><div>        $result = Braintree\Transaction::refund($transaction-&gt;id, '50.00');&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::CREDIT, $result-&gt;transaction-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;50.00&quot;, $result-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testMultipleRefundsWithPartialAmounts()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = $this-&gt;createTransactionToRefund();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction1 = Braintree\Transaction::refund($transaction-&gt;id, '50.00')-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::CREDIT, $transaction1-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;50.00&quot;, $transaction1-&gt;amount);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction2 = Braintree\Transaction::refund($transaction-&gt;id, '50.00')-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::CREDIT, $transaction2-&gt;type);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;50.00&quot;, $transaction2-&gt;amount);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::find($transaction-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $expectedRefundIds = [$transaction1-&gt;id, $transaction2-&gt;id];&nbsp;</div></li><li><div>        $refundIds = $transaction-&gt;refundIds;&nbsp;</div></li><li><div>        sort($expectedRefundIds);&nbsp;</div></li><li><div>        sort($refundIds);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals($expectedRefundIds, $refundIds);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefundWithUnsuccessfulPartialAmount()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = $this-&gt;createTransactionToRefund();&nbsp;</div></li><li><div>        $result = Braintree\Transaction::refund($transaction-&gt;id, '150.00');&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('amount');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            Braintree\Error\Codes::TRANSACTION_REFUND_AMOUNT_IS_TOO_LARGE, &nbsp;</div></li><li><div>            $errors[0]-&gt;code&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefundWithOptionsParam()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = $this-&gt;createTransactionToRefund();&nbsp;</div></li><li><div>        $options = [&nbsp;</div></li><li><div>            &quot;orderId&quot; =&gt; 'abcd', &nbsp;</div></li><li><div>            &quot;amount&quot; =&gt; '1.00'&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>        $result = Braintree\Transaction::refund($transaction-&gt;id, $options);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            'abcd', &nbsp;</div></li><li><div>            $result-&gt;transaction-&gt;orderId&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            '1.00', &nbsp;</div></li><li><div>            $result-&gt;transaction-&gt;amount&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testGatewayRejectionOnApplicationIncomplete()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $gateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'clientId' =&gt; 'client_id$development$integration_client_id', &nbsp;</div></li><li><div>            'clientSecret' =&gt; 'client_secret$development$integration_client_secret'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;merchant()-&gt;create([&nbsp;</div></li><li><div>            'email' =&gt; 'name@email.com', &nbsp;</div></li><li><div>            'countryCodeAlpha3' =&gt; 'USA', &nbsp;</div></li><li><div>            'paymentMethods' =&gt; ['credit_card', 'paypal']&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $gateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'accessToken' =&gt; $result-&gt;credentials-&gt;accessToken, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $gateway-&gt;transaction()-&gt;sale([&nbsp;</div></li><li><div>            'amount' =&gt; '4000.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/20'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::APPLICATION_INCOMPLETE, $transaction-&gt;gatewayRejectionReason);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testGatewayRejectionOnAvs()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $old_merchant_id = Braintree\Configuration::merchantId();&nbsp;</div></li><li><div>        $old_public_key = Braintree\Configuration::publicKey();&nbsp;</div></li><li><div>        $old_private_key = Braintree\Configuration::privateKey();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Braintree\Configuration::merchantId('processing_rules_merchant_id');&nbsp;</div></li><li><div>        Braintree\Configuration::publicKey('processing_rules_public_key');&nbsp;</div></li><li><div>        Braintree\Configuration::privateKey('processing_rules_private_key');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'billing' =&gt; [&nbsp;</div></li><li><div>                'streetAddress' =&gt; '200 2nd Street'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Braintree\Configuration::merchantId($old_merchant_id);&nbsp;</div></li><li><div>        Braintree\Configuration::publicKey($old_public_key);&nbsp;</div></li><li><div>        Braintree\Configuration::privateKey($old_private_key);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        Test\Helper::assertPrintable($result);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AVS, $transaction-&gt;gatewayRejectionReason);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testGatewayRejectionOnAvsAndCvv()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $old_merchant_id = Braintree\Configuration::merchantId();&nbsp;</div></li><li><div>        $old_public_key = Braintree\Configuration::publicKey();&nbsp;</div></li><li><div>        $old_private_key = Braintree\Configuration::privateKey();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Braintree\Configuration::merchantId('processing_rules_merchant_id');&nbsp;</div></li><li><div>        Braintree\Configuration::publicKey('processing_rules_public_key');&nbsp;</div></li><li><div>        Braintree\Configuration::privateKey('processing_rules_private_key');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'billing' =&gt; [&nbsp;</div></li><li><div>                'postalCode' =&gt; '20000'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div>                'cvv' =&gt; '200'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Braintree\Configuration::merchantId($old_merchant_id);&nbsp;</div></li><li><div>        Braintree\Configuration::publicKey($old_public_key);&nbsp;</div></li><li><div>        Braintree\Configuration::privateKey($old_private_key);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AVS_AND_CVV, $transaction-&gt;gatewayRejectionReason);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testGatewayRejectionOnCvv()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $old_merchant_id = Braintree\Configuration::merchantId();&nbsp;</div></li><li><div>        $old_public_key = Braintree\Configuration::publicKey();&nbsp;</div></li><li><div>        $old_private_key = Braintree\Configuration::privateKey();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Braintree\Configuration::merchantId('processing_rules_merchant_id');&nbsp;</div></li><li><div>        Braintree\Configuration::publicKey('processing_rules_public_key');&nbsp;</div></li><li><div>        Braintree\Configuration::privateKey('processing_rules_private_key');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div>                'cvv' =&gt; '200'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Braintree\Configuration::merchantId($old_merchant_id);&nbsp;</div></li><li><div>        Braintree\Configuration::publicKey($old_public_key);&nbsp;</div></li><li><div>        Braintree\Configuration::privateKey($old_private_key);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::CVV, $transaction-&gt;gatewayRejectionReason);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testGatewayRejectionOnFraud()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '4000111111111511', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/17', &nbsp;</div></li><li><div>                'cvv' =&gt; '333'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::FRAUD, $result-&gt;transaction-&gt;gatewayRejectionReason);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSnapshotPlanIdAddOnsAndDiscountsFromSubscription()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $creditCard = SubscriptionHelper::createCreditCard();&nbsp;</div></li><li><div>        $plan = SubscriptionHelper::triallessPlan();&nbsp;</div></li><li><div>        $result = Braintree\Subscription::create([&nbsp;</div></li><li><div>            'paymentMethodToken' =&gt; $creditCard-&gt;token, &nbsp;</div></li><li><div>            'planId' =&gt; $plan['id'], &nbsp;</div></li><li><div>            'addOns' =&gt; [&nbsp;</div></li><li><div>                'add' =&gt; [&nbsp;</div></li><li><div>                    [&nbsp;</div></li><li><div>                        'amount' =&gt; '11.00', &nbsp;</div></li><li><div>                        'inheritedFromId' =&gt; 'increase_10', &nbsp;</div></li><li><div>                        'quantity' =&gt; 2, &nbsp;</div></li><li><div>                        'numberOfBillingCycles' =&gt; 5&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>                    [&nbsp;</div></li><li><div>                        'amount' =&gt; '21.00', &nbsp;</div></li><li><div>                        'inheritedFromId' =&gt; 'increase_20', &nbsp;</div></li><li><div>                        'quantity' =&gt; 3, &nbsp;</div></li><li><div>                        'numberOfBillingCycles' =&gt; 6&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'discounts' =&gt; [&nbsp;</div></li><li><div>                'add' =&gt; [&nbsp;</div></li><li><div>                    [&nbsp;</div></li><li><div>                        'amount' =&gt; '7.50', &nbsp;</div></li><li><div>                        'inheritedFromId' =&gt; 'discount_7', &nbsp;</div></li><li><div>                        'quantity' =&gt; 2, &nbsp;</div></li><li><div>                        'neverExpires' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = $result-&gt;subscription-&gt;transactions[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals($transaction-&gt;planId, $plan['id']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $addOns = $transaction-&gt;addOns;&nbsp;</div></li><li><div>        SubscriptionHelper::sortModificationsById($addOns);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals($addOns[0]-&gt;amount, &quot;11.00&quot;);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($addOns[0]-&gt;id, &quot;increase_10&quot;);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($addOns[0]-&gt;quantity, 2);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($addOns[0]-&gt;numberOfBillingCycles, 5);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($addOns[0]-&gt;neverExpires);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals($addOns[1]-&gt;amount, &quot;21.00&quot;);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($addOns[1]-&gt;id, &quot;increase_20&quot;);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($addOns[1]-&gt;quantity, 3);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($addOns[1]-&gt;numberOfBillingCycles, 6);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($addOns[1]-&gt;neverExpires);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $discounts = $transaction-&gt;discounts;&nbsp;</div></li><li><div>        $this-&gt;assertEquals($discounts[0]-&gt;amount, &quot;7.50&quot;);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($discounts[0]-&gt;id, &quot;discount_7&quot;);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($discounts[0]-&gt;quantity, 2);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($discounts[0]-&gt;numberOfBillingCycles, null);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($discounts[0]-&gt;neverExpires);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function createTransactionViaTr($regularParams, $trParams)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        Test\Helper::suppressDeprecationWarnings();&nbsp;</div></li><li><div>        $trData = Braintree\TransparentRedirect::transactionData(&nbsp;</div></li><li><div>            array_merge($trParams, [&quot;redirectUrl&quot; =&gt; &quot;http://www.example.com&quot;])&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        return Test\Helper::submitTrRequest(&nbsp;</div></li><li><div>            Braintree\Transaction::createTransactionUrl(), &nbsp;</div></li><li><div>            $regularParams, &nbsp;</div></li><li><div>            $trData&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function createTransactionToRefund()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; ['submitForSettlement' =&gt; true]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        Braintree\Test\Transaction::settle($transaction-&gt;id);&nbsp;</div></li><li><div>        return $transaction;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function createEscrowedTransaction()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::nonDefaultSubMerchantAccountId(), &nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'holdInEscrow' =&gt; true&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'serviceFeeAmount' =&gt; '1.00'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        Test\Helper::escrow($result-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        return $result-&gt;transaction;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCardTypeIndicators()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; CardTypeIndicators::PREPAID, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\CreditCard::PREPAID_YES, $transaction-&gt;creditCardDetails-&gt;prepaid);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $prepaid_card_transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; CardTypeIndicators::COMMERCIAL, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\CreditCard::COMMERCIAL_YES, $prepaid_card_transaction-&gt;creditCardDetails-&gt;commercial);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; CardTypeIndicators::PAYROLL, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\CreditCard::PAYROLL_YES, $transaction-&gt;creditCardDetails-&gt;payroll);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;MSA&quot;, $transaction-&gt;creditCardDetails-&gt;productId);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; CardTypeIndicators::HEALTHCARE, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\CreditCard::HEALTHCARE_YES, $transaction-&gt;creditCardDetails-&gt;healthcare);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;J3&quot;, $transaction-&gt;creditCardDetails-&gt;productId);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; CardTypeIndicators::DURBIN_REGULATED, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\CreditCard::DURBIN_REGULATED_YES, $transaction-&gt;creditCardDetails-&gt;durbinRegulated);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; CardTypeIndicators::DEBIT, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\CreditCard::DEBIT_YES, $transaction-&gt;creditCardDetails-&gt;debit);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; CardTypeIndicators::ISSUING_BANK, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;NETWORK ONLY&quot;, $transaction-&gt;creditCardDetails-&gt;issuingBank);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; CardTypeIndicators::COUNTRY_OF_ISSUANCE, &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&quot;USA&quot;, $transaction-&gt;creditCardDetails-&gt;countryOfIssuance);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withVaultedPayPal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $customer = Braintree\Customer::createNoValidate();&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        Braintree\PaymentMethod::create([&nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodToken' =&gt; $paymentMethodToken, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('payer@example.com', $transaction-&gt;paypalDetails-&gt;payerEmail);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withFuturePayPal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('payer@example.com', $transaction-&gt;paypalDetails-&gt;payerEmail);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\NotFound');&nbsp;</div></li><li><div>        Braintree\PaymentMethod::find($paymentMethodToken);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayeeEmail()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'paypalAccount' =&gt; [&nbsp;</div></li><li><div>                'payeeEmail' =&gt; 'payee@example.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('payer@example.com', $transaction-&gt;paypalDetails-&gt;payerEmail);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;payeeEmail);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\NotFound');&nbsp;</div></li><li><div>        Braintree\PaymentMethod::find($paymentMethodToken);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayeeEmailInOptions()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'paypalAccount' =&gt; [], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'payeeEmail' =&gt; 'payee@example.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('payer@example.com', $transaction-&gt;paypalDetails-&gt;payerEmail);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;payeeEmail);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\NotFound');&nbsp;</div></li><li><div>        Braintree\PaymentMethod::find($paymentMethodToken);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayeeEmailInOptionsPayPal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'paypalAccount' =&gt; [], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'paypal' =&gt; [&nbsp;</div></li><li><div>                    'payeeEmail' =&gt; 'payee@example.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('payer@example.com', $transaction-&gt;paypalDetails-&gt;payerEmail);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;payeeEmail);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\NotFound');&nbsp;</div></li><li><div>        Braintree\PaymentMethod::find($paymentMethodToken);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayPalCustomField()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'paypalAccount' =&gt; [], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'paypal' =&gt; [&nbsp;</div></li><li><div>                    'customField' =&gt; 'custom field stuff'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('custom field stuff', $transaction-&gt;paypalDetails-&gt;customField);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\NotFound');&nbsp;</div></li><li><div>        Braintree\PaymentMethod::find($paymentMethodToken);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayPalSupplementaryData()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'paypalAccount' =&gt; [], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'paypal' =&gt; [&nbsp;</div></li><li><div>                    'supplementaryData' =&gt; [&nbsp;</div></li><li><div>                        'key1' =&gt; 'value', &nbsp;</div></li><li><div>                        'key2' =&gt; 'value'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // note - supplementary data is not returned in response&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayPalDescription()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'paypalAccount' =&gt; [], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'paypal' =&gt; [&nbsp;</div></li><li><div>                    'description' =&gt; 'Product description'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('Product description', $transaction-&gt;paypalDetails-&gt;description);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayPalReturnsPaymentInstrumentType()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\PaymentInstrumentType::PAYPAL_ACCOUNT, $transaction-&gt;paymentInstrumentType);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withFuturePayPalAndVault()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'storeInVault' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('payer@example.com', $transaction-&gt;paypalDetails-&gt;payerEmail);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>        $foundPayPalAccount = Braintree\PaymentMethod::find($paymentMethodToken);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($paymentMethodToken, $foundPayPalAccount-&gt;token);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withOnetimePayPal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'access_token' =&gt; 'PAYPAL_ACCESS_TOKEN', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('payer@example.com', $transaction-&gt;paypalDetails-&gt;payerEmail);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\NotFound');&nbsp;</div></li><li><div>        Braintree\PaymentMethod::find($paymentMethodToken);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withOnetimePayPalAndDoesNotVault()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $paymentMethodToken = 'PAYPAL_TOKEN-' . strval(rand());&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'access_token' =&gt; 'PAYPAL_ACCESS_TOKEN', &nbsp;</div></li><li><div>                'token' =&gt; $paymentMethodToken&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'storeInVault' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals('payer@example.com', $transaction-&gt;paypalDetails-&gt;payerEmail);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;imageUrl);&nbsp;</div></li><li><div>        $this-&gt;assertNotNull($transaction-&gt;paypalDetails-&gt;debugId);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\NotFound');&nbsp;</div></li><li><div>        Braintree\PaymentMethod::find($paymentMethodToken);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayPalAndSubmitForSettlement()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SETTLING, $transaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayPalHandlesBadUnvalidatedNonces()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $http = new HttpClientApi(Braintree\Configuration::$global);&nbsp;</div></li><li><div>        $nonce = $http-&gt;nonceForPayPalAccount([&nbsp;</div></li><li><div>            'paypal_account' =&gt; [&nbsp;</div></li><li><div>                'access_token' =&gt; 'PAYPAL_ACCESS_TOKEN', &nbsp;</div></li><li><div>                'consent_code' =&gt; 'PAYPAL_CONSENT_CODE'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('paypalAccount')-&gt;errors;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::PAYPAL_ACCOUNT_CANNOT_HAVE_BOTH_ACCESS_TOKEN_AND_CONSENT_CODE, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testCreate_withPayPalHandlesNonExistentNonces()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; 'NON_EXISTENT_NONCE', &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;errors;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_PAYMENT_METHOD_NONCE_UNKNOWN, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testVoid_withPayPal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $voided_transaction = Braintree\Transaction::voidNoValidate($result-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::VOIDED, $voided_transaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testVoid_failsOnDeclinedPayPal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$decline, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('Braintree\Exception\ValidationsFailed');&nbsp;</div></li><li><div>        Braintree\Transaction::voidNoValidate($result-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefund_withPayPal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transactionResult = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($transactionResult-&gt;success);&nbsp;</div></li><li><div>        Braintree\Test\Transaction::settle($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::refund($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($result-&gt;transaction-&gt;type, Braintree\Transaction::CREDIT);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefund_withPayPalAssignsRefundId()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transactionResult = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($transactionResult-&gt;success);&nbsp;</div></li><li><div>        $originalTransaction = $transactionResult-&gt;transaction;&nbsp;</div></li><li><div>        Braintree\Test\Transaction::settle($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::refund($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $refundTransaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $updatedOriginalTransaction = Braintree\Transaction::find($originalTransaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($refundTransaction-&gt;id, $updatedOriginalTransaction-&gt;refundId);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefund_withPayPalAssignsRefundedTransactionId()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transactionResult = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($transactionResult-&gt;success);&nbsp;</div></li><li><div>        $originalTransaction = $transactionResult-&gt;transaction;&nbsp;</div></li><li><div>        Braintree\Test\Transaction::settle($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::refund($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $refundTransaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals($refundTransaction-&gt;refundedTransactionId, $originalTransaction-&gt;id);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefund_withPayPalFailsifAlreadyRefunded()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transactionResult = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($transactionResult-&gt;success);&nbsp;</div></li><li><div>        Braintree\Test\Transaction::settle($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $firstRefund = Braintree\Transaction::refund($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($firstRefund-&gt;success);&nbsp;</div></li><li><div>        $secondRefund = Braintree\Transaction::refund($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($secondRefund-&gt;success);&nbsp;</div></li><li><div>        $errors = $secondRefund-&gt;errors-&gt;forKey('transaction')-&gt;errors;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_HAS_ALREADY_BEEN_REFUNDED, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefund_withPayPalFailsIfNotSettled()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transactionResult = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($transactionResult-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::refund($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;errors;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_CANNOT_REFUND_UNLESS_SETTLED, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefund_partialWithPayPal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transactionResult = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($transactionResult-&gt;success);&nbsp;</div></li><li><div>        Braintree\Test\Transaction::settle($transactionResult-&gt;transaction-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::refund(&nbsp;</div></li><li><div>            $transactionResult-&gt;transaction-&gt;id, &nbsp;</div></li><li><div>            $transactionResult-&gt;transaction-&gt;amount / 2&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($result-&gt;transaction-&gt;type, Braintree\Transaction::CREDIT);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($result-&gt;transaction-&gt;amount, $transactionResult-&gt;transaction-&gt;amount / 2);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testRefund_multiplePartialWithPayPal()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $nonce = Braintree\Test\Nonces::$paypalOneTimePayment;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transactionResult = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; Braintree\Test\TransactionAmounts::$authorize, &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $nonce, &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($transactionResult-&gt;success);&nbsp;</div></li><li><div>        $originalTransaction = $transactionResult-&gt;transaction;&nbsp;</div></li><li><div>        Braintree\Test\Transaction::settle($originalTransaction-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $firstRefund = Braintree\Transaction::refund(&nbsp;</div></li><li><div>            $transactionResult-&gt;transaction-&gt;id, &nbsp;</div></li><li><div>            $transactionResult-&gt;transaction-&gt;amount / 2&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;assertTrue($firstRefund-&gt;success);&nbsp;</div></li><li><div>        $firstRefundTransaction = $firstRefund-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $secondRefund = Braintree\Transaction::refund(&nbsp;</div></li><li><div>            $transactionResult-&gt;transaction-&gt;id, &nbsp;</div></li><li><div>            $transactionResult-&gt;transaction-&gt;amount / 2&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;assertTrue($secondRefund-&gt;success);&nbsp;</div></li><li><div>        $secondRefundTransaction = $secondRefund-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $updatedOriginalTransaction = Braintree\Transaction::find($originalTransaction-&gt;id);&nbsp;</div></li><li><div>        $expectedRefundIds = [$secondRefundTransaction-&gt;id, $firstRefundTransaction-&gt;id];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $updatedRefundIds = $updatedOriginalTransaction-&gt;refundIds;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue(in_array($expectedRefundIds[0], $updatedRefundIds));&nbsp;</div></li><li><div>        $this-&gt;assertTrue(in_array($expectedRefundIds[1], $updatedRefundIds));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testIncludeProcessorSettlementResponseForSettlementDeclinedTransaction()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            &quot;paymentMethodNonce&quot; =&gt; Braintree\Test\Nonces::$paypalFuturePayment, &nbsp;</div></li><li><div>            &quot;amount&quot; =&gt; &quot;100&quot;, &nbsp;</div></li><li><div>            &quot;options&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;submitForSettlement&quot; =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        Braintree\Test\Transaction::settlementDecline($transaction-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $inline_transaction = Braintree\Transaction::find($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($inline_transaction-&gt;status, Braintree\Transaction::SETTLEMENT_DECLINED);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($inline_transaction-&gt;processorSettlementResponseCode, &quot;4001&quot;);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($inline_transaction-&gt;processorSettlementResponseText, &quot;Settlement Declined&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testIncludeProcessorSettlementResponseForSettlementPendingTransaction()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            &quot;paymentMethodNonce&quot; =&gt; Braintree\Test\Nonces::$paypalFuturePayment, &nbsp;</div></li><li><div>            &quot;amount&quot; =&gt; &quot;100&quot;, &nbsp;</div></li><li><div>            &quot;options&quot; =&gt; [&nbsp;</div></li><li><div>                &quot;submitForSettlement&quot; =&gt; true&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        Braintree\Test\Transaction::settlementPending($transaction-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $inline_transaction = Braintree\Transaction::find($transaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($inline_transaction-&gt;status, Braintree\Transaction::SETTLEMENT_PENDING);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($inline_transaction-&gt;processorSettlementResponseCode, &quot;4002&quot;);&nbsp;</div></li><li><div>        $this-&gt;assertEquals($inline_transaction-&gt;processorSettlementResponseText, &quot;Settlement Pending&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withLodgingIndustryData()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'industry' =&gt; [&nbsp;</div></li><li><div>                'industryType' =&gt; Braintree\Transaction::LODGING_INDUSTRY, &nbsp;</div></li><li><div>                'data' =&gt; [&nbsp;</div></li><li><div>                    'folioNumber' =&gt; 'aaa', &nbsp;</div></li><li><div>                    'checkInDate' =&gt; '2014-07-07', &nbsp;</div></li><li><div>                    'checkOutDate' =&gt; '2014-07-09', &nbsp;</div></li><li><div>                    'roomRate' =&gt; '239.00'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withLodgingIndustryDataValidation()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'industry' =&gt; [&nbsp;</div></li><li><div>                'industryType' =&gt; Braintree\Transaction::LODGING_INDUSTRY, &nbsp;</div></li><li><div>                'data' =&gt; [&nbsp;</div></li><li><div>                    'folioNumber' =&gt; 'aaa', &nbsp;</div></li><li><div>                    'checkInDate' =&gt; '2014-07-07', &nbsp;</div></li><li><div>                    'checkOutDate' =&gt; '2014-06-09', &nbsp;</div></li><li><div>                    'roomRate' =&gt; '239.00'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('industry')-&gt;onAttribute('checkOutDate');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::INDUSTRY_DATA_LODGING_CHECK_OUT_DATE_MUST_FOLLOW_CHECK_IN_DATE, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withTravelCruiseIndustryData()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'industry' =&gt; [&nbsp;</div></li><li><div>                'industryType' =&gt; Braintree\Transaction::TRAVEL_AND_CRUISE_INDUSTRY, &nbsp;</div></li><li><div>                'data' =&gt; [&nbsp;</div></li><li><div>                    'travelPackage' =&gt; 'flight', &nbsp;</div></li><li><div>                    'departureDate' =&gt; '2014-07-07', &nbsp;</div></li><li><div>                    'lodgingCheckInDate' =&gt; '2014-07-09', &nbsp;</div></li><li><div>                    'lodgingCheckOutDate' =&gt; '2014-07-10', &nbsp;</div></li><li><div>                    'lodgingName' =&gt; 'Disney', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withTravelCruiseIndustryDataValidation()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12', &nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'industry' =&gt; [&nbsp;</div></li><li><div>                'industryType' =&gt; Braintree\Transaction::TRAVEL_AND_CRUISE_INDUSTRY, &nbsp;</div></li><li><div>                'data' =&gt; [&nbsp;</div></li><li><div>                    'travelPackage' =&gt; 'invalid', &nbsp;</div></li><li><div>                    'departureDate' =&gt; '2014-07-07', &nbsp;</div></li><li><div>                    'lodgingCheckInDate' =&gt; '2014-07-09', &nbsp;</div></li><li><div>                    'lodgingCheckOutDate' =&gt; '2014-07-10', &nbsp;</div></li><li><div>                    'lodgingName' =&gt; 'Disney', &nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertFalse($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $errors = $result-&gt;errors-&gt;forKey('transaction')-&gt;forKey('industry')-&gt;onAttribute('travelPackage');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::INDUSTRY_DATA_TRAVEL_CRUISE_TRAVEL_PACKAGE_IS_INVALID, $errors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withAmexRewardsSucceeds()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::fakeAmexDirectMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$amexPayWithPoints['Success'], &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true, &nbsp;</div></li><li><div>                'amexRewards' =&gt; [&nbsp;</div></li><li><div>                    'requestId' =&gt; 'ABC123', &nbsp;</div></li><li><div>                    'points' =&gt; '100', &nbsp;</div></li><li><div>                    'currencyAmount' =&gt; '1.00', &nbsp;</div></li><li><div>                    'currencyIsoCode' =&gt; 'USD'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withAmexRewardsSucceedsEvenIfCardIsIneligible()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::fakeAmexDirectMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$amexPayWithPoints['IneligibleCard'], &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true, &nbsp;</div></li><li><div>                'amexRewards' =&gt; [&nbsp;</div></li><li><div>                    'requestId' =&gt; 'ABC123', &nbsp;</div></li><li><div>                    'points' =&gt; '100', &nbsp;</div></li><li><div>                    'currencyAmount' =&gt; '1.00', &nbsp;</div></li><li><div>                    'currencyIsoCode' =&gt; 'USD'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSale_withAmexRewardsSucceedsEvenIfCardBalanceIsInsufficient()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::fakeAmexDirectMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$amexPayWithPoints['InsufficientPoints'], &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'submitForSettlement' =&gt; true, &nbsp;</div></li><li><div>                'amexRewards' =&gt; [&nbsp;</div></li><li><div>                    'requestId' =&gt; 'ABC123', &nbsp;</div></li><li><div>                    'points' =&gt; '100', &nbsp;</div></li><li><div>                    'currencyAmount' =&gt; '1.00', &nbsp;</div></li><li><div>                    'currencyIsoCode' =&gt; 'USD'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlement_withAmexRewardsSucceeds()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::fakeAmexDirectMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$amexPayWithPoints['Success'], &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'amexRewards' =&gt; [&nbsp;</div></li><li><div>                    'requestId' =&gt; 'ABC123', &nbsp;</div></li><li><div>                    'points' =&gt; '100', &nbsp;</div></li><li><div>                    'currencyAmount' =&gt; '1.00', &nbsp;</div></li><li><div>                    'currencyIsoCode' =&gt; 'USD'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForSettlement($transaction-&gt;id, '47.00');&nbsp;</div></li><li><div>        $submitTransaction = $submitResult-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submitTransaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlement_withAmexRewardsSucceedsEvenIfCardIsIneligible()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::fakeAmexDirectMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$amexPayWithPoints['IneligibleCard'], &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'amexRewards' =&gt; [&nbsp;</div></li><li><div>                    'requestId' =&gt; 'ABC123', &nbsp;</div></li><li><div>                    'points' =&gt; '100', &nbsp;</div></li><li><div>                    'currencyAmount' =&gt; '1.00', &nbsp;</div></li><li><div>                    'currencyIsoCode' =&gt; 'USD'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForSettlement($transaction-&gt;id, '47.00');&nbsp;</div></li><li><div>        $submitTransaction = $submitResult-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submitTransaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForSettlement_withAmexRewardsSucceedsEvenIfCardBalanceIsInsufficient()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '47.00', &nbsp;</div></li><li><div>            'merchantAccountId' =&gt; Test\Helper::fakeAmexDirectMerchantAccountId(), &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'cardholderName' =&gt; 'The Cardholder', &nbsp;</div></li><li><div>                'number' =&gt; Braintree\Test\CreditCardNumbers::$amexPayWithPoints['InsufficientPoints'], &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ], &nbsp;</div></li><li><div>            'options' =&gt; [&nbsp;</div></li><li><div>                'amexRewards' =&gt; [&nbsp;</div></li><li><div>                    'requestId' =&gt; 'ABC123', &nbsp;</div></li><li><div>                    'points' =&gt; '100', &nbsp;</div></li><li><div>                    'currencyAmount' =&gt; '1.00', &nbsp;</div></li><li><div>                    'currencyIsoCode' =&gt; 'USD'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertTrue($result-&gt;success);&nbsp;</div></li><li><div>        $transaction = $result-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SALE, $transaction-&gt;type);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForSettlement($transaction-&gt;id, '47.00');&nbsp;</div></li><li><div>        $submitTransaction = $submitResult-&gt;transaction;&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submitTransaction-&gt;status);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForPartialSettlement()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $authorizedTransaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $authorizedTransaction-&gt;status);&nbsp;</div></li><li><div>        $partialSettlementResult1 = Braintree\Transaction::submitForPartialSettlement($authorizedTransaction-&gt;id, '60.00');&nbsp;</div></li><li><div>        $this-&gt;assertTrue($partialSettlementResult1-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $partialSettlementResult1-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('60.00', $partialSettlementResult1-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $partialSettlementResult2 = Braintree\Transaction::submitForPartialSettlement($authorizedTransaction-&gt;id, '40.00');&nbsp;</div></li><li><div>        $this-&gt;assertTrue($partialSettlementResult2-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $partialSettlementResult2-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('40.00', $partialSettlementResult2-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $refreshedAuthorizedTransaction = Braintree\Transaction::find($authorizedTransaction-&gt;id);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(2, count($refreshedAuthorizedTransaction-&gt;partialSettlementTransactionIds));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForPartialSettlementUnsuccesful()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $authorizedTransaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $authorizedTransaction-&gt;status);&nbsp;</div></li><li><div>        $partialSettlementResult1 = Braintree\Transaction::submitForPartialSettlement($authorizedTransaction-&gt;id, '60.00');&nbsp;</div></li><li><div>        $this-&gt;assertTrue($partialSettlementResult1-&gt;success);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $partialSettlementResult2 = Braintree\Transaction::submitForPartialSettlement($partialSettlementResult1-&gt;transaction-&gt;id, '10.00');&nbsp;</div></li><li><div>        $this-&gt;assertFalse($partialSettlementResult2-&gt;success);&nbsp;</div></li><li><div>        $baseErrors = $partialSettlementResult2-&gt;errors-&gt;forKey('transaction')-&gt;onAttribute('base');&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Error\Codes::TRANSACTION_CANNOT_SUBMIT_FOR_PARTIAL_SETTLEMENT, $baseErrors[0]-&gt;code);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForPartialSettlement_withOrderId()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForPartialSettlement($transaction-&gt;id, '67.00', ['orderId' =&gt; 'ABC123']);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $submitResult-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submitResult-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('ABC123', $submitResult-&gt;transaction-&gt;orderId);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('67.00', $submitResult-&gt;transaction-&gt;amount);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForPartialSettlement_withDescriptor()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = [&nbsp;</div></li><li><div>            'descriptor' =&gt; [&nbsp;</div></li><li><div>                'name' =&gt; '123*123456789012345678', &nbsp;</div></li><li><div>                'phone' =&gt; '3334445555', &nbsp;</div></li><li><div>                'url' =&gt; 'ebay.com'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::AUTHORIZED, $transaction-&gt;status);&nbsp;</div></li><li><div>        $submitResult = Braintree\Transaction::submitForPartialSettlement($transaction-&gt;id, '67.00', $params);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(true, $submitResult-&gt;success);&nbsp;</div></li><li><div>        $this-&gt;assertEquals(Braintree\Transaction::SUBMITTED_FOR_SETTLEMENT, $submitResult-&gt;transaction-&gt;status);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('123*123456789012345678', $submitResult-&gt;transaction-&gt;descriptor-&gt;name);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('3334445555', $submitResult-&gt;transaction-&gt;descriptor-&gt;phone);&nbsp;</div></li><li><div>        $this-&gt;assertEquals('ebay.com', $submitResult-&gt;transaction-&gt;descriptor-&gt;url);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function testSubmitForPartialSettlement_withInvalidParams()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $transaction = Braintree\Transaction::saleNoValidate([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'creditCard' =&gt; [&nbsp;</div></li><li><div>                'number' =&gt; '5105105105105100', &nbsp;</div></li><li><div>                'expirationDate' =&gt; '05/12'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params = ['invalid' =&gt; 'invalid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;setExpectedException('InvalidArgumentException', 'invalid keys: invalid');&nbsp;</div></li><li><div>        Braintree\Transaction::submitForPartialSettlement($transaction-&gt;id, '67.00', $params);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function testFacilitatorDetailsAreReturnedOnTransactionsCreatedViaNonceGranting()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $partnerMerchantGateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'environment' =&gt; 'development', &nbsp;</div></li><li><div>            'merchantId' =&gt; 'integration_merchant_public_id', &nbsp;</div></li><li><div>            'publicKey' =&gt; 'oauth_app_partner_user_public_key', &nbsp;</div></li><li><div>            'privateKey' =&gt; 'oauth_app_partner_user_private_key'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $customer = $partnerMerchantGateway-&gt;customer()-&gt;create([&nbsp;</div></li><li><div>            'firstName' =&gt; 'Joe', &nbsp;</div></li><li><div>            'lastName' =&gt; 'Brown'&nbsp;</div></li><li><div> ])-&gt;customer;&nbsp;</div></li><li><div>        $creditCard = $partnerMerchantGateway-&gt;creditCard()-&gt;create([&nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'cardholderName' =&gt; 'Adam Davis', &nbsp;</div></li><li><div>            'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>            'expirationDate' =&gt; '05/2009'&nbsp;</div></li><li><div> ])-&gt;creditCard;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $oauthAppGateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'clientId' =&gt;  'client_id$development$integration_client_id', &nbsp;</div></li><li><div>            'clientSecret' =&gt; 'client_secret$development$integration_client_secret'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $code = Test\Braintree\OAuthTestHelper::createGrant($oauthAppGateway, [&nbsp;</div></li><li><div>            'merchant_public_id' =&gt; 'integration_merchant_id', &nbsp;</div></li><li><div>            'scope' =&gt; 'grant_payment_method'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $credentials = $oauthAppGateway-&gt;oauth()-&gt;createTokenFromCode([&nbsp;</div></li><li><div>            'code' =&gt; $code, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $grantingGateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'accessToken' =&gt; $credentials-&gt;accessToken&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $grantResult = $grantingGateway-&gt;paymentMethod()-&gt;grant($creditCard-&gt;token, false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $grantResult-&gt;paymentMethodNonce-&gt;nonce&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            $result-&gt;transaction-&gt;facilitatorDetails-&gt;oauthApplicationClientId, &nbsp;</div></li><li><div>            &quot;client_id\$development\$integration_client_id&quot;&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            $result-&gt;transaction-&gt;facilitatorDetails-&gt;oauthApplicationName, &nbsp;</div></li><li><div>            &quot;PseudoShop&quot;&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertNull($result-&gt;transaction-&gt;billing[&quot;postalCode&quot;]);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function testBillingPostalCodeIsReturnedWhenRequestedOnTransactionsCreatedViaNonceGranting()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $partnerMerchantGateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'environment' =&gt; 'development', &nbsp;</div></li><li><div>            'merchantId' =&gt; 'integration_merchant_public_id', &nbsp;</div></li><li><div>            'publicKey' =&gt; 'oauth_app_partner_user_public_key', &nbsp;</div></li><li><div>            'privateKey' =&gt; 'oauth_app_partner_user_private_key'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $customer = $partnerMerchantGateway-&gt;customer()-&gt;create([&nbsp;</div></li><li><div>            'firstName' =&gt; 'Joe', &nbsp;</div></li><li><div>            'lastName' =&gt; 'Brown'&nbsp;</div></li><li><div> ])-&gt;customer;&nbsp;</div></li><li><div>        $creditCard = $partnerMerchantGateway-&gt;creditCard()-&gt;create([&nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'cardholderName' =&gt; 'Adam Davis', &nbsp;</div></li><li><div>            'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>            'expirationDate' =&gt; '05/2009', &nbsp;</div></li><li><div>            'billingAddress' =&gt; [&nbsp;</div></li><li><div>                'firstName' =&gt; 'Adam', &nbsp;</div></li><li><div>                'lastName' =&gt; 'Davis', &nbsp;</div></li><li><div>                'postalCode' =&gt; '95131'&nbsp;</div></li><li><div> ]&nbsp;</div></li><li><div> ])-&gt;creditCard;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $oauthAppGateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'clientId' =&gt;  'client_id$development$integration_client_id', &nbsp;</div></li><li><div>            'clientSecret' =&gt; 'client_secret$development$integration_client_secret'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $code = Test\Braintree\OAuthTestHelper::createGrant($oauthAppGateway, [&nbsp;</div></li><li><div>            'merchant_public_id' =&gt; 'integration_merchant_id', &nbsp;</div></li><li><div>            'scope' =&gt; 'grant_payment_method'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $credentials = $oauthAppGateway-&gt;oauth()-&gt;createTokenFromCode([&nbsp;</div></li><li><div>            'code' =&gt; $code, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $grantingGateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'accessToken' =&gt; $credentials-&gt;accessToken&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $grantResult = $grantingGateway-&gt;paymentMethod()-&gt;grant($creditCard-&gt;token, ['allow_vaulting' =&gt; false, 'include_billing_postal_code' =&gt; true]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = Braintree\Transaction::sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'paymentMethodNonce' =&gt; $grantResult-&gt;paymentMethodNonce-&gt;nonce&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals($result-&gt;transaction-&gt;billing[&quot;postalCode&quot;], &quot;95131&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function testTransactionsCanBeCreatedWithSharedParams()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $partnerMerchantGateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'environment' =&gt; 'development', &nbsp;</div></li><li><div>            'merchantId' =&gt; 'integration_merchant_public_id', &nbsp;</div></li><li><div>            'publicKey' =&gt; 'oauth_app_partner_user_public_key', &nbsp;</div></li><li><div>            'privateKey' =&gt; 'oauth_app_partner_user_private_key'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $customer = $partnerMerchantGateway-&gt;customer()-&gt;create([&nbsp;</div></li><li><div>            'firstName' =&gt; 'Joe', &nbsp;</div></li><li><div>            'lastName' =&gt; 'Brown'&nbsp;</div></li><li><div> ])-&gt;customer;&nbsp;</div></li><li><div>        $address = $partnerMerchantGateway-&gt;address()-&gt;create([&nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'firstName' =&gt; 'Dan', &nbsp;</div></li><li><div>            'lastName' =&gt; 'Smith', &nbsp;</div></li><li><div> ])-&gt;address;&nbsp;</div></li><li><div>        $creditCard = $partnerMerchantGateway-&gt;creditCard()-&gt;create([&nbsp;</div></li><li><div>            'customerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'cardholderName' =&gt; 'Adam Davis', &nbsp;</div></li><li><div>            'number' =&gt; '4111111111111111', &nbsp;</div></li><li><div>            'expirationDate' =&gt; '05/2009'&nbsp;</div></li><li><div> ])-&gt;creditCard;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $oauthAppGateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'clientId' =&gt;  'client_id$development$integration_client_id', &nbsp;</div></li><li><div>            'clientSecret' =&gt; 'client_secret$development$integration_client_secret'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $code = Test\Braintree\OAuthTestHelper::createGrant($oauthAppGateway, [&nbsp;</div></li><li><div>            'merchant_public_id' =&gt; 'integration_merchant_id', &nbsp;</div></li><li><div>            'scope' =&gt; 'read_write, shared_vault_transactions'&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $credentials = $oauthAppGateway-&gt;oauth()-&gt;createTokenFromCode([&nbsp;</div></li><li><div>            'code' =&gt; $code, &nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $oauthAccesTokenGateway = new Braintree\Gateway([&nbsp;</div></li><li><div>            'accessToken' =&gt; $credentials-&gt;accessToken&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = $oauthAccesTokenGateway-&gt;transaction()-&gt;sale([&nbsp;</div></li><li><div>            'amount' =&gt; '100.00', &nbsp;</div></li><li><div>            'sharedPaymentMethodToken' =&gt; $creditCard-&gt;token, &nbsp;</div></li><li><div>            'sharedCustomerId' =&gt; $customer-&gt;id, &nbsp;</div></li><li><div>            'sharedShippingAddressId' =&gt; $address-&gt;id, &nbsp;</div></li><li><div>            'sharedBillingAddressId' =&gt; $address-&gt;id&nbsp;</div></li><li><div> ]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            $result-&gt;transaction-&gt;shippingDetails-&gt;firstName, &nbsp;</div></li><li><div>            $address-&gt;firstName&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;assertEquals(&nbsp;</div></li><li><div>            $result-&gt;transaction-&gt;billingDetails-&gt;firstName, &nbsp;</div></li><li><div>            $address-&gt;firstName&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd> <a href="http://hookr.io/plugins/paid-memberships-pro/1.9/classes/test_integration_transaction_test/">1.9</a></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>Test\Integration\TransactionTest</li><li><span></span>Paid Memberships Pro</li><li><span></span>1.9</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>