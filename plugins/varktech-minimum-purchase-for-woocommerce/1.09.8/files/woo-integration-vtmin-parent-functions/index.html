<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="1.09.8" data-slug="varktech-minimum-purchase-for-woocommerce" data-type="file" data-id="90560"><head xmlns="http://www.w3.org/1999/xhtml"><title> woo-integration-vtmin-parent-functions | file | Varktech Minimum Purchase For Woocommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, varktech-minimum-purchase-for-woocommerce, 1.09.8" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=2b908e12357e0ad35c8b436ffb750d1e' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/woo-integration-vtmin-parent-functions/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwoo-integration-vtmin-parent-functions%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fwoo-integration-vtmin-parent-functions%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-varktech-minimum-purchase-for-woocommerce-1.09.8-file-woo-integration-vtmin-parent-functions","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="woo-integration-vtmin-parent-functions" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to varktech-minimum-purchase-for&hellip;." href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/" class="plugin"><span property="name">varktech-minimum-purchase-for&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.09.8." href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/" class="H_VERSION"><span property="name">1.09.8</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">woo-integration-vtmin-parent-&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="52"><a href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/all/" title="All">All <span class="count badge">52</span></a></li><li class="" data-id="new" data-count="5"><a href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/new/" title="New">New <span class="count badge">5</span></a></li><li class="" data-id="hooks" data-count="6"><a href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/hooks/" title="Hooks">Hooks <span class="count badge">6</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="6"><a href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/filters/" title="Filters">Filters <span class="count badge">6</span></a></li><li class="" data-id="class" data-count="15"><a href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/classes/" title="Classes">Classes <span class="count badge">15</span></a></li><li class="" data-id="constant" data-count="20"><a href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/constants/" title="Constants">Constants <span class="count badge">20</span></a></li><li class="" data-id="function" data-count="11"><a href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/functions/" title="Functions">Functions <span class="count badge">11</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/varktech-minimum-purchase-for-woocommerce/1.09.8/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/woo-integration/vtmin-parent-functions.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">VarkTech Minimum Purchase for WooCommerce</span>&nbsp;</div></li><li><div><span class="comment">WPSC-specific functions</span>&nbsp;</div></li><li><div><span class="comment">Parent Plugin Integration</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>  function vtmin_load_vtmin_cart_for_processing() {&nbsp;</div></li><li><div>    global $wpdb, $woocommerce, $vtmin_cart, $vtmin_cart_item, $vtmin_info; &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    <span class="comment">// from Woocommerce/templates/cart/mini-cart.php  and  Woocommerce/templates/checkout/review-order.php</span>&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>    if (sizeof($woocommerce-&gt;cart-&gt;get_cart())&gt;0) {&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>                  $woocommerce-&gt;cart-&gt;calculate_totals(); <span class="comment">//v1.09.3 calculation includes generating line subtotals, used below</span>&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $vtmin_cart = new VTMIN_Cart;  &nbsp;</div></li><li><div>        foreach ( $woocommerce-&gt;cart-&gt;get_cart() as $cart_item_key =&gt; $cart_item ) {&nbsp;</div></li><li><div>                      $_product = $cart_item['data'];&nbsp;</div></li><li><div>                      if ($_product-&gt;exists() && $cart_item['quantity']&gt;0) {&nbsp;</div></li><li><div>                          $vtmin_cart_item = new VTMIN_Cart_Item;&nbsp;</div></li><li><div>           &nbsp;</div></li><li><div>            <span class="comment">//the product id does not change in woo if variation purchased.  </span>&nbsp;</div></li><li><div>            <span class="comment">//  Load expected variation id, if there, along with constructed product title.</span>&nbsp;</div></li><li><div>            $varLabels = ' ';&nbsp;</div></li><li><div>            if ($cart_item['variation_id'] &gt; ' ') {      &nbsp;</div></li><li><div>               &nbsp;</div></li><li><div>                <span class="comment">// get parent title</span>&nbsp;</div></li><li><div>                $parent_post = get_post($cart_item['product_id']);&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                <span class="comment">// get variation names to string onto parent title</span>&nbsp;</div></li><li><div>                foreach($cart_item['variation'] as $key =&gt; $value) {          &nbsp;</div></li><li><div>                  $varLabels .= $value . '&nbsp;';           &nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>                $vtmin_cart_item-&gt;product_id = $cart_item['variation_id'];&nbsp;</div></li><li><div>                $vtmin_cart_item-&gt;product_name = $parent_post-&gt;post_title . '&nbsp;' . $varLabels ;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } else { &nbsp;</div></li><li><div>                $vtmin_cart_item-&gt;product_id = $cart_item['product_id'];&nbsp;</div></li><li><div>                $vtmin_cart_item-&gt;product_name = $_product-&gt;get_title().$woocommerce-&gt;cart-&gt;get_item_data( $cart_item );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $vtmin_cart_item-&gt;quantity = $cart_item['quantity'];&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            <span class="comment">//v1.09.3 commented unit price</span>&nbsp;</div></li><li><div>            <span class="comment">//$vtmin_cart_item-&gt;unit_price = get_option( 'woocommerce_display_cart_prices_excluding_tax' ) == 'yes' || $woocommerce-&gt;customer-&gt;is_vat_exempt() ? $_product-&gt;get_price_excluding_tax() : $_product-&gt;get_price();</span>&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">            $quantity = 1; //v1.08 vat fix</span>&nbsp;</div></li><li><div><span class="comment">            $vtmin_cart_item-&gt;unit_price = get_option( 'woocommerce_display_cart_prices_excluding_tax' ) == 'yes' || $woocommerce-&gt;customer-&gt;is_vat_exempt() ? $_product-&gt;get_price_excluding_tax() : $_product-&gt;get_price_including_tax( $quantity ); //$_product-&gt;get_price();   //v1.08 vat fix</span>&nbsp;</div></li><li><div><span class="comment">            */</span>&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            <span class="comment">//v1.09.3 begin</span>&nbsp;</div></li><li><div>            <span class="comment">//  pick up unit price from line subtotal only - </span>&nbsp;</div></li><li><div>            <span class="comment">//  will include all taxation and price adjustments from other plugins</span>&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            <span class="comment">//$vtmin_cart_item-&gt;total_price = $vtmin_cart_item-&gt;quantity * $vtmin_cart_item-&gt;unit_price;</span>&nbsp;</div></li><li><div>  <span class="comment">//          $vtmin_cart_item-&gt;total_price = $cart_item['line_subtotal'];</span>&nbsp;</div></li><li><div>  <span class="comment">//          $vtmin_cart_item-&gt;unit_price = $cart_item['line_subtotal'] / $cart_item['quantity'];</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ( get_option( 'woocommerce_calc_taxes' ) == 'no' ) ||&nbsp;</div></li><li><div>                 ( get_option( 'woocommerce_prices_include_tax' ) == 'no' ) ) {      &nbsp;</div></li><li><div>               <span class="comment">//NO VAT included in price</span>&nbsp;</div></li><li><div>               $vtmin_cart_item-&gt;unit_price =  $cart_item['line_subtotal'] / $cart_item['quantity'];  &nbsp;</div></li><li><div>               $vtmin_cart_item-&gt;total_price =  $cart_item['line_subtotal'];                                                &nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>               &nbsp;</div></li><li><div>               <span class="comment">//v1.0.7.4 begin</span>&nbsp;</div></li><li><div>               <span class="comment">//TAX included in price in DB, and Woo $cart_item pricing **has already subtracted out the TAX **, so restore the TAX</span>&nbsp;</div></li><li><div>               <span class="comment">//  this price reflects the tax situation of the ORIGINAL price - so if the price was originally entered with tax, this will reflect tax</span>&nbsp;</div></li><li><div>               $price =  $cart_item['line_subtotal']  / $cart_item['quantity'];    &nbsp;</div></li><li><div>               $qty = 1;           &nbsp;</div></li><li><div>               $_tax = new WC_Tax();                &nbsp;</div></li><li><div>              <span class="comment">// $product = get_product( $product_id ); </span>&nbsp;</div></li><li><div>               $product = wc_get_product( $vtmin_cart_item-&gt;product_id ); <span class="comment">//v1.1.7 replace get_product with wc_get_product</span>&nbsp;</div></li><li><div>               $tax_rates = $_tax-&gt;get_rates( $product-&gt;get_tax_class() );&nbsp;</div></li><li><div>                        $taxes = $_tax-&gt;calc_tax( $price  * $qty, $tax_rates, false );&nbsp;</div></li><li><div>                       $tax_amount = $_tax-&gt;get_tax_total( $taxes );&nbsp;</div></li><li><div>                       $vtmin_cart_item-&gt;unit_price = round( $price  * $qty + $tax_amount, absint( get_option( 'woocommerce_price_num_decimals' ) ) ); &nbsp;</div></li><li><div>               $vtmin_cart_item-&gt;total_price = ($vtmin_cart_item-&gt;unit_price * $cart_item['quantity']);&nbsp;</div></li><li><div>             }                             &nbsp;</div></li><li><div>            <span class="comment">//v1.09.3 end</span>&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            <span class="comment">/**  *********************************</span>&nbsp;</div></li><li><div><span class="comment">            ***  JUST the cat *ids* please...</span>&nbsp;</div></li><li><div><span class="comment">            ************************************ */</span>&nbsp;</div></li><li><div>            $vtmin_cart_item-&gt;prod_cat_list = wp_get_object_terms( $cart_item['product_id'], $vtmin_info['parent_plugin_taxonomy'], $args = array('fields' =&gt; 'ids') );&nbsp;</div></li><li><div>            $vtmin_cart_item-&gt;rule_cat_list = wp_get_object_terms( $cart_item['product_id'], $vtmin_info['rulecat_taxonomy'], $args = array('fields' =&gt; 'ids') );&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>            <span class="comment">//add cart_item to cart array</span>&nbsp;</div></li><li><div>            $vtmin_cart-&gt;cart_items[] = $vtmin_cart_item;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>      } <span class="comment">//    endforeach;</span>&nbsp;</div></li><li><div>          } &nbsp;</div></li><li><div>         &nbsp;</div></li><li><div>}      &nbsp;</div></li><li><div>&nbsp;</div></li><li><div> &nbsp;</div></li><li><div> <span class="comment">//  checked_list (o) - selection list from previous iteration of rule selection                                 </span>&nbsp;</div></li><li><div>  function vtmin_fill_variations_checklist ($tax_class, $checked_list = NULL, $product_ID, $product_variation_IDs) { &nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// *** ------------------------------------------------------------------------------------------------------- ***</span></span>&nbsp;</div></li><li><div>      <span class="comment">// additional code from:  woocommerce/admin/post-types/writepanels/writepanel-product-type-variable.php</span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// *** ------------------------------------------------------------------------------------------------------- ***</span></span>&nbsp;</div></li><li><div>      <span class="comment">//    woo doesn't keep the variation title in post title of the variation ID post, additional logic constructs the title ...</span>&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $parent_post = get_post($product_ID);&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      $attributes = (array) maybe_unserialize( get_post_meta($product_ID, '_product_attributes', true) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>      $parent_post_terms = wp_get_post_terms( $post-&gt;ID, $attribute['name'] );&nbsp;</div></li><li><div>     &nbsp;</div></li><li><div>      <span class="comment">// woo parent product title only carried on parent post</span>&nbsp;</div></li><li><div>      echo '&lt;h3&gt;' .$parent_post-&gt;post_title.    ' - Variations&lt;/h3&gt;'; &nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      foreach ($product_variation_IDs as $product_variation_ID) {     <span class="comment">//($product_variation_IDs as $product_variation_ID =&gt; $info)</span>&nbsp;</div></li><li><div>          <span class="comment">// $variation_post = get_post($product_variation_ID);</span>&nbsp;</div></li><li><div>       &nbsp;</div></li><li><div>          $output = '&lt;li id='.$product_variation_ID.'&gt;' ;&nbsp;</div></li><li><div>          $output  .= '&lt;label class=&quot;selectit&quot;&gt;' ;&nbsp;</div></li><li><div>          $output  .= '&lt;input id=&quot;'.$product_variation_ID.'_'.$tax_class.' &quot; ';&nbsp;</div></li><li><div>          $output  .= 'type=&quot;checkbox&quot; name=&quot;tax-input-' .  $tax_class . '[]&quot; ';&nbsp;</div></li><li><div>          $output  .= 'value=&quot;'.$product_variation_ID.'&quot; ';&nbsp;</div></li><li><div>          if ($checked_list) {&nbsp;</div></li><li><div>              if (in_array($product_variation_ID, $checked_list)) {   <span class="comment">//if variation is in previously checked_list   </span>&nbsp;</div></li><li><div>                 $output  .= 'checked=&quot;checked&quot;';&nbsp;</div></li><li><div>              }                &nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $output  .= '&gt;'; <span class="comment">//end input statement</span>&nbsp;</div></li><li><div> &nbsp;</div></li><li><div>          $variation_label = ''; <span class="comment">//initialize label</span>&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          <span class="comment">//get the variation names</span>&nbsp;</div></li><li><div>          foreach ($attributes as $attribute) :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  <span class="comment">// Only deal with attributes that are variations</span>&nbsp;</div></li><li><div>                                  if ( !$attribute['is_variation'] ) continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  <span class="comment">// Get current value for variation (if set)</span>&nbsp;</div></li><li><div>                                  $variation_selected_value = get_post_meta( $product_variation_ID, 'attribute_' . sanitize_title($attribute['name']), true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                  <span class="comment">// Get terms for attribute taxonomy or value if its a custom attribute</span>&nbsp;</div></li><li><div>                                  if ($attribute['is_taxonomy']) :&nbsp;</div></li><li><div>                                      $post_terms = wp_get_post_terms( $product_ID, $attribute['name'] );&nbsp;</div></li><li><div>                                      foreach ($post_terms as $term) :&nbsp;</div></li><li><div>                                          if ($variation_selected_value == $term-&gt;slug) {&nbsp;</div></li><li><div>                        $variation_label .= $term-&gt;name . '&nbsp;&nbsp;' ;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                                      endforeach;&nbsp;</div></li><li><div>                                  else :&nbsp;</div></li><li><div>                                      $options = explode('|', $attribute['value']);&nbsp;</div></li><li><div>                                      foreach ($options as $option) :&nbsp;</div></li><li><div>                                          if ($variation_selected_value == $option) {&nbsp;</div></li><li><div>                      $variation_label .= ucfirst($option) . '&nbsp;&nbsp;' ;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                                      endforeach;&nbsp;</div></li><li><div>                                  endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      endforeach;&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>          $output  .= '&nbsp;&nbsp; #' .$product_variation_ID. '&nbsp;&nbsp; - &nbsp;&nbsp;' .$variation_label;&nbsp;</div></li><li><div>          $output  .= '&lt;/label&gt;';            &nbsp;</div></li><li><div>          $output  .= '&lt;/li&gt;'; &nbsp;</div></li><li><div>          echo $output ;             &nbsp;</div></li><li><div>       }         &nbsp;</div></li><li><div>      return;   &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** ************************************************</span>&nbsp;</div></li><li><div><span class="comment">**   Get all variations for product</span>&nbsp;</div></li><li><div><span class="comment">*************************************************** */</span>&nbsp;</div></li><li><div>function vtmin_get_variations_list($product_ID) {&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  <span class="comment">//sql from woocommerce/classes/class-wc-product.php</span>&nbsp;</div></li><li><div> $variations = get_posts( array(&nbsp;</div></li><li><div>          'post_parent' =&gt; $product_ID, &nbsp;</div></li><li><div>          'posts_per_page'=&gt; -1, &nbsp;</div></li><li><div>          'post_type' =&gt; 'product_variation', &nbsp;</div></li><li><div>          'fields' =&gt; 'ids', &nbsp;</div></li><li><div>          'post_status' =&gt; 'publish', &nbsp;</div></li><li><div>    'order' =&gt; 'ASC'&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div> if ($variations)  {    &nbsp;</div></li><li><div>    $product_variations_list = array();&nbsp;</div></li><li><div>    foreach ( $variations as $variation) {&nbsp;</div></li><li><div>      $product_variations_list [] = $variation;             &nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else  {&nbsp;</div></li><li><div>    $product_variations_list;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return ($product_variations_list);&nbsp;</div></li><li><div>} &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function vtmin_test_for_variations ($prod_ID) { &nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>   $vartest_response = 'no';&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>   /** Commented =&gt; DB access method uses more IO/CPU cycles than array processing below...&nbsp;</div></li><li><div>   <span class="comment">//sql from woocommerce/classes/class-wc-product.php</span>&nbsp;</div></li><li><div>   $variations = get_posts( array(&nbsp;</div></li><li><div>              'post_parent' =&gt; $prod_ID, &nbsp;</div></li><li><div>              'posts_per_page'=&gt; -1, &nbsp;</div></li><li><div>              'post_type' =&gt; 'product_variation', &nbsp;</div></li><li><div>              'fields' =&gt; 'ids', &nbsp;</div></li><li><div>              'post_status' =&gt; 'publish'&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>   if ($variations)  {&nbsp;</div></li><li><div>      $vartest_response = 'yes';&nbsp;</div></li><li><div>   }  */&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>   <span class="comment">// code from:  woocommerce/admin/post-types/writepanels/writepanel-product-type-variable.php</span>&nbsp;</div></li><li><div>   $attributes = (array) maybe_unserialize( get_post_meta($prod_ID, '_product_attributes', true) );&nbsp;</div></li><li><div>   foreach ($attributes as $attribute) {&nbsp;</div></li><li><div>     if ($attribute['is_variation'])  {&nbsp;</div></li><li><div>        $vartest_response = 'yes';&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>     }&nbsp;</div></li><li><div>   }&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>   return ($vartest_response);   &nbsp;</div></li><li><div>}     &nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment"><span class="comment">//v1.07 begin</span></span>&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div> function vtmin_format_money_element($price) { &nbsp;</div></li><li><div>    <span class="comment">//from woocommerce/woocommerce-core-function.php   function woocommerce_price</span>&nbsp;</div></li><li><div>      $return = '';&nbsp;</div></li><li><div>      $num_decimals = (int) get_option( 'woocommerce_price_num_decimals' );&nbsp;</div></li><li><div>      $currency_pos = get_option( 'woocommerce_currency_pos' );&nbsp;</div></li><li><div>      $currency_symbol = get_woocommerce_currency_symbol();&nbsp;</div></li><li><div>      $decimal_sep = wp_specialchars_decode( stripslashes( get_option( 'woocommerce_price_decimal_sep' ) ), ENT_QUOTES );&nbsp;</div></li><li><div>      $thousands_sep = wp_specialchars_decode( stripslashes( get_option( 'woocommerce_price_thousand_sep' ) ), ENT_QUOTES );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>      $price = apply_filters( 'raw_woocommerce_price', (double) $price );&nbsp;</div></li><li><div>      $price = number_format( $price, $num_decimals, $decimal_sep, $thousands_sep );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>      if ( get_option( 'woocommerce_price_trim_zeros' ) == 'yes' && $num_decimals &gt; 0 )&nbsp;</div></li><li><div>          $price = woocommerce_trim_zeros( $price );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>      <span class="comment">//$return = '&lt;span class=&quot;amount&quot;&gt;' . sprintf( get_woocommerce_price_format(), $currency_symbol, $price ) . '&lt;/span&gt;'; </span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_version =  WOOCOMMERCE_VERSION;&nbsp;</div></li><li><div>  if( (version_compare(strval('2'), strval($current_version), '&gt;') == 1) ) {   <span class="comment">//'==1' = 2nd value is lower     </span>&nbsp;</div></li><li><div>    $formatted = number_format( $price, $num_decimals, stripslashes( get_option( 'woocommerce_price_decimal_sep' ) ), stripslashes( get_option( 'woocommerce_price_thousand_sep' ) ) );&nbsp;</div></li><li><div>    $formatted = $currency_symbol . $formatted;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>    $formatted = sprintf( get_woocommerce_price_format(), $currency_symbol, $price );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>   return $formatted;&nbsp;</div></li><li><div> }&nbsp;</div></li><li><div> &nbsp;</div></li><li><div> <span class="comment">//****************************</span>&nbsp;</div></li><li><div> <span class="comment">// Gets Currency Symbol from PARENT plugin   - only used in backend UI during rules update</span>&nbsp;</div></li><li><div> <span class="comment">//****************************</span>   &nbsp;</div></li><li><div>function vtmin_get_currency_symbol() {    &nbsp;</div></li><li><div>  return get_woocommerce_currency_symbol();  &nbsp;</div></li><li><div>} &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function vtmin_debug_options() {   <span class="comment">//v1.09 updated function</span>&nbsp;</div></li><li><div> &nbsp;</div></li><li><div>  global $vtmin_setup_options;&nbsp;</div></li><li><div>  if ( ( isset( $vtmin_setup_options['debugging_mode_on'] )) &&&nbsp;</div></li><li><div>       ( $vtmin_setup_options['debugging_mode_on'] == 'yes' ) ) {  &nbsp;</div></li><li><div>    error_reporting(E_ALL);  &nbsp;</div></li><li><div>  }  else {&nbsp;</div></li><li><div>    error_reporting(E_ERROR | E_CORE_ERROR | E_COMPILE_ERROR);    <span class="comment">//only allow FATAL error types</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//***** v1.0.5  end</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//v1.07 end</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//****************************</span>*********************************&nbsp;</div></li><li><div><span class="comment">//v1.09.8 begin - MOVED HERE from parent-cart-validation</span>&nbsp;</div></li><li><div><span class="comment">//****************************</span>*********************************&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// from woocommerce/classes/class-wc-cart.php </span>&nbsp;</div></li><li><div>function vtmin_woo_get_url ($pageName) {            &nbsp;</div></li><li><div>   global $woocommerce;&nbsp;</div></li><li><div>    $checkout_page_id = vtmin_woo_get_page_id($pageName);&nbsp;</div></li><li><div>        if ( $checkout_page_id ) {&nbsp;</div></li><li><div>            if ( is_ssl() )&nbsp;</div></li><li><div>                return str_replace( 'http:', 'https:', get_permalink($checkout_page_id) );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                return apply_filters( 'woocommerce_get_checkout_url', get_permalink($checkout_page_id) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div><span class="comment">// from woocommerce/woocommerce-core-functions.php </span>&nbsp;</div></li><li><div>function vtmin_woo_get_page_id ($pageName) { &nbsp;</div></li><li><div>  $page = apply_filters('woocommerce_get_' . $pageName . '_page_id', get_option('woocommerce_' . $pageName . '_page_id'));&nbsp;</div></li><li><div>      return ( $page ) ? $page : -1;&nbsp;</div></li><li><div>}    &nbsp;</div></li><li><div> <span class="comment">/** =============+++++++++++++++++++++++++++++++++++++++++++++++++++++++++    */</span>&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div> &nbsp;</div></li><li><div> <span class="comment"><span class="comment">//v1.07 begin</span></span>&nbsp;</div></li><li><div><span class="comment">/** ************************************************</span>&nbsp;</div></li><li><div><span class="comment">**   Application - get current page url</span>&nbsp;</div></li><li><div><span class="comment">*       </span>&nbsp;</div></li><li><div><span class="comment">*       The code checking for 'www.' is included since</span>&nbsp;</div></li><li><div><span class="comment">*       some server configurations do not respond with the</span>&nbsp;</div></li><li><div><span class="comment">*       actual info, as to whether 'www.' is part of the </span>&nbsp;</div></li><li><div><span class="comment">*       URL.  The additional code balances out the currURL, </span>&nbsp;</div></li><li><div><span class="comment">*       relative to the Parent Plugin's recorded URLs           </span>&nbsp;</div></li><li><div><span class="comment">*************************************************** */</span> &nbsp;</div></li><li><div> function vtmin_currPageURL() {&nbsp;</div></li><li><div>   global $vtmin_info;&nbsp;</div></li><li><div>   $currPageURL = vtmin_get_currPageURL();&nbsp;</div></li><li><div>   $www = 'www.';&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>   $curr_has_www = 'no';&nbsp;</div></li><li><div>   if (strpos($currPageURL, $www )) {&nbsp;</div></li><li><div>       $curr_has_www = 'yes';&nbsp;</div></li><li><div>   }&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>   <span class="comment">//use checkout URL as an example of all setup URLs</span>&nbsp;</div></li><li><div>   $checkout_has_www = 'no';&nbsp;</div></li><li><div>   if (strpos($vtmin_info['woo_checkout_url'], $www )) {&nbsp;</div></li><li><div>       $checkout_has_www = 'yes';&nbsp;</div></li><li><div>   }     &nbsp;</div></li><li><div>       &nbsp;</div></li><li><div>   switch( true ) {&nbsp;</div></li><li><div>      case ( ($curr_has_www == 'yes') && ($checkout_has_www == 'yes') ):&nbsp;</div></li><li><div>      case ( ($curr_has_www == 'no')  && ($checkout_has_www == 'no') ): &nbsp;</div></li><li><div>          <span class="comment">//all good, no action necessary</span>&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case ( ($curr_has_www == 'no') && ($checkout_has_www == 'yes') ):&nbsp;</div></li><li><div>          <span class="comment">//reconstruct the URL with 'www.' included.</span>&nbsp;</div></li><li><div>          $currPageURL = vtmin_get_currPageURL($www); &nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case ( ($curr_has_www == 'yes') && ($checkout_has_www == 'no') ): &nbsp;</div></li><li><div>          <span class="comment">//all of the woo URLs have no 'www.', and curr has it, so remove the string </span>&nbsp;</div></li><li><div>          $currPageURL = str_replace($www, &quot;&quot;, $currPageURL);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>   } &nbsp;</div></li><li><div> &nbsp;</div></li><li><div>   return $currPageURL;&nbsp;</div></li><li><div>} &nbsp;</div></li><li><div> function vtmin_get_currPageURL($www = null) {&nbsp;</div></li><li><div>   global $vtmin_info;&nbsp;</div></li><li><div>   $pageURL = 'http';&nbsp;</div></li><li><div>   <span class="comment">//if ($_SERVER[&quot;HTTPS&quot;] == &quot;on&quot;) {$pageURL .= &quot;s&quot;;}</span>&nbsp;</div></li><li><div>   if ( isset( $_SERVER[&quot;HTTPS&quot;] ) && strtolower( $_SERVER[&quot;HTTPS&quot;] ) == &quot;on&quot; ) { $pageURL .= &quot;s&quot;;}&nbsp;</div></li><li><div>   $pageURL .= &quot;:<span class="comment">//&quot;;</span>&nbsp;</div></li><li><div>   $pageURL .= $www;   <span class="comment">//mostly null, only active rarely, 2nd time through - see above</span>&nbsp;</div></li><li><div>   &nbsp;</div></li><li><div>   <span class="comment">//NEVER create the URL with the port name!!!!!!!!!!!!!!</span>&nbsp;</div></li><li><div>   $pageURL .= $_SERVER[&quot;SERVER_NAME&quot;].$_SERVER[&quot;REQUEST_URI&quot;];&nbsp;</div></li><li><div>   <span class="comment">/** </span>&nbsp;</div></li><li><div><span class="comment">   if ($_SERVER[&quot;SERVER_PORT&quot;] != &quot;80&quot;) {</span>&nbsp;</div></li><li><div><span class="comment">      $pageURL .= $_SERVER[&quot;SERVER_NAME&quot;].&quot;:&quot;.$_SERVER[&quot;SERVER_PORT&quot;].$_SERVER[&quot;REQUEST_URI&quot;];</span>&nbsp;</div></li><li><div><span class="comment">   } else {</span>&nbsp;</div></li><li><div><span class="comment">      $pageURL .= $_SERVER[&quot;SERVER_NAME&quot;].$_SERVER[&quot;REQUEST_URI&quot;];</span>&nbsp;</div></li><li><div><span class="comment">   }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>   return $pageURL;&nbsp;</div></li><li><div>}  &nbsp;</div></li><li><div> <span class="comment">//v1.07 end</span>    &nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//****************************</span>*********************************&nbsp;</div></li><li><div><span class="comment">//v1.09.8 END - MOVED HERE from parent-cart-validation</span>&nbsp;</div></li><li><div><span class="comment">//****************************</span>*********************************&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>VarkTech Minimum Purchase for WooCommerce</li><li><span></span>1.09.8</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>