<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.7.5" data-slug="mailpoet-newsletters" data-type="class" data-id="41095"><head xmlns="http://www.w3.org/1999/xhtml"><title> wysija_control_back | class | Mailpoet Newsletters | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WYSIJA_control_back, class, plugin, mailpoet-newsletters, 2.7.5" /><meta name="description" content="The MailPoet Newsletters WYSIJA control back class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.8"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ab3e0726a84a00bbdd3cf9cd5b2717c6' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.8' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wysija_control_back/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwysija_control_back%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwysija_control_back%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-mailpoet-newsletters-2.7.5-class-wysija_control_back","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wysija_control_back" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to mailpoet-newsletters." href="http://hookr.io/plugins/mailpoet-newsletters/" class="plugin"><span property="name">mailpoet-newsletters</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.5." href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/" class="H_VERSION"><span property="name">2.7.5</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wysija_control_back</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="299"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/all/" title="All">All <span class="count badge">299</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="104"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/hooks/" title="Hooks">Hooks <span class="count badge">104</span></a></li><li class="" data-id="action" data-count="30"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/actions/" title="Actions">Actions <span class="count badge">30</span></a></li><li class="" data-id="filter" data-count="74"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/filters/" title="Filters">Filters <span class="count badge">74</span></a></li><li class="active" data-id="class" data-count="132"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/" title="Classes">Classes <span class="count badge">132</span></a></li><li class="" data-id="constant" data-count="52"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/constants/" title="Constants">Constants <span class="count badge">52</span></a></li><li class="" data-id="function" data-count="8"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/functions/" title="Functions">Functions <span class="count badge">8</span></a></li><li class="" data-id="shortcode" data-count="3"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">3</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WYSIJA_control_back</strong></h1><p>The MailPoet Newsletters <strong>WYSIJA control back</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/files/controllers-back/" class="file">/controllers/back.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="4" class="block" start="4"><li><div>class WYSIJA_control_back extends WYSIJA_control{&nbsp;</div></li><li><div>    var $redirectAfterSave=true;&nbsp;</div></li><li><div>    var $searchable=array();&nbsp;</div></li><li><div>    var $data=array();&nbsp;</div></li><li><div>    var $jsTrans=array();&nbsp;</div></li><li><div>    var $msgOnSave=true;&nbsp;</div></li><li><div>    var $pref=array();&nbsp;</div></li><li><div>    var $statuses=array();&nbsp;</div></li><li><div>    var $viewShow=null;&nbsp;</div></li><li><div>    var $_affected_rows = 0; //affected rows by batch select&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function __construct($extension=&quot;wysija-newsletters&quot;) {&nbsp;</div></li><li><div>        $this-&gt;extension=$extension;&nbsp;</div></li><li><div>        parent::__construct();&nbsp;</div></li><li><div>        global $wysija_msg, $wysija_queries, $wysija_queries_errors;&nbsp;</div></li><li><div>        $wysija_msgTemp=get_option('wysija_msg');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(is_array($wysija_msgTemp) && count($wysija_msgTemp)&gt;0) {&nbsp;</div></li><li><div>            $wysija_msg=$wysija_msgTemp;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wysija_qryTemp=get_option('wysija_queries');&nbsp;</div></li><li><div>        $wysija_qryErrors=get_option('wysija_queries_errors');&nbsp;</div></li><li><div>        if(is_array($wysija_qryTemp) && count($wysija_qryTemp)&gt;0) {&nbsp;</div></li><li><div>            $wysija_queries=$wysija_qryTemp;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(is_array($wysija_qryErrors) && count($wysija_qryErrors)&gt;0) {&nbsp;</div></li><li><div>            $wysija_queries_errors=$wysija_qryErrors;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        WYSIJA::update_option('wysija_queries', '');&nbsp;</div></li><li><div>        WYSIJA::update_option('wysija_queries_errors', '');&nbsp;</div></li><li><div>        WYSIJA::update_option('wysija_msg', '');&nbsp;</div></li><li><div>        global $wysija_installing;&nbsp;</div></li><li><div>        if($wysija_installing===true) return;&nbsp;</div></li><li><div>        $this-&gt;pref=get_user_meta(WYSIJA::wp_get_userdata('ID'), 'wysija_pref', true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $prefupdate=false;&nbsp;</div></li><li><div>        if($this-&gt;pref) {&nbsp;</div></li><li><div>            $prefupdate=true;&nbsp;</div></li><li><div>            $this-&gt;pref=unserialize(base64_decode($this-&gt;pref));&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $this-&gt;pref=array();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!isset($_GET['action'])) $action='default';&nbsp;</div></li><li><div>        else $action=$_GET['action'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(isset($_REQUEST['limit_pp'])) {&nbsp;</div></li><li><div>            $this-&gt;pref[$_REQUEST['page']][$action]['limit_pp']=$_REQUEST['limit_pp'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($_REQUEST['orderby'])) {&nbsp;</div></li><li><div>            $_REQUEST['orderby'] = preg_replace('|[^a-z0-9#_.-]|i', '', $_REQUEST['orderby']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!empty($_REQUEST['ordert']) && !in_array(strtoupper($_REQUEST['ordert']), array('DESC', 'ASC'))) {&nbsp;</div></li><li><div>            $_REQUEST['ordert'] = 'DESC';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!empty($_REQUEST['id'])) {&nbsp;</div></li><li><div>            $_REQUEST['id'] = (int) $_REQUEST['id'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!empty($_REQUEST['search'])) {&nbsp;</div></li><li><div>            $_REQUEST['search'] = esc_attr($_REQUEST['search']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($this-&gt;pref && isset($_REQUEST['page']) && $_REQUEST['page'] && isset($this-&gt;pref[$_REQUEST['page']][$action]['limit_pp'])) {&nbsp;</div></li><li><div>            $this-&gt;viewObj-&gt;limit_pp=$this-&gt;pref[$_REQUEST['page']][$action]['limit_pp'];&nbsp;</div></li><li><div>            $this-&gt;modelObj-&gt;limit_pp=$this-&gt;pref[$_REQUEST['page']][$action]['limit_pp'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($prefupdate) {&nbsp;</div></li><li><div>            update_user_meta(WYSIJA::wp_get_userdata('ID'), 'wysija_pref', base64_encode(serialize($this-&gt;pref)));&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            add_user_meta(WYSIJA::wp_get_userdata('ID'), 'wysija_pref', base64_encode(serialize($this-&gt;pref)));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        add_action('wysija_various_check', array($this, 'variousCheck'));&nbsp;</div></li><li><div>        do_action('wysija_various_check');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function variousCheck() {&nbsp;</div></li><li><div>        $model_config = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(get_option('wysicheck')) {&nbsp;</div></li><li><div>            $helper_licence = WYSIJA::get('licence', 'helper');&nbsp;</div></li><li><div>            $result = $helper_licence-&gt;check(true);&nbsp;</div></li><li><div>            if($result['nocontact']) {&nbsp;</div></li><li><div>                // redirect instantly to a page with a javascript file  where we check the domain is ok&nbsp;</div></li><li><div>                $data = get_option('wysijey');&nbsp;</div></li><li><div>                // remotely connect to host&nbsp;</div></li><li><div>                wp_enqueue_script('wysija-verif-licence', 'http://www.mailpoet.com/?wysijap=checkout&wysijashop-page=1&controller=customer&action=checkDomain&js=1&data='.$data, array( 'jquery' ), time());&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function errorInstall() {&nbsp;</div></li><li><div>       $this-&gt;viewObj-&gt;renderErrorInstall();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _resetGlobMsg() {&nbsp;</div></li><li><div>        global $wysija_msg, $wysija_queries, $wysija_queries_errors;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wysija_msg=$wysija_queries=$wysija_queries_errors=array();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    function defaultDisplay() {&nbsp;</div></li><li><div>        $this-&gt;viewShow=$this-&gt;action='main';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if it has not been enqueud in the head we print it here(can happens based on the action after a save or so)&nbsp;</div></li><li><div>        $this-&gt;js[]='wysija-admin-list';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get the filters&nbsp;</div></li><li><div>        if(isset($_REQUEST['search']) && $_REQUEST['search']) {&nbsp;</div></li><li><div>            $this-&gt;filters['like']=array();&nbsp;</div></li><li><div>            foreach($this-&gt;searchable as $searchable) {&nbsp;</div></li><li><div>                $this-&gt;filters['like'][$searchable]=$_REQUEST['search'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($this-&gt;filters) {&nbsp;</div></li><li><div>            $this-&gt;modelObj-&gt;setConditions($this-&gt;filters);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($this-&gt;joins) {&nbsp;</div></li><li><div>            $this-&gt;modelObj-&gt;setJoin($this-&gt;joins);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($this-&gt;statuses) {&nbsp;</div></li><li><div>            //we count by statuses&nbsp;</div></li><li><div>            $query='SELECT count('.$this-&gt;modelObj-&gt;pk.') as count, status FROM `[wysija]'.$this-&gt;modelObj-&gt;table_name.'` GROUP BY status';&nbsp;</div></li><li><div>            $countss=$this-&gt;modelObj-&gt;query('get_res', $query, ARRAY_A);&nbsp;</div></li><li><div>            $counts=array();&nbsp;</div></li><li><div>            $this-&gt;modelObj-&gt;countRows=0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach($countss as $count) {&nbsp;</div></li><li><div>                $mystat=(int)$count['status'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;statuses[$mystat]['count']=$count['count'];&nbsp;</div></li><li><div>                $this-&gt;statuses[$mystat]['uri']=$this-&gt;getDefaultUrl(false).'&link_filter='.$this-&gt;statuses[$mystat]['key'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;modelObj-&gt;countRows=$this-&gt;modelObj-&gt;countRows+$count['count'];&nbsp;</div></li><li><div>                $this-&gt;viewObj-&gt;statuses=$this-&gt;statuses;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $this-&gt;modelObj-&gt;countRows=$this-&gt;modelObj-&gt;count();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(isset($_REQUEST['orderby'])) {&nbsp;</div></li><li><div>            $this-&gt;modelObj-&gt;orderBy($_REQUEST['orderby'], strtoupper($_REQUEST['ordert']));&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $this-&gt;modelObj-&gt;orderBy($this-&gt;modelObj-&gt;getPk(), 'DESC');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;modelObj-&gt;limitON=true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data=$this-&gt;modelObj-&gt;getRows($this-&gt;list_columns);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $methodDefaultData='defaultData';&nbsp;</div></li><li><div>        if(method_exists($this, $methodDefaultData )) {&nbsp;</div></li><li><div>            $this-&gt;$methodDefaultData($data);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function defaultData($data) {&nbsp;</div></li><li><div>        $this-&gt;data=$data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function render() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;viewObj-&gt;render($this-&gt;viewShow, $this-&gt;data);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * by default this is the first method called from a controller this is from where we route to other methods&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function main() {&nbsp;</div></li><li><div>        $this-&gt;__construct();&nbsp;</div></li><li><div>        if($this-&gt;model) {&nbsp;</div></li><li><div>            if(isset($_REQUEST['action']))  $action=$_REQUEST['action'];&nbsp;</div></li><li><div>            else  $action='defaultDisplay';&nbsp;</div></li><li><div>            if(!$action) $action='defaultDisplay';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($action) {&nbsp;</div></li><li><div>                $this-&gt;_tryAction($action);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $this-&gt;error('No Model is linked to this controller : '. get_class($this));&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function __setMetaTitle() {&nbsp;</div></li><li><div>        global $title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(isset($this-&gt;title))$title=$this-&gt;title;&nbsp;</div></li><li><div>        else $title=$this-&gt;viewObj-&gt;title;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _tryAction($action) {&nbsp;</div></li><li><div>        $action=strip_tags($action);&nbsp;</div></li><li><div>        $_REQUEST = stripslashes_deep($_REQUEST);&nbsp;</div></li><li><div>        $_POST = stripslashes_deep($_POST);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $is_batch_select = $this-&gt;_batchSelect();&nbsp;</div></li><li><div>        $this-&gt;_affected_rows = $is_batch_select ? $this-&gt;_batch_select['count'] : (!empty($_REQUEST['wysija']['user']['user_id']) ? count($_REQUEST['wysija']['user']['user_id']) : 0);&nbsp;</div></li><li><div>        if(method_exists($this, $action)) {&nbsp;</div></li><li><div>            /** in some bulk actions we need to specify the action name and one or few variables*/&nbsp;</div></li><li><div>            $this-&gt;action=$action;&nbsp;</div></li><li><div>            $this-&gt;viewShow=$this-&gt;action;&nbsp;</div></li><li><div>            if(!$this-&gt;viewShow) $this-&gt;viewShow='defaultDisplay';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(strpos($action, 'bulk_')===false)$this-&gt;$action();&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $this-&gt;$action($_REQUEST['wysija'][$this-&gt;model][$this-&gt;modelObj-&gt;pk]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;__setMetaTitle();&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            /** in some bulk actions we need to specify the action name and one or few variables*/&nbsp;</div></li><li><div>            if(strpos($action, 'actionvar_')!== false) {&nbsp;</div></li><li><div>                $data=explode('-', $action);&nbsp;</div></li><li><div>                $datas=array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach($data as $dt) {&nbsp;</div></li><li><div>                    $res=explode('_', $dt);&nbsp;</div></li><li><div>                    $datas[$res[0]]=$res[1];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $action =$datas['actionvar'];&nbsp;</div></li><li><div>                unset($datas['actionvar']);&nbsp;</div></li><li><div>                $this-&gt;action=$action;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if(method_exists($this, $this-&gt;action)) {&nbsp;</div></li><li><div>                    $this-&gt;viewShow=$this-&gt;action;&nbsp;</div></li><li><div>                    $this-&gt;$action($datas);&nbsp;</div></li><li><div>                    $this-&gt;__setMetaTitle();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }else{&nbsp;</div></li><li><div>                    $this-&gt;error(&quot;Action '&quot;.$action.&quot;' does not exist in controller : &quot;. get_class($this));&nbsp;</div></li><li><div>                    $this-&gt;redirect();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }else{&nbsp;</div></li><li><div>                $this-&gt;error(&quot;Action '&quot;.$action.&quot;' does not exist in controller : &quot;. get_class($this));&nbsp;</div></li><li><div>                $this-&gt;redirect();&nbsp;</div></li><li><div>                //$this-&gt;defaultDisplay();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(defined('WYSIJA_REDIRECT'))  $this-&gt;redirectProcess();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if( !empty( $_REQUEST['page'] ) && $_REQUEST['page'] !== 'wysija_premium') {&nbsp;</div></li><li><div>            $this-&gt;checkTotalSubscribers();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function checkTotalSubscribers() {&nbsp;</div></li><li><div>        add_action('wysija_check_total_subscribers', array($this, '_checkTotalSubscribers'));&nbsp;</div></li><li><div>        do_action('wysija_remove_action_check_total_subscribers');&nbsp;</div></li><li><div>        do_action('wysija_check_total_subscribers');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Batch select process&nbsp;</div></li><li><div>     * - Currently, is for subscribers only&nbsp;</div></li><li><div>     * - Get all matched subscribers and override to $_REQUEST['wysija']['user']['user_id']&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _batchSelect() {&nbsp;</div></li><li><div>        if(empty($_REQUEST['wysija']['user']['force_select_all']))&nbsp;</div></li><li><div>            return FALSE;&nbsp;</div></li><li><div>        if (!(bool)$_REQUEST['wysija']['user']['force_select_all'])&nbsp;</div></li><li><div>            return FALSE;&nbsp;</div></li><li><div>        if(empty($_REQUEST['wysija']['user']['timestamp']))&nbsp;</div></li><li><div>            return FALSE;&nbsp;</div></li><li><div>        //$_POST['wysija']['filter'] = array(&nbsp;</div></li><li><div>        //  link_filter =&gt; '', //[subscribed, unsubscribed, unsubscribed, all]&nbsp;</div></li><li><div>        //  filter_list =&gt; int&nbsp;</div></li><li><div>        //);&nbsp;</div></li><li><div>        //&nbsp;</div></li><li><div>        //$_POST['wysija']['user']['timestamp'] = int&nbsp;</div></li><li><div>        //&nbsp;</div></li><li><div>        //select all users which match to $_POST['wysija']['filter'] and create_at &lt;= $_POST['wysija']['user']['timestamp']&nbsp;</div></li><li><div>        // - build query&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $select = array( '[wysija]user.user_id');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // filters for unsubscribed&nbsp;</div></li><li><div>        $filters = $this-&gt;modelObj-&gt;detect_filters();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;_batch_select = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;_batch_select['query'] = $this-&gt;modelObj-&gt;get_subscribers( $select, $filters, '', true );&nbsp;</div></li><li><div>        $this-&gt;_batch_select['query_count'] = $this-&gt;modelObj-&gt;get_subscribers( array( 'COUNT(DISTINCT([wysija]user.user_id))'), $filters, '', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Create a temporary table&nbsp;</div></li><li><div>        $temp_table_name = '[wysija]user'. time();&nbsp;</div></li><li><div>        $temp_table_create = 'CREATE TEMPORARY TABLE IF NOT EXISTS '.$temp_table_name . ' (user_id int (10) NOT NULL, PRIMARY KEY (user_id))';&nbsp;</div></li><li><div>        $temp_table_insert = 'INSERT IGNORE INTO '.$temp_table_name.' ' . $this-&gt;_batch_select['query'];&nbsp;</div></li><li><div>        $model_user = WYSIJA::get('user', 'model');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $model_user-&gt;query($temp_table_create);&nbsp;</div></li><li><div>    $model_user-&gt;query($temp_table_insert);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Override the queres with temporary table&nbsp;</div></li><li><div>        unset($this-&gt;_batch_select['where']);&nbsp;</div></li><li><div>        $row_count = $model_user-&gt;query('get_row', 'SELECT COUNT(*) as row_count FROM '.$temp_table_name);&nbsp;</div></li><li><div>        $this-&gt;_batch_select['original_query'] = $this-&gt;_batch_select['query']; // useful for export feature; in this case, we don't use temporary table&nbsp;</div></li><li><div>        $this-&gt;_batch_select['select'] = 'SELECT DISTINCT user_id';&nbsp;</div></li><li><div>        $this-&gt;_batch_select['from'] = 'FROM '.$temp_table_name . ' A';&nbsp;</div></li><li><div>        $this-&gt;_batch_select['query'] = 'SELECT user_id FROM '.$temp_table_name;&nbsp;</div></li><li><div>        $this-&gt;_batch_select['count'] = $row_count['row_count'];&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _checkTotalSubscribers() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $config=WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        $totalSubscribers=$config-&gt;getValue('total_subscribers');&nbsp;</div></li><li><div>        $helper_licence = WYSIJA::get('licence', 'helper');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if((int)$totalSubscribers&gt;1900) {&nbsp;</div></li><li><div>            if((int)$totalSubscribers&gt;2000) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $url_checkout = $helper_licence-&gt;get_url_checkout('over200');&nbsp;</div></li><li><div>                $this-&gt;error(str_replace(array('[link]', '[/link]'), &nbsp;</div></li><li><div>                array('&lt;a title=&quot;'.__('Get Premium now', WYSIJA).'&quot; target=&quot;_blank&quot; href=&quot;'.$url_checkout.'&quot;&gt;', '&lt;/a&gt;'), &nbsp;</div></li><li><div>                sprintf(__('Yikes. You\'re over the limit of 2000 subscribers for the free version of MailPoet (%1$s in total). Sending is disabled now. Please upgrade your version to [link]premium[/link] to send without limits.', WYSIJA)&nbsp;</div></li><li><div> , $totalSubscribers)), true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }else{&nbsp;</div></li><li><div>                $url_checkout = $helper_licence-&gt;get_url_checkout('near200');&nbsp;</div></li><li><div>                $this-&gt;notice(str_replace(array('[link]', '[/link]'), &nbsp;</div></li><li><div>                    array('&lt;a title=&quot;'.__('Get Premium now', WYSIJA).'&quot; target=&quot;_blank&quot; href=&quot;'.$url_checkout.'&quot;&gt;', '&lt;/a&gt;'), &nbsp;</div></li><li><div>                    sprintf(__('Yikes! You\'re near the limit of %1$s subscribers for MailPoet\'s free version. Upgrade to [link]Premium[/link] to send without limits, and more.', WYSIJA)&nbsp;</div></li><li><div> , &quot;2000&quot;)));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function edit($id=false) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(isset($_REQUEST['id']) || $id) {&nbsp;</div></li><li><div>            if(!$id) $id=$_REQUEST['id'];&nbsp;</div></li><li><div>            $this-&gt;data[$this-&gt;modelObj-&gt;table_name]=$this-&gt;modelObj-&gt;getOne($this-&gt;form_columns, array($this-&gt;modelObj-&gt;pk=&gt;$id));&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $this-&gt;error('Cannot edit element primary key is missing : '. get_class($this));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function view($id=false) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(isset($_REQUEST['id']) || $id) {&nbsp;</div></li><li><div>            if(!$id) $id=$_REQUEST['id'];&nbsp;</div></li><li><div>            $this-&gt;data[$this-&gt;modelObj-&gt;table_name]=$this-&gt;modelObj-&gt;getOne($this-&gt;form_columns, array($this-&gt;modelObj-&gt;pk=&gt;$id));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            $this-&gt;error('Cannot view element primary key is missing : '. get_class($this));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function add($dataPost=false) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!$dataPost) {&nbsp;</div></li><li><div>            $data=array();&nbsp;</div></li><li><div>            foreach($this-&gt;form_columns as $key) {&nbsp;</div></li><li><div>                $data[$key]='';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data=array();&nbsp;</div></li><li><div>            foreach($this-&gt;form_columns as $key) {&nbsp;</div></li><li><div>                if($key != $this-&gt;viewObj-&gt;model-&gt;pk)  $data[$key]=$dataPost[$key];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $data[$this-&gt;viewObj-&gt;model-&gt;pk]='';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function save() {&nbsp;</div></li><li><div>        $this-&gt;requireSecurity();&nbsp;</div></li><li><div>        //see if it's an update or an insert&nbsp;</div></li><li><div>        //get the pk and its value as a conditions where pk = pkval&nbsp;</div></li><li><div>        $conditions=$this-&gt;getPKVal($this-&gt;modelObj);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($conditions) {&nbsp;</div></li><li><div>            //this an update&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $result=$this-&gt;modelObj-&gt;update($_POST['wysija'][$this-&gt;model], $conditions);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($this-&gt;msgOnSave) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Create the update success message and add edit again link.&nbsp;</div></li><li><div>                $update_success = str_replace(array('[link]', '[/link]'), array('&lt;a href=&quot;admin.php?page=wysija_subscribers&action=edit&id='.$result.'&quot; &gt;', &quot;&lt;/a&gt;&quot;), $this-&gt;messages['update'][true]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($result) {&nbsp;</div></li><li><div>                    $this-&gt;notice($update_success);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    if($result==0) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    }else{&nbsp;</div></li><li><div>                        $this-&gt;error($this-&gt;messages['update'][false], true);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($this-&gt;redirectAfterSave) {&nbsp;</div></li><li><div>                if(isset($this-&gt;modelObj-&gt;stay)) {&nbsp;</div></li><li><div>                    $this-&gt;action='edit';&nbsp;</div></li><li><div>                    $this-&gt;redirect();&nbsp;</div></li><li><div>                }else{&nbsp;</div></li><li><div>                    $this-&gt;action='edit';&nbsp;</div></li><li><div>                    $this-&gt;redirect();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }else{&nbsp;</div></li><li><div>            //this is an insert&nbsp;</div></li><li><div>            unset($_POST['wysija'][$this-&gt;model][$this-&gt;modelObj-&gt;pk]);&nbsp;</div></li><li><div>            $result=$this-&gt;modelObj-&gt;insert($_POST['wysija'][$this-&gt;model]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($this-&gt;msgOnSave) {&nbsp;</div></li><li><div>                if($result) $this-&gt;notice($this-&gt;messages['insert'][true]);&nbsp;</div></li><li><div>                else{&nbsp;</div></li><li><div>                    $this-&gt;error($this-&gt;messages['insert'][false], true);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($this-&gt;redirectAfterSave) {&nbsp;</div></li><li><div>                if(isset($this-&gt;modelObj-&gt;stay)) {&nbsp;</div></li><li><div>                    $this-&gt;action='add';&nbsp;</div></li><li><div>                    $this-&gt;add($_POST['wysija'][$this-&gt;model]);&nbsp;</div></li><li><div>                }else{&nbsp;</div></li><li><div>                    $this-&gt;action='main';&nbsp;</div></li><li><div>                    $this-&gt;redirect();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //now we redirect to the edit page with the data in it&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function bulk_delete($ids) {&nbsp;</div></li><li><div>        $this-&gt;requireSecurity();&nbsp;</div></li><li><div>        foreach($ids as $id) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $conditions=$this-&gt;getPKVal($this-&gt;modelObj);&nbsp;</div></li><li><div>            if(!$conditions) $this-&gt;error('Cannot obtain PKVal from GET or POST.');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $result=$this-&gt;modelObj-&gt;delete($conditions);&nbsp;</div></li><li><div>            $this-&gt;modelObj-&gt;reset();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;notice(__('Elements deleted', WYSIJA));&nbsp;</div></li><li><div>        $this-&gt;redirect();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function delete() {&nbsp;</div></li><li><div>        // see if it's an update or an insert&nbsp;</div></li><li><div>        $this-&gt;requireSecurity();&nbsp;</div></li><li><div>        $conditions=$this-&gt;getPKVal($this-&gt;modelObj);&nbsp;</div></li><li><div>        if(!$conditions) $this-&gt;error('Cannot obtain PKVal from GET or POST.');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result=$this-&gt;modelObj-&gt;delete($conditions);&nbsp;</div></li><li><div>        if($result) {&nbsp;</div></li><li><div>            $this-&gt;notice(__('Element has been deleted.', WYSIJA));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;modelObj-&gt;reset();&nbsp;</div></li><li><div>        //now we redirect to the edit page with the data in it&nbsp;</div></li><li><div>        $this-&gt;action='main';&nbsp;</div></li><li><div>        $this-&gt;redirect();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function redirect($location=false) {&nbsp;</div></li><li><div>        global $wysi_location;&nbsp;</div></li><li><div>        define('WYSIJA_REDIRECT', true);&nbsp;</div></li><li><div>        if($location)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $url = parse_url($location);&nbsp;</div></li><li><div>            if(!empty($url['query'])) {&nbsp;</div></li><li><div>                $location .= '&';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $location .= '?';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $location .= 'redirect=1';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $wysi_location=$location;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function redirectProcess() {&nbsp;</div></li><li><div>        global $wysi_location;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!$wysi_location)  {&nbsp;</div></li><li><div>            $wysi_location=$this-&gt;getDefaultUrl();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        WYSIJA::redirect($wysi_location);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function popupReturn($viewFunc) {&nbsp;</div></li><li><div>        return wp_iframe( array($this-&gt;viewObj, 'popup_'.$viewFunc), $this-&gt;data);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _addTab($defaulttab) {&nbsp;</div></li><li><div>        return $this-&gt;iframeTabs;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function popupContent() {&nbsp;</div></li><li><div>        // remove auth check&nbsp;</div></li><li><div>        remove_action('admin_enqueue_scripts', 'wp_auth_check_load');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // add popup css&nbsp;</div></li><li><div>        wp_enqueue_style('custom_popup_css', WYSIJA_URL.'css/adminPopup.css', array(), WYSIJA::get_version(), 'screen');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $viewMedia;&nbsp;</div></li><li><div>        $viewMedia=$this-&gt;viewObj;&nbsp;</div></li><li><div>        $_GET['type']=$_REQUEST['type']='image';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $config=WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        $_GET['post_id']=$_REQUEST['post_id']=$config-&gt;getValue('confirm_email_link');&nbsp;</div></li><li><div>        $post_id = isset($_GET['post_id'])? (int) $_GET['post_id'] : 0;&nbsp;</div></li><li><div>        if(file_exists(ABSPATH.'wp-admin'.DS.'admin.php')) require_once(ABSPATH.'wp-admin'.DS.'admin.php');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        @header('Content-Type: ' . get_option('html_type') . '; charset=' . get_option('blog_charset'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_filter('media_upload_tabs', array($this, '_addTab'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!isset($this-&gt;iframeTabs)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //if wp version includes plupload then let's use it&nbsp;</div></li><li><div>            if(version_compare(get_bloginfo('version'), '3.3.0')&gt;= 0) {&nbsp;</div></li><li><div>                $this-&gt;iframeTabs=array(&nbsp;</div></li><li><div>            'special_new_wordp_upload'=&gt;__('Upload', WYSIJA));&nbsp;</div></li><li><div>            }else{&nbsp;</div></li><li><div>                $this-&gt;iframeTabs=array(&nbsp;</div></li><li><div>            'special_wordp_upload'=&gt;__('Upload', WYSIJA));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;iframeTabs['special_wysija_browse']=__('Newsletter Images', WYSIJA);&nbsp;</div></li><li><div>            $this-&gt;iframeTabs['special_wordp_browse']=__('WordPress Posts\' Images', WYSIJA);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach($this-&gt;iframeTabs as $actionKey =&gt;$actionTitle)&nbsp;</div></li><li><div>                add_action('media_upload_'.$actionKey, array($this, $actionKey));&nbsp;</div></li><li><div>        }else   add_action('media_upload_standard', array($this, 'popupReturn'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // upload type: image, video, file, ..?&nbsp;</div></li><li><div>        if ( isset($_GET['type']) )&nbsp;</div></li><li><div>                $type = strval($_GET['type']);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>                $type = apply_filters('media_upload_default_type', 'file');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // tab: gallery, library, or type-specific&nbsp;</div></li><li><div>        if ( isset($_GET['tab']) )&nbsp;</div></li><li><div>                $tab = strval($_GET['tab']);&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>                $tab ='special_wysija_browse';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $body_id = 'media-upload';&nbsp;</div></li><li><div>        // let the action code decide how to handle the request&nbsp;</div></li><li><div>        if ( $tab == 'type' || $tab == 'type_url' )&nbsp;</div></li><li><div>            //i'm not so sure we need that line&nbsp;</div></li><li><div>            do_action(&quot;media_upload_$type&quot;);&nbsp;</div></li><li><div>        else{&nbsp;</div></li><li><div>            if(strpos($tab, 'special_')!==false) {&nbsp;</div></li><li><div>                do_action(&quot;media_upload_$tab&quot;);&nbsp;</div></li><li><div>            }else{&nbsp;</div></li><li><div>                do_action('media_upload_standard', $tab);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getDefaultUrl($filter=true) {&nbsp;</div></li><li><div>        $location=&quot;admin.php?page=&quot;.$_REQUEST['page'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($filter) {&nbsp;</div></li><li><div>            if(isset($_REQUEST['search']) && $_REQUEST['search']) {&nbsp;</div></li><li><div>                $location.='&search='.$_REQUEST['search'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(isset($_REQUEST['filter-list']) && $_REQUEST['filter-list']) {&nbsp;</div></li><li><div>                $location.='&filter-list='.$_REQUEST['filter-list'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(isset($_REQUEST['link_filter']) && $_REQUEST['link_filter']) {&nbsp;</div></li><li><div>                $location.='&link_filter='.$_REQUEST['link_filter'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(isset($_REQUEST['orderby']) && $_REQUEST['orderby']) {&nbsp;</div></li><li><div>                $location.='&orderby='.$_REQUEST['orderby'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(isset($_REQUEST['ordert']) && $_REQUEST['ordert']) {&nbsp;</div></li><li><div>                $location.='&ordert='.$_REQUEST['ordert'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $location;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * to remove the conflicts in wysija's interfaces&nbsp;</div></li><li><div>     * @param boolean $themes&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_conflictive_plugins($themes=false) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * List of all the conflictive extensions which invite themselves on our interfaces and break some of our js:&nbsp;</div></li><li><div>         * tribulant newsletter&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $conflictivePlugins = array(&nbsp;</div></li><li><div>            'tribulant-wp-mailinglist' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'wp-mailinglist/wp-mailinglist.php', &nbsp;</div></li><li><div>                'version' =&gt; '3.8.7', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'admin_head' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'objects' =&gt; array('wpMail')&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'wp-events' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'wp-events/wp-events.php', &nbsp;</div></li><li><div>                'version' =&gt; '', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'admin_head' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'function' =&gt; 'events_editor_admin_head'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'email-users' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'email-users/email-users.php', &nbsp;</div></li><li><div>                'version' =&gt; '', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'admin_head' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'function' =&gt; 'editor_admin_head'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'acf' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'advanced-custom-fields/acf.php', &nbsp;</div></li><li><div>                'version' =&gt; '3.1.7', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'init' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'objects' =&gt; array('Acf')&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'wptofacebook' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'wptofacebook/index.php', &nbsp;</div></li><li><div>                'version' =&gt; '1.2.3', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'admin_head' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'function' =&gt; 'WpToFb::wptofb_editor_admin_head'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'mindvalley-pagemash' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'mindvalley-pagemash/pagemash.php', &nbsp;</div></li><li><div>                'version' =&gt; '1.1', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'admin_print_scripts' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'function' =&gt; 'pageMash_head'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'wp-polls' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'wp-polls/wp-polls.php', &nbsp;</div></li><li><div>                'version' =&gt; '2.63', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'wp_enqueue_scripts' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'function' =&gt; 'poll_scripts'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'wp_rokajaxsearch' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'wp_rokajaxsearch/rokajaxsearch.php', &nbsp;</div></li><li><div>                'version' =&gt; '', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'init' =&gt; array(&nbsp;</div></li><li><div>                        '-50' =&gt; array(&nbsp;</div></li><li><div>                            'function' =&gt; 'rokajaxsearch_mootools_init'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'wp_rokstories' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'wp_rokstories/rokstories.php', &nbsp;</div></li><li><div>                'version' =&gt; '', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'init' =&gt; array(&nbsp;</div></li><li><div>                        '-50' =&gt; array(&nbsp;</div></li><li><div>                            'function' =&gt; 'rokstories_mootools_init'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'simple-links' =&gt; array(&nbsp;</div></li><li><div>                'file' =&gt; 'simple-links/simple-links.php', &nbsp;</div></li><li><div>                'version' =&gt; '1.5', &nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'admin_print_scripts' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'objects' =&gt; array('simple_links_admin')&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $conflictiveThemes = array(&nbsp;</div></li><li><div>            'smallbiz' =&gt; array(&nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'admin_head' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'function' =&gt; 'smallbiz_on_admin_head'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'balance' =&gt; array(&nbsp;</div></li><li><div>                'clean' =&gt; array(&nbsp;</div></li><li><div>                    'admin_enqueue_scripts' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'functions' =&gt; array('al_admin_scripts', 'al_adminpanel_scripts', 'al_pricing_tables_scripts')&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'admin_head' =&gt; array(&nbsp;</div></li><li><div>                        '10' =&gt; array(&nbsp;</div></li><li><div>                            'function' =&gt; 'al_admin_head'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($themes) return $conflictiveThemes;&nbsp;</div></li><li><div>        return $conflictivePlugins;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/wysija_control_back/" class="active">2.7.5</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.4/classes/wysija_control_back/" class="">2.7.4</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.3/classes/wysija_control_back/" class="">2.7.3</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.2/classes/wysija_control_back/" class="">2.7.2</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.1/classes/wysija_control_back/" class="">2.7.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>WYSIJA_control_back</li><li><span></span>MailPoet Newsletters</li><li><span></span>2.7.5</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>