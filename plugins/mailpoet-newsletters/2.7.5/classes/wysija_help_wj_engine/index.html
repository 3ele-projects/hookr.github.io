<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.7.5" data-slug="mailpoet-newsletters" data-type="class" data-id="41169"><head xmlns="http://www.w3.org/1999/xhtml"><title> wysija_help_wj_engine | class | Mailpoet Newsletters | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WYSIJA_help_wj_engine, class, plugin, mailpoet-newsletters, 2.7.5" /><meta name="description" content="The MailPoet Newsletters WYSIJA help wj engine class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.8"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=82d71db751686dd52c9bcd76fb0ead70' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.8' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wysija_help_wj_engine/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwysija_help_wj_engine%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwysija_help_wj_engine%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-mailpoet-newsletters-2.7.5-class-wysija_help_wj_engine","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wysija_help_wj_engine" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to mailpoet-newsletters." href="http://hookr.io/plugins/mailpoet-newsletters/" class="plugin"><span property="name">mailpoet-newsletters</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.5." href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/" class="H_VERSION"><span property="name">2.7.5</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wysija_help_wj_engine</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="299"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/all/" title="All">All <span class="count badge">299</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="104"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/hooks/" title="Hooks">Hooks <span class="count badge">104</span></a></li><li class="" data-id="action" data-count="30"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/actions/" title="Actions">Actions <span class="count badge">30</span></a></li><li class="" data-id="filter" data-count="74"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/filters/" title="Filters">Filters <span class="count badge">74</span></a></li><li class="active" data-id="class" data-count="132"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/" title="Classes">Classes <span class="count badge">132</span></a></li><li class="" data-id="constant" data-count="52"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/constants/" title="Constants">Constants <span class="count badge">52</span></a></li><li class="" data-id="function" data-count="8"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/functions/" title="Functions">Functions <span class="count badge">8</span></a></li><li class="" data-id="shortcode" data-count="3"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">3</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WYSIJA_help_wj_engine</strong></h1><p>The MailPoet Newsletters <strong>WYSIJA help wj engine</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/files/helpers-wj-engine/" class="file">/helpers/wj_engine.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="6" class="block" start="6"><li><div>class WYSIJA_help_wj_engine extends WYSIJA_object {&nbsp;</div></li><li><div>    // debug mode&nbsp;</div></li><li><div>    var $_debug = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // contains email data&nbsp;</div></li><li><div>    var $_email_data = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // rendering context (editor, email)&nbsp;</div></li><li><div>    var $_context = 'editor';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // toggles for vib & unsub&nbsp;</div></li><li><div>    var $_hide_viewbrowser = false;&nbsp;</div></li><li><div>    var $_hide_unsubscribe = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // data holders&nbsp;</div></li><li><div>    var $_data = null;&nbsp;</div></li><li><div>    var $_styles = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // language direction&nbsp;</div></li><li><div>    var $_is_rtl = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // styles: defaults&nbsp;</div></li><li><div>    var $VIEWBROWSER_SIZES = array(7, 8, 9, 10, 11, 12, 13, 14);&nbsp;</div></li><li><div>    var $TEXT_SIZES = array(8, 9, 10, 11, 12, 13, 14, 16, 18, 24, 36, 48, 72);&nbsp;</div></li><li><div>    var $TITLE_SIZES = array(16, 18, 20, 22, 24, 26, 28, 30, 32, 34, 36, 40, 44, 48, 54, 60, 66, 72);&nbsp;</div></li><li><div>    var $FONTS = array(&nbsp;</div></li><li><div>        'Arial' =&gt; &quot;Arial, 'Helvetica Neue', Helvetica, sans-serif&quot;, &nbsp;</div></li><li><div>        'Comic Sans MS' =&gt; &quot;'Comic Sans MS', 'Marker Felt-Thin', Arial, sans-serif&quot;, &nbsp;</div></li><li><div>        'Courier New' =&gt; &quot;'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace&quot;, &nbsp;</div></li><li><div>        'Georgia' =&gt; &quot;Georgia, Times, 'Times New Roman', serif&quot;, &nbsp;</div></li><li><div>        'Tahoma' =&gt; &quot;Tahoma, Verdana, Segoe, sans-serif&quot;, &nbsp;</div></li><li><div>        'Times New Roman' =&gt; &quot;'Times New Roman', Times, Baskerville, Georgia, serif&quot;, &nbsp;</div></li><li><div>        'Trebuchet MS' =&gt; &quot;'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Tahoma, sans-serif&quot;, &nbsp;</div></li><li><div>        'Verdana' =&gt; &quot;Verdana, Geneva, sans-serif&quot;&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Constructor */&nbsp;</div></li><li><div>    function __construct() {&nbsp;</div></li><li><div>      parent::__construct();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** i18n methods */&nbsp;</div></li><li><div>    function getTranslations() {&nbsp;</div></li><li><div>        return array(&nbsp;</div></li><li><div>            'dropHeaderNotice' =&gt; __('Drop your logo in this header.', WYSIJA), &nbsp;</div></li><li><div>            'dropFooterNotice' =&gt; __('Drop your footer image here.', WYSIJA), &nbsp;</div></li><li><div>            'dropBannerNotice' =&gt; __('If you leave this area empty, it will not display once you send your email', WYSIJA), &nbsp;</div></li><li><div>            'clickToEditText' =&gt; __('Click here to add a title or text.', WYSIJA), &nbsp;</div></li><li><div>            'alignmentLeft' =&gt;  __('Align left', WYSIJA), &nbsp;</div></li><li><div>            'alignmentCenter' =&gt; __('Align center', WYSIJA), &nbsp;</div></li><li><div>            'alignmentRight' =&gt; __('Align right', WYSIJA), &nbsp;</div></li><li><div>            'addImageLink' =&gt; __('Add link / Alternative text', WYSIJA), &nbsp;</div></li><li><div>            'removeImageLink' =&gt; __('Remove link', WYSIJA), &nbsp;</div></li><li><div>            'removeImage' =&gt; __('Remove image', WYSIJA), &nbsp;</div></li><li><div>            'remove' =&gt; __('Remove', WYSIJA), &nbsp;</div></li><li><div>            'editText' =&gt; __( 'Edit text', WYSIJA), &nbsp;</div></li><li><div>            'removeText' =&gt; __('Remove text', WYSIJA), &nbsp;</div></li><li><div>            'textLabel' =&gt; __('Titles & text', WYSIJA), &nbsp;</div></li><li><div>            'dividerLabel' =&gt; __('Horizontal line', WYSIJA), &nbsp;</div></li><li><div>            'customDividerLabel' =&gt; __('Custom horizontal line', WYSIJA), &nbsp;</div></li><li><div>            'postLabel' =&gt; __('WordPress post', WYSIJA), &nbsp;</div></li><li><div>            'styleBodyLabel' =&gt; __('Text', WYSIJA), &nbsp;</div></li><li><div>            'styleViewbrowserLabel' =&gt; __('&quot;View in browser&quot;', WYSIJA), &nbsp;</div></li><li><div>            'styleH1Label' =&gt; __('Heading 1', WYSIJA), &nbsp;</div></li><li><div>            'styleH2Label' =&gt; __('Heading 2', WYSIJA), &nbsp;</div></li><li><div>            'styleH3Label' =&gt; __('Heading 3', WYSIJA), &nbsp;</div></li><li><div>            'styleLinksLabel' =&gt; __('Links', WYSIJA), &nbsp;</div></li><li><div>            'styleLinksDecorationLabel' =&gt; __('underline', WYSIJA), &nbsp;</div></li><li><div>            'styleFooterLabel' =&gt; __('Footer text', WYSIJA), &nbsp;</div></li><li><div>            'styleFooterBackgroundLabel' =&gt; __('Footer background', WYSIJA), &nbsp;</div></li><li><div>            'styleBodyBackgroundLabel' =&gt; __('Newsletter', WYSIJA), &nbsp;</div></li><li><div>            'styleHtmlBackgroundLabel' =&gt; __('Background', WYSIJA), &nbsp;</div></li><li><div>            'styleHeaderBackgroundLabel' =&gt; __('Header background', WYSIJA), &nbsp;</div></li><li><div>            'styleDividerLabel' =&gt; __('Horizontal line', WYSIJA), &nbsp;</div></li><li><div>            'styleUnsubscribeColorLabel' =&gt; __('Unsubscribe', WYSIJA), &nbsp;</div></li><li><div>            'articleSelectionTitle' =&gt; __('Post Selection', WYSIJA), &nbsp;</div></li><li><div>            'bookmarkSelectionTitle' =&gt; __('Social Bookmark Selection', WYSIJA), &nbsp;</div></li><li><div>            'dividerSelectionTitle' =&gt; __('Divider Selection', WYSIJA), &nbsp;</div></li><li><div>            'abouttodeletetheme' =&gt; __('You are about to delete the theme : %1$s. Do you really want to do that?', WYSIJA), &nbsp;</div></li><li><div>            'addLinkTitle' =&gt; __('Add Link & Alternative text', WYSIJA), &nbsp;</div></li><li><div>            'styleTransparent' =&gt; __('Check this box if you want transparency', WYSIJA), &nbsp;</div></li><li><div>            'ajaxLoading' =&gt; __('Loading...', WYSIJA), &nbsp;</div></li><li><div>            'customFieldsLabel' =&gt; __('Insert dynamic data about your subscribers, the newsletter, today\'s date, etc...', WYSIJA), &nbsp;</div></li><li><div>            'autoPostSettingsTitle' =&gt; __('Selection options', WYSIJA), &nbsp;</div></li><li><div>            'autoPostEditSettings' =&gt; __('Edit Automatic latest content', WYSIJA), &nbsp;</div></li><li><div>            'autoPostImmediateNotice' =&gt; __('You can only add one widget when designing a post notification sent immediately after an article is published', WYSIJA), &nbsp;</div></li><li><div>            'toggleImagesTitle' =&gt; __('Preview without images', WYSIJA), &nbsp;</div></li><li><div>            // Tags labels&nbsp;</div></li><li><div>            'tags_user' =&gt; __('Subscriber', WYSIJA), &nbsp;</div></li><li><div>            'tags_user_firstname' =&gt; __('First Name', WYSIJA), &nbsp;</div></li><li><div>            'tags_user_lastname' =&gt; __('Last Name', WYSIJA), &nbsp;</div></li><li><div>            'tags_user_email' =&gt; __('Email Address', WYSIJA), &nbsp;</div></li><li><div>            'tags_user_displayname' =&gt; __('WordPress user display name', WYSIJA), &nbsp;</div></li><li><div>            'tags_user_count' =&gt; __('Total of subscribers', WYSIJA), &nbsp;</div></li><li><div>            'tags_newsletter' =&gt; __('Newsletter', WYSIJA), &nbsp;</div></li><li><div>            'tags_newsletter_subject' =&gt; __('Newsletter Subject', WYSIJA), &nbsp;</div></li><li><div>            'tags_newsletter_autonl' =&gt; __('Post Notifications', WYSIJA), &nbsp;</div></li><li><div>            'tags_newsletter_total' =&gt; __('Total number of posts or pages', WYSIJA), &nbsp;</div></li><li><div>            'tags_newsletter_post_title' =&gt; __('Latest post title', WYSIJA), &nbsp;</div></li><li><div>            'tags_newsletter_number' =&gt; __('Issue number', WYSIJA), &nbsp;</div></li><li><div>            'tags_date' =&gt; __('Date', WYSIJA), &nbsp;</div></li><li><div>            'tags_date_d' =&gt; __('Current day of the month number', WYSIJA), &nbsp;</div></li><li><div>            'tags_date_dordinal' =&gt; __('Current day of the month in ordinal, ie. 2nd, 3rd, etc.', WYSIJA), &nbsp;</div></li><li><div>            'tags_date_dtext' =&gt; __('Full name of current day', WYSIJA), &nbsp;</div></li><li><div>            'tags_date_m' =&gt; __('Current month number', WYSIJA), &nbsp;</div></li><li><div>            'tags_date_mtext' =&gt; __('Full name of current month', WYSIJA), &nbsp;</div></li><li><div>            'tags_date_y' =&gt; __('Year', WYSIJA), &nbsp;</div></li><li><div>            'tags_global' =&gt; __('Links', WYSIJA), &nbsp;</div></li><li><div>            'tags_global_unsubscribe' =&gt; __('Unsubscribe link', WYSIJA), &nbsp;</div></li><li><div>            'tags_global_manage' =&gt; __('Edit subscription page link', WYSIJA), &nbsp;</div></li><li><div>            'tags_global_browser' =&gt; __('View in browser link', WYSIJA), &nbsp;</div></li><li><div>            'custom_fields_title' =&gt; __('Custom Fields', WYSIJA), &nbsp;</div></li><li><div>            'custom_fields_list' =&gt; WJ_Field::get_all_names(), &nbsp;</div></li><li><div>            // Themes specific labels&nbsp;</div></li><li><div>            'theme_setting_default' =&gt; __('Saving default style...', WYSIJA), &nbsp;</div></li><li><div>            'theme_saved_default' =&gt; __('Default style saved.', WYSIJA), &nbsp;</div></li><li><div>            'theme_save_as_default' =&gt; __('Set as default style.', WYSIJA), &nbsp;</div></li><li><div>            // Placeholders&nbsp;</div></li><li><div>            'drop_block_here' =&gt; __('Insert block here', WYSIJA)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Data methods */&nbsp;</div></li><li><div>    function getData($type = null) {&nbsp;</div></li><li><div>        if($type !== null) {&nbsp;</div></li><li><div>            if(array_key_exists($type, $this-&gt;_data)) {&nbsp;</div></li><li><div>                return $this-&gt;_data[$type];&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // return default value&nbsp;</div></li><li><div>                $defaults = $this-&gt;getDefaultData();&nbsp;</div></li><li><div>                return $defaults[$type];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $this-&gt;_data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setData($value = null, $decode = false) {&nbsp;</div></li><li><div>        if(!$value) {&nbsp;</div></li><li><div>            $this-&gt;_data = $this-&gt;getDefaultData();&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;_data = $value;&nbsp;</div></li><li><div>            if($decode) {&nbsp;</div></li><li><div>                $this-&gt;_data = $this-&gt;getDecoded('data');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getEmailData($key = null) {&nbsp;</div></li><li><div>        if($key === null) {&nbsp;</div></li><li><div>            return $this-&gt;_email_data;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if(array_key_exists($key, $this-&gt;_email_data)) {&nbsp;</div></li><li><div>                return $this-&gt;_email_data[$key];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setEmailData($value = null) {&nbsp;</div></li><li><div>        if($value !== null) {&nbsp;</div></li><li><div>            $this-&gt;_email_data = $value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setLanguageDirection() {&nbsp;</div></li><li><div>        // right to left language property&nbsp;</div></li><li><div>        if(function_exists('is_rtl')) {&nbsp;</div></li><li><div>            $this-&gt;_is_rtl = is_rtl();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function isRtl() {&nbsp;</div></li><li><div>        return $this-&gt;_is_rtl;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getDefaultData() {&nbsp;</div></li><li><div>        $dividersHelper = WYSIJA::get('dividers', 'helper');&nbsp;</div></li><li><div>        return array(&nbsp;</div></li><li><div>            'header' =&gt; array(&nbsp;</div></li><li><div>                'alignment' =&gt; 'center', &nbsp;</div></li><li><div>                'type' =&gt; 'header', &nbsp;</div></li><li><div>                'static' =&gt; '1', &nbsp;</div></li><li><div>                'text' =&gt; null, &nbsp;</div></li><li><div>                'image' =&gt; array(&nbsp;</div></li><li><div>                    'src' =&gt; null, &nbsp;</div></li><li><div>                    'width' =&gt; 600, &nbsp;</div></li><li><div>                    'height' =&gt; 86, &nbsp;</div></li><li><div>                    'url' =&gt; null, &nbsp;</div></li><li><div>                    'alignment' =&gt; 'center', &nbsp;</div></li><li><div>                    'static' =&gt; '1'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'body' =&gt; array(), &nbsp;</div></li><li><div>            'footer' =&gt; array(&nbsp;</div></li><li><div>                'alignment' =&gt; 'center', &nbsp;</div></li><li><div>                'type' =&gt; 'footer', &nbsp;</div></li><li><div>                'static' =&gt; '1', &nbsp;</div></li><li><div>                'text' =&gt; null, &nbsp;</div></li><li><div>                'image' =&gt; array(&nbsp;</div></li><li><div>                    'src' =&gt; null, &nbsp;</div></li><li><div>                    'width' =&gt; 600, &nbsp;</div></li><li><div>                    'height' =&gt; 86, &nbsp;</div></li><li><div>                    'url' =&gt; null, &nbsp;</div></li><li><div>                    'alignment' =&gt; 'center', &nbsp;</div></li><li><div>                    'static' =&gt; '1'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'widgets' =&gt; array(&nbsp;</div></li><li><div>                'divider' =&gt; array_merge($dividersHelper-&gt;getDefault(), array('type' =&gt; 'divider'))&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Styles methods */&nbsp;</div></li><li><div>    function getStyles($keys = null) {&nbsp;</div></li><li><div>        if($keys === null) return $this-&gt;_styles;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(!is_array($keys)) {&nbsp;</div></li><li><div>            $keys = array($keys);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $output = array();&nbsp;</div></li><li><div>        for($i=0; $i&lt;count($keys);$i++) {&nbsp;</div></li><li><div>            if(isset($this-&gt;_styles[$keys[$i]])) {&nbsp;</div></li><li><div>                $output = array_merge($output, $this-&gt;_styles[$keys[$i]]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getStyle($key, $subkey) {&nbsp;</div></li><li><div>        $styles = $this-&gt;getStyles($key);&nbsp;</div></li><li><div>        return $styles[$subkey];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setStyles($value = null, $decode = false) {&nbsp;</div></li><li><div>        if(!$value) {&nbsp;</div></li><li><div>            $this-&gt;_styles = $this-&gt;getDefaultStyles();&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;_styles = $value;&nbsp;</div></li><li><div>            if($decode) {&nbsp;</div></li><li><div>                $this-&gt;_styles = $this-&gt;getDecoded('styles');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getDefaultStyles() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>            'html' =&gt; array(&nbsp;</div></li><li><div>                'background' =&gt; 'FFFFFF'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'header' =&gt; array(&nbsp;</div></li><li><div>                'background' =&gt; 'FFFFFF'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'body' =&gt; array(&nbsp;</div></li><li><div>                'color' =&gt; '000000', &nbsp;</div></li><li><div>                'family' =&gt; 'Arial', &nbsp;</div></li><li><div>                'size' =&gt; $this-&gt;TEXT_SIZES[5], &nbsp;</div></li><li><div>                'background' =&gt; 'FFFFFF'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'footer' =&gt; array(&nbsp;</div></li><li><div>                'color' =&gt; '000000', &nbsp;</div></li><li><div>                'family' =&gt; 'Arial', &nbsp;</div></li><li><div>                'size' =&gt; $this-&gt;TEXT_SIZES[5], &nbsp;</div></li><li><div>                'background' =&gt; 'cccccc'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'h1' =&gt; array(&nbsp;</div></li><li><div>                'color' =&gt; '000000', &nbsp;</div></li><li><div>                'family' =&gt; 'Arial', &nbsp;</div></li><li><div>                'size' =&gt; $this-&gt;TITLE_SIZES[6]&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'h2' =&gt; array(&nbsp;</div></li><li><div>                'color' =&gt; '424242', &nbsp;</div></li><li><div>                'family' =&gt; 'Arial', &nbsp;</div></li><li><div>                'size' =&gt; $this-&gt;TITLE_SIZES[5]&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'h3' =&gt; array(&nbsp;</div></li><li><div>                'color' =&gt; '424242', &nbsp;</div></li><li><div>                'family' =&gt; 'Arial', &nbsp;</div></li><li><div>                'size' =&gt; $this-&gt;TITLE_SIZES[4]&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'a' =&gt; array(&nbsp;</div></li><li><div>                'color' =&gt; '4a91b0', &nbsp;</div></li><li><div>                'underline' =&gt; false&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'unsubscribe' =&gt; array(&nbsp;</div></li><li><div>                'color' =&gt; '000000'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'viewbrowser' =&gt; array(&nbsp;</div></li><li><div>                'color' =&gt; '000000', &nbsp;</div></li><li><div>                'family' =&gt; 'Arial', &nbsp;</div></li><li><div>                'size' =&gt; $this-&gt;VIEWBROWSER_SIZES[4]&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get default selected theme&nbsp;</div></li><li><div>        $model_config = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        $default_theme = $model_config-&gt;getValue('newsletter_default_theme', 'default');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($default_theme === 'default') {&nbsp;</div></li><li><div>            return $defaults;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $helper_themes = WYSIJA::get('themes', 'helper');&nbsp;</div></li><li><div>            $stylesheet = $helper_themes-&gt;getStylesheet($default_theme);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $styles = array();&nbsp;</div></li><li><div>            // look for each tags&nbsp;</div></li><li><div>            foreach($defaults as $tag =&gt; $values) {&nbsp;</div></li><li><div>                // look for css rules&nbsp;</div></li><li><div>                preg_match('/\.?'.$tag.'\s?{(.+)}/Ui', $stylesheet, $matches);&nbsp;</div></li><li><div>                if(isset($matches[1])) {&nbsp;</div></li><li><div>                    // extract styles&nbsp;</div></li><li><div>                    $styles[$tag] = $this-&gt;extractStyles($matches[1]);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // fallback to default&nbsp;</div></li><li><div>                    $styles[$tag] = $defaults[$tag];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $styles;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getApplicationData() {&nbsp;</div></li><li><div>        $app = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $app['domain'] = WJ_Utils::get_domain();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $app;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Editor methods */&nbsp;</div></li><li><div>    function renderEditor() {&nbsp;</div></li><li><div>        $this-&gt;setContext('editor');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($this-&gt;isDataValid() === false) {&nbsp;</div></li><li><div>            throw new Exception('data is not valid');&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>            $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // get company addressfrom settings&nbsp;</div></li><li><div>            $config=WYSIJA::get(&quot;config&quot;, &quot;model&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data = array(&nbsp;</div></li><li><div>                'header' =&gt; $this-&gt;renderEditorHeader(), &nbsp;</div></li><li><div>                'body' =&gt; $this-&gt;renderEditorBody(), &nbsp;</div></li><li><div>                'footer' =&gt; $this-&gt;renderEditorFooter(), &nbsp;</div></li><li><div>                'unsubscribe' =&gt; $config-&gt;emailFooterLinks(true), &nbsp;</div></li><li><div>                'company_address' =&gt; nl2br($config-&gt;getValue('company_address')), &nbsp;</div></li><li><div>                'is_debug' =&gt; $this-&gt;isDebug(), &nbsp;</div></li><li><div>                'i18n' =&gt; $this-&gt;getTranslations()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $viewbrowser = $config-&gt;view_in_browser_link(true);&nbsp;</div></li><li><div>            if($viewbrowser) {&nbsp;</div></li><li><div>                $data['viewbrowser'] = $viewbrowser;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $helper_render_engine-&gt;render($data, 'templates/newsletter/editor/editor_template.html');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEditorHeader($data = null) {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($data !== null) {&nbsp;</div></li><li><div>            $block = $data;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $block = $this-&gt;getData('header');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array_merge($block, array('i18n' =&gt; $this-&gt;getTranslations()));&nbsp;</div></li><li><div>        return $helper_render_engine-&gt;render($data, 'templates/newsletter/editor/header_template.html');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEditorBody() {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $blocks = $this-&gt;getData('body');&nbsp;</div></li><li><div>        if(empty($blocks)) return '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $body = '';&nbsp;</div></li><li><div>        foreach($blocks as $key =&gt; $block) {&nbsp;</div></li><li><div>            // generate block template&nbsp;</div></li><li><div>            $data = array_merge($block, array('i18n' =&gt; $this-&gt;getTranslations()));&nbsp;</div></li><li><div>            $body .= $helper_render_engine-&gt;render($data, 'templates/newsletter/editor/block_template.html');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $body;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEditorFooter($data = null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($data !== null) {&nbsp;</div></li><li><div>            $block = $data;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $block = $this-&gt;getData('footer');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array_merge($block, array('i18n' =&gt; $this-&gt;getTranslations()));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $helper_render_engine-&gt;render($data, 'templates/newsletter/editor/footer_template.html');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEditorBlock($block = array()) {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $block['i18n'] = $this-&gt;getTranslations();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $helper_render_engine-&gt;render($block, 'templates/newsletter/editor/block_'.$block['type'].'.html');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** render auto post */&nbsp;</div></li><li><div>    function renderEditorAutoPost($posts = array(), $params = array()) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>        if(isset($params['post_ids'])) {&nbsp;</div></li><li><div>            $output .= '&lt;input type=&quot;hidden&quot; name=&quot;post_ids&quot; value=&quot;'.$params['post_ids'].'&quot; /&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check if there are posts to display&nbsp;</div></li><li><div>        if(empty($posts)) {&nbsp;</div></li><li><div>            // set background color&nbsp;</div></li><li><div>            $background_color = '';&nbsp;</div></li><li><div>            if(isset($params['bgcolor1'])) {&nbsp;</div></li><li><div>                $background_color = $params['bgcolor1'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // display a message stating that the latest content has been sent&nbsp;</div></li><li><div>            $block = array(&nbsp;</div></li><li><div>                'no-block' =&gt; true, &nbsp;</div></li><li><div>                'type' =&gt; 'content', &nbsp;</div></li><li><div>                'alignment' =&gt; 'center', &nbsp;</div></li><li><div>                'background_color' =&gt; $background_color, &nbsp;</div></li><li><div>                'image' =&gt; null, &nbsp;</div></li><li><div>                'text' =&gt; array('value' =&gt; base64_encode(__('Latest content already sent.', WYSIJA)))&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $output .= $this-&gt;renderEditorBlock($block);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // otherwise, render all posts into blocks&nbsp;</div></li><li><div>            $output .= $this-&gt;renderPostsToBlocks($posts, $params, 'autopost');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEmailAutoPost($posts = array(), $params = array()) {&nbsp;</div></li><li><div>        if(empty($posts)) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $this-&gt;renderPostsToBlocks($posts, $params, 'autopost');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEmailBlock($block = array()) {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set block background color&nbsp;</div></li><li><div>        $background_color = null;&nbsp;</div></li><li><div>        if(isset($block['background_color'])) {&nbsp;</div></li><li><div>            $background_color = $block['background_color'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set rtl mode&nbsp;</div></li><li><div>        $block['is_rtl'] = $this-&gt;isRtl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $blockHTML = $helper_render_engine-&gt;render($block, 'templates/newsletter/email/block_template.html');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // convert lists&nbsp;</div></li><li><div>        $blockHTML = $this-&gt;convertLists($blockHTML);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // apply inline styles&nbsp;</div></li><li><div>        $blockHTML = $this-&gt;applyInlineStyles('body', $blockHTML, array('background_color' =&gt; $background_color));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $blockHTML;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderPostsToBlocks($posts = array(), $params = array(), $mode = 'post') {&nbsp;</div></li><li><div>        $html = '';&nbsp;</div></li><li><div>        $context = $this-&gt;getContext();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $helper_articles = WYSIJA::get('articles', 'helper');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($params['title_tag'] === 'list') {&nbsp;</div></li><li><div>            $list = '&lt;ul class=&quot;align-'.$params['title_alignment'].'&quot;&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // make sure empty bgcolors are set to transparent&nbsp;</div></li><li><div>        if(!isset($params['bgcolor1']) || (isset($params['bgcolor1']) && strlen($params['bgcolor1']) === 0)) {&nbsp;</div></li><li><div>            $params['bgcolor1'] = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if(!isset($params['bgcolor2']) || (isset($params['bgcolor2']) && strlen($params['bgcolor2']) === 0)) {&nbsp;</div></li><li><div>            $params['bgcolor2'] = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // BEGIN - posts&nbsp;</div></li><li><div>        for($i = 0, $count = count($posts); $i &lt; $count; $i++) {&nbsp;</div></li><li><div>            $post = $posts[$i];&nbsp;</div></li><li><div>            $is_odd = (bool)($i % 2);&nbsp;</div></li><li><div>            $is_last = (bool)($i === ($count - 1));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // set default background color to transparent&nbsp;</div></li><li><div>            $background_color = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // set background color for each post&nbsp;</div></li><li><div>            if($is_odd === false) $background_color = $params['bgcolor1'];&nbsp;</div></li><li><div>            if($is_odd === true) $background_color = $params['bgcolor2'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($params['image_alignment'] === 'alternate') {&nbsp;</div></li><li><div>                $image_alignment = ($is_odd ===  false) ? 'left' : 'right';&nbsp;</div></li><li><div>            } else if($params['image_alignment'] === 'none') {&nbsp;</div></li><li><div>                $image_alignment = 'left';&nbsp;</div></li><li><div>                $post['post_image'] = null;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $image_alignment = $params['image_alignment'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // build basic block data&nbsp;</div></li><li><div>            $block = array(&nbsp;</div></li><li><div>                'position' =&gt; $i, &nbsp;</div></li><li><div>                'type' =&gt; 'content', &nbsp;</div></li><li><div>                'alignment' =&gt; $image_alignment, &nbsp;</div></li><li><div>                'background_color' =&gt; $background_color, &nbsp;</div></li><li><div>                'image' =&gt; null, &nbsp;</div></li><li><div>                'text' =&gt; null&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // in case of autopost, we need to remove the &quot;block&quot; container because each block will be rendered within the autopost block&nbsp;</div></li><li><div>            if($mode === 'autopost') {&nbsp;</div></li><li><div>                $block['no-block'] = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // get title&nbsp;</div></li><li><div>            $title = $helper_articles-&gt;getPostTitle($post, $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if(!isset($params['title_position'])) {&nbsp;</div></li><li><div>                $params['title_position'] = 'inside';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // if post content is title, force title position inside&nbsp;</div></li><li><div>            if($params['post_content'] === 'title') {&nbsp;</div></li><li><div>                $params['title_position'] = 'inside';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // only display titles as a list&nbsp;</div></li><li><div>            if($params['title_tag'] === 'list') {&nbsp;</div></li><li><div>                $list .= $title;&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // if the title is outside, generate its own block&nbsp;</div></li><li><div>            if($params['title_position'] === 'outside') {&nbsp;</div></li><li><div>                // generate title&nbsp;</div></li><li><div>                $title_block = array_merge($block, array(&nbsp;</div></li><li><div>                    'alignment' =&gt; 'left', &nbsp;</div></li><li><div>                    'text' =&gt; array(&nbsp;</div></li><li><div>                        'value' =&gt; base64_encode($title)&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if($context === 'editor') {&nbsp;</div></li><li><div>                    $html .= $this-&gt;renderEditorBlock($title_block);&nbsp;</div></li><li><div>                } else if($context === 'email') {&nbsp;</div></li><li><div>                    $html .= $this-&gt;renderEmailBlock($title_block);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // generate content&nbsp;</div></li><li><div>            $content_block = array_merge($block, $helper_articles-&gt;convertPostToBlock($post, array_merge($params, array('image_alignment' =&gt; $image_alignment))));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($context === 'editor') {&nbsp;</div></li><li><div>                $html .= $this-&gt;renderEditorBlock($content_block);&nbsp;</div></li><li><div>            } else if($context === 'email') {&nbsp;</div></li><li><div>                $html .= $this-&gt;renderEmailBlock($content_block);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // display divider if required&nbsp;</div></li><li><div>            if(isset($params['divider']) && ($params['divider'] !== null && $is_last === false)) {&nbsp;</div></li><li><div>                // display divider only if there is one and if it's not the last post&nbsp;</div></li><li><div>                $divider_block = array_merge(&nbsp;</div></li><li><div>                    array(&nbsp;</div></li><li><div>                        'type' =&gt; 'divider', &nbsp;</div></li><li><div>                        'no-block' =&gt; ($mode === 'autopost')&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    $params['divider']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if($context === 'editor') {&nbsp;</div></li><li><div>                    $html .= $this-&gt;renderEditorBlock($divider_block);&nbsp;</div></li><li><div>                } else if($context === 'email') {&nbsp;</div></li><li><div>                    $html .= $this-&gt;renderEmailBlock($divider_block);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // END - Posts&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($params['title_tag'] === 'list') {&nbsp;</div></li><li><div>            $list .= '&lt;/ul&gt;';&nbsp;</div></li><li><div>            $list_block = array_merge($block, array(&nbsp;</div></li><li><div>                'alignment' =&gt; 'center', &nbsp;</div></li><li><div>                'type' =&gt; 'content', &nbsp;</div></li><li><div>                'text' =&gt; array(&nbsp;</div></li><li><div>                    'value' =&gt; base64_encode($list)&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>            if($context === 'editor') {&nbsp;</div></li><li><div>                $html .= $this-&gt;renderEditorBlock($list_block);&nbsp;</div></li><li><div>            } else if($context === 'email') {&nbsp;</div></li><li><div>                $html .= $this-&gt;renderEmailBlock($list_block);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $html;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** render draggable images list */&nbsp;</div></li><li><div>    function renderImages($data = array()) {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $helper_render_engine-&gt;render(array('images' =&gt; $data), 'templates/newsletter/editor/toolbar/images.html');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** render themes list */&nbsp;</div></li><li><div>    function renderThemes() {&nbsp;</div></li><li><div>        $themes = array();&nbsp;</div></li><li><div>        $hThemes = WYSIJA::get('themes', 'helper');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $installed = $hThemes-&gt;getInstalled();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get default selected theme&nbsp;</div></li><li><div>        $model_config = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        $default_theme = $model_config-&gt;getValue('newsletter_default_theme', 'default');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($installed)) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            foreach($installed as $theme) {&nbsp;</div></li><li><div>                $theme_info = $hThemes-&gt;getInformation($theme);&nbsp;</div></li><li><div>                $theme_info['is_selected'] = (bool)($default_theme === $theme);&nbsp;</div></li><li><div>                $themes[] = $theme_info;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $helper_render_engine-&gt;render(array('themes' =&gt; $themes, 'i18n' =&gt; $this-&gt;getTranslations()), 'templates/newsletter/editor/toolbar/themes.html');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderThemeStyles($theme = 'default') {&nbsp;</div></li><li><div>        $this-&gt;setContext('editor');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $hThemes = WYSIJA::get('themes', 'helper');&nbsp;</div></li><li><div>        $stylesheet = $hThemes-&gt;getStylesheet($theme);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($stylesheet === NULL) {&nbsp;</div></li><li><div>            // load default settings&nbsp;</div></li><li><div>            $this-&gt;setStyles(null);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // a stylesheet has been found, let's extract styles&nbsp;</div></li><li><div>            $styles = array();&nbsp;</div></li><li><div>            $defaults = $this-&gt;getDefaultStyles();&nbsp;</div></li><li><div>            // look for each tags&nbsp;</div></li><li><div>            foreach($defaults as $tag =&gt; $values) {&nbsp;</div></li><li><div>                // look for css rules&nbsp;</div></li><li><div>                preg_match('/\.?'.$tag.'\s?{(.+)}/Ui', $stylesheet, $matches);&nbsp;</div></li><li><div>                if(isset($matches[1])) {&nbsp;</div></li><li><div>                    // extract styles&nbsp;</div></li><li><div>                    $styles[$tag] = $this-&gt;extractStyles($matches[1]);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // fallback to default&nbsp;</div></li><li><div>                    $styles[$tag] = $defaults[$tag];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;setStyles($styles);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array(&nbsp;</div></li><li><div>            'css' =&gt; $this-&gt;renderStyles(), &nbsp;</div></li><li><div>            'form' =&gt; $this-&gt;renderStylesBar()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function extractStyles($raw) {&nbsp;</div></li><li><div>        $rules = explode(';', $raw);&nbsp;</div></li><li><div>        $output = array();&nbsp;</div></li><li><div>        foreach($rules as $rule) {&nbsp;</div></li><li><div>            $sub_property = false;&nbsp;</div></li><li><div>            $combo = explode(':', $rule);&nbsp;</div></li><li><div>            if(count($combo) === 2) {&nbsp;</div></li><li><div>                list($property, $value) = $combo;&nbsp;</div></li><li><div>                // remove leading and trailing space&nbsp;</div></li><li><div>                $property = trim($property);&nbsp;</div></li><li><div>                $value = trim($value);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch($property) {&nbsp;</div></li><li><div>                case 'background':&nbsp;</div></li><li><div>                case 'background-color':&nbsp;</div></li><li><div>                    $property = 'background';&nbsp;</div></li><li><div>                case 'color':&nbsp;</div></li><li><div>                    // remove # from color&nbsp;</div></li><li><div>                    $value = str_replace('#', '', $value);&nbsp;</div></li><li><div>                    // check if its a 3 chars color&nbsp;</div></li><li><div>                    if(strlen($value) === 3) {&nbsp;</div></li><li><div>                        $value = sprintf('%s%s%s%s%s%s', substr($value, 0, 1), substr($value, 0, 1), substr($value, 1, 1), substr($value, 1, 1), substr($value, 2, 1), substr($value, 2, 1));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'font-family':&nbsp;</div></li><li><div>                    $property = 'family';&nbsp;</div></li><li><div>                    $fonts = explode(', ', $value);&nbsp;</div></li><li><div>                    $value = array_shift($fonts);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'font-size':&nbsp;</div></li><li><div>                    $property = 'size';&nbsp;</div></li><li><div>                case 'height':&nbsp;</div></li><li><div>                    $value = (int)$value;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'text-decoration':&nbsp;</div></li><li><div>                    $property = 'underline';&nbsp;</div></li><li><div>                    $value = ($value === 'none') ? '-1' : '1';&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'border-color':&nbsp;</div></li><li><div>                    // remove # from color&nbsp;</div></li><li><div>                    $value = str_replace('#', '', $value);&nbsp;</div></li><li><div>                    // check if its a 3 chars color&nbsp;</div></li><li><div>                    if(strlen($value) === 3) {&nbsp;</div></li><li><div>                        $value = sprintf('%s%s%s%s%s%s', substr($value, 0, 1), substr($value, 0, 1), substr($value, 1, 1), substr($value, 1, 1), substr($value, 2, 1), substr($value, 2, 1));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    list($property, $sub_property) = explode('-', $property);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'border-size':&nbsp;</div></li><li><div>                    $value = (int)$value;&nbsp;</div></li><li><div>                    list($property, $sub_property) = explode('-', $property);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'border-style':&nbsp;</div></li><li><div>                    list($property, $sub_property) = explode('-', $property);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($sub_property !== FALSE) {&nbsp;</div></li><li><div>                $output[$property][$sub_property] = $value;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $output[$property] = $value;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderTheme($theme = 'default') {&nbsp;</div></li><li><div>        $output = array(&nbsp;</div></li><li><div>            'header' =&gt; null, &nbsp;</div></li><li><div>            'footer' =&gt; null, &nbsp;</div></li><li><div>            'divider' =&gt; null&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $hThemes = WYSIJA::get('themes', 'helper');&nbsp;</div></li><li><div>        $data = $hThemes-&gt;getData($theme);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($data['header'] !== NULL) {&nbsp;</div></li><li><div>            $output['header'] = $this-&gt;renderEditorHeader($data['header']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($data['footer'] !== NULL) {&nbsp;</div></li><li><div>            $output['footer'] = $this-&gt;renderEditorFooter($data['footer']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($data['divider'] !== NULL) {&nbsp;</div></li><li><div>            $output['divider'] = $this-&gt;renderEditorBlock(array_merge(array('no-block' =&gt; true), $data['divider']));&nbsp;</div></li><li><div>            $output['divider_options'] = $data['divider'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** render styles bar */&nbsp;</div></li><li><div>    function renderStylesBar() {&nbsp;</div></li><li><div>        $this-&gt;setContext('editor');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = $this-&gt;getStyles();&nbsp;</div></li><li><div>        $data['i18n'] = $this-&gt;getTranslations();&nbsp;</div></li><li><div>        $data['TEXT_SIZES'] = $this-&gt;TEXT_SIZES;&nbsp;</div></li><li><div>        $data['VIEWBROWSER_SIZES'] = $this-&gt;VIEWBROWSER_SIZES;&nbsp;</div></li><li><div>        $data['TITLE_SIZES'] = $this-&gt;TITLE_SIZES;&nbsp;</div></li><li><div>        $data['FONTS'] = array_keys($this-&gt;FONTS);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $helper_render_engine-&gt;render($data, 'templates/newsletter/editor/toolbar/styles.html');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatStyles($styles = array()) {&nbsp;</div></li><li><div>        if(empty($styles)) return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array();&nbsp;</div></li><li><div>        foreach($styles as $style =&gt; $value) {&nbsp;</div></li><li><div>            $stylesArray = explode('-', $style);&nbsp;</div></li><li><div>            if(count($stylesArray) === 2) {&nbsp;</div></li><li><div>                $data[$stylesArray[0]][$stylesArray[1]] = $value;&nbsp;</div></li><li><div>            } else if(count($stylesArray) === 3) {&nbsp;</div></li><li><div>                // handle transparent colors&nbsp;</div></li><li><div>                if($stylesArray[2] === 'transparent') {&nbsp;</div></li><li><div>                    $data[$stylesArray[0]][$stylesArray[1]] = $stylesArray[2];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $data[$stylesArray[0]][$stylesArray[1]][$stylesArray[2]] = $value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getContext() {&nbsp;</div></li><li><div>        return $this-&gt;_context;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setContext($value = null) {&nbsp;</div></li><li><div>        if($value !== null) $this-&gt;_context = $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function isDebug() {&nbsp;</div></li><li><div>        return ($this-&gt;_debug === true);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getEncoded($type = 'data') {&nbsp;</div></li><li><div>        return base64_encode(serialize($this-&gt;{'get'.ucfirst($type)}()));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function getDecoded($type = 'data') {&nbsp;</div></li><li><div>        return unserialize(base64_decode($this-&gt;{'get'.ucfirst($type)}()));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** methods */&nbsp;</div></li><li><div>    function isDataValid() {&nbsp;</div></li><li><div>        return ($this-&gt;getData() !== null);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Styles methods */&nbsp;</div></li><li><div>    function renderStyles() {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setInline(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = $this-&gt;getStyles();&nbsp;</div></li><li><div>        $data['context'] = $this-&gt;getContext();&nbsp;</div></li><li><div>        $data['is_rtl'] = $this-&gt;isRtl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch($data['context']) {&nbsp;</div></li><li><div>            case 'editor':&nbsp;</div></li><li><div>                $helper_render_engine-&gt;setStripSpecialchars(false);&nbsp;</div></li><li><div>                $data['viewbrowser_container'] = '#wysija_viewbrowser';&nbsp;</div></li><li><div>                $data['wysija_container'] = '#wysija_wrapper';&nbsp;</div></li><li><div>                $data['header_container'] = '#wysija_header';&nbsp;</div></li><li><div>                $data['body_container'] = '#wysija_body';&nbsp;</div></li><li><div>                $data['text_container'] = '.wysija_editable';&nbsp;</div></li><li><div>                $data['footer_container'] = '#wysija_footer';&nbsp;</div></li><li><div>                $data['placeholder_container'] = '#wysija_block_placeholder';&nbsp;</div></li><li><div>                $data['unsubscribe_container'] = '#wysija_unsubscribe';&nbsp;</div></li><li><div>                return $helper_render_engine-&gt;render($data, 'styles/css-'.$data['context'].'.html');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'email':&nbsp;</div></li><li><div>                $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>                $data['wysija_container'] = '#wysija_wrapper';&nbsp;</div></li><li><div>                $data['viewbrowser_container'] = '.wysija_viewbrowser_container';&nbsp;</div></li><li><div>                $data['header'] = '.wysija_header';&nbsp;</div></li><li><div>                $data['header_container'] = '.wysija_header_container';&nbsp;</div></li><li><div>                $data['body_container'] = '.wysija_block';&nbsp;</div></li><li><div>                $data['text_container'] = '.wysija_text_container';&nbsp;</div></li><li><div>                $data['image_container'] = '.wysija_image_container';&nbsp;</div></li><li><div>                $data['image_placeholder'] = '.wysija_image_placeholder';&nbsp;</div></li><li><div>                $data['footer'] = '.wysija_footer';&nbsp;</div></li><li><div>                $data['footer_container'] = '.wysija_footer_container';&nbsp;</div></li><li><div>                $data['unsubscribe_container'] = '.wysija_unsubscribe_container';&nbsp;</div></li><li><div>                return $helper_render_engine-&gt;render($data, 'templates/newsletter/email/css.html');&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Email methods */&nbsp;</div></li><li><div>    function renderNotification($email = NULL) {&nbsp;</div></li><li><div>        $this-&gt;_hide_viewbrowser = true;&nbsp;</div></li><li><div>        $this-&gt;_hide_unsubscribe = true;&nbsp;</div></li><li><div>        return $this-&gt;renderEmail($email);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEmail($email = NULL) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // fixes issue with pcre functions&nbsp;</div></li><li><div>        @ini_set('pcre.backtrack_limit', 1000000);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;setContext('email');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set language direction&nbsp;</div></li><li><div>        $this-&gt;setLanguageDirection();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($this-&gt;isDataValid() === false) {&nbsp;</div></li><li><div>            throw new Exception('data is not valid');&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // set email data for later use&nbsp;</div></li><li><div>            $this-&gt;setEmailData($email);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // render header&nbsp;</div></li><li><div>            $data = array(&nbsp;</div></li><li><div>                'viewbrowser' =&gt; $this-&gt;renderEmailViewBrowser(), &nbsp;</div></li><li><div>                'header' =&gt; $this-&gt;renderEmailHeader(), &nbsp;</div></li><li><div>                'body' =&gt; $this-&gt;renderEmailBody(), &nbsp;</div></li><li><div>                'footer' =&gt; $this-&gt;renderEmailFooter(), &nbsp;</div></li><li><div>                'unsubscribe' =&gt; $this-&gt;renderEmailUnsubscribe(), &nbsp;</div></li><li><div>                'css' =&gt; $this-&gt;renderStyles(), &nbsp;</div></li><li><div>                'styles' =&gt; $this-&gt;getStyles(), &nbsp;</div></li><li><div>                'hide_viewbrowser' =&gt; $this-&gt;_hide_viewbrowser, &nbsp;</div></li><li><div>                'hide_unsubscribe' =&gt; $this-&gt;_hide_unsubscribe&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // get language direction&nbsp;</div></li><li><div>            $data['is_rtl'] = $this-&gt;isRtl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // set email subject if specified&nbsp;</div></li><li><div>            $data['subject'] = $this-&gt;getEmailData('subject');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>            $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>            $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>            $helper_render_engine-&gt;setInline(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            try {&nbsp;</div></li><li><div>                $template = $helper_render_engine-&gt;render($data, 'templates/newsletter/email/email_template.html');&nbsp;</div></li><li><div>                $template = preg_replace('/\s*(?!&lt;\&quot;)\/\*[^\*]+\*\/(?!\&quot;)\s*/', '', $template);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $template;&nbsp;</div></li><li><div>            } catch(Exception $e) {&nbsp;</div></li><li><div>                return '';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEmailViewBrowser() {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $config=WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        $data = $config-&gt;view_in_browser_link();&nbsp;</div></li><li><div>        if(!isset($data['link'])) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // generate block template&nbsp;</div></li><li><div>            $viewbrowser = $helper_render_engine-&gt;render($data, 'templates/newsletter/email/viewbrowser_template.html');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // apply inline styles&nbsp;</div></li><li><div>            $viewbrowser = $this-&gt;applyInlineStyles('viewbrowser', $viewbrowser);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $viewbrowser;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEmailUnsubscribe() {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $config = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = array(&nbsp;</div></li><li><div>            'unsubscribe' =&gt; $config-&gt;emailFooterLinks(), &nbsp;</div></li><li><div>            'company_address' =&gt; nl2br($config-&gt;getValue('company_address'))&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // generate block template&nbsp;</div></li><li><div>        $unsubscribe = $helper_render_engine-&gt;render($data, 'templates/newsletter/email/unsubscribe_template.html');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // apply inline styles&nbsp;</div></li><li><div>        $unsubscribe = $this-&gt;applyInlineStyles('unsubscribe', $unsubscribe);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $unsubscribe;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEmailHeader() {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = $this-&gt;getData('header');&nbsp;</div></li><li><div>        $data['styles'] = array('header' =&gt; $this-&gt;getStyles('header'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check for emptyness&nbsp;</div></li><li><div>        if($data['text'] === NULL and $data['image']['static'] === TRUE) {&nbsp;</div></li><li><div>            return NULL;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set header content width&nbsp;</div></li><li><div>        $data['block_width'] = 600;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // generate block template&nbsp;</div></li><li><div>        $header = $helper_render_engine-&gt;render($data, 'templates/newsletter/email/header_template.html');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // apply inline styles&nbsp;</div></li><li><div>        $header = $this-&gt;applyInlineStyles('header', $header);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $header;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function encodeParameters($params = array()) {&nbsp;</div></li><li><div>        // encode string parameters&nbsp;</div></li><li><div>        $keys_to_encode = array('author_label', 'category_label', 'readmore');&nbsp;</div></li><li><div>        foreach($keys_to_encode as $key) {&nbsp;</div></li><li><div>            if(isset($params[$key]) && strlen(trim($params[$key])) &gt; 0) {&nbsp;</div></li><li><div>                $params[$key] = base64_encode(stripslashes($params[$key]));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $params;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function decodeParameters($params = array()) {&nbsp;</div></li><li><div>        // decode string parameters&nbsp;</div></li><li><div>        $keys_to_decode = array('author_label', 'category_label', 'readmore');&nbsp;</div></li><li><div>        foreach($keys_to_decode as $key) {&nbsp;</div></li><li><div>            if(isset($params[$key]) && strlen(trim($params[$key])) &gt; 0) {&nbsp;</div></li><li><div>                $params[$key] = base64_decode($params[$key]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $params;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEmailBody() {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $blocks = $this-&gt;getData('body');&nbsp;</div></li><li><div>        $styles = array('body' =&gt; $this-&gt;getStyles('body'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // default newsletter type&nbsp;</div></li><li><div>        $newsletter_type = 'default';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check if we need to interpret shortcodes&nbsp;</div></li><li><div>        $model_config = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        $interpret_shortcode = (bool)$model_config-&gt;getValue('interp_shortcode');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $body = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check if we are dealing with an auto newsletter&nbsp;</div></li><li><div>        $email = $this-&gt;getEmailData();&nbsp;</div></li><li><div>        if(isset($email['params']['autonl']) && !empty($email['params']['autonl'])) {&nbsp;</div></li><li><div>            // set newsletter type to automattic newsletter&nbsp;</div></li><li><div>            $newsletter_type = 'automatic';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // posts data&nbsp;</div></li><li><div>            $first_subject = null;&nbsp;</div></li><li><div>            $post_count = 0;&nbsp;</div></li><li><div>            $post_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach($blocks as $key =&gt; $block) {&nbsp;</div></li><li><div>            // reset block HTML so as to avoid duplicates&nbsp;</div></li><li><div>            $blockHTML = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // reset category_ids&nbsp;</div></li><li><div>                        $include_category_ids = array();&nbsp;</div></li><li><div>                        $exclude_category_ids = array();&nbsp;</div></li><li><div>                        $category_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // specific background color&nbsp;</div></li><li><div>            $block_background_color = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // get background color if specified&nbsp;</div></li><li><div>            if(isset($block['background_color']) && strlen($block['background_color']) === 6) {&nbsp;</div></li><li><div>                $block_background_color = $block['background_color'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // block width&nbsp;</div></li><li><div>            $block['block_width'] = 600;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($block['type'] === 'auto-post') {&nbsp;</div></li><li><div>                // special case for auto post, we need to fetch posts, taking previously sent posts into account&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // get email data&nbsp;</div></li><li><div>                //$email = $this-&gt;getEmailData();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // get block params&nbsp;</div></li><li><div>                $blockParams = $block['params'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // format parameters&nbsp;</div></li><li><div>                $params = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $category_ids = array();&nbsp;</div></li><li><div>                $category_condition = 'include';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach($blockParams as $pairs) {&nbsp;</div></li><li><div>                    // store category_ids in email for better performance on immediate sending of WP Posts.&nbsp;</div></li><li><div>                    if($pairs['key'] === 'category_ids') {&nbsp;</div></li><li><div>                        $pair_value = trim($pairs['value']);&nbsp;</div></li><li><div>                        if(!empty($pair_value)) {&nbsp;</div></li><li><div>                            $category_ids = array_map('intval', explode(', ', trim($pairs['value'])));&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // store category condition (include / exclude) for same above reason.&nbsp;</div></li><li><div>                    if($pairs['key'] === 'category_condition') {&nbsp;</div></li><li><div>                        $category_condition = (in_array(trim($pairs['value']), array('include', 'exclude'))) ? trim($pairs['value']) : 'include';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $params[$pairs['key']] = $pairs['value'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // make sure we store category_ids&nbsp;</div></li><li><div>                if(!empty($category_ids)) {&nbsp;</div></li><li><div>                    if($category_condition === 'include') {&nbsp;</div></li><li><div>                        $include_category_ids = array_unique($category_ids);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if($category_condition === 'exclude') {&nbsp;</div></li><li><div>                        $exclude_category_ids = array_unique($category_ids);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // make sure empty bgcolors are set to transparent&nbsp;</div></li><li><div>                if(isset($params['bgcolor1']) && strlen($params['bgcolor1']) === 0) {&nbsp;</div></li><li><div>                    $params['bgcolor1'] = 'transparent';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if(isset($params['bgcolor2']) && strlen($params['bgcolor2']) === 0) {&nbsp;</div></li><li><div>                    $params['bgcolor2'] = 'transparent';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // make sure the default params are set&nbsp;</div></li><li><div>                if(array_key_exists('autonl', $email['params']) === false) {&nbsp;</div></li><li><div>                    $email['params']['autonl'] = array();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if(array_key_exists('articles', $email['params']['autonl']) === false) {&nbsp;</div></li><li><div>                    $email['params']['autonl']['articles'] = array(&nbsp;</div></li><li><div>                        'ids' =&gt; array(), &nbsp;</div></li><li><div>                        'count' =&gt; 0, &nbsp;</div></li><li><div>                        'first_subject' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // exclude already sent post ids from selection&nbsp;</div></li><li><div>                if(!empty($email['params']['autonl']['articles']['ids'])) {&nbsp;</div></li><li><div>                    $params['exclude'] = $email['params']['autonl']['articles']['ids'];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $email['params']['autonl']['articles']['ids'] = array();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                //we set the post_date to filter articles only older than that one&nbsp;</div></li><li><div>                if(isset($email['params']['autonl']['firstSend'])) {&nbsp;</div></li><li><div>                    $params['post_date'] = $email['params']['autonl']['firstSend'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                 // if immediate let it know to the get post&nbsp;</div></li><li><div>                if(isset($email['params']['autonl']['articles']['immediatepostid'])) {&nbsp;</div></li><li><div>                    $params['include'] = (int)$email['params']['autonl']['articles']['immediatepostid'];&nbsp;</div></li><li><div>                    $params['post_limit'] = 1;&nbsp;</div></li><li><div>                }else{&nbsp;</div></li><li><div>                    //we set the post_date to filter articles only older than the last time we sent articles&nbsp;</div></li><li><div>                    if(isset($email['params']['autonl']['lastSend'])) {&nbsp;</div></li><li><div>                        $params['post_date'] = $email['params']['autonl']['lastSend'];&nbsp;</div></li><li><div>                    }else{&nbsp;</div></li><li><div>                        //get the latest child newsletter sent_at value&nbsp;</div></li><li><div>                        $mEmail=WYSIJA::get('email', 'model');&nbsp;</div></li><li><div>                        $mEmail-&gt;reset();&nbsp;</div></li><li><div>                        $mEmail-&gt;orderBy('email_id', 'DESC');&nbsp;</div></li><li><div>                        $lastEmailSent=$mEmail-&gt;getOne(false, array('campaign_id'=&gt;$email['campaign_id'], 'type'=&gt;'1'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if(!empty($lastEmailSent)) $params['post_date'] = $lastEmailSent['sent_at'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // decode specific keys&nbsp;</div></li><li><div>                $params = $this-&gt;decodeParameters($params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // include/exclude category_ids&nbsp;</div></li><li><div>                $params['include_category_ids'] = $include_category_ids;&nbsp;</div></li><li><div>                $params['exclude_category_ids'] = $exclude_category_ids;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // check for already inserted posts&nbsp;</div></li><li><div>                if(!empty($post_ids)) {&nbsp;</div></li><li><div>                    $params['exclude'] = $post_ids;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // get posts for this block&nbsp;</div></li><li><div>                $model_wp_posts = WYSIJA::get('wp_posts', 'model');&nbsp;</div></li><li><div>                $posts = $model_wp_posts-&gt;get_posts($params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // check if we have posts to display&nbsp;</div></li><li><div>                if(!empty($posts)) {&nbsp;</div></li><li><div>                    // get divider if necessary&nbsp;</div></li><li><div>                    if(isset($params['show_divider']) && $params['show_divider'] === 'yes') {&nbsp;</div></li><li><div>                        if(isset($email['params']['divider'])) {&nbsp;</div></li><li><div>                            // either from the email params&nbsp;</div></li><li><div>                            $params['divider'] = $email['params']['divider'];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            // get default divider otherwise&nbsp;</div></li><li><div>                            $helper_dividers = WYSIJA::get('dividers', 'helper');&nbsp;</div></li><li><div>                            $params['divider'] = $helper_dividers-&gt;getDefault();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $helper_articles = WYSIJA::get('articles', 'helper');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    foreach($posts as $key =&gt; $post) {&nbsp;</div></li><li><div>                        // assign first post title to autonl parameters (this is used to display the [newsletter:post_title] shortcode in the subject)&nbsp;</div></li><li><div>                        if($first_subject === null && strlen(trim($posts[$key]['post_title'])) &gt; 0) {&nbsp;</div></li><li><div>                            $first_subject = trim($posts[$key]['post_title']);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // check if shortcodes should be interpreted (value comes from WP options)&nbsp;</div></li><li><div>                        if($interpret_shortcode === true) {&nbsp;</div></li><li><div>                            // interpret shortcodes&nbsp;</div></li><li><div>                            $posts[$key]['post_content'] = apply_filters('the_content', $post['post_content']);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        if($params['image_alignment'] !== 'none') {&nbsp;</div></li><li><div>                            // get thumbnail&nbsp;</div></li><li><div>                            $posts[$key]['post_image'] = $helper_articles-&gt;getImage($post);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $post_ids[] = (int)$post['ID'];&nbsp;</div></li><li><div>                        $post_count++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // render html from post data and params&nbsp;</div></li><li><div>                    $blockHTML = $this-&gt;renderEmailAutoPost($posts, $params);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;setEmailData($email);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // set styles&nbsp;</div></li><li><div>                $block['styles'] = $styles;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // set rtl&nbsp;</div></li><li><div>                $block['is_rtl'] = $this-&gt;isRtl();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // generate block template&nbsp;</div></li><li><div>                $blockHTML = $helper_render_engine-&gt;render($block, 'templates/newsletter/email/block_template.html');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if($block['type'] !== 'raw') {&nbsp;</div></li><li><div>                    // convert lists in block&nbsp;</div></li><li><div>                    $blockHTML = $this-&gt;convertLists($blockHTML);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // apply inline styles&nbsp;</div></li><li><div>                    $blockHTML = $this-&gt;applyInlineStyles('body', $blockHTML, array('background_color' =&gt; $block_background_color));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // append generated html to body&nbsp;</div></li><li><div>            if($blockHTML !== '') {&nbsp;</div></li><li><div>                // render each block&nbsp;</div></li><li><div>                $body .= $blockHTML;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if($newsletter_type === 'automatic') {&nbsp;</div></li><li><div>            $email = $this-&gt;getEmailData();&nbsp;</div></li><li><div>            // set auto newsletter parameters&nbsp;</div></li><li><div>            $email['params']['autonl']['articles']['count'] = $post_count;&nbsp;</div></li><li><div>            $email['params']['autonl']['articles']['first_subject'] = $first_subject;&nbsp;</div></li><li><div>            // merge post ids&nbsp;</div></li><li><div>            if(!isset( $email['params']['autonl']['articles']['ids'])) {&nbsp;</div></li><li><div>                $email['params']['autonl']['articles']['ids'] = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $email['params']['autonl']['articles']['ids'] = array_unique(array_merge(&nbsp;</div></li><li><div>                (array)$email['params']['autonl']['articles']['ids'], &nbsp;</div></li><li><div>                (array)$post_ids&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;setEmailData($email);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $body;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function renderEmailFooter() {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setStripSpecialchars(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = $this-&gt;getData('footer');&nbsp;</div></li><li><div>        $data['styles'] = array('footer' =&gt; $this-&gt;getStyles('footer'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check for emptyness&nbsp;</div></li><li><div>        if($data['text'] === NULL and $data['image']['static'] === TRUE) {&nbsp;</div></li><li><div>            return NULL;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set footer content width&nbsp;</div></li><li><div>        $data['block_width'] = 600;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // generate block template&nbsp;</div></li><li><div>        $footer = $helper_render_engine-&gt;render($data, 'templates/newsletter/email/footer_template.html');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // apply inline styles&nbsp;</div></li><li><div>        $footer = $this-&gt;applyInlineStyles('footer', $footer);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $footer;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * area : header, body, footer, unsubscribe, viewbrowser&nbsp;</div></li><li><div>     * block : raw html&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function applyInlineStyles($area, $block, $extra = array()) {&nbsp;</div></li><li><div>        $helper_render_engine = WYSIJA::get('render_engine', 'helper');&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setTemplatePath(WYSIJA_EDITOR_TOOLS);&nbsp;</div></li><li><div>        $helper_render_engine-&gt;setInline(true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // common tags&nbsp;</div></li><li><div>        $tags = array(&nbsp;</div></li><li><div>            'table' =&gt; array(&nbsp;</div></li><li><div>                'border-collapse' =&gt; 'collapse', &nbsp;</div></li><li><div>                'mso-table-space' =&gt; '0pt', &nbsp;</div></li><li><div>                'clear' =&gt; 'both'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'td' =&gt; array(&nbsp;</div></li><li><div>                'border-collapse' =&gt; 'collapse'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        // common classes&nbsp;</div></li><li><div>        $classes = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set block background color&nbsp;</div></li><li><div>        if(array_key_exists('background_color', $extra) and $extra['background_color'] !== null) {&nbsp;</div></li><li><div>            $background_color = $extra['background_color'];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            switch ($area) {&nbsp;</div></li><li><div>                case 'header':&nbsp;</div></li><li><div>                case 'footer':&nbsp;</div></li><li><div>                case 'body':&nbsp;</div></li><li><div>                    $background_color = $this-&gt;getStyle($area, 'background');&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'unsubscribe':&nbsp;</div></li><li><div>                    $background_color = $this-&gt;getStyle('html', 'background');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    $background_color = $this-&gt;getStyle('html', 'background');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set common styles&nbsp;</div></li><li><div>        $styles = array(&nbsp;</div></li><li><div>            'titles' =&gt; array(&nbsp;</div></li><li><div>                'padding' =&gt; '0', &nbsp;</div></li><li><div>                'margin' =&gt; '0', &nbsp;</div></li><li><div>                'font-style' =&gt; 'normal', &nbsp;</div></li><li><div>                'font-weight' =&gt; 'normal', &nbsp;</div></li><li><div>                'line-height' =&gt; '125%', &nbsp;</div></li><li><div>                'letter-spacing' =&gt; 'normal'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'images' =&gt; array(&nbsp;</div></li><li><div>                'margin' =&gt; '0', &nbsp;</div></li><li><div>                'padding' =&gt; '0', &nbsp;</div></li><li><div>                'display' =&gt; 'block', &nbsp;</div></li><li><div>                'border' =&gt; array(&nbsp;</div></li><li><div>                    'size' =&gt; '1px', &nbsp;</div></li><li><div>                    'style' =&gt; 'solid', &nbsp;</div></li><li><div>                    'color' =&gt; $this-&gt;formatColor($background_color)&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // area specific classes/tags&nbsp;</div></li><li><div>        switch($area) {&nbsp;</div></li><li><div>            case 'header':&nbsp;</div></li><li><div>            case 'footer':&nbsp;</div></li><li><div>                $classes = array(&nbsp;</div></li><li><div>                    'wysija_'.$area =&gt; array('min-width' =&gt; '100%'), &nbsp;</div></li><li><div>                    'wysija_'.$area.'_container' =&gt; $this-&gt;getStyles($area), &nbsp;</div></li><li><div>                    'wysija_content_container' =&gt; array_merge($this-&gt;getStyles($area), array('padding' =&gt; '0')), &nbsp;</div></li><li><div>                    // images alignments&nbsp;</div></li><li><div>                    'wysija_image_container center' =&gt; array_merge($styles['images'], array('margin' =&gt; '0 auto 0 auto', 'text-align' =&gt; 'center', 'border' =&gt; '0')), &nbsp;</div></li><li><div>                    'wysija_image_container left' =&gt; array_merge($styles['images'], array('border' =&gt; '0')), &nbsp;</div></li><li><div>                    'wysija_image_container right' =&gt; array_merge($styles['images'], array('border' =&gt; '0')), &nbsp;</div></li><li><div>                    // image placeholder&nbsp;</div></li><li><div>                    'wysija_image_placeholder' =&gt; array('padding' =&gt; '0 0 0 0', 'margin' =&gt; '0 0 0 0', 'display' =&gt; 'block'), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // links around images&nbsp;</div></li><li><div>                    'wysija_image_link' =&gt; array('outline' =&gt; '0', 'border' =&gt; '0', 'margin' =&gt; '0', 'padding' =&gt; '0', 'display' =&gt; 'block'), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // images&nbsp;</div></li><li><div>                    'image_fix' =&gt; array('display' =&gt; 'block', 'outline' =&gt; '0', 'text-decoration' =&gt; 'none', 'interpolation' =&gt; 'bicubic')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'body':&nbsp;</div></li><li><div>                $tags = array_merge($tags, array(&nbsp;</div></li><li><div>                    'h1' =&gt; array_merge($styles['titles'], $this-&gt;getStyles('h1')), &nbsp;</div></li><li><div>                    'h2' =&gt; array_merge($styles['titles'], $this-&gt;getStyles('h2')), &nbsp;</div></li><li><div>                    'h3' =&gt; array_merge($styles['titles'], $this-&gt;getStyles('h3')), &nbsp;</div></li><li><div>                    'p' =&gt; array_merge($this-&gt;getStyles('body'), array('word-wrap' =&gt; true, 'padding' =&gt; '0', 'margin' =&gt; '1em 0', 'line-height' =&gt; '1.5em', 'vertical-align' =&gt; 'top', 'letter-spacing' =&gt; 'normal')), &nbsp;</div></li><li><div>                    'li' =&gt; array_merge($this-&gt;getStyles('body'), array('word-wrap' =&gt; true, 'padding' =&gt; '0', 'margin' =&gt; '0', 'line-height' =&gt; '1.5em', 'vertical-align' =&gt; 'top', 'letter-spacing' =&gt; 'normal')), &nbsp;</div></li><li><div>                    'a' =&gt; array_merge($this-&gt;getStyles('a'), array('word-wrap' =&gt; true)), &nbsp;</div></li><li><div>                    'br' =&gt; array('margin' =&gt; '0', 'padding' =&gt; '0', 'line-height' =&gt; '150%')&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $classes = array(&nbsp;</div></li><li><div>                    // blocks&nbsp;</div></li><li><div>                    'wysija_block' =&gt; array('min-width' =&gt; '100%'), &nbsp;</div></li><li><div>                    'wysija_content_container' =&gt; array('padding' =&gt; '10px 17px 10px 17px'), &nbsp;</div></li><li><div>                    'wysija_divider_container' =&gt; array('padding' =&gt; '15px 17px 15px 17px'), &nbsp;</div></li><li><div>                    'wysija_gallery_container' =&gt; array('padding' =&gt; '10px 17px 10px 17px'), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // text&nbsp;</div></li><li><div>                    // 'wysija_text_container' =&gt; array('margin' =&gt; '1em 0'), &nbsp;</div></li><li><div>                    'align-left' =&gt; array('text-align' =&gt; 'left'), &nbsp;</div></li><li><div>                    'align-center' =&gt; array('text-align' =&gt; 'center'), &nbsp;</div></li><li><div>                    'align-right' =&gt; array('text-align' =&gt; 'right'), &nbsp;</div></li><li><div>                    'align-justify' =&gt; array('text-align' =&gt; 'justify'), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // links around images&nbsp;</div></li><li><div>                    'wysija_image_link' =&gt; array('outline' =&gt; '0', 'border' =&gt; '0', 'margin' =&gt; '0', 'padding' =&gt; '0', 'display' =&gt; 'block'), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // images&nbsp;</div></li><li><div>                    'image_fix' =&gt; array('display' =&gt; 'block', 'outline' =&gt; '0', 'text-decoration' =&gt; 'none', 'interpolation' =&gt; 'bicubic'), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // images alignments&nbsp;</div></li><li><div>                    'wysija_image_table center' =&gt; array('margin' =&gt; '0 auto 0 auto', 'text-align' =&gt; 'center'), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    'wysija_image_container center' =&gt; array_merge($styles['images'], array('padding' =&gt; '0 0 0 0', 'margin' =&gt; '0 auto 0 auto', 'text-align' =&gt; 'left')), &nbsp;</div></li><li><div>                    'wysija_image_container left' =&gt; array_merge($styles['images'], array('padding' =&gt; '0 10px 0 0')), &nbsp;</div></li><li><div>                    'wysija_image_container right' =&gt; array_merge($styles['images'], array('padding' =&gt; '0 0 0 10px')), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    'wysija_image_placeholder left' =&gt; array('padding' =&gt; '0 0 0 0', 'margin' =&gt; '0 10px 0 0', 'display' =&gt; 'block'), &nbsp;</div></li><li><div>                    'wysija_image_placeholder right' =&gt; array('padding' =&gt; '0 0 0 0', 'margin' =&gt; '0 0 0 10px', 'display' =&gt; 'block'), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // gallery&nbsp;</div></li><li><div>                    'wysija_gallery_table center' =&gt; array('margin' =&gt; '0 auto 0 auto', 'text-align' =&gt; 'center'), &nbsp;</div></li><li><div>                    'wysija_cell_container' =&gt; array('border' =&gt; $styles['images']['border']), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // lists&nbsp;</div></li><li><div>                    'wysija_list_item' =&gt; array('margin' =&gt; '0')&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'viewbrowser':&nbsp;</div></li><li><div>                $tags = array_merge($tags, array(&nbsp;</div></li><li><div>                    'a' =&gt; $this-&gt;getStyles('viewbrowser')&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $classes = array(&nbsp;</div></li><li><div>                    'wysija_viewbrowser_container' =&gt; array_merge(&nbsp;</div></li><li><div>                        $this-&gt;getStyles('html'), &nbsp;</div></li><li><div>                        $this-&gt;getStyles('viewbrowser'), &nbsp;</div></li><li><div>                        array(&nbsp;</div></li><li><div>                            'text-align' =&gt; 'center', &nbsp;</div></li><li><div>                            'padding' =&gt; '8px'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'unsubscribe':&nbsp;</div></li><li><div>                $tags = array_merge($tags, array(&nbsp;</div></li><li><div>                    'a' =&gt; $this-&gt;getStyles('unsubscribe')&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $classes = array(&nbsp;</div></li><li><div>                    'wysija_unsubscribe_container' =&gt; array_merge(&nbsp;</div></li><li><div>                        $this-&gt;getStyles('html'), &nbsp;</div></li><li><div>                        $this-&gt;getStyles('unsubscribe'), &nbsp;</div></li><li><div>                        array(&nbsp;</div></li><li><div>                            'family' =&gt; 'Verdana', &nbsp;</div></li><li><div>                            'size' =&gt; '12', &nbsp;</div></li><li><div>                            'text-align' =&gt; 'center', &nbsp;</div></li><li><div>                            'padding' =&gt; '8px'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tags_to_check = array('p', 'a', 'ul', 'li', 'h1', 'h2', 'h3');&nbsp;</div></li><li><div>        $classes_to_check = array('wysija_content_container', 'wysija_image_container', 'wysija_divider_container', 'wysija_gallery_container', 'wysija_cell_container', 'wysija_list_item');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check tags and set custom background color&nbsp;</div></li><li><div>        foreach($tags_to_check as $tag) {&nbsp;</div></li><li><div>            if(isset($tags[$tag])) {&nbsp;</div></li><li><div>                $tags[$tag]['background'] = $background_color;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check classes and set custom background color&nbsp;</div></li><li><div>        foreach($classes_to_check as $class) {&nbsp;</div></li><li><div>            if(isset($classes[$class])) {&nbsp;</div></li><li><div>                $classes[$class]['background'] = $background_color;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($tags) === FALSE) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach($tags as $tag =&gt; $styles) {&nbsp;</div></li><li><div>                $styles = $this-&gt;splitSpacing($styles);&nbsp;</div></li><li><div>                $inlineStyles = $helper_render_engine-&gt;renderCSS($styles);&nbsp;</div></li><li><div>                $tags['#&lt; *'.$tag.'((?:(?!style).)*)&gt;#Ui'] = '&lt;'.$tag.' style=&quot;'.$inlineStyles.'&quot;$1&gt;';&nbsp;</div></li><li><div>                unset($tags[$tag]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $block = preg_replace(array_keys($tags), $tags, $block);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if(empty($classes) === FALSE) {&nbsp;</div></li><li><div>            foreach($classes as $class =&gt; $styles) {&nbsp;</div></li><li><div>                // split spacing styles&nbsp;</div></li><li><div>                $styles = $this-&gt;splitSpacing($styles);&nbsp;</div></li><li><div>                $inlineStyles = $helper_render_engine-&gt;renderCSS($styles);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // build regexp for this class&nbsp;</div></li><li><div>                $classes['#&lt;([^ /]+) ((?:(?!&gt;|style).)*)(?:style=&quot;([^&quot;]*)&quot;)?((?:(?!&gt;|style).)*)class=&quot;([^&quot;]*)'.$class.'([^&quot;]*)&quot;((?:(?!&gt;|style).)*)(?:style=&quot;([^&quot;]*)&quot;)?((?:(?!&gt;|style).)*)&gt;#Ui'] = '&lt;$1 $2$4$7 class=&quot;$5'.$class.'$6&quot; style=&quot;$3$8'.$inlineStyles.'&quot; $9&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                unset($classes[$class]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // apply styles&nbsp;</div></li><li><div>            $styledBlock = preg_replace(array_keys($classes), $classes, $block);&nbsp;</div></li><li><div>            // cleanup output (fixes rendering issues)&nbsp;</div></li><li><div>            $styledBlock = preg_replace('/(\t+)/', ' ', $styledBlock);&nbsp;</div></li><li><div>            $styledBlock = preg_replace('/( +)/', ' ', $styledBlock);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Check if the preg_replace worked. Otherwise we simply return the original block&nbsp;</div></li><li><div>            if(strlen(trim($styledBlock)) &gt; 0) {&nbsp;</div></li><li><div>                $block = $styledBlock;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $block;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function splitSpacing($styles) {&nbsp;</div></li><li><div>        foreach($styles as $property =&gt; $value) {&nbsp;</div></li><li><div>            if($property === 'margin' or $property === 'padding') {&nbsp;</div></li><li><div>                // extract multi-values&nbsp;</div></li><li><div>                $values = explode(' ', $value);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // split values depending on values count&nbsp;</div></li><li><div>                switch(count($values)) {&nbsp;</div></li><li><div>                    case 1:&nbsp;</div></li><li><div>                        $styles[$property.'-top'] = $values[0];&nbsp;</div></li><li><div>                        $styles[$property.'-right'] = $values[0];&nbsp;</div></li><li><div>                        $styles[$property.'-bottom'] = $values[0];&nbsp;</div></li><li><div>                        $styles[$property.'-left'] = $values[0];&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                    case 2:&nbsp;</div></li><li><div>                        $styles[$property.'-top'] = $values[0];&nbsp;</div></li><li><div>                        $styles[$property.'-right'] = $values[1];&nbsp;</div></li><li><div>                        $styles[$property.'-bottom'] = $values[0];&nbsp;</div></li><li><div>                        $styles[$property.'-left'] = $values[1];&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                    case 4:&nbsp;</div></li><li><div>                        $styles[$property.'-top'] = $values[0];&nbsp;</div></li><li><div>                        $styles[$property.'-right'] = $values[1];&nbsp;</div></li><li><div>                        $styles[$property.'-bottom'] = $values[2];&nbsp;</div></li><li><div>                        $styles[$property.'-left'] = $values[3];&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // unset original value&nbsp;</div></li><li><div>                unset($styles[$property]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $styles;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function formatColor($color) {&nbsp;</div></li><li><div>        if(strlen(trim($color)) === 0 or $color === 'transparent') {&nbsp;</div></li><li><div>            return 'transparent';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return '#'.$color;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // converts lists (ul, ol, li) into paragraphs for email compatibility&nbsp;</div></li><li><div>    function convertList($matches) {&nbsp;</div></li><li><div>        $output = $matches[5];&nbsp;</div></li><li><div>        // get alignment from ul tag and make sure it's a valid value&nbsp;</div></li><li><div>        $alignment = (isset($matches[3]) && in_array($matches[3], array('align-left', 'align-center', 'align-right'))) ? trim($matches[3]) : 'align-left';&nbsp;</div></li><li><div>        // convert opening li tag to paragraph&nbsp;</div></li><li><div>        $output = preg_replace('#&lt;li ?((?:(?!&gt;|class).)*)(?:class=&quot;([^&quot;]*)&quot;)?((?:(?!&gt;|class).)*)&gt;#Uis', &quot;\n&quot;.'&lt;p class=&quot;wysija_list_item '.$alignment.'&quot;&gt;&bull;&nbsp;', $output);&nbsp;</div></li><li><div>        // replace all closing li tags by p&nbsp;</div></li><li><div>        $output = str_replace('&lt;/li&gt;', &quot;&lt;/p&gt;\n&quot;, $output);&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function convertLists($html) {&nbsp;</div></li><li><div>        $model_config = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        if((bool)$model_config-&gt;getValue('disable_list_conversion') === true) {&nbsp;</div></li><li><div>            return $html;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // define maximum recursion level&nbsp;</div></li><li><div>        $max_recursion = 100;&nbsp;</div></li><li><div>        $recursion_count = 0;&nbsp;</div></li><li><div>        // as long as there are ul tags in the content and we haven't reached the maximum recursion value&nbsp;</div></li><li><div>        while(strpos($html, '&lt;ul') !== false && $recursion_count &lt; $max_recursion) {&nbsp;</div></li><li><div>            $html = preg_replace_callback(&nbsp;</div></li><li><div>                '#(&lt;ul ?((?:(?!&gt;|class).)*)(?:class=&quot;([^&quot;]*)&quot;)?((?:(?!&gt;|class).)*)&gt;((?:(?!&lt;ul).)*)&lt;\/ul&gt;)#Uis', &nbsp;</div></li><li><div>                array($this, 'convertList'), &nbsp;</div></li><li><div>                $html&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $recursion_count++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $html;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/wysija_help_wj_engine/" class="active">2.7.5</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.4/classes/wysija_help_wj_engine/" class="">2.7.4</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.3/classes/wysija_help_wj_engine/" class="">2.7.3</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.2/classes/wysija_help_wj_engine/" class="">2.7.2</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.1/classes/wysija_help_wj_engine/" class="">2.7.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>WYSIJA_help_wj_engine</li><li><span></span>MailPoet Newsletters</li><li><span></span>2.7.5</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>