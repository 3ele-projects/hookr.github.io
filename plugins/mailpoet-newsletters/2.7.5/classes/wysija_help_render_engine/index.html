<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.7.5" data-slug="mailpoet-newsletters" data-type="class" data-id="41159"><head xmlns="http://www.w3.org/1999/xhtml"><title> wysija_help_render_engine | class | Mailpoet Newsletters | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WYSIJA_help_render_engine, class, plugin, mailpoet-newsletters, 2.7.5" /><meta name="description" content="The MailPoet Newsletters WYSIJA help render engine class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.8"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ab763d1a0c4bc5805e70d6dd826e87a0' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.8' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wysija_help_render_engine/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwysija_help_render_engine%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwysija_help_render_engine%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-mailpoet-newsletters-2.7.5-class-wysija_help_render_engine","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wysija_help_render_engine" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to mailpoet-newsletters." href="http://hookr.io/plugins/mailpoet-newsletters/" class="plugin"><span property="name">mailpoet-newsletters</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.5." href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/" class="H_VERSION"><span property="name">2.7.5</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wysija_help_render_engine</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="299"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/all/" title="All">All <span class="count badge">299</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="104"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/hooks/" title="Hooks">Hooks <span class="count badge">104</span></a></li><li class="" data-id="action" data-count="30"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/actions/" title="Actions">Actions <span class="count badge">30</span></a></li><li class="" data-id="filter" data-count="74"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/filters/" title="Filters">Filters <span class="count badge">74</span></a></li><li class="active" data-id="class" data-count="132"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/" title="Classes">Classes <span class="count badge">132</span></a></li><li class="" data-id="constant" data-count="52"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/constants/" title="Constants">Constants <span class="count badge">52</span></a></li><li class="" data-id="function" data-count="8"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/functions/" title="Functions">Functions <span class="count badge">8</span></a></li><li class="" data-id="shortcode" data-count="3"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">3</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WYSIJA_help_render_engine</strong></h1><p>The MailPoet Newsletters <strong>WYSIJA help render engine</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/files/helpers-render-engine/" class="file">/helpers/render_engine.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="6" class="block" start="6"><li><div>class WYSIJA_help_render_engine extends WYSIJA_object {&nbsp;</div></li><li><div>    private $_template = null;&nbsp;</div></li><li><div>    private $_template_path = array();&nbsp;</div></li><li><div>    private $_data_path = null;&nbsp;</div></li><li><div>    private $_strip_special_chars = false;&nbsp;</div></li><li><div>    private $_render_time = false;&nbsp;</div></li><li><div>    private $_i18n = null;&nbsp;</div></li><li><div>    private $_lc_time = '';&nbsp;</div></li><li><div>    private $_inline = false;&nbsp;</div></li><li><div>    private $_fonts = array(&nbsp;</div></li><li><div>        'Arial' =&gt; &quot;Arial, 'Helvetica Neue', Helvetica, sans-serif&quot;, &nbsp;</div></li><li><div>        'Comic Sans MS' =&gt; &quot;'Comic Sans MS', 'Marker Felt-Thin', Arial, sans-serif&quot;, &nbsp;</div></li><li><div>        'Courier New' =&gt; &quot;'Courier New', Courier, 'Lucida Sans Typewriter', 'Lucida Typewriter', monospace&quot;, &nbsp;</div></li><li><div>        'Georgia' =&gt; &quot;Georgia, Times, 'Times New Roman', serif&quot;, &nbsp;</div></li><li><div>        'Tahoma' =&gt; &quot;Tahoma, Verdana, Segoe, sans-serif&quot;, &nbsp;</div></li><li><div>        'Times New Roman' =&gt; &quot;'Times New Roman', Times, Baskerville, Georgia, serif&quot;, &nbsp;</div></li><li><div>        'Trebuchet MS' =&gt; &quot;'Trebuchet MS', 'Lucida Grande', 'Lucida Sans Unicode', 'Lucida Sans', Tahoma, sans-serif&quot;, &nbsp;</div></li><li><div>        'Verdana' =&gt; &quot;Verdana, Geneva, sans-serif&quot;&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    const _OPEN = '{';&nbsp;</div></li><li><div>    const _CLOSE = '}';&nbsp;</div></li><li><div>    const _LOOP = 'loop';&nbsp;</div></li><li><div>    const _FOREACH = 'foreach';&nbsp;</div></li><li><div>    const _INCLUDE = 'include';&nbsp;</div></li><li><div>    const _TRANSLATE = 'translate';&nbsp;</div></li><li><div>    const _IF = 'if';&nbsp;</div></li><li><div>    const _SET = 'set';&nbsp;</div></li><li><div>    const _COUNTER = 'i';&nbsp;</div></li><li><div>    const _PAIR = 'IS_PAIR';&nbsp;</div></li><li><div>    const _FIRST = 'IS_FIRST';&nbsp;</div></li><li><div>    const _LAST = 'IS_LAST';&nbsp;</div></li><li><div>    const _VALUE = '_VALUE';&nbsp;</div></li><li><div>    const _FIRST_COL = 'IS_FIRST_COL';&nbsp;</div></li><li><div>    const _LAST_COL = 'IS_LAST_COL';&nbsp;</div></li><li><div>    const _FIRST_ROW = 'IS_FIRST_ROW';&nbsp;</div></li><li><div>    const _LAST_ROW = 'IS_LAST_ROW';&nbsp;</div></li><li><div>    const _VAR = '([\$#])([\w-_\.]+)';&nbsp;</div></li><li><div>    const _MODIFIER = &quot;(\|{0, 1}[^}]*)&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function __construct () { }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setLcTime ($lc_time)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_lc_time = $lc_time;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setTranslator($i18n)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_i18n = $i18n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setTemplatePath ($path)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (!is_array ($path)) {&nbsp;</div></li><li><div>            $path = array ($path);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;_template_path = $path;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function getTemplatePath ()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;_template_path;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setDataPath ($path)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_data_path = $path;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setStripSpecialchars ($value)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_strip_special_chars = $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function setInline($bool)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;_inline = $bool;&nbsp;</div></li><li><div>        $this-&gt;_inline = false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function renderCSS($vars) {&nbsp;</div></li><li><div>        $result = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($vars['family'])) {&nbsp;</div></li><li><div>            $font_family = '\''.$vars['family'].'\'';&nbsp;</div></li><li><div>            // check if we have fallbacks for this font&nbsp;</div></li><li><div>            if(array_key_exists($vars['family'], $this-&gt;_fonts)) {&nbsp;</div></li><li><div>                $font_family = $this-&gt;_fonts[$vars['family']];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $result[] = 'font-family: '.$font_family.';';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($vars['size'])) $result[] = 'font-size: ' . self::_css_format_font_size_value($vars['size']) . ';';&nbsp;</div></li><li><div>        if (isset($vars['color'])) $result[] = 'color: ' . self::_css_format_color($vars['color']) . ';color: ' . self::_css_format_color($vars['color']) . ' !important;';&nbsp;</div></li><li><div>        if (isset($vars['background']) && $vars['background'] !== '') $result[] = 'background-color: ' . self::_css_format_color($vars['background']) . ';';&nbsp;</div></li><li><div>        if (isset($vars['underline'])) {&nbsp;</div></li><li><div>            if ($vars['underline'] == '1') $result[] = 'text-decoration: underline;';&nbsp;</div></li><li><div>            elseif ($vars['underline'] == '-1') $result[] = 'text-decoration: none;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($vars['text-decoration'])) $result[] = 'text-decoration: ' . $vars['text-decoration'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['outline'])) $result[] = 'outline: ' . $vars['outline'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['height'])) $result[] = 'height: ' . $vars['height'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['border']) && is_array($vars['border'])) {&nbsp;</div></li><li><div>            $result[] = 'border: ' . $vars['border']['size'] . ' ' . $vars['border']['style'] . ' ' . $vars['border']['color'] . ';';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $result[] = 'border: 0;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($vars['border-collapse'])) $result[] = 'border-collapse: ' . $vars['border-collapse'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['mso-table-space'])) $result[] = 'mso-table-lspace: ' . $vars['mso-table-space'] . '; mso-table-rspace: ' . $vars['mso-table-space'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['text-align'])) $result[] = 'text-align: ' . $vars['text-align'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['font-weight'])) $result[] = 'font-weight: ' . $vars['font-weight'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['font-style'])) $result[] = 'font-style: ' . $vars['font-style'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['letter-spacing'])) $result[] = 'letter-spacing: ' . $vars['letter-spacing'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['line-height'])) {&nbsp;</div></li><li><div>            if ($vars['line-height'] == '0') {&nbsp;</div></li><li><div>                $result[] = 'line-height: 0;';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $result[] = 'mso-line-height-rule: exactly;-mso-line-height-rule: exactly;line-height: ' . self::_css_format_line_height($vars['line-height']) . ';';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($vars['list-style-position'])) $result[] = 'list-style-position: ' . $vars['list-style-position'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['list-style-type'])) $result[] = 'list-style-type: ' . $vars['list-style-type'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['list-style'])) $result[] = 'list-style: ' . $vars['list-style'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['display'])) $result[] = 'display: ' . $vars['display'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['margin'])) $result[] = 'margin: ' . $vars['margin'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['padding'])) $result[] = 'padding: ' . $vars['padding'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['margin-top']) && $vars['margin-top'] != '') $result[] = 'margin-top: ' . $vars['margin-top'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['margin-right']) && $vars['margin-right'] != '') $result[] = 'margin-right: ' . $vars['margin-right'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['margin-bottom']) && $vars['margin-bottom'] != '') $result[] = 'margin-bottom: ' . $vars['margin-bottom'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['margin-left']) && $vars['margin-left'] != '') $result[] = 'margin-left: ' . $vars['margin-left'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['padding-top']) && $vars['padding-top'] != '') $result[] = 'padding-top: ' . $vars['padding-top'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['padding-right']) && $vars['padding-right'] != '') $result[] = 'padding-right: ' . $vars['padding-right'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['padding-bottom']) && $vars['padding-bottom'] != '') $result[] = 'padding-bottom: ' . $vars['padding-bottom'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['padding-left']) && $vars['padding-left'] != '') $result[] = 'padding-left: ' . $vars['padding-left'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['clear'])) $result[] = 'clear: ' . $vars['clear'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['float'])) $result[] = 'float: ' . $vars['float'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['vertical-align'])) $result[] = 'vertical-align: ' . $vars['vertical-align'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['word-wrap'])) $result[] = 'word-wrap: break-word;';&nbsp;</div></li><li><div>        if (isset($vars['interpolation'])) $result[] = '-ms-interpolation-mode: ' . $vars['interpolation'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['min-width'])) $result[] = 'min-width: ' . $vars['min-width'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['max-width'])) $result[] = 'max-width: ' . $vars['max-width'] . ';';&nbsp;</div></li><li><div>        if (isset($vars['outlook_fix_tr'])) $result[] = 'font-size: 1px; mso-line-height-alt: 0; mso-margin-top-alt: 1px;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return implode('', $result);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function render($vars, $template)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (is_object ($vars)) {&nbsp;</div></li><li><div>            $vars = get_object_vars($vars);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($string = $this-&gt;_loadTemplate ($template)) {&nbsp;</div></li><li><div>            if ($this-&gt;_render_time) {&nbsp;</div></li><li><div>                $time_start = microtime();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;_vars = $vars;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if($this-&gt;_inline) {&nbsp;</div></li><li><div>                // inline mode (removes any tabs, carriage return, line breaks)&nbsp;</div></li><li><div>                $string = preg_replace(&quot;#(\t|\r|\n)#UiS&quot;, '', trim($string));&nbsp;</div></li><li><div>                $string = preg_replace(&quot;#&gt; +&lt;#UiS&quot;, '&gt;&lt;', $string);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $output = $this-&gt;_parse($string);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;_render_time) {&nbsp;</div></li><li><div>                $time_end = microtime();&nbsp;</div></li><li><div>                $time = $time_end - $time_start;&nbsp;</div></li><li><div>                $output .= &quot;&lt;div&gt;wysija rendering engine rendering took : $time second(s)&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $output;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            throw new Exception('wysija rendering engine needs a template');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // converts HTML template to PrototypeJS Template&nbsp;</div></li><li><div>    protected function _parseForJS($string, $vars = null) {&nbsp;</div></li><li><div>        $old_string = $string;&nbsp;</div></li><li><div>        if (null === $vars) {&nbsp;</div></li><li><div>            $vars =& $this-&gt;_vars;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        # search loop, include or if statement&nbsp;</div></li><li><div>        while (preg_match (&quot;`&quot;.self::_OPEN.&quot;(&quot;.self::_LOOP.&quot;|&quot;.self::_FOREACH.&quot;|&quot;.self::_INCLUDE.&quot;|&quot;.self::_IF.&quot;|&quot;.self::_SET.&quot;|&quot;.self::_TRANSLATE.&quot;)([^\{]*?)&quot;.self::_CLOSE.&quot;`&quot;, $string, $preg)) {&nbsp;</div></li><li><div>            $result_pattern = '';&nbsp;</div></li><li><div>            $tag_mask = $preg[0];&nbsp;</div></li><li><div>            $tag_type = $preg[1];&nbsp;</div></li><li><div>            $tag_properties = $preg[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # LOOP & FOREACH&nbsp;</div></li><li><div>            if ($tag_type == self::_LOOP || $tag_type == self::_FOREACH ) {&nbsp;</div></li><li><div>                $loop_name = $this-&gt;_getProperty ('name', $tag_properties);&nbsp;</div></li><li><div>                $loop_as = $this-&gt;_getProperty ('value', $tag_properties);&nbsp;</div></li><li><div>                $loop_key = $this-&gt;_getProperty ('key', $tag_properties);&nbsp;</div></li><li><div>                $loop_row_size = $this-&gt;_getProperty ('row_size', $tag_properties);&nbsp;</div></li><li><div>                $reverse = $this-&gt;_getProperty ('reverse', $tag_properties);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # define loop string and replace pattern&nbsp;</div></li><li><div>                $loop_replace_pattern = $this-&gt;_getEncapsuledPattern ($string, $tag_type, $tag_mask);&nbsp;</div></li><li><div>                preg_match (&quot;`&quot;.$loop_replace_pattern.&quot;`s&quot;, $string, $loops);&nbsp;</div></li><li><div>                $loop_string = $loops[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # loop on array&nbsp;</div></li><li><div>                preg_match (&quot;`^&quot;.self::_VAR.&quot;`&quot;, $loop_name, $preg);&nbsp;</div></li><li><div>                $loop_array = $this-&gt;_getValue ($preg, $vars);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($reverse) {&nbsp;</div></li><li><div>                    $loop_array = array_reverse ($loop_array);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (is_array ($loop_array)) {&nbsp;</div></li><li><div>                    $count = count ($loop_array);&nbsp;</div></li><li><div>                    $loop = array ();&nbsp;</div></li><li><div>                    $i = 0;&nbsp;</div></li><li><div>                    foreach ($loop_array as $line) {&nbsp;</div></li><li><div>                        # meta values&nbsp;</div></li><li><div>                        if (is_array($line)) {&nbsp;</div></li><li><div>                            # is pair ?&nbsp;</div></li><li><div>                            $line[self::_PAIR] = ($i+1)%2 ;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            # position in list&nbsp;</div></li><li><div>                            $i &lt; $count-1 ? $line[self::_LAST] = false : $line[self::_LAST] = true;&nbsp;</div></li><li><div>                            $i === 0 ? $line[self::_FIRST] = true : $line[self::_FIRST] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            # rows and columns infos&nbsp;</div></li><li><div>                            if ($loop_row_size) {&nbsp;</div></li><li><div>                                # col position&nbsp;</div></li><li><div>                                ($i+1)%$loop_row_size ? $line[self::_LAST_COL] = false : $line[self::_LAST_COL] = true;&nbsp;</div></li><li><div>                                ($i+1)%$loop_row_size === 1 ? $line[self::_FIRST_COL] = true : $line[self::_FIRST_COL] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                # row position&nbsp;</div></li><li><div>                                $i&lt;$loop_row_size ? $line[self::_FIRST_ROW] = true : $line[self::_FIRST_ROW] = false;&nbsp;</div></li><li><div>                                $modulo = $count%$loop_row_size;&nbsp;</div></li><li><div>                                if (($modulo && $i&gt;=$count-$modulo) || (!$modulo && $i&gt;=$count-$loop_row_size)) {&nbsp;</div></li><li><div>                                    $line[self::_LAST_ROW] = true;&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $line[self::_LAST_ROW] = false;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        # switch case&nbsp;</div></li><li><div>                        if ($tag_type == self::_LOOP) {&nbsp;</div></li><li><div>                            $loop_key ? $line[$loop_key] = $i : $line[self::_COUNTER] = $i;&nbsp;</div></li><li><div>                            $loop[] = $this-&gt;_parseForJS($loop_string, $line);&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $loop_key ? $vars[$loop_key] = $i : $vars[self::_COUNTER] = $i;&nbsp;</div></li><li><div>                            $vars[$loop_as] = $line;&nbsp;</div></li><li><div>                            $loop[] = $this-&gt;_parseForJS($loop_string, $vars);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $i++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $result_pattern .= implode ($loop, '');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # replace&nbsp;</div></li><li><div>                $string = preg_replace (&quot;`&quot;.$loop_replace_pattern.&quot;`s&quot;, $result_pattern, $string, 1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # IF&nbsp;</div></li><li><div>            if ($tag_type == self::_IF) {&nbsp;</div></li><li><div>                $replace_pattern = $this-&gt;_getEncapsuledPattern ($string, self::_IF, $tag_mask);&nbsp;</div></li><li><div>                preg_match (&quot;`&quot;.$replace_pattern.&quot;`s&quot;, $string, $result);&nbsp;</div></li><li><div>                $if_string = $result[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # condition&nbsp;</div></li><li><div>                if ($this-&gt;_getConditionResult ($tag_properties, $vars)) {&nbsp;</div></li><li><div>                    $result_pattern = $if_string;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # replace&nbsp;</div></li><li><div>                $string = preg_replace (&quot;`&quot;.$replace_pattern.&quot;`s&quot;, $result_pattern, $string, 1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # INCLUDE&nbsp;</div></li><li><div>            if ($tag_type == self::_INCLUDE) {&nbsp;</div></li><li><div>                $replace_pattern = $tag_mask;&nbsp;</div></li><li><div>                $include_file = $this-&gt;_getProperty ('file', $tag_properties);&nbsp;</div></li><li><div>                $var_type = substr($include_file, 0, 1);&nbsp;</div></li><li><div>                if ($var_type == '#' || $var_type == '$') {&nbsp;</div></li><li><div>                    $var_name = substr($include_file, 1, strlen($include_file)-1);&nbsp;</div></li><li><div>                    $include_file = $this-&gt;_getValue (array($include_file, $var_type, $var_name), $vars);&nbsp;</div></li><li><div>                    $result_pattern = $this-&gt;_loadTemplate($include_file);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $result_pattern = $this-&gt;_loadTemplate($include_file);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # replace&nbsp;</div></li><li><div>                $string = str_replace ($tag_mask, $result_pattern, $string);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # SET&nbsp;</div></li><li><div>            if ($tag_type == self::_SET) {&nbsp;</div></li><li><div>                $replace_pattern = $tag_mask;&nbsp;</div></li><li><div>                $var_name = $this-&gt;_getProperty ('var', $tag_properties);&nbsp;</div></li><li><div>                $var_type = substr ($var_name, 0, 1);&nbsp;</div></li><li><div>                $var_name = substr ($var_name, 1, strlen ($var_name)-1);&nbsp;</div></li><li><div>                $var_value = $this-&gt;_getProperty ('value', $tag_properties);&nbsp;</div></li><li><div>                $var_concat = $this-&gt;_getProperty ('concat', $tag_properties);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($var_value) {&nbsp;</div></li><li><div>                    if (preg_match (&quot;`&quot;.self::_VAR.self::_MODIFIER.&quot;`&quot;, $var_value, $is_var)) {&nbsp;</div></li><li><div>                        $var_value = $this-&gt;_getValue ($is_var, $vars);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else if ($var_concat) {&nbsp;</div></li><li><div>                    $split = explode (', ', $var_concat);&nbsp;</div></li><li><div>                    $var_value = '';&nbsp;</div></li><li><div>                    foreach ($split as $value) {&nbsp;</div></li><li><div>                        if (preg_match (&quot;`&quot;.self::_VAR.self::_MODIFIER.&quot;`&quot;, $value, $is_var)) {&nbsp;</div></li><li><div>                            $var_value .= $this-&gt;_getValue ($is_var, $vars);&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $var_value .= $value;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # set value&nbsp;</div></li><li><div>                if ($var_type == '#') {&nbsp;</div></li><li><div>                    $this-&gt;_setValue($var_name, $var_value, $vars);&nbsp;</div></li><li><div>                } else if ($var_type == '$') {&nbsp;</div></li><li><div>                    $this-&gt;_setValue($var_name, $var_value, $this-&gt;_vars);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # replace&nbsp;</div></li><li><div>                $string = str_replace ($tag_mask, '', $string);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //return $string;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $string = $this-&gt;_replaceForJS($string, $vars);&nbsp;</div></li><li><div>        return $string;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // render HTML templates&nbsp;</div></li><li><div>    protected function _parse($string, $vars=null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $old_string = $string;&nbsp;</div></li><li><div>        if (null === $vars) {&nbsp;</div></li><li><div>            $vars =& $this-&gt;_vars;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        # search loop, include or if statement&nbsp;</div></li><li><div>        while (preg_match (&quot;`&quot;.self::_OPEN.&quot;(&quot;.self::_LOOP.&quot;|&quot;.self::_FOREACH.&quot;|&quot;.self::_INCLUDE.&quot;|&quot;.self::_IF.&quot;|&quot;.self::_SET.&quot;|&quot;.self::_TRANSLATE.&quot;)([^\{]*?)&quot;.self::_CLOSE.&quot;`&quot;, $string, $preg)) {&nbsp;</div></li><li><div>            $result_pattern = '';&nbsp;</div></li><li><div>            $tag_mask = $preg[0];&nbsp;</div></li><li><div>            $tag_type = $preg[1];&nbsp;</div></li><li><div>            $tag_properties = $preg[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # LOOP & FOREACH&nbsp;</div></li><li><div>            if ($tag_type == self::_LOOP || $tag_type == self::_FOREACH ) {&nbsp;</div></li><li><div>                $loop_name = $this-&gt;_getProperty ('name', $tag_properties);&nbsp;</div></li><li><div>                $loop_as = $this-&gt;_getProperty ('value', $tag_properties);&nbsp;</div></li><li><div>                $loop_key = $this-&gt;_getProperty ('key', $tag_properties);&nbsp;</div></li><li><div>                $loop_row_size = (int)$this-&gt;_getProperty ('row_size', $tag_properties);&nbsp;</div></li><li><div>                $reverse = $this-&gt;_getProperty ('reverse', $tag_properties);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # define loop string and replace pattern&nbsp;</div></li><li><div>                $loop_replace_pattern = $this-&gt;_getEncapsuledPattern ($string, $tag_type, $tag_mask);&nbsp;</div></li><li><div>                preg_match (&quot;`&quot;.$loop_replace_pattern.&quot;`s&quot;, $string, $loops);&nbsp;</div></li><li><div>                $loop_string = $loops[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # loop on array&nbsp;</div></li><li><div>                preg_match (&quot;`^&quot;.self::_VAR.&quot;`&quot;, $loop_name, $preg);&nbsp;</div></li><li><div>                $loop_array = $this-&gt;_getValue ($preg, $vars);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if($reverse) {&nbsp;</div></li><li><div>                    $loop_array = array_reverse ($loop_array);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if(is_array($loop_array)) {&nbsp;</div></li><li><div>                    $count = count ($loop_array);&nbsp;</div></li><li><div>                    $loop = array ();&nbsp;</div></li><li><div>                    $i = 0;&nbsp;</div></li><li><div>                    foreach ($loop_array as $key =&gt; $line) {&nbsp;</div></li><li><div>                        # meta values&nbsp;</div></li><li><div>                        if (is_array($line)) {&nbsp;</div></li><li><div>                            # is pair ?&nbsp;</div></li><li><div>                            $line[self::_PAIR] = ($i+1)%2 ;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            # position in list&nbsp;</div></li><li><div>                            $i &lt; $count-1 ? $line[self::_LAST] = false : $line[self::_LAST] = true;&nbsp;</div></li><li><div>                            $i === 0 ? $line[self::_FIRST] = true : $line[self::_FIRST] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            # rows and columns infos&nbsp;</div></li><li><div>                            if ($loop_row_size) {&nbsp;</div></li><li><div>                                # col position&nbsp;</div></li><li><div>                                (($i+1) % $loop_row_size) ? $line[self::_LAST_COL] = false : $line[self::_LAST_COL] = true;&nbsp;</div></li><li><div>                                (($i+1) % $loop_row_size === 1) ? $line[self::_FIRST_COL] = true : $line[self::_FIRST_COL] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                # row position&nbsp;</div></li><li><div>                                ($i &lt; $loop_row_size) ? $line[self::_FIRST_ROW] = true : $line[self::_FIRST_ROW] = false;&nbsp;</div></li><li><div>                                $modulo = $count % $loop_row_size;&nbsp;</div></li><li><div>                                if(($modulo && $i&gt;=$count-$modulo) || (!$modulo && $i&gt;=$count-$loop_row_size)) {&nbsp;</div></li><li><div>                                    $line[self::_LAST_ROW] = true;&nbsp;</div></li><li><div>                                } else {&nbsp;</div></li><li><div>                                    $line[self::_LAST_ROW] = false;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        # switch case&nbsp;</div></li><li><div>                        if($tag_type == self::_LOOP) {&nbsp;</div></li><li><div>                            $loop_key ? $line[$loop_key] = $i : $line[self::_COUNTER] = $i;&nbsp;</div></li><li><div>                            $loop[] = $this-&gt;_parse($loop_string, $line);&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            //$loop_key ? $vars[$loop_key] = $i : $vars[self::_COUNTER] = $i;&nbsp;</div></li><li><div>                            $vars[self::_COUNTER] = $i;&nbsp;</div></li><li><div>                            $vars[$loop_key] = $key;&nbsp;</div></li><li><div>                            $vars[$loop_as] = $line;&nbsp;</div></li><li><div>                            $loop[] = $this-&gt;_parse($loop_string, $vars);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $i++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $result_pattern .= implode ($loop, '');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # replace&nbsp;</div></li><li><div>                $string = preg_replace (&quot;`&quot;.$loop_replace_pattern.&quot;`s&quot;, $result_pattern, $string, 1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # IF&nbsp;</div></li><li><div>            if ($tag_type == self::_IF) {&nbsp;</div></li><li><div>                $replace_pattern = $this-&gt;_getEncapsuledPattern ($string, self::_IF, $tag_mask);&nbsp;</div></li><li><div>                preg_match (&quot;`&quot;.$replace_pattern.&quot;`s&quot;, $string, $result);&nbsp;</div></li><li><div>                $if_string = $result[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # condition&nbsp;</div></li><li><div>                if ($this-&gt;_getConditionResult ($tag_properties, $vars)) {&nbsp;</div></li><li><div>                    $result_pattern = $if_string;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # replace&nbsp;</div></li><li><div>                $string = preg_replace (&quot;`&quot;.$replace_pattern.&quot;`s&quot;, $result_pattern, $string, 1);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # INCLUDE&nbsp;</div></li><li><div>            if ($tag_type == self::_INCLUDE) {&nbsp;</div></li><li><div>                $replace_pattern = $tag_mask;&nbsp;</div></li><li><div>                $include_file = $this-&gt;_getProperty ('file', $tag_properties);&nbsp;</div></li><li><div>                $var_type = substr ($include_file, 0, 1);&nbsp;</div></li><li><div>                if ($var_type == '#' || $var_type == '$') {&nbsp;</div></li><li><div>                    $var_name = substr ($include_file, 1, strlen($include_file)-1);&nbsp;</div></li><li><div>                    $include_file = $this-&gt;_getValue (array ($include_file, $var_type, $var_name), $vars);&nbsp;</div></li><li><div>                    $result_pattern = $this-&gt;_loadTemplate ($include_file);&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $result_pattern = $this-&gt;_loadTemplate ($include_file);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # replace&nbsp;</div></li><li><div>                $string = str_replace ($tag_mask, $result_pattern, $string);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # TRANSLATE&nbsp;</div></li><li><div>            if ($tag_type == self::_TRANSLATE) {&nbsp;</div></li><li><div>                $replace_pattern = $tag_mask;&nbsp;</div></li><li><div>                $key = $this-&gt;_getProperty ('key', $tag_properties);&nbsp;</div></li><li><div>                $into = $this-&gt;_getProperty ('into', $tag_properties);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $default = $this-&gt;_getProperty ('default', $tag_properties);&nbsp;</div></li><li><div>                if (preg_match (&quot;`&quot;.self::_VAR.self::_MODIFIER.&quot;`&quot;, $default, $is_var)) {&nbsp;</div></li><li><div>                    $default = $this-&gt;_getValue ($is_var, $vars);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $key_list = explode (', ', $key);&nbsp;</div></li><li><div>                foreach ($key_list as $i=&gt;$key) {&nbsp;</div></li><li><div>                    $var_type = $this-&gt;_getVarType($key);&nbsp;</div></li><li><div>                    if ($var_type == '#' || $var_type == '$') {&nbsp;</div></li><li><div>                        $key_list[$i] = $this-&gt;_getValue (array ($key, $var_type, $this-&gt;_getVarName($key)), $vars);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($this-&gt;_i18n !== null) {&nbsp;</div></li><li><div>                    $key = implode ('', $key_list);&nbsp;</div></li><li><div>                    $tmp = $this-&gt;_i18n-&gt;translate ($key);&nbsp;</div></li><li><div>                    if ($tmp == $key) {&nbsp;</div></li><li><div>                        $result_pattern = $default;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $result_pattern = $tmp;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $result_pattern = $default;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # replace&nbsp;</div></li><li><div>                if ($into) {&nbsp;</div></li><li><div>                    $var_type = $this-&gt;_getVarType($into);&nbsp;</div></li><li><div>                    $var_name = $this-&gt;_getVarName($into);&nbsp;</div></li><li><div>                    if ($var_type == '#') {&nbsp;</div></li><li><div>                        $this-&gt;_setValue($var_name, $result_pattern, $vars);&nbsp;</div></li><li><div>                    } else if ($var_type == '$') {&nbsp;</div></li><li><div>                        $this-&gt;_setValue($var_name, $result_pattern, $this-&gt;_vars);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $result_pattern = '';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $string = str_replace ($tag_mask, $result_pattern, $string);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # SET&nbsp;</div></li><li><div>            if ($tag_type == self::_SET) {&nbsp;</div></li><li><div>                $replace_pattern = $tag_mask;&nbsp;</div></li><li><div>                $var_name = $this-&gt;_getProperty ('var', $tag_properties);&nbsp;</div></li><li><div>                $var_type = substr ($var_name, 0, 1);&nbsp;</div></li><li><div>                $var_name = substr ($var_name, 1, strlen ($var_name)-1);&nbsp;</div></li><li><div>                $var_value = $this-&gt;_getProperty ('value', $tag_properties);&nbsp;</div></li><li><div>                $var_concat = $this-&gt;_getProperty ('concat', $tag_properties);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($var_value) {&nbsp;</div></li><li><div>                    if (preg_match (&quot;`&quot;.self::_VAR.self::_MODIFIER.&quot;`&quot;, $var_value, $is_var)) {&nbsp;</div></li><li><div>                        $var_value = $this-&gt;_getValue ($is_var, $vars);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else if ($var_concat) {&nbsp;</div></li><li><div>                    $split = explode (', ', $var_concat);&nbsp;</div></li><li><div>                    $var_value = '';&nbsp;</div></li><li><div>                    foreach ($split as $value) {&nbsp;</div></li><li><div>                        if (preg_match (&quot;`&quot;.self::_VAR.self::_MODIFIER.&quot;`&quot;, $value, $is_var)) {&nbsp;</div></li><li><div>                            $var_value .= $this-&gt;_getValue ($is_var, $vars);&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $var_value .= $value;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # set value&nbsp;</div></li><li><div>                if ($var_type == '#') {&nbsp;</div></li><li><div>                    $this-&gt;_setValue($var_name, $var_value, $vars);&nbsp;</div></li><li><div>                } else if ($var_type == '$') {&nbsp;</div></li><li><div>                    $this-&gt;_setValue($var_name, $var_value, $this-&gt;_vars);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                # replace&nbsp;</div></li><li><div>                $string = str_replace ($tag_mask, '', $string);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $string = $this-&gt;_replace ($string, $vars);&nbsp;</div></li><li><div>        return $string;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _getVarType ($var_name)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return substr ($var_name, 0, 1);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _getVarName ($var_name)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return substr ($var_name, 1, strlen ($var_name)-1);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _replace ($string, $vars)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        while(preg_match (&quot;`&quot;.self::_OPEN.self::_VAR.self::_MODIFIER.self::_CLOSE.&quot;`&quot;, $string, $reg)) {&nbsp;</div></li><li><div>            $value = $this-&gt;_getValue ($reg, $vars);&nbsp;</div></li><li><div>            $string = str_replace ($reg[0], strval ($value), $string);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $string;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _replaceForJS($string, $vars)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        while(preg_match (&quot;`&quot;.self::_OPEN.self::_VAR.self::_MODIFIER.self::_CLOSE.&quot;`&quot;, $string, $reg)) {&nbsp;</div></li><li><div>            //$value = $this-&gt;_getValue ($reg, $vars);&nbsp;</div></li><li><div>            //$value = var_export($reg, false);&nbsp;</div></li><li><div>            $value = $this-&gt;_convertVarToJS($reg);&nbsp;</div></li><li><div>            $string = str_replace($reg[0], strval ($value), $string);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $string;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _convertVarToJS($var) {&nbsp;</div></li><li><div>        if(isset($var[2])) {&nbsp;</div></li><li><div>            //return '#{element'.ucfirst($var[2]).'}';&nbsp;</div></li><li><div>            return '#{'.$var[2].'}';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $var[0];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _getConditionResult ($condition, $vars)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        preg_match_all (&quot;`&quot;.self::_VAR.&quot;`&quot;, $condition, $preg_list);&nbsp;</div></li><li><div>        $count = count($preg_list[0]);&nbsp;</div></li><li><div>        for ($i=0; $i&lt;$count; $i++) {&nbsp;</div></li><li><div>            $preg = array ($preg_list[0][$i], $preg_list[1][$i], $preg_list[2][$i]);&nbsp;</div></li><li><div>            $value[$i] = $this-&gt;_getValue ($preg, $vars);&nbsp;</div></li><li><div>            $condition = substr_replace ($condition, '$value['.$i.']', strpos ($condition, $preg[0]), strlen ($preg[0]));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $eval_string = sprintf (&quot;if (%s) {\$result=true;} else {\$result=false;}&quot;, $condition);&nbsp;</div></li><li><div>        @eval ($eval_string);&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _setValue ($var_string, $value, &$vars)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        # array&nbsp;</div></li><li><div>        $array = explode('.', $var_string);&nbsp;</div></li><li><div>        $count_array = count ($array);&nbsp;</div></li><li><div>        if ($count_array &gt; 1) {&nbsp;</div></li><li><div>            $string_eval = &quot;\$vars['&quot;.$array[0].&quot;']&quot;;&nbsp;</div></li><li><div>            for ($i=1; $i&lt;$count_array; $i++) {&nbsp;</div></li><li><div>                $string_eval .= &quot;['&quot;.$array[$i].&quot;']&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $string_eval .= &quot; = \$value;&quot;;&nbsp;</div></li><li><div>            eval($string_eval);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $vars[$var_string] = $value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _getValue ($reg, $vars=null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($reg[1] == '$') {&nbsp;</div></li><li><div>            $vars = $this-&gt;_vars;&nbsp;</div></li><li><div>        } else if (null === $vars) {&nbsp;</div></li><li><div>            $vars =& $this-&gt;_vars;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $reg[2];&nbsp;</div></li><li><div>        if (isset ($reg[3])) {&nbsp;</div></li><li><div>            $modifier = $reg[3];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $value = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $split = explode (&quot;.&quot;, $key);&nbsp;</div></li><li><div>        $split_count = count ($split);&nbsp;</div></li><li><div>        # array&nbsp;</div></li><li><div>        if ($split_count &gt; 1 && isset ($vars[$split[0]]) && is_array ($vars[$split[0]])) {&nbsp;</div></li><li><div>            $value = $vars[$split[0]];&nbsp;</div></li><li><div>            for ($i=1; $i&lt;$split_count; $i++) {&nbsp;</div></li><li><div>                if (isset ($value[$split[$i]])) {&nbsp;</div></li><li><div>                    $value = $value[$split[$i]];&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $value = null;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        # object&nbsp;</div></li><li><div>        else if ($split_count == 2 && isset ($vars[$split[0]]) && is_object($vars[$split[0]])) {&nbsp;</div></li><li><div>            $object = $vars[$split[0]];&nbsp;</div></li><li><div>            $key = $split[1];&nbsp;</div></li><li><div>            if (isset ($object-&gt;$key)) {&nbsp;</div></li><li><div>                $value = $object-&gt;$key;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        # regular var&nbsp;</div></li><li><div>        if (isset ($vars[$key])) {&nbsp;</div></li><li><div>            $value = $vars[$key];&nbsp;</div></li><li><div>        } else&nbsp;</div></li><li><div>        # constant&nbsp;</div></li><li><div>        if (defined ($key)) {&nbsp;</div></li><li><div>            $value = constant ($key);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        # modifier&nbsp;</div></li><li><div>        if (isset ($modifier) && $modifier) {&nbsp;</div></li><li><div>            $value = $this-&gt;_modifier ($modifier, $value, $vars);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _getEncapsuledPattern ($string, $tag_name, $mask)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $start = $end = 0;&nbsp;</div></li><li><div>        $string = strstr ($string, $mask);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (preg_match (&quot;`&quot;.self::_OPEN.&quot;(/{0, 1}&quot;.$tag_name.&quot;)(.*?)&quot;.self::_CLOSE.&quot;`&quot;, $string, $preg)) {&nbsp;</div></li><li><div>            $string = strstr ($string, $preg[0]);&nbsp;</div></li><li><div>            if ($preg[1] == $tag_name) {&nbsp;</div></li><li><div>                $start++;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $end++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($start == $end) {&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $pos = strlen ($preg[0]);&nbsp;</div></li><li><div>            $string = substr ($string, $pos, strlen ($string) - $pos);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        # make pattern&nbsp;</div></li><li><div>        $reg = addcslashes($mask, '?.+*()|[]$^').'(';&nbsp;</div></li><li><div>        for ($j=0; $j&lt;$end; $j++) {&nbsp;</div></li><li><div>            if ($j &lt; $end-1) {&nbsp;</div></li><li><div>                $reg .= &quot;.*?&quot;.self::_OPEN.&quot;/&quot;.$tag_name.self::_CLOSE;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $reg .= &quot;.*?)&quot;.self::_OPEN.&quot;/&quot;.$tag_name.self::_CLOSE;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $reg;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _getProperty ($key, $string)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (preg_match (&quot;` &quot;.$key.&quot;=\&quot;(.*?)\&quot;`&quot;, $string, $properties)) {&nbsp;</div></li><li><div>            return $properties[1];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _loadTemplate ($template)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach($this-&gt;_template_path as $path) {&nbsp;</div></li><li><div>            if ($template && file_exists (&quot;$path/$template&quot;)) {&nbsp;</div></li><li><div>                $file = &quot;$path/$template&quot;;&nbsp;</div></li><li><div>                return $this-&gt;_loadFile ($file);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        throw new Exception (&quot;Template '$template' not found !&quot;);&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _loadFile ($file)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($file && is_file ($file)) {&nbsp;</div></li><li><div>            $string = file_get_contents ($file);&nbsp;</div></li><li><div>            return $string;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _modifier ($string, $value, $vars=null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (null == $vars) {&nbsp;</div></li><li><div>            $vars = $this-&gt;_vars;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $commands = explode ('|', $string);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($commands as $command) {&nbsp;</div></li><li><div>            $arguments = array ();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            # define list of arguments&nbsp;</div></li><li><div>            if (strpos ($command, &quot;:&quot;)) {&nbsp;</div></li><li><div>                $strings = array ();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (strpos ($command, &quot;'&quot;)) {&nbsp;</div></li><li><div>                    $i = 0;&nbsp;</div></li><li><div>                    while (preg_match (&quot;`'([^}]*?)'`&quot;, $command, $preg)) {&nbsp;</div></li><li><div>                        $strings[] = $preg[1];&nbsp;</div></li><li><div>                        $command = str_replace ($preg[0], '{'.$i.'}', $command);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $split = explode (':', $command);&nbsp;</div></li><li><div>                if (count ($split) &gt; 1) {&nbsp;</div></li><li><div>                    $command = $split[0];&nbsp;</div></li><li><div>                    $count_split = count ($split);&nbsp;</div></li><li><div>                    for ($i=1; $i&lt;$count_split; $i++) {&nbsp;</div></li><li><div>                        if (preg_match (&quot;'&quot;.self::_VAR.&quot;'&quot;, $split[$i], $is_var)) {&nbsp;</div></li><li><div>                            $arguments[] = $this-&gt;_getValue ($is_var, $vars);&nbsp;</div></li><li><div>                        } else if (preg_match (&quot;`\{([0-9])\}`&quot;, $split[$i], $is_string)) {&nbsp;</div></li><li><div>                            $arguments[] = $strings[$is_string[1]];&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $arguments[] = $split[$i];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch ($command) {&nbsp;</div></li><li><div>                case 'default':&nbsp;</div></li><li><div>                    if(!$value) {&nbsp;</div></li><li><div>                        $value = $arguments[0];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'max':&nbsp;</div></li><li><div>                    $value = min($value, $arguments[0]);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'min':&nbsp;</div></li><li><div>                    $value = max($value, $arguments[0]);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'format_text':&nbsp;</div></li><li><div>                    // trim text&nbsp;</div></li><li><div>                    $value = trim($value);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // ignore non utf8 chars&nbsp;</div></li><li><div>                    //$value = iconv('UTF-8', 'UTF-8//IGNORE', $value);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // convert empty titles into line breaks&nbsp;</div></li><li><div>                    $value = str_replace('&lt;h1&gt;&lt;/h1&gt;', '&lt;br /&gt;', $value);&nbsp;</div></li><li><div>                    $value = str_replace('&lt;h2&gt;&lt;/h2&gt;', '&lt;br /&gt;', $value);&nbsp;</div></li><li><div>                    $value = str_replace('&lt;h3&gt;&lt;/h3&gt;', '&lt;br /&gt;', $value);&nbsp;</div></li><li><div>                    // convert empty paragraphs to line breaks&nbsp;</div></li><li><div>                    $value = str_replace('&lt;p&gt;&lt;/p&gt;', '&lt;br /&gt;', $value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'sanitize':&nbsp;</div></li><li><div>                    // prevent XSS&nbsp;</div></li><li><div>                    $value = preg_replace( '#&lt; *script(?:(?!&lt; */ *script *&gt;).)*&lt; */ *script *&gt;#isU', '', $value );&nbsp;</div></li><li><div>                    if(strlen($value) &gt; 0) {&nbsp;</div></li><li><div>                        $value = preg_replace(&quot;#&lt;([^&gt;&lt;]+?)([^a-z_\-]on\w*|xmlns)(\s*=\s*[^&gt;&lt;]*)([&gt;&lt;]*)#i&quot;, &quot;&lt;\\1\\4&quot;, $value);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'ratio':&nbsp;</div></li><li><div>                    $image = $value;&nbsp;</div></li><li><div>                    $ratio = 1.0;&nbsp;</div></li><li><div>                    if(isset($image['width']) && isset($image['height'])) {&nbsp;</div></li><li><div>                        if((int)$image['height'] &lt;= 0) {&nbsp;</div></li><li><div>                            $image['height'] = 1;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $ratio = round(($image['width'] / $image['height']) * 1000) / 1000;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $value = number_format($ratio, 3, '.', '');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>                case 'format_line_height':&nbsp;</div></li><li><div>                    $value = $this-&gt;_css_format_line_height($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'format_font_size_value':&nbsp;</div></li><li><div>                    $value = $this-&gt;_css_format_font_size_value($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'inc':&nbsp;</div></li><li><div>                    if (!isset ($arguments[0])) {&nbsp;</div></li><li><div>                        $value++;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $value = $value + $arguments[0];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'mult':&nbsp;</div></li><li><div>                    if ($arguments) {&nbsp;</div></li><li><div>                        $value = (float)$value * (float)$arguments[0];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'fract':&nbsp;</div></li><li><div>                    if ($arguments) {&nbsp;</div></li><li><div>                        $value = $value / $arguments[0];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'dec':&nbsp;</div></li><li><div>                    if (!isset ($arguments[0])) {&nbsp;</div></li><li><div>                        $value --;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $value = $value - $arguments[0];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'round':&nbsp;</div></li><li><div>                    $value = round ($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'strlen':&nbsp;</div></li><li><div>                    if ($arguments[0]) {&nbsp;</div></li><li><div>                            $value = strlen ($value, $arguments[0]);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                            $value = strlen ($value);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'count':&nbsp;</div></li><li><div>                    $value = count ($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'cut_string':&nbsp;</div></li><li><div>                    if ($arguments) {&nbsp;</div></li><li><div>                        $value = substr($value, 0, $arguments[0]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'substr':&nbsp;</div></li><li><div>                    if (count($arguments) == 2) {&nbsp;</div></li><li><div>                        $value = substr($value, $arguments[0], $arguments[1]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'width':&nbsp;</div></li><li><div>                    if (isset ($arguments[0]) && $arguments[0]) {&nbsp;</div></li><li><div>                            $data_path = $arguments[0];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                            $data_path = $this-&gt;_data_path;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = $data_path.'/'.$value;&nbsp;</div></li><li><div>                    if ($value && file_exists ($value)) {&nbsp;</div></li><li><div>                        $size = @getimagesize ($value);&nbsp;</div></li><li><div>                        $value = $size[0];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $value = '0';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'height':&nbsp;</div></li><li><div>                    if (isset ($arguments[0]) && $arguments[0]) {&nbsp;</div></li><li><div>                            $data_path = $arguments[0];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                            $data_path = $this-&gt;_data_path;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = $data_path.'/'.$value;&nbsp;</div></li><li><div>                    if ($value && file_exists ($value)) {&nbsp;</div></li><li><div>                        $size = @getimagesize ($value);&nbsp;</div></li><li><div>                        $value = $size[1];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $value = '0';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'colorOrNil':&nbsp;</div></li><li><div>                    if($value === 'transparent') {&nbsp;</div></li><li><div>                        $value = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'includes':&nbsp;</div></li><li><div>                    return (bool)(is_array($value) && in_array($arguments[0], $value));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'color':&nbsp;</div></li><li><div>                    $value = $this-&gt;_css_format_color($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'size':&nbsp;</div></li><li><div>                    if (isset ($arguments[0]) && $arguments[0]) {&nbsp;</div></li><li><div>                            $data_path = $arguments[0];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                            $data_path = $this-&gt;_data_path;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = $data_path.'/'.$value;&nbsp;</div></li><li><div>                    if ($value && file_exists ($value)) {&nbsp;</div></li><li><div>                        $value = round (filesize ($value));&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $value = '0';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'ucfirst':&nbsp;</div></li><li><div>                    $value = ucfirst ($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'upper':&nbsp;</div></li><li><div>                    $value = strtoupper($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'lower':&nbsp;</div></li><li><div>                    $value = strtolower($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'year':&nbsp;</div></li><li><div>                    if (preg_match (&quot;'([0-9]{4})-[0-9]{2}-[0-9]{2}'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $preg[1] != '0000' ? $value = $preg[1] : $value = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (preg_match (&quot;'^([0-9]{4})[0-9]{4}'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $preg[1] != '0000' ? $value = $preg[1] : $value = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'month':&nbsp;</div></li><li><div>                    if (preg_match (&quot;'[0-9]{4}-([0-9]{2})-[0-9]{2}'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $preg[1] != '00' ? $value = $preg[1] : $value = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (preg_match (&quot;'^[0-9]{4}([0-9]{2})[0-9]{2}'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $preg[1] != '00' ? $value = $preg[1] : $value = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'day':&nbsp;</div></li><li><div>                    if (preg_match (&quot;'[0-9]{4}-[0-9]{2}-([0-9]{2})'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $preg[1] != '00' ? $value = $preg[1] : $value = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (preg_match (&quot;'^[0-9]{6}([0-9]{2})'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $preg[1] != '00' ? $value = $preg[1] : $value = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'hour':&nbsp;</div></li><li><div>                    if (preg_match (&quot;'([0-9]{2}):[0-9]{2}:[0-9]{2}'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $value = $preg[1];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (preg_match (&quot;'([0-9]{2})[0-9]{4}$'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $value = $preg[1];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'minute':&nbsp;</div></li><li><div>                    if (preg_match (&quot;'[0-9]{2}:([0-9]{2}):[0-9]{2}'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $value = $preg[1];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (preg_match (&quot;'[0-9]{2}([0-9]{2})[0-9]{2}$'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $value = $preg[1];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'second':&nbsp;</div></li><li><div>                    if (preg_match(&quot;'[0-9]{2}:[0-9]{2}:([0-9]{2})'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $value = $preg[1];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if (preg_match(&quot;'[0-9]{4}([0-9]{2})$'&quot;, $value, $preg)) {&nbsp;</div></li><li><div>                        $value = $preg[1];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'nl2br':&nbsp;</div></li><li><div>                    $value = nl2br($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'replace_nl_br':&nbsp;</div></li><li><div>                    $value = str_replace('\n', '&lt;br /&gt;', $value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'delnl':&nbsp;</div></li><li><div>                    $value = str_replace ('\n', '', $value);&nbsp;</div></li><li><div>                    $value = str_replace ('\r', '', $value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'addslashes':&nbsp;</div></li><li><div>                    $value = addslashes ($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'stripslashes':&nbsp;</div></li><li><div>                    $value = stripslashes ($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'trim':&nbsp;</div></li><li><div>                    $value = trim ($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'nbsp':&nbsp;</div></li><li><div>                    $value = str_replace (' ', '&nbsp;', $value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'strip_tags':&nbsp;</div></li><li><div>                    if ($arguments) {&nbsp;</div></li><li><div>                        $value = strip_tags ($value, $arguments[0]);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $value = strip_tags ($value);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>                case 'htmlentities':&nbsp;</div></li><li><div>                    $result = '';&nbsp;</div></li><li><div>                    $length = strlen($value);&nbsp;</div></li><li><div>                    for ($i = 0; $i &lt; $length; $i++) {&nbsp;</div></li><li><div>                        $char = $value[$i];&nbsp;</div></li><li><div>                        $ascii = ord($char);&nbsp;</div></li><li><div>                        if ($ascii &lt; 128) {&nbsp;</div></li><li><div>                            // one-byte character&nbsp;</div></li><li><div>                            $result .= htmlentities($char);&nbsp;</div></li><li><div>                        } else if ($ascii &lt; 192) {&nbsp;</div></li><li><div>                            // non-utf8 character or not a start byte&nbsp;</div></li><li><div>                        } else if ($ascii &lt; 224) {&nbsp;</div></li><li><div>                            // two-byte character&nbsp;</div></li><li><div>                            $result .= htmlentities(substr($value, $i, 2), ENT_QUOTES, 'UTF-8');&nbsp;</div></li><li><div>                            $i++;&nbsp;</div></li><li><div>                        } else if ($ascii &lt; 240) {&nbsp;</div></li><li><div>                            // three-byte character&nbsp;</div></li><li><div>                            $ascii1 = ord($value[$i+1]);&nbsp;</div></li><li><div>                            $ascii2 = ord($value[$i+2]);&nbsp;</div></li><li><div>                            $unicode = (15 & $ascii) * 4096 +&nbsp;</div></li><li><div>                                    (63 & $ascii1) * 64 +&nbsp;</div></li><li><div>                                    (63 & $ascii2);&nbsp;</div></li><li><div>                            $result .= &quot;&#$unicode;&quot;;&nbsp;</div></li><li><div>                            $i += 2;&nbsp;</div></li><li><div>                        } else if ($ascii &lt; 248) {&nbsp;</div></li><li><div>                            // four-byte character&nbsp;</div></li><li><div>                            $ascii1 = ord($value[$i+1]);&nbsp;</div></li><li><div>                            $ascii2 = ord($value[$i+2]);&nbsp;</div></li><li><div>                            $ascii3 = ord($value[$i+3]);&nbsp;</div></li><li><div>                            $unicode = (15 & $ascii) * 262144 +&nbsp;</div></li><li><div>                                    (63 & $ascii1) * 4096 +&nbsp;</div></li><li><div>                                    (63 & $ascii2) * 64 +&nbsp;</div></li><li><div>                                    (63 & $ascii3);&nbsp;</div></li><li><div>                            $result .= &quot;&#$unicode;&quot;;&nbsp;</div></li><li><div>                            $i += 3;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $value = $result;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'index':&nbsp;</div></li><li><div>                    $index = (int)$arguments[0];&nbsp;</div></li><li><div>                    if(isset($value[$index])) {&nbsp;</div></li><li><div>                        $value = $value[$index];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $value = '';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'html_value':&nbsp;</div></li><li><div>                    $value = str_replace('&quot;', '&#34;', $value);&nbsp;</div></li><li><div>                    $value = str_replace(&quot;'&quot;, '&#39;', $value);&nbsp;</div></li><li><div>                    $value = str_replace('&lt;', '&lt;', $value);&nbsp;</div></li><li><div>                    $value = str_replace('&gt;', '&gt;', $value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'html_entity_decode':&nbsp;</div></li><li><div>                    $value = html_entity_decode ($value, ENT_QUOTES);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'json_decode':&nbsp;</div></li><li><div>                    $value = json_decode($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'json_encode':&nbsp;</div></li><li><div>                    $value = json_encode($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'maybe_serialize':&nbsp;</div></li><li><div>                    if(is_array($value) or is_object($value)) {&nbsp;</div></li><li><div>                        // make sure we clean up the useless parser variables&nbsp;</div></li><li><div>                        if(array_key_exists(self::_PAIR, $value)) unset($value[self::_PAIR]);&nbsp;</div></li><li><div>                        if(array_key_exists(self::_FIRST, $value)) unset($value[self::_FIRST]);&nbsp;</div></li><li><div>                        if(array_key_exists(self::_LAST, $value)) unset($value[self::_LAST]);&nbsp;</div></li><li><div>                        // serialize value&nbsp;</div></li><li><div>                        $value = serialize($value);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'base64_decode':&nbsp;</div></li><li><div>                    if($this-&gt;is_valid_base64($value) === true) {&nbsp;</div></li><li><div>                        $value = base64_decode($value);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'base64_encode':&nbsp;</div></li><li><div>                    $value = base64_encode($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'join':&nbsp;</div></li><li><div>                    if(isset($arguments[0])) {&nbsp;</div></li><li><div>                        $value = join($value, $arguments[0]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'wordwrap' :&nbsp;</div></li><li><div>                    if ($arguments) {&nbsp;</div></li><li><div>                        $value = wordwrap ($value, $arguments[0]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'img_size_limit':&nbsp;</div></li><li><div>                    if (isset($arguments[2]) && $arguments[2]) {&nbsp;</div></li><li><div>                            $data_path = $arguments[2];&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                            $data_path = $this-&gt;_data_path;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (null !== $data_path && $value != '' && file_exists ($data_path.'/'.$value)) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $size = @getimagesize ($data_path.'/'.$value);&nbsp;</div></li><li><div>                        $new_width = round($size[0]);&nbsp;</div></li><li><div>                        $new_height = round($size[1]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        # constrain width only&nbsp;</div></li><li><div>                        if (isset ($arguments[0]) && (!isset ($arguments[1]) || $arguments[1]=='0') && $size[0] &gt; $arguments[0]) {&nbsp;</div></li><li><div>                            $new_width = $arguments[0];&nbsp;</div></li><li><div>                            $new_height = round(($new_width * $size[1]) / $size[0]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        # constrain height only&nbsp;</div></li><li><div>                        if (isset ($arguments[0]) && $arguments[0]=='0' && isset ($arguments[1]) && $arguments[1]!='0' && $size[1] &gt; $arguments[1]) {&nbsp;</div></li><li><div>                            $new_height = $arguments[1];&nbsp;</div></li><li><div>                            $new_width = round(($new_height * $size[0]) / $size[1]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        # constrain both&nbsp;</div></li><li><div>                        if (isset ($arguments[0]) && isset ($arguments[1])) {&nbsp;</div></li><li><div>                            if ($size[0] &gt; $arguments[0] && $arguments[0]!='0') {&nbsp;</div></li><li><div>                                $new_width = $arguments[0];&nbsp;</div></li><li><div>                                $new_height = round(($new_width * $size[1]) / $size[0]);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if ($new_height &gt; $arguments[1] && $arguments[1]!='0') {&nbsp;</div></li><li><div>                                $new_height = $arguments[1];&nbsp;</div></li><li><div>                                $new_width = round(($new_height * $size[0]) / $size[1]);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (isset ($new_height) && isset ($new_width)) {&nbsp;</div></li><li><div>                            $value = 'width=&quot;'.$new_width.'&quot; height=&quot;'.$new_height.'&quot;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'highlight':&nbsp;</div></li><li><div>                    if($arguments[0]) {&nbsp;</div></li><li><div>                        $value = preg_replace (&quot;{(&quot;.$arguments[0].&quot;)}si&quot;, &quot;&lt;&quot;.$arguments[1].&quot; class='&quot;.$arguments[2].&quot;'&gt;\\1&lt;/&quot;.$arguments[1].&quot;&gt;&quot;, $value);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'password':&nbsp;</div></li><li><div>                    $value = preg_replace (&quot;'.'&quot;, '*', $value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'get_extension':&nbsp;</div></li><li><div>                    $value = strtolower (pathinfo ($value, PATHINFO_EXTENSION));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'utf8_encode':&nbsp;</div></li><li><div>                    $value = utf8_encode($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'url_encode':&nbsp;</div></li><li><div>                    $value = urlencode ($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'url_decode':&nbsp;</div></li><li><div>                    $value = urldecode($value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'number_format':&nbsp;</div></li><li><div>                    if ($arguments) {&nbsp;</div></li><li><div>                        $value = number_format ($value, $arguments[0], $arguments[1], $arguments[2]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'int':&nbsp;</div></li><li><div>                    $value = (int) $value;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'format_date':&nbsp;</div></li><li><div>                    if ($value && $arguments) {&nbsp;</div></li><li><div>                        $value = $this-&gt;_formatDate ($value, $arguments[0]);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'mime_type':&nbsp;</div></li><li><div>                    if ($value && file_exists ($this-&gt;_data_path.'/'.$value)) {&nbsp;</div></li><li><div>                        $value = mime_content_type ($this-&gt;_data_path.'/'.$value);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'modulo':&nbsp;</div></li><li><div>                    $value = $value%$arguments['0'];&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'trim_br':&nbsp;</div></li><li><div>                        $value = str_replace(array (&quot;&lt;br&gt;&quot;, &quot;&lt;br/&gt;&quot;, &quot;&lt;br /&gt;&quot;), &quot;\n&quot;, $value);&nbsp;</div></li><li><div>                        $value = nl2br (trim ($value));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'implode':&nbsp;</div></li><li><div>                        $value = implode ($arguments[0], $value);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // This function checks if the $data passed is a valid base64 string, &nbsp;</div></li><li><div>    // BEWARE that it does not ensure that the string is actually base64 encoded&nbsp;</div></li><li><div>    function is_valid_base64($data) {&nbsp;</div></li><li><div>        // if the string length is not a multiple of 4, it's not a base64 encoded string&nbsp;</div></li><li><div>        if(strlen($data) % 4 !== 0) return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check the characters contained within the string&nbsp;</div></li><li><div>        if(preg_match('%^[a-zA-Z0-9/+]*={0, 2}$%', $data)) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** misc */&nbsp;</div></li><li><div>    protected function _formatDate ($value, $format)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $date = $this-&gt;_getDate ($value);&nbsp;</div></li><li><div>        return strftime ($format, $date-&gt;format('U'));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected function _getDate ($value)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        setlocale (LC_TIME, &quot;$this-&gt;_lc_time.utf8&quot;);&nbsp;</div></li><li><div>        return new DateTime ($value);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected static function _css_format_font_size_value($value) {&nbsp;</div></li><li><div>        if(strpos($value, 'em') !== FALSE) {&nbsp;</div></li><li><div>            // if number value, convert to percent&nbsp;</div></li><li><div>            $percentage = ((float)$value * 100);&nbsp;</div></li><li><div>            $value = $percentage.'%';&nbsp;</div></li><li><div>        } else if(strpos($value, '%') === FALSE) {&nbsp;</div></li><li><div>            $value = $value.'px';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected static function _css_format_color($value) {&nbsp;</div></li><li><div>        if($value !== 'transparent' && $value !== '') {&nbsp;</div></li><li><div>            $value = '#'.$value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    protected static function _css_format_line_height($value) {&nbsp;</div></li><li><div>        // if value in px, don't modify&nbsp;</div></li><li><div>        if($value !== '0' && strpos($value, 'px') === FALSE && strpos($value, '%') === FALSE) {&nbsp;</div></li><li><div>            // if number value, convert to percent&nbsp;</div></li><li><div>            $percentage = ((float)$value * 100);&nbsp;</div></li><li><div>            $value = $percentage.'%';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $value;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.1</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/wysija_help_render_engine/" class="active">2.7.5</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.4/classes/wysija_help_render_engine/" class="">2.7.4</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.3/classes/wysija_help_render_engine/" class="">2.7.3</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.2/classes/wysija_help_render_engine/" class="">2.7.2</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.1/classes/wysija_help_render_engine/" class="">2.7.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>WYSIJA_help_render_engine</li><li><span></span>MailPoet Newsletters</li><li><span></span>2.7.5</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>