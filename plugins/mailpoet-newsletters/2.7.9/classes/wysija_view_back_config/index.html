<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.7.9" data-slug="mailpoet-newsletters" data-type="class" data-id="55878"><head xmlns="http://www.w3.org/1999/xhtml"><title> wysija_view_back_config | class | Mailpoet Newsletters | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WYSIJA_view_back_config, class, plugin, mailpoet-newsletters, 2.7.9" /><meta name="description" content="The MailPoet Newsletters WYSIJA view back config class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=8fce9cfc9c8e45b712b70e8ba0be56f3' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wysija_view_back_config/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwysija_view_back_config%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwysija_view_back_config%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-mailpoet-newsletters-2.7.9-class-wysija_view_back_config","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wysija_view_back_config" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to mailpoet-newsletters." href="http://hookr.io/plugins/mailpoet-newsletters/" class="plugin"><span property="name">mailpoet-newsletters</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.9." href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/" class="H_VERSION"><span property="name">2.7.9</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wysija_view_back_config</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="298"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/all/" title="All">All <span class="count badge">298</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="104"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/hooks/" title="Hooks">Hooks <span class="count badge">104</span></a></li><li class="" data-id="action" data-count="30"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/actions/" title="Actions">Actions <span class="count badge">30</span></a></li><li class="" data-id="filter" data-count="74"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/filters/" title="Filters">Filters <span class="count badge">74</span></a></li><li class="active" data-id="class" data-count="131"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/classes/" title="Classes">Classes <span class="count badge">131</span></a></li><li class="" data-id="constant" data-count="52"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/constants/" title="Constants">Constants <span class="count badge">52</span></a></li><li class="" data-id="function" data-count="8"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/functions/" title="Functions">Functions <span class="count badge">8</span></a></li><li class="" data-id="shortcode" data-count="3"><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">3</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WYSIJA_view_back_config</strong></h1><p>The MailPoet Newsletters <strong>WYSIJA view back config</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/files/views-back-config/" class="file">/views/back/config.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="4" class="block" start="4"><li><div>class WYSIJA_view_back_config extends WYSIJA_view_back {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $title = 'Settings';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $icon = 'icon-options-general';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    var $skip_header = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function reinstall() {&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;form name=&quot;wysija-settings&quot; method=&quot;post&quot; id=&quot;wysija-settings&quot; action=&quot;&quot; class=&quot;form-valid&quot; autocomplete=&quot;off&quot;&gt;&nbsp;</div></li><li><div>            &lt;input type=&quot;hidden&quot; value=&quot;doreinstall&quot; name=&quot;action&quot; /&gt;&nbsp;</div></li><li><div>            &lt;input type=&quot;hidden&quot; value=&quot;reinstall&quot; name=&quot;postedfrom&quot; /&gt;&nbsp;</div></li><li><div>            &lt;h3&gt;&lt;?php _e('If you confirm this, all your current MailPoet data will be erased (newsletters, themes, statistics, lists, subscribers, etc.)', WYSIJA); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>            &lt;p class=&quot;submit&quot;&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;submit&quot; value=&quot;&lt;?php _e('Confirm Reinstallation', WYSIJA) ?&gt;&quot; class=&quot;button-secondary&quot; id=&quot;submit&quot; name=&quot;submit&quot; /&gt;&nbsp;</div></li><li><div>                &lt;?php $this-&gt;secure(array( 'action' =&gt; 'doreinstall' )); ?&gt;&nbsp;</div></li><li><div>            &lt;/p&gt;&nbsp;</div></li><li><div>        &lt;/form&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_commentform($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        // second part concerning the checkbox&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($this-&gt;model-&gt;getValue($key))&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $checkboxDetails = array( 'id' =&gt; $key, 'name' =&gt; 'wysija['.$model.']['.$key.']', 'class' =&gt; 'activateInput' );&nbsp;</div></li><li><div>        $contentAfter = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if it's the commentform field and jetpacks is activated with its comment module then we disable the box&nbsp;</div></li><li><div>        if ($key == 'commentform' && WYSIJA::is_plugin_active('jetpack/jetpack.php') && in_array('comments', Jetpack::get_active_modules())) {&nbsp;</div></li><li><div>            $checkboxDetails['disabled'] = 'disabled';&nbsp;</div></li><li><div>            $contentAfter = '&lt;p&gt;'.__('This feature cannot work because the &quot;Comments&quot; feature of the plugin JetPack is enabled.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if it's the register form field and registration is not allowed on the site then we just disable it&nbsp;</div></li><li><div>        $active_signup = false;&nbsp;</div></li><li><div>        if (is_multisite()) {&nbsp;</div></li><li><div>            $active_signup = get_site_option('registration');&nbsp;</div></li><li><div>            if (!$active_signup)&nbsp;</div></li><li><div>                $active_signup = 'all';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $active_signup = apply_filters('wpmu_active_signup', $active_signup);&nbsp;</div></li><li><div>            if (in_array($active_signup, array( 'none', 'blog' )))&nbsp;</div></li><li><div>                $active_signup = false;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $active_signup = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $active_signup = get_option('users_can_register');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($key == 'registerform' && !$active_signup) {&nbsp;</div></li><li><div>            $checkboxDetails['disabled'] = 'disabled';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $contentAfter = '&lt;p&gt;'.__('Registration is disabled on this site.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldHTML = '&lt;label class=&quot;checkbox_optin_label&quot; for=&quot;'.$key.'&quot;&gt;';&nbsp;</div></li><li><div>        $fieldHTML.=$formsHelp-&gt;checkbox($checkboxDetails, 1, $checked);&nbsp;</div></li><li><div>        $fieldHTML.='&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = $this-&gt;model-&gt;getValue($key.'_linkname');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldHTML.='&lt;div id=&quot;'.$key.'_linkname'.'&quot; class=&quot;checkbox_optin_value&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($contentAfter) {&nbsp;</div></li><li><div>            $fieldHTML.='&lt;/div&gt;';&nbsp;</div></li><li><div>            $fieldHTML.=$contentAfter;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $fieldHTML.=$formsHelp-&gt;input(array( 'name' =&gt; 'wysija['.$model.']['.$key.'_linkname]', 'size' =&gt; '75' ), $value);&nbsp;</div></li><li><div>            $model_list = WYSIJA::get('list', 'model');&nbsp;</div></li><li><div>            $lists = $model_list-&gt;get(array( 'name', 'list_id' ), array( 'is_enabled' =&gt; 1 ));&nbsp;</div></li><li><div>            $valuefield = $this-&gt;model-&gt;getValue($key.'_lists');&nbsp;</div></li><li><div>            if (!$valuefield)&nbsp;</div></li><li><div>                $valuefield = array( );&nbsp;</div></li><li><div>            foreach ($lists as $list) {&nbsp;</div></li><li><div>                if (in_array($list['list_id'], $valuefield))&nbsp;</div></li><li><div>                    $checked = true;&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $checked = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $fieldHTML.= '&lt;p class=&quot;labelcheck&quot;&gt;&lt;label for=&quot;list-'.$list['list_id'].'&quot;&gt;'.$formsHelp-&gt;checkbox(array( 'id' =&gt; 'list-'.$list['list_id'], &nbsp;</div></li><li><div>                            'name' =&gt; 'wysija[config]['.$key.'_lists][]', 'class' =&gt; 'validate[minCheckbox[1]]' ), $list['list_id'], $checked).$list['name'].'&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $fieldHTML.='&lt;/div&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $fieldHTML;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_subscribers_count($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        // second part concerning the checkbox&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($this-&gt;model-&gt;getValue($key)) {&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $fieldHTML = '';&nbsp;</div></li><li><div>        $fieldHTML .= '&lt;div id=&quot;'.$key.'_linkname'.'&quot; class=&quot;checkbox_optin_value&quot;&gt;';&nbsp;</div></li><li><div>        $fieldHTML .= $formsHelp-&gt;input(array( 'name' =&gt; 'wysija['.$model.']['.$key.'_linkname]', 'size' =&gt; '75', 'class' =&gt; 'subscribers-count-shortcode', 'readonly' =&gt; 'readonly' ), '[wysija_subscribers_count]').'&lt;/p&gt;';&nbsp;</div></li><li><div>        $model_list = WYSIJA::get('list', 'model');&nbsp;</div></li><li><div>        $lists = $model_list-&gt;get(array( 'name', 'list_id', 'is_public' ), array( 'is_enabled' =&gt; 1 ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($lists as $list) {&nbsp;</div></li><li><div>            $fieldHTML.= '&lt;p class=&quot;labelcheck&quot;&gt;&lt;label for=&quot;'.$key.'list-'.$list['list_id'].'&quot;&gt;'.$formsHelp-&gt;checkbox(array( 'id' =&gt; $key.'list-'.$list['list_id'], &nbsp;</div></li><li><div>                        'name' =&gt; 'wysija[config]['.$key.'_lists][]', 'class' =&gt; 'subscribers-count-list' ), $list['list_id']).$list['name'].'&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $fieldHTML.='&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $fieldHTML;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_managesubscribe($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        // second part concerning the checkbox&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($this-&gt;model-&gt;getValue($key))&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $fieldHTML = '&lt;label class=&quot;checkbox_optin_label&quot; for=&quot;'.$key.'&quot;&gt;';&nbsp;</div></li><li><div>        $fieldHTML .= $formsHelp-&gt;checkbox(array( 'id' =&gt; $key, 'name' =&gt; 'wysija['.$model.']['.$key.']', 'class' =&gt; 'activateInput' ), 1, $checked);&nbsp;</div></li><li><div>        $fieldHTML .= '&lt;/label&gt;';&nbsp;</div></li><li><div>        $value = $this-&gt;model-&gt;getValue($key.'_linkname');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldHTML .= '&lt;div id=&quot;'.$key.'_linkname'.'&quot; class=&quot;checkbox_optin_value&quot;&gt;';&nbsp;</div></li><li><div>        $fieldHTML .= $formsHelp-&gt;input(array( 'name' =&gt; 'wysija['.$model.']['.$key.'_linkname]', 'size' =&gt; '75' ), $value);&nbsp;</div></li><li><div>        $fieldHTML .= '&lt;p style=&quot;margin-bottom:0px;&quot;&gt;'.__('Subscribers can choose from these lists :', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        $model_list = WYSIJA::get('list', 'model');&nbsp;</div></li><li><div>        $lists = $model_list-&gt;get(array( 'name', 'list_id', 'is_public' ), array( 'is_enabled' =&gt; 1 ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        usort($lists, array( $this, 'sort_by_name' ));&nbsp;</div></li><li><div>        foreach ($lists as $list) {&nbsp;</div></li><li><div>            if ($list['is_public'])&nbsp;</div></li><li><div>                $checked = true;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $checked = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $fieldHTML.= '&lt;p class=&quot;labelcheck&quot;&gt;&lt;label for=&quot;'.$key.'list-'.$list['list_id'].'&quot;&gt;'.$formsHelp-&gt;checkbox(array( 'id' =&gt; $key.'list-'.$list['list_id'], &nbsp;</div></li><li><div>                        'name' =&gt; 'wysija[config]['.$key.'_lists][]' ), $list['list_id'], $checked).$list['name'].'&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $fieldHTML.='&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $fieldHTML;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_viewinbrowser($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        /** second part concerning the checkbox */&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($this-&gt;model-&gt;getValue($key))&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $field = '&lt;p&gt;&lt;label for=&quot;'.$key.'&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;checkbox(array( 'id' =&gt; $key, 'name' =&gt; 'wysija['.$model.']['.$key.']', 'class' =&gt; 'activateInput' ), 1, $checked);&nbsp;</div></li><li><div>        $field.='&lt;/label&gt;';&nbsp;</div></li><li><div>        $value = $this-&gt;model-&gt;getValue($key.'_linkname');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;input(array( &quot;id&quot; =&gt; $key.'_linkname', 'name' =&gt; 'wysija['.$model.']['.$key.'_linkname]', 'size' =&gt; '75' ), $value).'&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_page_selection($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        $model_user = WYSIJA::get('user', 'model');&nbsp;</div></li><li><div>        $action_takens = array( 'confirmation_page' =&gt; 'subscribe', 'unsubscribe_page' =&gt; 'unsubscribe', 'subscriptions_page' =&gt; 'subscriptions' );&nbsp;</div></li><li><div>        $pages = array( $this-&gt;model-&gt;getValue('confirm_email_link') =&gt; __('MailPoet page', WYSIJA) );&nbsp;</div></li><li><div>        $pages_objects = get_pages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($pages_objects as $page_object) {&nbsp;</div></li><li><div>            $pages[$page_object-&gt;ID] = $page_object-&gt;post_title;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $preview_edit_links = '&lt;span id=&quot;'.$key.'-links&quot;&gt;';&nbsp;</div></li><li><div>        foreach ($pages as $page_id =&gt; $page_title) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $preview_link = $model_user-&gt;getConfirmLink(false, $action_takens[$key], false, true, '_blank', $page_id);&nbsp;</div></li><li><div>            $edit_link = get_edit_post_link($page_id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $preview_edit_links .= '&lt;span id=&quot;'.$key.'-links-'.$page_id.'&quot; class=&quot;links-page&quot;&gt;';&nbsp;</div></li><li><div>            $preview_edit_links .= '&lt;a href=&quot;'.$preview_link.'&quot; target=&quot;_blank&quot; title=&quot;'.__('Preview', WYSIJA).'&quot;&gt;'.__('Preview', WYSIJA).'&lt;/a&gt;';&nbsp;</div></li><li><div>            $preview_edit_links .= ' | &lt;a href=&quot;'.$edit_link.'&quot; target=&quot;_blank&quot; title=&quot;'.__('Edit', WYSIJA).'&quot;&gt;'.__('Edit', WYSIJA).'&lt;/a&gt;';&nbsp;</div></li><li><div>            $preview_edit_links .= '&lt;/span&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $preview_edit_links .= '&lt;/span&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $helper_forms = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $field = $helper_forms-&gt;dropdown(array( 'id' =&gt; $key, 'class' =&gt; 'page_select', 'name' =&gt; 'wysija['.$model.']['.$key.']' ), $pages, $this-&gt;model-&gt;getValue($key));&nbsp;</div></li><li><div>        $field .= $preview_edit_links;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_cron($key, $value, $model) {&nbsp;</div></li><li><div>        //second part concerning the checkbox&nbsp;</div></li><li><div>        $helper_forms = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($this-&gt;model-&gt;getValue($key))&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = '&lt;div&gt;&lt;div class=&quot;cronleft&quot;&gt;&lt;label for=&quot;'.$key.'&quot;&gt;';&nbsp;</div></li><li><div>        $field .= $helper_forms-&gt;checkbox(array( 'id' =&gt; $key, 'name' =&gt; 'wysija['.$model.']['.$key.']', 'class' =&gt; 'activateInput' ), 1, $checked);&nbsp;</div></li><li><div>        $field .= '&lt;/label&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $url_cron = site_url('wp-cron.php').'?'.WYSIJA_CRON.'&action=wysija_cron&process=all';&nbsp;</div></li><li><div>        $field .= '&lt;div class=&quot;cronright&quot; id=&quot;'.$key.'_linkname&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $text_cron_manual_trigger = __('I\'ll setup a cron job on my server to execute at the frequency I want. Read about [link]setting up a cron job yourself[/link].', WYSIJA).'&lt;br/&gt;&lt;span&gt;'.__('Use this URL in your cron job: [cron_url]').'&lt;/span&gt;';&nbsp;</div></li><li><div>        $text_cron_manual_trigger = str_replace(array( '[link]', '[/link]', '[cron_url]' ), array( '&lt;a href=&quot;http://support.mailpoet.com/knowledgebase/configure-cron-job/?utm_source=wpadmin&utm_campaign=advanced_settings&quot; title=&quot;Seting up cron job&quot; target=&quot;_blank&quot;&gt;', '&lt;/a&gt;', '&lt;a href=&quot;'.$url_cron.'&quot; target=&quot;_blank&quot;&gt;'.$url_cron.'&lt;/a&gt;' ), $text_cron_manual_trigger);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $text_cron_page_view = __('No thanks! I have enough visitors on my site. Their visits will trigger MailPoet\'s cron automatically.', WYSIJA);&nbsp;</div></li><li><div>        $values_page_view_trigger = array( 2 =&gt; $text_cron_manual_trigger, 1 =&gt; $text_cron_page_view );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = 2;&nbsp;</div></li><li><div>        if ((int)$this-&gt;model-&gt;getValue('cron_page_hit_trigger') === 1)&nbsp;</div></li><li><div>            $value = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = 'cron_page_hit_trigger';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $content_radios = $helper_forms-&gt;radios(array( 'id' =&gt; $key, 'name' =&gt; 'wysija['.$model.']['.$key.']' ), $values_page_view_trigger, $value);&nbsp;</div></li><li><div>        add_filter('wysija_extend_cron_config', array( $this, 'add_text_cron_premium' ));&nbsp;</div></li><li><div>        $field .= apply_filters('wysija_extend_cron_config', $content_radios);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field .= '&lt;/div&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // replace the variable in the text&nbsp;</div></li><li><div>        $field = str_replace(array( '[link]', '[/link]', '[cron_url]' ), array( '&lt;a href=&quot;http://support.mailpoet.com/knowledgebase/configure-cron-job/?utm_source=wpadmin&utm_campaign=advanced_settings&quot; title=&quot;Seting up cron job&quot; target=&quot;_blank&quot;&gt;', '&lt;/a&gt;', '&lt;a href=&quot;'.$url_cron.'&quot; target=&quot;_blank&quot;&gt;'.$url_cron.'&lt;/a&gt;' ), $field);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // TODO remove that function which is in the premium plugin&nbsp;</div></li><li><div>    function add_text_cron_premium($content) {&nbsp;</div></li><li><div>        if (WYSIJA::is_plugin_active('wysija-newsletters-premium/index.php') && $this-&gt;model-&gt;getValue('premium_key')) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $content = __('I\'m a premium user, MailPoet.com will make sure my emails get sent on time.', WYSIJA).'&lt;br/&gt;';&nbsp;</div></li><li><div>            $content .= __('If I want I can [link]create an additional cron job[/link] on my end to increase the sending frequency.', WYSIJA).'&lt;br/&gt;&lt;span&gt;'.__('Use this URL in your cron job: [cron_url]').'&lt;/span&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $content;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_cron_prem($key, $value, $model) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $url_cron = site_url('wp-cron.php').'?'.WYSIJA_CRON.'&action=wysija_cron&process=all';&nbsp;</div></li><li><div>        $field = '&lt;p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $text_cron_manual_trigger = __('If I want I can [link]create an additional cron job[/link] on my end to increase the frequency.', WYSIJA).'&lt;br/&gt;&lt;span&gt;'.__('Use this URL in your cron job: [cron_url]').'&lt;/span&gt;';&nbsp;</div></li><li><div>        $field .= str_replace(array( '[link]', '[/link]', '[cron_url]' ), array( '&lt;a href=&quot;http://support.mailpoet.com/knowledgebase/configure-cron-job/?utm_source=wpadmin&utm_campaign=advanced_settings&quot; title=&quot;Seting up cron job&quot; target=&quot;_blank&quot;&gt;', '&lt;/a&gt;', '&lt;a href=&quot;'.$url_cron.'&quot; target=&quot;_blank&quot;&gt;'.$url_cron.'&lt;/a&gt;' ), $text_cron_manual_trigger);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field .= '&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>//        $model_config = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>//        if ($model_config-&gt;getValue('cron_manual') !== true) {&nbsp;</div></li><li><div>//            $model_config-&gt;save(array('cron_manual' =&gt; true));&nbsp;</div></li><li><div>//&nbsp;</div></li><li><div>//            $helper_licence = WYSIJA::get('licence', 'helper');&nbsp;</div></li><li><div>//            $helper_licence-&gt;check(true);&nbsp;</div></li><li><div>//        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_debugnew($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        /** second part concerning the checkbox */&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $selected = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>        if (!$selected)&nbsp;</div></li><li><div>            $selected = 0;&nbsp;</div></li><li><div>        $field = '&lt;p&gt;&lt;label for=&quot;'.$key.'&quot;&gt;';&nbsp;</div></li><li><div>        $options = array( 0 =&gt; 'off', 1 =&gt; 'SQL queries', 2 =&gt; '&nbsp;+extra data', 3 =&gt; '&nbsp;&nbsp;+safe PHP errors' );&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;dropdown(array( 'id' =&gt; $key, 'name' =&gt; 'wysija['.$model.']['.$key.']' ), $options, $selected);&nbsp;</div></li><li><div>        $field.='&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_debuglog($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        /** second part concerning the checkbox */&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $lists = array( 'cron', 'post_notif', 'query_errors', 'queue_process', 'manual' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fieldHTML = '&lt;div id=&quot;'.$key.'_linkname'.'&quot; class=&quot;checkbox_optin_value&quot;&gt;';&nbsp;</div></li><li><div>        foreach ($lists as $list) {&nbsp;</div></li><li><div>            $checked = false;&nbsp;</div></li><li><div>            if ($this-&gt;model-&gt;getValue($key.'_'.$list))&nbsp;</div></li><li><div>                $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $fieldHTML.= '&lt;p class=&quot;labelcheck&quot;&gt;&lt;label for=&quot;'.$key.'list-'.$list.'&quot;&gt;'.$formsHelp-&gt;checkbox(array( 'id' =&gt; $key.'list-'.$list, &nbsp;</div></li><li><div>                        'name' =&gt; 'wysija[config]['.$key.'_'.$list.'][]' ), 1, $checked).$list.'&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $fieldHTML.='&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $fieldHTML;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_dkim($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = '';&nbsp;</div></li><li><div>        $keypublickey = $key.'_pubk';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //there is no public key, this is the first time we load that function so we need to generate the dkim&nbsp;</div></li><li><div>        if (!$this-&gt;model-&gt;getValue($keypublickey)) {&nbsp;</div></li><li><div>            //refresh the public key private key generation&nbsp;</div></li><li><div>            $helpersLi = WYSIJA::get('licence', 'helper');&nbsp;</div></li><li><div>            $helpersLi-&gt;dkim_config();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        WYSIJA::update_option('dkim_autosetup', false);&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $realkey = $key.'_active';&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($this-&gt;model-&gt;getValue($realkey))&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field.='&lt;p&gt;';&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;checkbox(array( 'id' =&gt; $realkey, 'name' =&gt; 'wysija['.$model.']['.$realkey.']', 'style' =&gt; 'margin-left:0px;', 'class' =&gt; 'activateInput' ), 1, $checked);&nbsp;</div></li><li><div>        $field.='&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field.='&lt;div id=&quot;'.$realkey.'_linkname&quot; &gt;';&nbsp;</div></li><li><div>        //$titlelink=str_replace(array('[link]', '[\link]'), array('&lt;a href=&quot;&quot;&gt;', '&lt;/a&gt;'), '');&nbsp;</div></li><li><div>        $titlelink = __('Configure your DNS by adding a key/value record in TXT as shown below.', WYSIJA).' &lt;a href=&quot;http://support.mailpoet.com/knowledgebase/guide-to-dkim-in-wysija/?utm_source=wpadmin&utm_campaign=settings&quot; target=&quot;_blank&quot;&gt;'.__('Read more', WYSIJA).'&lt;/a&gt;';&nbsp;</div></li><li><div>        $field.='&lt;fieldset style=&quot; border: 1px solid #ccc;margin: 0;padding: 10px;&quot;&gt;&lt;legend&gt;'.$titlelink.'&lt;/legend&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field.='&lt;label id=&quot;drlab&quot; for=&quot;domainrecord&quot;&gt;'.__('Key', WYSIJA).' &lt;input readonly=&quot;readonly&quot; id=&quot;domainrecord&quot; style=&quot;margin-right:10px;&quot; type=&quot;text&quot; value=&quot;wys._domainkey&quot;/&gt;&lt;/label&gt;&lt;label id=&quot;drpub&quot; for=&quot;dkimpub&quot;&gt;'.__('Value', WYSIJA).' &lt;input readonly=&quot;readonly&quot; id=&quot;dkimpub&quot; type=&quot;text&quot; size=&quot;70&quot; value=&quot;v=DKIM1;s=email;t=s;p='.$this-&gt;model-&gt;getValue($keypublickey).'&quot;/&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //the DKIM key is not a 1024 bits it is therefore obsolete&nbsp;</div></li><li><div>        if (!$this-&gt;model-&gt;getValue('dkim_1024')) {&nbsp;</div></li><li><div>            $stringRegenerate = __('You\'re using an older DKIM key which is unsupported by Gmail.', WYSIJA).' '.__('You\'ll need to update your DNS if you upgrade.', WYSIJA);&nbsp;</div></li><li><div>            $field.='&lt;p&gt;&lt;strong&gt;'.$stringRegenerate.'&lt;/strong&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>            $field.='&lt;p&gt;&lt;input type=&quot;hidden&quot; id=&quot;dkim_regenerate&quot; value=&quot;0&quot; name=&quot;wysija[config][dkim_regenerate]&quot;&gt;&lt;a id=&quot;button-regenerate-dkim&quot; class=&quot;button-secondary&quot; href=&quot;javascript:;&quot;&gt;'.__('Upgrade DKIM key', WYSIJA).'&lt;/a&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field.='&lt;/fieldset&gt;';&nbsp;</div></li><li><div>        $realkey = $key.'_domain';&nbsp;</div></li><li><div>        $field.='&lt;p&gt;&lt;label class=&quot;dkim&quot; for=&quot;'.$realkey.'&quot;&gt;'.__('Domain', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;input(array( 'id' =&gt; $realkey, 'name' =&gt; 'wysija['.$model.']['.$realkey.']' ), $this-&gt;model-&gt;getValue($realkey));&nbsp;</div></li><li><div>        $field.='&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field.='&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_debug($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        /** second part concerning the checkbox */&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($this-&gt;model-&gt;getValue($key))&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $field = '&lt;p&gt;&lt;label for=&quot;'.$key.'&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;checkbox(array( 'id' =&gt; $key, 'name' =&gt; 'wysija['.$model.']['.$key.']' ), 1, $checked);&nbsp;</div></li><li><div>        $field.='&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_capabilities($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        /** second part concerning the checkbox */&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = '&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;3&quot; class=&quot;wp-list-table widefat fixed capabilities_form&quot;&gt;&nbsp;</div></li><li><div>    &lt;thead&gt;&nbsp;</div></li><li><div>        &lt;tr&gt;&nbsp;</div></li><li><div>&lt;th class=&quot;rolestitle&quot; style=&quot;width:200px&quot;&gt;'.__('Roles and permissions', WYSIJA).'&lt;/th&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $wptools = WYSIJA::get('wp_tools', 'helper');&nbsp;</div></li><li><div>        $editable_roles = $wptools-&gt;wp_get_roles();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($editable_roles as $role) {&nbsp;</div></li><li><div>            $field.='&lt;th class=&quot;rolestable&quot; &gt;'.translate_user_role($role['name']).'&lt;/th&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field.='&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $alternate = true;&nbsp;</div></li><li><div>        $count = 1;&nbsp;</div></li><li><div>        $is_hidden = false;&nbsp;</div></li><li><div>        foreach ($this-&gt;model-&gt;capabilities as $keycap =&gt; $capability) {&nbsp;</div></li><li><div>            $classAlternate = array( );&nbsp;</div></li><li><div>            if ($alternate)&nbsp;</div></li><li><div>                $classAlternate[] = 'alternate';&nbsp;</div></li><li><div>            if ($count &gt; 2) {&nbsp;</div></li><li><div>                $classAlternate[] = 'hidden';&nbsp;</div></li><li><div>                $is_hidden = true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $classAlternate = implode(' ', $classAlternate);&nbsp;</div></li><li><div>            $classAlternate = ' class=&quot;'.$classAlternate.'&quot; ';&nbsp;</div></li><li><div>            $field.='&lt;tr'.$classAlternate.'&gt;&lt;td class=&quot;title&quot;&gt;&lt;p class=&quot;description&quot;&gt;'.$capability['label'].'&lt;/p&gt;&lt;/td&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ($editable_roles as $role) {&nbsp;</div></li><li><div>                $checked = false;&nbsp;</div></li><li><div>                $keycheck = 'rolescap---'.$role['key'].'---'.$keycap;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                //if($this-&gt;model-&gt;getValue($keycheck))   $checked=true;&nbsp;</div></li><li><div>                $checkboxparams = array( 'id' =&gt; $keycheck, 'name' =&gt; 'wysija['.$model.']['.$keycheck.']' );&nbsp;</div></li><li><div>                if (in_array($role['key'], array( 'administrator', 'super_admin' ))) {&nbsp;</div></li><li><div>                    $checkboxparams['disabled'] = 'disabled';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $roling = get_role($role['key']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // add &quot;organize_gallery&quot; to this role object&nbsp;</div></li><li><div>                if ($roling-&gt;has_cap('wysija_'.$keycap)) {&nbsp;</div></li><li><div>                    $checked = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $field.='&lt;td class=&quot;rolestable&quot; &gt;'.$formsHelp-&gt;checkbox($checkboxparams, 1, $checked).'&lt;/td&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field.='&lt;/tr&gt;';&nbsp;</div></li><li><div>            $alternate = !$alternate;&nbsp;</div></li><li><div>            $count++;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ($is_hidden) {&nbsp;</div></li><li><div>            $classAlternate = '';&nbsp;</div></li><li><div>            if ($alternate)&nbsp;</div></li><li><div>                $classAlternate = ' class=&quot;alternate&quot; ';&nbsp;</div></li><li><div>            $field.= '&lt;tr'.$classAlternate.'&gt;&lt;td colspan=&quot;'.(count($editable_roles) + 1).'&quot;&gt;&lt;a class=&quot;view_all&quot; href=&quot;javascript:void(0);&quot;&gt;'.__('View all', WYSIJA).'&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field.='&lt;/tbody&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_email_notifications($key, $value, $model, $paramsex) {&nbsp;</div></li><li><div>        /** first part concerning the field itself */&nbsp;</div></li><li><div>        $params = array( );&nbsp;</div></li><li><div>        $params['type'] = 'default';&nbsp;</div></li><li><div>        $params['size'] = 38;&nbsp;</div></li><li><div>        $field = $this-&gt;fieldHTML($key, $value, $model, $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** second part concerning the checkbox */&nbsp;</div></li><li><div>        $threecheck = array(&nbsp;</div></li><li><div>            '_when_sub' =&gt; __('When someone subscribes', WYSIJA)&nbsp;</div></li><li><div> , '_when_unsub' =&gt; __('When someone unsubscribes', WYSIJA), &nbsp;</div></li><li><div>            '_when_dailysummary' =&gt; __('Daily summary of emails sent', WYSIJA)&nbsp;</div></li><li><div>                //, &quot;_when_bounce&quot;=&gt;__('When an email bounces', WYSIJA)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        foreach ($threecheck as $keycheck =&gt; $checkobj) {&nbsp;</div></li><li><div>            $checked = false;&nbsp;</div></li><li><div>            if ($this-&gt;model-&gt;getValue($key.$keycheck))&nbsp;</div></li><li><div>                $checked = true;&nbsp;</div></li><li><div>            $field.='&lt;p&gt;&lt;label for=&quot;'.$key.$keycheck.'&quot;&gt;';&nbsp;</div></li><li><div>            $field.=$formsHelp-&gt;checkbox(array( &quot;id&quot; =&gt; $key.$keycheck, 'name' =&gt; 'wysija['.$model.']['.$key.$keycheck.']' ), 1, $checked);&nbsp;</div></li><li><div>            $field.=$checkobj.'&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fieldFormHTML_selfsigned($key, $value, $model, $params) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $realvalue = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = 0;&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($value == $realvalue)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;radio(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija['.$model.']['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>        $field.=__('No', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = 1;&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($value == $realvalue)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>        $field.='&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;radio(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija['.$model.']['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>        $field.=__('Yes', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function tabs($current = null) {&nbsp;</div></li><li><div>        $tabs = array(&nbsp;</div></li><li><div>            'basics' =&gt; _x('Basics', 'settings tab title', WYSIJA), &nbsp;</div></li><li><div>            'forms' =&gt; _x('Forms', 'settings tab title', WYSIJA), &nbsp;</div></li><li><div>            'signupconfirmation' =&gt; _x('Signup Confirmation', 'settings tab title', WYSIJA), &nbsp;</div></li><li><div>            'sendingmethod' =&gt; _x('Send With...', 'settings tab title', WYSIJA), &nbsp;</div></li><li><div>            'advanced' =&gt; _x('Advanced', 'settings tab title', WYSIJA), &nbsp;</div></li><li><div>            'add-ons' =&gt; _x('Add-ons', 'settings tab title', WYSIJA), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!$this-&gt;_user_can('change_sending_method'))&nbsp;</div></li><li><div>            unset($tabs['sendingmethod']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tabs = apply_filters('wysija_extend_settings', $tabs);&nbsp;</div></li><li><div>        echo '&lt;div id=&quot;icon-options-general&quot; class=&quot;icon32&quot;&gt;&lt;br /&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>        echo '&lt;h2 id=&quot;wysija-tabs&quot; class=&quot;nav-tab-wrapper&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($tabs as $tab =&gt; $name) {&nbsp;</div></li><li><div>            $class = ($tab === $current) ? ' nav-tab-active' : '';&nbsp;</div></li><li><div>            $extra = ($tab === 'premium') ? ' premium' : '';&nbsp;</div></li><li><div>            echo &quot;&lt;a class='nav-tab$class$extra' href='#$tab'&gt;$name&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        echo '&lt;/h2&gt;';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function save($data) {&nbsp;</div></li><li><div>        $this-&gt;main($data);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $action&nbsp;</div></li><li><div>     * @return boolean&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _user_can($action) {&nbsp;</div></li><li><div>        if (empty($action))&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        $is_network_admin = WYSIJA::current_user_can('manage_network');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //$is_network_admin=true;//PROD comment that line&nbsp;</div></li><li><div>        if ($is_network_admin)&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $is_multisite = is_multisite();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //$is_multisite=true;//PROD comment that line&nbsp;</div></li><li><div>        switch ($action) {&nbsp;</div></li><li><div>            case 'change_sending_method':&nbsp;</div></li><li><div>                if ((!$is_multisite || ($is_multisite && $this-&gt;model-&gt;getValue('ms_allow_admin_sending_method'))) && WYSIJA::current_user_can('switch_themes')&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>                    return true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'toggle_signup_confirmation':&nbsp;</div></li><li><div>                if ((!$is_multisite || ($is_multisite && $this-&gt;model-&gt;getValue('ms_allow_admin_toggle_signup_confirmation'))) && WYSIJA::current_user_can('switch_themes')) {&nbsp;</div></li><li><div>                    return true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function main($data) {&nbsp;</div></li><li><div>        $is_multisite = is_multisite();&nbsp;</div></li><li><div>        $is_network_admin = WYSIJA::current_user_can('manage_network');&nbsp;</div></li><li><div>        //$is_network_admin=$is_multisite=true;//PROD comment that line&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($is_multisite && $is_network_admin) {&nbsp;</div></li><li><div>            add_filter('wysija_extend_settings', array( $this, 'ms_tab_name' ), 12);&nbsp;</div></li><li><div>            add_filter('wysija_extend_settings_content', array( $this, 'ms_tab_content' ), 12, 2);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check for debug&nbsp;</div></li><li><div>        if (isset($_REQUEST['wysija_debug'])) {&nbsp;</div></li><li><div>            switch ((int)$_REQUEST['wysija_debug']) {&nbsp;</div></li><li><div>                // turn off debug&nbsp;</div></li><li><div>                case 0:&nbsp;</div></li><li><div>                    WYSIJA::update_option('debug_on', false);&nbsp;</div></li><li><div>                    WYSIJA::update_option('debug_new', false);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // turn on debug (with debug level as value)&nbsp;</div></li><li><div>                case 1:&nbsp;</div></li><li><div>                case 2:&nbsp;</div></li><li><div>                case 3:&nbsp;</div></li><li><div>                case 4:&nbsp;</div></li><li><div>                case 99:&nbsp;</div></li><li><div>                    WYSIJA::update_option('debug_on', true);&nbsp;</div></li><li><div>                    WYSIJA::update_option('debug_new', (int)$_REQUEST['wysija_debug']);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo $this-&gt;messages();&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div id=&quot;wysija-config&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php $this-&gt;tabs(); ?&gt;&nbsp;</div></li><li><div>            &lt;form name=&quot;wysija-settings&quot; method=&quot;post&quot; id=&quot;wysija-settings&quot; action=&quot;&quot; class=&quot;form-valid&quot; autocomplete=&quot;off&quot;&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;basics&quot; class=&quot;wysija-panel hidden&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php $this-&gt;basics(); ?&gt;&nbsp;</div></li><li><div>                    &lt;p class=&quot;submit&quot;&gt;&nbsp;</div></li><li><div>                        &lt;input type=&quot;submit&quot; value=&quot;&lt;?php echo esc_attr(__('Save settings', WYSIJA)); ?&gt;&quot; class=&quot;button-primary wysija&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;/p&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;forms&quot; class=&quot;wysija-panel hidden&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php /** if(WYSIJA::is_wysija_admin()) */ $this-&gt;form_list(); ?&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;div id=&quot;signupconfirmation&quot; class=&quot;wysija-panel hidden&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php $this-&gt;signupconfirmation(); ?&gt;&nbsp;</div></li><li><div>                    &lt;p class=&quot;submit&quot;&gt;&nbsp;</div></li><li><div>                        &lt;input type=&quot;submit&quot; value=&quot;&lt;?php echo esc_attr(__('Save settings', WYSIJA)); ?&gt;&quot; class=&quot;button-primary wysija&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;/p&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                if ($this-&gt;_user_can('change_sending_method')) {&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;div id=&quot;sendingmethod&quot; class=&quot;wysija-panel hidden&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php $this-&gt;sendingmethod(); ?&gt;&nbsp;</div></li><li><div>                        &lt;p class=&quot;submit&quot;&gt;&nbsp;</div></li><li><div>                            &lt;input type=&quot;submit&quot; value=&quot;&lt;?php echo esc_attr(__('Save settings', WYSIJA)); ?&gt;&quot; class=&quot;button-primary wysija&quot; /&gt;&nbsp;</div></li><li><div>                        &lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;div id=&quot;advanced&quot; class=&quot;wysija-panel hidden&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php $this-&gt;advanced($data); ?&gt;&nbsp;</div></li><li><div>                    &lt;p class=&quot;submit&quot;&gt;&nbsp;</div></li><li><div>                        &lt;input type=&quot;submit&quot; value=&quot;&lt;?php echo esc_attr(__('Save settings', WYSIJA)); ?&gt;&quot; class=&quot;button-primary wysija&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;/p&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;div id=&quot;add-ons&quot; class=&quot;wysija-panel hidden&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php $this-&gt;add_ons(); ?&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                echo apply_filters('wysija_extend_settings_content', '', array( 'viewObj' =&gt; &$this ));&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php $this-&gt;secure(array( 'action' =&gt; &quot;save&quot; )); ?&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;hidden&quot; value=&quot;save&quot; name=&quot;action&quot; /&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;hidden&quot; value=&quot;&quot; name=&quot;redirecttab&quot; id=&quot;redirecttab&quot; /&gt;&nbsp;</div></li><li><div>            &lt;/form&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function basics() {&nbsp;</div></li><li><div>        $step = array( );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['company_address'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'textarea', &nbsp;</div></li><li><div>            'label' =&gt; __(&quot;Your company's address&quot;, WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __(&quot;The address will be added to your newsletter's footer. This helps avoid spam filters.&quot;, WYSIJA), &nbsp;</div></li><li><div>            'rows' =&gt; &quot;3&quot;, &nbsp;</div></li><li><div>            'cols' =&gt; &quot;40&quot;, );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['emails_notified'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'email_notifications', &nbsp;</div></li><li><div>            'label' =&gt; __('Email notifications', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Enter the email addresses that should receive notifications (separate by comma).', WYSIJA) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['from_name'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'fromname', &nbsp;</div></li><li><div>            'class' =&gt; 'validate[required]', &nbsp;</div></li><li><div>            'label' =&gt; __('Sender of notifications', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Choose a FROM name and email address for notifications emails.', WYSIJA) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['commentform'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'commentform', &nbsp;</div></li><li><div>            'label' =&gt; __('Subscribe in comments', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Visitors who submit a comment on a post can click on a checkbox to subscribe.', WYSIJA), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $showregisteroption = true;&nbsp;</div></li><li><div>        //this option is only available for the main site&nbsp;</div></li><li><div>        if (is_multisite()) {&nbsp;</div></li><li><div>                    $mpoet_allow_register_option_on_all_sites = false;&nbsp;</div></li><li><div>                    $mpoet_allow_register_option_on_all_sites = apply_filters( 'mpoet_allow_register_option_on_all_sites', $mpoet_allow_register_option_on_all_sites );&nbsp;</div></li><li><div>                    if( $mpoet_allow_register_option_on_all_sites === false && !is_main_site() ) {&nbsp;</div></li><li><div>                        $showregisteroption = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($showregisteroption) {&nbsp;</div></li><li><div>            $step ['registerform'] = array(&nbsp;</div></li><li><div>                'type' =&gt; 'commentform', &nbsp;</div></li><li><div>                'label' =&gt; __('Subscribe in registration form', WYSIJA), &nbsp;</div></li><li><div>                'desc' =&gt; __('Allow users who register to your site to subscribe on a list of your choice.', WYSIJA)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $modelU = WYSIJA::get('user', 'model');&nbsp;</div></li><li><div>        $objUser = $modelU-&gt;getCurrentSubscriber();&nbsp;</div></li><li><div>        $step['viewinbrowser'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'viewinbrowser', &nbsp;</div></li><li><div>            'label' =&gt; __('Link to browser version', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Displays at the top of your newsletters. Don\'t forget to include the link tag, ie: [link]The link[/link]', WYSIJA), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['unsubscribe_linkname'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'input', &nbsp;</div></li><li><div>            'label' =&gt; __('Text of &quot;Unsubscribe&quot; link', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('This changes the label for the unsubscribe link in the footer of your newsletters.', WYSIJA) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['unsubscribe_page'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'page_selection', &nbsp;</div></li><li><div>            'label' =&gt; __('Unsubscribe page', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('A subscriber is directed to a page of your choice after clicking on the unsubscribe link, at the bottom of a newsletter.', WYSIJA), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $model_config = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>            &lt;tbody&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                do_action('mailpoet_pre_config_screen');&nbsp;</div></li><li><div>                echo $this-&gt;buildMyForm($step, $model_config-&gt;values, 'config');&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>            &lt;/tbody&gt;&nbsp;</div></li><li><div>        &lt;/table&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function signupconfirmation() {&nbsp;</div></li><li><div>        $step = array( );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['confirm_dbleoptin'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'radio', &nbsp;</div></li><li><div>            'values' =&gt; array( true =&gt; __('Yes', WYSIJA), false =&gt; __('No', WYSIJA) ), &nbsp;</div></li><li><div>            'label' =&gt; __('Enable signup confirmation', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Prevent people from being subscribed to your list unwillingly, this option ensures you to keep a clean list.', WYSIJA).' &lt;a href=&quot;http://support.mailpoet.com/knowledgebase/why-you-should-enforce-email-activation/?utm_source=wpadmin&utm_campaign=activation email&quot; target=&quot;_blank&quot;&gt;'.__('Learn more.', WYSIJA).'&lt;/a&gt;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!$this-&gt;_user_can('toggle_signup_confirmation')) {&nbsp;</div></li><li><div>            $step['confirm_dbleoptin']['type'] = 'disabled_radio';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['confirm_email_title'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'input', &nbsp;</div></li><li><div>            'label' =&gt; __('Email subject', WYSIJA), &nbsp;</div></li><li><div>            'rowclass' =&gt; 'confirmemail' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['confirm_email_body'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'textarea', &nbsp;</div></li><li><div>            'label' =&gt; __('Email content', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Don\'t forget to include: &lt;br&gt;&lt;br&gt;[activation_link]Confirm your subscription.[/activation_link]. &lt;br&gt;&lt;br&gt;Optional: [lists_to_confirm].', WYSIJA), &nbsp;</div></li><li><div>            'rowclass' =&gt; 'confirmemail' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $step['confirmation_page'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'page_selection', &nbsp;</div></li><li><div>            'label' =&gt; __('Confirmation page', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('When subscribers click on the activation link, they are redirected to a page of your choice.', WYSIJA), &nbsp;</div></li><li><div>            'rowclass' =&gt; 'confirmemail' );&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>            &lt;tbody&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                echo $this-&gt;buildMyForm($step, '', 'config');&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>            &lt;/tbody&gt;&nbsp;</div></li><li><div>        &lt;/table&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function sendingmethod() {&nbsp;</div></li><li><div>        $key = 'sending_method';&nbsp;</div></li><li><div>        $realvalue = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>        // Since 2.6.12, remove gmail and use stmp instead&nbsp;</div></li><li><div>        if ($realvalue == 'gmail')&nbsp;</div></li><li><div>            $realvalue = 'smtp';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $helper_forms = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $current_user = WYSIJA::wp_get_userdata();&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;table class=&quot;form-table&quot; id=&quot;ms-sendingmethod&quot;&gt;&nbsp;</div></li><li><div>            &lt;tbody&gt;&nbsp;</div></li><li><div>                &lt;tr class=&quot;methods&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    $is_multisite = is_multisite();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (is_multisite()) {&nbsp;</div></li><li><div>                        $field = '&lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        $value = 'network';&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>                        if ($value == $realvalue) {&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $field .= '&lt;label for=&quot;'.$id.'&quot; class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>                        $field .= $helper_forms-&gt;radio(&nbsp;</div></li><li><div>                                array(&nbsp;</div></li><li><div>                            'id' =&gt; $id, &nbsp;</div></li><li><div>                            'class' =&gt; 'mailpoet-delivery-method', &nbsp;</div></li><li><div>                            'name' =&gt; 'wysija[config]['.$key.']', &nbsp;</div></li><li><div> ), $value, $checked&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        $field .= '&lt;h3&gt;'.__('Network\'s Method', WYSIJA).'&lt;/h3&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>                        $field .= '&lt;p&gt;'.__('Method set by the network admin.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>                        if (!$this-&gt;model-&gt;getValue('ms_sending_emails_ok')) {&nbsp;</div></li><li><div>                            $field .= '&lt;strong'.__('Not Configured!', WYSIJA).'&lt;/strong&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $field .= '&lt;/th&gt;';&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        $value = 'site';&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>                        if ($value == $realvalue)&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot; class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>                        $field.=$helper_forms-&gt;radio(array( &quot;id&quot; =&gt; $id, 'class' =&gt; 'mailpoet-delivery-method', 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>                        $field.='&lt;h3&gt;'.__('Your own website', WYSIJA).'&lt;/h3&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>                        $field.='&lt;p&gt;'.__('The simplest solution for small lists. Your web host sets a daily email limit.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        $value = 'smtp';&nbsp;</div></li><li><div>                        if ($value === $realvalue)&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot; class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>                        $field.= $helper_forms-&gt;radio(array( 'id' =&gt; $id, 'class' =&gt; 'mailpoet-delivery-method', 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>                        $field.= '&lt;h3&gt;'.__('Third party', WYSIJA).'&lt;/h3&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>                        $field.='&lt;p&gt;'.__('Send with a professional SMTP provider, a great choice for big and small lists. We\'ve negotiated promotional offers with a few providers for you.', WYSIJA).' &lt;a href=&quot;http://support.mailpoet.com/knowledgebase/send-with-smtp-when-using-a-professional-sending-provider/?utm_source=wpadmin&utm_campaign=sending method&quot; target=&quot;_blank&quot;&gt;'.__('Read more', WYSIJA).'&lt;/a&gt;.&lt;/p&gt;';&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;tr class=&quot;hidechoice choice-sending-method-site&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $field = __('Delivery method', WYSIJA);&nbsp;</div></li><li><div>                        $field.='&lt;p class=&quot;description&quot;&gt;'.__('Send yourself some test emails to confirm which method works with your server.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $key = &quot;sending_emails_site_method&quot;;&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        $realvalue = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>                        $value = &quot;phpmail&quot;;&nbsp;</div></li><li><div>                        if ($value == $realvalue)&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $id = str_replace(&quot;_&quot;, '-', $key).'-'.$value;&nbsp;</div></li><li><div>                        $field = '&lt;p class=&quot;title&quot;&gt;&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>                        $field.=$helper_forms-&gt;radio(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>                        $field.='PHP Mail&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>                        $field.='&lt;p class=&quot;description&quot;&gt;'.__('This email engine works on 95&#37; of servers', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $value = &quot;sendmail&quot;;&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        if ($value == $realvalue)&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $id = str_replace(&quot;_&quot;, '-', $key).'-'.$value;&nbsp;</div></li><li><div>                        $field.='&lt;p class=&quot;title&quot;&gt;&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>                        $field.=$helper_forms-&gt;radio(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>                        $field.='Sendmail&lt;/label&gt;';&nbsp;</div></li><li><div>                        $field.='&lt;p class=&quot;description&quot;&gt;'.__('This method works on 5&#37; of servers', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $id = str_replace(&quot;_&quot;, '-', $key).'-'.$value.&quot;-path&quot;;&nbsp;</div></li><li><div>                        $field.='&lt;p class=&quot;title&quot; id=&quot;p-'.$id.'&quot;&gt;&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>                        $field.=__(&quot;Sendmail path&quot;, WYSIJA).'&lt;/label&gt;'.$helper_forms-&gt;input(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config][sendmail_path]' ), $this-&gt;model-&gt;getValue(&quot;sendmail_path&quot;)).'&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($this-&gt;model-&gt;getValue('allow_wpmail')) {&nbsp;</div></li><li><div>                            $checked = false;&nbsp;</div></li><li><div>                            $value = 'wpmail';&nbsp;</div></li><li><div>                            if ($value == $realvalue)&nbsp;</div></li><li><div>                                $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>                            $field.='&lt;p class=&quot;title&quot;&gt;&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>                            $field.=$helper_forms-&gt;radio(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>                            $field.='WP Mail&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>                            $field.='&lt;p class=&quot;description&quot;&gt;'.__('Use the same method as the one used for your WP site.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;tr class=&quot;hidechoice choice-sending-method-smtp&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $key = &quot;smtp_host&quot;;&nbsp;</div></li><li><div>                        $id = str_replace(&quot;_&quot;, '-', $key);&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('SMTP Hostname', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>                        $field.='&lt;p class=&quot;description&quot;&gt;'.__('e.g.:smtp.mydomain.com', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $value = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>                        $field = $helper_forms-&gt;input(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '40' ), $value, $checked);&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>                &lt;tr class=&quot;hidechoice choice-sending-method-smtp choice-sending-method-gmail&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $key = &quot;smtp_login&quot;;&nbsp;</div></li><li><div>                        $id = str_replace(&quot;_&quot;, '-', $key);&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('Login', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $value = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>                        $field = $helper_forms-&gt;input(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '40' ), $value, $checked);&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>                &lt;tr class=&quot;hidechoice choice-sending-method-smtp choice-sending-method-gmail&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $key = &quot;smtp_password&quot;;&nbsp;</div></li><li><div>                        $id = str_replace(&quot;_&quot;, '-', $key);&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('Password', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $value = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>                        $field = $helper_forms-&gt;input(array( &quot;type&quot; =&gt; &quot;password&quot;, &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '40' ), $value, $checked);&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>                &lt;tr id=&quot;restapipossible&quot; class=&quot;hidechoice&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $key = 'smtp_rest';&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $key);&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;web API&lt;/label&gt;';&nbsp;</div></li><li><div>                        $field.='&lt;p class=&quot;description&quot;&gt;'.__('Activate if your SMTP ports are blocked.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $value = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        if ($this-&gt;model-&gt;getValue('smtp_rest'))&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>                        $field = $helper_forms-&gt;checkbox(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '3' ), 1, $checked);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;tr class=&quot;hidechoice choice-sending-method-smtp choice-no-restapi&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $key = 'smtp_port';&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $key);&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('SMTP port', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $value = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>                        $field = $helper_forms-&gt;input(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '3' ), $value, $checked);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;tr class=&quot;hidechoice choice-sending-method-smtp choice-no-restapi&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $key = &quot;smtp_secure&quot;;&nbsp;</div></li><li><div>                        $id = str_replace(&quot;_&quot;, '-', $key);&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('Secure connection', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $value = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $field = $helper_forms-&gt;dropdown(array( 'name' =&gt; 'wysija[config]['.$key.']', &quot;id&quot; =&gt; $id ), array( false =&gt; __(&quot;No&quot;), &quot;ssl&quot; =&gt; &quot;SSL&quot;, &quot;tls&quot; =&gt; &quot;TLS&quot; ), $value);&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;tr class=&quot;hidechoice choice-sending-method-smtp choice-no-restapi&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $field = __('Authentication', WYSIJA);&nbsp;</div></li><li><div>                        echo $field.'&lt;p class=&quot;description&quot;&gt;'.__(&quot;Leave this option to Yes. Only a tiny portion of SMTP services ask Authentication to be turned off.&quot;, WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $key = 'smtp_auth';&nbsp;</div></li><li><div>                        $realvalue = $this-&gt;model-&gt;getValue($key);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $value = false;&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        if ($value == $realvalue)&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>                        $field.=$helper_forms-&gt;radio(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>                        $field.=__('No', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $value = true;&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        if ($value == $realvalue)&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>                        $field.='&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>                        $field.=$helper_forms-&gt;radio(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>                        $field.=__('Yes', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $value = false;&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        if ($value == $realvalue)&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>                        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>                        $field.=$helper_forms-&gt;radio(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>                        $field.=__('No', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $value = true;&nbsp;</div></li><li><div>                        $checked = false;&nbsp;</div></li><li><div>                        if ($value == $realvalue)&nbsp;</div></li><li><div>                            $checked = true;&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>                        $field.='&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>                        $field.=$helper_forms-&gt;radio(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>                        $field.=__('Yes', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;tr class=&quot;hidechoice choice-sending-method-smtp choice-sending-method-site choice-sending-method-gmail choice-sending-method-network&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php _e('Test method'); ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;&lt;?php echo ( is_multisite() ? 3 : 2 ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                        &lt;input type=&quot;text&quot; value=&quot;&lt;?php echo esc_attr($current_user-&gt;data-&gt;user_email); ?&gt;&quot; class=&quot;mailpoet-test-emails&quot; name=&quot;wysija[config][test_mails]&quot; /&gt;&nbsp;</div></li><li><div>                        &lt;a class=&quot;button-secondary mailpoet-test-delivery&quot;&gt;&lt;?php _e('Send a test mail', WYSIJA); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;tr class=&quot;hidechoice choice-sending-method-smtp choice-sending-method-site choice-sending-method-gmail&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $field = __('Send...', WYSIJA);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        echo $field.'&lt;p class=&quot;description&quot;&gt;'.str_replace(array( '[link]', '[/link]' ), array( '&lt;a href=&quot;http://support.mailpoet.com/knowledgebase/wp-cron-batch-emails-sending-frequency/?utm_source=wpadmin&utm_campaign=choosing%20frequency&quot; target=&quot;_blank&quot;&gt;', '&lt;/a&gt;' ), __('Your web host has limits. We suggest 70 emails per hour to be safe. [link]Find out more[/link].', WYSIJA)).'&lt;/p&gt;';&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;&lt;?php echo ( is_multisite() ? 3 : 2 ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $name = 'sending_emails_number';&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $name);&nbsp;</div></li><li><div>                        $value = $this-&gt;model-&gt;getValue($name);&nbsp;</div></li><li><div>                        $params = array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$name.']', 'size' =&gt; '6' );&nbsp;</div></li><li><div>                        //if($this-&gt;model-&gt;getValue(&quot;smtp_host&quot;)==&quot;smtp.gmail.com&quot;) $params[&quot;readonly&quot;]=&quot;readonly&quot;;&nbsp;</div></li><li><div>                        $field = $helper_forms-&gt;input($params, $value);&nbsp;</div></li><li><div>                        $field.= '&lt;span class=&quot;mailpoet-frequency_inner_texting&quot;&gt;'.__('emails', WYSIJA).'&lt;/span&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $name = 'sending_emails_each';&nbsp;</div></li><li><div>                        $id = str_replace('_', '-', $name);&nbsp;</div></li><li><div>                        $value = $this-&gt;model-&gt;getValue($name);&nbsp;</div></li><li><div>                        $field .=$helper_forms-&gt;dropdown(array( 'name' =&gt; 'wysija[config]['.$name.']', 'id' =&gt; $id ), $helper_forms-&gt;eachValues, $value);&nbsp;</div></li><li><div>                        echo $field;&nbsp;</div></li><li><div>                        echo '&lt;div class=&quot;mailpoet-frequency_warning hidden&quot;&gt;&lt;b&gt;'.__('This is fast!', WYSIJA).'&lt;/b&gt; '.str_replace(array( '[link]', '[/link]' ), array( '&lt;a href=&quot;http://support.mailpoet.com/knowledgebase/wp-cron-batch-emails-sending-frequency/?utm_source=wpadmin&utm_campaign=cron&quot; target=&quot;_blank&quot;&gt;', '&lt;/a&gt;' ), __('We suggest you setup a cron job. [link]Read more[/link] on support.mailpoet.com', WYSIJA)).'&lt;/span&gt;';&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;/tbody&gt;&nbsp;</div></li><li><div>        &lt;/table&gt;&nbsp;</div></li><li><div>        &lt;script&gt;&nbsp;</div></li><li><div>          wysija_translations = {};&nbsp;</div></li><li><div>          wysija_translations.api = &quot;&lt;?php _e('API Key', WYSIJA); ?&gt;&quot;;&nbsp;</div></li><li><div>          wysija_translations.password = &quot;&lt;?php _e('Password', WYSIJA); ?&gt;&quot;;&nbsp;</div></li><li><div>        &lt;/script&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function clearlog() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;h3&gt;Logs have been cleared&lt;/h3&gt;';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function log() {&nbsp;</div></li><li><div>        $option_log = get_option('wysija_log');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ($option_log as $key =&gt; $data) {&nbsp;</div></li><li><div>            echo '&lt;h3&gt;'.$key.'&lt;/h3&gt;';&nbsp;</div></li><li><div>            dbg($data, 0);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function advanced($data) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $advanced_fields = $super_advanced_fields = array( );&nbsp;</div></li><li><div>        $advanced_fields ['role_campaign'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'capabilities', &nbsp;</div></li><li><div>            '1col' =&gt; 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $advanced_fields['replyto_name'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'fromname', &nbsp;</div></li><li><div>            'class' =&gt; 'validate[required]', &nbsp;</div></li><li><div>            'label' =&gt; __('Reply-to name & email', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('You can change the default reply-to name and email for your newsletters. This option is also used for the activation emails and Admin notifications (in Basics).', WYSIJA) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $helper_licence = WYSIJA::get('licence', 'helper');&nbsp;</div></li><li><div>        $url_checkout = $helper_licence-&gt;get_url_checkout('bounce_address_automated');&nbsp;</div></li><li><div>        $advanced_fields ['bounce_email'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'input', &nbsp;</div></li><li><div>            'label' =&gt; __('Bounce Email', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('To which address should all the bounced emails go? Get the [link]Premium version[/link] to automatically handle these.', WYSIJA), &nbsp;</div></li><li><div>            'link' =&gt; '&lt;a href=&quot;'.$url_checkout.'&quot; target=&quot;_blank&quot; title=&quot;'.__('Purchase the premium version.', WYSIJA).'&quot;&gt;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $advanced_fields = apply_filters('wysija_settings_advanced', $advanced_fields);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $modelU = WYSIJA::get('user', 'model');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $advanced_fields ['manage_subscriptions'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'managesubscribe', &nbsp;</div></li><li><div>            'label' =&gt; __('Subscribers can edit their profile', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Add a link in the footer of all your newsletters so subscribers can edit their profile and lists. [link]See your own subscriber profile page.[/link]', WYSIJA), &nbsp;</div></li><li><div>            'link' =&gt; '&lt;a href=&quot;'.$modelU-&gt;getConfirmLink(false, 'subscriptions', false, true).'&quot; target=&quot;_blank&quot; title=&quot;'.__('Preview page', WYSIJA).'&quot;&gt;', );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $advanced_fields['subscriptions_page'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'page_selection', &nbsp;</div></li><li><div>            'label' =&gt; __('Subscriber profile page', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Select the page to display the subscriber\'s profile.', WYSIJA), &nbsp;</div></li><li><div>            'rowclass' =&gt; 'manage_subscriptions', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $advanced_fields ['html_source'] = array(&nbsp;</div></li><li><div>            'label' =&gt; __('Allow HTML edits', WYSIJA), &nbsp;</div></li><li><div>            'type' =&gt; 'radio', &nbsp;</div></li><li><div>            'values' =&gt; array( true =&gt; __('Yes', WYSIJA), false =&gt; __('No', WYSIJA) ), &nbsp;</div></li><li><div>            'desc' =&gt; __('This allows you to modify the HTML of text blocks in the visual editor.', WYSIJA)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $advanced_fields ['analytics'] = array(&nbsp;</div></li><li><div>            'rowclass' =&gt; 'analytics', &nbsp;</div></li><li><div>            'type' =&gt; 'radio', &nbsp;</div></li><li><div>            'values' =&gt; array( true =&gt; __('Yes', WYSIJA), false =&gt; __('No', WYSIJA) ), &nbsp;</div></li><li><div>            'label' =&gt; __('Share anonymous data', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Share anonymous data and help us improve the plugin. [link]Read more[/link].', WYSIJA), &nbsp;</div></li><li><div>            'link' =&gt; '&lt;a target=&quot;_blank&quot; href=&quot;http://support.mailpoet.com/knowledgebase/share-your-data/?utm_source=wpadmin&utm_campaign=advanced_settings&quot;&gt;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $advanced_fields ['industry'] = array(&nbsp;</div></li><li><div>            'rowclass' =&gt; 'industry', &nbsp;</div></li><li><div>            'type' =&gt; 'dropdown_keyval', &nbsp;</div></li><li><div>            'values' =&gt; array(&nbsp;</div></li><li><div>                'other' =&gt; __('other', WYSIJA), &nbsp;</div></li><li><div>                'art' =&gt; __('art', WYSIJA), &nbsp;</div></li><li><div>                'business' =&gt; __('business', WYSIJA), &nbsp;</div></li><li><div>                'education' =&gt; __('education', WYSIJA), &nbsp;</div></li><li><div>                'e-commerce' =&gt; __('e-commerce', WYSIJA), &nbsp;</div></li><li><div>                'food' =&gt; __('food', WYSIJA), &nbsp;</div></li><li><div>                'insurance' =&gt; __('insurance', WYSIJA), &nbsp;</div></li><li><div>                'government' =&gt; __('government', WYSIJA), &nbsp;</div></li><li><div>                'health and sports' =&gt; __('health and sports', WYSIJA), &nbsp;</div></li><li><div>                'manufacturing' =&gt; __('manufacturing', WYSIJA), &nbsp;</div></li><li><div>                'marketing and media' =&gt; __('marketing and media', WYSIJA), &nbsp;</div></li><li><div>                'non profit' =&gt; __('non profit', WYSIJA), &nbsp;</div></li><li><div>                'photography' =&gt; __('photography', WYSIJA), &nbsp;</div></li><li><div>                'travel' =&gt; __('travel', WYSIJA), &nbsp;</div></li><li><div>                'real estate' =&gt; __('real estate', WYSIJA), &nbsp;</div></li><li><div>                'religious' =&gt; __('religious', WYSIJA), &nbsp;</div></li><li><div>                'technology' =&gt; __('technology', WYSIJA)&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'label' =&gt; __('Industry', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Select your industry.', WYSIJA) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $super_advanced_fields ['subscribers_count'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'subscribers_count', &nbsp;</div></li><li><div>            'label' =&gt; __('Shortcode to display total number of subscribers', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Paste this shortcode to display the number of confirmed subscribers in post or page.', WYSIJA)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $super_advanced_fields ['advanced_charset'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'dropdown_keyval', &nbsp;</div></li><li><div>            'values' =&gt; array( 'UTF-8', 'UTF-7', 'BIG5', 'ISO-2022-JP', &nbsp;</div></li><li><div>                'ISO-8859-1', 'ISO-8859-2', 'ISO-8859-3', &nbsp;</div></li><li><div>                'ISO-8859-4', 'ISO-8859-5', 'ISO-8859-6', &nbsp;</div></li><li><div>                'ISO-8859-7', 'ISO-8859-8', 'ISO-8859-9', &nbsp;</div></li><li><div>                'ISO-8859-10', 'ISO-8859-13', 'ISO-8859-14', &nbsp;</div></li><li><div>                'ISO-8859-15', 'Windows-1251', 'Windows-1252' ), &nbsp;</div></li><li><div>            'label' =&gt; __('Charset', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Squares or weird characters are displayed in your emails? Select the encoding for your language.', WYSIJA) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $super_advanced_fields = apply_filters('wysija_settings_advancednext', $super_advanced_fields);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $super_advanced_fields ['cron_manual'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'cron', &nbsp;</div></li><li><div>            'label' =&gt; __('Enable MailPoet\'s Cron', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('None of your queued emails have been sent? Then activate this option.', WYSIJA) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $super_advanced_fields ['debug_new'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'debugnew', &nbsp;</div></li><li><div>            'label' =&gt; __('Debug mode', WYSIJA), &nbsp;</div></li><li><div>            'desc' =&gt; __('Enable this to show MailPoet\'s errors. Our support might ask you to enable this if you seek their help.', WYSIJA) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (WYSIJA_DBG &gt; 1) {&nbsp;</div></li><li><div>            $advanced_fields ['debug_log'] = array(&nbsp;</div></li><li><div>                'type' =&gt; 'debuglog', &nbsp;</div></li><li><div>                'label' =&gt; 'Logs', &nbsp;</div></li><li><div>                'desc' =&gt; str_replace(array( '[link]', '[linkclear]', '[/link]', '[/linkclear]' ), array( '&lt;a href=&quot;admin.php?page=wysija_config&action=log&quot; target=&quot;_blank&quot;&gt;', '&lt;a target=&quot;_blank&quot; href=&quot;admin.php?page=wysija_config&action=clearlog&_wpnonce='.$this-&gt;secure(array( 'action' =&gt; 'clearlog' ), true).'&quot;&gt;', '&lt;/a&gt;', '&lt;/a&gt;' ), 'View them [link]here[/link]. Clear them [linkclear]here[/linkclear]') );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //attach 'super-advanced' class to super_advanced_fields&nbsp;</div></li><li><div>        $super_advanced_field_class = 'super-advanced';&nbsp;</div></li><li><div>        foreach ($super_advanced_fields as $key =&gt; $field) {&nbsp;</div></li><li><div>            if (!empty($super_advanced_fields[$key]['rowclass']))&nbsp;</div></li><li><div>                $super_advanced_fields[$key]['rowclass'] = $super_advanced_fields[$key]['rowclass'].' '.$super_advanced_field_class;&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $super_advanced_fields[$key]['rowclass'] = $super_advanced_field_class;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>            &lt;tbody&gt;&nbsp;</div></li><li><div>                &lt;?php echo $this-&gt;buildMyForm($advanced_fields, '', 'config'); ?&gt;&nbsp;</div></li><li><div>                &lt;tr class='title_row'&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;&nbsp;</div></li><li><div>                        &lt;h3 class='title' alt='&lt;?php esc_attr_e('Do or do not. There is no try.', WYSIJA); ?&gt;'&gt;&nbsp;</div></li><li><div>                            &lt;?php _e(&quot;Geeky Options&quot;, WYSIJA); ?&gt;&nbsp;</div></li><li><div>                            &lt;a href='#geeky_options' alt='&lt;?php esc_attr_e(&quot;Toggle Geeky Options&quot;, WYSIJA); ?&gt;' data-hide='&lt;?php esc_attr_e(&quot;Hide&quot;, WYSIJA); ?&gt;' class='add-new-h2 mailpoet-geeky-toggle is_toggled'&gt;&lt;?php esc_attr_e(&quot;Show&quot;, WYSIJA); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                        &lt;/h3&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>                &lt;?php if (!empty($data['hooks']['hook_settings_super_advanced'])) echo $data['hooks']['hook_settings_super_advanced']; ?&gt;&nbsp;</div></li><li><div>                &lt;?php echo $this-&gt;buildMyForm($super_advanced_fields, '', 'config'); ?&gt;&nbsp;</div></li><li><div>                &lt;?php if (current_user_can('delete_plugins')): ?&gt;&nbsp;</div></li><li><div>                    &lt;tr class=&quot;&lt;?php echo $super_advanced_field_class ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                        &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;label&quot;&gt;&lt;?php _e('Reinstall from scratch', WYSIJA) ?&gt;&nbsp;</div></li><li><div>                    &lt;p class=&quot;description&quot;&gt;&lt;?php _e('Want to start all over again? This will wipe out MailPoet and reinstall anew.', WYSIJA) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/th&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;p&gt;&nbsp;</div></li><li><div>                    &lt;a class=&quot;button&quot; href=&quot;admin.php?page=wysija_config&action=reinstall&quot;&gt;&lt;?php _e('Reinstall now...', WYSIJA); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                &lt;/p&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;?php endif ?&gt;&nbsp;</div></li><li><div>        &lt;/tbody&gt;&nbsp;</div></li><li><div>        &lt;/table&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add-ons Manager developed by Sebs Studio&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function add_ons() {&nbsp;</div></li><li><div>        include_once(WYSIJA_DIR.'/add-ons/add-ons.php');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * filter adding its own tab to wysija's config(this deals with the name of the tab)&nbsp;</div></li><li><div>     * @param string $tabs&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function ms_tab_name($tabs) {&nbsp;</div></li><li><div>        $tabs['multisite'] = 'MS';&nbsp;</div></li><li><div>        return $tabs;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * filter adding its own tab to wysija's config (this deals with the content of the tab)&nbsp;</div></li><li><div>     * @param type $htmlContent&nbsp;</div></li><li><div>     * @param type $arg&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function ms_tab_content($htmlContent, $arg) {&nbsp;</div></li><li><div>        $this-&gt;viewObj = $arg['viewObj'];&nbsp;</div></li><li><div>        $mConfig = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        $formsHelp = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $htmlContent .='&lt;div id=&quot;multisite&quot; class=&quot;wysija-panel hidden&quot;&gt;'; //start multisite div&nbsp;</div></li><li><div>        $htmlContent.= '&lt;div class=&quot;intro&quot;&gt;&lt;h3&gt;'.__('Pick your prefered configuration?', WYSIJA).'&lt;/h3&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $htmlContent.= '&lt;table class=&quot;form-table&quot; id=&quot;form-ms-config&quot;&gt;&nbsp;</div></li><li><div>            &lt;tbody&gt;&nbsp;</div></li><li><div>                &lt;tr class=&quot;methods&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        $key = 'ms_sending_config';&nbsp;</div></li><li><div>        $realvalue = $mConfig-&gt;getValue($key);&nbsp;</div></li><li><div>        $value = 'one-for-all';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>        if ($value == $realvalue)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot; class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;radio(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>        $field.='&lt;p class=&quot;title&quot;&gt;&lt;strong&gt;'.__('One configuration for all sites', WYSIJA).'&lt;/strong&gt;&lt;/p&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>        $field.='&lt;p&gt;'.__('Enforce all sites to send with a unique FROM email address. You only need to configure the Automated Bounce Handling (Premium), SPF & DKIM only once.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        $field.='&lt;p&gt;'.__('Users can still change their reply-to address for their newsletter. Network admins can still edit sending method for each site.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        $htmlContent.= $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $htmlContent.= '&lt;/th&gt;&lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        $value = 'one-each';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>        if ($value == $realvalue)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot; class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$formsHelp-&gt;radio(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>        $field.='&lt;p class=&quot;title&quot;&gt;&lt;strong&gt;'.__('Configure each site manually', WYSIJA).'&lt;/strong&gt;&lt;/p&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>        $field.='&lt;p&gt;'.__('Configure SPF and DKIM independently for each site.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        $htmlContent.= $field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $htmlContent.= '&lt;/th&gt;&lt;td&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $htmlContent.='&lt;/tbody&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $htmlContent.='&lt;div class=&quot;intro&quot;&gt;&lt;h3&gt;'.__('Configuration and Permissions', WYSIJA).'&lt;/h3&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = array( );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields['ms_allow_admin_sending_method'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'debug', &nbsp;</div></li><li><div>            'label' =&gt; __('Allow site admins to change the sending method', WYSIJA) );&nbsp;</div></li><li><div>        $fields['ms_allow_admin_toggle_signup_confirmation'] = array(&nbsp;</div></li><li><div>            'type' =&gt; 'debug', &nbsp;</div></li><li><div>            'label' =&gt; __('Allow site admins to deactivate Signup Confirmation', WYSIJA) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $htmlContent.='&lt;table class=&quot;form-table&quot;&gt;&lt;tbody&gt;';&nbsp;</div></li><li><div>        $htmlContent.=$this-&gt;viewObj-&gt;buildMyForm($fields, '', 'config');&nbsp;</div></li><li><div>        $htmlContent.='&lt;/tbody&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $htmlContent.='&lt;div class=&quot;intro&quot;&gt;&lt;h3&gt;'.__('Network\'s Default Sending Method', WYSIJA).'&lt;/h3&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>        $htmlContent.=$this-&gt;ms_sending_method();&nbsp;</div></li><li><div>        if (false) {&nbsp;</div></li><li><div>            $htmlContent.= '&lt;div class=&quot;intro&quot;&gt;&lt;h3&gt;'.__('SPF and DKIM', WYSIJA).'&lt;/h3&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $htmlContent.= '&lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>                &lt;tbody&gt;&nbsp;</div></li><li><div>                    &lt;tr class=&quot;methods&quot;&gt;&nbsp;</div></li><li><div>                        &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $htmlContent.='&lt;p&gt;'.__('Your SPF record', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $htmlContent.= '&lt;/th&gt;';&nbsp;</div></li><li><div>            $htmlContent.= '&lt;th scope=&quot;row&quot;&gt;&lt;/th&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $htmlContent.='&lt;/tbody&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $htmlContent .='&lt;p class=&quot;submit&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;'.esc_attr(__('Save settings', WYSIJA)).'&quot; class=&quot;button-primary wysija&quot; /&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        $htmlContent.='&lt;/div&gt;'; //end multisite div&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $htmlContent;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function ms_sending_method() {&nbsp;</div></li><li><div>        $prefix = 'ms_';&nbsp;</div></li><li><div>        $model_config = WYSIJA::get('config', 'model');&nbsp;</div></li><li><div>        $helper_forms = WYSIJA::get('forms', 'helper');&nbsp;</div></li><li><div>        $html_content = '&lt;table class=&quot;form-table&quot; id=&quot;ms-sendingmethod&quot;&gt;&nbsp;</div></li><li><div>            &lt;tbody&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'sending_method';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $realvalue = $model_config-&gt;getValue($key);&nbsp;</div></li><li><div>        $html_content .= '&lt;tr class=&quot;methods&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        $value = 'site';&nbsp;</div></li><li><div>        $id = str_replace(&quot;_&quot;, '-', $key).'-'.$value;&nbsp;</div></li><li><div>        if ($value == $realvalue)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot; class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$helper_forms-&gt;radio(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>        $field.='&lt;h3&gt;'.__('Your own website', WYSIJA).'&lt;/h3&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        $value = 'smtp';&nbsp;</div></li><li><div>        if ($value === $realvalue)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot; class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>        $field.= $helper_forms-&gt;radio(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>        $field.= '&lt;h3&gt;'.__('Third party', WYSIJA).'&lt;/h3&gt;&lt;/label&gt;';&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;td&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'from_email';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key);&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('FROM email address for sites using this method', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>        $html_content.=$helper_forms-&gt;input(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '40' ), $model_config-&gt;getValue($key));&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr class=&quot;ms-hidechoice ms-choice-sending-method-site&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>        $field = __('Delivery method', WYSIJA);&nbsp;</div></li><li><div>        $field.='&lt;p class=&quot;description&quot;&gt;'.__('Send yourself some test emails to confirm which method works with your server.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'sending_emails_site_method';&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        $realvalue = $model_config-&gt;getValue($key);&nbsp;</div></li><li><div>        $value = 'phpmail';&nbsp;</div></li><li><div>        if ($value == $realvalue)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>        $field = '&lt;p class=&quot;title&quot;&gt;&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$helper_forms-&gt;radio(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>        $field.='PHP Mail&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        $field.='&lt;p class=&quot;description&quot;&gt;'.__('This email engine works on 95&#37; of servers', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($model_config-&gt;getValue('allow_wpmail')) {&nbsp;</div></li><li><div>            $checked = false;&nbsp;</div></li><li><div>            $value = 'wpmail';&nbsp;</div></li><li><div>            if ($value == $realvalue)&nbsp;</div></li><li><div>                $checked = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>            $field.='&lt;p class=&quot;title&quot;&gt;&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>            $field.=$helper_forms-&gt;radio(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>            $field.='WP Mail&lt;/label&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>            $field.='&lt;p class=&quot;description&quot;&gt;'.__('Use the same method as the one used for your WP site.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr class=&quot;ms-hidechoice ms-choice-sending-method-smtp&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'smtp_host';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key);&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('SMTP Hostname', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>        $field.='&lt;p class=&quot;description&quot;&gt;'.__('e.g.:smtp.mydomain.com', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&nbsp;</div></li><li><div>                    &lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = $model_config-&gt;getValue($key);&nbsp;</div></li><li><div>        $field = $helper_forms-&gt;input(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '40' ), $value, $checked);&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr class=&quot;ms-hidechoice ms-choice-sending-method-smtp&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'smtp_login';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key);&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('Login', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = $model_config-&gt;getValue($key);&nbsp;</div></li><li><div>        $field = $helper_forms-&gt;input(array( &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '40' ), $value, $checked);&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr class=&quot;ms-hidechoice ms-choice-sending-method-smtp&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'smtp_password';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key);&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('Password', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = $model_config-&gt;getValue($key);&nbsp;</div></li><li><div>        $field = $helper_forms-&gt;input(array( &quot;type&quot; =&gt; &quot;password&quot;, &quot;id&quot; =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '40' ), $value, $checked);&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr id=&quot;ms-restapipossible&quot; class=&quot;hidechoice&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'smtp_rest';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key);&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;web API&lt;/label&gt;';&nbsp;</div></li><li><div>        $field.='&lt;p class=&quot;description&quot;&gt;'.__('Activate if your SMTP ports are blocked.', WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = $model_config-&gt;getValue($key);&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($value)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $field = $helper_forms-&gt;checkbox(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '3' ), 1, $checked);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr class=&quot;ms-hidechoice ms-choice-sending-method-smtp ms-choice-no-restapi&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'smtp_port';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key);&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('SMTP port', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = $model_config-&gt;getValue($key);&nbsp;</div></li><li><div>        $field = $helper_forms-&gt;input(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']', 'size' =&gt; '3' ), $value, $checked);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr class=&quot;ms-hidechoice ms-choice-sending-method-smtp ms-choice-no-restapi&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'smtp_secure';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key);&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;'.__('Secure connection', WYSIJA).&quot;&lt;/label&gt;&quot;;&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = $model_config-&gt;getValue($key);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = $helper_forms-&gt;dropdown(array( 'name' =&gt; 'wysija[config]['.$key.']', &quot;id&quot; =&gt; $id ), array( false =&gt; __(&quot;No&quot;), &quot;ssl&quot; =&gt; &quot;SSL&quot;, &quot;tls&quot; =&gt; &quot;TLS&quot; ), $value);&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr class=&quot;ms-hidechoice ms-choice-sending-method-smtp ms-choice-no-restapi&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = __('Authentication', WYSIJA);&nbsp;</div></li><li><div>        $html_content.=$field.'&lt;p class=&quot;description&quot;&gt;'.__(&quot;Leave this option to Yes. Only a tiny portion of SMTP services ask Authentication to be turned off.&quot;, WYSIJA).'&lt;/p&gt;';&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $key = $prefix.'smtp_auth';&nbsp;</div></li><li><div>        $realvalue = $model_config-&gt;getValue($key);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = false;&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($value == $realvalue)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>        $field = '&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$helper_forms-&gt;radio(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>        $field.=__('No', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $value = true;&nbsp;</div></li><li><div>        $checked = false;&nbsp;</div></li><li><div>        if ($value == $realvalue)&nbsp;</div></li><li><div>            $checked = true;&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $key).'-'.$value;&nbsp;</div></li><li><div>        $field.='&lt;label for=&quot;'.$id.'&quot;&gt;';&nbsp;</div></li><li><div>        $field.=$helper_forms-&gt;radio(array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$key.']' ), $value, $checked);&nbsp;</div></li><li><div>        $field.=__('Yes', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $current_user = wp_get_current_user();&nbsp;</div></li><li><div>        $html_content .=&nbsp;</div></li><li><div>                '&lt;tr class=&quot;ms-hidechoice ms-choice-sending-method-smtp ms-choice-sending-method-site&quot;&gt;'.&nbsp;</div></li><li><div>                '&lt;th scope=&quot;row&quot;&gt;'.&nbsp;</div></li><li><div>                __('Test method').&nbsp;</div></li><li><div>                '&lt;/th&gt;'.&nbsp;</div></li><li><div>                '&lt;td colspan=&quot;'.( is_multisite() ? 3 : 2 ).'&quot;&gt;'.&nbsp;</div></li><li><div>                '&lt;input type=&quot;text&quot; value=&quot;'.esc_attr($current_user-&gt;data-&gt;user_email).'&quot; class=&quot;mailpoet-test-emails&quot; name=&quot;wysija[config][test_mails]&quot; /&gt;'.&nbsp;</div></li><li><div>                '&lt;a class=&quot;button-secondary mailpoet-test-delivery&quot; data-multisite=&quot;'.( is_multisite() ? 'true' : 'false' ).'&quot;&gt;'.esc_attr__('Send a test mail', WYSIJA).'&lt;/a&gt;'.&nbsp;</div></li><li><div>                '&lt;/td&gt;'.&nbsp;</div></li><li><div>                '&lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;tr class=&quot;ms-hidechoice ms-choice-sending-method-smtp ms-choice-sending-method-site&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = __('Send...', WYSIJA);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.=$field.'&lt;p class=&quot;description&quot;&gt;'.str_replace(array( '[link]', '[/link]' ), array( '&lt;a href=&quot;http://support.mailpoet.com/knowledgebase/wp-cron-batch-emails-sending-frequency/?utm_source=wpadmin&utm_campaign=choosing%20frequency&quot; target=&quot;_blank&quot;&gt;', '&lt;/a&gt;' ), __('Your web host has limits. We suggest 70 emails per hour to be safe. [link]Find out more[/link].', WYSIJA)).'&lt;/p&gt;';&nbsp;</div></li><li><div>        $html_content.='&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td colspan=&quot;2&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $name = $prefix.'sending_emails_number';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $name);&nbsp;</div></li><li><div>        $value = $model_config-&gt;getValue($name);&nbsp;</div></li><li><div>        $params = array( 'id' =&gt; $id, 'name' =&gt; 'wysija[config]['.$name.']', 'size' =&gt; '6' );&nbsp;</div></li><li><div>        $field = $helper_forms-&gt;input($params, $value);&nbsp;</div></li><li><div>        $field.= '&nbsp;'.__('emails', WYSIJA).'&nbsp;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $name = $prefix.'sending_emails_each';&nbsp;</div></li><li><div>        $id = str_replace('_', '-', $name);&nbsp;</div></li><li><div>        $value = $model_config-&gt;getValue($name);&nbsp;</div></li><li><div>        $field.=$helper_forms-&gt;dropdown(array( 'name' =&gt; 'wysija[config]['.$name.']', 'id' =&gt; $id ), $helper_forms-&gt;eachValues, $value);&nbsp;</div></li><li><div>        $field.='&lt;span class=&quot;ms-choice-under15&quot;&gt;&lt;b&gt;'.__('This is fast!', WYSIJA).'&lt;/b&gt; '.str_replace(array( '[link]', '[/link]' ), array( '&lt;a href=&quot;http://support.mailpoet.com/knowledgebase/wp-cron-batch-emails-sending-frequency/?utm_source=wpadmin&utm_campaign=cron&quot; target=&quot;_blank&quot;&gt;', '&lt;/a&gt;' ), __('We suggest you setup a cron job. [link]Read more[/link] on support.mailpoet.com', WYSIJA)).'&lt;/span&gt;';&nbsp;</div></li><li><div>        $html_content.=$field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $html_content.='&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>            &lt;/tbody&gt;&nbsp;</div></li><li><div>        &lt;/table&gt;';&nbsp;</div></li><li><div>        return $html_content;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // WYSIJA Form Editor&nbsp;</div></li><li><div>    function form_list() {&nbsp;</div></li><li><div>        $model_forms = WYSIJA::get('forms', 'model');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $forms = $model_forms-&gt;getRows();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get available lists which users can subscribe to&nbsp;</div></li><li><div>        $model_list = WYSIJA::get('list', 'model');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get lists users can subscribe to (aka &quot;enabled list&quot;)&nbsp;</div></li><li><div>        $lists = $model_list-&gt;get(array( 'name', 'list_id', 'is_public' ), array( 'is_enabled' =&gt; 1 ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // generate table header/footer&nbsp;</div></li><li><div>        $table_headers = '&nbsp;</div></li><li><div>            &lt;th class=&quot;manage-column&quot; scope=&quot;col&quot;&gt;&lt;span&gt;'.__('Name', WYSIJA).'&lt;/span&gt;&lt;/th&gt;&nbsp;</div></li><li><div>            &lt;th class=&quot;manage-column&quot; scope=&quot;col&quot;&gt;&lt;span&gt;'.__('Lists', WYSIJA).'&lt;/span&gt;&lt;/th&gt;&nbsp;</div></li><li><div>        ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $classes = function_exists('wp_star_rating') ? 'add-new-h2' : 'button-secondary2';&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;!-- Create a new form --&gt;&nbsp;</div></li><li><div>        &lt;p class=&quot;new_form&quot;&gt;&nbsp;</div></li><li><div>            &lt;a class=&quot;&lt;?php echo $classes; ?&gt;&quot; href=&quot;admin.php?page=wysija_config&action=form_add&_wpnonce=&lt;?php echo $this-&gt;secure(array( &quot;action&quot; =&gt; &quot;form_add&quot; ), true); ?&gt;&quot;&gt;&lt;?php _e('Create a new form', WYSIJA); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>        &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        if (count($forms) &gt; 0) {&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;!-- List of forms --&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;list&quot;&gt;&nbsp;</div></li><li><div>                &lt;table cellspacing=&quot;0&quot; class=&quot;widefat fixed&quot;&gt;&nbsp;</div></li><li><div>                    &lt;thead&gt;&nbsp;</div></li><li><div>                        &lt;tr&gt;&nbsp;</div></li><li><div>                            &lt;?php echo $table_headers; ?&gt;&nbsp;</div></li><li><div>                        &lt;/tr&gt;&nbsp;</div></li><li><div>                    &lt;/thead&gt;&nbsp;</div></li><li><div>                    &lt;tfoot&gt;&nbsp;</div></li><li><div>                        &lt;tr&gt;&nbsp;</div></li><li><div>                            &lt;?php echo $table_headers; ?&gt;&nbsp;</div></li><li><div>                        &lt;/tr&gt;&nbsp;</div></li><li><div>                    &lt;/tfoot&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;tbody&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        for ($i = 0, $count = count($forms); $i &lt; $count; $i++) {&nbsp;</div></li><li><div>                            // set current row&nbsp;</div></li><li><div>                            $row = $forms[$i];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // get lists in settings and build list of lists (separated by &quot;, &quot; for display only)&nbsp;</div></li><li><div>                            $form_data = unserialize(base64_decode($row['data']));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $form_lists = array( );&nbsp;</div></li><li><div>                            if (isset($form_data['settings']['lists']) && !empty($form_data['settings']['lists'])) {&nbsp;</div></li><li><div>                                for ($j = 0, $list_count = count($lists); $j &lt; $list_count; $j++) {&nbsp;</div></li><li><div>                                    if (in_array($lists[$j]['list_id'], $form_data['settings']['lists'])) {&nbsp;</div></li><li><div>                                        $form_lists[] = $lists[$j]['name'];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // format list of lists depending on who's choosing the list to subscribe to (admin OR user)&nbsp;</div></li><li><div>                            if (empty($form_lists)) {&nbsp;</div></li><li><div>                                $form_lists_display = '&lt;strong&gt;'.__('No list specified', WYSIJA).'&lt;/strong&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else {&nbsp;</div></li><li><div>                                if ($form_data['settings']['lists_selected_by'] === 'user') {&nbsp;</div></li><li><div>                                    // user can select his own lists&nbsp;</div></li><li><div>                                    $form_lists_display = sprintf(__('User choice: %s', WYSIJA), join(', ', $form_lists));&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                else {&nbsp;</div></li><li><div>                                    // admin has selected which lists the user subscribes to&nbsp;</div></li><li><div>                                    $form_lists_display = join(', ', $form_lists);&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                            &lt;tr class=&quot;&lt;?php echo (($i % 2) ? 'alternate' : ''); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                                &lt;td&gt;&nbsp;</div></li><li><div>                                    &lt;?php echo $row['name']; ?&gt;&nbsp;</div></li><li><div>                                    &lt;div class=&quot;row-actions&quot;&gt;&nbsp;</div></li><li><div>                                        &lt;span class=&quot;edit&quot;&gt;&nbsp;</div></li><li><div>                                            &lt;a href=&quot;admin.php?page=wysija_config&action=form_edit&id=&lt;?php echo $row['form_id'] ?&gt;&quot;&gt;&lt;?php _e('Edit', WYSIJA); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                                        &lt;/span&gt; |&nbsp;</div></li><li><div>                                        &lt;span class=&quot;duplicate&quot;&gt;&nbsp;</div></li><li><div>                                            &lt;a href=&quot;admin.php?page=wysija_config&action=form_duplicate&id=&lt;?php echo $row['form_id'] ?&gt;&_wpnonce=&lt;?php echo $this-&gt;secure(array( 'action' =&gt; 'form_duplicate', 'id' =&gt; $row['form_id'] ), true); ?&gt;&quot;&gt;&lt;?php _e('Duplicate', WYSIJA) ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                                        &lt;/span&gt; |&nbsp;</div></li><li><div>                                        &lt;span class=&quot;delete&quot;&gt;&nbsp;</div></li><li><div>                                            &lt;a href=&quot;admin.php?page=wysija_config&action=form_delete&id=&lt;?php echo $row['form_id'] ?&gt;&_wpnonce=&lt;?php echo $this-&gt;secure(array( 'action' =&gt; 'form_delete', 'id' =&gt; $row['form_id'] ), true); ?&gt;&quot; class=&quot;submitdelete&quot;&gt;&lt;?php _e('Delete', WYSIJA) ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                                        &lt;/span&gt;&nbsp;</div></li><li><div>                                    &lt;/div&gt;&nbsp;</div></li><li><div>                                &lt;/td&gt;&nbsp;</div></li><li><div>                                &lt;td&gt;&nbsp;</div></li><li><div>                                    &lt;?php echo $form_lists_display ?&gt;&nbsp;</div></li><li><div>                                &lt;/td&gt;&nbsp;</div></li><li><div>                            &lt;/tr&gt;&lt;?php&nbsp;</div></li><li><div>                }//endfor&nbsp;</div></li><li><div>                                ?&gt;&nbsp;</div></li><li><div>                    &lt;/tbody&gt;&nbsp;</div></li><li><div>                &lt;/table&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        } //endif&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function form_edit($data) {&nbsp;</div></li><li><div>        // get form editor rendering engine&nbsp;</div></li><li><div>        $helper_form_engine = WYSIJA::get('form_engine', 'helper');&nbsp;</div></li><li><div>        $helper_form_engine-&gt;set_lists($data['lists']);&nbsp;</div></li><li><div>        $helper_form_engine-&gt;set_data($data['form']['data'], true);&nbsp;</div></li><li><div>        $classes = function_exists('wp_star_rating') ? 'add-new-h2' : 'button-secondary2';&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;icon32&quot;&gt;&lt;img src=&quot;&lt;?php echo WYSIJA_URL ?&gt;img/form-icon.png&quot; alt=&quot;&quot; /&gt;&lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        if ($data['can_edit'] === false) {&nbsp;</div></li><li><div>            echo '&lt;h2 class=&quot;title clearfix&quot;&gt;';&nbsp;</div></li><li><div>            echo '&lt;span&gt;'.__('Edit form', WYSIJA).'&lt;/span&gt;';&nbsp;</div></li><li><div>            echo '&lt;/h2&gt;';&nbsp;</div></li><li><div>            echo __('Yikes! To edit a form, you need to have at least 1 list.', WYSIJA);&nbsp;</div></li><li><div>            echo '&lt;a href=&quot;admin.php?page=wysija_subscribers&action=addlist&quot; class=&quot;button-secondary2&quot;&gt;'.__('Add List', WYSIJA).'&lt;/a&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            echo '&lt;h2 class=&quot;title clearfix&quot;&gt;';&nbsp;</div></li><li><div>            echo '&lt;span&gt;'.__('Edit', WYSIJA).'&lt;/span&gt;';&nbsp;</div></li><li><div>            echo '&lt;span id=&quot;form-name&quot;&gt;'.$data['form']['name'].'&lt;/span&gt;';&nbsp;</div></li><li><div>            echo '&lt;span id=&quot;form-name-default&quot;&gt;'.$data['form']['name'].'&lt;/span&gt;';&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;span&gt;&nbsp;</div></li><li><div>                &lt;a id=&quot;edit-form-name&quot; class=&quot;button&quot; href=&quot;javascript:;&quot;&gt;&lt;?php echo __('Edit name', WYSIJA); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                &lt;a class=&quot;&lt;?php echo $classes; ?&gt;&quot; href=&quot;admin.php?page=wysija_config#tab-forms&quot;&gt;&lt;?php echo __('List of forms', WYSIJA); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>            &lt;/span&gt;&nbsp;</div></li><li><div>            &lt;/h2&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;div class=&quot;clearfix&quot;&gt;&nbsp;</div></li><li><div>                &lt;!-- Form Editor Container --&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;wysija_form_container&quot;&gt;&nbsp;</div></li><li><div>                    &lt;!-- Form Editor --&gt;&nbsp;</div></li><li><div>                    &lt;div id=&quot;wysija_form_editor&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        // render form editor&nbsp;</div></li><li><div>                        echo $helper_form_engine-&gt;render_editor();&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;!-- Form settings --&gt;&nbsp;</div></li><li><div>                    &lt;form id=&quot;wysija-form-settings&quot; action=&quot;&quot; method=&quot;POST&quot;&gt;&nbsp;</div></li><li><div>                        &lt;input type=&quot;hidden&quot; name=&quot;form_id&quot; value=&quot;&lt;?php echo (int)$data['form_id']; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        &lt;!-- Form settings: list selection --&gt;&nbsp;</div></li><li><div>                        &lt;div id=&quot;list-selection&quot; class=&quot;clearfix&quot;&gt;&nbsp;</div></li><li><div>                            &lt;p&gt;&nbsp;</div></li><li><div>                                &lt;strong&gt;&lt;?php _e('This form adds subscribers to these lists:', WYSIJA) ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>                            &lt;/p&gt;&nbsp;</div></li><li><div>                            &lt;?php&nbsp;</div></li><li><div>                            if (!empty($data['lists'])) {&nbsp;</div></li><li><div>                                $form_lists = $helper_form_engine-&gt;get_setting('lists');&nbsp;</div></li><li><div>                                // make sure that form_lists is an array&nbsp;</div></li><li><div>                                if ($form_lists === null or is_array($form_lists) === false)&nbsp;</div></li><li><div>                                    $form_lists = array( );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                usort($data['lists'], array( $this, 'sort_by_name' ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                print '&lt;select id=&quot;lists-selection&quot; name=&quot;lists&quot; data-placeholder=&quot;'.__('Choose a list', WYSIJA).'&quot; multiple class=&quot;chosen_select&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                for ($i = 0, $count = count($data['lists']); $i &lt; $count; $i++) {&nbsp;</div></li><li><div>                                    $list = $data['lists'][$i];&nbsp;</div></li><li><div>                                    $is_checked = (in_array($list['list_id'], $form_lists)) ? 'selected=&quot;selected&quot;' : '';&nbsp;</div></li><li><div>                                    //print '&lt;label&gt;&lt;input type=&quot;checkbox&quot; class=&quot;checkbox&quot; name=&quot;lists&quot; value=&quot;' . $list['list_id'] . '&quot; ' . $is_checked . ' /&gt;' . $list['name'] . '&lt;/label&gt;';&nbsp;</div></li><li><div>                                    print '&lt;option value=&quot;'.$list['list_id'].'&quot; '.$is_checked.' /&gt;'.$list['name'].'&lt;/option&gt;';&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                print '&lt;/select&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                        &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        &lt;!-- Form settings: after submit --&gt;&nbsp;</div></li><li><div>                        &lt;div id=&quot;after-submit&quot;&gt;&nbsp;</div></li><li><div>                            &lt;p&gt;&nbsp;</div></li><li><div>                                &lt;strong&gt;&lt;?php _e('After submit...', WYSIJA) ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>                                &lt;input type=&quot;hidden&quot; name=&quot;on_success&quot; value=&quot;message&quot; /&gt;&nbsp;</div></li><li><div>                                &lt;!--&lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;on_success&quot; value=&quot;message&quot; checked=&quot;checked&quot;  /&gt;&lt;?php _e('show message', WYSIJA); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                                &lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;on_success&quot; value=&quot;page&quot; /&gt;&lt;?php _e('go to page', WYSIJA); ?&gt;&lt;/label&gt;--&gt;&nbsp;</div></li><li><div>                            &lt;/p&gt;&nbsp;</div></li><li><div>                            &lt;textarea name=&quot;success_message&quot;&gt;&lt;?php echo $helper_form_engine-&gt;get_setting('success_message'); ?&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>                        &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        &lt;p id=&quot;form-error&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        &lt;p class=&quot;submit&quot;&gt;&nbsp;</div></li><li><div>                            &lt;a href=&quot;javascript:;&quot; id=&quot;form-save&quot; class=&quot;button-primary wysija&quot; &gt;&lt;?php echo esc_attr(__('Save', WYSIJA)); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                        &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        &lt;p id=&quot;form-notice&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;!-- Form export links --&gt;&nbsp;</div></li><li><div>                    &lt;div id=&quot;form-export-links&quot;&gt;&lt;p&gt;&lt;?php echo str_replace(array( '[link]', '[/link]' ), array( '&lt;a href=&quot;widgets.php&quot; target=&quot;_blank&quot;&gt;', '&lt;/a&gt;' ), __('You can easily add this form to your theme\'s [link]Widgets areas[/link].', WYSIJA)); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                        &lt;p&gt;&lt;?php&nbsp;</div></li><li><div>                $text = __('[link_html]HTML[/link_html], [link_php]PHP[/link_php], [link_iframe]iframe[/link_iframe] and [link_shortcode]shortcode[/link_shortcode] versions are also available.', WYSIJA);&nbsp;</div></li><li><div>                echo str_replace(&nbsp;</div></li><li><div>                        array( '[link_html]', '[link_php]', '[link_iframe]', '[link_shortcode]', '[/link_html]', '[/link_php]', '[/link_iframe]', '[/link_shortcode]' ), array( '&lt;a target=&quot;javascript:;&quot; class=&quot;expand-code&quot; title=&quot;html&quot;&gt;', '&lt;a target=&quot;javascript:;&quot; class=&quot;expand-code&quot; title=&quot;php&quot;&gt;', '&lt;a target=&quot;javascript:;&quot; class=&quot;expand-code&quot; title=&quot;iframe&quot;&gt;', '&lt;a target=&quot;javascript:;&quot; class=&quot;expand-code&quot; title=&quot;shortcode&quot;&gt;', '&lt;/a&gt;', '&lt;/a&gt;', '&lt;/a&gt;', '&lt;/a&gt;' ), $text);&nbsp;</div></li><li><div>                            ?&gt;&lt;/p&gt;&lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;!-- Form export --&gt;&nbsp;</div></li><li><div>                    &lt;div id=&quot;form-export&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php echo $helper_form_engine-&gt;render_editor_export($data['form_id']); ?&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;!-- Form Editor: Toolbar --&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;wysija_form_toolbar&quot;&gt;&nbsp;</div></li><li><div>                    &lt;!-- &lt;ul class=&quot;wysija_form_toolbar_tabs&quot;&gt;&nbsp;</div></li><li><div>                        &lt;li class=&quot;wjt-content&quot;&gt;&nbsp;</div></li><li><div>                            &lt;a class=&quot;selected&quot; href=&quot;javascript:;&quot; rel=&quot;wj_content&quot;&gt;&lt;?php _e('Content', WYSIJA) ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                        &lt;/li&gt;&nbsp;</div></li><li><div>                    &lt;/ul&gt; --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;!-- CONTENT BAR --&gt;&nbsp;</div></li><li><div>                    &lt;ul class=&quot;wj_content&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        // render editor toolbar&nbsp;</div></li><li><div>                        echo $helper_form_engine-&gt;render_editor_toolbar();&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/ul&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;!-- WIDGET TEMPLATES --&gt;&nbsp;</div></li><li><div>                    &lt;div id=&quot;wysija_widget_templates&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        // render editor widget templates&nbsp;</div></li><li><div>                        echo $helper_form_engine-&gt;render_editor_templates();&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;div id=&quot;wysija_notices&quot; style=&quot;display:none;&quot;&gt;&lt;span id=&quot;wysija_notice_msg&quot;&gt;&lt;/span&gt;&lt;img alt=&quot;loader&quot; style=&quot;display:none;&quot; id=&quot;ajax-loading&quot; src=&quot;&lt;?php echo WYSIJA_URL ?&gt;img/wpspin_light.gif&quot; /&gt;&lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&nbsp;</div></li><li><div>                wysijaAJAX.form_id = &lt;?php echo (int)$_REQUEST['id'] ?&gt;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                function formEditorSave(callback) {&nbsp;</div></li><li><div>                    wysijaAJAX.task = 'form_save';&nbsp;</div></li><li><div>                    wysijaAJAX._wpnonce = wysijanonces.config.form_save;&nbsp;</div></li><li><div>                    wysijaAJAX.wysijaData = WysijaForm.save();&nbsp;</div></li><li><div>                    WYSIJA_SYNC_AJAX({&nbsp;</div></li><li><div>                        success: callback&nbsp;</div></li><li><div>                    });&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                function refreshToolbar(data) {&nbsp;</div></li><li><div>                    // update toolbar&nbsp;</div></li><li><div>                    $('wysija_form_toolbar').down('.wj_content').innerHTML = Base64.decode(data.toolbar);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // update templates&nbsp;</div></li><li><div>                    $('wysija_widget_templates').innerHTML = Base64.decode(data.templates);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // setup events on widgets&nbsp;</div></li><li><div>                    setupToolbar();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                function refreshBlocks(field_name, block) {&nbsp;</div></li><li><div>                    var elements = $$('#wysija_form_editor .wysija_form_block[wysija_field=&quot;'+ field_name +'&quot;]');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if(elements.length &gt; 0) {&nbsp;</div></li><li><div>                        $(elements).each(function(element) {&nbsp;</div></li><li><div>                            // replace each block by new block&nbsp;</div></li><li><div>                            refreshBlock(element, block);&nbsp;</div></li><li><div>                        });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // init wysija form&nbsp;</div></li><li><div>                        setTimeout(function() {&nbsp;</div></li><li><div>                            formEditorSave(function() { WysijaForm.init() });&nbsp;</div></li><li><div>                        }, 1);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                function refreshBlock(element, block) {&nbsp;</div></li><li><div>                    element.replace(Base64.decode(block));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                function setupToolbar() {&nbsp;</div></li><li><div>                    // add custom field button&nbsp;</div></li><li><div>                    $('wysija-add-field').observe('click', function() {&nbsp;</div></li><li><div>                        WysijaPopup.open(wysijatrans.add_field, $(this).readAttribute('href2'), function(data) {&nbsp;</div></li><li><div>                            refreshToolbar(data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // make sure disabled widgets stay disabled after editing&nbsp;</div></li><li><div>                            WysijaForm.toggleWidgets();&nbsp;</div></li><li><div>                        });&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // edit custom field settings&nbsp;</div></li><li><div>                    $$('.wysija_form_item_settings').invoke('stopObserving', 'click');&nbsp;</div></li><li><div>                    $$('.wysija_form_item_settings').invoke('observe', 'click', function() {&nbsp;</div></li><li><div>                        var self = this;&nbsp;</div></li><li><div>                        // get field type&nbsp;</div></li><li><div>                        var field_type = $(this).previous('.wysija_form_item').readAttribute('wysija_field');&nbsp;</div></li><li><div>                        toggleBlocksHighlight('on', field_type);&nbsp;</div></li><li><div>                        WysijaPopup.open(wysijatrans.edit_field, $(this).readAttribute('href2'), function(data) {&nbsp;</div></li><li><div>                            refreshToolbar(data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // get field type&nbsp;</div></li><li><div>                            var field_name = $(self).previous('.wysija_form_item').readAttribute('wysija_field');&nbsp;</div></li><li><div>                            refreshBlocks(field_name, data.block);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // make sure disabled widgets stay disabled after editing&nbsp;</div></li><li><div>                            WysijaForm.toggleWidgets();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            toggleBlocksHighlight('off', field_type);&nbsp;</div></li><li><div>                        }, function() {&nbsp;</div></li><li><div>                            toggleBlocksHighlight('off', field_type);&nbsp;</div></li><li><div>                        });&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // remove custom field&nbsp;</div></li><li><div>                    $$('.wysija_form_item_delete').invoke('stopObserving', 'click');&nbsp;</div></li><li><div>                    $$('.wysija_form_item_delete').invoke('observe', 'click', function(e) {&nbsp;</div></li><li><div>                        // get field type&nbsp;</div></li><li><div>                        var field_type = $(this).previous('.wysija_form_item').readAttribute('wysija_field');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // highlight blocks using this field type&nbsp;</div></li><li><div>                        toggleBlocksHighlight('on', field_type);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if(window.confirm(wysijatrans.delete_field_confirmation)) {&nbsp;</div></li><li><div>                            // make ajax request&nbsp;</div></li><li><div>                            wysijaAJAX.task = 'form_field_delete';&nbsp;</div></li><li><div>                            wysijaAJAX._wpnonce = wysijanonces.config.form_field_delete;&nbsp;</div></li><li><div>                            // build data with field id&nbsp;</div></li><li><div>                            var data = { field_id: parseInt($(this).readAttribute('data-field-id'), 10) }, &nbsp;</div></li><li><div>                            self = this;&nbsp;</div></li><li><div>                            wysijaAJAX.wysijaData = Base64.encode(Object.toJSON(data).gsub('\\&quot;', '&quot;').gsub('&quot;[{', '[{').gsub('}]&quot;', '}]'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            new Ajax.Request(wysijaAJAX.ajaxurl, {&nbsp;</div></li><li><div>                                method: 'post', &nbsp;</div></li><li><div>                                parameters: wysijaAJAX, &nbsp;</div></li><li><div>                                onSuccess:function(response) {&nbsp;</div></li><li><div>                                    // remove widget from list&nbsp;</div></li><li><div>                                    $(self).up('li').remove();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // remove all blocks from the same type&nbsp;</div></li><li><div>                                    $$('.wysija_form_block[wysija_field=&quot;'+ field_type +'&quot;]').each(function(element) {&nbsp;</div></li><li><div>                                        // get block id&nbsp;</div></li><li><div>                                        var block = WysijaForm.get($(element));&nbsp;</div></li><li><div>                                        block.removeBlock();&nbsp;</div></li><li><div>                                    });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    // save form&nbsp;</div></li><li><div>                                    formEditorSave();&nbsp;</div></li><li><div>                                }, &nbsp;</div></li><li><div>                                onFailure:function(response) {&nbsp;</div></li><li><div>                                    // nothing we can do about it.&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            });&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // highlight blocks using this field type&nbsp;</div></li><li><div>                        toggleBlocksHighlight('off', field_type);&nbsp;</div></li><li><div>                        return false;&nbsp;</div></li><li><div>                    });&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                function toggleBlocksHighlight(toggle, field_type) {&nbsp;</div></li><li><div>                    if(field_type === undefined) return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if(toggle === 'on') {&nbsp;</div></li><li><div>                        // turn highlight on&nbsp;</div></li><li><div>                        $$('.wysija_form_block[wysija_field=&quot;'+ field_type +'&quot;]').invoke('addClassName', 'highlighted');&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        // turn highlight off&nbsp;</div></li><li><div>                        $$('.wysija_form_block[wysija_field=&quot;'+ field_type +'&quot;]').invoke('removeClassName', 'highlighted');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $('form-save').observe('click', function() {&nbsp;</div></li><li><div>                    // hide any previous error&nbsp;</div></li><li><div>                    $('form-error').hide();&nbsp;</div></li><li><div>                    // hide any previous notice&nbsp;</div></li><li><div>                    $('form-notice').hide();&nbsp;</div></li><li><div>                    $('form-export-links').hide();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // make sure a list has been selected or that we have a list selection widget inserted&nbsp;</div></li><li><div>                    if ($F('lists-selection').length === 0 && $$('#wysija_form_body div[wysija_field=&quot;list&quot;]').length === 0) {&nbsp;</div></li><li><div>                        $('form-error').update(wysijatrans.list_cannot_be_empty).show();&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        // hide export options while saving&nbsp;</div></li><li><div>                        WysijaForm.hideExport();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        formEditorSave(function(response) {&nbsp;</div></li><li><div>                            // regenerate export methods and show&nbsp;</div></li><li><div>                            $('form-export').innerHTML = Base64.decode(response.responseJSON.result.exports);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // display save message&nbsp;</div></li><li><div>                            $('form-notice').update(Base64.decode(response.responseJSON.result.save_message));&nbsp;</div></li><li><div>                            $('form-export-links').show();&nbsp;</div></li><li><div>                            $('form-notice').show();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            WysijaForm.showExport();&nbsp;</div></li><li><div>                        });&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    return false;&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $(document).observe('dom:loaded', function() {&nbsp;</div></li><li><div>                    // setup widget events&nbsp;</div></li><li><div>                    setupToolbar();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Setups the jQuery Select2&nbsp;</div></li><li><div>                    jQuery('#lists-selection').select2({&nbsp;</div></li><li><div>                        'width': 640&nbsp;</div></li><li><div>                    });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // in place editor for form name&nbsp;</div></li><li><div>                    new Ajax.InPlaceEditor('form-name', wysijaAJAX.ajaxurl, {&nbsp;</div></li><li><div>                        okControl: false, &nbsp;</div></li><li><div>                        cancelControl: false, &nbsp;</div></li><li><div>                        clickToEditText: '', &nbsp;</div></li><li><div>                        submitOnBlur: true, &nbsp;</div></li><li><div>                        highlightColor: '#f9f9f9', &nbsp;</div></li><li><div>                        externalControl: 'edit-form-name', &nbsp;</div></li><li><div>                        callback: function(form, value) {&nbsp;</div></li><li><div>                            wysijaAJAX.task = 'form_name_save';&nbsp;</div></li><li><div>                            wysijaAJAX._wpnonce = wysijanonces.config.form_name_save;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            return Object.toQueryString(wysijaAJAX) + '&id=' + wysijaAJAX.form_id + '&name=' + encodeURIComponent(WysijaForm.stripHtmlValue(value));&nbsp;</div></li><li><div>                        }, &nbsp;</div></li><li><div>                        onComplete: function(response, element) {&nbsp;</div></li><li><div>                            if(response.responseJSON.result.name.length === 0) {&nbsp;</div></li><li><div>                                $(element).innerHTML = $('form-name-default').innerHTML;&nbsp;</div></li><li><div>                            } else {&nbsp;</div></li><li><div>                                var sanitized_name = WysijaForm.stripHtmlValue(response.responseJSON.result.name);&nbsp;</div></li><li><div>                                $(element).innerHTML = sanitized_name;&nbsp;</div></li><li><div>                                $('form-name-default').innerHTML = sanitized_name;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // remove observe on input field&nbsp;</div></li><li><div>                            $('form-name-inplaceeditor').down('.editor_field').stopObserving('keypress');&nbsp;</div></li><li><div>                        }, &nbsp;</div></li><li><div>                        onEnterEditMode: function(form, value) {&nbsp;</div></li><li><div>                            setTimeout(function() {&nbsp;</div></li><li><div>                                $('form-name-inplaceeditor').down('.editor_field').observe('keypress', function(e) {&nbsp;</div></li><li><div>                                    // prevent form from submitting on enter key press&nbsp;</div></li><li><div>                                    if (e.keyCode == 13) {&nbsp;</div></li><li><div>                                        e.preventDefault();&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                });&nbsp;</div></li><li><div>                            }, 1);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    });&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>            &lt;/script&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Wysija Form Editor: Widget Settings&nbsp;</div></li><li><div>    function popup_form_widget_settings($data = array( )) {&nbsp;</div></li><li><div>        $type = (isset($data['type']) && strlen(trim($data['type'])) &gt; 0) ? $data['type'] : 'new';&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;popup_content inline_form form_widget_settings widget_&lt;?php echo $type; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            // it means it's a new field if we have a field_id parameter with a 0 value&nbsp;</div></li><li><div>            $is_editing_field = (bool)(isset($data['field_id']));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (isset($data['field_id'])) {&nbsp;</div></li><li><div>                $valid_types = array(&nbsp;</div></li><li><div>                    'input' =&gt; __('Text Input', WYSIJA), &nbsp;</div></li><li><div>                    'textarea' =&gt; __('Text Area', WYSIJA), &nbsp;</div></li><li><div>                    'radio' =&gt; __('Radio buttons', WYSIJA), &nbsp;</div></li><li><div>                    'checkbox' =&gt; __('Checkbox', WYSIJA), &nbsp;</div></li><li><div>                    'select' =&gt; __('Select', WYSIJA), &nbsp;</div></li><li><div>                    'date' =&gt; __('Date', WYSIJA)&nbsp;</div></li><li><div>                        //'country' =&gt; __('Country', WYSIJA)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;form id=&quot;field-settings-form&quot; method=&quot;get&quot; action=&quot;&quot;&gt;&nbsp;</div></li><li><div>                    &lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;&lt;?php echo esc_attr($_REQUEST['action']); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;input type=&quot;hidden&quot; name=&quot;page&quot; value=&quot;&lt;?php echo esc_attr($_REQUEST['page']); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;input type=&quot;hidden&quot; name=&quot;field_id&quot; value=&quot;&lt;?php echo (int)$data['field_id']; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;p class=&quot;clearfix&quot;&gt;&nbsp;</div></li><li><div>                        &lt;label for=&quot;field-type-select&quot;&gt;&lt;?php _e('Select a field type:', WYSIJA) ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                        &lt;select id=&quot;field-type-select&quot; name=&quot;type&quot;&gt;&nbsp;</div></li><li><div>                            &lt;option value=&quot;&quot;&gt;&lt;/option&gt;&nbsp;</div></li><li><div>                            &lt;?php&nbsp;</div></li><li><div>                            foreach ($valid_types as $type =&gt; $label) {&nbsp;</div></li><li><div>                                $is_selected = ($data['type'] === $type) ? ' selected=&quot;selected&quot;' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                echo '&lt;option value=&quot;'.$type.'&quot;'.$is_selected.'&gt;'.$label.'&lt;/option&gt;';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                        &lt;/select&gt;&nbsp;</div></li><li><div>                    &lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;hr /&gt;&nbsp;</div></li><li><div>                &lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (method_exists($this, 'form_widget_'.$data['type']) === false) {&nbsp;</div></li><li><div>                // display warning because the widget has no form built in&nbsp;</div></li><li><div>                // print 'missing method &quot;' . 'form_widget_' . $data['type'] . '&quot;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                // get widget form&nbsp;</div></li><li><div>                $data['is_editing_field'] = $is_editing_field;&nbsp;</div></li><li><div>                $widget_form = $this-&gt;{'form_widget_'.$data['type']}($data);&nbsp;</div></li><li><div>                // check whether the field is a custom field&nbsp;</div></li><li><div>                $form_engine = WYSIJA::get('form_engine', 'helper');&nbsp;</div></li><li><div>                $is_custom_field = $form_engine-&gt;is_custom_field($data);&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;!-- this is to display error messages --&gt;&nbsp;</div></li><li><div>                &lt;p id=&quot;widget-settings-error&quot; style=&quot;display:none;&quot;&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                &lt;!-- common form for every wysija form widget --&gt;&nbsp;</div></li><li><div>                &lt;form enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; action=&quot;&quot; class=&quot;&quot; id=&quot;widget-settings-form&quot;&gt;&nbsp;</div></li><li><div>                    &lt;input type=&quot;hidden&quot; name=&quot;type&quot; value=&quot;&lt;?php echo $data['type']; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;input type=&quot;hidden&quot; name=&quot;field&quot; value=&quot;&lt;?php echo $data['field']; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                    &lt;?php&nbsp;</div></li><li><div>                    if ($is_editing_field === true) {&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                        &lt;p class=&quot;clearfix&quot;&gt;&nbsp;</div></li><li><div>                            &lt;label for=&quot;name&quot;&gt;&lt;?php _e(&quot;Field's name:&quot;, WYSIJA); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                            &lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;&lt;?php echo stripslashes(esc_attr($data['name'])); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                        &lt;/p&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                        &lt;input type=&quot;hidden&quot; name=&quot;name&quot; value=&quot;&lt;?php echo esc_attr($data['name']); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    ?&gt;&nbsp;</div></li><li><div>                    &lt;?php echo $widget_form; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;p class=&quot;submit_button&quot;&gt;&nbsp;</div></li><li><div>                        &lt;input id=&quot;widget-settings-submit&quot; type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;&lt;?php echo esc_attr(__('Done', WYSIJA)) ?&gt;&quot; class=&quot;button-primary&quot; /&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        if ($is_editing_field === false && $is_custom_field === true) {&nbsp;</div></li><li><div>                            $field_id = (int)substr($data['field'], 3);&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                            &lt;a id=&quot;widget-field-settings&quot; wysija_field=&quot;&lt;?php echo $field_id; ?&gt;&quot; href=&quot;javascript:;&quot;&gt;&lt;?php echo __('Edit field', WYSIJA); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                            &lt;?php&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/p&gt;&nbsp;</div></li><li><div>                &lt;/form&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function form_widget_html($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get widget params from data, this will contain all user editable parameters&nbsp;</div></li><li><div>        $params = $data['params'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // text&nbsp;</div></li><li><div>        $text = isset($params['text']) ? $params['text'] : '';&nbsp;</div></li><li><div>        $output .= '&lt;textarea name=&quot;text&quot;&gt;'.$text.'&lt;/textarea&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // nl2br?&nbsp;</div></li><li><div>        $is_checked = (isset($params['nl2br']) && (bool)$params['nl2br'] === true) ? 'checked=&quot;checked&quot;' : '';&nbsp;</div></li><li><div>        $output .= '&lt;label for=&quot;field-nl2br&quot;&gt;&lt;input id=&quot;field-nl2br&quot; type=&quot;checkbox&quot; class=&quot;checkbox&quot; name=&quot;nl2br&quot; '.$is_checked.' value=&quot;1&quot; /&gt;'.__('Automatically add paragraphs', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function form_widget_submit($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // label&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_label($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function form_widget_input($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // label&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_label($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // inline label&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_label_inline($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // extra validation&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_validation($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function form_widget_textarea($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // label&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_label($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // inline label&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_label_inline($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // extra validation&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_validation($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($data['is_editing_field'] === false) {&nbsp;</div></li><li><div>            // number of lines (defaults to 1)&nbsp;</div></li><li><div>            $number_of_lines = (isset($data['params']['lines']) && (int)$data['params']['lines'] &gt; 0) ? (int)$data['params']['lines'] : 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $output .= '&lt;p class=&quot;clearfix&quot;&gt;&lt;label for=&quot;number-lines-select&quot;&gt;'.__('Number of lines:', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>            $output .= '    &lt;select id=&quot;number-lines-select&quot; name=&quot;lines&quot;&gt;';&nbsp;</div></li><li><div>            for ($i = 1; $i &lt; 6; $i++) {&nbsp;</div></li><li><div>                $is_selected = ($number_of_lines === $i) ? ' selected=&quot;selected&quot;' : '';&nbsp;</div></li><li><div>                $output .= '    &lt;option value=&quot;'.$i.'&quot; '.$is_selected.'&gt;'.sprintf(_n('1 line', '%d lines', $i, WYSIJA), $i).'&lt;/option&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $output .= '    &lt;/select&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function form_widget_list($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get widget params from data, this will contain all user editable parameters&nbsp;</div></li><li><div>        $params = $data['params'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get widget extra data, this will contain all the available lists&nbsp;</div></li><li><div>        $extra = $data['extra'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // label&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_label($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $helper_form_engine = WYSIJA::get('form_engine', 'helper');&nbsp;</div></li><li><div>        // get list names&nbsp;</div></li><li><div>        $list_names = $helper_form_engine-&gt;get_formatted_lists();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // display select lists&nbsp;</div></li><li><div>        $output .= '&lt;ul id=&quot;lists-selection&quot; class=&quot;selection sortable&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($params['values'])) {&nbsp;</div></li><li><div>            for ($i = 0, $count = count($params['values']); $i &lt; $count; $i++) {&nbsp;</div></li><li><div>                $list = $params['values'][$i];&nbsp;</div></li><li><div>                $is_checked = ((int)$list['is_checked'] &gt; 0) ? 'checked=&quot;checked&quot;' : '';&nbsp;</div></li><li><div>                if (isset($list_names[$list['list_id']])) {&nbsp;</div></li><li><div>                    $output .= '&lt;li class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>                    $output .= '    &lt;input class=&quot;is_selected&quot; id=&quot;list-'.$list['list_id'].'&quot; type=&quot;checkbox&quot; data-list=&quot;'.$list['list_id'].'&quot; value=&quot;1&quot; '.$is_checked.' /&gt;';&nbsp;</div></li><li><div>                    $output .= '    &lt;label for=&quot;list-'.$list['list_id'].'&quot;&gt;'.$list_names[$list['list_id']].'&lt;/label&gt;';&nbsp;</div></li><li><div>                    $output .= '    &lt;a class=&quot;icon remove&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>                    $output .= '    &lt;a class=&quot;icon handle&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>                    $output .= '&lt;/li&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $output .= '&lt;/ul&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // available lists container&nbsp;</div></li><li><div>        $output .= '&lt;div id=&quot;lists-add-container&quot; class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;h3&gt;'.__('Select the list you want to add:', WYSIJA).'&lt;/h3&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // available lists select&nbsp;</div></li><li><div>        $output .= '&lt;select id=&quot;lists-available&quot; class=&quot;mp-select-sort&quot;&gt;';&nbsp;</div></li><li><div>        for ($j = 0, $count = count($extra['lists']); $j &lt; $count; $j++) {&nbsp;</div></li><li><div>            // set current list&nbsp;</div></li><li><div>            $list = $extra['lists'][$j];&nbsp;</div></li><li><div>            // generate select option&nbsp;</div></li><li><div>            $output .= '&lt;option value=&quot;'.$list['list_id'].'&quot;&gt;'.$list['name'].'&lt;/option&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $output .= '&lt;/select&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // add button to add currently selected list to selected lists&nbsp;</div></li><li><div>        $output .= '&lt;a href=&quot;javascript:;&quot; class=&quot;icon add&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // generate prototypeJS template for list selection so we can dynamically add/remove elements&nbsp;</div></li><li><div>        $output .= '&lt;div id=&quot;selection-template&quot;&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;li class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;input class=&quot;is_selected&quot; id=&quot;list-#{list_id}&quot; type=&quot;checkbox&quot; data-list=&quot;#{list_id}&quot; value=&quot;1&quot; /&gt;&lt;label for=&quot;list-#{list_id}&quot;&gt;#{name}&lt;/label&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;a class=&quot;icon remove&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;a class=&quot;icon handle&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;/li&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function form_widget_radio($data = array( )) {&nbsp;</div></li><li><div>        return $this-&gt;form_widget_multiple($data, 'radio');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function form_widget_checkbox($data = array( )) {&nbsp;</div></li><li><div>        return $this-&gt;form_widget_multiple($data, 'checkbox');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function form_widget_select($data = array( )) {&nbsp;</div></li><li><div>        return $this-&gt;form_widget_multiple($data, 'select');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Country selection widget&nbsp;</div></li><li><div>    function form_widget_country($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // TODO: JSON data coming from API&nbsp;</div></li><li><div>        //$country_data = json_decode(file_get_contents('http://localhost/countries.json'), true);&nbsp;</div></li><li><div>        $country_data = array( );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // format countries for select widget&nbsp;</div></li><li><div>        $countries = array( );&nbsp;</div></li><li><div>        foreach ($country_data as $country) {&nbsp;</div></li><li><div>            $countries[] = array(&nbsp;</div></li><li><div>                'value' =&gt; $country['name'], &nbsp;</div></li><li><div>                'is_checked' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $data['params']['values'] = $countries;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // render select widget form&nbsp;</div></li><li><div>        $output .= $this-&gt;form_widget_multiple($data, 'select');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function form_widget_date($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // label&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_label($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // date types&nbsp;</div></li><li><div>        $date_types = array(&nbsp;</div></li><li><div>            'year_month_day' =&gt; __('Year, month, day', WYSIJA), &nbsp;</div></li><li><div>            'year_month' =&gt; __('Year, month', WYSIJA), &nbsp;</div></li><li><div>            'month' =&gt; __('Month (January, February, ...)', WYSIJA), &nbsp;</div></li><li><div>            'year' =&gt; __('Year', WYSIJA)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($data['is_editing_field'] === false) {&nbsp;</div></li><li><div>            $date_type_value = (isset($data['params']['date_type']) && strlen(trim($data['params']['date_type'])) &gt; 0) ? trim($data['params']['date_type']) : $date_types[0];&nbsp;</div></li><li><div>            $output .= '&lt;input type=&quot;hidden&quot; name=&quot;date_type&quot; value=&quot;'.$date_type_value.'&quot;&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // date type selection&nbsp;</div></li><li><div>            $output .= '&lt;p class=&quot;clearfix&quot;&gt;&lt;label for=&quot;date_type&quot;&gt;'.__('Type of date:', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>            $output .= '    &lt;select id=&quot;date_type&quot; name=&quot;date_type&quot;&gt;';&nbsp;</div></li><li><div>            foreach ($date_types as $key =&gt; $label) {&nbsp;</div></li><li><div>                $is_selected = (isset($data['params']['date_type']) && $data['params']['date_type'] === $key) ? ' selected=&quot;selected&quot;' : '';&nbsp;</div></li><li><div>                $output .= '    &lt;option value=&quot;'.$key.'&quot; '.$is_selected.'&gt;'.$label.'&lt;/option&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $output .= '    &lt;/select&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // date set default as today&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_date_default_today($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // date display order&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_date_order($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // generic widget for handling multiple choices (radio, checkbox, select)&nbsp;</div></li><li><div>    private function form_widget_multiple($data = array( ), $type = false) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($type === false)&nbsp;</div></li><li><div>            return $output;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get widget params from data, this will contain all user editable parameters&nbsp;</div></li><li><div>        $params = $data['params'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // label&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_label($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // label inline&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_label_inline($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // flag to know whether to allow multiple values or not&nbsp;</div></li><li><div>        $is_multiple = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // checkbox only allow one value (for now...)&nbsp;</div></li><li><div>        if ($type === 'checkbox') {&nbsp;</div></li><li><div>            $is_multiple = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // make sure we have one value&nbsp;</div></li><li><div>            if (empty($params['values'])) {&nbsp;</div></li><li><div>                $params['values'][] = array( 'value' =&gt; '', 'is_checked' =&gt; false );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                // restrict to 1 value&nbsp;</div></li><li><div>                if (count($params['values']) &gt; 1) {&nbsp;</div></li><li><div>                    $value = $params['values'][0];&nbsp;</div></li><li><div>                    $params['values'] = array( $value );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set CSS classes for list&nbsp;</div></li><li><div>        $list_classes = array( 'selection' );&nbsp;</div></li><li><div>        if ($is_multiple === true) {&nbsp;</div></li><li><div>            $list_classes[] = 'sortable';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // hide values when no editing CF global settings&nbsp;</div></li><li><div>        if ($data['is_editing_field'] === false) {&nbsp;</div></li><li><div>            $output .= '&lt;div class=&quot;hidden&quot;&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // display values&nbsp;</div></li><li><div>        $output .= '&lt;ul id=&quot;items-selection&quot; class=&quot;'.join(' ', $list_classes).'&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($params['values'])) {&nbsp;</div></li><li><div>            for ($i = 0, $count = count($params['values']); $i &lt; $count; $i++) {&nbsp;</div></li><li><div>                $item = $params['values'][$i];&nbsp;</div></li><li><div>                $is_checked = ((int)$item['is_checked'] &gt; 0) ? 'checked=&quot;checked&quot;' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $output .= '&lt;li class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>                if ($type === 'checkbox') {&nbsp;</div></li><li><div>                    $output .= '&lt;input type=&quot;checkbox&quot; class=&quot;is_checked&quot; value=&quot;1&quot; '.$is_checked.' /&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $output .= '&lt;input type=&quot;radio&quot; name=&quot;is_checked&quot; class=&quot;is_checked&quot; value=&quot;1&quot; '.$is_checked.' /&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $output .= '    &lt;input type=&quot;text&quot; class=&quot;value&quot; value=&quot;'.$item['value'].'&quot; tabindex=&quot;'.($i + 1).'&quot; /&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($is_multiple === true) {&nbsp;</div></li><li><div>                    $output .= '    &lt;a class=&quot;icon remove&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>                    $output .= '    &lt;a class=&quot;icon handle&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $output .= '&lt;/li&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $output .= '&lt;/ul&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($is_multiple === true) {&nbsp;</div></li><li><div>            // add a new option&nbsp;</div></li><li><div>            $output .= '&lt;a id=&quot;items-selection-add&quot; href=&quot;javascript:;&quot; class=&quot;icon add&quot;&gt;&lt;span&gt;&lt;/span&gt;'.__('Add item', WYSIJA).'&lt;/a&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // generate prototypeJS template for list selection so we can dynamically add/remove elements&nbsp;</div></li><li><div>            $output .= '&lt;div id=&quot;selection-template&quot;&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;li class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>            if ($type === 'checkbox') {&nbsp;</div></li><li><div>                $output .= '&lt;input type=&quot;checkbox&quot; class=&quot;is_checked&quot; value=&quot;1&quot; /&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $output .= '&lt;input type=&quot;radio&quot; name=&quot;is_checked&quot; class=&quot;is_checked&quot; value=&quot;1&quot; /&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $output .= '    &lt;input type=&quot;text&quot; class=&quot;value&quot; value=&quot;&quot; tabindex=&quot;#{item_index}&quot; /&gt;';&nbsp;</div></li><li><div>            $output .= '    &lt;a class=&quot;icon remove&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>            $output .= '    &lt;a class=&quot;icon handle&quot; href=&quot;javascript:;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/a&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;/li&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;/div&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // hide values when no editing CF global settings&nbsp;</div></li><li><div>        if ($data['is_editing_field'] === false) {&nbsp;</div></li><li><div>            $output .= '&lt;/div&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $output .= $this-&gt;_widget_validation($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // widget feature: ability to specify a label&nbsp;</div></li><li><div>    private function _widget_label($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($data['is_editing_field'] === false) {&nbsp;</div></li><li><div>            // label&nbsp;</div></li><li><div>            $label = (isset($data['params']['label'])) ? $data['params']['label'] : '';&nbsp;</div></li><li><div>            $output .= '&lt;p class=&quot;clearfix&quot;&gt;&lt;label for=&quot;label&quot;&gt;'.__('Label:', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;input id=&quot;label&quot; type=&quot;text&quot; name=&quot;label&quot; value=&quot;'.$label.'&quot; /&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // widget feature: ability to choose whether the label should be inline (a placeholder)&nbsp;</div></li><li><div>    private function _widget_label_inline($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // only show extra validation for these types&nbsp;</div></li><li><div>        if (in_array($data['type'], array( 'input', 'textarea', 'select' )) && $data['is_editing_field'] === false) {&nbsp;</div></li><li><div>            // inline&nbsp;</div></li><li><div>            $is_label_within = (bool)(isset($data['params']['label_within']) && (int)$data['params']['label_within'] &gt; 0);&nbsp;</div></li><li><div>            $output .= '&lt;p class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;label&gt;'.__('Display label within input:', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>            $output .= '    &lt;span class=&quot;group&quot;&gt;';&nbsp;</div></li><li><div>            $output .= '        &lt;label class=&quot;radio&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;label_within&quot; value=&quot;1&quot; '.(($is_label_within === true) ? 'checked=&quot;checked&quot;' : '').' /&gt;'.__('Yes', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>            $output .= '        &lt;label class=&quot;radio&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;label_within&quot; value=&quot;0&quot; '.(($is_label_within === false) ? 'checked=&quot;checked&quot;' : '').' /&gt;'.__('No', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>            $output .= '    &lt;/span&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function _widget_date_order($data = array( )) {&nbsp;</div></li><li><div>        // date order&nbsp;</div></li><li><div>        $date_orders = array(&nbsp;</div></li><li><div>            'year_month_day' =&gt; array( 'mm/dd/yyyy', 'dd/mm/yyyy', 'yyyy/mm/dd' ), &nbsp;</div></li><li><div>            'year_month' =&gt; array( 'mm/yyyy', 'yyyy/mm' ), &nbsp;</div></li><li><div>            'year' =&gt; array( 'yyyy' ), &nbsp;</div></li><li><div>            'month' =&gt; array( 'mm' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get date orders from date type&nbsp;</div></li><li><div>        $orders = array( );&nbsp;</div></li><li><div>        if (isset($date_orders[$data['params']['date_type']])) {&nbsp;</div></li><li><div>            $orders = $date_orders[$data['params']['date_type']];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $orders = $date_orders['year_month_day'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($data['is_editing_field'] === false) {&nbsp;</div></li><li><div>            if (count($orders) === 1) {&nbsp;</div></li><li><div>                // show as hidden input&nbsp;</div></li><li><div>                $output .= '&lt;input type=&quot;hidden&quot; name=&quot;date_order&quot; value=&quot;'.$orders[0].'&quot; /&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $output .= '&lt;p class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>                $output .= '&lt;label for=&quot;date_order&quot;&gt;'.__('Order:', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>                $output .= '&lt;select id=&quot;date_order&quot; class=&quot;date_order&quot; name=&quot;date_order&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ($orders as $date_order) {&nbsp;</div></li><li><div>                    $is_selected = (isset($data['params']['date_order']) && $data['params']['date_order'] === $date_order) ? ' selected=&quot;selected&quot;' : '';&nbsp;</div></li><li><div>                    $output .= '&lt;option value=&quot;'.$date_order.'&quot; '.$is_selected.'&gt;'.$date_order.'&lt;/option&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $output .= '&lt;/select&gt;';&nbsp;</div></li><li><div>                $output .= '&lt;/p&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            if (isset($data['params']['date_order'])) {&nbsp;</div></li><li><div>                $output .= '&lt;input type=&quot;hidden&quot; name=&quot;date_order&quot; value=&quot;'.$data['params']['date_order'].'&quot; /&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $output .= '&lt;input type=&quot;hidden&quot; name=&quot;date_order&quot; value=&quot;'.$orders[0].'&quot; /&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function _widget_date_default_today($data = array( )) {&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $display_default_today = true;&nbsp;</div></li><li><div>        $is_default_today = (bool)(isset($data['params']['is_default_today']) && (int)$data['params']['is_default_today'] &gt; 0);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // in the case of a &quot;year&quot;, we don't offer the possibility to select today's date as the default&nbsp;</div></li><li><div>        if ($data['params']['date_type'] === 'year') {&nbsp;</div></li><li><div>            $display_default_today = false;&nbsp;</div></li><li><div>            $is_default_today = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($data['is_editing_field'] === false && $display_default_today === true) {&nbsp;</div></li><li><div>            $output .= '&lt;p class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;label&gt;'.__(&quot;Preselect today's date:&quot;, WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>            $output .= '    &lt;span class=&quot;group&quot;&gt;';&nbsp;</div></li><li><div>            $output .= '        &lt;label class=&quot;radio&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;is_default_today&quot; value=&quot;1&quot; '.(($is_default_today === true) ? 'checked=&quot;checked&quot;' : '').' /&gt;'.__('Yes', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>            $output .= '        &lt;label class=&quot;radio&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;is_default_today&quot; value=&quot;0&quot; '.(($is_default_today === false) ? 'checked=&quot;checked&quot;' : '').' /&gt;'.__('No', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>            $output .= '    &lt;/span&gt;';&nbsp;</div></li><li><div>            $output .= '&lt;/p&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $output .= '&lt;input type=&quot;hidden&quot; name=&quot;is_default_today&quot; value=&quot;'.(int)$is_default_today.'&quot; /&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // widget feature: data validation - is_required checkbox&nbsp;</div></li><li><div>    private function _widget_validation_is_required($data = array( )) {&nbsp;</div></li><li><div>        // is the field mandatory?&nbsp;</div></li><li><div>        $is_required = (bool)(isset($data['params']['required']) && (int)$data['params']['required'] &gt; 0);&nbsp;</div></li><li><div>        $output = '&lt;p class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>        $output .= '    &lt;label&gt;'.__('Is this field mandatory?', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>        $output .= '    &lt;span class=&quot;group&quot;&gt;';&nbsp;</div></li><li><div>        $output .= '        &lt;label class=&quot;radio&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;required&quot; value=&quot;1&quot; '.(($is_required === true) ? 'checked=&quot;checked&quot;' : '').' /&gt;'.__('Yes', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>        $output .= '        &lt;label class=&quot;radio&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;required&quot; value=&quot;0&quot; '.(($is_required === false) ? 'checked=&quot;checked&quot;' : '').' /&gt;'.__('No', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>        $output .= '    &lt;/span&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;/p&gt;';&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // widget feature: data validation&nbsp;</div></li><li><div>    private function _widget_validation($data = array( )) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // display hidden parameters in case we're editing display settings&nbsp;</div></li><li><div>        if ($data['is_editing_field'] === false) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // special case for firstname & lastname&nbsp;</div></li><li><div>            // we need to display the &quot;is_required&quot; in the form since they're not actual custom fields, they don't have &quot;field settings&quot;&nbsp;</div></li><li><div>            if (in_array($data['field'], array( 'firstname', 'lastname' ))) {&nbsp;</div></li><li><div>                $output .= $this-&gt;_widget_validation_is_required($data);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                // display hidden input since these settings are set on the custom field itself&nbsp;</div></li><li><div>                if (isset($data['params']['required'])) {&nbsp;</div></li><li><div>                    $required_value = (isset($data['params']['required']) && (int)$data['params']['required'] &gt; 0) ? 1 : 0;&nbsp;</div></li><li><div>                    $output .= '&lt;input type=&quot;hidden&quot; name=&quot;required&quot; value=&quot;'.$required_value.'&quot; /&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (isset($data['params']['validate'])) {&nbsp;</div></li><li><div>                    $validate_value = (isset($data['params']['validate']) && strlen(trim($data['params']['validate'])) &gt; 0) ? trim($data['params']['validate']) : '';&nbsp;</div></li><li><div>                    $output .= '&lt;input type=&quot;hidden&quot; name=&quot;validate&quot; value=&quot;'.$validate_value.'&quot; /&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            // validation&nbsp;</div></li><li><div>            if ($data['field'] === 'email') {&nbsp;</div></li><li><div>                // the email field is always mandatory, no questions asked&nbsp;</div></li><li><div>                $output .= '&lt;input type=&quot;hidden&quot; name=&quot;required&quot; value=&quot;1&quot; /&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $output .= $this-&gt;_widget_validation_is_required($data);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // extra validation rules&nbsp;</div></li><li><div>            $rules = array(&nbsp;</div></li><li><div>                'onlyNumberSp' =&gt; __('Numbers only', WYSIJA), &nbsp;</div></li><li><div>                'onlyLetterSp' =&gt; __('Letters only', WYSIJA), &nbsp;</div></li><li><div>                'onlyLetterNumber' =&gt; __('Alphanumerical ', WYSIJA), &nbsp;</div></li><li><div>                'phone' =&gt; __('Phone number, (+, -, #, (, ) and spaces allowed)', WYSIJA)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // only show extra validation for these types&nbsp;</div></li><li><div>            if (in_array($data['type'], array( 'input', 'textarea' ))) {&nbsp;</div></li><li><div>                $output .= '&lt;p class=&quot;clearfix&quot;&gt;';&nbsp;</div></li><li><div>                $output .= '    &lt;label&gt;'.__('Validate for:', WYSIJA).'&lt;/label&gt;';&nbsp;</div></li><li><div>                $output .= '    &lt;select name=&quot;validate&quot;&gt;';&nbsp;</div></li><li><div>                $output .= '        &lt;option value=&quot;&quot;&gt;'.__('Nothing', WYSIJA).'&lt;/option&gt;';&nbsp;</div></li><li><div>                foreach ($rules as $rule =&gt; $label) {&nbsp;</div></li><li><div>                    $is_selected = (isset($data['params']['validate']) && ($rule === $data['params']['validate'])) ? ' selected=&quot;selected&quot;' : '';&nbsp;</div></li><li><div>                    $output .= '    &lt;option value=&quot;'.$rule.'&quot;'.$is_selected.'&gt;'.$label.'&lt;/option&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $output .= '    &lt;/select&gt;';&nbsp;</div></li><li><div>                $output .= '&lt;/p&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.4</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.9/classes/wysija_view_back_config/" class="active">2.7.9</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.8/classes/wysija_view_back_config/" class="">2.7.8</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.6/classes/wysija_view_back_config/" class="">2.7.6</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.5/classes/wysija_view_back_config/" class="">2.7.5</a></li><li><a href="http://hookr.io/plugins/mailpoet-newsletters/2.7.4/classes/wysija_view_back_config/" class="">2.7.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>WYSIJA_view_back_config</li><li><span></span>MailPoet Newsletters</li><li><span></span>2.7.9</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>