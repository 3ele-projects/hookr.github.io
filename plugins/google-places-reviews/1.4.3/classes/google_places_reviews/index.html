<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="1.4.3" data-slug="google-places-reviews" data-type="class" data-id="80925"><head xmlns="http://www.w3.org/1999/xhtml"><title> google_places_reviews | class | Google Places Reviews | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="Google_Places_Reviews, class, plugin, google-places-reviews, 1.4.3" /><meta name="description" content="Google Places Reviews" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.25"}};!function(e,n,t){var a;function i(e){var t=n.createElement("canvas"),a=t.getContext&&t.getContext("2d"),i=String.fromCharCode;return!(!a||!a.fillText)&&(a.textBaseline="top",a.font="600 32px Arial","flag"===e?(a.fillText(i(55356,56806,55356,56826),0,0),3e3<t.toDataURL().length):"diversity"===e?(a.fillText(i(55356,57221),0,0),t=a.getImageData(16,16,1,1).data,a.fillText(i(55356,57221,55356,57343),0,0),(t=a.getImageData(16,16,1,1).data)[0],t[1],t[2],t[3],!0):("simple"===e?a.fillText(i(55357,56835),0,0):a.fillText(i(55356,57135),0,0),0!==a.getImageData(16,16,1,1).data[0]))}function o(e){var t=n.createElement("script");t.src=e,t.type="text/javascript",n.getElementsByTagName("head")[0].appendChild(t)}t.supports={simple:i("simple"),flag:i("flag"),unicode8:i("unicode8"),diversity:i("diversity")},t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.simple&&t.supports.flag&&t.supports.unicode8&&t.supports.diversity||(a=function(){t.readyCallback()},n.addEventListener?(n.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(e.attachEvent("onload",a),n.attachEvent("onreadystatechange",function(){"complete"===n.readyState&&t.readyCallback()})),(a=t.source||{}).concatemoji?o(a.concatemoji):a.wpemoji&&a.twemoji&&(o(a.twemoji),o(a.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=05076b926480e5a979f3b4f1320604db' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.25' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/google_places_reviews/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgoogle_places_reviews%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fgoogle_places_reviews%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-google-places-reviews-1.4.3-class-google_places_reviews","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="google_places_reviews" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to google-places-reviews." href="http://hookr.io/plugins/google-places-reviews/" class="plugin"><span property="name">google-places-reviews</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.4.3." href="http://hookr.io/plugins/google-places-reviews/1.4.3/" class="H_VERSION"><span property="name">1.4.3</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/google-places-reviews/1.4.3/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">google_places_reviews</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="20"><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/all/" title="All">All <span class="count badge">20</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="5"><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/hooks/" title="Hooks">Hooks <span class="count badge">5</span></a></li><li class="" data-id="action" data-count="2"><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/actions/" title="Actions">Actions <span class="count badge">2</span></a></li><li class="" data-id="filter" data-count="3"><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/filters/" title="Filters">Filters <span class="count badge">3</span></a></li><li class="active" data-id="class" data-count="3"><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/classes/" title="Classes">Classes <span class="count badge">3</span></a></li><li class="" data-id="constant" data-count="3"><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/constants/" title="Constants">Constants <span class="count badge">3</span></a></li><li class="" data-id="function" data-count="9"><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/functions/" title="Functions">Functions <span class="count badge">9</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>Google_Places_Reviews</strong></h1><p>Google Places Reviews.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/files/classes-widget/" class="file">/classes/widget.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="11" class="block" start="11"><li><div>class Google_Places_Reviews extends WP_Widget {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Plugin Options from Options Panel&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var mixed|void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Google API key&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $api_key;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Array of Private Options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since    1.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $widget_fields = array(&nbsp;</div></li><li><div>        'title' =&gt; '', &nbsp;</div></li><li><div>        'location' =&gt; '', &nbsp;</div></li><li><div>        'reference' =&gt; '', &nbsp;</div></li><li><div>        'place_id' =&gt; '', &nbsp;</div></li><li><div>        'place_type' =&gt; '', &nbsp;</div></li><li><div>        'cache' =&gt; '', &nbsp;</div></li><li><div>        'disable_title_output' =&gt; '', &nbsp;</div></li><li><div>        'widget_style' =&gt; 'Minimal Light', &nbsp;</div></li><li><div>        'review_filter' =&gt; '', &nbsp;</div></li><li><div>        'review_limit' =&gt; '5', &nbsp;</div></li><li><div>        'review_characters' =&gt; '1', &nbsp;</div></li><li><div>        'hide_header' =&gt; '', &nbsp;</div></li><li><div>        'hide_out_of_rating' =&gt; '', &nbsp;</div></li><li><div>        'hide_google_image' =&gt; '', &nbsp;</div></li><li><div>        'target_blank' =&gt; '1', &nbsp;</div></li><li><div>        'no_follow' =&gt; '1', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register widget with WordPress.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        parent::__construct(&nbsp;</div></li><li><div>            'gpr_widget', // Base ID&nbsp;</div></li><li><div>            'Google Places Reviews', // Name&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'classname' =&gt; 'google-places-reviews', &nbsp;</div></li><li><div>                'description' =&gt; __( 'Display user reviews for any location found on Google Places.', 'google-places-reviews' )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;options = get_option( 'googleplacesreviews_options' );&nbsp;</div></li><li><div>        //API key (muy importante!)&nbsp;</div></li><li><div>        $this-&gt;api_key = $this-&gt;options['google_places_api_key'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Hooks&nbsp;</div></li><li><div>        add_action( 'wp_enqueue_scripts', array( $this, 'frontend_widget_scripts' ) );&nbsp;</div></li><li><div>        add_action( 'admin_enqueue_scripts', array( $this, 'admin_widget_scripts' ) );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_gpr_free_clear_widget_cache', array( $this, 'clear_widget_cache' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Admin Widget Scripts&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @description: Load Widget JS Script ONLY on Widget page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $hook&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function admin_widget_scripts( $hook ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $suffix = defined( 'SCRIPT_DEBUG' ) && SCRIPT_DEBUG ? '' : '.min';&nbsp;</div></li><li><div>        $apikey = $this-&gt;options['google_places_api_key'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $hook == 'widgets.php' || ( $hook == 'customize.php' && defined( 'SITEORIGIN_PANELS_VERSION' ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_register_script( 'gpr_google_places_gmaps', 'https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&key=' . $apikey, array( 'jquery' ) );&nbsp;</div></li><li><div>            wp_enqueue_script( 'gpr_google_places_gmaps' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_register_script( 'gpr_widget_admin_tipsy', plugins_url( 'assets/js/gpr-tipsy' . $suffix . '.js', dirname( __FILE__ ) ), array( 'jquery' ) );&nbsp;</div></li><li><div>            wp_enqueue_script( 'gpr_widget_admin_tipsy' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_register_script( 'gpr_widget_admin_scripts', plugins_url( 'assets/js/admin-widget' . $suffix . '.js', dirname( __FILE__ ) ), array( 'jquery' ) );&nbsp;</div></li><li><div>            wp_enqueue_script( 'gpr_widget_admin_scripts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_localize_script( 'gpr_widget_admin_scripts', 'gpr_ajax_object', array(&nbsp;</div></li><li><div>                'ajax_url' =&gt; admin_url( 'admin-ajax.php' ), &nbsp;</div></li><li><div>                'i18n' =&gt; array(&nbsp;</div></li><li><div>                    'google_auth_error' =&gt; sprintf( __( '%1$sGoogle API Error:%2$s Due to recent changes by Google you must now add the Maps API to your existing API key in order to use the Location Lookup feature of the Google Places Widget. %3$sView documentation here%4$s', 'google-maps-pro' ), '&lt;strong&gt;', '&lt;/strong&gt;', '&lt;br&gt;&lt;a href=&quot;https://wordimpress.com/documentation/google-places-reviews/creating-your-google-places-api-key/&quot; target=&quot;_blank&quot; class=&quot;new-window&quot;&gt;', '&lt;/a&gt;' ) )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_register_style( 'gpr_widget_admin_tipsy', plugins_url( 'assets/css/gpr-tipsy' . $suffix . '.css', dirname( __FILE__ ) ) );&nbsp;</div></li><li><div>            wp_enqueue_style( 'gpr_widget_admin_tipsy' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_register_style( 'gpr_widget_admin_css', plugins_url( 'assets/css/admin-widget' . $suffix . '.css', dirname( __FILE__ ) ) );&nbsp;</div></li><li><div>            wp_enqueue_style( 'gpr_widget_admin_css' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Frontend Scripts&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @description: Adds Google Places Reviews Stylesheets&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function frontend_widget_scripts() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $suffix = defined( 'SCRIPT_DEBUG' ) && SCRIPT_DEBUG ? '' : '.min';&nbsp;</div></li><li><div>        $gpr_css = plugins_url( 'assets/css/google-places-reviews' . $suffix . '.css', dirname( __FILE__ ) );&nbsp;</div></li><li><div>        wp_register_style( 'gpr_widget', $gpr_css );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Front-end display of widget.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see WP_Widget::widget()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args&nbsp;</div></li><li><div>     * @param array $instance&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function widget( $args, $instance ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;options['disable_css'] !== 'on' ) {&nbsp;</div></li><li><div>            wp_enqueue_style( 'gpr_widget' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //@TODO: Remove usage&nbsp;</div></li><li><div>        extract( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //loop through options array and save variables for usage within function&nbsp;</div></li><li><div>        foreach ( $instance as $variable =&gt; $value ) {&nbsp;</div></li><li><div>            ${$variable} = ! isset( $instance[ $variable ] ) ? $this-&gt;widget_fields[ $variable ] : esc_attr( $instance[ $variable ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Enqueue individual CSS if debug is on; otherwise plugin uses min version&nbsp;</div></li><li><div>        if ( defined( 'SCRIPT_DEBUG' ) === true ) {&nbsp;</div></li><li><div>            $this-&gt;enqueue_widget_theme_scripts( $widget_style );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Check for a reference. If none, output error&nbsp;</div></li><li><div>        if ( $reference === 'No location set' && empty( $place_id ) || empty( $reference ) && $place_id === 'No location set' ) {&nbsp;</div></li><li><div>            $this-&gt;output_error_message( __( 'There is no location set for this widget yet.', 'google-places-reviews' ), 'error' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Title filter&nbsp;</div></li><li><div>        if ( isset( $title ) ) {&nbsp;</div></li><li><div>            $title = apply_filters( 'widget_title', $instance['title'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Open link in new window if set&nbsp;</div></li><li><div>        if ( $target_blank == '1' ) {&nbsp;</div></li><li><div>            $target_blank = 'target=&quot;_blank&quot; ';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $target_blank = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add nofollow relation if set&nbsp;</div></li><li><div>        if ( $no_follow == '1' ) {&nbsp;</div></li><li><div>            $no_follow = 'rel=&quot;nofollow&quot; ';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $no_follow = '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Use the new Google Places ID (rather than reference) - but don't break older widgets/shortcodes&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( ( empty( $reference ) || $reference === 'No Location Set' && ! empty( $place_id ) && $place_id !== 'No location set' ) || strlen( $place_id ) &lt; 80 ) {&nbsp;</div></li><li><div>            $google_places_url = add_query_arg(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'placeid' =&gt; $place_id, &nbsp;</div></li><li><div>                    'key' =&gt; $this-&gt;api_key&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'https://maps.googleapis.com/maps/api/place/details/json'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            //User is on old Google's reference ID&nbsp;</div></li><li><div>            $google_places_url = add_query_arg(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'reference' =&gt; $reference, &nbsp;</div></li><li><div>                    'key' =&gt; $this-&gt;api_key&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'https://maps.googleapis.com/maps/api/place/details/json'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        //serialize($instance) sets the transient cache from the $instance variable which can easily bust the cache once options are changed&nbsp;</div></li><li><div>        $transient_unique_id = substr( $place_id, 0, 25 );&nbsp;</div></li><li><div>        $response = get_transient( 'gpr_widget_api_' . $transient_unique_id );&nbsp;</div></li><li><div>        $widget_options = get_transient( 'gpr_widget_options_' . $transient_unique_id );&nbsp;</div></li><li><div>        $serialized_instance = serialize( $instance );&nbsp;</div></li><li><div>        $cache = strtolower( $cache );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Cache: cache option is enabled&nbsp;</div></li><li><div>        if ( $cache !== 'none' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Check for an existing copy of our cached/transient data&nbsp;</div></li><li><div>            // also check to see if widget options have updated; this will bust the cache&nbsp;</div></li><li><div>            if ( $response === false || $serialized_instance !== $widget_options ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // It wasn't there, so regenerate the data and save the transient&nbsp;</div></li><li><div>                //Get Time to Cache Data&nbsp;</div></li><li><div>                $expiration = $cache;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                //Assign Time to appropriate Math&nbsp;</div></li><li><div>                switch ( $expiration ) {&nbsp;</div></li><li><div>                    case '1 hour':&nbsp;</div></li><li><div>                        $expiration = 3600;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case '3 hours':&nbsp;</div></li><li><div>                        $expiration = 3600 * 3;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case '6 hours':&nbsp;</div></li><li><div>                        $expiration = 3600 * 6;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case '12 hours':&nbsp;</div></li><li><div>                        $expiration = 60 * 60 * 12;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case '1 day':&nbsp;</div></li><li><div>                        $expiration = 60 * 60 * 24;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case '2 days':&nbsp;</div></li><li><div>                        $expiration = 60 * 60 * 48;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case '1 week':&nbsp;</div></li><li><div>                        $expiration = 60 * 60 * 168;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Cache data wasn't there, so regenerate the data and save the transient&nbsp;</div></li><li><div>                $response = $this-&gt;get_reviews( $google_places_url );&nbsp;</div></li><li><div>                set_transient( 'gpr_widget_api_' . $transient_unique_id, $response, $expiration );&nbsp;</div></li><li><div>                set_transient( 'gpr_widget_options_' . $transient_unique_id, $serialized_instance, $expiration );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } //end response&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //No Cache option enabled;&nbsp;</div></li><li><div>            $response = $this-&gt;get_reviews( $google_places_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Error message&nbsp;</div></li><li><div>        if ( ! empty( $response-&gt;error_message ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;output_error_message( $response-&gt;error_message, 'error' );&nbsp;</div></li><li><div>            $this-&gt;delete_transient_cache( $transient_unique_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } //No Place ID or Reference set for this widget&nbsp;</div></li><li><div>        elseif ( empty( $reference ) && empty( $place_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;output_error_message( __( '&lt;strong&gt;INVALID REQUEST&lt;/strong&gt;: Please check that this widget has a Google Place ID set.', 'google-places-reviews' ), 'error' );&nbsp;</div></li><li><div>            $this-&gt;delete_transient_cache( $transient_unique_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } elseif ( isset( $response['error_message'] ) && ! empty( $response['error_message'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $error = '&lt;strong&gt;' . $response['status'] . '&lt;/strong&gt;: ' . $response['error_message'];&nbsp;</div></li><li><div>            $this-&gt;output_error_message( $error, 'error' );&nbsp;</div></li><li><div>            $this-&gt;delete_transient_cache( $transient_unique_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Widget Style&nbsp;</div></li><li><div>        $style = &quot;gpr-&quot; . sanitize_title( $widget_style ) . &quot;-style&quot;;&nbsp;</div></li><li><div>        // no 'class' attribute - add one with the value of width&nbsp;</div></li><li><div>        //@see http://wordpress.stackexchange.com/questions/18942/add-class-to-before-widget-from-within-a-custom-widget&nbsp;</div></li><li><div>        if ( ! empty( $before_widget ) && strpos( $before_widget, 'class' ) === false ) {&nbsp;</div></li><li><div>            $before_widget = str_replace( '&gt;', 'class=&quot;' . $style . '&quot;', $before_widget );&nbsp;</div></li><li><div>        } // there is 'class' attribute - append width value to it&nbsp;</div></li><li><div>        elseif ( ! empty( $before_widget ) && strpos( $before_widget, 'class' ) !== false ) {&nbsp;</div></li><li><div>            $before_widget = str_replace( 'class=&quot;', 'class=&quot;' . $style . ' ', $before_widget );&nbsp;</div></li><li><div>        } //no 'before_widget' at all so wrap widget with div&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $before_widget = '&lt;div class=&quot;google-places-reviews&quot;&gt;';&nbsp;</div></li><li><div>            $before_widget = str_replace( 'class=&quot;', 'class=&quot;' . $style . ' ', $before_widget );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Before widget */&nbsp;</div></li><li><div>        echo $before_widget;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if the title is set & the user hasn't disabled title output&nbsp;</div></li><li><div>        if ( ! empty( $title ) && isset( $disable_title_output ) && $disable_title_output !== '1' ) {&nbsp;</div></li><li><div>            /** Add class to before_widget from within a custom widget&nbsp;</div></li><li><div>         http://wordpress.stackexchange.com/questions/18942/add-class-to-before-widget-from-within-a-custom-widget&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>            // no 'class' attribute - add one with the value of width&nbsp;</div></li><li><div>            if ( ! empty( $before_title ) && strpos( $before_title, 'class' ) === false ) {&nbsp;</div></li><li><div>                $before_title = str_replace( '&gt;', ' class=&quot;gpr-widget-title&quot;&gt;', $before_title );&nbsp;</div></li><li><div>            } //widget title has 'class' attribute&nbsp;</div></li><li><div>            elseif ( ! empty( $before_title ) && strpos( $before_title, 'class' ) !== false ) {&nbsp;</div></li><li><div>                $before_title = str_replace( 'class=&quot;', 'class=&quot;gpr-widget-title ', $before_title );&nbsp;</div></li><li><div>            } //no 'title' at all so wrap widget with div&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $before_title = '&lt;h3 class=&quot;&quot;&gt;';&nbsp;</div></li><li><div>                $before_title = str_replace( 'class=&quot;', 'class=&quot;gpr-widget-title ', $before_title );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $after_title = empty( $after_title ) ? '&lt;/h3&gt;' : $after_title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            echo $before_title . $title . $after_title;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        include( GPR_PLUGIN_PATH . '/inc/widget-frontend.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update Widget&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @description: Saves the widget options&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function update( $new_instance, $old_instance ) {&nbsp;</div></li><li><div>        $instance = $old_instance;&nbsp;</div></li><li><div>        //loop through options array and save to new instance&nbsp;</div></li><li><div>        foreach ( $this-&gt;widget_fields as $field =&gt; $value ) {&nbsp;</div></li><li><div>            $instance[ $field ] = strip_tags( stripslashes( $new_instance[ $field ] ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $instance;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Widget Form&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @description: Responsible for outputting the backend widget form.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see WP_Widget::form()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function form( $instance ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //API Key Check:&nbsp;</div></li><li><div>        if ( ! isset( $this-&gt;options['google_places_api_key'] ) || empty( $this-&gt;options['google_places_api_key'] ) ) {&nbsp;</div></li><li><div>            $api_key_error = sprintf( __( '&lt;p&gt;&lt;strong&gt;Notice: &lt;/strong&gt;No Google Places API key detected. You will need to create an API key to use Google Places Reviews. API keys are manage through the &lt;a href=&quot;%1$s&quot; class=&quot;new-window&quot; target=&quot;_blank&quot;&gt;Google API Console&lt;/a&gt;. For more information please see &lt;a href=&quot;%2$s&quot;  target=&quot;_blank&quot;  class=&quot;new-window&quot; title=&quot;Google Places API Introduction&quot;&gt;this article&lt;/a&gt;.&lt;/p&gt; &lt;p&gt;Once you have obtained your API key enter it in the &lt;a href=&quot;%3$s&quot; title=&quot;Google Places Reviews Plugin Settings&quot;&gt;plugin settings page&lt;/a&gt;.&lt;/p&gt;', 'google-places-reviews' ), esc_url( 'https://code.google.com/apis/console/?noredirect' ), esc_url( 'https://developers.google.com/places/documentation/#Authentication' ), admin_url( '/options-general.php?page=googleplacesreviews' ) );&nbsp;</div></li><li><div>            $this-&gt;output_error_message( $api_key_error, 'error' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //loop through options array and save options to new instance&nbsp;</div></li><li><div>        foreach ( $this-&gt;widget_fields as $field =&gt; $value ) {&nbsp;</div></li><li><div>            ${$field} = ! isset( $instance[ $field ] ) ? $value : esc_attr( $instance[ $field ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        //Get the widget form&nbsp;</div></li><li><div>        include( GPR_PLUGIN_PATH . '/inc/widget-form.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * cURL (wp_remote_get) the Google Places API&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @description: CURLs the Google Places API with our url parameters and returns JSON response&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $url&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array|mixed&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_reviews( $url ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Sanitize the URL&nbsp;</div></li><li><div>        $url = esc_url_raw( $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Send API Call using WP's HTTP API&nbsp;</div></li><li><div>        $data = wp_remote_get( $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_wp_error( $data ) ) {&nbsp;</div></li><li><div>            $error_message = $data-&gt;get_error_message();&nbsp;</div></li><li><div>            $this-&gt;output_error_message( &quot;Something went wrong: $error_message&quot;, 'error' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Use curl only if necessary&nbsp;</div></li><li><div>        if ( empty( $data['body'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $ch = curl_init( $url );&nbsp;</div></li><li><div>            curl_setopt( $ch, CURLOPT_RETURNTRANSFER, true );&nbsp;</div></li><li><div>            curl_setopt( $ch, CURLOPT_HEADER, 0 );&nbsp;</div></li><li><div>            $data = curl_exec( $ch ); // Google response&nbsp;</div></li><li><div>            curl_close( $ch );&nbsp;</div></li><li><div>            $response = json_decode( $data, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $response = json_decode( $data['body'], true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Get Reviewers Avatars&nbsp;</div></li><li><div>        $response = $this-&gt;get_reviewers_avatars( $response );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Get Business Avatar&nbsp;</div></li><li><div>        $response = $this-&gt;get_business_avatar( $response );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Google response data in JSON format&nbsp;</div></li><li><div>        return $response;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get Reviewers Avatars&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Get avatar from Places API response or provide placeholder.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_reviewers_avatars( $response ) {&nbsp;</div></li><li><div>        // GPR Reviews Array.&nbsp;</div></li><li><div>        $gpr_reviews = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Includes Avatar image from user.&nbsp;</div></li><li><div>        if ( isset( $response['result']['reviews'] ) && ! empty( $response['result']['reviews'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Loop Google Places reviews.&nbsp;</div></li><li><div>            foreach ( $response['result']['reviews'] as $review ) {&nbsp;</div></li><li><div>                // Check to see if image is empty (no broken images).&nbsp;</div></li><li><div>                if ( ! empty( $review['profile_photo_url'] ) ) {&nbsp;</div></li><li><div>                    $avatar_img = $review['profile_photo_url'] . '?sz=100';&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $avatar_img = GPR_PLUGIN_URL . '/assets/images/mystery-man.png';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Add array image to review array.&nbsp;</div></li><li><div>                $review = array_merge( $review, array( 'avatar' =&gt; $avatar_img ) );&nbsp;</div></li><li><div>                // Add full review to $gpr_views.&nbsp;</div></li><li><div>                array_push( $gpr_reviews, $review );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Merge custom reviews array with response.&nbsp;</div></li><li><div>            $response = array_merge( $response, array( 'gpr_reviews' =&gt; $gpr_reviews ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $response;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get Business Avatar&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @description: Gets the business Avatar and&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_business_avatar( $response ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Business Avatar&nbsp;</div></li><li><div>        if ( isset( $response['result']['photos'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $request_url = add_query_arg(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'photoreference' =&gt; $response['result']['photos'][0]['photo_reference'], &nbsp;</div></li><li><div>                    'key' =&gt; $this-&gt;api_key, &nbsp;</div></li><li><div>                    'maxwidth' =&gt; '300', &nbsp;</div></li><li><div>                    'maxheight' =&gt; '300', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'https://maps.googleapis.com/maps/api/place/photo'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $response = array_merge( $response, array( 'place_avatar' =&gt; esc_url( $request_url ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $response;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enqueue Widget Theme Scripts&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Outputs the necessary scripts for the widget themes&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $widget_style&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function enqueue_widget_theme_scripts( $widget_style ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $suffix = defined( 'SCRIPT_DEBUG' ) && SCRIPT_DEBUG ? '' : '.min';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Determine which CSS to pull&nbsp;</div></li><li><div>        $css_raised = GPR_PLUGIN_URL . '/assets/css/gpr-theme-raised' . $suffix . '.css';&nbsp;</div></li><li><div>        $css_minimal = GPR_PLUGIN_URL . '/assets/css/gpr-theme-minimal' . $suffix . '.css';&nbsp;</div></li><li><div>        $css_shadow = GPR_PLUGIN_URL . '/assets/css/gpr-theme-shadow' . $suffix . '.css';&nbsp;</div></li><li><div>        $css_inset = GPR_PLUGIN_URL . '/assets/css/gpr-theme-inset' . $suffix . '.css';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $widget_style === 'Minimal Light' || $widget_style === 'Minimal Dark' ) {&nbsp;</div></li><li><div>            //enqueue theme style&nbsp;</div></li><li><div>            wp_register_style( 'grp_widget_style_minimal', $css_minimal );&nbsp;</div></li><li><div>            wp_enqueue_style( 'grp_widget_style_minimal' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $widget_style === 'Shadow Light' || $widget_style === 'Shadow Dark' ) {&nbsp;</div></li><li><div>            wp_register_style( 'grp_widget_style_shadow', $css_shadow );&nbsp;</div></li><li><div>            wp_enqueue_style( 'grp_widget_style_shadow' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $widget_style === 'Inset Light' || $widget_style === 'Inset Dark' ) {&nbsp;</div></li><li><div>            wp_register_style( 'grp_widget_style_inset', $css_inset );&nbsp;</div></li><li><div>            wp_enqueue_style( 'grp_widget_style_inset' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $widget_style === 'Raised Light' || $widget_style === 'Raised Dark' ) {&nbsp;</div></li><li><div>            wp_register_style( 'grp_widget_style_raised', $css_raised );&nbsp;</div></li><li><div>            wp_enqueue_style( 'grp_widget_style_raised' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Output Error Message&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $message&nbsp;</div></li><li><div>     * @param $style&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function output_error_message( $message, $style ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $style ) {&nbsp;</div></li><li><div>            case 'error' :&nbsp;</div></li><li><div>                $style = 'gpr-error';&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'warning' :&nbsp;</div></li><li><div>                $style = 'gpr-warning';&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            default :&nbsp;</div></li><li><div>                $style = 'gpr-warning';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $output = '&lt;div class=&quot;gpr-alert ' . $style . '&quot;&gt;';&nbsp;</div></li><li><div>        $output .= $message;&nbsp;</div></li><li><div>        $output .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo $output;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get Star Rating&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Returns the necessary output for Google Star Ratings&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param $rating&nbsp;</div></li><li><div>     * @param $unix_timestamp&nbsp;</div></li><li><div>     * @param $hide_out_of_rating&nbsp;</div></li><li><div>     * @param $hide_google_image&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_star_rating( $rating, $unix_timestamp, $hide_out_of_rating, $hide_google_image ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>        $rating_value = '&lt;p class=&quot;gpr-rating-value&quot; ' . ( ( $hide_out_of_rating === '1' ) ? ' style=&quot;display:none;&quot;' : '' ) . '&gt;&lt;span&gt;' . $rating . '&lt;/span&gt;' . __( ' out of 5 stars', 'google-places-reviews' ) . '&lt;/p&gt;';&nbsp;</div></li><li><div>        $is_gpr_header = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //AVATAR&nbsp;</div></li><li><div>        $google_img = '&lt;div class=&quot;gpr-google-logo-wrap&quot;' . ( ( $hide_google_image === '1' ) ? ' style=&quot;display:none;&quot;' : '' ) . '&gt;&lt;img src=&quot;' . GPR_PLUGIN_URL . '/assets/images/google-logo-small.png' . '&quot; class=&quot;gpr-google-logo-header&quot; title=&quot; ' . __( 'Reviewed from Google', 'google-places-reviews' ) . '&quot; alt=&quot;' . __( 'Reviewed from Google', 'google-places-reviews' ) . '&quot; /&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Header doesn't have a timestamp&nbsp;</div></li><li><div>        if ( $unix_timestamp ) {&nbsp;</div></li><li><div>            $is_gpr_header = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //continue with output&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $output .= '&lt;div class=&quot;star-rating-wrap&quot;&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;div class=&quot;star-rating-size&quot; style=&quot;width:' . ( 65 * $rating / 5 ) . 'px;&quot;&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>        $output .= '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Output rating next to stars for individual reviews&nbsp;</div></li><li><div>        if ( $is_gpr_header === false ) {&nbsp;</div></li><li><div>            $output .= $rating_value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Show timestamp for reviews&nbsp;</div></li><li><div>        if ( $unix_timestamp ) {&nbsp;</div></li><li><div>            $output .= '&lt;span class=&quot;gpr-rating-time&quot;&gt;' . $this-&gt;get_time_since( $unix_timestamp ) . '&lt;/span&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //Show overall rating value of review&nbsp;</div></li><li><div>        if ( $is_gpr_header === true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //Google logo&nbsp;</div></li><li><div>            if ( isset( $hide_google_image ) && $hide_google_image !== 1 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $output .= $google_img;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $output .= $rating_value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $output;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Time Since&nbsp;</div></li><li><div>     * Works out the time since the entry post, takes a an argument in unix time (seconds)&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    static public function get_time_since( $date, $granularity = 1 ) {&nbsp;</div></li><li><div>        $difference = time() - $date;&nbsp;</div></li><li><div>        $retval = '';&nbsp;</div></li><li><div>        $periods = array(&nbsp;</div></li><li><div>            'decade' =&gt; 315360000, &nbsp;</div></li><li><div>            'year' =&gt; 31536000, &nbsp;</div></li><li><div>            'month' =&gt; 2628000, &nbsp;</div></li><li><div>            'week' =&gt; 604800, &nbsp;</div></li><li><div>            'day' =&gt; 86400, &nbsp;</div></li><li><div>            'hour' =&gt; 3600, &nbsp;</div></li><li><div>            'minute' =&gt; 60, &nbsp;</div></li><li><div>            'second' =&gt; 1&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $periods as $key =&gt; $value ) {&nbsp;</div></li><li><div>            if ( $difference &gt;= $value ) {&nbsp;</div></li><li><div>                $time = floor( $difference / $value );&nbsp;</div></li><li><div>                $difference %= $value;&nbsp;</div></li><li><div>                $retval .= ( $retval ? ' ' : '' ) . $time . ' ';&nbsp;</div></li><li><div>                $retval .= ( ( $time &gt; 1 ) ? $key . 's' : $key );&nbsp;</div></li><li><div>                $granularity --;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $granularity == '0' ) {&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ' posted ' . $retval . ' ago';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * AJAX Clear Widget Cache&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function clear_widget_cache() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $_POST['transient_id_1'] ) && isset( $_POST['transient_id_2'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            delete_transient( $_POST['transient_id_1'] );&nbsp;</div></li><li><div>            delete_transient( $_POST['transient_id_2'] );&nbsp;</div></li><li><div>            echo __( 'Cache cleared', 'google-places-reviews' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            echo __( 'Error: Transient ID not set. Cache not cleared.', 'google-places-reviews' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        wp_die();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete Transient Cache&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Removes the transient cache when an error is displayed as to not cache error results&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function delete_transient_cache( $transient_unique_id ) {&nbsp;</div></li><li><div>        delete_transient( 'gpr_widget_api_' . $transient_unique_id );&nbsp;</div></li><li><div>        delete_transient( 'gpr_widget_options_' . $transient_unique_id );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/google-places-reviews/1.4.3/classes/google_places_reviews/" class="active">1.4.3</a></li><li><a href="http://hookr.io/plugins/google-places-reviews/1.4.2/classes/google_places_reviews/" class="">1.4.2</a></li><li><a href="http://hookr.io/plugins/google-places-reviews/1.4/classes/google_places_reviews/" class="">1.4</a></li><li><a href="http://hookr.io/plugins/google-places-reviews/1.3/classes/google_places_reviews/" class="">1.3</a></li><li><a href="http://hookr.io/plugins/google-places-reviews/1.2.1/classes/google_places_reviews/" class="">1.2.1</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>Google_Places_Reviews</li><li><span></span>Google Places Reviews</li><li><span></span>1.4.3</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>