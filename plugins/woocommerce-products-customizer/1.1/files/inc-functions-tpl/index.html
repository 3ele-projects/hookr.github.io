<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="1.1" data-slug="woocommerce-products-customizer" data-type="file" data-id="90281"><head xmlns="http://www.w3.org/1999/xhtml"><title> inc-functions-tpl | file | Woocommerce Products Customizer | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, woocommerce-products-customizer, 1.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=df238a1940dcd0b33ec2546d8923bdd2' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/inc-functions-tpl/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Finc-functions-tpl%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Finc-functions-tpl%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-woocommerce-products-customizer-1.1-file-inc-functions-tpl","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="inc-functions-tpl" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to woocommerce-products-customiz&hellip;." href="http://hookr.io/plugins/woocommerce-products-customizer/" class="plugin"><span property="name">woocommerce-products-customiz&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.1." href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/" class="H_VERSION"><span property="name">1.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">inc-functions-tpl</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="206"><a href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/all/" title="All">All <span class="count badge">206</span></a></li><li class="" data-id="new" data-count="1"><a href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/new/" title="New">New <span class="count badge">1</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="" data-id="class" data-count="60"><a href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/classes/" title="Classes">Classes <span class="count badge">60</span></a></li><li class="" data-id="constant" data-count="58"><a href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/constants/" title="Constants">Constants <span class="count badge">58</span></a></li><li class="" data-id="function" data-count="86"><a href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/functions/" title="Functions">Functions <span class="count badge">86</span></a></li><li class="" data-id="shortcode" data-count="2"><a href="http://hookr.io/plugins/woocommerce-products-customizer/1.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">2</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/inc/functions.tpl.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Appends the editor at the end of the selected page</span>&nbsp;</div></li><li><div><span class="comment"> * @param type $content</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>add_shortcode(&quot;wpc-editor&quot;, &quot;get_product_editor&quot;);&nbsp;</div></li><li><div>function get_product_editor($content)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div><span class="comment">//    $post_max_value_length=ini_get(&quot;suhosin.post.max_value_length&quot;);</span>&nbsp;</div></li><li><div><span class="comment">//    var_dump($post_max_value_length);</span>&nbsp;</div></li><li><div>  $wpc_page_id = get_option( 'wpc_page_id' );&nbsp;</div></li><li><div>  $current_page_id=  get_the_ID();&nbsp;</div></li><li><div>  if ( $wpc_page_id !=$current_page_id)&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  $product_id=$_GET[&quot;product_id&quot;];&nbsp;</div></li><li><div>  $product=get_product($product_id);&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $is_customizable=0;&nbsp;</div></li><li><div>  if($product_id)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if($product-&gt;product_type==&quot;variation&quot;)&nbsp;</div></li><li><div>          $is_customizable=  get_post_meta($product-&gt;parent-&gt;id, &quot;customizable-product&quot;, true);        &nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $is_customizable=  get_post_meta($product_id, &quot;customizable-product&quot;, true);        &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if(!isset($product_id))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      echo __(&quot;You have to select a customizable product first.&quot;, &quot;wpc&quot;);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else if(!$is_customizable)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      echo __(&quot;This product is not customizable.&quot;, &quot;wpc&quot;);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else &nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      get_wpc_product_customizer($product_id);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $output=  ob_get_contents();&nbsp;</div></li><li><div>  ob_end_clean();&nbsp;</div></li><li><div>  return $content.$output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function wpc_starts_with($haystack, $needle)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return $needle === &quot;&quot; || strpos($haystack, $needle) === 0;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function wpc_check_rule($objects, $rule)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $param=$rule[&quot;param&quot;];&nbsp;</div></li><li><div>  $value=$rule[&quot;value&quot;];&nbsp;</div></li><li><div>  $operator=$rule[&quot;operator&quot;];&nbsp;</div></li><li><div>  $results=array();&nbsp;</div></li><li><div>  foreach ($objects as $object)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $to_eval=&quot;if($object[$param] $operator $value) return true; else return false;&quot;;&nbsp;</div></li><li><div>      $evaluation=  eval($to_eval);&nbsp;</div></li><li><div>      array_push($results, $evaluation);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $results;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Builds the editor for a simple product or variations in the front</span>&nbsp;</div></li><li><div><span class="comment"> * @global object $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> * @global object $current_user</span>&nbsp;</div></li><li><div><span class="comment"> * @param type $product_id Product or Variation ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_wpc_product_customizer($product_id)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $product=get_product($product_id);&nbsp;</div></li><li><div><span class="comment">//    ob_start();</span>&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if(!has_part($product_id))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      _e( 'Error: No active part defined for this product. A customizable product should have at least one part defined.', 'wpc' );&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>  $product_price=$product-&gt;price;&nbsp;</div></li><li><div>  $shop_currency_symbol=get_woocommerce_currency_symbol();&nbsp;</div></li><li><div>  $generate_layers=  (get_option(&quot;wpc-generate-layers&quot;)===&quot;yes&quot;)?true:false;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if($product-&gt;product_type==&quot;variation&quot;)&nbsp;</div></li><li><div>      $normal_product_id=$product-&gt;parent-&gt;id;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $normal_product_id=  $product_id;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $clip_w=  get_post_meta($normal_product_id, &quot;clip_width&quot;, true);&nbsp;</div></li><li><div>  $canvas_w=800;&nbsp;</div></li><li><div>  $canvas_h=500;&nbsp;</div></li><li><div>  $clip_h=  get_post_meta($normal_product_id, &quot;clip_height&quot;, true);&nbsp;</div></li><li><div>  $clip_x=  get_post_meta($normal_product_id, &quot;clip_x&quot;, true);&nbsp;</div></li><li><div>  $clip_y=  get_post_meta($normal_product_id, &quot;clip_y&quot;, true);&nbsp;</div></li><li><div>  $clip_radius=  get_post_meta($normal_product_id, &quot;clip_radius&quot;, true);&nbsp;</div></li><li><div>  $clip_radius_rect=  get_post_meta($normal_product_id, &quot;clip_radius_rect&quot;, true);&nbsp;</div></li><li><div>  if(empty($clip_radius_rect))&nbsp;</div></li><li><div>      $clip_radius_rect=0;&nbsp;</div></li><li><div>  $clip_type=  get_post_meta($normal_product_id, &quot;clip_type&quot;, true);&nbsp;</div></li><li><div>  $clip_border=  get_post_meta($normal_product_id, &quot;clip_b_color&quot;, true);&nbsp;</div></li><li><div>  $output_w=  get_option(&quot;wpc-min-output-width&quot;);&nbsp;</div></li><li><div>  $output_loop_delay=  get_option(&quot;wpc-output-loop-delay&quot;);&nbsp;</div></li><li><div>  if(!$output_loop_delay)&nbsp;</div></li><li><div>      $output_loop_delay=1000;&nbsp;</div></li><li><div>  $svg_colorization=  get_option(&quot;wpc-svg-colorization&quot;);&nbsp;</div></li><li><div>  $wpc_palette_type=  get_option(&quot;wpc-color-palette&quot;);&nbsp;</div></li><li><div>  $palette= get_option(&quot;wpc-custom-palette&quot;);&nbsp;</div></li><li><div>  $palette_tpl=&quot;&quot;;&nbsp;</div></li><li><div>  $redirect_after=  get_option(&quot;wpc-redirect-after-cart&quot;);&nbsp;</div></li><li><div>  if(empty($redirect_after))&nbsp;</div></li><li><div>      $redirect_after=0;&nbsp;</div></li><li><div>  if(is_array($palette)&&!empty($palette))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach ($palette as $color)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $hex=str_replace(&quot;#&quot;, &quot;&quot;, $color);&nbsp;</div></li><li><div>          $palette_tpl.='&lt;span style=&quot;background-color: '.$color.'&quot; data-color=&quot;'.$hex.'&quot; class=&quot;wpc-custom-color&quot;&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if(isset($_GET[&quot;edit&quot;]))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $variation_id=$_GET[&quot;product_id&quot;];&nbsp;</div></li><li><div>      $cart_item_key=$_GET[&quot;edit&quot;];&nbsp;</div></li><li><div>      $data=$_SESSION[&quot;wpc_generated_data&quot;][$variation_id][$cart_item_key];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else if(isset($_GET[&quot;design_index&quot;]))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $current_user;&nbsp;</div></li><li><div>      $design_index=$_GET[&quot;design_index&quot;];&nbsp;</div></li><li><div>      $user_designs=get_user_meta($current_user-&gt;ID, 'wpc_saved_designs');&nbsp;</div></li><li><div>      $data=$user_designs[$design_index][2];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else if(isset($_GET[&quot;oid&quot;]))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $order_item_id=$_GET[&quot;oid&quot;];&nbsp;</div></li><li><div>      $sql=&quot;select meta_value FROM &quot;.$wpdb-&gt;prefix.&quot;woocommerce_order_itemmeta where order_item_id=$order_item_id and meta_key='wpc_data'&quot;;&nbsp;</div></li><li><div>      <span class="comment">//echo $sql;</span>&nbsp;</div></li><li><div>      $wpc_data=$wpdb-&gt;get_var($sql);&nbsp;</div></li><li><div>      $data=  unserialize($wpc_data);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if(isset($data)&&!empty($data))&nbsp;</div></li><li><div>  {        &nbsp;</div></li><li><div>      <span class="comment">//Useful when editing cart item</span>&nbsp;</div></li><li><div>      $data=  stripslashes_deep($data);&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;script&gt;&nbsp;</div></li><li><div>          var to_load=&lt;?php echo json_encode($data);?&gt;;&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;script&gt;&nbsp;</div></li><li><div>      var palette_tpl='&lt;?php echo $palette_tpl;?&gt;';&nbsp;</div></li><li><div>      var loading_msg='&lt;?php _e(&quot;Just a moment&quot;, &quot;wpc&quot;);?&gt;';&nbsp;</div></li><li><div>      var deletion_error_msg='&lt;?php _e(&quot;The deletion of this object is not allowed&quot;, &quot;wpc&quot;);?&gt;';&nbsp;</div></li><li><div>      var empty_object_msg='&lt;?php _e(&quot;The edition area is empty.&quot;, &quot;wpc&quot;);?&gt;';&nbsp;</div></li><li><div>      var global_variation_id=&lt;?php echo $product_id;?&gt;;&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;wpc-customizer&quot;&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;wpc-top-bar&quot;&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;text-btn selected&quot; data-id=&quot;#txt-tools-container&quot;&gt;&lt;?php echo __(&quot;Text&quot;, &quot;wpc&quot;);?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;shapes-btn&quot; data-id=&quot;#shape-tools-container&quot;&gt;&lt;?php echo __(&quot;Shapes&quot;, &quot;wpc&quot;);?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;images-btn&quot; data-id=&quot;#image-tools-container&quot;&gt;&lt;?php echo __(&quot;Images / Cliparts&quot;, &quot;wpc&quot;);?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;wpc-edition-area&quot;&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;wpc-tools-bar&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php get_tools_bar();?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;wpc-editor-container&quot; style=&quot;width: &lt;?php echo $canvas_w;?&gt;px;height:&lt;?php echo $canvas_h;?&gt;px;&quot; data-clip_w=&quot;&lt;?php echo $clip_w;?&gt;&quot; data-clip_h=&quot;&lt;?php echo $clip_h;?&gt;&quot; data-clip_x=&quot;&lt;?php echo $clip_x;?&gt;&quot; data-clip_r=&quot;&lt;?php echo $clip_radius;?&gt;&quot; data-clip_rr=&quot;&lt;?php echo $clip_radius_rect;?&gt;&quot; data-clip_y=&quot;&lt;?php echo $clip_y;?&gt;&quot; data-clip_type=&quot;&lt;?php echo $clip_type;?&gt;&quot; data-clip_border=&quot;&lt;?php echo $clip_border;?&gt;&quot; data-output_w=&quot;&lt;?php echo $output_w;?&gt;&quot; data-output_delay=&quot;&lt;?php echo $output_loop_delay;?&gt;&quot; data-svg_colorization=&quot;&lt;?php echo $svg_colorization;?&gt;&quot; data-palette_type=&quot;&lt;?php echo $wpc_palette_type;?&gt;&quot; data-print_layers=&quot;&lt;?php echo $generate_layers;?&gt;&quot;&gt;&nbsp;</div></li><li><div>              &lt;canvas id=&quot;wpc-editor&quot; &gt;&lt;/canvas&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;wpc-buttons-bar&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php get_buttons_bar();?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;wpc-parts-bar&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php get_parts($product_id);?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>              $download_btn=  get_option(&quot;wpc-download-btn&quot;);&nbsp;</div></li><li><div>              $preview_btn=  get_option(&quot;wpc-preview-btn&quot;);&nbsp;</div></li><li><div>              $cart_btn=  get_option(&quot;wpc-cart-btn&quot;);&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;action-btn-bar&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          if($preview_btn!==&quot;0&quot;)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;a id=&quot;preview-order&quot; class=&quot;wpc-button blue&quot;&gt;&lt;?php echo __(&quot;Preview&quot;, &quot;wpc&quot;);?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          if($download_btn!==&quot;0&quot;)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;a id=&quot;download-design&quot; class=&quot;wpc-button blue&quot;&gt;&lt;?php echo __(&quot;Download&quot;, &quot;wpc&quot;);?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          if($cart_btn!==&quot;0&quot;)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;div class='d-iblk f-right'&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;wpc-qty-container&quot; class=&quot;d-iblk p-relative&quot;&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;button&quot; value=&quot;-&quot; class=&quot;minus&quot;&gt;&nbsp;</div></li><li><div>                  &lt;input id=&quot;wpc-qty&quot; type=&quot;number&quot; step=&quot;1&quot; value=&quot;1&quot; class=&quot;input-text qty text&quot; min=&quot;1&quot; dntmesecondfocus=&quot;true&quot; uprice=&quot;&lt;?php echo &quot;$product_price&quot;;?&gt;&quot;&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;button&quot; value=&quot;+&quot; class=&quot;plus&quot;&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;span class='d-iblk v-align-t' id='wpc-price'&gt;&nbsp;</div></li><li><div>                  &lt;span id=&quot;currency&quot;&gt;&lt;?php echo &quot;$shop_currency_symbol&quot;;?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                  &lt;span id=&quot;total_order&quot;&gt;&lt;?php echo &quot;$product_price&quot;;?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>              &lt;/span&gt;&nbsp;</div></li><li><div>              &lt;a id='add-to-cart'  class=&quot;wpc-button blue v-align-t&quot; data-id=&quot;&lt;?php echo $product_id;?&gt;&quot;&gt;&lt;?php _e(&quot;Add to cart&quot;, &quot;wpc&quot;);?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;debug&quot; class=&quot;mg-top-10 w-100 d-iblk&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>  $modal='&lt;div class=&quot;modal fade wpc-modal&quot; id=&quot;wpc-modal&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; aria-labelledby=&quot;myModalLabel&quot; aria-hidden=&quot;true&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;modal-dialog&quot;&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;modal-content&quot;&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;modal-header&quot;&gt;&nbsp;</div></li><li><div>                &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;modal&quot; aria-hidden=&quot;true&quot;&gt;&times;&lt;/button&gt;&nbsp;</div></li><li><div>                &lt;h4 class=&quot;modal-title&quot; id=&quot;myModalLabel&quot;&gt;Preview&lt;/h4&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;modal-body&quot;&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;';&nbsp;</div></li><li><div>  array_push(wpc_retarded_actions::$code, $modal);&nbsp;</div></li><li><div>  add_action( 'wp_footer', array( 'wpc_retarded_actions', 'display_code' ), 10, 1 );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action('wp_head', 'get_js_variables');&nbsp;</div></li><li><div>function get_js_variables() {&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>      &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>          var jquery_calls_url = '&lt;?php echo WPC_URL; ?&gt;jquery_calls.php';&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if a product contains at least one active part</span>&nbsp;</div></li><li><div><span class="comment"> * @param type $product_id Product ID</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function has_part($product_id)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $parts=  get_option(&quot;wpc-parts&quot;);&nbsp;</div></li><li><div>  $wc_product=get_product($product_id);&nbsp;</div></li><li><div>  if($wc_product-&gt;product_type==&quot;variable&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $variations=$wc_product-&gt;get_available_variations();&nbsp;</div></li><li><div>      foreach ($variations as $variation)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $variation_id=$variation['variation_id'];&nbsp;</div></li><li><div>          foreach ($parts as $part) {&nbsp;</div></li><li><div>              $part_key= sanitize_title($part);&nbsp;</div></li><li><div>              $part_media_id=  get_post_meta($variation_id, &quot;wpc_$part_key&quot;, true);&nbsp;</div></li><li><div>              if($part_media_id||$part_media_id==&quot;0&quot;)&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach ($parts as $part) {&nbsp;</div></li><li><div>          $part_key= sanitize_title($part);&nbsp;</div></li><li><div>          $part_media_id=  get_post_meta($product_id, &quot;wpc_$part_key&quot;, true);&nbsp;</div></li><li><div>          if($part_media_id||$part_media_id==&quot;0&quot;)&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create the parts bar at the bottom of the editor</span>&nbsp;</div></li><li><div><span class="comment"> * @param type $product_id Product ID</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_parts($product_id)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $parts=  get_option(&quot;wpc-parts&quot;);&nbsp;</div></li><li><div>  $is_first=true;&nbsp;</div></li><li><div>  foreach ($parts as $part) {&nbsp;</div></li><li><div>      $part_key= sanitize_title($part);&nbsp;</div></li><li><div>      $part_media_id=  get_post_meta($product_id, &quot;wpc_$part_key&quot;, true);&nbsp;</div></li><li><div>      if(!($part_media_id||$part_media_id==&quot;0&quot;))&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      $class=&quot;&quot;;&nbsp;</div></li><li><div>      if($is_first)&nbsp;</div></li><li><div>          $class=&quot;class='active'&quot;;&nbsp;</div></li><li><div>      $is_first=false;&nbsp;</div></li><li><div>      $img_ov_src=&quot;&quot;;&nbsp;</div></li><li><div>      $part_ov_img=get_post_meta($product_id, &quot;wpc_ov-$part_key&quot;, true);&nbsp;</div></li><li><div>      if(isset($part_ov_img))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $img_ov_src=  wp_get_attachment_url($part_ov_img);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $part_bg_img=get_post_meta($product_id, &quot;wpc_bg-$part_key&quot;, true);&nbsp;</div></li><li><div>      $img_bg_src=&quot;&quot;;&nbsp;</div></li><li><div>      if(isset($part_bg_img))&nbsp;</div></li><li><div>          $img_bg_src=  wp_get_attachment_url($part_bg_img);&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>      if($part_media_id==&quot;0&quot;)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;span data-id=&quot;&lt;?php echo $part_key;?&gt;&quot; data-url=&quot;&quot; &lt;?php echo $class;?&gt; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php echo $part;?&gt;&quot; data-bg=&quot;&lt;?php echo $img_bg_src;?&gt;&quot; data-ov=&quot;&lt;?php echo $img_ov_src;?&gt;&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php echo $part;?&gt;&nbsp;</div></li><li><div>          &lt;/span&gt;&nbsp;</div></li><li><div>          &lt;?php            &nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $part_img=wp_get_attachment_image_src($part_media_id, &quot;full&quot;);        &nbsp;</div></li><li><div>          $part_img_url=$part_img[0];&nbsp;</div></li><li><div>          $final_img_url=$part_img_url;&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;span data-id=&quot;&lt;?php echo $part_key;?&gt;&quot; data-url=&quot;&lt;?php echo $final_img_url;?&gt;&quot; &lt;?php echo $class;?&gt; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php echo $part;?&gt;&quot; data-bg=&quot;&lt;?php echo $img_bg_src;?&gt;&quot; data-ov=&quot;&lt;?php echo $img_ov_src;?&gt;&quot;&gt;&nbsp;</div></li><li><div>              &lt;img src=&quot;&lt;?php echo $part_img_url;?&gt;&quot;&gt;&nbsp;</div></li><li><div>          &lt;/span&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates the editor buttons bar (Preview, Download, Save for later, Add to cart)</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_buttons_bar()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&lt;!--        &lt;button id=&quot;zoom-in-btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;Zoom in&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;zoom-out-btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;Zoom out&quot;&gt;&lt;/button&gt;--&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;grid-btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;Grid&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;clear_all_btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Clear all&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;delete_btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Delete&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;copy_paste_btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Duplicate&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;send_to_back_btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Send to back&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;bring_to_front_btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Bring to front&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;flip_h_btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Flip horizontally&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;flip_v_btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Flip vertically&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;align_h_btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Center horizontally&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;align_v_btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Center vertically&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;undo-btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Undo&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>      &lt;button id=&quot;redo-btn&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Redo&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/button&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create the tools group (text, shape, images and user saved designs)</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_tools_bar()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  get_text_tools();&nbsp;</div></li><li><div>  get_shape_tools();&nbsp;</div></li><li><div>  get_image_tools();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates text elements tools</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_text_tools()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $fonts=get_option(&quot;wpc-fonts&quot;);&nbsp;</div></li><li><div>  if(empty($fonts))&nbsp;</div></li><li><div>      $fonts=  get_default_fonts ();&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;txt-tools-container&quot; style=&quot;display: block;&quot;&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;d-iblk&quot; style=&quot;width: 200px;&quot;&gt;&nbsp;</div></li><li><div>          &lt;textarea id=&quot;new-text&quot; placeholder=&quot;&lt;?php _e(&quot;Enter your texte here...&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>          &lt;a id=&quot;add-text-btn&quot; class=&quot;wpc-button blue&quot;&gt;&lt;?php _e(&quot;Add&quot;, &quot;wpc&quot;);?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;d-iblk&quot;&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;checkbox&quot; id=&quot;underline-cb&quot; class=&quot;custom-cb&quot;&gt;            &nbsp;</div></li><li><div>          &lt;label for=&quot;underline-cb&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Underline&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          &lt;input type=&quot;checkbox&quot; id=&quot;bold-cb&quot; class=&quot;custom-cb&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;bold-cb&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Bold&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          &lt;span id=&quot;txt-outline-color-selector&quot; class=&quot;color-selector border-color-selector&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Outline color&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;br&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;checkbox&quot; id=&quot;italic-cb&quot; class=&quot;custom-cb&quot;&gt;&nbsp;</div></li><li><div>          &lt;label for=&quot;italic-cb&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Italic&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/label&gt;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          &lt;span id=&quot;txt-color-selector&quot; style=&quot;background-color: #C6C4C4;&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Text color&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;span id=&quot;txt-bg-color-selector&quot; class=&quot;bg-color-selector&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Background color&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;d-iblk&quot;&gt;&nbsp;</div></li><li><div>          &lt;div&gt;&nbsp;</div></li><li><div>              &lt;?php _e(&quot;Font family: &quot;, &quot;wpc&quot;);?&gt;&nbsp;</div></li><li><div>              &lt;select id=&quot;font-family-selector&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php &nbsp;</div></li><li><div>                      foreach ($fonts as $font)&nbsp;</div></li><li><div>                      {&nbsp;</div></li><li><div>                          $font_label=$font[0];&nbsp;</div></li><li><div>                          echo &quot;&lt;option&gt;$font_label&lt;/option&gt;&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>                  &nbsp;</div></li><li><div>              &lt;/select&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;mg-top-10&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e(&quot;Font size: &quot;, &quot;wpc&quot;);?&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;font-size-slider&quot; class=&quot;noUiSlider horizontal&quot; data-min=&quot;10&quot; data-max=&quot;80&quot; data-step=&quot;1&quot; data-start=&quot;30&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;d-iblk&quot;&gt;&nbsp;</div></li><li><div>          &lt;div&gt;&nbsp;</div></li><li><div>              &lt;?php _e(&quot;Outline width: &quot;, &quot;wpc&quot;);?&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;o-thickness-slider&quot; class=&quot;noUiSlider horizontal&quot; data-min=&quot;0&quot; data-max=&quot;10&quot; data-step=&quot;1&quot; data-start=&quot;0&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;mg-top-20&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e(&quot;Opacity: &quot;, &quot;wpc&quot;);?&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;opacity-slider&quot; class=&quot;noUiSlider horizontal&quot; data-min=&quot;0&quot; data-max=&quot;1&quot; data-step=&quot;0.1&quot; data-start=&quot;1&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates shapes elements tools</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_shape_tools()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;shape-tools-container&quot; style=&quot;display: none;&quot;&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;d-iblk&quot;&gt;&nbsp;</div></li><li><div>          &lt;div&gt;&nbsp;</div></li><li><div>              &lt;a class=&quot;square&quot; id=&quot;square-btn&quot;&gt;&lt;/a&gt;&nbsp;</div></li><li><div>              &lt;a class=&quot;r-square&quot; id=&quot;r-square-btn&quot;&gt;&lt;/a&gt;&nbsp;</div></li><li><div>              &lt;a class=&quot;circle&quot; id=&quot;circle-btn&quot;&gt;&lt;/a&gt;&nbsp;</div></li><li><div>              &lt;a class=&quot;triangle&quot; id=&quot;triangle-btn&quot;&gt;&lt;/a&gt;&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;d-iblk&quot;&gt;&nbsp;</div></li><li><div>                  &lt;a class=&quot;polygon&quot; id=&quot;polygon-btn&quot;&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                  &lt;select id=&quot;polygon-nb-points&quot; class=&quot;mg-top-5 v-align-t&quot;&gt;&nbsp;</div></li><li><div>                      &lt;option&gt;5&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;option&gt;6&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;option&gt;7&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;option&gt;8&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;option&gt;9&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;option&gt;10&lt;/option&gt;&nbsp;</div></li><li><div>                  &lt;/select&gt;&nbsp;</div></li><li><div>                  &lt;a class=&quot;star&quot; id=&quot;star-btn&quot;&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                      &lt;select id=&quot;star-nb-points&quot; class=&quot;mg-top-5 v-align-t&quot;&gt;&nbsp;</div></li><li><div>                          &lt;option&gt;5&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option&gt;6&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option&gt;7&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option&gt;8&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option&gt;9&lt;/option&gt;&nbsp;</div></li><li><div>                          &lt;option&gt;10&lt;/option&gt;&nbsp;</div></li><li><div>                      &lt;/select&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;d-iblk v-align-t mg-left-15&quot;&gt;&nbsp;</div></li><li><div>          &lt;span id=&quot;shape-outline-color-selector&quot; class=&quot;color-selector border-color-selector mg-top-5&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Outline color&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;br&gt;&nbsp;</div></li><li><div>          &lt;span id=&quot;shape-bg-color-selector&quot; class=&quot;bg-color-selector mg-top-10&quot; data-placement=&quot;top&quot; data-original-title=&quot;&lt;?php _e(&quot;Background color&quot;, &quot;wpc&quot;);?&gt;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div class=&quot;d-iblk v-align-t mg-left-15&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;mg-top-5&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e(&quot;Outline width:&quot;, &quot;wpc&quot;);?&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;shape-thickness-slider&quot; class=&quot;noUiSlider horizontal&quot; data-min=&quot;0&quot; data-max=&quot;10&quot; data-step=&quot;1&quot; data-start=&quot;0&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;mg-top-20&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php _e(&quot;Opacity:&quot;, &quot;wpc&quot;);?&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;shape-opacity-slider&quot; class=&quot;noUiSlider horizontal&quot; data-min=&quot;0&quot; data-max=&quot;1&quot; data-step=&quot;0.1&quot; data-start=&quot;1&quot;&gt;&lt;/div&gt;          &nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates images/vectors elements tools</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_image_tools()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;image-tools-container&quot; style=&quot;display: none;&quot;&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;img-effects-container&quot;&gt;&nbsp;</div></li><li><div>              &lt;div&gt;&nbsp;</div></li><li><div>                   &lt;input type=&quot;checkbox&quot; id=&quot;grayscale&quot; class=&quot;custom-cb&quot;&gt;&nbsp;</div></li><li><div>                   &lt;label for=&quot;grayscale&quot; data-placement=&quot;top&quot; data-original-title=&quot;Grayscale&quot;&gt;&lt;?php _e(&quot;Grayscale&quot;, &quot;wpc&quot;);?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                   &lt;input type=&quot;checkbox&quot; id=&quot;invert&quot; class=&quot;custom-cb&quot;&gt;&nbsp;</div></li><li><div>                   &lt;label for=&quot;invert&quot; data-placement=&quot;top&quot; data-original-title=&quot;Invert&quot;&gt;&lt;?php _e(&quot;Invert&quot;, &quot;wpc&quot;);?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                   &lt;input type=&quot;checkbox&quot; id=&quot;sepia&quot; class=&quot;custom-cb&quot;&gt;&nbsp;</div></li><li><div>                   &lt;label for=&quot;sepia&quot; data-placement=&quot;top&quot; data-original-title=&quot;Sepia 1&quot;&gt;&lt;?php _e(&quot;Sepia 1&quot;, &quot;wpc&quot;);?&gt;&lt;/label&gt;                     &nbsp;</div></li><li><div>                   &lt;input type=&quot;checkbox&quot; id=&quot;sepia2&quot; class=&quot;custom-cb&quot;&gt;&nbsp;</div></li><li><div>                   &lt;label for=&quot;sepia2&quot; data-placement=&quot;top&quot; data-original-title=&quot;Sepia 2&quot;&gt;&lt;?php _e(&quot;Sepia 2&quot;, &quot;wpc&quot;);?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                   &lt;br&gt;&nbsp;</div></li><li><div>                   &lt;input type=&quot;checkbox&quot; id=&quot;blur&quot; class=&quot;custom-cb&quot;&gt;                     &nbsp;</div></li><li><div>                   &lt;label for=&quot;blur&quot; data-placement=&quot;top&quot; data-original-title=&quot;Blur&quot;&gt;&lt;?php _e(&quot;Blur&quot;, &quot;wpc&quot;);?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                   &lt;input type=&quot;checkbox&quot; id=&quot;sharpen&quot; class=&quot;custom-cb&quot;&gt;&nbsp;</div></li><li><div>                   &lt;label for=&quot;sharpen&quot; data-placement=&quot;top&quot; data-original-title=&quot;Sharpen&quot;&gt;&lt;?php _e(&quot;Sharpen&quot;, &quot;wpc&quot;);?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                   &lt;input type=&quot;checkbox&quot; id=&quot;emboss&quot; class=&quot;custom-cb&quot;&gt;&nbsp;</div></li><li><div>                   &lt;label for=&quot;emboss&quot; data-placement=&quot;top&quot; data-original-title=&quot;Emboss&quot;&gt;&lt;?php _e(&quot;Emboss&quot;, &quot;wpc&quot;);?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                   &lt;div id=&quot;clipart-bg-color-container&quot;&gt;&nbsp;</div></li><li><div>                       &lt;!--&lt;span id=&quot;clipart-bg-color-selector&quot; class=&quot;svg-color-selector&quot; data-placement=&quot;top&quot; data-original-title=&quot;Background color (SVG files only)&quot;&gt;&lt;/span&gt;--&gt;&nbsp;</div></li><li><div>                   &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;div&gt;&nbsp;</div></li><li><div>                  Opacity:&nbsp;</div></li><li><div>                  &lt;div id=&quot;img-opacity-slider&quot; class=&quot;noUiSlider horizontal&quot; data-min=&quot;0&quot; data-max=&quot;1&quot; data-step=&quot;0.1&quot; data-start=&quot;1&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;img-cliparts-container&quot; class=&quot;scrollable&quot;&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;scroll-container&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          $args=array(&nbsp;</div></li><li><div>              'numberposts' =&gt; -1, &nbsp;</div></li><li><div>              'post_type' =&gt; 'wpc-cliparts'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $cliparts_groups= get_posts($args);&nbsp;</div></li><li><div><span class="comment">//            if(!empty($cliparts_groups))</span>&nbsp;</div></li><li><div><span class="comment">//            {</span>&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;img-cliparts-accordion&quot; class=&quot;Accordion&quot; tabindex=&quot;0&quot;&gt;';&nbsp;</div></li><li><div>              echo '&lt;div class=&quot;AccordionPanel AccordionPanelOpen&quot; id=&quot;uploads-accordion&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;AccordionPanelTab&quot;&gt;'.__(&quot;Uploads&quot;, &quot;wpc&quot;).' (0)&lt;/div&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;AccordionPanelContent&quot; style=&quot;height: auto; display: block;&quot;&gt;Empty&lt;/div&gt;&nbsp;</div></li><li><div>                          &lt;/div&gt;';&nbsp;</div></li><li><div>              if(isset($_SESSION[&quot;wpc-facebook-images&quot;]))&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  echo '&lt;div class=&quot;AccordionPanel AccordionPanelOpen&quot; id=&quot;facebook-accordion&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;AccordionPanelTab&quot;&gt;Facebook images ('.count($_SESSION[&quot;wpc-facebook-images&quot;]).')&lt;/div&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;AccordionPanelContent&quot; style=&quot;height: auto; display: block;&quot;&gt;';&nbsp;</div></li><li><div>                                  foreach ($_SESSION[&quot;wpc-facebook-images&quot;] as $facebook_img)&nbsp;</div></li><li><div>                                  {&nbsp;</div></li><li><div>                                      echo &quot;&lt;span class='clipart-img'&gt;&lt;img src='$facebook_img'&gt;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              echo '&lt;/div&gt;&nbsp;</div></li><li><div>                          &lt;/div&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if(isset($_SESSION[&quot;wpc-instagram-images&quot;]))&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  echo '&lt;div class=&quot;AccordionPanel AccordionPanelOpen&quot; id=&quot;instagram-accordion&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;AccordionPanelTab&quot;&gt;Instagram images ('.count($_SESSION[&quot;wpc-instagram-images&quot;]).')&lt;/div&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;AccordionPanelContent&quot; style=&quot;height: auto; display: block;&quot;&gt;';&nbsp;</div></li><li><div>                                  foreach ($_SESSION[&quot;wpc-instagram-images&quot;] as $instagram_img)&nbsp;</div></li><li><div>                                  {&nbsp;</div></li><li><div>                                      echo &quot;&lt;span class='clipart-img'&gt;&lt;img src='$instagram_img'&gt;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                              echo '&lt;/div&gt;&nbsp;</div></li><li><div>                          &lt;/div&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              foreach($cliparts_groups as $cliparts_group)&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $cliparts= get_post_meta($cliparts_group-&gt;ID, &quot;wpc-cliparts&quot;, true);&nbsp;</div></li><li><div>                  $cliparts_prices= get_post_meta($cliparts_group-&gt;ID, &quot;wpc-cliparts-prices&quot;, true);&nbsp;</div></li><li><div>                  if(!empty($cliparts))&nbsp;</div></li><li><div>                  {&nbsp;</div></li><li><div>                          echo '&lt;div class=&quot;AccordionPanel&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;AccordionPanelTab&quot;&gt;'.$cliparts_group-&gt;post_title.' ('.count($cliparts).')&lt;/div&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;AccordionPanelContent&quot;&gt;';&nbsp;</div></li><li><div>                      &nbsp;</div></li><li><div>                      foreach($cliparts as $i=&gt;$clipart_id)&nbsp;</div></li><li><div>                      {&nbsp;</div></li><li><div>                          $attachment=wp_get_attachment_image_src($clipart_id, &quot;full&quot;);        &nbsp;</div></li><li><div>                          $attachment_url=$attachment[0];&nbsp;</div></li><li><div>                          $price=0;&nbsp;</div></li><li><div>                          if(isset($cliparts_prices[$i]))&nbsp;</div></li><li><div>                              $price=$cliparts_prices[$i];&nbsp;</div></li><li><div>                          echo &quot;&lt;span class='clipart-img'&gt;&lt;img src='$attachment_url' data-price='$price'&gt;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      echo '&lt;/div&gt;&nbsp;</div></li><li><div>                          &lt;/div&gt;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              echo '&lt;/div&gt;';&nbsp;</div></li><li><div><span class="comment"><span class="comment">//            }</span></span>&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php &nbsp;</div></li><li><div>          <span class="comment">//Create a conflict for admin post page so we disable it</span>&nbsp;</div></li><li><div>          if(!is_admin())&nbsp;</div></li><li><div>              get_upload_image_tools();&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              echo &quot;&lt;a id='wpc-add-img' class='button'&gt;Add image&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates uploads images tools</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_upload_image_tools()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $facebook_app_id=  get_option(&quot;wpc-facebook-app-id&quot;);&nbsp;</div></li><li><div>  $instagram_app_id=  get_option(&quot;wpc-instagram-app-id&quot;);&nbsp;</div></li><li><div>  $uploader=  get_option(&quot;wpc-uploader&quot;);&nbsp;</div></li><li><div>  $form_class=&quot;custom-uploader&quot;;&nbsp;</div></li><li><div>  if($uploader==&quot;native&quot;)&nbsp;</div></li><li><div>      $form_class=&quot;native-uploader&quot;&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;form id=&quot;userfile_upload_form&quot; class=&quot;&lt;?php echo $form_class;?&gt;&quot; method=&quot;POST&quot; action=&quot;&lt;?php echo admin_url( 'admin-ajax.php' );?&gt;&quot; enctype=&quot;multipart/form-data&quot;&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;nonce&quot; value=&quot;&lt;?php echo wp_create_nonce( 'wpc-picture-upload-nonce');?&gt;&quot;&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;action&quot; value=&quot;handle_picture_upload&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      if($uploader==&quot;native&quot;)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;file&quot; name=&quot;userfile&quot; id=&quot;userfile&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>      ?&gt;        &nbsp;</div></li><li><div>          &lt;div id=&quot;drop&quot;&gt;&nbsp;</div></li><li><div>             &lt;?php echo __(&quot;Drop your file here or&quot;, &quot;wpc&quot;);?&gt;&nbsp;</div></li><li><div>             &lt;a&gt;&lt;?php echo __(&quot;Select file&quot;, &quot;wpc&quot;);?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>             &lt;input type=&quot;file&quot; name=&quot;userfile&quot; /&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;ul&gt;&nbsp;</div></li><li><div>                      &lt;!-- The file uploads will be shown here --&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>  &lt;/form&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns user ordered designs</span>&nbsp;</div></li><li><div><span class="comment"> * @global object $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> * @param type $user_id</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_user_orders_designs($user_id)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>  $designs=array();&nbsp;</div></li><li><div>  $args = array(&nbsp;</div></li><li><div>                  'numberposts' =&gt; -1, &nbsp;</div></li><li><div>                  'meta_key' =&gt; '_customer_user', &nbsp;</div></li><li><div>                  'meta_value' =&gt; $user_id, &nbsp;</div></li><li><div>                  'post_type' =&gt; 'shop_order', &nbsp;</div></li><li><div>                  'post_status' =&gt; 'publish'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $orders=get_posts($args);&nbsp;</div></li><li><div>      foreach ($orders as $order)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $sql_1=&quot;select distinct order_item_id FROM &quot;.$wpdb-&gt;prefix.&quot;woocommerce_order_items where order_id=$order-&gt;ID&quot;;&nbsp;</div></li><li><div>          $order_items_id=$wpdb-&gt;get_col($sql_1);&nbsp;</div></li><li><div>          foreach ($order_items_id as $order_item_id) {&nbsp;</div></li><li><div>              $sql_2=&quot;select meta_key, meta_value FROM &quot;.$wpdb-&gt;prefix.&quot;woocommerce_order_itemmeta where order_item_id=$order_item_id and meta_key in ('_product_id', '_variation_id', 'wpc_data')&quot;;&nbsp;</div></li><li><div>              $order_item_metas=$wpdb-&gt;get_results($sql_2);&nbsp;</div></li><li><div>              $normalized_item_metas=array();&nbsp;</div></li><li><div>              foreach ($order_item_metas as $order_item_meta)&nbsp;</div></li><li><div>              {&nbsp;</div></li><li><div>                  $normalized_item_metas[$order_item_meta-&gt;meta_key]=$order_item_meta-&gt;meta_value;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if(!isset($normalized_item_metas[&quot;wpc_data&quot;]))&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>              if($normalized_item_metas[&quot;_variation_id&quot;])&nbsp;</div></li><li><div>                  $product_id=$normalized_item_metas[&quot;_variation_id&quot;];&nbsp;</div></li><li><div>              else&nbsp;</div></li><li><div>                  $product_id=$normalized_item_metas[&quot;_product_id&quot;];&nbsp;</div></li><li><div>              array_push($designs, array($product_id, $order-&gt;post_date, unserialize($normalized_item_metas[&quot;wpc_data&quot;]), $order_item_id));&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $designs;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action(&quot;init&quot;, &quot;set_variable_action_filters&quot;);&nbsp;</div></li><li><div>function set_variable_action_filters()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $woo_version=  wpc_get_woo_version_number();&nbsp;</div></li><li><div>  if($woo_version&lt;2.1)&nbsp;</div></li><li><div>      add_filter(&quot;woocommerce_in_cart_product_title&quot;, &quot;get_wpc_variable_attributes&quot;, 10, 2);&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      add_filter(&quot;woocommerce_cart_item_name&quot;, &quot;get_wpc_variable_attributes&quot;, 10, 2);&nbsp;</div></li><li><div>  if(get_option(&quot;wpc-parts-position-cart&quot;)==&quot;name&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if($woo_version&lt;2.1)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Old WC versions</span></span>&nbsp;</div></li><li><div>          add_filter(&quot;woocommerce_in_cart_product_title&quot;, &quot;get_wpc_data&quot;, 10, 3);&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//New WC versions</span></span>&nbsp;</div></li><li><div>          add_filter(&quot;woocommerce_cart_item_name&quot;, &quot;get_wpc_data&quot;, 10, 3);            &nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if($woo_version&lt;2.1)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//Old WC versions</span></span>&nbsp;</div></li><li><div>          add_filter(&quot;woocommerce_in_cart_product_thumbnail&quot;, &quot;get_wpc_data&quot;, 10, 3);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">//New WC versions</span></span>&nbsp;</div></li><li><div>          add_filter(&quot;woocommerce_cart_item_thumbnail&quot;, &quot;get_wpc_data&quot;, 10, 3);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class wpc_retarded_actions&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  public static $code=array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public static function display_code()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      foreach(self::$code as $i=&gt;$current_code)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          echo $current_code;&nbsp;</div></li><li><div>          unset(self::$code[$i]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_wpc_data($thumbnail_code, $values, $cart_item_key)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $variation_id=$values[&quot;variation_id&quot;];&nbsp;</div></li><li><div>  if(isset($_SESSION[&quot;wpc_generated_data&quot;][$variation_id][$cart_item_key]))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $thumbnail_code.=&quot;&lt;br&gt;&quot;;&nbsp;</div></li><li><div>      $customization_list=$_SESSION[&quot;wpc_generated_data&quot;][$variation_id][$cart_item_key];&nbsp;</div></li><li><div>      foreach ($customization_list as $customisation_key=&gt;$customization)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $image=$customization[&quot;image&quot;];&nbsp;</div></li><li><div>          $original_part_img_url=$customization[&quot;original_part_img&quot;];&nbsp;</div></li><li><div>          $modal_id=$variation_id.&quot;_&quot;.$cart_item_key.&quot;$customisation_key-&quot;. uniqid();&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          $thumbnail_code.='&lt;span&gt;&lt;a class=&quot;button&quot; data-toggle=&quot;modal&quot; data-target=&quot;#'.$modal_id.'&quot;&gt;'.ucfirst($customisation_key).'&lt;/a&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>          $modal='&lt;div class=&quot;modal fade wpc-modal wpc_part&quot; id=&quot;'.$modal_id.'&quot; tabindex=&quot;-1&quot; role=&quot;dialog&quot; aria-labelledby=&quot;myModalLabel&quot; aria-hidden=&quot;true&quot;&gt;&nbsp;</div></li><li><div>                          &lt;div class=&quot;modal-dialog&quot;&gt;&nbsp;</div></li><li><div>                            &lt;div class=&quot;modal-content&quot;&gt;&nbsp;</div></li><li><div>                              &lt;div class=&quot;modal-header&quot;&gt;&nbsp;</div></li><li><div>                                &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;modal&quot; aria-hidden=&quot;true&quot;&gt;&times;&lt;/button&gt;&nbsp;</div></li><li><div>                                &lt;h4 class=&quot;modal-title&quot; id=&quot;myModalLabel'.$modal_id.'&quot;&gt;Preview&lt;/h4&gt;&nbsp;</div></li><li><div>                              &lt;/div&gt;&nbsp;</div></li><li><div>                              &lt;div class=&quot;modal-body&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;div style=&quot;background-image:url('.$original_part_img_url.')&quot;&gt;&lt;img src=&quot;'.$image.'&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>                              &lt;/div&gt;&nbsp;</div></li><li><div>                            &lt;/div&gt;&nbsp;</div></li><li><div>                          &lt;/div&gt;&nbsp;</div></li><li><div>                        &lt;/div&gt;';&nbsp;</div></li><li><div>          array_push(wpc_retarded_actions::$code, $modal);&nbsp;</div></li><li><div>          add_action( 'wp_footer', array( 'wpc_retarded_actions', 'display_code' ), 10, 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $thumbnail_code.='&lt;a class=&quot;button alt&quot; href=&quot;'.get_wpc_url($variation_id).'&edit='.$cart_item_key.'&quot;&gt;Edit&lt;/a&gt;';&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else if(isset($_SESSION[&quot;wpc-uploaded-designs&quot;][$cart_item_key]))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $thumbnail_code.=&quot;&lt;br&gt;&quot;;&nbsp;</div></li><li><div>      $thumbnail_code.='&lt;span&gt;&lt;a class=&quot;button&quot; href='.$_SESSION[&quot;wpc-uploaded-designs&quot;][$cart_item_key].'&gt;'.__(&quot;Custom design&quot;, &quot;wpc&quot;).'&lt;/a&gt;&lt;/span&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $thumbnail_code;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_wpc_variable_attributes($code, $values)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if(isset($values[&quot;variation_id&quot;])&&!empty($values[&quot;variation_id&quot;])&&$values[&quot;variation&quot;]==&quot;wpc_data&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $product=  get_product($values[&quot;variation_id&quot;]);&nbsp;</div></li><li><div>      $attributes=$product-&gt;variation_data;&nbsp;</div></li><li><div>      if(is_array($attributes)&&!empty($attributes))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          foreach ($attributes as $attribute_key=&gt;$attribute_value)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $attribute_name=  wpc_get_product_attribute_name($product-&gt;id, $attribute_key);&nbsp;</div></li><li><div>              $code.=&quot;&lt;div&gt;&lt;strong&gt;$attribute_name&lt;/strong&gt;: $attribute_value&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $code;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//User my account page</span>&nbsp;</div></li><li><div>add_filter(&quot;woocommerce_order_item_quantity_html&quot;, &quot;get_user_account_products_meta&quot;, 11, 2);&nbsp;</div></li><li><div>function get_user_account_products_meta($output, $item)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $download_btn=  get_option(&quot;wpc-user-account-download-btn&quot;);&nbsp;</div></li><li><div>  if($download_btn!==&quot;0&quot;&&isset($item[&quot;variation_id&quot;])&&!empty($item[&quot;variation_id&quot;]))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $product=  get_product($item[&quot;variation_id&quot;]);&nbsp;</div></li><li><div>      $item_id=  uniqid();&nbsp;</div></li><li><div><span class="comment">//        var_dump($product);</span>&nbsp;</div></li><li><div>      ob_start();&nbsp;</div></li><li><div>      get_order_custom_admin_data($product, $item, $item_id);&nbsp;</div></li><li><div>      $admin_data=  ob_get_contents();&nbsp;</div></li><li><div>      ob_end_clean();&nbsp;</div></li><li><div>      $output.=$admin_data;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return the default fonts list</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_default_fonts()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $default=array(&nbsp;</div></li><li><div>      array(&quot;Shadows Into Light&quot;, &quot;http:<span class="comment">//fonts.googleapis.com/css?family=Shadows+Into+Light&quot;), </span>&nbsp;</div></li><li><div>      array(&quot;Droid Sans&quot;, &quot;http:<span class="comment">//fonts.googleapis.com/css?family=Droid+Sans:400, 700&quot;), </span>&nbsp;</div></li><li><div>      array(&quot;Abril Fatface&quot;, &quot;http:<span class="comment">//fonts.googleapis.com/css?family=Abril+Fatface&quot;), </span>&nbsp;</div></li><li><div>      array(&quot;Arvo&quot;, &quot;http:<span class="comment">//fonts.googleapis.com/css?family=Arvo:400, 700, 400italic, 700italic&quot;), </span>&nbsp;</div></li><li><div>      array(&quot;Lato&quot;, &quot;http:<span class="comment">//fonts.googleapis.com/css?family=Lato:400, 700, 400italic, 700italic&quot;), </span>&nbsp;</div></li><li><div>      array(&quot;Just Another Hand&quot;, &quot;http:<span class="comment">//fonts.googleapis.com/css?family=Just+Another+Hand&quot;)</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $default;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action('wp_enqueue_scripts', 'orion_scripts');&nbsp;</div></li><li><div>function orion_scripts() {&nbsp;</div></li><li><div>  wp_enqueue_script('jquery');&nbsp;</div></li><li><div>  $wpc_page_id = get_option( 'wpc_page_id' );&nbsp;</div></li><li><div>  if(is_admin())&nbsp;</div></li><li><div>      $current_page_id=0;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $current_page_id=  get_the_ID();&nbsp;</div></li><li><div>  if ( $wpc_page_id ==$current_page_id)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $fonts=get_option(&quot;wpc-fonts&quot;);&nbsp;</div></li><li><div>      if(empty($fonts))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $fonts=get_default_fonts();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($fonts as $font)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $font_label=$font[0];&nbsp;</div></li><li><div>          $font_url=$font[1];&nbsp;</div></li><li><div>          if($font_url)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $handler=  sanitize_title($font_label).&quot;-css&quot;;&nbsp;</div></li><li><div>              wp_register_style($handler, $font_url, array(), false, 'all');&nbsp;</div></li><li><div>              wp_enqueue_style($handler);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_style('simplegrid-css', WPC_URL . 'ressources/css/simplegrid.css', array(), '1.0', 'all');&nbsp;</div></li><li><div>  wp_enqueue_style('simplegrid-css');&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_script('nouislider-js', WPC_URL . 'ressources/js/noUiSlider/jquery.nouislider.min.js');&nbsp;</div></li><li><div>  wp_enqueue_script('nouislider-js', array('jquery'), false, false);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_script('qtip-js', WPC_URL . 'ressources/js/jquery.qtip-1.0.0-rc3.min.js');&nbsp;</div></li><li><div>  wp_enqueue_script('qtip-js', array('jquery'), false, false);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_style('nouislider-css', WPC_URL . 'ressources/js/noUiSlider/nouislider.css', array(), '1.0', 'all');&nbsp;</div></li><li><div>  wp_enqueue_style('nouislider-css');&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_script( 'jquery-blockui-wpc', WPC_URL . 'ressources/js/jquery-blockui/jquery.blockUI.min.js');&nbsp;</div></li><li><div>  wp_enqueue_script('jquery-blockui-wpc', array('jquery'), false, false);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_script('SpryAccordion-js', WPC_URL . 'ressources/js/spry/SpryAccordion.js');&nbsp;</div></li><li><div>  wp_enqueue_script('SpryAccordion-js', array('jquery'), false, false);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_style('SpryAccordion-css', WPC_URL . 'ressources/js/spry/SpryAccordion.css', array(), '1.0', 'all');&nbsp;</div></li><li><div>  wp_enqueue_style('SpryAccordion-css');&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_script('scroller-mouse-js', WPC_URL . 'ressources/js/perfectScrollbar/perfect-scrollbar-0.4.10.with-mousewheel.min.js');&nbsp;</div></li><li><div>  wp_enqueue_script('scroller-mouse-js', array('jquery', 'jquery-ui-mouse'), '1.1', false);&nbsp;</div></li><li><div>  wp_register_style('scroller-css', WPC_URL . 'ressources/js/perfectScrollbar/perfect-scrollbar-0.4.10.min.css', array(), '1.0', 'all');&nbsp;</div></li><li><div>  wp_enqueue_style('scroller-css');&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_style('colorpicker-css', WPC_URL . 'ressources/js/colorpicker/css/colorpicker.css');&nbsp;</div></li><li><div>  wp_enqueue_style('colorpicker-css');&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_script('colorpicker-js', WPC_URL . 'ressources/js/colorpicker/js/colorpicker.js');&nbsp;</div></li><li><div>  wp_enqueue_script('colorpicker-js', array('jQuery'));&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_script('fabric-js', WPC_URL . 'ressources/js/fabric.all.min.js');&nbsp;</div></li><li><div>  wp_enqueue_script('fabric-js', array('jquery'), '1.1', false);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $uploader=  get_option(&quot;wpc-uploader&quot;);&nbsp;</div></li><li><div>  if($uploader==&quot;native&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      wp_register_script('jquery-form-js', WPC_URL . 'ressources/js/jquery.form.js');&nbsp;</div></li><li><div>      wp_enqueue_script('jquery-form-js', array('jquery'), '1.1', false);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      wp_register_script('widget', WPC_URL . 'ressources/js/upload/js/jquery.ui.widget.js');&nbsp;</div></li><li><div>      wp_enqueue_script('widget', array('jquery'), '1.1', false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_register_style('upload-style', WPC_URL . 'ressources/js/upload/css/style.css');&nbsp;</div></li><li><div>      wp_enqueue_style('upload-style');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_register_script('fileupload', WPC_URL . 'ressources/js/upload/js/jquery.fileupload.js');&nbsp;</div></li><li><div>      wp_enqueue_script('fileupload', array('jquery'), '1.1', false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_register_script('iframe-transport', WPC_URL . 'ressources/js/upload/js/jquery.iframe-transport.js');&nbsp;</div></li><li><div>      wp_enqueue_script('iframe-transport', array('jquery'), '1.1', false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_register_script('knob', WPC_URL . 'ressources/js/upload/js/jquery.knob.js');&nbsp;</div></li><li><div>      wp_enqueue_script('knob', array('jquery'), '1.1', false);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_script('tooltip-js', WPC_URL . 'ressources/js/tooltip.js');&nbsp;</div></li><li><div>  wp_enqueue_script('tooltip-js', array('jquery'), '1.1', false);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_register_style('modal-css', WPC_URL . 'ressources/js/modal/modal.css');&nbsp;</div></li><li><div>  wp_enqueue_style('modal-css');&nbsp;</div></li><li><div>  wp_register_script('modal-js', WPC_URL . 'ressources/js/modal/modal.js');&nbsp;</div></li><li><div>  wp_enqueue_script('modal-js', array('jquery'));&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  wp_register_script('front-js', WPC_URL . 'ressources/js/front.js');&nbsp;</div></li><li><div>  wp_enqueue_script('front-js', array('jquery'), '1.1', false);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  wp_localize_script( 'front-js', 'ajax_object', &nbsp;</div></li><li><div>          array( 'ajax_url' =&gt; admin_url( 'admin-ajax.php' )) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_register_style('wpc-css', WPC_URL . 'ressources/css/wpc-front.css', array(), '1.0', 'all');&nbsp;</div></li><li><div>  wp_enqueue_style('wpc-css');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'woocommerce_after_add_to_cart_button', 'get_customize_btn');&nbsp;</div></li><li><div>function get_customize_btn() {&nbsp;</div></li><li><div>  $post_id=get_the_ID();&nbsp;</div></li><li><div>  $product=  get_product($post_id);&nbsp;</div></li><li><div>  $is_customizable=  get_post_meta($post_id, &quot;customizable-product&quot;, true);&nbsp;</div></li><li><div>  $design_from_blank = get_post_meta($post_id, 'wpc-design-from-blank', true);&nbsp;</div></li><li><div>  if($is_customizable)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if($design_from_blank)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          ?&gt;&lt;input type=&quot;button&quot; value=&quot;&lt;?php _e(&quot;Design from blank&quot;, &quot;wpc&quot;);?&gt;&quot; data-id=&quot;&lt;?php echo $post_id;?&gt;&quot; data-type=&quot;&lt;?php echo $product-&gt;product_type;?&gt;&quot; class=&quot;mg-top-10 wpc-customize-product&quot;/&gt;&lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action(&quot;woocommerce_add_cart_item&quot;, &quot;set_custom_upl_cart_item_data&quot;, 10, 2);&nbsp;</div></li><li><div>function set_custom_upl_cart_item_data($cart_item_data, $cart_item_key )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $product_id=$cart_item_data[&quot;product_id&quot;];&nbsp;</div></li><li><div>  $variation_id=$cart_item_data[&quot;variation_id&quot;];&nbsp;</div></li><li><div>  $element_id=$product_id;&nbsp;</div></li><li><div>  if(isset($variation_id)&&!empty($variation_id))&nbsp;</div></li><li><div>      $element_id=$variation_id;&nbsp;</div></li><li><div>  return $cart_item_data;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_filter(&quot;woocommerce_loop_add_to_cart_link&quot;, &quot;get_customize_btn_loop&quot;, 10, 2);&nbsp;</div></li><li><div>function get_customize_btn_loop($html, $product)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $is_customizable=  get_post_meta($product-&gt;id, &quot;customizable-product&quot;, true);&nbsp;</div></li><li><div>  if($is_customizable)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $design_from_blank = get_post_meta($product-&gt;id, 'wpc-design-from-blank', true);&nbsp;</div></li><li><div>      if($product-&gt;product_type==&quot;simple&quot;&&$design_from_blank)&nbsp;</div></li><li><div>          $html.='&lt;input type=&quot;button&quot; value=&quot;'. __(&quot;Design from blank&quot;, &quot;wpc&quot;).'&quot; data-id=&quot;'.$product-&gt;id.'&quot; data-type=&quot;'.$product-&gt;product_type.'&quot; class=&quot;mg-top-10 wpc-customize-product&quot;/&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>function save_pdf_output($generation_path, $input_file, $output_file)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $pdf = new TCPDF(PDF_PAGE_ORIENTATION, PDF_UNIT, PDF_PAGE_FORMAT, true, 'UTF-8', false);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $pdf-&gt;SetCreator(&quot;Woocommerce Products Designer by ORION&quot;);&nbsp;</div></li><li><div>  $pdf-&gt;SetAuthor('Woocommerce Products Designer by ORION');&nbsp;</div></li><li><div>  $pdf-&gt;SetTitle('Output');&nbsp;</div></li><li><div>  $pdf-&gt;setPrintHeader(false);&nbsp;</div></li><li><div>  $pdf-&gt;setPrintFooter(false);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// set default monospaced font</span>&nbsp;</div></li><li><div>  $pdf-&gt;SetDefaultMonospacedFont(PDF_FONT_MONOSPACED);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// set margins</span>&nbsp;</div></li><li><div>  $pdf-&gt;SetMargins(PDF_MARGIN_LEFT, PDF_MARGIN_TOP, PDF_MARGIN_RIGHT);&nbsp;</div></li><li><div>  $pdf-&gt;SetHeaderMargin(PDF_MARGIN_HEADER);&nbsp;</div></li><li><div>  $pdf-&gt;SetFooterMargin(PDF_MARGIN_FOOTER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// set auto page breaks</span>&nbsp;</div></li><li><div>  $pdf-&gt;SetAutoPageBreak(TRUE, PDF_MARGIN_BOTTOM);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// set image scale factor</span>&nbsp;</div></li><li><div>  $pdf-&gt;setImageScale(PDF_IMAGE_SCALE_RATIO);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// set some language-dependent strings (optional)</span>&nbsp;</div></li><li><div>  if (@file_exists(dirname(__FILE__).'/lang/eng.php')) {&nbsp;</div></li><li><div>          require_once(dirname(__FILE__).'/lang/eng.php');&nbsp;</div></li><li><div>          $pdf-&gt;setLanguageArray($l);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $pdf-&gt;AddPage();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// NOTE: Uncomment the following line to rasterize SVG image using the ImageMagick library.</span>&nbsp;</div></li><li><div>  <span class="comment">//$pdf-&gt;setRasterizeVectorImages(true);</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//    $pdf-&gt;ImageSVG($file=$input_file, $x='', $y='', $w='', $h='', $link='', $align='', $palign='', $border=0, $fitonpage=true);</span>&nbsp;</div></li><li><div><span class="comment">//    $pdf-&gt;Image($input_file, $x='', '', '', '', '', '', '', false, 300);</span>&nbsp;</div></li><li><div>  $pdf-&gt;Image($input_file, $x='', $y='', $w=0, $h=0, $type='', $link='', $align='', $resize=false, $dpi=300, $palign='', $ismask=false, $imgmask=false, $border=0, $fitbox=false, $hidden=false, $fitonpage=true, $alt=false, $altimgs=array());&nbsp;</div></li><li><div><span class="comment">//    $this-&gt;Image($input_file, 'C', 6, '', '', '', false, 'C', false, 300, 'C', false, false, 0, false, false, false);</span>&nbsp;</div></li><li><div><span class="comment">//    Image($file, $x='', $y='', $w=0, $h=0, $type='', $link='', $align='', $resize=false, $dpi=300, $palign='', $ismask=false, $imgmask=false, $border=0, $fitbox=false, $hidden=false, $fitonpage=false, $alt=false, $altimgs=array())</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pdf-&gt;Output($output_file, 'F');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_ajax_generate_downloadable_file', 'generate_downloadable_file' );&nbsp;</div></li><li><div>add_action( 'wp_ajax_nopriv_generate_downloadable_file', 'generate_downloadable_file' );&nbsp;</div></li><li><div>function generate_downloadable_file()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $final_canvas_parts=$_POST[&quot;final_canvas_parts&quot;];&nbsp;</div></li><li><div>  $tmp_dir=  uniqid();&nbsp;</div></li><li><div>  $upload_dir=  wp_upload_dir();&nbsp;</div></li><li><div>  $generation_path = $upload_dir[&quot;basedir&quot;].&quot;/WPC/$tmp_dir&quot;;&nbsp;</div></li><li><div>  $generation_url = $upload_dir[&quot;baseurl&quot;].&quot;/WPC/$tmp_dir&quot;;&nbsp;</div></li><li><div>  $variation_id=$_POST[&quot;variation_id&quot;];&nbsp;</div></li><li><div>  if(wp_mkdir_p($generation_path))&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $generation_url = $upload_dir[&quot;baseurl&quot;].&quot;/WPC/$tmp_dir&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $result=export_data_to_files($generation_path, $final_canvas_parts, $generation_url, false, $variation_id);&nbsp;</div></li><li><div>      if($result)&nbsp;</div></li><li><div>          echo json_encode(array(&nbsp;</div></li><li><div>              &quot;success&quot;=&gt;1, &nbsp;</div></li><li><div>              &quot;message&quot;=&gt;&quot;&lt;div class='wpc-success'&gt;&quot;.$result.&quot;&lt;/div&gt;&quot;, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          echo json_encode(array(&nbsp;</div></li><li><div>              &quot;success&quot;=&gt;0, &nbsp;</div></li><li><div>              &quot;message&quot;=&gt;&quot;&lt;div class='wpc-failure'&gt;&quot;.__( &quot;An error occured in the generation process. Please try again later.&quot;, &quot;wpc&quot;).&quot;&lt;/div&gt;&quot;, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      echo json_encode(array(&nbsp;</div></li><li><div>              &quot;success&quot;=&gt;0, &nbsp;</div></li><li><div>              &quot;message&quot;=&gt;&quot;&lt;div class='wpc-failure'&gt;&quot;.__( &quot;Can't create a generation directory...&quot;, &quot;wpc&quot;).&quot;&lt;/div&gt;&quot;, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          die();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Export data to archive</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $generation_dir Working directory path</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $data Data to export</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function export_data_to_files($generation_dir, $data, $generation_url, $force_zip, $variation_id)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $generate_layers=  (get_option(&quot;wpc-generate-layers&quot;)===&quot;yes&quot;)?true:false;&nbsp;</div></li><li><div>  $generate_pdf=  (get_option(&quot;wpc-generate-pdf&quot;)===&quot;yes&quot;)?true:false;&nbsp;</div></li><li><div>  $generate_zip=  (get_option(&quot;wpc-generate-zip&quot;)===&quot;yes&quot;)?true:false;&nbsp;</div></li><li><div>  $output_msg=false;&nbsp;</div></li><li><div>  $output_arr=array();&nbsp;</div></li><li><div>  foreach ($data as $part_key=&gt; $part_data)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $part_dir=&quot;$generation_dir/$part_key&quot;;&nbsp;</div></li><li><div>      if(!wp_mkdir_p($part_dir))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          echo &quot;Can't create part directory...&quot;;&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">//Layers</span>&nbsp;</div></li><li><div>      if($generate_layers)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $part_layers_dir=&quot;$part_dir/layers&quot;;&nbsp;</div></li><li><div>          if(!wp_mkdir_p($part_layers_dir))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              echo &quot;Can't create layers directory...&quot;;&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if(isset($part_data[&quot;layers&quot;]))&nbsp;</div></li><li><div>              $layers=$part_data[&quot;layers&quot;];&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          foreach ($layers as $layer_data)&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $usable_data=substr($layer_data, strpos($layer_data, &quot;, &quot;) + 1);&nbsp;</div></li><li><div>              $decodedData = base64_decode($usable_data);&nbsp;</div></li><li><div>              $file_name=  uniqid(&quot;wpc_layer_&quot;);&nbsp;</div></li><li><div>              $output_file_path=$part_layers_dir.&quot;/$file_name.png&quot;;&nbsp;</div></li><li><div>              $fp = fopen($output_file_path, 'wb');&nbsp;</div></li><li><div>              fwrite($fp, $decodedData);&nbsp;</div></li><li><div>              fclose($fp);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">//Part image</span>&nbsp;</div></li><li><div>      $usable_data=substr($part_data[&quot;image&quot;], strpos($part_data[&quot;image&quot;], &quot;, &quot;) + 1);&nbsp;</div></li><li><div>      $decodedData = base64_decode($usable_data);&nbsp;</div></li><li><div>      $file_name=  $part_key;&nbsp;</div></li><li><div>      $output_file_path=$part_dir.&quot;/$file_name.png&quot;;&nbsp;</div></li><li><div>      $fp = fopen($output_file_path, 'wb');&nbsp;</div></li><li><div>      fwrite($fp, $decodedData);&nbsp;</div></li><li><div>      fclose($fp);&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      if(!$generate_pdf)&nbsp;</div></li><li><div>          $output_msg.=&quot;&lt;div&gt;&quot;.ucfirst($part_key).__(&quot;: please click &quot;, &quot;wpc&quot;).&quot;&lt;a href='$generation_url/$part_key/$part_key.png' download='$part_key.png'&gt;&quot;.__( &quot;here&quot;, &quot;wpc&quot;).&quot;&lt;/a&gt; &quot;.__( &quot;to download&quot;, &quot;wpc&quot;).&quot;.&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      <span class="comment">//Part pdf</span>&nbsp;</div></li><li><div>      if($generate_pdf)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div><span class="comment">//            if ($nbCol==''|| $nbCol=='0'||$total_img==''||$total_img=='0') {</span>&nbsp;</div></li><li><div><span class="comment">//                $nbCol = get_option(&quot;wpc-outputpdf-img-col-number&quot;);</span>&nbsp;</div></li><li><div><span class="comment">//                $total_img = get_option(&quot;wpc-outputpdf-img-number&quot;);</span>&nbsp;</div></li><li><div><span class="comment"><span class="comment">//            }</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $output_pdf_file_path=$part_dir.&quot;/$part_key.pdf&quot;;&nbsp;</div></li><li><div>          <span class="comment">//save_pdf_output($generation_dir, $output_file_path, $output_pdf_file_path);</span>&nbsp;</div></li><li><div>          save_pdf_output($generation_dir, $output_file_path, $output_pdf_file_path);&nbsp;</div></li><li><div>          $download=false;&nbsp;</div></li><li><div>          if($download)&nbsp;</div></li><li><div>              $handler=&quot;download='$part_key.pdf'&quot;;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $handler=&quot;class='print_pdf'&quot;;&nbsp;</div></li><li><div>          $output_msg.=&quot;&lt;div&gt;&quot;.ucfirst($part_key).__(&quot;: please click &quot;, &quot;wpc&quot;).&quot;&lt;a href='$generation_url/$part_key/$part_key.pdf' $handler&gt;&quot;.__( &quot;here&quot;, &quot;wpc&quot;).&quot;&lt;/a&gt; &quot;.__( &quot;to download&quot;, &quot;wpc&quot;).&quot;.&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if($force_zip)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $zip_name=  uniqid(&quot;wpc_&quot;).&quot;.zip&quot;;&nbsp;</div></li><li><div>      $result=  create_zip($generation_dir, &quot;$generation_dir/$zip_name&quot;);&nbsp;</div></li><li><div>      if($result)&nbsp;</div></li><li><div>          return $zip_name;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else if($generate_zip)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $zip_name=  uniqid(&quot;wpc_&quot;).&quot;.zip&quot;;&nbsp;</div></li><li><div>      $result=  create_zip($generation_dir, &quot;$generation_dir/$zip_name&quot;);&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      if($result)&nbsp;</div></li><li><div>          $output_msg=&quot;&lt;div&gt;&quot;.__(&quot;The generation has been successfully completed. Please click &quot;, &quot;wpc&quot;).&quot;&lt;a href='$generation_url/$zip_name' download='$zip_name'&gt;&quot;.__( &quot;here&quot;, &quot;wpc&quot;).&quot;&lt;/a&gt; &quot;.__( &quot;to download your design&quot;, &quot;wpc&quot;).&quot;.&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $output_msg=false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $output_msg;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates a compressed zip file</span>&nbsp;</div></li><li><div><span class="comment"> * @param type $source Input directory path to zip</span>&nbsp;</div></li><li><div><span class="comment"> * @param type $destination Output file path</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function create_zip($source, $destination)&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if (!extension_loaded('zip') || !file_exists($source)) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $zip = new ZipArchive();&nbsp;</div></li><li><div>  if (!$zip-&gt;open($destination, ZIPARCHIVE::CREATE)) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $source = str_replace('\\', DIRECTORY_SEPARATOR, realpath($source));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (is_dir($source) === true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $files = new RecursiveIteratorIterator(new RecursiveDirectoryIterator($source), RecursiveIteratorIterator::SELF_FIRST);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ($files as $file)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $file = str_replace('\\', DIRECTORY_SEPARATOR, $file);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Ignore &quot;.&quot; and &quot;..&quot; folders</span>&nbsp;</div></li><li><div>          if( in_array(substr($file, strrpos($file, '/')+1), array('.', '..')) )&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $file = realpath($file);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (is_dir($file) === true)&nbsp;</div></li><li><div>              $zip-&gt;addEmptyDir(str_replace($source .DIRECTORY_SEPARATOR, '', $file . DIRECTORY_SEPARATOR));&nbsp;</div></li><li><div>          else if (is_file($file) === true)&nbsp;</div></li><li><div>              $zip-&gt;addFromString(str_replace($source . DIRECTORY_SEPARATOR, '', $file), file_get_contents($file));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else if (is_file($source) === true)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $zip-&gt;addFromString(basename($source), file_get_contents($source));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $zip-&gt;close();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_shortcode('wpc-products', 'get_wpc_products_display');&nbsp;</div></li><li><div>function get_wpc_products_display($atts) {&nbsp;</div></li><li><div>  extract( shortcode_atts( array(&nbsp;</div></li><li><div>      'cat' =&gt; '', &nbsp;</div></li><li><div>              'products' =&gt; '', &nbsp;</div></li><li><div>              'cols' =&gt; '3'&nbsp;</div></li><li><div> ), $atts, 'wpc-products' ) );&nbsp;</div></li><li><div>  $args = array( &nbsp;</div></li><li><div>          'posts_per_page' =&gt; 12, &nbsp;</div></li><li><div>          'post_type'=&gt; 'product', &nbsp;</div></li><li><div>          'product_cat'=&gt;$cat, &nbsp;</div></li><li><div>          'meta_query'=&gt; array(&nbsp;</div></li><li><div>                                  array(&nbsp;</div></li><li><div>                                      'key' =&gt; 'customizable-product', &nbsp;</div></li><li><div>                                      'value' =&gt; '1'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              $product_arr=array();&nbsp;</div></li><li><div>          if(!empty($products))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $product_arr=  explode(&quot;, &quot;, $products);&nbsp;</div></li><li><div>              $args[&quot;post__in&quot;]= $product_arr;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>  $products = get_posts( $args );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;div class='container wp-products-container wpc-grid wpc-grid-pad'&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $shop_currency_symbol=get_woocommerce_currency_symbol();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//var_dump($categories); wpc_custom</span>&nbsp;</div></li><li><div>      foreach ($products as $product) {&nbsp;</div></li><li><div>          $prod=get_product($product-&gt;ID);&nbsp;</div></li><li><div>                      $design_from_blank = get_post_meta($product-&gt;ID, 'wpc-design-from-blank', true);&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>              &lt;div class='wpc-col-1-&lt;?php echo $cols;?&gt; cat-item-ctn'&gt;&nbsp;</div></li><li><div>                  &lt;div class='cat-item'&gt;&nbsp;</div></li><li><div>                      &lt;h3&gt;&lt;?php  echo $product-&gt;post_title; ?&gt; &lt;span&gt;&lt;?php echo $shop_currency_symbol.''.$prod-&gt;price ?&gt;&lt;/span&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>                      &lt;?php  echo get_the_post_thumbnail($product-&gt;ID, 'medium'); ?&gt;&nbsp;</div></li><li><div>                      &lt;hr&gt;&nbsp;</div></li><li><div>                                              &lt;?php&nbsp;</div></li><li><div>                                                  &nbsp;</div></li><li><div>                                                  if($design_from_blank)&nbsp;</div></li><li><div>                                                  {&nbsp;</div></li><li><div>                                                      ?&gt;&lt;a href=&quot;&lt;?php echo get_wpc_url($product-&gt;ID) ?&gt;&quot; class='btn-choose'&gt; Design from blank&lt;/a&gt;&lt;?php&nbsp;</div></li><li><div>                                                  }&nbsp;</div></li><li><div>                                              ?&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&lt;?php &nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      $output=  ob_get_contents();&nbsp;</div></li><li><div>      ob_end_clean();&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_ajax_add_custom_design_to_cart', 'add_custom_design_to_cart_ajax' );&nbsp;</div></li><li><div>add_action( 'wp_ajax_nopriv_add_custom_design_to_cart', 'add_custom_design_to_cart_ajax' );&nbsp;</div></li><li><div>function add_custom_design_to_cart_ajax()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $woocommerce;&nbsp;</div></li><li><div>  $cart_url = $woocommerce-&gt;cart-&gt;get_cart_url();&nbsp;</div></li><li><div>  $final_canvas_parts=$_POST[&quot;final_canvas_parts&quot;];&nbsp;</div></li><li><div>  $variation_id=$_POST[&quot;variation_id&quot;];&nbsp;</div></li><li><div>  $quantity=$_POST[&quot;quantity&quot;];&nbsp;</div></li><li><div>  $cart_item_key=$_POST[&quot;cart_item_key&quot;];&nbsp;</div></li><li><div>  if($cart_item_key)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $_SESSION[&quot;wpc_generated_data&quot;][$variation_id][$cart_item_key]=$final_canvas_parts;&nbsp;</div></li><li><div>      $result=true;&nbsp;</div></li><li><div>      $message=&quot;&lt;div class='wpc_notification success f-right'&gt;Item successfully updated. &lt;a href='$cart_url'&gt;View Cart&lt;/a&gt;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $variable_product=get_product($variation_id);&nbsp;</div></li><li><div>      if($variable_product-&gt;product_type==&quot;simple&quot;)&nbsp;</div></li><li><div>          $product_id=$variation_id;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $product_id=$variable_product-&gt;parent-&gt;id;&nbsp;</div></li><li><div>      $result=$woocommerce-&gt;cart-&gt;add_to_cart( $product_id, $quantity, $variation_id, &quot;wpc_data&quot;, $final_canvas_parts);&nbsp;</div></li><li><div>      if(method_exists($woocommerce-&gt;cart, &quot;maybe_set_cart_cookies&quot;))&nbsp;</div></li><li><div>          $woocommerce-&gt;cart-&gt;maybe_set_cart_cookies();&nbsp;</div></li><li><div>      if($result)&nbsp;</div></li><li><div>          $message=&quot;&lt;div class='wpc_notification success f-right'&gt;&quot;.__( &quot;Product successfully added to basket.&quot;, &quot;wpc&quot;).&quot; &lt;a href='$cart_url'&gt;View Cart&lt;/a&gt;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $message=&quot;&lt;div class='wpc_notification failure f-right'&gt;&quot;.__( &quot;A problem occured. Please try again.&quot;, &quot;wpc&quot;).&quot;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo json_encode(array(&quot;success&quot;=&gt;$result, &nbsp;</div></li><li><div>                         &quot;message&quot;=&gt;$message, &nbsp;</div></li><li><div>                          &quot;url&quot;=&gt;$cart_url&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>  die();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_ajax_save_custom_design_for_later', 'save_custom_design_for_later_ajax' );&nbsp;</div></li><li><div>add_action( 'wp_ajax_nopriv_save_custom_design_for_later', 'save_custom_design_for_later_ajax' );&nbsp;</div></li><li><div>function save_custom_design_for_later_ajax()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $final_canvas_parts=$_POST[&quot;final_canvas_parts&quot;];&nbsp;</div></li><li><div>  $variation_id=$_POST[&quot;variation_id&quot;];&nbsp;</div></li><li><div>  $cart_item_key=&quot;&quot;;&nbsp;</div></li><li><div>  if(isset($_POST[&quot;cart_item_key&quot;]))&nbsp;</div></li><li><div>      $cart_item_key=$_POST[&quot;cart_item_key&quot;];&nbsp;</div></li><li><div>  $is_logged=0;&nbsp;</div></li><li><div>  $result=0;&nbsp;</div></li><li><div>  $message=&quot;&quot;;&nbsp;</div></li><li><div>  $url=wp_login_url(get_wpc_url($variation_id));&nbsp;</div></li><li><div>  if(is_user_logged_in())&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      global $current_user;&nbsp;</div></li><li><div>      get_currentuserinfo();&nbsp;</div></li><li><div>      $message=$current_user-&gt;ID;&nbsp;</div></li><li><div>      $is_logged=1;&nbsp;</div></li><li><div>      $today = date(&quot;Y-m-d H:i:s&quot;);     &nbsp;</div></li><li><div>      $result=add_user_meta($current_user-&gt;ID, &quot;wpc_saved_designs&quot;, array($variation_id, $today, $final_canvas_parts));&nbsp;</div></li><li><div>      if($result)&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $result=1;&nbsp;</div></li><li><div>          $message=&quot;&lt;div class='wpc_notification success'&gt;&quot;.__( &quot;The design has successfully been saved to your account.&quot;, &quot;wpc&quot;).&quot;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>          $user_designs=get_user_meta($current_user-&gt;ID, 'wpc_saved_designs');&nbsp;</div></li><li><div>          $newly_added_index=  count($user_designs)-1;&nbsp;</div></li><li><div>          $url=get_wpc_url($variation_id).&quot;&design_index=&quot;.$newly_added_index;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          $result=0;&nbsp;</div></li><li><div>          $message=&quot;&lt;div class='wpc_notification failure'&gt;&quot;.__( &quot;An error has occured. Please try again later or contact the administrator.&quot;, &quot;wpc&quot;).&quot;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if(!isset($_SESSION['wpc_designs_to_save']))&nbsp;</div></li><li><div>          $_SESSION['wpc_designs_to_save']=array();&nbsp;</div></li><li><div>      if(!isset($_SESSION['wpc_designs_to_save'][$variation_id]))&nbsp;</div></li><li><div>          $_SESSION['wpc_designs_to_save'][$variation_id]=array();&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      array_push($_SESSION['wpc_designs_to_save'][$variation_id], $final_canvas_parts);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo json_encode(array( &quot;is_logged&quot;=&gt;$is_logged, &nbsp;</div></li><li><div>                          &quot;success&quot;=&gt;$result, &nbsp;</div></li><li><div>                          &quot;message&quot;=&gt;$message, &nbsp;</div></li><li><div>                          &quot;url&quot;=&gt;$url&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  die();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'wp_ajax_handle_picture_upload', 'handle_picture_upload');&nbsp;</div></li><li><div>add_action( 'wp_ajax_nopriv_handle_picture_upload', 'handle_picture_upload');&nbsp;</div></li><li><div>function handle_picture_upload()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $nonce=$_POST['nonce'];&nbsp;</div></li><li><div>  if ( ! wp_verify_nonce( $nonce, 'wpc-picture-upload-nonce' ) )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $busted=__(&quot;Cheating huh?&quot;, &quot;wpc&quot;);&nbsp;</div></li><li><div>      die ($busted);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $upload_dir=  wp_upload_dir();&nbsp;</div></li><li><div>  $generation_path = $upload_dir[&quot;basedir&quot;];&nbsp;</div></li><li><div>  $generation_url = $upload_dir[&quot;baseurl&quot;];&nbsp;</div></li><li><div>  $file_name=  uniqid();&nbsp;</div></li><li><div>  $options=get_option('wpc-upload-options');&nbsp;</div></li><li><div>  $valid_formats=$options['wpc-upl-extensions'];&nbsp;</div></li><li><div>  if(!$valid_formats)&nbsp;</div></li><li><div>      $valid_formats = array(&quot;jpg&quot;, &quot;png&quot;, &quot;gif&quot;, &quot;bmp&quot;, &quot;jpeg&quot;, &quot;psd&quot;, &quot;eps&quot;);<span class="comment">//wpc-upl-extensions</span>&nbsp;</div></li><li><div><span class="comment">//    var_dump($valid_formats);</span>&nbsp;</div></li><li><div>  $name = $_FILES['userfile']['name'];&nbsp;</div></li><li><div>  $size = $_FILES['userfile']['size'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if(isset($_POST) and $_SERVER['REQUEST_METHOD'] == &quot;POST&quot;)&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if(strlen($name))&nbsp;</div></li><li><div>      {&nbsp;</div></li><li><div>          list($txt, $ext) = explode(&quot;.&quot;, $name);&nbsp;</div></li><li><div>          $ext=  strtolower($ext);&nbsp;</div></li><li><div>          if(in_array($ext, $valid_formats))&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>                  $tmp = $_FILES['userfile']['tmp_name'];&nbsp;</div></li><li><div>                  $success=0;&nbsp;</div></li><li><div>                  $message=&quot;&quot;;&nbsp;</div></li><li><div>                  $img_url=&quot;&quot;;&nbsp;</div></li><li><div>                  if(move_uploaded_file($tmp, $generation_path.&quot;/&quot;.$file_name.&quot;.$ext&quot;))&nbsp;</div></li><li><div>                  {&nbsp;</div></li><li><div>                      $min_width=  $options['wpc-min-upload-width'];&nbsp;</div></li><li><div>                      $min_height= $options['wpc-min-upload-height'];&nbsp;</div></li><li><div>                      $valid_formats_for_thumb=array(&quot;psd&quot;, &quot;eps&quot;);&nbsp;</div></li><li><div>                      if(in_array($ext, $valid_formats_for_thumb))&nbsp;</div></li><li><div>                      {&nbsp;</div></li><li><div>  <span class="comment">//                        $output_thumb=  uniqid().&quot;.png&quot;;</span>&nbsp;</div></li><li><div>                          $thumb_generation_success=  generate_adobe_thumb($generation_path, $file_name.&quot;.$ext&quot;, $file_name.&quot;.png&quot;);&nbsp;</div></li><li><div>                          <span class="comment">//If the thumb generation is a success, we force the extension to be png so the rest of the code can use it</span>&nbsp;</div></li><li><div>                          if($thumb_generation_success)&nbsp;</div></li><li><div>                              $ext=&quot;png&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if($min_width&gt;0||$min_height&gt;0)&nbsp;</div></li><li><div>                      {&nbsp;</div></li><li><div>                          list($width, $height, $type, $attr) = getimagesize($generation_path.&quot;/&quot;.$file_name.&quot;.$ext&quot;);&nbsp;</div></li><li><div>                          if(($min_width&gt;$width||$min_height&gt;$height)&&$ext!=&quot;svg&quot;)&nbsp;</div></li><li><div>                          {&nbsp;</div></li><li><div>                              $success=0;&nbsp;</div></li><li><div>                              $message=sprintf( __( 'Uploaded file dimensions: %1$spx x %2$spx, minimum required ', 'wpc' ), $width, $height );&nbsp;</div></li><li><div>                              if($min_width&gt;0&&$min_height&gt;0)&nbsp;</div></li><li><div>                                  $message.=&quot;dimensions: $min_height&quot;.&quot;px&quot;.&quot; x $min_height&quot;.&quot;px&quot;;&nbsp;</div></li><li><div>                              else if($min_width&gt;0)&nbsp;</div></li><li><div>                                  $message.=&quot;width: $min_width&quot;.&quot;px&quot;;&nbsp;</div></li><li><div>                              else if($min_height&gt;0)&nbsp;</div></li><li><div>                                  $message.=&quot;height: $min_height&quot;.&quot;px&quot;;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          else&nbsp;</div></li><li><div>                          {&nbsp;</div></li><li><div>                              $success=1;&nbsp;</div></li><li><div>                              $message=&quot;&lt;span class='clipart-img'&gt;&lt;img src='$generation_url/$file_name.$ext'&gt;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>                              $img_url=&quot;$generation_url/$file_name.$ext&quot;;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      else                    &nbsp;</div></li><li><div>                      {&nbsp;</div></li><li><div>                          $success=1;&nbsp;</div></li><li><div>                          $message=&quot;&lt;span class='clipart-img'&gt;&lt;img src='$generation_url/$file_name.$ext'&gt;&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>                          $img_url=&quot;$generation_url/$file_name.$ext&quot;;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if($success==0)&nbsp;</div></li><li><div>                          unlink ($generation_path.&quot;/&quot;.$file_name.&quot;.$ext&quot;);&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                  {&nbsp;</div></li><li><div>                      $success=0;&nbsp;</div></li><li><div>                      $message=__( 'An error occured during the upload. Please try again later', 'wpc' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>          {&nbsp;</div></li><li><div>              $success=0;&nbsp;</div></li><li><div>              $message=__( 'Incorrect file extension. Allowed extensions: ', 'wpc' ).  implode(&quot;, &quot;, $valid_formats);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          echo json_encode(&nbsp;</div></li><li><div>                              array(&nbsp;</div></li><li><div>                                      &quot;success&quot;=&gt;$success, &nbsp;</div></li><li><div>                                      &quot;message&quot;=&gt;$message, &nbsp;</div></li><li><div>                                      &quot;img_url&quot;=&gt;$img_url&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  die();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Woocommerce Products Customizer</li><li><span></span>1.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>