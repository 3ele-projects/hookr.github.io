<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.8.1" data-slug="buddypress" data-type="file" data-id="49198"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-forums-bbpress-bb-includes-functions-bb-template | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.8.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.17"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=f7fd2dae81a9a392232f51bd6c9a5a9c' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.17' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-forums-bbpress-bb-includes-functions-bb-template/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-forums-bbpress-bb-includes-functions-bb-template%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-forums-bbpress-bb-includes-functions-bb-template%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.1-file-bp-forums-bbpress-bb-includes-functions-bb-template","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-forums-bbpress-bb-includes-functions-bb-template" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.1." href="http://hookr.io/plugins/buddypress/2.8.1/" class="H_VERSION"><span property="name">2.8.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.8.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-forums-bbpress-bb-includes&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.1/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.1/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.1/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.1/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.1/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.1/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.1/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-forums/bbpress/bb-includes/functions.bb-template.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_load_template( $files, $globals = false, $action_arg = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $bb, $bbdb, $bb_current_user, $page, $bb_cache, &nbsp;</div></li><li><div>      $posts, $bb_post, $post_id, $topics, $topic, $topic_id, &nbsp;</div></li><li><div>      $forums, $forum, $forum_id, $tags, $tag, $tag_name, $user, $user_id, $view, &nbsp;</div></li><li><div>      $del_class, $bb_alt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $globals ) {&nbsp;</div></li><li><div>      foreach ( $globals as $global =&gt; $v ) {&nbsp;</div></li><li><div>          if ( !is_numeric($global) ) {&nbsp;</div></li><li><div>              $$global = $v;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              global $$v;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $files = (array) $files;&nbsp;</div></li><li><div>  $template = false;&nbsp;</div></li><li><div>  $default_template = false;&nbsp;</div></li><li><div>  $file_used = false;&nbsp;</div></li><li><div>  $default_file_used = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $files as $file ) {&nbsp;</div></li><li><div>      do_action( 'bb_' . $file, $action_arg );&nbsp;</div></li><li><div>      if ( false !== $template = bb_get_template( $file, false ) ) {&nbsp;</div></li><li><div>          $file_used = $file;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( !$default_template ) {&nbsp;</div></li><li><div>          if ( false !== $default_template = bb_get_default_template( $file ) ) {&nbsp;</div></li><li><div>              $default_file_used = $file;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$template && $default_template ) {&nbsp;</div></li><li><div>      $template = $default_template;&nbsp;</div></li><li><div>      $file_used = $default_file_used;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $template = apply_filters( 'bb_template', $template, $file_used );&nbsp;</div></li><li><div>  include( $template );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'bb_after_' . $file_used, $action_arg );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_template( $file, $default = true )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $bb;&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Skip theme loading in &quot;safe&quot; mode</span></span>&nbsp;</div></li><li><div>  if ( !isset( $bb-&gt;safemode ) || $bb-&gt;safemode !== true ) {&nbsp;</div></li><li><div>      if ( file_exists( bb_get_active_theme_directory() .  $file ) ) {&nbsp;</div></li><li><div>          return bb_get_active_theme_directory() .  $file;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$default ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return bb_get_default_template( $file );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_default_template( $file )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( file_exists( BB_DEFAULT_THEME_DIR . $file ) ) {&nbsp;</div></li><li><div>      return BB_DEFAULT_THEME_DIR . $file;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_header()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  bb_load_template( 'header.php' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_language_attributes( $xhtml = 0 )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $output = '';&nbsp;</div></li><li><div>  if ( $dir = bb_get_option( 'text_direction' ) ) {&nbsp;</div></li><li><div>      $output = 'dir=&quot;' . $dir . '&quot; ';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $lang = bb_get_option( 'language' ) ) {&nbsp;</div></li><li><div>      $output .= 'xml:lang=&quot;' . $lang . '&quot; ';&nbsp;</div></li><li><div>      if ( $xhtml &lt; '1.1' ) {&nbsp;</div></li><li><div>          $output .= 'lang=&quot;' . $lang . '&quot;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo ' ' . rtrim( $output );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_generator( $type = 'xhtml' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !$type ) {&nbsp;</div></li><li><div>      $type = 'xhtml';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo apply_filters( 'bb_generator', bb_get_generator( $type ) . &quot;\n&quot;, $type );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_generator( $type = 'xhtml' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !$type ) {&nbsp;</div></li><li><div>      $type = 'xhtml';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  switch ( $type ) {&nbsp;</div></li><li><div>      case 'html':&nbsp;</div></li><li><div>          $gen = '&lt;meta name=&quot;generator&quot; content=&quot;bbPress ' . bb_get_option( 'version' ) . '&quot;&gt;';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'xhtml':&nbsp;</div></li><li><div>          $gen = '&lt;meta name=&quot;generator&quot; content=&quot;bbPress ' . bb_get_option( 'version' ) . '&quot; /&gt;';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'atom':&nbsp;</div></li><li><div>          $gen = '&lt;generator uri=&quot;http:<span class="comment">//bbpress.org/&quot; version=&quot;' . bb_get_option( 'version' ) . '&quot;&gt;bbPress&lt;/generator&gt;';</span>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'rss2':&nbsp;</div></li><li><div>          $gen = '&lt;generator&gt;http:<span class="comment">//bbpress.org/?v=' . bb_get_option( 'version' ) . '&lt;/generator&gt;';</span>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'rdf':&nbsp;</div></li><li><div>          $gen = '&lt;admin:generatorAgent rdf:resource=&quot;http:<span class="comment">//bbpress.org/?v=' . bb_get_option( 'version' ) . '&quot; /&gt;';</span>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'comment':&nbsp;</div></li><li><div>          $gen = '&lt;!-- generator=&quot;bbPress/' . bb_get_option( 'version' ) . '&quot; --&gt;';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'export':&nbsp;</div></li><li><div>          $gen = '&lt;!-- generator=&quot;bbPress/' . bb_get_option( 'version' ) . '&quot; created=&quot;'. date( 'Y-m-d H:i' ) . '&quot;--&gt;';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_generator', $gen, $type );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_stylesheet_uri( $stylesheet = '' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo esc_html( bb_get_stylesheet_uri( $stylesheet ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_stylesheet_uri( $stylesheet = '' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( 'rtl' == $stylesheet ) {&nbsp;</div></li><li><div>      $css_file = 'style-rtl.css';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $css_file = 'style.css';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $active_theme = bb_get_active_theme_directory();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( file_exists( $active_theme . $css_file ) ) {&nbsp;</div></li><li><div>      $r = bb_get_active_theme_uri() . $css_file;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $r = BB_DEFAULT_THEME_URL . $css_file;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_stylesheet_uri', $r, $stylesheet );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_active_theme_uri()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo bb_get_active_theme_uri();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_active_theme_uri()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $bb;&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Skip theme loading in &quot;safe&quot; mode</span></span>&nbsp;</div></li><li><div>  if ( isset( $bb-&gt;safemode ) && $bb-&gt;safemode === true ) {&nbsp;</div></li><li><div>      $active_theme_uri = BB_DEFAULT_THEME_URL;&nbsp;</div></li><li><div>  } elseif ( !$active_theme = bb_get_option( 'bb_active_theme' ) ) {&nbsp;</div></li><li><div>      $active_theme_uri = BB_DEFAULT_THEME_URL;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $active_theme_uri = bb_get_theme_uri( $active_theme );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_active_theme_uri', $active_theme_uri );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_theme_uri( $theme = false )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $bb;&nbsp;</div></li><li><div>  if ( preg_match( '/^([a-z0-9_-]+)#([a-z0-9_-]+)$/i', $theme, $_matches ) ) {&nbsp;</div></li><li><div>      $theme_uri = $bb-&gt;theme_locations[$_matches[1]]['url'] . $_matches[2] . '/';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $theme_uri = $bb-&gt;theme_locations['core']['url'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_theme_uri', $theme_uri, $theme );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_footer()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  bb_load_template( 'footer.php' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_head()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  do_action('bb_head');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display the link to the Really Simple Discovery service endpoint.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @link http://archipelago.phrasewise.com/rsd</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_rsd_link() {&nbsp;</div></li><li><div>  if (bb_get_option('enable_xmlrpc'))&nbsp;</div></li><li><div>      echo '&lt;link rel=&quot;EditURI&quot; type=&quot;application/rsd+xml&quot; title=&quot;RSD&quot; href=&quot;' . bb_get_uri('xmlrpc.php', 'rsd', BB_URI_CONTEXT_LINK_OTHER + BB_URI_CONTEXT_BB_XMLRPC) . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display the link to the pingback service endpoint.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_pingback_link() {&nbsp;</div></li><li><div>  if (bb_get_option('enable_pingback'))&nbsp;</div></li><li><div>      echo '&lt;link rel=&quot;pingback&quot; href=&quot;' . bb_get_uri('xmlrpc.php', null, BB_URI_CONTEXT_LINK_OTHER + BB_URI_CONTEXT_BB_XMLRPC) . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function profile_menu() {&nbsp;</div></li><li><div>  global $user_id, $profile_menu, $self, $profile_page_title;&nbsp;</div></li><li><div>  $list = &quot;&lt;ul id='profile-menu'&gt;&quot;;&nbsp;</div></li><li><div>  $list .= &quot;\n\t&lt;li&quot; . ( ( $self ) ? '' : ' class=&quot;current&quot;' ) . '&gt;&lt;a href=&quot;' . esc_attr( get_user_profile_link( $user_id ) ) . '&quot;&gt;' . __('Profile') . '&lt;/a&gt;&lt;/li&gt;';&nbsp;</div></li><li><div>  $id = bb_get_current_user_info( 'id' );&nbsp;</div></li><li><div>  foreach ($profile_menu as $item) {&nbsp;</div></li><li><div>      <span class="comment">// 0 = name, 1 = users cap, 2 = others cap, 3 = file</span>&nbsp;</div></li><li><div>      $class = '';&nbsp;</div></li><li><div>      if ( $item[3] == $self ) {&nbsp;</div></li><li><div>          $class = ' class=&quot;current&quot;';&nbsp;</div></li><li><div>          $profile_page_title = $item[0];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( bb_can_access_tab( $item, $id, $user_id ) )&nbsp;</div></li><li><div>          if ( file_exists($item[3]) || is_callable($item[3]) )&nbsp;</div></li><li><div>              $list .= &quot;\n\t&lt;li$class&gt;&lt;a href='&quot; . esc_attr( get_profile_tab_link($user_id, $item[4]) ) . &quot;'&gt;{$item[0]}&lt;/a&gt;&lt;/li&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $list .= &quot;\n&lt;/ul&gt;&quot;;&nbsp;</div></li><li><div>  echo $list;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function login_form() {&nbsp;</div></li><li><div>  if ( bb_is_user_logged_in() )&nbsp;</div></li><li><div>      bb_load_template( 'logged-in.php' );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      bb_load_template( 'login-form.php', array('user_login', 'remember_checked', 'redirect_to', 're') );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function search_form( $q = '' ) {&nbsp;</div></li><li><div>  bb_load_template( 'search-form.php', array('q' =&gt; $q) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_post_template() {&nbsp;</div></li><li><div>  bb_load_template( 'post.php' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_form( $args = array() ) {&nbsp;</div></li><li><div>  global $page, $topic, $forum;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'h2' =&gt; '', &nbsp;</div></li><li><div>      'last_page_only' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( is_string( $args ) ) {&nbsp;</div></li><li><div>      $defaults['h2'] = $args;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $forum-&gt;forum_is_category ) && $forum-&gt;forum_is_category ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $add = topic_pages_add();&nbsp;</div></li><li><div>  if ( empty( $h2 ) && false !== $h2 ) {&nbsp;</div></li><li><div>      if ( bb_is_topic() ) {&nbsp;</div></li><li><div>          $h2 = __( 'Reply' );&nbsp;</div></li><li><div>      } elseif ( bb_is_forum() ) {&nbsp;</div></li><li><div>          $h2 = __( 'New Topic in this Forum' );&nbsp;</div></li><li><div>      } elseif ( bb_is_tag() || bb_is_front() ) {&nbsp;</div></li><li><div>          $h2 = __( 'Add New Topic' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $last_page = bb_get_page_number( ( isset( $topic-&gt;topic_posts ) ? $topic-&gt;topic_posts : 0 ) + $add );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !empty( $h2 ) ) {&nbsp;</div></li><li><div>      if ( bb_is_topic() && ( $page != $last_page && $last_page_only ) ) {&nbsp;</div></li><li><div>          $h2 = '&lt;a href=&quot;' . esc_attr( get_topic_link( 0, $last_page ) . '#postform' ) . '&quot;&gt;' . $h2 . ' &raquo;&lt;/a&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      echo '&lt;h2 class=&quot;post-form&quot;&gt;' . $h2 . '&lt;/h2&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'pre_post_form' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (&nbsp;</div></li><li><div>      ( false === bb_is_login_required() ) ||&nbsp;</div></li><li><div>      ( bb_is_topic() && bb_current_user_can( 'write_post', $topic-&gt;topic_id ) && ( $page == $last_page || !$last_page_only ) ) ||&nbsp;</div></li><li><div>      ( !bb_is_topic() && bb_current_user_can( 'write_topic', isset( $forum-&gt;forum_id ) ? $forum-&gt;forum_id : 0 ) )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>      echo '&lt;form class=&quot;postform post-form&quot; id=&quot;postform&quot; method=&quot;post&quot; action=&quot;' . bb_get_uri( 'bb-post.php', null, BB_URI_CONTEXT_FORM_ACTION ) . '&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      echo '&lt;fieldset&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      bb_load_template( 'post-form.php', array('h2' =&gt; $h2) );&nbsp;</div></li><li><div>      bb_nonce_field( bb_is_topic() ? 'create-post_' . $topic-&gt;topic_id : 'create-topic' );&nbsp;</div></li><li><div>      if ( bb_is_forum() ) {&nbsp;</div></li><li><div>          echo '&lt;input type=&quot;hidden&quot; name=&quot;forum_id&quot; value=&quot;' . $forum-&gt;forum_id . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      } elseif ( bb_is_topic() ) {&nbsp;</div></li><li><div>          echo '&lt;input type=&quot;hidden&quot; name=&quot;topic_id&quot; value=&quot;' . $topic-&gt;topic_id . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      do_action( 'post_form' );&nbsp;</div></li><li><div>      echo &quot;\n&lt;/fieldset&gt;\n&lt;/form&gt;\n&quot;;&nbsp;</div></li><li><div>  } elseif ( !bb_is_user_logged_in() ) {&nbsp;</div></li><li><div>      echo '&lt;p&gt;';&nbsp;</div></li><li><div>      printf(&nbsp;</div></li><li><div>          __('You must &lt;a href=&quot;%s&quot;&gt;log in&lt;/a&gt; to post.'), &nbsp;</div></li><li><div>          esc_attr( bb_get_uri( 'bb-login.php', null, BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_USER_FORMS ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      echo '&lt;/p&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'post_post_form' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function edit_form() {&nbsp;</div></li><li><div>  global $bb_post;&nbsp;</div></li><li><div>  do_action('pre_edit_form');&nbsp;</div></li><li><div>  echo '&lt;form class=&quot;postform edit-form&quot; method=&quot;post&quot; action=&quot;' . bb_get_uri('bb-edit.php', null, BB_URI_CONTEXT_FORM_ACTION)  . '&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  echo '&lt;fieldset&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  bb_load_template( 'edit-form.php', array('topic_title') );&nbsp;</div></li><li><div>  bb_nonce_field( 'edit-post_' . $bb_post-&gt;post_id );&nbsp;</div></li><li><div>  do_action('edit_form');&nbsp;</div></li><li><div>  if ($_REQUEST['view'] === 'all')&nbsp;</div></li><li><div>      echo &quot;\n&quot; . '&lt;input type=&quot;hidden&quot; name=&quot;view&quot; value=&quot;all&quot; /&gt;';&nbsp;</div></li><li><div>  echo &quot;\n&quot; . '&lt;/fieldset&gt;' . &quot;\n&quot; . '&lt;/form&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  do_action('post_edit_form');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_anonymous_post_form() {&nbsp;</div></li><li><div>  if ( !bb_is_user_logged_in() && !bb_is_login_required() )&nbsp;</div></li><li><div>      bb_load_template( 'post-form-anonymous.php' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function alt_class( $key, $others = '' ) {&nbsp;</div></li><li><div>  echo get_alt_class( $key, $others );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_alt_class( $key, $others = '' ) {&nbsp;</div></li><li><div>  global $bb_alt;&nbsp;</div></li><li><div>  $class = '';&nbsp;</div></li><li><div>  if ( !isset( $bb_alt[$key] ) ) $bb_alt[$key] = -1;&nbsp;</div></li><li><div>  ++$bb_alt[$key];&nbsp;</div></li><li><div>  $others = trim($others);&nbsp;</div></li><li><div>  if ( $others xor $bb_alt[$key] % 2 )&nbsp;</div></li><li><div>      $class = ' class=&quot;' . ( ($others) ? $others : 'alt' ) . '&quot;';&nbsp;</div></li><li><div>  elseif ( $others && $bb_alt[$key] % 2 )&nbsp;</div></li><li><div>      $class = ' class=&quot;' . $others . ' alt&quot;';&nbsp;</div></li><li><div>  return $class;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_location() {&nbsp;</div></li><li><div>  echo apply_filters( 'bb_location', bb_get_location() );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_location() { <span class="comment">// Not for display.  Do not internationalize.</span>&nbsp;</div></li><li><div>  static $file;&nbsp;</div></li><li><div>  static $filename;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !isset( $file ) ) {&nbsp;</div></li><li><div>      $path = '';&nbsp;</div></li><li><div>      foreach ( array( $_SERVER['SCRIPT_NAME'], $_SERVER['SCRIPT_FILENAME'], $_SERVER['PHP_SELF'] ) as $_path ) {&nbsp;</div></li><li><div>          if ( false !== strpos( $_path, '.php' ) ) {&nbsp;</div></li><li><div>              $path = $_path;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $filename = bb_find_filename( $path );&nbsp;</div></li><li><div>      <span class="comment">// Make $file relative to bbPress root directory</span>&nbsp;</div></li><li><div>      $file = str_replace( bb_get_option( 'path' ), '', $path );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $filename ) {&nbsp;</div></li><li><div>      case 'index.php':&nbsp;</div></li><li><div>      case 'page.php':&nbsp;</div></li><li><div>          $location = 'front-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'forum.php':&nbsp;</div></li><li><div>          $location = 'forum-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'tags.php':&nbsp;</div></li><li><div>          $location = 'tag-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'edit.php':&nbsp;</div></li><li><div>          $location = 'topic-edit-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'topic.php':&nbsp;</div></li><li><div>          $location = 'topic-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'rss.php':&nbsp;</div></li><li><div>          $location = 'feed-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'search.php':&nbsp;</div></li><li><div>          $location = 'search-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'profile.php':&nbsp;</div></li><li><div>          $location = 'profile-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'favorites.php':&nbsp;</div></li><li><div>          $location = 'favorites-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'view.php':&nbsp;</div></li><li><div>          $location = 'view-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'statistics.php':&nbsp;</div></li><li><div>          $location = 'stats-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'bb-login.php':&nbsp;</div></li><li><div>          $location = 'login-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'register.php':&nbsp;</div></li><li><div>          $location = 'register-page';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      default:&nbsp;</div></li><li><div>          $location = apply_filters( 'bb_get_location', '', $file );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $location;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_front() {&nbsp;</div></li><li><div>  return 'front-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_forum() {&nbsp;</div></li><li><div>  return 'forum-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Whether a user is required to log in in order to create posts and forums.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether a user must be logged in.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_is_login_required() {&nbsp;</div></li><li><div>  return ! (bool) bb_get_option('enable_loginless');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_tags() {&nbsp;</div></li><li><div>  return 'tag-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_tag() {&nbsp;</div></li><li><div>  global $tag, $tag_name;&nbsp;</div></li><li><div>  return $tag && $tag_name && bb_is_tags();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_topic_edit() {&nbsp;</div></li><li><div>  return 'topic-edit-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_topic() {&nbsp;</div></li><li><div>  return 'topic-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_feed() {&nbsp;</div></li><li><div>  return 'feed-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_search() {&nbsp;</div></li><li><div>  return 'search-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_profile() {&nbsp;</div></li><li><div>  return 'profile-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_favorites() {&nbsp;</div></li><li><div>  return 'favorites-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_view() {&nbsp;</div></li><li><div>  return 'view-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_statistics() {&nbsp;</div></li><li><div>  return 'stats-page' == bb_get_location();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_is_admin() {&nbsp;</div></li><li><div>  if ( defined('BB_IS_ADMIN') )&nbsp;</div></li><li><div>      return BB_IS_ADMIN;&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_title( $args = '' ) {&nbsp;</div></li><li><div>  echo apply_filters( 'bb_title', bb_get_title( $args ), $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_title( $args = '' ) {&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'separator' =&gt; ' &laquo; ', &nbsp;</div></li><li><div>      'order' =&gt; 'normal', &nbsp;</div></li><li><div>      'front' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  $title = array();&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  switch ( bb_get_location() ) {&nbsp;</div></li><li><div>      case 'search-page':&nbsp;</div></li><li><div>          if ( !$q = trim( @$_GET['search'] ) )&nbsp;</div></li><li><div>              if ( !$q = trim( @$_GET['q'] ) )&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          $title[] = sprintf( __( 'Search for %s' ), esc_html( $q ) );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'front-page':&nbsp;</div></li><li><div>          if ( !empty( $args['front'] ) )&nbsp;</div></li><li><div>              $title[] = $args['front'];&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'topic-edit-page':&nbsp;</div></li><li><div>      case 'topic-page':&nbsp;</div></li><li><div>          $title[] = get_topic_title();&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'forum-page':&nbsp;</div></li><li><div>          $title[] = get_forum_name();&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'tag-page':&nbsp;</div></li><li><div>          if ( bb_is_tag() )&nbsp;</div></li><li><div>              $title[] = esc_html( bb_get_tag_name() );&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          $title[] = __( 'Tags' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'profile-page':&nbsp;</div></li><li><div>          $title[] = get_user_display_name();&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'view-page':&nbsp;</div></li><li><div>          $title[] = get_view_name();&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ( $st = bb_get_option( 'static_title' ) )&nbsp;</div></li><li><div>      $title = array( $st );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $title[] = bb_get_option( 'name' );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ( 'reversed' == $args['order'] )&nbsp;</div></li><li><div>      $title = array_reverse( $title );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return apply_filters( 'bb_get_title', implode( $args['separator'], $title ), $args, $title );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_feed_head() {&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $feeds = array();&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  switch (bb_get_location()) {&nbsp;</div></li><li><div>      case 'profile-page':&nbsp;</div></li><li><div>          if ( $tab = isset($_GET['tab']) ? $_GET['tab'] : bb_get_path(2) )&nbsp;</div></li><li><div>              if ($tab != 'favorites')&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          &nbsp;</div></li><li><div>          $feeds[] = array(&nbsp;</div></li><li><div>              'title' =&gt; sprintf(__('%1$s &raquo; User Favorites: %2$s'), bb_get_option( 'name' ), get_user_name()), &nbsp;</div></li><li><div>              'href' =&gt; get_favorites_rss_link(0, BB_URI_CONTEXT_LINK_ALTERNATE_HREF + BB_URI_CONTEXT_BB_FEED)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'topic-page':&nbsp;</div></li><li><div>          $feeds[] = array(&nbsp;</div></li><li><div>              'title' =&gt; sprintf(__('%1$s &raquo; Topic: %2$s'), bb_get_option( 'name' ), get_topic_title()), &nbsp;</div></li><li><div>              'href' =&gt; get_topic_rss_link(0, BB_URI_CONTEXT_LINK_ALTERNATE_HREF + BB_URI_CONTEXT_BB_FEED)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'tag-page':&nbsp;</div></li><li><div>          if (bb_is_tag()) {&nbsp;</div></li><li><div>              $feeds[] = array(&nbsp;</div></li><li><div>                  'title' =&gt; sprintf(__('%1$s &raquo; Tag: %2$s - Recent Posts'), bb_get_option( 'name' ), bb_get_tag_name()), &nbsp;</div></li><li><div>                  'href' =&gt; bb_get_tag_posts_rss_link(0, BB_URI_CONTEXT_LINK_ALTERNATE_HREF + BB_URI_CONTEXT_BB_FEED)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              $feeds[] = array(&nbsp;</div></li><li><div>                  'title' =&gt; sprintf(__('%1$s &raquo; Tag: %2$s - Recent Topics'), bb_get_option( 'name' ), bb_get_tag_name()), &nbsp;</div></li><li><div>                  'href' =&gt; bb_get_tag_topics_rss_link(0, BB_URI_CONTEXT_LINK_ALTERNATE_HREF + BB_URI_CONTEXT_BB_FEED)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'forum-page':&nbsp;</div></li><li><div>          $feeds[] = array(&nbsp;</div></li><li><div>              'title' =&gt; sprintf(__('%1$s &raquo; Forum: %2$s - Recent Posts'), bb_get_option( 'name' ), get_forum_name()), &nbsp;</div></li><li><div>              'href' =&gt; bb_get_forum_posts_rss_link(0, BB_URI_CONTEXT_LINK_ALTERNATE_HREF + BB_URI_CONTEXT_BB_FEED)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $feeds[] = array(&nbsp;</div></li><li><div>              'title' =&gt; sprintf(__('%1$s &raquo; Forum: %2$s - Recent Topics'), bb_get_option( 'name' ), get_forum_name()), &nbsp;</div></li><li><div>              'href' =&gt; bb_get_forum_topics_rss_link(0, BB_URI_CONTEXT_LINK_ALTERNATE_HREF + BB_URI_CONTEXT_BB_FEED)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'front-page':&nbsp;</div></li><li><div>          $feeds[] = array(&nbsp;</div></li><li><div>              'title' =&gt; sprintf(__('%1$s &raquo; Recent Posts'), bb_get_option( 'name' )), &nbsp;</div></li><li><div>              'href' =&gt; bb_get_posts_rss_link(BB_URI_CONTEXT_LINK_ALTERNATE_HREF + BB_URI_CONTEXT_BB_FEED)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $feeds[] = array(&nbsp;</div></li><li><div>              'title' =&gt; sprintf(__('%1$s &raquo; Recent Topics'), bb_get_option( 'name' )), &nbsp;</div></li><li><div>              'href' =&gt; bb_get_topics_rss_link(BB_URI_CONTEXT_LINK_ALTERNATE_HREF + BB_URI_CONTEXT_BB_FEED)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      &nbsp;</div></li><li><div>      case 'view-page':&nbsp;</div></li><li><div>          global $bb_views, $view;&nbsp;</div></li><li><div>          if ($bb_views[$view]['feed']) {&nbsp;</div></li><li><div>              $feeds[] = array(&nbsp;</div></li><li><div>                  'title' =&gt; sprintf(__('%1$s &raquo; View: %2$s'), bb_get_option( 'name' ), get_view_name()), &nbsp;</div></li><li><div>                  'href' =&gt; bb_get_view_rss_link(null, BB_URI_CONTEXT_LINK_ALTERNATE_HREF + BB_URI_CONTEXT_BB_FEED)&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (count($feeds)) {&nbsp;</div></li><li><div>      $feed_links = array();&nbsp;</div></li><li><div>      foreach ($feeds as $feed) {&nbsp;</div></li><li><div>          $link = '&lt;link rel=&quot;alternate&quot; type=&quot;application/rss+xml&quot; ';&nbsp;</div></li><li><div>          $link .= 'title=&quot;' . esc_attr($feed['title']) . '&quot; ';&nbsp;</div></li><li><div>          $link .= 'href=&quot;' . esc_attr($feed['href']) . '&quot; /&gt;';&nbsp;</div></li><li><div>          $feed_links[] = $link;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $feed_links = join(&quot;\n&quot;, $feed_links);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $feed_links = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  echo apply_filters('bb_feed_head', $feed_links);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_posts_rss_link($context = 0) {&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( bb_get_option( 'mod_rewrite' ) )&nbsp;</div></li><li><div>      $link = bb_get_uri('rss/', null, $context);&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $link = bb_get_uri('rss.php', null, $context);&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_posts_rss_link', $link, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_topics_rss_link($context = 0) {&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( bb_get_option( 'mod_rewrite' ) )&nbsp;</div></li><li><div>      $link = bb_get_uri('rss/topics', null, $context);&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $link = bb_get_uri('rss.php', array('topics' =&gt; 1), $context);&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_topics_rss_link', $link, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_view_rss_link($view = null, $context = 0) {&nbsp;</div></li><li><div>  echo apply_filters( 'bb_view_rss_link', bb_get_view_rss_link($view, $context), $context);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_view_rss_link($view = null, $context = 0) {&nbsp;</div></li><li><div>  if (!$view) {&nbsp;</div></li><li><div>      global $view;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( bb_get_option( 'mod_rewrite' ) )&nbsp;</div></li><li><div>      $link = bb_get_uri('rss/view/' . $view, null, $context);&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $link = bb_get_uri('rss.php', array('view' =&gt; $view), $context);&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_view_rss_link', $link, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_latest_topics_pages( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array( 'before' =&gt; '', 'after' =&gt; '' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $page;&nbsp;</div></li><li><div>  static $bb_latest_topics_count;&nbsp;</div></li><li><div>  if ( !$bb_latest_topics_count) {&nbsp;</div></li><li><div>      global $bbdb;&nbsp;</div></li><li><div>      $bb_latest_topics_count = $bbdb-&gt;get_var('SELECT COUNT(`topic_id`) FROM `' . $bbdb-&gt;topics . '` WHERE `topic_status` = 0 AND `topic_sticky` != 2;');&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $pages = apply_filters( 'bb_latest_topics_pages', get_page_number_links( $page, $bb_latest_topics_count ), $bb_latest_topics_count ) ) {&nbsp;</div></li><li><div>      echo $args['before'] . $pages . $args['after'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// FORUMS</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function forum_id( $forum_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'forum_id', get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_forum_id( $forum_id = 0 ) {&nbsp;</div></li><li><div>  global $forum;&nbsp;</div></li><li><div>  $forum_id = (int) $forum_id;&nbsp;</div></li><li><div>  if ( $forum_id )&nbsp;</div></li><li><div>      $_forum = bb_get_forum( $forum_id );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $_forum =& $forum;&nbsp;</div></li><li><div>  return $_forum-&gt;forum_id;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function forum_link( $forum_id = 0, $page = 1, $context = BB_URI_CONTEXT_A_HREF ) {&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo apply_filters('forum_link', get_forum_link( $forum_id, $page, $context ), $forum_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_forum_link( $forum_id = 0, $page = 1, $context = BB_URI_CONTEXT_A_HREF ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $rewrite = bb_get_option( 'mod_rewrite' );&nbsp;</div></li><li><div>  if ( $rewrite ) {&nbsp;</div></li><li><div>      if ( $rewrite === 'slugs' ) {&nbsp;</div></li><li><div>          $column = 'forum_slug';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $column = 'forum_id';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $page = (1 &lt; $page) ? '/page/' . $page : '';&nbsp;</div></li><li><div>      $link = bb_get_uri('forum/' . $forum-&gt;$column . $page, null, $context);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $query = array(&nbsp;</div></li><li><div>          'id' =&gt; $forum-&gt;forum_id, &nbsp;</div></li><li><div>          'page' =&gt; (1 &lt; $page) ? $page : false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $link = bb_get_uri('forum.php', $query, $context);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'get_forum_link', $link, $forum-&gt;forum_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function forum_name( $forum_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'forum_name', get_forum_name( $forum_id ), $forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_forum_name( $forum_id = 0 ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_forum_name', $forum-&gt;forum_name, $forum-&gt;forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function forum_description( $args = null ) {&nbsp;</div></li><li><div>  if ( is_numeric($args) )&nbsp;</div></li><li><div>      $args = array( 'id' =&gt; $args );&nbsp;</div></li><li><div>  elseif ( $args && is_string($args) && false === strpos($args, '=') )&nbsp;</div></li><li><div>      $args = array( 'before' =&gt; $args );&nbsp;</div></li><li><div>  $defaults = array( 'id' =&gt; 0, 'before' =&gt; ' &#8211; ', 'after' =&gt; '' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $desc = apply_filters( 'forum_description', get_forum_description( $args['id'] ), $args['id'], $args ) )&nbsp;</div></li><li><div>      echo $args['before'] . $desc . $args['after'];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_forum_description( $forum_id = 0 ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_forum_description', $forum-&gt;forum_desc, $forum-&gt;forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_forum_parent( $forum_id = 0 ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_forum_parent', $forum-&gt;forum_parent, $forum-&gt;forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_forum_position( $forum_id = 0 ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_forum_position', $forum-&gt;forum_order, $forum-&gt;forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_forum_is_category( $forum_id = 0 ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_forum_is_category', isset($forum-&gt;forum_is_category) ? $forum-&gt;forum_is_category : false, $forum-&gt;forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function forum_topics( $forum_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'forum_topics', get_forum_topics( $forum_id ), $forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_forum_topics( $forum_id = 0 ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_forum_topics', $forum-&gt;topics, $forum-&gt;forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function forum_posts( $forum_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'forum_posts', get_forum_posts( $forum_id ), $forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_forum_posts( $forum_id = 0 ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_forum_posts', $forum-&gt;posts, $forum-&gt;forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function forum_pages( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Compatibility</span></span>&nbsp;</div></li><li><div>  if ( $args && is_numeric( $args ) ) {&nbsp;</div></li><li><div>      $args = array( 'id' =&gt; $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $defaults = array( 'id' =&gt; 0, 'before' =&gt; '', 'after' =&gt; '' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $page;&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $args['id'] ) );&nbsp;</div></li><li><div>  if ( $pages = apply_filters( 'forum_pages', get_page_number_links( $page, $forum-&gt;topics ), $forum-&gt;topics ) ) {&nbsp;</div></li><li><div>      echo $args['before'] . $pages . $args['after'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_forum_posts_rss_link( $forum_id = 0, $context = 0 ) {&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo apply_filters('bb_forum_posts_rss_link', bb_get_forum_posts_rss_link( $forum_id, $context ), $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_forum_posts_rss_link( $forum_id = 0, $context = 0 ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $rewrite = bb_get_option( 'mod_rewrite' );&nbsp;</div></li><li><div>  if ( $rewrite ) {&nbsp;</div></li><li><div>      if ( $rewrite === 'slugs' ) {&nbsp;</div></li><li><div>          $column = 'forum_slug';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $column = 'forum_id';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $link = bb_get_uri('rss/forum/' . $forum-&gt;$column, null, $context);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $link = bb_get_uri('rss.php', array('forum' =&gt; $forum-&gt;forum_id), $context);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_forum_posts_rss_link', $link, $forum-&gt;forum_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_forum_topics_rss_link( $forum_id = 0, $context = 0 ) {&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo apply_filters('bb_forum_topics_rss_link', bb_get_forum_topics_rss_link( $forum_id, $context ), $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_forum_topics_rss_link( $forum_id = 0, $context = 0 ) {&nbsp;</div></li><li><div>  $forum = bb_get_forum( get_forum_id( $forum_id ) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $rewrite = bb_get_option( 'mod_rewrite' );&nbsp;</div></li><li><div>  if ( $rewrite ) {&nbsp;</div></li><li><div>      if ( $rewrite === 'slugs' ) {&nbsp;</div></li><li><div>          $column = 'forum_slug';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $column = 'forum_id';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $link = bb_get_uri('rss/forum/' . $forum-&gt;$column . '/topics', null, $context);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $link = bb_get_uri('rss.php', array('forum' =&gt; $forum-&gt;forum_id, 'topics' =&gt; 1), $context);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_forum_topics_rss_link', $link, $forum-&gt;forum_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_forum_bread_crumb($args = '') {&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'forum_id' =&gt; 0, &nbsp;</div></li><li><div>      'separator' =&gt; ' &raquo; ', &nbsp;</div></li><li><div>      'class' =&gt; null&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $args = wp_parse_args($args, $defaults);&nbsp;</div></li><li><div>  extract($args, EXTR_SKIP);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $trail = '';&nbsp;</div></li><li><div>  $trail_forum = bb_get_forum(get_forum_id($forum_id));&nbsp;</div></li><li><div>  if ($class) {&nbsp;</div></li><li><div>      $class = ' class=&quot;' . $class . '&quot;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $current_trail_forum_id = $trail_forum-&gt;forum_id;&nbsp;</div></li><li><div>  while ( $trail_forum && $trail_forum-&gt;forum_id &gt; 0 ) {&nbsp;</div></li><li><div>      $crumb = $separator;&nbsp;</div></li><li><div>      if ($current_trail_forum_id != $trail_forum-&gt;forum_id || !bb_is_forum()) {&nbsp;</div></li><li><div>          $crumb .= '&lt;a' . $class . ' href=&quot;' . get_forum_link($trail_forum-&gt;forum_id) . '&quot;&gt;';&nbsp;</div></li><li><div>      } elseif ($class) {&nbsp;</div></li><li><div>          $crumb .= '&lt;span' . $class . '&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $crumb .= get_forum_name($trail_forum-&gt;forum_id);&nbsp;</div></li><li><div>      if ($current_trail_forum_id != $trail_forum-&gt;forum_id || !bb_is_forum()) {&nbsp;</div></li><li><div>          $crumb .= '&lt;/a&gt;';&nbsp;</div></li><li><div>      } elseif ($class) {&nbsp;</div></li><li><div>          $crumb .= '&lt;/span&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $trail = $crumb . $trail;&nbsp;</div></li><li><div>      $trail_forum = bb_get_forum($trail_forum-&gt;forum_parent);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters('bb_get_forum_bread_crumb', $trail, $forum_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_forum_bread_crumb( $args = '' ) {&nbsp;</div></li><li><div>  echo apply_filters('bb_forum_bread_crumb', bb_get_forum_bread_crumb( $args ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Forum Loop //</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function &bb_forums( $args = '' ) {&nbsp;</div></li><li><div>  global $bb_forums_loop;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_args = func_get_args();&nbsp;</div></li><li><div>  $default_type = 'flat';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_numeric($args) ) {&nbsp;</div></li><li><div>      $args = array( 'child_of' =&gt; $args );&nbsp;</div></li><li><div>  } elseif ( func_num_args() &gt; 1 ) { <span class="comment">// bb_forums( 'ul', $args ); Deprecated</span>&nbsp;</div></li><li><div>      $default_type = $args;&nbsp;</div></li><li><div>      $args = $_args[1];&nbsp;</div></li><li><div>  } elseif ( $args && is_string($args) && false === strpos($args, '=') ) {&nbsp;</div></li><li><div>      $args = array( 'type' =&gt; $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// hierarchical not used here.  Sent to bb_get_forums for proper ordering.</span>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, array('hierarchical' =&gt; true, 'type' =&gt; $default_type, 'walker' =&gt; 'BB_Walker_Blank') );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $levels = array( '', '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( in_array($args['type'], array('list', 'ul')) )&nbsp;</div></li><li><div>      $levels = array( '&lt;ul&gt;', '&lt;/ul&gt;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $forums = bb_get_forums( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !class_exists($args['walker']) )&nbsp;</div></li><li><div>      $args['walker'] = 'BB_Walker_Blank';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $bb_forums_loop = BB_Loop::start( $forums, $args['walker'] ) ) {&nbsp;</div></li><li><div>      $bb_forums_loop-&gt;preserve( array('forum', 'forum_id') );&nbsp;</div></li><li><div>      $bb_forums_loop-&gt;walker-&gt;db_fields = array( 'id' =&gt; 'forum_id', 'parent' =&gt; 'forum_parent' );&nbsp;</div></li><li><div>      list($bb_forums_loop-&gt;walker-&gt;start_lvl, $bb_forums_loop-&gt;walker-&gt;end_lvl) = $levels;&nbsp;</div></li><li><div>      return $bb_forums_loop-&gt;elements;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $false = false;&nbsp;</div></li><li><div>  return $false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_forum() { <span class="comment">// Returns current depth</span>&nbsp;</div></li><li><div>  global $bb_forums_loop;&nbsp;</div></li><li><div>  if ( !is_object($bb_forums_loop) || !is_a($bb_forums_loop, 'BB_Loop') )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  if ( !is_array($bb_forums_loop-&gt;elements) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $bb_forums_loop-&gt;step() ) {&nbsp;</div></li><li><div>      $GLOBALS['forum'] =& $bb_forums_loop-&gt;elements[key($bb_forums_loop-&gt;elements)]; <span class="comment">// Globalize the current forum object</span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $bb_forums_loop-&gt;reinstate();&nbsp;</div></li><li><div>      return $bb_forums_loop = null; <span class="comment">// All done?  Kill the object and exit the loop.</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $bb_forums_loop-&gt;walker-&gt;depth;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_forum_pad( $pad, $offset = 0 ) {&nbsp;</div></li><li><div>  global $bb_forums_loop;&nbsp;</div></li><li><div>  if ( !is_object($bb_forums_loop) || !is_a($bb_forums_loop, 'BB_Loop') )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo $bb_forums_loop-&gt;pad( $pad, $offset );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_forum_class( $args = null ) {&nbsp;</div></li><li><div>  echo apply_filters( 'bb_forum_class', get_alt_class( 'forum', bb_get_forum_class_names( $args ) ), $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_forum_class_names( $args = null ) {&nbsp;</div></li><li><div>  if ( is_numeric( $args ) ) { <span class="comment">// Not used</span>&nbsp;</div></li><li><div>      $args = array( 'id' =&gt; $args );&nbsp;</div></li><li><div>  } elseif ( $args && is_string( $args ) && false === strpos( $args, '=' ) ) {&nbsp;</div></li><li><div>      $args = array( 'class' =&gt; $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $defaults = array( 'id' =&gt; 0, 'key' =&gt; 'forum', 'class' =&gt; '', 'output' =&gt; 'string' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $classes = array();&nbsp;</div></li><li><div>  if ( $args['class'] ) {&nbsp;</div></li><li><div>      $classes[] = $args['class'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $bb_forums_loop;&nbsp;</div></li><li><div>  if ( is_object( $bb_forums_loop ) && is_a( $bb_forums_loop, 'BB_Loop' ) ) {&nbsp;</div></li><li><div>      $classes = array_merge( $classes, $bb_forums_loop-&gt;classes( 'array' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $args['output'] === 'string' ) {&nbsp;</div></li><li><div>      $classes = join( ' ', $classes );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_forum_class', $classes, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// TOPICS</span>&nbsp;</div></li><li><div>function topic_id( $id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'topic_id', get_topic_id( $id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_id( $id = 0 ) {&nbsp;</div></li><li><div>  global $topic;&nbsp;</div></li><li><div>  $id = (int) $id;&nbsp;</div></li><li><div>  if ( $id )&nbsp;</div></li><li><div>      $_topic = get_topic( $id );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $_topic =& $topic;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty($_topic-&gt;topic_id) )&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return (int) $_topic-&gt;topic_id;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_link( $id = 0, $page = 1, $context = BB_URI_CONTEXT_A_HREF ) {&nbsp;</div></li><li><div>  echo apply_filters( 'topic_link', get_topic_link( $id, $page, $context ), $id, $page, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_link( $id = 0, $page = 1, $context = BB_URI_CONTEXT_A_HREF ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rewrite = bb_get_option( 'mod_rewrite' );&nbsp;</div></li><li><div>  if ( $rewrite ) {&nbsp;</div></li><li><div>      if ( $rewrite === 'slugs' ) {&nbsp;</div></li><li><div>          $column = 'topic_slug';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $column = 'topic_id';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $page = (1 &lt; $page) ? '/page/' . $page : '';&nbsp;</div></li><li><div>      $link = bb_get_uri('topic/' . $topic-&gt;$column . $page, null, $context);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $page = (1 &lt; $page) ? $page : false;&nbsp;</div></li><li><div>      $link = bb_get_uri('topic.php', array('id' =&gt; $topic-&gt;topic_id, 'page' =&gt; $page), $context);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'get_topic_link', $link, $topic-&gt;topic_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_rss_link( $id = 0, $context = 0 ) {&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo apply_filters('topic_rss_link', get_topic_rss_link($id, $context), $id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_rss_link( $id = 0, $context = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rewrite = bb_get_option( 'mod_rewrite' );&nbsp;</div></li><li><div>  if ( $rewrite ) {&nbsp;</div></li><li><div>      if ( $rewrite === 'slugs' ) {&nbsp;</div></li><li><div>          $column = 'topic_slug';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $column = 'topic_id';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $link = bb_get_uri('rss/topic/' . $topic-&gt;$column, null, $context);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $link = bb_get_uri('rss.php', array('topic' =&gt; $topic-&gt;topic_id), $context);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'get_topic_rss_link', $link, $topic-&gt;topic_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_topic_labels() {&nbsp;</div></li><li><div>  echo apply_filters( 'bb_topic_labels', null );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_title( $id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'topic_title', get_topic_title( $id ), get_topic_id( $id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_title( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_topic_title', $topic-&gt;topic_title, $topic-&gt;topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_page_links( $id = 0, $args = null ) {&nbsp;</div></li><li><div>  echo apply_filters( 'topic_page_links', get_topic_page_links( $id, $args ), get_topic_id( $id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_page_links( $id = 0, $args = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'show_all' =&gt; false, &nbsp;</div></li><li><div>      'end_size' =&gt; 3, &nbsp;</div></li><li><div>      'before' =&gt; ' - ', &nbsp;</div></li><li><div>      'after' =&gt; null&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri = get_topic_link();&nbsp;</div></li><li><div>  if ( bb_get_option('mod_rewrite') ) {&nbsp;</div></li><li><div>      if ( false === $pos = strpos( $uri, '?' ) ) {&nbsp;</div></li><li><div>          $uri = $uri . '%_%';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $uri = substr_replace( $uri, '%_%', $pos, 0 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $uri = add_query_arg( 'page', '%_%', $uri );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $posts = $topic-&gt;topic_posts + topic_pages_add( $topic-&gt;topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $per_page = apply_filters( 'get_topic_page_links_per_page', bb_get_option('page_topics') );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_links = bb_paginate_links(&nbsp;</div></li><li><div>      array(&nbsp;</div></li><li><div>          'base' =&gt; $uri, &nbsp;</div></li><li><div>          'format' =&gt; bb_get_option('mod_rewrite') ? '/page/%#%' : '%#%', &nbsp;</div></li><li><div>          'total' =&gt; ceil($posts/$per_page), &nbsp;</div></li><li><div>          'current' =&gt; 0, &nbsp;</div></li><li><div>          'show_all' =&gt; $args['show_all'], &nbsp;</div></li><li><div>          'end_size' =&gt; $args['end_size'], &nbsp;</div></li><li><div>          'type' =&gt; 'array'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $links = $_links;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $links ) {&nbsp;</div></li><li><div>      if ( !$show_first ) {&nbsp;</div></li><li><div>          unset( $links[0] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $args['before'] ) {&nbsp;</div></li><li><div>          $r .= $args['before'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $r .= join('', $links);&nbsp;</div></li><li><div>      if ( $args['after'] ) {&nbsp;</div></li><li><div>          $r .= $args['after'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'get_topic_page_links', $r, $_links, $topic-&gt;topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_topic_voices( $id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'bb_topic_voices', bb_get_topic_voices( $id ), get_topic_id( $id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_topic_voices( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $topic-&gt;voices_count ) ) {&nbsp;</div></li><li><div>      global $bbdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $voices = $bbdb-&gt;get_col( $bbdb-&gt;prepare( &quot;SELECT DISTINCT poster_id FROM $bbdb-&gt;posts WHERE topic_id = %s AND post_status = '0';&quot;, $topic-&gt;topic_id ) ) ) {&nbsp;</div></li><li><div>          $voices = count( $voices );&nbsp;</div></li><li><div>          bb_update_topicmeta( $topic-&gt;topic_id, 'voices_count', $voices );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $voices = $topic-&gt;voices_count;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_topic_voices', $voices, $topic-&gt;topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_posts( $id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'topic_posts', get_topic_posts( $id ), get_topic_id( $id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_posts( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_topic_posts', $topic-&gt;topic_posts, $topic-&gt;topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_deleted_posts( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_topic_deleted_posts', isset($topic-&gt;deleted_posts) ? $topic-&gt;deleted_posts : 0, $topic-&gt;topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_noreply( $title ) {&nbsp;</div></li><li><div>  if ( 1 == get_topic_posts() && ( bb_is_front() || bb_is_forum() ) )&nbsp;</div></li><li><div>      $title = &quot;&lt;strong&gt;$title&lt;/strong&gt;&quot;;&nbsp;</div></li><li><div>  return $title;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_last_poster( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  echo apply_filters( 'topic_last_poster', get_topic_last_poster( $id ), $topic-&gt;topic_last_poster, $topic-&gt;topic_id ); <span class="comment"><span class="comment">// $topic-&gt;topic_last_poster = user ID</span></span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_last_poster( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  if ( isset( $topic-&gt;topic_last_post_id ) && ( 1 == $topic-&gt;topic_last_post_id ) ) {&nbsp;</div></li><li><div>      $user_display_name = $topic-&gt;topic_poster_name;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $user_display_name = get_post_author( $topic-&gt;topic_last_post_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'get_topic_last_poster', $user_display_name, $topic-&gt;topic_last_poster, $topic-&gt;topic_id ); <span class="comment"><span class="comment">// $topic-&gt;topic_last_poster = user ID</span></span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_author( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  echo apply_filters( 'topic_author', get_topic_author( $id ), $topic-&gt;topic_poster, $topic-&gt;topic_id ); <span class="comment"><span class="comment">// $topic-&gt;topic_poster = user ID</span></span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_author( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  $first_post = bb_get_first_post( $topic );&nbsp;</div></li><li><div>  if ( !empty( $first_post ) ) {&nbsp;</div></li><li><div>      $user_display_name = get_post_author( $first_post-&gt;post_id );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $user_display_name = $topic-&gt;topic_poster_name;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'get_topic_author', $user_display_name, $topic-&gt;topic_poster, $topic-&gt;topic_id ); <span class="comment"><span class="comment">// $topic-&gt;topic_poster = user ID</span></span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Filters expect the format to by mysql on both topic_time and get_topic_time</span>&nbsp;</div></li><li><div>function topic_time( $args = '' ) {&nbsp;</div></li><li><div>  $args = _bb_parse_time_function_args( $args );&nbsp;</div></li><li><div>  $time = apply_filters( 'topic_time', get_topic_time( array('format' =&gt; 'mysql') + $args), $args );&nbsp;</div></li><li><div>  echo _bb_time_function_return( $time, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_time( $args = '' ) {&nbsp;</div></li><li><div>  $args = _bb_parse_time_function_args( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $args['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $time = apply_filters( 'get_topic_time', $topic-&gt;topic_time, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return _bb_time_function_return( $time, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_start_time( $args = '' ) {&nbsp;</div></li><li><div>  $args = _bb_parse_time_function_args( $args );&nbsp;</div></li><li><div>  $time = apply_filters( 'topic_start_time', get_topic_start_time( array('format' =&gt; 'mysql') + $args), $args );&nbsp;</div></li><li><div>  echo _bb_time_function_return( $time, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_start_time( $args = '' ) {&nbsp;</div></li><li><div>  $args = _bb_parse_time_function_args( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $args['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $time = apply_filters( 'get_topic_start_time', $topic-&gt;topic_start_time, $args, $topic-&gt;topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return _bb_time_function_return( $time, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_last_post_link( $id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'topic_last_post_link', get_topic_last_post_link( $id ), $id);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_last_post_link( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  $page = bb_get_page_number( $topic-&gt;topic_posts );&nbsp;</div></li><li><div>  return apply_filters( 'get_post_link', get_topic_link( $topic-&gt;topic_id, $page ) . &quot;#post-$topic-&gt;topic_last_post_id&quot;, $topic-&gt;topic_last_post_id, $topic-&gt;topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_pages( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Compatibility</span></span>&nbsp;</div></li><li><div>  if ( $args && is_numeric( $args ) ) {&nbsp;</div></li><li><div>      $args = array( 'id' =&gt; $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $defaults = array( 'id' =&gt; 0, 'before' =&gt; '', 'after' =&gt; '' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $page;&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $args['id'] ) );&nbsp;</div></li><li><div>  $add = topic_pages_add( $topic-&gt;topic_id );&nbsp;</div></li><li><div>  if ( $pages = apply_filters( 'topic_pages', get_page_number_links( $page, $topic-&gt;topic_posts + $add ), $topic-&gt;topic_id ) ) {&nbsp;</div></li><li><div>      echo $args['before'] . $pages . $args['after'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_pages_add( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  if ( isset($_GET['view']) && 'all' == $_GET['view'] && bb_current_user_can('browse_deleted') && isset( $topic-&gt;deleted_posts ) )&nbsp;</div></li><li><div>      $add = $topic-&gt;deleted_posts;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $add = 0;&nbsp;</div></li><li><div>  return apply_filters( 'topic_pages_add', $add, isset($topic-&gt;topic_id) ? $topic-&gt;topic_id : 0 );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_page_number_links( $args ) {&nbsp;</div></li><li><div>  if ( 1 &lt; func_num_args() ) {&nbsp;</div></li><li><div>      $_args = func_get_args();&nbsp;</div></li><li><div>      $args = array(&nbsp;</div></li><li><div>          'page' =&gt; $_args[0], &nbsp;</div></li><li><div>          'total' =&gt; $_args[1], &nbsp;</div></li><li><div>          'per_page' =&gt; isset( $_args[2] ) ? $_args[2] : '', &nbsp;</div></li><li><div>          'mod_rewrite' =&gt; isset( $_args[3] ) ? $_args[3] : 'use_option'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'page' =&gt; 1, &nbsp;</div></li><li><div>      'total' =&gt; false, &nbsp;</div></li><li><div>      'per_page' =&gt; '', &nbsp;</div></li><li><div>      'mod_rewrite' =&gt; 'use_option', &nbsp;</div></li><li><div>      'prev_text' =&gt; __( '&laquo; Previous' ), &nbsp;</div></li><li><div>      'next_text' =&gt; __( 'Next &raquo;' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $add_args = array();&nbsp;</div></li><li><div>  $uri = rtrim( $_SERVER['REQUEST_URI'], '?&' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $mod_rewrite === 'use_option' ) {&nbsp;</div></li><li><div>      $mod_rewrite = bb_get_option( 'mod_rewrite' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $mod_rewrite ) {&nbsp;</div></li><li><div>      $format = '/page/%#%';&nbsp;</div></li><li><div>      if ( 1 == $page ) {&nbsp;</div></li><li><div>          if ( false === $pos = strpos($uri, '?') )&nbsp;</div></li><li><div>              $uri = $uri . '%_%';&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $uri = substr_replace($uri, '%_%', $pos, 0);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $uri = preg_replace('|/page/[0-9]+|', '%_%', $uri);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $uri = str_replace( '/%_%', '%_%', $uri );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( 1 == $page ) {&nbsp;</div></li><li><div>          if ( false === $pos = strpos($uri, '?') ) {&nbsp;</div></li><li><div>              $uri = $uri . '%_%';&nbsp;</div></li><li><div>              $format = '?page=%#%';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $uri = substr_replace($uri, '?%_%', $pos, 1);&nbsp;</div></li><li><div>              $format = 'page=%#%&';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( false === strpos($uri, '?page=') ) {&nbsp;</div></li><li><div>              $uri = preg_replace('!&page=[0-9]+!', '%_%', $uri );&nbsp;</div></li><li><div>              $uri = str_replace( '&page=', '', $uri );&nbsp;</div></li><li><div>              $format = '&page=%#%';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $uri = preg_replace('!\?page=[0-9]+!', '%_%', $uri );&nbsp;</div></li><li><div>              $uri = str_replace( '?page=', '', $uri );&nbsp;</div></li><li><div>              $format = '?page=%#%';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset($_GET['view']) && in_array($_GET['view'], bb_get_views()) )&nbsp;</div></li><li><div>      $add_args['view'] = $_GET['view'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $per_page ) ) {&nbsp;</div></li><li><div>      $per_page = bb_get_option( 'page_topics' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $links = bb_paginate_links( array(&nbsp;</div></li><li><div>      'base' =&gt; $uri, &nbsp;</div></li><li><div>      'format' =&gt; $format, &nbsp;</div></li><li><div>      'total' =&gt; ceil( $total/$per_page ), &nbsp;</div></li><li><div>      'current' =&gt; $page, &nbsp;</div></li><li><div>      'add_args' =&gt; $add_args, &nbsp;</div></li><li><div>      'type' =&gt; 'array', &nbsp;</div></li><li><div>      'mid_size' =&gt; 1, &nbsp;</div></li><li><div>      'prev_text' =&gt; $prev_text, &nbsp;</div></li><li><div>      'next_text' =&gt; $next_text&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ($links) {&nbsp;</div></li><li><div>      $links = join('', $links);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $links;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_topic_admin( $args = '' ) {&nbsp;</div></li><li><div>  $parts = array(&nbsp;</div></li><li><div>      'delete' =&gt; bb_get_topic_delete_link( $args ), &nbsp;</div></li><li><div>      'close' =&gt; bb_get_topic_close_link( $args ), &nbsp;</div></li><li><div>      'sticky' =&gt; bb_get_topic_sticky_link( $args ), &nbsp;</div></li><li><div>      'move' =&gt; bb_get_topic_move_dropdown( $args )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo join( &quot;\n&quot;, apply_filters( 'bb_topic_admin', $parts, $args ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_delete_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bb_get_topic_delete_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_topic_delete_link( $args = '' ) {&nbsp;</div></li><li><div>  $defaults = array( 'id' =&gt; 0, 'before' =&gt; '[', 'after' =&gt; ']', 'delete_text' =&gt; false, 'undelete_text' =&gt; false, 'redirect' =&gt; true );&nbsp;</div></li><li><div>  extract(wp_parse_args( $args, $defaults ), EXTR_SKIP);&nbsp;</div></li><li><div>  $id = (int) $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$topic || !bb_current_user_can( 'delete_topic', $topic-&gt;topic_id ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 0 == $topic-&gt;topic_status ) {&nbsp;</div></li><li><div>      if ( true === $redirect )&nbsp;</div></li><li><div>          $redirect = add_query_arg( bb_is_admin() ? array() : array( 'view' =&gt; 'all' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $query = array( 'id' =&gt; $topic-&gt;topic_id, '_wp_http_referer' =&gt; $redirect ? rawurlencode( $redirect ) : false );&nbsp;</div></li><li><div>      $confirm = __('Are you sure you want to delete that?');&nbsp;</div></li><li><div>      $display = esc_html( $delete_text ? $delete_text : __('Delete entire topic') );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( true === $redirect )&nbsp;</div></li><li><div>          $redirect = remove_query_arg( bb_is_admin() ? array() : 'view' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $query = array('id' =&gt; $topic-&gt;topic_id, 'view' =&gt; 'all', '_wp_http_referer' =&gt; $redirect ? rawurlencode( $redirect ) : false );&nbsp;</div></li><li><div>      $confirm = __('Are you sure you want to undelete that?');&nbsp;</div></li><li><div>      $display = esc_html( $undelete_text ? $undelete_text : __('Undelete entire topic') );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $uri = bb_get_uri('bb-admin/delete-topic.php', $query, BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_ADMIN);&nbsp;</div></li><li><div>  $uri = esc_url( bb_nonce_url( $uri, 'delete-topic_' . $topic-&gt;topic_id ) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $before . '&lt;a href=&quot;' . $uri . '&quot; onclick=&quot;return confirm(\'' . esc_js( $confirm ) . '\');&quot;&gt;' . $display . '&lt;/a&gt;' . $after;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_close_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bb_get_topic_close_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_topic_close_link( $args = '' ) {&nbsp;</div></li><li><div>  $defaults = array( 'id' =&gt; 0, 'before' =&gt; '[', 'after' =&gt; ']', 'close_text' =&gt; false, 'open_text' =&gt; false, 'redirect' =&gt; true );&nbsp;</div></li><li><div>  extract(wp_parse_args( $args, $defaults ), EXTR_SKIP);&nbsp;</div></li><li><div>  $id = (int) $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$topic || !bb_current_user_can( 'close_topic', $topic-&gt;topic_id ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( topic_is_open( $topic-&gt;topic_id ) )&nbsp;</div></li><li><div>      $display = esc_html( $close_text ? $close_text : __( 'Close topic' ) );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $display = esc_html( $open_text ? $open_text : __( 'Open topic' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $redirect )&nbsp;</div></li><li><div>      $redirect = $_SERVER['REQUEST_URI'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri = bb_get_uri('bb-admin/topic-toggle.php', array( 'id' =&gt; $topic-&gt;topic_id, '_wp_http_referer' =&gt; $redirect ? rawurlencode( $redirect ) : false ), BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_ADMIN);&nbsp;</div></li><li><div>  $uri = esc_url( bb_nonce_url( $uri, 'close-topic_' . $topic-&gt;topic_id ) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return $before . '&lt;a href=&quot;' . $uri . '&quot;&gt;' . $display . '&lt;/a&gt;' . $after;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_sticky_link( $args = '' ) {&nbsp;</div></li><li><div>  echo bb_get_topic_sticky_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_topic_sticky_link( $args = '' ) {&nbsp;</div></li><li><div>  $defaults = array( 'id' =&gt; 0, 'before' =&gt; '[', 'after' =&gt; ']' );&nbsp;</div></li><li><div>  extract(wp_parse_args( $args, $defaults ), EXTR_SKIP);&nbsp;</div></li><li><div>  $id = (int) $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$topic || !bb_current_user_can( 'stick_topic', $topic-&gt;topic_id ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri_stick = bb_get_uri('bb-admin/sticky.php', array('id' =&gt; $topic-&gt;topic_id), BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_ADMIN);&nbsp;</div></li><li><div>  $uri_stick = esc_url( bb_nonce_url( $uri_stick, 'stick-topic_' . $topic-&gt;topic_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri_super = bb_get_uri('bb-admin/sticky.php', array('id' =&gt; $topic-&gt;topic_id, 'super' =&gt; 1), BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_ADMIN);&nbsp;</div></li><li><div>  $uri_super = esc_url( bb_nonce_url( $uri_super, 'stick-topic_' . $topic-&gt;topic_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( topic_is_sticky( $topic-&gt;topic_id ) )&nbsp;</div></li><li><div>      return &quot;$before&lt;a href='&quot; . $uri_stick . &quot;'&gt;&quot;. __('Unstick topic') .&quot;&lt;/a&gt;$after&quot;;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      return &quot;$before&lt;a href='&quot; . $uri_stick . &quot;'&gt;&quot;. __('Stick topic') . &quot;&lt;/a&gt; (&lt;a href='&quot; . $uri_super . &quot;'&gt;&quot; . __('to front') . &quot;&lt;/a&gt;)$after&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_show_all_link( $id = 0 ) {&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'browse_deleted' ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  if ( 'all' == @$_GET['view'] )&nbsp;</div></li><li><div>      echo &quot;&lt;a href='&quot; . esc_attr( get_topic_link( $id ) ) . &quot;'&gt;&quot;. __('View normal posts') .&quot;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      echo &quot;&lt;a href='&quot; . esc_attr( add_query_arg( 'view', 'all', get_topic_link( $id ) ) ) . &quot;'&gt;&quot;. __('View all posts') .&quot;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_posts_link( $id = 0 ) {&nbsp;</div></li><li><div>  echo get_topic_posts_link( $id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_topic_posts_link( $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  $post_num = get_topic_posts( $id );&nbsp;</div></li><li><div>  $posts = sprintf(__ngettext( '%s post', '%s posts', $post_num ), $post_num);&nbsp;</div></li><li><div>  $r = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ( 'all' == @$_GET['view'] || bb_is_admin() ) && bb_current_user_can('browse_deleted') )&nbsp;</div></li><li><div>      $r .= &quot;&lt;a href='&quot; . esc_attr( get_topic_link( $id ) ) . &quot;'&gt;$posts&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $r .= $posts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bb_current_user_can( 'browse_deleted' ) ) {&nbsp;</div></li><li><div>      $user_id = bb_get_current_user_info( 'id' );&nbsp;</div></li><li><div>      if ( isset($topic-&gt;bozos[$user_id]) && 'all' != @$_GET['view'] )&nbsp;</div></li><li><div>          add_filter('get_topic_deleted_posts', create_function('$a', &quot;\$a -= {$topic-&gt;bozos[$user_id]}; return \$a;&quot;) );&nbsp;</div></li><li><div>      if ( $deleted = get_topic_deleted_posts( $id ) ) {&nbsp;</div></li><li><div>          $extra = sprintf(__('+%d more'), $deleted);&nbsp;</div></li><li><div>          if ( 'all' == @$_GET['view'] )&nbsp;</div></li><li><div>              $r .= &quot; $extra&quot;;&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $r .= &quot; &lt;a href='&quot; . esc_attr( add_query_arg( 'view', 'all', get_topic_link( $id ) ) ) . &quot;'&gt;$extra&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_move_dropdown( $args = '' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo bb_get_topic_move_dropdown( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_topic_move_dropdown( $args = '' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( $args && is_numeric( $args ) ) {&nbsp;</div></li><li><div>      $args = array( 'id' =&gt; (integer) $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array( 'id' =&gt; 0, 'before' =&gt; '[', 'after' =&gt; ']' );&nbsp;</div></li><li><div>  extract(wp_parse_args( $args, $defaults ), EXTR_SKIP);&nbsp;</div></li><li><div>  $id = (int) $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'move_topic', $topic-&gt;topic_id ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $dropdown = bb_get_forum_dropdown( array(&nbsp;</div></li><li><div>      'callback' =&gt; 'bb_current_user_can', &nbsp;</div></li><li><div>      'callback_args' =&gt; array('move_topic', $topic-&gt;topic_id), &nbsp;</div></li><li><div>      'selected' =&gt; $topic-&gt;forum_id, &nbsp;</div></li><li><div>      'tab' =&gt; false&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$dropdown )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = $before . '&lt;form id=&quot;topic-move&quot; method=&quot;post&quot; action=&quot;' . bb_get_uri( 'bb-admin/topic-move.php', null, BB_URI_CONTEXT_FORM_ACTION + BB_URI_CONTEXT_BB_ADMIN ) . '&quot;&gt;&lt;fieldset&gt;&lt;div&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  $r .= '&lt;input type=&quot;hidden&quot; name=&quot;topic_id&quot; value=&quot;' . $topic-&gt;topic_id . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  $r .= '&lt;label for=&quot;forum-id&quot;&gt;'. __( 'Move to' ) . '&lt;/label&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  $r .= $dropdown . &quot;\n&quot;;&nbsp;</div></li><li><div>  $r .= bb_nonce_field( 'move-topic_' . $topic-&gt;topic_id, '_wpnonce', true , false );&nbsp;</div></li><li><div>  $r .= '&lt;input type=&quot;submit&quot; name=&quot;Submit&quot; value=&quot;' . __( 'Move' ) . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  $r .= '&lt;/div&gt;&lt;/fieldset&gt;&lt;/form&gt;' . $after;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function topic_class( $class = '', $key = 'topic', $id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $id ) );&nbsp;</div></li><li><div>  $class = $class ? explode(' ', $class ) : array();&nbsp;</div></li><li><div>  if ( '1' === $topic-&gt;topic_status && bb_current_user_can( 'browse_deleted' ) )&nbsp;</div></li><li><div>      $class[] = 'deleted';&nbsp;</div></li><li><div>  elseif ( 1 &lt; $topic-&gt;topic_status && bb_current_user_can( 'browse_deleted' ) )&nbsp;</div></li><li><div>      $class[] = 'bozo';&nbsp;</div></li><li><div>  if ( '0' === $topic-&gt;topic_open )&nbsp;</div></li><li><div>      $class[] = 'closed';&nbsp;</div></li><li><div>  if ( 1 == $topic-&gt;topic_sticky && ( bb_is_forum() || bb_is_view() ) )&nbsp;</div></li><li><div>      $class[] = 'sticky';&nbsp;</div></li><li><div>  elseif ( 2 == $topic-&gt;topic_sticky && ( bb_is_front() || bb_is_forum() || bb_is_view() ) )&nbsp;</div></li><li><div>      $class[] = 'sticky super-sticky';&nbsp;</div></li><li><div>  $class = apply_filters( 'topic_class', $class, $topic-&gt;topic_id );&nbsp;</div></li><li><div>  $class = join(' ', $class);&nbsp;</div></li><li><div>  alt_class( $key, $class );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * bb_get_new_topic_link() - Get the link to the form for a new topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed The arguments for this function.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The link to the new topic form</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_get_new_topic_link( $args = null ) {&nbsp;</div></li><li><div>  $defaults = array( 'text' =&gt; __('Add New &raquo;'), 'forum' =&gt; 0, 'tag' =&gt; '' );&nbsp;</div></li><li><div>  if ( $args && is_string($args) && false === strpos($args, '=') )&nbsp;</div></li><li><div>      $args = array( 'text' =&gt; $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $forum && $forum = bb_get_forum( $forum ) )&nbsp;</div></li><li><div>      $url = get_forum_link( $forum-&gt;forum_id ) . '#postform';&nbsp;</div></li><li><div>  elseif ( $tag && $tag = bb_get_tag( $tag ) )&nbsp;</div></li><li><div>      $url = bb_get_tag_link( $tag-&gt;tag ) . '#postform';&nbsp;</div></li><li><div>  elseif ( bb_is_forum() ) {&nbsp;</div></li><li><div>      global $forum;&nbsp;</div></li><li><div>      $url = get_forum_link( $forum-&gt;forum_id ) . '#postform';&nbsp;</div></li><li><div>  } elseif ( bb_is_tag() ) {&nbsp;</div></li><li><div>      global $tag;&nbsp;</div></li><li><div>      $url = bb_get_tag_link( $tag ) . '#postform';&nbsp;</div></li><li><div>  } elseif ( bb_is_topic() )&nbsp;</div></li><li><div>      $url = get_forum_link() . '#postform';&nbsp;</div></li><li><div>  elseif ( bb_is_front() )&nbsp;</div></li><li><div>      $url = bb_get_uri(null, array('new' =&gt; 1));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bb_is_user_logged_in() && bb_is_login_required() )&nbsp;</div></li><li><div>      $url = bb_get_uri('bb-login.php', array('redirect_to' =&gt; $url), BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_USER_FORMS);&nbsp;</div></li><li><div>  elseif ( bb_is_forum() || bb_is_topic() ) {&nbsp;</div></li><li><div>      if ( !bb_current_user_can( 'write_topic', get_forum_id() ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( !bb_current_user_can( 'write_topics' ) )&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $url = esc_attr( apply_filters( 'new_topic_url', $url, $args ) ) )&nbsp;</div></li><li><div>      return '&lt;a href=&quot;' . $url . '&quot; class=&quot;new-topic&quot;&gt;' . $text . '&lt;/a&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_new_topic_link( $args = null ) {&nbsp;</div></li><li><div>  echo bb_get_new_topic_link($args);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_new_topic_forum_dropdown( $args = '' ) {&nbsp;</div></li><li><div>  if ( !is_array( $args ) ) {&nbsp;</div></li><li><div>      $args = array(&nbsp;</div></li><li><div>          'callback' =&gt; 'bb_current_user_can', &nbsp;</div></li><li><div>          'callback_args' =&gt; array( 'write_topic' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( !isset( $args['callback'] ) && !isset( $args['callback_args'] ) ) {&nbsp;</div></li><li><div>      $args['callback'] = 'bb_current_user_can';&nbsp;</div></li><li><div>      $args['callback_args'] = array( 'write_topic' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  bb_forum_dropdown( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_topic_search_form( $args = null, $query_obj = null ) {&nbsp;</div></li><li><div>  global $bb_query_form;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $query_obj && is_a($query_obj, 'BB_Query_Form') ); <span class="comment"><span class="comment">// [sic]</span></span>&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $query_obj =& $bb_query_form;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $query_obj-&gt;form( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_search_pages( $args = null ) {&nbsp;</div></li><li><div>  global $page, $search_count, $per_page;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $defaults = array( 'before' =&gt; '', 'after' =&gt; '' );&nbsp;</div></li><li><div>   $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ( $pages = apply_filters( 'bb_search_pages', get_page_number_links( array( 'page' =&gt; $page, 'total' =&gt; $search_count, 'per_page' =&gt; $per_page, 'mod_rewrite' =&gt; false ) ) ) )&nbsp;</div></li><li><div>      echo $args['before'] . $pages . $args['after'];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * bb_topic_pagecount() - Print the total page count for a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.9</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id The topic id of the topic being queried</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_topic_pagecount( $topic_id = 0 ) {&nbsp;</div></li><li><div>  echo bb_get_topic_pagecount( $topic_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * bb_get_topic_pagecount() - Get the total page count for a topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.9</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id The topic id of the topic being queried</span>&nbsp;</div></li><li><div><span class="comment"> * @return int The total number of pages in the topic</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_get_topic_pagecount( $topic_id = 0 ) {&nbsp;</div></li><li><div>  $topic = get_topic( get_topic_id( $topic_id ) );&nbsp;</div></li><li><div>  return bb_get_page_number( $topic-&gt;topic_posts + topic_pages_add() );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * bb_is_topic_lastpage() - Report whether the current page is the last page of a given topic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.9</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $topic_id The topic id of the topic being queried</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean True if called on the last page of a topic, otherwise false</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_is_topic_lastpage( $topic_id = 0 ) {&nbsp;</div></li><li><div>  global $page;&nbsp;</div></li><li><div>  return ( $page == bb_get_topic_pagecount( $topic_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// POSTS</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_id( $post_id = 0 ) {&nbsp;</div></li><li><div>  echo get_post_id( $post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_id( $post_id = 0 ) {&nbsp;</div></li><li><div>  global $bb_post;&nbsp;</div></li><li><div>  $post_id = (int) $post_id;&nbsp;</div></li><li><div>  if ( $post_id )&nbsp;</div></li><li><div>      $post = bb_get_post( $post_id );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $post =& $bb_post;&nbsp;</div></li><li><div>  return $post-&gt;post_id;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_link( $post_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'post_link', get_post_link( $post_id ), get_post_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_link( $post_id = 0 ) {&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $post_id ) );&nbsp;</div></li><li><div>  $page = bb_get_page_number( $bb_post-&gt;post_position );&nbsp;</div></li><li><div>  return apply_filters( 'get_post_link', get_topic_link( $bb_post-&gt;topic_id, $page ) . &quot;#post-$bb_post-&gt;post_id&quot;, $bb_post-&gt;post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_anchor_link( $force_full = false ) {&nbsp;</div></li><li><div>  if ( defined('DOING_AJAX') || $force_full )&nbsp;</div></li><li><div>      post_link();&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      echo '#post-' . get_post_id();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_position( $post_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'post_position', get_post_position( $post_id ), get_post_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_position( $post_id = 0 ) {&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $post_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_post_position', $bb_post-&gt;post_position, $bb_post-&gt;post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_position_link( $topic_id = 0, $position = 1 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'post_position_link', get_post_position_link( $topic_id, $position ), get_topic_id( $topic_id ), (integer) $position );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_position_link( $topic_id = 0, $position = 1 ) {&nbsp;</div></li><li><div>  $position = (integer) $position;&nbsp;</div></li><li><div>  $bb_topic = get_topic( get_topic_id( $topic_id ) );&nbsp;</div></li><li><div>  if ( $bb_topic-&gt;topic_posts &lt; $position ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $page = bb_get_page_number( $position );&nbsp;</div></li><li><div>  return apply_filters( 'get_post_position_link', get_topic_link( $bb_post-&gt;topic_id, $page ) . &quot;#position-$position&quot;, $bb_topic-&gt;topic_id, $position );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_post_meta( $key, $post_id = 0 ) {&nbsp;</div></li><li><div>  echo bb_get_post_meta( $key, $post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_post_meta( $key, $post_id = 0 ) {&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $post_id ) );&nbsp;</div></li><li><div>  if ( isset($bb_post-&gt;$key) )&nbsp;</div></li><li><div>      return $bb_post-&gt;$key;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_author( $post_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters('post_author', get_post_author( $post_id ), $post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_author( $post_id = 0 ) {&nbsp;</div></li><li><div>  if ( $user = bb_get_user( get_post_author_id( $post_id ) ) )&nbsp;</div></li><li><div>      return apply_filters( 'get_post_author', $user-&gt;display_name, $user-&gt;ID, $post_id );&nbsp;</div></li><li><div>  elseif ( $title = bb_get_post_meta( 'pingback_title', $post_id ) )&nbsp;</div></li><li><div>      return apply_filters( 'bb_get_pingback_title', $title, $post_id );&nbsp;</div></li><li><div>  elseif ( $title = bb_get_post_meta( 'post_author', $post_id ) )&nbsp;</div></li><li><div>      return apply_filters( 'get_post_author', $title, 0, $post_id );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      return apply_filters( 'get_post_author', __('Anonymous'), 0, $post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_author_link( $post_id = 0 ) {&nbsp;</div></li><li><div>  if ( $link = ( bb_get_option( 'name_link_profile' ) ? get_user_profile_link( get_post_author_id( $post_id ) ) : get_user_link( get_post_author_id( $post_id ) ) ) ) {&nbsp;</div></li><li><div>      echo '&lt;a href=&quot;' . esc_attr( $link ) . '&quot;&gt;' . get_post_author( $post_id ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>  } elseif ( $link = bb_get_post_meta( 'pingback_uri' )) {&nbsp;</div></li><li><div>      echo '&lt;a href=&quot;' . esc_attr( $link ) . '&quot;&gt;' . get_post_author( $post_id ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>  } elseif ( $link = bb_get_post_meta( 'post_url' ) ) {&nbsp;</div></li><li><div>      echo '&lt;a href=&quot;' . esc_attr( $link ) . '&quot;&gt;' . get_post_author( $post_id ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      post_author( $post_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_author_avatar( $size = '48', $default = '', $post_id = 0 ) {&nbsp;</div></li><li><div>  if ( ! bb_get_option('avatars_show') )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $author_id = get_post_author_id( $post_id );&nbsp;</div></li><li><div>  echo bb_get_avatar( $author_id, $size, $default );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_author_avatar_link( $size = '48', $default = '', $post_id = 0 ) {&nbsp;</div></li><li><div>  if ( ! bb_get_option('avatars_show') )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $author_id = get_post_author_id( $post_id );&nbsp;</div></li><li><div>  if ( $link = get_user_link( $author_id ) ) {&nbsp;</div></li><li><div>      echo '&lt;a href=&quot;' . esc_attr( $link ) . '&quot;&gt;' . bb_get_avatar( $author_id, $size, $default ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      echo bb_get_avatar( $author_id, $size, $default );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_text( $post_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'post_text', get_post_text( $post_id ), get_post_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_text( $post_id = 0 ) {&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $post_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_post_text', $bb_post-&gt;post_text, $bb_post-&gt;post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_post_time( $args = '' ) {&nbsp;</div></li><li><div>  $args = _bb_parse_time_function_args( $args );&nbsp;</div></li><li><div>  $time = apply_filters( 'bb_post_time', bb_get_post_time( array('format' =&gt; 'mysql') + $args ), $args );&nbsp;</div></li><li><div>  echo _bb_time_function_return( $time, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_post_time( $args = '' ) {&nbsp;</div></li><li><div>  $args = _bb_parse_time_function_args( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $args['id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $time = apply_filters( 'bb_get_post_time', $bb_post-&gt;post_time, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return _bb_time_function_return( $time, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_ip( $post_id = 0 ) {&nbsp;</div></li><li><div>  if ( bb_current_user_can( 'view_by_ip' ) )&nbsp;</div></li><li><div>      echo apply_filters( 'post_ip', get_post_ip( $post_id ), get_post_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_ip( $post_id = 0 ) {&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $post_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_post_ip', $bb_post-&gt;poster_ip, $bb_post-&gt;post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_post_admin( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'post_id' =&gt; 0, &nbsp;</div></li><li><div>      'before' =&gt; '', &nbsp;</div></li><li><div>      'after' =&gt; '', &nbsp;</div></li><li><div>      'before_each' =&gt; '', &nbsp;</div></li><li><div>      'after_each' =&gt; &quot;\n&quot;, &nbsp;</div></li><li><div>      'each' =&gt; array(&nbsp;</div></li><li><div>          'ip' =&gt; array(&nbsp;</div></li><li><div>              'post_id' =&gt; 0&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'edit' =&gt; array(&nbsp;</div></li><li><div>              'post_id' =&gt; 0&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'delete' =&gt; array(&nbsp;</div></li><li><div>              'post_id' =&gt; 0&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'undelete' =&gt; array(&nbsp;</div></li><li><div>              'post_id' =&gt; 0&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( isset( $args['each'] ) ) {&nbsp;</div></li><li><div>      $each_args = $args['each'];&nbsp;</div></li><li><div>      $_each_args = $defaults['each'];&nbsp;</div></li><li><div>      foreach ( $each_args as $_part_name =&gt; $_part_args ) {&nbsp;</div></li><li><div>          if ( !isset( $defaults['each'][$_part_name] ) ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $_each_args[$_part_name] = wp_parse_args( $_part_args, $defaults['each'][$_part_name] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  if ( isset( $_each_args ) ) {&nbsp;</div></li><li><div>      $args['each'] = $_each_args;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $parts = array();&nbsp;</div></li><li><div>  if ( is_array( $args['each'] ) && count( $args['each'] ) ) {&nbsp;</div></li><li><div>      foreach ( $args['each'] as $_part_name =&gt; $_part_args ) {&nbsp;</div></li><li><div>          if ( $args['post_id'] && !$_part_args['post_id'] ) {&nbsp;</div></li><li><div>              $_part_args['post_id'] = $args['post_id'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $args['before_each'] && !$_part_args['before'] ) {&nbsp;</div></li><li><div>              $_part_args['before'] = $args['before_each'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $args['after_each'] && !$_part_args['after'] ) {&nbsp;</div></li><li><div>              $_part_args['after'] = $args['after_each'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $_part_function = 'bb_get_post_' . $_part_name . '_link';&nbsp;</div></li><li><div>          $parts[$_part_name] = $_part_function( $_part_args );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// For the benefit of filters, mark the final part</span>&nbsp;</div></li><li><div>      if ( !isset( $args['last_each'] ) ) {&nbsp;</div></li><li><div>          $args['last_each'] = $_part_args;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $parts = apply_filters( 'bb_post_admin', $parts, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !count( $parts ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo $args['before'] . join( '', $parts ) . $args['after'];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_ip_link( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo bb_get_post_ip_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_post_ip_link( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'view_by_ip' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'post_id' =&gt; 0, &nbsp;</div></li><li><div>      'before' =&gt; '', &nbsp;</div></li><li><div>      'after' =&gt; '', &nbsp;</div></li><li><div>      'text' =&gt; '%s'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( is_numeric( $args ) ) {&nbsp;</div></li><li><div>      $args = array( 'post_id' =&gt; $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $args['post_id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri = bb_get_uri( 'bb-admin/posts.php', array( 'poster_ip' =&gt; get_post_ip( $bb_post-&gt;post_id ) ), BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_ADMIN );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Make sure that the last tag in $before gets a class (if it's there)</span></span></span></span>&nbsp;</div></li><li><div>  if ( preg_match( '/.*(&lt;[^&gt;]+&gt;)[^&lt;]*/', $args['before'], $_node ) ) {&nbsp;</div></li><li><div>      if ( preg_match( '/class=(\'|&quot;)(.*)\1/U', $_node[1], $_class ) ) {&nbsp;</div></li><li><div>          $args['before'] = str_replace( $_class[0], 'class=' . $_class[1] . 'before-post-ip-link ' . $_class[2] . $_class[1], $args['before'] );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $args['before'] = preg_replace( '/(.*)&lt;([a-z0-9_-]+)(\s?)([^&gt;]*)&gt;([^&lt;]*)/i', '$1&lt;$2 class=&quot;before-post-ip-link&quot;$3$4&gt;$5', $args['before'], 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $link = $args['before'] . '&lt;a class=&quot;post-ip-link&quot; href=&quot;' . esc_attr( $uri ) . '&quot;&gt;' . esc_html( sprintf( $args['text'], get_post_ip( $bb_post-&gt;post_id ) ) ) . '&lt;/a&gt;' . $args['after'];&nbsp;</div></li><li><div>  return apply_filters( 'post_ip_link', $link, $bb_post-&gt;post_id, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_edit_link( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo bb_get_post_edit_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_post_edit_link( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'post_id' =&gt; 0, &nbsp;</div></li><li><div>      'before' =&gt; '', &nbsp;</div></li><li><div>      'after' =&gt; '', &nbsp;</div></li><li><div>      'text' =&gt; __( 'Edit' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( is_numeric( $args ) ) {&nbsp;</div></li><li><div>      $args = array( 'post_id' =&gt; $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $args['post_id'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bb_current_user_can( 'edit_post', $bb_post-&gt;post_id ) ) {&nbsp;</div></li><li><div>      $uri = bb_get_uri( 'edit.php', array( 'id' =&gt; $bb_post-&gt;post_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Make sure that the last tag in $before gets a class (if it's there)</span></span></span></span>&nbsp;</div></li><li><div>      if ( preg_match( '/.*(&lt;[^&gt;]+&gt;)[^&lt;]*/', $args['before'], $_node ) ) {&nbsp;</div></li><li><div>          if ( preg_match( '/class=(\'|&quot;)(.*)\1/U', $_node[1], $_class ) ) {&nbsp;</div></li><li><div>              $args['before'] = str_replace( $_class[0], 'class=' . $_class[1] . 'before-post-edit-link ' . $_class[2] . $_class[1], $args['before'] );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $args['before'] = preg_replace( '/(.*)&lt;([a-z0-9_-]+)(\s?)([^&gt;]*)&gt;([^&lt;]*)/i', '$1&lt;$2 class=&quot;before-post-edit-link&quot;$3$4&gt;$5', $args['before'], 1 );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $r = $args['before'] . '&lt;a class=&quot;post-edit-link&quot; href=&quot;' . esc_attr( apply_filters( 'post_edit_uri', $uri, $bb_post-&gt;post_id, $args ) ) . '&quot;&gt;' . esc_html( $args['text'] ) . '&lt;/a&gt;' . $args['after'];&nbsp;</div></li><li><div>      return apply_filters( 'bb_get_post_edit_link', $r, $bb_post-&gt;post_id, $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_del_class( $post_id = 0 )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $post_id ) );&nbsp;</div></li><li><div>  $classes = array();&nbsp;</div></li><li><div>  if ( bb_get_post_meta( 'pingback_uri', $post_id ) ) {&nbsp;</div></li><li><div>      $classes[] = 'pingback';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $bb_post-&gt;post_status == 1 ) {&nbsp;</div></li><li><div>      $classes[] = 'deleted';&nbsp;</div></li><li><div>  } elseif ( $bb_post-&gt;post_status != 0 ) {&nbsp;</div></li><li><div>      $classes[] = 'post-status-' . $bb_post-&gt;post_status;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( count( $classes ) ) {&nbsp;</div></li><li><div>      $classes = join( ' ', $classes );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $classes = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'post_del_class', $classes, $bb_post-&gt;post_id, $bb_post );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_delete_link( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo bb_get_post_delete_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_post_delete_link( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'post_id' =&gt; 0, &nbsp;</div></li><li><div>      'before' =&gt; '', &nbsp;</div></li><li><div>      'after' =&gt; '', &nbsp;</div></li><li><div>      'text' =&gt; __( 'Delete' ), &nbsp;</div></li><li><div>      'redirect' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( is_numeric( $args ) || is_object( $args ) ) {&nbsp;</div></li><li><div>      $args = array( 'post_id' =&gt; $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( isset( $args['delete_text'] ) && ( !isset( $args['text'] ) || !$args['text'] ) ) {&nbsp;</div></li><li><div>      $args['text'] = $args['delete_text'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $post_id ) );&nbsp;</div></li><li><div>  <span class="comment">//if ( bb_is_first( $bb_post-&gt;post_id ) ) {</span>&nbsp;</div></li><li><div>  <span class="comment">//    $topic = get_topic( $bb_post-&gt;topic_id );</span>&nbsp;</div></li><li><div>  <span class="comment">//    if ( 2 &gt; $topic-&gt;topic_posts ) {</span>&nbsp;</div></li><li><div>          <span class="comment">// Should delete the whole topic</span>&nbsp;</div></li><li><div>  <span class="comment">//        return;</span>&nbsp;</div></li><li><div>  <span class="comment">//    }</span>&nbsp;</div></li><li><div>  <span class="comment">//}</span>&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'delete_post', $bb_post-&gt;post_id ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $redirect ) {&nbsp;</div></li><li><div>      $redirect = $_SERVER['REQUEST_URI'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri = bb_get_uri('bb-admin/delete-post.php', array(&nbsp;</div></li><li><div>      'id' =&gt; $bb_post-&gt;post_id, &nbsp;</div></li><li><div>      'status' =&gt; 1, &nbsp;</div></li><li><div>      '_wp_http_referer' =&gt; $redirect ? rawurlencode( $redirect ) : false&nbsp;</div></li><li><div> ), BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_ADMIN);&nbsp;</div></li><li><div>  $uri = esc_url( bb_nonce_url( $uri, 'delete-post_' . $bb_post-&gt;post_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ( bb_is_admin() || isset( $_GET['view'] ) && 'all' == $_GET['view'] ) ) {&nbsp;</div></li><li><div>      $ajax_class = 'dim:thread:post-' . $bb_post-&gt;post_id . ':deleted:FF3333:FFFF33:action=delete-post&amp;status=1';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $ajax_class = 'delete:thread:post-' . $bb_post-&gt;post_id . '::status=1';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $text = esc_html( $text );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Make sure that the last tag in $before gets a class (if it's there)</span></span></span></span>&nbsp;</div></li><li><div>  if ( preg_match( '/.*(&lt;[^&gt;]+&gt;)[^&lt;]*/', $before, $_node ) ) {&nbsp;</div></li><li><div>      if ( preg_match( '/class=(\'|&quot;)(.*)\1/U', $_node[1], $_class ) ) {&nbsp;</div></li><li><div>          $before = str_replace( $_class[0], 'class=' . $_class[1] . 'before-post-delete-link ' . $_class[2] . $_class[1], $before );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $before = preg_replace( '/(.*)&lt;([a-z0-9_-]+)(\s?)([^&gt;]*)&gt;([^&lt;]*)/i', '$1&lt;$2 class=&quot;before-post-delete-link&quot;$3$4&gt;$5', $before, 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = $before . '&lt;a href=&quot;' . $uri . '&quot; class=&quot;' . $ajax_class . ' post-delete-link&quot;&gt;' . $text . '&lt;/a&gt;' . $after;&nbsp;</div></li><li><div>  $r = apply_filters( 'post_delete_link', $r, $bb_post-&gt;post_status, $bb_post-&gt;post_id, $args );&nbsp;</div></li><li><div>  return $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_post_undelete_link( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo bb_get_post_undelete_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_post_undelete_link( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'post_id' =&gt; 0, &nbsp;</div></li><li><div>      'before' =&gt; '', &nbsp;</div></li><li><div>      'after' =&gt; '', &nbsp;</div></li><li><div>      'text' =&gt; __( 'Undelete' ), &nbsp;</div></li><li><div>      'redirect' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  if ( is_numeric( $args ) || is_object( $args ) ) {&nbsp;</div></li><li><div>      $args = array( 'post_id' =&gt; $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $post_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'delete_post', $bb_post-&gt;post_id ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $redirect ) {&nbsp;</div></li><li><div>      $redirect = $_SERVER['REQUEST_URI'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri = bb_get_uri('bb-admin/delete-post.php', array(&nbsp;</div></li><li><div>      'id' =&gt; $bb_post-&gt;post_id, &nbsp;</div></li><li><div>      'status' =&gt; 0, &nbsp;</div></li><li><div>      'view' =&gt; 'all', &nbsp;</div></li><li><div>      '_wp_http_referer' =&gt; $redirect ? rawurlencode( $redirect ) : false&nbsp;</div></li><li><div> ), BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_ADMIN);&nbsp;</div></li><li><div>  $uri = esc_url( bb_nonce_url( $uri, 'delete-post_' . $bb_post-&gt;post_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $ajax_class = 'dim:thread:post-' . $bb_post-&gt;post_id . ':deleted:FF3333:FFFF33:action=delete-post&amp;status=0';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $text = esc_html( $text );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Make sure that the last tag in $before gets a class (if it's there)</span></span></span></span>&nbsp;</div></li><li><div>  if ( preg_match( '/.*(&lt;[^&gt;]+&gt;)[^&lt;]*/', $before, $_node ) ) {&nbsp;</div></li><li><div>      if ( preg_match( '/class=(\'|&quot;)(.*)\1/U', $_node[1], $_class ) ) {&nbsp;</div></li><li><div>          $before = str_replace( $_class[0], 'class=' . $_class[1] . 'before-post-undelete-link ' . $_class[2] . $_class[1], $before );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $before = preg_replace( '/(.*)&lt;([a-z0-9_-]+)(\s?)([^&gt;]*)&gt;([^&lt;]*)/i', '$1&lt;$2 class=&quot;before-post-undelete-link&quot;$3$4&gt;$5', $before, 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = $before . '&lt;a href=&quot;' . $uri . '&quot; class=&quot;' . $ajax_class . ' post-undelete-link&quot;&gt;' . $text . '&lt;/a&gt;' . $after;&nbsp;</div></li><li><div>  $r = apply_filters( 'post_undelete_link', $r, $bb_post-&gt;post_status, $bb_post-&gt;post_id, $args );&nbsp;</div></li><li><div>  return $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_author_id( $post_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'post_author_id', get_post_author_id( $post_id ), get_post_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_author_id( $post_id = 0 ) {&nbsp;</div></li><li><div>  $bb_post = bb_get_post( get_post_id( $post_id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_post_author_id', (int) $bb_post-&gt;poster_id, get_post_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_author_title( $post_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'post_author_title', get_post_author_title( $post_id ), get_post_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_author_title( $post_id = 0 ) {&nbsp;</div></li><li><div>  return get_user_title( get_post_author_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_author_title_link( $post_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'post_author_title_link', get_post_author_title_link( $post_id ), get_post_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_post_author_title_link( $post_id = 0 ) {&nbsp;</div></li><li><div>  $title = get_post_author_title( $post_id );&nbsp;</div></li><li><div>  if ( false === $title ) {&nbsp;</div></li><li><div>      if ( bb_get_post_meta( 'pingback_uri', $post_id ) )&nbsp;</div></li><li><div>          $r = __('PingBack');&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $r = __('Unregistered'); <span class="comment"><span class="comment">// This should never happen</span></span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( $link = bb_get_option( 'name_link_profile' ) ? get_user_link( get_post_author_id( $post_id ) ) : get_user_profile_link( get_post_author_id( $post_id ) ) )&nbsp;</div></li><li><div>          $r = '&lt;a href=&quot;' . esc_attr( $link ) . '&quot;&gt;' . $title . '&lt;/a&gt;';&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $r = $title;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'get_post_author_title_link', $r, get_post_id( $post_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function post_author_type( $post_id = 0 ) {&nbsp;</div></li><li><div>  $id = get_post_author_id( $post_id );&nbsp;</div></li><li><div>  $type = get_user_type( $id );&nbsp;</div></li><li><div>  if ( false === $type ) {&nbsp;</div></li><li><div>      if ( bb_get_post_meta( 'pingback_uri', $post_id ) )&nbsp;</div></li><li><div>          $r = __('PingBack');&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $r = __('Unregistered'); <span class="comment"><span class="comment">// This should never happen</span></span>&nbsp;</div></li><li><div>  } else&nbsp;</div></li><li><div>      $r = '&lt;a href=&quot;' . esc_attr( get_user_profile_link( $id ) ) . '&quot;&gt;' . $type . '&lt;/a&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo apply_filters( 'post_author_type', $r, $post_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function allowed_markup( $args = '' ) {&nbsp;</div></li><li><div>  echo apply_filters( 'allowed_markup', get_allowed_markup( $args ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// format=list or array( 'format' =&gt; 'list' )</span>&nbsp;</div></li><li><div>function get_allowed_markup( $args = '' ) {&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, array('format' =&gt; 'flat') );&nbsp;</div></li><li><div>  extract($args, EXTR_SKIP);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tags = bb_allowed_tags();&nbsp;</div></li><li><div>  unset($tags['pre'], $tags['br']);&nbsp;</div></li><li><div>  $tags = array_keys($tags);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $format ) :&nbsp;</div></li><li><div>  case 'array' :&nbsp;</div></li><li><div>      $r = $tags;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'list' :&nbsp;</div></li><li><div>      $r = &quot;&lt;ul class='allowed-markup'&gt;\n\t&lt;li&gt;&quot;;&nbsp;</div></li><li><div>      $r .= join(&quot;&lt;/li&gt;\n\t&lt;li&gt;&quot;, $tags);&nbsp;</div></li><li><div>      $r .= &quot;&lt;/li&gt;\n&lt;/ul&gt;\n&quot;;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  default :&nbsp;</div></li><li><div>      $r = join(' ', $tags);&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  endswitch;&nbsp;</div></li><li><div>  return apply_filters( 'get_allowed_markup', $r, $format );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// USERS</span>&nbsp;</div></li><li><div>function bb_get_user_id( $id = 0 ) {&nbsp;</div></li><li><div>  global $user;&nbsp;</div></li><li><div>  if ( is_object($id) && isset($id-&gt;ID) )&nbsp;</div></li><li><div>      return (int) $id-&gt;ID;&nbsp;</div></li><li><div>  elseif ( !$id )&nbsp;</div></li><li><div>      return $user-&gt;ID;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_user = bb_get_user( (int) $id );&nbsp;</div></li><li><div>  return isset($_user-&gt;ID) ? $_user-&gt;ID : 0;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function user_profile_link( $id = 0 , $page = 1, $context = BB_URI_CONTEXT_A_HREF ) {&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo apply_filters( 'user_profile_link', get_user_profile_link( $id ), bb_get_user_id( $id ), $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_user_profile_link( $id = 0, $page = 1, $context = BB_URI_CONTEXT_A_HREF ) {&nbsp;</div></li><li><div>  $user = bb_get_user( bb_get_user_id( $id ) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $rewrite = bb_get_option( 'mod_rewrite' );&nbsp;</div></li><li><div>  if ( $rewrite ) {&nbsp;</div></li><li><div>      if ( $rewrite === 'slugs' ) {&nbsp;</div></li><li><div>          $column = 'user_nicename';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $column = 'ID';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $page = (1 &lt; $page) ? '/page/' . $page : '';&nbsp;</div></li><li><div>      $r = bb_get_uri('profile/' . $user-&gt;$column . $page, null, $context);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $query = array(&nbsp;</div></li><li><div>          'id' =&gt; $user-&gt;ID, &nbsp;</div></li><li><div>          'page' =&gt; (1 &lt; $page) ? $page : false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $r = bb_get_uri('profile.php', $query, $context);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'get_user_profile_link', $r, $user-&gt;ID, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function user_delete_button() {&nbsp;</div></li><li><div>  global $user;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $user_obj = new BP_User( $user-&gt;ID );&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'keep_gate' ) && 'keymaster' == $user_obj-&gt;roles[0] )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ( bb_current_user_can( 'edit_users' ) && bb_get_current_user_info( 'id' ) != (int) $user-&gt;ID )&nbsp;</div></li><li><div>      echo apply_filters( 'user_delete_button', get_user_delete_button() );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_user_delete_button() {&nbsp;</div></li><li><div>  $r = '&lt;input type=&quot;submit&quot; class=&quot;delete&quot; name=&quot;delete-user&quot; value=&quot;' . __('Delete User &raquo;') . '&quot; ';&nbsp;</div></li><li><div>  $r .= 'onclick=&quot;return confirm(\'' . esc_js(__('Are you sure you want to delete this user?')) . '\')&quot; /&gt;';&nbsp;</div></li><li><div>  return apply_filters( 'get_user_delete_button', $r);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function profile_tab_link( $id = 0, $tab, $page = 1 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'profile_tab_link', get_profile_tab_link( $id, $tab ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_profile_tab_link( $id = 0, $tab, $page = 1, $context = BB_URI_CONTEXT_A_HREF ) {&nbsp;</div></li><li><div>  $user = bb_get_user( bb_get_user_id( $id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tab = bb_sanitize_with_dashes($tab);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $tab === 'edit' && !( $context & BB_URI_CONTEXT_BB_USER_FORMS ) ) {&nbsp;</div></li><li><div>      $context += BB_URI_CONTEXT_BB_USER_FORMS;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rewrite = bb_get_option( 'mod_rewrite' );&nbsp;</div></li><li><div>  if ( $rewrite ) {&nbsp;</div></li><li><div>      if ( $rewrite === 'slugs' ) {&nbsp;</div></li><li><div>          $column = 'user_nicename';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $column = 'ID';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $page = (1 &lt; $page) ? '/page/' . $page : '';&nbsp;</div></li><li><div>      $r = bb_get_uri('profile/' . $user-&gt;$column . '/' . $tab . $page, null, $context);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $query = array(&nbsp;</div></li><li><div>          'id' =&gt; $user-&gt;ID, &nbsp;</div></li><li><div>          'tab' =&gt; $tab, &nbsp;</div></li><li><div>          'page' =&gt; (1 &lt; $page) ? $page : false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $r = bb_get_uri('profile.php', $query, $context);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'get_profile_tab_link', $r, $user-&gt;ID, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function user_link( $id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'user_link', get_user_link( $id ), $id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_user_link( $id = 0 ) {&nbsp;</div></li><li><div>  if ( $user = bb_get_user( bb_get_user_id( $id ) ) )&nbsp;</div></li><li><div>      return apply_filters( 'get_user_link', $user-&gt;user_url, $user-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function full_user_link( $id = 0 ) {&nbsp;</div></li><li><div>  echo get_full_user_link( $id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_full_user_link( $id = 0 ) {&nbsp;</div></li><li><div>  if ( get_user_link( $id ) )&nbsp;</div></li><li><div>      $r = '&lt;a href=&quot;' . esc_attr( get_user_link( $id ) ) . '&quot;&gt;' . get_user_display_name( $id ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $r = get_user_display_name( $id );&nbsp;</div></li><li><div>  return $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function user_type_label( $type ) {&nbsp;</div></li><li><div>  echo apply_filters( 'user_type_label', get_user_type_label( $type ), $type );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_user_type_label( $type ) {&nbsp;</div></li><li><div>  global $wp_roles;&nbsp;</div></li><li><div>  if ( $wp_roles-&gt;is_role( $type ) )&nbsp;</div></li><li><div>      return apply_filters( 'get_user_type_label', $wp_roles-&gt;role_names[$type], $type );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function user_type( $id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'user_type', get_user_type( $id ), $id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_user_type( $id = 0 ) {&nbsp;</div></li><li><div>  if ( $user = bb_get_user( bb_get_user_id( $id ) ) ) :&nbsp;</div></li><li><div>      @$caps = array_keys($user-&gt;capabilities);&nbsp;</div></li><li><div>      if ( !$caps )&nbsp;</div></li><li><div>          $caps[] = 'inactive';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $type = get_user_type_label( $caps[0] ); <span class="comment">//Just support one role for now.</span>&nbsp;</div></li><li><div>  else :&nbsp;</div></li><li><div>      $type = false;&nbsp;</div></li><li><div>  endif;&nbsp;</div></li><li><div>  return apply_filters( 'get_user_type', $type, $user-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_user_name( $id = 0 ) {&nbsp;</div></li><li><div>  $user = bb_get_user( bb_get_user_id( $id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_user_name', $user-&gt;user_login, $user-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_user_display_name( $id = 0 ) {&nbsp;</div></li><li><div>  $user = bb_get_user( bb_get_user_id( $id ) );&nbsp;</div></li><li><div>  return apply_filters( 'get_user_display_name', $user-&gt;display_name, $user-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function user_title( $id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'user_title', get_user_title( $id ), bb_get_user_id( $id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_user_title( $id = 0 ) {&nbsp;</div></li><li><div>  $user = bb_get_user( bb_get_user_id( $id ) );&nbsp;</div></li><li><div>  return empty( $user-&gt;title ) ? get_user_type( $id ) : apply_filters( 'get_user_title', $user-&gt;title, $user-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function profile_pages( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array( 'before' =&gt; '', 'after' =&gt; '' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $page, $user;&nbsp;</div></li><li><div>  $add = apply_filters( 'profile_pages_add', $add );&nbsp;</div></li><li><div>  if ( $pages = apply_filters( 'profile_pages', get_page_number_links( $page, $user-&gt;topics_replied + $add ), $user-&gt;user_id ) ) {&nbsp;</div></li><li><div>      echo $args['before'] . $pages . $args['after'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_profile_data( $id = 0 ) {&nbsp;</div></li><li><div>  if ( !$user = bb_get_user( bb_get_user_id( $id ) ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $reg_time = bb_gmtstrtotime( $user-&gt;user_registered );&nbsp;</div></li><li><div>  $profile_info_keys = bb_get_profile_info_keys();&nbsp;</div></li><li><div>  echo &quot;&lt;dl id='userinfo'&gt;\n&quot;;&nbsp;</div></li><li><div>  echo &quot;\t&lt;dt&gt;&quot; . __('Member Since') . &quot;&lt;/dt&gt;\n&quot;;&nbsp;</div></li><li><div>  echo &quot;\t&lt;dd&gt;&quot; . bb_datetime_format_i18n($reg_time, 'date') . ' (' . bb_since($reg_time) . &quot;)&lt;/dd&gt;\n&quot;;&nbsp;</div></li><li><div>  if ( is_array( $profile_info_keys ) ) {&nbsp;</div></li><li><div>      foreach ( $profile_info_keys as $key =&gt; $label ) {&nbsp;</div></li><li><div>          if ( in_array($key, array('first_name', 'last_name', 'display_name')) || !isset($user-&gt;$key) )&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          $val = 'user_url' == $key ? get_user_link( $user-&gt;ID ) : $user-&gt;$key;&nbsp;</div></li><li><div>          if (&nbsp;</div></li><li><div>              ( 'user_email' != $key || ( 'user_email' == $key && bb_current_user_can( 'edit_users' ) ) )&nbsp;</div></li><li><div>              && $val&nbsp;</div></li><li><div>              && 'http:<span class="comment">//' != $val</span>&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>              echo &quot;\t&lt;dt&gt;{$label[1]}&lt;/dt&gt;\n&quot;;&nbsp;</div></li><li><div>              $val = make_clickable( $val );&nbsp;</div></li><li><div>              $attributes = array();&nbsp;</div></li><li><div>              if (isset($label[2]) && !empty($label[2]))&nbsp;</div></li><li><div>                  if (preg_match(&quot;#^&lt;a#i&quot;, $val))&nbsp;</div></li><li><div>                      $val = preg_replace(&quot;#^&lt;a#i&quot;, '&lt;a class=&quot;' . esc_attr($label[2]) . '&quot;', $val);&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                      $val = '&lt;span class=&quot;' . esc_attr($label[2]) . '&quot;&gt;' . $val . '&lt;/span&gt;';&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>              echo &quot;\t&lt;dd&gt;&quot; . $val . &quot;&lt;/dd&gt;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo &quot;&lt;/dl&gt;\n&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_profile_base_content() {&nbsp;</div></li><li><div>  global $self;&nbsp;</div></li><li><div>  if ( !is_callable( $self ) )&nbsp;</div></li><li><div>      return; <span class="comment">// should never happen</span>&nbsp;</div></li><li><div>  call_user_func( $self );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_profile_data_form( $id = 0 ) {&nbsp;</div></li><li><div>  global $errors;&nbsp;</div></li><li><div>  if ( !$user = bb_get_user( bb_get_user_id( $id ) ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'edit_user', $user-&gt;ID ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $error_codes = $errors-&gt;get_error_codes();&nbsp;</div></li><li><div>  $profile_info_keys = bb_get_profile_info_keys();&nbsp;</div></li><li><div>  $required = false;&nbsp;</div></li><li><div>  if ( in_array( 'delete', $error_codes ) )&nbsp;</div></li><li><div>      echo '&lt;div class=&quot;form-invalid error&quot;&gt;' . $errors-&gt;get_error_message( 'delete' ) . '&lt;/div&gt;';&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;table id=&quot;userinfo&quot;&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  if ( is_array($profile_info_keys) ) :&nbsp;</div></li><li><div>      $bb_current_id = bb_get_current_user_info( 'id' );&nbsp;</div></li><li><div>      foreach ( $profile_info_keys as $key =&gt; $label ) :&nbsp;</div></li><li><div>          if ( $label[0] ) {&nbsp;</div></li><li><div>              $class = 'form-field form-required required';&nbsp;</div></li><li><div>              $required = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $class = 'form-field';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $title = esc_attr( $label[1] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $name = esc_attr( $key );&nbsp;</div></li><li><div>          $type = isset($label[2]) ? esc_attr( $label[2] ) : 'text';&nbsp;</div></li><li><div>          if ( !in_array( $type, array( 'checkbox', 'file', 'hidden', 'image', 'password', 'radio', 'text' ) ) ) {&nbsp;</div></li><li><div>              $type = 'text';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $checked = false;&nbsp;</div></li><li><div>          if ( in_array( $key, $error_codes ) ) {&nbsp;</div></li><li><div>              $class .= ' form-invalid error';&nbsp;</div></li><li><div>              $data = $errors-&gt;get_error_data( $key );&nbsp;</div></li><li><div>              if ( 'checkbox' == $type ) {&nbsp;</div></li><li><div>                  if ( isset($data['data']) )&nbsp;</div></li><li><div>                      $checked = $data['data'];&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                      $checked = $_POST[$key];&nbsp;</div></li><li><div>                  $value = $label[3];&nbsp;</div></li><li><div>                  $checked = $checked == $value;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ( isset($data['data']) )&nbsp;</div></li><li><div>                      $value = $data['data'];&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                      $value = $_POST[$key];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $message = esc_html( $errors-&gt;get_error_message( $key ) );&nbsp;</div></li><li><div>              $message = &quot;&lt;em&gt;$message&lt;/em&gt;&quot;;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( 'checkbox' == $type ) {&nbsp;</div></li><li><div>                  $checked = $user-&gt;$key == $label[3] || $label[4] == $label[3];&nbsp;</div></li><li><div>                  $value = $label[3];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $value = isset($user-&gt;$key) ? $user-&gt;$key : '';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $message = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $checked = $checked ? ' checked=&quot;checked&quot;' : '';&nbsp;</div></li><li><div>          $value = esc_attr( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;tr class=&quot;&lt;?php echo $class; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>      &lt;label for=&quot;&lt;?php echo $name; ?&gt;&quot;&gt;&lt;?php echo $title; ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;?php echo $message; ?&gt;&nbsp;</div></li><li><div>  &lt;/th&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>          if ($key == 'display_name') {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;select name=&quot;display_name&quot; id=&quot;display_name&quot;&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>              $public_display = array();&nbsp;</div></li><li><div>              $public_display['display_displayname'] = $user-&gt;display_name;&nbsp;</div></li><li><div>              <span class="comment">//$public_display['display_nickname'] = $user-&gt;nickname;</span>&nbsp;</div></li><li><div>              $public_display['display_username'] = $user-&gt;user_login;&nbsp;</div></li><li><div>              if ( isset($user-&gt;first_name) ) {&nbsp;</div></li><li><div>                  $public_display['display_firstname'] = $user-&gt;first_name;&nbsp;</div></li><li><div>                  if ( isset($user-&gt;last_name) ) {&nbsp;</div></li><li><div>                      $public_display['display_firstlast'] = $user-&gt;first_name.' '.$user-&gt;last_name;&nbsp;</div></li><li><div>                      $public_display['display_lastfirst'] = $user-&gt;last_name.' '.$user-&gt;first_name;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( isset($user-&gt;last_name) )&nbsp;</div></li><li><div>                  $public_display['display_lastname'] = $user-&gt;last_name;&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>              $public_display = array_unique(array_filter(array_map('trim', $public_display)));&nbsp;</div></li><li><div>              &nbsp;</div></li><li><div>              foreach($public_display as $id =&gt; $item) {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>          &lt;option id=&quot;&lt;?php echo esc_attr( $id ); ?&gt;&quot; value=&quot;&lt;?php echo esc_attr( $item ); ?&gt;&quot;&gt;&lt;?php echo esc_html( $item ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;/select&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;?php if ( 'checkbox' == $type && isset($label[5]) ) echo '&lt;label for=&quot;' . $name . '&quot;&gt;'; ?&gt;&nbsp;</div></li><li><div>      &lt;input name=&quot;&lt;?php echo $name; ?&gt;&quot; id=&quot;&lt;?php echo $name; ?&gt;&quot; type=&quot;&lt;?php echo $type; ?&gt;&quot;&lt;?php echo $checked; ?&gt; value=&quot;&lt;?php echo $value; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;?php if ( 'checkbox' == $type && isset($label[5]) ) echo esc_html( $label[5] ) . '&lt;/label&gt;'; ?&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php endforeach; endif; <span class="comment">// $profile_info_keys; $profile_info_keys ?&gt;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php bb_nonce_field( 'edit-profile_' . $user-&gt;ID ); if ( $required ) : ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;p class=&quot;required-message&quot;&gt;&lt;?php _e('These items are &lt;span class=&quot;required&quot;&gt;required&lt;/span&gt;.') ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  endif;&nbsp;</div></li><li><div>  do_action( 'extra_profile_info', $user-&gt;ID );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_profile_admin_form( $id = 0 ) {&nbsp;</div></li><li><div>  global $wp_roles, $errors;&nbsp;</div></li><li><div>  if ( !$user = bb_get_user( bb_get_user_id( $id ) ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'edit_user', $user-&gt;ID ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $error_codes = $errors-&gt;get_error_codes();&nbsp;</div></li><li><div>  $bb_current_id = bb_get_current_user_info( 'id' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $profile_admin_keys = bb_get_profile_admin_keys();&nbsp;</div></li><li><div>  $assignable_caps = bb_get_assignable_caps();&nbsp;</div></li><li><div>  $required = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $roles = $wp_roles-&gt;role_names;&nbsp;</div></li><li><div>  $can_keep_gate = bb_current_user_can( 'keep_gate' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Keymasters can't demote themselves</span>&nbsp;</div></li><li><div>  if ( ( $bb_current_id == $user-&gt;ID && $can_keep_gate ) || ( isset( $user-&gt;capabilities ) && is_array( $user-&gt;capabilities ) && array_key_exists( 'keymaster', $user-&gt;capabilities ) && !$can_keep_gate ) ) {&nbsp;</div></li><li><div>      $roles = array( 'keymaster' =&gt; $roles['keymaster'] );&nbsp;</div></li><li><div>  } elseif ( !$can_keep_gate ) { <span class="comment">// only keymasters can promote others to keymaster status</span>&nbsp;</div></li><li><div>      unset($roles['keymaster']);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $selected = array( 'inactive' =&gt; ' selected=&quot;selected&quot;' );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;table id=&quot;admininfo&quot;&gt;&nbsp;</div></li><li><div>&lt;tr class='form-field&lt;?php if ( in_array( 'role', $error_codes ) ) echo ' form-invalid error'; ?&gt;'&gt;&nbsp;</div></li><li><div>  &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>      &lt;label for=&quot;admininfo_role&quot;&gt;&lt;?php _e('User Type'); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;?php if ( in_array( 'role', $error_codes ) ) echo '&lt;em&gt;' . $errors-&gt;get_error_message( 'role' ) . '&lt;/em&gt;'; ?&gt;&nbsp;</div></li><li><div>  &lt;/th&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;select id=&quot;admininfo_role&quot; name=&quot;role&quot;&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  foreach( $roles as $r =&gt; $n ) {&nbsp;</div></li><li><div>      if ( isset( $user-&gt;capabilities ) && is_array( $user-&gt;capabilities ) && array_key_exists( $r, $user-&gt;capabilities ) ) {&nbsp;</div></li><li><div>          $selected['inactive'] = '';&nbsp;</div></li><li><div>          $selected[$r] = ' selected=&quot;selected&quot;';&nbsp;</div></li><li><div>      } elseif ( $r !== 'inactive' ) {&nbsp;</div></li><li><div>          $selected[$r] = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>          &lt;option value=&quot;&lt;?php echo $r; ?&gt;&quot;&lt;?php echo $selected[$r]; ?&gt;&gt;&lt;?php echo $n; ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>      &lt;/select&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  if (count($assignable_caps)) :&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&lt;tr class=&quot;extra-caps-row&quot;&gt;&nbsp;</div></li><li><div>  &lt;th scope=&quot;row&quot;&gt;&lt;?php _e('Allow this user to'); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  foreach( $assignable_caps as $cap =&gt; $label ) :&nbsp;</div></li><li><div>      $name = esc_attr( $cap );&nbsp;</div></li><li><div>      $checked = '';&nbsp;</div></li><li><div>      if ( isset( $user-&gt;capabilities ) && is_array( $user-&gt;capabilities ) && array_key_exists( $cap, $user-&gt;capabilities ) ) {&nbsp;</div></li><li><div>          $checked = ' checked=&quot;checked&quot;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $label = esc_html( $label );&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;label&gt;&lt;input name=&quot;&lt;?php echo $name; ?&gt;&quot; value=&quot;1&quot; type=&quot;checkbox&quot;&lt;?php echo $checked; ?&gt; /&gt; &lt;?php echo $label; ?&gt;&lt;/label&gt;&lt;br /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>  endif;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ( is_array($profile_admin_keys) ) :&nbsp;</div></li><li><div>      foreach ( $profile_admin_keys as $key =&gt; $label ) :&nbsp;</div></li><li><div>          if ( $label[0] ) {&nbsp;</div></li><li><div>              $class = 'form-field form-required required';&nbsp;</div></li><li><div>              $required = true;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $class = 'form-field';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $title = esc_attr( $label[1] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $name = esc_attr( $key );&nbsp;</div></li><li><div>          $type = isset($label[2]) ? esc_attr( $label[2] ) : 'text';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $checked = false;&nbsp;</div></li><li><div>          if ( in_array( $key, $error_codes ) ) {&nbsp;</div></li><li><div>              $class .= ' form-invalid error';&nbsp;</div></li><li><div>              $data = $errors-&gt;get_error_data( $key );&nbsp;</div></li><li><div>              if ( 'checkbox' == $type ) {&nbsp;</div></li><li><div>                  if ( isset($data['data']) )&nbsp;</div></li><li><div>                      $checked = $data['data'];&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                      $checked = $_POST[$key];&nbsp;</div></li><li><div>                  $value = $label[3];&nbsp;</div></li><li><div>                  $checked = $checked == $value;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ( isset($data['data']) )&nbsp;</div></li><li><div>                      $value = $data['data'];&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                      $value = $_POST[$key];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $message = esc_html( $errors-&gt;get_error_message( $key ) );&nbsp;</div></li><li><div>              $message = &quot;&lt;em&gt;$message&lt;/em&gt;&quot;;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( 'checkbox' == $type ) {&nbsp;</div></li><li><div>                  $checked = $user-&gt;$key == $label[3] || $label[4] == $label[3];&nbsp;</div></li><li><div>                  $value = $label[3];&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $value = isset($user-&gt;$key) ? $user-&gt;$key : '';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $message = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $checked = $checked ? ' checked=&quot;checked&quot;' : '';&nbsp;</div></li><li><div>          $value = esc_attr( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;tr class=&quot;&lt;?php echo $class; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;th scope=&quot;row&quot;&gt;&nbsp;</div></li><li><div>      &lt;label for=&quot;&lt;?php echo $name; ?&gt;&quot;&gt;&lt;?php echo $title ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;?php echo $message; ?&gt;&nbsp;</div></li><li><div>  &lt;/th&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;?php if ( 'checkbox' == $type && isset($label[5]) ) echo &quot;&lt;label for='$name'&gt;&quot;; ?&gt;&nbsp;</div></li><li><div>      &lt;input name=&quot;&lt;?php echo $name; ?&gt;&quot; id=&quot;&lt;?php echo $name; ?&gt;&quot; type=&quot;&lt;?php echo $type; ?&gt;&quot;&lt;?php echo $checked; ?&gt; value=&quot;&lt;?php echo $value; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;?php if ( 'checkbox' == $type && isset($label[5]) ) echo esc_html( $label[5] ) . &quot;&lt;/label&gt;&quot;; ?&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php endforeach; endif; <span class="comment">// $profile_admin_keys; $profile_admin_keys ?&gt;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php if ( $required ) : ?&gt;&nbsp;</div></li><li><div>&lt;p class=&quot;required-message&quot;&gt;&lt;?php _e('These items are &lt;span class=&quot;required&quot;&gt;required&lt;/span&gt;.') ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&lt;p&gt;&lt;?php _e('Inactive users can login and look around but not do anything. Blocked users just see a simple error message when they visit the site.'); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&lt;p&gt;&lt;?php _e('&lt;strong&gt;Note&lt;/strong&gt;: Blocking a user does &lt;em&gt;not&lt;/em&gt; block any IP addresses.'); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_profile_password_form( $id = 0 ) {&nbsp;</div></li><li><div>  global $errors;&nbsp;</div></li><li><div>  if ( !$user = bb_get_user( bb_get_user_id( $id ) ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'change_user_password', $user-&gt;ID ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $class = 'form-field';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $message = $errors-&gt;get_error_message( 'pass' ) ) {&nbsp;</div></li><li><div>      $class .= ' form-invalid error';&nbsp;</div></li><li><div>      $message = '&lt;em&gt;' . esc_html( $message ) . '&lt;/em&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;table&gt;&nbsp;</div></li><li><div>&lt;tr class=&quot;&lt;?php echo $class; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;th scope=&quot;row&quot; rowspan=&quot;2&quot;&gt;&nbsp;</div></li><li><div>      &lt;label for=&quot;pass1&quot;&gt;&lt;?php _e('New password'); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>      &lt;?php echo $message; ?&gt;&nbsp;</div></li><li><div>  &lt;/th&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;input name=&quot;pass1&quot; type=&quot;password&quot; id=&quot;pass1&quot; autocomplete=&quot;off&quot; /&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&lt;tr class=&quot;&lt;?php echo $class; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;input name=&quot;pass2&quot; type=&quot;password&quot; id=&quot;pass2&quot; autocomplete=&quot;off&quot; /&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&lt;tr class=&quot;pass-strength&quot;&gt;&nbsp;</div></li><li><div>  &lt;th scope=&quot;row&quot;&gt;&lt;?php _e('Password Strength'); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>  &lt;td&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;user_login&quot; id=&quot;user_login&quot; value=&quot;&lt;?php echo $user-&gt;user_login; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;noscript&gt;&nbsp;</div></li><li><div>          &lt;?php _e('Disabled (requires JavaScript)'); ?&gt;&nbsp;</div></li><li><div>      &lt;/noscript&gt;&nbsp;</div></li><li><div>      &lt;script type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&nbsp;</div></li><li><div>          if (typeof jQuery != 'undefined') {&nbsp;</div></li><li><div>              document.writeln('&lt;div id=&quot;pass-strength-result&quot;&gt;' + pwsL10n.short + '&lt;/div&gt;');&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              document.writeln('&lt;?php echo str_replace(&quot;'&quot;, &quot;\'&quot;, __('Disabled.')); ?&gt;')&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;/td&gt;&nbsp;</div></li><li><div>&lt;/tr&gt;&nbsp;</div></li><li><div>&lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;p&gt;&lt;?php _e('Hint: Use upper and lower case characters, numbers and symbols like !&quot;?$%^&amp;( in your password.'); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_logout_link( $args = '' ) {&nbsp;</div></li><li><div>  echo apply_filters( 'bb_logout_link', bb_get_logout_link( $args ), $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_logout_link( $args = '' ) {&nbsp;</div></li><li><div>  if ( $args && is_string($args) && false === strpos($args, '=') )&nbsp;</div></li><li><div>      $args = array( 'text' =&gt; $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array('text' =&gt; __('Log Out'), 'before' =&gt; '', 'after' =&gt; '', 'redirect' =&gt; '');&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract($args, EXTR_SKIP);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $query = array( 'action' =&gt; 'logout' );&nbsp;</div></li><li><div>  if ( $redirect ) {&nbsp;</div></li><li><div>      $query['redirect_to'] = $redirect;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri = esc_attr( bb_get_uri('bb-login.php', $query, BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_USER_FORMS) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_logout_link', $before . '&lt;a href=&quot;' . $uri . '&quot;&gt;' . $text . '&lt;/a&gt;' . $after, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_admin_link( $args = '' ) {&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'moderate' ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  echo apply_filters( 'bb_admin_link', bb_get_admin_link( $args ), $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_admin_link( $args = '' ) {&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'moderate' ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  if ( $args && is_string($args) && false === strpos($args, '=') )&nbsp;</div></li><li><div>      $args = array( 'text' =&gt; $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array('text' =&gt; __('Admin'), 'before' =&gt; '', 'after' =&gt; '');&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract($args, EXTR_SKIP);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri = esc_attr( bb_get_uri('bb-admin/', null, BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_ADMIN) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_admin_link', $before . '&lt;a href=&quot;' . $uri . '&quot;&gt;' . $text . '&lt;/a&gt;' . $after, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_user_admin_link( $user_id = null ) { &nbsp;</div></li><li><div>  if( !$user_id || !bb_current_user_can( 'edit_user', $user_id ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if( !bb_get_user_id( $user_id ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $uri = bb_get_uri( 'bb-admin/users.php', array( 'action' =&gt; 'edit', 'user_id' =&gt; $user_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_user_admin_link', $uri, $user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_profile_link( $args = '' ) {&nbsp;</div></li><li><div>  echo apply_filters( 'bb_profile_link', bb_get_profile_link( $args ), $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_profile_link( $args = '' ) {&nbsp;</div></li><li><div>  if ( $args && is_string($args) && false === strpos($args, '=') )&nbsp;</div></li><li><div>      $args = array( 'text' =&gt; $args );&nbsp;</div></li><li><div>  elseif ( is_numeric($args) )&nbsp;</div></li><li><div>      $args = array( 'id' =&gt; $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array( 'text' =&gt; __('View your profile'), 'before' =&gt; '', 'after' =&gt; '', 'id' =&gt; false );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract($args, EXTR_SKIP);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $id = (int) $id;&nbsp;</div></li><li><div>  if ( !$id )&nbsp;</div></li><li><div>      $id = bb_get_current_user_info( 'id' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_profile_link', &quot;$before&lt;a href='&quot; . esc_attr( get_user_profile_link( $id ) ) . &quot;'&gt;$text&lt;/a&gt;$after&quot;, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_current_user_info( $key = '' ) {&nbsp;</div></li><li><div>  if ( !$key )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  echo apply_filters( 'bb_current_user_info', bb_get_current_user_info( $key ), $key );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_current_user_info( $key = '' ) {&nbsp;</div></li><li><div>  if ( !is_string($key) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  if ( !$user = bb_get_current_user() ) <span class="comment">// Not globalized</span>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $key ) :&nbsp;</div></li><li><div>  case '' :&nbsp;</div></li><li><div>      return $user;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'id' :&nbsp;</div></li><li><div>  case 'ID' :&nbsp;</div></li><li><div>      return (int) $user-&gt;ID;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'name' :&nbsp;</div></li><li><div>      return get_user_display_name( $user-&gt;ID );&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'login' :&nbsp;</div></li><li><div>  case 'user_login' :&nbsp;</div></li><li><div>      return get_user_name( $user-&gt;ID );&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'email' :&nbsp;</div></li><li><div>  case 'user_email' :&nbsp;</div></li><li><div>      return bb_get_user_email( $user-&gt;ID );&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'url' :&nbsp;</div></li><li><div>  case 'uri' :&nbsp;</div></li><li><div>  case 'user_url' :&nbsp;</div></li><li><div>      return get_user_link( $user-&gt;ID );&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  endswitch;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_user_email( $id ) {&nbsp;</div></li><li><div>  if ( !$user = bb_get_user( bb_get_user_id( $id ) ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_user_email', $user-&gt;user_email, $id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//TAGS</span>&nbsp;</div></li><li><div>function topic_tags()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $tags, $tag, $topic_tag_cache, $user_tags, $other_tags, $topic;&nbsp;</div></li><li><div>  if ( is_array( $tags ) || bb_current_user_can( 'edit_tag_by_on', bb_get_current_user_info( 'id' ), $topic-&gt;topic_id ) ) {&nbsp;</div></li><li><div>      bb_load_template( 'topic-tags.php', array('user_tags', 'other_tags', 'public_tags') );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_tag_page_link()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo bb_get_tag_page_link();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_tag_page_link( $context = BB_URI_CONTEXT_A_HREF )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( bb_get_option( 'mod_rewrite' ) ) {&nbsp;</div></li><li><div>      $r = bb_get_uri( 'tags/', null, $context );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $r = bb_get_uri( 'tags.php', null, $context );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_tag_page_link', $r, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_tag_link( $tag_id = 0, $page = 1, $context = BB_URI_CONTEXT_A_HREF )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo apply_filters( 'bb_tag_link', bb_get_tag_link( $tag_id, $page, $context ), $tag_id, $page, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_tag_link( $tag_id = 0, $page = 1, $context = BB_URI_CONTEXT_A_HREF )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $tag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $tag_id ) {&nbsp;</div></li><li><div>      if ( is_object( $tag_id ) ) {&nbsp;</div></li><li><div>          $_tag = $tag_id;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $_tag = bb_get_tag( $tag_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $_tag =& $tag;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !is_object( $_tag ) ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$context || !is_integer( $context ) ) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bb_get_option( 'mod_rewrite' ) ) {&nbsp;</div></li><li><div>      $page = (1 &lt; $page) ? '/page/' . $page : '';&nbsp;</div></li><li><div>      $r = bb_get_uri( 'tags/' . $_tag-&gt;tag . $page, null, $context );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $query = array(&nbsp;</div></li><li><div>          'tag' =&gt; $_tag-&gt;tag, &nbsp;</div></li><li><div>          'page' =&gt; ( 1 &lt; $page ) ? $page : false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $r = bb_get_uri( 'tags.php', $query, $context );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_tag_link', $r, $_tag-&gt;tag, $page, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_tag_link_base()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo bb_get_tag_link_base();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_tag_link_base()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_get_tag_page_link() . ( bb_get_option( 'mod_rewrite' ) ? '' : '?tag=' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_tag_name( $tag_id = 0 )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo esc_html( bb_get_tag_name( $tag_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_tag_name( $tag_id = 0 ) {&nbsp;</div></li><li><div>  global $tag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $tag_id ) {&nbsp;</div></li><li><div>      if ( is_object( $tag_id ) ) {&nbsp;</div></li><li><div>          $_tag = $tag_id;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $_tag = bb_get_tag( $tag_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $_tag =& $tag;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !is_object( $_tag ) ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $_tag-&gt;raw_tag;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_tag_posts_rss_link( $tag_id = 0, $context = 0 )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !$context || !is_integer( $context ) ) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo apply_filters( 'tag_posts_rss_link', bb_get_tag_posts_rss_link( $tagid, $context ), $tag_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_tag_posts_rss_link( $tag_id = 0, $context = 0 )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $tag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $tag_id ) {&nbsp;</div></li><li><div>      if ( is_object( $tag_id ) ) {&nbsp;</div></li><li><div>          $_tag = $tag_id;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $_tag = bb_get_tag( $tag_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $_tag =& $tag;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !is_object( $_tag ) ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$context || !is_integer( $context ) ) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bb_get_option( 'mod_rewrite' ) ) {&nbsp;</div></li><li><div>      $link = bb_get_uri( 'rss/tags/' . $_tag-&gt;tag, null, $context );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $link = bb_get_uri( 'rss.php', array( 'tag' =&gt; $_tag-&gt;tag ), $context );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'get_tag_posts_rss_link', $link, $tag_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_tag_topics_rss_link( $tag_id = 0, $context = 0 )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !$context || !is_integer( $context ) ) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo apply_filters( 'tag_topics_rss_link', bb_get_tag_topics_rss_link( $tag_id, $context ), $tag_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_tag_topics_rss_link( $tag_id = 0, $context = 0 )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $tag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $tag_id ) {&nbsp;</div></li><li><div>      if ( is_object( $tag_id ) ) {&nbsp;</div></li><li><div>          $_tag = $tag_id;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $_tag = bb_get_tag( $tag_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $_tag =& $tag;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !is_object( $_tag ) ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$context || !is_integer( $context ) ) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bb_get_option( 'mod_rewrite' ) ) {&nbsp;</div></li><li><div>      $link = bb_get_uri( 'rss/tags/' . $_tag-&gt;tag . '/topics', null, $context );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $link = bb_get_uri( 'rss.php', array('tag' =&gt; $_tag-&gt;tag, 'topics' =&gt; 1 ), $context );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'get_tag_topics_rss_link', $link, $tag_id, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_list_tags( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'tags' =&gt; false, &nbsp;</div></li><li><div>      'format' =&gt; 'list', &nbsp;</div></li><li><div>      'topic' =&gt; 0, &nbsp;</div></li><li><div>      'list_id' =&gt; 'tags-list'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$topic = get_topic( get_topic_id( $topic ) ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !is_array( $tags ) ) {&nbsp;</div></li><li><div>      $tags = bb_get_topic_tags( $topic-&gt;topic_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$tags ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $list_id = esc_attr( $list_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = '';&nbsp;</div></li><li><div>  switch ( strtolower( $format ) ) {&nbsp;</div></li><li><div>      case 'table' :&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'list' :&nbsp;</div></li><li><div>      default :&nbsp;</div></li><li><div>          $args['format'] = 'list';&nbsp;</div></li><li><div>          $r .= '&lt;ul id=&quot;' . $list_id . '&quot; class=&quot;tags-list list:tag&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>          foreach ( $tags as $tag ) {&nbsp;</div></li><li><div>              $r .= _bb_list_tag_item( $tag, $args );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $r .= '&lt;/ul&gt;';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _bb_list_tag_item( $tag, $args )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $url = esc_url( bb_get_tag_link( $tag ) );&nbsp;</div></li><li><div>  $name = esc_html( bb_get_tag_name( $tag ) );&nbsp;</div></li><li><div>  if ( 'list' == $args['format'] ) {&nbsp;</div></li><li><div>      $id = 'tag-' . $tag-&gt;tag_id . '_' . $tag-&gt;user_id;&nbsp;</div></li><li><div>      return &quot;\t&quot; . '&lt;li id=&quot;' . $id . '&quot;' . get_alt_class( 'topic-tags' ) . '&gt;&lt;a href=&quot;' . $url . '&quot; rel=&quot;tag&quot;&gt;' . $name . '&lt;/a&gt; ' . bb_get_tag_remove_link( array( 'tag' =&gt; $tag, 'list_id' =&gt; $args['list_id'] ) ) . '&lt;/li&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>function tag_form( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array( 'topic' =&gt; 0, 'submit' =&gt; __('Add &raquo;'), 'list_id' =&gt; 'tags-list' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$topic = get_topic( get_topic_id( $topic ) ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'edit_tag_by_on', bb_get_current_user_info( 'id' ), $topic-&gt;topic_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $page;&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;form id=&quot;tag-form&quot; method=&quot;post&quot; action=&quot;&lt;?php bb_uri('tag-add.php', null, BB_URI_CONTEXT_FORM_ACTION + BB_URI_CONTEXT_BB_ADMIN); ?&gt;&quot; class=&quot;add:&lt;?php echo esc_attr( $list_id ); ?&gt;:&quot;&gt;&nbsp;</div></li><li><div>  &lt;p&gt;&nbsp;</div></li><li><div>      &lt;input name=&quot;tag&quot; type=&quot;text&quot; id=&quot;tag&quot; /&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;&lt;?php echo $topic-&gt;topic_id; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;hidden&quot; name=&quot;page&quot; value=&quot;&lt;?php echo $page; ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>      &lt;?php bb_nonce_field( 'add-tag_' . $topic-&gt;topic_id ); ?&gt;&nbsp;</div></li><li><div>      &lt;input type=&quot;submit&quot; name=&quot;submit&quot; id=&quot;tagformsub&quot; value=&quot;&lt;?php echo esc_attr( $submit ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>  &lt;/p&gt;&nbsp;</div></li><li><div>&lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function manage_tags_forms()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $tag;&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'manage_tags' ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $form = '&lt;ul id=&quot;manage-tags&quot;&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  $form .= '&lt;li id=&quot;tag-rename&quot;&gt;' . __('Rename tag:') . &quot;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= '&lt;form method=&quot;post&quot; action=&quot;' . bb_get_uri( 'bb-admin/tag-rename.php', null, BB_URI_CONTEXT_FORM_ACTION + BB_URI_CONTEXT_BB_ADMIN ) . '&quot;&gt;&lt;div&gt;' . &quot;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= '&lt;input type=&quot;text&quot; name=&quot;tag&quot; size=&quot;10&quot; maxlength=&quot;30&quot; /&gt;' . &quot;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= '&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;' . $tag-&gt;tag_id . '&quot; /&gt;' . &quot;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= &quot;&lt;input type='submit' name='Submit' value='&quot; . __('Rename') . &quot;' /&gt;\n\t&quot;;&nbsp;</div></li><li><div>  echo $form;&nbsp;</div></li><li><div>  bb_nonce_field( 'rename-tag_' . $tag-&gt;tag_id );&nbsp;</div></li><li><div>  echo &quot;\n\t&lt;/div&gt;&lt;/form&gt;\n  &lt;/li&gt;\n &quot;;&nbsp;</div></li><li><div>  $form = &quot;&lt;li id='tag-merge'&gt;&quot; . __('Merge this tag into:') . &quot;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= &quot;&lt;form method='post' action='&quot; . bb_get_uri('bb-admin/tag-merge.php', null, BB_URI_CONTEXT_FORM_ACTION + BB_URI_CONTEXT_BB_ADMIN) . &quot;'&gt;&lt;div&gt;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= &quot;&lt;input type='text' name='tag' size='10' maxlength='30' /&gt;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= &quot;&lt;input type='hidden' name='id' value='$tag-&gt;tag_id' /&gt;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= &quot;&lt;input type='submit' name='Submit' value='&quot; . __('Merge') . &quot;' &quot;;&nbsp;</div></li><li><div>  $form .= 'onclick=&quot;return confirm(\'' . esc_js( sprintf(__('Are you sure you want to merge the &quot;%s&quot; tag into the tag you specified? This is permanent and cannot be undone.'), $tag-&gt;raw_tag) ) . &quot;');\&quot; /&gt;\n\t&quot;;&nbsp;</div></li><li><div>  echo $form;&nbsp;</div></li><li><div>  bb_nonce_field( 'merge-tag_' . $tag-&gt;tag_id );&nbsp;</div></li><li><div>  echo &quot;\n\t&lt;/div&gt;&lt;/form&gt;\n  &lt;/li&gt;\n &quot;;&nbsp;</div></li><li><div>  $form = &quot;&lt;li id='tag-destroy'&gt;&quot; . __('Destroy tag:') . &quot;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= &quot;&lt;form method='post' action='&quot; . bb_get_uri('bb-admin/tag-destroy.php', null, BB_URI_CONTEXT_FORM_ACTION + BB_URI_CONTEXT_BB_ADMIN) . &quot;'&gt;&lt;div&gt;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= &quot;&lt;input type='hidden' name='id' value='$tag-&gt;tag_id' /&gt;\n\t&quot;;&nbsp;</div></li><li><div>  $form .= &quot;&lt;input type='submit' name='Submit' value='&quot; . __('Destroy') . &quot;' &quot;;&nbsp;</div></li><li><div>  $form .= 'onclick=&quot;return confirm(\'' . esc_js( sprintf(__('Are you sure you want to destroy the &quot;%s&quot; tag? This is permanent and cannot be undone.'), $tag-&gt;raw_tag) ) . &quot;');\&quot; /&gt;\n\t&quot;;&nbsp;</div></li><li><div>  echo $form;&nbsp;</div></li><li><div>  bb_nonce_field( 'destroy-tag_' . $tag-&gt;tag_id );&nbsp;</div></li><li><div>  echo &quot;\n\t&lt;/div&gt;&lt;/form&gt;\n  &lt;/li&gt;\n&lt;/ul&gt;&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_tag_remove_link( $args = null ) {&nbsp;</div></li><li><div>  echo bb_get_tag_remove_link( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_tag_remove_link( $args = null ) {&nbsp;</div></li><li><div>  if ( is_scalar($args) || is_object( $args ) )&nbsp;</div></li><li><div>      $args = array( 'tag' =&gt; $args );&nbsp;</div></li><li><div>  $defaults = array( 'tag' =&gt; 0, 'topic' =&gt; 0, 'list_id' =&gt; 'tags-list' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_object( $tag ) && isset( $tag-&gt;tag_id ) ); <span class="comment"><span class="comment">// [sic]</span></span>&nbsp;</div></li><li><div>  elseif ( !$tag = bb_get_tag( bb_get_tag_id( $tag ) ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  if ( !$topic = get_topic( get_topic_id( $topic ) ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  if ( !bb_current_user_can( 'edit_tag_by_on', $tag-&gt;user_id, $topic-&gt;topic_id ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  $url = bb_get_uri('tag-remove.php', array('tag' =&gt; $tag-&gt;tag_id, 'user' =&gt; $tag-&gt;user_id, 'topic' =&gt; $topic-&gt;topic_id) );&nbsp;</div></li><li><div>  $url = esc_url( bb_nonce_url( $url, 'remove-tag_' . $tag-&gt;tag_id . '|' . $topic-&gt;topic_id) );&nbsp;</div></li><li><div>  $title = esc_attr__( 'Remove this tag' );&nbsp;</div></li><li><div>  $list_id = esc_attr( $list_id );&nbsp;</div></li><li><div>  return &quot;[&lt;a href='$url' class='delete:$list_id:tag-{$tag-&gt;tag_id}_{$tag-&gt;user_id}' title='$title'&gt;&times;&lt;/a&gt;]&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_tag_heat_map( $args = '' ) {&nbsp;</div></li><li><div>  $_args = func_get_args();&nbsp;</div></li><li><div>  $defaults = array( 'smallest' =&gt; 8, 'largest' =&gt; 22, 'unit' =&gt; 'pt', 'limit' =&gt; 40, 'format' =&gt; 'flat' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 1 &lt; $fn = func_num_args() ) : <span class="comment">// For back compat</span>&nbsp;</div></li><li><div>      $args['smallest'] = $_args[0];&nbsp;</div></li><li><div>      $args['largest'] = $_args[1];&nbsp;</div></li><li><div>      $args['unit'] = 2 &lt; $fn ? $_args[2] : $unit;&nbsp;</div></li><li><div>      $args['limit'] = 3 &lt; $fn ? $_args[3] : $limit;&nbsp;</div></li><li><div>  endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  extract($args, EXTR_SKIP);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tags = bb_get_top_tags( array( 'number' =&gt; $limit ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty($tags) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = bb_get_tag_heat_map( $tags, $args );&nbsp;</div></li><li><div>  echo apply_filters( 'tag_heat_map', $r, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_tag_heat_map( $tags, $args = '' ) {&nbsp;</div></li><li><div>  $defaults = array( 'smallest' =&gt; 8, 'largest' =&gt; 22, 'unit' =&gt; 'pt', 'limit' =&gt; 45, 'format' =&gt; 'flat' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract($args, EXTR_SKIP);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$tags )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( (array) $tags as $tag ) {&nbsp;</div></li><li><div>      $counts{$tag-&gt;raw_tag} = $tag-&gt;tag_count;&nbsp;</div></li><li><div>      $taglinks{$tag-&gt;raw_tag} = bb_get_tag_link( $tag );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $min_count = min($counts);&nbsp;</div></li><li><div>  $spread = max($counts) - $min_count;&nbsp;</div></li><li><div>  if ( $spread &lt;= 0 )&nbsp;</div></li><li><div>      $spread = 1;&nbsp;</div></li><li><div>  $fontspread = $largest - $smallest;&nbsp;</div></li><li><div>  if ( $fontspread &lt;= 0 )&nbsp;</div></li><li><div>      $fontspread = 1;&nbsp;</div></li><li><div>  $fontstep = $fontspread / $spread;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action_ref_array( 'sort_tag_heat_map', array(&$counts) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $a = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $counts as $tag =&gt; $count ) {&nbsp;</div></li><li><div>      $taglink = esc_attr($taglinks{$tag});&nbsp;</div></li><li><div>      $tag = str_replace(' ', '&nbsp;', esc_html( $tag ));&nbsp;</div></li><li><div>      $fontsize = round( $smallest + ( ( $count - $min_count ) * $fontstep ), 1 );&nbsp;</div></li><li><div>      $a[] = &quot;&lt;a href='$taglink' title='&quot; . esc_attr( sprintf( __('%d topics'), $count ) ) . &quot;' rel='tag' style='font-size:$fontsize$unit;'&gt;$tag&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $format ) :&nbsp;</div></li><li><div>  case 'array' :&nbsp;</div></li><li><div>      $r =& $a;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'list' :&nbsp;</div></li><li><div>      $r = &quot;&lt;ul class='bb-tag-heat-map'&gt;\n\t&lt;li&gt;&quot;;&nbsp;</div></li><li><div>      $r .= join(&quot;&lt;/li&gt;\n\t&lt;li&gt;&quot;, $a);&nbsp;</div></li><li><div>      $r .= &quot;&lt;/li&gt;\n&lt;/ul&gt;\n&quot;;&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  default :&nbsp;</div></li><li><div>      $r = join(&quot;\n&quot;, $a);&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  endswitch;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_tag_heat_map', $r, $tags, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_sort_tag_heat_map( &$tag_counts ) {&nbsp;</div></li><li><div>  uksort($tag_counts, 'strnatcasecmp');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function tag_pages( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array( 'before' =&gt; '', 'after' =&gt; '' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $page, $tagged_topic_count;&nbsp;</div></li><li><div>  if ( $pages = apply_filters( 'tag_pages', get_page_number_links( $page, $tagged_topic_count ) ) ) {&nbsp;</div></li><li><div>      echo $args['before'] . $pages . $args['after'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_forum_dropdown( $args = '' ) {&nbsp;</div></li><li><div>  $_args = func_get_args();&nbsp;</div></li><li><div>  if ( $args && is_string($args) && false === strpos($args, '=') )&nbsp;</div></li><li><div>      $args = array( 'callback' =&gt; $args );&nbsp;</div></li><li><div>  if ( 1 &lt; func_num_args() )&nbsp;</div></li><li><div>      $args['callback_args'] = $_args[1];&nbsp;</div></li><li><div>  echo bb_get_forum_dropdown( $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_forum_dropdown( $args = '' ) {&nbsp;</div></li><li><div>  $_args = func_get_args();&nbsp;</div></li><li><div>  $defaults = array( 'callback' =&gt; false, 'callback_args' =&gt; false, 'id' =&gt; 'forum_id', 'none' =&gt; false, 'selected' =&gt; false, 'tab' =&gt; false, 'hierarchical' =&gt; 1, 'depth' =&gt; 0, 'child_of' =&gt; 0, 'disable_categories' =&gt; 1, 'options_only' =&gt; false );&nbsp;</div></li><li><div>  if ( $args && is_string($args) && false === strpos($args, '=') )&nbsp;</div></li><li><div>      $args = array( 'callback' =&gt; $args );&nbsp;</div></li><li><div>  if ( 1 &lt; func_num_args() )&nbsp;</div></li><li><div>      $args['callback_args'] = $_args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  extract($args, EXTR_SKIP);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bb_forums( $args ) )&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $forum_id, $forum;&nbsp;</div></li><li><div>  $old_global = $forum;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $name = esc_attr( $id );&nbsp;</div></li><li><div>  $id = str_replace( '_', '-', $name );&nbsp;</div></li><li><div>  $tab = (int) $tab;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $none && 1 == $none )&nbsp;</div></li><li><div>      $none = __('- None -');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = '';&nbsp;</div></li><li><div>  if ( !$options_only ) {&nbsp;</div></li><li><div>      if ( $tab ) {&nbsp;</div></li><li><div>          $tab = ' tabindex=&quot;' . $tab . '&quot;';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $tab = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $r .= '&lt;select name=&quot;' . $name . '&quot; id=&quot;' . $id . '&quot;' . $tab . '&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( $none )&nbsp;</div></li><li><div>      $r .= &quot;\n&quot; . '&lt;option value=&quot;0&quot;&gt;' . $none . '&lt;/option&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $no_option_selected = true;&nbsp;</div></li><li><div>  $options = array();&nbsp;</div></li><li><div>  while ( $depth = bb_forum() ) :&nbsp;</div></li><li><div>      global $forum; <span class="comment">// Globals + References = Pain</span>&nbsp;</div></li><li><div>      $pad_left = str_repeat( '&nbsp;&nbsp;&nbsp;', $depth - 1 );&nbsp;</div></li><li><div>      if ( $disable_categories && isset($forum-&gt;forum_is_category) && $forum-&gt;forum_is_category ) {&nbsp;</div></li><li><div>          $options[] = array(&nbsp;</div></li><li><div>              'value' =&gt; 0, &nbsp;</div></li><li><div>              'display' =&gt; $pad_left . $forum-&gt;forum_name, &nbsp;</div></li><li><div>              'disabled' =&gt; true, &nbsp;</div></li><li><div>              'selected' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $_selected = false;&nbsp;</div></li><li><div>      if ( (!$selected && $forum_id == $forum-&gt;forum_id) || $selected == $forum-&gt;forum_id ) {&nbsp;</div></li><li><div>          $_selected = true;&nbsp;</div></li><li><div>          $no_option_selected = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $options[] = array(&nbsp;</div></li><li><div>          'value' =&gt; $forum-&gt;forum_id, &nbsp;</div></li><li><div>          'display' =&gt; $pad_left . $forum-&gt;forum_name, &nbsp;</div></li><li><div>          'disabled' =&gt; false, &nbsp;</div></li><li><div>          'selected' =&gt; $_selected&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  endwhile;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 1 === count( $options ) && !$none ) {&nbsp;</div></li><li><div>      foreach ( $options as $option_index =&gt; $option_value ) {&nbsp;</div></li><li><div>          if ( $option_value['disabled'] ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return '&lt;input type=&quot;hidden&quot; name=&quot;' . $name . '&quot; id=&quot;' . $id . '&quot; value=&quot;' . esc_attr( $option_value['value'] ) . '&quot; /&gt;&lt;span&gt;' . esc_html( $option_value['display'] ) . '&lt;/span&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ($options as $option_index =&gt; $option_value) {&nbsp;</div></li><li><div>      if (!$none && !$selected && $no_option_selected && !$option_value['disabled']) {&nbsp;</div></li><li><div>          $option_value['selected'] = true;&nbsp;</div></li><li><div>          $no_option_selected = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $option_disabled = $option_value['disabled'] ? ' disabled=&quot;disabled&quot;' : '';&nbsp;</div></li><li><div>      $option_selected = $option_value['selected'] ? ' selected=&quot;selected&quot;' : '';&nbsp;</div></li><li><div>      $r .= &quot;\n&quot; . '&lt;option value=&quot;' . esc_attr( $option_value['value'] ) . '&quot;' . $option_disabled . $option_selected . '&gt;' . esc_html( $option_value['display'] ) . '&lt;/option&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $forum = $old_global;&nbsp;</div></li><li><div>  if ( !$options_only )&nbsp;</div></li><li><div>      $r .= '&lt;/select&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $r;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//FAVORITES</span>&nbsp;</div></li><li><div>function favorites_link( $user_id = 0 ) {&nbsp;</div></li><li><div>  echo apply_filters( 'favorites_link', get_favorites_link( $user_id ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_favorites_link( $user_id = 0 ) {&nbsp;</div></li><li><div>  if ( !$user_id )&nbsp;</div></li><li><div>      $user_id = bb_get_current_user_info( 'id' );&nbsp;</div></li><li><div>  return apply_filters( 'get_favorites_link', get_profile_tab_link($user_id, 'favorites'), $user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function user_favorites_link($add = array(), $rem = array(), $user_id = 0) {&nbsp;</div></li><li><div>  global $topic, $bb_current_user;&nbsp;</div></li><li><div>  if ( empty($add) || !is_array($add) )&nbsp;</div></li><li><div>      $add = array('mid' =&gt; __('Add this topic to your favorites'), 'post' =&gt; __(' (%?%)'));&nbsp;</div></li><li><div>  if ( empty($rem) || !is_array($rem) )&nbsp;</div></li><li><div>      $rem = array( 'pre' =&gt; __('This topic is one of your %favorites% ['), 'mid' =&gt; __('&times;'), 'post' =&gt; __(']'));&nbsp;</div></li><li><div>  if ( $user_id ) :&nbsp;</div></li><li><div>      if ( !bb_current_user_can( 'edit_favorites_of', (int) $user_id ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      if ( !$user = bb_get_user( bb_get_user_id( $user_id ) ) ) :&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      endif;&nbsp;</div></li><li><div>  else :&nbsp;</div></li><li><div>      if ( !bb_current_user_can('edit_favorites') )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      $user =& $bb_current_user-&gt;data;&nbsp;</div></li><li><div>  endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $url = esc_url( get_favorites_link( $user_id ) );&nbsp;</div></li><li><div>  if ( $is_fav = is_user_favorite( $user-&gt;ID, $topic-&gt;topic_id ) ) :&nbsp;</div></li><li><div>      $rem = preg_replace('|%(.+)%|', &quot;&lt;a href='$url'&gt;$1&lt;/a&gt;&quot;, $rem);&nbsp;</div></li><li><div>      $favs = array('fav' =&gt; '0', 'topic_id' =&gt; $topic-&gt;topic_id);&nbsp;</div></li><li><div>      $pre = ( is_array($rem) && isset($rem['pre']) ) ? $rem['pre']  : '';&nbsp;</div></li><li><div>      $mid = ( is_array($rem) && isset($rem['mid']) ) ? $rem['mid']  : ( is_string($rem) ? $rem : '' );&nbsp;</div></li><li><div>      $post = ( is_array($rem) && isset($rem['post']) ) ? $rem['post'] : '';&nbsp;</div></li><li><div>  elseif ( false === $is_fav ) :&nbsp;</div></li><li><div>      $add = preg_replace('|%(.+)%|', &quot;&lt;a href='$url'&gt;$1&lt;/a&gt;&quot;, $add);&nbsp;</div></li><li><div>      $favs = array('fav' =&gt; '1', 'topic_id' =&gt; $topic-&gt;topic_id);&nbsp;</div></li><li><div>      $pre = ( is_array($add) && isset($add['pre']) ) ? $add['pre']  : '';&nbsp;</div></li><li><div>      $mid = ( is_array($add) && isset($add['mid']) ) ? $add['mid']  : ( is_string($add) ? $add : '' );&nbsp;</div></li><li><div>      $post = ( is_array($add) && isset($add['post']) ) ? $add['post'] : '';&nbsp;</div></li><li><div>  endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url = esc_url(  bb_nonce_url( add_query_arg( $favs, get_favorites_link( $user_id ) ), 'toggle-favorite_' . $topic-&gt;topic_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (  !is_null($is_fav) )&nbsp;</div></li><li><div>      echo &quot;&lt;span id='favorite-$topic-&gt;topic_id'&gt;$pre&lt;a href='$url' class='dim:favorite-toggle:favorite-$topic-&gt;topic_id:is-favorite'&gt;$mid&lt;/a&gt;$post&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function favorites_rss_link( $id = 0, $context = 0 ) {&nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  echo apply_filters('favorites_rss_link', get_favorites_rss_link( $id, $context ), $context, $id);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_favorites_rss_link( $id = 0, $context = 0 ) {&nbsp;</div></li><li><div>  $user = bb_get_user( bb_get_user_id( $id ) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF + BB_URI_CONTEXT_BB_FEED;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $rewrite = bb_get_option( 'mod_rewrite' );&nbsp;</div></li><li><div>  if ( $rewrite ) {&nbsp;</div></li><li><div>      if ( $rewrite === 'slugs' ) {&nbsp;</div></li><li><div>          $column = 'user_nicename';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $column = 'ID';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $link = bb_get_uri('rss/profile/' . $user-&gt;$column, null, $context);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $link = bb_get_uri('rss.php', array('profile' =&gt; $user-&gt;ID), $context);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return apply_filters( 'get_favorites_rss_link', $link, $user-&gt;ID, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function favorites_pages( $args = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $defaults = array( 'before' =&gt; '', 'after' =&gt; '' );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $page, $user, $favorites_total;&nbsp;</div></li><li><div>  if ( $pages = apply_filters( 'favorites_pages', get_page_number_links( $page, $favorites_total ), $user-&gt;user_id ) ) {&nbsp;</div></li><li><div>      echo $args['before'] . $pages . $args['after'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//SUBSCRIPTION</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** </span>&nbsp;</div></li><li><div><span class="comment"> * Checks if subscription is enabled.</span>&nbsp;</div></li><li><div><span class="comment"> * </span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1 </span>&nbsp;</div></li><li><div><span class="comment"> *  </span>&nbsp;</div></li><li><div><span class="comment"> * @return bool is subscription enabled or not </span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_is_subscriptions_active() { &nbsp;</div></li><li><div>  return (bool) bb_get_option( 'enable_subscriptions' ); &nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if user is subscribed to current topic.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool is user subscribed or not</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_is_user_subscribed( $args = null ) {&nbsp;</div></li><li><div>  global $bbdb;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'user_id' =&gt; bb_is_topic_edit() ? bb_get_user_id( get_post_author_id() ) : bb_get_current_user_info( 'id' ), &nbsp;</div></li><li><div>      'topic_id' =&gt; get_topic_id()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $there = $bbdb-&gt;get_var( $bbdb-&gt;prepare( &quot;SELECT `$bbdb-&gt;term_relationships`.`object_id`&nbsp;</div></li><li><div>              FROM $bbdb-&gt;term_relationships, $bbdb-&gt;term_taxonomy, $bbdb-&gt;terms&nbsp;</div></li><li><div>              WHERE `$bbdb-&gt;term_relationships`.`object_id` = %d&nbsp;</div></li><li><div>              AND `$bbdb-&gt;term_relationships`.`term_taxonomy_id` = `$bbdb-&gt;term_taxonomy`.`term_taxonomy_id`&nbsp;</div></li><li><div>              AND `$bbdb-&gt;term_taxonomy`.`term_id` = `$bbdb-&gt;terms`.`term_id`&nbsp;</div></li><li><div>              AND `$bbdb-&gt;term_taxonomy`.`taxonomy` = 'bb_subscribe'&nbsp;</div></li><li><div>              AND `$bbdb-&gt;terms`.`slug` = 'topic-%d'&quot;, &nbsp;</div></li><li><div>              $user_id, $topic_id ) );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  $there = apply_filters( 'bb_is_user_subscribed', $there, $args );&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ( $there )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the subscribe/unsubscibe link.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if user is subscribed and outputs link based on status.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_user_subscribe_link() {&nbsp;</div></li><li><div>  $topic_id = get_topic_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bb_is_user_logged_in() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bb_is_user_subscribed() )&nbsp;</div></li><li><div>      echo '&lt;li id=&quot;subscription-toggle&quot;&gt;&lt;a href=&quot;'. bb_nonce_url( bb_get_uri( null, array( 'doit' =&gt; 'bb-subscribe', 'topic_id' =&gt; $topic_id, 'and' =&gt; 'remove' ) ), 'toggle-subscribe_' . $topic_id ) .'&quot;&gt;' . apply_filters( 'bb_user_subscribe_link_unsubscribe', __( 'Unsubscribe from Topic' ) ) . '&lt;/a&gt;&lt;/li&gt;';&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      echo '&lt;li id=&quot;subscription-toggle&quot;&gt;&lt;a href=&quot;'. bb_nonce_url( bb_get_uri( null, array( 'doit' =&gt; 'bb-subscribe', 'topic_id' =&gt; $topic_id, 'and' =&gt; 'add' ) ), 'toggle-subscribe_' . $topic_id ) .'&quot;&gt;' . apply_filters( 'bb_user_subscribe_link_subscribe', __( 'Subscribe to Topic' ) ) . '&lt;/a&gt;&lt;/li&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the post form subscription checkbox.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if user is subscribed and outputs checkbox based on status.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_user_subscribe_checkbox( $args = null ) {&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ( !bb_is_user_logged_in() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $is_current = false;&nbsp;</div></li><li><div>  $defaults = array( 'tab' =&gt; false );&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  $tab = $args['tab'] !== false ? ' tabindex=&quot;' . $args['tab'] . '&quot;' : '';&nbsp;</div></li><li><div>  $is_current = bb_get_user_id( get_post_author_id() ) == bb_get_current_user_info( 'id' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Change subscription checkbox message if current or moderating</span>&nbsp;</div></li><li><div>  if ( bb_is_topic_edit() && !$is_current )&nbsp;</div></li><li><div>      $text = __( 'This user should be notified of follow-up posts via email' );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $text = __( 'Notify me of follow-up posts via email' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo '&nbsp;</div></li><li><div>  &lt;label for=&quot;subscription_checkbox&quot;&gt;&nbsp;</div></li><li><div>      &lt;input name=&quot;subscription_checkbox&quot; id=&quot;subscription_checkbox&quot; type=&quot;checkbox&quot; value=&quot;subscribe&quot; ' . checked( true, bb_is_user_subscribed(), false ) . $tab . ' /&gt;&nbsp;</div></li><li><div>      ' .  apply_filters( 'bb_user_subscribe_checkbox_label', $text, (bool) $is_current ) . '&nbsp;</div></li><li><div>  &lt;/label&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//VIEWS</span>&nbsp;</div></li><li><div>function view_name( $view = '' ) { <span class="comment">// Filtration should be done at bb_register_view()</span>&nbsp;</div></li><li><div>  echo get_view_name( $view );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_view_name( $_view = '' ) {&nbsp;</div></li><li><div>  global $view, $bb_views;&nbsp;</div></li><li><div>  if ( $_view )&nbsp;</div></li><li><div>      $v = bb_slug_sanitize($_view);&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $v =& $view;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset($bb_views[$v]) )&nbsp;</div></li><li><div>      return $bb_views[$v]['title'];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function view_pages() {&nbsp;</div></li><li><div>  global $page, $view_count;&nbsp;</div></li><li><div>  echo apply_filters( 'view_pages', get_page_number_links( $page, $view_count ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function view_link( $_view = false, $page = 1, $context = BB_URI_CONTEXT_A_HREF ) {&nbsp;</div></li><li><div>  echo get_view_link( $_view, $page, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_view_link( $_view = false, $page = 1, $context = BB_URI_CONTEXT_A_HREF ) {&nbsp;</div></li><li><div>  global $view, $bb_views;&nbsp;</div></li><li><div>  if ( $_view )&nbsp;</div></li><li><div>      $v = bb_slug_sanitize($_view);&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $v =& $view;&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if (!$context || !is_integer($context)) {&nbsp;</div></li><li><div>      $context = BB_URI_CONTEXT_A_HREF;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  if ( !array_key_exists($v, $bb_views) )&nbsp;</div></li><li><div>      return bb_get_uri(null, null, $context);&nbsp;</div></li><li><div>  if ( bb_get_option('mod_rewrite') ) {&nbsp;</div></li><li><div>      $page = ( 1 &lt; $page ) ? '/page/' . $page : '';&nbsp;</div></li><li><div>      $link = bb_get_uri('view/' . $v . $page, null, $context);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $query = array(&nbsp;</div></li><li><div>          'view' =&gt; $v, &nbsp;</div></li><li><div>          'page' =&gt; ( 1 &lt; $page ) ? $page : false, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $link = bb_get_uri('view.php', $query, $context);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'get_view_link', $link, $v, $page, $context );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _bb_parse_time_function_args( $args ) {&nbsp;</div></li><li><div>  if ( is_numeric($args) )&nbsp;</div></li><li><div>      $args = array('id' =&gt; $args);&nbsp;</div></li><li><div>  elseif ( $args && is_string($args) && false === strpos($args, '=') )&nbsp;</div></li><li><div>      $args = array('format' =&gt; $args);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array( 'id' =&gt; 0, 'format' =&gt; 'since', 'more' =&gt; 0, 'localize' =&gt; true );&nbsp;</div></li><li><div>  return wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function _bb_time_function_return( $time, $args ) {&nbsp;</div></li><li><div>  $time = bb_gmtstrtotime( $time );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $format = $args['format'] ) :&nbsp;</div></li><li><div>  case 'since' :&nbsp;</div></li><li><div>      return bb_since( $time, $args['more'] );&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'timestamp' :&nbsp;</div></li><li><div>      $format = 'U';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'mysql' :&nbsp;</div></li><li><div>      $format = 'Y-m-d H:i:s';&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  case 'datetime' :&nbsp;</div></li><li><div>      $format = bb_get_option( 'datetime_format' );&nbsp;</div></li><li><div>      break;&nbsp;</div></li><li><div>  endswitch;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $args['localize'] ? bb_gmdate_i18n( $format, $time ) : gmdate( $format, $time );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_template_scripts() {&nbsp;</div></li><li><div>  if ( bb_is_topic() && bb_is_user_logged_in() )&nbsp;</div></li><li><div>      wp_enqueue_script( 'topic' );&nbsp;</div></li><li><div>  elseif ( bb_is_profile() && bb_is_user_logged_in() ) {&nbsp;</div></li><li><div>      global $self;&nbsp;</div></li><li><div>      if ($self == 'profile-edit.php') {&nbsp;</div></li><li><div>          wp_enqueue_script( 'profile-edit' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'checked' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the html checked attribute.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Compares the first two arguments and if identical marks as checked</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $checked One of the values to compare</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $current (true) The other value to compare if not just true</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $echo Whether to echo or just return the string</span>&nbsp;</div></li><li><div><span class="comment"> * @return string html attribute or empty string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function checked( $checked, $current = true, $echo = true ) {&nbsp;</div></li><li><div>  return __checked_selected_helper( $checked, $current, $echo, 'checked' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'selected' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the html selected attribute.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Compares the first two arguments and if identical marks as selected</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed selected One of the values to compare</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $current (true) The other value to compare if not just true</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $echo Whether to echo or just return the string</span>&nbsp;</div></li><li><div><span class="comment"> * @return string html attribute or empty string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function selected( $selected, $current = true, $echo = true ) {&nbsp;</div></li><li><div>  return __checked_selected_helper( $selected, $current, $echo, 'selected' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'disabled' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Outputs the html disabled attribute.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Compares the first two arguments and if identical marks as disabled</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $disabled One of the values to compare</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $current (true) The other value to compare if not just true</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $echo Whether to echo or just return the string</span>&nbsp;</div></li><li><div><span class="comment"> * @return string html attribute or empty string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function disabled( $disabled, $current = true, $echo = true ) {&nbsp;</div></li><li><div>  return __checked_selected_helper( $disabled, $current, $echo, 'disabled' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( '__checked_selected_helper' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Private helper function for checked, selected, and disabled.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Compares the first two arguments and if identical marks as $type</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param any $helper One of the values to compare</span>&nbsp;</div></li><li><div><span class="comment"> * @param any $current (true) The other value to compare if not just true</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $echo Whether to echo or just return the string</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $type The type of checked|selected|disabled we are doing</span>&nbsp;</div></li><li><div><span class="comment"> * @return string html attribute or empty string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function __checked_selected_helper( $helper, $current, $echo, $type ) {&nbsp;</div></li><li><div>  if ( (string) $helper === (string) $current )&nbsp;</div></li><li><div>      $result = &quot; $type='$type'&quot;;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $result = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $echo )&nbsp;</div></li><li><div>      echo $result;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $result;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2019 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>