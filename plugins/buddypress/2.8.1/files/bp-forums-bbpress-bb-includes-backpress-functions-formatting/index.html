<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.8.1" data-slug="buddypress" data-type="file" data-id="49161"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-forums-bbpress-bb-includes-backpress-functions-formatting | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.8.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.17"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=2b1d72b6b02d20352ac6088f8ef9b92f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.17' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-forums-bbpress-bb-includes-backpress-functions-formatting/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-forums-bbpress-bb-includes-backpress-functions-formatting%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-forums-bbpress-bb-includes-backpress-functions-formatting%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.1-file-bp-forums-bbpress-bb-includes-backpress-functions-formatting","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-forums-bbpress-bb-includes-backpress-functions-formatting" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.1." href="http://hookr.io/plugins/buddypress/2.8.1/" class="H_VERSION"><span property="name">2.8.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.8.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-forums-bbpress-bb-includes&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.1/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.1/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.1/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.1/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.1/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.1/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.1/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-forums/bbpress/bb-includes/backpress/functions.formatting.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">// Last sync [WP12504]</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * From WP wp-includes/formatting.php</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Missing functions are indicated in comments</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Main BackPress Formatting API.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Handles many functions for formatting output.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BackPress</span>&nbsp;</div></li><li><div><span class="comment"> **/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'wptexturize' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Replaces common plain text characters into formatted entities</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * As an example, </span>&nbsp;</div></li><li><div><span class="comment"> * &lt;code&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * 'cause today's effort makes it worth tomorrow's &quot;holiday&quot;...</span>&nbsp;</div></li><li><div><span class="comment"> * &lt;/code&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * Becomes:</span>&nbsp;</div></li><li><div><span class="comment"> * &lt;code&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * &#8217;cause today&#8217;s effort makes it worth tomorrow&#8217;s &#8220;holiday&#8221;&#8230;</span>&nbsp;</div></li><li><div><span class="comment"> * &lt;/code&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * Code within certain html blocks are skipped.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.71</span>&nbsp;</div></li><li><div><span class="comment"> * @uses $wp_cockneyreplace Array of formatted entities for certain common phrases</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text The text to be formatted</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The string replaced with html entities</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wptexturize($text) {&nbsp;</div></li><li><div>  global $wp_cockneyreplace;&nbsp;</div></li><li><div>  static $static_setup = false, $opening_quote, $closing_quote, $default_no_texturize_tags, $default_no_texturize_shortcodes, $static_characters, $static_replacements, $dynamic_characters, $dynamic_replacements;&nbsp;</div></li><li><div>  $output = '';&nbsp;</div></li><li><div>  $curl = '';&nbsp;</div></li><li><div>  $textarr = preg_split('/(&lt;.*&gt;|\[.*\])/Us', $text, -1, PREG_SPLIT_DELIM_CAPTURE);&nbsp;</div></li><li><div>  $stop = count($textarr);&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">// No need to setup these variables more than once</span>&nbsp;</div></li><li><div>  if (!$static_setup) {&nbsp;</div></li><li><div>      <span class="comment">/** translators: opening curly quote */</span>&nbsp;</div></li><li><div>      $opening_quote = _x('&#8220;', 'opening curly quote');&nbsp;</div></li><li><div>      <span class="comment">/** translators: closing curly quote */</span>&nbsp;</div></li><li><div>      $closing_quote = _x('&#8221;', 'closing curly quote');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $default_no_texturize_tags = array('pre', 'code', 'kbd', 'style', 'script', 'tt');&nbsp;</div></li><li><div>      $default_no_texturize_shortcodes = array('code');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// if a plugin has provided an autocorrect array, use it</span>&nbsp;</div></li><li><div>      if ( isset($wp_cockneyreplace) ) {&nbsp;</div></li><li><div>          $cockney = array_keys($wp_cockneyreplace);&nbsp;</div></li><li><div>          $cockneyreplace = array_values($wp_cockneyreplace);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $cockney = array(&quot;'tain't&quot;, &quot;'twere&quot;, &quot;'twas&quot;, &quot;'tis&quot;, &quot;'twill&quot;, &quot;'til&quot;, &quot;'bout&quot;, &quot;'nuff&quot;, &quot;'round&quot;, &quot;'cause&quot;);&nbsp;</div></li><li><div>          $cockneyreplace = array(&quot;&#8217;tain&#8217;t&quot;, &quot;&#8217;twere&quot;, &quot;&#8217;twas&quot;, &quot;&#8217;tis&quot;, &quot;&#8217;twill&quot;, &quot;&#8217;til&quot;, &quot;&#8217;bout&quot;, &quot;&#8217;nuff&quot;, &quot;&#8217;round&quot;, &quot;&#8217;cause&quot;);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $static_characters = array_merge(array('---', ' -- ', '--', ' - ', 'xn&#8211;', '...', '``', '\'s', '\'\'', ' (tm)'), $cockney);&nbsp;</div></li><li><div>      $static_replacements = array_merge(array('&#8212;', ' &#8212; ', '&#8211;', ' &#8211; ', 'xn--', '&#8230;', $opening_quote, '&#8217;s', $closing_quote, ' &#8482;'), $cockneyreplace);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $dynamic_characters = array('/\'(\d\d(?:&#8217;|\')?s)/', '/(\s|\A|[([{&lt;]|&quot;)\'/', '/(\d+)&quot;/', '/(\d+)\'/', '/(\S)\'([^\'\s])/', '/(\s|\A|[([{&lt;])&quot;(?!\s)/', '/&quot;(\s|\S|\Z)/', '/\'([\s.]|\Z)/', '/(\d+)x(\d+)/');&nbsp;</div></li><li><div>      $dynamic_replacements = array('&#8217;$1', '$1&#8216;', '$1&#8243;', '$1&#8242;', '$1&#8217;$2', '$1' . $opening_quote . '$2', $closing_quote . '$1', '&#8217;$1', '$1&#215;$2');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $static_setup = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Transform into regexp sub-expression used in _wptexturize_pushpop_element</span>&nbsp;</div></li><li><div>  <span class="comment">// Must do this everytime in case plugins use these filters in a context sensitive manner</span>&nbsp;</div></li><li><div>  $no_texturize_tags = '(' . implode('|', apply_filters('no_texturize_tags', $default_no_texturize_tags) ) . ')';&nbsp;</div></li><li><div>  $no_texturize_shortcodes = '(' . implode('|', apply_filters('no_texturize_shortcodes', $default_no_texturize_shortcodes) ) . ')';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $no_texturize_tags_stack = array();&nbsp;</div></li><li><div>  $no_texturize_shortcodes_stack = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  for ( $i = 0; $i &lt; $stop; $i++ ) {&nbsp;</div></li><li><div>      $curl = $textarr[$i];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty($curl) && '&lt;' != $curl{0} && '[' != $curl{0}&nbsp;</div></li><li><div>              && empty($no_texturize_shortcodes_stack) && empty($no_texturize_tags_stack)) { &nbsp;</div></li><li><div>          <span class="comment">// This is not a tag, nor is the texturization disabled</span>&nbsp;</div></li><li><div>          <span class="comment">// static strings</span>&nbsp;</div></li><li><div>          $curl = str_replace($static_characters, $static_replacements, $curl);&nbsp;</div></li><li><div>          <span class="comment">// regular expressions</span>&nbsp;</div></li><li><div>          $curl = preg_replace($dynamic_characters, $dynamic_replacements, $curl);&nbsp;</div></li><li><div>      } elseif (!empty($curl)) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Only call _wptexturize_pushpop_element if first char is correct</span>&nbsp;</div></li><li><div><span class="comment">           * tag opening</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ('&lt;' == $curl{0})&nbsp;</div></li><li><div>              _wptexturize_pushpop_element($curl, $no_texturize_tags_stack, $no_texturize_tags, '&lt;', '&gt;');&nbsp;</div></li><li><div>          elseif ('[' == $curl{0})&nbsp;</div></li><li><div>              _wptexturize_pushpop_element($curl, $no_texturize_shortcodes_stack, $no_texturize_shortcodes, '[', ']');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $curl = preg_replace('/&([^#])(?![a-zA-Z1-4]{1, 8};)/', '&#038;$1', $curl);&nbsp;</div></li><li><div>      $output .= $curl;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $output;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( '_wptexturize_pushpop_element' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Search for disabled element tags. Push element to stack on tag open and pop</span>&nbsp;</div></li><li><div><span class="comment"> * on tag close. Assumes first character of $text is tag opening.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text Text to check. First character is assumed to be $opening</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $stack Array used as stack of opened tag elements</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $disabled_elements Tags to match against formatted as regexp sub-expression</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $opening Tag opening character, assumed to be 1 character long</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $opening Tag closing  character</span>&nbsp;</div></li><li><div><span class="comment"> * @return object</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wptexturize_pushpop_element($text, &$stack, $disabled_elements, $opening = '&lt;', $closing = '&gt;') {&nbsp;</div></li><li><div>  <span class="comment">// Check if it is a closing tag -- otherwise assume opening tag</span>&nbsp;</div></li><li><div>  if (strncmp($opening . '/', $text, 2)) {&nbsp;</div></li><li><div>      <span class="comment">// Opening? Check $text+1 against disabled elements</span>&nbsp;</div></li><li><div>      if (preg_match('/^' . $disabled_elements . '\b/', substr($text, 1), $matches)) {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * This disables texturize until we find a closing tag of our type</span>&nbsp;</div></li><li><div><span class="comment">           * (e.g. &lt;pre&gt;) even if there was invalid nesting before that</span>&nbsp;</div></li><li><div><span class="comment">           * </span>&nbsp;</div></li><li><div><span class="comment">           * Example: in the case &lt;pre&gt;sadsadasd&lt;/code&gt;&quot;baba&quot;&lt;/pre&gt;</span>&nbsp;</div></li><li><div><span class="comment">           *          &quot;baba&quot; won't be texturize</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          array_push($stack, $matches[1]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Closing? Check $text+2 against disabled elements</span>&nbsp;</div></li><li><div>      $c = preg_quote($closing, '/');&nbsp;</div></li><li><div>      if (preg_match('/^' . $disabled_elements . $c . '/', substr($text, 2), $matches)) {&nbsp;</div></li><li><div>          $last = array_pop($stack);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Make sure it matches the opening tag</span>&nbsp;</div></li><li><div>          if ($last != $matches[1])&nbsp;</div></li><li><div>              array_push($stack, $last);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'clean_pre' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Accepts matches array from preg_replace_callback in wpautop() or a string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Ensures that the contents of a &lt;&lt;pre&gt;&gt;...&lt;&lt;/pre&gt;&gt; HTML block are not</span>&nbsp;</div></li><li><div><span class="comment"> * converted into paragraphs or line-breaks.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $matches The array or string</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The pre block without paragraph/line-break conversion.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function clean_pre($matches) {&nbsp;</div></li><li><div>  if ( is_array($matches) )&nbsp;</div></li><li><div>      $text = $matches[1] . $matches[2] . &quot;&lt;/pre&gt;&quot;;&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $text = $matches;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $text = str_replace('&lt;br /&gt;', '', $text);&nbsp;</div></li><li><div>  $text = str_replace('&lt;p&gt;', &quot;\n&quot;, $text);&nbsp;</div></li><li><div>  $text = str_replace('&lt;/p&gt;', '', $text);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $text;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function wpautop()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('seems_utf8') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks to see if a string is utf8 encoded.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * NOTE: This function checks for 5-Byte sequences, UTF8</span>&nbsp;</div></li><li><div><span class="comment"> *       has Bytes Sequences with a maximum length of 4.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @author bmorel at ssi dot fr (modified)</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $str The string to be checked</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if $str fits a UTF-8 model, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function seems_utf8($str) {&nbsp;</div></li><li><div>  $length = strlen($str);&nbsp;</div></li><li><div>  for ($i=0; $i &lt; $length; $i++) {&nbsp;</div></li><li><div>      $c = ord($str[$i]);&nbsp;</div></li><li><div>      if ($c &lt; 0x80) $n = 0; # 0bbbbbbb&nbsp;</div></li><li><div>      elseif (($c & 0xE0) == 0xC0) $n=1; # 110bbbbb&nbsp;</div></li><li><div>      elseif (($c & 0xF0) == 0xE0) $n=2; # 1110bbbb&nbsp;</div></li><li><div>      elseif (($c & 0xF8) == 0xF0) $n=3; # 11110bbb&nbsp;</div></li><li><div>      elseif (($c & 0xFC) == 0xF8) $n=4; # 111110bb&nbsp;</div></li><li><div>      elseif (($c & 0xFE) == 0xFC) $n=5; # 1111110b&nbsp;</div></li><li><div>      else return false; # Does not match any model&nbsp;</div></li><li><div>      for ($j=0; $j&lt;$n; $j++) { # n bytes matching 10bbbbbb follow ?&nbsp;</div></li><li><div>          if ((++$i == $length) || ((ord($str[$i]) & 0xC0) != 0x80))&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('_wp_specialchars') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Converts a number of special characters into their HTML entities.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Specifically deals with: &, &lt;, &gt;, &quot;, and '.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * $quote_style can be set to ENT_COMPAT to encode &quot; to</span>&nbsp;</div></li><li><div><span class="comment"> * &quot;, or ENT_QUOTES to do both. Default is ENT_NOQUOTES where no quotes are encoded.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.2</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $string The text which is to be encoded.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $quote_style Optional. Converts double quotes if set to ENT_COMPAT, both single and double if set to ENT_QUOTES or none if set to ENT_NOQUOTES. Also compatible with old values; converting single quotes if set to 'single', double if set to 'double' or both if otherwise set. Default is ENT_NOQUOTES.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $charset Optional. The character encoding of the string. Default is false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param boolean $double_encode Optional. Whether or not to encode existing html entities. Default is false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The encoded text with HTML entities.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _wp_specialchars( $string, $quote_style = ENT_NOQUOTES, $charset = false, $double_encode = false ) {&nbsp;</div></li><li><div>  $string = (string) $string;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 0 === strlen( $string ) ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Don't bother if there are no specialchars - saves some processing</span>&nbsp;</div></li><li><div>  if ( !preg_match( '/[&&lt;&gt;&quot;\']/', $string ) ) {&nbsp;</div></li><li><div>      return $string;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Account for the previous behaviour of the function when the $quote_style is not an accepted value</span>&nbsp;</div></li><li><div>  if ( empty( $quote_style ) ) {&nbsp;</div></li><li><div>      $quote_style = ENT_NOQUOTES;&nbsp;</div></li><li><div>  } elseif ( !in_array( $quote_style, array( 0, 2, 3, 'single', 'double' ), true ) ) {&nbsp;</div></li><li><div>      $quote_style = ENT_QUOTES;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Store the site charset as a static to avoid multiple calls to backpress_get_option()</span></span>&nbsp;</div></li><li><div>  if ( !$charset ) {&nbsp;</div></li><li><div>      static $_charset;&nbsp;</div></li><li><div>      if ( !isset( $_charset ) ) {&nbsp;</div></li><li><div>          $_charset = backpress_get_option( 'charset' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $charset = $_charset;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( in_array( $charset, array( 'utf8', 'utf-8', 'UTF8' ) ) ) {&nbsp;</div></li><li><div>      $charset = 'UTF-8';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $_quote_style = $quote_style;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $quote_style === 'double' ) {&nbsp;</div></li><li><div>      $quote_style = ENT_COMPAT;&nbsp;</div></li><li><div>      $_quote_style = ENT_COMPAT;&nbsp;</div></li><li><div>  } elseif ( $quote_style === 'single' ) {&nbsp;</div></li><li><div>      $quote_style = ENT_NOQUOTES;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Handle double encoding ourselves</span></span>&nbsp;</div></li><li><div>  if ( !$double_encode ) {&nbsp;</div></li><li><div>      $string = wp_specialchars_decode( $string, $_quote_style );&nbsp;</div></li><li><div>      $string = preg_replace( '/&(#?x?[0-9a-z]+);/i', '|wp_entity|$1|/wp_entity|', $string );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $string = @htmlspecialchars( $string, $quote_style, $charset );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Handle double encoding ourselves</span></span>&nbsp;</div></li><li><div>  if ( !$double_encode ) {&nbsp;</div></li><li><div>      $string = str_replace( array( '|wp_entity|', '|/wp_entity|' ), array( '&', ';' ), $string );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Backwards compatibility</span>&nbsp;</div></li><li><div>  if ( 'single' === $_quote_style ) {&nbsp;</div></li><li><div>      $string = str_replace( &quot;'&quot;, '&#039;', $string );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $string;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'wp_specialchars_decode' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Converts a number of HTML entities into their special characters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Specifically deals with: &, &lt;, &gt;, &quot;, and '.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * $quote_style can be set to ENT_COMPAT to decode &quot; entities, </span>&nbsp;</div></li><li><div><span class="comment"> * or ENT_QUOTES to do both &quot; and '. Default is ENT_NOQUOTES where no quotes are decoded.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $string The text which is to be decoded.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $quote_style Optional. Converts double quotes if set to ENT_COMPAT, both single and double if set to ENT_QUOTES or none if set to ENT_NOQUOTES. Also compatible with old _wp_specialchars() values; converting single quotes if set to 'single', double if set to 'double' or both if otherwise set. Default is ENT_NOQUOTES.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The decoded text without HTML entities.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_specialchars_decode( $string, $quote_style = ENT_NOQUOTES ) {&nbsp;</div></li><li><div>  $string = (string) $string;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 0 === strlen( $string ) ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Don't bother if there are no entities - saves a lot of processing</span>&nbsp;</div></li><li><div>  if ( strpos( $string, '&' ) === false ) {&nbsp;</div></li><li><div>      return $string;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Match the previous behaviour of _wp_specialchars() when the $quote_style is not an accepted value</span>&nbsp;</div></li><li><div>  if ( empty( $quote_style ) ) {&nbsp;</div></li><li><div>      $quote_style = ENT_NOQUOTES;&nbsp;</div></li><li><div>  } elseif ( !in_array( $quote_style, array( 0, 2, 3, 'single', 'double' ), true ) ) {&nbsp;</div></li><li><div>      $quote_style = ENT_QUOTES;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// More complete than get_html_translation_table( HTML_SPECIALCHARS )</span>&nbsp;</div></li><li><div>  $single = array( '&#039;' =&gt; '\'', '&#x27;' =&gt; '\'' );&nbsp;</div></li><li><div>  $single_preg = array( '/&#0*39;/' =&gt; '&#039;', '/&#x0*27;/i' =&gt; '&#x27;' );&nbsp;</div></li><li><div>  $double = array( '&quot;' =&gt; '&quot;', '&#034;' =&gt; '&quot;', '&#x22;' =&gt; '&quot;' );&nbsp;</div></li><li><div>  $double_preg = array( '/&#0*34;/' =&gt; '&#034;', '/&#x0*22;/i' =&gt; '&#x22;' );&nbsp;</div></li><li><div>  $others = array( '&lt;' =&gt; '&lt;', '&#060;' =&gt; '&lt;', '&gt;' =&gt; '&gt;', '&#062;' =&gt; '&gt;', '&amp;' =&gt; '&', '&#038;' =&gt; '&', '&#x26;' =&gt; '&' );&nbsp;</div></li><li><div>  $others_preg = array( '/&#0*60;/' =&gt; '&#060;', '/&#0*62;/' =&gt; '&#062;', '/&#0*38;/' =&gt; '&#038;', '/&#x0*26;/i' =&gt; '&#x26;' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $quote_style === ENT_QUOTES ) {&nbsp;</div></li><li><div>      $translation = array_merge( $single, $double, $others );&nbsp;</div></li><li><div>      $translation_preg = array_merge( $single_preg, $double_preg, $others_preg );&nbsp;</div></li><li><div>  } elseif ( $quote_style === ENT_COMPAT || $quote_style === 'double' ) {&nbsp;</div></li><li><div>      $translation = array_merge( $double, $others );&nbsp;</div></li><li><div>      $translation_preg = array_merge( $double_preg, $others_preg );&nbsp;</div></li><li><div>  } elseif ( $quote_style === 'single' ) {&nbsp;</div></li><li><div>      $translation = array_merge( $single, $others );&nbsp;</div></li><li><div>      $translation_preg = array_merge( $single_preg, $others_preg );&nbsp;</div></li><li><div>  } elseif ( $quote_style === ENT_NOQUOTES ) {&nbsp;</div></li><li><div>      $translation = $others;&nbsp;</div></li><li><div>      $translation_preg = $others_preg;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Remove zero padding on numeric entities</span>&nbsp;</div></li><li><div>  $string = preg_replace( array_keys( $translation_preg ), array_values( $translation_preg ), $string );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Replace characters according to translation table</span>&nbsp;</div></li><li><div>  return strtr( $string, $translation );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'wp_check_invalid_utf8' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks for invalid UTF8 in a string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $string The text which is to be checked.</span>&nbsp;</div></li><li><div><span class="comment"> * @param boolean $strip Optional. Whether to attempt to strip out invalid UTF8. Default is false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The checked text.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_check_invalid_utf8( $string, $strip = false ) {&nbsp;</div></li><li><div>  $string = (string) $string;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 0 === strlen( $string ) ) {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Store the site charset as a static to avoid multiple calls to backpress_get_option()</span></span>&nbsp;</div></li><li><div>  static $is_utf8;&nbsp;</div></li><li><div>  if ( !isset( $is_utf8 ) ) {&nbsp;</div></li><li><div>      $is_utf8 = in_array( backpress_get_option( 'charset' ), array( 'utf8', 'utf-8', 'UTF8', 'UTF-8' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( !$is_utf8 ) {&nbsp;</div></li><li><div>      return $string;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check for support for utf8 in the installed PCRE library once and store the result in a static</span>&nbsp;</div></li><li><div>  static $utf8_pcre;&nbsp;</div></li><li><div>  if ( !isset( $utf8_pcre ) ) {&nbsp;</div></li><li><div>      $utf8_pcre = @preg_match( '/^./u', 'a' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  <span class="comment">// We can't demand utf8 in the PCRE installation, so just return the string in those cases</span>&nbsp;</div></li><li><div>  if ( !$utf8_pcre ) {&nbsp;</div></li><li><div>      return $string;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// preg_match fails when it encounters invalid UTF8 in $string</span>&nbsp;</div></li><li><div>  if ( 1 === @preg_match( '/^./us', $string ) ) {&nbsp;</div></li><li><div>      return $string;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Attempt to strip the bad chars if requested (not recommended)</span>&nbsp;</div></li><li><div>  if ( $strip && function_exists( 'iconv' ) ) {&nbsp;</div></li><li><div>      return iconv( 'utf-8', 'utf-8', $string );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return '';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('utf8_uri_encode') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Encode the Unicode values to be used in the URI.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $utf8_string</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $length Max length of the string</span>&nbsp;</div></li><li><div><span class="comment"> * @return string String with Unicode encoded for URI.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function utf8_uri_encode( $utf8_string, $length = 0 ) {&nbsp;</div></li><li><div>  $unicode = '';&nbsp;</div></li><li><div>  $values = array();&nbsp;</div></li><li><div>  $num_octets = 1;&nbsp;</div></li><li><div>  $unicode_length = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $string_length = strlen( $utf8_string );&nbsp;</div></li><li><div>  for ($i = 0; $i &lt; $string_length; $i++ ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $value = ord( $utf8_string[ $i ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $value &lt; 128 ) {&nbsp;</div></li><li><div>          if ( $length && ( $unicode_length &gt;= $length ) )&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          $unicode .= chr($value);&nbsp;</div></li><li><div>          $unicode_length++;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( count( $values ) == 0 ) $num_octets = ( $value &lt; 224 ) ? 2 : 3;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $values[] = $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $length && ( $unicode_length + ($num_octets * 3) ) &gt; $length )&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          if ( count( $values ) == $num_octets ) {&nbsp;</div></li><li><div>              if ($num_octets == 3) {&nbsp;</div></li><li><div>                  $unicode .= '%' . dechex($values[0]) . '%' . dechex($values[1]) . '%' . dechex($values[2]);&nbsp;</div></li><li><div>                  $unicode_length += 9;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $unicode .= '%' . dechex($values[0]) . '%' . dechex($values[1]);&nbsp;</div></li><li><div>                  $unicode_length += 6;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $values = array();&nbsp;</div></li><li><div>              $num_octets = 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $unicode;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('remove_accents') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Converts all accent characters to ASCII characters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If there are no accent characters, then the string given is just returned.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $string Text that might have accent characters</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Filtered string with replaced &quot;nice&quot; characters.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function remove_accents($string) {&nbsp;</div></li><li><div>  if ( !preg_match('/[\x80-\xff]/', $string) )&nbsp;</div></li><li><div>      return $string;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if (seems_utf8($string)) {&nbsp;</div></li><li><div>      $chars = array(&nbsp;</div></li><li><div>      <span class="comment">// Decompositions for Latin-1 Supplement</span>&nbsp;</div></li><li><div>      chr(195).chr(128) =&gt; 'A', chr(195).chr(129) =&gt; 'A', &nbsp;</div></li><li><div>      chr(195).chr(130) =&gt; 'A', chr(195).chr(131) =&gt; 'A', &nbsp;</div></li><li><div>      chr(195).chr(132) =&gt; 'A', chr(195).chr(133) =&gt; 'A', &nbsp;</div></li><li><div>      chr(195).chr(135) =&gt; 'C', chr(195).chr(136) =&gt; 'E', &nbsp;</div></li><li><div>      chr(195).chr(137) =&gt; 'E', chr(195).chr(138) =&gt; 'E', &nbsp;</div></li><li><div>      chr(195).chr(139) =&gt; 'E', chr(195).chr(140) =&gt; 'I', &nbsp;</div></li><li><div>      chr(195).chr(141) =&gt; 'I', chr(195).chr(142) =&gt; 'I', &nbsp;</div></li><li><div>      chr(195).chr(143) =&gt; 'I', chr(195).chr(145) =&gt; 'N', &nbsp;</div></li><li><div>      chr(195).chr(146) =&gt; 'O', chr(195).chr(147) =&gt; 'O', &nbsp;</div></li><li><div>      chr(195).chr(148) =&gt; 'O', chr(195).chr(149) =&gt; 'O', &nbsp;</div></li><li><div>      chr(195).chr(150) =&gt; 'O', chr(195).chr(153) =&gt; 'U', &nbsp;</div></li><li><div>      chr(195).chr(154) =&gt; 'U', chr(195).chr(155) =&gt; 'U', &nbsp;</div></li><li><div>      chr(195).chr(156) =&gt; 'U', chr(195).chr(157) =&gt; 'Y', &nbsp;</div></li><li><div>      chr(195).chr(159) =&gt; 's', chr(195).chr(160) =&gt; 'a', &nbsp;</div></li><li><div>      chr(195).chr(161) =&gt; 'a', chr(195).chr(162) =&gt; 'a', &nbsp;</div></li><li><div>      chr(195).chr(163) =&gt; 'a', chr(195).chr(164) =&gt; 'a', &nbsp;</div></li><li><div>      chr(195).chr(165) =&gt; 'a', chr(195).chr(167) =&gt; 'c', &nbsp;</div></li><li><div>      chr(195).chr(168) =&gt; 'e', chr(195).chr(169) =&gt; 'e', &nbsp;</div></li><li><div>      chr(195).chr(170) =&gt; 'e', chr(195).chr(171) =&gt; 'e', &nbsp;</div></li><li><div>      chr(195).chr(172) =&gt; 'i', chr(195).chr(173) =&gt; 'i', &nbsp;</div></li><li><div>      chr(195).chr(174) =&gt; 'i', chr(195).chr(175) =&gt; 'i', &nbsp;</div></li><li><div>      chr(195).chr(177) =&gt; 'n', chr(195).chr(178) =&gt; 'o', &nbsp;</div></li><li><div>      chr(195).chr(179) =&gt; 'o', chr(195).chr(180) =&gt; 'o', &nbsp;</div></li><li><div>      chr(195).chr(181) =&gt; 'o', chr(195).chr(182) =&gt; 'o', &nbsp;</div></li><li><div>      chr(195).chr(182) =&gt; 'o', chr(195).chr(185) =&gt; 'u', &nbsp;</div></li><li><div>      chr(195).chr(186) =&gt; 'u', chr(195).chr(187) =&gt; 'u', &nbsp;</div></li><li><div>      chr(195).chr(188) =&gt; 'u', chr(195).chr(189) =&gt; 'y', &nbsp;</div></li><li><div>      chr(195).chr(191) =&gt; 'y', &nbsp;</div></li><li><div>      <span class="comment">// Decompositions for Latin Extended-A</span>&nbsp;</div></li><li><div>      chr(196).chr(128) =&gt; 'A', chr(196).chr(129) =&gt; 'a', &nbsp;</div></li><li><div>      chr(196).chr(130) =&gt; 'A', chr(196).chr(131) =&gt; 'a', &nbsp;</div></li><li><div>      chr(196).chr(132) =&gt; 'A', chr(196).chr(133) =&gt; 'a', &nbsp;</div></li><li><div>      chr(196).chr(134) =&gt; 'C', chr(196).chr(135) =&gt; 'c', &nbsp;</div></li><li><div>      chr(196).chr(136) =&gt; 'C', chr(196).chr(137) =&gt; 'c', &nbsp;</div></li><li><div>      chr(196).chr(138) =&gt; 'C', chr(196).chr(139) =&gt; 'c', &nbsp;</div></li><li><div>      chr(196).chr(140) =&gt; 'C', chr(196).chr(141) =&gt; 'c', &nbsp;</div></li><li><div>      chr(196).chr(142) =&gt; 'D', chr(196).chr(143) =&gt; 'd', &nbsp;</div></li><li><div>      chr(196).chr(144) =&gt; 'D', chr(196).chr(145) =&gt; 'd', &nbsp;</div></li><li><div>      chr(196).chr(146) =&gt; 'E', chr(196).chr(147) =&gt; 'e', &nbsp;</div></li><li><div>      chr(196).chr(148) =&gt; 'E', chr(196).chr(149) =&gt; 'e', &nbsp;</div></li><li><div>      chr(196).chr(150) =&gt; 'E', chr(196).chr(151) =&gt; 'e', &nbsp;</div></li><li><div>      chr(196).chr(152) =&gt; 'E', chr(196).chr(153) =&gt; 'e', &nbsp;</div></li><li><div>      chr(196).chr(154) =&gt; 'E', chr(196).chr(155) =&gt; 'e', &nbsp;</div></li><li><div>      chr(196).chr(156) =&gt; 'G', chr(196).chr(157) =&gt; 'g', &nbsp;</div></li><li><div>      chr(196).chr(158) =&gt; 'G', chr(196).chr(159) =&gt; 'g', &nbsp;</div></li><li><div>      chr(196).chr(160) =&gt; 'G', chr(196).chr(161) =&gt; 'g', &nbsp;</div></li><li><div>      chr(196).chr(162) =&gt; 'G', chr(196).chr(163) =&gt; 'g', &nbsp;</div></li><li><div>      chr(196).chr(164) =&gt; 'H', chr(196).chr(165) =&gt; 'h', &nbsp;</div></li><li><div>      chr(196).chr(166) =&gt; 'H', chr(196).chr(167) =&gt; 'h', &nbsp;</div></li><li><div>      chr(196).chr(168) =&gt; 'I', chr(196).chr(169) =&gt; 'i', &nbsp;</div></li><li><div>      chr(196).chr(170) =&gt; 'I', chr(196).chr(171) =&gt; 'i', &nbsp;</div></li><li><div>      chr(196).chr(172) =&gt; 'I', chr(196).chr(173) =&gt; 'i', &nbsp;</div></li><li><div>      chr(196).chr(174) =&gt; 'I', chr(196).chr(175) =&gt; 'i', &nbsp;</div></li><li><div>      chr(196).chr(176) =&gt; 'I', chr(196).chr(177) =&gt; 'i', &nbsp;</div></li><li><div>      chr(196).chr(178) =&gt; 'IJ', chr(196).chr(179) =&gt; 'ij', &nbsp;</div></li><li><div>      chr(196).chr(180) =&gt; 'J', chr(196).chr(181) =&gt; 'j', &nbsp;</div></li><li><div>      chr(196).chr(182) =&gt; 'K', chr(196).chr(183) =&gt; 'k', &nbsp;</div></li><li><div>      chr(196).chr(184) =&gt; 'k', chr(196).chr(185) =&gt; 'L', &nbsp;</div></li><li><div>      chr(196).chr(186) =&gt; 'l', chr(196).chr(187) =&gt; 'L', &nbsp;</div></li><li><div>      chr(196).chr(188) =&gt; 'l', chr(196).chr(189) =&gt; 'L', &nbsp;</div></li><li><div>      chr(196).chr(190) =&gt; 'l', chr(196).chr(191) =&gt; 'L', &nbsp;</div></li><li><div>      chr(197).chr(128) =&gt; 'l', chr(197).chr(129) =&gt; 'L', &nbsp;</div></li><li><div>      chr(197).chr(130) =&gt; 'l', chr(197).chr(131) =&gt; 'N', &nbsp;</div></li><li><div>      chr(197).chr(132) =&gt; 'n', chr(197).chr(133) =&gt; 'N', &nbsp;</div></li><li><div>      chr(197).chr(134) =&gt; 'n', chr(197).chr(135) =&gt; 'N', &nbsp;</div></li><li><div>      chr(197).chr(136) =&gt; 'n', chr(197).chr(137) =&gt; 'N', &nbsp;</div></li><li><div>      chr(197).chr(138) =&gt; 'n', chr(197).chr(139) =&gt; 'N', &nbsp;</div></li><li><div>      chr(197).chr(140) =&gt; 'O', chr(197).chr(141) =&gt; 'o', &nbsp;</div></li><li><div>      chr(197).chr(142) =&gt; 'O', chr(197).chr(143) =&gt; 'o', &nbsp;</div></li><li><div>      chr(197).chr(144) =&gt; 'O', chr(197).chr(145) =&gt; 'o', &nbsp;</div></li><li><div>      chr(197).chr(146) =&gt; 'OE', chr(197).chr(147) =&gt; 'oe', &nbsp;</div></li><li><div>      chr(197).chr(148) =&gt; 'R', chr(197).chr(149) =&gt; 'r', &nbsp;</div></li><li><div>      chr(197).chr(150) =&gt; 'R', chr(197).chr(151) =&gt; 'r', &nbsp;</div></li><li><div>      chr(197).chr(152) =&gt; 'R', chr(197).chr(153) =&gt; 'r', &nbsp;</div></li><li><div>      chr(197).chr(154) =&gt; 'S', chr(197).chr(155) =&gt; 's', &nbsp;</div></li><li><div>      chr(197).chr(156) =&gt; 'S', chr(197).chr(157) =&gt; 's', &nbsp;</div></li><li><div>      chr(197).chr(158) =&gt; 'S', chr(197).chr(159) =&gt; 's', &nbsp;</div></li><li><div>      chr(197).chr(160) =&gt; 'S', chr(197).chr(161) =&gt; 's', &nbsp;</div></li><li><div>      chr(197).chr(162) =&gt; 'T', chr(197).chr(163) =&gt; 't', &nbsp;</div></li><li><div>      chr(197).chr(164) =&gt; 'T', chr(197).chr(165) =&gt; 't', &nbsp;</div></li><li><div>      chr(197).chr(166) =&gt; 'T', chr(197).chr(167) =&gt; 't', &nbsp;</div></li><li><div>      chr(197).chr(168) =&gt; 'U', chr(197).chr(169) =&gt; 'u', &nbsp;</div></li><li><div>      chr(197).chr(170) =&gt; 'U', chr(197).chr(171) =&gt; 'u', &nbsp;</div></li><li><div>      chr(197).chr(172) =&gt; 'U', chr(197).chr(173) =&gt; 'u', &nbsp;</div></li><li><div>      chr(197).chr(174) =&gt; 'U', chr(197).chr(175) =&gt; 'u', &nbsp;</div></li><li><div>      chr(197).chr(176) =&gt; 'U', chr(197).chr(177) =&gt; 'u', &nbsp;</div></li><li><div>      chr(197).chr(178) =&gt; 'U', chr(197).chr(179) =&gt; 'u', &nbsp;</div></li><li><div>      chr(197).chr(180) =&gt; 'W', chr(197).chr(181) =&gt; 'w', &nbsp;</div></li><li><div>      chr(197).chr(182) =&gt; 'Y', chr(197).chr(183) =&gt; 'y', &nbsp;</div></li><li><div>      chr(197).chr(184) =&gt; 'Y', chr(197).chr(185) =&gt; 'Z', &nbsp;</div></li><li><div>      chr(197).chr(186) =&gt; 'z', chr(197).chr(187) =&gt; 'Z', &nbsp;</div></li><li><div>      chr(197).chr(188) =&gt; 'z', chr(197).chr(189) =&gt; 'Z', &nbsp;</div></li><li><div>      chr(197).chr(190) =&gt; 'z', chr(197).chr(191) =&gt; 's', &nbsp;</div></li><li><div>      <span class="comment">// Euro Sign</span>&nbsp;</div></li><li><div>      chr(226).chr(130).chr(172) =&gt; 'E', &nbsp;</div></li><li><div>      <span class="comment">// GBP (Pound) Sign</span>&nbsp;</div></li><li><div>      chr(194).chr(163) =&gt; '');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $string = strtr($string, $chars);&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Assume ISO-8859-1 if not UTF-8</span>&nbsp;</div></li><li><div>      $chars['in'] = chr(128).chr(131).chr(138).chr(142).chr(154).chr(158)&nbsp;</div></li><li><div>          .chr(159).chr(162).chr(165).chr(181).chr(192).chr(193).chr(194)&nbsp;</div></li><li><div>          .chr(195).chr(196).chr(197).chr(199).chr(200).chr(201).chr(202)&nbsp;</div></li><li><div>          .chr(203).chr(204).chr(205).chr(206).chr(207).chr(209).chr(210)&nbsp;</div></li><li><div>          .chr(211).chr(212).chr(213).chr(214).chr(216).chr(217).chr(218)&nbsp;</div></li><li><div>          .chr(219).chr(220).chr(221).chr(224).chr(225).chr(226).chr(227)&nbsp;</div></li><li><div>          .chr(228).chr(229).chr(231).chr(232).chr(233).chr(234).chr(235)&nbsp;</div></li><li><div>          .chr(236).chr(237).chr(238).chr(239).chr(241).chr(242).chr(243)&nbsp;</div></li><li><div>          .chr(244).chr(245).chr(246).chr(248).chr(249).chr(250).chr(251)&nbsp;</div></li><li><div>          .chr(252).chr(253).chr(255);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $chars['out'] = &quot;EfSZszYcYuAAAAAACEEEEIIIINOOOOOOUUUUYaaaaaaceeeeiiiinoooooouuuuyy&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $string = strtr($string, $chars['in'], $chars['out']);&nbsp;</div></li><li><div>      $double_chars['in'] = array(chr(140), chr(156), chr(198), chr(208), chr(222), chr(223), chr(230), chr(240), chr(254));&nbsp;</div></li><li><div>      $double_chars['out'] = array('OE', 'oe', 'AE', 'DH', 'TH', 'ss', 'ae', 'dh', 'th');&nbsp;</div></li><li><div>      $string = str_replace($double_chars['in'], $double_chars['out'], $string);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $string;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function sanitize_file_name()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('sanitize_user') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sanitize username stripping out unsafe characters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If $strict is true, only alphanumeric characters (as well as _, space, ., -, </span>&nbsp;</div></li><li><div><span class="comment"> * @) are returned.</span>&nbsp;</div></li><li><div><span class="comment"> * Removes tags, octets, entities, and if strict is enabled, will remove all</span>&nbsp;</div></li><li><div><span class="comment"> * non-ASCII characters. After sanitizing, it passes the username, raw username</span>&nbsp;</div></li><li><div><span class="comment"> * (the username in the parameter), and the strict parameter as parameters for</span>&nbsp;</div></li><li><div><span class="comment"> * the filter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() Calls 'sanitize_user' hook on username, raw username, </span>&nbsp;</div></li><li><div><span class="comment"> *        and $strict parameter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $username The username to be sanitized.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $strict If set limits $username to specific characters. Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The sanitized username, after passing through filters.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function sanitize_user( $username, $strict = false ) {&nbsp;</div></li><li><div>  $raw_username = $username;&nbsp;</div></li><li><div>  $username = wp_strip_all_tags($username);&nbsp;</div></li><li><div>  <span class="comment">// Kill octets</span>&nbsp;</div></li><li><div>  $username = preg_replace('|%([a-fA-F0-9][a-fA-F0-9])|', '', $username);&nbsp;</div></li><li><div>  $username = preg_replace('/&.+?;/', '', $username); <span class="comment">// Kill entities</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If strict, reduce to ASCII for max portability.</span>&nbsp;</div></li><li><div>  if ( $strict )&nbsp;</div></li><li><div>      $username = preg_replace('|[^a-z0-9 _.\-@]|i', '', $username);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Consolidate contiguous whitespace</span>&nbsp;</div></li><li><div>  $username = preg_replace('|\s+|', ' ', $username);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters('sanitize_user', $username, $raw_username, $strict);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('sanitize_title') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sanitizes title or use fallback title.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Specifically, HTML and PHP tags are stripped. Further actions can be added</span>&nbsp;</div></li><li><div><span class="comment"> * via the plugin API. If $title is empty and $fallback_title is set, the latter</span>&nbsp;</div></li><li><div><span class="comment"> * will be used.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $title The string to be sanitized.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $fallback_title Optional. A title to use if $title is empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The sanitized string.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function sanitize_title($title, $fallback_title = '') {&nbsp;</div></li><li><div>  $raw_title = $title;&nbsp;</div></li><li><div>  $title = strip_tags($title);&nbsp;</div></li><li><div>  $title = apply_filters('sanitize_title', $title, $raw_title);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' === $title || false === $title )&nbsp;</div></li><li><div>      $title = $fallback_title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $title;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('sanitize_title_with_dashes') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sanitizes title, replacing whitespace with dashes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Limits the output to alphanumeric characters, underscore (_) and dash (-).</span>&nbsp;</div></li><li><div><span class="comment"> * Whitespace becomes a dash.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $title The title to be sanitized.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The sanitized title.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function sanitize_title_with_dashes($title) {&nbsp;</div></li><li><div>  $title = strip_tags($title);&nbsp;</div></li><li><div>  <span class="comment">// Preserve escaped octets.</span>&nbsp;</div></li><li><div>  $title = preg_replace('|%([a-fA-F0-9][a-fA-F0-9])|', '---$1---', $title);&nbsp;</div></li><li><div>  <span class="comment">// Remove percent signs that are not part of an octet.</span>&nbsp;</div></li><li><div>  $title = str_replace('%', '', $title);&nbsp;</div></li><li><div>  <span class="comment">// Restore octets.</span>&nbsp;</div></li><li><div>  $title = preg_replace('|---([a-fA-F0-9][a-fA-F0-9])---|', '%$1', $title);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $title = remove_accents($title);&nbsp;</div></li><li><div>  if (seems_utf8($title)) {&nbsp;</div></li><li><div>      if (function_exists('mb_strtolower')) {&nbsp;</div></li><li><div>          $title = mb_strtolower($title, 'UTF-8');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $title = utf8_uri_encode($title, 200);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $title = strtolower($title);&nbsp;</div></li><li><div>  $title = preg_replace('/&.+?;/', '', $title); <span class="comment">// kill entities</span>&nbsp;</div></li><li><div>  $title = str_replace('.', '-', $title);&nbsp;</div></li><li><div>  $title = preg_replace('/[^%a-z0-9 _-]/', '', $title);&nbsp;</div></li><li><div>  $title = preg_replace('/\s+/', '-', $title);&nbsp;</div></li><li><div>  $title = preg_replace('|-+|', '-', $title);&nbsp;</div></li><li><div>  $title = trim($title, '-');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $title;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function sanitize_sql_orderby()</span>&nbsp;</div></li><li><div><span class="comment">// ! function sanitize_html_class()</span>&nbsp;</div></li><li><div><span class="comment">// ! function convert_chars()</span>&nbsp;</div></li><li><div><span class="comment">// ! function funky_javascript_callback()</span>&nbsp;</div></li><li><div><span class="comment">// ! function funky_javascript_fix()</span>&nbsp;</div></li><li><div><span class="comment">// ! function balanceTags()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'force_balance_tags' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Balances tags of string using a modified stack.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.4</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @author Leonard Lin &lt;leonard@acm.org&gt;</span>&nbsp;</div></li><li><div><span class="comment"> * @license GPL v2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @copyright November 4, 2001</span>&nbsp;</div></li><li><div><span class="comment"> * @version 1.1</span>&nbsp;</div></li><li><div><span class="comment"> * @todo Make better - change loop condition to $text in 1.2</span>&nbsp;</div></li><li><div><span class="comment"> * @internal Modified by Scott Reilly (coffee2code) 02 Aug 2004</span>&nbsp;</div></li><li><div><span class="comment"> *        1.1  Fixed handling of append/stack pop order of end text</span>&nbsp;</div></li><li><div><span class="comment"> *             Added Cleaning Hooks</span>&nbsp;</div></li><li><div><span class="comment"> *        1.0  First Version</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text Text to be balanced.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Balanced text.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function force_balance_tags( $text ) {&nbsp;</div></li><li><div>  $tagstack = array(); $stacksize = 0; $tagqueue = ''; $newtext = '';&nbsp;</div></li><li><div>  $single_tags = array('br', 'hr', 'img', 'input'); <span class="comment">//Known single-entity/self-closing tags</span>&nbsp;</div></li><li><div>  $nestable_tags = array('blockquote', 'div', 'span'); <span class="comment">//Tags that can be immediately nested within themselves</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  # WP bug fix for comments - in case you REALLY meant to type '&lt; !--'&nbsp;</div></li><li><div>  $text = str_replace('&lt; !--', '&lt;    !--', $text);&nbsp;</div></li><li><div>  # WP bug fix for LOVE &lt;3 (and other situations with '&lt;' before a number)&nbsp;</div></li><li><div>  $text = preg_replace('#&lt;([0-9]{1})#', '&lt;$1', $text);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  while (preg_match(&quot;/&lt;(\/?\w*)\s*([^&gt;]*)&gt;/&quot;, $text, $regex)) {&nbsp;</div></li><li><div>      $newtext .= $tagqueue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $i = strpos($text, $regex[0]);&nbsp;</div></li><li><div>      $l = strlen($regex[0]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// clear the shifter</span>&nbsp;</div></li><li><div>      $tagqueue = '';&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Pop</span> or Push</span>&nbsp;</div></li><li><div>      if ( isset($regex[1][0]) && '/' == $regex[1][0] ) { <span class="comment">// End Tag</span>&nbsp;</div></li><li><div>          $tag = strtolower(substr($regex[1], 1));&nbsp;</div></li><li><div>          <span class="comment">// if too many closing tags</span>&nbsp;</div></li><li><div>          if($stacksize &lt;= 0) {&nbsp;</div></li><li><div>              $tag = '';&nbsp;</div></li><li><div>              <span class="comment">//or close to be safe $tag = '/' . $tag;</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// if stacktop value = tag close value then pop</span>&nbsp;</div></li><li><div>          else if ($tagstack[$stacksize - 1] == $tag) { <span class="comment">// found closing tag</span>&nbsp;</div></li><li><div>              $tag = '&lt;/' . $tag . '&gt;'; <span class="comment">// Close Tag</span>&nbsp;</div></li><li><div>              <span class="comment">// Pop</span>&nbsp;</div></li><li><div>              array_pop ($tagstack);&nbsp;</div></li><li><div>              $stacksize--;&nbsp;</div></li><li><div>          } else { <span class="comment">// closing tag not at top, search for it</span>&nbsp;</div></li><li><div>              for ($j=$stacksize-1;$j&gt;=0;$j--) {&nbsp;</div></li><li><div>                  if ($tagstack[$j] == $tag) {&nbsp;</div></li><li><div>                  <span class="comment">// add tag to tagqueue</span>&nbsp;</div></li><li><div>                      for ($k=$stacksize-1;$k&gt;=$j;$k--) {&nbsp;</div></li><li><div>                          $tagqueue .= '&lt;/' . array_pop ($tagstack) . '&gt;';&nbsp;</div></li><li><div>                          $stacksize--;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $tag = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else { <span class="comment">// Begin Tag</span>&nbsp;</div></li><li><div>          $tag = strtolower($regex[1]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Tag Cleaning</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If self-closing or '', don't do anything.</span>&nbsp;</div></li><li><div>          if((substr($regex[2], -1) == '/') || ($tag == '')) {&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// ElseIf it's a known single-entity tag but it doesn't close itself, do so</span>&nbsp;</div></li><li><div>          elseif ( in_array($tag, $single_tags) ) {&nbsp;</div></li><li><div>              $regex[2] .= '/';&nbsp;</div></li><li><div>          } else {    <span class="comment">// Push the tag onto the stack</span>&nbsp;</div></li><li><div>              <span class="comment">// If the top of the stack is the same as the tag we want to push, close previous tag</span>&nbsp;</div></li><li><div>              if (($stacksize &gt; 0) && !in_array($tag, $nestable_tags) && ($tagstack[$stacksize - 1] == $tag)) {&nbsp;</div></li><li><div>                  $tagqueue = '&lt;/' . array_pop ($tagstack) . '&gt;';&nbsp;</div></li><li><div>                  $stacksize--;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $stacksize = array_push ($tagstack, $tag);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Attributes</span>&nbsp;</div></li><li><div>          $attributes = $regex[2];&nbsp;</div></li><li><div>          if($attributes) {&nbsp;</div></li><li><div>              $attributes = ' '.$attributes;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $tag = '&lt;'.$tag.$attributes.'&gt;';&nbsp;</div></li><li><div>          <span class="comment">//If already queuing a close tag, then put this tag on, too</span>&nbsp;</div></li><li><div>          if ($tagqueue) {&nbsp;</div></li><li><div>              $tagqueue .= $tag;&nbsp;</div></li><li><div>              $tag = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $newtext .= substr($text, 0, $i) . $tag;&nbsp;</div></li><li><div>      $text = substr($text, $i+$l);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Clear Tag Queue</span>&nbsp;</div></li><li><div>  $newtext .= $tagqueue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add Remaining text</span>&nbsp;</div></li><li><div>  $newtext .= $text;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Empty Stack</span>&nbsp;</div></li><li><div>  while($x = array_pop($tagstack)) {&nbsp;</div></li><li><div>      $newtext .= '&lt;/' . $x . '&gt;'; <span class="comment">// Add remaining tags to close</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// WP fix for the bug with HTML comments</span>&nbsp;</div></li><li><div>  $newtext = str_replace(&quot;&lt; !--&quot;, &quot;&lt;!--&quot;, $newtext);&nbsp;</div></li><li><div>  $newtext = str_replace(&quot;&lt;    !--&quot;, &quot;&lt; !--&quot;, $newtext);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $newtext;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('format_to_edit') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Acts on text which is about to be edited.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Unless $richedit is set, it is simply a holder for the 'format_to_edit'</span>&nbsp;</div></li><li><div><span class="comment"> * filter. If $richedit is set true htmlspecialchars() will be run on the</span>&nbsp;</div></li><li><div><span class="comment"> * content, converting special characters to HTMl entities.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.71</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $content The text about to be edited.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $richedit Whether or not the $content should pass through htmlspecialchars(). Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The text after the filter (and possibly htmlspecialchars()) has been run.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function format_to_edit($content, $richedit = false) {&nbsp;</div></li><li><div>  $content = apply_filters('format_to_edit', $content);&nbsp;</div></li><li><div>  if (! $richedit )&nbsp;</div></li><li><div>      $content = htmlspecialchars($content);&nbsp;</div></li><li><div>  return $content;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// !format_to_post()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'zeroise' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add leading zeros when necessary.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If you set the threshold to '4' and the number is '10', then you will get</span>&nbsp;</div></li><li><div><span class="comment"> * back '0010'. If you set the number to '4' and the number is '5000', then you</span>&nbsp;</div></li><li><div><span class="comment"> * will get back '5000'.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Uses sprintf to append the amount of zeros based on the $threshold parameter</span>&nbsp;</div></li><li><div><span class="comment"> * and the size of the number. If the number is large enough, then no zeros will</span>&nbsp;</div></li><li><div><span class="comment"> * be appended.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.71</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $number Number to append zeros to if not greater than threshold.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $threshold Digit places number needs to be to not have zeros added.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Adds leading zeros to number if needed.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function zeroise($number, $threshold) {&nbsp;</div></li><li><div>  return sprintf('%0'.$threshold.'s', $number);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'backslashit' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds backslashes before letters and before a number at the start of a string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.71</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $string Value to which backslashes will be added.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string String with backslashes inserted.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function backslashit($string) {&nbsp;</div></li><li><div>  $string = preg_replace('/^([0-9])/', '\\\\\\\\\1', $string);&nbsp;</div></li><li><div>  $string = preg_replace('/([a-z])/i', '\\\\\1', $string);&nbsp;</div></li><li><div>  return $string;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'trailingslashit' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Appends a trailing slash.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Will remove trailing slash if it exists already before adding a trailing</span>&nbsp;</div></li><li><div><span class="comment"> * slash. This prevents double slashing a string or path.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The primary use of this is for paths and thus should be used for paths. It is</span>&nbsp;</div></li><li><div><span class="comment"> * not restricted to paths and offers no specific path support.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @uses untrailingslashit() Unslashes string if it was slashed already.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $string What to add the trailing slash to.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string String with trailing slash added.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function trailingslashit($string) {&nbsp;</div></li><li><div>  return untrailingslashit($string) . '/';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'untrailingslashit' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Removes trailing slash if it exists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The primary use of this is for paths and thus should be used for paths. It is</span>&nbsp;</div></li><li><div><span class="comment"> * not restricted to paths and offers no specific path support.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $string What to remove the trailing slash from.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string String without the trailing slash.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function untrailingslashit($string) {&nbsp;</div></li><li><div>  return rtrim($string, '/');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function addslashes_gpc()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('stripslashes_deep') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Navigates through an array and removes slashes from the values.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If an array is passed, the array_map() function causes a callback to pass the</span>&nbsp;</div></li><li><div><span class="comment"> * value back to the function. The slashes from this value will removed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $value The array or string to be striped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|string Stripped array (or string in the callback).</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function stripslashes_deep($value) {&nbsp;</div></li><li><div>  $value = is_array($value) ? array_map('stripslashes_deep', $value) : stripslashes($value);&nbsp;</div></li><li><div>  return $value;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'urlencode_deep' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Navigates through an array and encodes the values to be used in a URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Uses a callback to pass the value of the array back to the function as a</span>&nbsp;</div></li><li><div><span class="comment"> * string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $value The array or string to be encoded.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|string $value The encoded array (or string from the callback).</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function urlencode_deep($value) {&nbsp;</div></li><li><div>  $value = is_array($value) ? array_map('urlencode_deep', $value) : urlencode($value);&nbsp;</div></li><li><div>  return $value;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function antispambot()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( '_make_url_clickable_cb' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Callback to convert URI match to HTML A element.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function was backported from 2.5.0 to 2.3.2. Regex callback for {@link</span>&nbsp;</div></li><li><div><span class="comment"> * make_clickable()}.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.3.2</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $matches Single Regex Match.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string HTML A element with URI address.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _make_url_clickable_cb($matches) {&nbsp;</div></li><li><div>  $url = $matches[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $url = esc_url($url);&nbsp;</div></li><li><div>  if ( empty($url) )&nbsp;</div></li><li><div>      return $matches[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $matches[1] . &quot;&lt;a href=\&quot;$url\&quot; rel=\&quot;nofollow\&quot;&gt;$url&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( '_make_web_ftp_clickable_cb' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Callback to convert URL match to HTML A element.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function was backported from 2.5.0 to 2.3.2. Regex callback for {@link</span>&nbsp;</div></li><li><div><span class="comment"> * make_clickable()}.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.3.2</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $matches Single Regex Match.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string HTML A element with URL address.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _make_web_ftp_clickable_cb($matches) {&nbsp;</div></li><li><div>  $ret = '';&nbsp;</div></li><li><div>  $dest = $matches[2];&nbsp;</div></li><li><div>  $dest = 'http:<span class="comment">//' . $dest;</span>&nbsp;</div></li><li><div>  $dest = esc_url($dest);&nbsp;</div></li><li><div>  if ( empty($dest) )&nbsp;</div></li><li><div>      return $matches[0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// removed trailing [., ;:)] from URL</span>&nbsp;</div></li><li><div>  if ( in_array( substr($dest, -1), array('.', ', ', ';', ':', ')') ) === true ) {&nbsp;</div></li><li><div>      $ret = substr($dest, -1);&nbsp;</div></li><li><div>      $dest = substr($dest, 0, strlen($dest)-1);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $matches[1] . &quot;&lt;a href=\&quot;$dest\&quot; rel=\&quot;nofollow\&quot;&gt;$dest&lt;/a&gt;$ret&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( '_make_email_clickable_cb' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Callback to convert email address match to HTML A element.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This function was backported from 2.5.0 to 2.3.2. Regex callback for {@link</span>&nbsp;</div></li><li><div><span class="comment"> * make_clickable()}.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.3.2</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $matches Single Regex Match.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string HTML A element with email address.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _make_email_clickable_cb($matches) {&nbsp;</div></li><li><div>  $email = $matches[2] . '@' . $matches[3];&nbsp;</div></li><li><div>  return $matches[1] . &quot;&lt;a href=\&quot;mailto:$email\&quot;&gt;$email&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'make_clickable' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Convert plaintext URI to HTML links.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Converts URI, www and ftp, and email addresses. Finishes by fixing links</span>&nbsp;</div></li><li><div><span class="comment"> * within links.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.71</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $ret Content to convert URIs.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Content with converted URIs.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function make_clickable($ret) {&nbsp;</div></li><li><div>  $ret = ' ' . $ret;&nbsp;</div></li><li><div>  <span class="comment">// in testing, using arrays here was found to be faster</span>&nbsp;</div></li><li><div>  $ret = preg_replace_callback('#(?&lt;=[\s&gt;])(\()?([\w]+?:<span class="comment">//(?:[\w\\x80-\\xff\#$%&~/=?@\[\](+-]|[., ;:](?![\s&lt;]|(\))?([\s]|$))|(?(1)\)(?![\s&lt;., ;:]|$)|\)))+)#is', '_make_url_clickable_cb', $ret);</span>&nbsp;</div></li><li><div>  $ret = preg_replace_callback('#([\s&gt;])((www|ftp)\.[\w\\x80-\\xff\#$%&~/.\-;:=, ?@\[\]+]+)#is', '_make_web_ftp_clickable_cb', $ret);&nbsp;</div></li><li><div>  $ret = preg_replace_callback('#([\s&gt;])([.0-9a-z_+-]+)@(([0-9a-z-]+\.)+[0-9a-z]{2, })#i', '_make_email_clickable_cb', $ret);&nbsp;</div></li><li><div>  <span class="comment">// this one is not in an array because we need it to run last, for cleanup of accidental links within links</span>&nbsp;</div></li><li><div>  $ret = preg_replace(&quot;#(&lt;a( [^&gt;]+?&gt;|&gt;))&lt;a [^&gt;]+?&gt;([^&gt;]+?)&lt;/a&gt;&lt;/a&gt;#i&quot;, &quot;$1$3&lt;/a&gt;&quot;, $ret);&nbsp;</div></li><li><div>  $ret = trim($ret);&nbsp;</div></li><li><div>  return $ret;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function wp_rel_nofollow()</span>&nbsp;</div></li><li><div><span class="comment">// ! function wp_rel_nofollow_callback()</span>&nbsp;</div></li><li><div><span class="comment">// ! function translate_smiley()</span>&nbsp;</div></li><li><div><span class="comment">// ! function convert_smilies()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('is_email') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Verifies that an email is valid.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Does not grok i18n domains. Not RFC compliant.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 0.71</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $email Email address to verify.</span>&nbsp;</div></li><li><div><span class="comment"> * @param boolean $check_dns Whether to check the DNS for the domain using checkdnsrr().</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|bool Either false or the valid email address.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_email( $email, $check_dns = false ) {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Test for the minimum length the email can be</span></span>&nbsp;</div></li><li><div>  if ( strlen( $email ) &lt; 3 ) {&nbsp;</div></li><li><div>      return apply_filters( 'is_email', false, $email, 'email_too_short' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Test for an @ character after the first position</span></span>&nbsp;</div></li><li><div>  if ( strpos( $email, '@', 1 ) === false ) {&nbsp;</div></li><li><div>      return apply_filters( 'is_email', false, $email, 'email_no_at' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Split out the local and domain parts</span></span>&nbsp;</div></li><li><div>  list( $local, $domain ) = explode( '@', $email, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// LOCAL PART</span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Test for invalid characters</span></span></span></span>&nbsp;</div></li><li><div>  if ( !preg_match( '/^[a-zA-Z0-9!#$%&\'*+\/=?^_`{|}~\.-]+$/', $local ) ) {&nbsp;</div></li><li><div>      return apply_filters( 'is_email', false, $email, 'local_invalid_chars' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// DOMAIN PART</span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Test for sequences of periods</span></span>&nbsp;</div></li><li><div>  if ( preg_match( '/\.{2, }/', $domain ) ) {&nbsp;</div></li><li><div>      return apply_filters( 'is_email', false, $email, 'domain_period_sequence' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Test for leading and trailing periods and whitespace</span></span>&nbsp;</div></li><li><div>  if ( trim( $domain, &quot; \t\n\r\0\x0B.&quot; ) !== $domain ) {&nbsp;</div></li><li><div>      return apply_filters( 'is_email', false, $email, 'domain_period_limits' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Split the domain into subs</span></span>&nbsp;</div></li><li><div>  $subs = explode( '.', $domain );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Assume the domain will have at least two subs</span></span>&nbsp;</div></li><li><div>  if ( 2 &gt; count( $subs ) ) {&nbsp;</div></li><li><div>      return apply_filters( 'is_email', false, $email, 'domain_no_periods' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Loop through each sub</span></span>&nbsp;</div></li><li><div>  foreach ( $subs as $sub ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Test for leading and trailing hyphens</span> and whitespace</span>&nbsp;</div></li><li><div>      if ( trim( $sub, &quot; \t\n\r\0\x0B-&quot; ) !== $sub ) {&nbsp;</div></li><li><div>          return apply_filters( 'is_email', false, $email, 'sub_hyphen_limits' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Test for invalid characters</span></span></span></span>&nbsp;</div></li><li><div>      if ( !preg_match('/^[a-z0-9-]+$/i', $sub ) ) {&nbsp;</div></li><li><div>          return apply_filters( 'is_email', false, $email, 'sub_invalid_chars' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// DNS</span>&nbsp;</div></li><li><div>  <span class="comment">// Check the domain has a valid MX and A resource record</span>&nbsp;</div></li><li><div>  if ( $check_dns && function_exists( 'checkdnsrr' ) && !( checkdnsrr( $domain . '.', 'MX' ) || checkdnsrr( $domain . '.', 'A' ) ) ) {&nbsp;</div></li><li><div>      return apply_filters( 'is_email', false, $email, 'dns_no_rr' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Congratulations your email made it!</span></span>&nbsp;</div></li><li><div>  return apply_filters( 'is_email', $email, $email, null );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function wp_iso_descrambler()</span>&nbsp;</div></li><li><div><span class="comment">// ! function get_gmt_from_date()</span>&nbsp;</div></li><li><div><span class="comment">// ! function get_date_from_gmt()</span>&nbsp;</div></li><li><div><span class="comment">// ! function iso8601_timezone_to_offset()</span>&nbsp;</div></li><li><div><span class="comment">// ! function iso8601_to_datetime()</span>&nbsp;</div></li><li><div><span class="comment">// ! popuplinks()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('sanitize_email') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Strips out all characters that are not allowable in an email.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $email Email address to filter.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Filtered email address.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function sanitize_email( $email ) {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Test for the minimum length the email can be</span></span>&nbsp;</div></li><li><div>  if ( strlen( $email ) &lt; 3 ) {&nbsp;</div></li><li><div>      return apply_filters( 'sanitize_email', '', $email, 'email_too_short' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Test for an @ character after the first position</span></span>&nbsp;</div></li><li><div>  if ( strpos( $email, '@', 1 ) === false ) {&nbsp;</div></li><li><div>      return apply_filters( 'sanitize_email', '', $email, 'email_no_at' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Split out the local and domain parts</span></span>&nbsp;</div></li><li><div>  list( $local, $domain ) = explode( '@', $email, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// LOCAL PART</span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Test for invalid characters</span></span></span></span>&nbsp;</div></li><li><div>  $local = preg_replace( '/[^a-zA-Z0-9!#$%&\'*+\/=?^_`{|}~\.-]/', '', $local );&nbsp;</div></li><li><div>  if ( '' === $local ) {&nbsp;</div></li><li><div>      return apply_filters( 'sanitize_email', '', $email, 'local_invalid_chars' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// DOMAIN PART</span></span>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Test for sequences of periods</span></span>&nbsp;</div></li><li><div>  $domain = preg_replace( '/\.{2, }/', '', $domain );&nbsp;</div></li><li><div>  if ( '' === $domain ) {&nbsp;</div></li><li><div>      return apply_filters( 'sanitize_email', '', $email, 'domain_period_sequence' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Test for leading and trailing periods and whitespace</span></span>&nbsp;</div></li><li><div>  $domain = trim( $domain, &quot; \t\n\r\0\x0B.&quot; );&nbsp;</div></li><li><div>  if ( '' === $domain ) {&nbsp;</div></li><li><div>      return apply_filters( 'sanitize_email', '', $email, 'domain_period_limits' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Split the domain into subs</span></span>&nbsp;</div></li><li><div>  $subs = explode( '.', $domain );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Assume the domain will have at least two subs</span></span>&nbsp;</div></li><li><div>  if ( 2 &gt; count( $subs ) ) {&nbsp;</div></li><li><div>      return apply_filters( 'sanitize_email', '', $email, 'domain_no_periods' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Create an array that will contain valid subs</span>&nbsp;</div></li><li><div>  $new_subs = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Loop through each sub</span></span>&nbsp;</div></li><li><div>  foreach ( $subs as $sub ) {&nbsp;</div></li><li><div>      <span class="comment">// Test for leading and trailing hyphens</span>&nbsp;</div></li><li><div>      $sub = trim( $sub, &quot; \t\n\r\0\x0B-&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Test for invalid characters</span></span></span></span>&nbsp;</div></li><li><div>      $sub = preg_replace( '/^[^a-z0-9-]+$/i', '', $sub );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If there's anything left, add it to the valid subs</span>&nbsp;</div></li><li><div>      if ( '' !== $sub ) {&nbsp;</div></li><li><div>          $new_subs[] = $sub;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If there aren't 2 or more valid subs</span>&nbsp;</div></li><li><div>  if ( 2 &gt; count( $new_subs ) ) {&nbsp;</div></li><li><div>      return apply_filters( 'sanitize_email', '', $email, 'domain_no_valid_subs' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Join valid subs into the new domain</span>&nbsp;</div></li><li><div>  $domain = join( '.', $new_subs );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Put the email back together</span>&nbsp;</div></li><li><div>  $email = $local . '@' . $domain;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Congratulations your email made it!</span></span>&nbsp;</div></li><li><div>  return apply_filters( 'sanitize_email', $email, $email, null );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function human_time_diff()</span>&nbsp;</div></li><li><div><span class="comment">// ! function wp_trim_excerpt()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'ent2ncr' ) ) : <span class="comment">// Current at [WP9840]</span>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Converts named entities into numbered entities.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.1</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text The text within which entities will be converted.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Text with converted entities.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function ent2ncr($text) {&nbsp;</div></li><li><div>  $to_ncr = array(&nbsp;</div></li><li><div>      '&quot;' =&gt; '&#34;', &nbsp;</div></li><li><div>      '&amp;' =&gt; '&#38;', &nbsp;</div></li><li><div>      '&frasl;' =&gt; '&#47;', &nbsp;</div></li><li><div>      '&lt;' =&gt; '&#60;', &nbsp;</div></li><li><div>      '&gt;' =&gt; '&#62;', &nbsp;</div></li><li><div>      '|' =&gt; '&#124;', &nbsp;</div></li><li><div>      '&nbsp;' =&gt; '&#160;', &nbsp;</div></li><li><div>      '&iexcl;' =&gt; '&#161;', &nbsp;</div></li><li><div>      '&cent;' =&gt; '&#162;', &nbsp;</div></li><li><div>      '&pound;' =&gt; '&#163;', &nbsp;</div></li><li><div>      '&curren;' =&gt; '&#164;', &nbsp;</div></li><li><div>      '&yen;' =&gt; '&#165;', &nbsp;</div></li><li><div>      '&brvbar;' =&gt; '&#166;', &nbsp;</div></li><li><div>      '&brkbar;' =&gt; '&#166;', &nbsp;</div></li><li><div>      '&sect;' =&gt; '&#167;', &nbsp;</div></li><li><div>      '&uml;' =&gt; '&#168;', &nbsp;</div></li><li><div>      '&die;' =&gt; '&#168;', &nbsp;</div></li><li><div>      '&copy;' =&gt; '&#169;', &nbsp;</div></li><li><div>      '&ordf;' =&gt; '&#170;', &nbsp;</div></li><li><div>      '&laquo;' =&gt; '&#171;', &nbsp;</div></li><li><div>      '&not;' =&gt; '&#172;', &nbsp;</div></li><li><div>      '&shy;' =&gt; '&#173;', &nbsp;</div></li><li><div>      '&reg;' =&gt; '&#174;', &nbsp;</div></li><li><div>      '&macr;' =&gt; '&#175;', &nbsp;</div></li><li><div>      '&hibar;' =&gt; '&#175;', &nbsp;</div></li><li><div>      '&deg;' =&gt; '&#176;', &nbsp;</div></li><li><div>      '&plusmn;' =&gt; '&#177;', &nbsp;</div></li><li><div>      '&sup2;' =&gt; '&#178;', &nbsp;</div></li><li><div>      '&sup3;' =&gt; '&#179;', &nbsp;</div></li><li><div>      '&acute;' =&gt; '&#180;', &nbsp;</div></li><li><div>      '&micro;' =&gt; '&#181;', &nbsp;</div></li><li><div>      '&para;' =&gt; '&#182;', &nbsp;</div></li><li><div>      '&middot;' =&gt; '&#183;', &nbsp;</div></li><li><div>      '&cedil;' =&gt; '&#184;', &nbsp;</div></li><li><div>      '&sup1;' =&gt; '&#185;', &nbsp;</div></li><li><div>      '&ordm;' =&gt; '&#186;', &nbsp;</div></li><li><div>      '&raquo;' =&gt; '&#187;', &nbsp;</div></li><li><div>      '&frac14;' =&gt; '&#188;', &nbsp;</div></li><li><div>      '&frac12;' =&gt; '&#189;', &nbsp;</div></li><li><div>      '&frac34;' =&gt; '&#190;', &nbsp;</div></li><li><div>      '&iquest;' =&gt; '&#191;', &nbsp;</div></li><li><div>      '&Agrave;' =&gt; '&#192;', &nbsp;</div></li><li><div>      '&Aacute;' =&gt; '&#193;', &nbsp;</div></li><li><div>      '&Acirc;' =&gt; '&#194;', &nbsp;</div></li><li><div>      '&Atilde;' =&gt; '&#195;', &nbsp;</div></li><li><div>      '&Auml;' =&gt; '&#196;', &nbsp;</div></li><li><div>      '&Aring;' =&gt; '&#197;', &nbsp;</div></li><li><div>      '&AElig;' =&gt; '&#198;', &nbsp;</div></li><li><div>      '&Ccedil;' =&gt; '&#199;', &nbsp;</div></li><li><div>      '&Egrave;' =&gt; '&#200;', &nbsp;</div></li><li><div>      '&Eacute;' =&gt; '&#201;', &nbsp;</div></li><li><div>      '&Ecirc;' =&gt; '&#202;', &nbsp;</div></li><li><div>      '&Euml;' =&gt; '&#203;', &nbsp;</div></li><li><div>      '&Igrave;' =&gt; '&#204;', &nbsp;</div></li><li><div>      '&Iacute;' =&gt; '&#205;', &nbsp;</div></li><li><div>      '&Icirc;' =&gt; '&#206;', &nbsp;</div></li><li><div>      '&Iuml;' =&gt; '&#207;', &nbsp;</div></li><li><div>      '&ETH;' =&gt; '&#208;', &nbsp;</div></li><li><div>      '&Ntilde;' =&gt; '&#209;', &nbsp;</div></li><li><div>      '&Ograve;' =&gt; '&#210;', &nbsp;</div></li><li><div>      '&Oacute;' =&gt; '&#211;', &nbsp;</div></li><li><div>      '&Ocirc;' =&gt; '&#212;', &nbsp;</div></li><li><div>      '&Otilde;' =&gt; '&#213;', &nbsp;</div></li><li><div>      '&Ouml;' =&gt; '&#214;', &nbsp;</div></li><li><div>      '&times;' =&gt; '&#215;', &nbsp;</div></li><li><div>      '&Oslash;' =&gt; '&#216;', &nbsp;</div></li><li><div>      '&Ugrave;' =&gt; '&#217;', &nbsp;</div></li><li><div>      '&Uacute;' =&gt; '&#218;', &nbsp;</div></li><li><div>      '&Ucirc;' =&gt; '&#219;', &nbsp;</div></li><li><div>      '&Uuml;' =&gt; '&#220;', &nbsp;</div></li><li><div>      '&Yacute;' =&gt; '&#221;', &nbsp;</div></li><li><div>      '&THORN;' =&gt; '&#222;', &nbsp;</div></li><li><div>      '&szlig;' =&gt; '&#223;', &nbsp;</div></li><li><div>      '&agrave;' =&gt; '&#224;', &nbsp;</div></li><li><div>      '&aacute;' =&gt; '&#225;', &nbsp;</div></li><li><div>      '&acirc;' =&gt; '&#226;', &nbsp;</div></li><li><div>      '&atilde;' =&gt; '&#227;', &nbsp;</div></li><li><div>      '&auml;' =&gt; '&#228;', &nbsp;</div></li><li><div>      '&aring;' =&gt; '&#229;', &nbsp;</div></li><li><div>      '&aelig;' =&gt; '&#230;', &nbsp;</div></li><li><div>      '&ccedil;' =&gt; '&#231;', &nbsp;</div></li><li><div>      '&egrave;' =&gt; '&#232;', &nbsp;</div></li><li><div>      '&eacute;' =&gt; '&#233;', &nbsp;</div></li><li><div>      '&ecirc;' =&gt; '&#234;', &nbsp;</div></li><li><div>      '&euml;' =&gt; '&#235;', &nbsp;</div></li><li><div>      '&igrave;' =&gt; '&#236;', &nbsp;</div></li><li><div>      '&iacute;' =&gt; '&#237;', &nbsp;</div></li><li><div>      '&icirc;' =&gt; '&#238;', &nbsp;</div></li><li><div>      '&iuml;' =&gt; '&#239;', &nbsp;</div></li><li><div>      '&eth;' =&gt; '&#240;', &nbsp;</div></li><li><div>      '&ntilde;' =&gt; '&#241;', &nbsp;</div></li><li><div>      '&ograve;' =&gt; '&#242;', &nbsp;</div></li><li><div>      '&oacute;' =&gt; '&#243;', &nbsp;</div></li><li><div>      '&ocirc;' =&gt; '&#244;', &nbsp;</div></li><li><div>      '&otilde;' =&gt; '&#245;', &nbsp;</div></li><li><div>      '&ouml;' =&gt; '&#246;', &nbsp;</div></li><li><div>      '&divide;' =&gt; '&#247;', &nbsp;</div></li><li><div>      '&oslash;' =&gt; '&#248;', &nbsp;</div></li><li><div>      '&ugrave;' =&gt; '&#249;', &nbsp;</div></li><li><div>      '&uacute;' =&gt; '&#250;', &nbsp;</div></li><li><div>      '&ucirc;' =&gt; '&#251;', &nbsp;</div></li><li><div>      '&uuml;' =&gt; '&#252;', &nbsp;</div></li><li><div>      '&yacute;' =&gt; '&#253;', &nbsp;</div></li><li><div>      '&thorn;' =&gt; '&#254;', &nbsp;</div></li><li><div>      '&yuml;' =&gt; '&#255;', &nbsp;</div></li><li><div>      '&OElig;' =&gt; '&#338;', &nbsp;</div></li><li><div>      '&oelig;' =&gt; '&#339;', &nbsp;</div></li><li><div>      '&Scaron;' =&gt; '&#352;', &nbsp;</div></li><li><div>      '&scaron;' =&gt; '&#353;', &nbsp;</div></li><li><div>      '&Yuml;' =&gt; '&#376;', &nbsp;</div></li><li><div>      '&fnof;' =&gt; '&#402;', &nbsp;</div></li><li><div>      '&circ;' =&gt; '&#710;', &nbsp;</div></li><li><div>      '&tilde;' =&gt; '&#732;', &nbsp;</div></li><li><div>      '&Alpha;' =&gt; '&#913;', &nbsp;</div></li><li><div>      '&Beta;' =&gt; '&#914;', &nbsp;</div></li><li><div>      '&Gamma;' =&gt; '&#915;', &nbsp;</div></li><li><div>      '&Delta;' =&gt; '&#916;', &nbsp;</div></li><li><div>      '&Epsilon;' =&gt; '&#917;', &nbsp;</div></li><li><div>      '&Zeta;' =&gt; '&#918;', &nbsp;</div></li><li><div>      '&Eta;' =&gt; '&#919;', &nbsp;</div></li><li><div>      '&Theta;' =&gt; '&#920;', &nbsp;</div></li><li><div>      '&Iota;' =&gt; '&#921;', &nbsp;</div></li><li><div>      '&Kappa;' =&gt; '&#922;', &nbsp;</div></li><li><div>      '&Lambda;' =&gt; '&#923;', &nbsp;</div></li><li><div>      '&Mu;' =&gt; '&#924;', &nbsp;</div></li><li><div>      '&Nu;' =&gt; '&#925;', &nbsp;</div></li><li><div>      '&Xi;' =&gt; '&#926;', &nbsp;</div></li><li><div>      '&Omicron;' =&gt; '&#927;', &nbsp;</div></li><li><div>      '&Pi;' =&gt; '&#928;', &nbsp;</div></li><li><div>      '&Rho;' =&gt; '&#929;', &nbsp;</div></li><li><div>      '&Sigma;' =&gt; '&#931;', &nbsp;</div></li><li><div>      '&Tau;' =&gt; '&#932;', &nbsp;</div></li><li><div>      '&Upsilon;' =&gt; '&#933;', &nbsp;</div></li><li><div>      '&Phi;' =&gt; '&#934;', &nbsp;</div></li><li><div>      '&Chi;' =&gt; '&#935;', &nbsp;</div></li><li><div>      '&Psi;' =&gt; '&#936;', &nbsp;</div></li><li><div>      '&Omega;' =&gt; '&#937;', &nbsp;</div></li><li><div>      '&alpha;' =&gt; '&#945;', &nbsp;</div></li><li><div>      '&beta;' =&gt; '&#946;', &nbsp;</div></li><li><div>      '&gamma;' =&gt; '&#947;', &nbsp;</div></li><li><div>      '&delta;' =&gt; '&#948;', &nbsp;</div></li><li><div>      '&epsilon;' =&gt; '&#949;', &nbsp;</div></li><li><div>      '&zeta;' =&gt; '&#950;', &nbsp;</div></li><li><div>      '&eta;' =&gt; '&#951;', &nbsp;</div></li><li><div>      '&theta;' =&gt; '&#952;', &nbsp;</div></li><li><div>      '&iota;' =&gt; '&#953;', &nbsp;</div></li><li><div>      '&kappa;' =&gt; '&#954;', &nbsp;</div></li><li><div>      '&lambda;' =&gt; '&#955;', &nbsp;</div></li><li><div>      '&mu;' =&gt; '&#956;', &nbsp;</div></li><li><div>      '&nu;' =&gt; '&#957;', &nbsp;</div></li><li><div>      '&xi;' =&gt; '&#958;', &nbsp;</div></li><li><div>      '&omicron;' =&gt; '&#959;', &nbsp;</div></li><li><div>      '&pi;' =&gt; '&#960;', &nbsp;</div></li><li><div>      '&rho;' =&gt; '&#961;', &nbsp;</div></li><li><div>      '&sigmaf;' =&gt; '&#962;', &nbsp;</div></li><li><div>      '&sigma;' =&gt; '&#963;', &nbsp;</div></li><li><div>      '&tau;' =&gt; '&#964;', &nbsp;</div></li><li><div>      '&upsilon;' =&gt; '&#965;', &nbsp;</div></li><li><div>      '&phi;' =&gt; '&#966;', &nbsp;</div></li><li><div>      '&chi;' =&gt; '&#967;', &nbsp;</div></li><li><div>      '&psi;' =&gt; '&#968;', &nbsp;</div></li><li><div>      '&omega;' =&gt; '&#969;', &nbsp;</div></li><li><div>      '&thetasym;' =&gt; '&#977;', &nbsp;</div></li><li><div>      '&upsih;' =&gt; '&#978;', &nbsp;</div></li><li><div>      '&piv;' =&gt; '&#982;', &nbsp;</div></li><li><div>      '&ensp;' =&gt; '&#8194;', &nbsp;</div></li><li><div>      '&emsp;' =&gt; '&#8195;', &nbsp;</div></li><li><div>      '&thinsp;' =&gt; '&#8201;', &nbsp;</div></li><li><div>      '&zwnj;' =&gt; '&#8204;', &nbsp;</div></li><li><div>      '&zwj;' =&gt; '&#8205;', &nbsp;</div></li><li><div>      '&lrm;' =&gt; '&#8206;', &nbsp;</div></li><li><div>      '&rlm;' =&gt; '&#8207;', &nbsp;</div></li><li><div>      '&ndash;' =&gt; '&#8211;', &nbsp;</div></li><li><div>      '&mdash;' =&gt; '&#8212;', &nbsp;</div></li><li><div>      '&lsquo;' =&gt; '&#8216;', &nbsp;</div></li><li><div>      '&rsquo;' =&gt; '&#8217;', &nbsp;</div></li><li><div>      '&sbquo;' =&gt; '&#8218;', &nbsp;</div></li><li><div>      '&ldquo;' =&gt; '&#8220;', &nbsp;</div></li><li><div>      '&rdquo;' =&gt; '&#8221;', &nbsp;</div></li><li><div>      '&bdquo;' =&gt; '&#8222;', &nbsp;</div></li><li><div>      '&dagger;' =&gt; '&#8224;', &nbsp;</div></li><li><div>      '&Dagger;' =&gt; '&#8225;', &nbsp;</div></li><li><div>      '&bull;' =&gt; '&#8226;', &nbsp;</div></li><li><div>      '&hellip;' =&gt; '&#8230;', &nbsp;</div></li><li><div>      '&permil;' =&gt; '&#8240;', &nbsp;</div></li><li><div>      '&prime;' =&gt; '&#8242;', &nbsp;</div></li><li><div>      '&Prime;' =&gt; '&#8243;', &nbsp;</div></li><li><div>      '&lsaquo;' =&gt; '&#8249;', &nbsp;</div></li><li><div>      '&rsaquo;' =&gt; '&#8250;', &nbsp;</div></li><li><div>      '&oline;' =&gt; '&#8254;', &nbsp;</div></li><li><div>      '&frasl;' =&gt; '&#8260;', &nbsp;</div></li><li><div>      '&euro;' =&gt; '&#8364;', &nbsp;</div></li><li><div>      '&image;' =&gt; '&#8465;', &nbsp;</div></li><li><div>      '&weierp;' =&gt; '&#8472;', &nbsp;</div></li><li><div>      '&real;' =&gt; '&#8476;', &nbsp;</div></li><li><div>      '&trade;' =&gt; '&#8482;', &nbsp;</div></li><li><div>      '&alefsym;' =&gt; '&#8501;', &nbsp;</div></li><li><div>      '&crarr;' =&gt; '&#8629;', &nbsp;</div></li><li><div>      '&lArr;' =&gt; '&#8656;', &nbsp;</div></li><li><div>      '&uArr;' =&gt; '&#8657;', &nbsp;</div></li><li><div>      '&rArr;' =&gt; '&#8658;', &nbsp;</div></li><li><div>      '&dArr;' =&gt; '&#8659;', &nbsp;</div></li><li><div>      '&hArr;' =&gt; '&#8660;', &nbsp;</div></li><li><div>      '&forall;' =&gt; '&#8704;', &nbsp;</div></li><li><div>      '&part;' =&gt; '&#8706;', &nbsp;</div></li><li><div>      '&exist;' =&gt; '&#8707;', &nbsp;</div></li><li><div>      '&empty;' =&gt; '&#8709;', &nbsp;</div></li><li><div>      '&nabla;' =&gt; '&#8711;', &nbsp;</div></li><li><div>      '&isin;' =&gt; '&#8712;', &nbsp;</div></li><li><div>      '&notin;' =&gt; '&#8713;', &nbsp;</div></li><li><div>      '&ni;' =&gt; '&#8715;', &nbsp;</div></li><li><div>      '&prod;' =&gt; '&#8719;', &nbsp;</div></li><li><div>      '&sum;' =&gt; '&#8721;', &nbsp;</div></li><li><div>      '&minus;' =&gt; '&#8722;', &nbsp;</div></li><li><div>      '&lowast;' =&gt; '&#8727;', &nbsp;</div></li><li><div>      '&radic;' =&gt; '&#8730;', &nbsp;</div></li><li><div>      '&prop;' =&gt; '&#8733;', &nbsp;</div></li><li><div>      '&infin;' =&gt; '&#8734;', &nbsp;</div></li><li><div>      '&ang;' =&gt; '&#8736;', &nbsp;</div></li><li><div>      '&and;' =&gt; '&#8743;', &nbsp;</div></li><li><div>      '&or;' =&gt; '&#8744;', &nbsp;</div></li><li><div>      '&cap;' =&gt; '&#8745;', &nbsp;</div></li><li><div>      '&cup;' =&gt; '&#8746;', &nbsp;</div></li><li><div>      '&int;' =&gt; '&#8747;', &nbsp;</div></li><li><div>      '&there4;' =&gt; '&#8756;', &nbsp;</div></li><li><div>      '&sim;' =&gt; '&#8764;', &nbsp;</div></li><li><div>      '&cong;' =&gt; '&#8773;', &nbsp;</div></li><li><div>      '&asymp;' =&gt; '&#8776;', &nbsp;</div></li><li><div>      '&ne;' =&gt; '&#8800;', &nbsp;</div></li><li><div>      '&equiv;' =&gt; '&#8801;', &nbsp;</div></li><li><div>      '&le;' =&gt; '&#8804;', &nbsp;</div></li><li><div>      '&ge;' =&gt; '&#8805;', &nbsp;</div></li><li><div>      '&sub;' =&gt; '&#8834;', &nbsp;</div></li><li><div>      '&sup;' =&gt; '&#8835;', &nbsp;</div></li><li><div>      '&nsub;' =&gt; '&#8836;', &nbsp;</div></li><li><div>      '&sube;' =&gt; '&#8838;', &nbsp;</div></li><li><div>      '&supe;' =&gt; '&#8839;', &nbsp;</div></li><li><div>      '&oplus;' =&gt; '&#8853;', &nbsp;</div></li><li><div>      '&otimes;' =&gt; '&#8855;', &nbsp;</div></li><li><div>      '&perp;' =&gt; '&#8869;', &nbsp;</div></li><li><div>      '&sdot;' =&gt; '&#8901;', &nbsp;</div></li><li><div>      '&lceil;' =&gt; '&#8968;', &nbsp;</div></li><li><div>      '&rceil;' =&gt; '&#8969;', &nbsp;</div></li><li><div>      '&lfloor;' =&gt; '&#8970;', &nbsp;</div></li><li><div>      '&rfloor;' =&gt; '&#8971;', &nbsp;</div></li><li><div>      '&lang;' =&gt; '&#9001;', &nbsp;</div></li><li><div>      '&rang;' =&gt; '&#9002;', &nbsp;</div></li><li><div>      '&larr;' =&gt; '&#8592;', &nbsp;</div></li><li><div>      '&uarr;' =&gt; '&#8593;', &nbsp;</div></li><li><div>      '&rarr;' =&gt; '&#8594;', &nbsp;</div></li><li><div>      '&darr;' =&gt; '&#8595;', &nbsp;</div></li><li><div>      '&harr;' =&gt; '&#8596;', &nbsp;</div></li><li><div>      '&loz;' =&gt; '&#9674;', &nbsp;</div></li><li><div>      '&spades;' =&gt; '&#9824;', &nbsp;</div></li><li><div>      '&clubs;' =&gt; '&#9827;', &nbsp;</div></li><li><div>      '&hearts;' =&gt; '&#9829;', &nbsp;</div></li><li><div>      '&diams;' =&gt; '&#9830;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return str_replace( array_keys($to_ncr), array_values($to_ncr), $text );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function wp_richedit_pre()</span>&nbsp;</div></li><li><div><span class="comment">// ! function wp_htmledit_pre()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('clean_url') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks and cleans a URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * A number of characters are removed from the URL. If the URL is for displaying</span>&nbsp;</div></li><li><div><span class="comment"> * (the default behaviour) amperstands are also replaced. The 'esc_url' filter</span>&nbsp;</div></li><li><div><span class="comment"> * is applied to the returned cleaned URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_kses_bad_protocol() To only permit protocols in the URL set</span>&nbsp;</div></li><li><div><span class="comment"> *        via $protocols or the common ones set in the function.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $url The URL to be cleaned.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $protocols Optional. An array of acceptable protocols.</span>&nbsp;</div></li><li><div><span class="comment"> *        Defaults to 'http', 'https', 'ftp', 'ftps', 'mailto', 'news', 'irc', 'gopher', 'nntp', 'feed', 'telnet', 'mms', 'rtsp', 'svn' if not set.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $context Optional. How the URL will be used. Default is 'display'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The cleaned $url after the 'cleaned_url' filter is applied.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function clean_url( $url, $protocols = null, $context = 'display' ) {&nbsp;</div></li><li><div>  $original_url = $url;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' == $url )&nbsp;</div></li><li><div>      return $url;&nbsp;</div></li><li><div>  $url = preg_replace('|[^a-z0-9-~+_.?#=!&;, /:%@$\|*\'()\\x80-\\xff]|i', '', $url);&nbsp;</div></li><li><div>  $strip = array('%0d', '%0a', '%0D', '%0A');&nbsp;</div></li><li><div>  $url = _deep_replace($strip, $url);&nbsp;</div></li><li><div>  $url = str_replace(';<span class="comment">//', '://', $url);</span>&nbsp;</div></li><li><div>  <span class="comment">/** If the URL doesn't appear to contain a scheme, we</span>&nbsp;</div></li><li><div><span class="comment">   * presume it needs http:// appended (unless a relative</span>&nbsp;</div></li><li><div><span class="comment">   * link starting with / or a php file).</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( strpos($url, ':') === false &&&nbsp;</div></li><li><div>      substr( $url, 0, 1 ) != '/' && substr( $url, 0, 1 ) != '#' && !preg_match('/^[a-z0-9-]+?\.php/i', $url) )&nbsp;</div></li><li><div>      $url = 'http:<span class="comment">//' . $url;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Replace ampersands and single quotes only when displaying.</span>&nbsp;</div></li><li><div>  if ( 'display' == $context ) {&nbsp;</div></li><li><div>      $url = wp_kses_normalize_entities( $url );&nbsp;</div></li><li><div>      $url = str_replace( '&amp;', '&#038;', $url );&nbsp;</div></li><li><div>      $url = str_replace( &quot;'&quot;, '&#039;', $url );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !is_array($protocols) )&nbsp;</div></li><li><div>      $protocols = array ('http', 'https', 'ftp', 'ftps', 'mailto', 'news', 'irc', 'gopher', 'nntp', 'feed', 'telnet', 'mms', 'rtsp', 'svn');&nbsp;</div></li><li><div>  if ( wp_kses_bad_protocol( $url, $protocols ) != $url )&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters('clean_url', $url, $original_url, $context);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( '_deep_replace' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Perform a deep string replace operation to ensure the values in $search are no longer present</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Repeats the replacement operation until it no longer replaces anything so as to remove &quot;nested&quot; values</span>&nbsp;</div></li><li><div><span class="comment"> * e.g. $subject = '%0%0%0DDD', $search ='%0D', $result ='' rather than the '%0%0DD' that</span>&nbsp;</div></li><li><div><span class="comment"> * str_replace would return</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.1</span>&nbsp;</div></li><li><div><span class="comment"> * @access private</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $search</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $subject</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The processed string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _deep_replace($search, $subject) {&nbsp;</div></li><li><div>  $found = true;&nbsp;</div></li><li><div>  while($found) {&nbsp;</div></li><li><div>      $found = false;&nbsp;</div></li><li><div>      foreach( (array) $search as $val ) {&nbsp;</div></li><li><div>          while(strpos($subject, $val) !== false) {&nbsp;</div></li><li><div>              $found = true;&nbsp;</div></li><li><div>              $subject = str_replace($val, '', $subject);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $subject;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'esc_sql' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Escapes data for use in a MySQL query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This is just a handy shortcut for $bpdb-&gt;escape(), for completeness' sake</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $sql Unescaped SQL data</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The cleaned $sql</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function esc_sql( $sql ) {&nbsp;</div></li><li><div>  global $bpdb;&nbsp;</div></li><li><div>  return $bpdb-&gt;escape( $sql );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'esc_url' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks and cleans a URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * A number of characters are removed from the URL. If the URL is for displaying</span>&nbsp;</div></li><li><div><span class="comment"> * (the default behaviour) amperstands are also replaced. The 'esc_url' filter</span>&nbsp;</div></li><li><div><span class="comment"> * is applied to the returned cleaned URL.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @uses esc_url()</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_kses_bad_protocol() To only permit protocols in the URL set</span>&nbsp;</div></li><li><div><span class="comment"> *        via $protocols or the common ones set in the function.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $url The URL to be cleaned.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $protocols Optional. An array of acceptable protocols.</span>&nbsp;</div></li><li><div><span class="comment"> *        Defaults to 'http', 'https', 'ftp', 'ftps', 'mailto', 'news', 'irc', 'gopher', 'nntp', 'feed', 'telnet' if not set.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The cleaned $url after the 'cleaned_url' filter is applied.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function esc_url( $url, $protocols = null ) {&nbsp;</div></li><li><div>  return clean_url( $url, $protocols, 'display' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'esc_url_raw' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Performs esc_url() for database usage.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see esc_url()</span>&nbsp;</div></li><li><div><span class="comment"> * @see esc_url()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $url The URL to be cleaned.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $protocols An array of acceptable protocols.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The cleaned URL.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function esc_url_raw( $url, $protocols = null ) {&nbsp;</div></li><li><div>  return clean_url( $url, $protocols, 'db' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function sanitize_url()</span>&nbsp;</div></li><li><div><span class="comment">// ! function htmlentities2()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'esc_js' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Escape single quotes, htmlspecialchar &quot; &lt; &gt; &, and fix line endings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Escapes text strings for echoing in JS, both inline (for example in onclick=&quot;...&quot;)</span>&nbsp;</div></li><li><div><span class="comment"> * and inside &lt;script&gt; tag. Note that the strings have to be in single quotes.</span>&nbsp;</div></li><li><div><span class="comment"> * The filter 'js_escape' is also applied here.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text The text to be escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Escaped text.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function esc_js( $text ) {&nbsp;</div></li><li><div>  $safe_text = wp_check_invalid_utf8( $text );&nbsp;</div></li><li><div>  $safe_text = _wp_specialchars( $safe_text, ENT_COMPAT );&nbsp;</div></li><li><div>  $safe_text = preg_replace( '/&#(x)?0*(?(1)27|39);?/i', &quot;'&quot;, stripslashes( $safe_text ) );&nbsp;</div></li><li><div>  $safe_text = str_replace( &quot;\r&quot;, '', $safe_text );&nbsp;</div></li><li><div>  $safe_text = str_replace( &quot;\n&quot;, '\\n', addslashes( $safe_text ) );&nbsp;</div></li><li><div>  return apply_filters( 'js_escape', $safe_text, $text );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'js_escape' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Escape single quotes, specialchar double quotes, and fix line endings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The filter 'js_escape' is also applied by esc_js()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.4</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @see esc_js()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text The text to be escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Escaped text.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function js_escape( $text ) {&nbsp;</div></li><li><div>  return esc_js( $text );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'esc_html' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Escaping for HTML blocks.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function esc_html( $text ) {&nbsp;</div></li><li><div>  $safe_text = wp_check_invalid_utf8( $text );&nbsp;</div></li><li><div>  $safe_text = _wp_specialchars( $safe_text, ENT_QUOTES );&nbsp;</div></li><li><div>  return apply_filters( 'esc_html', $safe_text, $text );&nbsp;</div></li><li><div>  return $text;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'wp_specialchars' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Escaping for HTML blocks</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @see esc_html()</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_specialchars( $string, $quote_style = ENT_NOQUOTES, $charset = false, $double_encode = false ) {&nbsp;</div></li><li><div>  if ( func_num_args() &gt; 1 ) { <span class="comment">// Maintain backwards compat for people passing additional args</span>&nbsp;</div></li><li><div>      $args = func_get_args();&nbsp;</div></li><li><div>      return call_user_func_array( '_wp_specialchars', $args );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return esc_html( $string );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'esc_attr' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Escaping for HTML attributes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function esc_attr( $text ) {&nbsp;</div></li><li><div>  $safe_text = wp_check_invalid_utf8( $text );&nbsp;</div></li><li><div>  $safe_text = _wp_specialchars( $safe_text, ENT_QUOTES );&nbsp;</div></li><li><div>  return apply_filters( 'attribute_escape', $safe_text, $text );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists( 'attribute_escape' ) ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Escaping for HTML attributes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.6</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @deprecated 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> * @see esc_attr()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function attribute_escape( $text ) {&nbsp;</div></li><li><div>  return esc_attr( $text );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function tag_escape()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('like_escape') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Escapes text for SQL LIKE special characters % and _.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text The text to be escaped.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string text, safe for inclusion in LIKE query.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function like_escape($text) {&nbsp;</div></li><li><div>  return addcslashes($text, '\\%_');&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function wp_make_link_relative()</span>&nbsp;</div></li><li><div><span class="comment">// ! function sanitize_option()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_parse_str') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Parses a string into variables to be stored in an array.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Uses {@link http://www.php.net/parse_str parse_str()} and stripslashes if</span>&nbsp;</div></li><li><div><span class="comment"> * {@link http://www.php.net/magic_quotes magic_quotes_gpc} is on.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2.1</span>&nbsp;</div></li><li><div><span class="comment"> * @uses apply_filters() for the 'wp_parse_str' filter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $string The string to be parsed.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $array Variables will be stored in this array.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_parse_str( $string, &$array ) {&nbsp;</div></li><li><div>  parse_str( $string, $array );&nbsp;</div></li><li><div>  if ( get_magic_quotes_gpc() )&nbsp;</div></li><li><div>      $array = stripslashes_deep( $array );&nbsp;</div></li><li><div>  $array = apply_filters( 'wp_parse_str', $array );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_pre_kses_less_than') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Convert lone less than signs.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * KSES already converts lone greater than signs.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses wp_pre_kses_less_than_callback in the callback function.</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $text Text to be converted.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Converted text.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_pre_kses_less_than( $text ) {&nbsp;</div></li><li><div>  return preg_replace_callback('%&lt;[^&gt;]*?((?=&lt;)|&gt;|$)%', 'wp_pre_kses_less_than_callback', $text);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>if ( !function_exists('wp_pre_kses_less_than_callback') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Callback function used by preg_replace.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @uses esc_html to format the $matches text.</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $matches Populated by matches to preg_replace.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The text returned after esc_html if needed.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_pre_kses_less_than_callback( $matches ) {&nbsp;</div></li><li><div>  if ( false === strpos($matches[0], '&gt;') )&nbsp;</div></li><li><div>      return esc_html($matches[0]);&nbsp;</div></li><li><div>  return $matches[0];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div><span class="comment">// ! function wp_sprintf()</span>&nbsp;</div></li><li><div><span class="comment">// ! function wp_sprintf_l()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_html_excerpt') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Safely extracts not more than the first $count characters from html string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * UTF-8, tags and entities safe prefix extraction. Entities inside will *NOT*</span>&nbsp;</div></li><li><div><span class="comment"> * be counted as one character. For example &amp; will be counted as 4, &lt; as</span>&nbsp;</div></li><li><div><span class="comment"> * 3, etc.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param integer $str String to get the excerpt from.</span>&nbsp;</div></li><li><div><span class="comment"> * @param integer $count Maximum number of characters to take.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The excerpt.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_html_excerpt( $str, $count ) {&nbsp;</div></li><li><div>  $str = wp_strip_all_tags( $str, true );&nbsp;</div></li><li><div>  $str = mb_substr( $str, 0, $count );&nbsp;</div></li><li><div>  <span class="comment">// remove part of an entity at the end</span>&nbsp;</div></li><li><div>  $str = preg_replace( '/&[^;\s]{0, 6}$/', '', $str );&nbsp;</div></li><li><div>  return $str;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// ! function links_add_base_url()</span>&nbsp;</div></li><li><div><span class="comment">// ! function _links_add_base()</span>&nbsp;</div></li><li><div><span class="comment">// ! function links_add_target()</span>&nbsp;</div></li><li><div><span class="comment">// ! function _links_add_target()</span>&nbsp;</div></li><li><div><span class="comment">// ! function normalize_whitespace()</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('wp_strip_all_tags') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Properly strip all HTML tags including script and style</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $string String containing HTML tags</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $remove_breaks optional Whether to remove left over line breaks and white space chars</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The processed string.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function wp_strip_all_tags($string, $remove_breaks = false) {&nbsp;</div></li><li><div>  $string = preg_replace( '@&lt;(script|style)[^&gt;]*?&gt;.*?&lt;/\\1&gt;@si', '', $string );&nbsp;</div></li><li><div>  $string = strip_tags($string);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $remove_breaks )&nbsp;</div></li><li><div>      $string = preg_replace('/[\r\n\t ]+/', ' ', $string);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return trim($string);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !function_exists('sanitize_text_field') ) :&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sanitize a string from user input or from the db</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * check for invalid UTF-8, </span>&nbsp;</div></li><li><div><span class="comment"> * Convert single &lt; characters to entity, </span>&nbsp;</div></li><li><div><span class="comment"> * strip all tags, </span>&nbsp;</div></li><li><div><span class="comment"> * remove line breaks, tabs and extra whitre space, </span>&nbsp;</div></li><li><div><span class="comment"> * strip octets.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.9</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $str</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function sanitize_text_field($str) {&nbsp;</div></li><li><div>  $filtered = wp_check_invalid_utf8( $str );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( strpos($filtered, '&lt;') !== false ) {&nbsp;</div></li><li><div>      $filtered = wp_pre_kses_less_than( $filtered );&nbsp;</div></li><li><div>      <span class="comment">// This will strip extra whitespace for us.</span>&nbsp;</div></li><li><div>      $filtered = wp_strip_all_tags( $filtered, true );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $filtered = trim( preg_replace('/[\r\n\t ]+/', ' ', $filtered) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $match = array();&nbsp;</div></li><li><div>  $found = false;&nbsp;</div></li><li><div>  while ( preg_match('/%[a-f0-9]{2}/i', $filtered, $match) ) {&nbsp;</div></li><li><div>      $filtered = str_replace($match[0], '', $filtered);&nbsp;</div></li><li><div>      $found = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $found ) {&nbsp;</div></li><li><div>      <span class="comment">// Strip out the whitespace that may now exist after removing the octets.</span>&nbsp;</div></li><li><div>      $filtered = trim( preg_replace('/ +/', ' ', $filtered) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters('sanitize_text_field', $filtered, $str);&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif;&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2019 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>