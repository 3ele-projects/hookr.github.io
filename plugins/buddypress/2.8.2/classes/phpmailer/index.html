<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.8.2" data-slug="buddypress" data-type="class" data-id="2838"><head xmlns="http://www.w3.org/1999/xhtml"><title> phpmailer | class | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="PHPMailer, class, plugin, buddypress, 2.8.2" /><meta name="description" content="PHPMailer - PHP email creation and transport class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.14"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=3e34c133eeb9bd85e50cf523ab135535' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.14' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/phpmailer/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fphpmailer%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fphpmailer%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.2-class-phpmailer","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="phpmailer" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/buddypress/2.8.2/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">phpmailer</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.2/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.2/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.2/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="active" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.2/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>PHPMailer</strong></h1><p>PHPMailer - PHP email creation and transport class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/buddypress/2.8.2/files/bp-forums-bbpress-bb-includes-backpress-class-mailer/" class="file">/bp-forums/bbpress/bb-includes/backpress/class.mailer.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="36" class="block" start="36"><li><div>class PHPMailer {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // PROPERTIES, PUBLIC&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Email priority (1 = High, 3 = Normal, 5 = low).&nbsp;</div></li><li><div>   * @var int&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Priority = 3;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the CharSet of the message.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $CharSet = 'iso-8859-1';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the Content-type of the message.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $ContentType = 'text/plain';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the Encoding of the message. Options for this are &quot;8bit&quot;, &nbsp;</div></li><li><div>   * &quot;7bit&quot;, &quot;binary&quot;, &quot;base64&quot;, and &quot;quoted-printable&quot;.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Encoding = '8bit';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Holds the most recent mailer error message.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $ErrorInfo = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the From email address for the message.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $From = 'root@localhost';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the From name of the message.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $FromName = 'Root User';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the Sender email (Return-Path) of the message.  If not empty, &nbsp;</div></li><li><div>   * will be sent via -f to sendmail or as 'MAIL FROM' in smtp mode.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Sender = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the Subject of the message.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Subject = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the Body of the message.  This can be either an HTML or text body.&nbsp;</div></li><li><div>   * If HTML then run IsHTML(true).&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Body = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the text-only body of the message.  This automatically sets the&nbsp;</div></li><li><div>   * email to multipart/alternative.  This body can be read by mail&nbsp;</div></li><li><div>   * clients that do not have HTML email capability such as mutt. Clients&nbsp;</div></li><li><div>   * that can read HTML will view the normal Body.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $AltBody = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets word wrapping on the body of the message to a given number of&nbsp;</div></li><li><div>   * characters.&nbsp;</div></li><li><div>   * @var int&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $WordWrap = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Method to send mail: (&quot;mail&quot;, &quot;sendmail&quot;, or &quot;smtp&quot;).&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Mailer = 'mail';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the path of the sendmail program.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Sendmail = '/usr/sbin/sendmail';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Path to PHPMailer plugins.  This is now only useful if the SMTP class&nbsp;</div></li><li><div>   * is in a different directory than the PHP include path.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $PluginDir = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Holds PHPMailer version.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Version = &quot;2.0.4&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the email address that a reading confirmation will be sent.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $ConfirmReadingTo = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the hostname to use in Message-Id and Received headers&nbsp;</div></li><li><div>   * and as default HELO string. If empty, the value returned&nbsp;</div></li><li><div>   * by SERVER_NAME is used or 'localhost.localdomain'.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Hostname = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the message ID to be used in the Message-Id header.&nbsp;</div></li><li><div>   * If empty, a unique id will be generated.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $MessageID = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // PROPERTIES FOR SMTP&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the SMTP hosts.  All hosts must be separated by a&nbsp;</div></li><li><div>   * semicolon.  You can also specify a different port&nbsp;</div></li><li><div>   * for each host by using this format: [hostname:port]&nbsp;</div></li><li><div>   * (e.g. &quot;smtp1.example.com:25;smtp2.example.com&quot;).&nbsp;</div></li><li><div>   * Hosts will be tried in order.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Host = 'localhost';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the default SMTP server port.&nbsp;</div></li><li><div>   * @var int&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Port = 25;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the SMTP HELO of the message (Default is $Hostname).&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Helo = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets connection prefix.&nbsp;</div></li><li><div>   * Options are &quot;&quot;, &quot;ssl&quot; or &quot;tls&quot;&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $SMTPSecure = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets SMTP authentication. Utilizes the Username and Password variables.&nbsp;</div></li><li><div>   * @var bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $SMTPAuth = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets SMTP username.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Username = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets SMTP password.&nbsp;</div></li><li><div>   * @var string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Password = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the SMTP server timeout in seconds. This function will not&nbsp;</div></li><li><div>   * work with the win32 version.&nbsp;</div></li><li><div>   * @var int&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $Timeout = 10;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets SMTP class debugging on or off.&nbsp;</div></li><li><div>   * @var bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $SMTPDebug = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Prevents the SMTP connection from being closed after each mail&nbsp;</div></li><li><div>   * sending.  If this is set to true then to close the connection&nbsp;</div></li><li><div>   * requires an explicit call to SmtpClose().&nbsp;</div></li><li><div>   * @var bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $SMTPKeepAlive = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Provides the ability to have the TO field process individual&nbsp;</div></li><li><div>   * emails, instead of sending to entire TO addresses&nbsp;</div></li><li><div>   * @var bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  var $SingleTo = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // PROPERTIES, PRIVATE&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  var $smtp = NULL;&nbsp;</div></li><li><div>  var $to = array();&nbsp;</div></li><li><div>  var $cc = array();&nbsp;</div></li><li><div>  var $bcc = array();&nbsp;</div></li><li><div>  var $ReplyTo = array();&nbsp;</div></li><li><div>  var $attachment = array();&nbsp;</div></li><li><div>  var $CustomHeader = array();&nbsp;</div></li><li><div>  var $message_type = '';&nbsp;</div></li><li><div>  var $boundary = array();&nbsp;</div></li><li><div>  var $language = array();&nbsp;</div></li><li><div>  var $error_count = 0;&nbsp;</div></li><li><div>  var $LE = &quot;\n&quot;;&nbsp;</div></li><li><div>  var $sign_cert_file = &quot;&quot;;&nbsp;</div></li><li><div>  var $sign_key_file = &quot;&quot;;&nbsp;</div></li><li><div>  var $sign_key_pass = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // METHODS, VARIABLES&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets message type to HTML.&nbsp;</div></li><li><div>   * @param bool $bool&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function IsHTML($bool) {&nbsp;</div></li><li><div>    if($bool == true) {&nbsp;</div></li><li><div>      $this-&gt;ContentType = 'text/html';&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $this-&gt;ContentType = 'text/plain';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets Mailer to send message using SMTP.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function IsSMTP() {&nbsp;</div></li><li><div>    $this-&gt;Mailer = 'smtp';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets Mailer to send message using PHP mail() function.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function IsMail() {&nbsp;</div></li><li><div>    $this-&gt;Mailer = 'mail';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets Mailer to send message using the $Sendmail program.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function IsSendmail() {&nbsp;</div></li><li><div>    $this-&gt;Mailer = 'sendmail';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets Mailer to send message using the qmail MTA.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function IsQmail() {&nbsp;</div></li><li><div>    $this-&gt;Sendmail = '/var/qmail/bin/sendmail';&nbsp;</div></li><li><div>    $this-&gt;Mailer = 'sendmail';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // METHODS, RECIPIENTS&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Adds a &quot;To&quot; address.&nbsp;</div></li><li><div>   * @param string $address&nbsp;</div></li><li><div>   * @param string $name&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddAddress($address, $name = '') {&nbsp;</div></li><li><div>    $cur = count($this-&gt;to);&nbsp;</div></li><li><div>    $this-&gt;to[$cur][0] = trim($address);&nbsp;</div></li><li><div>    $this-&gt;to[$cur][1] = $name;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Adds a &quot;Cc&quot; address. Note: this function works&nbsp;</div></li><li><div>   * with the SMTP mailer on win32, not with the &quot;mail&quot;&nbsp;</div></li><li><div>   * mailer.&nbsp;</div></li><li><div>   * @param string $address&nbsp;</div></li><li><div>   * @param string $name&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddCC($address, $name = '') {&nbsp;</div></li><li><div>    $cur = count($this-&gt;cc);&nbsp;</div></li><li><div>    $this-&gt;cc[$cur][0] = trim($address);&nbsp;</div></li><li><div>    $this-&gt;cc[$cur][1] = $name;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Adds a &quot;Bcc&quot; address. Note: this function works&nbsp;</div></li><li><div>   * with the SMTP mailer on win32, not with the &quot;mail&quot;&nbsp;</div></li><li><div>   * mailer.&nbsp;</div></li><li><div>   * @param string $address&nbsp;</div></li><li><div>   * @param string $name&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddBCC($address, $name = '') {&nbsp;</div></li><li><div>    $cur = count($this-&gt;bcc);&nbsp;</div></li><li><div>    $this-&gt;bcc[$cur][0] = trim($address);&nbsp;</div></li><li><div>    $this-&gt;bcc[$cur][1] = $name;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Adds a &quot;Reply-To&quot; address.&nbsp;</div></li><li><div>   * @param string $address&nbsp;</div></li><li><div>   * @param string $name&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddReplyTo($address, $name = '') {&nbsp;</div></li><li><div>    $cur = count($this-&gt;ReplyTo);&nbsp;</div></li><li><div>    $this-&gt;ReplyTo[$cur][0] = trim($address);&nbsp;</div></li><li><div>    $this-&gt;ReplyTo[$cur][1] = $name;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // METHODS, MAIL SENDING&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Creates message and assigns Mailer. If the message is&nbsp;</div></li><li><div>   * not sent successfully then it returns false.  Use the ErrorInfo&nbsp;</div></li><li><div>   * variable to view description of the error.&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function Send() {&nbsp;</div></li><li><div>    $header = '';&nbsp;</div></li><li><div>    $body = '';&nbsp;</div></li><li><div>    $result = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if((count($this-&gt;to) + count($this-&gt;cc) + count($this-&gt;bcc)) &lt; 1) {&nbsp;</div></li><li><div>      $this-&gt;SetError($this-&gt;Lang('provide_address'));&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Set whether the message is multipart/alternative */&nbsp;</div></li><li><div>    if(!empty($this-&gt;AltBody)) {&nbsp;</div></li><li><div>      $this-&gt;ContentType = 'multipart/alternative';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;error_count = 0; // reset errors&nbsp;</div></li><li><div>    $this-&gt;SetMessageType();&nbsp;</div></li><li><div>    $header .= $this-&gt;CreateHeader();&nbsp;</div></li><li><div>    $body = $this-&gt;CreateBody();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if($body == '') {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Choose the mailer */&nbsp;</div></li><li><div>    switch($this-&gt;Mailer) {&nbsp;</div></li><li><div>      case 'sendmail':&nbsp;</div></li><li><div>        $result = $this-&gt;SendmailSend($header, $body);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'smtp':&nbsp;</div></li><li><div>        $result = $this-&gt;SmtpSend($header, $body);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'mail':&nbsp;</div></li><li><div>        $result = $this-&gt;MailSend($header, $body);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      default:&nbsp;</div></li><li><div>        $result = $this-&gt;MailSend($header, $body);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>        //$this-&gt;SetError($this-&gt;Mailer . $this-&gt;Lang('mailer_not_supported'));&nbsp;</div></li><li><div>        //$result = false;&nbsp;</div></li><li><div>        //break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sends mail using the $Sendmail program.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function SendmailSend($header, $body) {&nbsp;</div></li><li><div>    if ($this-&gt;Sender != '') {&nbsp;</div></li><li><div>      $sendmail = sprintf(&quot;%s -oi -f %s -t&quot;, escapeshellcmd($this-&gt;Sendmail), escapeshellarg($this-&gt;Sender));&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $sendmail = sprintf(&quot;%s -oi -t&quot;, escapeshellcmd($this-&gt;Sendmail));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(!@$mail = popen($sendmail, 'w')) {&nbsp;</div></li><li><div>      $this-&gt;SetError($this-&gt;Lang('execute') . $this-&gt;Sendmail);&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    fputs($mail, $header);&nbsp;</div></li><li><div>    fputs($mail, $body);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $result = pclose($mail);&nbsp;</div></li><li><div>    if (version_compare(phpversion(), '4.2.3') == -1) {&nbsp;</div></li><li><div>      $result = $result &gt;&gt; 8 & 0xFF;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if($result != 0) {&nbsp;</div></li><li><div>      $this-&gt;SetError($this-&gt;Lang('execute') . $this-&gt;Sendmail);&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sends mail using the PHP mail() function.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function MailSend($header, $body) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $to = '';&nbsp;</div></li><li><div>    for($i = 0; $i &lt; count($this-&gt;to); $i++) {&nbsp;</div></li><li><div>      if($i != 0) { $to .= ', '; }&nbsp;</div></li><li><div>      $to .= $this-&gt;AddrFormat($this-&gt;to[$i]);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $toArr = explode(', ', $to);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $params = sprintf(&quot;-oi -f %s&quot;, $this-&gt;Sender);&nbsp;</div></li><li><div>    if ($this-&gt;Sender != '' && strlen(ini_get('safe_mode')) &lt; 1) {&nbsp;</div></li><li><div>      $old_from = ini_get('sendmail_from');&nbsp;</div></li><li><div>      ini_set('sendmail_from', $this-&gt;Sender);&nbsp;</div></li><li><div>      if ($this-&gt;SingleTo === true && count($toArr) &gt; 1) {&nbsp;</div></li><li><div>        foreach ($toArr as $key =&gt; $val) {&nbsp;</div></li><li><div>          $rt = @mail($val, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)), $body, $header, $params);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)), $body, $header, $params);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      if ($this-&gt;SingleTo === true && count($toArr) &gt; 1) {&nbsp;</div></li><li><div>        foreach ($toArr as $key =&gt; $val) {&nbsp;</div></li><li><div>          $rt = @mail($val, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)), $body, $header, $params);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)), $body, $header);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if (isset($old_from)) {&nbsp;</div></li><li><div>      ini_set('sendmail_from', $old_from);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(!$rt) {&nbsp;</div></li><li><div>      $this-&gt;SetError($this-&gt;Lang('instantiate'));&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sends mail via SMTP using PhpSMTP (Author:&nbsp;</div></li><li><div>   * Chris Ryan).  Returns bool.  Returns false if there is a&nbsp;</div></li><li><div>   * bad MAIL FROM, RCPT, or DATA input.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function SmtpSend($header, $body) {&nbsp;</div></li><li><div>    include_once('class.mailer-smtp.php');&nbsp;</div></li><li><div>    $error = '';&nbsp;</div></li><li><div>    $bad_rcpt = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(!$this-&gt;SmtpConnect()) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $smtp_from = ($this-&gt;Sender == '') ? $this-&gt;From : $this-&gt;Sender;&nbsp;</div></li><li><div>    if(!$this-&gt;smtp-&gt;Mail($smtp_from)) {&nbsp;</div></li><li><div>      $error = $this-&gt;Lang('from_failed') . $smtp_from;&nbsp;</div></li><li><div>      $this-&gt;SetError($error);&nbsp;</div></li><li><div>      $this-&gt;smtp-&gt;Reset();&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Attempt to send attach all recipients */&nbsp;</div></li><li><div>    for($i = 0; $i &lt; count($this-&gt;to); $i++) {&nbsp;</div></li><li><div>      if(!$this-&gt;smtp-&gt;Recipient($this-&gt;to[$i][0])) {&nbsp;</div></li><li><div>        $bad_rcpt[] = $this-&gt;to[$i][0];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    for($i = 0; $i &lt; count($this-&gt;cc); $i++) {&nbsp;</div></li><li><div>      if(!$this-&gt;smtp-&gt;Recipient($this-&gt;cc[$i][0])) {&nbsp;</div></li><li><div>        $bad_rcpt[] = $this-&gt;cc[$i][0];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    for($i = 0; $i &lt; count($this-&gt;bcc); $i++) {&nbsp;</div></li><li><div>      if(!$this-&gt;smtp-&gt;Recipient($this-&gt;bcc[$i][0])) {&nbsp;</div></li><li><div>        $bad_rcpt[] = $this-&gt;bcc[$i][0];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(count($bad_rcpt) &gt; 0) { // Create error message&nbsp;</div></li><li><div>      for($i = 0; $i &lt; count($bad_rcpt); $i++) {&nbsp;</div></li><li><div>        if($i != 0) {&nbsp;</div></li><li><div>          $error .= ', ';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $error .= $bad_rcpt[$i];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $error = $this-&gt;Lang('recipients_failed') . $error;&nbsp;</div></li><li><div>      $this-&gt;SetError($error);&nbsp;</div></li><li><div>      $this-&gt;smtp-&gt;Reset();&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(!$this-&gt;smtp-&gt;Data($header . $body)) {&nbsp;</div></li><li><div>      $this-&gt;SetError($this-&gt;Lang('data_not_accepted'));&nbsp;</div></li><li><div>      $this-&gt;smtp-&gt;Reset();&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if($this-&gt;SMTPKeepAlive == true) {&nbsp;</div></li><li><div>      $this-&gt;smtp-&gt;Reset();&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $this-&gt;SmtpClose();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Initiates a connection to an SMTP server.  Returns false if the&nbsp;</div></li><li><div>   * operation failed.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function SmtpConnect() {&nbsp;</div></li><li><div>    if($this-&gt;smtp == NULL) {&nbsp;</div></li><li><div>      $this-&gt;smtp = new SMTP();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;smtp-&gt;do_debug = $this-&gt;SMTPDebug;&nbsp;</div></li><li><div>    $hosts = explode(';', $this-&gt;Host);&nbsp;</div></li><li><div>    $index = 0;&nbsp;</div></li><li><div>    $connection = ($this-&gt;smtp-&gt;Connected());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Retry while there is no connection */&nbsp;</div></li><li><div>    while($index &lt; count($hosts) && $connection == false) {&nbsp;</div></li><li><div>      $hostinfo = array();&nbsp;</div></li><li><div>      if(preg_match('/^(.+):([0-9]+)$/', $hosts[$index], $hostinfo)) {&nbsp;</div></li><li><div>        $host = $hostinfo[1];&nbsp;</div></li><li><div>        $port = $hostinfo[2];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        $host = $hosts[$index];&nbsp;</div></li><li><div>        $port = $this-&gt;Port;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if($this-&gt;smtp-&gt;Connect(((!empty($this-&gt;SMTPSecure))?$this-&gt;SMTPSecure.'://':'').$host, $port, $this-&gt;Timeout)) {&nbsp;</div></li><li><div>        if ($this-&gt;Helo != '') {&nbsp;</div></li><li><div>          $this-&gt;smtp-&gt;Hello($this-&gt;Helo);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>          $this-&gt;smtp-&gt;Hello($this-&gt;ServerHostname());&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $connection = true;&nbsp;</div></li><li><div>        if($this-&gt;SMTPAuth) {&nbsp;</div></li><li><div>          if(!$this-&gt;smtp-&gt;Authenticate($this-&gt;Username, $this-&gt;Password)) {&nbsp;</div></li><li><div>            $this-&gt;SetError($this-&gt;Lang('authenticate'));&nbsp;</div></li><li><div>            $this-&gt;smtp-&gt;Reset();&nbsp;</div></li><li><div>            $connection = false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $index++;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if(!$connection) {&nbsp;</div></li><li><div>      $this-&gt;SetError($this-&gt;Lang('connect_host'));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $connection;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Closes the active SMTP session if one exists.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function SmtpClose() {&nbsp;</div></li><li><div>    if($this-&gt;smtp != NULL) {&nbsp;</div></li><li><div>      if($this-&gt;smtp-&gt;Connected()) {&nbsp;</div></li><li><div>        $this-&gt;smtp-&gt;Quit();&nbsp;</div></li><li><div>        $this-&gt;smtp-&gt;Close();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the language for all class error messages.  Returns false&nbsp;</div></li><li><div>   * if it cannot load the language file.  The default language type&nbsp;</div></li><li><div>   * is English.&nbsp;</div></li><li><div>   * @param string $lang_type Type of language (e.g. Portuguese: &quot;br&quot;)&nbsp;</div></li><li><div>   * @param string $lang_path Path to the language file directory&nbsp;</div></li><li><div>   * @access public&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function SetLanguage($lang_type, $lang_path = 'language/') {&nbsp;</div></li><li><div>    if(file_exists($lang_path.'phpmailer.lang-'.$lang_type.'.php')) {&nbsp;</div></li><li><div>      include($lang_path.'phpmailer.lang-'.$lang_type.'.php');&nbsp;</div></li><li><div>    } elseif (file_exists($lang_path.'phpmailer.lang-en.php')) {&nbsp;</div></li><li><div>      include($lang_path.'phpmailer.lang-en.php');&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $PHPMAILER_LANG = array();&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;provide_address&quot;] = 'You must provide at least one ' .&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;mailer_not_supported&quot;] = ' mailer is not supported.';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;execute&quot;] = 'Could not execute: ';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;instantiate&quot;] = 'Could not instantiate mail function.';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;authenticate&quot;] = 'SMTP Error: Could not authenticate.';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;from_failed&quot;] = 'The following From address failed: ';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;recipients_failed&quot;] = 'SMTP Error: The following ' .&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;data_not_accepted&quot;] = 'SMTP Error: Data not accepted.';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;connect_host&quot;] = 'SMTP Error: Could not connect to SMTP host.';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;file_access&quot;] = 'Could not access file: ';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;file_open&quot;] = 'File Error: Could not open file: ';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;encoding&quot;] = 'Unknown encoding: ';&nbsp;</div></li><li><div>      $PHPMAILER_LANG[&quot;signing&quot;] = 'Signing Error: ';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $this-&gt;language = $PHPMAILER_LANG;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // METHODS, MESSAGE CREATION&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Creates recipient headers.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddrAppend($type, $addr) {&nbsp;</div></li><li><div>    $addr_str = $type . ': ';&nbsp;</div></li><li><div>    $addr_str .= $this-&gt;AddrFormat($addr[0]);&nbsp;</div></li><li><div>    if(count($addr) &gt; 1) {&nbsp;</div></li><li><div>      for($i = 1; $i &lt; count($addr); $i++) {&nbsp;</div></li><li><div>        $addr_str .= ', ' . $this-&gt;AddrFormat($addr[$i]);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $addr_str .= $this-&gt;LE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $addr_str;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Formats an address correctly.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddrFormat($addr) {&nbsp;</div></li><li><div>    if(empty($addr[1])) {&nbsp;</div></li><li><div>      $formatted = $this-&gt;SecureHeader($addr[0]);&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $formatted = $this-&gt;EncodeHeader($this-&gt;SecureHeader($addr[1]), 'phrase') . &quot; &lt;&quot; . $this-&gt;SecureHeader($addr[0]) . &quot;&gt;&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $formatted;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Wraps message for use with mailers that do not&nbsp;</div></li><li><div>   * automatically perform wrapping and for quoted-printable.&nbsp;</div></li><li><div>   * Original written by philippe.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function WrapText($message, $length, $qp_mode = false) {&nbsp;</div></li><li><div>    $soft_break = ($qp_mode) ? sprintf(&quot; =%s&quot;, $this-&gt;LE) : $this-&gt;LE;&nbsp;</div></li><li><div>    // If utf-8 encoding is used, we will need to make sure we don't&nbsp;</div></li><li><div>    // split multibyte characters when we wrap&nbsp;</div></li><li><div>    $is_utf8 = (strtolower($this-&gt;CharSet) == &quot;utf-8&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $message = $this-&gt;FixEOL($message);&nbsp;</div></li><li><div>    if (substr($message, -1) == $this-&gt;LE) {&nbsp;</div></li><li><div>      $message = substr($message, 0, -1);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $line = explode($this-&gt;LE, $message);&nbsp;</div></li><li><div>    $message = '';&nbsp;</div></li><li><div>    for ($i=0 ;$i &lt; count($line); $i++) {&nbsp;</div></li><li><div>      $line_part = explode(' ', $line[$i]);&nbsp;</div></li><li><div>      $buf = '';&nbsp;</div></li><li><div>      for ($e = 0; $e&lt;count($line_part); $e++) {&nbsp;</div></li><li><div>        $word = $line_part[$e];&nbsp;</div></li><li><div>        if ($qp_mode and (strlen($word) &gt; $length)) {&nbsp;</div></li><li><div>          $space_left = $length - strlen($buf) - 1;&nbsp;</div></li><li><div>          if ($e != 0) {&nbsp;</div></li><li><div>            if ($space_left &gt; 20) {&nbsp;</div></li><li><div>              $len = $space_left;&nbsp;</div></li><li><div>              if ($is_utf8) {&nbsp;</div></li><li><div>                $len = $this-&gt;UTF8CharBoundary($word, $len);&nbsp;</div></li><li><div>              } elseif (substr($word, $len - 1, 1) == &quot;=&quot;) {&nbsp;</div></li><li><div>                $len--;&nbsp;</div></li><li><div>              } elseif (substr($word, $len - 2, 1) == &quot;=&quot;) {&nbsp;</div></li><li><div>                $len -= 2;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $part = substr($word, 0, $len);&nbsp;</div></li><li><div>              $word = substr($word, $len);&nbsp;</div></li><li><div>              $buf .= ' ' . $part;&nbsp;</div></li><li><div>              $message .= $buf . sprintf(&quot;=%s&quot;, $this-&gt;LE);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>              $message .= $buf . $soft_break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $buf = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          while (strlen($word) &gt; 0) {&nbsp;</div></li><li><div>            $len = $length;&nbsp;</div></li><li><div>            if ($is_utf8) {&nbsp;</div></li><li><div>              $len = $this-&gt;UTF8CharBoundary($word, $len);&nbsp;</div></li><li><div>            } elseif (substr($word, $len - 1, 1) == &quot;=&quot;) {&nbsp;</div></li><li><div>              $len--;&nbsp;</div></li><li><div>            } elseif (substr($word, $len - 2, 1) == &quot;=&quot;) {&nbsp;</div></li><li><div>              $len -= 2;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $part = substr($word, 0, $len);&nbsp;</div></li><li><div>            $word = substr($word, $len);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (strlen($word) &gt; 0) {&nbsp;</div></li><li><div>              $message .= $part . sprintf(&quot;=%s&quot;, $this-&gt;LE);&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>              $buf = $part;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>          $buf_o = $buf;&nbsp;</div></li><li><div>          $buf .= ($e == 0) ? $word : (' ' . $word);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if (strlen($buf) &gt; $length and $buf_o != '') {&nbsp;</div></li><li><div>            $message .= $buf_o . $soft_break;&nbsp;</div></li><li><div>            $buf = $word;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $message .= $buf . $this-&gt;LE;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $message;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Finds last character boundary prior to maxLength in a utf-8&nbsp;</div></li><li><div>   * quoted (printable) encoded string.&nbsp;</div></li><li><div>   * Original written by Colin Brown.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @param string $encodedText utf-8 QP text&nbsp;</div></li><li><div>   * @param int    $maxLength   find last character boundary prior to this length&nbsp;</div></li><li><div>   * @return int&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function UTF8CharBoundary($encodedText, $maxLength) {&nbsp;</div></li><li><div>    $foundSplitPos = false;&nbsp;</div></li><li><div>    $lookBack = 3;&nbsp;</div></li><li><div>    while (!$foundSplitPos) {&nbsp;</div></li><li><div>      $lastChunk = substr($encodedText, $maxLength - $lookBack, $lookBack);&nbsp;</div></li><li><div>      $encodedCharPos = strpos($lastChunk, &quot;=&quot;);&nbsp;</div></li><li><div>      if ($encodedCharPos !== false) {&nbsp;</div></li><li><div>        // Found start of encoded character byte within $lookBack block.&nbsp;</div></li><li><div>        // Check the encoded byte value (the 2 chars after the '=')&nbsp;</div></li><li><div>        $hex = substr($encodedText, $maxLength - $lookBack + $encodedCharPos + 1, 2);&nbsp;</div></li><li><div>        $dec = hexdec($hex);&nbsp;</div></li><li><div>        if ($dec &lt; 128) { // Single byte character.&nbsp;</div></li><li><div>          // If the encoded char was found at pos 0, it will fit&nbsp;</div></li><li><div>          // otherwise reduce maxLength to start of the encoded char&nbsp;</div></li><li><div>          $maxLength = ($encodedCharPos == 0) ? $maxLength :&nbsp;</div></li><li><div>          $maxLength - ($lookBack - $encodedCharPos);&nbsp;</div></li><li><div>          $foundSplitPos = true;&nbsp;</div></li><li><div>        } elseif ($dec &gt;= 192) { // First byte of a multi byte character&nbsp;</div></li><li><div>          // Reduce maxLength to split at start of character&nbsp;</div></li><li><div>          $maxLength = $maxLength - ($lookBack - $encodedCharPos);&nbsp;</div></li><li><div>          $foundSplitPos = true;&nbsp;</div></li><li><div>        } elseif ($dec &lt; 192) { // Middle byte of a multi byte character, look further back&nbsp;</div></li><li><div>          $lookBack += 3;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        // No encoded character found&nbsp;</div></li><li><div>        $foundSplitPos = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $maxLength;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Set the body wrapping.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function SetWordWrap() {&nbsp;</div></li><li><div>    if($this-&gt;WordWrap &lt; 1) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    switch($this-&gt;message_type) {&nbsp;</div></li><li><div>      case 'alt':&nbsp;</div></li><li><div>        /** fall through */&nbsp;</div></li><li><div>      case 'alt_attachments':&nbsp;</div></li><li><div>        $this-&gt;AltBody = $this-&gt;WrapText($this-&gt;AltBody, $this-&gt;WordWrap);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      default:&nbsp;</div></li><li><div>        $this-&gt;Body = $this-&gt;WrapText($this-&gt;Body, $this-&gt;WordWrap);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Assembles message header.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function CreateHeader() {&nbsp;</div></li><li><div>    $result = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Set the boundaries */&nbsp;</div></li><li><div>    $uniq_id = md5(uniqid(time()));&nbsp;</div></li><li><div>    $this-&gt;boundary[1] = 'b1_' . $uniq_id;&nbsp;</div></li><li><div>    $this-&gt;boundary[2] = 'b2_' . $uniq_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $result .= $this-&gt;HeaderLine('Date', $this-&gt;RFCDate());&nbsp;</div></li><li><div>    if($this-&gt;Sender == '') {&nbsp;</div></li><li><div>      $result .= $this-&gt;HeaderLine('Return-Path', trim($this-&gt;From));&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $result .= $this-&gt;HeaderLine('Return-Path', trim($this-&gt;Sender));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** To be created automatically by mail() */&nbsp;</div></li><li><div>    if($this-&gt;Mailer != 'mail') {&nbsp;</div></li><li><div>      if(count($this-&gt;to) &gt; 0) {&nbsp;</div></li><li><div>        $result .= $this-&gt;AddrAppend('To', $this-&gt;to);&nbsp;</div></li><li><div>      } elseif (count($this-&gt;cc) == 0) {&nbsp;</div></li><li><div>        $result .= $this-&gt;HeaderLine('To', 'undisclosed-recipients:;');&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $from = array();&nbsp;</div></li><li><div>    $from[0][0] = trim($this-&gt;From);&nbsp;</div></li><li><div>    $from[0][1] = $this-&gt;FromName;&nbsp;</div></li><li><div>    $result .= $this-&gt;AddrAppend('From', $from);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** sendmail and mail() extract Cc from the header before sending */&nbsp;</div></li><li><div>    if((($this-&gt;Mailer == 'sendmail') || ($this-&gt;Mailer == 'mail')) && (count($this-&gt;cc) &gt; 0)) {&nbsp;</div></li><li><div>      $result .= $this-&gt;AddrAppend('Cc', $this-&gt;cc);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** sendmail and mail() extract Bcc from the header before sending */&nbsp;</div></li><li><div>    if((($this-&gt;Mailer == 'sendmail') || ($this-&gt;Mailer == 'mail')) && (count($this-&gt;bcc) &gt; 0)) {&nbsp;</div></li><li><div>      $result .= $this-&gt;AddrAppend('Bcc', $this-&gt;bcc);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(count($this-&gt;ReplyTo) &gt; 0) {&nbsp;</div></li><li><div>      $result .= $this-&gt;AddrAppend('Reply-To', $this-&gt;ReplyTo);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** mail() sets the subject itself */&nbsp;</div></li><li><div>    if($this-&gt;Mailer != 'mail') {&nbsp;</div></li><li><div>      $result .= $this-&gt;HeaderLine('Subject', $this-&gt;EncodeHeader($this-&gt;SecureHeader($this-&gt;Subject)));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if($this-&gt;MessageID != '') {&nbsp;</div></li><li><div>      $result .= $this-&gt;HeaderLine('Message-ID', $this-&gt;MessageID);&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $result .= sprintf(&quot;Message-ID: &lt;%s@%s&gt;%s&quot;, $uniq_id, $this-&gt;ServerHostname(), $this-&gt;LE);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $result .= $this-&gt;HeaderLine('X-Priority', $this-&gt;Priority);&nbsp;</div></li><li><div>    $result .= $this-&gt;HeaderLine('X-Mailer', 'PHPMailer (phpmailer.sourceforge.net) [version ' . $this-&gt;Version . ']');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if($this-&gt;ConfirmReadingTo != '') {&nbsp;</div></li><li><div>      $result .= $this-&gt;HeaderLine('Disposition-Notification-To', '&lt;' . trim($this-&gt;ConfirmReadingTo) . '&gt;');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Add custom headers&nbsp;</div></li><li><div>    for($index = 0; $index &lt; count($this-&gt;CustomHeader); $index++) {&nbsp;</div></li><li><div>      $result .= $this-&gt;HeaderLine(trim($this-&gt;CustomHeader[$index][0]), $this-&gt;EncodeHeader(trim($this-&gt;CustomHeader[$index][1])));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if (!$this-&gt;sign_key_file) {&nbsp;</div></li><li><div>      $result .= $this-&gt;HeaderLine('MIME-Version', '1.0');&nbsp;</div></li><li><div>      $result .= $this-&gt;GetMailMIME();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns the message MIME.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function GetMailMIME() {&nbsp;</div></li><li><div>    $result = '';&nbsp;</div></li><li><div>    switch($this-&gt;message_type) {&nbsp;</div></li><li><div>      case 'plain':&nbsp;</div></li><li><div>        $result .= $this-&gt;HeaderLine('Content-Transfer-Encoding', $this-&gt;Encoding);&nbsp;</div></li><li><div>        $result .= sprintf(&quot;Content-Type: %s; charset=\&quot;%s\&quot;&quot;, $this-&gt;ContentType, $this-&gt;CharSet);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'attachments':&nbsp;</div></li><li><div>        /** fall through */&nbsp;</div></li><li><div>      case 'alt_attachments':&nbsp;</div></li><li><div>        if($this-&gt;InlineImageExists()) {&nbsp;</div></li><li><div>          $result .= sprintf(&quot;Content-Type: %s;%s\ttype=\&quot;text/html\&quot;;%s\tboundary=\&quot;%s\&quot;%s&quot;, 'multipart/related', $this-&gt;LE, $this-&gt;LE, $this-&gt;boundary[1], $this-&gt;LE);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>          $result .= $this-&gt;HeaderLine('Content-Type', 'multipart/mixed;');&nbsp;</div></li><li><div>          $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . '&quot;');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'alt':&nbsp;</div></li><li><div>        $result .= $this-&gt;HeaderLine('Content-Type', 'multipart/alternative;');&nbsp;</div></li><li><div>        $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . '&quot;');&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if($this-&gt;Mailer != 'mail') {&nbsp;</div></li><li><div>      $result .= $this-&gt;LE.$this-&gt;LE;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Assembles the message body.  Returns an empty string on failure.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function CreateBody() {&nbsp;</div></li><li><div>    $result = '';&nbsp;</div></li><li><div>    if ($this-&gt;sign_key_file) {&nbsp;</div></li><li><div>      $result .= $this-&gt;GetMailMIME();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $this-&gt;SetWordWrap();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    switch($this-&gt;message_type) {&nbsp;</div></li><li><div>      case 'alt':&nbsp;</div></li><li><div>        $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], '', 'text/plain', '');&nbsp;</div></li><li><div>        $result .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);&nbsp;</div></li><li><div>        $result .= $this-&gt;LE.$this-&gt;LE;&nbsp;</div></li><li><div>        $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], '', 'text/html', '');&nbsp;</div></li><li><div>        $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);&nbsp;</div></li><li><div>        $result .= $this-&gt;LE.$this-&gt;LE;&nbsp;</div></li><li><div>        $result .= $this-&gt;EndBoundary($this-&gt;boundary[1]);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'plain':&nbsp;</div></li><li><div>        $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'attachments':&nbsp;</div></li><li><div>        $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], '', '', '');&nbsp;</div></li><li><div>        $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);&nbsp;</div></li><li><div>        $result .= $this-&gt;LE;&nbsp;</div></li><li><div>        $result .= $this-&gt;AttachAll();&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'alt_attachments':&nbsp;</div></li><li><div>        $result .= sprintf(&quot;--%s%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);&nbsp;</div></li><li><div>        $result .= sprintf(&quot;Content-Type: %s;%s&quot; . &quot;\tboundary=\&quot;%s\&quot;%s&quot;, 'multipart/alternative', $this-&gt;LE, $this-&gt;boundary[2], $this-&gt;LE.$this-&gt;LE);&nbsp;</div></li><li><div>        $result .= $this-&gt;GetBoundary($this-&gt;boundary[2], '', 'text/plain', '') . $this-&gt;LE; // Create text body&nbsp;</div></li><li><div>        $result .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);&nbsp;</div></li><li><div>        $result .= $this-&gt;LE.$this-&gt;LE;&nbsp;</div></li><li><div>        $result .= $this-&gt;GetBoundary($this-&gt;boundary[2], '', 'text/html', '') . $this-&gt;LE; // Create the HTML body&nbsp;</div></li><li><div>        $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);&nbsp;</div></li><li><div>        $result .= $this-&gt;LE.$this-&gt;LE;&nbsp;</div></li><li><div>        $result .= $this-&gt;EndBoundary($this-&gt;boundary[2]);&nbsp;</div></li><li><div>        $result .= $this-&gt;AttachAll();&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if($this-&gt;IsError()) {&nbsp;</div></li><li><div>      $result = '';&nbsp;</div></li><li><div>    } else if ($this-&gt;sign_key_file) {&nbsp;</div></li><li><div>      $file = tempnam(&quot;&quot;, &quot;mail&quot;);&nbsp;</div></li><li><div>      $fp = fopen($file, &quot;w&quot;);&nbsp;</div></li><li><div>      fwrite($fp, $result);&nbsp;</div></li><li><div>      fclose($fp);&nbsp;</div></li><li><div>      $signed = tempnam(&quot;&quot;, &quot;signed&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (@openssl_pkcs7_sign($file, $signed, &quot;file://&quot;.$this-&gt;sign_cert_file, array(&quot;file://&quot;.$this-&gt;sign_key_file, $this-&gt;sign_key_pass), null)) {&nbsp;</div></li><li><div>        $fp = fopen($signed, &quot;r&quot;);&nbsp;</div></li><li><div>        $result = fread($fp, filesize($this-&gt;sign_key_file));&nbsp;</div></li><li><div>        $result = '';&nbsp;</div></li><li><div>        while(!feof($fp)) {&nbsp;</div></li><li><div>          $result = $result . fread($fp, 1024);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        fclose($fp);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        $this-&gt;SetError($this-&gt;Lang(&quot;signing&quot;).openssl_error_string());&nbsp;</div></li><li><div>        $result = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unlink($file);&nbsp;</div></li><li><div>      unlink($signed);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns the start of a message boundary.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function GetBoundary($boundary, $charSet, $contentType, $encoding) {&nbsp;</div></li><li><div>    $result = '';&nbsp;</div></li><li><div>    if($charSet == '') {&nbsp;</div></li><li><div>      $charSet = $this-&gt;CharSet;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if($contentType == '') {&nbsp;</div></li><li><div>      $contentType = $this-&gt;ContentType;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if($encoding == '') {&nbsp;</div></li><li><div>      $encoding = $this-&gt;Encoding;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $result .= $this-&gt;TextLine('--' . $boundary);&nbsp;</div></li><li><div>    $result .= sprintf(&quot;Content-Type: %s; charset = \&quot;%s\&quot;&quot;, $contentType, $charSet);&nbsp;</div></li><li><div>    $result .= $this-&gt;LE;&nbsp;</div></li><li><div>    $result .= $this-&gt;HeaderLine('Content-Transfer-Encoding', $encoding);&nbsp;</div></li><li><div>    $result .= $this-&gt;LE;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns the end of a message boundary.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function EndBoundary($boundary) {&nbsp;</div></li><li><div>    return $this-&gt;LE . '--' . $boundary . '--' . $this-&gt;LE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Sets the message type.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function SetMessageType() {&nbsp;</div></li><li><div>    if(count($this-&gt;attachment) &lt; 1 && strlen($this-&gt;AltBody) &lt; 1) {&nbsp;</div></li><li><div>      $this-&gt;message_type = 'plain';&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      if(count($this-&gt;attachment) &gt; 0) {&nbsp;</div></li><li><div>        $this-&gt;message_type = 'attachments';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if(strlen($this-&gt;AltBody) &gt; 0 && count($this-&gt;attachment) &lt; 1) {&nbsp;</div></li><li><div>        $this-&gt;message_type = 'alt';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if(strlen($this-&gt;AltBody) &gt; 0 && count($this-&gt;attachment) &gt; 0) {&nbsp;</div></li><li><div>        $this-&gt;message_type = 'alt_attachments';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /** Returns a formatted header line.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function HeaderLine($name, $value) {&nbsp;</div></li><li><div>    return $name . ': ' . $value . $this-&gt;LE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns a formatted mail line.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function TextLine($value) {&nbsp;</div></li><li><div>    return $value . $this-&gt;LE;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // CLASS METHODS, ATTACHMENTS&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Adds an attachment from a path on the filesystem.&nbsp;</div></li><li><div>   * Returns false if the file could not be found&nbsp;</div></li><li><div>   * or accessed.&nbsp;</div></li><li><div>   * @param string $path Path to the attachment.&nbsp;</div></li><li><div>   * @param string $name Overrides the attachment name.&nbsp;</div></li><li><div>   * @param string $encoding File encoding (see $Encoding).&nbsp;</div></li><li><div>   * @param string $type File extension (MIME) type.&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddAttachment($path, $name = '', $encoding = 'base64', $type = 'application/octet-stream') {&nbsp;</div></li><li><div>    if(!@is_file($path)) {&nbsp;</div></li><li><div>      $this-&gt;SetError($this-&gt;Lang('file_access') . $path);&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $filename = basename($path);&nbsp;</div></li><li><div>    if($name == '') {&nbsp;</div></li><li><div>      $name = $filename;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $cur = count($this-&gt;attachment);&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][0] = $path;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][1] = $filename;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][2] = $name;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][3] = $encoding;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][4] = $type;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][5] = false; // isStringAttachment&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][6] = 'attachment';&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][7] = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Attaches all fs, string, and binary attachments to the message.&nbsp;</div></li><li><div>   * Returns an empty string on failure.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AttachAll() {&nbsp;</div></li><li><div>    /** Return text of body */&nbsp;</div></li><li><div>    $mime = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Add all attachments */&nbsp;</div></li><li><div>    for($i = 0; $i &lt; count($this-&gt;attachment); $i++) {&nbsp;</div></li><li><div>      /** Check for string attachment */&nbsp;</div></li><li><div>      $bString = $this-&gt;attachment[$i][5];&nbsp;</div></li><li><div>      if ($bString) {&nbsp;</div></li><li><div>        $string = $this-&gt;attachment[$i][0];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        $path = $this-&gt;attachment[$i][0];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $filename = $this-&gt;attachment[$i][1];&nbsp;</div></li><li><div>      $name = $this-&gt;attachment[$i][2];&nbsp;</div></li><li><div>      $encoding = $this-&gt;attachment[$i][3];&nbsp;</div></li><li><div>      $type = $this-&gt;attachment[$i][4];&nbsp;</div></li><li><div>      $disposition = $this-&gt;attachment[$i][6];&nbsp;</div></li><li><div>      $cid = $this-&gt;attachment[$i][7];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $mime[] = sprintf(&quot;--%s%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);&nbsp;</div></li><li><div>      $mime[] = sprintf(&quot;Content-Type: %s; name=\&quot;%s\&quot;%s&quot;, $type, $this-&gt;EncodeHeader($this-&gt;SecureHeader($name)), $this-&gt;LE);&nbsp;</div></li><li><div>      $mime[] = sprintf(&quot;Content-Transfer-Encoding: %s%s&quot;, $encoding, $this-&gt;LE);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if($disposition == 'inline') {&nbsp;</div></li><li><div>        $mime[] = sprintf(&quot;Content-ID: &lt;%s&gt;%s&quot;, $cid, $this-&gt;LE);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $mime[] = sprintf(&quot;Content-Disposition: %s; filename=\&quot;%s\&quot;%s&quot;, $disposition, $this-&gt;EncodeHeader($this-&gt;SecureHeader($name)), $this-&gt;LE.$this-&gt;LE);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      /** Encode as string attachment */&nbsp;</div></li><li><div>      if($bString) {&nbsp;</div></li><li><div>        $mime[] = $this-&gt;EncodeString($string, $encoding);&nbsp;</div></li><li><div>        if($this-&gt;IsError()) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $mime[] = $this-&gt;LE.$this-&gt;LE;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        $mime[] = $this-&gt;EncodeFile($path, $encoding);&nbsp;</div></li><li><div>        if($this-&gt;IsError()) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $mime[] = $this-&gt;LE.$this-&gt;LE;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $mime[] = sprintf(&quot;--%s--%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return join('', $mime);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Encodes attachment in requested format.  Returns an&nbsp;</div></li><li><div>   * empty string on failure.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function EncodeFile ($path, $encoding = 'base64') {&nbsp;</div></li><li><div>    if(!@$fd = fopen($path, 'rb')) {&nbsp;</div></li><li><div>      $this-&gt;SetError($this-&gt;Lang('file_open') . $path);&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $magic_quotes = get_magic_quotes_runtime();&nbsp;</div></li><li><div>    if ($magic_quotes) {&nbsp;</div></li><li><div>      if (version_compare(PHP_VERSION, '5.3.0', '&lt;')) {&nbsp;</div></li><li><div>        set_magic_quotes_runtime(0);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        ini_set('magic_quotes_runtime', 0);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $file_buffer = fread($fd, filesize($path));&nbsp;</div></li><li><div>    $file_buffer = $this-&gt;EncodeString($file_buffer, $encoding);&nbsp;</div></li><li><div>    fclose($fd);&nbsp;</div></li><li><div>    if ($magic_quotes) {&nbsp;</div></li><li><div>      if (version_compare(PHP_VERSION, '5.3.0', '&lt;')) {&nbsp;</div></li><li><div>        set_magic_quotes_runtime($magic_quotes);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        ini_set('magic_quotes_runtime', $magic_quotes);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $file_buffer;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Encodes string to requested format. Returns an&nbsp;</div></li><li><div>   * empty string on failure.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function EncodeString ($str, $encoding = 'base64') {&nbsp;</div></li><li><div>    $encoded = '';&nbsp;</div></li><li><div>    switch(strtolower($encoding)) {&nbsp;</div></li><li><div>      case 'base64':&nbsp;</div></li><li><div>        /** chunk_split is found in PHP &gt;= 3.0.6 */&nbsp;</div></li><li><div>        $encoded = chunk_split(base64_encode($str), 76, $this-&gt;LE);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case '7bit':&nbsp;</div></li><li><div>      case '8bit':&nbsp;</div></li><li><div>        $encoded = $this-&gt;FixEOL($str);&nbsp;</div></li><li><div>        if (substr($encoded, -(strlen($this-&gt;LE))) != $this-&gt;LE)&nbsp;</div></li><li><div>          $encoded .= $this-&gt;LE;&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'binary':&nbsp;</div></li><li><div>        $encoded = $str;&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'quoted-printable':&nbsp;</div></li><li><div>        $encoded = $this-&gt;EncodeQP($str);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      default:&nbsp;</div></li><li><div>        $this-&gt;SetError($this-&gt;Lang('encoding') . $encoding);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    return $encoded;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Encode a header string to best of Q, B, quoted or none.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function EncodeHeader ($str, $position = 'text') {&nbsp;</div></li><li><div>    $x = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    switch (strtolower($position)) {&nbsp;</div></li><li><div>      case 'phrase':&nbsp;</div></li><li><div>        if (!preg_match('/[\200-\377]/', $str)) {&nbsp;</div></li><li><div>          /** Can't use addslashes as we don't know what value has magic_quotes_sybase. */&nbsp;</div></li><li><div>          $encoded = addcslashes($str, &quot;\0..\37\177\\\&quot;&quot;);&nbsp;</div></li><li><div>          if (($str == $encoded) && !preg_match('/[^A-Za-z0-9!#$%&\'*+\/=?^_`{|}~ -]/', $str)) {&nbsp;</div></li><li><div>            return ($encoded);&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>            return (&quot;\&quot;$encoded\&quot;&quot;);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $x = preg_match_all('/[^\040\041\043-\133\135-\176]/', $str, $matches);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'comment':&nbsp;</div></li><li><div>        $x = preg_match_all('/[()&quot;]/', $str, $matches);&nbsp;</div></li><li><div>        /** Fall-through */&nbsp;</div></li><li><div>      case 'text':&nbsp;</div></li><li><div>      default:&nbsp;</div></li><li><div>        $x += preg_match_all('/[\000-\010\013\014\016-\037\177-\377]/', $str, $matches);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if ($x == 0) {&nbsp;</div></li><li><div>      return ($str);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $maxlen = 75 - 7 - strlen($this-&gt;CharSet);&nbsp;</div></li><li><div>    /** Try to select the encoding which should produce the shortest output */&nbsp;</div></li><li><div>    if (strlen($str)/3 &lt; $x) {&nbsp;</div></li><li><div>      $encoding = 'B';&nbsp;</div></li><li><div>      if (function_exists('mb_strlen') && $this-&gt;HasMultiBytes($str)) {&nbsp;</div></li><li><div>     // Use a custom function which correctly encodes and wraps long&nbsp;</div></li><li><div>     // multibyte strings without breaking lines within a character&nbsp;</div></li><li><div>        $encoded = $this-&gt;Base64EncodeWrapMB($str);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>        $encoded = base64_encode($str);&nbsp;</div></li><li><div>        $maxlen -= $maxlen % 4;&nbsp;</div></li><li><div>        $encoded = trim(chunk_split($encoded, $maxlen, &quot;\n&quot;));&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $encoding = 'Q';&nbsp;</div></li><li><div>      $encoded = $this-&gt;EncodeQ($str, $position);&nbsp;</div></li><li><div>      $encoded = $this-&gt;WrapText($encoded, $maxlen, true);&nbsp;</div></li><li><div>      $encoded = str_replace('='.$this-&gt;LE, &quot;\n&quot;, trim($encoded));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $encoded = preg_replace('/^(.*)$/m', &quot; =?&quot;.$this-&gt;CharSet.&quot;?$encoding?\\1?=&quot;, $encoded);&nbsp;</div></li><li><div>    $encoded = trim(str_replace(&quot;\n&quot;, $this-&gt;LE, $encoded));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $encoded;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Checks if a string contains multibyte characters.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @param string $str multi-byte text to wrap encode&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function HasMultiBytes($str) {&nbsp;</div></li><li><div>    if (function_exists('mb_strlen')) {&nbsp;</div></li><li><div>      return (strlen($str) &gt; mb_strlen($str, $this-&gt;CharSet));&nbsp;</div></li><li><div>    } else { // Assume no multibytes (we can't handle without mbstring functions anyway)&nbsp;</div></li><li><div>      return False;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Correctly encodes and wraps long multibyte strings for mail headers&nbsp;</div></li><li><div>   * without breaking lines within a character.&nbsp;</div></li><li><div>   * Adapted from a function by paravoid at http://uk.php.net/manual/en/function.mb-encode-mimeheader.php&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @param string $str multi-byte text to wrap encode&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function Base64EncodeWrapMB($str) {&nbsp;</div></li><li><div>    $start = &quot;=?&quot;.$this-&gt;CharSet.&quot;?B?&quot;;&nbsp;</div></li><li><div>    $end = &quot;?=&quot;;&nbsp;</div></li><li><div>    $encoded = &quot;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $mb_length = mb_strlen($str, $this-&gt;CharSet);&nbsp;</div></li><li><div>    // Each line must have length &lt;= 75, including $start and $end&nbsp;</div></li><li><div>    $length = 75 - strlen($start) - strlen($end);&nbsp;</div></li><li><div>    // Average multi-byte ratio&nbsp;</div></li><li><div>    $ratio = $mb_length / strlen($str);&nbsp;</div></li><li><div>    // Base64 has a 4:3 ratio&nbsp;</div></li><li><div>    $offset = $avgLength = floor($length * $ratio * .75);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    for ($i = 0; $i &lt; $mb_length; $i += $offset) {&nbsp;</div></li><li><div>      $lookBack = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      do {&nbsp;</div></li><li><div>        $offset = $avgLength - $lookBack;&nbsp;</div></li><li><div>        $chunk = mb_substr($str, $i, $offset, $this-&gt;CharSet);&nbsp;</div></li><li><div>        $chunk = base64_encode($chunk);&nbsp;</div></li><li><div>        $lookBack++;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      while (strlen($chunk) &gt; $length);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $encoded .= $chunk . $this-&gt;LE;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Chomp the last linefeed&nbsp;</div></li><li><div>    $encoded = substr($encoded, 0, -strlen($this-&gt;LE));&nbsp;</div></li><li><div>    return $encoded;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Encode string to quoted-printable.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function EncodeQP( $input = '', $line_max = 76, $space_conv = false ) {&nbsp;</div></li><li><div>    $hex = array('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F');&nbsp;</div></li><li><div>    $lines = preg_split('/(?:\r\n|\r|\n)/', $input);&nbsp;</div></li><li><div>    $eol = &quot;\r\n&quot;;&nbsp;</div></li><li><div>    $escape = '=';&nbsp;</div></li><li><div>    $output = '';&nbsp;</div></li><li><div>    while( list(, $line) = each($lines) ) {&nbsp;</div></li><li><div>      $linlen = strlen($line);&nbsp;</div></li><li><div>      $newline = '';&nbsp;</div></li><li><div>      for($i = 0; $i &lt; $linlen; $i++) {&nbsp;</div></li><li><div>        $c = substr( $line, $i, 1 );&nbsp;</div></li><li><div>        $dec = ord( $c );&nbsp;</div></li><li><div>        if ( ( $i == 0 ) && ( $dec == 46 ) ) { // convert first point in the line into =2E&nbsp;</div></li><li><div>          $c = '=2E';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $dec == 32 ) {&nbsp;</div></li><li><div>          if ( $i == ( $linlen - 1 ) ) { // convert space at eol only&nbsp;</div></li><li><div>            $c = '=20';&nbsp;</div></li><li><div>          } else if ( $space_conv ) {&nbsp;</div></li><li><div>            $c = '=20';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        } elseif ( ($dec == 61) || ($dec &lt; 32 ) || ($dec &gt; 126) ) { // always encode &quot;\t&quot;, which is *not* required&nbsp;</div></li><li><div>          $h2 = floor($dec/16);&nbsp;</div></li><li><div>          $h1 = floor($dec%16);&nbsp;</div></li><li><div>          $c = $escape.$hex[$h2].$hex[$h1];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( (strlen($newline) + strlen($c)) &gt;= $line_max ) { // CRLF is not counted&nbsp;</div></li><li><div>          $output .= $newline.$escape.$eol; //  soft line break; &quot; =\r\n&quot; is okay&nbsp;</div></li><li><div>          $newline = '';&nbsp;</div></li><li><div>          // check if newline first character will be point or not&nbsp;</div></li><li><div>          if ( $dec == 46 ) {&nbsp;</div></li><li><div>            $c = '=2E';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $newline .= $c;&nbsp;</div></li><li><div>      } // end of for&nbsp;</div></li><li><div>      $output .= $newline.$eol;&nbsp;</div></li><li><div>    } // end of while&nbsp;</div></li><li><div>    return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Callback for converting to &quot;=XX&quot;.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function EncodeQ_callback ($matches) {&nbsp;</div></li><li><div>    return sprintf('=%02X', ord($matches[1]));&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Encode string to q encoding.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function EncodeQ ($str, $position = 'text') {&nbsp;</div></li><li><div>    /** There should not be any EOL in the string */&nbsp;</div></li><li><div>    $encoded = preg_replace(&quot;/[\r\n]/&quot;, '', $str);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    switch (strtolower($position)) {&nbsp;</div></li><li><div>      case 'phrase':&nbsp;</div></li><li><div>        $encoded = preg_replace_callback(&quot;/([^A-Za-z0-9!*+\/ -])/&quot;, &nbsp;</div></li><li><div>                                         array('PHPMailer', 'EncodeQ_callback'), $encoded);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'comment':&nbsp;</div></li><li><div>        $encoded = preg_replace_callback(&quot;/([\(\)\&quot;])/&quot;, &nbsp;</div></li><li><div>                                         array('PHPMailer', 'EncodeQ_callback'), $encoded);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      case 'text':&nbsp;</div></li><li><div>      default:&nbsp;</div></li><li><div>        /** Replace every high ascii, control =, ? and _ characters */&nbsp;</div></li><li><div>        $encoded = preg_replace_callback('/([\000-\011\013\014\016-\037\075\077\137\177-\377])/', &nbsp;</div></li><li><div>                                         array('PHPMailer', 'EncodeQ_callback'), $encoded);&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Replace every spaces to _ (more readable than =20) */&nbsp;</div></li><li><div>    $encoded = str_replace(' ', '_', $encoded);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $encoded;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Adds a string or binary attachment (non-filesystem) to the list.&nbsp;</div></li><li><div>   * This method can be used to attach ascii or binary data, &nbsp;</div></li><li><div>   * such as a BLOB record from a database.&nbsp;</div></li><li><div>   * @param string $string String attachment data.&nbsp;</div></li><li><div>   * @param string $filename Name of the attachment.&nbsp;</div></li><li><div>   * @param string $encoding File encoding (see $Encoding).&nbsp;</div></li><li><div>   * @param string $type File extension (MIME) type.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddStringAttachment($string, $filename, $encoding = 'base64', $type = 'application/octet-stream') {&nbsp;</div></li><li><div>    /** Append to $attachment array */&nbsp;</div></li><li><div>    $cur = count($this-&gt;attachment);&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][0] = $string;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][1] = $filename;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][2] = $filename;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][3] = $encoding;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][4] = $type;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][5] = true; // isString&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][6] = 'attachment';&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][7] = 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Adds an embedded attachment.  This can include images, sounds, and&nbsp;</div></li><li><div>   * just about any other document.  Make sure to set the $type to an&nbsp;</div></li><li><div>   * image type.  For JPEG images use &quot;image/jpeg&quot; and for GIF images&nbsp;</div></li><li><div>   * use &quot;image/gif&quot;.&nbsp;</div></li><li><div>   * @param string $path Path to the attachment.&nbsp;</div></li><li><div>   * @param string $cid Content ID of the attachment.  Use this to identify&nbsp;</div></li><li><div>   *        the Id for accessing the image in an HTML form.&nbsp;</div></li><li><div>   * @param string $name Overrides the attachment name.&nbsp;</div></li><li><div>   * @param string $encoding File encoding (see $Encoding).&nbsp;</div></li><li><div>   * @param string $type File extension (MIME) type.&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddEmbeddedImage($path, $cid, $name = '', $encoding = 'base64', $type = 'application/octet-stream') {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(!@is_file($path)) {&nbsp;</div></li><li><div>      $this-&gt;SetError($this-&gt;Lang('file_access') . $path);&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    $filename = basename($path);&nbsp;</div></li><li><div>    if($name == '') {&nbsp;</div></li><li><div>      $name = $filename;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** Append to $attachment array */&nbsp;</div></li><li><div>    $cur = count($this-&gt;attachment);&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][0] = $path;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][1] = $filename;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][2] = $name;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][3] = $encoding;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][4] = $type;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][5] = false;&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][6] = 'inline';&nbsp;</div></li><li><div>    $this-&gt;attachment[$cur][7] = $cid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns true if an inline attachment is present.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function InlineImageExists() {&nbsp;</div></li><li><div>    $result = false;&nbsp;</div></li><li><div>    for($i = 0; $i &lt; count($this-&gt;attachment); $i++) {&nbsp;</div></li><li><div>      if($this-&gt;attachment[$i][6] == 'inline') {&nbsp;</div></li><li><div>        $result = true;&nbsp;</div></li><li><div>        break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // CLASS METHODS, MESSAGE RESET&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Clears all recipients assigned in the TO array.  Returns void.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function ClearAddresses() {&nbsp;</div></li><li><div>    $this-&gt;to = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Clears all recipients assigned in the CC array.  Returns void.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function ClearCCs() {&nbsp;</div></li><li><div>    $this-&gt;cc = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Clears all recipients assigned in the BCC array.  Returns void.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function ClearBCCs() {&nbsp;</div></li><li><div>    $this-&gt;bcc = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Clears all recipients assigned in the ReplyTo array.  Returns void.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function ClearReplyTos() {&nbsp;</div></li><li><div>    $this-&gt;ReplyTo = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Clears all recipients assigned in the TO, CC and BCC&nbsp;</div></li><li><div>   * array.  Returns void.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function ClearAllRecipients() {&nbsp;</div></li><li><div>    $this-&gt;to = array();&nbsp;</div></li><li><div>    $this-&gt;cc = array();&nbsp;</div></li><li><div>    $this-&gt;bcc = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Clears all previously set filesystem, string, and binary&nbsp;</div></li><li><div>   * attachments.  Returns void.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function ClearAttachments() {&nbsp;</div></li><li><div>    $this-&gt;attachment = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Clears all custom headers.  Returns void.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function ClearCustomHeaders() {&nbsp;</div></li><li><div>    $this-&gt;CustomHeader = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>  // CLASS METHODS, MISCELLANEOUS&nbsp;</div></li><li><div>  /////////////////////////////////////////////////&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Adds the error message to the error container.&nbsp;</div></li><li><div>   * Returns void.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function SetError($msg) {&nbsp;</div></li><li><div>    $this-&gt;error_count++;&nbsp;</div></li><li><div>    $this-&gt;ErrorInfo = $msg;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns the proper RFC 822 formatted date.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function RFCDate() {&nbsp;</div></li><li><div>    $tz = date('Z');&nbsp;</div></li><li><div>    $tzs = ($tz &lt; 0) ? '-' : '+';&nbsp;</div></li><li><div>    $tz = abs($tz);&nbsp;</div></li><li><div>    $tz = (int)($tz/3600)*100 + ($tz%3600)/60;&nbsp;</div></li><li><div>    $result = sprintf(&quot;%s %s%04d&quot;, date('D, j M Y H:i:s'), $tzs, $tz);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns the appropriate server variable.  Should work with both&nbsp;</div></li><li><div>   * PHP 4.1.0+ as well as older versions.  Returns an empty string&nbsp;</div></li><li><div>   * if nothing is found.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return mixed&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function ServerVar($varName) {&nbsp;</div></li><li><div>    global $HTTP_SERVER_VARS;&nbsp;</div></li><li><div>    global $HTTP_ENV_VARS;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(!isset($_SERVER)) {&nbsp;</div></li><li><div>      $_SERVER = $HTTP_SERVER_VARS;&nbsp;</div></li><li><div>      if(!isset($_SERVER['REMOTE_ADDR'])) {&nbsp;</div></li><li><div>        $_SERVER = $HTTP_ENV_VARS; // must be Apache&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(isset($_SERVER[$varName])) {&nbsp;</div></li><li><div>      return $_SERVER[$varName];&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      return '';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns the server hostname or 'localhost.localdomain' if unknown.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function ServerHostname() {&nbsp;</div></li><li><div>    if ($this-&gt;Hostname != '') {&nbsp;</div></li><li><div>      $result = $this-&gt;Hostname;&nbsp;</div></li><li><div>    } elseif ($this-&gt;ServerVar('SERVER_NAME') != '') {&nbsp;</div></li><li><div>      $result = $this-&gt;ServerVar('SERVER_NAME');&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $result = 'localhost.localdomain';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    return $result;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns a message in the appropriate language.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function Lang($key) {&nbsp;</div></li><li><div>    if(count($this-&gt;language) &lt; 1) {&nbsp;</div></li><li><div>      $this-&gt;SetLanguage('en'); // set the default language&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    if(isset($this-&gt;language[$key])) {&nbsp;</div></li><li><div>      return $this-&gt;language[$key];&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      return 'Language string failed to load: ' . $key;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Returns true if an error occurred.&nbsp;</div></li><li><div>   * @return bool&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function IsError() {&nbsp;</div></li><li><div>    return ($this-&gt;error_count &gt; 0);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Changes every end of line from CR or LF to CRLF.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function FixEOL($str) {&nbsp;</div></li><li><div>    $str = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $str);&nbsp;</div></li><li><div>    $str = str_replace(&quot;\r&quot;, &quot;\n&quot;, $str);&nbsp;</div></li><li><div>    $str = str_replace(&quot;\n&quot;, $this-&gt;LE, $str);&nbsp;</div></li><li><div>    return $str;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Adds a custom header.&nbsp;</div></li><li><div>   * @return void&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function AddCustomHeader($custom_header) {&nbsp;</div></li><li><div>    $this-&gt;CustomHeader[] = explode(':', $custom_header, 2);&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Evaluates the message and returns modifications for inline images and backgrounds&nbsp;</div></li><li><div>   * @access public&nbsp;</div></li><li><div>   * @return $message&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function MsgHTML($message, $basedir='') {&nbsp;</div></li><li><div>    preg_match_all(&quot;/(src|background)=\&quot;(.*)\&quot;/Ui&quot;, $message, $images);&nbsp;</div></li><li><div>    if(isset($images[2])) {&nbsp;</div></li><li><div>      foreach($images[2] as $i =&gt; $url) {&nbsp;</div></li><li><div>        // do not change urls for absolute images (thanks to corvuscorax)&nbsp;</div></li><li><div>        if (!preg_match('/^[A-z][A-z]*:\/\//', $url)) {&nbsp;</div></li><li><div>          $filename = basename($url);&nbsp;</div></li><li><div>          $directory = dirname($url);&nbsp;</div></li><li><div>          ($directory == '.')?$directory='':'';&nbsp;</div></li><li><div>          $cid = 'cid:' . md5($filename);&nbsp;</div></li><li><div>          $fileParts = explode(&quot;.&quot;, $filename);&nbsp;</div></li><li><div>          $ext = $fileParts[1];&nbsp;</div></li><li><div>          $mimeType = $this-&gt;_mime_types($ext);&nbsp;</div></li><li><div>          if ( strlen($basedir) &gt; 1 && substr($basedir, -1) != '/') { $basedir .= '/'; }&nbsp;</div></li><li><div>          if ( strlen($directory) &gt; 1 && substr($directory, -1) != '/') { $directory .= '/'; }&nbsp;</div></li><li><div>          if ( $this-&gt;AddEmbeddedImage($basedir.$directory.$filename, md5($filename), $filename, 'base64', $mimeType) ) {&nbsp;</div></li><li><div>            $message = preg_replace(&quot;/&quot;.$images[1][$i].&quot;=\&quot;&quot;.preg_quote($url, '/').&quot;\&quot;/Ui&quot;, $images[1][$i].&quot;=\&quot;&quot;.$cid.&quot;\&quot;&quot;, $message);&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    $this-&gt;IsHTML(true);&nbsp;</div></li><li><div>    $this-&gt;Body = $message;&nbsp;</div></li><li><div>    $textMsg = trim(strip_tags(preg_replace('/&lt;(head|title|style|script)[^&gt;]*&gt;.*?&lt;\/\\1&gt;/s', '', $message)));&nbsp;</div></li><li><div>    if ( !empty($textMsg) && empty($this-&gt;AltBody) ) {&nbsp;</div></li><li><div>      $this-&gt;AltBody = html_entity_decode($textMsg);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    if ( empty($this-&gt;AltBody) ) {&nbsp;</div></li><li><div>      $this-&gt;AltBody = 'To view this email message, open the email in with HTML compatibility!' . &quot;\n\n&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Gets the mime type of the embedded or inline image&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @return mime type of ext&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function _mime_types($ext = '') {&nbsp;</div></li><li><div>    $mimes = array(&nbsp;</div></li><li><div>      'ai' =&gt;  'application/postscript', &nbsp;</div></li><li><div>      'aif' =&gt;  'audio/x-aiff', &nbsp;</div></li><li><div>      'aifc' =&gt;  'audio/x-aiff', &nbsp;</div></li><li><div>      'aiff' =&gt;  'audio/x-aiff', &nbsp;</div></li><li><div>      'avi' =&gt;  'video/x-msvideo', &nbsp;</div></li><li><div>      'bin' =&gt;  'application/macbinary', &nbsp;</div></li><li><div>      'bmp' =&gt;  'image/bmp', &nbsp;</div></li><li><div>      'class' =&gt;  'application/octet-stream', &nbsp;</div></li><li><div>      'cpt' =&gt;  'application/mac-compactpro', &nbsp;</div></li><li><div>      'css' =&gt;  'text/css', &nbsp;</div></li><li><div>      'dcr' =&gt;  'application/x-director', &nbsp;</div></li><li><div>      'dir' =&gt;  'application/x-director', &nbsp;</div></li><li><div>      'dll' =&gt;  'application/octet-stream', &nbsp;</div></li><li><div>      'dms' =&gt;  'application/octet-stream', &nbsp;</div></li><li><div>      'doc' =&gt;  'application/msword', &nbsp;</div></li><li><div>      'dvi' =&gt;  'application/x-dvi', &nbsp;</div></li><li><div>      'dxr' =&gt;  'application/x-director', &nbsp;</div></li><li><div>      'eml' =&gt;  'message/rfc822', &nbsp;</div></li><li><div>      'eps' =&gt;  'application/postscript', &nbsp;</div></li><li><div>      'exe' =&gt;  'application/octet-stream', &nbsp;</div></li><li><div>      'gif' =&gt;  'image/gif', &nbsp;</div></li><li><div>      'gtar' =&gt;  'application/x-gtar', &nbsp;</div></li><li><div>      'htm' =&gt;  'text/html', &nbsp;</div></li><li><div>      'html' =&gt;  'text/html', &nbsp;</div></li><li><div>      'jpe' =&gt;  'image/jpeg', &nbsp;</div></li><li><div>      'jpeg' =&gt;  'image/jpeg', &nbsp;</div></li><li><div>      'jpg' =&gt;  'image/jpeg', &nbsp;</div></li><li><div>      'hqx' =&gt;  'application/mac-binhex40', &nbsp;</div></li><li><div>      'js' =&gt;  'application/x-javascript', &nbsp;</div></li><li><div>      'lha' =&gt;  'application/octet-stream', &nbsp;</div></li><li><div>      'log' =&gt;  'text/plain', &nbsp;</div></li><li><div>      'lzh' =&gt;  'application/octet-stream', &nbsp;</div></li><li><div>      'mid' =&gt;  'audio/midi', &nbsp;</div></li><li><div>      'midi' =&gt;  'audio/midi', &nbsp;</div></li><li><div>      'mif' =&gt;  'application/vnd.mif', &nbsp;</div></li><li><div>      'mov' =&gt;  'video/quicktime', &nbsp;</div></li><li><div>      'movie' =&gt;  'video/x-sgi-movie', &nbsp;</div></li><li><div>      'mp2' =&gt;  'audio/mpeg', &nbsp;</div></li><li><div>      'mp3' =&gt;  'audio/mpeg', &nbsp;</div></li><li><div>      'mpe' =&gt;  'video/mpeg', &nbsp;</div></li><li><div>      'mpeg' =&gt;  'video/mpeg', &nbsp;</div></li><li><div>      'mpg' =&gt;  'video/mpeg', &nbsp;</div></li><li><div>      'mpga' =&gt;  'audio/mpeg', &nbsp;</div></li><li><div>      'oda' =&gt;  'application/oda', &nbsp;</div></li><li><div>      'pdf' =&gt;  'application/pdf', &nbsp;</div></li><li><div>      'php' =&gt;  'application/x-httpd-php', &nbsp;</div></li><li><div>      'php3' =&gt;  'application/x-httpd-php', &nbsp;</div></li><li><div>      'php4' =&gt;  'application/x-httpd-php', &nbsp;</div></li><li><div>      'phps' =&gt;  'application/x-httpd-php-source', &nbsp;</div></li><li><div>      'phtml' =&gt;  'application/x-httpd-php', &nbsp;</div></li><li><div>      'png' =&gt;  'image/png', &nbsp;</div></li><li><div>      'ppt' =&gt;  'application/vnd.ms-powerpoint', &nbsp;</div></li><li><div>      'ps' =&gt;  'application/postscript', &nbsp;</div></li><li><div>      'psd' =&gt;  'application/octet-stream', &nbsp;</div></li><li><div>      'qt' =&gt;  'video/quicktime', &nbsp;</div></li><li><div>      'ra' =&gt;  'audio/x-realaudio', &nbsp;</div></li><li><div>      'ram' =&gt;  'audio/x-pn-realaudio', &nbsp;</div></li><li><div>      'rm' =&gt;  'audio/x-pn-realaudio', &nbsp;</div></li><li><div>      'rpm' =&gt;  'audio/x-pn-realaudio-plugin', &nbsp;</div></li><li><div>      'rtf' =&gt;  'text/rtf', &nbsp;</div></li><li><div>      'rtx' =&gt;  'text/richtext', &nbsp;</div></li><li><div>      'rv' =&gt;  'video/vnd.rn-realvideo', &nbsp;</div></li><li><div>      'sea' =&gt;  'application/octet-stream', &nbsp;</div></li><li><div>      'shtml' =&gt;  'text/html', &nbsp;</div></li><li><div>      'sit' =&gt;  'application/x-stuffit', &nbsp;</div></li><li><div>      'so' =&gt;  'application/octet-stream', &nbsp;</div></li><li><div>      'smi' =&gt;  'application/smil', &nbsp;</div></li><li><div>      'smil' =&gt;  'application/smil', &nbsp;</div></li><li><div>      'swf' =&gt;  'application/x-shockwave-flash', &nbsp;</div></li><li><div>      'tar' =&gt;  'application/x-tar', &nbsp;</div></li><li><div>      'text' =&gt;  'text/plain', &nbsp;</div></li><li><div>      'txt' =&gt;  'text/plain', &nbsp;</div></li><li><div>      'tgz' =&gt;  'application/x-tar', &nbsp;</div></li><li><div>      'tif' =&gt;  'image/tiff', &nbsp;</div></li><li><div>      'tiff' =&gt;  'image/tiff', &nbsp;</div></li><li><div>      'wav' =&gt;  'audio/x-wav', &nbsp;</div></li><li><div>      'wbxml' =&gt;  'application/vnd.wap.wbxml', &nbsp;</div></li><li><div>      'wmlc' =&gt;  'application/vnd.wap.wmlc', &nbsp;</div></li><li><div>      'word' =&gt;  'application/msword', &nbsp;</div></li><li><div>      'xht' =&gt;  'application/xhtml+xml', &nbsp;</div></li><li><div>      'xhtml' =&gt;  'application/xhtml+xml', &nbsp;</div></li><li><div>      'xl' =&gt;  'application/excel', &nbsp;</div></li><li><div>      'xls' =&gt;  'application/vnd.ms-excel', &nbsp;</div></li><li><div>      'xml' =&gt;  'text/xml', &nbsp;</div></li><li><div>      'xsl' =&gt;  'text/xml', &nbsp;</div></li><li><div>      'zip' =&gt;  'application/zip'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    return ( ! isset($mimes[strtolower($ext)])) ? 'application/octet-stream' : $mimes[strtolower($ext)];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Set (or reset) Class Objects (variables)&nbsp;</div></li><li><div>   *&nbsp;</div></li><li><div>   * Usage Example:&nbsp;</div></li><li><div>   * $page-&gt;set('X-Priority', '3');&nbsp;</div></li><li><div>   *&nbsp;</div></li><li><div>   * @access public&nbsp;</div></li><li><div>   * @param string $name Parameter Name&nbsp;</div></li><li><div>   * @param mixed $value Parameter Value&nbsp;</div></li><li><div>   * NOTE: will not work with arrays, there are no arrays to set/reset&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function set ( $name, $value = '' ) {&nbsp;</div></li><li><div>    if ( isset($this-&gt;$name) ) {&nbsp;</div></li><li><div>      $this-&gt;$name = $value;&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      $this-&gt;SetError('Cannot set or reset variable ' . $name);&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Read a file from a supplied filename and return it.&nbsp;</div></li><li><div>   *&nbsp;</div></li><li><div>   * @access public&nbsp;</div></li><li><div>   * @param string $filename Parameter File Name&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function getFile($filename) {&nbsp;</div></li><li><div>    $return = '';&nbsp;</div></li><li><div>    if ($fp = fopen($filename, 'rb')) {&nbsp;</div></li><li><div>      while (!feof($fp)) {&nbsp;</div></li><li><div>        $return .= fread($fp, 1024);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      fclose($fp);&nbsp;</div></li><li><div>      return $return;&nbsp;</div></li><li><div>    } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Strips newlines to prevent header injection.&nbsp;</div></li><li><div>   * @access private&nbsp;</div></li><li><div>   * @param string $str String&nbsp;</div></li><li><div>   * @return string&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function SecureHeader($str) {&nbsp;</div></li><li><div>    $str = trim($str);&nbsp;</div></li><li><div>    $str = str_replace(&quot;\r&quot;, &quot;&quot;, $str);&nbsp;</div></li><li><div>    $str = str_replace(&quot;\n&quot;, &quot;&quot;, $str);&nbsp;</div></li><li><div>    return $str;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  /**&nbsp;</div></li><li><div>   * Set the private key file and password to sign the message.&nbsp;</div></li><li><div>   *&nbsp;</div></li><li><div>   * @access public&nbsp;</div></li><li><div>   * @param string $key_filename Parameter File Name&nbsp;</div></li><li><div>   * @param string $key_pass Password for private key&nbsp;</div></li><li><div>   */&nbsp;</div></li><li><div>  function Sign($cert_filename, $key_filename, $key_pass) {&nbsp;</div></li><li><div>    $this-&gt;sign_cert_file = $cert_filename;&nbsp;</div></li><li><div>    $this-&gt;sign_key_file = $key_filename;&nbsp;</div></li><li><div>    $this-&gt;sign_key_pass = $key_pass;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.4</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/phpmailer/" class="active">2.8.2</a></li><li><a href="http://hookr.io/plugins/buddypress/2.8.1/classes/phpmailer/" class="">2.8.1</a></li><li><a href="http://hookr.io/plugins/buddypress/2.8.0/classes/phpmailer/" class="">2.8.0</a></li><li><a href="http://hookr.io/plugins/buddypress/2.7.5/classes/phpmailer/" class="">2.7.5</a></li><li><a href="http://hookr.io/plugins/buddypress/2.7.4/classes/phpmailer/" class="">2.7.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>PHPMailer</li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>