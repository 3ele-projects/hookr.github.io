<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.8.2" data-slug="buddypress" data-type="class" data-id="48952"><head xmlns="http://www.w3.org/1999/xhtml"><title> bb_xmlrpc_server | class | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="BB_XMLRPC_Server, class, plugin, buddypress, 2.8.2" /><meta name="description" content="XML-RPC server class to allow for remote publishing" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=da47bc4b0ee1ea34b09e03aa5b4e6f4c' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/bb_xmlrpc_server/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fbb_xmlrpc_server%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fbb_xmlrpc_server%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.2-class-bb_xmlrpc_server","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bb_xmlrpc_server" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/buddypress/2.8.2/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bb_xmlrpc_server</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.2/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.2/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.2/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="active" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.2/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>BB_XMLRPC_Server</strong></h1><p>XML-RPC server class to allow for remote publishing.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/buddypress/2.8.2/files/bp-forums-bbpress-xmlrpc/" class="file">/bp-forums/bbpress/xmlrpc.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="51" class="block" start="67"><li><div>class BB_XMLRPC_Server extends IXR_Server&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Stores the last error generated by the class&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @var object|boolean An instance of the IXR_Error class or false if no error exists&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $error = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Site options which can be manipulated using XML-RPC&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $site_options = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether read-only methods require authentication&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @var boolean&nbsp;</div></li><li><div>     **/&nbsp;</div></li><li><div>    var $auth_readonly = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether user switching is allowed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @var boolean&nbsp;</div></li><li><div>     **/&nbsp;</div></li><li><div>    var $allow_user_switching = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initialises the XML-RPC server&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __construct()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // bbPress publishing API&nbsp;</div></li><li><div>        if ( bb_get_option( 'enable_xmlrpc' ) ) {&nbsp;</div></li><li><div>            $this-&gt;methods = array(&nbsp;</div></li><li><div>                // - Demo&nbsp;</div></li><li><div>                'demo.sayHello' =&gt; 'this:sayHello', &nbsp;</div></li><li><div>                'demo.addTwoNumbers' =&gt; 'this:addTwoNumbers', &nbsp;</div></li><li><div>                // - Forums&nbsp;</div></li><li><div>                'bb.getForumCount' =&gt; 'this:bb_getForumCount', &nbsp;</div></li><li><div>                'bb.getForums' =&gt; 'this:bb_getForums', &nbsp;</div></li><li><div>                'bb.getForum' =&gt; 'this:bb_getForum', &nbsp;</div></li><li><div>                'bb.newForum' =&gt; 'this:bb_newForum', &nbsp;</div></li><li><div>                'bb.editForum' =&gt; 'this:bb_editForum', &nbsp;</div></li><li><div>                'bb.deleteForum' =&gt; 'this:bb_deleteForum', &nbsp;</div></li><li><div>                // - Topics&nbsp;</div></li><li><div>                'bb.getTopicCount' =&gt; 'this:bb_getTopicCount', &nbsp;</div></li><li><div>                'bb.getTopics' =&gt; 'this:bb_getTopics', &nbsp;</div></li><li><div>                'bb.getTopic' =&gt; 'this:bb_getTopic', &nbsp;</div></li><li><div>                'bb.newTopic' =&gt; 'this:bb_newTopic', &nbsp;</div></li><li><div>                'bb.editTopic' =&gt; 'this:bb_editTopic', &nbsp;</div></li><li><div>                'bb.deleteTopic' =&gt; 'this:bb_deleteTopic', // Also undeletes&nbsp;</div></li><li><div>                'bb.moveTopic' =&gt; 'this:bb_moveTopic', &nbsp;</div></li><li><div>                'bb.stickTopic' =&gt; 'this:bb_stickTopic', // Also unsticks&nbsp;</div></li><li><div>                'bb.closeTopic' =&gt; 'this:bb_closeTopic', // Also opens&nbsp;</div></li><li><div>                'bb.getTopicStatusList' =&gt; 'this:bb_getTopicStatusList', &nbsp;</div></li><li><div>                // - Posts (replies)&nbsp;</div></li><li><div>                'bb.getPostCount' =&gt; 'this:bb_getPostCount', &nbsp;</div></li><li><div>                'bb.getPosts' =&gt; 'this:bb_getPosts', &nbsp;</div></li><li><div>                'bb.getPost' =&gt; 'this:bb_getPost', &nbsp;</div></li><li><div>                'bb.newPost' =&gt; 'this:bb_newPost', &nbsp;</div></li><li><div>                'bb.editPost' =&gt; 'this:bb_editPost', &nbsp;</div></li><li><div>                'bb.deletePost' =&gt; 'this:bb_deletePost', // Also undeletes&nbsp;</div></li><li><div>                'bb.getPostStatusList' =&gt; 'this:bb_getPostStatusList', &nbsp;</div></li><li><div>                // - Topic Tags&nbsp;</div></li><li><div>                'bb.getHotTopicTags' =&gt; 'this:bb_getHotTopicTags', &nbsp;</div></li><li><div>                'bb.getTopicTagCount' =&gt; 'this:bb_getTopicTagCount', &nbsp;</div></li><li><div>                'bb.getTopicTags' =&gt; 'this:bb_getTopicTags', &nbsp;</div></li><li><div>                'bb.getTopicTag' =&gt; 'this:bb_getTopicTag', &nbsp;</div></li><li><div>                'bb.addTopicTags' =&gt; 'this:bb_addTopicTags', &nbsp;</div></li><li><div>                'bb.removeTopicTags' =&gt; 'this:bb_removeTopicTags', &nbsp;</div></li><li><div>                'bb.renameTopicTag' =&gt; 'this:bb_renameTopicTag', &nbsp;</div></li><li><div>                'bb.mergeTopicTags' =&gt; 'this:bb_mergeTopicTags', &nbsp;</div></li><li><div>                'bb.destroyTopicTag' =&gt; 'this:bb_destroyTopicTag', &nbsp;</div></li><li><div>                // - Options&nbsp;</div></li><li><div>                'bb.getOptions' =&gt; 'this:bb_getOptions', &nbsp;</div></li><li><div>                'bb.setOptions' =&gt; 'this:bb_setOptions'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Pingback&nbsp;</div></li><li><div>        if ( bb_get_option( 'enable_pingback' ) ) {&nbsp;</div></li><li><div>            $this-&gt;methods = array_merge( (array)$this-&gt;methods, array(&nbsp;</div></li><li><div>                'pingback.ping' =&gt; 'this:pingback_ping', &nbsp;</div></li><li><div>                'pingback.extensions.getPingbacks' =&gt; 'this:pingback_extensions_getPingbacks'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Tells read-only methods whether they require authentication or not&nbsp;</div></li><li><div>        $this-&gt;auth_readonly = apply_filters( 'bb_xmlrpc_auth_readonly', $this-&gt;auth_readonly );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Whether or not to allow user switching&nbsp;</div></li><li><div>        $this-&gt;allow_user_switching = bb_get_option( 'bb_xmlrpc_allow_user_switching' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;initialise_site_option_info();&nbsp;</div></li><li><div>        $this-&gt;methods = apply_filters( 'bb_xmlrpc_methods', $this-&gt;methods );&nbsp;</div></li><li><div>        $this-&gt;IXR_Server( $this-&gt;methods );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function BB_XMLRPC_Server()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;__construct();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Utility methods&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Checks the user credentials supplied in the request to make sure they are valid&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|boolean The user id if the user is valid, otherwise false&nbsp;</div></li><li><div>     * @param string $user_login The users login&nbsp;</div></li><li><div>     * @param string $user_pass The users password in plain text&nbsp;</div></li><li><div>     * @param string $capability The capability to check (optional)&nbsp;</div></li><li><div>     * @param string $message The message to pass back in the error if the capability check fails (optional)&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function authenticate( $user_login, $user_pass, $capability = 'read', $message = false )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( is_array( $user_login ) ) {&nbsp;</div></li><li><div>            $auth_user_login = (string) $user_login[0];&nbsp;</div></li><li><div>            $switch_user_login = (string) $user_login[1];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $auth_user_login = (string) $user_login;&nbsp;</div></li><li><div>            $switch_user_login = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Check the login&nbsp;</div></li><li><div>        $user = bb_check_login( $auth_user_login, $user_pass );&nbsp;</div></li><li><div>        if ( !$user || is_wp_error( $user ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'Authentication failed.' ) );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set the current user&nbsp;</div></li><li><div>        $user = bb_set_current_user( $user-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to do this&nbsp;</div></li><li><div>        if ( !bb_current_user_can( $capability ) ) {&nbsp;</div></li><li><div>            if ( !$message ) {&nbsp;</div></li><li><div>                $message = __( 'You do not have permission to read this.' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, $message );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Switch the user if requested and allowed&nbsp;</div></li><li><div>        if ( $switch_user_login && $this-&gt;allow_user_switching && bb_current_user_can( 'edit_users' ) ) {&nbsp;</div></li><li><div>            $user = $this-&gt;switch_user( $switch_user_login, $capability, $message );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $user;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Switches the currently active user for incognito actions&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|boolean The user id if the user is valid, otherwise false&nbsp;</div></li><li><div>     * @param string $user_login The users login&nbsp;</div></li><li><div>     * @param string $capability The capability to check (optional)&nbsp;</div></li><li><div>     * @param string $message The message to pass back in the error if the capability check fails (optional)&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function switch_user( $user_login, $capability = 'read', $message = false )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Just get the user, authentication has already been established by the &nbsp;</div></li><li><div>        $user = bb_get_user( $user_login, array( 'by' =&gt; 'login' ) );&nbsp;</div></li><li><div>        if ( !$user || is_wp_error( $user ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'User switching failed, the requested user does not exist.' ) );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set the current user&nbsp;</div></li><li><div>        $user = bb_set_current_user( $user-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to do this&nbsp;</div></li><li><div>        if ( !bb_current_user_can( $capability ) ) {&nbsp;</div></li><li><div>            if ( !$message ) {&nbsp;</div></li><li><div>                $message = __( 'You do not have permission to read this.' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, $message );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $user;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sanitises data from XML-RPC request parameters&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return mixed The sanitised variable, should come back with the same type&nbsp;</div></li><li><div>     * @param $array mixed The variable to be sanitised&nbsp;</div></li><li><div>     * @uses $bbdb BackPress database class instance&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function escape( &$array )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        global $bbdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !is_array( $array ) ) {&nbsp;</div></li><li><div>            // Escape it&nbsp;</div></li><li><div>            $array = $bbdb-&gt;escape( $array );&nbsp;</div></li><li><div>        } elseif ( count( $array ) ) {&nbsp;</div></li><li><div>            foreach ( (array) $array as $k =&gt; $v ) {&nbsp;</div></li><li><div>                if ( is_array( $v ) ) {&nbsp;</div></li><li><div>                    // Recursively sanitize arrays&nbsp;</div></li><li><div>                    $this-&gt;escape( $array[$k] );&nbsp;</div></li><li><div>                } elseif ( is_object( $v ) ) {&nbsp;</div></li><li><div>                    // Don't sanitise objects - shouldn't happen anyway&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // Escape it&nbsp;</div></li><li><div>                    $array[$k] = $bbdb-&gt;escape( $v );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $array;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares forum data for return in an XML-RPC object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array The prepared forum data&nbsp;</div></li><li><div>     * @param array|object The unprepared forum data&nbsp;</div></li><li><div>     **/&nbsp;</div></li><li><div>    function prepare_forum( $forum )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Cast to an array&nbsp;</div></li><li><div>        $_forum = (array) $forum;&nbsp;</div></li><li><div>        // Set the URI&nbsp;</div></li><li><div>        $_forum['forum_uri'] = get_forum_link( $_forum['forum_id'] );&nbsp;</div></li><li><div>        // Give this a definite value&nbsp;</div></li><li><div>        if ( !isset( $_forum['forum_is_category'] ) ) {&nbsp;</div></li><li><div>            $_forum['forum_is_category'] = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Allow plugins to modify the data&nbsp;</div></li><li><div>        return apply_filters( 'bb_xmlrpc_prepare_forum', $_forum, (array) $forum );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares topic data for return in an XML-RPC object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array The prepared topic data&nbsp;</div></li><li><div>     * @param array|object The unprepared topic data&nbsp;</div></li><li><div>     **/&nbsp;</div></li><li><div>    function prepare_topic( $topic )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Cast to an array&nbsp;</div></li><li><div>        $_topic = (array) $topic;&nbsp;</div></li><li><div>        // Set the URI&nbsp;</div></li><li><div>        $_topic['topic_uri'] = get_topic_link( $_topic['topic_id'] );&nbsp;</div></li><li><div>        // Set readable times&nbsp;</div></li><li><div>        $_topic['topic_start_time_since'] = bb_since( $_topic['topic_start_time'] );&nbsp;</div></li><li><div>        $_topic['topic_time_since'] = bb_since( $_topic['topic_time'] );&nbsp;</div></li><li><div>        // Set the display names&nbsp;</div></li><li><div>        $_topic['topic_poster_display_name'] = get_user_display_name( $_topic['topic_poster'] );&nbsp;</div></li><li><div>        $_topic['topic_last_poster_display_name'] = get_user_display_name( $_topic['topic_last_poster'] );&nbsp;</div></li><li><div>        // Remove some sensitive user ids&nbsp;</div></li><li><div>        unset(&nbsp;</div></li><li><div>            $_topic['topic_poster'], &nbsp;</div></li><li><div>            $_topic['topic_last_poster']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        // Allow plugins to modify the data&nbsp;</div></li><li><div>        return apply_filters( 'bb_xmlrpc_prepare_topic', $_topic, (array) $topic );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares post data for return in an XML-RPC object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array The prepared post data&nbsp;</div></li><li><div>     * @param array|object The unprepared post data&nbsp;</div></li><li><div>     **/&nbsp;</div></li><li><div>    function prepare_post( $post )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Cast to an array&nbsp;</div></li><li><div>        $_post = (array) $post;&nbsp;</div></li><li><div>        // Set the URI&nbsp;</div></li><li><div>        $_post['post_uri'] = get_post_link( $_post['post_id'] );&nbsp;</div></li><li><div>        // Set readable times&nbsp;</div></li><li><div>        $_post['post_time_since'] = bb_since( $_post['post_time'] );&nbsp;</div></li><li><div>        // Set the display names&nbsp;</div></li><li><div>        $_post['poster_display_name'] = get_user_display_name( $_post['poster_id'] );&nbsp;</div></li><li><div>        // Remove some sensitive data&nbsp;</div></li><li><div>        unset(&nbsp;</div></li><li><div>            $_post['poster_id'], &nbsp;</div></li><li><div>            $_post['poster_ip'], &nbsp;</div></li><li><div>            $_post['pingback_queued']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        // Allow plugins to modify the data&nbsp;</div></li><li><div>        return apply_filters( 'bb_xmlrpc_prepare_post', $_post, (array) $post );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares topic tag data for return in an XML-RPC object&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array The prepared topic tag data&nbsp;</div></li><li><div>     * @param array|object The unprepared topic tag data&nbsp;</div></li><li><div>     **/&nbsp;</div></li><li><div>    function prepare_topic_tag( $tag )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Cast to an array&nbsp;</div></li><li><div>        $_tag = (array) $tag;&nbsp;</div></li><li><div>        // Set the URI&nbsp;</div></li><li><div>        $_tag['topic_tag_uri'] = bb_get_tag_link( $tag );&nbsp;</div></li><li><div>        // Consistent nomenclature&nbsp;</div></li><li><div>        $_tag['topic_tag_name'] = (string) $_tag['name'];&nbsp;</div></li><li><div>        $_tag['topic_tag_slug'] = (string) $_tag['slug'];&nbsp;</div></li><li><div>        $_tag['topic_tag_count'] = (int) $_tag['count'];&nbsp;</div></li><li><div>        // Remove some sensitive data&nbsp;</div></li><li><div>        unset(&nbsp;</div></li><li><div>            $_tag['object_id'], &nbsp;</div></li><li><div>            $_tag['name'], &nbsp;</div></li><li><div>            $_tag['slug'], &nbsp;</div></li><li><div>            $_tag['count'], &nbsp;</div></li><li><div>            $_tag['term_id'], &nbsp;</div></li><li><div>            $_tag['term_group'], &nbsp;</div></li><li><div>            $_tag['term_taxonomy_id'], &nbsp;</div></li><li><div>            $_tag['taxonomy'], &nbsp;</div></li><li><div>            $_tag['description'], &nbsp;</div></li><li><div>            $_tag['parent'], &nbsp;</div></li><li><div>            $_tag['count'], &nbsp;</div></li><li><div>            $_tag['user_id'], &nbsp;</div></li><li><div>            $_tag['tag_id'], &nbsp;</div></li><li><div>            $_tag['tag'], &nbsp;</div></li><li><div>            $_tag['raw_tag'], &nbsp;</div></li><li><div>            $_tag['tag_count']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        // Allow plugins to modify the data&nbsp;</div></li><li><div>        return apply_filters( 'bb_xmlrpc_prepare_topic_tag', $_tag, (array) $tag );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * bbPress publishing API - Demo XML-RPC methods&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Hello world demo function for XML-RPC&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return string The phrase 'Hello!'&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a greeting&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;demo.sayHello&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function sayHello( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly && !$this-&gt;authenticate( $username, $password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return 'Hello!';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds two numbers together as a demo of XML-RPC&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer The sum of the two supplied numbers&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer $args[2] The first number to be added&nbsp;</div></li><li><div>     * @param integer $args[3] The second number to be added&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the sum of two numbers&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;demo.addTwoNumbers&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;5&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;102&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function addTwoNumbers( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly && !$this-&gt;authenticate( $username, $password ) ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $number1 = (int) $args[2];&nbsp;</div></li><li><div>        $number2 = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ( $number1 + $number2 );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * bbPress publishing API - Forum XML-RPC methods&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns a numerical count of forums&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object The number of forums when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The parent forum's id or slug (optional)&nbsp;</div></li><li><div>     * @param integer $args[3] The depth of child forums to retrieve (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a count of all forums in the bbPress instance&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForumCount&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a count of all child forums in the forum with id number 34&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForumCount&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;34&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a count of all child forums in the forum with slug &quot;first-forum&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForumCount&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;first-forum&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a count of all child forums in the forum with id number 34 no more than 2 forums deep in the hierarchy&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForumCount&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;34&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;2&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getForumCount( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getForumCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getForumCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup an array to store arguments to pass to bb_get_forums() function&nbsp;</div></li><li><div>        $get_forums_args = array(&nbsp;</div></li><li><div>            'child_of' =&gt; 0, &nbsp;</div></li><li><div>            'hierarchical' =&gt; 0, &nbsp;</div></li><li><div>            'depth' =&gt; 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $forum_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $forum_id ) {&nbsp;</div></li><li><div>            // Check for bad data&nbsp;</div></li><li><div>            if ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Check the requested forum exists&nbsp;</div></li><li><div>            if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The forum does not exist.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Add the specific forum to the arguments&nbsp;</div></li><li><div>            $get_forums_args['child_of'] = (int) $forum-&gt;forum_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be an integer&nbsp;</div></li><li><div>        $depth = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $depth &gt; 0 ) {&nbsp;</div></li><li><div>            // Add the depth to traverse to the arguments&nbsp;</div></li><li><div>            $get_forums_args['depth'] = $depth;&nbsp;</div></li><li><div>            // Only make it hierarchical if the depth &gt; 1&nbsp;</div></li><li><div>            if ( $depth &gt; 1 ) {&nbsp;</div></li><li><div>                $get_forums_args['hierarchical'] = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the forums. Return 0 when no forums exist&nbsp;</div></li><li><div>        if ( !$forums = bb_get_forums( $get_forums_args ) ) {&nbsp;</div></li><li><div>            $count = 0;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $count = count( $forums );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getForumCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return a count of the forums&nbsp;</div></li><li><div>        return $count;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns details of multiple forums&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object An array containing details of all returned forums when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The parent forum's id or slug (optional)&nbsp;</div></li><li><div>     * @param integer $args[3] The depth of child forums to retrieve (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all forums in the bbPress instance&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForums&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all child forums in the forum with id number 34&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForums&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;34&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all child forums in the forum with slug &quot;first-forum&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForums&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;first-forum&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all child forums in the forum with id number 34 no more than 2 forums deep in the hierarchy&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForums&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;34&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;2&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getForums( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getForums' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getForums' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup an array to store arguments to pass to bb_get_forums() function&nbsp;</div></li><li><div>        $get_forums_args = array(&nbsp;</div></li><li><div>            'child_of' =&gt; 0, &nbsp;</div></li><li><div>            'hierarchical' =&gt; 0, &nbsp;</div></li><li><div>            'depth' =&gt; 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $forum_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $forum_id ) {&nbsp;</div></li><li><div>            // Check for bad data&nbsp;</div></li><li><div>            if ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // First check the requested forum exists&nbsp;</div></li><li><div>            if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The forum does not exist.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Add the specific forum to the arguments&nbsp;</div></li><li><div>            $get_forums_args['child_of'] = (int) $forum-&gt;forum_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be an integer&nbsp;</div></li><li><div>        $depth = (int) $args[3];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $depth &gt; 0 ) {&nbsp;</div></li><li><div>            // Add the depth to traverse to to the arguments&nbsp;</div></li><li><div>            $get_forums_args['depth'] = $depth;&nbsp;</div></li><li><div>            // Only make it hierarchical if the depth &gt; 1&nbsp;</div></li><li><div>            if ( $depth &gt; 1 ) {&nbsp;</div></li><li><div>                $get_forums_args['hierarchical'] = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the forums. Return an error when no forums exist&nbsp;</div></li><li><div>        if ( !$forums = bb_get_forums( $get_forums_args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 404, __( 'No forums found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $_forums = array();&nbsp;</div></li><li><div>        foreach ( $forums as $forum ) {&nbsp;</div></li><li><div>            $_forums[] = $this-&gt;prepare_forum( $forum );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getForums' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the forums&nbsp;</div></li><li><div>        return $_forums;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns details of a forum&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object An array containing details of the returned forum when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The forum's id or slug&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the forum with id number 34&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForum&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;34&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the forum with slug &quot;first-forum&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getForum&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;first-forum&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getForum( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $forum_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$forum_id || ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested forum exists&nbsp;</div></li><li><div>        if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 404, __( 'No forum found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $forum = $this-&gt;prepare_forum( $forum );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the forums&nbsp;</div></li><li><div>        return $forum;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Creates a new forum&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The forum data when successfully created or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param array $args[2] The values for the various settings in the new forum&nbsp;</div></li><li><div>     * @param string $args[2]['name'] The name of the forum&nbsp;</div></li><li><div>     * @param string $args[2]['description'] The description of the forum (optional)&nbsp;</div></li><li><div>     * @param integer|string $args[2]['parent_id'] The unique id of the parent forum for this forum (optional)&nbsp;</div></li><li><div>     * @param integer $args[2]['order'] The position of the forum in the forum list (optional)&nbsp;</div></li><li><div>     * @param integer $args[2]['is_category'] Whether the forum is simply a container category (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to create a new sub-forum called &quot;A new forum&quot; inside the parent forum with id 2&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.newForum&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;struct&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;name&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;A new forum&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;parent_id&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;integer&gt;2&lt;/integer&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *         &lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_newForum( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.newForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'manage_forums', __( 'You do not have permission to manage forums.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.newForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure there is something for us to do&nbsp;</div></li><li><div>        if ( !$args[2] || !is_array( $args[2] ) || !count( $args[2] ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The forum data is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $structure = (array) $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Minimum requirement is a name for the new forum&nbsp;</div></li><li><div>        if ( !isset( $structure['name'] ) || !$structure['name'] ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The forum name is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Inject structure into an array suitable for bb_new_forum()&nbsp;</div></li><li><div>        $bb_new_forum_args = array(&nbsp;</div></li><li><div>            'forum_name' =&gt; (string) $structure['name'], &nbsp;</div></li><li><div>            'forum_desc' =&gt; (string) $structure['description'], &nbsp;</div></li><li><div>            'forum_parent' =&gt; (int) $structure['parent_id'], &nbsp;</div></li><li><div>            'forum_order' =&gt; (int) $structure['order'], &nbsp;</div></li><li><div>            'forum_is_category' =&gt; (int) $structure['is_category']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove empty settings so that changes to the defaults in bb_new_forum() are honoured&nbsp;</div></li><li><div>        $bb_new_forum_args = array_filter( $bb_new_forum_args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Leave the require until the very end&nbsp;</div></li><li><div>        require_once( BB_PATH . 'bb-admin/includes/functions.bb-admin.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Create the forum&nbsp;</div></li><li><div>        if ( !$forum_id = (int) bb_new_forum( $bb_new_forum_args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The forum could not be created.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $forum = $this-&gt;prepare_forum( bb_get_forum( $forum_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.newForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $forum;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edits an existing forum&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The forum data when successfully edited or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param array $args[2] The values for the various settings in the new forum, at least one must be specified&nbsp;</div></li><li><div>     * @param integer|string $args[2]['forum_id'] The unique id of the forum to be edited&nbsp;</div></li><li><div>     * @param string $args[2]['name'] The name of the forum (optional)&nbsp;</div></li><li><div>     * @param string $args[2]['slug'] The slug for the forum (optional)&nbsp;</div></li><li><div>     * @param string $args[2]['description'] The description of the forum (optional)&nbsp;</div></li><li><div>     * @param integer $args[2]['parent_id'] The unique id of the parent forum for this forum (optional)&nbsp;</div></li><li><div>     * @param integer $args[2]['order'] The position of the forum in the forum list (optional)&nbsp;</div></li><li><div>     * @param integer $args[2]['is_category'] Whether the forum is simply a container category (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to edit a forum with id 11, changing the description&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.editForum&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;struct&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;forum_id&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;integer&gt;11&lt;/integer&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;description&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;This is a great forum for all sorts of reasons.&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *         &lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_editForum( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.editForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'manage_forums', __( 'You do not have permission to manage forums.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.editForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure there is something for us to do&nbsp;</div></li><li><div>        if ( !$args[2] || !is_array( $args[2] ) || !count( $args[2] ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The forum data is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $structure = (array) $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $forum_id = isset( $structure['forum_id'] ) ? $structure['forum_id'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$forum_id || ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested forum exists&nbsp;</div></li><li><div>        if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No forum found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Cast the forum object as an array&nbsp;</div></li><li><div>        $forum = (array) $forum;&nbsp;</div></li><li><div>        // The forum id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $forum_id = (int) $forum['forum_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove some unneeded indexes&nbsp;</div></li><li><div>        unset( $forum['topics'] );&nbsp;</div></li><li><div>        unset( $forum['posts'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add one if it isn't there&nbsp;</div></li><li><div>        if ( !isset( $forum['forum_is_category'] ) ) {&nbsp;</div></li><li><div>            $forum['forum_is_category'] = 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Validate the name for the forum&nbsp;</div></li><li><div>        if ( isset( $structure['name'] ) && !$structure['name'] ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The forum name is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Inject structure into an array suitable for bb_update_forum()&nbsp;</div></li><li><div>        $bb_update_forum_args = array(&nbsp;</div></li><li><div>            'forum_name' =&gt; $structure['name']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Slug cannot be blank&nbsp;</div></li><li><div>        if ( isset( $structure['slug'] ) && $structure['slug'] !== '' ) {&nbsp;</div></li><li><div>            $bb_update_forum_args['forum_slug'] = $structure['slug'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Description can be nothing&nbsp;</div></li><li><div>        if ( isset( $structure['description'] ) ) {&nbsp;</div></li><li><div>            $bb_update_forum_args['forum_desc'] = $structure['description'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Parent forum ID must be an integer and it can be 0&nbsp;</div></li><li><div>        if ( isset( $structure['parent_id'] ) && is_integer( $structure['parent_id'] ) ) {&nbsp;</div></li><li><div>            $bb_update_forum_args['forum_parent'] = $structure['parent_id'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Order must be an integer and it can be 0&nbsp;</div></li><li><div>        if ( isset( $structure['order'] ) && is_integer( $structure['order'] ) ) {&nbsp;</div></li><li><div>            $bb_update_forum_args['forum_order'] = $structure['order'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Category flag must be an integer and it can be 0&nbsp;</div></li><li><div>        if ( isset( $structure['is_category'] ) && is_integer( $structure['is_category'] ) ) {&nbsp;</div></li><li><div>            $bb_update_forum_args['forum_is_category'] = $structure['is_category'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Merge the changes into the existing data for the forum&nbsp;</div></li><li><div>        $bb_update_forum_args = wp_parse_args( $bb_update_forum_args, $forum );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Leave the require until the very end&nbsp;</div></li><li><div>        require_once( BB_PATH . 'bb-admin/includes/functions.bb-admin.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update the forum&nbsp;</div></li><li><div>        if ( !bb_update_forum( $bb_update_forum_args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The forum could not be edited.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $forum = $this-&gt;prepare_forum( bb_get_forum( $forum_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.editForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $forum;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes a forum&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object 1 when successfully deleted or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The unique id of the forum to be deleted&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to delete a forum with the slug &quot;naughty-forum&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.deleteForum&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;naughty-forum&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_deleteForum( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.deleteForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'delete_forums', __( 'You do not have permission to delete forums.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.deleteForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $forum_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$forum_id || ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested forum exists&nbsp;</div></li><li><div>        if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No forum found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Cast the forum object as an array&nbsp;</div></li><li><div>        $forum = (array) $forum;&nbsp;</div></li><li><div>        // The forum id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $forum_id = (int) $forum['forum_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to delete this forum specifically&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'delete_forum', $forum_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to delete this forum.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Leave the require until the very end&nbsp;</div></li><li><div>        require_once( BB_PATH . 'bb-admin/includes/functions.bb-admin.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Delete the forum&nbsp;</div></li><li><div>        if ( !bb_delete_forum( $forum_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The forum could not be deleted.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.deleteForum' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * bbPress publishing API - Topic XML-RPC methods&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns a numerical count of topics&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object The number of topics when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The forum id or slug (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a count of all topics in the bbPress instance&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopicCount&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a count of all topics in the forum with id number 34&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopicCount&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;34&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a count of all topics in the forum with slug &quot;first-forum&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopicCount&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;first-forum&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getTopicCount( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getTopicCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getTopicCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        if ( isset( $args[2] ) && $forum_id = $args[2] ) {&nbsp;</div></li><li><div>            // Check for bad data&nbsp;</div></li><li><div>            if ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Check the requested forum exists&nbsp;</div></li><li><div>            if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The forum does not exist.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // OK, let's trust the count in the forum table&nbsp;</div></li><li><div>            $count = (int) $forum-&gt;topics;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // Get all forums&nbsp;</div></li><li><div>            $forums = bb_get_forums();&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>            // Return an error when no forums exist&nbsp;</div></li><li><div>            if ( !$forums ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'No forums found.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Count the topics&nbsp;</div></li><li><div>            $count = 0;&nbsp;</div></li><li><div>            foreach ( $forums as $forum ) {&nbsp;</div></li><li><div>                $count += (int) $forum-&gt;topics;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getTopicCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the count of topics&nbsp;</div></li><li><div>        return $count;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns details of the latest topics&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The topics when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The forum id or slug (optional)&nbsp;</div></li><li><div>     * @param integer $args[3] The number of topics to return (optional)&nbsp;</div></li><li><div>     * @param integer $args[4] The number of the page to return (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all topics in the bbPress instance&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopics&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all topics in the forum with id number 34&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopics&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;34&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get topics 6 to 10 in the forum with slug &quot;first-forum&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopics&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;first-forum&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;5&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;2&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getTopics( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getTopics' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getTopics' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup an array to store arguments to pass to get_topics() function&nbsp;</div></li><li><div>        $get_topics_args = array(&nbsp;</div></li><li><div>            'forum' =&gt; false, &nbsp;</div></li><li><div>            'number' =&gt; false, &nbsp;</div></li><li><div>            'page' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        if ( isset( $args[2] ) && $forum_id = $args[2] ) {&nbsp;</div></li><li><div>            // Check for bad data&nbsp;</div></li><li><div>            if ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Check the requested forum exists&nbsp;</div></li><li><div>            if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The forum does not exist.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // The forum id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>            $get_topics_args['forum'] = (int) $forum-&gt;forum_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be an integer&nbsp;</div></li><li><div>        if ( isset( $args[3] ) && $number = (int) $args[3] ) {&nbsp;</div></li><li><div>            $get_topics_args['number'] = $number;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be an integer&nbsp;</div></li><li><div>        if ( isset( $args[4] ) && $page = (int) $args[4] ) {&nbsp;</div></li><li><div>            $get_topics_args['page'] = $page;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the topics&nbsp;</div></li><li><div>        if ( !$topics = get_latest_topics( $get_topics_args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topics found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $_topics = array();&nbsp;</div></li><li><div>        foreach ( $topics as $topic ) {&nbsp;</div></li><li><div>            $_topics[] = $this-&gt;prepare_topic( $topic );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getTopics' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the topics&nbsp;</div></li><li><div>        return $_topics;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns details of a topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object An array containing details of the returned topic when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The topic's id or slug&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the topic with id number 105&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopic&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;105&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the topic with slug &quot;cheesy-biscuits&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopic&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;cheesy-biscuits&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getTopic( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $topic = $this-&gt;prepare_topic( $topic );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the topic&nbsp;</div></li><li><div>        return $topic;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Creates a new topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The topic data when successfully created or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param array $args[2] The values for the various parameters in the new topic&nbsp;</div></li><li><div>     * @param string $args[2]['title'] The title of the topic&nbsp;</div></li><li><div>     * @param string $args[2]['text'] The text of the topic&nbsp;</div></li><li><div>     * @param integer|string $args[2]['forum_id'] The unique id of the forum which will contain this topic, slugs are OK to use too&nbsp;</div></li><li><div>     * @param string|array $args[2]['tags'] A comma delimited string or an array of tags to add to the topic (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to create a new topic called &quot;Insane monkeys&quot; inside the forum with id 2&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.newTopic&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;struct&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;title&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;Insane monkeys&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;text&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;I just saw some insane monkeys eating bananas, did anyone else see that?&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;forum_id&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;integer&gt;2&lt;/integer&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;tags&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;monkeys, bananas&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *         &lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_newTopic( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.newTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'write_topics', __( 'You do not have permission to write topics.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Additionally they need to be able to write posts&nbsp;</div></li><li><div>        if ( !$this-&gt;error && !bb_current_user_can( 'write_posts' ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to write posts.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.newTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure there is something for us to do&nbsp;</div></li><li><div>        if ( !$args[2] || !is_array( $args[2] ) || !count( $args[2] ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic data is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $structure = (array) $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $forum_id = isset( $structure['forum_id'] ) ? $structure['forum_id'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$forum_id || ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested forum exists&nbsp;</div></li><li><div>        if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No forum found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The forum id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $forum_id = (int) $forum-&gt;forum_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to write topics to this forum&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'write_topic', $forum_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to write topics to this forum.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic requires a title&nbsp;</div></li><li><div>        if ( !isset( $structure['title'] ) || !$structure['title'] ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic title is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic requires text&nbsp;</div></li><li><div>        if ( !isset( $structure['text'] ) || !$structure['text'] ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic text is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Inject structure into an array suitable for bb_insert_topic()&nbsp;</div></li><li><div>        $bb_insert_topic_args = array(&nbsp;</div></li><li><div>            'topic_title' =&gt; (string) $structure['title'], &nbsp;</div></li><li><div>            'forum_id' =&gt; $forum_id, &nbsp;</div></li><li><div>            'tags' =&gt; (string) trim( $structure['tags'] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove empty settings so that changes to the defaults in bb_insert_topic() are honoured&nbsp;</div></li><li><div>        $bb_insert_topic_args = array_filter( $bb_insert_topic_args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Create the topic&nbsp;</div></li><li><div>        if ( !$topic_id = bb_insert_topic( $bb_insert_topic_args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The topic could not be created.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Inject structure into an array suitable for bb_insert_post()&nbsp;</div></li><li><div>        $bb_insert_post_args = array(&nbsp;</div></li><li><div>            'topic_id' =&gt; (int) $topic_id, &nbsp;</div></li><li><div>            'post_text' =&gt; (string) $structure['text']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Create the post&nbsp;</div></li><li><div>        if ( !$post_id = bb_insert_post( $bb_insert_post_args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The post could not be created.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $topic = $this-&gt;prepare_topic( get_topic( $topic_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.newTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $topic;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edits an existing topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The topic data when successfully edited or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param array $args[2] The values for the various parameters in the edited topic&nbsp;</div></li><li><div>     * @param integer|string $args[2]['topic_id'] The topic's id or slug&nbsp;</div></li><li><div>     * @param string $args[2]['title'] The title of the topic&nbsp;</div></li><li><div>     * @param string $args[2]['text'] The text of the topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to edit the title of a topic with the slug &quot;insane-monkeys&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.editTopic&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;struct&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;topic_id&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;insane-monkeys&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;title&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;Very insane monkeys&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *         &lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_editTopic( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.editTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'edit_topics', __( 'You do not have permission to edit topics.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Additionally they need to be able to edit posts&nbsp;</div></li><li><div>        if ( !$this-&gt;error && !bb_current_user_can( 'edit_posts' ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to edit posts.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.editTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure there is something for us to do&nbsp;</div></li><li><div>        if ( !$args[2] || !is_array( $args[2] ) || !count( $args[2] ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic data is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $structure = (array) $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $structure['topic_id'] ) ? $structure['topic_id'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to edit this topic&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'edit_topic', $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to edit this topic.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the first post in the topic (that's where the content is)&nbsp;</div></li><li><div>        if ( !$post = bb_get_first_post( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No posts found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_id = (int) $post-&gt;post_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to edit this post&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'edit_post', $post_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to edit this post.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic requires a title&nbsp;</div></li><li><div>        if ( isset( $structure['title'] ) && !$structure['title'] ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic title is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic requires text&nbsp;</div></li><li><div>        if ( isset( $structure['text'] ) && !$structure['text'] ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic text is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $structure['title'] ) {&nbsp;</div></li><li><div>            if ( !bb_insert_topic( array( 'topic_title' =&gt; (string) $structure['title'], 'topic_id' =&gt; $topic_id ) ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 500, __( 'The topic could not be edited.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $structure['text'] ) {&nbsp;</div></li><li><div>            if ( !bb_insert_post( array( 'post_text' =&gt; (string) $structure['text'], 'post_id' =&gt; $post_id, 'topic_id'=&gt; $topic_id ) ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 500, __( 'The post could not be edited.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $topic = $this-&gt;prepare_topic( get_topic( $topic_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.editTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $topic;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes a topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object 0 if already changed, 1 when successfully changed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The unique id of the topic to be deleted&nbsp;</div></li><li><div>     * @param integer $args[3] 1 deletes the topic, 0 undeletes the topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to delete a topic with id of 34&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.deleteTopic&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;integer&gt;34&lt;/integer&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_deleteTopic( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.deleteTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'delete_topics', __( 'You do not have permission to delete topics.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.deleteTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $delete = isset( $args[3] ) ? (int) $args[3] : 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Don't do anything if already set that way&nbsp;</div></li><li><div>        if ( $delete === (int) $topic-&gt;topic_status ) {&nbsp;</div></li><li><div>            return 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to delete this topic&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'delete_topic', $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to delete this topic.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Delete the topic&nbsp;</div></li><li><div>        if ( !bb_delete_topic( $topic_id, $delete ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The topic could not be deleted.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.deleteTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Moves a topic to a different forum&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object the forum id where the topic lives after the method is called or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The unique id of the topic to be moved&nbsp;</div></li><li><div>     * @param integer|string $args[3] The unique id of the forum to be moved to&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to move the topic with id of 34 to forum with slug of &quot;better-forum&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.moveTopic&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;integer&gt;34&lt;/integer&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;better-forum&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_moveTopic( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.moveTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'move_topics', __( 'You do not have permission to move topics.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.moveTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $forum_id = isset( $args[3] ) ? $args[3] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$forum_id || ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No forum found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The forum id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $forum_id = (int) $forum-&gt;forum_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only move it if it isn't already there&nbsp;</div></li><li><div>        if ( $forum_id !== (int) $topic-&gt;forum_id ) {&nbsp;</div></li><li><div>            // Make sure they are allowed to move this topic specifically to this forum&nbsp;</div></li><li><div>            if ( !bb_current_user_can( 'move_topic', $topic_id, $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 403, __( 'You are not allowed to move this topic to this forum.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Move the topic&nbsp;</div></li><li><div>            if ( !bb_move_topic( $topic_id, $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 500, __( 'The topic could not be moved.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.moveTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $forum_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sticks a topic to the top of a forum or the front page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object 0 if it is already stuck to the desired location, 1 when successfully stuck or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The unique id of the topic to be stuck&nbsp;</div></li><li><div>     * @param integer $args[3] 0 unsticks, 1 sticks, 2 sticks to front (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to stick the topic with id of 34 to the front page&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.stickTopic&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;integer&gt;34&lt;/integer&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;integer&gt;1&lt;/integer&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_stickTopic( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.stickTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'stick_topics', __( 'You do not have permission to stick topics.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.stickTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to stick this topic&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'stick_topic', $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to stick this topic.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Stick to where?&nbsp;</div></li><li><div>        $where = isset( $args[3] ) ? (int) $args[3] : 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Forget it if it's already there&nbsp;</div></li><li><div>        if ( $where === (int) $topic-&gt;topic_sticky ) {&nbsp;</div></li><li><div>            return 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Stick the topic&nbsp;</div></li><li><div>        if ( !bb_stick_topic( $topic_id, $where ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The topic could not be stuck.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.stickTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Closes a topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object 0 when already changed, 1 when successfully changed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The unique id of the topic to be closed&nbsp;</div></li><li><div>     * @param integer $args[2] 0 closes, 1 opens (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to close the topic with slug of &quot;really-old-topic&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.closeTopic&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;really-old-topic&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to open the topic with slug of &quot;really-old-topic&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.closeTopic&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;really-old-topic&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;integer&gt;1&lt;/integer&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_closeTopic( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.closeTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'close_topics', __( 'You do not have permission to close topics.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.closeTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to close this topic&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'close_topic', $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to close this topic.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Open or close?&nbsp;</div></li><li><div>        $close = isset( $args[3] ) ? (int) $args[3] : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Forget it if it's already matching&nbsp;</div></li><li><div>        if ( $close === (int) $topic-&gt;topic_open ) {&nbsp;</div></li><li><div>            return 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Close the topic&nbsp;</div></li><li><div>        if ( !$close && !bb_close_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The topic could not be closed.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Open the topic&nbsp;</div></li><li><div>        if ( $close && !bb_open_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The topic could not be opened.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.closeTopic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * bbPress publishing API - Post XML-RPC methods&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns a numerical count of posts&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object The number of topics when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The topic id or slug&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a count of all posts in the topic with slug &quot;countable-topic&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getPostCount&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;countable-topic&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getPostCount( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getPostCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getPostCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // OK, let's trust the count in the topic table&nbsp;</div></li><li><div>        $count = $topic-&gt;topic_posts;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getPostCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the count of posts&nbsp;</div></li><li><div>        return $count;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns details of the posts in a given topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The posts when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The topic id or slug&nbsp;</div></li><li><div>     * @param integer $args[3] The number of posts to return (optional)&nbsp;</div></li><li><div>     * @param integer $args[4] The number of the page to return (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all posts in the topic with id number 53&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getPosts&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;53&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the latest 5 posts in the topic with id number 341&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getPosts&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;341&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;5&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get posts 11 to 20 in the topic with slug &quot;long-topic&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getPosts&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;long-topic&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;10&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;2&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getPosts( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getPosts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getPosts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup an array to store arguments to pass to get_thread() function&nbsp;</div></li><li><div>        $get_thread_args = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be an integer&nbsp;</div></li><li><div>        if ( isset( $args[3] ) && $per_page = (int) $args[3] ) {&nbsp;</div></li><li><div>            $get_thread_args['per_page'] = $per_page;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be an integer&nbsp;</div></li><li><div>        if ( isset( $args[4] ) && $page = (int) $args[4] ) {&nbsp;</div></li><li><div>            $get_thread_args['page'] = $page;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the posts&nbsp;</div></li><li><div>        if ( !$posts = get_thread( $topic_id, $get_thread_args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'No posts found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $_posts = array();&nbsp;</div></li><li><div>        foreach ( $posts as $post ) {&nbsp;</div></li><li><div>            $_posts[] = $this-&gt;prepare_post( $post );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getPosts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the posts&nbsp;</div></li><li><div>        return $_posts;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns details of a post&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object An array containing details of the returned post when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer $args[2] The post's id&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the post with id number 32&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getPost&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;32&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getPost( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $post_id = isset( $args[2] ) ? (int) $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$post_id ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The post id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested post exists&nbsp;</div></li><li><div>        if ( !$post = bb_get_post( $post_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No post found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $_post = $this-&gt;prepare_post( $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the post&nbsp;</div></li><li><div>        return $_post;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Creates a new post in a given topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The post data when successfully created or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param array $args[2] The values for the various parameters in the new topic&nbsp;</div></li><li><div>     * @param string $args[2]['text'] The text of the topic&nbsp;</div></li><li><div>     * @param integer|string $args[2]['topic_id'] The unique id of the topic which will contain this topic, slugs are OK to use too&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to create a new post in the topic with slug &quot;totally-worth-it&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.newPost&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;struct&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;text&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;I agree, it is totally worth it.&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;topic_id&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;totally-worth-it&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *         &lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_newPost( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.newPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'write_posts', __( 'You do not have permission to write posts.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.newPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure there is something for us to do&nbsp;</div></li><li><div>        if ( !$args[2] || !is_array( $args[2] ) || !count( $args[2] ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The post data is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $structure = (array) $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $structure['topic_id'] ) ? $structure['topic_id'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to write posts to this topic&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'write_post', $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to write posts to this topic.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The post requires text&nbsp;</div></li><li><div>        if ( !isset( $structure['text'] ) || !$structure['text'] ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The post text is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Inject structure into an array suitable for bb_insert_post()&nbsp;</div></li><li><div>        $bb_insert_post_args = array(&nbsp;</div></li><li><div>            'topic_id' =&gt; $topic_id, &nbsp;</div></li><li><div>            'post_text' =&gt; (string) $structure['text']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Create the post&nbsp;</div></li><li><div>        if ( !$post_id = bb_insert_post( $bb_insert_post_args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The post could not be created.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $post = $this-&gt;prepare_forum( bb_get_post( $post_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.newPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $post;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Edits an existing post&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The post data when successfully edited or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param array $args[2] The values for the various parameters in the new topic&nbsp;</div></li><li><div>     * @param integer $args[2]['post_id'] The unique id of the post&nbsp;</div></li><li><div>     * @param string $args[2]['text'] The text of the topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to edit the text of the post with an id of 452&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.editPost&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;struct&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;post_id&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;int&gt;452&lt;/int&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;text&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;For now I will withhold my opinion.&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *         &lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_editPost( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.editPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'edit_posts', __( 'You do not have permission to edit posts.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.editPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure there is something for us to do&nbsp;</div></li><li><div>        if ( !$args[2] || !is_array( $args[2] ) || !count( $args[2] ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The post data is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $structure = (array) $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $post_id = isset( $structure['post_id'] ) ? (int) $structure['post_id'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$post_id ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The post id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$post = bb_get_post( $post_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No post found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Re-assign the post id&nbsp;</div></li><li><div>        $post_id = (int) $post-&gt;post_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to edit this post&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'edit_post', $post_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to edit this post.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The post requires text&nbsp;</div></li><li><div>        if ( !isset( $structure['text'] ) || !$structure['text'] ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The post text is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Inject structure into an array suitable for bb_insert_post()&nbsp;</div></li><li><div>        $bb_insert_post_args = array(&nbsp;</div></li><li><div>            'post_id' =&gt; $post_id, &nbsp;</div></li><li><div>            'post_text' =&gt; (string) $structure['text']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Create the post&nbsp;</div></li><li><div>        if ( !$post_id = bb_insert_post( $bb_insert_post_args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The post could not be edited.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $post = $this-&gt;prepare_forum( bb_get_post( $post_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.editPost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $post;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes an existing post&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object 1 when successfully deleted, 0 when already deleted or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param array $args[2] The unique id of the post&nbsp;</div></li><li><div>     * @param array $args[3] 1 deletes the post, 0 undeletes the post (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to delete the post with an id of 4301&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.editPost&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;4301&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_deletePost( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.deletePost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'delete_posts', __( 'You do not have permission to delete posts.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.deletePost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $post_id = isset( $args[2] ) ? (int) $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$post_id ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The post id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$post = bb_get_post( $post_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No post found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Re-assign the post id&nbsp;</div></li><li><div>        $post_id = (int) $post-&gt;post_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to delete this post&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'delete_post', $post_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to delete this post.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $status = isset( $args[3] ) ? (int) $args[3] : 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $status === (int) $post-&gt;post_status ) {&nbsp;</div></li><li><div>            return 0;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Delete the post&nbsp;</div></li><li><div>        if ( !$post_id = bb_delete_post( $post_id, $status ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The post could not be edited.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.deletePost' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * bbPress publishing API - Topic Tag XML-RPC methods&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the hot tags in order of hotness in a given forum or all hot tags&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object The tag data when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer $args[2] The number of tags to return (optional)&nbsp;</div></li><li><div>     * @param integer|string $args[3] The forum id or slug (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the 20 hottest tags in the forum with slug &quot;hawtness&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopicTags&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;20&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;hawtness&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getHotTopicTags( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getHotTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getHotTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Must be a number&nbsp;</div></li><li><div>        $per_page = isset( $args[2] ) ? (integer) $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $forum_id = isset( $args[3] ) ? $args[3] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $forum_id ) {&nbsp;</div></li><li><div>            // Check for bad data&nbsp;</div></li><li><div>            if ( !is_string( $forum_id ) && !is_integer( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The forum id is invalid.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Check the requested forum exists&nbsp;</div></li><li><div>            if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 404, __( 'No forum found.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            global $bbdb;&nbsp;</div></li><li><div>            $topic_ids = $bbdb-&gt;get_col( $bbdb-&gt;prepare( &quot;SELECT topic_id FROM `&quot; . $bbdb-&gt;topics . &quot;` WHERE `topic_status` = 0 AND `topic_open` = 1 AND `tag_count` &gt; 0 AND `forum_id` = %s;&quot;, $forum_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !count( $topic_ids ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'No topics found.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            global $wp_taxonomy_object;&nbsp;</div></li><li><div>            $tags = $wp_taxonomy_object-&gt;get_object_terms( $topic_ids, 'bb_topic_tag', array( 'fields' =&gt; 'all_with_object_id', 'orderby' =&gt; 'count', 'order' =&gt; 'DESC' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( !$tags || is_wp_error( $tags ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 500, __( 'Could not retrieve hot topic tags.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( !count( $tags ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 500, __( 'No hot topic tags found.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            global $bb_log;&nbsp;</div></li><li><div>            $bb_log-&gt;debug($tags);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            for ( $i = 0; isset( $tags[$i] ); $i++ ) {&nbsp;</div></li><li><div>                _bb_make_tag_compat( $tags[$i] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $bb_log-&gt;debug($tags);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>            $_tags = array();&nbsp;</div></li><li><div>            foreach ( $tags as $tag ) {&nbsp;</div></li><li><div>                $_tag = $this-&gt;prepare_topic_tag( $tag );&nbsp;</div></li><li><div>                if ( !in_array( $_tag, $_tags ) ) {&nbsp;</div></li><li><div>                    $_tags[] = $_tag;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $per_page ) {&nbsp;</div></li><li><div>                $_tags = array_slice( $_tags, 0, $per_page );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if ( !$tags = bb_get_top_tags( array( 'get' =&gt; 'all', 'number' =&gt; $per_page ) ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 500, __( 'No hot topic tags found.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>            $_tags = array();&nbsp;</div></li><li><div>            foreach ( $tags as $tag ) {&nbsp;</div></li><li><div>                $_tags[] = $this-&gt;prepare_topic_tag( $tag );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getHotTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $_tags;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns a numerical count of tags in a given topic or all tags&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object The number of topics when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The topic id or slug (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get a count of all tags in the topic with slug &quot;woot-frist-topic&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopicTagCount&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;woot-frist-topic&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getTopicTagCount( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getTopicTagCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getTopicTagCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( $topic_id ) {&nbsp;</div></li><li><div>            if ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Check the requested topic exists&nbsp;</div></li><li><div>            if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>            $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Now get the tags&nbsp;</div></li><li><div>            if ( !$tags = bb_get_topic_tags( $topic_id ) ) {&nbsp;</div></li><li><div>                $tags = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Count the tags&nbsp;</div></li><li><div>            $count = count( $tags );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            global $wp_taxonomy_object;&nbsp;</div></li><li><div>            $count = $wp_taxonomy_object-&gt;count_terms( 'bb_topic_tag' );&nbsp;</div></li><li><div>            if ( is_wp_error( $count ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 500, __( 'Could not get a count of all topic tags.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getTopicTagCount' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the count of tags&nbsp;</div></li><li><div>        return $count;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the tags in a given topic or all tags&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object The tag data when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param integer|string $args[2] The topic id or slug (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all tags in the topic with slug &quot;woot-frist-topic&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopicTags&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;woot-frist-topic&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getTopicTags( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( $topic_id ) {&nbsp;</div></li><li><div>            if ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Check the requested topic exists&nbsp;</div></li><li><div>            if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>            $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Now get the tags&nbsp;</div></li><li><div>            if ( !$tags = bb_get_topic_tags( $topic_id ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 500, __( 'No topic tags found.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            global $wp_taxonomy_object;&nbsp;</div></li><li><div>            $tags = $wp_taxonomy_object-&gt;get_terms( 'bb_topic_tag', array( 'get' =&gt; 'all' ) );&nbsp;</div></li><li><div>            if ( is_wp_error( $tags ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 500, __( 'Could not retrieve all topic tags.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            for ( $i = 0; isset( $tags[$i] ); $i++ ) {&nbsp;</div></li><li><div>                _bb_make_tag_compat( $tags[$i] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $_tags = array();&nbsp;</div></li><li><div>        foreach ( $tags as $tag ) {&nbsp;</div></li><li><div>            $_tags[] = $this-&gt;prepare_topic_tag( $tag );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the tags&nbsp;</div></li><li><div>        return $_tags;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the topics which are tagged with the given tag&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object The topic data when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param string $args[2] The tag name or slug&nbsp;</div></li><li><div>     * @param integer $args[3] The number of topics to return (optional)&nbsp;</div></li><li><div>     * @param integer $args[4] The number of the page to return (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the latest 10 topics tagged with the tag &quot;apples&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getTopicTag&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;apples&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;10&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getTopicTag( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getTopicTag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getTopicTag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be a string&nbsp;</div></li><li><div>        $tag_id = isset( $args[2] ) ? (string) $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$tag_id ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The tag id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$tag = bb_get_tag( $tag_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No tag found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the numeric tag id&nbsp;</div></li><li><div>        $tag_id = (int) $tag-&gt;tag_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup an array to store arguments to pass to get_tagged_topics() function&nbsp;</div></li><li><div>        $get_topics_args = array(&nbsp;</div></li><li><div>            'tag_id' =&gt; false, &nbsp;</div></li><li><div>            'number' =&gt; false, &nbsp;</div></li><li><div>            'page' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be an integer&nbsp;</div></li><li><div>        if ( isset( $args[3] ) && $number = (int) $args[3] ) {&nbsp;</div></li><li><div>            $get_topics_args['number'] = $number;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be an integer&nbsp;</div></li><li><div>        if ( isset( $args[4] ) && $page = (int) $args[4] ) {&nbsp;</div></li><li><div>            $get_topics_args['page'] = $page;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Now get the topics&nbsp;</div></li><li><div>        if ( !$topics = get_tagged_topics( $tag_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'No topics found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $_topics = array();&nbsp;</div></li><li><div>        foreach ( $topics as $topic ) {&nbsp;</div></li><li><div>            $_topics[] = $this-&gt;prepare_topic( $topic );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getTopicTag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the topics&nbsp;</div></li><li><div>        return $_topics;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds the specified tags to the specified topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The tags which were added when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param string|integer $args[2] The topic id or slug&nbsp;</div></li><li><div>     * @param string|array $args[3] The tags to add to the topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to add the tag &quot;banana&quot; to the topic with id 219&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.addTopicTags&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;219&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;banana&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to add the tags &quot;banana&quot; and &quot;man&quot; to the topic with id 219&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.addTopicTags&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;219&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;banana, man&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to add the tags &quot;banana&quot; and &quot;man&quot; to the topic with id 219 using an array&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.addTopicTags&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;219&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;array&gt;&nbsp;</div></li><li><div>     *             &lt;data&gt;&lt;value&gt;&lt;string&gt;banana&lt;/string&gt;&lt;/value&gt;&lt;/data&gt;&nbsp;</div></li><li><div>     *             &lt;data&gt;&lt;value&gt;&lt;string&gt;man&lt;/string&gt;&lt;/value&gt;&lt;/data&gt;&nbsp;</div></li><li><div>     *         &lt;/array&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_addTopicTags( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.addTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'edit_tags', __( 'You do not have permission to edit tags.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.addTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to add tags to this topic&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'add_tag_to', $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to add tags to this topic.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tags = isset( $args[3] ) ? $args[3] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$tags || ( !is_string( $tags ) && !is_array( $tags ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The tag data is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add the tags&nbsp;</div></li><li><div>        if ( !$tag_ids = bb_add_topic_tags( $topic_id, $tags ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The tags could not be added.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $_tags = array();&nbsp;</div></li><li><div>        foreach ( $tag_ids as $tag_id ) {&nbsp;</div></li><li><div>            $_tags[] = $this-&gt;prepare_topic_tag( bb_get_tag( $tag_id ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.addTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the tags which were added as an array&nbsp;</div></li><li><div>        return $_tags;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Removes the specified tags from the specified topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object 1 when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param string|integer $args[2] The topic id or slug&nbsp;</div></li><li><div>     * @param string|array $args[3] The tags to remove from the topic&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to remove the tag &quot;banana&quot; to the topic with id 219&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.removeTopicTags&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;219&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;banana&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to remove the tags &quot;banana&quot; and &quot;man&quot; to the topic with id 219&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.removeTopicTags&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;219&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;banana, man&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to remove the tags &quot;banana&quot; and &quot;man&quot; to the topic with id 219 using an array&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.removeTopicTags&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;int&gt;219&lt;/int&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;array&gt;&nbsp;</div></li><li><div>     *             &lt;data&gt;&lt;value&gt;&lt;string&gt;banana&lt;/string&gt;&lt;/value&gt;&lt;/data&gt;&nbsp;</div></li><li><div>     *             &lt;data&gt;&lt;value&gt;&lt;string&gt;man&lt;/string&gt;&lt;/value&gt;&lt;/data&gt;&nbsp;</div></li><li><div>     *         &lt;/array&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_removeTopicTags( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.removeTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'edit_tags', __( 'You do not have permission to edit tags.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.removeTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can be numeric id or slug&nbsp;</div></li><li><div>        $topic_id = isset( $args[2] ) ? $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$topic_id || ( !is_string( $topic_id ) && !is_integer( $topic_id ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The topic id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested topic exists&nbsp;</div></li><li><div>        if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No topic found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The topic id may have been a slug, so make sure it's an integer here&nbsp;</div></li><li><div>        $topic_id = (int) $topic-&gt;topic_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure they are allowed to add tags to this topic&nbsp;</div></li><li><div>        if ( !bb_current_user_can( 'add_tag_to', $topic_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 403, __( 'You do not have permission to remove tags from this topic.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $tags = isset( $args[3] ) ? $args[3] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$tags || ( !is_string( $tags ) && !is_array( $tags ) ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The tag data is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add the tags&nbsp;</div></li><li><div>        if ( !bb_remove_topic_tags( $topic_id, $tags ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The tags could not be removed.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.removeTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the result&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Renames the specified tag to a new tag name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The tag data when successfully renamed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param string $args[2] The tag name or slug&nbsp;</div></li><li><div>     * @param string $args[3] The new tag name (slug is auto-generated)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to rename the tag &quot;banana&quot; to &quot;bananas&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.renameTopicTag&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;banana&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;bananas&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_renameTopicTag( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.renameTopicTag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'manage_tags', __( 'You do not have permission to manage tags.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.renameTopicTag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be a string&nbsp;</div></li><li><div>        $tag_id = isset( $args[2] ) ? (string) $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$tag_id ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The tag id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested tag exists&nbsp;</div></li><li><div>        if ( !$tag = bb_get_tag( $tag_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No tag found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the numeric tag id&nbsp;</div></li><li><div>        $tag_id = (int) $tag-&gt;tag_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be a string&nbsp;</div></li><li><div>        $tag_name = isset( $args[3] ) ? (string) $args[3] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$tag_name || $tag_name == $tag-&gt;tag_name ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The tag name is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Rename the tag&nbsp;</div></li><li><div>        if ( !$new_tag = bb_rename_tag( $tag_id, $tag_name ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The tag could not be renamed.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $new_tag = $this-&gt;prepare_topic_tag( $new_tag );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.renameTopicTag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the tag&nbsp;</div></li><li><div>        return $new_tag;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Merges the specified tags&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object The tag data when successfully merged or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param string $args[2] The old tag name or slug to be destroyed&nbsp;</div></li><li><div>     * @param string $args[3] The new tag name or slug where the old tag will be merged to&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to merge the tag &quot;banana&quot; into the tag &quot;apple&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.mergeTopicTags&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;banana&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;apple&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_mergeTopicTags( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.mergeTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'manage_tags', __( 'You do not have permission to manage tags.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.mergeTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be strings&nbsp;</div></li><li><div>        $old_tag_id = isset( $args[2] ) ? (string) $args[2] : false;&nbsp;</div></li><li><div>        $new_tag_id = isset( $args[3] ) ? (string) $args[3] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$old_tag_id ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The old tag id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( !$new_tag_id ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The new tag id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested tags exist&nbsp;</div></li><li><div>        if ( !$old_tag = bb_get_tag( $old_tag_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No old tag found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( !$new_tag = bb_get_tag( $new_tag_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No new tag found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the numeric tag ids&nbsp;</div></li><li><div>        $old_tag_id = (int) $old_tag-&gt;tag_id;&nbsp;</div></li><li><div>        $new_tag_id = (int) $new_tag-&gt;tag_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Rename the tag&nbsp;</div></li><li><div>        if ( !$result = bb_rename_tag( $old_tag_id, $new_tag_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The tags could not be merged.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the merged tag&nbsp;</div></li><li><div>        $new_tag = bb_get_tag( $new_tag_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only include &quot;safe&quot; data in the array&nbsp;</div></li><li><div>        $new_tag = $this-&gt;prepare_topic_tag( $new_tag );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.mergeTopicTags' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the tag&nbsp;</div></li><li><div>        return $new_tag;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Destroys the specified tag&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return integer|object 1 when successfully deleted or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param string $args[2] The tag name or slug to be destroyed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to destroy the tag &quot;banana&quot;&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.destroyTopicTag&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;banana&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_destroyTopicTag( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.destroyTopicTag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'manage_tags', __( 'You do not have permission to manage tags.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.destroyTopicTag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Can only be a string&nbsp;</div></li><li><div>        $tag_id = isset( $args[2] ) ? (string) $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for bad data&nbsp;</div></li><li><div>        if ( !$tag_id ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The tag id is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the requested tag exists&nbsp;</div></li><li><div>        if ( !$tag = bb_get_tag( $tag_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'No tag found.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the numeric tag id&nbsp;</div></li><li><div>        $tag_id = (int) $tag-&gt;tag_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Destroy the tag&nbsp;</div></li><li><div>        if ( !$result = bb_destroy_tag( $tag_id ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 500, __( 'The tag could not be destroyed.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.destroyTopicTag' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return the tag&nbsp;</div></li><li><div>        return $result;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * bbPress publishing API - Options XML-RPC methods&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initialises site options which can be manipulated using XML-RPC&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function initialise_site_option_info()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;site_options = array(&nbsp;</div></li><li><div>            // Read only options&nbsp;</div></li><li><div>            'software_name' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Software Name' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'value' =&gt; 'bbPress'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'software_version' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Software Version' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'option' =&gt; 'version'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'site_url' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Site URL' ), &nbsp;</div></li><li><div>                'readonly' =&gt; true, &nbsp;</div></li><li><div>                'option' =&gt; 'uri'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Updatable options&nbsp;</div></li><li><div>            'site_name' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Site Name' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'name'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'site_description' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Site Description' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'description'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'time_zone' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Time Zone' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'gmt_offset'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'datetime_format' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Date/Time Format' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'datetime_format'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'date_format' =&gt; array(&nbsp;</div></li><li><div>                'desc' =&gt; __( 'Date Format' ), &nbsp;</div></li><li><div>                'readonly' =&gt; false, &nbsp;</div></li><li><div>                'option' =&gt; 'date_format'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;site_options = apply_filters( 'xmlrpc_site_options', $this-&gt;site_options );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Compiles site options into an array suitable to be passed back through the XML-RPC server&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array The site options in an array&nbsp;</div></li><li><div>     * @param array $options An array of options to fetch and return&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _getOptions( $options )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $data = array();&nbsp;</div></li><li><div>        foreach ( $options as $option ) {&nbsp;</div></li><li><div>            if ( array_key_exists( $option, $this-&gt;site_options ) ) {&nbsp;</div></li><li><div>                $data[$option] = $this-&gt;site_options[$option];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Is the value static or dynamic?&nbsp;</div></li><li><div>                if ( isset( $data[$option]['option'] ) ) {&nbsp;</div></li><li><div>                    $data[$option]['value'] = bb_get_option( $data[$option]['option'] );&nbsp;</div></li><li><div>                    unset( $data[$option]['option'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets the specified site options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object An array containing the specified options when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param array $args[2] The options to be retrieved, when omitted the method returns all options (optional)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all site options&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getOptions&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get the site name and site description&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.getOptions&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;array&gt;&nbsp;</div></li><li><div>     *             &lt;data&gt;&lt;value&gt;&lt;string&gt;site_name&lt;/string&gt;&lt;/value&gt;&lt;/data&gt;&nbsp;</div></li><li><div>     *             &lt;data&gt;&lt;value&gt;&lt;string&gt;site_description&lt;/string&gt;&lt;/value&gt;&lt;/data&gt;&nbsp;</div></li><li><div>     *         &lt;/array&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_getOptions( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.getOptions' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        if ( $this-&gt;auth_readonly ) {&nbsp;</div></li><li><div>            $user = $this-&gt;authenticate( $username, $password );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.getOptions' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If there are parameters supplied then make sure they are in an array&nbsp;</div></li><li><div>        $options = isset( $args[2] ) ? (array) $args[2] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If no specific options where asked for, return all of them&nbsp;</div></li><li><div>        if ( !$options || !count( $options ) ) {&nbsp;</div></li><li><div>            $options = array_keys( $this-&gt;site_options );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.getOptions' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;_getOptions( $options );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the specified site options to the specified values&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @return array|object An array containing the specified options when successfully executed or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The username for authentication&nbsp;</div></li><li><div>     * @param string $args[1] The password for authentication&nbsp;</div></li><li><div>     * @param array $args[2] The options to be updated along with the new value of the option&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to set the site name and site description&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;bb.setOptions&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;joeblow&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;123password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;struct&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;site_name&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;Awesome forums&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *             &lt;member&gt;&nbsp;</div></li><li><div>     *                 &lt;name&gt;site_description&lt;/name&gt;&nbsp;</div></li><li><div>     *                 &lt;value&gt;&lt;string&gt;My totally awesome forums will kick your butt&lt;/string&gt;&lt;/value&gt;&nbsp;</div></li><li><div>     *             &lt;/member&gt;&nbsp;</div></li><li><div>     *         &lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bb_setOptions( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'bb.setOptions' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Escape args&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the login credentials&nbsp;</div></li><li><div>        $username = $args[0];&nbsp;</div></li><li><div>        $password = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check the user is valid&nbsp;</div></li><li><div>        $user = $this-&gt;authenticate( $username, $password, 'manage_options', __( 'You are not allowed to manage options.' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_authenticated', 'bb.setOptions' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If an error was raised by authentication or by an action then return it&nbsp;</div></li><li><div>        if ( $this-&gt;error ) {&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure there is something for us to do&nbsp;</div></li><li><div>        if ( !$args[2] || !is_array( $args[2] ) || !count( $args[2] ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 400, __( 'The options data is invalid.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $options = (array) $args[2];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update the requested options&nbsp;</div></li><li><div>        foreach( $options as $o_name =&gt; $o_value ) {&nbsp;</div></li><li><div>            $option_names[] = $o_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If there is no value set skip it&nbsp;</div></li><li><div>            if ( empty( $o_value ) ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If the option doesn't exist skip it&nbsp;</div></li><li><div>            if ( !array_key_exists( $o_name, $this-&gt;site_options ) ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If the option is readonly skip it&nbsp;</div></li><li><div>            if ( $this-&gt;site_options[$o_name]['readonly'] == true ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Everything is good, update the option&nbsp;</div></li><li><div>            bb_update_option( $this-&gt;site_options[$o_name]['option'], $o_value );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $_options = $this-&gt;_getOptions( $option_names );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call_return', 'bb.setOptions' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Now return the updated values&nbsp;</div></li><li><div>        return $_options;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Pingback XML-RPC methods&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Processes pingback requests&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @link http://www.hixie.ch/specs/pingback/pingback&nbsp;</div></li><li><div>     * @return string|object A message of success or an IXR_Error object on failure&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The full URI of the post where the pingback is being sent from&nbsp;</div></li><li><div>     * @param string $args[1] The full URI of the post where the pingback is being sent to&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to register a pingback&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;pingback.ping&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;http://example.org/2008/09/post-containing-a-link/&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;http://example.com/2008/08/post-being-linked-to/&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function pingback_ping( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'pingback.ping' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // No particular need to sanitise&nbsp;</div></li><li><div>        $link_from = (string) $args[0];&nbsp;</div></li><li><div>        $link_to = (string) $args[1];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Tidy up ampersands in the URLs&nbsp;</div></li><li><div>        $link_from = str_replace( '&amp;', '&', $link_from );&nbsp;</div></li><li><div>        $link_to = str_replace( '&amp;', '&', $link_to );&nbsp;</div></li><li><div>        $link_to = str_replace( '&', '&amp;', $link_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check if the topic linked to is in our site - a little more strict than WordPress, doesn't pull out the www if added&nbsp;</div></li><li><div>        if ( !bb_match_domains( $link_to, bb_get_uri() ) ) {&nbsp;</div></li><li><div>            // These are not the droids you are looking for&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 0, __( 'This is not the site you are trying to pingback.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the topic&nbsp;</div></li><li><div>        if ( $topic_to = bb_get_topic_from_uri( $link_to ) ) {&nbsp;</div></li><li><div>            // Topics shouldn't ping themselves&nbsp;</div></li><li><div>            if ( $topic_from = bb_get_topic_from_uri( $link_from ) ) {&nbsp;</div></li><li><div>                if ( $topic_from-&gt;topic_id === $topic_to-&gt;topic_id ) {&nbsp;</div></li><li><div>                    $this-&gt;error = new IXR_Error( 0, __( 'The source URL and the target URL cannot both point to the same resource.' ) );&nbsp;</div></li><li><div>                    return $this-&gt;error;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error ( 33, __( 'The specified target URL cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let's check that the remote site didn't already pingback this entry&nbsp;</div></li><li><div>        $query = new BB_Query( 'post', array( 'topic_id' =&gt; $topic_to-&gt;topic_id, 'append_meta' =&gt; true ), 'get_thread' );&nbsp;</div></li><li><div>        $posts_to = $query-&gt;results;&nbsp;</div></li><li><div>        unset( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure we have some posts in the topic, this error should never happen really&nbsp;</div></li><li><div>        if ( !$posts_to || !is_array( $posts_to ) || !count( $posts_to ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 0, __( 'The specified target topic does not contain any posts.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check if we already have a pingback from this URL&nbsp;</div></li><li><div>        foreach ( $posts_to as $post ) {&nbsp;</div></li><li><div>            if ( isset( $post-&gt;pingback_uri ) && trim( $post-&gt;pingback_uri ) === trim( $link_from ) ) {&nbsp;</div></li><li><div>                $this-&gt;error = new IXR_Error( 48, __( 'The pingback has already been registered.' ) );&nbsp;</div></li><li><div>                return $this-&gt;error;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        unset( $posts_to, $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Give time for the server sending the pingback to finish publishing it's post&nbsp;</div></li><li><div>        sleep(1);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let's check the remote site for valid URL and content&nbsp;</div></li><li><div>        $link_from_source = wp_remote_fopen( $link_from );&nbsp;</div></li><li><div>        if ( !$link_from_source ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 16, __( 'The source URL does not exist.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow plugins to filter here&nbsp;</div></li><li><div>        $link_from_source = apply_filters( 'bb_pre_remote_source', $link_from_source, $link_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Work around bug in strip_tags()&nbsp;</div></li><li><div>        $link_from_source = str_replace( '&lt;!DOC', '&lt;DOC', $link_from_source );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Normalize spaces&nbsp;</div></li><li><div>        $link_from_source = preg_replace( '/[\s\r\n\t]+/', ' ', $link_from_source );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Turn certain elements to double line returns&nbsp;</div></li><li><div>        $link_from_source = preg_replace( &quot;/ &lt;(h1|h2|h3|h4|h5|h6|p|th|td|li|dt|dd|pre|caption|input|textarea|button|body)[^&gt;]*&gt;/&quot;, &quot;\n\n&quot;, $link_from_source );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Find the title of the page&nbsp;</div></li><li><div>        preg_match( '|&lt;title&gt;([^&lt;]*?)&lt;/title&gt;|is', $link_from_source, $link_from_title );&nbsp;</div></li><li><div>        $link_from_title = $link_from_title[1];&nbsp;</div></li><li><div>        if ( empty( $link_from_title ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 32, __( 'We cannot find a title on that page.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Strip out all tags except anchors&nbsp;</div></li><li><div>        $link_from_source = strip_tags( $link_from_source, '&lt;a&gt;' ); // just keep the tag we need&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Split the source into paragraphs&nbsp;</div></li><li><div>        $link_from_paragraphs = explode( &quot;\n\n&quot;, $link_from_source );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Prepare the link to search for in preg_match() once here&nbsp;</div></li><li><div>        $preg_target = preg_quote( $link_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Loop through the paragraphs looking for the context for the url&nbsp;</div></li><li><div>        foreach ( $link_from_paragraphs as $link_from_paragraph ) {&nbsp;</div></li><li><div>            // The url exists&nbsp;</div></li><li><div>            if ( strpos( $link_from_paragraph, $link_to ) !== false ) {&nbsp;</div></li><li><div>                // But is it in an anchor tag&nbsp;</div></li><li><div>                preg_match(&nbsp;</div></li><li><div>                    &quot;|&lt;a[^&gt;]+?&quot; . $preg_target . &quot;[^&gt;]*&gt;([^&gt;]+?)&lt;/a&gt;|&quot;, &nbsp;</div></li><li><div>                    $link_from_paragraph, &nbsp;</div></li><li><div>                    $context&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                // If the URL isn't in an anchor tag, keep looking&nbsp;</div></li><li><div>                if ( empty( $context ) ) {&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // We're going to use this fake tag to mark the context in a bit&nbsp;</div></li><li><div>                // the marker is needed in case the link text appears more than once in the paragraph&nbsp;</div></li><li><div>                $excerpt = preg_replace( '|\&lt;/?wpcontext\&gt;|', '', $link_from_paragraph );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Prevent really long link text&nbsp;</div></li><li><div>                if ( strlen( $context[1] ) &gt; 100 ) {&nbsp;</div></li><li><div>                    $context[1] = substr( $context[1], 0, 100 ) . '...';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Set up the marker around the context&nbsp;</div></li><li><div>                $marker = '&lt;wpcontext&gt;' . $context[1] . '&lt;/wpcontext&gt;';&nbsp;</div></li><li><div>                // Swap out the link for our marker&nbsp;</div></li><li><div>                $excerpt = str_replace( $context[0], $marker, $excerpt );&nbsp;</div></li><li><div>                // Strip all tags except for our context marker&nbsp;</div></li><li><div>                $excerpt = trim( strip_tags( $excerpt, '&lt;wpcontext&gt;' ) );&nbsp;</div></li><li><div>                // Make the marker safe for use in regexp&nbsp;</div></li><li><div>                $preg_marker = preg_quote( $marker );&nbsp;</div></li><li><div>                // Reduce the excerpt to only include 100 characters on either side of the link&nbsp;</div></li><li><div>                $excerpt = preg_replace( &quot;|.*?\s(.{0, 100}&quot; . $preg_marker . &quot;{0, 100})\s.*|s&quot;, '$1', $excerpt );&nbsp;</div></li><li><div>                // Strip tags again, to remove the marker wrapper&nbsp;</div></li><li><div>                $excerpt = strip_tags( $excerpt );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>         // Make sure the link to the target was found in the excerpt&nbsp;</div></li><li><div>        if ( empty( $context ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 17, __( 'The source URL does not contain a link to the target URL, and so cannot be used as a source.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add whacky prefix and suffix to the excerpt and sanitize&nbsp;</div></li><li><div>        $excerpt = '[...] ' . esc_html( $excerpt ) . ' [...]';&nbsp;</div></li><li><div>        $this-&gt;escape( $excerpt );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Build an array of post data to insert then insert a new post&nbsp;</div></li><li><div>        $postdata = array(&nbsp;</div></li><li><div>            'topic_id' =&gt; $topic_to-&gt;topic_id, &nbsp;</div></li><li><div>            'post_text' =&gt; $excerpt, &nbsp;</div></li><li><div>            'poster_id' =&gt; 0, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        if ( !$post_ID = bb_insert_post( $postdata ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 0, __( 'The pingback could not be added.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add meta to let us know where the pingback came from&nbsp;</div></li><li><div>        $link_from = str_replace( '&', '&amp;', $link_from );&nbsp;</div></li><li><div>        $this-&gt;escape( $link_from );&nbsp;</div></li><li><div>        bb_update_postmeta( $post_ID, 'pingback_uri', $link_from );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add the title to meta&nbsp;</div></li><li><div>        $this-&gt;escape( $link_from_title );&nbsp;</div></li><li><div>        bb_update_postmeta( $post_ID, 'pingback_title', $link_from_title );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Action for plugins and what not&nbsp;</div></li><li><div>        do_action( 'bb_pingback_post', $post_ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return success message, complete with emoticon&nbsp;</div></li><li><div>        return sprintf( __( 'Pingback from %1$s to %2$s registered. Keep the web talking! :-)' ), $link_from, $link_to );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns an array of URLs that pingbacked the given URL&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @link http://www.aquarionics.com/misc/archives/blogite/0198.html&nbsp;</div></li><li><div>     * @return array The array of URLs that pingbacked the given topic&nbsp;</div></li><li><div>     * @param array $args Arguments passed by the XML-RPC call&nbsp;</div></li><li><div>     * @param string $args[0] The full URI of the post where the pingback is being sent from&nbsp;</div></li><li><div>     * @param string $args[1] The full URI of the post where the pingback is being sent to&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * XML-RPC request to get all pingbacks on a topic&nbsp;</div></li><li><div>     * &lt;methodCall&gt;&nbsp;</div></li><li><div>     *     &lt;methodName&gt;pingback.ping&lt;/methodName&gt;&nbsp;</div></li><li><div>     *     &lt;params&gt;&nbsp;</div></li><li><div>     *         &lt;param&gt;&lt;value&gt;&lt;string&gt;http://example.com/2008/08/post-tobe-queried/&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&nbsp;</div></li><li><div>     *     &lt;/params&gt;&nbsp;</div></li><li><div>     * &lt;/methodCall&gt;&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function pingback_extensions_getPingbacks( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        do_action( 'bb_xmlrpc_call', 'pingback.extensions.getPingbacks' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;escape( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Don't accept arrays of arguments&nbsp;</div></li><li><div>        if ( is_array( $args ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 404, __( 'The requested method only accepts one parameter.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $url = (string) $args;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Tidy up ampersands in the URI&nbsp;</div></li><li><div>        $url = str_replace( '&amp;', '&', $url );&nbsp;</div></li><li><div>        $url = str_replace( '&', '&amp;', $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check if the URI is in our site&nbsp;</div></li><li><div>        if ( !bb_match_domains( $url, bb_get_uri() ) ) {&nbsp;</div></li><li><div>            // These are not the droids you are looking for&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 0, __( 'The specified target URL is not on this domain.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure the specified URI is in fact associated with a topic&nbsp;</div></li><li><div>        if ( !$topic = bb_get_topic_from_uri( $url ) ) {&nbsp;</div></li><li><div>            $this-&gt;error = new IXR_Error( 33, __( 'The specified target URL cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.' ) );&nbsp;</div></li><li><div>            return $this-&gt;error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Grab the posts from the topic&nbsp;</div></li><li><div>        $query = new BB_Query( 'post', array( 'topic_id' =&gt; $topic_to-&gt;topic_id, 'append_meta' =&gt; true ), 'get_thread' );&nbsp;</div></li><li><div>        $posts_to = $query-&gt;results;&nbsp;</div></li><li><div>        unset( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for pingbacks in the post meta data&nbsp;</div></li><li><div>        $pingbacks = array();&nbsp;</div></li><li><div>        foreach ( $posts_to as $post ) {&nbsp;</div></li><li><div>            if ( isset( $post-&gt;pingback_uri ) ) {&nbsp;</div></li><li><div>                $pingbacks[] = $post-&gt;pingback_uri;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        unset( $post );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // This will return an empty array on failure&nbsp;</div></li><li><div>        return $pingbacks;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/bb_xmlrpc_server/" class="active">2.8.2</a></li><li><a href="http://hookr.io/plugins/buddypress/2.8.1/classes/bb_xmlrpc_server/" class="">2.8.1</a></li><li><a href="http://hookr.io/plugins/buddypress/2.8.0/classes/bb_xmlrpc_server/" class="">2.8.0</a></li><li><a href="http://hookr.io/plugins/buddypress/2.7.5/classes/bb_xmlrpc_server/" class="">2.7.5</a></li><li><a href="http://hookr.io/plugins/buddypress/2.7.4/classes/bb_xmlrpc_server/" class="">2.7.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>BB_XMLRPC_Server</li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>