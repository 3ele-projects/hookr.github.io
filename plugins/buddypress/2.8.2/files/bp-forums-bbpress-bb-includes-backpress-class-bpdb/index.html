<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.8.2" data-slug="buddypress" data-type="file" data-id="49139"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-forums-bbpress-bb-includes-backpress-class-bpdb | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.8.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.24"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=b14e6bcd414490d6db792bfbcd8e7b41' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.24' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-forums-bbpress-bb-includes-backpress-class-bpdb/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-forums-bbpress-bb-includes-backpress-class-bpdb%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-forums-bbpress-bb-includes-backpress-class-bpdb%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.2-file-bp-forums-bbpress-bb-includes-backpress-class-bpdb","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-forums-bbpress-bb-includes-backpress-class-bpdb" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.8.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-forums-bbpress-bb-includes&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.2/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.2/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.2/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.2/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-forums/bbpress/bb-includes/backpress/class.bpdb.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">//  backPress DB Class</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">//  ORIGINAL CODE FROM:</span>&nbsp;</div></li><li><div><span class="comment">//  Justin Vincent (justin@visunet.ie)</span>&nbsp;</div></li><li><div><span class="comment">//    http://php.justinvincent.com</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>define( 'EZSQL_VERSION', 'BP1.25' );&nbsp;</div></li><li><div>define( 'OBJECT', 'OBJECT', true );&nbsp;</div></li><li><div>define( 'OBJECT_K', 'OBJECT_K', false );&nbsp;</div></li><li><div>define( 'ARRAY_A', 'ARRAY_A', false );&nbsp;</div></li><li><div>define( 'ARRAY_K', 'ARRAY_K', false );&nbsp;</div></li><li><div>define( 'ARRAY_N', 'ARRAY_N', false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !defined( 'SAVEQUERIES' ) ) {&nbsp;</div></li><li><div>  define( 'SAVEQUERIES', false );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !defined( 'BPDB__ERROR_STRING' ) ) {&nbsp;</div></li><li><div>  define( 'BPDB__ERROR_STRING', 'DB Error: %s, %s: %s' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>if ( !defined( 'BPDB__ERROR_HTML' ) ) {&nbsp;</div></li><li><div>  define( 'BPDB__ERROR_HTML', '&lt;div class=&quot;error&quot;&gt;&lt;p&gt;&lt;strong&gt;DB Error in %3$s:&lt;/strong&gt; %1$s&lt;/p&gt;&lt;pre&gt;%2$s&lt;/pre&gt;&lt;/div&gt;' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>if ( !defined( 'BPDB__CONNECT_ERROR_MESSAGE' ) ) {&nbsp;</div></li><li><div>  define( 'BPDB__CONNECT_ERROR_MESSAGE', 'DB Error: cannot connect' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>if ( !defined( 'BPDB__SELECT_ERROR_MESSAGE' ) ) {&nbsp;</div></li><li><div>  define( 'BPDB__SELECT_ERROR_MESSAGE', 'DB Error: cannot select' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>if ( !defined( 'BPDB__DB_VERSION_ERROR' ) ) {&nbsp;</div></li><li><div>  define( 'BPDB__DB_VERSION_ERROR', 'DB Requires MySQL version 4.0 or higher' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>if ( !defined( 'BPDB__PHP_EXTENSION_MISSING' ) ) {&nbsp;</div></li><li><div>  define( 'BPDB__PHP_EXTENSION_MISSING', 'DB Requires The MySQL PHP extension' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>class BPDB&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to show SQL/DB errors</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $show_errors = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to suppress errors during the DB bootstrapping.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $suppress_errors = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The last error during query.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $last_error = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Amount of queries made</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $num_queries = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The last query made</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $last_query = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Saved info on the table column</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $col_info = array();&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Saved queries that were executed</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $queries = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to use the query log</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $save_queries = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Table prefix</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * You can set this to have multiple installations</span>&nbsp;</div></li><li><div><span class="comment">   * in a single database. The second reason is for possible</span>&nbsp;</div></li><li><div><span class="comment">   * security precautions.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $prefix = '';&nbsp;</div></li><li><div>  &nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether the database queries are ready to start executing.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $ready = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The currently connected MySQL connection resource.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool|resource</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $dbh = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * List of tables</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access private</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $tables = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to use mysql_real_escape_string</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @access public</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  var $real_escape = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * PHP4 style constructor</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return unknown Returns the result of bpdb::__construct()</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function BPDB()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $args = func_get_args();&nbsp;</div></li><li><div>      register_shutdown_function( array( &$this, '__destruct' ) );&nbsp;</div></li><li><div>      return call_user_func_array( array( &$this, '__construct' ), $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * PHP5 style constructor</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Grabs the arguments, calls bpdb::_init() and then connects to the database</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function __construct()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $args = func_get_args();&nbsp;</div></li><li><div>      $args = call_user_func_array( array( &$this, '_init' ), $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;db_connect_host( $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Initialises the class variables based on provided arguments</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args The provided connection settings</span>&nbsp;</div></li><li><div><span class="comment">   * @return array The current connection settings after processing by init</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function _init( $args )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( !extension_loaded( 'mysql' ) ) {&nbsp;</div></li><li><div>          $this-&gt;show_errors();&nbsp;</div></li><li><div>          $this-&gt;bail( BPDB__PHP_EXTENSION_MISSING );&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 4 == func_num_args() ) {&nbsp;</div></li><li><div>          $args = array(&nbsp;</div></li><li><div>              'user' =&gt; $args, &nbsp;</div></li><li><div>              'password' =&gt; func_get_arg( 1 ), &nbsp;</div></li><li><div>              'name' =&gt; func_get_arg( 2 ), &nbsp;</div></li><li><div>              'host' =&gt; func_get_arg( 3 )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $defaults = array(&nbsp;</div></li><li><div>          'user' =&gt; false, &nbsp;</div></li><li><div>          'password' =&gt; false, &nbsp;</div></li><li><div>          'name' =&gt; false, &nbsp;</div></li><li><div>          'host' =&gt; 'localhost', &nbsp;</div></li><li><div>          'charset' =&gt; false, &nbsp;</div></li><li><div>          'collate' =&gt; false, &nbsp;</div></li><li><div>          'errors' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $args['errors'] ) {&nbsp;</div></li><li><div>          case 'show' :&nbsp;</div></li><li><div>              $this-&gt;show_errors( true );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'suppress' :&nbsp;</div></li><li><div>              $this-&gt;suppress_errors( true );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $args;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * PHP5 style destructor, registered as shutdown function in PHP4</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Always returns true</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function __destruct()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Figure out which database server should handle the query, and connect to it.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string query</span>&nbsp;</div></li><li><div><span class="comment">   * @return resource mysql database connection</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function &db_connect( $query = '' )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $false = false;&nbsp;</div></li><li><div>      if ( empty( $query ) ) {&nbsp;</div></li><li><div>          return $false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $this-&gt;dbh;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Connects to the database server and selects a database</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array args</span>&nbsp;</div></li><li><div><span class="comment">   *    name =&gt; string DB name (required)</span>&nbsp;</div></li><li><div><span class="comment">   *    user =&gt; string DB user (optional: false)</span>&nbsp;</div></li><li><div><span class="comment">   *    password =&gt; string DB user password (optional: false)</span>&nbsp;</div></li><li><div><span class="comment">   *    host =&gt; string DB hostname (optional: 'localhost')</span>&nbsp;</div></li><li><div><span class="comment">   *    charset =&gt; string DB default charset.  Used in a SET NAMES query. (optional)</span>&nbsp;</div></li><li><div><span class="comment">   *    collate =&gt; string DB default collation.  If charset supplied, optionally added to the SET NAMES query (optional)</span>&nbsp;</div></li><li><div><span class="comment">   * @return void|bool void if cannot connect, false if cannot select, true if success</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function db_connect_host( $args )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unset( $this-&gt;dbh ); <span class="comment">// De-reference before re-assigning</span>&nbsp;</div></li><li><div>      $this-&gt;dbh = @mysql_connect( $host, $user, $password, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !$this-&gt;dbh ) {&nbsp;</div></li><li><div>          if ( !$this-&gt;suppress_errors ) {&nbsp;</div></li><li><div>              $this-&gt;show_errors();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $this-&gt;bail( BPDB__CONNECT_ERROR_MESSAGE );&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;ready = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;has_cap( 'collation' ) ) {&nbsp;</div></li><li><div>          if ( !empty( $charset ) ) {&nbsp;</div></li><li><div>              if ( function_exists( 'mysql_set_charset' ) ) {&nbsp;</div></li><li><div>                  mysql_set_charset( $charset, $this-&gt;dbh );&nbsp;</div></li><li><div>                  $this-&gt;real_escape = true;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $collation_query = &quot;SET NAMES '{$charset}'&quot;;&nbsp;</div></li><li><div>                  if ( !empty( $collate ) ) {&nbsp;</div></li><li><div>                      $collation_query .= &quot; COLLATE '{$collate}'&quot;;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $this-&gt;query( $collation_query, true );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;select( $name, $this-&gt;dbh );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Sets the table prefix for the WordPress tables.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string prefix</span>&nbsp;</div></li><li><div><span class="comment">   * @param false|array tables (optional: false)</span>&nbsp;</div></li><li><div><span class="comment">   *    table identifiers are array keys</span>&nbsp;</div></li><li><div><span class="comment">   *    array values</span>&nbsp;</div></li><li><div><span class="comment">   *        empty: set prefix: array( 'posts' =&gt; false, 'users' =&gt; false, ... )</span>&nbsp;</div></li><li><div><span class="comment">   *        string: set to that array value: array( 'posts' =&gt; 'my_posts', 'users' =&gt; 'my_users' )</span>&nbsp;</div></li><li><div><span class="comment">   *    OR array values (with numeric keys): array( 'posts', 'users', ... )</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string the previous prefix (mostly only meaningful if all $table parameter was false)</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function set_prefix( $prefix, $tables = false )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( !$prefix ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( preg_match( '|[^a-z0-9_]|i', $prefix ) ) {&nbsp;</div></li><li><div>          return new WP_Error( 'invalid_db_prefix', 'Invalid database prefix' ); <span class="comment">// No gettext here</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $old_prefix = $this-&gt;prefix;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $tables && is_array( $tables ) ) {&nbsp;</div></li><li><div>          $_tables =& $tables;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $_tables =& $this-&gt;tables;&nbsp;</div></li><li><div>          $this-&gt;prefix = $prefix;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $_tables as $key =&gt; $value ) {&nbsp;</div></li><li><div>          if ( is_numeric( $key ) ) { <span class="comment">// array( 'posts', 'users', ... )</span>&nbsp;</div></li><li><div>              $this-&gt;$value = $prefix . $value;&nbsp;</div></li><li><div>          } elseif ( !$value ) {&nbsp;</div></li><li><div>              $this-&gt;$key = $prefix . $key; <span class="comment">// array( 'posts' =&gt; false, 'users' =&gt; false, ... )</span>&nbsp;</div></li><li><div>          } elseif ( is_string( $value ) ) { <span class="comment">// array( 'posts' =&gt; 'my_posts', 'users' =&gt; 'my_users' )</span>&nbsp;</div></li><li><div>              $this-&gt;$key = $value;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $old_prefix;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Selects a database using the current database connection.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * The database name will be changed based on the current database</span>&nbsp;</div></li><li><div><span class="comment">   * connection. On failure, the execution will bail and display an DB error.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $db MySQL database name</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function select( $db, &$dbh )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( !@mysql_select_db( $db, $dbh ) ) {&nbsp;</div></li><li><div>          $this-&gt;ready = false;&nbsp;</div></li><li><div>          $this-&gt;show_errors();&nbsp;</div></li><li><div>          $this-&gt;bail( BPDB__SELECT_ERROR_MESSAGE );&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _weak_escape( $string )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return addslashes( $string );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _real_escape( $string )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( $this-&gt;dbh && $this-&gt;real_escape ) {&nbsp;</div></li><li><div>          return mysql_real_escape_string( $string, $this-&gt;dbh );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return addslashes( $string );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function _escape( $data )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( is_array( $data ) ) {&nbsp;</div></li><li><div>          foreach ( (array) $data as $k =&gt; $v ) {&nbsp;</div></li><li><div>              if ( is_array( $v ) ) {&nbsp;</div></li><li><div>                  $data[$k] = $this-&gt;_escape( $v );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $data[$k] = $this-&gt;_real_escape( $v );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $data = $this-&gt;_real_escape( $data );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $data;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Escapes content for insertion into the database using addslashes(), for security</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $data</span>&nbsp;</div></li><li><div><span class="comment">   * @return string query safe string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function escape( $data )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( is_array( $data ) ) {&nbsp;</div></li><li><div>          foreach ( (array) $data as $k =&gt; $v ) {&nbsp;</div></li><li><div>              if ( is_array( $v ) ) {&nbsp;</div></li><li><div>                  $data[$k] = $this-&gt;escape( $v );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $data[$k] = $this-&gt;_weak_escape( $v );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $data = $this-&gt;_weak_escape( $data );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $data;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Escapes content by reference for insertion into the database, for security</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $s</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function escape_by_ref( &$string )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $string = $this-&gt;_real_escape( $string );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Escapes array recursively for insertion into the database, for security</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function escape_deep( $array )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;_escape( $array );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Prepares a SQL query for safe execution.  Uses sprintf()-like syntax.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This function only supports a small subset of the sprintf syntax; it only supports %d (decimal number), %s (string).</span>&nbsp;</div></li><li><div><span class="comment">   * Does not support sign, padding, alignment, width or precision specifiers.</span>&nbsp;</div></li><li><div><span class="comment">   * Does not support argument numbering/swapping.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * May be called like {@link http://php.net/sprintf sprintf()} or like {@link http://php.net/vsprintf vsprintf()}.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Both %d and %s should be left unquoted in the query string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   * wpdb::prepare( &quot;SELECT * FROM `table` WHERE `column` = %s AND `field` = %d&quot;, &quot;foo&quot;, 1337 )</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;/code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @link http://php.net/sprintf Description of syntax.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $query Query statement with sprintf()-like placeholders</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|mixed $args The array of variables to substitute into the query's placeholders if being called like {@link http://php.net/vsprintf vsprintf()}, or the first variable to substitute into the query's placeholders if being called like {@link http://php.net/sprintf sprintf()}.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed $args, ... further variables to substitute into the query's placeholders if being called like {@link http://php.net/sprintf sprintf()}.</span>&nbsp;</div></li><li><div><span class="comment">   * @return null|string Sanitized query string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function prepare( $query = null ) <span class="comment">// ( $query, *$args )</span>&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( is_null( $query ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $args = func_get_args();&nbsp;</div></li><li><div>      array_shift( $args );&nbsp;</div></li><li><div>      <span class="comment">// If args were passed as an array (as in vsprintf), move them up</span>&nbsp;</div></li><li><div>      if ( isset( $args[0] ) && is_array( $args[0] ) ) {&nbsp;</div></li><li><div>          $args = $args[0];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $query = str_replace( &quot;'%s'&quot;, '%s', $query ); <span class="comment">// in case someone mistakenly already singlequoted it</span>&nbsp;</div></li><li><div>      $query = str_replace( '&quot;%s&quot;', '%s', $query ); <span class="comment">// doublequote unquoting</span>&nbsp;</div></li><li><div>      $query = str_replace( '%s', &quot;'%s'&quot;, $query ); <span class="comment">// quote the strings</span>&nbsp;</div></li><li><div>      array_walk( $args, array( &$this, 'escape_by_ref' ) );&nbsp;</div></li><li><div>      return @vsprintf( $query, $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get SQL/DB error</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str Error string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function get_error( $str = '' )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( empty( $str ) ) {&nbsp;</div></li><li><div>          if ( $this-&gt;last_error ) {&nbsp;</div></li><li><div>              $str = $this-&gt;last_error;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $caller = $this-&gt;get_caller();&nbsp;</div></li><li><div>      $error_str = sprintf( BPDB__ERROR_STRING, $str, $this-&gt;last_query, $caller );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( class_exists( 'WP_Error' ) ) {&nbsp;</div></li><li><div>          return new WP_Error( 'db_query', $error_str, array( 'query' =&gt; $this-&gt;last_query, 'error' =&gt; $str, 'caller' =&gt; $caller ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return array( 'query' =&gt; $this-&gt;last_query, 'error' =&gt; $str, 'caller' =&gt; $caller, 'error_str' =&gt; $error_str );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Print SQL/DB error.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $str The error to display</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool False if the showing of errors is disabled.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function print_error( $str = '' )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( $this-&gt;suppress_errors ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $error = $this-&gt;get_error( $str );&nbsp;</div></li><li><div>      if ( is_object( $error ) && is_a( $error, 'WP_Error' ) ) {&nbsp;</div></li><li><div>          $err = $error-&gt;get_error_data();&nbsp;</div></li><li><div>          $err['error_str'] = $error-&gt;get_error_message();&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $err =& $error;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $log_file = ini_get( 'error_log' );&nbsp;</div></li><li><div>      if ( !empty( $log_file ) && ( 'syslog' != $log_file ) && is_writable( $log_file ) && function_exists( 'error_log' ) ) {&nbsp;</div></li><li><div>          error_log($err['error_str'], 0);&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Is error output turned on or not</span>&nbsp;</div></li><li><div>      if ( !$this-&gt;show_errors ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $str = htmlspecialchars( $err['error'], ENT_QUOTES );&nbsp;</div></li><li><div>      $query = htmlspecialchars( $err['query'], ENT_QUOTES );&nbsp;</div></li><li><div>      $caller = htmlspecialchars( $err['caller'], ENT_QUOTES );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If there is an error then take note of it</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      printf( BPDB__ERROR_HTML, $str, $query, $caller );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Enables showing of database errors.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This function should be used only to enable showing of errors.</span>&nbsp;</div></li><li><div><span class="comment">   * bpdb::hide_errors() should be used instead for hiding of errors. However, </span>&nbsp;</div></li><li><div><span class="comment">   * this function can be used to enable and disable showing of database</span>&nbsp;</div></li><li><div><span class="comment">   * errors.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $show Whether to show or hide errors</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Old value for showing errors.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function show_errors( $show = true )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $errors = $this-&gt;show_errors;&nbsp;</div></li><li><div>      $this-&gt;show_errors = $show;&nbsp;</div></li><li><div>      return $errors;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Disables showing of database errors.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Whether showing of errors was active or not</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function hide_errors()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;show_errors( false );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether to suppress database errors.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $suppress</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool previous setting</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function suppress_errors( $suppress = true )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $errors = $this-&gt;suppress_errors;&nbsp;</div></li><li><div>      $this-&gt;suppress_errors = $suppress;&nbsp;</div></li><li><div>      return $errors;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Kill cached query results.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function flush()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;last_result = array();&nbsp;</div></li><li><div>      $this-&gt;col_info = array();&nbsp;</div></li><li><div>      $this-&gt;last_query = null;&nbsp;</div></li><li><div>      $this-&gt;last_error = '';&nbsp;</div></li><li><div>      $this-&gt;num_rows = 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Perform a MySQL database query, using current database connection.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * More information can be found on the codex page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $query</span>&nbsp;</div></li><li><div><span class="comment">   * @return int|false Number of rows affected/selected or false on error</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function query( $query, $use_current = false )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( !$this-&gt;ready ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// filter the query, if filters are available</span>&nbsp;</div></li><li><div>      <span class="comment">// NOTE: some queries are made before the plugins have been loaded, and thus cannot be filtered with this method</span>&nbsp;</div></li><li><div>      if ( function_exists( 'apply_filters' ) ) {&nbsp;</div></li><li><div>          $query = apply_filters( 'query', $query );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// initialise return</span>&nbsp;</div></li><li><div>      $return_val = 0;&nbsp;</div></li><li><div>      $this-&gt;flush();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Log how the function was called</span>&nbsp;</div></li><li><div>      $this-&gt;func_call = &quot;\$db-&gt;query(\&quot;$query\&quot;)&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Keep track of the last query for debug..</span>&nbsp;</div></li><li><div>      $this-&gt;last_query = $query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Perform the query via std mysql_query function..</span>&nbsp;</div></li><li><div>      if ( SAVEQUERIES ) {&nbsp;</div></li><li><div>          $this-&gt;timer_start();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $use_current ) {&nbsp;</div></li><li><div>          $dbh =& $this-&gt;dbh;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $dbh = $this-&gt;db_connect( $query );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;result = @mysql_query( $query, $dbh );&nbsp;</div></li><li><div>      ++$this-&gt;num_queries;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( SAVEQUERIES ) {&nbsp;</div></li><li><div>          $this-&gt;queries[] = array( $query, $this-&gt;timer_stop(), $this-&gt;get_caller() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If there is an error then take note of it</span>..&nbsp;</div></li><li><div>      if ( $this-&gt;last_error = mysql_error( $dbh ) ) {&nbsp;</div></li><li><div>          return $this-&gt;print_error( $this-&gt;last_error );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( preg_match( &quot;/^\\s*(insert|delete|update|replace|alter) /i&quot;, $query ) ) {&nbsp;</div></li><li><div>          $this-&gt;rows_affected = mysql_affected_rows( $dbh );&nbsp;</div></li><li><div>          <span class="comment">// Take note of the insert_id</span>&nbsp;</div></li><li><div>          if ( preg_match( &quot;/^\\s*(insert|replace) /i&quot;, $query ) ) {&nbsp;</div></li><li><div>              $this-&gt;insert_id = mysql_insert_id( $dbh );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// Return number of rows affected</span>&nbsp;</div></li><li><div>          $return_val = $this-&gt;rows_affected;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $i = 0;&nbsp;</div></li><li><div>          while ( $i &lt; @mysql_num_fields( $this-&gt;result ) ) {&nbsp;</div></li><li><div>              $this-&gt;col_info[$i] = @mysql_fetch_field( $this-&gt;result );&nbsp;</div></li><li><div>              $i++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $num_rows = 0;&nbsp;</div></li><li><div>          while ( $row = @mysql_fetch_object( $this-&gt;result ) ) {&nbsp;</div></li><li><div>              $this-&gt;last_result[$num_rows] = $row;&nbsp;</div></li><li><div>              $num_rows++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          @mysql_free_result( $this-&gt;result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Log number of rows the query returned</span>&nbsp;</div></li><li><div>          $this-&gt;num_rows = $num_rows;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Return number of rows selected</span>&nbsp;</div></li><li><div>          $return_val = $this-&gt;num_rows;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $return_val;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Insert a row into a table.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   * wpdb::insert( 'table', array( 'column' =&gt; 'foo', 'field' =&gt; 1337 ), array( '%s', '%d' ) )</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;/code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @see bpdb::prepare()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $table table name</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data Data to insert (in column =&gt; value pairs).  Both $data columns and $data values should be &quot;raw&quot; (neither should be SQL escaped).</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|string $format (optional) An array of formats to be mapped to each of the value in $data.  If string, that format will be used for all of the values in $data.  A format is one of '%d', '%s' (decimal number, string).  If omitted, all values in $data will be treated as strings.</span>&nbsp;</div></li><li><div><span class="comment">   * @return int|false The number of rows inserted, or false on error.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function insert( $table, $data, $format = null )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $formats = $format = (array) $format;&nbsp;</div></li><li><div>      $fields = array_keys( $data );&nbsp;</div></li><li><div>      $formatted_fields = array();&nbsp;</div></li><li><div>      foreach ( $fields as $field ) {&nbsp;</div></li><li><div>          if ( !empty( $format ) ) {&nbsp;</div></li><li><div>              $form = ( $form = array_shift( $formats ) ) ? $form : $format[0];&nbsp;</div></li><li><div>          } elseif ( isset( $this-&gt;field_types[$field] ) ) {&nbsp;</div></li><li><div>              $form = $this-&gt;field_types[$field];&nbsp;</div></li><li><div>          } elseif ( is_null( $data[$field] ) ) {&nbsp;</div></li><li><div>              $form = 'NULL';&nbsp;</div></li><li><div>              unset( $data[$field] );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $form = '%s';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $formatted_fields[] = $form;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $sql = &quot;INSERT INTO `$table` (`&quot; . implode( '`, `', $fields ) . &quot;`) VALUES (&quot; . implode( &quot;, &quot;, $formatted_fields ) . &quot;)&quot;;&nbsp;</div></li><li><div>      return $this-&gt;query( $this-&gt;prepare( $sql, $data ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Update a row in the table</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   * wpdb::update( 'table', array( 'column' =&gt; 'foo', 'field' =&gt; 1337 ), array( 'ID' =&gt; 1 ), array( '%s', '%d' ), array( '%d' ) )</span>&nbsp;</div></li><li><div><span class="comment">   * &lt;/code&gt;</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   * @see bpdb::prepare()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $table table name</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $data Data to update (in column =&gt; value pairs).  Both $data columns and $data values should be &quot;raw&quot; (neither should be SQL escaped).</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $where A named array of WHERE clauses (in column =&gt; value pairs).  Multiple clauses will be joined with ANDs.  Both $where columns and $where values should be &quot;raw&quot;.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|string $format (optional) An array of formats to be mapped to each of the values in $data.  If string, that format will be used for all of the values in $data.  A format is one of '%d', '%s' (decimal number, string).  If omitted, all values in $data will be treated as strings.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array|string $format_where (optional) An array of formats to be mapped to each of the values in $where.  If string, that format will be used for all of  the items in $where.  A format is one of '%d', '%s' (decimal number, string).  If omitted, all values in $where will be treated as strings.</span>&nbsp;</div></li><li><div><span class="comment">   * @return int|false The number of rows updated, or false on error.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function update( $table, $data, $where, $format = null, $where_format = null )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( !is_array( $where ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $formats = $format = (array) $format;&nbsp;</div></li><li><div>      $bits = $wheres = array();&nbsp;</div></li><li><div>      foreach ( (array) array_keys( $data ) as $field ) {&nbsp;</div></li><li><div>          if ( !empty( $format ) ) {&nbsp;</div></li><li><div>              $form = ( $form = array_shift( $formats ) ) ? $form : $format[0];&nbsp;</div></li><li><div>          } elseif ( isset( $this-&gt;field_types[$field] ) ) {&nbsp;</div></li><li><div>              $form = $this-&gt;field_types[$field];&nbsp;</div></li><li><div>          } elseif ( is_null( $data[$field] ) ) {&nbsp;</div></li><li><div>              $form = 'NULL';&nbsp;</div></li><li><div>              unset( $data[$field] );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $form = '%s';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $bits[] = &quot;`$field` = {$form}&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $where_formats = $where_format = (array) $where_format;&nbsp;</div></li><li><div>      foreach ( (array) array_keys( $where ) as $field ) {&nbsp;</div></li><li><div>          if ( !empty( $where_format ) ) {&nbsp;</div></li><li><div>              $form = ( $form = array_shift( $where_formats ) ) ? $form : $where_format[0];&nbsp;</div></li><li><div>          } elseif ( isset( $this-&gt;field_types[$field] ) ) {&nbsp;</div></li><li><div>              $form = $this-&gt;field_types[$field];&nbsp;</div></li><li><div>          } elseif ( is_null( $where[$field] ) ) {&nbsp;</div></li><li><div>              unset( $where[$field] );&nbsp;</div></li><li><div>              $wheres[] = &quot;`$field` IS NULL&quot;;&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $form = '%s';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $wheres[] = &quot;`$field` = {$form}&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $sql = &quot;UPDATE `$table` SET &quot; . implode( ', ', $bits ) . ' WHERE ' . implode( ' AND ', $wheres );&nbsp;</div></li><li><div>      return $this-&gt;query( $this-&gt;prepare( $sql, array_merge( array_values( $data ), array_values( $where ) ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve one variable from the database.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Executes a SQL query and returns the value from the SQL result.</span>&nbsp;</div></li><li><div><span class="comment">   * If the SQL result contains more than one column and/or more than one row, this function returns the value in the column and row specified.</span>&nbsp;</div></li><li><div><span class="comment">   * If $query is null, this function returns the value in the specified column and row from the previous SQL result.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|null $query SQL query.  If null, use the result from the previous query.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $x (optional) Column of value to return.  Indexed from 0.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $y (optional) Row of value to return.  Indexed from 0.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string Database query result</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function get_var( $query=null, $x = 0, $y = 0 )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;func_call = &quot;\$db-&gt;get_var(\&quot;$query\&quot;, $x, $y)&quot;;&nbsp;</div></li><li><div>      if ( $query ) {&nbsp;</div></li><li><div>          $this-&gt;query( $query );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Extract var out of cached results based x, y vals</span>&nbsp;</div></li><li><div>      if ( !empty( $this-&gt;last_result[$y] ) ) {&nbsp;</div></li><li><div>          $values = array_values( get_object_vars( $this-&gt;last_result[$y] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If there is a value return it else return null</span>&nbsp;</div></li><li><div>      return ( isset($values[$x]) && $values[$x]!=='' ) ? $values[$x] : null;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve one row from the database.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Executes a SQL query and returns the row from the SQL result.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|null $query SQL query.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $output (optional) one of ARRAY_A | ARRAY_N | OBJECT constants.  Return an associative array (column =&gt; value, ...), a numerically indexed array (0 =&gt; value, ...) or an object ( -&gt;column = value ), respectively.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $y (optional) Row to return.  Indexed from 0.</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed Database query result in format specifed by $output</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function get_row( $query = null, $output = OBJECT, $y = 0 )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;func_call = &quot;\$db-&gt;get_row(\&quot;$query\&quot;, $output, $y)&quot;;&nbsp;</div></li><li><div>      if ( $query ) {&nbsp;</div></li><li><div>          $this-&gt;query( $query );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return null;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !isset( $this-&gt;last_result[$y] ) ) {&nbsp;</div></li><li><div>          return null;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $output == OBJECT ) {&nbsp;</div></li><li><div>          return $this-&gt;last_result[$y] ? $this-&gt;last_result[$y] : null;&nbsp;</div></li><li><div>      } elseif ( $output == ARRAY_A ) {&nbsp;</div></li><li><div>          return $this-&gt;last_result[$y] ? get_object_vars( $this-&gt;last_result[$y] ) : null;&nbsp;</div></li><li><div>      } elseif ( $output == ARRAY_N ) {&nbsp;</div></li><li><div>          return $this-&gt;last_result[$y] ? array_values( get_object_vars( $this-&gt;last_result[$y] ) ) : null;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;print_error( &quot; \$db-&gt;get_row(string query, output type, int offset) -- Output type must be one of: OBJECT, ARRAY_A, ARRAY_N&quot; );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve one column from the database.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Executes a SQL query and returns the column from the SQL result.</span>&nbsp;</div></li><li><div><span class="comment">   * If the SQL result contains more than one column, this function returns the column specified.</span>&nbsp;</div></li><li><div><span class="comment">   * If $query is null, this function returns the specified column from the previous SQL result.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|null $query SQL query.  If null, use the result from the previous query.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $x Column to return.  Indexed from 0.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array Database query result.  Array indexed from 0 by SQL result row number.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function get_col( $query = null , $x = 0 )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( $query ) {&nbsp;</div></li><li><div>          $this-&gt;query( $query );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $new_array = array();&nbsp;</div></li><li><div>      <span class="comment">// Extract the column values</span>&nbsp;</div></li><li><div>      for ( $i=0; $i &lt; count( $this-&gt;last_result ); $i++ ) {&nbsp;</div></li><li><div>          $new_array[$i] = $this-&gt;get_var( null, $x, $i );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $new_array;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve an entire SQL result set from the database (i.e., many rows)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Executes a SQL query and returns the entire SQL result.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $query SQL query.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $output (optional) ane of ARRAY_A | ARRAY_N | OBJECT | OBJECT_K | ARRAY_K constants.  With one of the first three, return an array of rows indexed from 0 by SQL result row number.  Each row is an associative array (column =&gt; value, ...), a numerically indexed array (0 =&gt; value, ...), or an object. ( -&gt;column = value ), respectively.  With OBJECT_K and ARRAY_K, return an associative array of row objects keyed by the value of each row's first column's value.  Duplicate keys are discarded.</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed Database query results</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function get_results( $query = null, $output = OBJECT ) &nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $this-&gt;func_call = &quot;\$db-&gt;get_results(\&quot;$query\&quot;, $output)&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $query ) {&nbsp;</div></li><li><div>          $this-&gt;query($query);&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return null;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $output == OBJECT ) {&nbsp;</div></li><li><div>          <span class="comment">// Return an integer-keyed array of row objects</span>&nbsp;</div></li><li><div>          return $this-&gt;last_result;&nbsp;</div></li><li><div>      } elseif ( $output == OBJECT_K || $output == ARRAY_K ) {&nbsp;</div></li><li><div>          <span class="comment">// Return an array of row objects with keys from column 1</span>&nbsp;</div></li><li><div>          <span class="comment">// (Duplicates are discarded)</span>&nbsp;</div></li><li><div>          $key = $this-&gt;col_info[0]-&gt;name;&nbsp;</div></li><li><div>          foreach ( $this-&gt;last_result as $row ) {&nbsp;</div></li><li><div>              if ( !isset( $new_array[ $row-&gt;$key ] ) ) {&nbsp;</div></li><li><div>                  $new_array[ $row-&gt;$key ] = $row;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $output == ARRAY_K ) {&nbsp;</div></li><li><div>              return array_map( 'get_object_vars', $new_array );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $new_array;&nbsp;</div></li><li><div>      } elseif ( $output == ARRAY_A || $output == ARRAY_N ) {&nbsp;</div></li><li><div>          <span class="comment">// Return an integer-keyed array of...</span>&nbsp;</div></li><li><div>          if ( $this-&gt;last_result ) {&nbsp;</div></li><li><div>              $i = 0;&nbsp;</div></li><li><div>              foreach( $this-&gt;last_result as $row ) {&nbsp;</div></li><li><div>                  if ( $output == ARRAY_N ) {&nbsp;</div></li><li><div>                      <span class="comment">// ...integer-keyed row arrays</span>&nbsp;</div></li><li><div>                      $new_array[$i] = array_values( get_object_vars( $row ) );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      <span class="comment">// ...column name-keyed row arrays</span>&nbsp;</div></li><li><div>                      $new_array[$i] = get_object_vars( $row );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  ++$i;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return $new_array;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve column metadata from the last query.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $info_type one of name, table, def, max_length, not_null, primary_key, multiple_key, unique_key, numeric, blob, type, unsigned, zerofill</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $col_offset 0: col name. 1: which table the col's in. 2: col's max length. 3: if the col is numeric. 4: col's type</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed Column Results</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function get_col_info( $info_type = 'name', $col_offset = -1 )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( $this-&gt;col_info ) {&nbsp;</div></li><li><div>          if ( $col_offset == -1 ) {&nbsp;</div></li><li><div>              $i = 0;&nbsp;</div></li><li><div>              foreach( (array) $this-&gt;col_info as $col ) {&nbsp;</div></li><li><div>                  $new_array[$i] = $col-&gt;{$info_type};&nbsp;</div></li><li><div>                  $i++;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return $new_array;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return $this-&gt;col_info[$col_offset]-&gt;{$info_type};&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Starts the timer, for debugging purposes.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return true</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function timer_start()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $mtime = microtime();&nbsp;</div></li><li><div>      $mtime = explode( ' ', $mtime );&nbsp;</div></li><li><div>      $this-&gt;time_start = $mtime[1] + $mtime[0];&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Stops the debugging timer.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Total time spent on the query, in milliseconds</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function timer_stop()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $mtime = microtime();&nbsp;</div></li><li><div>      $mtime = explode( ' ', $mtime );&nbsp;</div></li><li><div>      $time_end = $mtime[1] + $mtime[0];&nbsp;</div></li><li><div>      $time_total = $time_end - $this-&gt;time_start;&nbsp;</div></li><li><div>      return $time_total;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Wraps errors in a nice header and footer and dies.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Will not die if bpdb::$show_errors is true</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $message</span>&nbsp;</div></li><li><div><span class="comment">   * @return false|void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function bail( $message )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( !$this-&gt;show_errors ) {&nbsp;</div></li><li><div>          if ( class_exists( 'WP_Error' ) )&nbsp;</div></li><li><div>              $this-&gt;error = new WP_Error( '500', $message );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              $this-&gt;error = $message;&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      backpress_die( $message );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether or not MySQL database is at least the required minimum version.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return WP_Error</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function check_database_version( $dbh_or_table = false )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// Make sure the server has MySQL 4.0</span>&nbsp;</div></li><li><div>      if ( version_compare( $this-&gt;db_version( $dbh_or_table ), '4.0.0', '&lt;' ) ) {&nbsp;</div></li><li><div>          return new WP_Error( 'database_version', BPDB__DB_VERSION_ERROR );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Whether of not the database supports collation.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Called when BackPress is generating the table scheme.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True if collation is supported, false if version does not</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function supports_collation()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      return $this-&gt;has_cap( 'collation' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Generic function to determine if a database supports a particular feature</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $db_cap the feature</span>&nbsp;</div></li><li><div><span class="comment">   * @param false|string|resource $dbh_or_table Which database to test.  False = the currently selected database, string = the database containing the specified table, resource = the database corresponding to the specified mysql resource.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function has_cap( $db_cap, $dbh_or_table = false )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      $version = $this-&gt;db_version( $dbh_or_table );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( strtolower( $db_cap ) ) {&nbsp;</div></li><li><div>          case 'collation' :&nbsp;</div></li><li><div>          case 'group_concat' :&nbsp;</div></li><li><div>          case 'subqueries' :&nbsp;</div></li><li><div>              return version_compare( $version, '4.1', '&gt;=' );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'index_hint_for_join' :&nbsp;</div></li><li><div>              return version_compare( $version, '5.0', '&gt;=' );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'index_hint_lists' :&nbsp;</div></li><li><div>          case 'index_hint_for_any' :&nbsp;</div></li><li><div>              return version_compare( $version, '5.1', '&gt;=' );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * The database version number</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param false|string|resource $dbh_or_table Which database to test. False = the currently selected database, string = the database containing the specified table, resource = the database corresponding to the specified mysql resource.</span>&nbsp;</div></li><li><div><span class="comment">   * @return false|string false on failure, version number on success</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function db_version( $dbh_or_table = false )&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      if ( !$dbh_or_table ) {&nbsp;</div></li><li><div>          $dbh =& $this-&gt;dbh;&nbsp;</div></li><li><div>      } elseif ( is_resource( $dbh_or_table ) ) {&nbsp;</div></li><li><div>          $dbh =& $dbh_or_table;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $dbh = $this-&gt;db_connect( &quot;DESCRIBE $dbh_or_table&quot; );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $dbh ) {&nbsp;</div></li><li><div>          return preg_replace( '|[^0-9\.]|', '', mysql_get_server_info( $dbh ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve the name of the function that called bpdb.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Requires PHP 4.3 and searches up the list of functions until it reaches</span>&nbsp;</div></li><li><div><span class="comment">   * the one that would most logically had called this method.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string The name of the calling function</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function get_caller()&nbsp;</div></li><li><div>  {&nbsp;</div></li><li><div>      <span class="comment">// requires PHP 4.3+</span>&nbsp;</div></li><li><div>      if ( !is_callable( 'debug_backtrace' ) ) {&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bt = debug_backtrace();&nbsp;</div></li><li><div>      $caller = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bt = array_reverse( $bt );&nbsp;</div></li><li><div>      foreach ( (array) $bt as $call ) {&nbsp;</div></li><li><div>          if ( @$call['class'] == __CLASS__ ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $function = $call['function'];&nbsp;</div></li><li><div>          if ( isset( $call['class'] ) ) {&nbsp;</div></li><li><div>              $function = $call['class'] . &quot;-&gt;$function&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $caller[] = $function;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $caller = join( ', ', $caller );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $caller;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>