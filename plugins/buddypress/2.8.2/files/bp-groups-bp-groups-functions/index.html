<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.8.2" data-slug="buddypress" data-type="file" data-id="49289"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-groups-bp-groups-functions | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.8.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.24"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ce8b362a8deb88be3733ded01259e87b' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.24' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-groups-bp-groups-functions/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-groups-bp-groups-functions%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-groups-bp-groups-functions%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.2-file-bp-groups-bp-groups-functions","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-groups-bp-groups-functions" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.8.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-groups-bp-groups-functions</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.2/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.2/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.2/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.2/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-groups/bp-groups-functions.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * BuddyPress Groups Functions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Functions are where all the magic happens in BuddyPress. They will</span>&nbsp;</div></li><li><div><span class="comment"> * handle the actual saving or manipulation of information. Usually they will</span>&nbsp;</div></li><li><div><span class="comment"> * hand off to a database class for data access, then return</span>&nbsp;</div></li><li><div><span class="comment"> * true or false on success or failure.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BuddyPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage GroupsFunctions</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly.</span>&nbsp;</div></li><li><div>defined( 'ABSPATH' ) || exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether there is a Groups directory page in the $bp global.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if set, False if empty.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_groups_has_directory() {&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return (bool) !empty( $bp-&gt;pages-&gt;groups-&gt;id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fetch a single group object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * When calling up a group object, you should always use this function instead</span>&nbsp;</div></li><li><div><span class="comment"> * of instantiating BP_Groups_Group directly, so that you will inherit cache</span>&nbsp;</div></li><li><div><span class="comment"> * support and pass through the groups_get_group filter.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0 The function signature was changed to accept a group ID only, </span>&nbsp;</div></li><li><div><span class="comment"> *              instead of an array containing the group ID.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return BP_Groups_Group $group The group object.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_group( $group_id ) {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Backward compatibilty.</span>&nbsp;</div></li><li><div><span class="comment">   * Old-style arguments take the form of an array or a query string.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( ! is_numeric( $group_id ) ) {&nbsp;</div></li><li><div>      $r = wp_parse_args( $group_id, array(&nbsp;</div></li><li><div>          'group_id' =&gt; false, &nbsp;</div></li><li><div>          'load_users' =&gt; false, &nbsp;</div></li><li><div>          'populate_extras' =&gt; false, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $group_id = $r['group_id'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $group = new BP_Groups_Group( $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a single group object.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param BP_Groups_Group $group Single group object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'groups_get_group', $group );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Creation, Editing & Deletion ****************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     An array of arguments.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int|bool $group_id     Pass a group ID to update an existing item, or</span>&nbsp;</div></li><li><div><span class="comment"> *                                  0 / false to create a new group. Default: 0.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int      $creator_id   The user ID that creates the group.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $name         The group name.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $description  Optional. The group's description.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $slug         The group slug.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $status       The group's status. Accepts 'public', 'private' or</span>&nbsp;</div></li><li><div><span class="comment"> *                                  'hidden'. Defaults to 'public'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int      $parent_id    The ID of the parent group. Default: 0.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int      $enable_forum Optional. Whether the group has a forum enabled.</span>&nbsp;</div></li><li><div><span class="comment"> *                                  If the legacy forums are enabled for this group</span>&nbsp;</div></li><li><div><span class="comment"> *                                  or if a bbPress forum is enabled for the group, </span>&nbsp;</div></li><li><div><span class="comment"> *                                  set this to 1. Default: 0.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $date_created The GMT time, in Y-m-d h:i:s format, when the group</span>&nbsp;</div></li><li><div><span class="comment"> *                                  was created. Defaults to the current time.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool The ID of the group on success. False on error.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_create_group( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'group_id' =&gt; 0, &nbsp;</div></li><li><div>      'creator_id' =&gt; 0, &nbsp;</div></li><li><div>      'name' =&gt; '', &nbsp;</div></li><li><div>      'description' =&gt; '', &nbsp;</div></li><li><div>      'slug' =&gt; '', &nbsp;</div></li><li><div>      'status' =&gt; 'public', &nbsp;</div></li><li><div>      'parent_id' =&gt; 0, &nbsp;</div></li><li><div>      'enable_forum' =&gt; 0, &nbsp;</div></li><li><div>      'date_created' =&gt; bp_core_current_time()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Pass an existing group ID.</span>&nbsp;</div></li><li><div>  if ( ! empty( $group_id ) ) {&nbsp;</div></li><li><div>      $group = groups_get_group( $group_id );&nbsp;</div></li><li><div>      $name = ! empty( $name ) ? $name : $group-&gt;name;&nbsp;</div></li><li><div>      $slug = ! empty( $slug ) ? $slug : $group-&gt;slug;&nbsp;</div></li><li><div>      $description = ! empty( $description ) ? $description : $group-&gt;description;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Groups need at least a name.</span>&nbsp;</div></li><li><div>      if ( empty( $name ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Create a new group.</span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Instantiate new group object.</span>&nbsp;</div></li><li><div>      $group = new BP_Groups_Group;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set creator ID.</span>&nbsp;</div></li><li><div>  if ( $creator_id ) {&nbsp;</div></li><li><div>      $group-&gt;creator_id = (int) $creator_id;&nbsp;</div></li><li><div>  } elseif ( is_user_logged_in() ) {&nbsp;</div></li><li><div>      $group-&gt;creator_id = bp_loggedin_user_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $group-&gt;creator_id ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Validate status.</span>&nbsp;</div></li><li><div>  if ( ! groups_is_valid_status( $status ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set group name.</span>&nbsp;</div></li><li><div>  $group-&gt;name = $name;&nbsp;</div></li><li><div>  $group-&gt;description = $description;&nbsp;</div></li><li><div>  $group-&gt;slug = $slug;&nbsp;</div></li><li><div>  $group-&gt;status = $status;&nbsp;</div></li><li><div>  $group-&gt;parent_id = $parent_id;&nbsp;</div></li><li><div>  $group-&gt;enable_forum = (int) $enable_forum;&nbsp;</div></li><li><div>  $group-&gt;date_created = $date_created;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Save group.</span>&nbsp;</div></li><li><div>  if ( ! $group-&gt;save() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If this is a new group, set up the creator as the first member and admin.</span>&nbsp;</div></li><li><div>  if ( empty( $group_id ) ) {&nbsp;</div></li><li><div>      $member = new BP_Groups_Member;&nbsp;</div></li><li><div>      $member-&gt;group_id = $group-&gt;id;&nbsp;</div></li><li><div>      $member-&gt;user_id = $group-&gt;creator_id;&nbsp;</div></li><li><div>      $member-&gt;is_admin = 1;&nbsp;</div></li><li><div>      $member-&gt;user_title = __( 'Group Admin', 'buddypress' );&nbsp;</div></li><li><div>      $member-&gt;is_confirmed = 1;&nbsp;</div></li><li><div>      $member-&gt;date_modified = bp_core_current_time();&nbsp;</div></li><li><div>      $member-&gt;save();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the creation of a new group and a group creator needs to be made.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int              $id     ID of the newly created group.</span>&nbsp;</div></li><li><div><span class="comment">       * @param BP_Groups_Member $member Instance of the member who is assigned</span>&nbsp;</div></li><li><div><span class="comment">       *                                 as group creator.</span>&nbsp;</div></li><li><div><span class="comment">       * @param BP_Groups_Group  $group  Instance of the group being created.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_create_group', $group-&gt;id, $member, $group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the update of a group.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int             $id    ID of the updated group.</span>&nbsp;</div></li><li><div><span class="comment">       * @param BP_Groups_Group $group Instance of the group being updated.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_update_group', $group-&gt;id, $group );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the creation or update of a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int             $id    ID of the newly created group.</span>&nbsp;</div></li><li><div><span class="comment">   * @param BP_Groups_Group $group Instance of the group being updated.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_created_group', $group-&gt;id, $group );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $group-&gt;id;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Edit the base details for a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * These are the settings that appear on the first page of the group's Admin</span>&nbsp;</div></li><li><div><span class="comment"> * section (Name, Description, and &quot;Notify members...&quot;).</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $group_id       ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $group_name     Name of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $group_desc     Description of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $notify_members Whether to send an email notification to group</span>&nbsp;</div></li><li><div><span class="comment"> *                               members about changes in these details.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_edit_base_group_details( $group_id, $group_name, $group_desc, $notify_members ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $group_name ) || empty( $group_desc ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $group = groups_get_group( $group_id );&nbsp;</div></li><li><div>  $old_group = clone $group;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $group-&gt;name = $group_name;&nbsp;</div></li><li><div>  $group-&gt;description = $group_desc;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$group-&gt;save() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $notify_members ) {&nbsp;</div></li><li><div>      groups_notification_group_updated( $group-&gt;id, $old_group );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fired after a group's details are updated.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int             $value          ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @param BP_Groups_Group $old_group      Group object, before being modified.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool            $notify_members Whether to send an email notification to members about the change.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_details_updated', $group-&gt;id, $old_group, $notify_members );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Edit the base details for a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * These are the settings that appear on the Settings page of the group's Admin</span>&nbsp;</div></li><li><div><span class="comment"> * section (privacy settings, &quot;enable forum&quot;, invitation status).</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int         $group_id      ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool        $enable_forum  Whether to enable a forum for the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $status        Group status. 'public', 'private', 'hidden'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|bool $invite_status Optional. Who is allowed to send invitations</span>&nbsp;</div></li><li><div><span class="comment"> *                                   to the group. 'members', 'mods', or 'admins'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_edit_group_settings( $group_id, $enable_forum, $status, $invite_status = false, $parent_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $group = groups_get_group( $group_id );&nbsp;</div></li><li><div>  $group-&gt;enable_forum = $enable_forum;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Before we potentially switch the group status, if it has been changed to public</span>&nbsp;</div></li><li><div><span class="comment">   * from private and there are outstanding membership requests, auto-accept those requests.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( 'private' == $group-&gt;status && 'public' == $status )&nbsp;</div></li><li><div>      groups_accept_all_pending_membership_requests( $group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Now update the status.</span>&nbsp;</div></li><li><div>  $group-&gt;status = $status;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Update the parent ID if necessary.</span>&nbsp;</div></li><li><div>  if ( false !== $parent_id ) {&nbsp;</div></li><li><div>      $group-&gt;parent_id = $parent_id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$group-&gt;save() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If forums have been enabled, and a forum does not yet exist, we need to create one.</span>&nbsp;</div></li><li><div>  if ( $group-&gt;enable_forum ) {&nbsp;</div></li><li><div>      if ( bp_is_active( 'forums' ) && !groups_get_groupmeta( $group-&gt;id, 'forum_id' ) ) {&nbsp;</div></li><li><div>          groups_new_group_forum( $group-&gt;id, $group-&gt;name, $group-&gt;description );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set the invite status.</span>&nbsp;</div></li><li><div>  if ( $invite_status )&nbsp;</div></li><li><div>      groups_update_groupmeta( $group-&gt;id, 'invite_status', $invite_status );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  groups_update_groupmeta( $group-&gt;id, 'last_activity', bp_core_current_time() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the update of a groups settings.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id ID of the group that was updated.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_settings_updated', $group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a group and all of its associated metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group to delete.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_delete_group( $group_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the deletion of a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group to be deleted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_before_delete_group', $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the group object.</span>&nbsp;</div></li><li><div>  $group = groups_get_group( $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if group cannot be deleted.</span>&nbsp;</div></li><li><div>  if ( ! $group-&gt;delete() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Remove all outstanding invites for this group.</span>&nbsp;</div></li><li><div>  groups_delete_all_group_invites( $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the deletion of a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group that was deleted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_delete_group', $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check a group status (eg 'private') against the whitelist of registered statuses.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $status Status to check.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if status is allowed, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_is_valid_status( $status ) {&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return in_array( $status, (array) $bp-&gt;groups-&gt;valid_status );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Provide a unique, sanitized version of a group slug.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $slug Group slug to check.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string $slug A unique and sanitized slug.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_check_slug( $slug ) {&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'wp' == substr( $slug, 0, 2 ) )&nbsp;</div></li><li><div>      $slug = substr( $slug, 2, strlen( $slug ) - 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( in_array( $slug, (array) $bp-&gt;groups-&gt;forbidden_names ) )&nbsp;</div></li><li><div>      $slug = $slug . '-' . rand();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( BP_Groups_Group::check_slug( $slug ) ) {&nbsp;</div></li><li><div>      do {&nbsp;</div></li><li><div>          $slug = $slug . '-' . rand();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      while ( BP_Groups_Group::check_slug( $slug ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $slug;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a group slug by its ID.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id The numeric ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The group's slug.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_slug( $group_id ) {&nbsp;</div></li><li><div>  $group = groups_get_group( $group_id );&nbsp;</div></li><li><div>  return !empty( $group-&gt;slug ) ? $group-&gt;slug : '';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a group ID by its slug.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $group_slug The group's slug.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|null The group ID on success; null on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_id( $group_slug ) {&nbsp;</div></li><li><div>  return BP_Groups_Group::group_exists( $group_slug );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** User Actions **************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove a user from a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  Optional. ID of the user. Defaults to the currently</span>&nbsp;</div></li><li><div><span class="comment"> *                      logged-in user.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_leave_group( $group_id, $user_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) )&nbsp;</div></li><li><div>      $user_id = bp_loggedin_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Don't let single admins leave the group.</span>&nbsp;</div></li><li><div>  if ( count( groups_get_group_admins( $group_id ) ) &lt; 2 ) {&nbsp;</div></li><li><div>      if ( groups_is_user_admin( $user_id, $group_id ) ) {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'As the only admin, you cannot leave the group.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! BP_Groups_Member::delete( $user_id, $group_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bp_core_add_message( __( 'You successfully left the group.', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after a user leaves a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id  ID of the user leaving the group.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_leave_group', $group_id, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add a user to a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  Optional. ID of the user. Defaults to the currently</span>&nbsp;</div></li><li><div><span class="comment"> *                      logged-in user.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_join_group( $group_id, $user_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) )&nbsp;</div></li><li><div>      $user_id = bp_loggedin_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check if the user has an outstanding invite. If so, delete it.</span>&nbsp;</div></li><li><div>  if ( groups_check_user_has_invite( $user_id, $group_id ) )&nbsp;</div></li><li><div>      groups_delete_invite( $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check if the user has an outstanding request. If so, delete it.</span>&nbsp;</div></li><li><div>  if ( groups_check_for_membership_request( $user_id, $group_id ) )&nbsp;</div></li><li><div>      groups_delete_membership_request( null, $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// User is already a member, just return true.</span>&nbsp;</div></li><li><div>  if ( groups_is_user_member( $user_id, $group_id ) )&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $new_member = new BP_Groups_Member;&nbsp;</div></li><li><div>  $new_member-&gt;group_id = $group_id;&nbsp;</div></li><li><div>  $new_member-&gt;user_id = $user_id;&nbsp;</div></li><li><div>  $new_member-&gt;inviter_id = 0;&nbsp;</div></li><li><div>  $new_member-&gt;is_admin = 0;&nbsp;</div></li><li><div>  $new_member-&gt;user_title = '';&nbsp;</div></li><li><div>  $new_member-&gt;date_modified = bp_core_current_time();&nbsp;</div></li><li><div>  $new_member-&gt;is_confirmed = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$new_member-&gt;save() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !isset( $bp-&gt;groups-&gt;current_group ) || !$bp-&gt;groups-&gt;current_group || $group_id != $bp-&gt;groups-&gt;current_group-&gt;id )&nbsp;</div></li><li><div>      $group = groups_get_group( $group_id );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $group = $bp-&gt;groups-&gt;current_group;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Record this in activity streams.</span></span>&nbsp;</div></li><li><div>  groups_record_activity( array(&nbsp;</div></li><li><div>      'type' =&gt; 'joined_group', &nbsp;</div></li><li><div>      'item_id' =&gt; $group_id, &nbsp;</div></li><li><div>      'user_id' =&gt; $user_id, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after a user joins a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id  ID of the user joining the group.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_join_group', $group_id, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** General Group Functions ***************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a list of group administrators.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Info about group admins (user_id + date_modified).</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_group_admins( $group_id ) {&nbsp;</div></li><li><div>  return BP_Groups_Member::get_group_administrator_ids( $group_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a list of group moderators.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Info about group admins (user_id + date_modified).</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_group_mods( $group_id ) {&nbsp;</div></li><li><div>  return BP_Groups_Member::get_group_moderator_ids( $group_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fetch the members of a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Since BuddyPress 1.8, a procedural wrapper for BP_Group_Member_Query.</span>&nbsp;</div></li><li><div><span class="comment"> * Previously called BP_Groups_Member::get_all_for_group().</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * To use the legacy query, filter 'bp_use_legacy_group_member_query', </span>&nbsp;</div></li><li><div><span class="comment"> * returning true.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     An array of optional arguments.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int      $group_id     ID of the group whose members are being queried.</span>&nbsp;</div></li><li><div><span class="comment"> *                                  Default: current group ID.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int      $page         Page of results to be queried. Default: 1.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int      $per_page     Number of items to return per page of results.</span>&nbsp;</div></li><li><div><span class="comment"> *                                  Default: 20.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int      $max          Optional. Max number of items to return.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type array    $exclude      Optional. Array of user IDs to exclude.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool|int $value        True (or 1) to exclude admins and mods from results.</span>&nbsp;</div></li><li><div><span class="comment"> *                                  Default: 1.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool|int $value        True (or 1) to exclude banned users from results.</span>&nbsp;</div></li><li><div><span class="comment"> *                                  Default: 1.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type array    $group_role   Optional. Array of group roles to include.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $search_terms Optional. Filter results by a search string.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $type         Optional. Sort the order of results. 'last_joined', </span>&nbsp;</div></li><li><div><span class="comment"> *                                  'first_joined', or any of the $type params available</span>&nbsp;</div></li><li><div><span class="comment"> *                                  in {@link BP_User_Query}. Default: 'last_joined'.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Multi-d array of 'members' list and 'count'.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_group_members( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Backward compatibility with old method of passing arguments.</span>&nbsp;</div></li><li><div>  if ( ! is_array( $args ) || func_num_args() &gt; 1 ) {&nbsp;</div></li><li><div>      _deprecated_argument( __METHOD__, '2.0.0', sprintf( __( 'Arguments passed to %1$s should be in an associative array. See the inline documentation at %2$s for more details.', 'buddypress' ), __METHOD__, __FILE__ ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $old_args_keys = array(&nbsp;</div></li><li><div>          0 =&gt; 'group_id', &nbsp;</div></li><li><div>          1 =&gt; 'per_page', &nbsp;</div></li><li><div>          2 =&gt; 'page', &nbsp;</div></li><li><div>          3 =&gt; 'exclude_admins_mods', &nbsp;</div></li><li><div>          4 =&gt; 'exclude_banned', &nbsp;</div></li><li><div>          5 =&gt; 'exclude', &nbsp;</div></li><li><div>          6 =&gt; 'group_role', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args = bp_core_parse_args_array( $old_args_keys, func_get_args() );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = wp_parse_args( $args, array(&nbsp;</div></li><li><div>      'group_id' =&gt; bp_get_current_group_id(), &nbsp;</div></li><li><div>      'per_page' =&gt; false, &nbsp;</div></li><li><div>      'page' =&gt; false, &nbsp;</div></li><li><div>      'exclude_admins_mods' =&gt; true, &nbsp;</div></li><li><div>      'exclude_banned' =&gt; true, &nbsp;</div></li><li><div>      'exclude' =&gt; false, &nbsp;</div></li><li><div>      'group_role' =&gt; array(), &nbsp;</div></li><li><div>      'search_terms' =&gt; false, &nbsp;</div></li><li><div>      'type' =&gt; 'last_joined', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// For legacy users. Use of BP_Groups_Member::get_all_for_group() is deprecated.</span>&nbsp;</div></li><li><div>  if ( apply_filters( 'bp_use_legacy_group_member_query', false, __FUNCTION__, func_get_args() ) ) {&nbsp;</div></li><li><div>      $retval = BP_Groups_Member::get_all_for_group( $r['group_id'], $r['per_page'], $r['page'], $r['exclude_admins_mods'], $r['exclude_banned'], $r['exclude'] );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Both exclude_admins_mods and exclude_banned are legacy arguments.</span>&nbsp;</div></li><li><div>      <span class="comment">// Convert to group_role.</span>&nbsp;</div></li><li><div>      if ( empty( $r['group_role'] ) ) {&nbsp;</div></li><li><div>          $r['group_role'] = array( 'member' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $r['exclude_admins_mods'] ) {&nbsp;</div></li><li><div>              $r['group_role'][] = 'mod';&nbsp;</div></li><li><div>              $r['group_role'][] = 'admin';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $r['exclude_banned'] ) {&nbsp;</div></li><li><div>              $r['group_role'][] = 'banned';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Perform the group member query (extends BP_User_Query).</span>&nbsp;</div></li><li><div>      $members = new BP_Group_Member_Query( array(&nbsp;</div></li><li><div>          'group_id' =&gt; $r['group_id'], &nbsp;</div></li><li><div>          'per_page' =&gt; $r['per_page'], &nbsp;</div></li><li><div>          'page' =&gt; $r['page'], &nbsp;</div></li><li><div>          'group_role' =&gt; $r['group_role'], &nbsp;</div></li><li><div>          'exclude' =&gt; $r['exclude'], &nbsp;</div></li><li><div>          'search_terms' =&gt; $r['search_terms'], &nbsp;</div></li><li><div>          'type' =&gt; $r['type'], &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Structure the return value as expected by the template functions.</span>&nbsp;</div></li><li><div>      $retval = array(&nbsp;</div></li><li><div>          'members' =&gt; array_values( $members-&gt;results ), &nbsp;</div></li><li><div>          'count' =&gt; $members-&gt;total_users, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the member count for a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.3</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id Group ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int Count of confirmed members for the group.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_total_member_count( $group_id ) {&nbsp;</div></li><li><div>  return BP_Groups_Group::get_total_member_count( $group_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Fetching, Filtering & Searching  ************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a collection of groups, based on the parameters passed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0 Added `$group_type`, `$group_type__in`, and `$group_type__not_in` parameters.</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0 Added `$update_admin_cache` and `$parent_id` parameters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     Array of arguments. Supports all arguments of</span>&nbsp;</div></li><li><div><span class="comment"> *     {@link BP_Groups_Group::get()}. Where the default values differ, they</span>&nbsp;</div></li><li><div><span class="comment"> *     have been described here.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int $per_page Default: 20.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int $page Default: 1.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return array See {@link BP_Groups_Group::get()}.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_groups( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'type' =&gt; false, <span class="comment">// Active, newest, alphabetical, random, popular, most-forum-topics or most-forum-posts.</span>&nbsp;</div></li><li><div>      'order' =&gt; 'DESC', <span class="comment">// 'ASC' or 'DESC'</span>&nbsp;</div></li><li><div>      'orderby' =&gt; 'date_created', <span class="comment">// date_created, last_activity, total_member_count, name, random.</span>&nbsp;</div></li><li><div>      'user_id' =&gt; false, <span class="comment">// Pass a user_id to limit to only groups that this user is a member of.</span>&nbsp;</div></li><li><div>      'include' =&gt; false, <span class="comment">// Only include these specific groups (group_ids).</span>&nbsp;</div></li><li><div>      'exclude' =&gt; false, <span class="comment">// Do not include these specific groups (group_ids).</span>&nbsp;</div></li><li><div>      'parent_id' =&gt; null, <span class="comment">// Get groups that are children of the specified group(s).</span>&nbsp;</div></li><li><div>      'search_terms' =&gt; false, <span class="comment">// Limit to groups that match these search terms.</span>&nbsp;</div></li><li><div>      'search_columns' =&gt; array(), <span class="comment">// Select which columns to search.</span>&nbsp;</div></li><li><div>      'group_type' =&gt; '', <span class="comment"><span class="comment">// Array or comma-separated list of group types to limit results to.</span></span>&nbsp;</div></li><li><div>      'group_type__in' =&gt; '', <span class="comment"><span class="comment">// Array or comma-separated list of group types to limit results to.</span></span>&nbsp;</div></li><li><div>      'group_type__not_in' =&gt; '', <span class="comment">// Array or comma-separated list of group types that will be excluded from results.</span>&nbsp;</div></li><li><div>      'meta_query' =&gt; false, <span class="comment">// Filter by groupmeta. See WP_Meta_Query for syntax.</span>&nbsp;</div></li><li><div>      'show_hidden' =&gt; false, <span class="comment">// Show hidden groups to non-admins.</span>&nbsp;</div></li><li><div>      'per_page' =&gt; 20, <span class="comment">// The number of results to return per page.</span>&nbsp;</div></li><li><div>      'page' =&gt; 1, <span class="comment">// The page to return if limiting per page.</span>&nbsp;</div></li><li><div>      'update_meta_cache' =&gt; true, <span class="comment">// Pre-fetch groupmeta for queried groups.</span>&nbsp;</div></li><li><div>      'update_admin_cache' =&gt; false, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = bp_parse_args( $args, $defaults, 'groups_get_groups' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $groups = BP_Groups_Group::get( array(&nbsp;</div></li><li><div>      'type' =&gt; $r['type'], &nbsp;</div></li><li><div>      'user_id' =&gt; $r['user_id'], &nbsp;</div></li><li><div>      'include' =&gt; $r['include'], &nbsp;</div></li><li><div>      'exclude' =&gt; $r['exclude'], &nbsp;</div></li><li><div>      'parent_id' =&gt; $r['parent_id'], &nbsp;</div></li><li><div>      'search_terms' =&gt; $r['search_terms'], &nbsp;</div></li><li><div>      'search_columns' =&gt; $r['search_columns'], &nbsp;</div></li><li><div>      'group_type' =&gt; $r['group_type'], &nbsp;</div></li><li><div>      'group_type__in' =&gt; $r['group_type__in'], &nbsp;</div></li><li><div>      'group_type__not_in' =&gt; $r['group_type__not_in'], &nbsp;</div></li><li><div>      'meta_query' =&gt; $r['meta_query'], &nbsp;</div></li><li><div>      'show_hidden' =&gt; $r['show_hidden'], &nbsp;</div></li><li><div>      'per_page' =&gt; $r['per_page'], &nbsp;</div></li><li><div>      'page' =&gt; $r['page'], &nbsp;</div></li><li><div>      'update_meta_cache' =&gt; $r['update_meta_cache'], &nbsp;</div></li><li><div>      'update_admin_cache' =&gt; $r['update_admin_cache'], &nbsp;</div></li><li><div>      'order' =&gt; $r['order'], &nbsp;</div></li><li><div>      'orderby' =&gt; $r['orderby'], &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the collection of groups based on parsed parameters.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param BP_Groups_Group $groups Object of found groups based on parameters.</span>&nbsp;</div></li><li><div><span class="comment">   *                                Passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array           $r      Array of parsed arguments used for group query.</span>&nbsp;</div></li><li><div><span class="comment">   *                                Passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters_ref_array( 'groups_get_groups', array( &$groups, &$r ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the total group count for the site.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_total_group_count() {&nbsp;</div></li><li><div>  $count = wp_cache_get( 'bp_total_group_count', 'bp' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $count ) {&nbsp;</div></li><li><div>      $count = BP_Groups_Group::get_total_group_count();&nbsp;</div></li><li><div>      wp_cache_set( 'bp_total_group_count', $count, 'bp' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $count;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the IDs of the groups of which a specified user is a member.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $pag_num  Optional. Max number of results to return.</span>&nbsp;</div></li><li><div><span class="comment"> *                      Default: false (no limit).</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $pag_page Optional. Page offset of results to return.</span>&nbsp;</div></li><li><div><span class="comment"> *                      Default: false (no limit).</span>&nbsp;</div></li><li><div><span class="comment"> * @return array {</span>&nbsp;</div></li><li><div><span class="comment"> *     @type array $groups Array of groups returned by paginated query.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int   $total Count of groups matching query.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_user_groups( $user_id = 0, $pag_num = 0, $pag_page = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) )&nbsp;</div></li><li><div>      $user_id = bp_displayed_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return BP_Groups_Member::get_group_ids( $user_id, $pag_num, $pag_page );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a list of groups of which the specified user is a member.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Get a list of the groups to which this member belongs, </span>&nbsp;</div></li><li><div><span class="comment"> * filtered by group membership status and role.</span>&nbsp;</div></li><li><div><span class="comment"> * Usage examples: Used with no arguments specified, </span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *    bp_get_user_groups( bp_loggedin_user_id() );</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * returns an array of the groups in which the logged-in user</span>&nbsp;</div></li><li><div><span class="comment"> * is an unpromoted member. To fetch an array of all groups that</span>&nbsp;</div></li><li><div><span class="comment"> * the current user belongs to, in any membership role, </span>&nbsp;</div></li><li><div><span class="comment"> * member, moderator or administrator, use</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *    bp_get_user_groups( $user_id, array(</span>&nbsp;</div></li><li><div><span class="comment"> *        'is_admin' =&gt; null, </span>&nbsp;</div></li><li><div><span class="comment"> *        'is_mod' =&gt; null, </span>&nbsp;</div></li><li><div><span class="comment"> * ) );</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     Array of optional args.</span>&nbsp;</div></li><li><div><span class="comment"> *     @param bool|null   $is_confirmed Whether to return only confirmed memberships. Pass `null` to disable this</span>&nbsp;</div></li><li><div><span class="comment"> *                                      filter. Default: true.</span>&nbsp;</div></li><li><div><span class="comment"> *     @param bool|null   $is_banned    Whether to return only banned memberships. Pass `null` to disable this filter.</span>&nbsp;</div></li><li><div><span class="comment"> *                                      Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @param bool|null   $is_admin     Whether to return only admin memberships. Pass `null` to disable this filter.</span>&nbsp;</div></li><li><div><span class="comment"> *                                      Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @param bool|null   $is_mod       Whether to return only mod memberships. Pass `null` to disable this filter.</span>&nbsp;</div></li><li><div><span class="comment"> *                                      Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @param bool|null   $invite_sent  Whether to return only memberships with 'invite_sent'. Pass `null` to disable</span>&nbsp;</div></li><li><div><span class="comment"> *                                      this filter. Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @param string      $orderby      Field to order by. Accepts 'id' (membership ID), 'group_id', 'date_modified'.</span>&nbsp;</div></li><li><div><span class="comment"> *                                      Default: 'group_id'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @param string      $order        Sort order. Accepts 'ASC' or 'DESC'. Default: 'ASC'.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Array of matching group memberships, keyed by group ID.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_get_user_groups( $user_id, $args = array() ) {&nbsp;</div></li><li><div>  $r = bp_parse_args( $args, array(&nbsp;</div></li><li><div>      'is_confirmed' =&gt; true, &nbsp;</div></li><li><div>      'is_banned' =&gt; false, &nbsp;</div></li><li><div>      'is_admin' =&gt; false, &nbsp;</div></li><li><div>      'is_mod' =&gt; false, &nbsp;</div></li><li><div>      'invite_sent' =&gt; null, &nbsp;</div></li><li><div>      'orderby' =&gt; 'group_id', &nbsp;</div></li><li><div>      'order' =&gt; 'ASC', &nbsp;</div></li><li><div> ), 'get_user_groups' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_id = intval( $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $membership_ids = wp_cache_get( $user_id, 'bp_groups_memberships_for_user' );&nbsp;</div></li><li><div>  if ( false === $membership_ids ) {&nbsp;</div></li><li><div>      $membership_ids = BP_Groups_Member::get_membership_ids_for_user( $user_id );&nbsp;</div></li><li><div>      wp_cache_set( $user_id, $membership_ids, 'bp_groups_memberships_for_user' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Prime the membership cache.</span>&nbsp;</div></li><li><div>  $uncached_membership_ids = bp_get_non_cached_ids( $membership_ids, 'bp_groups_memberships' );&nbsp;</div></li><li><div>  if ( ! empty( $uncached_membership_ids ) ) {&nbsp;</div></li><li><div>      $uncached_memberships = BP_Groups_Member::get_memberships_by_id( $uncached_membership_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $uncached_memberships as $uncached_membership ) {&nbsp;</div></li><li><div>          wp_cache_set( $uncached_membership-&gt;id, $uncached_membership, 'bp_groups_memberships' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Assemble filter array for use in `wp_list_filter()`.</span>&nbsp;</div></li><li><div>  $filters = wp_array_slice_assoc( $r, array( 'is_confirmed', 'is_banned', 'is_admin', 'is_mod', 'invite_sent' ) );&nbsp;</div></li><li><div>  foreach ( $filters as $filter_name =&gt; $filter_value ) {&nbsp;</div></li><li><div>      if ( is_null( $filter_value ) ) {&nbsp;</div></li><li><div>          unset( $filters[ $filter_name ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Populate group membership array from cache, and normalize.</span>&nbsp;</div></li><li><div>  $groups = array();&nbsp;</div></li><li><div>  $int_keys = array( 'id', 'group_id', 'user_id', 'inviter_id' );&nbsp;</div></li><li><div>  $bool_keys = array( 'is_admin', 'is_mod', 'is_confirmed', 'is_banned', 'invite_sent' );&nbsp;</div></li><li><div>  foreach ( $membership_ids as $membership_id ) {&nbsp;</div></li><li><div>      $membership = wp_cache_get( $membership_id, 'bp_groups_memberships' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sanity check.</span>&nbsp;</div></li><li><div>      if ( ! isset( $membership-&gt;group_id ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Integer values.</span>&nbsp;</div></li><li><div>      foreach ( $int_keys as $index ) {&nbsp;</div></li><li><div>          $membership-&gt;{$index} = intval( $membership-&gt;{$index} );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Boolean values.</span>&nbsp;</div></li><li><div>      foreach ( $bool_keys as $index ) {&nbsp;</div></li><li><div>          $membership-&gt;{$index} = (bool) $membership-&gt;{$index};&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $filters as $filter_name =&gt; $filter_value ) {&nbsp;</div></li><li><div>          if ( ! isset( $membership-&gt;{$filter_name} ) || $filter_value != $membership-&gt;{$filter_name} ) {&nbsp;</div></li><li><div>              continue 2;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $group_id = (int) $membership-&gt;group_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $groups[ $group_id ] = $membership;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// By default, results are ordered by membership id.</span>&nbsp;</div></li><li><div>  if ( 'group_id' === $r['orderby'] ) {&nbsp;</div></li><li><div>      ksort( $groups );&nbsp;</div></li><li><div>  } elseif ( in_array( $r['orderby'], array( 'id', 'date_modified' ) ) ) {&nbsp;</div></li><li><div>      $groups = bp_sort_by_key( $groups, $r['orderby'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// By default, results are ordered ASC.</span>&nbsp;</div></li><li><div>  if ( 'DESC' === strtoupper( $r['order'] ) ) {&nbsp;</div></li><li><div>      <span class="comment">// `true` to preserve keys.</span>&nbsp;</div></li><li><div>      $groups = array_reverse( $groups, true );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $groups;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the count of groups of which the specified user is a member.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id Optional. Default: ID of the displayed user.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int Group count.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_total_groups_for_user( $user_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) )&nbsp;</div></li><li><div>      $user_id = ( bp_displayed_user_id() ) ? bp_displayed_user_id() : bp_loggedin_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $count = wp_cache_get( 'bp_total_groups_for_user_' . $user_id, 'bp' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $count ) {&nbsp;</div></li><li><div>      $count = BP_Groups_Member::total_group_count( $user_id );&nbsp;</div></li><li><div>      wp_cache_set( 'bp_total_groups_for_user_' . $user_id, $count, 'bp' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return (int) $count;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the BP_Groups_Group object corresponding to the current group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return BP_Groups_Group The current group object.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_current_group() {&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_group = isset( $bp-&gt;groups-&gt;current_group )&nbsp;</div></li><li><div>      ? $bp-&gt;groups-&gt;current_group&nbsp;</div></li><li><div>      : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the BP_Groups_Group object corresponding to the current group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param BP_Groups_Group $current_group Current BP_Groups_Group object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'groups_get_current_group', $current_group );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Avatars *************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Generate the avatar upload directory path for a given group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id Optional. ID of the group. Default: ID of the current group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_avatar_upload_dir( $group_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $group_id ) ) {&nbsp;</div></li><li><div>      $group_id = bp_get_current_group_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $directory = 'group-avatars';&nbsp;</div></li><li><div>  $path = bp_core_avatar_upload_path() . '/' . $directory . '/' . $group_id;&nbsp;</div></li><li><div>  $newbdir = $path;&nbsp;</div></li><li><div>  $newurl = bp_core_avatar_url() . '/' . $directory . '/' . $group_id;&nbsp;</div></li><li><div>  $newburl = $newurl;&nbsp;</div></li><li><div>  $newsubdir = '/' . $directory . '/' . $group_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the avatar upload directory path for a given group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $value Array of parts related to the groups avatar upload directory.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'groups_avatar_upload_dir', array(&nbsp;</div></li><li><div>      'path' =&gt; $path, &nbsp;</div></li><li><div>      'url' =&gt; $newurl, &nbsp;</div></li><li><div>      'subdir' =&gt; $newsubdir, &nbsp;</div></li><li><div>      'basedir' =&gt; $newbdir, &nbsp;</div></li><li><div>      'baseurl' =&gt; $newburl, &nbsp;</div></li><li><div>      'error' =&gt; false&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Member Status Checks ************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a user is an admin of a given group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool ID of the membership if the user is admin, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_is_user_admin( $user_id, $group_id ) {&nbsp;</div></li><li><div>  $is_admin = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_groups = bp_get_user_groups( $user_id, array(&nbsp;</div></li><li><div>      'is_admin' =&gt; true, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $user_groups[ $group_id ] ) ) {&nbsp;</div></li><li><div>      $is_admin = $user_groups[ $group_id ]-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $is_admin;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a user is a mod of a given group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool ID of the membership if the user is mod, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_is_user_mod( $user_id, $group_id ) {&nbsp;</div></li><li><div>  $is_mod = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_groups = bp_get_user_groups( $user_id, array(&nbsp;</div></li><li><div>      'is_mod' =&gt; true, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $user_groups[ $group_id ] ) ) {&nbsp;</div></li><li><div>      $is_mod = $user_groups[ $group_id ]-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $is_mod;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a user is a member of a given group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool ID of the membership if the user is member, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_is_user_member( $user_id, $group_id ) {&nbsp;</div></li><li><div>  $is_member = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_groups = bp_get_user_groups( $user_id, array(&nbsp;</div></li><li><div>      'is_admin' =&gt; null, &nbsp;</div></li><li><div>      'is_mod' =&gt; null, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $user_groups[ $group_id ] ) ) {&nbsp;</div></li><li><div>      $is_member = $user_groups[ $group_id ]-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $is_member;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a user is banned from a given group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool ID of the membership if the user is banned, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_is_user_banned( $user_id, $group_id ) {&nbsp;</div></li><li><div>  $is_banned = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_groups = bp_get_user_groups( $user_id, array(&nbsp;</div></li><li><div>      'is_confirmed' =&gt; null, &nbsp;</div></li><li><div>      'is_banned' =&gt; true, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $user_groups[ $group_id ] ) ) {&nbsp;</div></li><li><div>      $is_banned = $user_groups[ $group_id ]-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $is_banned;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a user has an outstanding invitation to a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool ID of the membership if the user is invited, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_is_user_invited( $user_id, $group_id ) {&nbsp;</div></li><li><div>  $is_invited = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_groups = bp_get_user_groups( $user_id, array(&nbsp;</div></li><li><div>      'invite_sent' =&gt; true, &nbsp;</div></li><li><div>      'is_confirmed' =&gt; false, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $user_groups[ $group_id ] ) ) {&nbsp;</div></li><li><div>      $is_invited = $user_groups[ $group_id ]-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $is_invited;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a user has a pending membership request for a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool ID of the membership if the user is pending, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_is_user_pending( $user_id, $group_id ) {&nbsp;</div></li><li><div>  $is_pending = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_groups = bp_get_user_groups( $user_id, array(&nbsp;</div></li><li><div>      'invite_sent' =&gt; false, &nbsp;</div></li><li><div>      'is_confirmed' =&gt; false, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $user_groups[ $group_id ] ) ) {&nbsp;</div></li><li><div>      $is_pending = $user_groups[ $group_id ]-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $is_pending;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is the specified user the creator of the group?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.6</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_is_user_creator( $user_id, $group_id ) {&nbsp;</div></li><li><div>  return BP_Groups_Member::check_is_creator( $user_id, $group_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Activity Posting ****************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Post an Activity status update affiliated with a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0 Added 'error_type' parameter to $args.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     Array of arguments.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $content  The content of the update.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $user_id  Optional. ID of the user posting the update. Default:</span>&nbsp;</div></li><li><div><span class="comment"> *                            ID of the logged-in user.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $group_id Optional. ID of the group to be affiliated with the</span>&nbsp;</div></li><li><div><span class="comment"> *                            update. Default: ID of the current group.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool Returns the ID of the new activity item on success, or false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_post_update( $args = '' ) {&nbsp;</div></li><li><div>  if ( ! bp_is_active( 'activity' ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'content' =&gt; false, &nbsp;</div></li><li><div>      'user_id' =&gt; bp_loggedin_user_id(), &nbsp;</div></li><li><div>      'group_id' =&gt; 0, &nbsp;</div></li><li><div>      'error_type' =&gt; 'bool'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $r, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $group_id ) && !empty( $bp-&gt;groups-&gt;current_group-&gt;id ) )&nbsp;</div></li><li><div>      $group_id = $bp-&gt;groups-&gt;current_group-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $content ) || !strlen( trim( $content ) ) || empty( $user_id ) || empty( $group_id ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp-&gt;groups-&gt;current_group = groups_get_group( $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Be sure the user is a member of the group before posting.</span>&nbsp;</div></li><li><div>  if ( !bp_current_user_can( 'bp_moderate' ) && !groups_is_user_member( $user_id, $group_id ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Record this in activity streams.</span></span>&nbsp;</div></li><li><div>  $activity_action = sprintf( __( '%1$s posted an update in the group %2$s', 'buddypress'), bp_core_get_userlink( $user_id ), '&lt;a href=&quot;' . bp_get_group_permalink( $bp-&gt;groups-&gt;current_group ) . '&quot;&gt;' . esc_attr( $bp-&gt;groups-&gt;current_group-&gt;name ) . '&lt;/a&gt;' );&nbsp;</div></li><li><div>  $activity_content = $content;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the action for the new group activity update.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $activity_action The new group activity update.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $action = apply_filters( 'groups_activity_new_update_action', $activity_action );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the content for the new group activity update.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $activity_content The content of the update.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $content_filtered = apply_filters( 'groups_activity_new_update_content', $activity_content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $activity_id = groups_record_activity( array(&nbsp;</div></li><li><div>      'user_id' =&gt; $user_id, &nbsp;</div></li><li><div>      'action' =&gt; $action, &nbsp;</div></li><li><div>      'content' =&gt; $content_filtered, &nbsp;</div></li><li><div>      'type' =&gt; 'activity_update', &nbsp;</div></li><li><div>      'item_id' =&gt; $group_id, &nbsp;</div></li><li><div>      'error_type' =&gt; $error_type&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  groups_update_groupmeta( $group_id, 'last_activity', bp_core_current_time() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after posting of an Activity status update affiliated with a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content     The content of the update.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $user_id     ID of the user posting the update.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $group_id    ID of the group being posted to.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool   $activity_id Whether or not the activity recording succeeded.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bp_groups_posted_update', $content, $user_id, $group_id, $activity_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $activity_id;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Invitations *********************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get IDs of users with outstanding invites to a given group from a specified user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int               $user_id ID of the inviting user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|bool          $limit   Limit to restrict to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|bool          $page    Optional. Page offset of results to return.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array|bool $exclude Array of comma-separated list of group IDs</span>&nbsp;</div></li><li><div><span class="comment"> *                                   to exclude from results.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $value IDs of users who have been invited to the group by the</span>&nbsp;</div></li><li><div><span class="comment"> *                      user but have not yet accepted.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_invites_for_user( $user_id = 0, $limit = false, $page = false, $exclude = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) )&nbsp;</div></li><li><div>      $user_id = bp_loggedin_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return BP_Groups_Member::get_invites( $user_id, $limit, $page, $exclude );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the total group invite count for a user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id The user ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_invite_count_for_user( $user_id = 0 ) {&nbsp;</div></li><li><div>  if ( empty( $user_id ) ) {&nbsp;</div></li><li><div>      $user_id = bp_loggedin_user_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return BP_Groups_Member::get_invite_count_for_user( $user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Invite a user to a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     Array of arguments.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $user_id       ID of the user being invited.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $group_id      ID of the group to which the user is being invited.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $inviter_id    Optional. ID of the inviting user. Default:</span>&nbsp;</div></li><li><div><span class="comment"> *                                 ID of the logged-in user.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $date_modified Optional. Modified date for the invitation.</span>&nbsp;</div></li><li><div><span class="comment"> *                                 Default: current date/time.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool   $is_confirmed  Optional. Whether the invitation should be</span>&nbsp;</div></li><li><div><span class="comment"> *                                 marked confirmed. Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_invite_user( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $defaults = array(&nbsp;</div></li><li><div>      'user_id' =&gt; false, &nbsp;</div></li><li><div>      'group_id' =&gt; false, &nbsp;</div></li><li><div>      'inviter_id' =&gt; bp_loggedin_user_id(), &nbsp;</div></li><li><div>      'date_modified' =&gt; bp_core_current_time(), &nbsp;</div></li><li><div>      'is_confirmed' =&gt; 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>  extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $user_id || ! $group_id || ! $inviter_id ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the user has already requested membership, accept the request.</span>&nbsp;</div></li><li><div>  if ( $membership_id = groups_check_for_membership_request( $user_id, $group_id ) ) {&nbsp;</div></li><li><div>      groups_accept_membership_request( $membership_id, $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Otherwise, create a new invitation.</span>&nbsp;</div></li><li><div>  } elseif ( ! groups_is_user_member( $user_id, $group_id ) && ! groups_check_user_has_invite( $user_id, $group_id, 'all' ) ) {&nbsp;</div></li><li><div>      $invite = new BP_Groups_Member;&nbsp;</div></li><li><div>      $invite-&gt;group_id = $group_id;&nbsp;</div></li><li><div>      $invite-&gt;user_id = $user_id;&nbsp;</div></li><li><div>      $invite-&gt;date_modified = $date_modified;&nbsp;</div></li><li><div>      $invite-&gt;inviter_id = $inviter_id;&nbsp;</div></li><li><div>      $invite-&gt;is_confirmed = $is_confirmed;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !$invite-&gt;save() )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the creation of a new group invite.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $args Array of parsed arguments for the group invite.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_invite_user', $args );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Uninvite a user from a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Functionally, this is equivalent to removing a user from a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_uninvite_user( $user_id, $group_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! BP_Groups_Member::delete_invite( $user_id, $group_id ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after uninviting a user from a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group being uninvited from.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id  ID of the user being uninvited.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_uninvite_user', $group_id, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Process the acceptance of a group invitation.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Returns true if a user is already a member of the group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True when the user is a member of the group, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_accept_invite( $user_id, $group_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the user is already a member (because BP at one point allowed two invitations to</span>&nbsp;</div></li><li><div>  <span class="comment">// slip through), delete all existing invitations/requests and return true.</span>&nbsp;</div></li><li><div>  if ( groups_is_user_member( $user_id, $group_id ) ) {&nbsp;</div></li><li><div>      if ( groups_check_user_has_invite( $user_id, $group_id ) ) {&nbsp;</div></li><li><div>          groups_delete_invite( $user_id, $group_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( groups_check_for_membership_request( $user_id, $group_id ) ) {&nbsp;</div></li><li><div>          groups_delete_membership_request( null, $user_id, $group_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member = new BP_Groups_Member( $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Save the inviter ID so that we can pass it to the action below.</span>&nbsp;</div></li><li><div>  $inviter_id = $member-&gt;inviter_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member-&gt;accept_invite();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$member-&gt;save() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Remove request to join.</span>&nbsp;</div></li><li><div>  if ( $member-&gt;check_for_membership_request( $user_id, $group_id ) ) {&nbsp;</div></li><li><div>      $member-&gt;delete_request( $user_id, $group_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Modify group meta.</span>&nbsp;</div></li><li><div>  groups_update_groupmeta( $group_id, 'last_activity', bp_core_current_time() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after a user has accepted a group invite.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.8.0 The $inviter_id arg was added.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id    ID of the user who accepted the group invite.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id   ID of the group being accepted to.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $inviter_id ID of the user who invited this user to the group.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_accept_invite', $user_id, $group_id, $inviter_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Reject a group invitation.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_reject_invite( $user_id, $group_id ) {&nbsp;</div></li><li><div>  if ( ! BP_Groups_Member::delete_invite( $user_id, $group_id ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after a user rejects a group invitation.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id  ID of the user rejecting the invite.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group being rejected.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_reject_invite', $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a group invitation.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the invited user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_delete_invite( $user_id, $group_id ) {&nbsp;</div></li><li><div>  if ( ! BP_Groups_Member::delete_invite( $user_id, $group_id ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the deletion of a group invitation.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id  ID of the user whose invitation is being deleted.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group whose invitation is being deleted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_delete_invite', $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Send all pending invites by a single user to a specific group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the inviting user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_send_invites( $user_id, $group_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) )&nbsp;</div></li><li><div>      $user_id = bp_loggedin_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Send friend invites.</span>&nbsp;</div></li><li><div>  $invited_users = groups_get_invites_for_group( $user_id, $group_id );&nbsp;</div></li><li><div>  $group = groups_get_group( $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  for ( $i = 0, $count = count( $invited_users ); $i &lt; $count; ++$i ) {&nbsp;</div></li><li><div>      $member = new BP_Groups_Member( $invited_users[$i], $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Send the actual invite.</span>&nbsp;</div></li><li><div>      groups_notification_group_invites( $group, $member, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $member-&gt;invite_sent = 1;&nbsp;</div></li><li><div>      $member-&gt;save();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the sending of invites for a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0 Added $user_id to passed parameters.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $group_id      ID of the group who's being invited to.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $invited_users Array of users being invited to the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $user_id       ID of the inviting user.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_send_invites', $group_id, $invited_users, $user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get IDs of users with outstanding invites to a given group from a specified user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the inviting user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $value IDs of users who have been invited to the group by the</span>&nbsp;</div></li><li><div><span class="comment"> *                      user but have not yet accepted.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_invites_for_group( $user_id, $group_id ) {&nbsp;</div></li><li><div>  return BP_Groups_Group::get_invites( $user_id, $group_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check to see whether a user has already been invited to a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * By default, the function checks for invitations that have been sent.</span>&nbsp;</div></li><li><div><span class="comment"> * Entering 'all' as the $type parameter will return unsent invitations as</span>&nbsp;</div></li><li><div><span class="comment"> * well (useful to make sure AJAX requests are not duplicated).</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id  ID of potential group member.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $group_id ID of potential group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $type     Optional. Use 'sent' to check for sent invites, </span>&nbsp;</div></li><li><div><span class="comment"> *                         'all' to check for all. Default: 'sent'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool ID of the membership if found, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_check_user_has_invite( $user_id, $group_id, $type = 'sent' ) {&nbsp;</div></li><li><div>  $invite = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $args = array(&nbsp;</div></li><li><div>      'is_confirmed' =&gt; false, &nbsp;</div></li><li><div>      'is_banned' =&gt; null, &nbsp;</div></li><li><div>      'is_admin' =&gt; null, &nbsp;</div></li><li><div>      'is_mod' =&gt; null, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'sent' === $type ) {&nbsp;</div></li><li><div>      $args['invite_sent'] = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_groups = bp_get_user_groups( $user_id, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $user_groups[ $group_id ] ) && 0 !== $user_groups[ $group_id ]-&gt;inviter_id ) {&nbsp;</div></li><li><div>      $invite = $user_groups[ $group_id ]-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $invite;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete all invitations to a given group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group whose invitations are being deleted.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|null Number of rows records deleted on success, null on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_delete_all_group_invites( $group_id ) {&nbsp;</div></li><li><div>  return BP_Groups_Group::delete_all_invites( $group_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Promotion & Banning *************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Promote a member to a new status within a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $status   The new status. 'mod' or 'admin'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_promote_member( $user_id, $group_id, $status ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member = new BP_Groups_Member( $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Don't use this action. It's deprecated as of BuddyPress 1.6.</span>&nbsp;</div></li><li><div>  do_action( 'groups_premote_member', $group_id, $user_id, $status );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the promotion of a user to a new status.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $group_id ID of the group being promoted in.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $user_id  ID of the user being promoted.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $status   New status being promoted to.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_promote_member', $group_id, $user_id, $status );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $member-&gt;promote( $status );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Demote a user to 'member' status within a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_demote_member( $user_id, $group_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member = new BP_Groups_Member( $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the demotion of a user to 'member'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group being demoted in.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id  ID of the user being demoted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_demote_member', $group_id, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $member-&gt;demote();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Ban a member from a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_ban_member( $user_id, $group_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member = new BP_Groups_Member( $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the banning of a member from a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group being banned from.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id  ID of the user being banned.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_ban_member', $group_id, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $member-&gt;ban();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Unban a member from a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_unban_member( $user_id, $group_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member = new BP_Groups_Member( $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the unbanning of a member from a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group being unbanned from.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id  ID of the user being unbanned.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_unban_member', $group_id, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $member-&gt;unban();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Removal *************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove a member from a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.6</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_remove_member( $user_id, $group_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $member = new BP_Groups_Member( $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the removal of a member from a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.2.6</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group being removed from.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id  ID of the user being removed.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_remove_member', $group_id, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $member-&gt;remove();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Membership **********************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Create a group membership request.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $requesting_user_id ID of the user requesting membership.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id           ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_send_membership_request( $requesting_user_id, $group_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Prevent duplicate requests.</span>&nbsp;</div></li><li><div>  if ( groups_check_for_membership_request( $requesting_user_id, $group_id ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check if the user is already a member or is banned.</span>&nbsp;</div></li><li><div>  if ( groups_is_user_member( $requesting_user_id, $group_id ) || groups_is_user_banned( $requesting_user_id, $group_id ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check if the user is already invited - if so, simply accept invite.</span>&nbsp;</div></li><li><div>  if ( groups_check_user_has_invite( $requesting_user_id, $group_id ) ) {&nbsp;</div></li><li><div>      groups_accept_invite( $requesting_user_id, $group_id );&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $requesting_user = new BP_Groups_Member;&nbsp;</div></li><li><div>  $requesting_user-&gt;group_id = $group_id;&nbsp;</div></li><li><div>  $requesting_user-&gt;user_id = $requesting_user_id;&nbsp;</div></li><li><div>  $requesting_user-&gt;inviter_id = 0;&nbsp;</div></li><li><div>  $requesting_user-&gt;is_admin = 0;&nbsp;</div></li><li><div>  $requesting_user-&gt;user_title = '';&nbsp;</div></li><li><div>  $requesting_user-&gt;date_modified = bp_core_current_time();&nbsp;</div></li><li><div>  $requesting_user-&gt;is_confirmed = 0;&nbsp;</div></li><li><div>  $requesting_user-&gt;comments = isset( $_POST['group-request-membership-comments'] ) ? $_POST['group-request-membership-comments'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $requesting_user-&gt;save() ) {&nbsp;</div></li><li><div>      $admins = groups_get_group_admins( $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Saved okay, now send the email notification.</span>&nbsp;</div></li><li><div>      for ( $i = 0, $count = count( $admins ); $i &lt; $count; ++$i )&nbsp;</div></li><li><div>          groups_notification_new_membership_request( $requesting_user_id, $admins[$i]-&gt;user_id, $group_id, $requesting_user-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the creation of a new membership request.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int   $requesting_user_id  ID of the user requesting membership.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $admins              Array of group admins.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int   $group_id            ID of the group being requested to.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int   $requesting_user-&gt;id ID of the user requesting membership.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_membership_requested', $requesting_user_id, $admins, $group_id, $requesting_user-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Accept a pending group membership request.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $membership_id ID of the membership object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id       Optional. ID of the user who requested membership.</span>&nbsp;</div></li><li><div><span class="comment"> *                           Provide this value along with $group_id to override</span>&nbsp;</div></li><li><div><span class="comment"> *                           $membership_id.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id      Optional. ID of the group to which membership is being</span>&nbsp;</div></li><li><div><span class="comment"> *                           requested. Provide this value along with $user_id to</span>&nbsp;</div></li><li><div><span class="comment"> *                           override $membership_id.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_accept_membership_request( $membership_id, $user_id = 0, $group_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !empty( $user_id ) && !empty( $group_id ) ) {&nbsp;</div></li><li><div>      $membership = new BP_Groups_Member( $user_id, $group_id );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $membership = new BP_Groups_Member( false, false, $membership_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $membership-&gt;accept_request();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$membership-&gt;save() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check if the user has an outstanding invite, if so delete it.</span>&nbsp;</div></li><li><div>  if ( groups_check_user_has_invite( $membership-&gt;user_id, $membership-&gt;group_id ) ) {&nbsp;</div></li><li><div>      groups_delete_invite( $membership-&gt;user_id, $membership-&gt;group_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after a group membership request has been accepted.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int  $user_id  ID of the user who accepted membership.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int  $group_id ID of the group that was accepted membership to.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $value    If membership was accepted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_membership_accepted', $membership-&gt;user_id, $membership-&gt;group_id, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Reject a pending group membership request.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $membership_id ID of the membership object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id       Optional. ID of the user who requested membership.</span>&nbsp;</div></li><li><div><span class="comment"> *                           Provide this value along with $group_id to override</span>&nbsp;</div></li><li><div><span class="comment"> *                           $membership_id.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id      Optional. ID of the group to which membership is being</span>&nbsp;</div></li><li><div><span class="comment"> *                           requested. Provide this value along with $user_id to</span>&nbsp;</div></li><li><div><span class="comment"> *                           override $membership_id.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_reject_membership_request( $membership_id, $user_id = 0, $group_id = 0 ) {&nbsp;</div></li><li><div>  if ( !$membership = groups_delete_membership_request( $membership_id, $user_id, $group_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after a group membership request has been rejected.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int  $user_id  ID of the user who rejected membership.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int  $group_id ID of the group that was rejected membership to.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $value    If membership was accepted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_membership_rejected', $membership-&gt;user_id, $membership-&gt;group_id, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a pending group membership request.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $membership_id ID of the membership object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id       Optional. ID of the user who requested membership.</span>&nbsp;</div></li><li><div><span class="comment"> *                           Provide this value along with $group_id to override</span>&nbsp;</div></li><li><div><span class="comment"> *                           $membership_id.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id      Optional. ID of the group to which membership is being</span>&nbsp;</div></li><li><div><span class="comment"> *                           requested. Provide this value along with $user_id to</span>&nbsp;</div></li><li><div><span class="comment"> *                           override $membership_id.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_delete_membership_request( $membership_id, $user_id = 0, $group_id = 0 ) {&nbsp;</div></li><li><div>  if ( !empty( $user_id ) && !empty( $group_id ) )&nbsp;</div></li><li><div>      $membership = new BP_Groups_Member( $user_id, $group_id );&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      $membership = new BP_Groups_Member( false, false, $membership_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! BP_Groups_Member::delete_request( $membership-&gt;user_id, $membership-&gt;group_id ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $membership;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether a user has an outstanding membership request for a given group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id  ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool ID of the membership if found, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_check_for_membership_request( $user_id, $group_id ) {&nbsp;</div></li><li><div>  $request = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_groups = bp_get_user_groups( $user_id, array(&nbsp;</div></li><li><div>      'is_confirmed' =&gt; false, &nbsp;</div></li><li><div>      'is_banned' =&gt; false, &nbsp;</div></li><li><div>      'is_admin' =&gt; null, &nbsp;</div></li><li><div>      'is_mod' =&gt; null&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $user_groups[ $group_id ] ) && 0 === $user_groups[ $group_id ]-&gt;inviter_id ) {&nbsp;</div></li><li><div>      $request = $user_groups[ $group_id ]-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $request;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Accept all pending membership requests to a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.2</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_accept_all_pending_membership_requests( $group_id ) {&nbsp;</div></li><li><div>  $user_ids = BP_Groups_Member::get_all_membership_request_user_ids( $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$user_ids )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( (array) $user_ids as $user_id )&nbsp;</div></li><li><div>      groups_accept_membership_request( false, $user_id, $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the acceptance of all pending membership requests to a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group whose pending memberships were accepted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_accept_all_pending_membership_requests', $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Meta ****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete metadata for a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int         $group_id   ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|bool $meta_key   The key of the row to delete.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|bool $meta_value Optional. Metadata value. If specified, only delete</span>&nbsp;</div></li><li><div><span class="comment"> *                                metadata entries with this value.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool        $delete_all Optional. If true, delete matching metadata entries</span>&nbsp;</div></li><li><div><span class="comment"> *                                for all groups. Otherwise, only delete matching</span>&nbsp;</div></li><li><div><span class="comment"> *                                metadata entries for the specified group.</span>&nbsp;</div></li><li><div><span class="comment"> *                                Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_delete_groupmeta( $group_id, $meta_key = false, $meta_value = false, $delete_all = false ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Legacy - if no meta_key is passed, delete all for the item.</span>&nbsp;</div></li><li><div>  if ( empty( $meta_key ) ) {&nbsp;</div></li><li><div>      $keys = $wpdb-&gt;get_col( $wpdb-&gt;prepare( &quot;SELECT meta_key FROM {$wpdb-&gt;groupmeta} WHERE group_id = %d&quot;, $group_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// With no meta_key, ignore $delete_all.</span>&nbsp;</div></li><li><div>      $delete_all = false;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $keys = array( $meta_key );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $retval = true;&nbsp;</div></li><li><div>  foreach ( $keys as $key ) {&nbsp;</div></li><li><div>      $retval = delete_metadata( 'group', $group_id, $key, $meta_value, $delete_all );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a piece of group metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_key Metadata key.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $single   Optional. If true, return only the first value of the</span>&nbsp;</div></li><li><div><span class="comment"> *                         specified meta_key. This parameter has no effect if</span>&nbsp;</div></li><li><div><span class="comment"> *                         meta_key is empty.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Metadata value.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_get_groupmeta( $group_id, $meta_key = '', $single = true ) {&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>  $retval = get_metadata( 'group', $group_id, $meta_key, $single );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update a piece of group metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $group_id   ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_key   Metadata key.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $meta_value Value to store.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $prev_value Optional. If specified, only update existing</span>&nbsp;</div></li><li><div><span class="comment"> *                           metadata entries with the specified value.</span>&nbsp;</div></li><li><div><span class="comment"> *                           Otherwise, update all entries.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|int $retval Returns false on failure. On successful update of existing</span>&nbsp;</div></li><li><div><span class="comment"> *                          metadata, returns true. On successful creation of new metadata, </span>&nbsp;</div></li><li><div><span class="comment"> *                          returns the integer ID of the new metadata row.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_update_groupmeta( $group_id, $meta_key, $meta_value, $prev_value = '' ) {&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>  $retval = update_metadata( 'group', $group_id, $meta_key, $meta_value, $prev_value );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add a piece of group metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $group_id   ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_key   Metadata key.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $meta_value Metadata value.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $unique     Optional. Whether to enforce a single metadata value</span>&nbsp;</div></li><li><div><span class="comment"> *                           for the given key. If true, and the object already</span>&nbsp;</div></li><li><div><span class="comment"> *                           has a value for the key, no change will be made.</span>&nbsp;</div></li><li><div><span class="comment"> *                           Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool The meta ID on successful update, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_add_groupmeta( $group_id, $meta_key, $meta_value, $unique = false ) {&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>  $retval = add_metadata( 'group', $group_id, $meta_key, $meta_value, $unique );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Cleanup Functions ***************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete all group membership information for the specified user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_remove_data_for_user( $user_id ) {&nbsp;</div></li><li><div>  BP_Groups_Member::delete_all_for_user( $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the deletion of all data for a user.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id ID of the user whose data is being deleted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_remove_data_for_user', $user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'wpmu_delete_user', 'groups_remove_data_for_user' );&nbsp;</div></li><li><div>add_action( 'delete_user', 'groups_remove_data_for_user' );&nbsp;</div></li><li><div>add_action( 'bp_make_spam_user', 'groups_remove_data_for_user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Group Types ***************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register a group type.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0 Introduce $has_directory, $show_in_create_screen, $show_in_list, and</span>&nbsp;</div></li><li><div><span class="comment"> *              $description, $create_screen_checked as $args parameters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $group_type Unique string identifier for the group type.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     Array of arguments describing the group type.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string|bool $has_directory         Set the slug to be used for custom group directory page. eg.</span>&nbsp;</div></li><li><div><span class="comment"> *                                              example.com/groups/type/MY_SLUG. Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool        $show_in_create_screen Whether this group type is allowed to be selected on the group creation</span>&nbsp;</div></li><li><div><span class="comment"> *                                              page. Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool|null   $show_in_list          Whether this group type should be shown in lists rendered by</span>&nbsp;</div></li><li><div><span class="comment"> *                                              bp_group_type_list(). Default: null. If $show_in_create_screen is true, </span>&nbsp;</div></li><li><div><span class="comment"> *                                              this will default to true, unless this is set explicitly to false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string      $description           A short descriptive summary of what the group type is. Currently shown</span>&nbsp;</div></li><li><div><span class="comment"> *                                              on a group's &quot;Manage &gt; Settings&quot; page when selecting group types.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool        $create_screen_checked If $show_in_create_screen is true, whether we should have our group type</span>&nbsp;</div></li><li><div><span class="comment"> *                                              checkbox checked by default. Handy if you want to imply that the group</span>&nbsp;</div></li><li><div><span class="comment"> *                                              type should be enforced, but decision lies with the group creator.</span>&nbsp;</div></li><li><div><span class="comment"> *                                              Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type array       $labels {</span>&nbsp;</div></li><li><div><span class="comment"> *         Array of labels to use in various parts of the interface.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *         @type string $name          Default name. Should typically be plural.</span>&nbsp;</div></li><li><div><span class="comment"> *         @type string $singular_name Singular name.</span>&nbsp;</div></li><li><div><span class="comment"> *     }</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return object|WP_Error Group type object on success, WP_Error object on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_groups_register_group_type( $group_type, $args = array() ) {&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $bp-&gt;groups-&gt;types[ $group_type ] ) ) {&nbsp;</div></li><li><div>      return new WP_Error( 'bp_group_type_exists', __( 'Group type already exists.', 'buddypress' ), $group_type );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = bp_parse_args( $args, array(&nbsp;</div></li><li><div>      'has_directory' =&gt; false, &nbsp;</div></li><li><div>      'show_in_create_screen' =&gt; false, &nbsp;</div></li><li><div>      'show_in_list' =&gt; null, &nbsp;</div></li><li><div>      'description' =&gt; '', &nbsp;</div></li><li><div>      'create_screen_checked' =&gt; false, &nbsp;</div></li><li><div>      'labels' =&gt; array(), &nbsp;</div></li><li><div> ), 'register_group_type' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $group_type = sanitize_key( $group_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of illegal group type names.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * - 'any' is a special pseudo-type, representing items unassociated with any group type.</span>&nbsp;</div></li><li><div><span class="comment">   * - 'null' is a special pseudo-type, representing users without any type.</span>&nbsp;</div></li><li><div><span class="comment">   * - '_none' is used internally to denote an item that should not apply to any group types.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $illegal_names Array of illegal names.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $illegal_names = apply_filters( 'bp_group_type_illegal_names', array( 'any', 'null', '_none' ) );&nbsp;</div></li><li><div>  if ( in_array( $group_type, $illegal_names, true ) ) {&nbsp;</div></li><li><div>      return new WP_Error( 'bp_group_type_illegal_name', __( 'You may not register a group type with this name.', 'buddypress' ), $group_type );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Store the group type name as data in the object (not just as the array key).</span>&nbsp;</div></li><li><div>  $r['name'] = $group_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Make sure the relevant labels have been filled in.</span>&nbsp;</div></li><li><div>  $default_name = isset( $r['labels']['name'] ) ? $r['labels']['name'] : ucfirst( $r['name'] );&nbsp;</div></li><li><div>  $r['labels'] = array_merge( array(&nbsp;</div></li><li><div>      'name' =&gt; $default_name, &nbsp;</div></li><li><div>      'singular_name' =&gt; $default_name, &nbsp;</div></li><li><div> ), $r['labels'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Directory slug.</span>&nbsp;</div></li><li><div>  if ( ! empty( $r['has_directory'] ) ) {&nbsp;</div></li><li><div>      <span class="comment">// A string value is intepreted as the directory slug.</span>&nbsp;</div></li><li><div>      if ( is_string( $r['has_directory'] ) ) {&nbsp;</div></li><li><div>          $directory_slug = $r['has_directory'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Otherwise fall back on group type.</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $directory_slug = $group_type;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sanitize for use in URLs.</span>&nbsp;</div></li><li><div>      $r['directory_slug'] = sanitize_title( $directory_slug );&nbsp;</div></li><li><div>      $r['has_directory'] = true;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $r['directory_slug'] = '';&nbsp;</div></li><li><div>      $r['has_directory'] = false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Type lists.</span>&nbsp;</div></li><li><div>  if ( true === $r['show_in_create_screen'] && is_null( $r['show_in_list'] ) ) {&nbsp;</div></li><li><div>      $r['show_in_list'] = true;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $r['show_in_list'] = (bool) $r['show_in_list'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp-&gt;groups-&gt;types[ $group_type ] = $type = (object) $r;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after a group type is registered.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $group_type Group type identifier.</span>&nbsp;</div></li><li><div><span class="comment">   * @param object $type       Group type object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bp_groups_register_group_type', $group_type, $type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $type;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a list of all registered group type objects.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see bp_groups_register_group_type() for accepted arguments.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $args     Optional. An array of key =&gt; value arguments to match against</span>&nbsp;</div></li><li><div><span class="comment"> *                               the group type objects. Default empty array.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $output   Optional. The type of output to return. Accepts 'names'</span>&nbsp;</div></li><li><div><span class="comment"> *                               or 'objects'. Default 'names'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string       $operator Optional. The logical operation to perform. 'or' means only one</span>&nbsp;</div></li><li><div><span class="comment"> *                               element from the array needs to match; 'and' means all elements</span>&nbsp;</div></li><li><div><span class="comment"> *                               must match. Accepts 'or' or 'and'. Default 'and'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array       $types    A list of groups type names or objects.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_groups_get_group_types( $args = array(), $output = 'names', $operator = 'and' ) {&nbsp;</div></li><li><div>  $types = buddypress()-&gt;groups-&gt;types;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $types = wp_filter_object_list( $types, $args, $operator );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the array of group type objects.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This filter is run before the $output filter has been applied, so that</span>&nbsp;</div></li><li><div><span class="comment">   * filtering functions have access to the entire group type objects.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $types     group type objects, keyed by name.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $args      Array of key=&gt;value arguments for filtering.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $operator  'or' to match any of $args, 'and' to require all.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $types = apply_filters( 'bp_groups_get_group_types', $types, $args, $operator );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'names' === $output ) {&nbsp;</div></li><li><div>      $types = wp_list_pluck( $types, 'name' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $types;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve a group type object by name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $group_type The name of the group type.</span>&nbsp;</div></li><li><div><span class="comment"> * @return object A group type object.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_groups_get_group_type_object( $group_type ) {&nbsp;</div></li><li><div>  $types = bp_groups_get_group_types( array(), 'objects' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $types[ $group_type ] ) ) {&nbsp;</div></li><li><div>      return null;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $types[ $group_type ];&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Set type for a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0 $group_type parameter also accepts an array of group types now.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int          $group      ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $group_type Group type or array of group types to set.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $append     Optional. True to append this to existing types for group, </span>&nbsp;</div></li><li><div><span class="comment"> *                                 false to replace. Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $retval See bp_set_object_terms().</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_groups_set_group_type( $group_id, $group_type, $append = false ) {&nbsp;</div></li><li><div>  <span class="comment">// Pass an empty group type to remove group's type.</span>&nbsp;</div></li><li><div>  if ( ! empty( $group_type ) && is_string( $group_type ) && ! bp_groups_get_group_type_object( $group_type ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Cast as array.</span>&nbsp;</div></li><li><div>  $group_type = (array) $group_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Validate group types.</span>&nbsp;</div></li><li><div>  foreach ( $group_type as $type ) {&nbsp;</div></li><li><div>      <span class="comment">// Remove any invalid group types.</span>&nbsp;</div></li><li><div>      if ( is_null( bp_groups_get_group_type_object( $type ) ) ) {&nbsp;</div></li><li><div>          unset( $group_type[ $type ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $retval = bp_set_object_terms( $group_id, $group_type, 'bp_group_type', $append );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bust the cache if the type has been updated.</span>&nbsp;</div></li><li><div>  if ( ! is_wp_error( $retval ) ) {&nbsp;</div></li><li><div>      wp_cache_delete( $group_id, 'bp_groups_group_type' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires just after a group type has been changed.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int          $group_id   ID of the group whose group type has been updated.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string|array $group_type Group type or array of group types.</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool         $append     Whether the type is being appended to existing types.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'bp_groups_set_group_type', $group_id, $group_type, $append );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get type for a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int  $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $single   Optional. Whether to return a single type string. If multiple types are found</span>&nbsp;</div></li><li><div><span class="comment"> *                       for the group, the oldest one will be returned. Default: true.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|array|bool On success, returns a single group type (if `$single` is true) or an array of group</span>&nbsp;</div></li><li><div><span class="comment"> *                           types (if `$single` is false). Returns false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_groups_get_group_type( $group_id, $single = true ) {&nbsp;</div></li><li><div>  $types = wp_cache_get( $group_id, 'bp_groups_group_type' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $types ) {&nbsp;</div></li><li><div>      $raw_types = bp_get_object_terms( $group_id, 'bp_group_type' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_wp_error( $raw_types ) ) {&nbsp;</div></li><li><div>          $types = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Only include currently registered group types.</span>&nbsp;</div></li><li><div>          foreach ( $raw_types as $gtype ) {&nbsp;</div></li><li><div>              if ( bp_groups_get_group_type_object( $gtype-&gt;name ) ) {&nbsp;</div></li><li><div>                  $types[] = $gtype-&gt;name;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_cache_set( $group_id, $types, 'bp_groups_group_type' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $type = false;&nbsp;</div></li><li><div>  if ( ! empty( $types ) ) {&nbsp;</div></li><li><div>      if ( $single ) {&nbsp;</div></li><li><div>          $type = end( $types );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $type = $types;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a groups's group type(s).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $type     Group type.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int          $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool         $single   Whether to return a single type string, or an array.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_groups_get_group_type', $type, $group_id, $single );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Remove type for a group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int            $group      ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string         $group_type Group type.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|WP_Error $deleted    True on success. False or WP_Error on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_groups_remove_group_type( $group_id, $group_type ) {&nbsp;</div></li><li><div>  if ( empty( $group_type ) || ! bp_groups_get_group_type_object( $group_type ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $deleted = bp_remove_object_terms( $group_id, $group_type, 'bp_group_type' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bust the case, if the type has been removed.</span>&nbsp;</div></li><li><div>  if ( ! is_wp_error( $deleted ) ) {&nbsp;</div></li><li><div>      wp_cache_delete( $group_id, 'bp_groups_group_type' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires just after a group's group type has been removed.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $group      ID of the group whose group type has been removed.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $group_type Group type.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'bp_groups_remove_group_type', $group_id, $group_type );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $deleted;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check whether the given group has a certain group type.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int    $group_id   ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @param  string $group_type Group type.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool   Whether the group has the give group type.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_groups_has_group_type( $group_id, $group_type ) {&nbsp;</div></li><li><div>  if ( empty( $group_type ) || ! bp_groups_get_group_type_object( $group_type ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get all group's group types.</span>&nbsp;</div></li><li><div>  $types = bp_groups_get_group_type( $group_id, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! is_array( $types ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return in_array( $group_type, $types );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the &quot;current&quot; group type, if one is provided, in group directories.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_get_current_group_directory_type() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the &quot;current&quot; group type, if one is provided, in group directories.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value &quot;Current&quot; group type.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_get_current_group_directory_type', buddypress()-&gt;groups-&gt;current_directory_type );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a group's type when the group is deleted.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param  int   $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $value    See {@see bp_groups_set_group_type()}.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_remove_group_type_on_group_delete( $group_id = 0 ) {&nbsp;</div></li><li><div>  bp_groups_set_group_type( $group_id, '' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'groups_delete_group', 'bp_remove_group_type_on_group_delete' );&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>