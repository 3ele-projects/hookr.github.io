<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.8.2" data-slug="buddypress" data-type="file" data-id="49193"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-forums-bbpress-bb-includes-functions-bb-meta | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.8.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=84246bb263790d59f10e03d6245f1c99' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-forums-bbpress-bb-includes-functions-bb-meta/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-forums-bbpress-bb-includes-functions-bb-meta%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-forums-bbpress-bb-includes-functions-bb-meta%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.2-file-bp-forums-bbpress-bb-includes-functions-bb-meta","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-forums-bbpress-bb-includes-functions-bb-meta" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.8.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-forums-bbpress-bb-includes&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.2/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.2/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.2/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.2/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-forums/bbpress/bb-includes/functions.bb-meta.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Options/Meta */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Internal */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_sanitize_meta_key( $key )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return preg_replace( '|[^a-z0-9_]|i', '', $key );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds and updates meta data in the database</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @internal</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_update_meta( $object_id = 0, $meta_key, $meta_value, $type, $global = false )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $bbdb;&nbsp;</div></li><li><div>  if ( !is_numeric( $object_id ) || empty( $object_id ) && !$global ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $cache_object_id = $object_id = (int) $object_id;&nbsp;</div></li><li><div>  switch ( $type ) {&nbsp;</div></li><li><div>      case 'option':&nbsp;</div></li><li><div>          $object_type = 'bb_option';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'user' :&nbsp;</div></li><li><div>          global $wp_users_object;&nbsp;</div></li><li><div>          $id = $object_id;&nbsp;</div></li><li><div>          $return = $wp_users_object-&gt;update_meta( compact( 'id', 'meta_key', 'meta_value' ) );&nbsp;</div></li><li><div>          if ( is_wp_error( $return ) ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $return;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'forum' :&nbsp;</div></li><li><div>          $object_type = 'bb_forum';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'topic' :&nbsp;</div></li><li><div>          $object_type = 'bb_topic';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'post' :&nbsp;</div></li><li><div>          $object_type = 'bb_post';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      default :&nbsp;</div></li><li><div>          $object_type = $type;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_key = bb_sanitize_meta_key( $meta_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_tuple = compact( 'object_type', 'object_id', 'meta_key', 'meta_value', 'type' );&nbsp;</div></li><li><div>  $meta_tuple = apply_filters( 'bb_update_meta', $meta_tuple );&nbsp;</div></li><li><div>  extract( $meta_tuple, EXTR_OVERWRITE );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_value = $_meta_value = maybe_serialize( $meta_value );&nbsp;</div></li><li><div>  $meta_value = maybe_unserialize( $meta_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $cur = $bbdb-&gt;get_row( $bbdb-&gt;prepare( &quot;SELECT * FROM `$bbdb-&gt;meta` WHERE `object_type` = %s AND `object_id` = %d AND `meta_key` = %s&quot;, $object_type, $object_id, $meta_key ) );&nbsp;</div></li><li><div>  if ( !$cur ) {&nbsp;</div></li><li><div>      $bbdb-&gt;query( $bbdb-&gt;prepare(&nbsp;</div></li><li><div>          &quot;INSERT INTO `$bbdb-&gt;meta` ( `object_type`, `object_id`, `meta_key`, `meta_value` ) VALUES( %s, %d, %s, %s )&nbsp;</div></li><li><div>          ON DUPLICATE KEY UPDATE `meta_value` = VALUES( `meta_value` )&quot;, &nbsp;</div></li><li><div>          $object_type, $object_id, $meta_key, $_meta_value&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  } elseif ( $cur-&gt;meta_value != $meta_value ) {&nbsp;</div></li><li><div>      $bbdb-&gt;update( $bbdb-&gt;meta, array( 'meta_value' =&gt; $_meta_value), array( 'object_type' =&gt; $object_type, 'object_id' =&gt; $object_id, 'meta_key' =&gt; $meta_key ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $object_type === 'bb_option' ) {&nbsp;</div></li><li><div>      $cache_object_id = $meta_key;&nbsp;</div></li><li><div>      wp_cache_delete( $cache_object_id, 'bb_option_not_set' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  wp_cache_delete( $cache_object_id, $object_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$cur ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Deletes meta data from the database</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @internal</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_delete_meta( $object_id = 0, $meta_key, $meta_value, $type, $global = false )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $bbdb;&nbsp;</div></li><li><div>  if ( !is_numeric( $object_id ) || empty( $object_id ) && !$global ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $cache_object_id = $object_id = (int) $object_id;&nbsp;</div></li><li><div>  switch ( $type ) {&nbsp;</div></li><li><div>      case 'option':&nbsp;</div></li><li><div>          $object_type = 'bb_option';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'user':&nbsp;</div></li><li><div>          global $wp_users_object;&nbsp;</div></li><li><div>          $id = $object_id;&nbsp;</div></li><li><div>          return $wp_users_object-&gt;delete_meta( compact( 'id', 'meta_key', 'meta_value' ) );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'forum':&nbsp;</div></li><li><div>          $object_type = 'bb_forum';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'topic':&nbsp;</div></li><li><div>          $object_type = 'bb_topic';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'post':&nbsp;</div></li><li><div>          $object_type = 'bb_post';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      default:&nbsp;</div></li><li><div>          $object_type = $type;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_key = bb_sanitize_meta_key( $meta_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_tuple = compact( 'object_type', 'object_id', 'meta_key', 'meta_value', 'type' );&nbsp;</div></li><li><div>  $meta_tuple = apply_filters( 'bb_delete_meta', $meta_tuple );&nbsp;</div></li><li><div>  extract( $meta_tuple, EXTR_OVERWRITE );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_value = maybe_serialize( $meta_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $meta_value ) ) {&nbsp;</div></li><li><div>      $meta_sql = $bbdb-&gt;prepare( &quot;SELECT `meta_id` FROM `$bbdb-&gt;meta` WHERE `object_type` = %s AND `object_id` = %d AND `meta_key` = %s&quot;, $object_type, $object_id, $meta_key );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $meta_sql = $bbdb-&gt;prepare( &quot;SELECT `meta_id` FROM `$bbdb-&gt;meta` WHERE `object_type` = %s AND `object_id` = %d AND `meta_key` = %s AND `meta_value` = %s&quot;, $object_type, $object_id, $meta_key, $meta_value );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$meta_id = $bbdb-&gt;get_var( $meta_sql ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bbdb-&gt;query( $bbdb-&gt;prepare( &quot;DELETE FROM `$bbdb-&gt;meta` WHERE `meta_id` = %d&quot;, $meta_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $object_type == 'bb_option' ) {&nbsp;</div></li><li><div>      $cache_object_id = $meta_key;&nbsp;</div></li><li><div>      wp_cache_delete( $cache_object_id, 'bb_option_not_set' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  wp_cache_delete( $cache_object_id, $object_type );&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds an objects meta data to the object</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This is the only function that should add to user / topic - NOT bbdb::prepared</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @internal</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_append_meta( $object, $type )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $bbdb;&nbsp;</div></li><li><div>  switch ( $type ) {&nbsp;</div></li><li><div>      case 'user':&nbsp;</div></li><li><div>          global $wp_users_object;&nbsp;</div></li><li><div>          return $wp_users_object-&gt;append_meta( $object );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'forum':&nbsp;</div></li><li><div>          $object_id_column = 'forum_id';&nbsp;</div></li><li><div>          $object_type = 'bb_forum';&nbsp;</div></li><li><div>          $slug = 'forum_slug';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'topic':&nbsp;</div></li><li><div>          $object_id_column = 'topic_id';&nbsp;</div></li><li><div>          $object_type = 'bb_topic';&nbsp;</div></li><li><div>          $slug = 'topic_slug';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'post':&nbsp;</div></li><li><div>          $object_id_column = 'post_id';&nbsp;</div></li><li><div>          $object_type = 'bb_post';&nbsp;</div></li><li><div>          $slug = false;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_array( $object ) && count( $object ) ) {&nbsp;</div></li><li><div>      $trans = array();&nbsp;</div></li><li><div>      foreach ( array_keys( $object ) as $i ) {&nbsp;</div></li><li><div>          $trans[$object[$i]-&gt;$object_id_column] =& $object[$i];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $ids = array_map( 'intval', array_keys( $trans ) );&nbsp;</div></li><li><div>      $query_ids = array();&nbsp;</div></li><li><div>      $cached_objects = array();&nbsp;</div></li><li><div>      $position = 0;&nbsp;</div></li><li><div>      foreach ( $ids as $_id ) {&nbsp;</div></li><li><div>          if ( false !== $_cached_object = wp_cache_get( $_id, $object_type ) ) {&nbsp;</div></li><li><div>              $cached_objects[$position] = $_cached_object;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $query_ids[$position] = $_id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $position++;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( !count( $query_ids ) ) {&nbsp;</div></li><li><div>          return $cached_objects;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $_query_ids = $query_ids;&nbsp;</div></li><li><div>      sort( $_query_ids );&nbsp;</div></li><li><div>      $_query_ids = join( ', ', $_query_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $metas = $bbdb-&gt;get_results( &quot;SELECT `object_id`, `meta_key`, `meta_value` FROM `$bbdb-&gt;meta` WHERE `object_type` = '$object_type' AND `object_id` IN ($_query_ids) <span class="comment"><span class="comment">/* bb_append_meta */</span></span>&quot; ) ) {&nbsp;</div></li><li><div>          usort( $metas, '_bb_append_meta_sort' );&nbsp;</div></li><li><div>          foreach ( $metas as $meta ) {&nbsp;</div></li><li><div>              $trans[$meta-&gt;object_id]-&gt;{$meta-&gt;meta_key} = maybe_unserialize( $meta-&gt;meta_value );&nbsp;</div></li><li><div>              if ( strpos($meta-&gt;meta_key, $bbdb-&gt;prefix) === 0 ) {&nbsp;</div></li><li><div>                  $trans[$meta-&gt;object_id]-&gt;{substr($meta-&gt;meta_key, strlen($bbdb-&gt;prefix))} = maybe_unserialize( $meta-&gt;meta_value );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ( $query_ids as $position =&gt; $i ) {&nbsp;</div></li><li><div>          $cached_objects[$position] = $trans[$i];&nbsp;</div></li><li><div>          wp_cache_add( $i, $trans[$i], $object_type );&nbsp;</div></li><li><div>          if ( $slug ) {&nbsp;</div></li><li><div>              wp_cache_add( $trans[$i]-&gt;$slug, $i, 'bb_' . $slug );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( !count( $cached_objects ) ) {&nbsp;</div></li><li><div>          return $object;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      ksort( $cached_objects );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $cached_objects;&nbsp;</div></li><li><div>  } elseif ( $object ) {&nbsp;</div></li><li><div>      if ( false !== $cached_object = wp_cache_get( $object-&gt;$object_id_column, $object_type ) ) {&nbsp;</div></li><li><div>          return $cached_object;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( $metas = $bbdb-&gt;get_results( $bbdb-&gt;prepare( &quot;SELECT `object_id`, `meta_key`, `meta_value` FROM `$bbdb-&gt;meta` WHERE `object_type` = '$object_type' AND `object_id` = %d <span class="comment"><span class="comment">/* bb_append_meta */</span></span>&quot;, $object-&gt;$object_id_column ) ) ) {&nbsp;</div></li><li><div>          usort( $metas, '_bb_append_meta_sort' );&nbsp;</div></li><li><div>          foreach ( $metas as $meta ) {&nbsp;</div></li><li><div>              $object-&gt;{$meta-&gt;meta_key} = maybe_unserialize( $meta-&gt;meta_value );&nbsp;</div></li><li><div>              if ( strpos( $meta-&gt;meta_key, $bbdb-&gt;prefix ) === 0 ) {&nbsp;</div></li><li><div>                  $object-&gt;{substr( $meta-&gt;meta_key, strlen( $bbdb-&gt;prefix ) )} = $object-&gt;{$meta-&gt;meta_key};&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( $object-&gt;$object_id_column ) {&nbsp;</div></li><li><div>          wp_cache_add( $object-&gt;$object_id_column, $object, $object_type );&nbsp;</div></li><li><div>          if ( $slug ) {&nbsp;</div></li><li><div>              wp_cache_add( $object-&gt;$slug, $object-&gt;$object_id_column, 'bb_' . $slug );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return $object;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sorts meta keys by length to ensure $appended_object-&gt;{$bbdb-&gt;prefix} key overwrites $appended_object-&gt;key as desired</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @internal</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function _bb_append_meta_sort( $a, $b )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return strlen( $a-&gt;meta_key ) - strlen( $b-&gt;meta_key );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Options */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Echoes the requested bbPress option by calling bb_get_option()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string The option to be echoed</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_option( $option )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo apply_filters( 'bb_option_' . $option, bb_get_option( $option ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns the requested bbPress option from the meta table or the $bb object</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string The option to be echoed</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed The value of the option</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_get_option( $option )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  <span class="comment">// Allow plugins to short-circuit options.</span>&nbsp;</div></li><li><div>  if ( false !== $r = apply_filters( 'bb_pre_get_option_' . $option, false, $option ) ) {&nbsp;</div></li><li><div>      return $r;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $bb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $option ) {&nbsp;</div></li><li><div>      case 'site_id':&nbsp;</div></li><li><div>          if ( isset( $bb-&gt;site_id ) && is_numeric( $bb-&gt;site_id ) ) {&nbsp;</div></li><li><div>              $r = (int) $bb-&gt;site_id;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $r = 1;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'language':&nbsp;</div></li><li><div>          $r = str_replace( '_', '-', bb_get_locale() );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'text_direction':&nbsp;</div></li><li><div>          global $bb_locale;&nbsp;</div></li><li><div>          $r = $bb_locale-&gt;text_direction;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'version':&nbsp;</div></li><li><div>          return '1.2'; <span class="comment"><span class="comment">// Don't filter</span></span>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'bb_db_version' :&nbsp;</div></li><li><div>          return '2471'; <span class="comment"><span class="comment">// Don't filter</span></span>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'html_type':&nbsp;</div></li><li><div>          $r = 'text/html';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'charset':&nbsp;</div></li><li><div>          $r = 'UTF-8';&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'bb_table_prefix':&nbsp;</div></li><li><div>      case 'table_prefix':&nbsp;</div></li><li><div>          global $bbdb;&nbsp;</div></li><li><div>          return $bbdb-&gt;prefix; <span class="comment"><span class="comment">// Don't filter</span></span>;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>      case 'url':&nbsp;</div></li><li><div>          $option = 'uri';&nbsp;</div></li><li><div>      default:&nbsp;</div></li><li><div>          if ( isset( $bb-&gt;$option ) ) {&nbsp;</div></li><li><div>              $r = $bb-&gt;$option;&nbsp;</div></li><li><div>              if ( $option === 'mod_rewrite' ) {&nbsp;</div></li><li><div>                  if ( is_bool( $r ) ) {&nbsp;</div></li><li><div>                      $r = (int) $r;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $r = bb_get_option_from_db( $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !$r ) {&nbsp;</div></li><li><div>              switch ( $option ) {&nbsp;</div></li><li><div>                  case 'name':&nbsp;</div></li><li><div>                      $r = __( 'Please give me a name!' );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'wp_table_prefix' :&nbsp;</div></li><li><div>                      global $wp_table_prefix; <span class="comment">// This global is deprecated</span>&nbsp;</div></li><li><div>                      return $wp_table_prefix; <span class="comment"><span class="comment">// Don't filter</span></span>;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'mod_rewrite':&nbsp;</div></li><li><div>                      $r = 0;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'page_topics':&nbsp;</div></li><li><div>                      $r = 30;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'edit_lock':&nbsp;</div></li><li><div>                      $r = 60;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'gmt_offset':&nbsp;</div></li><li><div>                      $r = 0;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'uri_ssl':&nbsp;</div></li><li><div>                      $r = preg_replace( '|^http:<span class="comment">//|i', 'https://', bb_get_option( 'uri' ) );</span>&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'throttle_time':&nbsp;</div></li><li><div>                      $r = 30;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'email_login':&nbsp;</div></li><li><div>                      $r = false;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_option_' . $option, $r, $option );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieves and returns the requested bbPress option from the meta table</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string The option to be echoed</span>&nbsp;</div></li><li><div><span class="comment"> * @return void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_get_option_from_db( $option )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $bbdb;&nbsp;</div></li><li><div>  $option = bb_sanitize_meta_key( $option );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( wp_cache_get( $option, 'bb_option_not_set' ) ) {&nbsp;</div></li><li><div>      $r = null;&nbsp;</div></li><li><div>  } elseif ( false !== $_r = wp_cache_get( $option, 'bb_option' ) ) {&nbsp;</div></li><li><div>      $r = $_r;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( BB_INSTALLING ) {&nbsp;</div></li><li><div>          $bbdb-&gt;suppress_errors();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $row = $bbdb-&gt;get_row( $bbdb-&gt;prepare( &quot;SELECT `meta_value` FROM `$bbdb-&gt;meta` WHERE `object_type` = 'bb_option' AND `meta_key` = %s&quot;, $option ) );&nbsp;</div></li><li><div>      if ( BB_INSTALLING ) {&nbsp;</div></li><li><div>          $bbdb-&gt;suppress_errors( false );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_object( $row ) ) {&nbsp;</div></li><li><div>          $r = maybe_unserialize( $row-&gt;meta_value );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $r = null;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $r === null ) {&nbsp;</div></li><li><div>      wp_cache_set( $option, true, 'bb_option_not_set' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      wp_cache_set( $option, $r, 'bb_option' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'bb_get_option_from_db_' . $option, $r, $option );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_form_option( $option )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  echo bb_get_form_option( $option );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_form_option( $option )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return esc_attr( bb_get_option( $option ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Don't use the return value; use the API. Only returns options stored in DB.</span>&nbsp;</div></li><li><div>function bb_cache_all_options()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $base_options = array(&nbsp;</div></li><li><div>      'site_id', &nbsp;</div></li><li><div>      'bb_db_version', &nbsp;</div></li><li><div>      'name', &nbsp;</div></li><li><div>      'description', &nbsp;</div></li><li><div>      'uri_ssl', &nbsp;</div></li><li><div>      'from_email', &nbsp;</div></li><li><div>      'bb_auth_salt', &nbsp;</div></li><li><div>      'bb_secure_auth_salt', &nbsp;</div></li><li><div>      'bb_logged_in_salt', &nbsp;</div></li><li><div>      'bb_nonce_salt', &nbsp;</div></li><li><div>      'page_topics', &nbsp;</div></li><li><div>      'edit_lock', &nbsp;</div></li><li><div>      'bb_active_theme', &nbsp;</div></li><li><div>      'active_plugins', &nbsp;</div></li><li><div>      'mod_rewrite', &nbsp;</div></li><li><div>      'datetime_format', &nbsp;</div></li><li><div>      'date_format', &nbsp;</div></li><li><div>      'avatars_show', &nbsp;</div></li><li><div>      'avatars_default', &nbsp;</div></li><li><div>      'avatars_rating', &nbsp;</div></li><li><div>      'wp_table_prefix', &nbsp;</div></li><li><div>      'user_bbdb_name', &nbsp;</div></li><li><div>      'user_bbdb_user', &nbsp;</div></li><li><div>      'user_bbdb_password', &nbsp;</div></li><li><div>      'user_bbdb_host', &nbsp;</div></li><li><div>      'user_bbdb_charset', &nbsp;</div></li><li><div>      'user_bbdb_collate', &nbsp;</div></li><li><div>      'custom_user_table', &nbsp;</div></li><li><div>      'custom_user_meta_table', &nbsp;</div></li><li><div>      'wp_siteurl', &nbsp;</div></li><li><div>      'wp_home', &nbsp;</div></li><li><div>      'cookiedomain', &nbsp;</div></li><li><div>      'usercookie', &nbsp;</div></li><li><div>      'passcookie', &nbsp;</div></li><li><div>      'authcookie', &nbsp;</div></li><li><div>      'cookiepath', &nbsp;</div></li><li><div>      'sitecookiepath', &nbsp;</div></li><li><div>      'secure_auth_cookie', &nbsp;</div></li><li><div>      'logged_in_cookie', &nbsp;</div></li><li><div>      'admin_cookie_path', &nbsp;</div></li><li><div>      'core_plugins_cookie_path', &nbsp;</div></li><li><div>      'user_plugins_cookie_path', &nbsp;</div></li><li><div>      'wp_admin_cookie_path', &nbsp;</div></li><li><div>      'wp_plugins_cookie_path', &nbsp;</div></li><li><div>      'wordpress_mu_primary_blog_id', &nbsp;</div></li><li><div>      'enable_loginless', &nbsp;</div></li><li><div>      'enable_subscriptions', &nbsp;</div></li><li><div>      'enable_xmlrpc', &nbsp;</div></li><li><div>      'enable_pingback', &nbsp;</div></li><li><div>      'throttle_time', &nbsp;</div></li><li><div>      'bb_xmlrpc_allow_user_switching', &nbsp;</div></li><li><div>      'bp_bbpress_cron', &nbsp;</div></li><li><div>      'email_login', &nbsp;</div></li><li><div>      'static_title', &nbsp;</div></li><li><div>      'plugin_cookie_paths', &nbsp;</div></li><li><div>      'wp_roles_map', &nbsp;</div></li><li><div>      'gmt_offset', &nbsp;</div></li><li><div>      'timezone_string', &nbsp;</div></li><li><div>      'name_link_profile', &nbsp;</div></li><li><div>      'bp_bbpress_cron_check', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check that these aren't already in the cache</span>&nbsp;</div></li><li><div>  $query_options = array();&nbsp;</div></li><li><div>  foreach ( $base_options as $base_option ) {&nbsp;</div></li><li><div>      if ( isset( $bb-&gt;$base_option ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( wp_cache_get( $base_option, 'bb_option_not_set' ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( false === wp_cache_get( $base_option, 'bb_option' ) ) {&nbsp;</div></li><li><div>          $query_options[] = $base_option;&nbsp;</div></li><li><div>          wp_cache_set( $base_option, true, 'bb_option_not_set' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( !count( $query_options ) ) {&nbsp;</div></li><li><div>      <span class="comment">// It's all in cache</span>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $query_keys = &quot;('&quot; . join( &quot;', '&quot;, $query_options ) . &quot;')&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $bbdb;&nbsp;</div></li><li><div>  $results = $bbdb-&gt;get_results( &quot;SELECT `meta_key`, `meta_value` FROM `$bbdb-&gt;meta` WHERE `object_type` = 'bb_option' AND `meta_key` IN $query_keys;&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count( $base_options ) === count( $query_options ) && ( !$results || !is_array( $results ) || !count( $results ) ) ) {&nbsp;</div></li><li><div>      <span class="comment">// Let's assume that the options haven't been populated from the old topicmeta table</span>&nbsp;</div></li><li><div>      if ( !BB_INSTALLING && ( !defined( 'BB_DO_NOT_UPGRADE_TOPICMETA' ) || !BB_DO_NOT_UPGRADE_TOPICMETA ) ) {&nbsp;</div></li><li><div>          $topicmeta_exists = $bbdb-&gt;query( &quot;SELECT * FROM $bbdb-&gt;topicmeta LIMIT 1&quot; );&nbsp;</div></li><li><div>          if ($topicmeta_exists) {&nbsp;</div></li><li><div>              require_once( BB_PATH . 'bb-admin/includes/defaults.bb-schema.php' );&nbsp;</div></li><li><div>              <span class="comment">// Create the meta table</span>&nbsp;</div></li><li><div>              $bbdb-&gt;query( $bb_queries['meta'] );&nbsp;</div></li><li><div>              <span class="comment">// Copy options</span>&nbsp;</div></li><li><div>              $bbdb-&gt;query( &quot;INSERT INTO `$bbdb-&gt;meta` (`meta_key`, `meta_value`) SELECT `meta_key`, `meta_value` FROM `$bbdb-&gt;topicmeta` WHERE `topic_id` = 0;&quot; );&nbsp;</div></li><li><div>              <span class="comment">// Copy topic meta</span>&nbsp;</div></li><li><div>              $bbdb-&gt;query( &quot;INSERT INTO `$bbdb-&gt;meta` (`object_id`, `meta_key`, `meta_value`) SELECT `topic_id`, `meta_key`, `meta_value` FROM `$bbdb-&gt;topicmeta` WHERE `topic_id` != 0;&quot; );&nbsp;</div></li><li><div>              <span class="comment">// Entries with an object_id are topic meta at this stage</span>&nbsp;</div></li><li><div>              $bbdb-&gt;query( &quot;UPDATE `$bbdb-&gt;meta` SET `object_type` = 'bb_topic' WHERE `object_id` != 0&quot; );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset( $topicmeta_exists );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return bb_cache_all_options();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      foreach ( $results as $options ) {&nbsp;</div></li><li><div>          wp_cache_delete( $options-&gt;meta_key, 'bb_option_not_set' );&nbsp;</div></li><li><div>          wp_cache_set( $options-&gt;meta_key, maybe_unserialize( $options-&gt;meta_value ), 'bb_option' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Can store anything but NULL.</span>&nbsp;</div></li><li><div>function bb_update_option( $option, $value )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_update_meta( 0, $option, $value, 'option', true );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_delete_option( $option, $value = '' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_delete_meta( 0, $option, $value, 'option', true );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a transient</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Transient</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $transient Transient name. Expected to not be SQL-escaped</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool true if successful, false otherwise</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_delete_transient( $transient )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $_bb_using_ext_object_cache, $bbdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $_bb_using_ext_object_cache ) {&nbsp;</div></li><li><div>      return wp_cache_delete( $transient, 'transient' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $transient = '_transient_' . $bbdb-&gt;escape( $transient );&nbsp;</div></li><li><div>      return bb_delete_option( $transient );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the value of a transient</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If the transient does not exist or does not have a value, then the return value</span>&nbsp;</div></li><li><div><span class="comment"> * will be false.</span>&nbsp;</div></li><li><div><span class="comment"> * </span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Transient</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $transient Transient name. Expected to not be SQL-escaped</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Value of transient</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_get_transient( $transient )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $_bb_using_ext_object_cache, $bbdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $_bb_using_ext_object_cache ) {&nbsp;</div></li><li><div>      $value = wp_cache_get( $transient, 'transient' );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $transient_option = '_transient_' . $bbdb-&gt;escape( $transient );&nbsp;</div></li><li><div>      $transient_timeout = '_transient_timeout_' . $bbdb-&gt;escape( $transient );&nbsp;</div></li><li><div>      $timeout = bb_get_option( $transient_timeout );&nbsp;</div></li><li><div>      if ( $timeout && $timeout &lt; time() ) {&nbsp;</div></li><li><div>          bb_delete_option( $transient_option );&nbsp;</div></li><li><div>          bb_delete_option( $transient_timeout );&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $value = bb_get_option( $transient_option );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'transient_' . $transient, $value );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Set/update the value of a transient</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * You do not need to serialize values, if the value needs to be serialize, then</span>&nbsp;</div></li><li><div><span class="comment"> * it will be serialized before it is set.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Transient</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $transient Transient name. Expected to not be SQL-escaped</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $value Transient value.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $expiration Time until expiration in seconds, default 0</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool False if value was not set and true if value was set.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_set_transient( $transient, $value, $expiration = 0 )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  global $_bb_using_ext_object_cache, $bbdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $_bb_using_ext_object_cache ) {&nbsp;</div></li><li><div>      return wp_cache_set( $transient, $value, 'transient', $expiration );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $transient_timeout = '_transient_timeout_' . $bbdb-&gt;escape( $transient );&nbsp;</div></li><li><div>      $transient = '_transient_' . $bbdb-&gt;escape( $transient );&nbsp;</div></li><li><div>      if ( 0 != $expiration ) {&nbsp;</div></li><li><div>          bb_update_option( $transient_timeout, time() + $expiration );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      return bb_update_option( $transient, $value );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** User meta */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_usermeta( $user_id, $meta_key )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !$user = bb_get_user( $user_id ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_key = bb_sanitize_meta_key( $meta_key );&nbsp;</div></li><li><div>  if ( !isset( $user-&gt;$meta_key ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $user-&gt;$meta_key;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_update_usermeta( $user_id, $meta_key, $meta_value )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_update_meta( $user_id, $meta_key, $meta_value, 'user' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// $meta_value defaults to null to conform to BackPress' WP_User::delete_meta()</span>&nbsp;</div></li><li><div>function bb_delete_usermeta( $user_id, $meta_key, $meta_value = null )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_delete_meta( $user_id, $meta_key, $meta_value, 'user' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Saves and restores user interface settings stored in a cookie.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Checks if the current user-settings cookie is updated and stores it. When no</span>&nbsp;</div></li><li><div><span class="comment"> * cookie exists (different browser used), adds the last saved cookie restoring</span>&nbsp;</div></li><li><div><span class="comment"> * the settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Meta</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_user_settings()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !defined( 'BB_IS_ADMIN' ) || !BB_IS_ADMIN ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( defined( 'DOING_AJAX' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$user = bb_get_current_user() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $settings = bb_get_usermeta( $user-&gt;ID, 'bb_user_settings' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $_COOKIE['bb-user-settings-' . $user-&gt;ID] ) ) {&nbsp;</div></li><li><div>      $cookie = preg_replace( '/[^A-Za-z0-9=&_]/', '', $_COOKIE['bb-user-settings-' . $user-&gt;ID] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $cookie ) && strpos( $cookie, '=' ) ) {&nbsp;</div></li><li><div>          if ( $cookie == $settings ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $last_time = (int) bb_get_usermeta( $user-&gt;ID, 'bb_user_settings_time' );&nbsp;</div></li><li><div>          $saved = isset( $_COOKIE['bb-user-settings-time-' . $user-&gt;ID] ) ? preg_replace( '/[^0-9]/', '', $_COOKIE['bb-user-settings-time-' . $user-&gt;ID] ) : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $saved &gt; $last_time ) {&nbsp;</div></li><li><div>              bb_update_usermeta( $user-&gt;ID, 'bb_user_settings', $cookie );&nbsp;</div></li><li><div>              bb_update_usermeta( $user-&gt;ID, 'bb_user_settings_time', time() - 5 );&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  setcookie( 'bb-user-settings-' . $user-&gt;ID, $settings, time() + 31536000, $bb-&gt;cookiepath );&nbsp;</div></li><li><div>  setcookie( 'bb-user-settings-time-' . $user-&gt;ID, time(), time() + 31536000, $bb-&gt;cookiepath );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve user interface setting value based on setting name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Meta</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name The name of the setting.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $default Optional default value to return when $name is not set.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed the last saved user setting or the default value/false if it doesn't exist.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_get_user_setting( $name, $default = false )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $arr = bb_get_all_user_settings();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return isset( $arr[$name] ) ? $arr[$name] : $default;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds or updates a user interface setting value based on setting name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Meta</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $name The name of the setting.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $value The value of the setting.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_update_user_setting( $name, $value )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( is_null( $value ) || $value === '' ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$user = bb_get_current_user() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $name = (string) $name;&nbsp;</div></li><li><div>  $name = preg_replace( '/[^A-Za-z0-9_]/', '', $name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $value = (string) $value;&nbsp;</div></li><li><div>  $value = preg_replace( '/[^A-Za-z0-9_]/', '', $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $arr = bb_get_all_user_settings();&nbsp;</div></li><li><div>  $arr[$name] = $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $arr as $k =&gt; $v ) {&nbsp;</div></li><li><div>      $settings .= $k . '=' . $v . '&';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $settings = rtrim( $settings, '&' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bb_update_usermeta( $user-&gt;ID, 'bb_user_settings', $settings );&nbsp;</div></li><li><div>  setcookie( 'bb-user-settings-' . $user-&gt;ID, $settings, time() + 31536000, $bb-&gt;cookiepath );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete user interface settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Deleting settings would reset them to the defaults.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Meta</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $names The name or array of names of the setting to be deleted.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_delete_user_setting( $names )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  $arr = bb_get_all_user_settings();&nbsp;</div></li><li><div>  $names = (array) $names;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$user = bb_get_current_user() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $names as $name ) {&nbsp;</div></li><li><div>      if ( isset( $arr[$name] ) ) {&nbsp;</div></li><li><div>          unset( $arr[$name] );&nbsp;</div></li><li><div>          $settings = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $settings ) ) {&nbsp;</div></li><li><div>      foreach ( $arr as $k =&gt; $v ) {&nbsp;</div></li><li><div>          $settings .= $k . '=' . $v . '&';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $settings = rtrim( $settings, '&' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bb_update_usermeta( $user-&gt;ID, 'bb_user_settings', $settings );&nbsp;</div></li><li><div>      setcookie( 'bb-user-settings-' . $user-&gt;ID, $settings, time() + 31536000, $bb-&gt;cookiepath );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve all user interface settings.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Meta</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array the last saved user settings or empty array.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_get_all_user_settings()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( ! $user = bb_get_current_user() ) {&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $arr = array();&nbsp;</div></li><li><div>  if ( isset( $_COOKIE['bb-user-settings-' . $user-&gt;ID] ) ) {&nbsp;</div></li><li><div>      $cookie = preg_replace( '/[^A-Za-z0-9=&_]/', '', $_COOKIE['bb-user-settings-' . $user-&gt;ID] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $cookie && strpos( $cookie, '=' ) ) { <span class="comment">// the '=' cannot be 1st char</span>&nbsp;</div></li><li><div>          parse_str( $cookie, $arr );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } elseif ( isset( $user-&gt;bb_user_settings ) && is_string( $user-&gt;bb_user_settings ) ) {&nbsp;</div></li><li><div>      parse_str( $user-&gt;bb_user_settings, $arr );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $arr;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete the user settings of the current user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package bbPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Meta</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bb_delete_all_user_settings()&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !$user = bb_get_current_user() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bb_delete_usermeta( $user-&gt;ID, 'bb_user_settings' );&nbsp;</div></li><li><div>  setcookie( 'bb-user-settings-' . $user-&gt;ID, ' ', time() - 31536000, $bb-&gt;cookiepath );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Forum meta */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_forummeta( $forum_id, $meta_key )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !$forum = bb_get_forum( $forum_id ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_key = bb_sanitize_meta_key( $meta_key );&nbsp;</div></li><li><div>  if ( !isset( $forum-&gt;$meta_key ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $forum-&gt;$meta_key;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_update_forummeta( $forum_id, $meta_key, $meta_value )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_update_meta( $forum_id, $meta_key, $meta_value, 'forum' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_delete_forummeta( $forum_id, $meta_key, $meta_value = '' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_delete_meta( $forum_id, $meta_key, $meta_value, 'forum' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Topic meta */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_topicmeta( $topic_id, $meta_key )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !$topic = get_topic( $topic_id ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_key = bb_sanitize_meta_key( $meta_key );&nbsp;</div></li><li><div>  if ( !isset($topic-&gt;$meta_key) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $topic-&gt;$meta_key;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_update_topicmeta( $topic_id, $meta_key, $meta_value )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_update_meta( $topic_id, $meta_key, $meta_value, 'topic' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_delete_topicmeta( $topic_id, $meta_key, $meta_value = '' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_delete_meta( $topic_id, $meta_key, $meta_value, 'topic' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Post meta */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_get_postmeta( $post_id, $meta_key )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  if ( !$post = bb_get_post( $post_id ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_key = bb_sanitize_meta_key( $meta_key );&nbsp;</div></li><li><div>  if ( !isset( $post-&gt;$meta_key ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  return $post-&gt;$meta_key;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_update_postmeta( $post_id, $meta_key, $meta_value )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_update_meta( $post_id, $meta_key, $meta_value, 'post' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function bb_delete_postmeta( $post_id, $meta_key, $meta_value = '' )&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>  return bb_delete_meta( $post_id, $meta_key, $meta_value, 'post' );&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>