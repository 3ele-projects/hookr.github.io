<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.8.2" data-slug="buddypress" data-type="file" data-id="49537"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-xprofile-bp-xprofile-functions | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.8.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=903ee4a7bcd999640c69c52326a22af2' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-xprofile-bp-xprofile-functions/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-xprofile-bp-xprofile-functions%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-xprofile-bp-xprofile-functions%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.2-file-bp-xprofile-bp-xprofile-functions","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-xprofile-bp-xprofile-functions" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.8.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-xprofile-bp-xprofile-funct&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.2/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.2/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.2/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.2/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-xprofile/bp-xprofile-functions.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * BuddyPress XProfile Filters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Business functions are where all the magic happens in BuddyPress. They will</span>&nbsp;</div></li><li><div><span class="comment"> * handle the actual saving or manipulation of information. Usually they will</span>&nbsp;</div></li><li><div><span class="comment"> * hand off to a database class for data access, then return</span>&nbsp;</div></li><li><div><span class="comment"> * true or false on success or failure.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BuddyPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage XProfileFunctions</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly.</span>&nbsp;</div></li><li><div>defined( 'ABSPATH' ) || exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/*** Field Group Management **************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fetch a set of field groups, populated with fields and field data.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Procedural wrapper for BP_XProfile_Group::get() method.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $args See {@link BP_XProfile_Group::get()} for description of arguments.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $groups</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_get_groups( $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $groups = BP_XProfile_Group::get( $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a set of field groups, populated with fields and field data.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $groups Array of field groups and field data.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args   Array of arguments used to query for groups.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_xprofile_get_groups', $groups, $args );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Insert a new profile field group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $args {</span>&nbsp;</div></li><li><div><span class="comment"> *    Array of arguments for field group insertion.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *    @type int|bool    $field_group_id ID of the field group to insert into.</span>&nbsp;</div></li><li><div><span class="comment"> *    @type string|bool $name           Name of the group.</span>&nbsp;</div></li><li><div><span class="comment"> *    @type string      $description    Field group description.</span>&nbsp;</div></li><li><div><span class="comment"> *    @type bool        $can_delete     Whether or not the field group can be deleted.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_insert_field_group( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Parse the arguments.</span>&nbsp;</div></li><li><div>  $r = bp_parse_args( $args, array(&nbsp;</div></li><li><div>      'field_group_id' =&gt; false, &nbsp;</div></li><li><div>      'name' =&gt; false, &nbsp;</div></li><li><div>      'description' =&gt; '', &nbsp;</div></li><li><div>      'can_delete' =&gt; true&nbsp;</div></li><li><div> ), 'xprofile_insert_field_group' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if no group name.</span>&nbsp;</div></li><li><div>  if ( empty( $r['name'] ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Create new field group object, maybe using an existing ID.</span>&nbsp;</div></li><li><div>  $field_group = new BP_XProfile_Group( $r['field_group_id'] );&nbsp;</div></li><li><div>  $field_group-&gt;name = $r['name'];&nbsp;</div></li><li><div>  $field_group-&gt;description = $r['description'];&nbsp;</div></li><li><div>  $field_group-&gt;can_delete = $r['can_delete'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $field_group-&gt;save();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a specific profile field group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $field_group_id Field group ID to fetch.</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean|BP_XProfile_Group</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_get_field_group( $field_group_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Try to get a specific field group by ID.</span></span>&nbsp;</div></li><li><div>  $field_group = new BP_XProfile_Group( $field_group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Bail if group was not found.</span></span>&nbsp;</div></li><li><div>  if ( empty( $field_group-&gt;id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Return field group.</span>&nbsp;</div></li><li><div>  return $field_group;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a specific profile field group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $field_group_id Field group ID to delete.</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_delete_field_group( $field_group_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Try to get a specific field group by ID.</span></span>&nbsp;</div></li><li><div>  $field_group = xprofile_get_field_group( $field_group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Bail if group was not found.</span></span>&nbsp;</div></li><li><div>  if ( false === $field_group ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Return the results of trying to delete the field group.</span>&nbsp;</div></li><li><div>  return $field_group-&gt;delete();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update the position of a specific profile field group.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $field_group_id Field group ID to update.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $position       Field group position to update to.</span>&nbsp;</div></li><li><div><span class="comment"> * @return boolean</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_update_field_group_position( $field_group_id = 0, $position = 0 ) {&nbsp;</div></li><li><div>  return BP_XProfile_Group::update_position( $field_group_id, $position );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/*** Field Management *********************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get details of all xprofile field types.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Key/value pairs (field type =&gt; class name).</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_get_field_types() {&nbsp;</div></li><li><div>  $fields = array(&nbsp;</div></li><li><div>      'checkbox' =&gt; 'BP_XProfile_Field_Type_Checkbox', &nbsp;</div></li><li><div>      'datebox' =&gt; 'BP_XProfile_Field_Type_Datebox', &nbsp;</div></li><li><div>      'multiselectbox' =&gt; 'BP_XProfile_Field_Type_Multiselectbox', &nbsp;</div></li><li><div>      'number' =&gt; 'BP_XProfile_Field_Type_Number', &nbsp;</div></li><li><div>      'url' =&gt; 'BP_XProfile_Field_Type_URL', &nbsp;</div></li><li><div>      'radio' =&gt; 'BP_XProfile_Field_Type_Radiobutton', &nbsp;</div></li><li><div>      'selectbox' =&gt; 'BP_XProfile_Field_Type_Selectbox', &nbsp;</div></li><li><div>      'textarea' =&gt; 'BP_XProfile_Field_Type_Textarea', &nbsp;</div></li><li><div>      'textbox' =&gt; 'BP_XProfile_Field_Type_Textbox', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the list of all xprofile field types.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If you've added a custom field type in a plugin, register it with this filter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $fields Array of field type/class name pairings.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_xprofile_get_field_types', $fields );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Creates the specified field type object; used for validation and templating.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $type Type of profile field to create. See {@link bp_xprofile_get_field_types()} for default core values.</span>&nbsp;</div></li><li><div><span class="comment"> * @return object $value If field type unknown, returns BP_XProfile_Field_Type_Textarea.</span>&nbsp;</div></li><li><div><span class="comment"> *                       Otherwise returns an instance of the relevant child class of BP_XProfile_Field_Type.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_create_field_type( $type ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $field = bp_xprofile_get_field_types();&nbsp;</div></li><li><div>  $class = isset( $field[$type] ) ? $field[$type] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * To handle (missing) field types, fallback to a placeholder field object if a type is unknown.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( $class && class_exists( $class ) ) {&nbsp;</div></li><li><div>      return new $class;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return new BP_XProfile_Field_Type_Placeholder;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Insert or update an xprofile field.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array|string $args {</span>&nbsp;</div></li><li><div><span class="comment"> *     Array of arguments.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $field_id          Optional. Pass the ID of an existing field to edit that field.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $field_group_id    ID of the associated field group.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $parent_id         Optional. ID of the parent field.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $type              Field type. Checked against a field_types whitelist.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $name              Name of the new field.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $description       Optional. Descriptive text for the field.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool   $is_required       Optional. Whether users must provide a value for the field. Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool   $can_delete        Optional. Whether admins can delete this field in the Dashboard interface.</span>&nbsp;</div></li><li><div><span class="comment"> *                                     Generally this is false only for the Name field, which is required throughout BP.</span>&nbsp;</div></li><li><div><span class="comment"> *                                     Default: true.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string $order_by          Optional. For field types that support options (such as 'radio'), this flag</span>&nbsp;</div></li><li><div><span class="comment"> *                                     determines whether the sort order of the options will be 'default'</span>&nbsp;</div></li><li><div><span class="comment"> *                                     (order created) or 'custom'.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type bool   $is_default_option Optional. For the 'option' field type, setting this value to true means that</span>&nbsp;</div></li><li><div><span class="comment"> *                                     it'll be the default value for the parent field when the user has not yet</span>&nbsp;</div></li><li><div><span class="comment"> *                                     overridden. Default: true.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type int    $option_order      Optional. For the 'option' field type, this determines the order in which the</span>&nbsp;</div></li><li><div><span class="comment"> *                                     options appear.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|int False on failure, ID of new field on success.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_insert_field( $args = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $r = wp_parse_args( $args, array(&nbsp;</div></li><li><div>      'field_id' =&gt; null, &nbsp;</div></li><li><div>      'field_group_id' =&gt; null, &nbsp;</div></li><li><div>      'parent_id' =&gt; null, &nbsp;</div></li><li><div>      'type' =&gt; '', &nbsp;</div></li><li><div>      'name' =&gt; '', &nbsp;</div></li><li><div>      'description' =&gt; '', &nbsp;</div></li><li><div>      'is_required' =&gt; false, &nbsp;</div></li><li><div>      'can_delete' =&gt; true, &nbsp;</div></li><li><div>      'order_by' =&gt; '', &nbsp;</div></li><li><div>      'is_default_option' =&gt; false, &nbsp;</div></li><li><div>      'option_order' =&gt; null, &nbsp;</div></li><li><div>      'field_order' =&gt; null, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Field_group_id is required.</span>&nbsp;</div></li><li><div>  if ( empty( $r['field_group_id'] ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check this is a non-empty, valid field type.</span>&nbsp;</div></li><li><div>  if ( ! in_array( $r['type'], (array) buddypress()-&gt;profile-&gt;field_types ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Instantiate a new field object.</span>&nbsp;</div></li><li><div>  if ( ! empty( $r['field_id'] ) ) {&nbsp;</div></li><li><div>      $field = xprofile_get_field( $r['field_id'] );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $field = new BP_XProfile_Field;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $field-&gt;group_id = $r['field_group_id'];&nbsp;</div></li><li><div>  $field-&gt;type = $r['type'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// The 'name' field cannot be empty.</span>&nbsp;</div></li><li><div>  if ( ! empty( $r['name'] ) ) {&nbsp;</div></li><li><div>      $field-&gt;name = $r['name'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $field-&gt;description = $r['description'];&nbsp;</div></li><li><div>  $field-&gt;order_by = $r['order_by'];&nbsp;</div></li><li><div>  $field-&gt;parent_id = (int) $r['parent_id'];&nbsp;</div></li><li><div>  $field-&gt;field_order = (int) $r['field_order'];&nbsp;</div></li><li><div>  $field-&gt;option_order = (int) $r['option_order'];&nbsp;</div></li><li><div>  $field-&gt;is_required = (bool) $r['is_required'];&nbsp;</div></li><li><div>  $field-&gt;can_delete = (bool) $r['can_delete'];&nbsp;</div></li><li><div>  $field-&gt;is_default_option = (bool) $r['is_default_option'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $field-&gt;save();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a profile field object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0 Added `$user_id` and `$get_data` parameters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|object $field    ID of the field or object representing field data.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $user_id  Optional. ID of the user associated with the field.</span>&nbsp;</div></li><li><div><span class="comment"> *                             Ignored if `$get_data` is false. If `$get_data` is</span>&nbsp;</div></li><li><div><span class="comment"> *                             true, but no `$user_id` is provided, defaults to</span>&nbsp;</div></li><li><div><span class="comment"> *                             logged-in user ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool       $get_data Whether to fetch data for the specified `$user_id`.</span>&nbsp;</div></li><li><div><span class="comment"> * @return BP_XProfile_Field|null Field object if found, otherwise null.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_get_field( $field, $user_id = null, $get_data = true ) {&nbsp;</div></li><li><div>  if ( $field instanceof BP_XProfile_Field ) {&nbsp;</div></li><li><div>      $_field = $field;&nbsp;</div></li><li><div>  } elseif ( is_object( $field ) ) {&nbsp;</div></li><li><div>      $_field = new BP_XProfile_Field();&nbsp;</div></li><li><div>      $_field-&gt;fill_data( $field );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $_field = BP_XProfile_Field::get_instance( $field, $user_id, $get_data );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $_field ) {&nbsp;</div></li><li><div>      return null;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $_field;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a profile field object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|object $field_id ID of the field or object representing field data.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether or not the field was deleted.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_delete_field( $field_id ) {&nbsp;</div></li><li><div>  $field = new BP_XProfile_Field( $field_id );&nbsp;</div></li><li><div>  return $field-&gt;delete();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/*** Field Data Management *****************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fetches profile data for a specific field for the user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * When the field value is serialized, this function unserializes and filters</span>&nbsp;</div></li><li><div><span class="comment"> * each item in the array.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $field        The ID of the field, or the $name of the field.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id      The ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $multi_format How should array data be returned? 'comma' if you want a</span>&nbsp;</div></li><li><div><span class="comment"> *                             comma-separated string; 'array' if you want an array.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed The profile field data.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_get_field_data( $field, $user_id = 0, $multi_format = 'array' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) ) {&nbsp;</div></li><li><div>      $user_id = bp_displayed_user_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_numeric( $field ) ) {&nbsp;</div></li><li><div>      $field_id = $field;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $field_id = xprofile_get_field_id_from_name( $field );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $field_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $values = maybe_unserialize( BP_XProfile_ProfileData::get_value_byid( $field_id, $user_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_array( $values ) ) {&nbsp;</div></li><li><div>      $data = array();&nbsp;</div></li><li><div>      foreach( (array) $values as $value ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the field data value for a specific field for the user.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $value    Value saved for the field.</span>&nbsp;</div></li><li><div><span class="comment">           * @param int    $field_id ID of the field being displayed.</span>&nbsp;</div></li><li><div><span class="comment">           * @param int    $user_id  ID of the user being displayed.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $data[] = apply_filters( 'xprofile_get_field_data', $value, $field_id, $user_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'comma' == $multi_format ) {&nbsp;</div></li><li><div>          $data = implode( ', ', $data );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">/** This filter is documented in bp-xprofile/bp-xprofile-functions.php */</span>&nbsp;</div></li><li><div>      $data = apply_filters( 'xprofile_get_field_data', $values, $field_id, $user_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $data;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * A simple function to set profile data for a specific field for a specific user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|string $field       The ID of the field, or the $name of the field.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int        $user_id     The ID of the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed      $value       The value for the field you want to set for the user.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool       $is_required Whether or not the field is required.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_set_field_data( $field, $user_id, $value, $is_required = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_numeric( $field ) ) {&nbsp;</div></li><li><div>      $field_id = $field;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $field_id = xprofile_get_field_id_from_name( $field );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $field_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $field = xprofile_get_field( $field_id );&nbsp;</div></li><li><div>  $field_type = BP_XProfile_Field::get_type( $field_id );&nbsp;</div></li><li><div>  $field_type_obj = bp_xprofile_create_field_type( $field_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filter the raw submitted profile field value.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Use this filter to modify the values submitted by users before</span>&nbsp;</div></li><li><div><span class="comment">   * doing field-type-specific validation.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed                  $value          Value passed to xprofile_set_field_data().</span>&nbsp;</div></li><li><div><span class="comment">   * @param BP_XProfile_Field      $field          Field object.</span>&nbsp;</div></li><li><div><span class="comment">   * @param BP_XProfile_Field_Type $field_type_obj Field type object.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $value = apply_filters( 'bp_xprofile_set_field_data_pre_validate', $value, $field, $field_type_obj );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Special-case support for integer 0 for the number field type.</span>&nbsp;</div></li><li><div>  if ( $is_required && ! is_integer( $value ) && $value !== '0' && ( empty( $value ) || ! is_array( $value ) && ! strlen( trim( $value ) ) ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Certain types of fields (checkboxes, multiselects) may come through empty.</span>&nbsp;</div></li><li><div><span class="comment">   * Save as empty array so this isn't overwritten by the default on next edit.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Special-case support for integer 0 for the number field type</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( empty( $value ) && ! is_integer( $value ) && $value !== '0' && $field_type_obj-&gt;accepts_null_value ) {&nbsp;</div></li><li><div>      $value = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the value is empty, then delete any field data that exists, unless the field is of a type</span>&nbsp;</div></li><li><div>  <span class="comment">// where null values are semantically meaningful.</span>&nbsp;</div></li><li><div>  if ( empty( $value ) && ! is_integer( $value ) && $value !== '0' && ! $field_type_obj-&gt;accepts_null_value ) {&nbsp;</div></li><li><div>      xprofile_delete_field_data( $field_id, $user_id );&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// For certain fields, only certain parameters are acceptable, so add them to the whitelist.</span>&nbsp;</div></li><li><div>  if ( $field_type_obj-&gt;supports_options ) {&nbsp;</div></li><li><div>      $field_type_obj-&gt;set_whitelist_values( wp_list_pluck( $field-&gt;get_children(), 'name' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check the value is in an accepted format for this form field.</span>&nbsp;</div></li><li><div>  if ( ! $field_type_obj-&gt;is_valid( $value ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $field = new BP_XProfile_ProfileData();&nbsp;</div></li><li><div>  $field-&gt;field_id = $field_id;&nbsp;</div></li><li><div>  $field-&gt;user_id = $user_id;&nbsp;</div></li><li><div>  $field-&gt;value = maybe_serialize( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $field-&gt;save();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Set the visibility level for this field.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $field_id         The ID of the xprofile field.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id          The ID of the user to whom the data belongs.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $visibility_level What the visibity setting should be.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_set_field_visibility_level( $field_id = 0, $user_id = 0, $visibility_level = '' ) {&nbsp;</div></li><li><div>  if ( empty( $field_id ) || empty( $user_id ) || empty( $visibility_level ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check against a whitelist.</span>&nbsp;</div></li><li><div>  $allowed_values = bp_xprofile_get_visibility_levels();&nbsp;</div></li><li><div>  if ( !array_key_exists( $visibility_level, $allowed_values ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Stored in an array in usermeta.</span>&nbsp;</div></li><li><div>  $current_visibility_levels = bp_get_user_meta( $user_id, 'bp_xprofile_visibility_levels', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$current_visibility_levels ) {&nbsp;</div></li><li><div>      $current_visibility_levels = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_visibility_levels[$field_id] = $visibility_level;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return bp_update_user_meta( $user_id, 'bp_xprofile_visibility_levels', $current_visibility_levels );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the visibility level for a field.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $field_id The ID of the xprofile field.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id The ID of the user to whom the data belongs.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_get_field_visibility_level( $field_id = 0, $user_id = 0 ) {&nbsp;</div></li><li><div>  $current_level = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $field_id ) || empty( $user_id ) ) {&nbsp;</div></li><li><div>      return $current_level;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $current_levels = bp_get_user_meta( $user_id, 'bp_xprofile_visibility_levels', true );&nbsp;</div></li><li><div>  $current_level = isset( $current_levels[ $field_id ] ) ? $current_levels[ $field_id ] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Use the user's stored level, unless custom visibility is disabled.</span>&nbsp;</div></li><li><div>  $field = xprofile_get_field( $field_id );&nbsp;</div></li><li><div>  if ( isset( $field-&gt;allow_custom_visibility ) && 'disabled' === $field-&gt;allow_custom_visibility ) {&nbsp;</div></li><li><div>      $current_level = $field-&gt;default_visibility;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If we're still empty, it means that overrides are permitted, but the</span>&nbsp;</div></li><li><div>  <span class="comment">// user has not provided a value. Use the default value.</span>&nbsp;</div></li><li><div>  if ( empty( $current_level ) ) {&nbsp;</div></li><li><div>      $current_level = $field-&gt;default_visibility;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $current_level;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete XProfile field data.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $field   Field to delete.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id User ID to delete field from.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether or not the field was deleted.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_delete_field_data( $field = '', $user_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the field ID.</span>&nbsp;</div></li><li><div>  if ( is_numeric( $field ) ) {&nbsp;</div></li><li><div>      $field_id = (int) $field;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $field_id = xprofile_get_field_id_from_name( $field );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if field or user ID are empty.</span>&nbsp;</div></li><li><div>  if ( empty( $field_id ) || empty( $user_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the profile field data to delete.</span>&nbsp;</div></li><li><div>  $field = new BP_XProfile_ProfileData( $field_id, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Delete the field data.</span>&nbsp;</div></li><li><div>  return $field-&gt;delete();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check if field is a required field.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $field_id ID of the field to check for.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Whether or not field is required.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_check_is_required_field( $field_id ) {&nbsp;</div></li><li><div>  $field = new BP_XProfile_Field( $field_id );&nbsp;</div></li><li><div>  $retval = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $field-&gt;is_required ) ) {&nbsp;</div></li><li><div>      $retval = $field-&gt;is_required;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return (bool) $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Returns the ID for the field based on the field name.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $field_name The name of the field to get the ID for.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int $field_id on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_get_field_id_from_name( $field_name ) {&nbsp;</div></li><li><div>  return BP_XProfile_Field::get_id_from_name( $field_name );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fetches a random piece of profile data for the user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global BuddyPress $bp           The one true BuddyPress instance.</span>&nbsp;</div></li><li><div><span class="comment"> * @global object     $wpdb         WordPress DB access object.</span>&nbsp;</div></li><li><div><span class="comment"> * @global object     $current_user WordPress global variable containing current logged in user information.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int  $user_id          User ID of the user to get random data for.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $exclude_fullname Optional; whether or not to exclude the full name field as random data.</span>&nbsp;</div></li><li><div><span class="comment"> *                               Defaults to true.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|bool The fetched random data for the user, or false if no data or no match.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_get_random_profile_data( $user_id, $exclude_fullname = true ) {&nbsp;</div></li><li><div>  $field_data = BP_XProfile_ProfileData::get_random( $user_id, $exclude_fullname );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $field_data ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $field_data[0]-&gt;value = xprofile_format_profile_field( $field_data[0]-&gt;type, $field_data[0]-&gt;value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $field_data[0]-&gt;value ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters a random piece of profile data for the user.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $field_data Array holding random profile data.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'xprofile_get_random_profile_data', $field_data );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Formats a profile field according to its type. [ TODO: Should really be moved to filters ]</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $field_type  The type of field: datebox, selectbox, textbox etc.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $field_value The actual value.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|bool The formatted value, or false if value is empty.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_format_profile_field( $field_type, $field_value ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $field_value ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $field_value = bp_unserialize_profile_field( $field_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'datebox' != $field_type ) {&nbsp;</div></li><li><div>      $content = $field_value;&nbsp;</div></li><li><div>      $field_value = str_replace( ']]&gt;', ']]&gt;', $content );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return xprofile_filter_format_field_value_by_type( stripslashes_deep( $field_value ), $field_type );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update the field position for a provided field.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $field_id       ID of the field to update.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $position       Position to update the field to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $field_group_id Group ID for group the field is in.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_update_field_position( $field_id, $position, $field_group_id ) {&nbsp;</div></li><li><div>  return BP_XProfile_Field::update_position( $field_id, $position, $field_group_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Replace the displayed and logged-in users fullnames with the xprofile name, if required.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The Members component uses the logged-in user's display_name to set the</span>&nbsp;</div></li><li><div><span class="comment"> * value of buddypress()-&gt;loggedin_user-&gt;fullname. However, in cases where</span>&nbsp;</div></li><li><div><span class="comment"> * profile sync is disabled, display_name may diverge from the xprofile</span>&nbsp;</div></li><li><div><span class="comment"> * fullname field value, and the xprofile field should take precedence.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Runs at bp_setup_globals:100 to ensure that all components have loaded their</span>&nbsp;</div></li><li><div><span class="comment"> * globals before attempting any overrides.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_override_user_fullnames() {&nbsp;</div></li><li><div>  <span class="comment">// If sync is enabled, the two names will match. No need to continue.</span>&nbsp;</div></li><li><div>  if ( ! bp_disable_profile_sync() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_loggedin_user_id() ) {&nbsp;</div></li><li><div>      buddypress()-&gt;loggedin_user-&gt;fullname = bp_core_get_user_displayname( bp_loggedin_user_id() );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_displayed_user_id() ) {&nbsp;</div></li><li><div>      buddypress()-&gt;displayed_user-&gt;fullname = bp_core_get_user_displayname( bp_displayed_user_id() );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_setup_globals', 'xprofile_override_user_fullnames', 100 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Setup the avatar upload directory for a user.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BuddyPress Core</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $directory The root directory name. Optional.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $user_id   The user ID. Optional.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Array containing the path, URL, and other helpful settings.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_avatar_upload_dir( $directory = 'avatars', $user_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Use displayed user if no user ID was passed.</span>&nbsp;</div></li><li><div>  if ( empty( $user_id ) ) {&nbsp;</div></li><li><div>      $user_id = bp_displayed_user_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Failsafe against accidentally nooped $directory parameter.</span>&nbsp;</div></li><li><div>  if ( empty( $directory ) ) {&nbsp;</div></li><li><div>      $directory = 'avatars';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $path = bp_core_avatar_upload_path() . '/' . $directory. '/' . $user_id;&nbsp;</div></li><li><div>  $newbdir = $path;&nbsp;</div></li><li><div>  $newurl = bp_core_avatar_url() . '/' . $directory. '/' . $user_id;&nbsp;</div></li><li><div>  $newburl = $newurl;&nbsp;</div></li><li><div>  $newsubdir = '/' . $directory. '/' . $user_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the avatar upload directory for a user.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $value Array containing the path, URL, and other helpful settings.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'xprofile_avatar_upload_dir', array(&nbsp;</div></li><li><div>      'path' =&gt; $path, &nbsp;</div></li><li><div>      'url' =&gt; $newurl, &nbsp;</div></li><li><div>      'subdir' =&gt; $newsubdir, &nbsp;</div></li><li><div>      'basedir' =&gt; $newbdir, &nbsp;</div></li><li><div>      'baseurl' =&gt; $newburl, &nbsp;</div></li><li><div>      'error' =&gt; false&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * When search_terms are passed to BP_User_Query, search against xprofile fields.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array         $sql   Clauses in the user_id SQL query.</span>&nbsp;</div></li><li><div><span class="comment"> * @param BP_User_Query $query User query object.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_bp_user_query_search( $sql, BP_User_Query $query ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $query-&gt;query_vars['search_terms'] ) || empty( $sql['where']['search'] ) ) {&nbsp;</div></li><li><div>      return $sql;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $search_terms_clean = bp_esc_like( wp_kses_normalize_entities( $query-&gt;query_vars['search_terms'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $query-&gt;query_vars['search_wildcard'] === 'left' ) {&nbsp;</div></li><li><div>      $search_terms_nospace = '%' . $search_terms_clean;&nbsp;</div></li><li><div>      $search_terms_space = '%' . $search_terms_clean . ' %';&nbsp;</div></li><li><div>  } elseif ( $query-&gt;query_vars['search_wildcard'] === 'right' ) {&nbsp;</div></li><li><div>      $search_terms_nospace =        $search_terms_clean . '%';&nbsp;</div></li><li><div>      $search_terms_space = '% ' . $search_terms_clean . '%';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $search_terms_nospace = '%' . $search_terms_clean . '%';&nbsp;</div></li><li><div>      $search_terms_space = '%' . $search_terms_clean . '%';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Combine the core search (against wp_users) into a single OR clause</span>&nbsp;</div></li><li><div>  <span class="comment">// with the xprofile_data search.</span>&nbsp;</div></li><li><div>  $search_xprofile = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>      &quot;u.{$query-&gt;uid_name} IN ( SELECT user_id FROM {$bp-&gt;profile-&gt;table_name_data} WHERE value LIKE %s OR value LIKE %s )&quot;, &nbsp;</div></li><li><div>      $search_terms_nospace, &nbsp;</div></li><li><div>      $search_terms_space&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $search_core = $sql['where']['search'];&nbsp;</div></li><li><div>  $search_combined = &quot;( {$search_xprofile} OR {$search_core} )&quot;;&nbsp;</div></li><li><div>  $sql['where']['search'] = $search_combined;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $sql;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_user_query_uid_clauses', 'bp_xprofile_bp_user_query_search', 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Syncs Xprofile data to the standard built in WordPress profile data.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id ID of the user to sync.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_sync_wp_profile( $user_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Bail if profile syncing is disabled.</span></span>&nbsp;</div></li><li><div>  if ( bp_disable_profile_sync() ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) ) {&nbsp;</div></li><li><div>      $user_id = bp_loggedin_user_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $user_id ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $fullname = xprofile_get_field_data( bp_xprofile_fullname_field_id(), $user_id );&nbsp;</div></li><li><div>  $space = strpos( $fullname, ' ' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $space ) {&nbsp;</div></li><li><div>      $firstname = $fullname;&nbsp;</div></li><li><div>      $lastname = '';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $firstname = substr( $fullname, 0, $space );&nbsp;</div></li><li><div>      $lastname = trim( substr( $fullname, $space, strlen( $fullname ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bp_update_user_meta( $user_id, 'nickname', $fullname );&nbsp;</div></li><li><div>  bp_update_user_meta( $user_id, 'first_name', $firstname );&nbsp;</div></li><li><div>  bp_update_user_meta( $user_id, 'last_name', $lastname );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_update_user( array( 'ID' =&gt; $user_id, 'display_name' =&gt; $fullname ) );&nbsp;</div></li><li><div>  wp_cache_delete( 'bp_core_userdata_' . $user_id, 'bp' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'xprofile_updated_profile', 'xprofile_sync_wp_profile' );&nbsp;</div></li><li><div>add_action( 'bp_core_signup_user', 'xprofile_sync_wp_profile' );&nbsp;</div></li><li><div>add_action( 'bp_core_activated_user', 'xprofile_sync_wp_profile' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Syncs the standard built in WordPress profile data to XProfile.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.4</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param object $errors Array of errors. Passed by reference.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $update Whether or not being upated.</span>&nbsp;</div></li><li><div><span class="comment"> * @param object $user   User object whose profile is being synced. Passed by reference.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_sync_bp_profile( &$errors, $update, &$user ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Bail if profile syncing is disabled.</span></span>&nbsp;</div></li><li><div>  if ( bp_disable_profile_sync() || ! $update || $errors-&gt;get_error_codes() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  xprofile_set_field_data( bp_xprofile_fullname_field_id(), $user-&gt;ID, $user-&gt;display_name );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'user_profile_update_errors', 'xprofile_sync_bp_profile', 10, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * When a user is deleted, we need to clean up the database and remove all the</span>&nbsp;</div></li><li><div><span class="comment"> * profile data from each table. Also we need to clean anything up in the</span>&nbsp;</div></li><li><div><span class="comment"> * usermeta table that this component uses.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $user_id The ID of the deleted user.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function xprofile_remove_data( $user_id ) {&nbsp;</div></li><li><div>  BP_XProfile_ProfileData::delete_data_for_user( $user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'wpmu_delete_user', 'xprofile_remove_data' );&nbsp;</div></li><li><div>add_action( 'delete_user', 'xprofile_remove_data' );&nbsp;</div></li><li><div>add_action( 'bp_make_spam_user', 'xprofile_remove_data' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/*** XProfile Meta ****************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete a piece of xprofile metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int         $object_id   ID of the object the metadata belongs to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $object_type Type of object. 'group', 'field', or 'data'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|bool $meta_key    Key of the metadata being deleted. If omitted, all</span>&nbsp;</div></li><li><div><span class="comment"> *                                 metadata for the object will be deleted.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed       $meta_value  Optional. If provided, only metadata that matches</span>&nbsp;</div></li><li><div><span class="comment"> *                                 the value will be permitted.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool        $delete_all  Optional. If true, delete matching metadata entries</span>&nbsp;</div></li><li><div><span class="comment"> *                                 for all objects, ignoring the specified object_id. Otherwise, only</span>&nbsp;</div></li><li><div><span class="comment"> *                                 delete matching metadata entries for the specified object.</span>&nbsp;</div></li><li><div><span class="comment"> *                                 Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_delete_meta( $object_id, $object_type, $meta_key = false, $meta_value = false, $delete_all = false ) {&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Sanitize object type.</span></span>&nbsp;</div></li><li><div>  if ( ! in_array( $object_type, array( 'group', 'field', 'data' ) ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Legacy - if no meta_key is passed, delete all for the item.</span>&nbsp;</div></li><li><div>  if ( empty( $meta_key ) ) {&nbsp;</div></li><li><div>      $table_key = 'xprofile_' . $object_type . 'meta';&nbsp;</div></li><li><div>      $table_name = $wpdb-&gt;{$table_key};&nbsp;</div></li><li><div>      $keys = $wpdb-&gt;get_col( $wpdb-&gt;prepare( &quot;SELECT meta_key FROM {$table_name} WHERE object_type = %s AND object_id = %d&quot;, $object_type, $object_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Force delete_all to false if deleting all for object.</span>&nbsp;</div></li><li><div>      $delete_all = false;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $keys = array( $meta_key );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_xprofile_filter_meta_query' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $retval = false;&nbsp;</div></li><li><div>  foreach ( $keys as $key ) {&nbsp;</div></li><li><div>      $retval = delete_metadata( 'xprofile_' . $object_type, $object_id, $key, $meta_value, $delete_all );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_xprofile_filter_meta_query' );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a piece of xprofile metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Note that the default value of $single is true, unlike in the case of the</span>&nbsp;</div></li><li><div><span class="comment"> * underlying get_metadata() function. This is for backward compatibility.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $object_id   ID of the object the metadata belongs to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $object_type Type of object. 'group', 'field', or 'data'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_key    Key of the metadata being fetched. If omitted, all</span>&nbsp;</div></li><li><div><span class="comment"> *                            metadata for the object will be retrieved.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $single      Optional. If true, return only the first value of the</span>&nbsp;</div></li><li><div><span class="comment"> *                            specified meta_key. This parameter has no effect if meta_key is not</span>&nbsp;</div></li><li><div><span class="comment"> *                            specified. Default: true.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed Meta value if found. False on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_get_meta( $object_id, $object_type, $meta_key = '', $single = true ) {&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Sanitize object type.</span></span>&nbsp;</div></li><li><div>  if ( ! in_array( $object_type, array( 'group', 'field', 'data' ) ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_xprofile_filter_meta_query' );&nbsp;</div></li><li><div>  $retval = get_metadata( 'xprofile_' . $object_type, $object_id, $meta_key, $single );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_xprofile_filter_meta_query' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update a piece of xprofile metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $object_id   ID of the object the metadata belongs to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $object_type Type of object. 'group', 'field', or 'data'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_key    Key of the metadata being updated.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_value  Value of the metadata being updated.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $prev_value  Optional. If specified, only update existing</span>&nbsp;</div></li><li><div><span class="comment"> *                            metadata entries with the specified value.</span>&nbsp;</div></li><li><div><span class="comment"> *                            Otherwise update all entries.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|int Returns false on failure. On successful update of existing</span>&nbsp;</div></li><li><div><span class="comment"> *                  metadata, returns true. On successful creation of new metadata, </span>&nbsp;</div></li><li><div><span class="comment"> *                  returns the integer ID of the new metadata row.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_update_meta( $object_id, $object_type, $meta_key, $meta_value, $prev_value = '' ) {&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_xprofile_filter_meta_query' );&nbsp;</div></li><li><div>  $retval = update_metadata( 'xprofile_' . $object_type, $object_id, $meta_key, $meta_value, $prev_value );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_xprofile_filter_meta_query' );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add a piece of xprofile metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $object_id   ID of the object the metadata belongs to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $object_type Type of object. 'group', 'field', or 'data'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_key    Metadata key.</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed  $meta_value  Metadata value.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool   $unique      Optional. Whether to enforce a single metadata value</span>&nbsp;</div></li><li><div><span class="comment"> *                            for the given key. If true, and the object already</span>&nbsp;</div></li><li><div><span class="comment"> *                            has a value for the key, no change will be made.</span>&nbsp;</div></li><li><div><span class="comment"> *                            Default false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return int|bool The meta ID on successful update, false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_add_meta( $object_id, $object_type, $meta_key, $meta_value, $unique = false ) {&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>  add_filter( 'query', 'bp_xprofile_filter_meta_query' );&nbsp;</div></li><li><div>  $retval = add_metadata( 'xprofile_' . $object_type , $object_id, $meta_key, $meta_value, $unique );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_filter_metaid_column_name' );&nbsp;</div></li><li><div>  remove_filter( 'query', 'bp_xprofile_filter_meta_query' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Updates the fieldgroup metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $field_group_id Group ID for the group field belongs to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_key       Meta key to update.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_value     Meta value to update to.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_update_fieldgroup_meta( $field_group_id, $meta_key, $meta_value ) {&nbsp;</div></li><li><div>  return bp_xprofile_update_meta( $field_group_id, 'group', $meta_key, $meta_value );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Updates the field metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $field_id   Field ID to update.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_key   Meta key to update.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_value Meta value to update to.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_update_field_meta( $field_id, $meta_key, $meta_value ) {&nbsp;</div></li><li><div>  return bp_xprofile_update_meta( $field_id, 'field', $meta_key, $meta_value );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Updates the fielddata metadata.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $field_data_id Field ID to update.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_key      Meta key to update.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $meta_value    Meta value to update to.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_update_fielddata_meta( $field_data_id, $meta_key, $meta_value ) {&nbsp;</div></li><li><div>  return bp_xprofile_update_meta( $field_data_id, 'data', $meta_key, $meta_value );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return the field ID for the Full Name xprofile field.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return int Field ID.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_fullname_field_id() {&nbsp;</div></li><li><div>  $id = wp_cache_get( 'fullname_field_id', 'bp_xprofile' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $id ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>      $id = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT id FROM {$bp-&gt;profile-&gt;table_name_fields} WHERE name = %s&quot;, addslashes( bp_xprofile_fullname_field_name() ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_cache_set( 'fullname_field_id', $id, 'bp_xprofile' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return absint( $id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Return the field name for the Full Name xprofile field.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The field name.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_fullname_field_name() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the field name for the Full Name xprofile field.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value BP_XPROFILE_FULLNAME_FIELD_NAME Full name field constant.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_xprofile_fullname_field_name', BP_XPROFILE_FULLNAME_FIELD_NAME );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is rich text enabled for this profile field?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * By default, rich text is enabled for textarea fields and disabled for all other field types.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int|null $field_id Optional. Default current field ID.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_is_richtext_enabled_for_field( $field_id = null ) {&nbsp;</div></li><li><div>  if ( ! $field_id ) {&nbsp;</div></li><li><div>      $field_id = bp_get_the_profile_field_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $field = xprofile_get_field( $field_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $enabled = false;&nbsp;</div></li><li><div>  if ( $field instanceof BP_XProfile_Field ) {&nbsp;</div></li><li><div>      $enabled = (bool) $field-&gt;type_obj-&gt;supports_richtext;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether richtext is enabled for the given field.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $enabled  True if richtext is enabled for the field, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int  $field_id ID of the field.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_xprofile_is_richtext_enabled_for_field', $enabled, $field_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get visibility levels out of the $bp global.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_get_visibility_levels() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the visibility levels out of the $bp global.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $visibility_levels Array of visibility levels.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_xprofile_get_visibility_levels', buddypress()-&gt;profile-&gt;visibility_levels );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the ids of fields that are hidden for this displayed/loggedin user pair.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This is the function primarily responsible for profile field visibility. It works by determining</span>&nbsp;</div></li><li><div><span class="comment"> * the relationship between the displayed_user (ie the profile owner) and the current_user (ie the</span>&nbsp;</div></li><li><div><span class="comment"> * profile viewer). Then, based on that relationship, we query for the set of fields that should</span>&nbsp;</div></li><li><div><span class="comment"> * be excluded from the profile loop.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see BP_XProfile_Group::get()</span>&nbsp;</div></li><li><div><span class="comment"> *   or if you have added your own custom levels.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $displayed_user_id The id of the user the profile fields belong to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $current_user_id   The id of the user viewing the profile.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array An array of field ids that should be excluded from the profile query</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_get_hidden_fields_for_user( $displayed_user_id = 0, $current_user_id = 0 ) {&nbsp;</div></li><li><div>  if ( !$displayed_user_id ) {&nbsp;</div></li><li><div>      $displayed_user_id = bp_displayed_user_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$displayed_user_id ) {&nbsp;</div></li><li><div>      return array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$current_user_id ) {&nbsp;</div></li><li><div>      $current_user_id = bp_loggedin_user_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// @todo - This is where you'd swap out for current_user_can() checks</span>&nbsp;</div></li><li><div>  $hidden_levels = bp_xprofile_get_hidden_field_types_for_user( $displayed_user_id, $current_user_id );&nbsp;</div></li><li><div>  $hidden_fields = bp_xprofile_get_fields_by_visibility_levels( $displayed_user_id, $hidden_levels );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the ids of fields that are hidden for this displayed/loggedin user pair.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $hidden_fields     Array of hidden fields for the displayed/logged in user.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $displayed_user_id ID of the displayed user.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $current_user_id   ID of the current user.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_xprofile_get_hidden_fields_for_user', $hidden_fields, $displayed_user_id, $current_user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the visibility levels that should be hidden for this user pair.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Field visibility is determined based on the relationship between the</span>&nbsp;</div></li><li><div><span class="comment"> * logged-in user, the displayed user, and the visibility setting for the</span>&nbsp;</div></li><li><div><span class="comment"> * current field. (See bp_xprofile_get_hidden_fields_for_user().) This</span>&nbsp;</div></li><li><div><span class="comment"> * utility function speeds up this matching by fetching the visibility levels</span>&nbsp;</div></li><li><div><span class="comment"> * that should be hidden for the current user pair.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.8.2</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see bp_xprofile_get_hidden_fields_for_user()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $displayed_user_id The id of the user the profile fields belong to.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $current_user_id   The id of the user viewing the profile.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array An array of visibility levels hidden to the current user.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_get_hidden_field_types_for_user( $displayed_user_id = 0, $current_user_id = 0 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Current user is logged in.</span>&nbsp;</div></li><li><div>  if ( ! empty( $current_user_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Nothing's private when viewing your own profile, or when the</span>&nbsp;</div></li><li><div>      <span class="comment">// current user is an admin.</span>&nbsp;</div></li><li><div>      if ( $displayed_user_id == $current_user_id || bp_current_user_can( 'bp_moderate' ) ) {&nbsp;</div></li><li><div>          $hidden_levels = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If the current user and displayed user are friends, show all.</span>&nbsp;</div></li><li><div>      } elseif ( bp_is_active( 'friends' ) && friends_check_friendship( $displayed_user_id, $current_user_id ) ) {&nbsp;</div></li><li><div>          $hidden_levels = array( 'adminsonly', );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Current user is logged in but not friends, so exclude friends-only.</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $hidden_levels = array( 'friends', 'adminsonly', );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Current user is not logged in, so exclude friends-only, loggedin, and adminsonly.</span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $hidden_levels = array( 'friends', 'loggedin', 'adminsonly', );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the visibility levels that should be hidden for this user pair.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $hidden_fields     Array of hidden fields for the displayed/logged in user.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $displayed_user_id ID of the displayed user.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $current_user_id   ID of the current user.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_xprofile_get_hidden_field_types_for_user', $hidden_levels, $displayed_user_id, $current_user_id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Fetch an array of the xprofile fields that a given user has marked with certain visibility levels.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see bp_xprofile_get_hidden_fields_for_user()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int   $user_id The id of the profile owner.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $levels  An array of visibility levels ('public', 'friends', 'loggedin', 'adminsonly' etc) to be</span>&nbsp;</div></li><li><div><span class="comment"> *                       checked against.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $field_ids The fields that match the requested visibility levels for the given user.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_get_fields_by_visibility_levels( $user_id, $levels = array() ) {&nbsp;</div></li><li><div>  if ( !is_array( $levels ) ) {&nbsp;</div></li><li><div>      $levels = (array)$levels;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_visibility_levels = bp_get_user_meta( $user_id, 'bp_xprofile_visibility_levels', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Parse the user-provided visibility levels with the default levels, which may take</span>&nbsp;</div></li><li><div>  <span class="comment">// precedence.</span>&nbsp;</div></li><li><div>  $default_visibility_levels = BP_XProfile_Group::fetch_default_visibility_levels();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach( (array) $default_visibility_levels as $d_field_id =&gt; $defaults ) {&nbsp;</div></li><li><div>      <span class="comment">// If the admin has forbidden custom visibility levels for this field, replace</span>&nbsp;</div></li><li><div>      <span class="comment">// the user-provided setting with the default specified by the admin.</span>&nbsp;</div></li><li><div>      if ( isset( $defaults['allow_custom'] ) && isset( $defaults['default'] ) && 'disabled' == $defaults['allow_custom'] ) {&nbsp;</div></li><li><div>          $user_visibility_levels[$d_field_id] = $defaults['default'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $field_ids = array();&nbsp;</div></li><li><div>  foreach( (array) $user_visibility_levels as $field_id =&gt; $field_visibility ) {&nbsp;</div></li><li><div>      if ( in_array( $field_visibility, $levels ) ) {&nbsp;</div></li><li><div>          $field_ids[] = $field_id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Never allow the fullname field to be excluded.</span>&nbsp;</div></li><li><div>  if ( in_array( 1, $field_ids ) ) {&nbsp;</div></li><li><div>      $key = array_search( 1, $field_ids );&nbsp;</div></li><li><div>      unset( $field_ids[$key] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $field_ids;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Formats datebox field values passed through a POST request.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param int $field_id The id of the current field being looped through.</span>&nbsp;</div></li><li><div><span class="comment"> * @return void This function only changes the global $_POST that should contain</span>&nbsp;</div></li><li><div><span class="comment"> *              the datebox data.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_xprofile_maybe_format_datebox_post_data( $field_id ) {&nbsp;</div></li><li><div>  if ( ! isset( $_POST['field_' . $field_id] ) ) {&nbsp;</div></li><li><div>      if ( ! empty( $_POST['field_' . $field_id . '_day'] ) && ! empty( $_POST['field_' . $field_id . '_month'] ) && ! empty( $_POST['field_' . $field_id . '_year'] ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Concatenate the values.</span>&nbsp;</div></li><li><div>          $date_value = $_POST['field_' . $field_id . '_day'] . ' ' . $_POST['field_' . $field_id . '_month'] . ' ' . $_POST['field_' . $field_id . '_year'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Check that the concatenated value can be turned into a timestamp.</span>&nbsp;</div></li><li><div>          if ( $timestamp = strtotime( $date_value ) ) {&nbsp;</div></li><li><div>              <span class="comment">// Add the timestamp to the global $_POST that should contain the datebox data.</span>&nbsp;</div></li><li><div>              $_POST['field_' . $field_id] = date( 'Y-m-d H:i:s', $timestamp );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>