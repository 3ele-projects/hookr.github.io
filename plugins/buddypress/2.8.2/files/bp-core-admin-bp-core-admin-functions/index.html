<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.8.2" data-slug="buddypress" data-type="file" data-id="49013"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-core-admin-bp-core-admin-functions | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.8.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.25"}};!function(e,n,t){var a;function i(e){var t=n.createElement("canvas"),a=t.getContext&&t.getContext("2d"),i=String.fromCharCode;return!(!a||!a.fillText)&&(a.textBaseline="top",a.font="600 32px Arial","flag"===e?(a.fillText(i(55356,56806,55356,56826),0,0),3e3<t.toDataURL().length):"diversity"===e?(a.fillText(i(55356,57221),0,0),t=a.getImageData(16,16,1,1).data,a.fillText(i(55356,57221,55356,57343),0,0),(t=a.getImageData(16,16,1,1).data)[0],t[1],t[2],t[3],!0):("simple"===e?a.fillText(i(55357,56835),0,0):a.fillText(i(55356,57135),0,0),0!==a.getImageData(16,16,1,1).data[0]))}function o(e){var t=n.createElement("script");t.src=e,t.type="text/javascript",n.getElementsByTagName("head")[0].appendChild(t)}t.supports={simple:i("simple"),flag:i("flag"),unicode8:i("unicode8"),diversity:i("diversity")},t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.simple&&t.supports.flag&&t.supports.unicode8&&t.supports.diversity||(a=function(){t.readyCallback()},n.addEventListener?(n.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(e.attachEvent("onload",a),n.attachEvent("onreadystatechange",function(){"complete"===n.readyState&&t.readyCallback()})),(a=t.source||{}).concatemoji?o(a.concatemoji):a.wpemoji&&a.twemoji&&(o(a.twemoji),o(a.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=58bb98bcc2396291fd8bc1bd860b99fe' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.25' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-core-admin-bp-core-admin-functions/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-core-admin-bp-core-admin-functions%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-core-admin-bp-core-admin-functions%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.2-file-bp-core-admin-bp-core-admin-functions","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-core-admin-bp-core-admin-functions" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.8.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-core-admin-bp-core-admin-f&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.2/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.2/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.2/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.2/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-core/admin/bp-core-admin-functions.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * BuddyPress Common Admin Functions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BuddyPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage CoreAdministration</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.3.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly.</span>&nbsp;</div></li><li><div>defined( 'ABSPATH' ) || exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Menu **********************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Initializes the wp-admin area &quot;BuddyPress&quot; menus and sub menus.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_admin_menu_init() {&nbsp;</div></li><li><div>  add_action( bp_core_admin_hook(), 'bp_core_add_admin_menu', 9 );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * In BP 1.6, the top-level admin menu was removed. For backpat, this function</span>&nbsp;</div></li><li><div><span class="comment"> * keeps the top-level menu if a plugin has registered a menu into the old</span>&nbsp;</div></li><li><div><span class="comment"> * 'bp-general-settings' menu.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The old &quot;bp-general-settings&quot; page was renamed &quot;bp-components&quot;.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_parent_pages</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $_registered_pages</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $submenu</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_admin_backpat_menu() {&nbsp;</div></li><li><div>  global $_parent_pages, $_registered_pages, $submenu;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If there's no bp-general-settings menu (perhaps because the current</span>&nbsp;</div></li><li><div>  <span class="comment">// user is not an Administrator), there's nothing to do here.</span>&nbsp;</div></li><li><div>  if ( ! isset( $submenu['bp-general-settings'] ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * By default, only the core &quot;Help&quot; submenu is added under the top-level BuddyPress menu.</span>&nbsp;</div></li><li><div><span class="comment">   * This means that if no third-party plugins have registered their admin pages into the</span>&nbsp;</div></li><li><div><span class="comment">   * 'bp-general-settings' menu, it will only contain one item. Kill it.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( 1 != count( $submenu['bp-general-settings'] ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// This removes the top-level menu.</span>&nbsp;</div></li><li><div>  remove_submenu_page( 'bp-general-settings', 'bp-general-settings' );&nbsp;</div></li><li><div>  remove_menu_page( 'bp-general-settings' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// These stop people accessing the URL directly.</span>&nbsp;</div></li><li><div>  unset( $_parent_pages['bp-general-settings'] );&nbsp;</div></li><li><div>  unset( $_registered_pages['toplevel_page_bp-general-settings'] );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( bp_core_admin_hook(), 'bp_core_admin_backpat_menu', 999 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This tells WP to highlight the Settings &gt; BuddyPress menu item, </span>&nbsp;</div></li><li><div><span class="comment"> * regardless of which actual BuddyPress admin screen we are on.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The conditional prevents the behaviour when the user is viewing the</span>&nbsp;</div></li><li><div><span class="comment"> * backpat &quot;Help&quot; page, the Activity page, or any third-party plugins.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global string $plugin_page</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $submenu</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_modify_admin_menu_highlight() {&nbsp;</div></li><li><div>  global $plugin_page, $submenu_file;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// This tweaks the Settings subnav menu to show only one BuddyPress menu item.</span>&nbsp;</div></li><li><div>  if ( ! in_array( $plugin_page, array( 'bp-activity', 'bp-general-settings', ) ) ) {&nbsp;</div></li><li><div>      $submenu_file = 'bp-components';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Network Admin &gt; Tools.</span>&nbsp;</div></li><li><div>  if ( in_array( $plugin_page, array( 'bp-tools', 'available-tools' ) ) ) {&nbsp;</div></li><li><div>      $submenu_file = $plugin_page;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Generates markup for a fallback top-level BuddyPress menu page, if the site is running</span>&nbsp;</div></li><li><div><span class="comment"> * a legacy plugin which hasn't been updated. If the site is up to date, this page</span>&nbsp;</div></li><li><div><span class="comment"> * will never appear.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see bp_core_admin_backpat_menu()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @todo Add convenience links into the markup once new positions are finalised.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_admin_backpat_page() {&nbsp;</div></li><li><div>  $url = bp_core_do_network_admin() ? network_admin_url( 'settings.php' ) : admin_url( 'options-general.php' );&nbsp;</div></li><li><div>  $settings_url = add_query_arg( 'page', 'bp-components', $url ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>      &lt;h2&gt;&lt;?php _e( 'Why have all my BuddyPress menus disappeared?', 'buddypress' ); ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;p&gt;&lt;?php _e( &quot;Don't worry! We've moved the BuddyPress options into more convenient and easier to find locations. You're seeing this page because you are running a legacy BuddyPress plugin which has not been updated.&quot;, 'buddypress' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>      &lt;p&gt;&lt;?php printf( __( 'Components, Pages, Settings, and Forums, have been moved to &lt;a href=&quot;%s&quot;&gt;Settings &gt; BuddyPress&lt;/a&gt;. Profile Fields has been moved into the &lt;a href=&quot;%s&quot;&gt;Users&lt;/a&gt; menu.', 'buddypress' ), esc_url( $settings_url ), bp_get_admin_url( 'users.php?page=bp-profile-setup' ) ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Notices *******************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Print admin messages to admin_notices or network_admin_notices.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * BuddyPress combines all its messages into a single notice, to avoid a preponderance of yellow</span>&nbsp;</div></li><li><div><span class="comment"> * boxes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_print_admin_notices() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Only the super admin should see messages.</span>&nbsp;</div></li><li><div>  if ( ! bp_current_user_can( 'bp_moderate' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// On multisite installs, don't show on a non-root blog, unless</span>&nbsp;</div></li><li><div>  <span class="comment">// 'do_network_admin' is overridden.</span>&nbsp;</div></li><li><div>  if ( is_multisite() && bp_core_do_network_admin() && ! bp_is_root_blog() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $notice_types = array();&nbsp;</div></li><li><div>  foreach ( buddypress()-&gt;admin-&gt;notices as $notice ) {&nbsp;</div></li><li><div>      $notice_types[] = $notice['type'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $notice_types = array_unique( $notice_types );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $notice_types as $type ) {&nbsp;</div></li><li><div>      $notices = wp_list_filter( buddypress()-&gt;admin-&gt;notices, array( 'type' =&gt; $type ) );&nbsp;</div></li><li><div>      printf( '&lt;div id=&quot;message&quot; class=&quot;fade %s&quot;&gt;', sanitize_html_class( $type ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $notices as $notice ) {&nbsp;</div></li><li><div>          printf( '&lt;p&gt;%s&lt;/p&gt;', $notice['message'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      printf( '&lt;/div&gt;' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'admin_notices', 'bp_core_print_admin_notices' );&nbsp;</div></li><li><div>add_action( 'network_admin_notices', 'bp_core_print_admin_notices' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add an admin notice to the BP queue.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Messages added with this function are displayed in BuddyPress's general purpose admin notices</span>&nbsp;</div></li><li><div><span class="comment"> * box. It is recommended that you hook this function to admin_init, so that your messages are</span>&nbsp;</div></li><li><div><span class="comment"> * loaded in time.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $notice The notice you are adding to the queue.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $type   The notice type; optional. Usually either &quot;updated&quot; or &quot;error&quot;.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_add_admin_notice( $notice = '', $type = 'updated' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Do not add if the notice is empty.</span>&nbsp;</div></li><li><div>  if ( empty( $notice ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Double check the object before referencing it.</span>&nbsp;</div></li><li><div>  if ( ! isset( buddypress()-&gt;admin-&gt;notices ) ) {&nbsp;</div></li><li><div>      buddypress()-&gt;admin-&gt;notices = array();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add the notice.</span>&nbsp;</div></li><li><div>  buddypress()-&gt;admin-&gt;notices[] = array(&nbsp;</div></li><li><div>      'message' =&gt; $notice, &nbsp;</div></li><li><div>      'type' =&gt; $type, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Verify that some BP prerequisites are set up properly, and notify the admin if not.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * On every Dashboard page, this function checks the following:</span>&nbsp;</div></li><li><div><span class="comment"> *   - that pretty permalinks are enabled.</span>&nbsp;</div></li><li><div><span class="comment"> *   - that every BP component that needs a WP page for a directory has one.</span>&nbsp;</div></li><li><div><span class="comment"> *   - that no WP page has multiple BP components associated with it.</span>&nbsp;</div></li><li><div><span class="comment"> * The administrator will be shown a notice for each check that fails.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global WPDB $wpdb WordPress DB object</span>&nbsp;</div></li><li><div><span class="comment"> * @global WP_Rewrite $wp_rewrite</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_activation_notice() {&nbsp;</div></li><li><div>  global $wp_rewrite, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Only the super admin gets warnings.</span>&nbsp;</div></li><li><div>  if ( ! bp_current_user_can( 'bp_moderate' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail in user admin.</span>&nbsp;</div></li><li><div>  if ( is_user_admin() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// On multisite installs, don't load on a non-root blog, unless do_network_admin is overridden.</span>&nbsp;</div></li><li><div>  if ( is_multisite() && bp_core_do_network_admin() && ! bp_is_root_blog() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if in network admin, and BuddyPress is not network activated.</span>&nbsp;</div></li><li><div>  if ( is_network_admin() && ! bp_is_network_activated() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check to make sure that the blog setup routine has run. This can't</span>&nbsp;</div></li><li><div><span class="comment">   * happen during the wizard because of the order which the components</span>&nbsp;</div></li><li><div><span class="comment">   * are loaded.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( bp_is_active( 'blogs' ) ) {&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>      $count = $wpdb-&gt;get_var( &quot;SELECT COUNT(*) FROM {$bp-&gt;blogs-&gt;table_name}&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $count ) ) {&nbsp;</div></li><li><div>          bp_blogs_record_existing_blogs();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add notice if no rewrite rules are enabled.</span>&nbsp;</div></li><li><div>  if ( empty( $wp_rewrite-&gt;permalink_structure ) ) {&nbsp;</div></li><li><div>      bp_core_add_admin_notice( sprintf( __( '&lt;strong&gt;BuddyPress is almost ready&lt;/strong&gt;. You must &lt;a href=&quot;%s&quot;&gt;update your permalink structure&lt;/a&gt; to something other than the default for it to work.', 'buddypress' ), admin_url( 'options-permalink.php' ) ), 'error' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get BuddyPress instance.</span>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check for orphaned BP components (BP component is enabled, no WP page exists).</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $orphaned_components = array();&nbsp;</div></li><li><div>  $wp_page_components = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Only components with 'has_directory' require a WP page to function.</span>&nbsp;</div></li><li><div>  foreach( array_keys( $bp-&gt;loaded_components ) as $component_id ) {&nbsp;</div></li><li><div>      if ( !empty( $bp-&gt;{$component_id}-&gt;has_directory ) ) {&nbsp;</div></li><li><div>          $wp_page_components[] = array(&nbsp;</div></li><li><div>              'id' =&gt; $component_id, &nbsp;</div></li><li><div>              'name' =&gt; isset( $bp-&gt;{$component_id}-&gt;name ) ? $bp-&gt;{$component_id}-&gt;name : ucwords( $bp-&gt;{$component_id}-&gt;id )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Activate and Register are special cases. They are not components but they need WP pages.</span>&nbsp;</div></li><li><div>  <span class="comment">// If user registration is disabled, we can skip this step.</span>&nbsp;</div></li><li><div>  if ( bp_get_signup_allowed() ) {&nbsp;</div></li><li><div>      $wp_page_components[] = array(&nbsp;</div></li><li><div>          'id' =&gt; 'activate', &nbsp;</div></li><li><div>          'name' =&gt; __( 'Activate', 'buddypress' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wp_page_components[] = array(&nbsp;</div></li><li><div>          'id' =&gt; 'register', &nbsp;</div></li><li><div>          'name' =&gt; __( 'Register', 'buddypress' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// On the first admin screen after a new installation, this isn't set, so grab it to suppress</span>&nbsp;</div></li><li><div>  <span class="comment">// a misleading error message.</span>&nbsp;</div></li><li><div>  if ( empty( $bp-&gt;pages-&gt;members ) ) {&nbsp;</div></li><li><div>      $bp-&gt;pages = bp_core_get_directory_pages();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach( $wp_page_components as $component ) {&nbsp;</div></li><li><div>      if ( !isset( $bp-&gt;pages-&gt;{$component['id']} ) ) {&nbsp;</div></li><li><div>          $orphaned_components[] = $component['name'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Special case: If the Forums component is orphaned, but the bbPress 1.x installation is</span>&nbsp;</div></li><li><div>  <span class="comment">// not correctly set up, don't show a nag. (In these cases, it's probably the case that the</span>&nbsp;</div></li><li><div>  <span class="comment">// user is using bbPress 2.x; see https://buddypress.trac.wordpress.org/ticket/4292.</span>&nbsp;</div></li><li><div>  if ( isset( $bp-&gt;forums-&gt;name ) && in_array( $bp-&gt;forums-&gt;name, $orphaned_components ) && !bp_forums_is_installed_correctly() ) {&nbsp;</div></li><li><div>      $forum_key = array_search( $bp-&gt;forums-&gt;name, $orphaned_components );&nbsp;</div></li><li><div>      unset( $orphaned_components[$forum_key] );&nbsp;</div></li><li><div>      $orphaned_components = array_values( $orphaned_components );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !empty( $orphaned_components ) ) {&nbsp;</div></li><li><div>      $admin_url = bp_get_admin_url( add_query_arg( array( 'page' =&gt; 'bp-page-settings' ), 'admin.php' ) );&nbsp;</div></li><li><div>      $notice = sprintf(&nbsp;</div></li><li><div>          '%1$s &lt;a href=&quot;%2$s&quot;&gt;%3$s&lt;/a&gt;', &nbsp;</div></li><li><div>          sprintf(&nbsp;</div></li><li><div>              __( 'The following active BuddyPress Components do not have associated WordPress Pages: %s.', 'buddypress' ), &nbsp;</div></li><li><div>              '&lt;strong&gt;' . implode( '&lt;/strong&gt;, &lt;strong&gt;', array_map( 'esc_html', $orphaned_components ) ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          esc_url( $admin_url ), &nbsp;</div></li><li><div>          __( 'Repair', 'buddypress' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_core_add_admin_notice( $notice );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// BP components cannot share a single WP page. Check for duplicate assignments, and post a message if found.</span>&nbsp;</div></li><li><div>  $dupe_names = array();&nbsp;</div></li><li><div>  $page_ids = (array)bp_core_get_directory_page_ids();&nbsp;</div></li><li><div>  $dupes = array_diff_assoc( $page_ids, array_unique( $page_ids ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !empty( $dupes ) ) {&nbsp;</div></li><li><div>      foreach( array_keys( $dupes ) as $dupe_component ) {&nbsp;</div></li><li><div>          $dupe_names[] = $bp-&gt;pages-&gt;{$dupe_component}-&gt;title;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Make sure that there are no duplicate duplicates :).</span>&nbsp;</div></li><li><div>      $dupe_names = array_unique( $dupe_names );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If there are duplicates, post a message about them.</span>&nbsp;</div></li><li><div>  if ( !empty( $dupe_names ) ) {&nbsp;</div></li><li><div>      $admin_url = bp_get_admin_url( add_query_arg( array( 'page' =&gt; 'bp-page-settings' ), 'admin.php' ) );&nbsp;</div></li><li><div>      $notice = sprintf(&nbsp;</div></li><li><div>          '%1$s &lt;a href=&quot;%2$s&quot;&gt;%3$s&lt;/a&gt;', &nbsp;</div></li><li><div>          sprintf(&nbsp;</div></li><li><div>              __( 'Each BuddyPress Component needs its own WordPress page. The following WordPress Pages have more than one component associated with them: %s.', 'buddypress' ), &nbsp;</div></li><li><div>              '&lt;strong&gt;' . implode( '&lt;/strong&gt;, &lt;strong&gt;', array_map( 'esc_html', $dupe_names ) ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          esc_url( $admin_url ), &nbsp;</div></li><li><div>          __( 'Repair', 'buddypress' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_core_add_admin_notice( $notice );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Redirect user to BuddyPress's What's New page on activation.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @internal Used internally to redirect BuddyPress to the about page on activation.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_do_activation_redirect() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if no activation redirect.</span>&nbsp;</div></li><li><div>  if ( ! get_transient( '_bp_activation_redirect' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Delete the redirect transient.</span>&nbsp;</div></li><li><div>  delete_transient( '_bp_activation_redirect' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if activating from network, or bulk.</span>&nbsp;</div></li><li><div>  if ( isset( $_GET['activate-multi'] ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $query_args = array( 'page' =&gt; 'bp-about' );&nbsp;</div></li><li><div>  if ( get_transient( '_bp_is_new_install' ) ) {&nbsp;</div></li><li><div>      $query_args['is_new_install'] = '1';&nbsp;</div></li><li><div>      delete_transient( '_bp_is_new_install' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Redirect to BuddyPress about page.</span>&nbsp;</div></li><li><div>  wp_safe_redirect( add_query_arg( $query_args, bp_get_admin_url( 'index.php' ) ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** UI/Styling ****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the tabs in the admin area.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $active_tab Name of the tab that is active. Optional.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_admin_tabs( $active_tab = '' ) {&nbsp;</div></li><li><div>  $tabs_html = '';&nbsp;</div></li><li><div>  $idle_class = 'nav-tab';&nbsp;</div></li><li><div>  $active_class = 'nav-tab nav-tab-active';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the admin tabs to be displayed.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.9.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $value Array of tabs to output to the admin area.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $tabs = apply_filters( 'bp_core_admin_tabs', bp_core_get_admin_tabs( $active_tab ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Loop through tabs and build navigation.</span>&nbsp;</div></li><li><div>  foreach ( array_values( $tabs ) as $tab_data ) {&nbsp;</div></li><li><div>      $is_current = (bool) ( $tab_data['name'] == $active_tab );&nbsp;</div></li><li><div>      $tab_class = $is_current ? $active_class : $idle_class;&nbsp;</div></li><li><div>      $tabs_html .= '&lt;a href=&quot;' . esc_url( $tab_data['href'] ) . '&quot; class=&quot;' . esc_attr( $tab_class ) . '&quot;&gt;' . esc_html( $tab_data['name'] ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo $tabs_html;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the output of tabs for the admin area.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bp_admin_tabs' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the data for the tabs in the admin area.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $active_tab Name of the tab that is active. Optional.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_get_admin_tabs( $active_tab = '' ) {&nbsp;</div></li><li><div>  $tabs = array(&nbsp;</div></li><li><div>      '0' =&gt; array(&nbsp;</div></li><li><div>          'href' =&gt; bp_get_admin_url( add_query_arg( array( 'page' =&gt; 'bp-components' ), 'admin.php' ) ), &nbsp;</div></li><li><div>          'name' =&gt; __( 'Components', 'buddypress' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      '1' =&gt; array(&nbsp;</div></li><li><div>          'href' =&gt; bp_get_admin_url( add_query_arg( array( 'page' =&gt; 'bp-page-settings' ), 'admin.php' ) ), &nbsp;</div></li><li><div>          'name' =&gt; __( 'Pages', 'buddypress' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      '2' =&gt; array(&nbsp;</div></li><li><div>          'href' =&gt; bp_get_admin_url( add_query_arg( array( 'page' =&gt; 'bp-settings' ), 'admin.php' ) ), &nbsp;</div></li><li><div>          'name' =&gt; __( 'Options', 'buddypress' )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If forums component is active, add additional tab.</span>&nbsp;</div></li><li><div>  if ( bp_is_active( 'forums' ) && class_exists( 'BP_Forums_Component' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Enqueue thickbox.</span>&nbsp;</div></li><li><div>      wp_enqueue_script( 'thickbox' );&nbsp;</div></li><li><div>      wp_enqueue_style( 'thickbox' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tabs['3'] = array(&nbsp;</div></li><li><div>          'href' =&gt; bp_get_admin_url( add_query_arg( array( 'page' =&gt; 'bb-forums-setup' ), 'admin.php' ) ), &nbsp;</div></li><li><div>          'name' =&gt; __( 'Forums', 'buddypress' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the tab data used in our wp-admin screens.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $tabs Tab data.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_core_get_admin_tabs', $tabs );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Help **********************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Adds contextual help to BuddyPress admin pages.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> * @todo Make this part of the BP_Component class and split into each component.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $screen Current screen.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_add_contextual_help( $screen = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $screen-&gt;id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Component page.</span>&nbsp;</div></li><li><div>      case 'settings_page_bp-components' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Help tabs.</span></span></span></span>&nbsp;</div></li><li><div>          $screen-&gt;add_help_tab( array(&nbsp;</div></li><li><div>              'id' =&gt; 'bp-comp-overview', &nbsp;</div></li><li><div>              'title' =&gt; __( 'Overview', 'buddypress' ), &nbsp;</div></li><li><div>              'content' =&gt; bp_core_add_contextual_help_content( 'bp-comp-overview' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Help panel - sidebar links.</span></span></span></span>&nbsp;</div></li><li><div>          $screen-&gt;set_help_sidebar(&nbsp;</div></li><li><div>              '&lt;p&gt;&lt;strong&gt;' . __( 'For more information:', 'buddypress' ) . '&lt;/strong&gt;&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment">//codex.buddypress.org/getting-started/configure-components/&quot;&gt;Managing Components&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;' .</span>&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment"><span class="comment"><span class="comment"><span class="comment">//buddypress.org/support/&quot;&gt;Support Forums&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;'</span></span></span></span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Pages page.</span>&nbsp;</div></li><li><div>      case 'settings_page_bp-page-settings' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Help tabs.</span></span></span></span>&nbsp;</div></li><li><div>          $screen-&gt;add_help_tab( array(&nbsp;</div></li><li><div>              'id' =&gt; 'bp-page-overview', &nbsp;</div></li><li><div>              'title' =&gt; __( 'Overview', 'buddypress' ), &nbsp;</div></li><li><div>              'content' =&gt; bp_core_add_contextual_help_content( 'bp-page-overview' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Help panel - sidebar links.</span></span></span></span>&nbsp;</div></li><li><div>          $screen-&gt;set_help_sidebar(&nbsp;</div></li><li><div>              '&lt;p&gt;&lt;strong&gt;' . __( 'For more information:', 'buddypress' ) . '&lt;/strong&gt;&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment">//codex.buddypress.org/getting-started/configure-components/#settings-buddypress-pages&quot;&gt;Managing Pages&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;' .</span>&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment"><span class="comment"><span class="comment"><span class="comment">//buddypress.org/support/&quot;&gt;Support Forums&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;'</span></span></span></span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Settings page.</span>&nbsp;</div></li><li><div>      case 'settings_page_bp-settings' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Help tabs.</span></span></span></span>&nbsp;</div></li><li><div>          $screen-&gt;add_help_tab( array(&nbsp;</div></li><li><div>              'id' =&gt; 'bp-settings-overview', &nbsp;</div></li><li><div>              'title' =&gt; __( 'Overview', 'buddypress' ), &nbsp;</div></li><li><div>              'content' =&gt; bp_core_add_contextual_help_content( 'bp-settings-overview' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Help panel - sidebar links.</span></span></span></span>&nbsp;</div></li><li><div>          $screen-&gt;set_help_sidebar(&nbsp;</div></li><li><div>              '&lt;p&gt;&lt;strong&gt;' . __( 'For more information:', 'buddypress' ) . '&lt;/strong&gt;&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment">//codex.buddypress.org/getting-started/configure-components/#settings-buddypress-settings&quot;&gt;Managing Settings&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;' .</span>&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment"><span class="comment"><span class="comment"><span class="comment">//buddypress.org/support/&quot;&gt;Support Forums&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;'</span></span></span></span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Profile fields page.</span>&nbsp;</div></li><li><div>      case 'users_page_bp-profile-setup' :&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Help tabs.</span></span></span></span>&nbsp;</div></li><li><div>          $screen-&gt;add_help_tab( array(&nbsp;</div></li><li><div>              'id' =&gt; 'bp-profile-overview', &nbsp;</div></li><li><div>              'title' =&gt; __( 'Overview', 'buddypress' ), &nbsp;</div></li><li><div>              'content' =&gt; bp_core_add_contextual_help_content( 'bp-profile-overview' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment">// Help panel - sidebar links.</span></span></span></span>&nbsp;</div></li><li><div>          $screen-&gt;set_help_sidebar(&nbsp;</div></li><li><div>              '&lt;p&gt;&lt;strong&gt;' . __( 'For more information:', 'buddypress' ) . '&lt;/strong&gt;&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment">//codex.buddypress.org/administrator-guide/extended-profiles/&quot;&gt;Managing Profile Fields&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;' .</span>&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment"><span class="comment"><span class="comment"><span class="comment">//buddypress.org/support/&quot;&gt;Support Forums&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;'</span></span></span></span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'load-settings_page_bp-components', 'bp_core_add_contextual_help' );&nbsp;</div></li><li><div>add_action( 'load-settings_page_bp-page-settings', 'bp_core_add_contextual_help' );&nbsp;</div></li><li><div>add_action( 'load-settings_page_bp-settings', 'bp_core_add_contextual_help' );&nbsp;</div></li><li><div>add_action( 'load-users_page_bp-profile-setup', 'bp_core_add_contextual_help' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Renders contextual help content to contextual help tabs.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $tab Current help content tab.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_add_contextual_help_content( $tab = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  switch ( $tab ) {&nbsp;</div></li><li><div>      case 'bp-comp-overview' :&nbsp;</div></li><li><div>          $retval = __( 'By default, all but four of the BuddyPress components are enabled. You can selectively enable or disable any of the components by using the form below. Your BuddyPress installation will continue to function. However, the features of the disabled components will no longer be accessible to anyone using the site.', 'buddypress' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'bp-page-overview' :&nbsp;</div></li><li><div>          $retval = __( 'BuddyPress Components use WordPress Pages for their root directory/archive pages. You can change the page associations for each active component by using the form below.', 'buddypress' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'bp-settings-overview' :&nbsp;</div></li><li><div>          $retval = __( 'Extra configuration settings are provided and activated. You can selectively enable or disable any setting by using the form on this screen.', 'buddypress' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      case 'bp-profile-overview' :&nbsp;</div></li><li><div>          $retval = __( 'Your users will distinguish themselves through their profile page. Create relevant profile fields that will show on each users profile.', 'buddypress' ) . '&lt;br /&gt;&lt;br /&gt;' . __( 'Note: Any fields in the first group will appear on the signup page.', 'buddypress' );&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      default:&nbsp;</div></li><li><div>          $retval = false;&nbsp;</div></li><li><div>          break;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Wrap text in a paragraph tag.</span>&nbsp;</div></li><li><div>  if ( !empty( $retval ) ) {&nbsp;</div></li><li><div>      $retval = '&lt;p&gt;' . $retval . '&lt;/p&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $retval;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Separator *****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add a separator to the WordPress admin menus.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_admin_separator() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if BuddyPress is not network activated and viewing network admin.</span>&nbsp;</div></li><li><div>  if ( is_network_admin() && ! bp_is_network_activated() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if BuddyPress is network activated and viewing site admin.</span>&nbsp;</div></li><li><div>  if ( ! is_network_admin() && bp_is_network_activated() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Prevent duplicate separators when no core menu items exist.</span>&nbsp;</div></li><li><div>  if ( ! bp_current_user_can( 'bp_moderate' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if there are no components with admin UI's. Hardcoded for now, until</span>&nbsp;</div></li><li><div>  <span class="comment">// there's a real API for determining this later.</span>&nbsp;</div></li><li><div>  if ( ! bp_is_active( 'activity' ) && ! bp_is_active( 'groups' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $menu;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $menu[] = array( '', 'read', 'separator-buddypress', '', 'wp-menu-separator buddypress' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Tell WordPress we have a custom menu order.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool $menu_order Menu order.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool Always true.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_admin_custom_menu_order( $menu_order = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Bail if user cannot see admin pages.</span></span>&nbsp;</div></li><li><div>  if ( ! bp_current_user_can( 'bp_moderate' ) ) {&nbsp;</div></li><li><div>      return $menu_order;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return true;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Move our custom separator above our custom post types.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $menu_order Menu Order.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Modified menu order.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_admin_menu_order( $menu_order = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Bail if user cannot see admin pages.</span></span>&nbsp;</div></li><li><div>  if ( empty( $menu_order ) || ! bp_current_user_can( 'bp_moderate' ) ) {&nbsp;</div></li><li><div>      return $menu_order;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Initialize our custom order array.</span>&nbsp;</div></li><li><div>  $bp_menu_order = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Menu values.</span>&nbsp;</div></li><li><div>  $last_sep = is_network_admin() ? 'separator1' : 'separator2';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the custom admin menus.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $value Empty array.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $custom_menus = (array) apply_filters( 'bp_admin_menu_order', array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if no components have top level admin pages.</span>&nbsp;</div></li><li><div>  if ( empty( $custom_menus ) ) {&nbsp;</div></li><li><div>      return $menu_order;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add our separator to beginning of array.</span>&nbsp;</div></li><li><div>  array_unshift( $custom_menus, 'separator-buddypress' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Loop through menu order and do some rearranging.</span>&nbsp;</div></li><li><div>  foreach ( (array) $menu_order as $item ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Position BuddyPress menus above appearance.</span>&nbsp;</div></li><li><div>      if ( $last_sep == $item ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Add our custom menus.</span>&nbsp;</div></li><li><div>          foreach( (array) $custom_menus as $custom_menu ) {&nbsp;</div></li><li><div>              if ( array_search( $custom_menu, $menu_order ) ) {&nbsp;</div></li><li><div>                  $bp_menu_order[] = $custom_menu;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Add the appearance separator.</span>&nbsp;</div></li><li><div>          $bp_menu_order[] = $last_sep;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Skip our menu items.</span>&nbsp;</div></li><li><div>      } elseif ( ! in_array( $item, $custom_menus ) ) {&nbsp;</div></li><li><div>          $bp_menu_order[] = $item;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Return our custom order.</span>&nbsp;</div></li><li><div>  return $bp_menu_order;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Utility  *****************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * When using a WP_List_Table, get the currently selected bulk action.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * WP_List_Tables have bulk actions at the top and at the bottom of the tables, </span>&nbsp;</div></li><li><div><span class="comment"> * and the inputs have different keys in the $_REQUEST array. This function</span>&nbsp;</div></li><li><div><span class="comment"> * reconciles the two values and returns a single action being performed.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_admin_list_table_current_bulk_action() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $action = ! empty( $_REQUEST['action'] ) ? $_REQUEST['action'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the bottom is set, let it override the action.</span>&nbsp;</div></li><li><div>  if ( ! empty( $_REQUEST['action2'] ) && $_REQUEST['action2'] != &quot;-1&quot; ) {&nbsp;</div></li><li><div>      $action = $_REQUEST['action2'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $action;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Menus *********************************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register meta box and associated JS for BuddyPress WP Nav Menu.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.9.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_admin_wp_nav_menu_meta_box() {&nbsp;</div></li><li><div>  if ( ! bp_is_root_blog() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_meta_box( 'add-buddypress-nav-menu', __( 'BuddyPress', 'buddypress' ), 'bp_admin_do_wp_nav_menu_meta_box', 'nav-menus', 'side', 'default' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  add_action( 'admin_print_footer_scripts', 'bp_admin_wp_nav_menu_restrict_items' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Build and populate the BuddyPress accordion on Appearance &gt; Menus.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.9.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global $nav_menu_selected_id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_admin_do_wp_nav_menu_meta_box() {&nbsp;</div></li><li><div>  global $nav_menu_selected_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $walker = new BP_Walker_Nav_Menu_Checklist( false );&nbsp;</div></li><li><div>  $args = array( 'walker' =&gt; $walker );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $post_type_name = 'buddypress';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tabs = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tabs['loggedin']['label'] = __( 'Logged-In', 'buddypress' );&nbsp;</div></li><li><div>  $tabs['loggedin']['pages'] = bp_nav_menu_get_loggedin_pages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tabs['loggedout']['label'] = __( 'Logged-Out', 'buddypress' );&nbsp;</div></li><li><div>  $tabs['loggedout']['pages'] = bp_nav_menu_get_loggedout_pages();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div id=&quot;buddypress-menu&quot; class=&quot;posttypediv&quot;&gt;&nbsp;</div></li><li><div>      &lt;h4&gt;&lt;?php _e( 'Logged-In', 'buddypress' ) ?&gt;&lt;/h4&gt;&nbsp;</div></li><li><div>      &lt;p&gt;&lt;?php _e( '&lt;em&gt;Logged-In&lt;/em&gt; links are relative to the current user, and are not visible to visitors who are not logged in.', 'buddypress' ) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;div id=&quot;tabs-panel-posttype-&lt;?php echo $post_type_name; ?&gt;-loggedin&quot; class=&quot;tabs-panel tabs-panel-active&quot;&gt;&nbsp;</div></li><li><div>          &lt;ul id=&quot;buddypress-menu-checklist-loggedin&quot; class=&quot;categorychecklist form-no-clear&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php echo walk_nav_menu_tree( array_map( 'wp_setup_nav_menu_item', $tabs['loggedin']['pages'] ), 0, (object) $args );?&gt;&nbsp;</div></li><li><div>          &lt;/ul&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;h4&gt;&lt;?php _e( 'Logged-Out', 'buddypress' ) ?&gt;&lt;/h4&gt;&nbsp;</div></li><li><div>      &lt;p&gt;&lt;?php _e( '&lt;em&gt;Logged-Out&lt;/em&gt; links are not visible to users who are logged in.', 'buddypress' ) ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;div id=&quot;tabs-panel-posttype-&lt;?php echo $post_type_name; ?&gt;-loggedout&quot; class=&quot;tabs-panel tabs-panel-active&quot;&gt;&nbsp;</div></li><li><div>          &lt;ul id=&quot;buddypress-menu-checklist-loggedout&quot; class=&quot;categorychecklist form-no-clear&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php echo walk_nav_menu_tree( array_map( 'wp_setup_nav_menu_item', $tabs['loggedout']['pages'] ), 0, (object) $args );?&gt;&nbsp;</div></li><li><div>          &lt;/ul&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      $removed_args = array(&nbsp;</div></li><li><div>          'action', &nbsp;</div></li><li><div>          'customlink-tab', &nbsp;</div></li><li><div>          'edit-menu-item', &nbsp;</div></li><li><div>          'menu-item', &nbsp;</div></li><li><div>          'page-tab', &nbsp;</div></li><li><div>          '_wpnonce', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;p class=&quot;button-controls&quot;&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;list-controls&quot;&gt;&nbsp;</div></li><li><div>              &lt;a href=&quot;&lt;?php&nbsp;</div></li><li><div>              echo esc_url( add_query_arg(&nbsp;</div></li><li><div>                  array(&nbsp;</div></li><li><div>                      $post_type_name . '-tab' =&gt; 'all', &nbsp;</div></li><li><div>                      'selectall' =&gt; 1, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                  remove_query_arg( $removed_args )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>              ?&gt;#buddypress-menu&quot; class=&quot;select-all&quot;&gt;&lt;?php _e( 'Select All', 'buddypress' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>          &lt;/span&gt;&nbsp;</div></li><li><div>          &lt;span class=&quot;add-to-menu&quot;&gt;&nbsp;</div></li><li><div>              &lt;input type=&quot;submit&quot;&lt;?php if ( function_exists( 'wp_nav_menu_disabled_check' ) ) : wp_nav_menu_disabled_check( $nav_menu_selected_id ); endif; ?&gt; class=&quot;button-secondary submit-add-to-menu right&quot; value=&quot;&lt;?php esc_attr_e( 'Add to Menu', 'buddypress' ); ?&gt;&quot; name=&quot;add-custom-menu-item&quot; id=&quot;submit-buddypress-menu&quot; /&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;spinner&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;/span&gt;&nbsp;</div></li><li><div>      &lt;/p&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&lt;!-- /#buddypress-menu --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * In admin emails list, for non-en_US locales, add notice explaining how to reinstall emails.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If BuddyPress installs before its translations are in place, tell people how to reinstall</span>&nbsp;</div></li><li><div><span class="comment"> * the emails so they have their contents in their site's language.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_admin_email_maybe_add_translation_notice() {&nbsp;</div></li><li><div>  if ( get_current_screen()-&gt;post_type !== bp_get_email_post_type() || get_locale() === 'en_US' ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If user can't access BP Tools, there's no point showing the message.</span>&nbsp;</div></li><li><div>  if ( ! current_user_can( buddypress()-&gt;admin-&gt;capability ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_core_do_network_admin() ) {&nbsp;</div></li><li><div>      $admin_page = 'admin.php';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $admin_page = 'tools.php';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bp_core_add_admin_notice(&nbsp;</div></li><li><div>      sprintf(&nbsp;</div></li><li><div>          __( 'Are your emails in the wrong language? Go to &lt;a href=&quot;%s&quot;&gt;BuddyPress Tools and run the &quot;reinstall emails&quot;&lt;/a&gt; tool.', 'buddypress' ), &nbsp;</div></li><li><div>          esc_url( add_query_arg( 'page', 'bp-tools', bp_get_admin_url( $admin_page ) ) )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'updated'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'admin_head-edit.php', 'bp_admin_email_maybe_add_translation_notice' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * In emails editor, add notice linking to token documentation on Codex.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_admin_email_add_codex_notice() {&nbsp;</div></li><li><div>  if ( get_current_screen()-&gt;post_type !== bp_get_email_post_type() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bp_core_add_admin_notice(&nbsp;</div></li><li><div>      sprintf(&nbsp;</div></li><li><div>          __( 'Phrases wrapped in braces &lt;code&gt;{{ }}&lt;/code&gt; are email tokens. &lt;a href=&quot;%s&quot;&gt;Learn about tokens on the BuddyPress Codex&lt;/a&gt;.', 'buddypress' ), &nbsp;</div></li><li><div>          esc_url( 'https:<span class="comment">//codex.buddypress.org/emails/email-tokens/' )</span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'error'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'admin_head-post.php', 'bp_admin_email_add_codex_notice' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display metabox for email taxonomy type.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Shows the term description in a list, rather than the term name itself.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Post $post Post object.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array   $box {</span>&nbsp;</div></li><li><div><span class="comment"> *     Tags meta box arguments.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $id       Meta box ID.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type string   $title    Meta box title.</span>&nbsp;</div></li><li><div><span class="comment"> *     @type callable $callback Meta box display callback.</span>&nbsp;</div></li><li><div><span class="comment"> * }</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_email_tax_type_metabox( $post, $box ) {&nbsp;</div></li><li><div>  $r = array(&nbsp;</div></li><li><div>      'taxonomy' =&gt; bp_get_email_tax_type()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $tax_name = esc_attr( $r['taxonomy'] );&nbsp;</div></li><li><div>  $taxonomy = get_taxonomy( $r['taxonomy'] );&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;div id=&quot;taxonomy-&lt;?php echo $tax_name; ?&gt;&quot; class=&quot;categorydiv&quot;&gt;&nbsp;</div></li><li><div>      &lt;div id=&quot;&lt;?php echo $tax_name; ?&gt;-all&quot; class=&quot;tabs-panel&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          $name = ( $tax_name == 'category' ) ? 'post_category' : 'tax_input[' . $tax_name . ']';&nbsp;</div></li><li><div>          echo &quot;&lt;input type='hidden' name='{$name}[]' value='0' /&gt;&quot;; <span class="comment">// Allows for an empty term set to be sent. 0 is an invalid Term ID and will be ignored by empty() checks.</span>&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;ul id=&quot;&lt;?php echo $tax_name; ?&gt;checklist&quot; data-wp-lists=&quot;list:&lt;?php echo $tax_name; ?&gt;&quot; class=&quot;categorychecklist form-no-clear&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php wp_terms_checklist( $post-&gt;ID, array( 'taxonomy' =&gt; $tax_name, 'walker' =&gt; new BP_Walker_Category_Checklist ) ); ?&gt;&nbsp;</div></li><li><div>          &lt;/ul&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;p&gt;&lt;?php esc_html_e( 'Choose when this email will be sent.', 'buddypress' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Custom metaboxes used by our 'bp-email' post type.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_email_custom_metaboxes() {&nbsp;</div></li><li><div>  <span class="comment">// Remove default 'Excerpt' metabox and replace with our own.</span>&nbsp;</div></li><li><div>  remove_meta_box( 'postexcerpt', null, 'normal' );&nbsp;</div></li><li><div>  add_meta_box( 'postexcerpt', __( 'Plain text email content', 'buddypress' ), 'bp_email_plaintext_metabox', null, 'normal', 'high' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'add_meta_boxes_' . bp_get_email_post_type(), 'bp_email_custom_metaboxes' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Customized version of the 'Excerpt' metabox for our 'bp-email' post type.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * We are using the 'Excerpt' metabox as our plain-text email content editor.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Post $post</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_email_plaintext_metabox( $post ) {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;label class=&quot;screen-reader-text&quot; for=&quot;excerpt&quot;&gt;&lt;?php&nbsp;</div></li><li><div>      <span class="comment">/** translators: accessibility text */</span>&nbsp;</div></li><li><div>      _e( 'Plain text email content', 'buddypress' );&nbsp;</div></li><li><div>  ?&gt;&lt;/label&gt;&lt;textarea rows=&quot;5&quot; cols=&quot;40&quot; name=&quot;excerpt&quot; id=&quot;excerpt&quot;&gt;&lt;?php echo $post-&gt;post_excerpt; <span class="comment">// textarea_escaped ?&gt;&lt;/textarea&gt;</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php _e( 'Most email clients support HTML email. However, some people prefer to receive plain text email. Enter a plain text alternative version of your email here.', 'buddypress' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Restrict various items from view if editing a BuddyPress menu.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * If a person is editing a BP menu item, that person should not be able to</span>&nbsp;</div></li><li><div><span class="comment"> * see or edit the following fields:</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * - CSS Classes - We use the 'bp-menu' CSS class to determine if the</span>&nbsp;</div></li><li><div><span class="comment"> *   menu item belongs to BP, so we cannot allow manipulation of this field to</span>&nbsp;</div></li><li><div><span class="comment"> *   occur.</span>&nbsp;</div></li><li><div><span class="comment"> * - URL - This field is automatically generated by BP on output, so this</span>&nbsp;</div></li><li><div><span class="comment"> *   field is useless and can cause confusion.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Note: These restrictions are only enforced if JavaScript is enabled.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.9.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_admin_wp_nav_menu_restrict_items() {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>  &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>  jQuery( '#menu-to-edit').on( 'click', 'a.item-edit', function() {&nbsp;</div></li><li><div>      var settings = jQuery(this).closest( '.menu-item-bar' ).next( '.menu-item-settings' );&nbsp;</div></li><li><div>      var css_class = settings.find( '.edit-menu-item-classes' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( css_class.val().indexOf( 'bp-menu' ) === 0 ) {&nbsp;</div></li><li><div>          css_class.attr( 'readonly', 'readonly' );&nbsp;</div></li><li><div>          settings.find( '.field-url' ).css( 'display', 'none' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  });&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add &quot;Mark as Spam/Ham&quot; button to user row actions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $actions     User row action links.</span>&nbsp;</div></li><li><div><span class="comment"> * @param object $user_object Current user information.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $actions User row action links.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_admin_user_row_actions( $actions, $user_object ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Setup the $user_id variable from the current user object.</span>&nbsp;</div></li><li><div>  $user_id = 0;&nbsp;</div></li><li><div>  if ( !empty( $user_object-&gt;ID ) ) {&nbsp;</div></li><li><div>      $user_id = absint( $user_object-&gt;ID );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail early if user cannot perform this action, or is looking at themselves.</span>&nbsp;</div></li><li><div>  if ( current_user_can( 'edit_user', $user_id ) && ( bp_loggedin_user_id() !== $user_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Admin URL could be single site or network.</span>&nbsp;</div></li><li><div>      $url = bp_get_admin_url( 'users.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If spammed, create unspam link.</span>&nbsp;</div></li><li><div>      if ( bp_is_user_spammer( $user_id ) ) {&nbsp;</div></li><li><div>          $url = add_query_arg( array( 'action' =&gt; 'ham', 'user' =&gt; $user_id ), $url );&nbsp;</div></li><li><div>          $unspam_link = wp_nonce_url( $url, 'bp-spam-user' );&nbsp;</div></li><li><div>          $actions['ham'] = sprintf( '&lt;a href=&quot;%1$s&quot;&gt;%2$s&lt;/a&gt;', esc_url( $unspam_link ), esc_html__( 'Not Spam', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If not already spammed, create spam link.</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $url = add_query_arg( array( 'action' =&gt; 'spam', 'user' =&gt; $user_id ), $url );&nbsp;</div></li><li><div>          $spam_link = wp_nonce_url( $url, 'bp-spam-user' );&nbsp;</div></li><li><div>          $actions['spam'] = sprintf( '&lt;a class=&quot;submitdelete&quot; href=&quot;%1$s&quot;&gt;%2$s&lt;/a&gt;', esc_url( $spam_link ), esc_html__( 'Spam', 'buddypress' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Create a &quot;View&quot; link.</span>&nbsp;</div></li><li><div>  $url = bp_core_get_user_domain( $user_id );&nbsp;</div></li><li><div>  $actions['view'] = sprintf( '&lt;a href=&quot;%1$s&quot;&gt;%2$s&lt;/a&gt;', esc_url( $url ), esc_html__( 'View', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Return new actions.</span>&nbsp;</div></li><li><div>  return $actions;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Catch requests to mark individual users as spam/ham from users.php.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_admin_user_manage_spammers() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Print our inline scripts on non-Multisite.</span>&nbsp;</div></li><li><div>  add_action( 'admin_footer', 'bp_core_admin_user_spammed_js' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $action = isset( $_REQUEST['action'] ) ? $_REQUEST['action'] : false;&nbsp;</div></li><li><div>  $updated = isset( $_REQUEST['updated'] ) ? $_REQUEST['updated'] : false;&nbsp;</div></li><li><div>  $mode = isset( $_POST['mode'] ) ? $_POST['mode'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If this is a multisite, bulk request, stop now!</span>&nbsp;</div></li><li><div>  if ( 'list' == $mode ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Process a spam/ham request.</span>&nbsp;</div></li><li><div>  if ( ! empty( $action ) && in_array( $action, array( 'spam', 'ham' ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      check_admin_referer( 'bp-spam-user' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $user_id = ! empty( $_REQUEST['user'] ) ? intval( $_REQUEST['user'] ) : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $user_id ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $redirect = wp_get_referer();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $status = ( $action == 'spam' ) ? 'spam' : 'ham';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Process the user.</span>&nbsp;</div></li><li><div>      bp_core_process_spammer_status( $user_id, $status );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $redirect = add_query_arg( array( 'updated' =&gt; 'marked-' . $status ), $redirect );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_redirect( $redirect );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Display feedback.</span>&nbsp;</div></li><li><div>  if ( ! empty( $updated ) && in_array( $updated, array( 'marked-spam', 'marked-ham' ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'marked-spam' === $updated ) {&nbsp;</div></li><li><div>          $notice = __( 'User marked as spammer. Spam users are visible only to site admins.', 'buddypress' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $notice = __( 'User removed from spam.', 'buddypress' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_core_add_admin_notice( $notice );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Inline script that adds the 'site-spammed' class to spammed users.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_admin_user_spammed_js() {&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>  &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>      jQuery( document ).ready( function($) {&nbsp;</div></li><li><div>          $( '.row-actions .ham' ).each( function() {&nbsp;</div></li><li><div>              $( this ).closest( 'tr' ).addClass( 'site-spammed' );&nbsp;</div></li><li><div>          });&nbsp;</div></li><li><div>      });&nbsp;</div></li><li><div>  &lt;/script&gt;&nbsp;</div></li><li><div>  &lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Catch and process an admin notice dismissal.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_admin_notice_dismiss_callback() {&nbsp;</div></li><li><div>  if ( ! current_user_can( 'install_plugins' ) ) {&nbsp;</div></li><li><div>      wp_send_json_error();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $_POST['nonce'] ) || empty( $_POST['notice_id'] ) ) {&nbsp;</div></li><li><div>      wp_send_json_error();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $notice_id = wp_unslash( $_POST['notice_id'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! wp_verify_nonce( $_POST['nonce'], 'bp-dismissible-notice-' . $notice_id ) ) {&nbsp;</div></li><li><div>      wp_send_json_error();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bp_update_option( &quot;bp-dismissed-notice-$notice_id&quot;, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_send_json_success();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'wp_ajax_bp_dismiss_notice', 'bp_core_admin_notice_dismiss_callback' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add a &quot;buddypress&quot; class to body element of wp-admin.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $classes CSS classes for the body tag in the admin, a comma separated string.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_core_admin_body_classes( $classes ) {&nbsp;</div></li><li><div>  return $classes . ' buddypress';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'admin_body_class', 'bp_core_admin_body_classes' );&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>