<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.8.2" data-slug="buddypress" data-type="file" data-id="49038"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-core-bp-core-template-loader | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.8.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.24"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=200003937411a8ddaad4e7e691e510c6' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.24' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-core-bp-core-template-loader/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-core-bp-core-template-loader%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-core-bp-core-template-loader%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.2-file-bp-core-bp-core-template-loader","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-core-bp-core-template-loader" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.8.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-core-bp-core-template-load&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.2/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.2/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.2/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.2/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-core/bp-core-template-loader.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * BuddyPress Template Functions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This file contains functions necessary to mirror the WordPress core template</span>&nbsp;</div></li><li><div><span class="comment"> * loading process. Many of those functions are not filterable, and even then</span>&nbsp;</div></li><li><div><span class="comment"> * would not be robust enough to predict where BuddyPress templates might exist.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BuddyPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage TemplateFunctions</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly.</span>&nbsp;</div></li><li><div>defined( 'ABSPATH' ) || exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get a BuddyPress template part for display in a theme.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $slug Template part slug. Used to generate filenames, </span>&nbsp;</div></li><li><div><span class="comment"> *                          eg 'friends' for 'friends.php'.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|null $name Optional. Template part name. Used to generate</span>&nbsp;</div></li><li><div><span class="comment"> *                          secondary filenames, eg 'personal' for 'activity-personal.php'.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Path to located template. See {@link bp_locate_template()}.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_get_template_part( $slug, $name = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires at the start of bp_get_template_part().</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This is a variable hook that is dependent on the slug passed in.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $slug Template part slug requested.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name Template part name requested.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'get_template_part_' . $slug, $slug, $name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Setup possible parts.</span>&nbsp;</div></li><li><div>  $templates = array();&nbsp;</div></li><li><div>  if ( isset( $name ) ) {&nbsp;</div></li><li><div>      $templates[] = $slug . '-' . $name . '.php';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $templates[] = $slug . '.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template parts to be loaded.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array  $templates Array of templates located.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $slug      Template part slug requested.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $name      Template part name requested.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $templates = apply_filters( 'bp_get_template_part', $templates, $slug, $name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Return the part that is found.</span>&nbsp;</div></li><li><div>  return bp_locate_template( $templates, true, false );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get an asset template part.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Basically the same as {@link bp_get_template_part()}, but with 'assets/'</span>&nbsp;</div></li><li><div><span class="comment"> * prepended to the slug.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see bp_get_template_part() for full documentation.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $slug Template slug.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|null $name Template name.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_get_asset_template_part( $slug, $name = null ) {&nbsp;</div></li><li><div>  return bp_get_template_part( &quot;assets/{$slug}&quot;, $name );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve the name of the highest priority template file that exists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Searches in the STYLESHEETPATH before TEMPLATEPATH so that themes which</span>&nbsp;</div></li><li><div><span class="comment"> * inherit from a parent theme can just overload one file. If the template is</span>&nbsp;</div></li><li><div><span class="comment"> * not found in either of those, it looks in the theme-compat folder last.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|array $template_names Template file(s) to search for, in order.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $load           Optional. If true, the template file will be loaded when</span>&nbsp;</div></li><li><div><span class="comment"> *                                     found. If false, the path will be returned. Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool         $require_once   Optional. Whether to require_once or require. Has</span>&nbsp;</div></li><li><div><span class="comment"> *                                     no effect if $load is false. Default: true.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The template filename if one is located.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_locate_template( $template_names, $load = false, $require_once = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail when there are no templates to locate</span>&nbsp;</div></li><li><div>  if ( empty( $template_names ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// No file found yet.</span>&nbsp;</div></li><li><div>  $located = false;&nbsp;</div></li><li><div>  $template_locations = bp_get_template_stack();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Try to find a template file.</span>&nbsp;</div></li><li><div>  foreach ( (array) $template_names as $template_name ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Continue if template is empty.</span>&nbsp;</div></li><li><div>      if ( empty( $template_name ) ) {&nbsp;</div></li><li><div>          continue;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Trim off any slashes from the template name.</span>&nbsp;</div></li><li><div>      $template_name = ltrim( $template_name, '/' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Loop through template stack.</span>&nbsp;</div></li><li><div>      foreach ( (array) $template_locations as $template_location ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Continue if $template_location is empty.</span>&nbsp;</div></li><li><div>          if ( empty( $template_location ) ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Check child theme first.</span>&nbsp;</div></li><li><div>          if ( file_exists( trailingslashit( $template_location ) . $template_name ) ) {&nbsp;</div></li><li><div>              $located = trailingslashit( $template_location ) . $template_name;&nbsp;</div></li><li><div>              break 2;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This action exists only to follow the standard BuddyPress coding convention, </span>&nbsp;</div></li><li><div><span class="comment">   * and should not be used to short-circuit any part of the template locator.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * If you want to override a specific template part, please either filter</span>&nbsp;</div></li><li><div><span class="comment">   * 'bp_get_template_part' or add a new location to the template stack.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bp_locate_template', $located, $template_name, $template_names, $template_locations, $load, $require_once );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filter here to allow/disallow template loading.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $value True to load the template, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $load_template = (bool) apply_filters( 'bp_locate_template_and_load', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $load_template && $load && ! empty( $located ) ) {&nbsp;</div></li><li><div>      load_template( $located, $require_once );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $located;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get file data of the highest priority asset that exists.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Similar to {@link bp_locate_template()}, but for files like CSS and JS.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $filename Relative filename to search for.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array|bool Array of asset data if one is located (includes absolute filepath and URI).</span>&nbsp;</div></li><li><div><span class="comment"> *                    Boolean false on failure.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_locate_template_asset( $filename ) {&nbsp;</div></li><li><div>  <span class="comment">// Ensure assets can be located when running from /src/.</span>&nbsp;</div></li><li><div>  if ( defined( 'BP_SOURCE_SUBDIRECTORY' ) && 'src' === BP_SOURCE_SUBDIRECTORY ) {&nbsp;</div></li><li><div>      $filename = str_replace( '.min', '', $filename );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Use bp_locate_template() to find our asset.</span>&nbsp;</div></li><li><div>  $located = bp_locate_template( $filename, false );&nbsp;</div></li><li><div>  if ( false === $located ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set up data array.</span>&nbsp;</div></li><li><div>  $data = array();&nbsp;</div></li><li><div>  $data['file'] = $data['uri'] = $located;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $find = array(&nbsp;</div></li><li><div>      get_theme_root(), &nbsp;</div></li><li><div>      bp_get_theme_compat_dir()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $replace = array(&nbsp;</div></li><li><div>      get_theme_root_uri(), &nbsp;</div></li><li><div>      bp_get_theme_compat_url()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Make sure URI path is relative to site URL.</span>&nbsp;</div></li><li><div>  $data['uri'] = str_replace( $find, $replace, $data['uri'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $data;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register a new template stack location.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * This allows for templates to live in places beyond just the parent/child</span>&nbsp;</div></li><li><div><span class="comment"> * relationship, to allow for custom template locations. Used in conjunction</span>&nbsp;</div></li><li><div><span class="comment"> * with bp_locate_template(), this allows for easy template overrides.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $location_callback Callback function that returns the stack location.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $priority          Optional. The priority parameter as passed to</span>&nbsp;</div></li><li><div><span class="comment"> *                                  add_filter(). Default: 10.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool See {@link add_filter()}.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_register_template_stack( $location_callback = '', $priority = 10 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Bail if no location, or function/method is not callable.</span></span>&nbsp;</div></li><li><div>  if ( empty( $location_callback ) || ! is_callable( $location_callback ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Add location callback to template stack.</span></span>&nbsp;</div></li><li><div>  return add_filter( 'bp_template_stack', $location_callback, (int) $priority );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Deregister a previously registered template stack location.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see bp_register_template_stack()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $location_callback Callback function that returns the stack location.</span>&nbsp;</div></li><li><div><span class="comment"> * @param int    $priority          Optional. The priority parameter passed to</span>&nbsp;</div></li><li><div><span class="comment"> *                                  {@link bp_register_template_stack()}. Default: 10.</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool See {@link remove_filter()}.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_deregister_template_stack( $location_callback = '', $priority = 10 ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Bail if no location, or function/method is not callable.</span></span>&nbsp;</div></li><li><div>  if ( empty( $location_callback ) || ! is_callable( $location_callback ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Add location callback to template stack.</span></span>&nbsp;</div></li><li><div>  return remove_filter( 'bp_template_stack', $location_callback, (int) $priority );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the &quot;template stack&quot;, a list of registered directories where templates can be found.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Calls the functions added to the 'bp_template_stack' filter hook, and return</span>&nbsp;</div></li><li><div><span class="comment"> * an array of the template locations.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see bp_register_template_stack()</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_filter         Stores all of the filters.</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $merged_filters    Merges the filter hooks using this function.</span>&nbsp;</div></li><li><div><span class="comment"> * @global array $wp_current_filter Stores the list of current filters with</span>&nbsp;</div></li><li><div><span class="comment"> *                                  the current one last.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array The filtered value after all hooked functions are applied to it.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_get_template_stack() {&nbsp;</div></li><li><div>  global $wp_filter, $merged_filters, $wp_current_filter;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Setup some default variables.</span>&nbsp;</div></li><li><div>  $tag = 'bp_template_stack';&nbsp;</div></li><li><div>  $args = $stack = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add 'bp_template_stack' to the current filter array.</span>&nbsp;</div></li><li><div>  $wp_current_filter[] = $tag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Sort.</span>&nbsp;</div></li><li><div>  if ( class_exists( 'WP_Hook' ) ) {&nbsp;</div></li><li><div>      $filter = $wp_filter[ $tag ]-&gt;callbacks;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $filter = &$wp_filter[ $tag ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $merged_filters[ $tag ] ) ) {&nbsp;</div></li><li><div>          ksort( $filter );&nbsp;</div></li><li><div>          $merged_filters[ $tag ] = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Ensure we're always at the beginning of the filter array.</span>&nbsp;</div></li><li><div>  reset( $filter );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Loop through 'bp_template_stack' filters, and call callback functions.</span>&nbsp;</div></li><li><div>  do {&nbsp;</div></li><li><div>      foreach( (array) current( $filter ) as $the_ ) {&nbsp;</div></li><li><div>          if ( ! is_null( $the_['function'] ) ) {&nbsp;</div></li><li><div>              $args[1] = $stack;&nbsp;</div></li><li><div>              $stack[] = call_user_func_array( $the_['function'], array_slice( $args, 1, (int) $the_['accepted_args'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } while ( next( $filter ) !== false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Remove 'bp_template_stack' from the current filter array.</span>&nbsp;</div></li><li><div>  array_pop( $wp_current_filter );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Remove empties and duplicates.</span>&nbsp;</div></li><li><div>  $stack = array_unique( array_filter( $stack ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the &quot;template stack&quot; list of registered directories where templates can be found.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $stack Array of registered directories for template locations.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return (array) apply_filters( 'bp_get_template_stack', $stack ) ;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Put a template part into an output buffer, and return it.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @see bp_get_template_part() for a description of $slug and $name params.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string      $slug See {@link bp_get_template_part()}.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string|null $name See {@link bp_get_template_part()}.</span>&nbsp;</div></li><li><div><span class="comment"> * @param bool        $echo If true, template content will be echoed. If false, </span>&nbsp;</div></li><li><div><span class="comment"> *                          returned. Default: true.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string|null If $echo, returns the template content.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_buffer_template_part( $slug, $name = null, $echo = true ) {&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Remove 'bp_replace_the_content' filter to prevent infinite loops.</span></span>&nbsp;</div></li><li><div>  remove_filter( 'the_content', 'bp_replace_the_content' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bp_get_template_part( $slug, $name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Remove 'bp_replace_the_content' filter to prevent infinite loops.</span></span>&nbsp;</div></li><li><div>  add_filter( 'the_content', 'bp_replace_the_content' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get the output buffer contents.</span>&nbsp;</div></li><li><div>  $output = ob_get_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Echo or return the output buffer contents.</span>&nbsp;</div></li><li><div>  if ( true === $echo ) {&nbsp;</div></li><li><div>      echo $output;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return $output;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Retrieve the path to a template.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Used to quickly retrieve the path of a template without including the file</span>&nbsp;</div></li><li><div><span class="comment"> * extension. It will also check the parent theme and theme-compat theme with</span>&nbsp;</div></li><li><div><span class="comment"> * the use of {@link bp_locate_template()}. Allows for more generic template</span>&nbsp;</div></li><li><div><span class="comment"> * locations without the use of the other get_*_template() functions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $type      Filename without extension.</span>&nbsp;</div></li><li><div><span class="comment"> * @param array  $templates An optional list of template candidates.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Full path to file.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_get_query_template( $type, $templates = array() ) {&nbsp;</div></li><li><div>  $type = preg_replace( '|[^a-z0-9-]+|', '', $type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $templates ) ) {&nbsp;</div></li><li><div>      $templates = array( &quot;{$type}.php&quot; );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters possible file paths to check for for a template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This is a variable filter based on the type passed into</span>&nbsp;</div></li><li><div><span class="comment">   * bp_get_query_template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $templates Array of template files already prepared.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $templates = apply_filters( &quot;bp_get_{$type}_template&quot;, $templates );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Filter possible templates, try to match one, and set any BuddyPress theme</span>&nbsp;</div></li><li><div>  <span class="comment">// compat properties so they can be cross-checked later.</span>&nbsp;</div></li><li><div>  $templates = bp_set_theme_compat_templates( $templates );&nbsp;</div></li><li><div>  $template = bp_locate_template( $templates );&nbsp;</div></li><li><div>  $template = bp_set_theme_compat_template( $template );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the path to a template file.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This is a variable filter based on the type passed into</span>&nbsp;</div></li><li><div><span class="comment">   * bp_get_query_template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $template Path to the most appropriate found template file.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( &quot;bp_{$type}_template&quot;, $template );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the possible subdirectories to check for templates in.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $templates Templates we are looking for.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Possible subfolders to look in.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_get_template_locations( $templates = array() ) {&nbsp;</div></li><li><div>  $locations = array(&nbsp;</div></li><li><div>      'buddypress', &nbsp;</div></li><li><div>      'community', &nbsp;</div></li><li><div>      ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the possible subdirectories to check for templates in.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $locations Array of subfolders to look in.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $templates Array of templates we are looking for.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_get_template_locations', $locations, $templates );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add template locations to template files being searched for.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $stacks Array of template locations.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Array of all template locations registered so far.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_add_template_stack_locations( $stacks = array() ) {&nbsp;</div></li><li><div>  $retval = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get alternate locations.</span>&nbsp;</div></li><li><div>  $locations = bp_get_template_locations();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Loop through locations and stacks and combine.</span>&nbsp;</div></li><li><div>  foreach ( (array) $stacks as $stack ) {&nbsp;</div></li><li><div>      foreach ( (array) $locations as $custom_location ) {&nbsp;</div></li><li><div>          $retval[] = untrailingslashit( trailingslashit( $stack ) . $custom_location );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template locations to template files being searched for.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $value  Array of all template locations registered so far.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $stacks Array of template locations.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_add_template_stack_locations', array_unique( $retval ), $stacks );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add checks for BuddyPress conditions to 'parse_query' action.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Query $posts_query WP_Query object.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_parse_query( $posts_query ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if $posts_query is not the main loop.</span>&nbsp;</div></li><li><div>  if ( ! $posts_query-&gt;is_main_query() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if filters are suppressed on this query.</span>&nbsp;</div></li><li><div>  if ( true == $posts_query-&gt;get( 'suppress_filters' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Bail if in admin.</span>&nbsp;</div></li><li><div>  if ( is_admin() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires at the end of the bp_parse_query function.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Allow BuddyPress components to parse the main query.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Query $posts_query WP_Query instance. Passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action_ref_array( 'bp_parse_query', array( &$posts_query ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Possibly intercept the template being loaded.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Listens to the 'template_include' filter and waits for any BuddyPress specific</span>&nbsp;</div></li><li><div><span class="comment"> * template condition to be met. If one is met and the template file exists, </span>&nbsp;</div></li><li><div><span class="comment"> * it will be used; otherwise.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Note that the _edit() checks are ahead of their counterparts, to prevent them</span>&nbsp;</div></li><li><div><span class="comment"> * from being stomped on accident.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $template The path to the template file that is being used.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string The path to the template file that is being used.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_template_include_theme_supports( $template = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters whether or not to override the template being loaded in parent/child themes.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool   $value    Whether or not there is a file override. Default false.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $template The path to the template file that is being used.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $new_template = apply_filters( 'bp_get_root_template', false, $template );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// A BuddyPress template file was located, so override the WordPress</span>&nbsp;</div></li><li><div>  <span class="comment">// template and use it to switch off BuddyPress's theme compatibility.</span>&nbsp;</div></li><li><div>  if ( ! empty( $new_template ) ) {&nbsp;</div></li><li><div>      $template = bp_set_template_included( $new_template );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the final template being loaded in parent/child themes.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $template The path to the template file that is being used.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_template_include_theme_supports', $template );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Set the included template.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param mixed $template Default: false.</span>&nbsp;</div></li><li><div><span class="comment"> * @return mixed False if empty. Template name if template included.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_set_template_included( $template = false ) {&nbsp;</div></li><li><div>  buddypress()-&gt;theme_compat-&gt;found_template = $template;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return buddypress()-&gt;theme_compat-&gt;found_template;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Is a BuddyPress template being included?</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.8.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool True if yes, false if no.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_is_template_included() {&nbsp;</div></li><li><div>  return ! empty( buddypress()-&gt;theme_compat-&gt;found_template );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Attempt to load a custom BP functions file, similar to each themes functions.php file.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global string $pagenow</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_load_theme_functions() {&nbsp;</div></li><li><div>  global $pagenow, $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Do not load our custom BP functions file if theme compat is disabled.</span>&nbsp;</div></li><li><div>  if ( ! bp_use_theme_compat_with_current_theme() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Do not include on BuddyPress deactivation.</span>&nbsp;</div></li><li><div>  if ( bp_is_deactivation() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the $wp_query global is empty (the main query has not been run, </span>&nbsp;</div></li><li><div>  <span class="comment">// or has been reset), load_template() will fail at setting certain</span>&nbsp;</div></li><li><div>  <span class="comment">// global values. This does not happen on a normal page load, but can</span>&nbsp;</div></li><li><div>  <span class="comment">// cause problems when running automated tests.</span>&nbsp;</div></li><li><div>  if ( ! is_a( $wp_query, 'WP_Query' ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Only include if not installing or if activating via wp-activate.php.</span>&nbsp;</div></li><li><div>  if ( ! defined( 'WP_INSTALLING' ) || 'wp-activate.php' === $pagenow ) {&nbsp;</div></li><li><div>      bp_locate_template( 'buddypress-functions.php', true );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the templates to use as the endpoint for BuddyPress template parts.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.4.0 Added singular.php to stack</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Array of possible root level wrapper template files.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_get_theme_compat_templates() {&nbsp;</div></li><li><div>  return bp_get_query_template( 'buddypress', array(&nbsp;</div></li><li><div>      'plugin-buddypress.php', &nbsp;</div></li><li><div>      'buddypress.php', &nbsp;</div></li><li><div>      'community.php', &nbsp;</div></li><li><div>      'generic.php', &nbsp;</div></li><li><div>      'page.php', &nbsp;</div></li><li><div>      'single.php', &nbsp;</div></li><li><div>      'singular.php', &nbsp;</div></li><li><div>      'index.php'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>