<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="2.7.5" data-slug="buddypress" data-type="class" data-id="49562"><head xmlns="http://www.w3.org/1999/xhtml"><title> bpdb | class | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="BPDB, class, plugin, buddypress, 2.7.5" /><meta name="description" content="The BuddyPress BPDB class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.24"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=2e46f293b7632decaf2817710beb73aa' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.24' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/bpdb/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fbpdb%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fbpdb%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.7.5-class-bpdb","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bpdb" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.5." href="http://hookr.io/plugins/buddypress/2.7.5/" class="H_VERSION"><span property="name">2.7.5</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/buddypress/2.7.5/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bpdb</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="7768"><a href="http://hookr.io/plugins/buddypress/2.7.5/all/" title="All">All <span class="count badge">7768</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.7.5/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3600"><a href="http://hookr.io/plugins/buddypress/2.7.5/hooks/" title="Hooks">Hooks <span class="count badge">3600</span></a></li><li class="" data-id="action" data-count="1718"><a href="http://hookr.io/plugins/buddypress/2.7.5/actions/" title="Actions">Actions <span class="count badge">1718</span></a></li><li class="" data-id="filter" data-count="1882"><a href="http://hookr.io/plugins/buddypress/2.7.5/filters/" title="Filters">Filters <span class="count badge">1882</span></a></li><li class="active" data-id="class" data-count="178"><a href="http://hookr.io/plugins/buddypress/2.7.5/classes/" title="Classes">Classes <span class="count badge">178</span></a></li><li class="" data-id="constant" data-count="160"><a href="http://hookr.io/plugins/buddypress/2.7.5/constants/" title="Constants">Constants <span class="count badge">160</span></a></li><li class="" data-id="function" data-count="3830"><a href="http://hookr.io/plugins/buddypress/2.7.5/functions/" title="Functions">Functions <span class="count badge">3830</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.7.5/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>BPDB</strong></h1><p>The BuddyPress <strong>BPDB</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(2)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/buddypress/2.7.5/files/bp-forums-bbpress-bb-includes-backpress-class-bpdb/" class="file">/bp-forums/bbpress/bb-includes/backpress/class.bpdb.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="38" class="block" start="38"><li><div>class BPDB&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether to show SQL/DB errors&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $show_errors = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether to suppress errors during the DB bootstrapping.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $suppress_errors = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The last error during query.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $last_error = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Amount of queries made&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $num_queries = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The last query made&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $last_query = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saved info on the table column&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $col_info = array();&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saved queries that were executed&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $queries = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether to use the query log&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $save_queries = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Table prefix&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * You can set this to have multiple installations&nbsp;</div></li><li><div>     * in a single database. The second reason is for possible&nbsp;</div></li><li><div>     * security precautions.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $prefix = '';&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether the database queries are ready to start executing.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $ready = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The currently connected MySQL connection resource.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var bool|resource&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $dbh = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * List of tables&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access private&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $tables = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether to use mysql_real_escape_string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @access public&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    var $real_escape = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * PHP4 style constructor&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return unknown Returns the result of bpdb::__construct()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function BPDB()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $args = func_get_args();&nbsp;</div></li><li><div>        register_shutdown_function( array( &$this, '__destruct' ) );&nbsp;</div></li><li><div>        return call_user_func_array( array( &$this, '__construct' ), $args );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * PHP5 style constructor&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Grabs the arguments, calls bpdb::_init() and then connects to the database&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __construct()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $args = func_get_args();&nbsp;</div></li><li><div>        $args = call_user_func_array( array( &$this, '_init' ), $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;db_connect_host( $args );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initialises the class variables based on provided arguments&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args The provided connection settings&nbsp;</div></li><li><div>     * @return array The current connection settings after processing by init&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function _init( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( !extension_loaded( 'mysql' ) ) {&nbsp;</div></li><li><div>            $this-&gt;show_errors();&nbsp;</div></li><li><div>            $this-&gt;bail( BPDB__PHP_EXTENSION_MISSING );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 4 == func_num_args() ) {&nbsp;</div></li><li><div>            $args = array(&nbsp;</div></li><li><div>                'user' =&gt; $args, &nbsp;</div></li><li><div>                'password' =&gt; func_get_arg( 1 ), &nbsp;</div></li><li><div>                'name' =&gt; func_get_arg( 2 ), &nbsp;</div></li><li><div>                'host' =&gt; func_get_arg( 3 )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>            'user' =&gt; false, &nbsp;</div></li><li><div>            'password' =&gt; false, &nbsp;</div></li><li><div>            'name' =&gt; false, &nbsp;</div></li><li><div>            'host' =&gt; 'localhost', &nbsp;</div></li><li><div>            'charset' =&gt; false, &nbsp;</div></li><li><div>            'collate' =&gt; false, &nbsp;</div></li><li><div>            'errors' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $args['errors'] ) {&nbsp;</div></li><li><div>            case 'show' :&nbsp;</div></li><li><div>                $this-&gt;show_errors( true );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'suppress' :&nbsp;</div></li><li><div>                $this-&gt;suppress_errors( true );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $args;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * PHP5 style destructor, registered as shutdown function in PHP4&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Always returns true&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __destruct()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Figure out which database server should handle the query, and connect to it.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string query&nbsp;</div></li><li><div>     * @return resource mysql database connection&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function &db_connect( $query = '' )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $false = false;&nbsp;</div></li><li><div>        if ( empty( $query ) ) {&nbsp;</div></li><li><div>            return $false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $this-&gt;dbh;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Connects to the database server and selects a database&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array args&nbsp;</div></li><li><div>     *    name =&gt; string DB name (required)&nbsp;</div></li><li><div>     *    user =&gt; string DB user (optional: false)&nbsp;</div></li><li><div>     *    password =&gt; string DB user password (optional: false)&nbsp;</div></li><li><div>     *    host =&gt; string DB hostname (optional: 'localhost')&nbsp;</div></li><li><div>     *    charset =&gt; string DB default charset.  Used in a SET NAMES query. (optional)&nbsp;</div></li><li><div>     *    collate =&gt; string DB default collation.  If charset supplied, optionally added to the SET NAMES query (optional)&nbsp;</div></li><li><div>     * @return void|bool void if cannot connect, false if cannot select, true if success&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function db_connect_host( $args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        extract( $args, EXTR_SKIP );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        unset( $this-&gt;dbh ); // De-reference before re-assigning&nbsp;</div></li><li><div>        $this-&gt;dbh = @mysql_connect( $host, $user, $password, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$this-&gt;dbh ) {&nbsp;</div></li><li><div>            if ( !$this-&gt;suppress_errors ) {&nbsp;</div></li><li><div>                $this-&gt;show_errors();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;bail( BPDB__CONNECT_ERROR_MESSAGE );&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;ready = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;has_cap( 'collation' ) ) {&nbsp;</div></li><li><div>            if ( !empty( $charset ) ) {&nbsp;</div></li><li><div>                if ( function_exists( 'mysql_set_charset' ) ) {&nbsp;</div></li><li><div>                    mysql_set_charset( $charset, $this-&gt;dbh );&nbsp;</div></li><li><div>                    $this-&gt;real_escape = true;&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $collation_query = &quot;SET NAMES '{$charset}'&quot;;&nbsp;</div></li><li><div>                    if ( !empty( $collate ) ) {&nbsp;</div></li><li><div>                        $collation_query .= &quot; COLLATE '{$collate}'&quot;;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $this-&gt;query( $collation_query, true );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this-&gt;select( $name, $this-&gt;dbh );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the table prefix for the WordPress tables.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string prefix&nbsp;</div></li><li><div>     * @param false|array tables (optional: false)&nbsp;</div></li><li><div>     *    table identifiers are array keys&nbsp;</div></li><li><div>     *    array values&nbsp;</div></li><li><div>     *        empty: set prefix: array( 'posts' =&gt; false, 'users' =&gt; false, ... )&nbsp;</div></li><li><div>     *        string: set to that array value: array( 'posts' =&gt; 'my_posts', 'users' =&gt; 'my_users' )&nbsp;</div></li><li><div>     *    OR array values (with numeric keys): array( 'posts', 'users', ... )&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string the previous prefix (mostly only meaningful if all $table parameter was false)&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function set_prefix( $prefix, $tables = false )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( !$prefix ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( preg_match( '|[^a-z0-9_]|i', $prefix ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'invalid_db_prefix', 'Invalid database prefix' ); // No gettext here&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $old_prefix = $this-&gt;prefix;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $tables && is_array( $tables ) ) {&nbsp;</div></li><li><div>            $_tables =& $tables;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $_tables =& $this-&gt;tables;&nbsp;</div></li><li><div>            $this-&gt;prefix = $prefix;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $_tables as $key =&gt; $value ) {&nbsp;</div></li><li><div>            if ( is_numeric( $key ) ) { // array( 'posts', 'users', ... )&nbsp;</div></li><li><div>                $this-&gt;$value = $prefix . $value;&nbsp;</div></li><li><div>            } elseif ( !$value ) {&nbsp;</div></li><li><div>                $this-&gt;$key = $prefix . $key; // array( 'posts' =&gt; false, 'users' =&gt; false, ... )&nbsp;</div></li><li><div>            } elseif ( is_string( $value ) ) { // array( 'posts' =&gt; 'my_posts', 'users' =&gt; 'my_users' )&nbsp;</div></li><li><div>                $this-&gt;$key = $value;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $old_prefix;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Selects a database using the current database connection.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The database name will be changed based on the current database&nbsp;</div></li><li><div>     * connection. On failure, the execution will bail and display an DB error.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $db MySQL database name&nbsp;</div></li><li><div>     * @return bool True on success, false on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function select( $db, &$dbh )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( !@mysql_select_db( $db, $dbh ) ) {&nbsp;</div></li><li><div>            $this-&gt;ready = false;&nbsp;</div></li><li><div>            $this-&gt;show_errors();&nbsp;</div></li><li><div>            $this-&gt;bail( BPDB__SELECT_ERROR_MESSAGE );&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _weak_escape( $string )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return addslashes( $string );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _real_escape( $string )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( $this-&gt;dbh && $this-&gt;real_escape ) {&nbsp;</div></li><li><div>            return mysql_real_escape_string( $string, $this-&gt;dbh );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return addslashes( $string );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function _escape( $data )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( is_array( $data ) ) {&nbsp;</div></li><li><div>            foreach ( (array) $data as $k =&gt; $v ) {&nbsp;</div></li><li><div>                if ( is_array( $v ) ) {&nbsp;</div></li><li><div>                    $data[$k] = $this-&gt;_escape( $v );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $data[$k] = $this-&gt;_real_escape( $v );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $data = $this-&gt;_real_escape( $data );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Escapes content for insertion into the database using addslashes(), for security&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array $data&nbsp;</div></li><li><div>     * @return string query safe string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function escape( $data )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( is_array( $data ) ) {&nbsp;</div></li><li><div>            foreach ( (array) $data as $k =&gt; $v ) {&nbsp;</div></li><li><div>                if ( is_array( $v ) ) {&nbsp;</div></li><li><div>                    $data[$k] = $this-&gt;escape( $v );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $data[$k] = $this-&gt;_weak_escape( $v );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $data = $this-&gt;_weak_escape( $data );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Escapes content by reference for insertion into the database, for security&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $s&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function escape_by_ref( &$string )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $string = $this-&gt;_real_escape( $string );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Escapes array recursively for insertion into the database, for security&nbsp;</div></li><li><div>     * @param array $array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function escape_deep( $array )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;_escape( $array );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Prepares a SQL query for safe execution.  Uses sprintf()-like syntax.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This function only supports a small subset of the sprintf syntax; it only supports %d (decimal number), %s (string).&nbsp;</div></li><li><div>     * Does not support sign, padding, alignment, width or precision specifiers.&nbsp;</div></li><li><div>     * Does not support argument numbering/swapping.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * May be called like {@link http://php.net/sprintf sprintf()} or like {@link http://php.net/vsprintf vsprintf()}.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Both %d and %s should be left unquoted in the query string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * &lt;code&gt;&nbsp;</div></li><li><div>     * wpdb::prepare( &quot;SELECT * FROM `table` WHERE `column` = %s AND `field` = %d&quot;, &quot;foo&quot;, 1337 )&nbsp;</div></li><li><div>     * &lt;/code&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @link http://php.net/sprintf Description of syntax.&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $query Query statement with sprintf()-like placeholders&nbsp;</div></li><li><div>     * @param array|mixed $args The array of variables to substitute into the query's placeholders if being called like {@link http://php.net/vsprintf vsprintf()}, or the first variable to substitute into the query's placeholders if being called like {@link http://php.net/sprintf sprintf()}.&nbsp;</div></li><li><div>     * @param mixed $args, ... further variables to substitute into the query's placeholders if being called like {@link http://php.net/sprintf sprintf()}.&nbsp;</div></li><li><div>     * @return null|string Sanitized query string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function prepare( $query = null ) // ( $query, *$args )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( is_null( $query ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $args = func_get_args();&nbsp;</div></li><li><div>        array_shift( $args );&nbsp;</div></li><li><div>        // If args were passed as an array (as in vsprintf), move them up&nbsp;</div></li><li><div>        if ( isset( $args[0] ) && is_array( $args[0] ) ) {&nbsp;</div></li><li><div>            $args = $args[0];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $query = str_replace( &quot;'%s'&quot;, '%s', $query ); // in case someone mistakenly already singlequoted it&nbsp;</div></li><li><div>        $query = str_replace( '&quot;%s&quot;', '%s', $query ); // doublequote unquoting&nbsp;</div></li><li><div>        $query = str_replace( '%s', &quot;'%s'&quot;, $query ); // quote the strings&nbsp;</div></li><li><div>        array_walk( $args, array( &$this, 'escape_by_ref' ) );&nbsp;</div></li><li><div>        return @vsprintf( $query, $args );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get SQL/DB error&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $str Error string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_error( $str = '' )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( empty( $str ) ) {&nbsp;</div></li><li><div>            if ( $this-&gt;last_error ) {&nbsp;</div></li><li><div>                $str = $this-&gt;last_error;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $caller = $this-&gt;get_caller();&nbsp;</div></li><li><div>        $error_str = sprintf( BPDB__ERROR_STRING, $str, $this-&gt;last_query, $caller );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( class_exists( 'WP_Error' ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'db_query', $error_str, array( 'query' =&gt; $this-&gt;last_query, 'error' =&gt; $str, 'caller' =&gt; $caller ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return array( 'query' =&gt; $this-&gt;last_query, 'error' =&gt; $str, 'caller' =&gt; $caller, 'error_str' =&gt; $error_str );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Print SQL/DB error.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $str The error to display&nbsp;</div></li><li><div>     * @return bool False if the showing of errors is disabled.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function print_error( $str = '' )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( $this-&gt;suppress_errors ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $error = $this-&gt;get_error( $str );&nbsp;</div></li><li><div>        if ( is_object( $error ) && is_a( $error, 'WP_Error' ) ) {&nbsp;</div></li><li><div>            $err = $error-&gt;get_error_data();&nbsp;</div></li><li><div>            $err['error_str'] = $error-&gt;get_error_message();&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $err =& $error;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $log_file = ini_get( 'error_log' );&nbsp;</div></li><li><div>        if ( !empty( $log_file ) && ( 'syslog' != $log_file ) && is_writable( $log_file ) && function_exists( 'error_log' ) ) {&nbsp;</div></li><li><div>            error_log($err['error_str'], 0);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Is error output turned on or not&nbsp;</div></li><li><div>        if ( !$this-&gt;show_errors ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $str = htmlspecialchars( $err['error'], ENT_QUOTES );&nbsp;</div></li><li><div>        $query = htmlspecialchars( $err['query'], ENT_QUOTES );&nbsp;</div></li><li><div>        $caller = htmlspecialchars( $err['caller'], ENT_QUOTES );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If there is an error then take note of it&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        printf( BPDB__ERROR_HTML, $str, $query, $caller );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enables showing of database errors.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This function should be used only to enable showing of errors.&nbsp;</div></li><li><div>     * bpdb::hide_errors() should be used instead for hiding of errors. However, &nbsp;</div></li><li><div>     * this function can be used to enable and disable showing of database&nbsp;</div></li><li><div>     * errors.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool $show Whether to show or hide errors&nbsp;</div></li><li><div>     * @return bool Old value for showing errors.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function show_errors( $show = true )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $errors = $this-&gt;show_errors;&nbsp;</div></li><li><div>        $this-&gt;show_errors = $show;&nbsp;</div></li><li><div>        return $errors;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Disables showing of database errors.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool Whether showing of errors was active or not&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function hide_errors()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;show_errors( false );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether to suppress database errors.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool $suppress&nbsp;</div></li><li><div>     * @return bool previous setting&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function suppress_errors( $suppress = true )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $errors = $this-&gt;suppress_errors;&nbsp;</div></li><li><div>        $this-&gt;suppress_errors = $suppress;&nbsp;</div></li><li><div>        return $errors;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Kill cached query results.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function flush()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;last_result = array();&nbsp;</div></li><li><div>        $this-&gt;col_info = array();&nbsp;</div></li><li><div>        $this-&gt;last_query = null;&nbsp;</div></li><li><div>        $this-&gt;last_error = '';&nbsp;</div></li><li><div>        $this-&gt;num_rows = 0;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Perform a MySQL database query, using current database connection.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * More information can be found on the codex page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $query&nbsp;</div></li><li><div>     * @return int|false Number of rows affected/selected or false on error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function query( $query, $use_current = false )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( !$this-&gt;ready ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // filter the query, if filters are available&nbsp;</div></li><li><div>        // NOTE: some queries are made before the plugins have been loaded, and thus cannot be filtered with this method&nbsp;</div></li><li><div>        if ( function_exists( 'apply_filters' ) ) {&nbsp;</div></li><li><div>            $query = apply_filters( 'query', $query );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // initialise return&nbsp;</div></li><li><div>        $return_val = 0;&nbsp;</div></li><li><div>        $this-&gt;flush();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Log how the function was called&nbsp;</div></li><li><div>        $this-&gt;func_call = &quot;\$db-&gt;query(\&quot;$query\&quot;)&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Keep track of the last query for debug..&nbsp;</div></li><li><div>        $this-&gt;last_query = $query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Perform the query via std mysql_query function..&nbsp;</div></li><li><div>        if ( SAVEQUERIES ) {&nbsp;</div></li><li><div>            $this-&gt;timer_start();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $use_current ) {&nbsp;</div></li><li><div>            $dbh =& $this-&gt;dbh;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $dbh = $this-&gt;db_connect( $query );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;result = @mysql_query( $query, $dbh );&nbsp;</div></li><li><div>        ++$this-&gt;num_queries;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( SAVEQUERIES ) {&nbsp;</div></li><li><div>            $this-&gt;queries[] = array( $query, $this-&gt;timer_stop(), $this-&gt;get_caller() );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If there is an error then take note of it..&nbsp;</div></li><li><div>        if ( $this-&gt;last_error = mysql_error( $dbh ) ) {&nbsp;</div></li><li><div>            return $this-&gt;print_error( $this-&gt;last_error );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( preg_match( &quot;/^\\s*(insert|delete|update|replace|alter) /i&quot;, $query ) ) {&nbsp;</div></li><li><div>            $this-&gt;rows_affected = mysql_affected_rows( $dbh );&nbsp;</div></li><li><div>            // Take note of the insert_id&nbsp;</div></li><li><div>            if ( preg_match( &quot;/^\\s*(insert|replace) /i&quot;, $query ) ) {&nbsp;</div></li><li><div>                $this-&gt;insert_id = mysql_insert_id( $dbh );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Return number of rows affected&nbsp;</div></li><li><div>            $return_val = $this-&gt;rows_affected;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $i = 0;&nbsp;</div></li><li><div>            while ( $i &lt; @mysql_num_fields( $this-&gt;result ) ) {&nbsp;</div></li><li><div>                $this-&gt;col_info[$i] = @mysql_fetch_field( $this-&gt;result );&nbsp;</div></li><li><div>                $i++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $num_rows = 0;&nbsp;</div></li><li><div>            while ( $row = @mysql_fetch_object( $this-&gt;result ) ) {&nbsp;</div></li><li><div>                $this-&gt;last_result[$num_rows] = $row;&nbsp;</div></li><li><div>                $num_rows++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            @mysql_free_result( $this-&gt;result );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Log number of rows the query returned&nbsp;</div></li><li><div>            $this-&gt;num_rows = $num_rows;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Return number of rows selected&nbsp;</div></li><li><div>            $return_val = $this-&gt;num_rows;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $return_val;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Insert a row into a table.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * &lt;code&gt;&nbsp;</div></li><li><div>     * wpdb::insert( 'table', array( 'column' =&gt; 'foo', 'field' =&gt; 1337 ), array( '%s', '%d' ) )&nbsp;</div></li><li><div>     * &lt;/code&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @see bpdb::prepare()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table table name&nbsp;</div></li><li><div>     * @param array $data Data to insert (in column =&gt; value pairs).  Both $data columns and $data values should be &quot;raw&quot; (neither should be SQL escaped).&nbsp;</div></li><li><div>     * @param array|string $format (optional) An array of formats to be mapped to each of the value in $data.  If string, that format will be used for all of the values in $data.  A format is one of '%d', '%s' (decimal number, string).  If omitted, all values in $data will be treated as strings.&nbsp;</div></li><li><div>     * @return int|false The number of rows inserted, or false on error.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function insert( $table, $data, $format = null )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $formats = $format = (array) $format;&nbsp;</div></li><li><div>        $fields = array_keys( $data );&nbsp;</div></li><li><div>        $formatted_fields = array();&nbsp;</div></li><li><div>        foreach ( $fields as $field ) {&nbsp;</div></li><li><div>            if ( !empty( $format ) ) {&nbsp;</div></li><li><div>                $form = ( $form = array_shift( $formats ) ) ? $form : $format[0];&nbsp;</div></li><li><div>            } elseif ( isset( $this-&gt;field_types[$field] ) ) {&nbsp;</div></li><li><div>                $form = $this-&gt;field_types[$field];&nbsp;</div></li><li><div>            } elseif ( is_null( $data[$field] ) ) {&nbsp;</div></li><li><div>                $form = 'NULL';&nbsp;</div></li><li><div>                unset( $data[$field] );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $form = '%s';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $formatted_fields[] = $form;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $sql = &quot;INSERT INTO `$table` (`&quot; . implode( '`, `', $fields ) . &quot;`) VALUES (&quot; . implode( &quot;, &quot;, $formatted_fields ) . &quot;)&quot;;&nbsp;</div></li><li><div>        return $this-&gt;query( $this-&gt;prepare( $sql, $data ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Update a row in the table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * &lt;code&gt;&nbsp;</div></li><li><div>     * wpdb::update( 'table', array( 'column' =&gt; 'foo', 'field' =&gt; 1337 ), array( 'ID' =&gt; 1 ), array( '%s', '%d' ), array( '%d' ) )&nbsp;</div></li><li><div>     * &lt;/code&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     * @see bpdb::prepare()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $table table name&nbsp;</div></li><li><div>     * @param array $data Data to update (in column =&gt; value pairs).  Both $data columns and $data values should be &quot;raw&quot; (neither should be SQL escaped).&nbsp;</div></li><li><div>     * @param array $where A named array of WHERE clauses (in column =&gt; value pairs).  Multiple clauses will be joined with ANDs.  Both $where columns and $where values should be &quot;raw&quot;.&nbsp;</div></li><li><div>     * @param array|string $format (optional) An array of formats to be mapped to each of the values in $data.  If string, that format will be used for all of the values in $data.  A format is one of '%d', '%s' (decimal number, string).  If omitted, all values in $data will be treated as strings.&nbsp;</div></li><li><div>     * @param array|string $format_where (optional) An array of formats to be mapped to each of the values in $where.  If string, that format will be used for all of  the items in $where.  A format is one of '%d', '%s' (decimal number, string).  If omitted, all values in $where will be treated as strings.&nbsp;</div></li><li><div>     * @return int|false The number of rows updated, or false on error.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function update( $table, $data, $where, $format = null, $where_format = null )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( !is_array( $where ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $formats = $format = (array) $format;&nbsp;</div></li><li><div>        $bits = $wheres = array();&nbsp;</div></li><li><div>        foreach ( (array) array_keys( $data ) as $field ) {&nbsp;</div></li><li><div>            if ( !empty( $format ) ) {&nbsp;</div></li><li><div>                $form = ( $form = array_shift( $formats ) ) ? $form : $format[0];&nbsp;</div></li><li><div>            } elseif ( isset( $this-&gt;field_types[$field] ) ) {&nbsp;</div></li><li><div>                $form = $this-&gt;field_types[$field];&nbsp;</div></li><li><div>            } elseif ( is_null( $data[$field] ) ) {&nbsp;</div></li><li><div>                $form = 'NULL';&nbsp;</div></li><li><div>                unset( $data[$field] );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $form = '%s';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $bits[] = &quot;`$field` = {$form}&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $where_formats = $where_format = (array) $where_format;&nbsp;</div></li><li><div>        foreach ( (array) array_keys( $where ) as $field ) {&nbsp;</div></li><li><div>            if ( !empty( $where_format ) ) {&nbsp;</div></li><li><div>                $form = ( $form = array_shift( $where_formats ) ) ? $form : $where_format[0];&nbsp;</div></li><li><div>            } elseif ( isset( $this-&gt;field_types[$field] ) ) {&nbsp;</div></li><li><div>                $form = $this-&gt;field_types[$field];&nbsp;</div></li><li><div>            } elseif ( is_null( $where[$field] ) ) {&nbsp;</div></li><li><div>                unset( $where[$field] );&nbsp;</div></li><li><div>                $wheres[] = &quot;`$field` IS NULL&quot;;&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $form = '%s';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $wheres[] = &quot;`$field` = {$form}&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;UPDATE `$table` SET &quot; . implode( ', ', $bits ) . ' WHERE ' . implode( ' AND ', $wheres );&nbsp;</div></li><li><div>        return $this-&gt;query( $this-&gt;prepare( $sql, array_merge( array_values( $data ), array_values( $where ) ) ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve one variable from the database.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Executes a SQL query and returns the value from the SQL result.&nbsp;</div></li><li><div>     * If the SQL result contains more than one column and/or more than one row, this function returns the value in the column and row specified.&nbsp;</div></li><li><div>     * If $query is null, this function returns the value in the specified column and row from the previous SQL result.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|null $query SQL query.  If null, use the result from the previous query.&nbsp;</div></li><li><div>     * @param int $x (optional) Column of value to return.  Indexed from 0.&nbsp;</div></li><li><div>     * @param int $y (optional) Row of value to return.  Indexed from 0.&nbsp;</div></li><li><div>     * @return string Database query result&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_var( $query=null, $x = 0, $y = 0 )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;func_call = &quot;\$db-&gt;get_var(\&quot;$query\&quot;, $x, $y)&quot;;&nbsp;</div></li><li><div>        if ( $query ) {&nbsp;</div></li><li><div>            $this-&gt;query( $query );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Extract var out of cached results based x, y vals&nbsp;</div></li><li><div>        if ( !empty( $this-&gt;last_result[$y] ) ) {&nbsp;</div></li><li><div>            $values = array_values( get_object_vars( $this-&gt;last_result[$y] ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If there is a value return it else return null&nbsp;</div></li><li><div>        return ( isset($values[$x]) && $values[$x]!=='' ) ? $values[$x] : null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve one row from the database.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Executes a SQL query and returns the row from the SQL result.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|null $query SQL query.&nbsp;</div></li><li><div>     * @param string $output (optional) one of ARRAY_A | ARRAY_N | OBJECT constants.  Return an associative array (column =&gt; value, ...), a numerically indexed array (0 =&gt; value, ...) or an object ( -&gt;column = value ), respectively.&nbsp;</div></li><li><div>     * @param int $y (optional) Row to return.  Indexed from 0.&nbsp;</div></li><li><div>     * @return mixed Database query result in format specifed by $output&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_row( $query = null, $output = OBJECT, $y = 0 )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;func_call = &quot;\$db-&gt;get_row(\&quot;$query\&quot;, $output, $y)&quot;;&nbsp;</div></li><li><div>        if ( $query ) {&nbsp;</div></li><li><div>            $this-&gt;query( $query );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return null;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !isset( $this-&gt;last_result[$y] ) ) {&nbsp;</div></li><li><div>            return null;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $output == OBJECT ) {&nbsp;</div></li><li><div>            return $this-&gt;last_result[$y] ? $this-&gt;last_result[$y] : null;&nbsp;</div></li><li><div>        } elseif ( $output == ARRAY_A ) {&nbsp;</div></li><li><div>            return $this-&gt;last_result[$y] ? get_object_vars( $this-&gt;last_result[$y] ) : null;&nbsp;</div></li><li><div>        } elseif ( $output == ARRAY_N ) {&nbsp;</div></li><li><div>            return $this-&gt;last_result[$y] ? array_values( get_object_vars( $this-&gt;last_result[$y] ) ) : null;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;print_error( &quot; \$db-&gt;get_row(string query, output type, int offset) -- Output type must be one of: OBJECT, ARRAY_A, ARRAY_N&quot; );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve one column from the database.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Executes a SQL query and returns the column from the SQL result.&nbsp;</div></li><li><div>     * If the SQL result contains more than one column, this function returns the column specified.&nbsp;</div></li><li><div>     * If $query is null, this function returns the specified column from the previous SQL result.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|null $query SQL query.  If null, use the result from the previous query.&nbsp;</div></li><li><div>     * @param int $x Column to return.  Indexed from 0.&nbsp;</div></li><li><div>     * @return array Database query result.  Array indexed from 0 by SQL result row number.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_col( $query = null , $x = 0 )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( $query ) {&nbsp;</div></li><li><div>            $this-&gt;query( $query );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $new_array = array();&nbsp;</div></li><li><div>        // Extract the column values&nbsp;</div></li><li><div>        for ( $i=0; $i &lt; count( $this-&gt;last_result ); $i++ ) {&nbsp;</div></li><li><div>            $new_array[$i] = $this-&gt;get_var( null, $x, $i );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $new_array;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve an entire SQL result set from the database (i.e., many rows)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Executes a SQL query and returns the entire SQL result.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $query SQL query.&nbsp;</div></li><li><div>     * @param string $output (optional) ane of ARRAY_A | ARRAY_N | OBJECT | OBJECT_K | ARRAY_K constants.  With one of the first three, return an array of rows indexed from 0 by SQL result row number.  Each row is an associative array (column =&gt; value, ...), a numerically indexed array (0 =&gt; value, ...), or an object. ( -&gt;column = value ), respectively.  With OBJECT_K and ARRAY_K, return an associative array of row objects keyed by the value of each row's first column's value.  Duplicate keys are discarded.&nbsp;</div></li><li><div>     * @return mixed Database query results&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_results( $query = null, $output = OBJECT ) &nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;func_call = &quot;\$db-&gt;get_results(\&quot;$query\&quot;, $output)&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $query ) {&nbsp;</div></li><li><div>            $this-&gt;query($query);&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return null;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $output == OBJECT ) {&nbsp;</div></li><li><div>            // Return an integer-keyed array of row objects&nbsp;</div></li><li><div>            return $this-&gt;last_result;&nbsp;</div></li><li><div>        } elseif ( $output == OBJECT_K || $output == ARRAY_K ) {&nbsp;</div></li><li><div>            // Return an array of row objects with keys from column 1&nbsp;</div></li><li><div>            // (Duplicates are discarded)&nbsp;</div></li><li><div>            $key = $this-&gt;col_info[0]-&gt;name;&nbsp;</div></li><li><div>            foreach ( $this-&gt;last_result as $row ) {&nbsp;</div></li><li><div>                if ( !isset( $new_array[ $row-&gt;$key ] ) ) {&nbsp;</div></li><li><div>                    $new_array[ $row-&gt;$key ] = $row;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $output == ARRAY_K ) {&nbsp;</div></li><li><div>                return array_map( 'get_object_vars', $new_array );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $new_array;&nbsp;</div></li><li><div>        } elseif ( $output == ARRAY_A || $output == ARRAY_N ) {&nbsp;</div></li><li><div>            // Return an integer-keyed array of...&nbsp;</div></li><li><div>            if ( $this-&gt;last_result ) {&nbsp;</div></li><li><div>                $i = 0;&nbsp;</div></li><li><div>                foreach( $this-&gt;last_result as $row ) {&nbsp;</div></li><li><div>                    if ( $output == ARRAY_N ) {&nbsp;</div></li><li><div>                        // ...integer-keyed row arrays&nbsp;</div></li><li><div>                        $new_array[$i] = array_values( get_object_vars( $row ) );&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        // ...column name-keyed row arrays&nbsp;</div></li><li><div>                        $new_array[$i] = get_object_vars( $row );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    ++$i;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return $new_array;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve column metadata from the last query.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $info_type one of name, table, def, max_length, not_null, primary_key, multiple_key, unique_key, numeric, blob, type, unsigned, zerofill&nbsp;</div></li><li><div>     * @param int $col_offset 0: col name. 1: which table the col's in. 2: col's max length. 3: if the col is numeric. 4: col's type&nbsp;</div></li><li><div>     * @return mixed Column Results&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_col_info( $info_type = 'name', $col_offset = -1 )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( $this-&gt;col_info ) {&nbsp;</div></li><li><div>            if ( $col_offset == -1 ) {&nbsp;</div></li><li><div>                $i = 0;&nbsp;</div></li><li><div>                foreach( (array) $this-&gt;col_info as $col ) {&nbsp;</div></li><li><div>                    $new_array[$i] = $col-&gt;{$info_type};&nbsp;</div></li><li><div>                    $i++;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return $new_array;&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return $this-&gt;col_info[$col_offset]-&gt;{$info_type};&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Starts the timer, for debugging purposes.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return true&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function timer_start()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $mtime = microtime();&nbsp;</div></li><li><div>        $mtime = explode( ' ', $mtime );&nbsp;</div></li><li><div>        $this-&gt;time_start = $mtime[1] + $mtime[0];&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Stops the debugging timer.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int Total time spent on the query, in milliseconds&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function timer_stop()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $mtime = microtime();&nbsp;</div></li><li><div>        $mtime = explode( ' ', $mtime );&nbsp;</div></li><li><div>        $time_end = $mtime[1] + $mtime[0];&nbsp;</div></li><li><div>        $time_total = $time_end - $this-&gt;time_start;&nbsp;</div></li><li><div>        return $time_total;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Wraps errors in a nice header and footer and dies.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Will not die if bpdb::$show_errors is true&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $message&nbsp;</div></li><li><div>     * @return false|void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function bail( $message )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( !$this-&gt;show_errors ) {&nbsp;</div></li><li><div>            if ( class_exists( 'WP_Error' ) )&nbsp;</div></li><li><div>                $this-&gt;error = new WP_Error( '500', $message );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $this-&gt;error = $message;&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        backpress_die( $message );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether or not MySQL database is at least the required minimum version.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return WP_Error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function check_database_version( $dbh_or_table = false )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Make sure the server has MySQL 4.0&nbsp;</div></li><li><div>        if ( version_compare( $this-&gt;db_version( $dbh_or_table ), '4.0.0', '&lt;' ) ) {&nbsp;</div></li><li><div>            return new WP_Error( 'database_version', BPDB__DB_VERSION_ERROR );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether of not the database supports collation.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Called when BackPress is generating the table scheme.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool True if collation is supported, false if version does not&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function supports_collation()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $this-&gt;has_cap( 'collation' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Generic function to determine if a database supports a particular feature&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $db_cap the feature&nbsp;</div></li><li><div>     * @param false|string|resource $dbh_or_table Which database to test.  False = the currently selected database, string = the database containing the specified table, resource = the database corresponding to the specified mysql resource.&nbsp;</div></li><li><div>     * @return bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function has_cap( $db_cap, $dbh_or_table = false )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $version = $this-&gt;db_version( $dbh_or_table );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( strtolower( $db_cap ) ) {&nbsp;</div></li><li><div>            case 'collation' :&nbsp;</div></li><li><div>            case 'group_concat' :&nbsp;</div></li><li><div>            case 'subqueries' :&nbsp;</div></li><li><div>                return version_compare( $version, '4.1', '&gt;=' );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'index_hint_for_join' :&nbsp;</div></li><li><div>                return version_compare( $version, '5.0', '&gt;=' );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case 'index_hint_lists' :&nbsp;</div></li><li><div>            case 'index_hint_for_any' :&nbsp;</div></li><li><div>                return version_compare( $version, '5.1', '&gt;=' );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The database version number&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param false|string|resource $dbh_or_table Which database to test. False = the currently selected database, string = the database containing the specified table, resource = the database corresponding to the specified mysql resource.&nbsp;</div></li><li><div>     * @return false|string false on failure, version number on success&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function db_version( $dbh_or_table = false )&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ( !$dbh_or_table ) {&nbsp;</div></li><li><div>            $dbh =& $this-&gt;dbh;&nbsp;</div></li><li><div>        } elseif ( is_resource( $dbh_or_table ) ) {&nbsp;</div></li><li><div>            $dbh =& $dbh_or_table;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $dbh = $this-&gt;db_connect( &quot;DESCRIBE $dbh_or_table&quot; );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $dbh ) {&nbsp;</div></li><li><div>            return preg_replace( '|[^0-9\.]|', '', mysql_get_server_info( $dbh ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the name of the function that called bpdb.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Requires PHP 4.3 and searches up the list of functions until it reaches&nbsp;</div></li><li><div>     * the one that would most logically had called this method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string The name of the calling function&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_caller()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // requires PHP 4.3+&nbsp;</div></li><li><div>        if ( !is_callable( 'debug_backtrace' ) ) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $bt = debug_backtrace();&nbsp;</div></li><li><div>        $caller = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $bt = array_reverse( $bt );&nbsp;</div></li><li><div>        foreach ( (array) $bt as $call ) {&nbsp;</div></li><li><div>            if ( @$call['class'] == __CLASS__ ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $function = $call['function'];&nbsp;</div></li><li><div>            if ( isset( $call['class'] ) ) {&nbsp;</div></li><li><div>                $function = $call['class'] . &quot;-&gt;$function&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $caller[] = $function;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $caller = join( ', ', $caller );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $caller;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd><dt><strong><a href="http://hookr.io/plugins/buddypress/2.7.5/files/bp-forums-bp-forums-bbpress-sa/" class="file">/bp-forums/bp-forums-bbpress-sa.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="50" class="block" start="226"><li><div>class BPDB extends WPDB {&nbsp;</div></li><li><div>    var $db_servers = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see WPDB::__construct() for description of parameters.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __construct( $dbuser, $dbpassword, $dbname, $dbhost ) {&nbsp;</div></li><li><div>        parent::__construct( $dbuser, $dbpassword, $dbname, $dbhost );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $args = func_get_args();&nbsp;</div></li><li><div>        $args = call_user_func_array( array( &$this, 'init' ), $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $args['host'] )&nbsp;</div></li><li><div>            $this-&gt;db_servers['dbh_global'] = $args;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Determine if a database supports a particular feature.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Overridden here to work around differences between bbPress's&nbsp;</div></li><li><div>     * and WordPress's implementations. In particular, when&nbsp;</div></li><li><div>     * BuddyPress tries to run bbPress' SQL installation script, &nbsp;</div></li><li><div>     * the collation check always failed. The capability is long&nbsp;</div></li><li><div>     * supported by WordPress' minimum required MySQL version, so&nbsp;</div></li><li><div>     * this is safe.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see WPDB::has_cap() for a description of parameters and&nbsp;</div></li><li><div>     *      return values.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $db_cap See {@link WPDB::has_cap()}.&nbsp;</div></li><li><div>     * @param string $_table_name See {@link WPDB::has_cap()}.&nbsp;</div></li><li><div>     * @return bool See {@link WPDB::has_cap()}.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function has_cap( $db_cap, $_table_name='' ) {&nbsp;</div></li><li><div>        if ( 'collation' == $db_cap )&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return parent::has_cap( $db_cap );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initialize the class variables based on provided arguments.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Based on, and taken from, the BackPress class in turn taken&nbsp;</div></li><li><div>     * from the 1.0 branch of bbPress.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see BBDB::__construct() for a description of params.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args Array of args to parse.&nbsp;</div></li><li><div>     * @return array $args.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function init( $args ) {&nbsp;</div></li><li><div>        if ( 4 == func_num_args() ) {&nbsp;</div></li><li><div>            $args = array(&nbsp;</div></li><li><div>                'user' =&gt; $args, &nbsp;</div></li><li><div>                'password' =&gt; func_get_arg( 1 ), &nbsp;</div></li><li><div>                'name' =&gt; func_get_arg( 2 ), &nbsp;</div></li><li><div>                'host' =&gt; func_get_arg( 3 ), &nbsp;</div></li><li><div>                'charset' =&gt; defined( 'BBDB_CHARSET' ) ? BBDB_CHARSET : false, &nbsp;</div></li><li><div>                'collate' =&gt; defined( 'BBDB_COLLATE' ) ? BBDB_COLLATE : false, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>                'user' =&gt; false, &nbsp;</div></li><li><div>                'password' =&gt; false, &nbsp;</div></li><li><div>                'name' =&gt; false, &nbsp;</div></li><li><div>                'host' =&gt; 'localhost', &nbsp;</div></li><li><div>                'charset' =&gt; false, &nbsp;</div></li><li><div>                'collate' =&gt; false, &nbsp;</div></li><li><div>                'errors' =&gt; false&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Stub for escape_deep() compatibility.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $data See {@link WPDB::escape_deep()}.&nbsp;</div></li><li><div>     * @return mixed $data See {@link WPDB::escape_deep()}.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function escape_deep( $data ) {&nbsp;</div></li><li><div>        return esc_sql( $data );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.7.4</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/bpdb/" class="">2.8.2</a></li><li><a href="http://hookr.io/plugins/buddypress/2.8.1/classes/bpdb/" class="">2.8.1</a></li><li><a href="http://hookr.io/plugins/buddypress/2.8.0/classes/bpdb/" class="">2.8.0</a></li><li><a href="http://hookr.io/plugins/buddypress/2.7.5/classes/bpdb/" class="active">2.7.5</a></li><li><a href="http://hookr.io/plugins/buddypress/2.7.4/classes/bpdb/" class="">2.7.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>BPDB</li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>