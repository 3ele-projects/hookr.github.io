<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.7.4" data-slug="buddypress" data-type="file" data-id="49298"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-groups-classes-class-bp-groups-group | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.7.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.24"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=5214332a0d39a2e4818bc5638a9cb808' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.24' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-groups-classes-class-bp-groups-group/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-groups-classes-class-bp-groups-group%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-groups-classes-class-bp-groups-group%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.7.4-file-bp-groups-classes-class-bp-groups-group","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-groups-classes-class-bp-groups-group" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.4." href="http://hookr.io/plugins/buddypress/2.7.4/" class="H_VERSION"><span property="name">2.7.4</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.7.4/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-groups-classes-class-bp-gr&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7768"><a href="http://hookr.io/plugins/buddypress/2.7.4/all/" title="All">All <span class="count badge">7768</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.7.4/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3600"><a href="http://hookr.io/plugins/buddypress/2.7.4/hooks/" title="Hooks">Hooks <span class="count badge">3600</span></a></li><li class="" data-id="action" data-count="1718"><a href="http://hookr.io/plugins/buddypress/2.7.4/actions/" title="Actions">Actions <span class="count badge">1718</span></a></li><li class="" data-id="filter" data-count="1882"><a href="http://hookr.io/plugins/buddypress/2.7.4/filters/" title="Filters">Filters <span class="count badge">1882</span></a></li><li class="" data-id="class" data-count="178"><a href="http://hookr.io/plugins/buddypress/2.7.4/classes/" title="Classes">Classes <span class="count badge">178</span></a></li><li class="" data-id="constant" data-count="160"><a href="http://hookr.io/plugins/buddypress/2.7.4/constants/" title="Constants">Constants <span class="count badge">160</span></a></li><li class="" data-id="function" data-count="3830"><a href="http://hookr.io/plugins/buddypress/2.7.4/functions/" title="Functions">Functions <span class="count badge">3830</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-groups/classes/class-bp-groups-group.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * BuddyPress Groups Classes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BuddyPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage GroupsClasses</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly.</span>&nbsp;</div></li><li><div>defined( 'ABSPATH' ) || exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * BuddyPress Group object.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class BP_Groups_Group {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * User ID of the group's creator.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $creator_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Name of the group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Group slug.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $slug;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Group description.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $description;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Group status.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Core statuses are 'public', 'private', and 'hidden'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $status;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Parent ID.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * ID of parent group, if applicable.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $parent_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Should (legacy) bbPress forums be enabled for this group?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $enable_forum;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Date the group was created.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $date_created;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Data about the group's admins.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $admins;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Data about the group's moderators.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $mods;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Total count of group members.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var int</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $total_member_count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the current user a member of this group?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $is_member;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Does the current user have an outstanding invitation to this group?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.9.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $is_invited;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Does the current user have a pending membership request to this group?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.9.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $is_pending;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Timestamp of the last activity that happened in this group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $last_activity;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * If this is a private or hidden group, does the current user have access?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected $user_has_access;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Raw arguments passed to the constructor.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $args;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Constructor method.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null $id   Optional. If the ID of an existing group is provided, </span>&nbsp;</div></li><li><div><span class="comment">   *                       the object will be pre-populated with info about that group.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array    $args {</span>&nbsp;</div></li><li><div><span class="comment">   *     Array of optional arguments.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool $populate_extras Deprecated.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __construct( $id = null, $args = array() ) {&nbsp;</div></li><li><div>      if ( !empty( $id ) ) {&nbsp;</div></li><li><div>          $this-&gt;id = (int) $id;&nbsp;</div></li><li><div>          $this-&gt;populate();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set up data about the current group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function populate() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get BuddyPress.</span>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check cache for group data.</span>&nbsp;</div></li><li><div>      $group = wp_cache_get( $this-&gt;id, 'bp_groups' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Cache missed, so query the DB.</span>&nbsp;</div></li><li><div>      if ( false === $group ) {&nbsp;</div></li><li><div>          $group = $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT g.* FROM {$bp-&gt;groups-&gt;table_name} g WHERE g.id = %d&quot;, $this-&gt;id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_cache_set( $this-&gt;id, $group, 'bp_groups' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// No group found so set the ID and bail.</span>&nbsp;</div></li><li><div>      if ( empty( $group ) || is_wp_error( $group ) ) {&nbsp;</div></li><li><div>          $this-&gt;id = 0;&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Group found so setup the object variables.</span>&nbsp;</div></li><li><div>      $this-&gt;id = (int) $group-&gt;id;&nbsp;</div></li><li><div>      $this-&gt;creator_id = (int) $group-&gt;creator_id;&nbsp;</div></li><li><div>      $this-&gt;name = stripslashes( $group-&gt;name );&nbsp;</div></li><li><div>      $this-&gt;slug = $group-&gt;slug;&nbsp;</div></li><li><div>      $this-&gt;description = stripslashes( $group-&gt;description );&nbsp;</div></li><li><div>      $this-&gt;status = $group-&gt;status;&nbsp;</div></li><li><div>      $this-&gt;parent_id = (int) $group-&gt;parent_id;&nbsp;</div></li><li><div>      $this-&gt;enable_forum = (int) $group-&gt;enable_forum;&nbsp;</div></li><li><div>      $this-&gt;date_created = $group-&gt;date_created;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Save the current group to the database.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function save() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;creator_id = apply_filters( 'groups_group_creator_id_before_save', $this-&gt;creator_id, $this-&gt;id );&nbsp;</div></li><li><div>      $this-&gt;name = apply_filters( 'groups_group_name_before_save', $this-&gt;name, $this-&gt;id );&nbsp;</div></li><li><div>      $this-&gt;slug = apply_filters( 'groups_group_slug_before_save', $this-&gt;slug, $this-&gt;id );&nbsp;</div></li><li><div>      $this-&gt;description = apply_filters( 'groups_group_description_before_save', $this-&gt;description, $this-&gt;id );&nbsp;</div></li><li><div>      $this-&gt;status = apply_filters( 'groups_group_status_before_save', $this-&gt;status, $this-&gt;id );&nbsp;</div></li><li><div>      $this-&gt;parent_id = apply_filters( 'groups_group_parent_id_before_save', $this-&gt;parent_id, $this-&gt;id );&nbsp;</div></li><li><div>      $this-&gt;enable_forum = apply_filters( 'groups_group_enable_forum_before_save', $this-&gt;enable_forum, $this-&gt;id );&nbsp;</div></li><li><div>      $this-&gt;date_created = apply_filters( 'groups_group_date_created_before_save', $this-&gt;date_created, $this-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before the current group item gets saved.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Please use this hook to filter the properties above. Each part will be passed in.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param BP_Groups_Group $this Current instance of the group item being saved. Passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action_ref_array( 'groups_group_before_save', array( &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Groups need at least a name.</span>&nbsp;</div></li><li><div>      if ( empty( $this-&gt;name ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Set slug with group title if not passed.</span>&nbsp;</div></li><li><div>      if ( empty( $this-&gt;slug ) ) {&nbsp;</div></li><li><div>          $this-&gt;slug = sanitize_title( $this-&gt;name );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sanity check.</span>&nbsp;</div></li><li><div>      if ( empty( $this-&gt;slug ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check for slug conflicts if creating new group.</span>&nbsp;</div></li><li><div>      if ( empty( $this-&gt;id ) ) {&nbsp;</div></li><li><div>          $this-&gt;slug = groups_check_slug( $this-&gt;slug );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $this-&gt;id ) ) {&nbsp;</div></li><li><div>          $sql = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>              &quot;UPDATE {$bp-&gt;groups-&gt;table_name} SET&nbsp;</div></li><li><div>                  creator_id = %d, &nbsp;</div></li><li><div>                  name = %s, &nbsp;</div></li><li><div>                  slug = %s, &nbsp;</div></li><li><div>                  description = %s, &nbsp;</div></li><li><div>                  status = %s, &nbsp;</div></li><li><div>                  parent_id = %d, &nbsp;</div></li><li><div>                  enable_forum = %d, &nbsp;</div></li><li><div>                  date_created = %s&nbsp;</div></li><li><div>              WHERE&nbsp;</div></li><li><div>                  id = %d&nbsp;</div></li><li><div>              &quot;, &nbsp;</div></li><li><div>                  $this-&gt;creator_id, &nbsp;</div></li><li><div>                  $this-&gt;name, &nbsp;</div></li><li><div>                  $this-&gt;slug, &nbsp;</div></li><li><div>                  $this-&gt;description, &nbsp;</div></li><li><div>                  $this-&gt;status, &nbsp;</div></li><li><div>                  $this-&gt;parent_id, &nbsp;</div></li><li><div>                  $this-&gt;enable_forum, &nbsp;</div></li><li><div>                  $this-&gt;date_created, &nbsp;</div></li><li><div>                  $this-&gt;id&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $sql = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>              &quot;INSERT INTO {$bp-&gt;groups-&gt;table_name} (&nbsp;</div></li><li><div>                  creator_id, &nbsp;</div></li><li><div>                  name, &nbsp;</div></li><li><div>                  slug, &nbsp;</div></li><li><div>                  description, &nbsp;</div></li><li><div>                  status, &nbsp;</div></li><li><div>                  parent_id, &nbsp;</div></li><li><div>                  enable_forum, &nbsp;</div></li><li><div>                  date_created&nbsp;</div></li><li><div> ) VALUES (&nbsp;</div></li><li><div>                  %d, %s, %s, %s, %s, %d, %d, %s&nbsp;</div></li><li><div> )&quot;, &nbsp;</div></li><li><div>                  $this-&gt;creator_id, &nbsp;</div></li><li><div>                  $this-&gt;name, &nbsp;</div></li><li><div>                  $this-&gt;slug, &nbsp;</div></li><li><div>                  $this-&gt;description, &nbsp;</div></li><li><div>                  $this-&gt;status, &nbsp;</div></li><li><div>                  $this-&gt;parent_id, &nbsp;</div></li><li><div>                  $this-&gt;enable_forum, &nbsp;</div></li><li><div>                  $this-&gt;date_created&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( false === $wpdb-&gt;query($sql) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $this-&gt;id ) )&nbsp;</div></li><li><div>          $this-&gt;id = $wpdb-&gt;insert_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the current group item has been saved.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param BP_Groups_Group $this Current instance of the group item that was saved. Passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action_ref_array( 'groups_group_after_save', array( &$this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_cache_delete( $this-&gt;id, 'bp_groups' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Delete the current group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function delete() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Delete groupmeta for the group.</span>&nbsp;</div></li><li><div>      groups_delete_groupmeta( $this-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fetch the user IDs of all the members of the group.</span>&nbsp;</div></li><li><div>      $user_ids = BP_Groups_Member::get_group_member_ids( $this-&gt;id );&nbsp;</div></li><li><div>      $user_id_str = esc_sql( implode( ', ', wp_parse_id_list( $user_ids ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Modify group count usermeta for members.</span>&nbsp;</div></li><li><div>      $wpdb-&gt;query( &quot;UPDATE {$wpdb-&gt;usermeta} SET meta_value = meta_value - 1 WHERE meta_key = 'total_group_count' AND user_id IN ( {$user_id_str} )&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Now delete all group member entries.</span>&nbsp;</div></li><li><div>      BP_Groups_Member::delete_all( $this-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before the deletion of a group.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param BP_Groups_Group $this     Current instance of the group item being deleted. Passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array           $user_ids Array of user IDs that were members of the group.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action_ref_array( 'bp_groups_delete_group', array( &$this, $user_ids ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_cache_delete( $this-&gt;id, 'bp_groups' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Finally remove the group entry from the DB.</span>&nbsp;</div></li><li><div>      if ( !$wpdb-&gt;query( $wpdb-&gt;prepare( &quot;DELETE FROM {$bp-&gt;groups-&gt;table_name} WHERE id = %d&quot;, $this-&gt;id ) ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Magic getter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key Property name.</span>&nbsp;</div></li><li><div><span class="comment">   * @return mixed</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __get( $key ) {&nbsp;</div></li><li><div>      switch ( $key ) {&nbsp;</div></li><li><div>          case 'last_activity' :&nbsp;</div></li><li><div>          case 'total_member_count' :&nbsp;</div></li><li><div>          case 'forum_id' :&nbsp;</div></li><li><div>              $retval = groups_get_groupmeta( $this-&gt;id, $key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'last_activity' !== $key ) {&nbsp;</div></li><li><div>                  $retval = (int) $retval;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              return $retval;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'admins' :&nbsp;</div></li><li><div>              return $this-&gt;get_admins();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'mods' :&nbsp;</div></li><li><div>              return $this-&gt;get_mods();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'is_member' :&nbsp;</div></li><li><div>              return $this-&gt;get_is_member();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'is_invited' :&nbsp;</div></li><li><div>              return groups_check_user_has_invite( bp_loggedin_user_id(), $this-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'is_pending' :&nbsp;</div></li><li><div>              return groups_check_for_membership_request( bp_loggedin_user_id(), $this-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'user_has_access' :&nbsp;</div></li><li><div>              return $this-&gt;get_user_has_access();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          default :&nbsp;</div></li><li><div>              return isset( $this-&gt;{$key} ) ? $this-&gt;{$key} : null;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Magic issetter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Used to maintain backward compatibility for properties that are now</span>&nbsp;</div></li><li><div><span class="comment">   * accessible only via magic method.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key Property name.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __isset( $key ) {&nbsp;</div></li><li><div>      switch ( $key ) {&nbsp;</div></li><li><div>          case 'admins' :&nbsp;</div></li><li><div>          case 'is_invited' :&nbsp;</div></li><li><div>          case 'is_member' :&nbsp;</div></li><li><div>          case 'is_pending' :&nbsp;</div></li><li><div>          case 'last_activity' :&nbsp;</div></li><li><div>          case 'mods' :&nbsp;</div></li><li><div>          case 'total_member_count' :&nbsp;</div></li><li><div>          case 'user_has_access' :&nbsp;</div></li><li><div>          case 'forum_id' :&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          default :&nbsp;</div></li><li><div>              return isset( $this-&gt;{$key} );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Magic setter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Used to maintain backward compatibility for properties that are now</span>&nbsp;</div></li><li><div><span class="comment">   * accessible only via magic method.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key Property name.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __set( $key, $value ) {&nbsp;</div></li><li><div>      switch ( $key ) {&nbsp;</div></li><li><div>          case 'user_has_access' :&nbsp;</div></li><li><div>              return $this-&gt;user_has_access = (bool) $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          default :&nbsp;</div></li><li><div>              $this-&gt;{$key} = $value;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of the group's admins.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Used to provide cache-friendly access to the 'admins' property of</span>&nbsp;</div></li><li><div><span class="comment">   * the group object.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function get_admins() {&nbsp;</div></li><li><div>      if ( isset( $this-&gt;admins ) ) {&nbsp;</div></li><li><div>          return $this-&gt;admins;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;set_up_admins_and_mods();&nbsp;</div></li><li><div>      return $this-&gt;admins;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of the group's mods.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Used to provide cache-friendly access to the 'mods' property of</span>&nbsp;</div></li><li><div><span class="comment">   * the group object.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function get_mods() {&nbsp;</div></li><li><div>      if ( isset( $this-&gt;mods ) ) {&nbsp;</div></li><li><div>          return $this-&gt;mods;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;set_up_admins_and_mods();&nbsp;</div></li><li><div>      return $this-&gt;mods;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set up admins and mods for the current group object.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Called only when the 'admins' or 'mods' property is accessed.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function set_up_admins_and_mods() {&nbsp;</div></li><li><div>      $admin_ids = BP_Groups_Member::get_group_administrator_ids( $this-&gt;id );&nbsp;</div></li><li><div>      $admin_ids_plucked = wp_list_pluck( $admin_ids, 'user_id' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $mod_ids = BP_Groups_Member::get_group_moderator_ids( $this-&gt;id );&nbsp;</div></li><li><div>      $mod_ids_plucked = wp_list_pluck( $mod_ids, 'user_id' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $admin_mod_users = get_users( array(&nbsp;</div></li><li><div>          'include' =&gt; array_merge( $admin_ids_plucked, $mod_ids_plucked ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $admin_objects = $mod_objects = array();&nbsp;</div></li><li><div>      foreach ( $admin_mod_users as $admin_mod_user ) {&nbsp;</div></li><li><div>          $obj = new stdClass();&nbsp;</div></li><li><div>          $obj-&gt;user_id = $admin_mod_user-&gt;ID;&nbsp;</div></li><li><div>          $obj-&gt;user_login = $admin_mod_user-&gt;user_login;&nbsp;</div></li><li><div>          $obj-&gt;user_email = $admin_mod_user-&gt;user_email;&nbsp;</div></li><li><div>          $obj-&gt;user_nicename = $admin_mod_user-&gt;user_nicename;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( in_array( $admin_mod_user-&gt;ID, $admin_ids_plucked, true ) ) {&nbsp;</div></li><li><div>              $obj-&gt;is_admin = 1;&nbsp;</div></li><li><div>              $obj-&gt;is_mod = 0;&nbsp;</div></li><li><div>              $admin_objects[] = $obj;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $obj-&gt;is_admin = 0;&nbsp;</div></li><li><div>              $obj-&gt;is_mod = 1;&nbsp;</div></li><li><div>              $mod_objects[] = $obj;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;admins = $admin_objects;&nbsp;</div></li><li><div>      $this-&gt;mods = $mod_objects;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Checks whether the logged-in user is a member of the group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function get_is_member() {&nbsp;</div></li><li><div>      if ( isset( $this-&gt;is_member ) ) {&nbsp;</div></li><li><div>          return $this-&gt;is_member;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;is_member = groups_is_user_member( bp_loggedin_user_id(), $this-&gt;id );&nbsp;</div></li><li><div>      return $this-&gt;is_member;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Checks whether the logged-in user has access to the group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function get_user_has_access() {&nbsp;</div></li><li><div>      if ( isset( $this-&gt;user_has_access ) ) {&nbsp;</div></li><li><div>          return $this-&gt;user_has_access;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ( 'private' === $this-&gt;status ) || ( 'hidden' === $this-&gt;status ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Assume user does not have access to hidden/private groups.</span>&nbsp;</div></li><li><div>          $this-&gt;user_has_access = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Group members or community moderators have access.</span>&nbsp;</div></li><li><div>          if ( ( is_user_logged_in() && $this-&gt;get_is_member() ) || bp_current_user_can( 'bp_moderate' ) ) {&nbsp;</div></li><li><div>              $this-&gt;user_has_access = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $this-&gt;user_has_access = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;user_has_access;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** Static Methods ****************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get whether a group exists for a given slug.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string      $slug       Slug to check.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool $table_name Optional. Name of the table to check</span>&nbsp;</div></li><li><div><span class="comment">   *                                against. Default: $bp-&gt;groups-&gt;table_name.</span>&nbsp;</div></li><li><div><span class="comment">   * @return int|null Group ID if found; null if not.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function group_exists( $slug, $table_name = false ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $table_name ) )&nbsp;</div></li><li><div>          $table_name = buddypress()-&gt;groups-&gt;table_name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $slug ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $query = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT id FROM {$table_name} WHERE slug = %s&quot;, strtolower( $slug ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return is_numeric( $query ) ? (int) $query : $query;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the ID of a group by the group's slug.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Alias of {@link BP_Groups_Group::group_exists()}.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $slug See {@link BP_Groups_Group::group_exists()}.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string|null See {@link BP_Groups_Group::group_exists()}.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_id_from_slug( $slug ) {&nbsp;</div></li><li><div>      return BP_Groups_Group::group_exists( $slug );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get IDs of users with outstanding invites to a given group from a specified user.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $user_id ID of the inviting user.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array IDs of users who have been invited to the group by the</span>&nbsp;</div></li><li><div><span class="comment">   *               user but have not yet accepted.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_invites( $user_id, $group_id ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $wpdb-&gt;get_col( $wpdb-&gt;prepare( &quot;SELECT user_id FROM {$bp-&gt;groups-&gt;table_name_members} WHERE group_id = %d and is_confirmed = 0 AND inviter_id = %d&quot;, $group_id, $user_id ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of a user's groups, filtered by a search string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string   $filter  Search term. Matches against 'name' and</span>&nbsp;</div></li><li><div><span class="comment">   *                          'description' fields.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int      $user_id ID of the user whose groups are being searched.</span>&nbsp;</div></li><li><div><span class="comment">   *                          Default: the displayed user.</span>&nbsp;</div></li><li><div><span class="comment">   * @param mixed    $order   Not used.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null $limit   Optional. The max number of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                          Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null $page    Optional. The page offset of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                          Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @return false|array {</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array $groups Array of matched and paginated group objects.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int   $total  Total count of groups matching the query.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function filter_user_groups( $filter, $user_id = 0, $order = false, $limit = null, $page = null ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $user_id ) )&nbsp;</div></li><li><div>          $user_id = bp_displayed_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $search_terms_like = '%' . bp_esc_like( $filter ) . '%';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $pag_sql = $order_sql = $hidden_sql = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $limit ) && !empty( $page ) )&nbsp;</div></li><li><div>          $pag_sql = $wpdb-&gt;prepare( &quot; LIMIT %d, %d&quot;, intval( ( $page - 1 ) * $limit), intval( $limit ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get all the group ids for the current user's groups.</span>&nbsp;</div></li><li><div>      $gids = BP_Groups_Member::get_group_ids( $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $gids['groups'] ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $gids = esc_sql( implode( ', ', wp_parse_id_list( $gids['groups'] ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $paged_groups = $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;SELECT id as group_id FROM {$bp-&gt;groups-&gt;table_name} WHERE ( name LIKE %s OR description LIKE %s ) AND id IN ({$gids}) {$pag_sql}&quot;, $search_terms_like, $search_terms_like ) );&nbsp;</div></li><li><div>      $total_groups = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT COUNT(id) FROM {$bp-&gt;groups-&gt;table_name} WHERE ( name LIKE %s OR description LIKE %s ) AND id IN ({$gids})&quot;, $search_terms_like, $search_terms_like ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( 'groups' =&gt; $paged_groups, 'total' =&gt; $total_groups );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of groups, filtered by a search string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string      $filter  Search term. Matches against 'name' and</span>&nbsp;</div></li><li><div><span class="comment">   *                             'description' fields.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null    $limit   Optional. The max number of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                             Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null    $page    Optional. The page offset of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                             Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool $sort_by Column to sort by. Default: false (default</span>&nbsp;</div></li><li><div><span class="comment">   *        sort).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool $order   ASC or DESC. Default: false (default sort).</span>&nbsp;</div></li><li><div><span class="comment">   * @return array {</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array $groups Array of matched and paginated group objects.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int   $total  Total count of groups matching the query.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function search_groups( $filter, $limit = null, $page = null, $sort_by = false, $order = false ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $search_terms_like = '%' . bp_esc_like( $filter ) . '%';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $pag_sql = $order_sql = $hidden_sql = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $limit ) && !empty( $page ) )&nbsp;</div></li><li><div>          $pag_sql = $wpdb-&gt;prepare( &quot; LIMIT %d, %d&quot;, intval( ( $page - 1 ) * $limit), intval( $limit ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $sort_by ) && !empty( $order ) ) {&nbsp;</div></li><li><div>          $sort_by = esc_sql( $sort_by );&nbsp;</div></li><li><div>          $order = esc_sql( $order );&nbsp;</div></li><li><div>          $order_sql = &quot;ORDER BY {$sort_by} {$order}&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !bp_current_user_can( 'bp_moderate' ) )&nbsp;</div></li><li><div>          $hidden_sql = &quot;AND status != 'hidden'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $paged_groups = $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;SELECT id as group_id FROM {$bp-&gt;groups-&gt;table_name} WHERE ( name LIKE %s OR description LIKE %s ) {$hidden_sql} {$order_sql} {$pag_sql}&quot;, $search_terms_like, $search_terms_like ) );&nbsp;</div></li><li><div>      $total_groups = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT COUNT(id) FROM {$bp-&gt;groups-&gt;table_name} WHERE ( name LIKE %s OR description LIKE %s ) {$hidden_sql}&quot;, $search_terms_like, $search_terms_like ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( 'groups' =&gt; $paged_groups, 'total' =&gt; $total_groups );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check for the existence of a slug.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $slug Slug to check.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string|null The slug, if found. Otherwise null.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function check_slug( $slug ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT slug FROM {$bp-&gt;groups-&gt;table_name} WHERE slug = %s&quot;, $slug ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the slug for a given group ID.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string|null The slug, if found. Otherwise null.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_slug( $group_id ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT slug FROM {$bp-&gt;groups-&gt;table_name} WHERE id = %d&quot;, $group_id ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check whether a given group has any members.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool True if the group has members, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function has_members( $group_id ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $members = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT COUNT(id) FROM {$bp-&gt;groups-&gt;table_name_members} WHERE group_id = %d&quot;, $group_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $members ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check whether a group has outstanding membership requests.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @return int|null The number of outstanding requests, or null if</span>&nbsp;</div></li><li><div><span class="comment">   *                  none are found.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function has_membership_requests( $group_id ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT COUNT(id) FROM {$bp-&gt;groups-&gt;table_name_members} WHERE group_id = %d AND is_confirmed = 0&quot;, $group_id ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get outstanding membership requests for a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int      $group_id ID of the group.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null $limit    Optional. Max number of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                           Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null $page     Optional. Page offset of results returned. Default:</span>&nbsp;</div></li><li><div><span class="comment">   *                           null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @return array {</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array $requests The requested page of located requests.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int   $total    Total number of requests outstanding for the</span>&nbsp;</div></li><li><div><span class="comment">   *                           group.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_membership_requests( $group_id, $limit = null, $page = null ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $limit ) && !empty( $page ) ) {&nbsp;</div></li><li><div>          $pag_sql = $wpdb-&gt;prepare( &quot; LIMIT %d, %d&quot;, intval( ( $page - 1 ) * $limit), intval( $limit ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $paged_requests = $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;SELECT * FROM {$bp-&gt;groups-&gt;table_name_members} WHERE group_id = %d AND is_confirmed = 0 AND inviter_id = 0{$pag_sql}&quot;, $group_id ) );&nbsp;</div></li><li><div>      $total_requests = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT COUNT(id) FROM {$bp-&gt;groups-&gt;table_name_members} WHERE group_id = %d AND is_confirmed = 0 AND inviter_id = 0&quot;, $group_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( 'requests' =&gt; $paged_requests, 'total' =&gt; $total_requests );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Query for groups.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @see WP_Meta_Query::queries for a description of the 'meta_query'</span>&nbsp;</div></li><li><div><span class="comment">   *      parameter format.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0 Added `$group_type`, `$group_type__in`, and `$group_type__not_in` parameters.</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0 Added `$update_admin_cache` and `$parent_id` parameters.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $args {</span>&nbsp;</div></li><li><div><span class="comment">   *     Array of parameters. All items are optional.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $type               Optional. Shorthand for certain orderby/order combinations.</span>&nbsp;</div></li><li><div><span class="comment">   *                                            'newest', 'active', 'popular', 'alphabetical', 'random'.</span>&nbsp;</div></li><li><div><span class="comment">   *                                            When present, will override orderby and order params.</span>&nbsp;</div></li><li><div><span class="comment">   *                                            Default: null.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $orderby            Optional. Property to sort by. 'date_created', 'last_activity', </span>&nbsp;</div></li><li><div><span class="comment">   *                                            'total_member_count', 'name', 'random'. Default: 'date_created'.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $order              Optional. Sort order. 'ASC' or 'DESC'. Default: 'DESC'.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $per_page           Optional. Number of items to return per page of results.</span>&nbsp;</div></li><li><div><span class="comment">   *                                            Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $page               Optional. Page offset of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                                            Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int          $user_id            Optional. If provided, results will be limited to groups</span>&nbsp;</div></li><li><div><span class="comment">   *                                            of which the specified user is a member. Default: null.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string       $search_terms       Optional. If provided, only groups whose names or descriptions</span>&nbsp;</div></li><li><div><span class="comment">   *                                            match the search terms will be returned. Default: false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array|string $group_type         Array or comma-separated list of group types to limit results to.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array|string $group_type__in     Array or comma-separated list of group types to limit results to.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array|string $group_type__not_in Array or comma-separated list of group types that will be</span>&nbsp;</div></li><li><div><span class="comment">   *                                            excluded from results.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array        $meta_query         Optional. An array of meta_query conditions.</span>&nbsp;</div></li><li><div><span class="comment">   *                                            See {@link WP_Meta_Query::queries} for description.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array|string $value              Optional. Array or comma-separated list of group IDs. Results</span>&nbsp;</div></li><li><div><span class="comment">   *                                            will be limited to groups within the list. Default: false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array|string $parent_id          Optional. Array or comma-separated list of group IDs. Results</span>&nbsp;</div></li><li><div><span class="comment">   *                                            will be limited to children of the specified groups. Default: null.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array|string $exclude            Optional. Array or comma-separated list of group IDs.</span>&nbsp;</div></li><li><div><span class="comment">   *                                            Results will exclude the listed groups. Default: false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $update_meta_cache  Whether to pre-fetch groupmeta for the returned groups.</span>&nbsp;</div></li><li><div><span class="comment">   *                                            Default: true.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $update_admin_cache Whether to pre-fetch administrator IDs for the returned</span>&nbsp;</div></li><li><div><span class="comment">   *                                            groups. Default: false.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type bool         $show_hidden        Whether to include hidden groups in results. Default: false.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   * @return array {</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array $groups Array of group objects returned by the</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int   $total  Total count of all groups matching non-</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query params.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get( $args = array() ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Backward compatibility with old method of passing arguments.</span>&nbsp;</div></li><li><div>      if ( ! is_array( $args ) || func_num_args() &gt; 1 ) {&nbsp;</div></li><li><div>          _deprecated_argument( __METHOD__, '1.7', sprintf( __( 'Arguments passed to %1$s should be in an associative array. See the inline documentation at %2$s for more details.', 'buddypress' ), __METHOD__, __FILE__ ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $old_args_keys = array(&nbsp;</div></li><li><div>              0 =&gt; 'type', &nbsp;</div></li><li><div>              1 =&gt; 'per_page', &nbsp;</div></li><li><div>              2 =&gt; 'page', &nbsp;</div></li><li><div>              3 =&gt; 'user_id', &nbsp;</div></li><li><div>              4 =&gt; 'search_terms', &nbsp;</div></li><li><div>              5 =&gt; 'include', &nbsp;</div></li><li><div>              6 =&gt; 'populate_extras', &nbsp;</div></li><li><div>              7 =&gt; 'exclude', &nbsp;</div></li><li><div>              8 =&gt; 'show_hidden', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $func_args = func_get_args();&nbsp;</div></li><li><div>          $args = bp_core_parse_args_array( $old_args_keys, $func_args );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $defaults = array(&nbsp;</div></li><li><div>          'type' =&gt; null, &nbsp;</div></li><li><div>          'orderby' =&gt; 'date_created', &nbsp;</div></li><li><div>          'order' =&gt; 'DESC', &nbsp;</div></li><li><div>          'per_page' =&gt; null, &nbsp;</div></li><li><div>          'page' =&gt; null, &nbsp;</div></li><li><div>          'user_id' =&gt; 0, &nbsp;</div></li><li><div>          'search_terms' =&gt; false, &nbsp;</div></li><li><div>          'group_type' =&gt; '', &nbsp;</div></li><li><div>          'group_type__in' =&gt; '', &nbsp;</div></li><li><div>          'group_type__not_in' =&gt; '', &nbsp;</div></li><li><div>          'meta_query' =&gt; false, &nbsp;</div></li><li><div>          'include' =&gt; false, &nbsp;</div></li><li><div>          'parent_id' =&gt; null, &nbsp;</div></li><li><div>          'update_meta_cache' =&gt; true, &nbsp;</div></li><li><div>          'update_admin_cache' =&gt; false, &nbsp;</div></li><li><div>          'exclude' =&gt; false, &nbsp;</div></li><li><div>          'show_hidden' =&gt; false, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $r = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $sql = array(&nbsp;</div></li><li><div>          'select' =&gt; &quot;SELECT DISTINCT g.id&quot;, &nbsp;</div></li><li><div>          'from' =&gt; &quot;{$bp-&gt;groups-&gt;table_name} g&quot;, &nbsp;</div></li><li><div>          'where' =&gt; '', &nbsp;</div></li><li><div>          'orderby' =&gt; '', &nbsp;</div></li><li><div>          'pagination' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $r['user_id'] ) ) {&nbsp;</div></li><li><div>          $sql['from'] .= &quot; JOIN {$bp-&gt;groups-&gt;table_name_members} m ON ( g.id = m.group_id )&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $where_conditions = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $r['show_hidden'] ) ) {&nbsp;</div></li><li><div>          $where_conditions['hidden'] = &quot;g.status != 'hidden'&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $r['search_terms'] ) ) {&nbsp;</div></li><li><div>          $search_terms_like = '%' . bp_esc_like( $r['search_terms'] ) . '%';&nbsp;</div></li><li><div>          $where_conditions['search'] = $wpdb-&gt;prepare( &quot;( g.name LIKE %s OR g.description LIKE %s )&quot;, $search_terms_like, $search_terms_like );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $meta_query_sql = self::get_meta_query_sql( $r['meta_query'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $meta_query_sql['join'] ) ) {&nbsp;</div></li><li><div>          $sql['from'] .= $meta_query_sql['join'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $meta_query_sql['where'] ) ) {&nbsp;</div></li><li><div>          $where_conditions['meta'] = $meta_query_sql['where'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Only use 'group_type__in', if 'group_type' is not set.</span>&nbsp;</div></li><li><div>      if ( empty( $r['group_type'] ) && ! empty( $r['group_type__in']) ) {&nbsp;</div></li><li><div>          $r['group_type'] = $r['group_type__in'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Group types to exclude. This has priority over inclusions.</span>&nbsp;</div></li><li><div>      if ( ! empty( $r['group_type__not_in'] ) ) {&nbsp;</div></li><li><div>          $group_type_clause = self::get_sql_clause_for_group_types( $r['group_type__not_in'], 'NOT IN' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Group types to include.</span>&nbsp;</div></li><li><div>      } elseif ( ! empty( $r['group_type'] ) ) {&nbsp;</div></li><li><div>          $group_type_clause = self::get_sql_clause_for_group_types( $r['group_type'], 'IN' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $group_type_clause ) ) {&nbsp;</div></li><li><div>          $where_conditions['group_type'] = $group_type_clause;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $r['user_id'] ) ) {&nbsp;</div></li><li><div>          $where_conditions['user'] = $wpdb-&gt;prepare( &quot;m.user_id = %d AND m.is_confirmed = 1 AND m.is_banned = 0&quot;, $r['user_id'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $r['include'] ) ) {&nbsp;</div></li><li><div>          $include = implode( ', ', wp_parse_id_list( $r['include'] ) );&nbsp;</div></li><li><div>          $where_conditions['include'] = &quot;g.id IN ({$include})&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_null( $r['parent_id'] ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Note that `wp_parse_id_list()` converts `false` to 0.</span>&nbsp;</div></li><li><div>          $parent_id = implode( ', ', wp_parse_id_list( $r['parent_id'] ) );&nbsp;</div></li><li><div>          $where_conditions['parent_id'] = &quot;g.parent_id IN ({$parent_id})&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $r['exclude'] ) ) {&nbsp;</div></li><li><div>          $exclude = implode( ', ', wp_parse_id_list( $r['exclude'] ) );&nbsp;</div></li><li><div>          $where_conditions['exclude'] = &quot;g.id NOT IN ({$exclude})&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Order/orderby ********************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $order = $r['order'];&nbsp;</div></li><li><div>      $orderby = $r['orderby'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If a 'type' parameter was passed, parse it and overwrite</span>&nbsp;</div></li><li><div>      <span class="comment">// 'order' and 'orderby' params passed to the function.</span>&nbsp;</div></li><li><div>      if (  ! empty( $r['type'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the 'type' parameter used to overwrite 'order' and 'orderby' values.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param array  $value Converted 'type' value for order and orderby.</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $value Parsed 'type' value for the get method.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $order_orderby = apply_filters( 'bp_groups_get_orderby', self::convert_type_to_order_orderby( $r['type'] ), $r['type'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If an invalid type is passed, $order_orderby will be</span>&nbsp;</div></li><li><div>          <span class="comment">// an array with empty values. In this case, we stick</span>&nbsp;</div></li><li><div>          <span class="comment">// with the default values of $order and $orderby.</span>&nbsp;</div></li><li><div>          if ( ! empty( $order_orderby['order'] ) ) {&nbsp;</div></li><li><div>              $order = $order_orderby['order'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $order_orderby['orderby'] ) ) {&nbsp;</div></li><li><div>              $orderby = $order_orderby['orderby'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// 'total_member_count' and 'last_activity' sorts require additional table joins.</span>&nbsp;</div></li><li><div>      if ( 'total_member_count' === $orderby ) {&nbsp;</div></li><li><div>          $sql['from'] .= &quot; JOIN {$bp-&gt;groups-&gt;table_name_groupmeta} gm_total_member_count ON ( g.id = gm_total_member_count.group_id )&quot;;&nbsp;</div></li><li><div>          $where_conditions['total_member_count'] = &quot;gm_total_member_count.meta_key = 'total_member_count'&quot;;&nbsp;</div></li><li><div>      } elseif ( 'last_activity' === $orderby ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $sql['from'] .= &quot; JOIN {$bp-&gt;groups-&gt;table_name_groupmeta} gm_last_activity on ( g.id = gm_last_activity.group_id )&quot;;&nbsp;</div></li><li><div>          $where_conditions['last_activity'] = &quot;gm_last_activity.meta_key = 'last_activity'&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sanitize 'order'.</span>&nbsp;</div></li><li><div>      $order = bp_esc_sql_order( $order );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the converted 'orderby' term.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $value   Converted 'orderby' term.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $orderby Original orderby value.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $value   Parsed 'type' value for the get method.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $orderby = apply_filters( 'bp_groups_get_orderby_converted_by_term', self::convert_orderby_to_order_by_term( $orderby ), $orderby, $r['type'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Random order is a special case.</span>&nbsp;</div></li><li><div>      if ( 'rand()' === $orderby ) {&nbsp;</div></li><li><div>          $sql['orderby'] = &quot;ORDER BY rand()&quot;;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $sql['orderby'] = &quot;ORDER BY {$orderby} {$order}&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $r['per_page'] ) && ! empty( $r['page'] ) && $r['per_page'] != -1 ) {&nbsp;</div></li><li><div>          $sql['pagination'] = $wpdb-&gt;prepare( &quot;LIMIT %d, %d&quot;, intval( ( $r['page'] - 1 ) * $r['per_page']), intval( $r['per_page'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $where = '';&nbsp;</div></li><li><div>      if ( ! empty( $where_conditions ) ) {&nbsp;</div></li><li><div>          $sql['where'] = implode( ' AND ', $where_conditions );&nbsp;</div></li><li><div>          $where = &quot;WHERE {$sql['where']}&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $paged_groups_sql = &quot;{$sql['select']} FROM {$sql['from']} {$where} {$sql['orderby']} {$sql['pagination']}&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the pagination SQL statement.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $value Concatenated SQL statement.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array  $sql   Array of SQL parts before concatenation.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array  $r     Array of parsed arguments for the get method.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $paged_groups_sql = apply_filters( 'bp_groups_get_paged_groups_sql', $paged_groups_sql, $sql, $r );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cached = bp_core_get_incremented_cache( $paged_groups_sql, 'bp_groups' );&nbsp;</div></li><li><div>      if ( false === $cached ) {&nbsp;</div></li><li><div>          $paged_group_ids = $wpdb-&gt;get_col( $paged_groups_sql );&nbsp;</div></li><li><div>          bp_core_set_incremented_cache( $paged_groups_sql, 'bp_groups', $paged_group_ids );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $paged_group_ids = $cached;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $uncached_group_ids = bp_get_non_cached_ids( $paged_group_ids, 'bp_groups' );&nbsp;</div></li><li><div>      if ( $uncached_group_ids ) {&nbsp;</div></li><li><div>          $group_ids_sql = implode( ', ', array_map( 'intval', $uncached_group_ids ) );&nbsp;</div></li><li><div>          $group_data_objects = $wpdb-&gt;get_results( &quot;SELECT g.* FROM {$bp-&gt;groups-&gt;table_name} g WHERE g.id IN ({$group_ids_sql})&quot; );&nbsp;</div></li><li><div>          foreach ( $group_data_objects as $group_data_object ) {&nbsp;</div></li><li><div>              wp_cache_set( $group_data_object-&gt;id, $group_data_object, 'bp_groups' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $paged_groups = array();&nbsp;</div></li><li><div>      foreach ( $paged_group_ids as $paged_group_id ) {&nbsp;</div></li><li><div>          $paged_groups[] = new BP_Groups_Group( $paged_group_id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $total_groups_sql = &quot;SELECT COUNT(DISTINCT g.id) FROM {$sql['from']} $where&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the SQL used to retrieve total group results.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $t_sql     Concatenated SQL statement used for retrieving total group results.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array  $total_sql Array of SQL parts for the query.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array  $r         Array of parsed arguments for the get method.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $total_groups_sql = apply_filters( 'bp_groups_get_total_groups_sql', $total_groups_sql, $sql, $r );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $cached = bp_core_get_incremented_cache( $total_groups_sql, 'bp_groups' );&nbsp;</div></li><li><div>      if ( false === $cached ) {&nbsp;</div></li><li><div>          $total_groups = (int) $wpdb-&gt;get_var( $total_groups_sql );&nbsp;</div></li><li><div>          bp_core_set_incremented_cache( $total_groups_sql, 'bp_groups', $total_groups );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $total_groups = (int) $cached;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $group_ids = array();&nbsp;</div></li><li><div>      foreach ( (array) $paged_groups as $group ) {&nbsp;</div></li><li><div>          $group_ids[] = $group-&gt;id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Grab all groupmeta.</span>&nbsp;</div></li><li><div>      if ( ! empty( $r['update_meta_cache'] ) ) {&nbsp;</div></li><li><div>          bp_groups_update_meta_cache( $group_ids );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Prefetch all administrator IDs, if requested.</span>&nbsp;</div></li><li><div>      if ( $r['update_admin_cache'] ) {&nbsp;</div></li><li><div>          BP_Groups_Member::prime_group_admins_mods_cache( $group_ids );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Set up integer properties needing casting.</span>&nbsp;</div></li><li><div>      $int_props = array(&nbsp;</div></li><li><div>          'id', 'creator_id', 'enable_forum'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Integer casting.</span>&nbsp;</div></li><li><div>      foreach ( $paged_groups as $key =&gt; $g ) {&nbsp;</div></li><li><div>          foreach ( $int_props as $int_prop ) {&nbsp;</div></li><li><div>              $paged_groups[ $key ]-&gt;{$int_prop} = (int) $paged_groups[ $key ]-&gt;{$int_prop};&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      unset( $sql, $total_sql );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( 'groups' =&gt; $paged_groups, 'total' =&gt; $total_groups );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the SQL for the 'meta_query' param in BP_Activity_Activity::get()</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * We use WP_Meta_Query to do the heavy lifting of parsing the</span>&nbsp;</div></li><li><div><span class="comment">   * meta_query array and creating the necessary SQL clauses.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.8.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $meta_query An array of meta_query filters. See the</span>&nbsp;</div></li><li><div><span class="comment">   *                          documentation for {@link WP_Meta_Query} for details.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array $sql_array 'join' and 'where' clauses.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected static function get_meta_query_sql( $meta_query = array() ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $sql_array = array(&nbsp;</div></li><li><div>          'join' =&gt; '', &nbsp;</div></li><li><div>          'where' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $meta_query ) ) {&nbsp;</div></li><li><div>          $groups_meta_query = new WP_Meta_Query( $meta_query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// WP_Meta_Query expects the table name at</span>&nbsp;</div></li><li><div>          <span class="comment">// $wpdb-&gt;group.</span>&nbsp;</div></li><li><div>          $wpdb-&gt;groupmeta = buddypress()-&gt;groups-&gt;table_name_groupmeta;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $meta_sql = $groups_meta_query-&gt;get_sql( 'group', 'g', 'id' );&nbsp;</div></li><li><div>          $sql_array['join'] = $meta_sql['join'];&nbsp;</div></li><li><div>          $sql_array['where'] = self::strip_leading_and( $meta_sql['where'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $sql_array;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Convert the 'type' parameter to 'order' and 'orderby'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.8.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type The 'type' shorthand param.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array {</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $order   SQL-friendly order string.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type string $orderby SQL-friendly orderby column name.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected static function convert_type_to_order_orderby( $type = '' ) {&nbsp;</div></li><li><div>      $order = $orderby = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $type ) {&nbsp;</div></li><li><div>          case 'newest' :&nbsp;</div></li><li><div>              $order = 'DESC';&nbsp;</div></li><li><div>              $orderby = 'date_created';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'active' :&nbsp;</div></li><li><div>              $order = 'DESC';&nbsp;</div></li><li><div>              $orderby = 'last_activity';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'popular' :&nbsp;</div></li><li><div>              $order = 'DESC';&nbsp;</div></li><li><div>              $orderby = 'total_member_count';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'alphabetical' :&nbsp;</div></li><li><div>              $order = 'ASC';&nbsp;</div></li><li><div>              $orderby = 'name';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'random' :&nbsp;</div></li><li><div>              $order = '';&nbsp;</div></li><li><div>              $orderby = 'random';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( 'order' =&gt; $order, 'orderby' =&gt; $orderby );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of groups, sorted by those that have the most legacy forum topics.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null          $limit           Optional. The max number of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                                           Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null          $page            Optional. The page offset of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                                           Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int               $user_id         Optional. If present, groups will be limited to</span>&nbsp;</div></li><li><div><span class="comment">   *                                           those of which the specified user is a member.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool       $search_terms    Optional. Limit groups to those whose name</span>&nbsp;</div></li><li><div><span class="comment">   *                                           or description field contain the search string.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool              $populate_extras Optional. Whether to fetch extra</span>&nbsp;</div></li><li><div><span class="comment">   *                                           information about the groups. Default: true.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array|bool $exclude         Optional. Array or comma-separated list of group</span>&nbsp;</div></li><li><div><span class="comment">   *                                           IDs to exclude from results.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array {</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array $groups Array of group objects returned by the</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int   $total  Total count of all groups matching non-</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query params.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_by_most_forum_topics( $limit = null, $page = null, $user_id = 0, $search_terms = false, $populate_extras = true, $exclude = false ) {&nbsp;</div></li><li><div>      global $wpdb, $bbdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $bbdb ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** This action is documented in bp-forums/bp-forums-screens */</span></span>&nbsp;</div></li><li><div>          do_action( 'bbpress_init' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $limit ) && !empty( $page ) ) {&nbsp;</div></li><li><div>          $pag_sql = $wpdb-&gt;prepare( &quot; LIMIT %d, %d&quot;, intval( ( $page - 1 ) * $limit), intval( $limit ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !is_user_logged_in() || ( !bp_current_user_can( 'bp_moderate' ) && ( $user_id != bp_loggedin_user_id() ) ) )&nbsp;</div></li><li><div>          $hidden_sql = &quot; AND g.status != 'hidden'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $search_terms ) ) {&nbsp;</div></li><li><div>          $search_terms_like = '%' . bp_esc_like( $search_terms ) . '%';&nbsp;</div></li><li><div>          $search_sql = $wpdb-&gt;prepare( ' AND ( g.name LIKE %s OR g.description LIKE %s ) ', $search_terms_like, $search_terms_like );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $exclude ) ) {&nbsp;</div></li><li><div>          $exclude = implode( ', ', wp_parse_id_list( $exclude ) );&nbsp;</div></li><li><div>          $exclude_sql = &quot; AND g.id NOT IN ({$exclude})&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $user_id ) ) {&nbsp;</div></li><li><div>          $user_id = absint( esc_sql( $user_id ) );&nbsp;</div></li><li><div>          $paged_groups = $wpdb-&gt;get_results( &quot;SELECT DISTINCT g.*, gm1.meta_value as total_member_count, gm2.meta_value as last_activity FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name_groupmeta} gm3, {$bp-&gt;groups-&gt;table_name_members} m, {$bbdb-&gt;forums} f, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = m.group_id AND g.id = gm1.group_id AND g.id = gm2.group_id AND g.id = gm3.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND (gm3.meta_key = 'forum_id' AND gm3.meta_value = f.forum_id) AND f.topics &gt; 0 {$hidden_sql} {$search_sql} AND m.user_id = {$user_id} AND m.is_confirmed = 1 AND m.is_banned = 0 {$exclude_sql} ORDER BY f.topics DESC {$pag_sql}&quot; );&nbsp;</div></li><li><div>          $total_groups = $wpdb-&gt;get_var( &quot;SELECT COUNT(DISTINCT g.id) FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name_groupmeta} gm3, {$bbdb-&gt;forums} f, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = gm1.group_id AND g.id = gm2.group_id AND g.id = gm3.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND (gm3.meta_key = 'forum_id' AND gm3.meta_value = f.forum_id) AND f.topics &gt; 0 {$hidden_sql} {$search_sql} AND m.user_id = {$user_id} AND m.is_confirmed = 1 AND m.is_banned = 0 {$exclude_sql}&quot; );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $paged_groups = $wpdb-&gt;get_results( &quot;SELECT DISTINCT g.*, gm1.meta_value as total_member_count, gm2.meta_value as last_activity FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name_groupmeta} gm3, {$bbdb-&gt;forums} f, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = gm1.group_id AND g.id = gm2.group_id AND g.id = gm3.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND (gm3.meta_key = 'forum_id' AND gm3.meta_value = f.forum_id) AND f.topics &gt; 0 {$hidden_sql} {$search_sql} {$exclude_sql} ORDER BY f.topics DESC {$pag_sql}&quot; );&nbsp;</div></li><li><div>          $total_groups = $wpdb-&gt;get_var( &quot;SELECT COUNT(DISTINCT g.id) FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name_groupmeta} gm3, {$bbdb-&gt;forums} f, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = gm1.group_id AND g.id = gm2.group_id AND g.id = gm3.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND (gm3.meta_key = 'forum_id' AND gm3.meta_value = f.forum_id) AND f.topics &gt; 0 {$hidden_sql} {$search_sql} {$exclude_sql}&quot; );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $populate_extras ) ) {&nbsp;</div></li><li><div>          foreach ( (array) $paged_groups as $group ) {&nbsp;</div></li><li><div>              $group_ids[] = $group-&gt;id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $paged_groups = BP_Groups_Group::get_group_extras( $paged_groups, $group_ids, 'newest' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( 'groups' =&gt; $paged_groups, 'total' =&gt; $total_groups );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Convert the 'orderby' param into a proper SQL term/column.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.8.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $orderby Orderby term as passed to get().</span>&nbsp;</div></li><li><div><span class="comment">   * @return string $order_by_term SQL-friendly orderby term.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected static function convert_orderby_to_order_by_term( $orderby ) {&nbsp;</div></li><li><div>      $order_by_term = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $orderby ) {&nbsp;</div></li><li><div>          case 'date_created' :&nbsp;</div></li><li><div>          default :&nbsp;</div></li><li><div>              $order_by_term = 'g.date_created';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'last_activity' :&nbsp;</div></li><li><div>              $order_by_term = 'gm_last_activity.meta_value';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'total_member_count' :&nbsp;</div></li><li><div>              $order_by_term = 'CONVERT(gm_total_member_count.meta_value, SIGNED)';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'name' :&nbsp;</div></li><li><div>              $order_by_term = 'g.name';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'random' :&nbsp;</div></li><li><div>              $order_by_term = 'rand()';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $order_by_term;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of groups, sorted by those that have the most legacy forum posts.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null          $limit           Optional. The max number of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                                           Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null          $page            Optional. The page offset of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                                           Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool       $search_terms    Optional. Limit groups to those whose name</span>&nbsp;</div></li><li><div><span class="comment">   *                                           or description field contain the search string.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool              $populate_extras Optional. Whether to fetch extra</span>&nbsp;</div></li><li><div><span class="comment">   *                                           information about the groups. Default: true.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array|bool $exclude         Optional. Array or comma-separated list of group</span>&nbsp;</div></li><li><div><span class="comment">   *                                           IDs to exclude from results.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array {</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array $groups Array of group objects returned by the</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int   $total  Total count of all groups matching non-</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query params.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_by_most_forum_posts( $limit = null, $page = null, $search_terms = false, $populate_extras = true, $exclude = false ) {&nbsp;</div></li><li><div>      global $wpdb, $bbdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $bbdb ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** This action is documented in bp-forums/bp-forums-screens */</span></span>&nbsp;</div></li><li><div>          do_action( 'bbpress_init' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $limit ) && !empty( $page ) ) {&nbsp;</div></li><li><div>          $pag_sql = $wpdb-&gt;prepare( &quot; LIMIT %d, %d&quot;, intval( ( $page - 1 ) * $limit), intval( $limit ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !is_user_logged_in() || ( !bp_current_user_can( 'bp_moderate' ) && ( $user_id != bp_loggedin_user_id() ) ) )&nbsp;</div></li><li><div>          $hidden_sql = &quot; AND g.status != 'hidden'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $search_terms ) ) {&nbsp;</div></li><li><div>          $search_terms_like = '%' . bp_esc_like( $search_terms ) . '%';&nbsp;</div></li><li><div>          $search_sql = $wpdb-&gt;prepare( ' AND ( g.name LIKE %s OR g.description LIKE %s ) ', $search_terms_like, $search_terms_like );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $exclude ) ) {&nbsp;</div></li><li><div>          $exclude = implode( ', ', wp_parse_id_list( $exclude ) );&nbsp;</div></li><li><div>          $exclude_sql = &quot; AND g.id NOT IN ({$exclude})&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $user_id ) ) {&nbsp;</div></li><li><div>          $user_id = esc_sql( $user_id );&nbsp;</div></li><li><div>          $paged_groups = $wpdb-&gt;get_results( &quot;SELECT DISTINCT g.*, gm1.meta_value as total_member_count, gm2.meta_value as last_activity FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name_groupmeta} gm3, {$bp-&gt;groups-&gt;table_name_members} m, {$bbdb-&gt;forums} f, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = m.group_id AND g.id = gm1.group_id AND g.id = gm2.group_id AND g.id = gm3.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND (gm3.meta_key = 'forum_id' AND gm3.meta_value = f.forum_id) {$hidden_sql} {$search_sql} AND m.user_id = {$user_id} AND m.is_confirmed = 1 AND m.is_banned = 0 {$exclude_sql} ORDER BY f.posts ASC {$pag_sql}&quot; );&nbsp;</div></li><li><div>          $total_groups = $wpdb-&gt;get_results( &quot;SELECT COUNT(DISTINCT g.id) FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name_groupmeta} gm3, {$bp-&gt;groups-&gt;table_name_members} m, {$bbdb-&gt;forums} f, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = m.group_id AND g.id = gm1.group_id AND g.id = gm2.group_id AND g.id = gm3.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND (gm3.meta_key = 'forum_id' AND gm3.meta_value = f.forum_id) AND f.posts &gt; 0 {$hidden_sql} {$search_sql} AND m.user_id = {$user_id} AND m.is_confirmed = 1 AND m.is_banned = 0 {$exclude_sql} &quot; );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $paged_groups = $wpdb-&gt;get_results( &quot;SELECT DISTINCT g.*, gm1.meta_value as total_member_count, gm2.meta_value as last_activity FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name_groupmeta} gm3, {$bbdb-&gt;forums} f, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = gm1.group_id AND g.id = gm2.group_id AND g.id = gm3.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND (gm3.meta_key = 'forum_id' AND gm3.meta_value = f.forum_id) AND f.posts &gt; 0 {$hidden_sql} {$search_sql} {$exclude_sql} ORDER BY f.posts ASC {$pag_sql}&quot; );&nbsp;</div></li><li><div>          $total_groups = $wpdb-&gt;get_var( &quot;SELECT COUNT(DISTINCT g.id) FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name_groupmeta} gm3, {$bbdb-&gt;forums} f, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = gm1.group_id AND g.id = gm2.group_id AND g.id = gm3.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND (gm3.meta_key = 'forum_id' AND gm3.meta_value = f.forum_id) {$hidden_sql} {$search_sql} {$exclude_sql}&quot; );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $populate_extras ) ) {&nbsp;</div></li><li><div>          foreach ( (array) $paged_groups as $group ) {&nbsp;</div></li><li><div>              $group_ids[] = $group-&gt;id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $paged_groups = BP_Groups_Group::get_group_extras( $paged_groups, $group_ids, 'newest' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( 'groups' =&gt; $paged_groups, 'total' =&gt; $total_groups );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of groups whose names start with a given letter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string            $letter          The letter.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null          $limit           Optional. The max number of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                                           Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null          $page            Optional. The page offset of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                                           Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool              $populate_extras Optional. Whether to fetch extra</span>&nbsp;</div></li><li><div><span class="comment">   *                                           information about the groups. Default: true.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array|bool $exclude         Optional. Array or comma-separated list of group</span>&nbsp;</div></li><li><div><span class="comment">   *                                           IDs to exclude from results.</span>&nbsp;</div></li><li><div><span class="comment">   * @return false|array {</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array $groups Array of group objects returned by the</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int   $total  Total count of all groups matching non-</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query params.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_by_letter( $letter, $limit = null, $page = null, $populate_extras = true, $exclude = false ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $pag_sql = $hidden_sql = $exclude_sql = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Multibyte compliance.</span>&nbsp;</div></li><li><div>      if ( function_exists( 'mb_strlen' ) ) {&nbsp;</div></li><li><div>          if ( mb_strlen( $letter, 'UTF-8' ) &gt; 1 || is_numeric( $letter ) || !$letter ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( strlen( $letter ) &gt; 1 || is_numeric( $letter ) || !$letter ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $exclude ) ) {&nbsp;</div></li><li><div>          $exclude = implode( ', ', wp_parse_id_list( $exclude ) );&nbsp;</div></li><li><div>          $exclude_sql = &quot; AND g.id NOT IN ({$exclude})&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !bp_current_user_can( 'bp_moderate' ) )&nbsp;</div></li><li><div>          $hidden_sql = &quot; AND status != 'hidden'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $letter_like = bp_esc_like( $letter ) . '%';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $limit ) && !empty( $page ) ) {&nbsp;</div></li><li><div>          $pag_sql = $wpdb-&gt;prepare( &quot; LIMIT %d, %d&quot;, intval( ( $page - 1 ) * $limit), intval( $limit ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $total_groups = $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT COUNT(DISTINCT g.id) FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = gm1.group_id AND g.id = gm2.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND g.name LIKE %s {$hidden_sql} {$exclude_sql}&quot;, $letter_like ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $paged_groups = $wpdb-&gt;get_results( $wpdb-&gt;prepare( &quot;SELECT g.*, gm1.meta_value as total_member_count, gm2.meta_value as last_activity FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = gm1.group_id AND g.id = gm2.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' AND g.name LIKE %s {$hidden_sql} {$exclude_sql} ORDER BY g.name ASC {$pag_sql}&quot;, $letter_like ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $populate_extras ) ) {&nbsp;</div></li><li><div>          foreach ( (array) $paged_groups as $group ) {&nbsp;</div></li><li><div>              $group_ids[] = $group-&gt;id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $paged_groups = BP_Groups_Group::get_group_extras( $paged_groups, $group_ids, 'newest' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( 'groups' =&gt; $paged_groups, 'total' =&gt; $total_groups );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a list of random groups.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Use BP_Groups_Group::get() with 'type' = 'random' instead.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null          $limit           Optional. The max number of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                                           Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int|null          $page            Optional. The page offset of results to return.</span>&nbsp;</div></li><li><div><span class="comment">   *                                           Default: null (no limit).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int               $user_id         Optional. If present, groups will be limited to</span>&nbsp;</div></li><li><div><span class="comment">   *                                           those of which the specified user is a member.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool       $search_terms    Optional. Limit groups to those whose name</span>&nbsp;</div></li><li><div><span class="comment">   *                                           or description field contain the search string.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool              $populate_extras Optional. Whether to fetch extra</span>&nbsp;</div></li><li><div><span class="comment">   *                                           information about the groups. Default: true.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array|bool $exclude         Optional. Array or comma-separated list of group</span>&nbsp;</div></li><li><div><span class="comment">   *                                           IDs to exclude from results.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array {</span>&nbsp;</div></li><li><div><span class="comment">   *     @type array $groups Array of group objects returned by the</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query.</span>&nbsp;</div></li><li><div><span class="comment">   *     @type int   $total  Total count of all groups matching non-</span>&nbsp;</div></li><li><div><span class="comment">   *                         paginated query params.</span>&nbsp;</div></li><li><div><span class="comment">   * }</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_random( $limit = null, $page = null, $user_id = 0, $search_terms = false, $populate_extras = true, $exclude = false ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $pag_sql = $hidden_sql = $search_sql = $exclude_sql = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $limit ) && !empty( $page ) )&nbsp;</div></li><li><div>          $pag_sql = $wpdb-&gt;prepare( &quot; LIMIT %d, %d&quot;, intval( ( $page - 1 ) * $limit), intval( $limit ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !is_user_logged_in() || ( !bp_current_user_can( 'bp_moderate' ) && ( $user_id != bp_loggedin_user_id() ) ) )&nbsp;</div></li><li><div>          $hidden_sql = &quot;AND g.status != 'hidden'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $search_terms ) ) {&nbsp;</div></li><li><div>          $search_terms_like = '%' . bp_esc_like( $search_terms ) . '%';&nbsp;</div></li><li><div>          $search_sql = $wpdb-&gt;prepare( &quot; AND ( g.name LIKE %s OR g.description LIKE %s )&quot;, $search_terms_like, $search_terms_like );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $exclude ) ) {&nbsp;</div></li><li><div>          $exclude = wp_parse_id_list( $exclude );&nbsp;</div></li><li><div>          $exclude = esc_sql( implode( ', ', $exclude ) );&nbsp;</div></li><li><div>          $exclude_sql = &quot; AND g.id NOT IN ({$exclude})&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $user_id ) ) {&nbsp;</div></li><li><div>          $user_id = esc_sql( $user_id );&nbsp;</div></li><li><div>          $paged_groups = $wpdb-&gt;get_results( &quot;SELECT g.*, gm1.meta_value as total_member_count, gm2.meta_value as last_activity FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name_members} m, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = m.group_id AND g.id = gm1.group_id AND g.id = gm2.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' {$hidden_sql} {$search_sql} AND m.user_id = {$user_id} AND m.is_confirmed = 1 AND m.is_banned = 0 {$exclude_sql} ORDER BY rand() {$pag_sql}&quot; );&nbsp;</div></li><li><div>          $total_groups = $wpdb-&gt;get_var( &quot;SELECT COUNT(DISTINCT m.group_id) FROM {$bp-&gt;groups-&gt;table_name_members} m LEFT JOIN {$bp-&gt;groups-&gt;table_name_groupmeta} gm ON m.group_id = gm.group_id INNER JOIN {$bp-&gt;groups-&gt;table_name} g ON m.group_id = g.id WHERE gm.meta_key = 'last_activity'{$hidden_sql} {$search_sql} AND m.user_id = {$user_id} AND m.is_confirmed = 1 AND m.is_banned = 0 {$exclude_sql}&quot; );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $paged_groups = $wpdb-&gt;get_results( &quot;SELECT g.*, gm1.meta_value as total_member_count, gm2.meta_value as last_activity FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm1, {$bp-&gt;groups-&gt;table_name_groupmeta} gm2, {$bp-&gt;groups-&gt;table_name} g WHERE g.id = gm1.group_id AND g.id = gm2.group_id AND gm2.meta_key = 'last_activity' AND gm1.meta_key = 'total_member_count' {$hidden_sql} {$search_sql} {$exclude_sql} ORDER BY rand() {$pag_sql}&quot; );&nbsp;</div></li><li><div>          $total_groups = $wpdb-&gt;get_var( &quot;SELECT COUNT(DISTINCT g.id) FROM {$bp-&gt;groups-&gt;table_name_groupmeta} gm INNER JOIN {$bp-&gt;groups-&gt;table_name} g ON gm.group_id = g.id WHERE gm.meta_key = 'last_activity'{$hidden_sql} {$search_sql} {$exclude_sql}&quot; );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $populate_extras ) ) {&nbsp;</div></li><li><div>          foreach ( (array) $paged_groups as $group ) {&nbsp;</div></li><li><div>              $group_ids[] = $group-&gt;id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $paged_groups = BP_Groups_Group::get_group_extras( $paged_groups, $group_ids, 'newest' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array( 'groups' =&gt; $paged_groups, 'total' =&gt; $total_groups );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fetch extra data for a list of groups.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This method is used throughout the class, by methods that take a</span>&nbsp;</div></li><li><div><span class="comment">   * $populate_extras parameter.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Data fetched:</span>&nbsp;</div></li><li><div><span class="comment">   *     - Logged-in user's status within each group (is_member, </span>&nbsp;</div></li><li><div><span class="comment">   *       is_confirmed, is_pending, is_banned)</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array        $paged_groups Array of groups.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|array $group_ids    Array or comma-separated list of IDs matching</span>&nbsp;</div></li><li><div><span class="comment">   *                                   $paged_groups.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool  $type         Not used.</span>&nbsp;</div></li><li><div><span class="comment">   * @return array $paged_groups</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_group_extras( &$paged_groups, &$group_ids, $type = false ) {&nbsp;</div></li><li><div>      $user_id = bp_loggedin_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $paged_groups as &$group ) {&nbsp;</div></li><li><div>          $group-&gt;is_member = groups_is_user_member( $user_id, $group-&gt;id )  ? 1 : 0;&nbsp;</div></li><li><div>          $group-&gt;is_invited = groups_is_user_invited( $user_id, $group-&gt;id ) ? 1 : 0;&nbsp;</div></li><li><div>          $group-&gt;is_pending = groups_is_user_pending( $user_id, $group-&gt;id ) ? 1 : 0;&nbsp;</div></li><li><div>          $group-&gt;is_banned = (bool) groups_is_user_banned( $user_id, $group-&gt;id );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $paged_groups;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Delete all invitations to a given group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group whose invitations are being deleted.</span>&nbsp;</div></li><li><div><span class="comment">   * @return int|null Number of rows records deleted on success, null on</span>&nbsp;</div></li><li><div><span class="comment">   *                  failure.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function delete_all_invites( $group_id ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $wpdb-&gt;query( $wpdb-&gt;prepare( &quot;DELETE FROM {$bp-&gt;groups-&gt;table_name_members} WHERE group_id = %d AND invite_sent = 1&quot;, $group_id ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a total group count for the site.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Will include hidden groups in the count only if</span>&nbsp;</div></li><li><div><span class="comment">   * current_user_can( 'bp_moderate' ).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Group count.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_total_group_count() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $hidden_sql = '';&nbsp;</div></li><li><div>      if ( !bp_current_user_can( 'bp_moderate' ) )&nbsp;</div></li><li><div>          $hidden_sql = &quot;WHERE status != 'hidden'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $wpdb-&gt;get_var( &quot;SELECT COUNT(id) FROM {$bp-&gt;groups-&gt;table_name} {$hidden_sql}&quot; );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get global count of forum topics in public groups (legacy forums).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type Optional. If 'unreplied', count will be limited to</span>&nbsp;</div></li><li><div><span class="comment">   *                     those topics that have received no replies.</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Forum topic count.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_global_forum_topic_count( $type ) {&nbsp;</div></li><li><div>      global $bbdb, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'unreplied' == $type )&nbsp;</div></li><li><div>          $bp-&gt;groups-&gt;filter_sql = ' AND t.topic_posts = 1';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the portion of the SQL related to global count of forum topics in public groups.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * See https://buddypress.trac.wordpress.org/ticket/4306.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $filter_sql SQL portion for the query.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $type       Type of forum topics to query for.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $extra_sql = apply_filters( 'get_global_forum_topic_count_extra_sql', $bp-&gt;groups-&gt;filter_sql, $type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Make sure the $extra_sql begins with an AND.</span>&nbsp;</div></li><li><div>      if ( 'AND' != substr( trim( strtoupper( $extra_sql ) ), 0, 3 ) )&nbsp;</div></li><li><div>          $extra_sql = ' AND ' . $extra_sql;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $wpdb-&gt;get_var( &quot;SELECT COUNT(t.topic_id) FROM {$bbdb-&gt;topics} AS t, {$bp-&gt;groups-&gt;table_name} AS g LEFT JOIN {$bp-&gt;groups-&gt;table_name_groupmeta} AS gm ON g.id = gm.group_id WHERE (gm.meta_key = 'forum_id' AND gm.meta_value = t.forum_id) AND g.status = 'public' AND t.topic_status = '0' AND t.topic_sticky != '2' {$extra_sql} &quot; );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the member count for a group.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id Group ID.</span>&nbsp;</div></li><li><div><span class="comment">   * @return int Count of confirmed members for the group.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_total_member_count( $group_id ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $wpdb-&gt;get_var( $wpdb-&gt;prepare( &quot;SELECT COUNT(id) FROM {$bp-&gt;groups-&gt;table_name_members} WHERE group_id = %d AND is_confirmed = 1 AND is_banned = 0&quot;, $group_id ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a total count of all topics of a given status, across groups/forums.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string      $status       Which group type to count. 'public', 'private', </span>&nbsp;</div></li><li><div><span class="comment">   *                                  'hidden', or 'all'. Default: 'public'.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string|bool $search_terms Provided search terms.</span>&nbsp;</div></li><li><div><span class="comment">   * @return int The topic count</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_global_topic_count( $status = 'public', $search_terms = false ) {&nbsp;</div></li><li><div>      global $bbdb, $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $status ) {&nbsp;</div></li><li><div>          case 'all' :&nbsp;</div></li><li><div>              $status_sql = '';&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'hidden' :&nbsp;</div></li><li><div>              $status_sql = &quot;AND g.status = 'hidden'&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'private' :&nbsp;</div></li><li><div>              $status_sql = &quot;AND g.status = 'private'&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'public' :&nbsp;</div></li><li><div>          default :&nbsp;</div></li><li><div>              $status_sql = &quot;AND g.status = 'public'&quot;;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $sql = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $sql['select'] = &quot;SELECT COUNT(t.topic_id)&quot;;&nbsp;</div></li><li><div>      $sql['from'] = &quot;FROM {$bbdb-&gt;topics} AS t INNER JOIN {$bp-&gt;groups-&gt;table_name_groupmeta} AS gm ON t.forum_id = gm.meta_value INNER JOIN {$bp-&gt;groups-&gt;table_name} AS g ON gm.group_id = g.id&quot;;&nbsp;</div></li><li><div>      $sql['where'] = &quot;WHERE gm.meta_key = 'forum_id' {$status_sql} AND t.topic_status = '0' AND t.topic_sticky != '2'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $search_terms ) ) {&nbsp;</div></li><li><div>          $search_terms_like = '%' . bp_esc_like( $search_terms ) . '%';&nbsp;</div></li><li><div>          $sql['where'] .= $wpdb-&gt;prepare( &quot; AND ( t.topic_title LIKE %s )&quot;, $search_terms_like );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $wpdb-&gt;get_var( implode( ' ', $sql ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get an array containing ids for each group type.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * A bit of a kludge workaround for some issues</span>&nbsp;</div></li><li><div><span class="comment">   * with bp_has_groups().</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_group_type_ids() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>      $ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $ids['all'] = $wpdb-&gt;get_col( &quot;SELECT id FROM {$bp-&gt;groups-&gt;table_name}&quot; );&nbsp;</div></li><li><div>      $ids['public'] = $wpdb-&gt;get_col( &quot;SELECT id FROM {$bp-&gt;groups-&gt;table_name} WHERE status = 'public'&quot; );&nbsp;</div></li><li><div>      $ids['private'] = $wpdb-&gt;get_col( &quot;SELECT id FROM {$bp-&gt;groups-&gt;table_name} WHERE status = 'private'&quot; );&nbsp;</div></li><li><div>      $ids['hidden'] = $wpdb-&gt;get_col( &quot;SELECT id FROM {$bp-&gt;groups-&gt;table_name} WHERE status = 'hidden'&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $ids;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get SQL clause for group type(s).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string|array $group_types Group type(s).</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string       $operator    'IN' or 'NOT IN'.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string       $clause      SQL clause.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected static function get_sql_clause_for_group_types( $group_types, $operator ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sanitize operator.</span>&nbsp;</div></li><li><div>      if ( 'NOT IN' !== $operator ) {&nbsp;</div></li><li><div>          $operator = 'IN';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Parse and sanitize types.</span>&nbsp;</div></li><li><div>      if ( ! is_array( $group_types ) ) {&nbsp;</div></li><li><div>          $group_types = preg_split( '/[, \s+]/', $group_types );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $types = array();&nbsp;</div></li><li><div>      foreach ( $group_types as $gt ) {&nbsp;</div></li><li><div>          if ( bp_groups_get_group_type_object( $gt ) ) {&nbsp;</div></li><li><div>              $types[] = $gt;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $tax_query = new WP_Tax_Query( array(&nbsp;</div></li><li><div>          array(&nbsp;</div></li><li><div>              'taxonomy' =&gt; 'bp_group_type', &nbsp;</div></li><li><div>              'field' =&gt; 'name', &nbsp;</div></li><li><div>              'operator' =&gt; $operator, &nbsp;</div></li><li><div>              'terms' =&gt; $types, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $site_id = bp_get_taxonomy_term_site_id( 'bp_group_type' );&nbsp;</div></li><li><div>      $switched = false;&nbsp;</div></li><li><div>      if ( $site_id !== get_current_blog_id() ) {&nbsp;</div></li><li><div>          switch_to_blog( $site_id );&nbsp;</div></li><li><div>          $switched = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $sql_clauses = $tax_query-&gt;get_sql( 'g', 'id' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $clause = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// The no_results clauses are the same between IN and NOT IN.</span>&nbsp;</div></li><li><div>      if ( false !== strpos( $sql_clauses['where'], '0 = 1' ) ) {&nbsp;</div></li><li><div>          $clause = self::strip_leading_and( $sql_clauses['where'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// The tax_query clause generated for NOT IN can be used almost as-is.</span>&nbsp;</div></li><li><div>      } elseif ( 'NOT IN' === $operator ) {&nbsp;</div></li><li><div>          $clause = self::strip_leading_and( $sql_clauses['where'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// IN clauses must be converted to a subquery.</span>&nbsp;</div></li><li><div>      } elseif ( preg_match( '/' . $wpdb-&gt;term_relationships . '\.term_taxonomy_id IN \([0-9, ]+\)/', $sql_clauses['where'], $matches ) ) {&nbsp;</div></li><li><div>          $clause = &quot; g.id IN ( SELECT object_id FROM $wpdb-&gt;term_relationships WHERE {$matches[0]} )&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $switched ) {&nbsp;</div></li><li><div>          restore_current_blog();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $clause;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Strips the leading AND and any surrounding whitespace from a string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Used here to normalize SQL fragments generated by `WP_Meta_Query` and</span>&nbsp;</div></li><li><div><span class="comment">   * other utility classes.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.7.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $s String.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected static function strip_leading_and( $s ) {&nbsp;</div></li><li><div>      return preg_replace( '/^\s*AND\s*/', '', $s );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>