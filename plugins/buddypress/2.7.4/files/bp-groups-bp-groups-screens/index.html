<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.7.4" data-slug="buddypress" data-type="file" data-id="49292"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-groups-bp-groups-screens | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.7.4" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.25"}};!function(e,n,t){var a;function i(e){var t=n.createElement("canvas"),a=t.getContext&&t.getContext("2d"),i=String.fromCharCode;return!(!a||!a.fillText)&&(a.textBaseline="top",a.font="600 32px Arial","flag"===e?(a.fillText(i(55356,56806,55356,56826),0,0),3e3<t.toDataURL().length):"diversity"===e?(a.fillText(i(55356,57221),0,0),t=a.getImageData(16,16,1,1).data,a.fillText(i(55356,57221,55356,57343),0,0),(t=a.getImageData(16,16,1,1).data)[0],t[1],t[2],t[3],!0):("simple"===e?a.fillText(i(55357,56835),0,0):a.fillText(i(55356,57135),0,0),0!==a.getImageData(16,16,1,1).data[0]))}function o(e){var t=n.createElement("script");t.src=e,t.type="text/javascript",n.getElementsByTagName("head")[0].appendChild(t)}t.supports={simple:i("simple"),flag:i("flag"),unicode8:i("unicode8"),diversity:i("diversity")},t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.simple&&t.supports.flag&&t.supports.unicode8&&t.supports.diversity||(a=function(){t.readyCallback()},n.addEventListener?(n.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1)):(e.attachEvent("onload",a),n.attachEvent("onreadystatechange",function(){"complete"===n.readyState&&t.readyCallback()})),(a=t.source||{}).concatemoji?o(a.concatemoji):a.wpemoji&&a.twemoji&&(o(a.twemoji),o(a.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=5080f47c767249956e7e28a2ed061214' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.25' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-groups-bp-groups-screens/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-groups-bp-groups-screens%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-groups-bp-groups-screens%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.7.4-file-bp-groups-bp-groups-screens","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-groups-bp-groups-screens" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.7.4." href="http://hookr.io/plugins/buddypress/2.7.4/" class="H_VERSION"><span property="name">2.7.4</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.7.4/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-groups-bp-groups-screens</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7768"><a href="http://hookr.io/plugins/buddypress/2.7.4/all/" title="All">All <span class="count badge">7768</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.7.4/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3600"><a href="http://hookr.io/plugins/buddypress/2.7.4/hooks/" title="Hooks">Hooks <span class="count badge">3600</span></a></li><li class="" data-id="action" data-count="1718"><a href="http://hookr.io/plugins/buddypress/2.7.4/actions/" title="Actions">Actions <span class="count badge">1718</span></a></li><li class="" data-id="filter" data-count="1882"><a href="http://hookr.io/plugins/buddypress/2.7.4/filters/" title="Filters">Filters <span class="count badge">1882</span></a></li><li class="" data-id="class" data-count="178"><a href="http://hookr.io/plugins/buddypress/2.7.4/classes/" title="Classes">Classes <span class="count badge">178</span></a></li><li class="" data-id="constant" data-count="160"><a href="http://hookr.io/plugins/buddypress/2.7.4/constants/" title="Constants">Constants <span class="count badge">160</span></a></li><li class="" data-id="function" data-count="3830"><a href="http://hookr.io/plugins/buddypress/2.7.4/functions/" title="Functions">Functions <span class="count badge">3830</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-groups/bp-groups-screens.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * BuddyPress Groups Screen Functions</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Screen functions are the controllers of BuddyPress. They will execute when</span>&nbsp;</div></li><li><div><span class="comment"> * their specific URL is caught. They will first save or manipulate data using</span>&nbsp;</div></li><li><div><span class="comment"> * business functions, then pass on the user to a template file.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BuddyPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage GroupsScreens</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly.</span>&nbsp;</div></li><li><div>defined( 'ABSPATH' ) || exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! buddypress()-&gt;do_autoload ) {&nbsp;</div></li><li><div>  require dirname( __FILE__ ) . '/classes/class-bp-groups-theme-compat.php';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of the Groups directory index.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_directory_groups_setup() {&nbsp;</div></li><li><div>  if ( bp_is_groups_directory() ) {&nbsp;</div></li><li><div>      <span class="comment">// Set group type if available.</span>&nbsp;</div></li><li><div>      if ( bp_is_current_action( bp_get_groups_group_type_base() ) && bp_action_variable() ) {&nbsp;</div></li><li><div>          $matched_types = bp_groups_get_group_types( array(&nbsp;</div></li><li><div>              'has_directory' =&gt; true, &nbsp;</div></li><li><div>              'directory_slug' =&gt; bp_action_variable(), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Redirect back to group directory if no match.</span>&nbsp;</div></li><li><div>          if ( empty( $matched_types ) ) {&nbsp;</div></li><li><div>              bp_core_redirect( bp_get_groups_directory_permalink() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set our global variable.</span>&nbsp;</div></li><li><div>          buddypress()-&gt;groups-&gt;current_directory_type = reset( $matched_types );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_update_is_directory( true, 'groups' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before the loading of the Groups directory index.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_directory_groups_setup' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the template to load for the Groups directory index.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $value Path to the groups directory index template to load.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      bp_core_load_template( apply_filters( 'groups_template_directory_groups', 'groups/index' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_directory_groups_setup', 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the loading of the My Groups page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_my_groups() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of the My Groups page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_my_groups' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for the My Groups page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to the My Groups page template to load.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_my_groups', 'members/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the loading of a user's Groups &gt; Invites page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_invites() {&nbsp;</div></li><li><div>  $group_id = (int)bp_action_variable( 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_is_action_variable( 'accept' ) && is_numeric( $group_id ) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !check_admin_referer( 'groups_accept_invite' ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !groups_accept_invite( bp_loggedin_user_id(), $group_id ) ) {&nbsp;</div></li><li><div>          bp_core_add_message( __('Group invite could not be accepted', 'buddypress'), 'error' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          bp_core_add_message( __('Group invite accepted', 'buddypress') );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Record this in activity streams.</span>&nbsp;</div></li><li><div>          $group = groups_get_group( $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          groups_record_activity( array(&nbsp;</div></li><li><div>              'type' =&gt; 'joined_group', &nbsp;</div></li><li><div>              'item_id' =&gt; $group-&gt;id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_GET['redirect_to'] ) ) {&nbsp;</div></li><li><div>          $redirect_to = urldecode( $_GET['redirect_to'] );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $redirect_to = trailingslashit( bp_loggedin_user_domain() . bp_get_groups_slug() . '/' . bp_current_action() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_core_redirect( $redirect_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } elseif ( bp_is_action_variable( 'reject' ) && is_numeric( $group_id ) ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !check_admin_referer( 'groups_reject_invite' ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !groups_reject_invite( bp_loggedin_user_id(), $group_id ) ) {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'Group invite could not be rejected', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'Group invite rejected', 'buddypress' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_GET['redirect_to'] ) ) {&nbsp;</div></li><li><div>          $redirect_to = urldecode( $_GET['redirect_to'] );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $redirect_to = trailingslashit( bp_loggedin_user_domain() . bp_get_groups_slug() . '/' . bp_current_action() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_core_redirect( $redirect_to );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of a users Groups &gt; Invites template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $group_id ID of the group being displayed</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_invites', $group_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a users Groups &gt; Invites page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a users Groups &gt; Invites page template.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_invites', 'members/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the loading of a single group's page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_home() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_single_item() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of a single group's page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_home' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a single group's page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a single group's template to load.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_home', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This screen function handles actions related to group forums.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_forum() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bp_is_active( 'forums' ) || !bp_forums_is_installed_correctly() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_action_variable( 0 ) && !bp_is_action_variable( 'topic', 0 ) ) {&nbsp;</div></li><li><div>      bp_do_404();&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$bp-&gt;groups-&gt;current_group-&gt;user_has_access ) {&nbsp;</div></li><li><div>      bp_core_no_access();&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_single_item() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Fetch the details we need.</span>&nbsp;</div></li><li><div>  $topic_slug = (string)bp_action_variable( 1 );&nbsp;</div></li><li><div>  $topic_id = bp_forums_get_topic_id_from_slug( $topic_slug );&nbsp;</div></li><li><div>  $forum_id = groups_get_groupmeta( $bp-&gt;groups-&gt;current_group-&gt;id, 'forum_id' );&nbsp;</div></li><li><div>  $user_is_banned = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bp_current_user_can( 'bp_moderate' ) && groups_is_user_banned( bp_loggedin_user_id(), $bp-&gt;groups-&gt;current_group-&gt;id ) )&nbsp;</div></li><li><div>      $user_is_banned = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !empty( $topic_slug ) && !empty( $topic_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Posting a reply.</span>&nbsp;</div></li><li><div>      if ( !$user_is_banned && !bp_action_variable( 2 ) && isset( $_POST['submit_reply'] ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'bp_forums_new_reply' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Auto join this user if they are not yet a member of this group.</span></span>&nbsp;</div></li><li><div>          if ( bp_groups_auto_join() && !bp_current_user_can( 'bp_moderate' ) && 'public' == $bp-&gt;groups-&gt;current_group-&gt;status && !groups_is_user_member( bp_loggedin_user_id(), $bp-&gt;groups-&gt;current_group-&gt;id ) ) {&nbsp;</div></li><li><div>              groups_join_group( $bp-&gt;groups-&gt;current_group-&gt;id, bp_loggedin_user_id() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $topic_page = isset( $_GET['topic_page'] ) ? $_GET['topic_page'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Don't allow reply flooding.</span>&nbsp;</div></li><li><div>          if ( bp_forums_reply_exists( $_POST['reply_text'], $topic_id, bp_loggedin_user_id() ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'It looks like you\'ve already said that!', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( !$post_id = groups_new_group_forum_post( $_POST['reply_text'], $topic_id, $topic_page ) ) {&nbsp;</div></li><li><div>                  bp_core_add_message( __( 'There was an error when replying to that topic', 'buddypress'), 'error' );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  bp_core_add_message( __( 'Your reply was posted successfully', 'buddypress') );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $query_vars = isset( $_SERVER['QUERY_STRING'] ) ? '?' . $_SERVER['QUERY_STRING'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $redirect = bp_get_group_permalink( groups_get_current_group() ) . 'forum/topic/' . $topic_slug . '/' . $query_vars;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !empty( $post_id ) ) {&nbsp;</div></li><li><div>              $redirect .= '#post-' . $post_id;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_core_redirect( $redirect );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Sticky a topic.</span>&nbsp;</div></li><li><div>      elseif ( bp_is_action_variable( 'stick', 2 ) && ( bp_is_item_admin() || bp_is_item_mod() ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'bp_forums_stick_topic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !bp_forums_sticky_topic( array( 'topic_id' =&gt; $topic_id ) ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error when making that topic a sticky', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'The topic was made sticky successfully', 'buddypress' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after a group forum topic has been stickied.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $topic_id ID of the topic being stickied.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_stick_forum_topic', $topic_id );&nbsp;</div></li><li><div>          bp_core_redirect( wp_get_referer() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Un-Sticky a topic.</span>&nbsp;</div></li><li><div>      elseif ( bp_is_action_variable( 'unstick', 2 ) && ( bp_is_item_admin() || bp_is_item_mod() ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'bp_forums_unstick_topic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !bp_forums_sticky_topic( array( 'topic_id' =&gt; $topic_id, 'mode' =&gt; 'unstick' ) ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error when unsticking that topic', 'buddypress'), 'error' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'The topic was unstuck successfully', 'buddypress') );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after a group forum topic has been un-stickied.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $topic_id ID of the topic being un-stickied.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_unstick_forum_topic', $topic_id );&nbsp;</div></li><li><div>          bp_core_redirect( wp_get_referer() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Close a topic.</span>&nbsp;</div></li><li><div>      elseif ( bp_is_action_variable( 'close', 2 ) && ( bp_is_item_admin() || bp_is_item_mod() ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'bp_forums_close_topic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !bp_forums_openclose_topic( array( 'topic_id' =&gt; $topic_id ) ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error when closing that topic', 'buddypress'), 'error' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'The topic was closed successfully', 'buddypress') );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after a group forum topic has been closed.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $topic_id ID of the topic being closed.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_close_forum_topic', $topic_id );&nbsp;</div></li><li><div>          bp_core_redirect( wp_get_referer() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Open a topic.</span>&nbsp;</div></li><li><div>      elseif ( bp_is_action_variable( 'open', 2 ) && ( bp_is_item_admin() || bp_is_item_mod() ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'bp_forums_open_topic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !bp_forums_openclose_topic( array( 'topic_id' =&gt; $topic_id, 'mode' =&gt; 'open' ) ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error when opening that topic', 'buddypress'), 'error' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'The topic was opened successfully', 'buddypress') );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after a group forum topic has been opened.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $topic_id ID of the topic being opened.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_open_forum_topic', $topic_id );&nbsp;</div></li><li><div>          bp_core_redirect( wp_get_referer() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Delete a topic.</span>&nbsp;</div></li><li><div>      elseif ( empty( $user_is_banned ) && bp_is_action_variable( 'delete', 2 ) && !bp_action_variable( 3 ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Fetch the topic.</span></span>&nbsp;</div></li><li><div>          $topic = bp_forums_get_topic_details( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/** Check the logged in user can delete this topic */</span>&nbsp;</div></li><li><div>          if ( ! bp_is_item_admin() && ! bp_is_item_mod() && ( (int) bp_loggedin_user_id() != (int) $topic-&gt;topic_poster ) ) {&nbsp;</div></li><li><div>              bp_core_redirect( wp_get_referer() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'bp_forums_delete_topic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before a group forum topic is deleted.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $topic_id ID of the topic being deleted.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_before_delete_forum_topic', $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !groups_delete_group_forum_topic( $topic_id ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error deleting the topic', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'The topic was deleted successfully', 'buddypress' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after a group forum topic has been deleted.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $topic_id ID of the topic being deleted.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_delete_forum_topic', $topic_id );&nbsp;</div></li><li><div>          bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'forum/' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Editing a topic.</span>&nbsp;</div></li><li><div>      elseif ( empty( $user_is_banned ) && bp_is_action_variable( 'edit', 2 ) && !bp_action_variable( 3 ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Fetch the topic.</span></span>&nbsp;</div></li><li><div>          $topic = bp_forums_get_topic_details( $topic_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Check the logged in user can edit this topic.</span></span></span>&nbsp;</div></li><li><div>          if ( ! bp_is_item_admin() && ! bp_is_item_mod() && ( (int) bp_loggedin_user_id() != (int) $topic-&gt;topic_poster ) ) {&nbsp;</div></li><li><div>              bp_core_redirect( wp_get_referer() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['save_changes'] ) ) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              check_admin_referer( 'bp_forums_edit_topic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $topic_tags = !empty( $_POST['topic_tags'] ) ? $_POST['topic_tags'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( !groups_update_group_forum_topic( $topic_id, $_POST['topic_title'], $_POST['topic_text'], $topic_tags ) ) {&nbsp;</div></li><li><div>                  bp_core_add_message( __( 'There was an error when editing that topic', 'buddypress'), 'error' );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  bp_core_add_message( __( 'The topic was edited successfully', 'buddypress') );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Fires after a group forum topic has been edited.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param int $topic_id ID of the topic being edited.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              do_action( 'groups_edit_forum_topic', $topic_id );&nbsp;</div></li><li><div>              bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'forum/topic/' . $topic_slug . '/' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the template to load for a topic edit page.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $value Path to a topic edit template.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          bp_core_load_template( apply_filters( 'groups_template_group_forum_topic_edit', 'groups/single/home' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Delete a post.</span>&nbsp;</div></li><li><div>      } elseif ( empty( $user_is_banned ) && bp_is_action_variable( 'delete', 2 ) && $post_id = bp_action_variable( 4 ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Fetch the post.</span></span>&nbsp;</div></li><li><div>          $post = bp_forums_get_post( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Check the logged in user can edit this topic.</span></span></span>&nbsp;</div></li><li><div>          if ( ! bp_is_item_admin() && ! bp_is_item_mod() && ( (int) bp_loggedin_user_id() != (int) $post-&gt;poster_id ) ) {&nbsp;</div></li><li><div>              bp_core_redirect( wp_get_referer() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'bp_forums_delete_post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before the deletion of a group forum post.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $post_id ID of the forum post being deleted.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_before_delete_forum_post', $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !groups_delete_group_forum_post( $post_id ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error deleting that post', 'buddypress'), 'error' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'The post was deleted successfully', 'buddypress') );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after the deletion of a group forum post.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $post_id ID of the forum post being deleted.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_delete_forum_post', $post_id );&nbsp;</div></li><li><div>          bp_core_redirect( wp_get_referer() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Editing a post.</span>&nbsp;</div></li><li><div>      } elseif ( empty( $user_is_banned ) && bp_is_action_variable( 'edit', 2 ) && $post_id = bp_action_variable( 4 ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Fetch the post.</span></span>&nbsp;</div></li><li><div>          $post = bp_forums_get_post( $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Check the logged in user can edit this topic.</span></span></span>&nbsp;</div></li><li><div>          if ( ! bp_is_item_admin() && ! bp_is_item_mod() && ( (int) bp_loggedin_user_id() != (int) $post-&gt;poster_id ) ) {&nbsp;</div></li><li><div>              bp_core_redirect( wp_get_referer() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_POST['save_changes'] ) ) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              check_admin_referer( 'bp_forums_edit_post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $topic_page = isset( $_GET['topic_page'] ) ? $_GET['topic_page'] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( !$post_id = groups_update_group_forum_post( $post_id, $_POST['post_text'], $topic_id, $topic_page ) ) {&nbsp;</div></li><li><div>                  bp_core_add_message( __( 'There was an error when editing that post', 'buddypress'), 'error' );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  bp_core_add_message( __( 'The post was edited successfully', 'buddypress') );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $_SERVER['QUERY_STRING'] ) {&nbsp;</div></li><li><div>                  $query_vars = '?' . $_SERVER['QUERY_STRING'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Fires after the editing of a group forum post.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param int $post_id ID of the forum post being edited.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              do_action( 'groups_edit_forum_post', $post_id );&nbsp;</div></li><li><div>              bp_core_redirect( bp_get_group_permalink( $bp-&gt;groups-&gt;current_group ) . 'forum/topic/' . $topic_slug . '/' . $query_vars . '#post-' . $post_id );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">/** This filter is documented in bp-groups/bp-groups-screens.php */</span></span>&nbsp;</div></li><li><div>          bp_core_load_template( apply_filters( 'groups_template_group_forum_topic_edit', 'groups/single/home' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Standard topic display.</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( !empty( $user_is_banned ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( __( &quot;You have been banned from this group.&quot;, 'buddypress' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filters the template to load for a topic page.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.1.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $value Path to a topic template.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          bp_core_load_template( apply_filters( 'groups_template_group_forum_topic', 'groups/single/home' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Forum topic does not exist.</span>&nbsp;</div></li><li><div>  } elseif ( !empty( $topic_slug ) && empty( $topic_id ) ) {&nbsp;</div></li><li><div>      bp_do_404();&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Posting a topic.</span>&nbsp;</div></li><li><div>      if ( isset( $_POST['submit_topic'] ) && bp_is_active( 'forums' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'bp_forums_new_topic' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $user_is_banned ) {&nbsp;</div></li><li><div>              $error_message = __( &quot;You have been banned from this group.&quot;, 'buddypress' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( bp_groups_auto_join() && !bp_current_user_can( 'bp_moderate' ) && 'public' == $bp-&gt;groups-&gt;current_group-&gt;status && !groups_is_user_member( bp_loggedin_user_id(), $bp-&gt;groups-&gt;current_group-&gt;id ) ) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Auto join this user if they are not yet a member of this group.</span></span>&nbsp;</div></li><li><div>              groups_join_group( $bp-&gt;groups-&gt;current_group-&gt;id, bp_loggedin_user_id() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $_POST['topic_title'] ) ) {&nbsp;</div></li><li><div>              $error_message = __( 'Please provide a title for your forum topic.', 'buddypress' );&nbsp;</div></li><li><div>          } elseif ( empty( $_POST['topic_text'] ) ) {&nbsp;</div></li><li><div>              $error_message = __( 'Forum posts cannot be empty. Please enter some text.', 'buddypress' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $forum_id ) ) {&nbsp;</div></li><li><div>              $error_message = __( 'This group does not have a forum setup yet.', 'buddypress' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $error_message ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( $error_message, 'error' );&nbsp;</div></li><li><div>              $redirect = bp_get_group_permalink( $bp-&gt;groups-&gt;current_group ) . 'forum';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( !$topic = groups_new_group_forum_topic( $_POST['topic_title'], $_POST['topic_text'], $_POST['topic_tags'], $forum_id ) ) {&nbsp;</div></li><li><div>                  bp_core_add_message( __( 'There was an error when creating the topic', 'buddypress'), 'error' );&nbsp;</div></li><li><div>                  $redirect = bp_get_group_permalink( $bp-&gt;groups-&gt;current_group ) . 'forum';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  bp_core_add_message( __( 'The topic was created successfully', 'buddypress') );&nbsp;</div></li><li><div>                  $redirect = bp_get_group_permalink( $bp-&gt;groups-&gt;current_group ) . 'forum/topic/' . $topic-&gt;topic_slug . '/';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_core_redirect( $redirect );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires at the end of the group forum screen loading process.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $topic_id ID of the topic being displayed.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $forum_id ID of the forum being displayed.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_screen_group_forum', $topic_id, $forum_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the template to load for a group forum page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $value Path to a group forum template.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      bp_core_load_template( apply_filters( 'groups_template_group_forum', 'groups/single/home' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of a group's Members page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_members() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bp_is_single_item() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Refresh the group member count meta.</span>&nbsp;</div></li><li><div>  groups_update_groupmeta( $bp-&gt;groups-&gt;current_group-&gt;id, 'total_member_count', groups_get_total_member_count( $bp-&gt;groups-&gt;current_group-&gt;id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of a group's Members page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id ID of the group whose members are being displayed.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_members', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a group's Members page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a group's Members template.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_members', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of a group's Send Invites page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_invite() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bp_is_single_item() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_is_action_variable( 'send', 0 ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !check_admin_referer( 'groups_send_invites', '_wpnonce_send_invites' ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !empty( $_POST['friends'] ) ) {&nbsp;</div></li><li><div>          foreach( (array) $_POST['friends'] as $friend ) {&nbsp;</div></li><li><div>              groups_invite_user( array( 'user_id' =&gt; $friend, 'group_id' =&gt; $bp-&gt;groups-&gt;current_group-&gt;id ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Send the invites.</span>&nbsp;</div></li><li><div>      groups_send_invites( bp_loggedin_user_id(), $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>      bp_core_add_message( __('Group invites sent.', 'buddypress') );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the sending of a group invite inside the group's Send Invites page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $id ID of the group whose members are being displayed.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_screen_group_invite', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>      bp_core_redirect( bp_get_group_permalink( $bp-&gt;groups-&gt;current_group ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } elseif ( !bp_action_variable( 0 ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the template to load for a group's Send Invites page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $value Path to a group's Send Invites template.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      bp_core_load_template( apply_filters( 'groups_template_group_invite', 'groups/single/home' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      bp_do_404();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Process group invitation removal requests.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Note that this function is only used when JS is disabled. Normally, clicking</span>&nbsp;</div></li><li><div><span class="comment"> * Remove Invite removes the invitation via AJAX.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_remove_group_invite() {&nbsp;</div></li><li><div>  if ( ! bp_is_group_invites() ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_action_variable( 'remove', 0 ) || ! is_numeric( bp_action_variable( 1 ) ) ) {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! check_admin_referer( 'groups_invite_uninvite_user' ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $friend_id = intval( bp_action_variable( 1 ) );&nbsp;</div></li><li><div>  $group_id = bp_get_current_group_id();&nbsp;</div></li><li><div>  $message = __( 'Invite successfully removed', 'buddypress' );&nbsp;</div></li><li><div>  $redirect = wp_get_referer();&nbsp;</div></li><li><div>  $error = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_groups_user_can_send_invites( $group_id ) ) {&nbsp;</div></li><li><div>      $message = __( 'You are not allowed to send or remove invites', 'buddypress' );&nbsp;</div></li><li><div>      $error = 'error';&nbsp;</div></li><li><div>  } elseif ( groups_check_for_membership_request( $friend_id, $group_id ) ) {&nbsp;</div></li><li><div>      $message = __( 'The member requested to join the group', 'buddypress' );&nbsp;</div></li><li><div>      $error = 'error';&nbsp;</div></li><li><div>  } elseif ( ! groups_uninvite_user( $friend_id, $group_id ) ) {&nbsp;</div></li><li><div>      $message = __( 'There was an error removing the invite', 'buddypress' );&nbsp;</div></li><li><div>      $error = 'error';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bp_core_add_message( $message, $error );&nbsp;</div></li><li><div>  bp_core_redirect( $redirect );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_remove_group_invite' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of a group's Request Membership page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_request_membership() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !is_user_logged_in() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'private' != $bp-&gt;groups-&gt;current_group-&gt;status )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the user is already invited, accept invitation.</span>&nbsp;</div></li><li><div>  if ( groups_check_user_has_invite( bp_loggedin_user_id(), $bp-&gt;groups-&gt;current_group-&gt;id ) ) {&nbsp;</div></li><li><div>      if ( groups_accept_invite( bp_loggedin_user_id(), $bp-&gt;groups-&gt;current_group-&gt;id ) )&nbsp;</div></li><li><div>          bp_core_add_message( __( 'Group invite accepted', 'buddypress' ) );&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          bp_core_add_message( __( 'There was an error accepting the group invitation. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>      bp_core_redirect( bp_get_group_permalink( $bp-&gt;groups-&gt;current_group ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the user has submitted a request, send it.</span>&nbsp;</div></li><li><div>  if ( isset( $_POST['group-request-send']) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !check_admin_referer( 'groups_request_membership' ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !groups_send_membership_request( bp_loggedin_user_id(), $bp-&gt;groups-&gt;current_group-&gt;id ) ) {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'There was an error sending your group membership request. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'Your membership request was sent to the group administrator successfully. You will be notified when the group administrator responds to your request.', 'buddypress' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      bp_core_redirect( bp_get_group_permalink( $bp-&gt;groups-&gt;current_group ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of a group's Request Memebership page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id ID of the group currently being displayed.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_request_membership', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a group's Request Membership page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a group's Request Membership template.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_request_membership', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the loading of a single group's activity.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_activity() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_single_item() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of a single group's activity page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_activity' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a single group's activity page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a single group's template to load.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_screen_group_activity', 'groups/single/activity' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of a single group activity item.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_activity_permalink() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !bp_is_groups_component() || !bp_is_active( 'activity' ) || ( bp_is_active( 'activity' ) && !bp_is_current_action( bp_get_activity_slug() ) ) || !bp_action_variable( 0 ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  buddypress()-&gt;is_single_item = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">/** This filter is documented in bp-groups/bp-groups-screens.php */</span></span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_home', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_screen_group_activity_permalink' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of a group's Admin pages.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_admin() {&nbsp;</div></li><li><div>  if ( !bp_is_groups_component() || !bp_is_current_action( 'admin' ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_action_variables() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'admin/edit-details/' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of a group's admin/edit-details page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_admin_edit_details() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'edit-details' != bp_get_group_current_admin_tab() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_is_item_admin() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// If the edit form has been submitted, save the edited details.</span></span>&nbsp;</div></li><li><div>      if ( isset( $_POST['save'] ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( !check_admin_referer( 'groups_edit_group_details' ) )&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $group_notify_members = isset( $_POST['group-notify-members'] ) ? (int) $_POST['group-notify-members'] : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( !groups_edit_base_group_details( $_POST['group-id'], $_POST['group-name'], $_POST['group-desc'], $group_notify_members ) ) {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error updating group details. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              bp_core_add_message( __( 'Group details were successfully updated.', 'buddypress' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before the redirect if a group details has been edited and saved.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $id ID of the group that was edited.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_group_details_edited', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'admin/edit-details/' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before the loading of the group admin/edit-details page template.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $id ID of the group that is being displayed.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_screen_group_admin_edit_details', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters the template to load for a group's admin/edit-details page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $value Path to a group's admin/edit-details template.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      bp_core_load_template( apply_filters( 'groups_template_group_admin', 'groups/single/home' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_screen_group_admin_edit_details' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of a group's admin/group-settings page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_admin_settings() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'group-settings' != bp_get_group_current_admin_tab() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// If the edit form has been submitted, save the edited details.</span></span>&nbsp;</div></li><li><div>  if ( isset( $_POST['save'] ) ) {&nbsp;</div></li><li><div>      $enable_forum = ( isset($_POST['group-show-forum'] ) ) ? 1 : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Checked against a whitelist for security.</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">/** This filter is documented in bp-groups/bp-groups-admin.php */</span></span>&nbsp;</div></li><li><div>      $allowed_status = apply_filters( 'groups_allowed_status', array( 'public', 'private', 'hidden' ) );&nbsp;</div></li><li><div>      $status = ( in_array( $_POST['group-status'], (array) $allowed_status ) ) ? $_POST['group-status'] : 'public';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Checked against a whitelist for security.</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">/** This filter is documented in bp-groups/bp-groups-admin.php */</span></span>&nbsp;</div></li><li><div>      $allowed_invite_status = apply_filters( 'groups_allowed_invite_status', array( 'members', 'mods', 'admins' ) );&nbsp;</div></li><li><div>      $invite_status = isset( $_POST['group-invite-status'] ) && in_array( $_POST['group-invite-status'], (array) $allowed_invite_status ) ? $_POST['group-invite-status'] : 'members';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !check_admin_referer( 'groups_edit_group_settings' ) )&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Save group types.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Ensure we keep types that have 'show_in_create_screen' set to false.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $current_types = bp_groups_get_group_type( bp_get_current_group_id(), false );&nbsp;</div></li><li><div>      $current_types = array_intersect( bp_groups_get_group_types( array( 'show_in_create_screen' =&gt; false ) ), (array) $current_types );&nbsp;</div></li><li><div>      if ( isset( $_POST['group-types'] ) ) {&nbsp;</div></li><li><div>          $current_types = array_merge( $current_types, $_POST['group-types'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Set group types.</span></span>&nbsp;</div></li><li><div>          bp_groups_set_group_type( bp_get_current_group_id(), $current_types );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// No group types checked, so this means we want to wipe out all group types.</span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Passing a blank string will wipe out all types for the group.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * Ensure we keep types that have 'show_in_create_screen' set to false.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          $current_types = empty( $current_types ) ? '' : $current_types;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Set group types.</span></span>&nbsp;</div></li><li><div>          bp_groups_set_group_type( bp_get_current_group_id(), $current_types );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !groups_edit_group_settings( $_POST['group-id'], $enable_forum, $status, $invite_status ) ) {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'There was an error updating group settings. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'Group settings were successfully updated.', 'buddypress' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before the redirect if a group settings has been edited and saved.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $id ID of the group that was edited.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_group_settings_edited', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'admin/group-settings/' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of the group admin/group-settings page template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id ID of the group that is being displayed.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_admin_settings', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a group's admin/group-settings page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a group's admin/group-settings template.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_admin_settings', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_screen_group_admin_settings' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of a group's Change Avatar page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_admin_avatar() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'group-avatar' != bp_get_group_current_admin_tab() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the logged-in user doesn't have permission or if avatar uploads are disabled, then stop here.</span>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() || bp_disable_group_avatar_uploads() || ! buddypress()-&gt;avatar-&gt;show_avatars )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the group admin has deleted the admin avatar.</span>&nbsp;</div></li><li><div>  if ( bp_is_action_variable( 'delete', 1 ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      check_admin_referer( 'bp_group_avatar_delete' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( bp_core_delete_existing_avatar( array( 'item_id' =&gt; $bp-&gt;groups-&gt;current_group-&gt;id, 'object' =&gt; 'group' ) ) ) {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'The group profile photo was deleted successfully!', 'buddypress' ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'There was a problem deleting the group profile photo. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $bp-&gt;avatar_admin ) ) {&nbsp;</div></li><li><div>      $bp-&gt;avatar_admin = new stdClass();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp-&gt;avatar_admin-&gt;step = 'upload-image';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !empty( $_FILES ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      check_admin_referer( 'bp_avatar_upload' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Pass the file to the avatar upload handler.</span>&nbsp;</div></li><li><div>      if ( bp_core_avatar_handle_upload( $_FILES, 'groups_avatar_upload_dir' ) ) {&nbsp;</div></li><li><div>          $bp-&gt;avatar_admin-&gt;step = 'crop-image';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Make sure we include the jQuery jCrop file for image cropping.</span>&nbsp;</div></li><li><div>          add_action( 'wp_print_scripts', 'bp_core_add_jquery_cropper' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the image cropping is done, crop the image and save a full/thumb version.</span>&nbsp;</div></li><li><div>  if ( isset( $_POST['avatar-crop-submit'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      check_admin_referer( 'bp_avatar_cropstore' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $args = array(&nbsp;</div></li><li><div>          'object' =&gt; 'group', &nbsp;</div></li><li><div>          'avatar_dir' =&gt; 'group-avatars', &nbsp;</div></li><li><div>          'item_id' =&gt; $bp-&gt;groups-&gt;current_group-&gt;id, &nbsp;</div></li><li><div>          'original_file' =&gt; $_POST['image_src'], &nbsp;</div></li><li><div>          'crop_x' =&gt; $_POST['x'], &nbsp;</div></li><li><div>          'crop_y' =&gt; $_POST['y'], &nbsp;</div></li><li><div>          'crop_w' =&gt; $_POST['w'], &nbsp;</div></li><li><div>          'crop_h' =&gt; $_POST['h']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( !bp_core_avatar_handle_crop( $args ) ) {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'There was a problem cropping the group profile photo.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'The new group profile photo was uploaded successfully.', 'buddypress' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of the group Change Avatar page template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id ID of the group that is being displayed.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_admin_avatar', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a group's Change Avatar page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a group's Change Avatar template.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_admin_avatar', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_screen_group_admin_avatar' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of a group's Change cover image page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_admin_cover_image() {&nbsp;</div></li><li><div>  if ( 'group-cover-image' != bp_get_group_current_admin_tab() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the logged-in user doesn't have permission or if cover image uploads are disabled, then stop here.</span>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() || ! bp_group_use_cover_image_header() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of the group Change cover image page template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id ID of the group that is being displayed.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_admin_cover_image', bp_get_current_group_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a group's Change cover image page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a group's Change cover image template.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_admin_cover_image', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_screen_group_admin_cover_image' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This function handles actions related to member management on the group admin.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_admin_manage_members() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'manage-members' != bp_get_group_current_admin_tab() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_action_variable( 1 ) && bp_action_variable( 2 ) && bp_action_variable( 3 ) ) {&nbsp;</div></li><li><div>      if ( bp_is_action_variable( 'promote', 1 ) && ( bp_is_action_variable( 'mod', 2 ) || bp_is_action_variable( 'admin', 2 ) ) && is_numeric( bp_action_variable( 3 ) ) ) {&nbsp;</div></li><li><div>          $user_id = bp_action_variable( 3 );&nbsp;</div></li><li><div>          $status = bp_action_variable( 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce first.</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( !check_admin_referer( 'groups_promote_member' ) )&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Promote a user.</span>&nbsp;</div></li><li><div>          if ( !groups_promote_member( $user_id, $bp-&gt;groups-&gt;current_group-&gt;id, $status ) )&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error when promoting that user. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              bp_core_add_message( __( 'User promoted successfully', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before the redirect after a group member has been promoted.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $user_id ID of the user being promoted.</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $id      ID of the group user is promoted within.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_promoted_member', $user_id, $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'admin/manage-members/' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( bp_action_variable( 1 ) && bp_action_variable( 2 ) ) {&nbsp;</div></li><li><div>      if ( bp_is_action_variable( 'demote', 1 ) && is_numeric( bp_action_variable( 2 ) ) ) {&nbsp;</div></li><li><div>          $user_id = bp_action_variable( 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce first.</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( !check_admin_referer( 'groups_demote_member' ) )&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Stop sole admins from abandoning their group.</span>&nbsp;</div></li><li><div>          $group_admins = groups_get_group_admins( $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>          if ( 1 == count( $group_admins ) && $group_admins[0]-&gt;user_id == $user_id )&nbsp;</div></li><li><div>              bp_core_add_message( __( 'This group must have at least one admin', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Demote a user.</span>&nbsp;</div></li><li><div>          elseif ( !groups_demote_member( $user_id, $bp-&gt;groups-&gt;current_group-&gt;id ) )&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error when demoting that user. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              bp_core_add_message( __( 'User demoted successfully', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before the redirect after a group member has been demoted.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $user_id ID of the user being demoted.</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $id      ID of the group user is demoted within.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_demoted_member', $user_id, $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'admin/manage-members/' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( bp_is_action_variable( 'ban', 1 ) && is_numeric( bp_action_variable( 2 ) ) ) {&nbsp;</div></li><li><div>          $user_id = bp_action_variable( 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce first.</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( !check_admin_referer( 'groups_ban_member' ) )&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Ban a user.</span>&nbsp;</div></li><li><div>          if ( !groups_ban_member( $user_id, $bp-&gt;groups-&gt;current_group-&gt;id ) )&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error when banning that user. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              bp_core_add_message( __( 'User banned successfully', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before the redirect after a group member has been banned.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $user_id ID of the user being banned.</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $id      ID of the group user is banned from.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_banned_member', $user_id, $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'admin/manage-members/' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( bp_is_action_variable( 'unban', 1 ) && is_numeric( bp_action_variable( 2 ) ) ) {&nbsp;</div></li><li><div>          $user_id = bp_action_variable( 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce first.</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( !check_admin_referer( 'groups_unban_member' ) )&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Remove a ban for user.</span>&nbsp;</div></li><li><div>          if ( !groups_unban_member( $user_id, $bp-&gt;groups-&gt;current_group-&gt;id ) )&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error when unbanning that user. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              bp_core_add_message( __( 'User ban removed successfully', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before the redirect after a group member has been unbanned.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $user_id ID of the user being unbanned.</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $id      ID of the group user is unbanned from.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_unbanned_member', $user_id, $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'admin/manage-members/' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( bp_is_action_variable( 'remove', 1 ) && is_numeric( bp_action_variable( 2 ) ) ) {&nbsp;</div></li><li><div>          $user_id = bp_action_variable( 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce first.</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( !check_admin_referer( 'groups_remove_member' ) )&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Remove a user.</span>&nbsp;</div></li><li><div>          if ( !groups_remove_member( $user_id, $bp-&gt;groups-&gt;current_group-&gt;id ) )&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error removing that user from the group. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              bp_core_add_message( __( 'User removed successfully', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires before the redirect after a group member has been removed.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.2.6</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $user_id ID of the user being removed.</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $id      ID of the group the user is removed from.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_removed_member', $user_id, $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'admin/manage-members/' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of a group's manage members template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id ID of the group whose manage members page is being displayed.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_admin_manage_members', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a group's manage members page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a group's manage members template.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_admin_manage_members', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_screen_group_admin_manage_members' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of Admin &gt; Membership Requests.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_admin_requests() {&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'membership-requests' != bp_get_group_current_admin_tab() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() || ( 'public' == $bp-&gt;groups-&gt;current_group-&gt;status ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $request_action = (string) bp_action_variable( 1 );&nbsp;</div></li><li><div>  $membership_id = (int) bp_action_variable( 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !empty( $request_action ) && !empty( $membership_id ) ) {&nbsp;</div></li><li><div>      if ( 'accept' == $request_action && is_numeric( $membership_id ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce first.</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          if ( !check_admin_referer( 'groups_accept_membership_request' ) )&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Accept the membership request.</span>&nbsp;</div></li><li><div>          if ( !groups_accept_membership_request( $membership_id ) )&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error accepting the membership request. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              bp_core_add_message( __( 'Group membership request accepted', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } elseif ( 'reject' == $request_action && is_numeric( $membership_id ) ) {&nbsp;</div></li><li><div>          <span class="comment">/** Check the nonce first. */</span>&nbsp;</div></li><li><div>          if ( !check_admin_referer( 'groups_reject_membership_request' ) )&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Reject the membership request.</span>&nbsp;</div></li><li><div>          if ( !groups_reject_membership_request( $membership_id ) )&nbsp;</div></li><li><div>              bp_core_add_message( __( 'There was an error rejecting the membership request. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              bp_core_add_message( __( 'Group membership request rejected', 'buddypress' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before the redirect if a group membership request has been handled.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $id             ID of the group that was edited.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $request_action Membership request action being performed.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int    $membership_id  The key of the action_variables array that you want.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_group_request_managed', $bp-&gt;groups-&gt;current_group-&gt;id, $request_action, $membership_id );&nbsp;</div></li><li><div>      bp_core_redirect( bp_get_group_permalink( groups_get_current_group() ) . 'admin/membership-requests/' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of the group membership request page template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id ID of the group that is being displayed.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_admin_requests', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for a group's membership request page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to a group's membership request template.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_admin_requests', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_screen_group_admin_requests' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle the display of the Delete Group page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_group_admin_delete_group() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'delete-group' != bp_get_group_current_admin_tab() )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! bp_is_item_admin() && !bp_current_user_can( 'bp_moderate' ) )&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $_REQUEST['delete-group-button'] ) && isset( $_REQUEST['delete-group-understand'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Check the nonce first.</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      if ( !check_admin_referer( 'groups_delete_group' ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before the deletion of a group from the Delete Group page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $id ID of the group being deleted.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'groups_before_group_deleted', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Group admin has deleted the group, now do it.</span>&nbsp;</div></li><li><div>      if ( !groups_delete_group( $bp-&gt;groups-&gt;current_group-&gt;id ) ) {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'There was an error deleting the group. Please try again.', 'buddypress' ), 'error' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          bp_core_add_message( __( 'The group was deleted successfully.', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after the deletion of a group from the Delete Group page.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param int $id ID of the group being deleted.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_group_deleted', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_core_redirect( trailingslashit( bp_loggedin_user_domain() . bp_get_groups_slug() ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      bp_core_redirect( trailingslashit( bp_loggedin_user_domain() . bp_get_groups_slug() ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before the loading of the Delete Group page template.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param int $id ID of the group that is being displayed.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'groups_screen_group_admin_delete_group', $bp-&gt;groups-&gt;current_group-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the template to load for the Delete Group page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $value Path to the Delete Group template.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  bp_core_load_template( apply_filters( 'groups_template_group_admin_delete_group', 'groups/single/home' ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_screens', 'groups_screen_group_admin_delete_group' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render the group settings fields on the Notification Settings page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function groups_screen_notification_settings() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$group_invite = bp_get_user_meta( bp_displayed_user_id(), 'notification_groups_invite', true ) )&nbsp;</div></li><li><div>      $group_invite = 'yes';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$group_update = bp_get_user_meta( bp_displayed_user_id(), 'notification_groups_group_updated', true ) )&nbsp;</div></li><li><div>      $group_update = 'yes';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$group_promo = bp_get_user_meta( bp_displayed_user_id(), 'notification_groups_admin_promotion', true ) )&nbsp;</div></li><li><div>      $group_promo = 'yes';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( !$group_request = bp_get_user_meta( bp_displayed_user_id(), 'notification_groups_membership_request', true ) )&nbsp;</div></li><li><div>      $group_request = 'yes';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $group_request_completed = bp_get_user_meta( bp_displayed_user_id(), 'notification_membership_request_completed', true ) ) {&nbsp;</div></li><li><div>      $group_request_completed = 'yes';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;table class=&quot;notification-settings&quot; id=&quot;groups-notification-settings&quot;&gt;&nbsp;</div></li><li><div>      &lt;thead&gt;&nbsp;</div></li><li><div>          &lt;tr&gt;&nbsp;</div></li><li><div>              &lt;th class=&quot;icon&quot;&gt;&lt;/th&gt;&nbsp;</div></li><li><div>              &lt;th class=&quot;title&quot;&gt;&lt;?php _ex( 'Groups', 'Group settings on notification settings page', 'buddypress' ) ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>              &lt;th class=&quot;yes&quot;&gt;&lt;?php _e( 'Yes', 'buddypress' ) ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>              &lt;th class=&quot;no&quot;&gt;&lt;?php _e( 'No', 'buddypress' )?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;/thead&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;tbody&gt;&nbsp;</div></li><li><div>          &lt;tr id=&quot;groups-notification-settings-invitation&quot;&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;?php _ex( 'A member invites you to join a group', 'group settings on notification settings page', 'buddypress' ) ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;yes&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_groups_invite]&quot; id=&quot;notification-groups-invite-yes&quot; value=&quot;yes&quot; &lt;?php checked( $group_invite, 'yes', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-invite-yes&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'Yes, send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;no&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_groups_invite]&quot; id=&quot;notification-groups-invite-no&quot; value=&quot;no&quot; &lt;?php checked( $group_invite, 'no', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-invite-no&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'No, do not send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>          &lt;tr id=&quot;groups-notification-settings-info-updated&quot;&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;?php _ex( 'Group information is updated', 'group settings on notification settings page', 'buddypress' ) ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;yes&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_groups_group_updated]&quot; id=&quot;notification-groups-group-updated-yes&quot; value=&quot;yes&quot; &lt;?php checked( $group_update, 'yes', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-group-updated-yes&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'Yes, send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;no&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_groups_group_updated]&quot; id=&quot;notification-groups-group-updated-no&quot; value=&quot;no&quot; &lt;?php checked( $group_update, 'no', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-group-updated-no&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'No, do not send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>          &lt;tr id=&quot;groups-notification-settings-promoted&quot;&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;?php _ex( 'You are promoted to a group administrator or moderator', 'group settings on notification settings page', 'buddypress' ) ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;yes&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_groups_admin_promotion]&quot; id=&quot;notification-groups-admin-promotion-yes&quot; value=&quot;yes&quot; &lt;?php checked( $group_promo, 'yes', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-admin-promotion-yes&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'Yes, send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;no&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_groups_admin_promotion]&quot; id=&quot;notification-groups-admin-promotion-no&quot; value=&quot;no&quot; &lt;?php checked( $group_promo, 'no', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-admin-promotion-no&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'No, do not send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>          &lt;tr id=&quot;groups-notification-settings-request&quot;&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;?php _ex( 'A member requests to join a private group for which you are an admin', 'group settings on notification settings page', 'buddypress' ) ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;yes&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_groups_membership_request]&quot; id=&quot;notification-groups-membership-request-yes&quot; value=&quot;yes&quot; &lt;?php checked( $group_request, 'yes', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-membership-request-yes&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'Yes, send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;no&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_groups_membership_request]&quot; id=&quot;notification-groups-membership-request-no&quot; value=&quot;no&quot; &lt;?php checked( $group_request, 'no', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-membership-request-no&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'No, do not send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>          &lt;tr id=&quot;groups-notification-settings-request-completed&quot;&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td&gt;&lt;?php _ex( 'Your request to join a group has been approved or denied', 'group settings on notification settings page', 'buddypress' ) ?&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;yes&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_membership_request_completed]&quot; id=&quot;notification-groups-membership-request-completed-yes&quot; value=&quot;yes&quot; &lt;?php checked( $group_request_completed, 'yes', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-membership-request-completed-yes&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'Yes, send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>              &lt;td class=&quot;no&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;notifications[notification_membership_request_completed]&quot; id=&quot;notification-groups-membership-request-completed-no&quot; value=&quot;no&quot; &lt;?php checked( $group_request_completed, 'no', true ) ?&gt;/&gt;&lt;label for=&quot;notification-groups-membership-request-completed-no&quot; class=&quot;bp-screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  _e( 'No, do not send email', 'buddypress' );&nbsp;</div></li><li><div>              ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires at the end of the available group settings fields on Notification Settings page.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( 'groups_screen_notification_settings' ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;/tbody&gt;&nbsp;</div></li><li><div>  &lt;/table&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'bp_notification_settings', 'groups_screen_notification_settings' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/** Theme Compatibility *******************************************************/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>new BP_Groups_Theme_Compat();&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2021 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>