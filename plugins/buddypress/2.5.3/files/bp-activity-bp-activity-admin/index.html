<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="2.8.2" data-slug="buddypress" data-type="file" data-id="48976"><head xmlns="http://www.w3.org/1999/xhtml"><title> bp-activity-bp-activity-admin | file | Buddypress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, buddypress, 2.8.2" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=0fbde1b736b097c73c175e672706cbd2' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/bp-activity-bp-activity-admin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-activity-bp-activity-admin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fbp-activity-bp-activity-admin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-buddypress-2.8.2-file-bp-activity-bp-activity-admin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="bp-activity-bp-activity-admin" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to buddypress." href="http://hookr.io/plugins/buddypress/" class="plugin"><span property="name">buddypress</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.8.2." href="http://hookr.io/plugins/buddypress/2.8.2/" class="H_VERSION"><span property="name">2.8.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/buddypress/2.8.2/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">bp-activity-bp-activity-admin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="7837"><a href="http://hookr.io/plugins/buddypress/2.8.2/all/" title="All">All <span class="count badge">7837</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3621"><a href="http://hookr.io/plugins/buddypress/2.8.2/hooks/" title="Hooks">Hooks <span class="count badge">3621</span></a></li><li class="" data-id="action" data-count="1727"><a href="http://hookr.io/plugins/buddypress/2.8.2/actions/" title="Actions">Actions <span class="count badge">1727</span></a></li><li class="" data-id="filter" data-count="1894"><a href="http://hookr.io/plugins/buddypress/2.8.2/filters/" title="Filters">Filters <span class="count badge">1894</span></a></li><li class="" data-id="class" data-count="181"><a href="http://hookr.io/plugins/buddypress/2.8.2/classes/" title="Classes">Classes <span class="count badge">181</span></a></li><li class="" data-id="constant" data-count="161"><a href="http://hookr.io/plugins/buddypress/2.8.2/constants/" title="Constants">Constants <span class="count badge">161</span></a></li><li class="" data-id="function" data-count="3874"><a href="http://hookr.io/plugins/buddypress/2.8.2/functions/" title="Functions">Functions <span class="count badge">3874</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/buddypress/2.8.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/bp-activity/bp-activity-admin.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * BuddyPress Activity component admin screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Props to WordPress core for the Comments admin screen, and its contextual</span>&nbsp;</div></li><li><div><span class="comment"> * help text, on which this implementation is heavily based.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package BuddyPress</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage ActivityAdmin</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Exit if accessed directly.</span>&nbsp;</div></li><li><div>defined( 'ABSPATH' ) || exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Include WP's list table class.</span>&nbsp;</div></li><li><div>if ( !class_exists( 'WP_List_Table' ) ) require( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// Per_page screen option. Has to be hooked in extremely early.</span>&nbsp;</div></li><li><div>if ( is_admin() && ! empty( $_REQUEST['page'] ) && 'bp-activity' == $_REQUEST['page'] )&nbsp;</div></li><li><div>  add_filter( 'set-screen-option', 'bp_activity_admin_screen_options', 10, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Register the Activity component admin screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_add_admin_menu() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add our screen.</span>&nbsp;</div></li><li><div>  $hook = add_menu_page(&nbsp;</div></li><li><div>      _x( 'Activity', 'Admin Dashbord SWA page title', 'buddypress' ), &nbsp;</div></li><li><div>      _x( 'Activity', 'Admin Dashbord SWA menu', 'buddypress' ), &nbsp;</div></li><li><div>      'bp_moderate', &nbsp;</div></li><li><div>      'bp-activity', &nbsp;</div></li><li><div>      'bp_activity_admin', &nbsp;</div></li><li><div>      'div'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Hook into early actions to load custom CSS and our init handler.</span>&nbsp;</div></li><li><div>  add_action( &quot;load-$hook&quot;, 'bp_activity_admin_load' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( bp_core_admin_hook(), 'bp_activity_add_admin_menu' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add activity component to custom menus array.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Several BuddyPress components have top-level menu items in the Dashboard, </span>&nbsp;</div></li><li><div><span class="comment"> * which all appear together in the middle of the Dashboard menu. This function</span>&nbsp;</div></li><li><div><span class="comment"> * adds the Activity page to the array of these menu items.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.7.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array $custom_menus The list of top-level BP menu items.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $custom_menus List of top-level BP menu items, with Activity added.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_menu_order( $custom_menus = array() ) {&nbsp;</div></li><li><div>  array_push( $custom_menus, 'bp-activity' );&nbsp;</div></li><li><div>  return $custom_menus;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'bp_admin_menu_order', 'bp_activity_admin_menu_order' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * AJAX receiver for Activity replies via the admin screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Processes requests to add new activity comments, and echoes HTML for a new</span>&nbsp;</div></li><li><div><span class="comment"> * table row.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_reply() {&nbsp;</div></li><li><div>  <span class="comment">// Check nonce.</span>&nbsp;</div></li><li><div>  check_ajax_referer( 'bp-activity-admin-reply', '_ajax_nonce-bp-activity-admin-reply' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $parent_id = ! empty( $_REQUEST['parent_id'] ) ? (int) $_REQUEST['parent_id'] : 0;&nbsp;</div></li><li><div>  $root_id = ! empty( $_REQUEST['root_id'] )   ? (int) $_REQUEST['root_id']   : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// $parent_id is required</span>&nbsp;</div></li><li><div>  if ( empty( $parent_id ) )&nbsp;</div></li><li><div>      die( '-1' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If $root_id not set (e.g. for root items), use $parent_id.</span>&nbsp;</div></li><li><div>  if ( empty( $root_id ) )&nbsp;</div></li><li><div>      $root_id = $parent_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check that a reply has been entered.</span>&nbsp;</div></li><li><div>  if ( empty( $_REQUEST['content'] ) )&nbsp;</div></li><li><div>      die( __( 'ERROR: Please type a reply.', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Check parent activity exists.</span>&nbsp;</div></li><li><div>  $parent_activity = new BP_Activity_Activity( $parent_id );&nbsp;</div></li><li><div>  if ( empty( $parent_activity-&gt;component ) )&nbsp;</div></li><li><div>      die( __( 'ERROR: The item you are trying to reply to cannot be found, or it has been deleted.', 'buddypress' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// @todo: Check if user is allowed to create new activity items</span>&nbsp;</div></li><li><div>  <span class="comment">// if ( ! current_user_can( 'bp_new_activity' ) )</span>&nbsp;</div></li><li><div>  if ( ! current_user_can( 'bp_moderate' ) )&nbsp;</div></li><li><div>      die( '-1' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Add new activity comment.</span>&nbsp;</div></li><li><div>  $new_activity_id = bp_activity_new_comment( array(&nbsp;</div></li><li><div>      'activity_id' =&gt; $root_id, <span class="comment">// ID of the root activity item.</span>&nbsp;</div></li><li><div>      'content' =&gt; $_REQUEST['content'], &nbsp;</div></li><li><div>      'parent_id' =&gt; $parent_id, <span class="comment">// ID of a parent comment.</span>&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Fetch the new activity item, as we need it to create table markup to return.</span>&nbsp;</div></li><li><div>  $new_activity = new BP_Activity_Activity( $new_activity_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// This needs to be set for the BP_Activity_List_Table constructor to work.</span>&nbsp;</div></li><li><div>  set_current_screen( 'toplevel_page_bp-activity' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Set up an output buffer.</span>&nbsp;</div></li><li><div>  ob_start();&nbsp;</div></li><li><div>  $list_table = new BP_Activity_List_Table();&nbsp;</div></li><li><div>  $list_table-&gt;single_row( (array) $new_activity );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Get table markup.</span>&nbsp;</div></li><li><div>  $response =  array(&nbsp;</div></li><li><div>      'data' =&gt; ob_get_contents(), &nbsp;</div></li><li><div>      'id' =&gt; $new_activity_id, &nbsp;</div></li><li><div>      'position' =&gt; -1, &nbsp;</div></li><li><div>      'what' =&gt; 'bp_activity', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  ob_end_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Send response.</span>&nbsp;</div></li><li><div>  $r = new WP_Ajax_Response();&nbsp;</div></li><li><div>  $r-&gt;add( $response );&nbsp;</div></li><li><div>  $r-&gt;send();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  exit();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_action( 'wp_ajax_bp-activity-admin-reply', 'bp_activity_admin_reply' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Handle save/update of screen options for the Activity component admin screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $value     Will always be false unless another plugin filters it first.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $option    Screen option name.</span>&nbsp;</div></li><li><div><span class="comment"> * @param string $new_value Screen option form value.</span>&nbsp;</div></li><li><div><span class="comment"> * @return string Option value. False to abandon update.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_screen_options( $value, $option, $new_value ) {&nbsp;</div></li><li><div>  if ( 'toplevel_page_bp_activity_per_page' != $option && 'toplevel_page_bp_activity_network_per_page' != $option )&nbsp;</div></li><li><div>      return $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Per page.</span>&nbsp;</div></li><li><div>  $new_value = (int) $new_value;&nbsp;</div></li><li><div>  if ( $new_value &lt; 1 || $new_value &gt; 999 )&nbsp;</div></li><li><div>      return $value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $new_value;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Hide the advanced edit meta boxes by default, so we don't clutter the screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param array     $hidden Array of items to hide.</span>&nbsp;</div></li><li><div><span class="comment"> * @param WP_Screen $screen Screen identifier.</span>&nbsp;</div></li><li><div><span class="comment"> * @return array Hidden Meta Boxes.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_edit_hidden_metaboxes( $hidden, $screen ) {&nbsp;</div></li><li><div>  if ( empty( $screen-&gt;id ) || 'toplevel_page_bp-activity' !== $screen-&gt;id && 'toplevel_page_bp-activity-network' !== $screen-&gt;id ) {&nbsp;</div></li><li><div>      return $hidden;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Hide the primary link meta box by default.</span>&nbsp;</div></li><li><div>  $hidden = array_merge( (array) $hidden, array( 'bp_activity_itemids', 'bp_activity_link', 'bp_activity_type', 'bp_activity_userid', ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters default hidden metaboxes so plugins can alter list.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array     $hidden Default metaboxes to hide.</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Screen $screen Screen identifier.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return apply_filters( 'bp_hide_meta_boxes', array_unique( $hidden ), $screen );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>add_filter( 'default_hidden_meta_boxes', 'bp_activity_admin_edit_hidden_metaboxes', 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Set up the Activity admin page.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Does the following:</span>&nbsp;</div></li><li><div><span class="comment"> *   - Register contextual help and screen options for this admin page.</span>&nbsp;</div></li><li><div><span class="comment"> *   - Enqueues scripts and styles.</span>&nbsp;</div></li><li><div><span class="comment"> *   - Catches POST and GET requests related to Activity.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global object                 $bp                     BuddyPress global settings.</span>&nbsp;</div></li><li><div><span class="comment"> * @global BP_Activity_List_Table $bp_activity_list_table Activity screen list table.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_load() {&nbsp;</div></li><li><div>  global $bp_activity_list_table;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>  $doaction = bp_admin_list_table_current_bulk_action();&nbsp;</div></li><li><div>  $min = bp_core_get_minified_asset_suffix();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires at top of Activity admin page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $doaction Current $_GET action being performed in admin screen.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bp_activity_admin_load', $doaction );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Edit screen.</span>&nbsp;</div></li><li><div>  if ( 'edit' == $doaction && ! empty( $_GET['aid'] ) ) {&nbsp;</div></li><li><div>      <span class="comment">// Columns screen option.</span>&nbsp;</div></li><li><div>      add_screen_option( 'layout_columns', array( 'default' =&gt; 2, 'max' =&gt; 2, ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      get_current_screen()-&gt;add_help_tab( array(&nbsp;</div></li><li><div>          'id' =&gt; 'bp-activity-edit-overview', &nbsp;</div></li><li><div>          'title' =&gt; __( 'Overview', 'buddypress' ), &nbsp;</div></li><li><div>          'content' =&gt;&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( 'You edit activities made on your site similar to the way you edit a comment. This is useful if you need to change which page the activity links to, or when you notice that the author has made a typographical error.', 'buddypress' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( 'The two big editing areas for the activity title and content are fixed in place, but you can reposition all the other boxes using drag and drop, and can minimize or expand them by clicking the title bar of each box. Use the Screen Options tab to unhide more boxes (Primary Item/Secondary Item, Link, Type, Author ID) or to choose a 1- or 2-column layout for this screen.', 'buddypress' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( 'You can also moderate the activity from this screen using the Status box, where you can also change the timestamp of the activity.', 'buddypress' ) . '&lt;/p&gt;'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      get_current_screen()-&gt;add_help_tab( array(&nbsp;</div></li><li><div>          'id' =&gt; 'bp-activity-edit-advanced', &nbsp;</div></li><li><div>          'title' =&gt; __( 'Item, Link, Type', 'buddypress' ), &nbsp;</div></li><li><div>          'content' =&gt;&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;strong&gt;Primary Item/Secondary Item&lt;/strong&gt; - These identify the object that created the activity. For example, the fields could reference a comment left on a specific site. Some types of activity may only use one, or none, of these fields.', 'buddypress' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;strong&gt;Link&lt;/strong&gt; - Used by some types of activity (e.g blog posts and comments, and forum topics and replies) to store a link back to the original content.', 'buddypress' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( '&lt;strong&gt;Type&lt;/strong&gt; - Each distinct kind of activity has its own type. For example, &lt;code&gt;created_group&lt;/code&gt; is used when a group is created and &lt;code&gt;joined_group&lt;/code&gt; is used when a user joins a group.', 'buddypress' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( 'For information about when and how BuddyPress uses all of these settings, see the Managing Activity link in the panel to the side.', 'buddypress' ) . '&lt;/p&gt;'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Help panel - sidebar links.</span></span>&nbsp;</div></li><li><div>      get_current_screen()-&gt;set_help_sidebar(&nbsp;</div></li><li><div>          '&lt;p&gt;&lt;strong&gt;' . __( 'For more information:', 'buddypress' ) . '&lt;/strong&gt;&lt;/p&gt;' .&nbsp;</div></li><li><div>          '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment">//codex.buddypress.org/administrator-guide/activity-stream-management-panels/&quot;&gt;Managing Activity&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;' .</span>&nbsp;</div></li><li><div>          '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment"><span class="comment">//buddypress.org/support/&quot;&gt;Support Forums&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;'</span></span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Register metaboxes for the edit screen.</span>&nbsp;</div></li><li><div>      add_meta_box( 'submitdiv', _x( 'Status', 'activity admin edit screen', 'buddypress' ), 'bp_activity_admin_edit_metabox_status', get_current_screen()-&gt;id, 'side', 'core' );&nbsp;</div></li><li><div>      add_meta_box( 'bp_activity_itemids', _x( 'Primary Item/Secondary Item', 'activity admin edit screen', 'buddypress' ), 'bp_activity_admin_edit_metabox_itemids', get_current_screen()-&gt;id, 'normal', 'core' );&nbsp;</div></li><li><div>      add_meta_box( 'bp_activity_link', _x( 'Link', 'activity admin edit screen', 'buddypress' ), 'bp_activity_admin_edit_metabox_link', get_current_screen()-&gt;id, 'normal', 'core' );&nbsp;</div></li><li><div>      add_meta_box( 'bp_activity_type', _x( 'Type', 'activity admin edit screen', 'buddypress' ), 'bp_activity_admin_edit_metabox_type', get_current_screen()-&gt;id, 'normal', 'core' );&nbsp;</div></li><li><div>      add_meta_box( 'bp_activity_userid', _x( 'Author ID', 'activity admin edit screen', 'buddypress' ), 'bp_activity_admin_edit_metabox_userid', get_current_screen()-&gt;id, 'normal', 'core' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires after the registration of all of the default activity meta boxes.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'bp_activity_admin_meta_boxes' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Enqueue JavaScript files.</span>&nbsp;</div></li><li><div>      wp_enqueue_script( 'postbox' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'dashboard' );&nbsp;</div></li><li><div>      wp_enqueue_script( 'comment' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Index screen.</span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// Create the Activity screen list table.</span>&nbsp;</div></li><li><div>      $bp_activity_list_table = new BP_Activity_List_Table();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// The per_page screen option.</span>&nbsp;</div></li><li><div>      add_screen_option( 'per_page', array( 'label' =&gt; _x( 'Activity', 'Activity items per page (screen options)', 'buddypress' )) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Help panel - overview text.</span>&nbsp;</div></li><li><div>      get_current_screen()-&gt;add_help_tab( array(&nbsp;</div></li><li><div>          'id' =&gt; 'bp-activity-overview', &nbsp;</div></li><li><div>          'title' =&gt; __( 'Overview', 'buddypress' ), &nbsp;</div></li><li><div>          'content' =&gt;&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( 'You can manage activities made on your site similar to the way you manage comments and other content. This screen is customizable in the same ways as other management screens, and you can act on activities using the on-hover action links or the Bulk Actions.', 'buddypress' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( 'There are many different types of activities. Some are generated automatically by BuddyPress and other plugins, and some are entered directly by a user in the form of status update. To help manage the different activity types, use the filter dropdown box to switch between them.', 'buddypress' ) . '&lt;/p&gt;'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Help panel - moderation text.</span>&nbsp;</div></li><li><div>      get_current_screen()-&gt;add_help_tab( array(&nbsp;</div></li><li><div>          'id' =&gt; 'bp-activity-moderating', &nbsp;</div></li><li><div>          'title' =&gt; __( 'Moderating Activity', 'buddypress' ), &nbsp;</div></li><li><div>          'content' =&gt;&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( 'In the &lt;strong&gt;Activity&lt;/strong&gt; column, above each activity it says &#8220;Submitted on, &#8221; followed by the date and time the activity item was generated on your site. Clicking on the date/time link will take you to that activity on your live site. Hovering over any activity gives you options to reply, edit, spam mark, or delete that activity.', 'buddypress' ) . '&lt;/p&gt;' .&nbsp;</div></li><li><div>              '&lt;p&gt;' . __( &quot;In the &lt;strong&gt;In Response To&lt;/strong&gt; column, if the activity was in reply to another activity, it shows that activity's author's picture and name, and a link to that activity on your live site. If there is a small bubble, the number in it shows how many other activities are related to this one; these are usually comments. Clicking the bubble will filter the activity screen to show only related activity items.&quot;, 'buddypress' ) . '&lt;/p&gt;'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Help panel - sidebar links.</span></span>&nbsp;</div></li><li><div>      get_current_screen()-&gt;set_help_sidebar(&nbsp;</div></li><li><div>          '&lt;p&gt;&lt;strong&gt;' . __( 'For more information:', 'buddypress' ) . '&lt;/strong&gt;&lt;/p&gt;' .&nbsp;</div></li><li><div>          '&lt;p&gt;' . __( '&lt;a href=&quot;https:<span class="comment"><span class="comment">//buddypress.org/support/&quot;&gt;Support Forums&lt;/a&gt;', 'buddypress' ) . '&lt;/p&gt;'</span></span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add accessible hidden heading and text for Activity screen pagination.</span>&nbsp;</div></li><li><div>      if ( bp_get_major_wp_version() &gt;= 4.4 ) {&nbsp;</div></li><li><div>          get_current_screen()-&gt;set_screen_reader_content( array(&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'heading_pagination' =&gt; __( 'Activity list navigation', 'buddypress' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Enqueue CSS and JavaScript.</span>&nbsp;</div></li><li><div>  wp_enqueue_script( 'bp_activity_admin_js', $bp-&gt;plugin_url . &quot;bp-activity/admin/js/admin{$min}.js&quot;, array( 'jquery', 'wp-ajax-response' ), bp_get_version(), true );&nbsp;</div></li><li><div>  wp_localize_script( 'bp_activity_admin_js', 'bp_activity_admin_vars', array(&nbsp;</div></li><li><div>      'page' =&gt; get_current_screen()-&gt;id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  wp_enqueue_style( 'bp_activity_admin_css', $bp-&gt;plugin_url . &quot;bp-activity/admin/css/admin{$min}.css&quot;, array(), bp_get_version() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  wp_style_add_data( 'bp_activity_admin_css', 'rtl', true );&nbsp;</div></li><li><div>  if ( $min ) {&nbsp;</div></li><li><div>      wp_style_add_data( 'bp_activity_admin_css', 'suffix', $min );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires after the activity js and style has been enqueued.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bp_activity_admin_enqueue_scripts' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Handle spam/un-spam/delete of activities.</span>&nbsp;</div></li><li><div>  if ( !empty( $doaction ) && ! in_array( $doaction, array( '-1', 'edit', 'save', ) ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Build redirection URL.</span></span>&nbsp;</div></li><li><div>      $redirect_to = remove_query_arg( array( 'aid', 'deleted', 'error', 'spammed', 'unspammed', ), wp_get_referer() );&nbsp;</div></li><li><div>      $redirect_to = add_query_arg( 'paged', $bp_activity_list_table-&gt;get_pagenum(), $redirect_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get activity IDs.</span>&nbsp;</div></li><li><div>      $activity_ids = array_map( 'absint', (array) $_REQUEST['aid'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters list of IDs being spammed/un-spammed/deleted.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $activity_ids Activity IDs to spam/un-spam/delete.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $activity_ids = apply_filters( 'bp_activity_admin_action_activity_ids', $activity_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Is this a bulk request?</span>&nbsp;</div></li><li><div>      if ( 'bulk_' == substr( $doaction, 0, 5 ) && ! empty( $_REQUEST['aid'] ) ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Check this is a valid form submission.</span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'bulk-activities' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Trim 'bulk_' off the action name to avoid duplicating a ton of code.</span>&nbsp;</div></li><li><div>          $doaction = substr( $doaction, 5 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// This is a request to delete, spam, or un-spam, a single item.</span>&nbsp;</div></li><li><div>      } elseif ( !empty( $_REQUEST['aid'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Check this is a valid form submission.</span></span></span>&nbsp;</div></li><li><div>          check_admin_referer( 'spam-activity_' . $activity_ids[0] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Initialise counters for how many of each type of item we perform an action on.</span>&nbsp;</div></li><li><div>      $deleted = $spammed = $unspammed = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Store any errors that occurs when updating the database items.</span>&nbsp;</div></li><li><div>      $errors = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// &quot;We'd like to shoot the monster, could you move, please?&quot;</span>&nbsp;</div></li><li><div>      foreach ( $activity_ids as $activity_id ) {&nbsp;</div></li><li><div>          <span class="comment">// @todo: Check the permissions on each</span>&nbsp;</div></li><li><div>          <span class="comment">// if ( ! current_user_can( 'bp_edit_activity', $activity_id ) )</span>&nbsp;</div></li><li><div>          <span class="comment">// continue;</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment"><span class="comment">// Get the activity from the database.</span></span></span>&nbsp;</div></li><li><div>          $activity = new BP_Activity_Activity( $activity_id );&nbsp;</div></li><li><div>          if ( empty( $activity-&gt;component ) ) {&nbsp;</div></li><li><div>              $errors[] = $activity_id;&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          switch ( $doaction ) {&nbsp;</div></li><li><div>              case 'delete' :&nbsp;</div></li><li><div>                  if ( 'activity_comment' == $activity-&gt;type )&nbsp;</div></li><li><div>                      bp_activity_delete_comment( $activity-&gt;item_id, $activity-&gt;id );&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                      bp_activity_delete( array( 'id' =&gt; $activity-&gt;id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $deleted++;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'ham' :&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Remove moderation and blacklist checks in case we want to ham an activity</span>&nbsp;</div></li><li><div><span class="comment">                   * which contains one of these listed keys.</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  remove_action( 'bp_activity_before_save', 'bp_activity_check_moderation_keys', 2 );&nbsp;</div></li><li><div>                  remove_action( 'bp_activity_before_save', 'bp_activity_check_blacklist_keys', 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  bp_activity_mark_as_ham( $activity );&nbsp;</div></li><li><div>                  $result = $activity-&gt;save();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// Check for any error during activity save.</span></span></span>&nbsp;</div></li><li><div>                  if ( ! $result )&nbsp;</div></li><li><div>                      $errors[] = $activity-&gt;id;&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                      $unspammed++;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              case 'spam' :&nbsp;</div></li><li><div>                  bp_activity_mark_as_spam( $activity );&nbsp;</div></li><li><div>                  $result = $activity-&gt;save();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">// Check for any error during activity save.</span></span></span>&nbsp;</div></li><li><div>                  if ( ! $result )&nbsp;</div></li><li><div>                      $errors[] = $activity-&gt;id;&nbsp;</div></li><li><div>                  else&nbsp;</div></li><li><div>                      $spammed++;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              default:&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Release memory.</span>&nbsp;</div></li><li><div>          unset( $activity );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before redirect for plugins to do something with activity.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Passes an activity array counts how many were spam, not spam, deleted, and IDs that were errors.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array  $value        Array holding spam, not spam, deleted counts, error IDs.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $redirect_to  URL to redirect to.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array  $activity_ids Original array of activity IDs.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'bp_activity_admin_action_after', array( $spammed, $unspammed, $deleted, $errors ), $redirect_to, $activity_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Add arguments to the redirect URL so that on page reload, we can easily display what we've just done.</span>&nbsp;</div></li><li><div>      if ( $spammed )&nbsp;</div></li><li><div>          $redirect_to = add_query_arg( 'spammed', $spammed, $redirect_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $unspammed )&nbsp;</div></li><li><div>          $redirect_to = add_query_arg( 'unspammed', $unspammed, $redirect_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $deleted )&nbsp;</div></li><li><div>          $redirect_to = add_query_arg( 'deleted', $deleted, $redirect_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// If an error occurred, pass back the activity ID that failed.</span></span>&nbsp;</div></li><li><div>      if ( ! empty( $errors ) )&nbsp;</div></li><li><div>          $redirect_to = add_query_arg( 'error', implode ( ', ', array_map( 'absint', $errors ) ), $redirect_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters redirect URL after activity spamming/un-spamming/deletion occurs.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $redirect_to URL to redirect to.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      wp_redirect( apply_filters( 'bp_activity_admin_action_redirect', $redirect_to ) );&nbsp;</div></li><li><div>      exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Save the edit.</span>&nbsp;</div></li><li><div>  } elseif ( $doaction && 'save' == $doaction ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Build redirection URL.</span></span>&nbsp;</div></li><li><div>      $redirect_to = remove_query_arg( array( 'action', 'aid', 'deleted', 'error', 'spammed', 'unspammed', ), $_SERVER['REQUEST_URI'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Get activity ID.</span>&nbsp;</div></li><li><div>      $activity_id = (int) $_REQUEST['aid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Check this is a valid form submission.</span></span></span>&nbsp;</div></li><li><div>      check_admin_referer( 'edit-activity_' . $activity_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Get the activity from the database.</span></span></span>&nbsp;</div></li><li><div>      $activity = new BP_Activity_Activity( $activity_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// If the activity doesn't exist, just redirect back to the index.</span>&nbsp;</div></li><li><div>      if ( empty( $activity-&gt;component ) ) {&nbsp;</div></li><li><div>          wp_redirect( $redirect_to );&nbsp;</div></li><li><div>          exit;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Check the form for the updated properties.</span>&nbsp;</div></li><li><div>      <span class="comment">// Store any error that occurs when updating the database item.</span>&nbsp;</div></li><li><div>      $error = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Activity spam status.</span>&nbsp;</div></li><li><div>      $prev_spam_status = $new_spam_status = false;&nbsp;</div></li><li><div>      if ( ! empty( $_POST['activity_status'] ) ) {&nbsp;</div></li><li><div>          $prev_spam_status = $activity-&gt;is_spam;&nbsp;</div></li><li><div>          $new_spam_status = ( 'spam' == $_POST['activity_status'] ) ? true : false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Activity action.</span>&nbsp;</div></li><li><div>      if ( isset( $_POST['bp-activities-action'] ) )&nbsp;</div></li><li><div>          $activity-&gt;action = $_POST['bp-activities-action'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Activity content.</span>&nbsp;</div></li><li><div>      if ( isset( $_POST['bp-activities-content'] ) )&nbsp;</div></li><li><div>          $activity-&gt;content = $_POST['bp-activities-content'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Activity primary link.</span>&nbsp;</div></li><li><div>      if ( ! empty( $_POST['bp-activities-link'] ) )&nbsp;</div></li><li><div>          $activity-&gt;primary_link = $_POST['bp-activities-link'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Activity user ID.</span>&nbsp;</div></li><li><div>      if ( ! empty( $_POST['bp-activities-userid'] ) )&nbsp;</div></li><li><div>          $activity-&gt;user_id = (int) $_POST['bp-activities-userid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Activity item primary ID.</span>&nbsp;</div></li><li><div>      if ( isset( $_POST['bp-activities-primaryid'] ) )&nbsp;</div></li><li><div>          $activity-&gt;item_id = (int) $_POST['bp-activities-primaryid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Activity item secondary ID.</span>&nbsp;</div></li><li><div>      if ( isset( $_POST['bp-activities-secondaryid'] ) )&nbsp;</div></li><li><div>          $activity-&gt;secondary_item_id = (int) $_POST['bp-activities-secondaryid'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Activity type.</span>&nbsp;</div></li><li><div>      if ( ! empty( $_POST['bp-activities-type'] ) ) {&nbsp;</div></li><li><div>          $actions = bp_activity_admin_get_activity_actions();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Check that the new type is a registered activity type.</span>&nbsp;</div></li><li><div>          if ( in_array( $_POST['bp-activities-type'], $actions ) ) {&nbsp;</div></li><li><div>              $activity-&gt;type = $_POST['bp-activities-type'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Activity timestamp.</span>&nbsp;</div></li><li><div>      if ( ! empty( $_POST['aa'] ) && ! empty( $_POST['mm'] ) && ! empty( $_POST['jj'] ) && ! empty( $_POST['hh'] ) && ! empty( $_POST['mn'] ) && ! empty( $_POST['ss'] ) ) {&nbsp;</div></li><li><div>          $aa = $_POST['aa'];&nbsp;</div></li><li><div>          $mm = $_POST['mm'];&nbsp;</div></li><li><div>          $jj = $_POST['jj'];&nbsp;</div></li><li><div>          $hh = $_POST['hh'];&nbsp;</div></li><li><div>          $mn = $_POST['mn'];&nbsp;</div></li><li><div>          $ss = $_POST['ss'];&nbsp;</div></li><li><div>          $aa = ( $aa &lt;= 0 ) ? date( 'Y' ) : $aa;&nbsp;</div></li><li><div>          $mm = ( $mm &lt;= 0 ) ? date( 'n' ) : $mm;&nbsp;</div></li><li><div>          $jj = ( $jj &gt; 31 ) ? 31 : $jj;&nbsp;</div></li><li><div>          $jj = ( $jj &lt;= 0 ) ? date( 'j' ) : $jj;&nbsp;</div></li><li><div>          $hh = ( $hh &gt; 23 ) ? $hh -24 : $hh;&nbsp;</div></li><li><div>          $mn = ( $mn &gt; 59 ) ? $mn -60 : $mn;&nbsp;</div></li><li><div>          $ss = ( $ss &gt; 59 ) ? $ss -60 : $ss;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Reconstruct the date into a timestamp.</span>&nbsp;</div></li><li><div>          $gmt_date = sprintf( &quot;%04d-%02d-%02d %02d:%02d:%02d&quot;, $aa, $mm, $jj, $hh, $mn, $ss );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $activity-&gt;date_recorded = $gmt_date;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Has the spam status has changed?</span>&nbsp;</div></li><li><div>      if ( $new_spam_status != $prev_spam_status ) {&nbsp;</div></li><li><div>          if ( $new_spam_status )&nbsp;</div></li><li><div>              bp_activity_mark_as_spam( $activity );&nbsp;</div></li><li><div>          else&nbsp;</div></li><li><div>              bp_activity_mark_as_ham( $activity );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Save.</span>&nbsp;</div></li><li><div>      $result = $activity-&gt;save();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Clear the activity stream first page cache, in case this activity's timestamp was changed.</span>&nbsp;</div></li><li><div>      wp_cache_delete( 'bp_activity_sitewide_front', 'bp' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Check for any error during activity save.</span></span></span>&nbsp;</div></li><li><div>      if ( false === $result )&nbsp;</div></li><li><div>          $error = $activity-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Fires before redirect so plugins can do something first on save action.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $value Array holding activity object and ID that holds error.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action_ref_array( 'bp_activity_admin_edit_after', array( &$activity, $error ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// If an error occurred, pass back the activity ID that failed.</span></span>&nbsp;</div></li><li><div>      if ( $error )&nbsp;</div></li><li><div>          $redirect_to = add_query_arg( 'error', $error, $redirect_to );&nbsp;</div></li><li><div>      else&nbsp;</div></li><li><div>          $redirect_to = add_query_arg( 'updated', $activity-&gt;id, $redirect_to );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filters URL to redirect to after saving.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $redirect_to URL to redirect to.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      wp_redirect( apply_filters( 'bp_activity_admin_edit_redirect', $redirect_to ) );&nbsp;</div></li><li><div>      exit;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If a referrer and a nonce is supplied, but no action, redirect back.</span>&nbsp;</div></li><li><div>  } elseif ( ! empty( $_GET['_wp_http_referer'] ) ) {&nbsp;</div></li><li><div>      wp_redirect( remove_query_arg( array( '_wp_http_referer', '_wpnonce' ), stripslashes( $_SERVER['REQUEST_URI'] ) ) );&nbsp;</div></li><li><div>      exit;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Output the Activity component admin screens.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin() {&nbsp;</div></li><li><div>  <span class="comment">// Decide whether to load the index or edit screen.</span>&nbsp;</div></li><li><div>  $doaction = ! empty( $_REQUEST['action'] ) ? $_REQUEST['action'] : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Display the single activity edit screen.</span>&nbsp;</div></li><li><div>  if ( 'edit' == $doaction && ! empty( $_GET['aid'] ) )&nbsp;</div></li><li><div>      bp_activity_admin_edit();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Otherwise, display the Activity index screen.</span>&nbsp;</div></li><li><div>  else&nbsp;</div></li><li><div>      bp_activity_admin_index();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display the single activity edit screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_edit() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// @todo: Check if user is allowed to edit activity items</span>&nbsp;</div></li><li><div>  <span class="comment">// if ( ! current_user_can( 'bp_edit_activity' ) )</span>&nbsp;</div></li><li><div>  if ( ! is_super_admin() )&nbsp;</div></li><li><div>      die( '-1' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment"><span class="comment">// Get the activity from the database.</span></span></span>&nbsp;</div></li><li><div>  $activity = bp_activity_get( array(&nbsp;</div></li><li><div>      'in' =&gt; ! empty( $_REQUEST['aid'] ) ? (int) $_REQUEST['aid'] : 0, &nbsp;</div></li><li><div>      'max' =&gt; 1, &nbsp;</div></li><li><div>      'show_hidden' =&gt; true, &nbsp;</div></li><li><div>      'spam' =&gt; 'all', &nbsp;</div></li><li><div>      'display_comments' =&gt; 0&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $activity['activities'][0] ) ) {&nbsp;</div></li><li><div>      $activity = $activity['activities'][0];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Workaround to use WP's touch_time() without duplicating that function.</span>&nbsp;</div></li><li><div>      $GLOBALS['comment'] = new stdClass;&nbsp;</div></li><li><div>      $GLOBALS['comment']-&gt;comment_date = $activity-&gt;date_recorded;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $activity = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Construct URL for form.</span>&nbsp;</div></li><li><div>  $form_url = remove_query_arg( array( 'action', 'deleted', 'error', 'spammed', 'unspammed', ), $_SERVER['REQUEST_URI'] );&nbsp;</div></li><li><div>  $form_url = add_query_arg( 'action', 'save', $form_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before activity edit form is displays so plugins can modify the activity.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $value Array holding single activity object that was passed by reference.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action_ref_array( 'bp_activity_admin_edit', array( &$activity ) ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>      &lt;h1&gt;&lt;?php printf( __( 'Editing Activity (ID #%s)', 'buddypress' ), number_format_i18n( (int) $_REQUEST['aid'] ) ); ?&gt;&lt;/h1&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php if ( ! empty( $activity ) ) : ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;form action=&quot;&lt;?php echo esc_url( $form_url ); ?&gt;&quot; id=&quot;bp-activities-edit-form&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;poststuff&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;div id=&quot;post-body&quot; class=&quot;metabox-holder columns-&lt;?php echo 1 == get_current_screen()-&gt;get_columns() ? '1' : '2'; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>                      &lt;div id=&quot;post-body-content&quot;&gt;&nbsp;</div></li><li><div>                          &lt;div id=&quot;postdiv&quot;&gt;&nbsp;</div></li><li><div>                              &lt;div id=&quot;bp_activity_action&quot; class=&quot;postbox&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;h2&gt;&lt;?php _e( 'Action', 'buddypress' ); ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;inside&quot;&gt;&nbsp;</div></li><li><div>                                      &lt;label for=&quot;bp-activities-action&quot; class=&quot;screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          _e( 'Edit activity action', 'buddypress' );&nbsp;</div></li><li><div>                                      ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                                      &lt;?php wp_editor( stripslashes( $activity-&gt;action ), 'bp-activities-action', array( 'media_buttons' =&gt; false, 'textarea_rows' =&gt; 7, 'teeny' =&gt; true, 'quicktags' =&gt; array( 'buttons' =&gt; 'strong, em, link, block, del, ins, img, code, spell, close' ) ) ); ?&gt;&nbsp;</div></li><li><div>                                  &lt;/div&gt;&nbsp;</div></li><li><div>                              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              &lt;div id=&quot;bp_activity_content&quot; class=&quot;postbox&quot;&gt;&nbsp;</div></li><li><div>                                  &lt;h2&gt;&lt;?php _e( 'Content', 'buddypress' ); ?&gt;&lt;/h2&gt;&nbsp;</div></li><li><div>                                  &lt;div class=&quot;inside&quot;&gt;&nbsp;</div></li><li><div>                                      &lt;label for=&quot;bp-activities-content&quot; class=&quot;screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                                          _e( 'Edit activity content', 'buddypress' );&nbsp;</div></li><li><div>                                      ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                                      &lt;?php wp_editor( stripslashes( $activity-&gt;content ), 'bp-activities-content', array( 'media_buttons' =&gt; false, 'teeny' =&gt; true, 'quicktags' =&gt; array( 'buttons' =&gt; 'strong, em, link, block, del, ins, img, code, spell, close' ) ) ); ?&gt;&nbsp;</div></li><li><div>                                  &lt;/div&gt;&nbsp;</div></li><li><div>                              &lt;/div&gt;&nbsp;</div></li><li><div>                          &lt;/div&gt;&nbsp;</div></li><li><div>                      &lt;/div&gt;&lt;!-- #post-body-content --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      &lt;div id=&quot;postbox-container-1&quot; class=&quot;postbox-container&quot;&gt;&nbsp;</div></li><li><div>                          &lt;?php do_meta_boxes( get_current_screen()-&gt;id, 'side', $activity ); ?&gt;&nbsp;</div></li><li><div>                      &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      &lt;div id=&quot;postbox-container-2&quot; class=&quot;postbox-container&quot;&gt;&nbsp;</div></li><li><div>                          &lt;?php do_meta_boxes( get_current_screen()-&gt;id, 'normal', $activity ); ?&gt;&nbsp;</div></li><li><div>                          &lt;?php do_meta_boxes( get_current_screen()-&gt;id, 'advanced', $activity ); ?&gt;&nbsp;</div></li><li><div>                      &lt;/div&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&lt;!-- #post-body --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;/div&gt;&lt;!-- #poststuff --&gt;&nbsp;</div></li><li><div>              &lt;?php wp_nonce_field( 'closedpostboxes', 'closedpostboxesnonce', false ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php wp_nonce_field( 'meta-box-order', 'meta-box-order-nonce', false ); ?&gt;&nbsp;</div></li><li><div>              &lt;?php wp_nonce_field( 'edit-activity_' . $activity-&gt;id ); ?&gt;&nbsp;</div></li><li><div>          &lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php else : ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;p&gt;&lt;?php&nbsp;</div></li><li><div>              printf(&nbsp;</div></li><li><div>                  '%1$s &lt;a href=&quot;%2$s&quot;&gt;%3$s&lt;/a&gt;', &nbsp;</div></li><li><div>                  __( 'No activity found with this ID.', 'buddypress' ), &nbsp;</div></li><li><div>                  esc_url( bp_get_admin_url( 'admin.php?page=bp-activity' ) ), &nbsp;</div></li><li><div>                  __( 'Go back and try again.', 'buddypress' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;/div&gt;&lt;!-- .wrap --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Status metabox for the Activity admin edit screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param object $item Activity item.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_edit_metabox_status( $item ) {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div class=&quot;submitbox&quot; id=&quot;submitcomment&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;div id=&quot;minor-publishing&quot;&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;minor-publishing-actions&quot;&gt;&nbsp;</div></li><li><div>              &lt;div id=&quot;preview-action&quot;&gt;&nbsp;</div></li><li><div>                  &lt;a class=&quot;button preview&quot; href=&quot;&lt;?php echo esc_attr( bp_activity_get_permalink( $item-&gt;id, $item ) ); ?&gt;&quot; target=&quot;_blank&quot;&gt;&lt;?php _e( 'View Activity', 'buddypress' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&lt;!-- #minor-publishing-actions --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;div id=&quot;misc-publishing-actions&quot;&gt;&nbsp;</div></li><li><div>              &lt;div class=&quot;misc-pub-section&quot; id=&quot;comment-status-radio&quot;&gt;&nbsp;</div></li><li><div>                  &lt;label class=&quot;approved&quot; for=&quot;activity-status-approved&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;activity_status&quot; id=&quot;activity-status-approved&quot; value=&quot;ham&quot; &lt;?php checked( $item-&gt;is_spam, 0 ); ?&gt;&gt;&lt;?php _e( 'Approved', 'buddypress' ); ?&gt;&lt;/label&gt;&lt;br /&gt;&nbsp;</div></li><li><div>                  &lt;label class=&quot;spam&quot; for=&quot;activity-status-spam&quot;&gt;&lt;input type=&quot;radio&quot; name=&quot;activity_status&quot; id=&quot;activity-status-spam&quot; value=&quot;spam&quot; &lt;?php checked( $item-&gt;is_spam, 1 ); ?&gt;&gt;&lt;?php _e( 'Spam', 'buddypress' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;div class=&quot;misc-pub-section curtime misc-pub-section-last&quot;&gt;&nbsp;</div></li><li><div>                  &lt;?php&nbsp;</div></li><li><div>                  <span class="comment">// Translators: Publish box date format, see http://php.net/date.</span>&nbsp;</div></li><li><div>                  $datef = __( 'M j, Y @ G:i', 'buddypress' );&nbsp;</div></li><li><div>                  $date = date_i18n( $datef, strtotime( $item-&gt;date_recorded ) );&nbsp;</div></li><li><div>                  ?&gt;&nbsp;</div></li><li><div>                  &lt;span id=&quot;timestamp&quot;&gt;&lt;?php printf( __( 'Submitted on: %s', 'buddypress' ), '&lt;strong&gt;' . $date . '&lt;/strong&gt;' ); ?&gt;&lt;/span&gt;&nbsp;&lt;a href=&quot;#edit_timestamp&quot; class=&quot;edit-timestamp hide-if-no-js&quot; tabindex='4'&gt;&lt;?php _e( 'Edit', 'buddypress' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;div id='timestampdiv' class='hide-if-js'&gt;&nbsp;</div></li><li><div>                      &lt;?php touch_time( 1, 0, 5 ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/div&gt;&lt;!-- #timestampdiv --&gt;&nbsp;</div></li><li><div>              &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;/div&gt; &lt;!-- #misc-publishing-actions --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&lt;!-- #minor-publishing --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;div id=&quot;major-publishing-actions&quot;&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;publishing-action&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php submit_button( __( 'Update', 'buddypress' ), 'primary', 'save', false ); ?&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&lt;!-- #major-publishing-actions --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;/div&gt;&lt;!-- #submitcomment --&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Primary link metabox for the Activity admin edit screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param object $item Activity item.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_edit_metabox_link( $item ) {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;label class=&quot;screen-reader-text&quot; for=&quot;bp-activities-link&quot;&gt;&lt;?php&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      _e( 'Link', 'buddypress' );&nbsp;</div></li><li><div>  ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;url&quot; name=&quot;bp-activities-link&quot; id=&quot;bp-activities-link&quot; value=&quot;&lt;?php echo esc_url( $item-&gt;primary_link ); ?&gt;&quot; aria-describedby=&quot;bp-activities-link-description&quot; /&gt;&nbsp;</div></li><li><div>  &lt;p id=&quot;bp-activities-link-description&quot;&gt;&lt;?php _e( 'Activity generated by posts and comments, forum topics and replies, and some plugins, uses the link field for a permalink back to the content item.', 'buddypress' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * User ID metabox for the Activity admin edit screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param object $item Activity item.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_edit_metabox_userid( $item ) {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;label class=&quot;screen-reader-text&quot; for=&quot;bp-activities-userid&quot;&gt;&lt;?php&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      _e( 'Author ID', 'buddypress' );&nbsp;</div></li><li><div>  ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;number&quot; name=&quot;bp-activities-userid&quot; id=&quot;bp-activities-userid&quot; value=&quot;&lt;?php echo esc_attr( $item-&gt;user_id ); ?&gt;&quot; min=&quot;1&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get flattened array of all registered activity actions.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Format is [activity_type] =&gt; Pretty name for activity type.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return array $actions</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_get_activity_actions() {&nbsp;</div></li><li><div>  $actions = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Walk through the registered actions, and build an array of actions/values.</span></span>&nbsp;</div></li><li><div>  foreach ( bp_activity_get_actions() as $action ) {&nbsp;</div></li><li><div>      $action = array_values( (array) $action );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ( $i = 0, $i_count = count( $action ); $i &lt; $i_count; $i++ ) {&nbsp;</div></li><li><div>          $actions[ $action[$i]['key'] ] = $action[$i]['value'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// This was a mis-named activity type from before BP 1.6.</span></span>&nbsp;</div></li><li><div>  unset( $actions['friends_register_activity_action'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Sort array by the human-readable value.</span></span>&nbsp;</div></li><li><div>  natsort( $actions );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $actions;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Activity type metabox for the Activity admin edit screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param object $item Activity item.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_edit_metabox_type( $item ) {&nbsp;</div></li><li><div>  $bp = buddypress();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $actions = array();&nbsp;</div></li><li><div>  $selected = $item-&gt;type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Walk through the registered actions, and build an array of actions/values.</span></span>&nbsp;</div></li><li><div>  foreach ( bp_activity_get_actions() as $action ) {&nbsp;</div></li><li><div>      $action = array_values( (array) $action );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ( $i = 0, $i_count = count( $action ); $i &lt; $i_count; $i++ )&nbsp;</div></li><li><div>          $actions[ $action[$i]['key'] ] = $action[$i]['value'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// This was a mis-named activity type from before BP 1.6.</span></span>&nbsp;</div></li><li><div>  unset( $actions['friends_register_activity_action'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment"><span class="comment">// Sort array by the human-readable value.</span></span>&nbsp;</div></li><li><div>  natsort( $actions );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * If the activity type is not registered properly (eg, a plugin has</span>&nbsp;</div></li><li><div><span class="comment">   * not called bp_activity_set_action()), add the raw type to the end</span>&nbsp;</div></li><li><div><span class="comment">   * of the list.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  if ( ! isset( $actions[ $selected ] ) ) {&nbsp;</div></li><li><div>      _doing_it_wrong( __FUNCTION__, sprintf( __( 'This activity item has a type (%s) that is not registered using bp_activity_set_action(), so no label is available.', 'buddypress' ), $selected ), '2.0.0' );&nbsp;</div></li><li><div>      $actions[ $selected ] = $selected;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;label for=&quot;bp-activities-type&quot; class=&quot;screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      esc_html_e( 'Select activity type', 'buddypress' );&nbsp;</div></li><li><div>  ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>  &lt;select name=&quot;bp-activities-type&quot; id=&quot;bp-activities-type&quot;&gt;&nbsp;</div></li><li><div>      &lt;?php foreach ( $actions as $k =&gt; $v ) : ?&gt;&nbsp;</div></li><li><div>          &lt;option value=&quot;&lt;?php echo esc_attr( $k ); ?&gt;&quot; &lt;?php selected( $k, $selected ); ?&gt;&gt;&lt;?php echo esc_html( $v ); ?&gt;&lt;/option&gt;&nbsp;</div></li><li><div>      &lt;?php endforeach; ?&gt;&nbsp;</div></li><li><div>  &lt;/select&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Primary item ID/Secondary item ID metabox for the Activity admin edit screen.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param object $item Activity item.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_edit_metabox_itemids( $item ) {&nbsp;</div></li><li><div>?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;label for=&quot;bp-activities-primaryid&quot;&gt;&lt;?php _e( 'Primary Item ID', 'buddypress' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;number&quot; name=&quot;bp-activities-primaryid&quot; id=&quot;bp-activities-primaryid&quot; value=&quot;&lt;?php echo esc_attr( $item-&gt;item_id ); ?&gt;&quot; min=&quot;0&quot; /&gt;&nbsp;</div></li><li><div>  &lt;br /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;label for=&quot;bp-activities-secondaryid&quot;&gt;&lt;?php _e( 'Secondary Item ID', 'buddypress' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>  &lt;input type=&quot;number&quot; name=&quot;bp-activities-secondaryid&quot; id=&quot;bp-activities-secondaryid&quot; value=&quot;&lt;?php echo esc_attr( $item-&gt;secondary_item_id ); ?&gt;&quot; min=&quot;0&quot; /&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;p&gt;&lt;?php _e( 'These identify the object that created this activity. For example, the fields could reference a pair of site and comment IDs.', 'buddypress' ); ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Display the Activity admin index screen, which contains a list of all the activities.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global BP_Activity_List_Table $bp_activity_list_table Activity screen list table.</span>&nbsp;</div></li><li><div><span class="comment"> * @global string                 $plugin_page            The current plugin page.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function bp_activity_admin_index() {&nbsp;</div></li><li><div>  global $bp_activity_list_table, $plugin_page;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $messages = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// If the user has just made a change to an activity item, build status messages.</span>&nbsp;</div></li><li><div>  if ( ! empty( $_REQUEST['deleted'] ) || ! empty( $_REQUEST['spammed'] ) || ! empty( $_REQUEST['unspammed'] ) || ! empty( $_REQUEST['error'] ) || ! empty( $_REQUEST['updated'] ) ) {&nbsp;</div></li><li><div>      $deleted = ! empty( $_REQUEST['deleted'] ) ? (int) $_REQUEST['deleted']   : 0;&nbsp;</div></li><li><div>      $errors = ! empty( $_REQUEST['error'] ) ? $_REQUEST['error']           : '';&nbsp;</div></li><li><div>      $spammed = ! empty( $_REQUEST['spammed'] ) ? (int) $_REQUEST['spammed']   : 0;&nbsp;</div></li><li><div>      $unspammed = ! empty( $_REQUEST['unspammed'] ) ? (int) $_REQUEST['unspammed'] : 0;&nbsp;</div></li><li><div>      $updated = ! empty( $_REQUEST['updated'] ) ? (int) $_REQUEST['updated']   : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $errors = array_map( 'absint', explode( ', ', $errors ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Make sure we don't get any empty values in $errors.</span>&nbsp;</div></li><li><div>      for ( $i = 0, $errors_count = count( $errors ); $i &lt; $errors_count; $i++ ) {&nbsp;</div></li><li><div>          if ( 0 === $errors[$i] ) {&nbsp;</div></li><li><div>              unset( $errors[$i] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Reindex array.</span>&nbsp;</div></li><li><div>      $errors = array_values( $errors );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $deleted &gt; 0 )&nbsp;</div></li><li><div>          $messages[] = sprintf( _n( '%s activity item has been permanently deleted.', '%s activity items have been permanently deleted.', $deleted, 'buddypress' ), number_format_i18n( $deleted ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $errors ) ) {&nbsp;</div></li><li><div>          if ( 1 == count( $errors ) ) {&nbsp;</div></li><li><div>              $messages[] = sprintf( __( 'An error occurred when trying to update activity ID #%s.', 'buddypress' ), number_format_i18n( $errors[0] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $error_msg = __( 'Errors occurred when trying to update these activity items:', 'buddypress' );&nbsp;</div></li><li><div>              $error_msg .= '&lt;ul class=&quot;activity-errors&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Display each error as a list item.</span>&nbsp;</div></li><li><div>              foreach ( $errors as $error ) {&nbsp;</div></li><li><div>                  <span class="comment">// Translators: This is a bulleted list of item IDs.</span>&nbsp;</div></li><li><div>                  $error_msg .= '&lt;li&gt;' . sprintf( __( '#%s', 'buddypress' ), number_format_i18n( $error ) ) . '&lt;/li&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $error_msg  .= '&lt;/ul&gt;';&nbsp;</div></li><li><div>              $messages[] = $error_msg;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $spammed &gt; 0 )&nbsp;</div></li><li><div>          $messages[] = sprintf( _n( '%s activity item has been successfully spammed.', '%s activity items have been successfully spammed.', $spammed, 'buddypress' ), number_format_i18n( $spammed ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $unspammed &gt; 0 )&nbsp;</div></li><li><div>          $messages[] = sprintf( _n( '%s activity item has been successfully unspammed.', '%s activity items have been successfully unspammed.', $unspammed, 'buddypress' ), number_format_i18n( $unspammed ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $updated &gt; 0 )&nbsp;</div></li><li><div>          $messages[] = __( 'The activity item has been updated successfully.', 'buddypress' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Prepare the activity items for display.</span>&nbsp;</div></li><li><div>  $bp_activity_list_table-&gt;prepare_items();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Fires before edit form is displayed so plugins can modify the activity messages.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.6.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $messages Array of messages to display at top of page.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  do_action( 'bp_activity_admin_index', $messages ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>      &lt;h1&gt;&nbsp;</div></li><li><div>          &lt;?php if ( !empty( $_REQUEST['aid'] ) ) : ?&gt;&nbsp;</div></li><li><div>              &lt;?php printf( __( 'Activity related to ID #%s', 'buddypress' ), number_format_i18n( (int) $_REQUEST['aid'] ) ); ?&gt;&nbsp;</div></li><li><div>          &lt;?php else : ?&gt;&nbsp;</div></li><li><div>              &lt;?php _ex( 'Activity', 'Admin SWA page', 'buddypress' ); ?&gt;&nbsp;</div></li><li><div>          &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          &lt;?php if ( !empty( $_REQUEST['s'] ) ) : ?&gt;&nbsp;</div></li><li><div>              &lt;span class=&quot;subtitle&quot;&gt;&lt;?php printf( __( 'Search results for &#8220;%s&#8221;', 'buddypress' ), wp_html_excerpt( esc_html( stripslashes( $_REQUEST['s'] ) ), 50 ) ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>          &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>      &lt;/h1&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php <span class="comment">// If the user has just made a change to an activity item, display the status messages. ?&gt;</span>&nbsp;</div></li><li><div>      &lt;?php if ( !empty( $messages ) ) : ?&gt;&nbsp;</div></li><li><div>          &lt;div id=&quot;moderated&quot; class=&quot;&lt;?php echo ( ! empty( $_REQUEST['error'] ) ) ? 'error' : 'updated'; ?&gt;&quot;&gt;&lt;p&gt;&lt;?php echo implode( &quot;&lt;br/&gt;\n&quot;, $messages ); ?&gt;&lt;/p&gt;&lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php endif; ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php <span class="comment">// Display each activity on its own row. ?&gt;</span>&nbsp;</div></li><li><div>      &lt;?php $bp_activity_list_table-&gt;views(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;form id=&quot;bp-activities-form&quot; action=&quot;&quot; method=&quot;get&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php $bp_activity_list_table-&gt;search_box( __( 'Search all Activity', 'buddypress' ), 'bp-activity' ); ?&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;hidden&quot; name=&quot;page&quot; value=&quot;&lt;?php echo esc_attr( $plugin_page ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>          &lt;?php $bp_activity_list_table-&gt;display(); ?&gt;&nbsp;</div></li><li><div>      &lt;/form&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      &lt;?php <span class="comment">// This markup is used for the reply form. ?&gt;</span>&nbsp;</div></li><li><div>      &lt;table style=&quot;display: none;&quot;&gt;&nbsp;</div></li><li><div>          &lt;tr id=&quot;bp-activities-container&quot; style=&quot;display: none;&quot;&gt;&nbsp;</div></li><li><div>              &lt;td colspan=&quot;4&quot;&gt;&nbsp;</div></li><li><div>                  &lt;form method=&quot;get&quot; action=&quot;&quot;&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      &lt;h3 id=&quot;bp-replyhead&quot;&gt;&lt;?php _e( 'Reply to Activity', 'buddypress' ); ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>                      &lt;label for=&quot;bp-activities&quot; class=&quot;screen-reader-text&quot;&gt;&lt;?php&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: accessibility text */</span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                          _e( 'Reply', 'buddypress' );&nbsp;</div></li><li><div>                      ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                      &lt;?php wp_editor( '', 'bp-activities', array( 'dfw' =&gt; false, 'media_buttons' =&gt; false, 'quicktags' =&gt; array( 'buttons' =&gt; 'strong, em, link, block, del, ins, img, code, spell, close' ), 'tinymce' =&gt; false, ) ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      &lt;p id=&quot;bp-replysubmit&quot; class=&quot;submit&quot;&gt;&nbsp;</div></li><li><div>                          &lt;a href=&quot;#&quot; class=&quot;cancel button-secondary alignleft&quot;&gt;&lt;?php _e( 'Cancel', 'buddypress' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>                          &lt;a href=&quot;#&quot; class=&quot;save button-primary alignright&quot;&gt;&lt;?php _e( 'Reply', 'buddypress' ); ?&gt;&lt;/a&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          &lt;img class=&quot;waiting&quot; style=&quot;display:none;&quot; src=&quot;&lt;?php echo esc_url( admin_url( 'images/wpspin_light.gif' ) ); ?&gt;&quot; alt=&quot;&quot; /&gt;&nbsp;</div></li><li><div>                          &lt;span class=&quot;error&quot; style=&quot;display:none;&quot;&gt;&lt;/span&gt;&nbsp;</div></li><li><div>                          &lt;br class=&quot;clear&quot; /&gt;&nbsp;</div></li><li><div>                      &lt;/p&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      &lt;?php wp_nonce_field( 'bp-activity-admin-reply', '_ajax_nonce-bp-activity-admin-reply', false ); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  &lt;/form&gt;&nbsp;</div></li><li><div>              &lt;/td&gt;&nbsp;</div></li><li><div>          &lt;/tr&gt;&nbsp;</div></li><li><div>      &lt;/table&gt;&nbsp;</div></li><li><div>  &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&lt;?php&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>BuddyPress</li><li><span></span>2.8.2</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>