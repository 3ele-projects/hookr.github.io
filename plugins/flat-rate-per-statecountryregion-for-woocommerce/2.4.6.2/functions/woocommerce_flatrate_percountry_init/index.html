<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr function lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr function lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr function lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr function ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr function gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr function" data-site="plugin" data-version="2.4.6.2" data-slug="flat-rate-per-statecountryregion-for-woocommerce" data-type="function" data-id="62981"><head xmlns="http://www.w3.org/1999/xhtml"><title> woocommerce_flatrate_percountry_init | function | Flat Rate Per Statecountryregion For Woocommerce | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="woocommerce_flatrate_percountry_init, function, plugin, flat-rate-per-statecountryregion-for-woocommerce, 2.4.6.2" /><meta name="description" content="The Flat Rate per State/Country/Region for WooCommerce woocommerce flatrate percountry init function." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.17"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=9a30ddc575818a980b59b09782eee380' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.17' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/functions/woocommerce_flatrate_percountry_init/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fwoocommerce_flatrate_percountry_init%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffunctions%2Fwoocommerce_flatrate_percountry_init%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-flat-rate-per-statecountryregion-for-woocommerce-2.4.6.2-function-woocommerce_flatrate_percountry_init","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="woocommerce_flatrate_percountry_init" class="single single-function single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to flat-rate-per-statecountryreg&hellip;." href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/" class="plugin"><span property="name">flat-rate-per-statecountryreg&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 2.4.6.2." href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/" class="H_VERSION"><span property="name">2.4.6.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to functions." href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/functions/" class=""><span property="name">functions</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">woocommerce_flatrate_percount&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="function"><ul role="navigation"><li class="" data-id="all" data-count="4"><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/all/" title="All">All <span class="count badge">4</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="1"><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/hooks/" title="Hooks">Hooks <span class="count badge">1</span></a></li><li class="" data-id="action" data-count="1"><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/actions/" title="Actions">Actions <span class="count badge">1</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="" data-id="class" data-count="0"><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/classes/" title="Classes">Classes <span class="count badge">0</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="active" data-id="function" data-count="3"><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/functions/" title="Functions">Functions <span class="count badge">3</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>woocommerce_flatrate_percountry_init</strong></h1><p>The Flat Rate per State/Country/Region for WooCommerce <strong>woocommerce flatrate percountry init</strong> function.</p> </section> <section id="description"><h2>Description</h2><pre><div>woocommerce_flatrate_percountry_init();&nbsp;</div></pre></section><hr /> <section id="usage"><h2>Usage</h2><pre><ol><li><div>if ( !function_exists( '<span class="func">woocommerce_flatrate_percountry_init</span>' ) ) {&nbsp;</div></li><li><div>    require_once ABSPATH . PLUGINDIR . 'flat-rate-per-statecountryregion-for-woocommerce/woocommerce_flatrate_percountry.php';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div> &nbsp;</div></li><li><div><span class="comment">// NOTICE! Understand what this does before running.</span>&nbsp;</div></li><li><div><span class="param">$result</span> = <span class="func">woocommerce_flatrate_percountry_init</span>(<span class="param"></span>);&nbsp;</div></li><li><div>   &nbsp;</div></li></ol></pre></section><hr /> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The function is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/files/woocommerce-flatrate-percountry/" class="file">/woocommerce_flatrate_percountry.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="26" class="block" start="28"><li><div>function woocommerce_flatrate_percountry_init() {&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    if ( ! class_exists( 'WC_Flat_Rate_Per_Country_Region' ) ) {&nbsp;</div></li><li><div>    class WC_Flat_Rate_Per_Country_Region extends WC_Shipping_Method {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Constructor for your shipping class&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @access public&nbsp;</div></li><li><div>         * @return void&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        public function __construct() {&nbsp;</div></li><li><div>            $this-&gt;id = 'woocommerce_flatrate_percountry';&nbsp;</div></li><li><div>            load_plugin_textdomain('flat-rate-per-countryregion-for-woocommerce', false, dirname(plugin_basename(__FILE__)) . '/lang/');&nbsp;</div></li><li><div>            $this-&gt;method_title = __('Flat Rate per State/Country/Region', 'flat-rate-per-countryregion-for-woocommerce');&nbsp;</div></li><li><div>            $this-&gt;method_description = __('Allows you to set a flat delivery rate per country and/or world region.&lt;br/&gt;&lt;br/&gt;If you set a rate for the client\'s country it will be used. Otherwise, if you set a rate for client\'s region it will be used.&lt;br/&gt;If none of the rates are set, the &quot;Rest of the World&quot; rate will be used.', 'flat-rate-per-countryregion-for-woocommerce').'&lt;br/&gt;&lt;br/&gt;'.__('You can also choose either to apply the shipping fee for the whole order or multiply it per each item.', 'flat-rate-per-countryregion-for-woocommerce');&nbsp;</div></li><li><div>            $this-&gt;wpml = function_exists('icl_object_id') && function_exists('icl_register_string');&nbsp;</div></li><li><div>            $this-&gt;polylang = $this-&gt;wpml; //Not used yet&nbsp;</div></li><li><div>            if ($this-&gt;wpml) { //Really WPML?&nbsp;</div></li><li><div>                global $sitepress;&nbsp;</div></li><li><div>                $this-&gt;wpml=is_object($sitepress);&nbsp;</div></li><li><div>                if (!$this-&gt;wpml) {&nbsp;</div></li><li><div>                    //Maybe Polylang?&nbsp;</div></li><li><div>                    //...&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ($this-&gt;wpml) {&nbsp;</div></li><li><div>                $this-&gt;shipping_classes=$this-&gt;get_all_shipping_classes_wpml();&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $this-&gt;shipping_classes=$this-&gt;get_all_shipping_classes();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;init();&nbsp;</div></li><li><div>            $this-&gt;init_form_fields_per_region();&nbsp;</div></li><li><div>            $this-&gt;init_form_fields_per_country();&nbsp;</div></li><li><div>            //Fix 1.4.2 - Change &quot;per_country_1_country&quot; to &quot;per_country_1_c&quot; &nbsp;</div></li><li><div>            $count=(isset($this-&gt;settings['per_region_count']) ? intval($this-&gt;settings['per_region_count']) : 0);&nbsp;</div></li><li><div>            for($counter = 1; $count &gt;= $counter; $counter++) {&nbsp;</div></li><li><div>                if (isset($this-&gt;settings['per_country_'.$counter.'_country'])) {&nbsp;</div></li><li><div>                    $this-&gt;settings['per_country_'.$counter.'_c']=$this-&gt;settings['per_country_'.$counter.'_country'];&nbsp;</div></li><li><div>                    unset($this-&gt;settings['per_country_'.$counter.'_country']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $this-&gt;init_form_fields_per_state();&nbsp;</div></li><li><div>            $this-&gt;tax_status = $this-&gt;settings['tax_status']; //Important so that WooCommerce knows if it should or shouldn't add taxes to this method&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Init the settings */&nbsp;</div></li><li><div>        function init() {&nbsp;</div></li><li><div>            //Let's sort arrays the right way&nbsp;</div></li><li><div>            setlocale(LC_COLLATE, get_locale());&nbsp;</div></li><li><div>            //Regions - Source: http://www.geohive.com/earth/gen_codes.aspx&nbsp;</div></li><li><div>            $this-&gt;regions = array(&nbsp;</div></li><li><div>                //Africa&nbsp;</div></li><li><div>                'AF_EA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Africa - Eastern Africa', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('BI', 'KM' , 'DJ', 'ER', 'ET', 'KE', 'MG', 'MW', 'MU', 'YT', 'MZ', 'RE', 'RW', 'SC', 'SO', 'TZ', 'UG', 'ZM', 'ZW'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AF_MA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Africa - Middle Africa', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AO', 'CM', 'CF', 'TD', 'CG', 'CD', 'GQ', 'GA', 'ST'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AF_NA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Africa - Northern Africa', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('DZ', 'EG', 'LY', 'MA', 'SS', 'SD', 'TN', 'EH'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AF_SA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Africa - Southern Africa', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('BW', 'LS', 'NA', 'ZA', 'SZ'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AF_WA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Africa - Western Africa', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('BJ', 'BF', 'CV', 'CI', 'GM', 'GH', 'GN', 'GW', 'LR', 'ML', 'MR', 'NE', 'NG', 'SH', 'SN', 'SL', 'TG'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                //Americas&nbsp;</div></li><li><div>                'AM_LAC' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Americas - Latin America and the Caribbean', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AI', 'AG', 'AW', 'BS', 'BB', 'BQ', 'VG', 'KY', 'CU', 'CW', 'DM', 'DO', 'GD', 'GP', 'HT', 'JM', 'MQ', 'MS', 'PR', 'BL', 'KN', 'LC', 'MF', 'VC', 'SX', 'TT', 'TC', 'VI'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AM_CA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Americas - Central America', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('BZ', 'CR', 'SV', 'GT', 'HN', 'MX', 'NI', 'PA'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AM_SA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Americas - South America', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AR', 'BO', 'BR', 'CL', 'CO', 'EC', 'FK', 'GF', 'GY', 'PY', 'PE', 'SR', 'UY', 'VE'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AM_NA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Americas - Northern America', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('BM', 'CA', 'GL', 'PM', 'US'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                //Asia&nbsp;</div></li><li><div>                'AS_CA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Asia - Central Asia', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('KZ', 'KG', 'TJ', 'TM', 'UZ'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AS_EA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Asia - Eastern Asia', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('CN', 'HK', 'MO', 'JP', 'KP', 'KR', 'MN', 'TW'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AS_SA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Asia - Southern Asia', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AF', 'BD', 'BT', 'IN', 'IR', 'MV', 'NP', 'PK', 'LK'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AS_SEA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Asia - South-Eastern Asia', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('BN', 'KH', 'ID', 'LA', 'MY', 'MM', 'PH', 'SG', 'TH', 'TL', 'VN'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'AS_WA' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Asia - Western Asia', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AM', 'AZ', 'BH', 'CY', 'GE', 'IQ', 'IL', 'JO', 'KW', 'LB', 'PS', 'OM', 'QA', 'SA', 'SY', 'TR', 'AE', 'YE'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                //Europe&nbsp;</div></li><li><div>                'EU_EE' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Europe - Eastern Europe', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('BY', 'BG', 'CZ', 'HU', 'MD', 'PL', 'RO', 'RU', 'SK', 'UA'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'EU_NE' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Europe - Northern Europe', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AX', 'DK', 'EE', 'FO', 'FI', 'GG', 'IS', 'IE', 'JE', 'LV', 'LT', 'IM', 'NO', 'SJ', 'SE', 'GB'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'EU_SE' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Europe - Southern Europe', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AL', 'AD', 'BA', 'HR', 'GI', 'GR', 'VA', 'IT', 'MK', 'MT', 'ME', 'PT', 'SM', 'RS', 'SI', 'ES'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'EU_WE' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Europe - Western Europe', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AT', 'BE', 'FR', 'DE', 'LI', 'LU', 'MC', 'NL', 'CH'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                //Special EU Group&nbsp;</div></li><li><div>                /**'EU_EU' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('European Union', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('BE', 'BG', 'CZ', 'DK', 'DE', 'EE', 'IE', 'GR', 'ES', 'FR', 'HR', 'IT', 'CY', 'LV', 'LT', 'LU', 'HU', 'MT', 'NL', 'AT', 'PL', 'PT', 'RO', 'SI', 'SK', 'FI', 'SE', 'GB'), &nbsp;</div></li><li><div> ), */&nbsp;</div></li><li><div>                //Special EU Group - From WooCommerce&nbsp;</div></li><li><div>                'EU_EU' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('European Union', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; WC()-&gt;countries-&gt;get_european_union_countries()&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                //Special EU Group + Monaco and Isle of Man - From WooCommerce&nbsp;</div></li><li><div>                'EU_EUVAT' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('European Union', 'flat-rate-per-countryregion-for-woocommerce').' + '.__('Monaco and Isle of Man', 'flat-rate-per-countryregion-for-woocommerce').' (EU VAT)', &nbsp;</div></li><li><div>                    'countries' =&gt; WC()-&gt;countries-&gt;get_european_union_countries('eu_vat')&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                //Oceania&nbsp;</div></li><li><div>                'OC_ANZ' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Oceania - Australia and New Zealand', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AU', 'CX', 'CC', 'NZ', 'NF'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'OC_ML' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Oceania - Melanesia', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('FJ', 'NC', 'PG', 'SB', 'VU'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'OC_MN' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Oceania - Micronesia', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('GU', 'KI', 'MH', 'FM', 'NR', 'MP', 'PW'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'OC_PL' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Oceania - Polynesia', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AS', 'CK', 'PF', 'NU', 'PN', 'WS', 'TK', 'TO', 'TV', 'WF'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                /**&nbsp;</div></li><li><div>                'UNCLASSIFIED' =&gt; array(&nbsp;</div></li><li><div>                    'name' =&gt; __('Unclassified', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'countries' =&gt; array('AQ', 'BV', 'IO', 'TF', 'HM', 'AN', 'GS', 'UM'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                */&nbsp;</div></li><li><div>                /**&nbsp;</div></li><li><div>                AQ - Antarctica&nbsp;</div></li><li><div>                BV - Bouvet Island&nbsp;</div></li><li><div>                IO - British Indian Ocean Territory&nbsp;</div></li><li><div>                TF - French Southern Territories&nbsp;</div></li><li><div>                HM - Heard Island and McDonald Islands&nbsp;</div></li><li><div>                AN - Netherlands Antilles&nbsp;</div></li><li><div>                GS - South Georgia/Sandwich Islands&nbsp;</div></li><li><div>                UM - ?&nbsp;</div></li><li><div>                */&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $this-&gt;regionslist=array();&nbsp;</div></li><li><div>            foreach($this-&gt;regions as $key =&gt; $temp) {&nbsp;</div></li><li><div>                $this-&gt;regionslist[$key]=$temp['name'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            asort($this-&gt;regionslist, SORT_LOCALE_STRING);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Load the settings API&nbsp;</div></li><li><div>            $this-&gt;init_form_fields(); // This is part of the settings API. Override the method to add your own settings&nbsp;</div></li><li><div>            $this-&gt;init_settings(); // This is part of the settings API. Loads settings you previously init.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;title = $this-&gt;settings['title'];&nbsp;</div></li><li><div>            $this-&gt;enabled = $this-&gt;settings['enabled'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //WPML label&nbsp;</div></li><li><div>            if ($this-&gt;wpml) add_filter(<a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/filters/add_filter/woocommerce_cart_shipping_method_full_label/" data-id="1214553" title="woocommerce_cart_shipping_method_full_label" class="filter">'woocommerce_cart_shipping_method_full_label'</a>, array($this, 'wpml_shipping_method_label'), 9, 2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            //Remove &quot;free&quot; from the label&nbsp;</div></li><li><div>            if (isset($this-&gt;settings['remove_free'])) {&nbsp;</div></li><li><div>                if ($this-&gt;settings['remove_free']=='yes') {&nbsp;</div></li><li><div>                    add_filter(<a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/filters/add_filter/woocommerce_cart_shipping_method_full_label/" data-id="1214553" title="woocommerce_cart_shipping_method_full_label" class="filter">'woocommerce_cart_shipping_method_full_label'</a>, array($this, 'remove_free_price_text'), 10, 2);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Save settings in admin if you have any defined&nbsp;</div></li><li><div>            add_action( 'woocommerce_update_options_shipping_' . $this-&gt;id, array( $this, 'process_admin_options' ) );&nbsp;</div></li><li><div>            if ($this-&gt;wpml) add_action('woocommerce_update_options_shipping_' . $this-&gt;id, array($this, 'register_wpml_strings'));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function get_all_shipping_classes() {&nbsp;</div></li><li><div>            $shipping_classes=array();&nbsp;</div></li><li><div>            if ( $temp=WC()-&gt;shipping-&gt;get_shipping_classes() ) {&nbsp;</div></li><li><div>                if (!is_wp_error($temp)) { //On Multisite we aren't able to get the terms... - To be fixed.&nbsp;</div></li><li><div>                    foreach ( $temp as $shipping_class ) {&nbsp;</div></li><li><div>                        $shipping_classes[$shipping_class-&gt;slug]=$shipping_class-&gt;name;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $shipping_classes;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * WPML compatibility&nbsp;</div></li><li><div>         * We need to register our own several possible Shipping Method titles because WooCommerce Multilingual assumes each Shipping Method will only have one static title&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        function register_wpml_strings() {&nbsp;</div></li><li><div>            $to_register=array(&nbsp;</div></li><li><div>                'title', &nbsp;</div></li><li><div>                'world_rulename', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            //Region&nbsp;</div></li><li><div>            $count=(isset($this-&gt;settings['per_region_count']) ? intval($this-&gt;settings['per_region_count']) : 0);&nbsp;</div></li><li><div>            for($counter = 1; $count &gt;= $counter; $counter++) {&nbsp;</div></li><li><div>                $to_register[]='per_region_'.$counter.'_txt';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            //Country&nbsp;</div></li><li><div>            $count=(isset($this-&gt;settings['per_country_count']) ? intval($this-&gt;settings['per_country_count']) : 0);&nbsp;</div></li><li><div>            for($counter = 1; $count &gt;= $counter; $counter++) {&nbsp;</div></li><li><div>                $to_register[]='per_country_'.$counter.'_txt';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            //State&nbsp;</div></li><li><div>            $count=(isset($this-&gt;settings['per_state_count']) ? intval($this-&gt;settings['per_state_count']) : 0);&nbsp;</div></li><li><div>            for($counter = 1; $count &gt;= $counter; $counter++) {&nbsp;</div></li><li><div>                $to_register[]='per_state_'.$counter.'_txt';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            foreach($to_register as $string) {&nbsp;</div></li><li><div>                //Only if the state rule name exists already (we may still be choosing the country for this rule)&nbsp;</div></li><li><div>                if (isset($this-&gt;settings[$string])) icl_register_string($this-&gt;id, $this-&gt;id.'_'.$string, $this-&gt;settings[$string]);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            add_action($this-&gt;id.'_notices', array($this, 'register_wpml_strings_notice'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        function register_wpml_strings_notice() {&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;&nbsp;</div></li><li><div>                &lt;p&gt;&nbsp;</div></li><li><div>                    &lt;strong&gt;&nbsp;</div></li><li><div>                        &lt;?php printf(__( 'You should now check and, if necessary, translate the rule names and method title on &lt;a href=&quot;%s&quot;&gt;WPML String Translation&lt;/a&gt;', 'flat-rate-per-countryregion-for-woocommerce'), 'admin.php?page=wpml-string-translation/menu/string-translation.php&amp;context='.$this-&gt;id); ?&gt;&nbsp;</div></li><li><div>                    &lt;/strong&gt;&nbsp;</div></li><li><div>                &lt;/p&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function get_all_shipping_classes_wpml() {&nbsp;</div></li><li><div>            $shipping_classes=array();&nbsp;</div></li><li><div>            $terms=get_terms('product_shipping_class', array(&nbsp;</div></li><li><div>                'hide_empty' =&gt; false&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>            if (!is_wp_error($terms)) { //On Multisite we aren't able to get the terms... - To be fixed.&nbsp;</div></li><li><div>                global $sitepress;&nbsp;</div></li><li><div>                $langs=$sitepress-&gt;get_active_languages();&nbsp;</div></li><li><div>                foreach($terms as $term) {&nbsp;</div></li><li><div>                    $shipping_classes[$term-&gt;slug]=$term-&gt;name;&nbsp;</div></li><li><div>                    foreach($langs as $lang =&gt; $language) {&nbsp;</div></li><li><div>                        if ($term_tr=$this-&gt;get_translated_term($term-&gt;term_id, 'product_shipping_class', $lang)) {&nbsp;</div></li><li><div>                            $shipping_classes[$term_tr-&gt;slug]=$term_tr-&gt;name;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $shipping_classes;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Get translated term */&nbsp;</div></li><li><div>        function get_translated_term($term_id, $taxonomy, $language) {&nbsp;</div></li><li><div>            global $sitepress;&nbsp;</div></li><li><div>            $translated_term_id = icl_object_id(intval($term_id), $taxonomy, true, $language);&nbsp;</div></li><li><div>            remove_filter( <a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/filters/add_filter/get_term/" data-id="1214558" title="get_term" class="filter">'get_term'</a>, array( $sitepress, 'get_term_adjust_id' ), 1 );&nbsp;</div></li><li><div>            $translated_term_object = get_term_by('id', intval($translated_term_id), $taxonomy);&nbsp;</div></li><li><div>            add_filter( <a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/filters/add_filter/get_term/" data-id="1214558" title="get_term" class="filter">'get_term'</a>, array( $sitepress, 'get_term_adjust_id' ), 1, 1 );&nbsp;</div></li><li><div>            return $translated_term_object;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** The form */&nbsp;</div></li><li><div>        function init_form_fields() {&nbsp;</div></li><li><div>            $fields = array(&nbsp;</div></li><li><div>                'global_def' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; __('Global settings', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'type' =&gt; 'title'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'enabled' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; __('Enable/Disable', 'woocommerce'), &nbsp;</div></li><li><div>                    'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                    'label' =&gt; __('Enable this shipping method', 'woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'no', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'title' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; __('Method Title', 'woocommerce'), &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'description' =&gt; __('This controls the title which the user sees during checkout.', 'woocommerce').' '.__('(If chosen below)', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; __('Flat Rate per State/Country/Region', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'show_region_country' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; __('Label to show to the user', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose either to show the region name, the country name, the method title (or a combination of these) on the checkout screen.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'region', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                            'country' =&gt; __('Country', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                            'region' =&gt; __('State or Country or Region name or &quot;Rest of the World&quot;', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                            'title' =&gt; __('Method Title', 'woocommerce').' '.__('(as defined above)', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                            'title_country' =&gt; __('Method Title', 'woocommerce').' + '.__('Country', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                            'title_region' =&gt; __('Method Title', 'woocommerce').' + '.__('State or Country or Region name or &quot;Rest of the World&quot;', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                            'rule_name' =&gt; __('Rule name', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'tax_status' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; __('Tax Status', 'woocommerce'), &nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'description' =&gt; '', &nbsp;</div></li><li><div>                    'default' =&gt; 'taxable', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                            'taxable' =&gt; __('Taxable', 'woocommerce'), &nbsp;</div></li><li><div>                            'none' =&gt; __('None', 'woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'remove_free' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; __('Remove &quot;(Free)&quot;', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                    'description' =&gt; __('If the final rate is zero, remove the &quot;(Free)&quot; text from the checkout screen. Useful if you need to get a quote for the shipping cost from the carrier.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'label' =&gt; __('Remove &quot;(Free)&quot; from checkout if delivery rate equals zero', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'no', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'world_title' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; __('&quot;Rest of the World&quot; Rates', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'type' =&gt; 'title'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'world_disable' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Disable', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                    'description' =&gt; __('If this checkbox is enabled, this shipping method will only be available for the World Regions, Countries and States rules set below.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'label' =&gt; __('Disable &quot;Rest of the World&quot; fee', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'no', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'world_rulename' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Rule name', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'description' =&gt; __('The name for this rule, if you choose to show it to the client.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; __('Rest of the World', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'placeholder' =&gt; '', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'tax_type' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Apply rate', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose either to apply the shipping fee for the whole order or multiply it per each item.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'per_order', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                            'per_order' =&gt; __('Per order', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                            'per_item' =&gt; __('Per item', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'fee_world' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Rate', 'flat-rate-per-countryregion-for-woocommerce').' ('.get_woocommerce_currency().')&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'price', &nbsp;</div></li><li><div>                    'description' =&gt; __('The shipping fee for all the Countries/Regions not specified below.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'placeholder' =&gt; '0', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'world_free_above' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Free for orders above', 'flat-rate-per-countryregion-for-woocommerce').' ('.get_woocommerce_currency().')&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'price', &nbsp;</div></li><li><div>                    'description' =&gt; __('The shipping fee will be free if the order total reaches this value. Empty or zero for no free shipping.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'placeholder' =&gt; '', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'world_free_class' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Free for shipping classes', 'flat-rate-per-countryregion-for-woocommerce').($this-&gt;wpml ? '&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;rules_items&quot;&gt;('.__('Choose all languages variations', 'flat-rate-per-countryregion-for-woocommerce').')' : '').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'multiselect', &nbsp;</div></li><li><div>                    'description' =&gt; __('The shipping fee will be free if at least one item, or all items, depending on the setting below, belong to the selected shipping classes.', 'flat-rate-per-countryregion-for-woocommerce').($this-&gt;wpml ? ' '.__('Choose all languages variations', 'flat-rate-per-countryregion-for-woocommerce') : ''), &nbsp;</div></li><li><div>                    'class' =&gt; 'chosen_select', &nbsp;</div></li><li><div>                    'css' =&gt; 'width: 450px;', &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'options' =&gt; $this-&gt;shipping_classes, &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'world_free_class_type' =&gt; array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Free for shipping classes if', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose either one item on Shipping Class is enough to set the rate as free or all items should belong to the Shipping Classes.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'one', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'one' =&gt; __('At least one item belongs to the class(es) set above', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                        'all' =&gt; __('All items belong to class(es) set above', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $this-&gt;form_fields=$fields;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Per Region form fields */&nbsp;</div></li><li><div>        function init_form_fields_per_region() {&nbsp;</div></li><li><div>            $this-&gt;form_fields['per_region']=array(&nbsp;</div></li><li><div>                'title' =&gt; __('Per Region Rates', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'title'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $this-&gt;form_fields['per_region_count']=array(&nbsp;</div></li><li><div>                'title' =&gt; __('Number of Region rules', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'number', &nbsp;</div></li><li><div>                'description' =&gt; __('How many diferent &quot;per region&quot; rates do you want to set?', 'flat-rate-per-countryregion-for-woocommerce').' '.__('Please save the options after changing this value.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $count=(isset($this-&gt;settings['per_region_count']) ? intval($this-&gt;settings['per_region_count']) : 0);&nbsp;</div></li><li><div>            for($counter = 1; $count &gt;= $counter; $counter++) {&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_region_'.$counter.'_sep']=array(&nbsp;</div></li><li><div>                    'title' =&gt; sprintf(__( 'Region rule #%s', 'flat-rate-per-countryregion-for-woocommerce'), $counter), &nbsp;</div></li><li><div>                    'class' =&gt; 'rules_sep', &nbsp;</div></li><li><div>                    'type' =&gt; 'rules_sep'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_region_'.$counter.'_region']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Region', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'multiselect', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose one or more regions for this rule.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'class' =&gt; 'chosen_select', &nbsp;</div></li><li><div>                    'css' =&gt; 'width: 450px;', &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'options' =&gt; $this-&gt;regionslist, &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_region_'.$counter.'_txt']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Rule name', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'description' =&gt; __('The name for this rule, if you choose to show it to the client.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'placeholder' =&gt; '', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_region_'.$counter.'_t']= array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Apply rate', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose either to apply the shipping fee for the whole order or multiply it per each item.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'per_order', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                            'per_order' =&gt; __('Per order', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                            'per_item' =&gt; __('Per item', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_region_'.$counter.'_fee']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Rate', 'flat-rate-per-countryregion-for-woocommerce').' ('.get_woocommerce_currency().')&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'price', &nbsp;</div></li><li><div>                    'description' =&gt; __('The shipping fee for the regions specified above.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'placeholder' =&gt; '0', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_region_'.$counter.'_fr']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Free for orders above', 'flat-rate-per-countryregion-for-woocommerce').' ('.get_woocommerce_currency().')&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'price', &nbsp;</div></li><li><div>                    'description' =&gt; __('The shipping fee will be free if the order total reaches this value. Empty or zero for no free shipping.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'placeholder' =&gt; '', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_region_'.$counter.'_fr_class']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Free for shipping classes', 'flat-rate-per-countryregion-for-woocommerce').($this-&gt;wpml ? '&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;rules_items&quot;&gt;('.__('Choose all languages variations', 'flat-rate-per-countryregion-for-woocommerce').')' : '').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'multiselect', &nbsp;</div></li><li><div>                    'description' =&gt; __('The shipping fee will be free if at least one item belongs to the selected shipping classes.', 'flat-rate-per-countryregion-for-woocommerce').($this-&gt;wpml ? ' '.__('Choose all languages variations', 'flat-rate-per-countryregion-for-woocommerce') : ''), &nbsp;</div></li><li><div>                    'class' =&gt; 'chosen_select', &nbsp;</div></li><li><div>                    'css' =&gt; 'width: 450px;', &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'options' =&gt; $this-&gt;shipping_classes, &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_region_'.$counter.'_fr_class_type']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Free for shipping classes if', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose either one item on Shipping Class is enough to set the rate as free or all items should belong to the Shipping Classes.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'one', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'one' =&gt; __('At least one item belongs to the class(es) set above', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                        'all' =&gt; __('All items belong to class(es) set above', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Per Country form fields */&nbsp;</div></li><li><div>        function init_form_fields_per_country() {&nbsp;</div></li><li><div>            $this-&gt;form_fields['per_country']=array(&nbsp;</div></li><li><div>                'title' =&gt; __('Per Country Rates', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'title'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $this-&gt;form_fields['per_country_count']=array(&nbsp;</div></li><li><div>                'title' =&gt; __('Number of Country rules', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'number', &nbsp;</div></li><li><div>                'description' =&gt; __('How many diferent &quot;per country&quot; rates do you want to set?', 'flat-rate-per-countryregion-for-woocommerce').' '.__('Please save the options after changing this value.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $count=(isset($this-&gt;settings['per_country_count']) ? intval($this-&gt;settings['per_country_count']) : 0);&nbsp;</div></li><li><div>            for($counter = 1; $count &gt;= $counter; $counter++) {&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_country_'.$counter.'_sep']=array(&nbsp;</div></li><li><div>                    'title' =&gt; sprintf(__( 'Country rule #%s', 'flat-rate-per-countryregion-for-woocommerce'), $counter), &nbsp;</div></li><li><div>                    'class' =&gt; 'rules_sep', &nbsp;</div></li><li><div>                    'type' =&gt; 'rules_sep'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_country_'.$counter.'_c']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Country', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'multiselect', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose one or more countries for this rule.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'class' =&gt; 'chosen_select', &nbsp;</div></li><li><div>                    'css' =&gt; 'width: 450px;', &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'options' =&gt; WC()-&gt;countries-&gt;countries, &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_country_'.$counter.'_txt']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Rule name', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'description' =&gt; __('The name for this rule, if you choose to show it to the client.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'placeholder' =&gt; '', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_country_'.$counter.'_t']= array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Apply rate', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose either to apply the shipping fee for the whole order or multiply it per each item.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'per_order', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                            'per_order' =&gt; __('Per order', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                            'per_item' =&gt; __('Per item', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_country_'.$counter.'_fee']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Rate', 'flat-rate-per-countryregion-for-woocommerce').' ('.get_woocommerce_currency().')&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'price', &nbsp;</div></li><li><div>                    'description' =&gt; __('The shipping fee for the countries specified above.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'placeholder' =&gt; '0', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_country_'.$counter.'_fr']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Free for orders above', 'flat-rate-per-countryregion-for-woocommerce').' ('.get_woocommerce_currency().')&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'price', &nbsp;</div></li><li><div>                    'description' =&gt; __('The shipping fee will be free if the order total reaches this value. Empty or zero for no free shipping.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'placeholder' =&gt; '0', &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_country_'.$counter.'_fr_class']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Free for shipping classes', 'flat-rate-per-countryregion-for-woocommerce').($this-&gt;wpml ? '&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;rules_items&quot;&gt;('.__('Choose all languages variations', 'flat-rate-per-countryregion-for-woocommerce').')' : '').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'multiselect', &nbsp;</div></li><li><div>                    'description' =&gt; __('The shipping fee will be free if at least one item belongs to the selected shipping classes.', 'flat-rate-per-countryregion-for-woocommerce').($this-&gt;wpml ? ' '.__('Choose all languages variations', 'flat-rate-per-countryregion-for-woocommerce') : ''), &nbsp;</div></li><li><div>                    'class' =&gt; 'chosen_select', &nbsp;</div></li><li><div>                    'css' =&gt; 'width: 450px;', &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'options' =&gt; $this-&gt;shipping_classes, &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_country_'.$counter.'_fr_class_type']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Free for shipping classes if', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose either one item on Shipping Class is enough to set the rate as free or all items should belong to the Shipping Classes.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'default' =&gt; 'one', &nbsp;</div></li><li><div>                    'options' =&gt; array(&nbsp;</div></li><li><div>                        'one' =&gt; __('At least one item belongs to the class(es) set above', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                        'all' =&gt; __('All items belong to class(es) set above', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Per State form fields */&nbsp;</div></li><li><div>        function init_form_fields_per_state() {&nbsp;</div></li><li><div>            $this-&gt;form_fields['per_state']=array(&nbsp;</div></li><li><div>                'title' =&gt; __('Per State Rates', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'title'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $this-&gt;form_fields['per_state_count']=array(&nbsp;</div></li><li><div>                'title' =&gt; __('Number of State rules', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                'type' =&gt; 'number', &nbsp;</div></li><li><div>                'description' =&gt; __('How many diferent &quot;per state&quot; rates do you want to set?', 'flat-rate-per-countryregion-for-woocommerce').' '.__('Please save the options after changing this value.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                'default' =&gt; 0, &nbsp;</div></li><li><div>                'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $count=(isset($this-&gt;settings['per_state_count']) ? intval($this-&gt;settings['per_state_count']) : 0);&nbsp;</div></li><li><div>            for($counter = 1; $count &gt;= $counter; $counter++) {&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_state_'.$counter.'_sep']=array(&nbsp;</div></li><li><div>                    'title' =&gt; sprintf(__( 'State rule #%s', 'flat-rate-per-countryregion-for-woocommerce'), $counter), &nbsp;</div></li><li><div>                    'class' =&gt; 'rules_sep', &nbsp;</div></li><li><div>                    'type' =&gt; 'rules_sep'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                $this-&gt;form_fields['per_state_'.$counter.'_c']=array(&nbsp;</div></li><li><div>                    'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Country', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'description' =&gt; __('Choose the country for this rule.', 'flat-rate-per-countryregion-for-woocommerce').' '.__('Please save the options after changing this value.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                    'class' =&gt; 'chosen_select', &nbsp;</div></li><li><div>                    'css' =&gt; 'width: 450px;', &nbsp;</div></li><li><div>                    'default' =&gt; '', &nbsp;</div></li><li><div>                    'options' =&gt; WC()-&gt;countries-&gt;countries, &nbsp;</div></li><li><div>                    'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                if (isset($this-&gt;settings['per_state_'.$counter.'_c']) && !empty($this-&gt;settings['per_state_'.$counter.'_c'])) {&nbsp;</div></li><li><div>                    $this-&gt;form_fields['per_state_'.$counter.'_s']=array(&nbsp;</div></li><li><div>                        'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'State', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'multiselect', &nbsp;</div></li><li><div>                        'description' =&gt; __('Choose one or more states for this rule.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                        'class' =&gt; 'chosen_select', &nbsp;</div></li><li><div>                        'css' =&gt; 'width: 450px;', &nbsp;</div></li><li><div>                        'default' =&gt; '', &nbsp;</div></li><li><div>                        'options' =&gt; WC()-&gt;countries-&gt;get_states($this-&gt;settings['per_state_'.$counter.'_c']), &nbsp;</div></li><li><div>                        'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $this-&gt;form_fields['per_state_'.$counter.'_txt']=array(&nbsp;</div></li><li><div>                        'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Rule name', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'text', &nbsp;</div></li><li><div>                        'description' =&gt; __('The name for this rule, if you choose to show it to the client.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                        'default' =&gt; '', &nbsp;</div></li><li><div>                        'placeholder' =&gt; '', &nbsp;</div></li><li><div>                        'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $this-&gt;form_fields['per_state_'.$counter.'_t']= array(&nbsp;</div></li><li><div>                        'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Apply rate', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'select', &nbsp;</div></li><li><div>                        'description' =&gt; __('Choose either to apply the shipping fee for the whole order or multiply it per each item.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                        'default' =&gt; 'per_order', &nbsp;</div></li><li><div>                        'options' =&gt; array(&nbsp;</div></li><li><div>                                'per_order' =&gt; __('Per order', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                                'per_item' =&gt; __('Per item', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                        'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $this-&gt;form_fields['per_state_'.$counter.'_fee']=array(&nbsp;</div></li><li><div>                        'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Rate', 'flat-rate-per-countryregion-for-woocommerce').' ('.get_woocommerce_currency().')&lt;/span&gt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'price', &nbsp;</div></li><li><div>                        'description' =&gt; __('The shipping fee for the states specified above.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                        'default' =&gt; '', &nbsp;</div></li><li><div>                        'placeholder' =&gt; '0', &nbsp;</div></li><li><div>                        'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $this-&gt;form_fields['per_state_'.$counter.'_fr']=array(&nbsp;</div></li><li><div>                        'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__( 'Free for orders above', 'flat-rate-per-countryregion-for-woocommerce').' ('.get_woocommerce_currency().')&lt;/span&gt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'price', &nbsp;</div></li><li><div>                        'description' =&gt; __('The shipping fee will be free if the order total reaches this value. Empty or zero for no free shipping.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                        'default' =&gt; '', &nbsp;</div></li><li><div>                        'placeholder' =&gt; '0', &nbsp;</div></li><li><div>                        'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $this-&gt;form_fields['per_state_'.$counter.'_fr_class']=array(&nbsp;</div></li><li><div>                        'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Free for shipping classes', 'flat-rate-per-countryregion-for-woocommerce').($this-&gt;wpml ? '&lt;/span&gt;&lt;br/&gt;&lt;span class=&quot;rules_items&quot;&gt;('.__('Choose all languages variations', 'flat-rate-per-countryregion-for-woocommerce').')' : '').'&lt;/span&gt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'multiselect', &nbsp;</div></li><li><div>                        'description' =&gt; __('The shipping fee will be free if at least one item belongs to the selected shipping classes.', 'flat-rate-per-countryregion-for-woocommerce').($this-&gt;wpml ? ' '.__('Choose all languages variations', 'flat-rate-per-countryregion-for-woocommerce') : ''), &nbsp;</div></li><li><div>                        'class' =&gt; 'chosen_select', &nbsp;</div></li><li><div>                        'css' =&gt; 'width: 450px;', &nbsp;</div></li><li><div>                        'default' =&gt; '', &nbsp;</div></li><li><div>                        'options' =&gt; $this-&gt;shipping_classes, &nbsp;</div></li><li><div>                        'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    $this-&gt;form_fields['per_state_'.$counter.'_fr_class_type']=array(&nbsp;</div></li><li><div>                        'title' =&gt; '&lt;span class=&quot;rules_items&quot;&gt;'.__('Free for shipping classes if', 'flat-rate-per-countryregion-for-woocommerce').'&lt;/span&gt;', &nbsp;</div></li><li><div>                        'type' =&gt; 'select', &nbsp;</div></li><li><div>                        'description' =&gt; __('Choose either one item on Shipping Class is enough to set the rate as free or all items should belong to the Shipping Classes.', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                        'default' =&gt; 'one', &nbsp;</div></li><li><div>                        'options' =&gt; array(&nbsp;</div></li><li><div>                            'one' =&gt; __('At least one item belongs to the class(es) set above', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div>                            'all' =&gt; __('All items belong to class(es) set above', 'flat-rate-per-countryregion-for-woocommerce'), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                        'desc_tip' =&gt; true&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    //Pas ainda no escolhido.&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function generate_rules_sep_html($key, $data) {&nbsp;</div></li><li><div>            $defaults = array(&nbsp;</div></li><li><div>                'title' =&gt; '', &nbsp;</div></li><li><div>                'class' =&gt; ''&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            $data = wp_parse_args($data, $defaults);&nbsp;</div></li><li><div>            ob_start();&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                &lt;th colspan=&quot;2&quot; class=&quot;&lt;?php echo esc_attr( $data['class'] ); ?&gt;&quot;&gt;&lt;?php echo wp_kses_post($data['title']); ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>            &lt;/tr&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            return ob_get_clean();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        function admin_options() {&nbsp;</div></li><li><div>            do_action($this-&gt;id.'_notices');&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;div id=&quot;wc_flatrate_wd&quot;&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;wc_flatrate_wd_rightbar&quot;&gt;&nbsp;</div></li><li><div>                    &lt;h4&gt;&lt;?php _e('Free technical support (limited)', 'flat-rate-per-countryregion-for-woocommerce'); ?&gt;:&lt;/h4&gt;&nbsp;</div></li><li><div>                    &lt;p&gt;&lt;a href=&quot;https://wordpress.org/support/plugin/flat-rate-per-countryregion-for-woocommerce&quot; target=&quot;_blank&quot;&gt;WordPress.org&lt;/a&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;h4&gt;&lt;?php _e('Premium technical support or custom WordPress / WooCommerce development', 'flat-rate-per-countryregion-for-woocommerce'); ?&gt;:&lt;/h4&gt;&nbsp;</div></li><li><div>                    &lt;p&gt;&lt;a href=&quot;http://www.webdados.pt/contactos/&quot; title=&quot;&lt;?php echo esc_attr(sprintf(__('Please contact %s', 'flat-rate-per-countryregion-for-woocommerce'), 'Webdados')); ?&gt;&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;&lt;?php echo plugins_url('images/webdados.png', __FILE__); ?&gt;&quot; width=&quot;200&quot;/&gt;&lt;/a&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;h4&gt;&lt;?php _e('Help us translate this plugin', 'flat-rate-per-countryregion-for-woocommerce'); ?&gt;:&lt;/h4&gt;&nbsp;</div></li><li><div>                    &lt;p&gt;&lt;?php printf(__('Download the &lt;a href=&quot;%s&quot;&gt;.pot file&lt;/a&gt; and send us the translation on your language', 'flat-rate-per-countryregion-for-woocommerce'), plugins_url('lang/flat-rate-per-countryregion-for-woocommerce.pot', __FILE__) ); ?&gt;&lt;/p&gt;        &nbsp;</div></li><li><div>                    &lt;hr/&gt;&nbsp;</div></li><li><div>                    &lt;h4&gt;&lt;?php _e('Please rate our plugin at WordPress.org', 'flat-rate-per-countryregion-for-woocommerce'); ?&gt;:&lt;/h4&gt;&nbsp;</div></li><li><div>                    &lt;a href=&quot;https://wordpress.org/support/view/plugin-reviews/flat-rate-per-countryregion-for-woocommerce?filter=5#postform&quot; target=&quot;_blank&quot; style=&quot;text-align: center; display: block;&quot;&gt;&nbsp;</div></li><li><div>                        &lt;div class=&quot;star-rating&quot;&gt;&lt;div class=&quot;star star-full&quot;&gt;&lt;/div&gt;&lt;div class=&quot;star star-full&quot;&gt;&lt;/div&gt;&lt;div class=&quot;star star-full&quot;&gt;&lt;/div&gt;&lt;div class=&quot;star star-full&quot;&gt;&lt;/div&gt;&lt;div class=&quot;star star-full&quot;&gt;&lt;/div&gt;&lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;/a&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;wc_flatrate_wd_settings&quot;&gt;&nbsp;</div></li><li><div>                    &lt;h3&gt;&lt;?php echo $this-&gt;method_title; ?&gt;&lt;/h3&gt;&nbsp;</div></li><li><div>                    &lt;p&gt;&lt;?php echo $this-&gt;method_description; ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;p&gt;&lt;a href=&quot;#&quot; onclick=&quot;jQuery('#WC_FRPC_Country_List').show(); return false;&quot;&gt;&lt;?php _e('Click here to see list of regions, and the countries included on each one.', 'flat-rate-per-countryregion-for-woocommerce'); ?&gt;&lt;/a&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;div id=&quot;WC_FRPC_Country_List&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        foreach($this-&gt;regionslist as $key =&gt; $region) {&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                            &lt;p&gt;&lt;b&gt;&lt;?php echo $region; ?&gt;:&lt;/b&gt;&lt;br/&gt;&nbsp;</div></li><li><div>                            &lt;?php&nbsp;</div></li><li><div>                            $countries=array();&nbsp;</div></li><li><div>                            foreach($this-&gt;regions[$key]['countries'] as $country) {&nbsp;</div></li><li><div>                                if (isset(WC()-&gt;countries-&gt;countries[$country]) && trim(WC()-&gt;countries-&gt;countries[$country])!='') $countries[]=WC()-&gt;countries-&gt;countries[$country];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            sort($countries, SORT_LOCALE_STRING);&nbsp;</div></li><li><div>                            echo implode(', ', $countries);&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                            &lt;/p&gt;&nbsp;</div></li><li><div>                            &lt;?php&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                        &lt;hr/&gt;&lt;p&gt;&lt;b&gt;&lt;?php _e('NOT ASSIGNED', 'flat-rate-per-countryregion-for-woocommerce'); ?&gt;:&lt;/b&gt;&lt;br/&gt;&nbsp;</div></li><li><div>                        &lt;?php&nbsp;</div></li><li><div>                        $countries=array();&nbsp;</div></li><li><div>                        foreach(WC()-&gt;countries-&gt;countries as $code =&gt; $country) {&nbsp;</div></li><li><div>                            $done=false;&nbsp;</div></li><li><div>                            foreach($this-&gt;regions as $region) {&nbsp;</div></li><li><div>                                if (in_array($code, $region['countries'])) {&nbsp;</div></li><li><div>                                    $done=true;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if (!$done) $countries[]=WC()-&gt;countries-&gt;countries[$code];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        sort($countries, SORT_LOCALE_STRING);&nbsp;</div></li><li><div>                        echo implode(', ', $countries);&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                        &lt;/p&gt;&nbsp;</div></li><li><div>                        &lt;p style=&quot;text-align: center;&quot;&gt;[&lt;a href=&quot;#&quot; onclick=&quot;jQuery('#WC_FRPC_Country_List').hide(); return false;&quot;&gt;&lt;?php _e('Close country list', 'flat-rate-per-countryregion-for-woocommerce'); ?&gt;&lt;/a&gt;]&lt;/p&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>                    &lt;?php $this-&gt;generate_settings_html(); ?&gt;&nbsp;</div></li><li><div>                    &lt;/table&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&nbsp;</div></li><li><div>            &lt;style type=&quot;text/css&quot;&gt;&nbsp;</div></li><li><div>                #WC_FRPC_Country_List {&nbsp;</div></li><li><div>                    display: none;&nbsp;</div></li><li><div>                    margin: 10px;&nbsp;</div></li><li><div>                    padding: 20px;&nbsp;</div></li><li><div>                    background-color: #fff;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                #WC_FRPC_Country_List p:first-child {&nbsp;</div></li><li><div>                    margin-top: 0px;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                #WC_FRPC_Country_List p:last-child {&nbsp;</div></li><li><div>                    margin-bottom: 0px;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                #wc_flatrate_wd_rightbar {&nbsp;</div></li><li><div>                    display: none;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                @media (min-width: 961px) {&nbsp;</div></li><li><div>                    #wc_flatrate_wd {&nbsp;</div></li><li><div>                        height: auto;&nbsp;</div></li><li><div>                        overflow: hidden;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    #wc_flatrate_wd_settings {&nbsp;</div></li><li><div>                        width: auto;&nbsp;</div></li><li><div>                        overflow: hidden;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    #wc_flatrate_wd_rightbar {&nbsp;</div></li><li><div>                        display: block;&nbsp;</div></li><li><div>                        float: right;&nbsp;</div></li><li><div>                        width: 200px;&nbsp;</div></li><li><div>                        max-width: 20%;&nbsp;</div></li><li><div>                        margin-left: 20px;&nbsp;</div></li><li><div>                        padding: 15px;&nbsp;</div></li><li><div>                        background-color: #fff;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    #wc_flatrate_wd_rightbar h4:first-child {&nbsp;</div></li><li><div>                        margin-top: 0px;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    #wc_flatrate_wd_rightbar p {&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    #wc_flatrate_wd_rightbar p img {&nbsp;</div></li><li><div>                        max-width: 100%;&nbsp;</div></li><li><div>                        height: auto;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                .form-table th {&nbsp;</div></li><li><div>                    width: 250px;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                .woocommerce_page_wc-settings h4.wc-settings-sub-title {&nbsp;</div></li><li><div>                    font-size: 1.4em;&nbsp;</div></li><li><div>                    padding-bottom: 0.5em;&nbsp;</div></li><li><div>                    border-bottom: 1px solid #444;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                .woocommerce_page_wc-settings .rules_sep {&nbsp;</div></li><li><div>                    border-bottom: 1px solid #CCC;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                .woocommerce_page_wc-settings .rules_items {&nbsp;</div></li><li><div>                    padding-left: 2em;&nbsp;</div></li><li><div>                    font-weight: normal;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            &lt;/style&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Removes the &quot;(Free)&quot; text from the shipping label if the rate is zero */&nbsp;</div></li><li><div>        public function remove_free_price_text($full_label, $method) {&nbsp;</div></li><li><div>            return str_replace(' ('.__('Free', 'woocommerce').')', '', $full_label);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Find shipping classes on the ordered items - Stolen from flat-rate shipping */&nbsp;</div></li><li><div>        public function find_shipping_classes( $package ) {&nbsp;</div></li><li><div>            $found_shipping_classes = array();&nbsp;</div></li><li><div>            // Find shipping classes for products in the cart&nbsp;</div></li><li><div>            if ( sizeof( $package['contents'] ) &gt; 0 ) {&nbsp;</div></li><li><div>                foreach ( $package['contents'] as $item_id =&gt; $values ) {&nbsp;</div></li><li><div>                    if ( $values['data']-&gt;needs_shipping() ) {&nbsp;</div></li><li><div>                        $found_class = $values['data']-&gt;get_shipping_class();&nbsp;</div></li><li><div>                        if ( ! isset( $found_shipping_classes[ $found_class ] ) ) {&nbsp;</div></li><li><div>                            $found_shipping_classes[ $found_class ] = array();&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $found_shipping_classes[ $found_class ][ $item_id ] = $values;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $found_shipping_classes;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Force correct WPML label translation */&nbsp;</div></li><li><div>        function wpml_shipping_method_label($label, $method) {&nbsp;</div></li><li><div>            if ($method-&gt;id==$this-&gt;id) {&nbsp;</div></li><li><div>                $label=$GLOBALS['woocommerce_flatrate_percountry_label'];&nbsp;</div></li><li><div>                if ( $method-&gt;cost &gt; 0 ) {&nbsp;</div></li><li><div>                    if ( WC()-&gt;cart-&gt;tax_display_cart == 'excl' ) {&nbsp;</div></li><li><div>                        $label .= ': ' . wc_price( $method-&gt;cost );&nbsp;</div></li><li><div>                        if ( $method-&gt;get_shipping_tax() &gt; 0 && WC()-&gt;cart-&gt;prices_include_tax ) {&nbsp;</div></li><li><div>                            $label .= ' &lt;small&gt;' . WC()-&gt;countries-&gt;ex_tax_or_vat() . '&lt;/small&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $label .= ': ' . wc_price( $method-&gt;cost + $method-&gt;get_shipping_tax() );&nbsp;</div></li><li><div>                        if ( $method-&gt;get_shipping_tax() &gt; 0 && ! WC()-&gt;cart-&gt;prices_include_tax ) {&nbsp;</div></li><li><div>                            $label .= ' &lt;small&gt;' . WC()-&gt;countries-&gt;inc_tax_or_vat() . '&lt;/small&gt;';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } elseif ( $method-&gt;id !== 'free_shipping' ) {&nbsp;</div></li><li><div>                    $label .= ' (' . __( 'Free', 'woocommerce' ) . ')';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $label;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** Calculate the rate */&nbsp;</div></li><li><div>        public function calculate_shipping($package = array()) {&nbsp;</div></li><li><div>            //Per order by default&nbsp;</div></li><li><div>            $tax_type='per_order';&nbsp;</div></li><li><div>            //Order total&nbsp;</div></li><li><div>            if (WC()-&gt;cart-&gt;prices_include_tax)&nbsp;</div></li><li><div>                $order_total = WC()-&gt;cart-&gt;cart_contents_total + array_sum( WC()-&gt;cart-&gt;taxes );&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                $order_total = WC()-&gt;cart-&gt;cart_contents_total;&nbsp;</div></li><li><div>            //Label&nbsp;</div></li><li><div>            $label='';&nbsp;</div></li><li><div>            if(trim($package['destination']['country'])!='') {&nbsp;</div></li><li><div>                $final_rate=-1;&nbsp;</div></li><li><div>                //State&nbsp;</div></li><li><div>                if ($final_rate==-1) {&nbsp;</div></li><li><div>                    $count=intval($this-&gt;settings['per_state_count']);&nbsp;</div></li><li><div>                    for($i=1; $i&lt;=$count; $i++) {&nbsp;</div></li><li><div>                        if (isset($this-&gt;settings['per_state_'.$i.'_s']) && is_array($this-&gt;settings['per_state_'.$i.'_s'])) {&nbsp;</div></li><li><div>                            if (trim($package['destination']['country'])==$this-&gt;settings['per_state_'.$i.'_c']) { //Pas correcto&nbsp;</div></li><li><div>                                $states=WC()-&gt;countries-&gt;get_states($this-&gt;settings['per_state_'.$i.'_c']);&nbsp;</div></li><li><div>                                if (in_array(trim($package['destination']['state']), $this-&gt;settings['per_state_'.$i.'_s'])) { //State found in this state rule&nbsp;</div></li><li><div>                                    if (isset($this-&gt;settings['per_state_'.$i.'_fee']) && is_numeric($this-&gt;settings['per_state_'.$i.'_fee'])) { //Rate is set for this rule&nbsp;</div></li><li><div>                                        //The rate&nbsp;</div></li><li><div>                                        $final_rate=$this-&gt;settings['per_state_'.$i.'_fee'];&nbsp;</div></li><li><div>                                        //Free based on price?&nbsp;</div></li><li><div>                                        if (isset($this-&gt;settings['per_state_'.$i.'_fr']) && ! empty($this-&gt;settings['per_state_'.$i.'_fr'])) {&nbsp;</div></li><li><div>                                            if (intval($this-&gt;settings['per_state_'.$i.'_fr'])&gt;0) {&nbsp;</div></li><li><div>                                                if ($order_total&gt;=intval($this-&gt;settings['per_state_'.$i.'_fr'])) $final_rate=0; //Free&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        //Free based on shipping class?&nbsp;</div></li><li><div>                                        if (isset($this-&gt;settings['per_state_'.$i.'_fr_class']) && is_array($this-&gt;settings['per_state_'.$i.'_fr_class'])) {&nbsp;</div></li><li><div>                                            if (count($this-&gt;settings['per_state_'.$i.'_fr_class'])&gt;0) {&nbsp;</div></li><li><div>                                                switch($this-&gt;settings['per_state_'.$i.'_fr_class_type']) {&nbsp;</div></li><li><div>                                                    case 'all':&nbsp;</div></li><li><div>                                                        $final_rate_free=true;&nbsp;</div></li><li><div>                                                        foreach ($this-&gt;find_shipping_classes($package) as $shipping_class =&gt; $items) {&nbsp;</div></li><li><div>                                                            if (trim($shipping_class)!='') {&nbsp;</div></li><li><div>                                                                if (!in_array($shipping_class, $this-&gt;settings['per_state_'.$i.'_fr_class'])) {&nbsp;</div></li><li><div>                                                                    $final_rate_free=false; //Not free&nbsp;</div></li><li><div>                                                                    break;&nbsp;</div></li><li><div>                                                                }&nbsp;</div></li><li><div>                                                            } else {&nbsp;</div></li><li><div>                                                                $final_rate_free=false; //Not free&nbsp;</div></li><li><div>                                                            }&nbsp;</div></li><li><div>                                                        }&nbsp;</div></li><li><div>                                                        if ($final_rate_free) $final_rate=0; //Free&nbsp;</div></li><li><div>                                                        break;&nbsp;</div></li><li><div>                                                    //case 'one':&nbsp;</div></li><li><div>                                                    default:&nbsp;</div></li><li><div>                                                        foreach ($this-&gt;find_shipping_classes($package) as $shipping_class =&gt; $items) {&nbsp;</div></li><li><div>                                                            if (trim($shipping_class)!='') {&nbsp;</div></li><li><div>                                                                if (in_array($shipping_class, $this-&gt;settings['per_country_'.$i.'_fr_class'])) {&nbsp;</div></li><li><div>                                                                    $final_rate=0; //Free&nbsp;</div></li><li><div>                                                                    break;&nbsp;</div></li><li><div>                                                                }&nbsp;</div></li><li><div>                                                            }&nbsp;</div></li><li><div>                                                        }&nbsp;</div></li><li><div>                                                        break;&nbsp;</div></li><li><div>                                                }&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        //Per order or per item?&nbsp;</div></li><li><div>                                        if (isset($this-&gt;settings['per_state_'.$i.'_t']) && ! empty($this-&gt;settings['per_state_'.$i.'_t'])) $tax_type=$this-&gt;settings['per_state_'.$i.'_t'];&nbsp;</div></li><li><div>                                        //The label&nbsp;</div></li><li><div>                                        if ($this-&gt;settings['show_region_country']=='rule_name') {&nbsp;</div></li><li><div>                                            //$label=$this-&gt;settings['per_state_'.$i.'_txt'];&nbsp;</div></li><li><div>                                            $label=(&nbsp;</div></li><li><div>                                                $this-&gt;wpml&nbsp;</div></li><li><div>                                                ?&nbsp;</div></li><li><div>                                                icl_translate($this-&gt;id, $this-&gt;id.'_per_state_'.$i.'_txt', $this-&gt;settings['per_state_'.$i.'_txt'])&nbsp;</div></li><li><div>                                                :&nbsp;</div></li><li><div>                                                $this-&gt;settings['per_state_'.$i.'_txt']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                                        } else {&nbsp;</div></li><li><div>                                            $label=$states[trim($package['destination']['state'])];&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                //Country&nbsp;</div></li><li><div>                if ($final_rate==-1) {&nbsp;</div></li><li><div>                    $count=intval($this-&gt;settings['per_country_count']);&nbsp;</div></li><li><div>                    for($i=1; $i&lt;=$count; $i++) {&nbsp;</div></li><li><div>                        if (isset($this-&gt;settings['per_country_'.$i.'_c']) && is_array($this-&gt;settings['per_country_'.$i.'_c'])) {&nbsp;</div></li><li><div>                            if (in_array(trim($package['destination']['country']), $this-&gt;settings['per_country_'.$i.'_c'])) { //Country found in this country rule&nbsp;</div></li><li><div>                                if (isset($this-&gt;settings['per_country_'.$i.'_fee']) && is_numeric($this-&gt;settings['per_country_'.$i.'_fee'])) { //Rate is set for this rule&nbsp;</div></li><li><div>                                    //The rate&nbsp;</div></li><li><div>                                    $final_rate=$this-&gt;settings['per_country_'.$i.'_fee'];&nbsp;</div></li><li><div>                                    //Free based on price?&nbsp;</div></li><li><div>                                    if (isset($this-&gt;settings['per_country_'.$i.'_fr']) && ! empty($this-&gt;settings['per_country_'.$i.'_fr'])) {&nbsp;</div></li><li><div>                                        if (intval($this-&gt;settings['per_country_'.$i.'_fr'])&gt;0) {&nbsp;</div></li><li><div>                                            if ($order_total&gt;=intval($this-&gt;settings['per_country_'.$i.'_fr'])) $final_rate=0; //Free&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    //Free based on shipping class?&nbsp;</div></li><li><div>                                    if (isset($this-&gt;settings['per_country_'.$i.'_fr_class']) && is_array($this-&gt;settings['per_country_'.$i.'_fr_class'])) {&nbsp;</div></li><li><div>                                        if (count($this-&gt;settings['per_country_'.$i.'_fr_class'])&gt;0) {&nbsp;</div></li><li><div>                                            switch($this-&gt;settings['per_country_'.$i.'_fr_class_type']) {&nbsp;</div></li><li><div>                                                case 'all':&nbsp;</div></li><li><div>                                                    $final_rate_free=true;&nbsp;</div></li><li><div>                                                    foreach ($this-&gt;find_shipping_classes($package) as $shipping_class =&gt; $items) {&nbsp;</div></li><li><div>                                                        if (trim($shipping_class)!='') {&nbsp;</div></li><li><div>                                                            if (!in_array($shipping_class, $this-&gt;settings['per_country_'.$i.'_fr_class'])) {&nbsp;</div></li><li><div>                                                                $final_rate_free=false; //Not free&nbsp;</div></li><li><div>                                                                break;&nbsp;</div></li><li><div>                                                            }&nbsp;</div></li><li><div>                                                        } else {&nbsp;</div></li><li><div>                                                            $final_rate_free=false; //Not free&nbsp;</div></li><li><div>                                                        }&nbsp;</div></li><li><div>                                                    }&nbsp;</div></li><li><div>                                                    if ($final_rate_free) $final_rate=0; //Free&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>                                                //case 'one':&nbsp;</div></li><li><div>                                                default:&nbsp;</div></li><li><div>                                                    foreach ($this-&gt;find_shipping_classes($package) as $shipping_class =&gt; $items) {&nbsp;</div></li><li><div>                                                        if (trim($shipping_class)!='') {&nbsp;</div></li><li><div>                                                            if (in_array($shipping_class, $this-&gt;settings['per_country_'.$i.'_fr_class'])) {&nbsp;</div></li><li><div>                                                                $final_rate=0; //Free&nbsp;</div></li><li><div>                                                                break;&nbsp;</div></li><li><div>                                                            }&nbsp;</div></li><li><div>                                                        }&nbsp;</div></li><li><div>                                                    }&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    //Per order or per item?&nbsp;</div></li><li><div>                                    if (isset($this-&gt;settings['per_country_'.$i.'_t']) && ! empty($this-&gt;settings['per_country_'.$i.'_t'])) $tax_type=$this-&gt;settings['per_country_'.$i.'_t'];&nbsp;</div></li><li><div>                                    //The label&nbsp;</div></li><li><div>                                    if ($this-&gt;settings['show_region_country']=='rule_name') {&nbsp;</div></li><li><div>                                        //$label=$this-&gt;settings['per_country_'.$i.'_txt'];&nbsp;</div></li><li><div>                                        $label=(&nbsp;</div></li><li><div>                                            $this-&gt;wpml&nbsp;</div></li><li><div>                                            ?&nbsp;</div></li><li><div>                                            icl_translate($this-&gt;id, $this-&gt;id.'_per_country_'.$i.'_txt', $this-&gt;settings['per_country_'.$i.'_txt'])&nbsp;</div></li><li><div>                                            :&nbsp;</div></li><li><div>                                            $this-&gt;settings['per_country_'.$i.'_txt']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                                    } else {&nbsp;</div></li><li><div>                                        $label=WC()-&gt;countries-&gt;countries[trim($package['destination']['country'])];&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                //Region&nbsp;</div></li><li><div>                if ($final_rate==-1) {&nbsp;</div></li><li><div>                    $count=intval($this-&gt;settings['per_region_count']);&nbsp;</div></li><li><div>                    for($i=1; $i&lt;=$count; $i++) {&nbsp;</div></li><li><div>                        if (isset($this-&gt;settings['per_region_'.$i.'_region']) && is_array($this-&gt;settings['per_region_'.$i.'_region'])) {&nbsp;</div></li><li><div>                            foreach($this-&gt;settings['per_region_'.$i.'_region'] as $region) {&nbsp;</div></li><li><div>                                if (in_array(trim($package['destination']['country']), $this-&gt;regions[trim($region)]['countries'])) { //Country found in this region rule&nbsp;</div></li><li><div>                                    if (isset($this-&gt;settings['per_region_'.$i.'_fee']) && is_numeric($this-&gt;settings['per_region_'.$i.'_fee'])) { //Rate is set for this rule&nbsp;</div></li><li><div>                                        //The rate&nbsp;</div></li><li><div>                                        $final_rate=$this-&gt;settings['per_region_'.$i.'_fee'];&nbsp;</div></li><li><div>                                        //Free based on price?&nbsp;</div></li><li><div>                                        if (isset($this-&gt;settings['per_region_'.$i.'_fr']) && ! empty($this-&gt;settings['per_region_'.$i.'_fr'])) {&nbsp;</div></li><li><div>                                            if (intval($this-&gt;settings['per_region_'.$i.'_fr'])&gt;0) {&nbsp;</div></li><li><div>                                                if ($order_total&gt;=intval($this-&gt;settings['per_region_'.$i.'_fr'])) $final_rate=0; //Free&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        //Free based on shipping class?&nbsp;</div></li><li><div>                                        if (isset($this-&gt;settings['per_region_'.$i.'_fr_class']) && is_array($this-&gt;settings['per_region_'.$i.'_fr_class'])) {&nbsp;</div></li><li><div>                                            if (count($this-&gt;settings['per_region_'.$i.'_fr_class'])&gt;0) {&nbsp;</div></li><li><div>                                                switch($this-&gt;settings['per_region_'.$i.'_fr_class_type']) {&nbsp;</div></li><li><div>                                                    case 'all':&nbsp;</div></li><li><div>                                                        $final_rate_free=true;&nbsp;</div></li><li><div>                                                        foreach ($this-&gt;find_shipping_classes($package) as $shipping_class =&gt; $items) {&nbsp;</div></li><li><div>                                                            if (trim($shipping_class)!='') {&nbsp;</div></li><li><div>                                                                if (!in_array($shipping_class, $this-&gt;settings['per_region_'.$i.'_fr_class'])) {&nbsp;</div></li><li><div>                                                                    $final_rate_free=false; //Not free&nbsp;</div></li><li><div>                                                                    break;&nbsp;</div></li><li><div>                                                                }&nbsp;</div></li><li><div>                                                            } else {&nbsp;</div></li><li><div>                                                                $final_rate_free=false; //Not free&nbsp;</div></li><li><div>                                                            }&nbsp;</div></li><li><div>                                                        }&nbsp;</div></li><li><div>                                                        if ($final_rate_free) $final_rate=0; //Free&nbsp;</div></li><li><div>                                                        break;&nbsp;</div></li><li><div>                                                    //case 'one':&nbsp;</div></li><li><div>                                                    default:&nbsp;</div></li><li><div>                                                        foreach ($this-&gt;find_shipping_classes($package) as $shipping_class =&gt; $items) {&nbsp;</div></li><li><div>                                                            if (trim($shipping_class)!='') {&nbsp;</div></li><li><div>                                                                if (in_array($shipping_class, $this-&gt;settings['per_region_'.$i.'_fr_class'])) {&nbsp;</div></li><li><div>                                                                    $final_rate=0; //Free&nbsp;</div></li><li><div>                                                                    break;&nbsp;</div></li><li><div>                                                                }&nbsp;</div></li><li><div>                                                            }&nbsp;</div></li><li><div>                                                        }&nbsp;</div></li><li><div>                                                        break;&nbsp;</div></li><li><div>                                                }&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        //Per order or per item?&nbsp;</div></li><li><div>                                        if (isset($this-&gt;settings['per_region_'.$i.'_t']) && ! empty($this-&gt;settings['per_region_'.$i.'_t'])) $tax_type=$this-&gt;settings['per_region_'.$i.'_t'];&nbsp;</div></li><li><div>                                        //The label&nbsp;</div></li><li><div>                                        if ($this-&gt;settings['show_region_country']=='rule_name') {&nbsp;</div></li><li><div>                                            //$label=$this-&gt;settings['per_region_'.$i.'_txt'];&nbsp;</div></li><li><div>                                            $label=(&nbsp;</div></li><li><div>                                                $this-&gt;wpml&nbsp;</div></li><li><div>                                                ?&nbsp;</div></li><li><div>                                                icl_translate($this-&gt;id, $this-&gt;id.'_per_region_'.$i.'_txt', $this-&gt;settings['per_region_'.$i.'_txt'])&nbsp;</div></li><li><div>                                                :&nbsp;</div></li><li><div>                                                $this-&gt;settings['per_region_'.$i.'_txt']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                                        } else {&nbsp;</div></li><li><div>                                            $label=$this-&gt;regions[trim($region)]['name'];&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            if ($final_rate!=-1) break; //Region rate found, break for&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                //Rest of the World&nbsp;</div></li><li><div>                if ($final_rate==-1) {&nbsp;</div></li><li><div>                    if (isset($this-&gt;settings['world_disable']) && $this-&gt;settings['world_disable']=='yes') return; //Exit with no fee set&nbsp;</div></li><li><div>                    if (isset($this-&gt;settings['fee_world']) && is_numeric($this-&gt;settings['fee_world'])) {&nbsp;</div></li><li><div>                        //The rate&nbsp;</div></li><li><div>                        $final_rate=$this-&gt;settings['fee_world'];&nbsp;</div></li><li><div>                        //Free based on price?&nbsp;</div></li><li><div>                        if (isset($this-&gt;settings['world_free_above']) && ! empty($this-&gt;settings['world_free_above'])) {&nbsp;</div></li><li><div>                            if (intval($this-&gt;settings['world_free_above'])&gt;0) {&nbsp;</div></li><li><div>                                if ($order_total&gt;=intval($this-&gt;settings['world_free_above'])) $final_rate=0; //Free&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        //Free based on shipping class?&nbsp;</div></li><li><div>                        if (isset($this-&gt;settings['world_free_class']) && is_array($this-&gt;settings['world_free_class'])) {&nbsp;</div></li><li><div>                            if (count($this-&gt;settings['world_free_class'])&gt;0) {&nbsp;</div></li><li><div>                                switch($this-&gt;settings['world_free_class_type']) {&nbsp;</div></li><li><div>                                    case 'all':&nbsp;</div></li><li><div>                                        $final_rate_free=true;&nbsp;</div></li><li><div>                                        foreach ($this-&gt;find_shipping_classes($package) as $shipping_class =&gt; $items) {&nbsp;</div></li><li><div>                                            if (trim($shipping_class)!='') {&nbsp;</div></li><li><div>                                                if (!in_array($shipping_class, $this-&gt;settings['world_free_class'])) {&nbsp;</div></li><li><div>                                                    $final_rate_free=false; //Not free&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>                                                }&nbsp;</div></li><li><div>                                            } else {&nbsp;</div></li><li><div>                                                $final_rate_free=false; //Not free&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        if ($final_rate_free) $final_rate=0; //Free&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    //case 'one':&nbsp;</div></li><li><div>                                    default:&nbsp;</div></li><li><div>                                        foreach ($this-&gt;find_shipping_classes($package) as $shipping_class =&gt; $items) {&nbsp;</div></li><li><div>                                            if (trim($shipping_class)!='') {&nbsp;</div></li><li><div>                                                if (in_array($shipping_class, $this-&gt;settings['world_free_class'])) {&nbsp;</div></li><li><div>                                                    $final_rate=0; //Free&nbsp;</div></li><li><div>                                                    break;&nbsp;</div></li><li><div>                                                }&nbsp;</div></li><li><div>                                            }&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        //Per order or per item?&nbsp;</div></li><li><div>                        if (isset($this-&gt;settings['tax_type']) && ! empty($this-&gt;settings['tax_type'])) $tax_type=$this-&gt;settings['tax_type'];&nbsp;</div></li><li><div>                        //The label&nbsp;</div></li><li><div>                        if ($this-&gt;settings['show_region_country']=='rule_name') {&nbsp;</div></li><li><div>                            //$label=$this-&gt;settings['world_rulename'];&nbsp;</div></li><li><div>                            $label=(&nbsp;</div></li><li><div>                                $this-&gt;wpml&nbsp;</div></li><li><div>                                ?&nbsp;</div></li><li><div>                                icl_translate($this-&gt;id, $this-&gt;id.'_world_rulename', $this-&gt;settings['world_rulename'])&nbsp;</div></li><li><div>                                :&nbsp;</div></li><li><div>                                $this-&gt;settings['world_rulename']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $label=__('Rest of the World', 'flat-rate-per-countryregion-for-woocommerce');&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                //Let's customize the label&nbsp;</div></li><li><div>                if (isset($this-&gt;settings['show_region_country']) && ! empty($this-&gt;settings['show_region_country'])) {&nbsp;</div></li><li><div>                    switch($this-&gt;settings['show_region_country']) {&nbsp;</div></li><li><div>                        case 'region':&nbsp;</div></li><li><div>                        case 'rule_name':&nbsp;</div></li><li><div>                            //The default or already set&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        case 'country':&nbsp;</div></li><li><div>                            $label=WC()-&gt;countries-&gt;countries[trim($package['destination']['country'])];&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        case 'title':&nbsp;</div></li><li><div>                            //$label=$this-&gt;title;&nbsp;</div></li><li><div>                            $label=(&nbsp;</div></li><li><div>                                $this-&gt;wpml&nbsp;</div></li><li><div>                                ?&nbsp;</div></li><li><div>                                icl_translate($this-&gt;id, $this-&gt;id.'_title', $this-&gt;title)&nbsp;</div></li><li><div>                                :&nbsp;</div></li><li><div>                                $this-&gt;title&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        case 'title_region':&nbsp;</div></li><li><div>                            //$label=$this-&gt;title.' - '.$label;&nbsp;</div></li><li><div>                            $label=(&nbsp;</div></li><li><div>                                $this-&gt;wpml&nbsp;</div></li><li><div>                                ?&nbsp;</div></li><li><div>                                icl_translate($this-&gt;id, $this-&gt;id.'_title', $this-&gt;title)&nbsp;</div></li><li><div>                                :&nbsp;</div></li><li><div>                                $this-&gt;title&nbsp;</div></li><li><div> ).' - '.$label;&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        case 'title_country':&nbsp;</div></li><li><div>                            //$label=$this-&gt;title.' - '.WC()-&gt;countries-&gt;countries[trim($package['destination']['country'])];&nbsp;</div></li><li><div>                            $label=(&nbsp;</div></li><li><div>                                $this-&gt;wpml&nbsp;</div></li><li><div>                                ?&nbsp;</div></li><li><div>                                icl_translate($this-&gt;id, $this-&gt;id.'_title', $this-&gt;title)&nbsp;</div></li><li><div>                                :&nbsp;</div></li><li><div>                                $this-&gt;title&nbsp;</div></li><li><div> ).' - '.WC()-&gt;countries-&gt;countries[trim($package['destination']['country'])];&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        default:&nbsp;</div></li><li><div>                            //The default - already set&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                //Still no rate found. Well... That means it's free right?&nbsp;</div></li><li><div>                if ($final_rate==-1) {&nbsp;</div></li><li><div>                    $final_rate=0;&nbsp;</div></li><li><div>                    $label=__('Flat rate not set', 'flat-rate-per-countryregion-for-woocommerce');&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $final_rate=0; //No country? Is the client from outer world?&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $label=(trim($label)!='' ? $label : $this-&gt;title);&nbsp;</div></li><li><div>            if ($this-&gt;wpml) $GLOBALS['woocommerce_flatrate_percountry_label']=$label; //This is so dirty...&nbsp;</div></li><li><div>            $rate = array(&nbsp;</div></li><li><div>                'id' =&gt; $this-&gt;id, &nbsp;</div></li><li><div>                'label' =&gt; $label, &nbsp;</div></li><li><div>                'cost' =&gt; floatval($final_rate), &nbsp;</div></li><li><div>                'calc_tax' =&gt; 'per_order'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            switch($tax_type) {&nbsp;</div></li><li><div>                case 'per_order':&nbsp;</div></li><li><div>                    //The default - already set&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'per_item':&nbsp;</div></li><li><div>                    $final_rate_items=0;&nbsp;</div></li><li><div>                    foreach ($package['contents'] as $item_id =&gt; $values) {&nbsp;</div></li><li><div>                        $_product=$values['data'];&nbsp;</div></li><li><div>                        if ($values['quantity']&gt;0 && $_product-&gt;needs_shipping()) {&nbsp;</div></li><li><div>                            $temp_qty=floatval($values['quantity']);&nbsp;</div></li><li><div>                            //WooCommerce Product Bundles integration (https://wordpress.org/support/topic/for-use-with-woocommerce-product-bundles)&nbsp;</div></li><li><div>                            if (get_class($_product) == 'WC_Product_Bundle') {&nbsp;</div></li><li><div>                                if ($_product-&gt;per_product_shipping_active) { //Shipping per product?&nbsp;</div></li><li><div>                                    $temp_qty_bundle=0;&nbsp;</div></li><li><div>                                    $temp_bundles = $_product-&gt;get_bundled_items();&nbsp;</div></li><li><div>                                    if (is_array($temp_bundles) && count($temp_bundles) &gt; 0) {&nbsp;</div></li><li><div>                                        foreach ($temp_bundles as $temp_bundle_product) {&nbsp;</div></li><li><div>                                            $temp_qty_bundle += $temp_qty * (float)$temp_bundle_product-&gt;get_quantity();&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    $temp_qty=$temp_qty_bundle;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            $final_rate_items+=floatval($final_rate)*$temp_qty;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $rate['cost']=$final_rate_items;&nbsp;</div></li><li><div>                    //$rate['calc_tax']='per_item'; //Not really needed, is it?&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    //The default - already set&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Register the rate&nbsp;</div></li><li><div>            $this-&gt;add_rate($rate);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 2.4.6</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.8.1/functions/woocommerce_flatrate_percountry_init/" class="">2.4.8.1</a></li><li><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.7/functions/woocommerce_flatrate_percountry_init/" class="">2.4.7</a></li><li><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.2/functions/woocommerce_flatrate_percountry_init/" class="active">2.4.6.2</a></li><li><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6.1/functions/woocommerce_flatrate_percountry_init/" class="">2.4.6.1</a></li><li><a href="http://hookr.io/plugins/flat-rate-per-statecountryregion-for-woocommerce/2.4.6/functions/woocommerce_flatrate_percountry_init/" class="">2.4.6</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>function</li><li><span></span>woocommerce_flatrate_percountry_init</li><li><span></span>Flat Rate per State/Country/Region for WooCommerce</li><li><span></span>2.4.8.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>