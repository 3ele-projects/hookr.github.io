<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="1.14.8" data-slug="pods-framework" data-type="class" data-id="59864"><head xmlns="http://www.w3.org/1999/xhtml"><title> podapi | class | Pods Framework | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="PodAPI, class, plugin, pods-framework, 1.14.8" /><meta name="description" content="Include and Init the PodsAPI class" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=6bc320ebe6193b47c4550ee04c9798fa' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/pod_api/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpod_api%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fpod_api%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-pods-framework-1.14.8-class-pod_api","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="pod_api" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to pods-framework." href="http://hookr.io/plugins/pods-framework/" class="plugin"><span property="name">pods-framework</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><span property="name">1.14.8</span><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/pods-framework/1.14.8/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">pod_api</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="199"><a href="http://hookr.io/plugins/pods-framework/1.14.8/all/" title="All">All <span class="count badge">199</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/pods-framework/1.14.8/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="122"><a href="http://hookr.io/plugins/pods-framework/1.14.8/hooks/" title="Hooks">Hooks <span class="count badge">122</span></a></li><li class="" data-id="action" data-count="41"><a href="http://hookr.io/plugins/pods-framework/1.14.8/actions/" title="Actions">Actions <span class="count badge">41</span></a></li><li class="" data-id="filter" data-count="81"><a href="http://hookr.io/plugins/pods-framework/1.14.8/filters/" title="Filters">Filters <span class="count badge">81</span></a></li><li class="active" data-id="class" data-count="5"><a href="http://hookr.io/plugins/pods-framework/1.14.8/classes/" title="Classes">Classes <span class="count badge">5</span></a></li><li class="" data-id="constant" data-count="7"><a href="http://hookr.io/plugins/pods-framework/1.14.8/constants/" title="Constants">Constants <span class="count badge">7</span></a></li><li class="" data-id="function" data-count="64"><a href="http://hookr.io/plugins/pods-framework/1.14.8/functions/" title="Functions">Functions <span class="count badge">64</span></a></li><li class="" data-id="shortcode" data-count="1"><a href="http://hookr.io/plugins/pods-framework/1.14.8/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">1</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>PodAPI</strong></h1><p>Include and Init the PodsAPI class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/pods-framework/1.14.8/files/classes-podapi/" class="file">/classes/PodAPI.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="2" class="block" start="2"><li><div>class PodAPI&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    var $snap = false;&nbsp;</div></li><li><div>    var $dt;&nbsp;</div></li><li><div>    var $dtname;&nbsp;</div></li><li><div>    var $format;&nbsp;</div></li><li><div>    var $fields;&nbsp;</div></li><li><div>    var $use_pod_id = false; // set to true for save_pod_item to operate off of pod_id (for backwards compatibility with functions using pod_ids)&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Store and retrieve data programatically&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $dtname (optional) The pod name&nbsp;</div></li><li><div>     * @param string $format (optional) Format for import/export, &quot;php&quot; or &quot;csv&quot;&nbsp;</div></li><li><div>     * @since 1.7.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function __construct($dtname = null, $format = 'php') {&nbsp;</div></li><li><div>        $this-&gt;dtname = pods_sanitize(trim($dtname));&nbsp;</div></li><li><div>        $this-&gt;format = pods_sanitize(trim($format));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($this-&gt;dtname)) {&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod(array('name' =&gt; $this-&gt;dtname));&nbsp;</div></li><li><div>            if (is_array($pod)) {&nbsp;</div></li><li><div>                $this-&gt;dt = $pod['id'];&nbsp;</div></li><li><div>                $this-&gt;fields = $pod['fields'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Throw an error or die (cake or death?)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $error Error message&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function oh_snap($error) {&nbsp;</div></li><li><div>        if (false!==$this-&gt;snap) {&nbsp;</div></li><li><div>            throw new Exception($error);&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        die($error);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or edit a content type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The datatype ID&nbsp;</div></li><li><div>     * $params['name'] string The datatype name&nbsp;</div></li><li><div>     * $params['label'] string The datatype label&nbsp;</div></li><li><div>     * $params['is_toplevel'] bool Display the pod as a top-level admin menu&nbsp;</div></li><li><div>     * $params['detail_page'] string The URI for single pod items&nbsp;</div></li><li><div>     * $params['pre_save_helpers'] string Comma-separated list of helper names&nbsp;</div></li><li><div>     * $params['pre_drop_helpers'] string Comma-separated list of helper names&nbsp;</div></li><li><div>     * $params['post_save_helpers'] string Comma-separated list of helper names&nbsp;</div></li><li><div>     * $params['post_drop_helpers'] string Comma-separated list of helper names&nbsp;</div></li><li><div>     * $params['order'] string Comma-separated list of field IDs&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_pod($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) str_replace('@wp_', '{prefix}', $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set defaults&nbsp;</div></li><li><div>        $params = (object) array_merge(array('id' =&gt; '', &nbsp;</div></li><li><div>                                             'name' =&gt; '', &nbsp;</div></li><li><div>                                             'label' =&gt; '', &nbsp;</div></li><li><div>                                             'is_toplevel' =&gt; 0, &nbsp;</div></li><li><div>                                             'detail_page' =&gt; '', &nbsp;</div></li><li><div>                                             'pre_save_helpers' =&gt; '', &nbsp;</div></li><li><div>                                             'pre_drop_helpers' =&gt; '', &nbsp;</div></li><li><div>                                             'post_save_helpers' =&gt; '', &nbsp;</div></li><li><div>                                             'post_drop_helpers' =&gt; '', &nbsp;</div></li><li><div>                                             'order' =&gt; 0), &nbsp;</div></li><li><div>                                       (array) $params);&nbsp;</div></li><li><div>        if (isset($params-&gt;action))&nbsp;</div></li><li><div>            unset($params-&gt;action);&nbsp;</div></li><li><div>        if (isset($params-&gt;_wpnonce))&nbsp;</div></li><li><div>            unset($params-&gt;_wpnonce);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add new pod&nbsp;</div></li><li><div>        if (empty($params-&gt;id)) {&nbsp;</div></li><li><div>            $params-&gt;name = pods_clean_name($params-&gt;name);&nbsp;</div></li><li><div>            if (empty($params-&gt;name)) {&nbsp;</div></li><li><div>                return $this-&gt;oh_snap('&lt;e&gt;Enter a pod name');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $sql = &quot;SELECT id FROM @wp_pod_types WHERE name = '{$params-&gt;name}' LIMIT 1&quot;;&nbsp;</div></li><li><div>            pod_query($sql, 'Duplicate pod name', 'Pod name already exists');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $set = array();&nbsp;</div></li><li><div>            $columns = array();&nbsp;</div></li><li><div>            foreach ($params as $column =&gt; $value) {&nbsp;</div></li><li><div>                if (in_array($column, array('id', 'order', 'return_pod')))&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                $columns[] = &quot;`{$column}`&quot;;&nbsp;</div></li><li><div>                $set[] = &quot;'{$value}'&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $columns = implode(', ', $columns);&nbsp;</div></li><li><div>            $set = implode(', ', $set);&nbsp;</div></li><li><div>            $pod_id = pod_query(&quot;INSERT INTO @wp_pod_types ({$columns}) VALUES ({$set})&quot;, 'Cannot add new pod');&nbsp;</div></li><li><div>            pod_query(&quot;CREATE TABLE `@wp_pod_tbl_{$params-&gt;name}` (id int unsigned auto_increment primary key, name varchar(128), slug varchar(128)) DEFAULT CHARSET utf8&quot;, 'Cannot add pod database table');&nbsp;</div></li><li><div>            pod_query(&quot;INSERT INTO @wp_pod_fields (datatype, name, label, comment, coltype, required, weight) VALUES ({$pod_id}, 'name', 'Name', '', 'txt', 1, 0), ({$pod_id}, 'slug', 'Permalink', 'Leave blank to auto-generate', 'slug', 0, 1)&quot;);&nbsp;</div></li><li><div>            if (!isset($params-&gt;return_pod) || false === $params-&gt;return_pod)&nbsp;</div></li><li><div>                return $pod_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Edit existing pod&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $pod_id = $params-&gt;id;&nbsp;</div></li><li><div>            $set = array();&nbsp;</div></li><li><div>            foreach ($params as $column =&gt; $value) {&nbsp;</div></li><li><div>                if (in_array($column, array('id', 'name', 'order', 'return_pod')))&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                $set[] = &quot;`{$column}` = '{$value}'&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (!empty($set)) {&nbsp;</div></li><li><div>                $set = implode(', ', $set);&nbsp;</div></li><li><div>                $sql = &quot;&nbsp;</div></li><li><div>                UPDATE&nbsp;</div></li><li><div>                    `@wp_pod_types`&nbsp;</div></li><li><div>                SET&nbsp;</div></li><li><div>                    {$set}&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                    `id` = {$pod_id}&nbsp;</div></li><li><div>                LIMIT&nbsp;</div></li><li><div>                    1&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>                pod_query($sql, 'Cannot change Pod settings');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $weight = 0;&nbsp;</div></li><li><div>            $order = (false !== strpos($params-&gt;order, ', ')) ? explode(', ', $params-&gt;order) : array($params-&gt;order);&nbsp;</div></li><li><div>            foreach ($order as $field_id) {&nbsp;</div></li><li><div>                pod_query(&quot;UPDATE `@wp_pod_fields` SET `weight` = '{$weight}' WHERE `id` = '{$field_id}' LIMIT 1&quot;, 'Cannot change column order');&nbsp;</div></li><li><div>                $weight++;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (!isset($params-&gt;return_pod) || false === $params-&gt;return_pod)&nbsp;</div></li><li><div>                return $pod_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $this-&gt;load_pod(array('id' =&gt; $pod_id));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or edit a column within a content type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The field ID&nbsp;</div></li><li><div>     * $params['name'] string The field name&nbsp;</div></li><li><div>     * $params['datatype'] int The datatype ID&nbsp;</div></li><li><div>     * $params['dtname'] string The datatype name&nbsp;</div></li><li><div>     * $params['coltype'] string The column type (&quot;txt&quot;, &quot;desc&quot;, &quot;pick&quot;, etc)&nbsp;</div></li><li><div>     * $params['sister_field_id'] int (optional) The related field ID&nbsp;</div></li><li><div>     * $params['pickval'] string The related PICK pod name&nbsp;</div></li><li><div>     * $params['label'] string The field label&nbsp;</div></li><li><div>     * $params['comment'] string The field comment&nbsp;</div></li><li><div>     * $params['display_helper'] string (optional) The display helper name&nbsp;</div></li><li><div>     * $params['input_helper'] string (optional) The input helper name&nbsp;</div></li><li><div>     * $params['pick_filter'] string (optional) WHERE clause for PICK fields&nbsp;</div></li><li><div>     * $params['pick_orderby'] string (optional) ORDER BY clause for PICK fields&nbsp;</div></li><li><div>     * $params['required'] bool Is the field required?&nbsp;</div></li><li><div>     * $params['unique'] bool Is the field unique?&nbsp;</div></li><li><div>     * $params['multiple'] bool Is the PICK dropdown a multi-select?&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_column($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) str_replace('@wp_', '{prefix}', $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set defaults&nbsp;</div></li><li><div>        $params = (object) array_merge(array('id' =&gt; '', &nbsp;</div></li><li><div>                                             'name' =&gt; '', &nbsp;</div></li><li><div>                                             'datatype' =&gt; '', &nbsp;</div></li><li><div>                                             'dtname' =&gt; '', &nbsp;</div></li><li><div>                                             'coltype' =&gt; 'txt', &nbsp;</div></li><li><div>                                             'sister_field_id' =&gt; 0, &nbsp;</div></li><li><div>                                             'pickval' =&gt; '', &nbsp;</div></li><li><div>                                             'label' =&gt; '', &nbsp;</div></li><li><div>                                             'comment' =&gt; '', &nbsp;</div></li><li><div>                                             'display_helper' =&gt; '', &nbsp;</div></li><li><div>                                             'input_helper' =&gt; '', &nbsp;</div></li><li><div>                                             'pick_filter' =&gt; '', &nbsp;</div></li><li><div>                                             'pick_orderby' =&gt; '', &nbsp;</div></li><li><div>                                             'required' =&gt; 0, &nbsp;</div></li><li><div>                                             'unique' =&gt; 0, &nbsp;</div></li><li><div>                                             'multiple' =&gt; 0), &nbsp;</div></li><li><div>                                       (array) $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Force Types&nbsp;</div></li><li><div>        $params-&gt;id = absint($params-&gt;id);&nbsp;</div></li><li><div>        $params-&gt;sister_field_id = absint($params-&gt;sister_field_id);&nbsp;</div></li><li><div>        $params-&gt;required = absint($params-&gt;required);&nbsp;</div></li><li><div>        $params-&gt;unique = absint($params-&gt;unique);&nbsp;</div></li><li><div>        $params-&gt;multiple = absint($params-&gt;multiple);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $dbtypes = array(&nbsp;</div></li><li><div>            'bool' =&gt; 'bool default 0', &nbsp;</div></li><li><div>            'date' =&gt; 'datetime', &nbsp;</div></li><li><div>            'num' =&gt; 'decimal(12, 2)', &nbsp;</div></li><li><div>            'txt' =&gt; 'varchar(128)', &nbsp;</div></li><li><div>            'slug' =&gt; 'varchar(128)', &nbsp;</div></li><li><div>            'code' =&gt; 'longtext', &nbsp;</div></li><li><div>            'desc' =&gt; 'longtext'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $dbtypes = apply_filters('pods_column_dbtypes', $dbtypes);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add new column&nbsp;</div></li><li><div>        if (empty($params-&gt;id)) {&nbsp;</div></li><li><div>            $params-&gt;name = pods_clean_name($params-&gt;name);&nbsp;</div></li><li><div>            if (empty($params-&gt;name)) {&nbsp;</div></li><li><div>                return $this-&gt;oh_snap('&lt;e&gt;Enter a column name');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif (in_array($params-&gt;name, array('id', 'name', 'type', 'created', 'modified', 'p', 't'))) {&nbsp;</div></li><li><div>                return $this-&gt;oh_snap(&quot;&lt;e&gt;$params-&gt;name is a reserved name&quot;);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $sql = &quot;SELECT id FROM @wp_pod_fields WHERE datatype = $params-&gt;datatype AND name = '$params-&gt;name' LIMIT 1&quot;;&nbsp;</div></li><li><div>            pod_query($sql, 'Cannot get fields', 'Column by this name already exists');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ('slug' == $params-&gt;coltype) {&nbsp;</div></li><li><div>                $sql = &quot;SELECT id FROM @wp_pod_fields WHERE datatype = $params-&gt;datatype AND coltype = 'slug' LIMIT 1&quot;;&nbsp;</div></li><li><div>                pod_query($sql, 'Too many permalinks', 'This pod already has a permalink column');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Sink the new column to the bottom of the list&nbsp;</div></li><li><div>            $weight = 0;&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT weight FROM @wp_pod_fields WHERE datatype = $params-&gt;datatype ORDER BY weight DESC LIMIT 1&quot;);&nbsp;</div></li><li><div>            if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                $row = pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>                $weight = (int) $row['weight'] + 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ('pick' != $params-&gt;coltype) {&nbsp;</div></li><li><div>                $params-&gt;pickval = '';&nbsp;</div></li><li><div>                $params-&gt;pick_filter = '';&nbsp;</div></li><li><div>                $params-&gt;pick_orderby = '';&nbsp;</div></li><li><div>                $params-&gt;sister_field_id = 0;&nbsp;</div></li><li><div>                $params-&gt;multiple = 0;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $field_id = pod_query(&quot;INSERT INTO @wp_pod_fields (datatype, name, label, comment, display_helper, input_helper, coltype, pickval, pick_filter, pick_orderby, sister_field_id, required, `unique`, `multiple`, weight) VALUES ('$params-&gt;datatype', '$params-&gt;name', '$params-&gt;label', '$params-&gt;comment', '$params-&gt;display_helper', '$params-&gt;input_helper', '$params-&gt;coltype', '$params-&gt;pickval', '$params-&gt;pick_filter', '$params-&gt;pick_orderby', '$params-&gt;sister_field_id', '$params-&gt;required', '$params-&gt;unique', '$params-&gt;multiple', '$weight')&quot;, 'Cannot add new field');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ('pick' != $params-&gt;coltype && 'file' != $params-&gt;coltype) {&nbsp;</div></li><li><div>                $dbtype = $dbtypes[$params-&gt;coltype];&nbsp;</div></li><li><div>                pod_query(&quot;ALTER TABLE `@wp_pod_tbl_$params-&gt;dtname` ADD COLUMN `$params-&gt;name` $dbtype&quot;, 'Cannot create new column');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                pod_query(&quot;UPDATE @wp_pod_fields SET sister_field_id = '{$field_id}' WHERE id = '{$params-&gt;sister_field_id}' LIMIT 1&quot;, 'Cannot update sister field');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Edit existing column&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            if ('id' == $params-&gt;name) {&nbsp;</div></li><li><div>                return $this-&gt;oh_snap(&quot;&lt;e&gt;$params-&gt;name is not editable.&quot;);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql = &quot;SELECT id FROM @wp_pod_fields WHERE datatype = $params-&gt;datatype AND id != $params-&gt;id AND name = '$params-&gt;name' LIMIT 1&quot;;&nbsp;</div></li><li><div>            pod_query($sql, 'Column already exists', &quot;$params-&gt;name already exists.&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql = &quot;SELECT name, coltype FROM @wp_pod_fields WHERE id = $params-&gt;id LIMIT 1&quot;;&nbsp;</div></li><li><div>            $result = pod_query($sql);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                $row = pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>                $old_coltype = $row['coltype'];&nbsp;</div></li><li><div>                $old_name = $row['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $dbtype = $dbtypes[$params-&gt;coltype];&nbsp;</div></li><li><div>                $pickval = ('pick' != $params-&gt;coltype || empty($params-&gt;pickval)) ? '' : &quot;$params-&gt;pickval&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($params-&gt;coltype != $old_coltype) {&nbsp;</div></li><li><div>                    if ('pick' == $params-&gt;coltype || 'file' == $params-&gt;coltype) {&nbsp;</div></li><li><div>                        if ('pick' != $old_coltype && 'file' != $old_coltype) {&nbsp;</div></li><li><div>                            pod_query(&quot;ALTER TABLE `@wp_pod_tbl_$params-&gt;dtname` DROP COLUMN `$old_name`&quot;);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    elseif ('pick' == $old_coltype || 'file' == $old_coltype) {&nbsp;</div></li><li><div>                        pod_query(&quot;ALTER TABLE `@wp_pod_tbl_$params-&gt;dtname` ADD COLUMN `$params-&gt;name` $dbtype&quot;, 'Cannot create column');&nbsp;</div></li><li><div>                        pod_query(&quot;UPDATE @wp_pod_fields SET sister_field_id = NULL WHERE sister_field_id = $params-&gt;id&quot;);&nbsp;</div></li><li><div>                        pod_query(&quot;DELETE FROM @wp_pod_rel WHERE field_id = $params-&gt;id&quot;);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        pod_query(&quot;ALTER TABLE `@wp_pod_tbl_$params-&gt;dtname` CHANGE `$old_name` `$params-&gt;name` $dbtype&quot;);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ($params-&gt;name != $old_name && 'pick' != $params-&gt;coltype && 'file' != $params-&gt;coltype) {&nbsp;</div></li><li><div>                    pod_query(&quot;ALTER TABLE `@wp_pod_tbl_$params-&gt;dtname` CHANGE `$old_name` `$params-&gt;name` $dbtype&quot;);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ('pick' != $params-&gt;coltype) {&nbsp;</div></li><li><div>                    $params-&gt;pickval = '';&nbsp;</div></li><li><div>                    $params-&gt;pick_filter = '';&nbsp;</div></li><li><div>                    $params-&gt;pick_orderby = '';&nbsp;</div></li><li><div>                    $params-&gt;sister_field_id = 0;&nbsp;</div></li><li><div>                    $params-&gt;multiple = 0;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $sql = &quot;&nbsp;</div></li><li><div>                UPDATE&nbsp;</div></li><li><div>                    @wp_pod_fields&nbsp;</div></li><li><div>                SET&nbsp;</div></li><li><div>                    name = '$params-&gt;name', &nbsp;</div></li><li><div>                    label = '$params-&gt;label', &nbsp;</div></li><li><div>                    comment = '$params-&gt;comment', &nbsp;</div></li><li><div>                    coltype = '$params-&gt;coltype', &nbsp;</div></li><li><div>                    pickval = '$params-&gt;pickval', &nbsp;</div></li><li><div>                    display_helper = '$params-&gt;display_helper', &nbsp;</div></li><li><div>                    input_helper = '$params-&gt;input_helper', &nbsp;</div></li><li><div>                    pick_filter = '$params-&gt;pick_filter', &nbsp;</div></li><li><div>                    pick_orderby = '$params-&gt;pick_orderby', &nbsp;</div></li><li><div>                    sister_field_id = '$params-&gt;sister_field_id', &nbsp;</div></li><li><div>                    required = '$params-&gt;required', &nbsp;</div></li><li><div>                    `unique` = '$params-&gt;unique', &nbsp;</div></li><li><div>                    `multiple` = '$params-&gt;multiple'&nbsp;</div></li><li><div>                WHERE&nbsp;</div></li><li><div>                    id = $params-&gt;id&nbsp;</div></li><li><div>                LIMIT&nbsp;</div></li><li><div>                    1&nbsp;</div></li><li><div>                &quot;;&nbsp;</div></li><li><div>                pod_query($sql, 'Cannot edit column');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or edit a Pod Template&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The template ID&nbsp;</div></li><li><div>     * $params['name'] string The template name&nbsp;</div></li><li><div>     * $params['code'] string The template code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_template($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) str_replace('@wp_', '{prefix}', $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set defaults&nbsp;</div></li><li><div>        $params = (object) array_merge(array('id' =&gt; '', &nbsp;</div></li><li><div>                                             'name' =&gt; '', &nbsp;</div></li><li><div>                                             'code' =&gt; ''), &nbsp;</div></li><li><div>                                       (array) $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Force Types&nbsp;</div></li><li><div>        $params-&gt;id = absint($params-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add new template&nbsp;</div></li><li><div>        if (empty($params-&gt;id)) {&nbsp;</div></li><li><div>            if (empty($params-&gt;name)) {&nbsp;</div></li><li><div>                return $this-&gt;oh_snap('&lt;e&gt;Enter a template name');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql = &quot;SELECT id FROM @wp_pod_templates WHERE name = '$params-&gt;name' LIMIT 1&quot;;&nbsp;</div></li><li><div>            pod_query($sql, 'Cannot get Templates', 'Template by this name already exists');&nbsp;</div></li><li><div>            $template_id = pod_query(&quot;INSERT INTO @wp_pod_templates (name, code) VALUES ('$params-&gt;name', '$params-&gt;code')&quot;, 'Cannot add new template');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $template_id; // return&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Edit existing template&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $maybename = '';&nbsp;</div></li><li><div>            if (!empty($params-&gt;name))&nbsp;</div></li><li><div>                $maybename = &quot;name = '$params-&gt;name', &quot;;&nbsp;</div></li><li><div>            pod_query(&quot;UPDATE @wp_pod_templates SET $maybename code = '$params-&gt;code' WHERE id = $params-&gt;id LIMIT 1&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or edit a Pod Page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The page ID&nbsp;</div></li><li><div>     * $params['uri'] string The page URI&nbsp;</div></li><li><div>     * $params['title'] string The page title&nbsp;</div></li><li><div>     * $params['page_template'] string The page template&nbsp;</div></li><li><div>     * $params['phpcode'] string The page code&nbsp;</div></li><li><div>     * $params['precode'] string The page pre code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_page($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) str_replace('@wp_', '{prefix}', $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set defaults&nbsp;</div></li><li><div>        $params = (object) array_merge(array('id' =&gt; '', &nbsp;</div></li><li><div>                                             'uri' =&gt; '', &nbsp;</div></li><li><div>                                             'page_title' =&gt; '', &nbsp;</div></li><li><div>                                             'page_template' =&gt; '', &nbsp;</div></li><li><div>                                             'phpcode' =&gt; '', &nbsp;</div></li><li><div>                                             'precode' =&gt; ''), &nbsp;</div></li><li><div>                                       (array) $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Force Types&nbsp;</div></li><li><div>        $params-&gt;id = absint($params-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add new page&nbsp;</div></li><li><div>        if (empty($params-&gt;id)) {&nbsp;</div></li><li><div>            if (empty($params-&gt;uri)) {&nbsp;</div></li><li><div>                return $this-&gt;oh_snap('&lt;e&gt;Enter a page URI');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // normalize URI (remove outside /&nbsp;</div></li><li><div>            $params-&gt;uri = trim($params-&gt;uri, '/');&nbsp;</div></li><li><div>            $sql = &quot;SELECT id FROM @wp_pod_pages WHERE uri = '$params-&gt;uri' LIMIT 1&quot;;&nbsp;</div></li><li><div>            pod_query($sql, 'Cannot get Pod Pages', 'Page by this URI already exists');&nbsp;</div></li><li><div>            $page_id = pod_query(&quot;INSERT INTO @wp_pod_pages (uri, title, page_template, phpcode, precode) VALUES ('$params-&gt;uri', '$params-&gt;page_title', '$params-&gt;page_template', '$params-&gt;phpcode', '$params-&gt;precode')&quot;, 'Cannot add new page');&nbsp;</div></li><li><div>            return $page_id; // return&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Edit existing page&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $maybename = '';&nbsp;</div></li><li><div>            if (!empty($params-&gt;uri))&nbsp;</div></li><li><div>                $maybename = &quot;uri = '$params-&gt;uri', &quot;;&nbsp;</div></li><li><div>            pod_query(&quot;UPDATE @wp_pod_pages SET $maybename title = '$params-&gt;page_title', page_template = '$params-&gt;page_template', phpcode = '$params-&gt;phpcode', precode = '$params-&gt;precode' WHERE id = $params-&gt;id LIMIT 1&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or edit a Pod Helper&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The helper ID&nbsp;</div></li><li><div>     * $params['name'] string The helper name&nbsp;</div></li><li><div>     * $params['helper_type'] string The helper type (&quot;pre_save&quot;, &quot;display&quot;, etc)&nbsp;</div></li><li><div>     * $params['phpcode'] string The helper code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_helper($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) str_replace('@wp_', '{prefix}', $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set defaults&nbsp;</div></li><li><div>        $params = (object) array_merge(array('id' =&gt; '', &nbsp;</div></li><li><div>                                             'name' =&gt; '', &nbsp;</div></li><li><div>                                             //'helper_type' =&gt; 'display', &nbsp;</div></li><li><div>                                             'phpcode' =&gt; ''), &nbsp;</div></li><li><div>                                       (array) $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Force Types&nbsp;</div></li><li><div>        $params-&gt;id = absint($params-&gt;id);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add new helper&nbsp;</div></li><li><div>        if (empty($params-&gt;id)) {&nbsp;</div></li><li><div>            if (empty($params-&gt;name)) {&nbsp;</div></li><li><div>                return $this-&gt;oh_snap('&lt;e&gt;Enter a helper name');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (!isset($params-&gt;helper_type) || empty($params-&gt;helper_type))&nbsp;</div></li><li><div>                $params-&gt;helper_type = 'display';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql = &quot;SELECT id FROM @wp_pod_helpers WHERE name = '$params-&gt;name' LIMIT 1&quot;;&nbsp;</div></li><li><div>            pod_query($sql, 'Cannot get helpers', 'helper by this name already exists');&nbsp;</div></li><li><div>            $helper_id = pod_query(&quot;INSERT INTO @wp_pod_helpers (name, helper_type, phpcode) VALUES ('$params-&gt;name', '$params-&gt;helper_type', '$params-&gt;phpcode')&quot;, 'Cannot add new helper');&nbsp;</div></li><li><div>            return $helper_id; // return&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Edit existing helper&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $maybename = '';&nbsp;</div></li><li><div>            if (isset($params-&gt;name) && !empty($params-&gt;name))&nbsp;</div></li><li><div>                $maybename = &quot;name = '$params-&gt;name', &quot;;&nbsp;</div></li><li><div>            $maybetype = '';&nbsp;</div></li><li><div>            if (isset($params-&gt;helper_type) && !empty($params-&gt;helper_type))&nbsp;</div></li><li><div>                $maybetype = &quot;helper_type = '$params-&gt;helper_type', &quot;;&nbsp;</div></li><li><div>            pod_query(&quot;UPDATE @wp_pod_helpers SET {$maybename} {$maybetype} phpcode = '$params-&gt;phpcode' WHERE id = $params-&gt;id LIMIT 1&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Save the entire role structure&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_roles($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $roles = array();&nbsp;</div></li><li><div>        foreach ($params as $key =&gt; $val) {&nbsp;</div></li><li><div>            if ('action' != $key) {&nbsp;</div></li><li><div>                $tmp = empty($val) ? array() : explode(', ', $val);&nbsp;</div></li><li><div>                $roles[$key] = $tmp;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        delete_option('pods_roles');&nbsp;</div></li><li><div>        add_option('pods_roles', serialize($roles));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve an associative array of table values&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['table'] string The table name (default: &quot;types&quot;)&nbsp;</div></li><li><div>     * $params['columns'] string Comma-separated string of columns (default: &quot;*&quot;)&nbsp;</div></li><li><div>     * $params['orderby'] string MySQL ORDER BY clause (default: &quot;id ASC&quot;)&nbsp;</div></li><li><div>     * $params['where'] string MySQL WHERE clause (default: 1)&nbsp;</div></li><li><div>     * $params['array_key'] string The key column for the returned associative array (default: &quot;id&quot;)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @return array The table data array&nbsp;</div></li><li><div>     * @since 1.8.5&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_table_data($params) {&nbsp;</div></li><li><div>        $params = is_array($params) ? $params : array();&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>            'table' =&gt; 'types', &nbsp;</div></li><li><div>            'columns' =&gt; '*', &nbsp;</div></li><li><div>            'orderby' =&gt; 'id ASC', &nbsp;</div></li><li><div>            'where' =&gt; 1, &nbsp;</div></li><li><div>            'array_key' =&gt; 'id'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $params = (object) array_merge($defaults, $params);&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT $params-&gt;columns FROM @wp_pod_$params-&gt;table WHERE $params-&gt;where ORDER BY $params-&gt;orderby&quot;);&nbsp;</div></li><li><div>        if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>            while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                $data[$row[$params-&gt;array_key]] = $row;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add or edit a single pod item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['datatype'] string The datatype name&nbsp;</div></li><li><div>     * $params['columns'] array (optional) Associative array of column names + values&nbsp;</div></li><li><div>     * $params['data'] array (optional) Associative array of a set of associative arrays of column names + values (for bulk operations)&nbsp;</div></li><li><div>     * $params['pod_id'] int The item's ID from the wp_pod table (or alternatively use the tbl_row_id parameter instead)&nbsp;</div></li><li><div>     * $params['tbl_row_id'] int The item's ID from the wp_pod_tbl_* table (or alternatively use the pod_id parameter instead)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @return int The table row ID&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_pod_item($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) str_replace('@wp_', '{prefix}', $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Support for multiple save_pod_item operations at the same time&nbsp;</div></li><li><div>        if (isset($params-&gt;data) && !empty($params-&gt;data) && is_array($params-&gt;data)) {&nbsp;</div></li><li><div>            $ids = array();&nbsp;</div></li><li><div>            $new_params = $params;&nbsp;</div></li><li><div>            unset($new_params-&gt;data);&nbsp;</div></li><li><div>            foreach ($params-&gt;data as $columns) {&nbsp;</div></li><li><div>                $new_params-&gt;columns = $columns;&nbsp;</div></li><li><div>                $ids[] = $this-&gt;save_pod_item($new_params);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $ids;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Support for bulk edit&nbsp;</div></li><li><div>        if (isset($params-&gt;tbl_row_id) && !empty($params-&gt;tbl_row_id) && is_array($params-&gt;tbl_row_id)) {&nbsp;</div></li><li><div>            $ids = array();&nbsp;</div></li><li><div>            $new_params = $params;&nbsp;</div></li><li><div>            foreach ($params-&gt;tbl_row_id as $tbl_row_id) {&nbsp;</div></li><li><div>                $new_params-&gt;tbl_row_id = $tbl_row_id;&nbsp;</div></li><li><div>                $ids[] = $this-&gt;save_pod_item($new_params);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $ids;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow Helpers to bypass subsequent helpers in recursive save_pod_item calls&nbsp;</div></li><li><div>        $bypass_helpers = false;&nbsp;</div></li><li><div>        if (isset($params-&gt;bypass_helpers) && true === (boolean) $params-&gt;bypass_helpers) {&nbsp;</div></li><li><div>            $bypass_helpers = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get array of datatypes&nbsp;</div></li><li><div>        $datatypes = $this-&gt;get_table_data(array('array_key' =&gt; 'name', 'columns' =&gt; 'id, name'));&nbsp;</div></li><li><div>        $params-&gt;datatype_id = (int) $datatypes[$params-&gt;datatype]['id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the datatype fields&nbsp;</div></li><li><div>        $opts = array('table' =&gt; 'fields', 'where' =&gt; &quot;datatype = {$params-&gt;datatype_id}&quot;, 'orderby' =&gt; 'weight', 'array_key' =&gt; 'name');&nbsp;</div></li><li><div>        $columns = $this-&gt;get_table_data($opts);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Find the active columns (loop through $params-&gt;columns to retain order)&nbsp;</div></li><li><div>        if (!empty($params-&gt;columns) && is_array($params-&gt;columns)) {&nbsp;</div></li><li><div>            foreach ($params-&gt;columns as $column_name =&gt; $column_val) {&nbsp;</div></li><li><div>                // Support for Pre Key/Value Parameters in previous Pods versions&nbsp;</div></li><li><div>                if (isset($params-&gt;name)&&isset($params-&gt;$column_val)) {&nbsp;</div></li><li><div>                    $column_name = $column_val;&nbsp;</div></li><li><div>                    $column_val = $params-&gt;$column_name;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($columns[$column_name])) {&nbsp;</div></li><li><div>                    $columns[$column_name]['value'] = $column_val;&nbsp;</div></li><li><div>                    $active_columns[] = $column_name;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            unset($params-&gt;columns);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Load all helpers&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT pre_save_helpers, post_save_helpers FROM @wp_pod_types WHERE id = {$params-&gt;datatype_id}&quot;);&nbsp;</div></li><li><div>        $row = pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>        $params-&gt;pre_save_helpers = explode(', ', $row['pre_save_helpers']);&nbsp;</div></li><li><div>        $params-&gt;post_save_helpers = explode(', ', $row['post_save_helpers']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Allow Helpers to know what's going on, are we adding or saving?&nbsp;</div></li><li><div>        $is_new_item = false;&nbsp;</div></li><li><div>        if (!empty($params-&gt;tbl_row_id)) {&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT p.id FROM @wp_pod p INNER JOIN @wp_pod_types t ON t.id = p.datatype WHERE p.tbl_row_id = $params-&gt;tbl_row_id AND t.name = '$params-&gt;datatype' LIMIT 1&quot;, 'Pod item not found', null, 'Pod item not found');&nbsp;</div></li><li><div>            $params-&gt;pod_id = pods_mysql_result($result, 0);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif (!empty($params-&gt;pod_id)) {&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT tbl_row_id FROM @wp_pod WHERE id = $params-&gt;pod_id LIMIT 1&quot;, 'Item not found', null, 'Item not found');&nbsp;</div></li><li><div>            $params-&gt;tbl_row_id = pods_mysql_result($result, 0);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>            $is_new_item = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Plugin hook&nbsp;</div></li><li><div>        do_action('pods_pre_save_pod_item', $params, $columns);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Call any pre-save helpers (if not bypassed)&nbsp;</div></li><li><div>        if(!$bypass_helpers && !empty($params-&gt;pre_save_helpers)) {&nbsp;</div></li><li><div>            foreach ($params-&gt;pre_save_helpers as $helper) {&nbsp;</div></li><li><div>                $function_or_file = $helper;&nbsp;</div></li><li><div>                $check_function = $function_or_file;&nbsp;</div></li><li><div>                if ((!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE) && (!defined('PODS_HELPER_FUNCTIONS') || !PODS_HELPER_FUNCTIONS))&nbsp;</div></li><li><div>                    $check_function = false;&nbsp;</div></li><li><div>                $check_file = null;&nbsp;</div></li><li><div>                if ((!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE) && (!defined('PODS_HELPER_FILES') || !PODS_HELPER_FILES))&nbsp;</div></li><li><div>                    $check_file = false;&nbsp;</div></li><li><div>                if (false !== $check_function && false !== $check_file)&nbsp;</div></li><li><div>                    $function_or_file = pods_function_or_file($function_or_file, $check_function, 'helper', $check_file);&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $function_or_file = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $content = false;&nbsp;</div></li><li><div>                if (!$function_or_file) {&nbsp;</div></li><li><div>                    $api = new PodAPI();&nbsp;</div></li><li><div>                    $params_helper = array('name' =&gt; $helper, 'type' =&gt; 'pre_save');&nbsp;</div></li><li><div>                    if (!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE)&nbsp;</div></li><li><div>                        $params_helper = pods_sanitize($params_helper);&nbsp;</div></li><li><div>                    $content = $api-&gt;load_helper($params_helper);&nbsp;</div></li><li><div>                    if (false !== $content && 0 &lt; strlen(trim($content['phpcode'])))&nbsp;</div></li><li><div>                        $content = $content['phpcode'];&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $content = false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (false === $content && false !== $function_or_file && isset($function_or_file['function']))&nbsp;</div></li><li><div>                    $function_or_file['function']($params, $columns, $this);&nbsp;</div></li><li><div>                elseif (false === $content && false !== $function_or_file && isset($function_or_file['file']))&nbsp;</div></li><li><div>                    locate_template($function_or_file['file'], true, true);&nbsp;</div></li><li><div>                elseif (false !== $content) {&nbsp;</div></li><li><div>                    if (!defined('PODS_DISABLE_EVAL') || PODS_DISABLE_EVAL)&nbsp;</div></li><li><div>                        eval(&quot;?&gt;$content&quot;);&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        echo $content;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Loop through each active column, validating and preparing the table data&nbsp;</div></li><li><div>        foreach ($active_columns as $key) {&nbsp;</div></li><li><div>            $val = $columns[$key]['value'];&nbsp;</div></li><li><div>            $type = $columns[$key]['coltype'];&nbsp;</div></li><li><div>            $label = $columns[$key]['label'];&nbsp;</div></li><li><div>            $label = empty($label) ? $key : $label;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Verify required fields&nbsp;</div></li><li><div>            if (1 == $columns[$key]['required']) {&nbsp;</div></li><li><div>                if ('' == $val || null == $val) {&nbsp;</div></li><li><div>                    return $this-&gt;oh_snap(&quot;&lt;e&gt;$label is empty.&quot;);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ('num' == $type && !is_numeric($val)) {&nbsp;</div></li><li><div>                    return $this-&gt;oh_snap(&quot;&lt;e&gt;$label is not numeric.&quot;);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Verify unique fields&nbsp;</div></li><li><div>            if (1 == $columns[$key]['unique'] && !in_array($type, array('pick', 'file'))) {&nbsp;</div></li><li><div>                $exclude = '';&nbsp;</div></li><li><div>                if (!empty($params-&gt;pod_id)) {&nbsp;</div></li><li><div>                    $result = pod_query(&quot;SELECT tbl_row_id FROM @wp_pod WHERE id = '$params-&gt;pod_id' AND datatype = '{$params-&gt;datatype_id}' LIMIT 1&quot;);&nbsp;</div></li><li><div>                    if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                        $exclude = 'AND id != ' . pods_mysql_result($result, 0);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Trigger an error if not unique&nbsp;</div></li><li><div>                $sql = &quot;SELECT id FROM `@wp_pod_tbl_$params-&gt;datatype` WHERE `$key` = '$val' $exclude LIMIT 1&quot;;&nbsp;</div></li><li><div>                pod_query($sql, 'Not unique', &quot;$label needs to be unique.&quot;);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Verify slug columns&nbsp;</div></li><li><div>            if ('slug' == $type) {&nbsp;</div></li><li><div>                $slug_val = empty($val) ? $columns['name']['value'] : $val;&nbsp;</div></li><li><div>                $val = pods_unique_slug($slug_val, $key, $params);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Prepare all table (non-relational) data&nbsp;</div></li><li><div>            if (!in_array($type, array('pick', 'file'))) {&nbsp;</div></li><li><div>                if ('num' == $type)&nbsp;</div></li><li><div>                    $val = floatval($val);&nbsp;</div></li><li><div>                elseif ('bool' == $type)&nbsp;</div></li><li><div>                    $val = min(absint($val), 1);&nbsp;</div></li><li><div>                if ('num' != $type)&nbsp;</div></li><li><div>                    $val = &quot;'$val'&quot;;&nbsp;</div></li><li><div>                $table_data[] = &quot;`$key` = $val&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Store relational column data to be looped through later&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $rel_columns[$type][$key] = $val;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Create the pod_id if it doesn't exist&nbsp;</div></li><li><div>        if (empty($params-&gt;pod_id)&&empty($params-&gt;tbl_row_id)) {&nbsp;</div></li><li><div>            $current_time = current_time('mysql');&nbsp;</div></li><li><div>            $user = 0;&nbsp;</div></li><li><div>            if (is_user_logged_in()) {&nbsp;</div></li><li><div>                global $user_ID;&nbsp;</div></li><li><div>                get_currentuserinfo();&nbsp;</div></li><li><div>                $user = $user_ID;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $name = $params-&gt;datatype;&nbsp;</div></li><li><div>            if (isset($params-&gt;name))&nbsp;</div></li><li><div>                $name = $params-&gt;name;&nbsp;</div></li><li><div>            if (isset($params-&gt;columns) && is_array($params-&gt;columns) && isset($params-&gt;columns['name']))&nbsp;</div></li><li><div>                $name = $params-&gt;columns['name'];&nbsp;</div></li><li><div>            $sql = &quot;INSERT INTO @wp_pod (datatype, name, created, modified, author_id) VALUES ('{$params-&gt;datatype_id}', '$name', '$current_time', '$current_time', '$user')&quot;;&nbsp;</div></li><li><div>            $params-&gt;pod_id = pod_query($sql, 'Cannot add new content');&nbsp;</div></li><li><div>            $params-&gt;tbl_row_id = pod_query(&quot;INSERT INTO `@wp_pod_tbl_$params-&gt;datatype` (name) VALUES (NULL)&quot;, 'Cannot add new table row');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save the table row&nbsp;</div></li><li><div>        if (isset($table_data)) {&nbsp;</div></li><li><div>            $table_data = implode(', ', $table_data);&nbsp;</div></li><li><div>            pod_query(&quot;UPDATE `@wp_pod_tbl_$params-&gt;datatype` SET $table_data WHERE id = $params-&gt;tbl_row_id LIMIT 1&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update wp_pod&nbsp;</div></li><li><div>        $item_name = isset($columns['name']['value']) ? &quot;, name = '&quot; . $columns['name']['value'] . &quot;'&quot; : '';&nbsp;</div></li><li><div>        pod_query(&quot;UPDATE @wp_pod SET tbl_row_id = $params-&gt;tbl_row_id, datatype = $params-&gt;datatype_id, modified = '&quot; . current_time('mysql') . &quot;' $item_name WHERE id = $params-&gt;pod_id LIMIT 1&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save relational column data&nbsp;</div></li><li><div>        if (isset($rel_columns)) {&nbsp;</div></li><li><div>            // E.g. $rel_columns['pick']['related_events'] = '3, 15';&nbsp;</div></li><li><div>            foreach ($rel_columns as $rel_type =&gt; $rel_data) {&nbsp;</div></li><li><div>                foreach ($rel_data as $rel_name =&gt; $rel_values) {&nbsp;</div></li><li><div>                    $field_id = $columns[$rel_name]['id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Convert values from a comma-separated string into an array&nbsp;</div></li><li><div>                    if (empty($rel_values))&nbsp;</div></li><li><div>                        $rel_values = array();&nbsp;</div></li><li><div>                    elseif (!is_array($rel_values))&nbsp;</div></li><li><div>                        $rel_values = explode(', ', $rel_values);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Remove existing relationships&nbsp;</div></li><li><div>                    pod_query(&quot;DELETE FROM @wp_pod_rel WHERE pod_id = $params-&gt;pod_id AND field_id = $field_id&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // File relationships&nbsp;</div></li><li><div>                    if ('file' == $rel_type) {&nbsp;</div></li><li><div>                        $rel_weight = 0;&nbsp;</div></li><li><div>                        foreach ($rel_values as $related_id) {&nbsp;</div></li><li><div>                            $related_id = absint($related_id);&nbsp;</div></li><li><div>                            if (empty($related_id))&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            pod_query(&quot;INSERT INTO @wp_pod_rel (pod_id, field_id, tbl_row_id, weight) VALUES ($params-&gt;pod_id, $field_id, $related_id, $rel_weight)&quot;);&nbsp;</div></li><li><div>                            $rel_weight++;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // Pick relationships&nbsp;</div></li><li><div>                    elseif ('pick' == $rel_type) {&nbsp;</div></li><li><div>                        $pickval = $columns[$rel_name]['pickval'];&nbsp;</div></li><li><div>                        $sister_datatype_id = 0;&nbsp;</div></li><li><div>                        $sister_field_id = 0;&nbsp;</div></li><li><div>                        if (!in_array($pickval, array('wp_taxonomy', 'wp_post', 'wp_page', 'wp_user')) && isset($datatypes[$pickval])) {&nbsp;</div></li><li><div>                            $sister_datatype_id = $datatypes[$pickval]['id'];&nbsp;</div></li><li><div>                            if (!empty($columns[$rel_name]['sister_field_id']))&nbsp;</div></li><li><div>                                $sister_field_id = $columns[$rel_name]['sister_field_id'];&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $sister_pod_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Delete parent and sister rels&nbsp;</div></li><li><div>                        if (!empty($sister_field_id)) {&nbsp;</div></li><li><div>                            // Get sister pod IDs (a sister pod's sister pod is the parent pod)&nbsp;</div></li><li><div>                            $result = pod_query(&quot;SELECT pod_id FROM @wp_pod_rel WHERE sister_pod_id = $params-&gt;pod_id&quot;);&nbsp;</div></li><li><div>                            if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                                while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                                    $sister_pod_ids[] = $row['pod_id'];&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                                $sister_pod_ids = implode(', ', $sister_pod_ids);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                // Delete the sister pod relationship&nbsp;</div></li><li><div>                                pod_query(&quot;DELETE FROM @wp_pod_rel WHERE pod_id IN ($sister_pod_ids) AND sister_pod_id = $params-&gt;pod_id AND field_id = $sister_field_id&quot;);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Add rel values&nbsp;</div></li><li><div>                        $rel_weight = 0;&nbsp;</div></li><li><div>                        foreach ($rel_values as $related_id) {&nbsp;</div></li><li><div>                            $related_id = absint($related_id);&nbsp;</div></li><li><div>                            if (empty($related_id))&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            $sister_pod_id = 0;&nbsp;</div></li><li><div>                            if (!empty($sister_field_id) && !empty($sister_datatype_id)) {&nbsp;</div></li><li><div>                                $result = pod_query(&quot;SELECT id FROM @wp_pod WHERE datatype = $sister_datatype_id AND tbl_row_id = $related_id LIMIT 1&quot;);&nbsp;</div></li><li><div>                                if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                                    $sister_pod_id = pods_mysql_result($result, 0);&nbsp;</div></li><li><div>                                    pod_query(&quot;INSERT INTO @wp_pod_rel (pod_id, sister_pod_id, field_id, tbl_row_id, weight) VALUES ($sister_pod_id, $params-&gt;pod_id, $sister_field_id, $params-&gt;tbl_row_id, $rel_weight)&quot;, 'Cannot add sister relationships');&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            pod_query(&quot;INSERT INTO @wp_pod_rel (pod_id, sister_pod_id, field_id, tbl_row_id, weight) VALUES ($params-&gt;pod_id, $sister_pod_id, $field_id, $related_id, $rel_weight)&quot;, 'Cannot add relationships');&nbsp;</div></li><li><div>                            $rel_weight++;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Plugin hook&nbsp;</div></li><li><div>        do_action('pods_post_save_pod_item', $params, $columns);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Call any post-save helpers (if not bypassed)&nbsp;</div></li><li><div>        if(!$bypass_helpers && !empty($params-&gt;post_save_helpers)) {&nbsp;</div></li><li><div>            foreach ($params-&gt;post_save_helpers as $helper) {&nbsp;</div></li><li><div>                $function_or_file = $helper;&nbsp;</div></li><li><div>                $check_function = $function_or_file;&nbsp;</div></li><li><div>                if ((!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE) && (!defined('PODS_HELPER_FUNCTIONS') || !PODS_HELPER_FUNCTIONS))&nbsp;</div></li><li><div>                    $check_function = false;&nbsp;</div></li><li><div>                $check_file = null;&nbsp;</div></li><li><div>                if ((!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE) && (!defined('PODS_HELPER_FILES') || !PODS_HELPER_FILES))&nbsp;</div></li><li><div>                    $check_file = false;&nbsp;</div></li><li><div>                if (false !== $check_function && false !== $check_file)&nbsp;</div></li><li><div>                    $function_or_file = pods_function_or_file($function_or_file, $check_function, 'helper', $check_file);&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $function_or_file = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $content = false;&nbsp;</div></li><li><div>                if (!$function_or_file) {&nbsp;</div></li><li><div>                    $api = new PodAPI();&nbsp;</div></li><li><div>                    $params_helper = array('name' =&gt; $helper, 'type' =&gt; 'post_save');&nbsp;</div></li><li><div>                    if (!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE)&nbsp;</div></li><li><div>                        $params_helper = pods_sanitize($params_helper);&nbsp;</div></li><li><div>                    $content = $api-&gt;load_helper($params_helper);&nbsp;</div></li><li><div>                    if (false !== $content && 0 &lt; strlen(trim($content['phpcode'])))&nbsp;</div></li><li><div>                        $content = $content['phpcode'];&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $content = false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (false === $content && false !== $function_or_file && isset($function_or_file['function']))&nbsp;</div></li><li><div>                    $function_or_file['function']($params, $columns, $this);&nbsp;</div></li><li><div>                elseif (false === $content && false !== $function_or_file && isset($function_or_file['file']))&nbsp;</div></li><li><div>                    locate_template($function_or_file['file'], true, true);&nbsp;</div></li><li><div>                elseif (false !== $content) {&nbsp;</div></li><li><div>                    if (!defined('PODS_DISABLE_EVAL') || PODS_DISABLE_EVAL)&nbsp;</div></li><li><div>                        eval(&quot;?&gt;$content&quot;);&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        echo $content;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Success! Return the id&nbsp;</div></li><li><div>        if (false===$this-&gt;use_pod_id) {&nbsp;</div></li><li><div>            return $params-&gt;tbl_row_id;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $params-&gt;pod_id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Duplicate a pod item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['datatype'] string The datatype name&nbsp;</div></li><li><div>     * $params['tbl_row_id'] int The item's ID from the wp_pod_tbl_* table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @return int The table row ID&nbsp;</div></li><li><div>     * @since 1.12&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function duplicate_pod_item($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $id = false;&nbsp;</div></li><li><div>        $columns = $this-&gt;fields;&nbsp;</div></li><li><div>        if (empty($columns) || $this-&gt;dtname != $params-&gt;datatype) {&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod(array('name' =&gt; $params-&gt;datatype));&nbsp;</div></li><li><div>            $columns = $pod['fields'];&nbsp;</div></li><li><div>            if (null === $this-&gt;dtname) {&nbsp;</div></li><li><div>                $this-&gt;dtname = $pod['name'];&nbsp;</div></li><li><div>                $this-&gt;dt = $pod['id'];&nbsp;</div></li><li><div>                $this-&gt;fields = $pod['fields'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $pod = new Pod($params-&gt;datatype, $params-&gt;tbl_row_id);&nbsp;</div></li><li><div>        if (!empty($pod-&gt;data)) {&nbsp;</div></li><li><div>            $params = array('datatype' =&gt; $params-&gt;datatype, &nbsp;</div></li><li><div>                            'columns' =&gt; array());&nbsp;</div></li><li><div>            foreach ($columns as $column) {&nbsp;</div></li><li><div>                $field = $column['name'];&nbsp;</div></li><li><div>                if ('pick' == $column['coltype']) {&nbsp;</div></li><li><div>                    $field = $column . '.id';&nbsp;</div></li><li><div>                    if ('wp_taxonomy' == $column['pickval'])&nbsp;</div></li><li><div>                        $field = $column . '.term_id';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ('file' == $column['coltype'])&nbsp;</div></li><li><div>                    $field = $column . '.ID';&nbsp;</div></li><li><div>                $value = $pod-&gt;get_field($field);&nbsp;</div></li><li><div>                if (0 &lt; strlen($value))&nbsp;</div></li><li><div>                    $params['columns'][$column['name']] = $value;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $params = apply_filters('duplicate_pod_item', $params, $pod-&gt;datatype, $pod-&gt;get_field('id'));&nbsp;</div></li><li><div>            $id = $this-&gt;save_pod_item(pods_sanitize($params));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $id;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Export a pod item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['datatype'] string The datatype name&nbsp;</div></li><li><div>     * $params['tbl_row_id'] int The item's ID from the wp_pod_tbl_* table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @return int The table row ID&nbsp;</div></li><li><div>     * @since 1.12&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function export_pod_item($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = false;&nbsp;</div></li><li><div>        $columns = $this-&gt;fields;&nbsp;</div></li><li><div>        if (empty($columns) || $this-&gt;dtname != $params-&gt;datatype) {&nbsp;</div></li><li><div>            $pod = $this-&gt;load_pod(array('name' =&gt; $params-&gt;datatype));&nbsp;</div></li><li><div>            $columns = $pod['fields'];&nbsp;</div></li><li><div>            if (null === $this-&gt;dtname) {&nbsp;</div></li><li><div>                $this-&gt;dtname = $pod['name'];&nbsp;</div></li><li><div>                $this-&gt;dt = $pod['id'];&nbsp;</div></li><li><div>                $this-&gt;fields = $pod['fields'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $pod = new Pod($params-&gt;datatype, $params-&gt;tbl_row_id);&nbsp;</div></li><li><div>        if (!empty($pod-&gt;data)) {&nbsp;</div></li><li><div>            $data = array();&nbsp;</div></li><li><div>            foreach ($columns as $column) {&nbsp;</div></li><li><div>                $value = $pod-&gt;get_field($column['name']);&nbsp;</div></li><li><div>                if (0 &lt; strlen($value))&nbsp;</div></li><li><div>                    $data[$column['name']] = $value;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $data = apply_filters('export_pod_item', $data, $pod-&gt;datatype, $pod-&gt;get_field('id'));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Reorder a Pod&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['datatype'] string The datatype name&nbsp;</div></li><li><div>     * $params['field'] string The column name of the field to reorder&nbsp;</div></li><li><div>     * $params['order'] array The key=&gt;value array of items to reorder (key should be an integer)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function reorder_pod_item($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!is_array($params-&gt;order)) {&nbsp;</div></li><li><div>            $params-&gt;order = explode(', ', $params-&gt;order);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        foreach ($params-&gt;order as $order =&gt; $id) {&nbsp;</div></li><li><div>            pod_query(&quot;UPDATE @wp_pod_tbl_{$params-&gt;datatype} SET `{$params-&gt;field}`={$order} WHERE id={$id}&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete all content for a content type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The datatype ID&nbsp;</div></li><li><div>     * $params['name'] string The datatype name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function reset_pod($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod($params);&nbsp;</div></li><li><div>        if (false === $pod)&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;id = $pod['id'];&nbsp;</div></li><li><div>        $params-&gt;name = $pod['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = array();&nbsp;</div></li><li><div>        foreach ($pod['fields'] as $field) {&nbsp;</div></li><li><div>            $fields[] = $field['id'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $fields = implode(', ', $fields);&nbsp;</div></li><li><div>        if (!empty($fields))&nbsp;</div></li><li><div>            pod_query(&quot;UPDATE @wp_pod_fields SET sister_field_id = NULL WHERE sister_field_id IN ($fields)&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;DELETE FROM p, r&nbsp;</div></li><li><div>        USING @wp_pod_types AS t&nbsp;</div></li><li><div>        LEFT JOIN @wp_pod AS p ON p.datatype = t.id&nbsp;</div></li><li><div>        LEFT JOIN @wp_pod_fields AS f ON f.datatype = t.id&nbsp;</div></li><li><div>        LEFT JOIN @wp_pod_rel AS r ON r.field_id = f.id&nbsp;</div></li><li><div>        WHERE t.name = '$params-&gt;name'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pod_query($sql);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;DELETE FROM r&nbsp;</div></li><li><div>        USING @wp_pod_fields AS f&nbsp;</div></li><li><div>        INNER JOIN @wp_pod_rel AS r ON r.field_id = f.id&nbsp;</div></li><li><div>        WHERE f.pickval = '$params-&gt;name'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pod_query($sql);&nbsp;</div></li><li><div>        pod_query(&quot;TRUNCATE `@wp_pod_tbl_$params-&gt;name`&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a content type and all its content&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The datatype ID&nbsp;</div></li><li><div>     * $params['name'] string The datatype name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function drop_pod($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod = $this-&gt;load_pod($params);&nbsp;</div></li><li><div>        if (false === $pod)&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;id = $pod['id'];&nbsp;</div></li><li><div>        $params-&gt;name = $pod['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM @wp_pod_types WHERE id = $params-&gt;id LIMIT 1&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $fields = array();&nbsp;</div></li><li><div>        foreach ($pod['fields'] as $field) {&nbsp;</div></li><li><div>            $fields[] = $field['id'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $fields = implode(', ', $fields);&nbsp;</div></li><li><div>        if (!empty($fields))&nbsp;</div></li><li><div>            pod_query(&quot;UPDATE @wp_pod_fields SET sister_field_id = NULL WHERE sister_field_id IN ($fields)&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sql = &quot;DELETE FROM @wp_pod, @wp_pod_rel&nbsp;</div></li><li><div>        USING @wp_pod_fields&nbsp;</div></li><li><div>        INNER JOIN @wp_pod_rel ON @wp_pod_rel.field_id = @wp_pod_fields.id&nbsp;</div></li><li><div>        INNER JOIN @wp_pod ON @wp_pod.datatype = @wp_pod_fields.datatype&nbsp;</div></li><li><div>        WHERE @wp_pod_fields.datatype = $params-&gt;id&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pod_query($sql);&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM @wp_pod_fields WHERE datatype = $params-&gt;id&quot;);&nbsp;</div></li><li><div>        pod_query(&quot;DROP TABLE `@wp_pod_tbl_$params-&gt;name`&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a column within a content type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The column ID&nbsp;</div></li><li><div>     * $params['dtname'] string The datatype name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function drop_column($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT name, coltype FROM @wp_pod_fields WHERE id = $params-&gt;id LIMIT 1&quot;);&nbsp;</div></li><li><div>        list($field_name, $coltype) = pods_mysql_fetch_array($result);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ('pick' == $coltype) {&nbsp;</div></li><li><div>            // Remove any orphans&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT id FROM @wp_pod_fields WHERE sister_field_id = $params-&gt;id&quot;);&nbsp;</div></li><li><div>            if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                    $related_fields[] = $row['id'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $related_fields = implode(', ', $related_fields);&nbsp;</div></li><li><div>                pod_query(&quot;DELETE FROM @wp_pod_rel WHERE field_id IN ($related_fields)&quot;);&nbsp;</div></li><li><div>                pod_query(&quot;UPDATE @wp_pod_fields SET sister_field_id = NULL WHERE sister_field_id IN ($related_fields)&quot;);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ('file' != $coltype) {&nbsp;</div></li><li><div>            pod_query(&quot;ALTER TABLE `@wp_pod_tbl_$params-&gt;dtname` DROP COLUMN `$field_name`&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM @wp_pod_fields WHERE id = $params-&gt;id LIMIT 1&quot;);&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM @wp_pod_rel WHERE field_id = $params-&gt;id&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a Pod Template&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The template ID&nbsp;</div></li><li><div>     * $params['name'] string The template name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function drop_template($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $where = empty($params-&gt;id) ? &quot;name = '$params-&gt;name'&quot; : &quot;id = $params-&gt;id&quot;;&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM @wp_pod_templates WHERE $where LIMIT 1&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a Pod Page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The page ID&nbsp;</div></li><li><div>     * $params['uri'] string The page URI&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function drop_page($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $where = empty($params-&gt;id) ? &quot;uri = '$params-&gt;uri'&quot; : &quot;id = $params-&gt;id&quot;;&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM @wp_pod_pages WHERE $where LIMIT 1&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a Pod Helper&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The helper ID&nbsp;</div></li><li><div>     * $params['name'] string The helper name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function drop_helper($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        $where = empty($params-&gt;id) ? &quot;name = '$params-&gt;name'&quot; : &quot;id = $params-&gt;id&quot;;&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM @wp_pod_helpers WHERE $where LIMIT 1&quot;);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Drop a single pod item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod_id'] int The item's ID from the wp_pod table&nbsp;</div></li><li><div>     * $params['tbl_row_id'] int (optional) The item's ID from the wp_pod_tbl_* table (used with datatype parameter)&nbsp;</div></li><li><div>     * $params['datatype'] string (optional) The datatype name (used with tbl_row_id parameter)&nbsp;</div></li><li><div>     * $params['datatype_id'] int (optional) The datatype ID (used with tbl_row_id parameter)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function drop_pod_item($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($params-&gt;tbl_row_id)) {&nbsp;</div></li><li><div>            if (!empty($params-&gt;tbl_row_id) && is_array($params-&gt;tbl_row_id)) {&nbsp;</div></li><li><div>                $new_params = $params;&nbsp;</div></li><li><div>                foreach ($params-&gt;tbl_row_id as $tbl_row_id) {&nbsp;</div></li><li><div>                    $new_params-&gt;tbl_row_id = $tbl_row_id;&nbsp;</div></li><li><div>                    $this-&gt;drop_pod_item($new_params);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                return;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (isset($params-&gt;datatype_id)) {&nbsp;</div></li><li><div>                $select_dt = &quot;p.datatype = '$params-&gt;datatype_id'&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $select_dt = &quot;t.name = '$params-&gt;datatype'&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $sql = &quot;&nbsp;</div></li><li><div>            SELECT&nbsp;</div></li><li><div>                p.id AS pod_id, p.tbl_row_id, t.id, t.name&nbsp;</div></li><li><div>            FROM&nbsp;</div></li><li><div>                @wp_pod p&nbsp;</div></li><li><div>            INNER JOIN&nbsp;</div></li><li><div>                @wp_pod_types t ON t.id = p.datatype&nbsp;</div></li><li><div>            WHERE&nbsp;</div></li><li><div>                p.tbl_row_id = $params-&gt;tbl_row_id AND&nbsp;</div></li><li><div>                $select_dt&nbsp;</div></li><li><div>            LIMIT&nbsp;</div></li><li><div>                1&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $sql = &quot;&nbsp;</div></li><li><div>            SELECT&nbsp;</div></li><li><div>                p.id AS pod_id, p.tbl_row_id, t.id, t.name&nbsp;</div></li><li><div>            FROM&nbsp;</div></li><li><div>                @wp_pod p&nbsp;</div></li><li><div>            INNER JOIN&nbsp;</div></li><li><div>                @wp_pod_types t ON t.id = p.datatype&nbsp;</div></li><li><div>            WHERE&nbsp;</div></li><li><div>                p.id = $params-&gt;pod_id&nbsp;</div></li><li><div>            LIMIT&nbsp;</div></li><li><div>                1&nbsp;</div></li><li><div>            &quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $result = pod_query($sql);&nbsp;</div></li><li><div>        $row = pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>        $params-&gt;datatype_id = $row['id'];&nbsp;</div></li><li><div>        $params-&gt;datatype = $row['name'];&nbsp;</div></li><li><div>        $params-&gt;pod_id = $row['pod_id'];&nbsp;</div></li><li><div>        $params-&gt;tbl_row_id = $row['tbl_row_id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get helper code&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT pre_drop_helpers, post_drop_helpers FROM @wp_pod_types WHERE id = $params-&gt;datatype_id&quot;);&nbsp;</div></li><li><div>        $row = pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>        $params-&gt;pre_drop_helpers = explode(', ', $row['pre_drop_helpers']);&nbsp;</div></li><li><div>        $params-&gt;post_drop_helpers = explode(', ', $row['post_drop_helpers']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Plugin hook&nbsp;</div></li><li><div>        do_action('pods_pre_drop_pod_item', $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Pre-drop helpers&nbsp;</div></li><li><div>        if (0 &lt; count($params-&gt;pre_drop_helpers)) {&nbsp;</div></li><li><div>            foreach ($params-&gt;pre_drop_helpers as $helper) {&nbsp;</div></li><li><div>                $function_or_file = $helper;&nbsp;</div></li><li><div>                $check_function = $function_or_file;&nbsp;</div></li><li><div>                if ((!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE) && (!defined('PODS_HELPER_FUNCTIONS') || !PODS_HELPER_FUNCTIONS))&nbsp;</div></li><li><div>                    $check_function = false;&nbsp;</div></li><li><div>                $check_file = null;&nbsp;</div></li><li><div>                if ((!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE) && (!defined('PODS_HELPER_FILES') || !PODS_HELPER_FILES))&nbsp;</div></li><li><div>                    $check_file = false;&nbsp;</div></li><li><div>                if (false !== $check_function && false !== $check_file)&nbsp;</div></li><li><div>                    $function_or_file = pods_function_or_file($function_or_file, $check_function, 'helper', $check_file);&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $function_or_file = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $content = false;&nbsp;</div></li><li><div>                if (!$function_or_file) {&nbsp;</div></li><li><div>                    $api = new PodAPI();&nbsp;</div></li><li><div>                    $params_helper = array('name' =&gt; $helper, 'type' =&gt; 'pre_drop');&nbsp;</div></li><li><div>                    if (!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE)&nbsp;</div></li><li><div>                        $params_helper = pods_sanitize($params_helper);&nbsp;</div></li><li><div>                    $content = $api-&gt;load_helper($params_helper);&nbsp;</div></li><li><div>                    if (false !== $content && 0 &lt; strlen(trim($content['phpcode'])))&nbsp;</div></li><li><div>                        $content = $content['phpcode'];&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $content = false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (false === $content && false !== $function_or_file && isset($function_or_file['function']))&nbsp;</div></li><li><div>                    $function_or_file['function']($params, $this);&nbsp;</div></li><li><div>                elseif (false === $content && false !== $function_or_file && isset($function_or_file['file']))&nbsp;</div></li><li><div>                    locate_template($function_or_file['file'], true, true);&nbsp;</div></li><li><div>                elseif (false !== $content) {&nbsp;</div></li><li><div>                    if (!defined('PODS_DISABLE_EVAL') || PODS_DISABLE_EVAL)&nbsp;</div></li><li><div>                        eval(&quot;?&gt;$content&quot;);&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        echo $content;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM `@wp_pod_tbl_$params-&gt;datatype` WHERE id = $params-&gt;tbl_row_id LIMIT 1&quot;);&nbsp;</div></li><li><div>        pod_query(&quot;UPDATE @wp_pod_rel SET sister_pod_id = NULL WHERE sister_pod_id = $params-&gt;pod_id&quot;);&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM @wp_pod WHERE id = $params-&gt;pod_id LIMIT 1&quot;);&nbsp;</div></li><li><div>        pod_query(&quot;DELETE FROM @wp_pod_rel WHERE pod_id = $params-&gt;pod_id&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Plugin hook&nbsp;</div></li><li><div>        do_action('pods_post_drop_pod_item', $params);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Post-drop helpers&nbsp;</div></li><li><div>        if (0 &lt; count($params-&gt;post_drop_helpers)) {&nbsp;</div></li><li><div>            foreach ($params-&gt;post_drop_helpers as $helper) {&nbsp;</div></li><li><div>                $function_or_file = $helper;&nbsp;</div></li><li><div>                $check_function = $function_or_file;&nbsp;</div></li><li><div>                if ((!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE) && (!defined('PODS_HELPER_FUNCTIONS') || !PODS_HELPER_FUNCTIONS))&nbsp;</div></li><li><div>                    $check_function = false;&nbsp;</div></li><li><div>                $check_file = null;&nbsp;</div></li><li><div>                if ((!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE) && (!defined('PODS_HELPER_FILES') || !PODS_HELPER_FILES))&nbsp;</div></li><li><div>                    $check_file = false;&nbsp;</div></li><li><div>                if (false !== $check_function && false !== $check_file)&nbsp;</div></li><li><div>                    $function_or_file = pods_function_or_file($function_or_file, $check_function, 'helper', $check_file);&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $function_or_file = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $content = false;&nbsp;</div></li><li><div>                if (!$function_or_file) {&nbsp;</div></li><li><div>                    $api = new PodAPI();&nbsp;</div></li><li><div>                    $params_helper = array('name' =&gt; $helper, 'type' =&gt; 'post_drop');&nbsp;</div></li><li><div>                    if (!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE)&nbsp;</div></li><li><div>                        $params_helper = pods_sanitize($params_helper);&nbsp;</div></li><li><div>                    $content = $api-&gt;load_helper($params_helper);&nbsp;</div></li><li><div>                    if (false !== $content && 0 &lt; strlen(trim($content['phpcode'])))&nbsp;</div></li><li><div>                        $content = $content['phpcode'];&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        $content = false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (false === $content && false !== $function_or_file && isset($function_or_file['function']))&nbsp;</div></li><li><div>                    $function_or_file['function']($params, $this);&nbsp;</div></li><li><div>                elseif (false === $content && false !== $function_or_file && isset($function_or_file['file']))&nbsp;</div></li><li><div>                    locate_template($function_or_file['file'], true, true);&nbsp;</div></li><li><div>                elseif (false !== $content) {&nbsp;</div></li><li><div>                    if (!defined('PODS_DISABLE_EVAL') || PODS_DISABLE_EVAL)&nbsp;</div></li><li><div>                        eval(&quot;?&gt;$content&quot;);&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        echo $content;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if a Pod exists&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The datatype ID&nbsp;</div></li><li><div>     * $params['name'] string The datatype name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.12&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function pod_exists($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        if (!empty($params-&gt;id) || !empty($params-&gt;name)) {&nbsp;</div></li><li><div>            $where = empty($params-&gt;id) ? &quot;name = '{$params-&gt;name}'&quot; : &quot;id = {$params-&gt;id}&quot;;&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT id, name FROM @wp_pod_types WHERE {$where} LIMIT 1&quot;);&nbsp;</div></li><li><div>            if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                $pod = pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>                return $pod;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a content type and all of its fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The datatype ID&nbsp;</div></li><li><div>     * $params['name'] string The datatype name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_pod($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        if (!empty($params-&gt;id) || !empty($params-&gt;name)) {&nbsp;</div></li><li><div>            $where = empty($params-&gt;id) ? &quot;name = '$params-&gt;name'&quot; : &quot;id = $params-&gt;id&quot;;&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT * FROM @wp_pod_types WHERE $where LIMIT 1&quot;);&nbsp;</div></li><li><div>            if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                $pod = pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>                $pod['fields'] = array();&nbsp;</div></li><li><div>                $result = pod_query(&quot;SELECT id, name, coltype, pickval, required, weight FROM @wp_pod_fields WHERE datatype = {$pod['id']} ORDER BY weight&quot;);&nbsp;</div></li><li><div>                while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                    $pod['fields'][$row['name']] = $row;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $pod;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a column&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The field ID&nbsp;</div></li><li><div>     * $params['name'] string The field name&nbsp;</div></li><li><div>     * $params['datatype'] int The Pod ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_column($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        if (isset($params-&gt;id))&nbsp;</div></li><li><div>            $params-&gt;id = absint($params-&gt;id);&nbsp;</div></li><li><div>        $where = empty($params-&gt;id) ? &quot;`name` = '{$params-&gt;name}' AND `datatype` = {$params-&gt;datatype}&quot; : &quot;`id` = {$params-&gt;id}&quot;;&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT * FROM @wp_pod_fields WHERE {$where} LIMIT 1&quot;);&nbsp;</div></li><li><div>        return @pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a Pod Template&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The template ID&nbsp;</div></li><li><div>     * $params['name'] string The template name&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_template($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        if (isset($params-&gt;id))&nbsp;</div></li><li><div>            $params-&gt;id = absint($params-&gt;id);&nbsp;</div></li><li><div>        $where = empty($params-&gt;id) ? &quot;`name` = '{$params-&gt;name}'&quot; : &quot;`id` = {$params-&gt;id}&quot;;&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT * FROM @wp_pod_templates WHERE {$where} LIMIT 1&quot;);&nbsp;</div></li><li><div>        return @pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a Pod Page&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The page ID&nbsp;</div></li><li><div>     * $params['uri'] string The page URI&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_page($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        if (isset($params-&gt;id))&nbsp;</div></li><li><div>            $params-&gt;id = absint($params-&gt;id);&nbsp;</div></li><li><div>        $where = empty($params-&gt;id) ? &quot;`uri` = '{$params-&gt;uri}'&quot; : &quot;`id` = {$params-&gt;id}&quot;;&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT * FROM @wp_pod_pages WHERE {$where} LIMIT 1&quot;);&nbsp;</div></li><li><div>        return @pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a Pod Helper&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['id'] int The helper ID&nbsp;</div></li><li><div>     * $params['name'] string The helper name&nbsp;</div></li><li><div>     * $params['type'] string The helper type&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_helper($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>        if (isset($params-&gt;id))&nbsp;</div></li><li><div>            $params-&gt;id = absint($params-&gt;id);&nbsp;</div></li><li><div>        $where = empty($params-&gt;id) ? &quot;`name` = '{$params-&gt;name}'&quot; : &quot;`id` = {$params-&gt;id}&quot;;&nbsp;</div></li><li><div>        if (isset($params-&gt;type) && !empty($params-&gt;type))&nbsp;</div></li><li><div>            $where .= &quot; AND `helper_type` = '{$params-&gt;type}'&quot;;&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT * FROM @wp_pod_helpers WHERE {$where} LIMIT 1&quot;);&nbsp;</div></li><li><div>        return @pods_mysql_fetch_assoc($result);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load the input form for a pod item&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['datatype'] string The datatype name&nbsp;</div></li><li><div>     * $params['pod_id'] int The item's pod ID&nbsp;</div></li><li><div>     * $params['tbl_row_id'] int (optional) The item's ID&nbsp;</div></li><li><div>     * $params['public_columns'] array An associative array of columns&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_pod_item($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $params-&gt;tbl_row_id = (int) (isset($params-&gt;tbl_row_id)?$params-&gt;tbl_row_id:null);&nbsp;</div></li><li><div>        $params-&gt;pod_id = (int) (isset($params-&gt;pod_id)?$params-&gt;pod_id:null);&nbsp;</div></li><li><div>        if (empty($params-&gt;tbl_row_id)) {&nbsp;</div></li><li><div>            $params-&gt;tbl_row_id = null;&nbsp;</div></li><li><div>            if (!empty($params-&gt;pod_id)) {&nbsp;</div></li><li><div>                $result = pod_query(&quot;SELECT tbl_row_id FROM @wp_pod WHERE id = $params-&gt;pod_id LIMIT 1&quot;, 'Item not found', null, 'Item not found');&nbsp;</div></li><li><div>                $params-&gt;tbl_row_id = pods_mysql_result($result, 0);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $obj = new Pod($params-&gt;datatype, $params-&gt;tbl_row_id);&nbsp;</div></li><li><div>        $pod_id = 0;&nbsp;</div></li><li><div>        if (!empty($params-&gt;tbl_row_id) && !empty($obj-&gt;data)) {&nbsp;</div></li><li><div>            $pod_id = $obj-&gt;get_pod_id();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $obj-&gt;showform($pod_id, $params-&gt;public_columns = null);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load a bi-directional (sister) column&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pickval'] string The related PICK pod name&nbsp;</div></li><li><div>     * $params['datatype'] int The datatype ID&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.7.9&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_sister_fields($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $params = (object) $params;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!empty($params-&gt;pickval) && is_string($params-&gt;pickval)) {&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT id FROM @wp_pod_types WHERE name = '$params-&gt;pickval' LIMIT 1&quot;);&nbsp;</div></li><li><div>            if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                $sister_datatype = pods_mysql_result($result, 0);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $result = pod_query(&quot;SELECT name FROM @wp_pod_types WHERE id = $params-&gt;datatype LIMIT 1&quot;);&nbsp;</div></li><li><div>                if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                    $datatype_name = pods_mysql_result($result, 0);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $result = pod_query(&quot;SELECT id, name FROM @wp_pod_fields WHERE datatype = $sister_datatype AND pickval = '$datatype_name'&quot;);&nbsp;</div></li><li><div>                    if (0 &lt; pods_mysql_num_rows($result)) {&nbsp;</div></li><li><div>                        while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                            $sister_fields[] = $row;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        return $sister_fields;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Export a package&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * $params['pod'] string Pod Type IDs to export&nbsp;</div></li><li><div>     * $params['template'] string Template IDs to export&nbsp;</div></li><li><div>     * $params['podpage'] string Pod Page IDs to export&nbsp;</div></li><li><div>     * $params['helper'] string Helper IDs to export&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $params An associative array of parameters&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function export_package($params) {&nbsp;</div></li><li><div>        if (defined('PODS_STRICT_MODE') && PODS_STRICT_MODE)&nbsp;</div></li><li><div>            $params = pods_sanitize($params);&nbsp;</div></li><li><div>        $export = array(&nbsp;</div></li><li><div>            'meta' =&gt; array(&nbsp;</div></li><li><div>                'version' =&gt; PODS_VERSION, &nbsp;</div></li><li><div>                'build' =&gt; date('U'), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $pod_ids = $params['pod'];&nbsp;</div></li><li><div>        $template_ids = $params['template'];&nbsp;</div></li><li><div>        $pod_page_ids = $params['podpage'];&nbsp;</div></li><li><div>        $helper_ids = $params['helper'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get pods&nbsp;</div></li><li><div>        if (!empty($pod_ids)) {&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT * FROM @wp_pod_types WHERE id IN ($pod_ids)&quot;);&nbsp;</div></li><li><div>            while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                $dt = $row['id'];&nbsp;</div></li><li><div>                unset($row['id']);&nbsp;</div></li><li><div>                $export['pods'][$dt] = $row;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Get pod fields&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT * FROM @wp_pod_fields WHERE datatype IN ($pod_ids)&quot;);&nbsp;</div></li><li><div>            while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                unset($row['id']);&nbsp;</div></li><li><div>                $dt = $row['datatype'];&nbsp;</div></li><li><div>                unset($row['datatype']);&nbsp;</div></li><li><div>                unset($row['sister_field_id']); // impossible to reference this correctly until all pods / fields have been added&nbsp;</div></li><li><div>                $export['pods'][$dt]['fields'][] = $row;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get templates&nbsp;</div></li><li><div>        if (!empty($template_ids)) {&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT * FROM @wp_pod_templates WHERE id IN ($template_ids)&quot;);&nbsp;</div></li><li><div>            while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                unset($row['id']);&nbsp;</div></li><li><div>                $export['templates'][] = $row;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get pod pages&nbsp;</div></li><li><div>        if (!empty($pod_page_ids)) {&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT * FROM @wp_pod_pages WHERE id IN ($pod_page_ids)&quot;);&nbsp;</div></li><li><div>            while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                unset($row['id']);&nbsp;</div></li><li><div>                $export['pod_pages'][] = $row;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get helpers&nbsp;</div></li><li><div>        if (!empty($helper_ids)) {&nbsp;</div></li><li><div>            $result = pod_query(&quot;SELECT * FROM @wp_pod_helpers WHERE id IN ($helper_ids)&quot;);&nbsp;</div></li><li><div>            while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>                unset($row['id']);&nbsp;</div></li><li><div>                $export['helpers'][] = $row;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (1 == count($export))&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $export;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Replace an existing package&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $data (optional) An associative array containing a package, or the json encoded package&nbsp;</div></li><li><div>     * @since 1.9.8&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function replace_package($data = false) {&nbsp;</div></li><li><div>        return $this-&gt;import_package($data, true);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Import a package&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $data (optional) An associative array containing a package, or the json encoded package&nbsp;</div></li><li><div>     * @param bool $replace (optional) Replace existing items when found&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function import_package($data = false, $replace = false) {&nbsp;</div></li><li><div>        $output = false;&nbsp;</div></li><li><div>        if (false===$data || isset($data['action'])) {&nbsp;</div></li><li><div>            $data = get_option('pods_package');&nbsp;</div></li><li><div>            $output = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!is_array($data)) {&nbsp;</div></li><li><div>            $json_data = @json_decode($data, true);&nbsp;</div></li><li><div>            if (!is_array($json_data))&nbsp;</div></li><li><div>                $json_data = @json_decode(stripslashes($data), true);&nbsp;</div></li><li><div>            $data = $json_data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!is_array($data) || empty($data)) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $dbtypes = array(&nbsp;</div></li><li><div>            'bool' =&gt; 'bool default 0', &nbsp;</div></li><li><div>            'date' =&gt; 'datetime', &nbsp;</div></li><li><div>            'num' =&gt; 'decimal(9, 2)', &nbsp;</div></li><li><div>            'txt' =&gt; 'varchar(128)', &nbsp;</div></li><li><div>            'slug' =&gt; 'varchar(128)', &nbsp;</div></li><li><div>            'code' =&gt; 'mediumtext', &nbsp;</div></li><li><div>            'desc' =&gt; 'mediumtext'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $dbtypes = apply_filters('pods_column_dbtypes', $dbtypes, $this);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $found = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($data['pods'])) {&nbsp;</div></li><li><div>            $pod_columns = '';&nbsp;</div></li><li><div>            foreach ($data['pods'] as $pod) {&nbsp;</div></li><li><div>                $pod = pods_sanitize($pod);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $table_columns = array();&nbsp;</div></li><li><div>                $pod_fields = $pod['fields'];&nbsp;</div></li><li><div>                unset($pod['fields']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (false !== $replace) {&nbsp;</div></li><li><div>                    $existing = $this-&gt;load_pod(array('name' =&gt; $pod['name']));&nbsp;</div></li><li><div>                    if (is_array($existing))&nbsp;</div></li><li><div>                        $this-&gt;drop_pod(array('id' =&gt; $existing['id']));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (empty($pod_columns))&nbsp;</div></li><li><div>                    $pod_columns = implode(&quot;`, `&quot;, array_keys($pod));&nbsp;</div></li><li><div>                // Backward-compatibility (before/after helpers)&nbsp;</div></li><li><div>                $pod_columns = str_replace('before_helpers', 'pre_save_helpers', $pod_columns);&nbsp;</div></li><li><div>                $pod_columns = str_replace('after_helpers', 'post_save_helpers', $pod_columns);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $values = implode(&quot;', '&quot;, $pod);&nbsp;</div></li><li><div>                $dt = pod_query(&quot;INSERT INTO @wp_pod_types (`$pod_columns`) VALUES ('$values')&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $tupples = array();&nbsp;</div></li><li><div>                $field_columns = '';&nbsp;</div></li><li><div>                foreach ($pod_fields as $fieldval) {&nbsp;</div></li><li><div>                    // Escape the values&nbsp;</div></li><li><div>                    foreach ($fieldval as $k =&gt; $v) {&nbsp;</div></li><li><div>                        if (empty($v))&nbsp;</div></li><li><div>                            $v = 'null';&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            $v = pods_sanitize($v);&nbsp;</div></li><li><div>                        $fieldval[$k] = $v;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Store all table columns&nbsp;</div></li><li><div>                    if ('pick' != $fieldval['coltype'] && 'file' != $fieldval['coltype'])&nbsp;</div></li><li><div>                        $table_columns[$fieldval['name']] = $fieldval['coltype'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $fieldval['datatype'] = $dt;&nbsp;</div></li><li><div>                    if (empty($field_columns))&nbsp;</div></li><li><div>                        $field_columns = implode(&quot;`, `&quot;, array_keys($fieldval));&nbsp;</div></li><li><div>                    $tupples[] = implode(&quot;', '&quot;, $fieldval);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $tupples = implode(&quot;'), ('&quot;, $tupples);&nbsp;</div></li><li><div>                $tupples = str_replace(&quot;'null'&quot;, 'null', $tupples);&nbsp;</div></li><li><div>                pod_query(&quot;INSERT INTO @wp_pod_fields (`$field_columns`) VALUES ('$tupples')&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Create the actual table with any non-PICK columns&nbsp;</div></li><li><div>                $definitions = array(&quot;id INT unsigned auto_increment primary key&quot;);&nbsp;</div></li><li><div>                foreach ($table_columns as $colname =&gt; $coltype) {&nbsp;</div></li><li><div>                    $definitions[] = &quot;`$colname` {$dbtypes[$coltype]}&quot;;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $definitions = implode(', ', $definitions);&nbsp;</div></li><li><div>                pod_query(&quot;CREATE TABLE @wp_pod_tbl_{$pod['name']} ($definitions)&quot;);&nbsp;</div></li><li><div>                if (!isset($found['pods']))&nbsp;</div></li><li><div>                    $found['pods'] = array();&nbsp;</div></li><li><div>                $found['pods'][] = esc_textarea($pod['name']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($data['templates'])) {&nbsp;</div></li><li><div>            foreach ($data['templates'] as $template) {&nbsp;</div></li><li><div>                $defaults = array('name' =&gt; '', 'code' =&gt; '');&nbsp;</div></li><li><div>                $params = array_merge($defaults, $template);&nbsp;</div></li><li><div>                if (!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE)&nbsp;</div></li><li><div>                    $params = pods_sanitize($params);&nbsp;</div></li><li><div>                if (false !== $replace) {&nbsp;</div></li><li><div>                    $existing = $this-&gt;load_template(array('name' =&gt; $params['name']));&nbsp;</div></li><li><div>                    if (is_array($existing))&nbsp;</div></li><li><div>                        $params['id'] = $existing['id'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;save_template($params);&nbsp;</div></li><li><div>                if (!isset($found['templates']))&nbsp;</div></li><li><div>                    $found['templates'] = array();&nbsp;</div></li><li><div>                $found['templates'][] = esc_textarea($params['name']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($data['pod_pages'])) {&nbsp;</div></li><li><div>            foreach ($data['pod_pages'] as $pod_page) {&nbsp;</div></li><li><div>                $defaults = array('uri' =&gt; '', 'title' =&gt; '', 'phpcode' =&gt; '', 'precode' =&gt; '', 'page_template' =&gt; '');&nbsp;</div></li><li><div>                $params = array_merge($defaults, $pod_page);&nbsp;</div></li><li><div>                if (!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE)&nbsp;</div></li><li><div>                    $params = pods_sanitize($params);&nbsp;</div></li><li><div>                if (false !== $replace) {&nbsp;</div></li><li><div>                    $existing = $this-&gt;load_page(array('uri' =&gt; $params['uri']));&nbsp;</div></li><li><div>                    if (is_array($existing))&nbsp;</div></li><li><div>                        $params['id'] = $existing['id'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;save_page($params);&nbsp;</div></li><li><div>                if (!isset($found['pod_pages']))&nbsp;</div></li><li><div>                    $found['pod_pages'] = array();&nbsp;</div></li><li><div>                $found['pod_pages'][] = esc_textarea($params['uri']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($data['helpers'])) {&nbsp;</div></li><li><div>            foreach ($data['helpers'] as $helper) {&nbsp;</div></li><li><div>                // backwards compatibility&nbsp;</div></li><li><div>                if (isset($helper['helper_type'])) {&nbsp;</div></li><li><div>                    if ('before' == $helper['helper_type'])&nbsp;</div></li><li><div>                        $helper['helper_type'] = 'pre_save';&nbsp;</div></li><li><div>                    if ('after' == $helper['helper_type'])&nbsp;</div></li><li><div>                        $helper['helper_type'] = 'post_save';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $defaults = array('name' =&gt; '', 'helper_type' =&gt; 'display', 'phpcode' =&gt; '');&nbsp;</div></li><li><div>                $params = array_merge($defaults, $helper);&nbsp;</div></li><li><div>                if (!defined('PODS_STRICT_MODE') || !PODS_STRICT_MODE)&nbsp;</div></li><li><div>                    $params = pods_sanitize($params);&nbsp;</div></li><li><div>                if (false !== $replace) {&nbsp;</div></li><li><div>                    $existing = $this-&gt;load_helper(array('name' =&gt; $params['name']));&nbsp;</div></li><li><div>                    if (is_array($existing))&nbsp;</div></li><li><div>                        $params['id'] = $existing['id'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $this-&gt;save_helper($params);&nbsp;</div></li><li><div>                if (!isset($found['helpers']))&nbsp;</div></li><li><div>                    $found['helpers'] = array();&nbsp;</div></li><li><div>                $found['helpers'][] = esc_textarea($params['name']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (true===$output) {&nbsp;</div></li><li><div>            if (!empty($found)) {&nbsp;</div></li><li><div>                echo '&lt;br /&gt;&lt;div id=&quot;message&quot; class=&quot;updated fade&quot;&gt;';&nbsp;</div></li><li><div>                echo '&lt;h3 style=&quot;margin-top:10px;&quot;&gt;Package Imported:&lt;/h3&gt;';&nbsp;</div></li><li><div>                if (isset($found['pods'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Pod(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $found['pods']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($found['templates'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Template(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $found['templates']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($found['pod_pages'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Pod Page(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $found['pod_pages']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($found['helpers'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Helper(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $found['helpers']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                echo '&lt;/div&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                echo '&lt;e&gt;&lt;br /&gt;&lt;div id=&quot;message&quot; class=&quot;error fade&quot;&gt;&lt;p&gt;Error: Package not imported, try again.&lt;/p&gt;&lt;/div&gt;&lt;/e&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!empty($found))&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Validate a package&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $data (optional) An associative array containing a package, or the json encoded package&nbsp;</div></li><li><div>     * @since 1.9.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function validate_package($data = false, $output = false) {&nbsp;</div></li><li><div>        if (is_array($data)&&isset($data['data'])) {&nbsp;</div></li><li><div>            $data = $data['data'];&nbsp;</div></li><li><div>            $output = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (is_array($data))&nbsp;</div></li><li><div>            $data = esc_textarea(json_encode($data));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $found = array();&nbsp;</div></li><li><div>        $warnings = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        update_option('pods_package', $data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $json_data = @json_decode($data, true);&nbsp;</div></li><li><div>        if (!is_array($json_data))&nbsp;</div></li><li><div>            $json_data = @json_decode(stripslashes($data), true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (!is_array($json_data) || empty($json_data)) {&nbsp;</div></li><li><div>            $warnings[] = &quot;This is not a valid package. Please try again.&quot;;&nbsp;</div></li><li><div>            if (true===$output) {&nbsp;</div></li><li><div>                echo '&lt;e&gt;&lt;br /&gt;&lt;div id=&quot;message&quot; class=&quot;error fade&quot;&gt;&lt;p&gt;This is not a valid package. Please try again.&lt;/p&gt;&lt;/div&gt;&lt;/e&gt;';&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>                return $warnings;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $data = $json_data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (0 &lt; strlen($data['meta']['version']) && false === strpos($data['meta']['version'], '.') && (int) $data['meta']['version'] &lt; 1000) { // older style&nbsp;</div></li><li><div>            $data['meta']['version'] = implode('.', str_split($data['meta']['version']));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif (0 &lt; strlen($data['meta']['version']) && false === strpos($data['meta']['version'], '.')) { // old style&nbsp;</div></li><li><div>            $data['meta']['version'] = pods_version_to_point($data['meta']['version']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($data['meta']['compatible_from'])) {&nbsp;</div></li><li><div>            if (0 &lt; strlen($data['meta']['compatible_from']) && false === strpos($data['meta']['compatible_from'], '.')) { // old style&nbsp;</div></li><li><div>                $data['meta']['compatible_from'] = pods_version_to_point($data['meta']['compatible_from']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (version_compare(PODS_VERSION, $data['meta']['compatible_from'], '&lt;')) {&nbsp;</div></li><li><div>                $compatible_from = explode('.', $data['meta']['compatible_from']);&nbsp;</div></li><li><div>                $compatible_from = $compatible_from[0] . '.' . $compatible_from[1];&nbsp;</div></li><li><div>                $pods_version = explode('.', PODS_VERSION);&nbsp;</div></li><li><div>                $pods_version = $pods_version[0] . '.' . $pods_version[1];&nbsp;</div></li><li><div>                if (version_compare($pods_version, $compatible_from, '&lt;'))&nbsp;</div></li><li><div>                    $warnings['version'] = 'This package may only compatible with the newer &lt;strong&gt;Pods ' . pods_version_to_point($data['meta']['compatible_from']) . '+&lt;/strong&gt;, but you are currently running the older &lt;strong&gt;Pods ' . PODS_VERSION . '&lt;/strong&gt;&lt;br /&gt;Unless the package author has specified it is compatible, it may not have been tested to work with your installed version of Pods.';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (isset($data['meta']['compatible_to'])) {&nbsp;</div></li><li><div>            if (0 &lt; strlen($data['meta']['compatible_to']) && false === strpos($data['meta']['compatible_to'], '.')) { // old style&nbsp;</div></li><li><div>                $data['meta']['compatible_to'] = pods_version_to_point($data['meta']['compatible_to']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (version_compare($data['meta']['compatible_to'], PODS_VERSION, '&lt;')) {&nbsp;</div></li><li><div>                $compatible_to = explode('.', $data['meta']['compatible_to']);&nbsp;</div></li><li><div>                $compatible_to = $compatible_to[0] . '.' . $compatible_to[1];&nbsp;</div></li><li><div>                $pods_version = explode('.', PODS_VERSION);&nbsp;</div></li><li><div>                $pods_version = $pods_version[0] . '.' . $pods_version[1];&nbsp;</div></li><li><div>                if (version_compare($compatible_to, $pods_version, '&lt;'))&nbsp;</div></li><li><div>                    $warnings['version'] = 'This package may only compatible with the older &lt;strong&gt;Pods ' . $data['meta']['compatible_to'] . '&lt;/strong&gt;, but you are currently running the newer &lt;strong&gt;Pods ' . PODS_VERSION . '&lt;/strong&gt;&lt;br /&gt;Unless the package author has specified it is compatible, it may not have been tested to work with your installed version of Pods.';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (!isset($data['meta']['compatible_from']) && !isset($data['meta']['compatible_to'])) {&nbsp;</div></li><li><div>            if (version_compare(PODS_VERSION, $data['meta']['version'], '&lt;')) {&nbsp;</div></li><li><div>                $compatible_from = explode('.', $data['meta']['version']);&nbsp;</div></li><li><div>                $compatible_from = $compatible_from[0] . '.' . $compatible_from[1];&nbsp;</div></li><li><div>                $pods_version = explode('.', PODS_VERSION);&nbsp;</div></li><li><div>                $pods_version = $pods_version[0] . '.' . $pods_version[1];&nbsp;</div></li><li><div>                if (version_compare($pods_version, $compatible_from, '&lt;'))&nbsp;</div></li><li><div>                    $warnings['version'] = 'This package was built using the newer &lt;strong&gt;Pods ' . $data['meta']['version'] . '&lt;/strong&gt;, but you are currently running the older &lt;strong&gt;Pods ' . PODS_VERSION . '&lt;/strong&gt;&lt;br /&gt;Unless the package author has specified it is compatible, it may not have been tested to work with your installed version of Pods.';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif (version_compare($data['meta']['version'], PODS_VERSION, '&lt;')) {&nbsp;</div></li><li><div>                $compatible_to = explode('.', $data['meta']['version']);&nbsp;</div></li><li><div>                $compatible_to = $compatible_to[0] . '.' . $compatible_to[1];&nbsp;</div></li><li><div>                $pods_version = explode('.', PODS_VERSION);&nbsp;</div></li><li><div>                $pods_version = $pods_version[0] . '.' . $pods_version[1];&nbsp;</div></li><li><div>                if (version_compare($compatible_to, $pods_version, '&lt;'))&nbsp;</div></li><li><div>                    $warnings['version'] = 'This package was built using the older &lt;strong&gt;Pods ' . $data['meta']['version'] . '&lt;/strong&gt;, but you are currently running the newer &lt;strong&gt;Pods ' . PODS_VERSION . '&lt;/strong&gt;&lt;br /&gt;Unless the package author has specified it is compatible, it may not have been tested to work with your installed version of Pods.';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($data['pods'])) {&nbsp;</div></li><li><div>            foreach ($data['pods'] as $pod) {&nbsp;</div></li><li><div>                $pod = pods_sanitize($pod);&nbsp;</div></li><li><div>                $existing = $this-&gt;load_pod(array('name' =&gt; $pod['name']));&nbsp;</div></li><li><div>                if (is_array($existing)) {&nbsp;</div></li><li><div>                    if (!isset($warnings['pods']))&nbsp;</div></li><li><div>                        $warnings['pods'] = array();&nbsp;</div></li><li><div>                    $warnings['pods'][] = esc_textarea($pod['name']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!isset($found['pods']))&nbsp;</div></li><li><div>                    $found['pods'] = array();&nbsp;</div></li><li><div>                $found['pods'][] = esc_textarea($pod['name']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($data['templates'])) {&nbsp;</div></li><li><div>            foreach ($data['templates'] as $template) {&nbsp;</div></li><li><div>                $template = pods_sanitize($template);&nbsp;</div></li><li><div>                $existing = $this-&gt;load_template(array('name' =&gt; $template['name']));&nbsp;</div></li><li><div>                if (is_array($existing)) {&nbsp;</div></li><li><div>                    if (!isset($warnings['templates']))&nbsp;</div></li><li><div>                        $warnings['templates'] = array();&nbsp;</div></li><li><div>                    $warnings['templates'][] = esc_textarea($template['name']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!isset($found['templates']))&nbsp;</div></li><li><div>                    $found['templates'] = array();&nbsp;</div></li><li><div>                $found['templates'][] = esc_textarea($template['name']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($data['pod_pages'])) {&nbsp;</div></li><li><div>            foreach ($data['pod_pages'] as $pod_page) {&nbsp;</div></li><li><div>                $pod_page = pods_sanitize($pod_page);&nbsp;</div></li><li><div>                $existing = $this-&gt;load_page(array('uri' =&gt; $pod_page['uri']));&nbsp;</div></li><li><div>                if (is_array($existing)) {&nbsp;</div></li><li><div>                    if (!isset($warnings['pod_pages']))&nbsp;</div></li><li><div>                        $warnings['pod_pages'] = array();&nbsp;</div></li><li><div>                    $warnings['pod_pages'][] = esc_textarea($pod_page['uri']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!isset($found['pod_pages']))&nbsp;</div></li><li><div>                    $found['pod_pages'] = array();&nbsp;</div></li><li><div>                $found['pod_pages'][] = esc_textarea($pod_page['uri']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (isset($data['helpers'])) {&nbsp;</div></li><li><div>            foreach ($data['helpers'] as $helper) {&nbsp;</div></li><li><div>                $helper = pods_sanitize($helper);&nbsp;</div></li><li><div>                $existing = $this-&gt;load_helper(array('name' =&gt; $helper['name']));&nbsp;</div></li><li><div>                if (is_array($existing)) {&nbsp;</div></li><li><div>                    if (!isset($warnings['helpers']))&nbsp;</div></li><li><div>                        $warnings['helpers'] = array();&nbsp;</div></li><li><div>                    $warnings['helpers'][] = esc_textarea($helper['name']);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (!isset($found['helpers']))&nbsp;</div></li><li><div>                    $found['helpers'] = array();&nbsp;</div></li><li><div>                $found['helpers'][] = esc_textarea($helper['name']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (true===$output) {&nbsp;</div></li><li><div>            if (!empty($found)) {&nbsp;</div></li><li><div>                echo '&lt;hr /&gt;';&nbsp;</div></li><li><div>                echo '&lt;h3&gt;Package Contents:&lt;/h3&gt;';&nbsp;</div></li><li><div>                if (isset($warnings['version']))&nbsp;</div></li><li><div>                    echo '&lt;p&gt;&lt;em&gt;&lt;strong&gt;NOTICE:&lt;/strong&gt; ' . $warnings['version'] . '&lt;/em&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>                if (isset($found['pods'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Pod(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $found['pods']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($found['templates'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Template(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $found['templates']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($found['pod_pages'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Pod Page(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $found['pod_pages']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($found['helpers'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Helper(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $found['helpers']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (0 &lt; count($warnings) && (!isset($warnings['version']) || 1 &lt; count($warnings))) {&nbsp;</div></li><li><div>                echo '&lt;hr /&gt;';&nbsp;</div></li><li><div>                echo '&lt;h3 class=&quot;red&quot;&gt;WARNING: There are portions of this package that already exist&lt;/h3&gt;';&nbsp;</div></li><li><div>                if (isset($warnings['pods'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Pod(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $warnings['pods']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($warnings['templates'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Template(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $warnings['templates']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($warnings['pod_pages'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Pod Page(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $warnings['pod_pages']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if (isset($warnings['helpers'])) {&nbsp;</div></li><li><div>                    echo '&lt;h4&gt;Helper(s)&lt;/h4&gt;';&nbsp;</div></li><li><div>                    echo '&lt;ul class=&quot;pretty&quot;&gt;&lt;li&gt;' . implode('&lt;/li&gt;&lt;li&gt;', $warnings['helpers']) . '&lt;/li&gt;&lt;/ul&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                echo '&lt;p&gt;&lt;input type=&quot;button&quot; class=&quot;button-primary&quot; style=&quot;background:#f39400;border-color:#d56500;&quot; onclick=&quot;podsImport(\'replace_package\')&quot; value=&quot; Overwrite the existing package (Step 2 of 2) &quot; /&gt;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;button&quot; class=&quot;button-secondary&quot; onclick=&quot;podsImportCancel()&quot; value=&quot; Cancel &quot; /&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif (!empty($found)) {&nbsp;</div></li><li><div>                echo '&lt;p&gt;&lt;input type=&quot;button&quot; class=&quot;button-primary&quot; onclick=&quot;podsImport(\'import_package\')&quot; value=&quot; Import Package (Step 2 of 2) &quot; /&gt;&nbsp;&nbsp;&nbsp;&lt;input type=&quot;button&quot; class=&quot;button-secondary&quot; onclick=&quot;podsImportCancel()&quot; value=&quot; Cancel &quot; /&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>                return false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            echo '&lt;e&gt;&lt;br /&gt;&lt;div id=&quot;message&quot; class=&quot;error fade&quot;&gt;&lt;p&gt;Error: This package is empty, there is nothing to import.&lt;/p&gt;&lt;/div&gt;&lt;/e&gt;';&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if (0 &lt; count($warnings))&nbsp;</div></li><li><div>            return $warnings;&nbsp;</div></li><li><div>        elseif (!empty($found))&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Import data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param mixed $data PHP associative array or CSV input&nbsp;</div></li><li><div>     * @param bool $numeric_mode Use IDs instead of the name field when matching&nbsp;</div></li><li><div>     * @since 1.7.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function import($data, $numeric_mode = false) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        if ('csv' == $this-&gt;format) {&nbsp;</div></li><li><div>            $data = $this-&gt;csv_to_php($data);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        pod_query(&quot;SET NAMES utf8&quot;);&nbsp;</div></li><li><div>        pod_query(&quot;SET CHARACTER SET utf8&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get the id/name pairs of all associated pick/file tables&nbsp;</div></li><li><div>        $pick_values = $file_values = array();&nbsp;</div></li><li><div>        foreach ($this-&gt;fields as $field_name =&gt; $field_data) {&nbsp;</div></li><li><div>            $pickval = $field_data['pickval'];&nbsp;</div></li><li><div>            if ('file' == $field_data['coltype']) {&nbsp;</div></li><li><div>                $res = pod_query(&quot;SELECT ID as id, guid as name FROM $wpdb-&gt;posts WHERE post_type = 'attachment' ORDER BY id&quot;);&nbsp;</div></li><li><div>                while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                    $file_url = str_replace(get_bloginfo('url'), '', $item['name']);&nbsp;</div></li><li><div>                    $file_values[$field_name][$file_url] = $item['id'];&nbsp;</div></li><li><div>                    $file_values[$field_name][$item['name']] = $item['id'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ('pick' == $field_data['coltype']) {&nbsp;</div></li><li><div>                if ('wp_taxonomy' == $pickval) {&nbsp;</div></li><li><div>                    $res = pod_query(&quot;SELECT term_id AS id, name FROM $wpdb-&gt;terms ORDER BY id&quot;);&nbsp;</div></li><li><div>                    while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                        $pick_values[$field_name][$item['name']] = $item['id'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ('wp_page' == $pickval || 'wp_post' == $pickval) {&nbsp;</div></li><li><div>                    $pickval = str_replace('wp_', '', $pickval);&nbsp;</div></li><li><div>                    $res = pod_query(&quot;SELECT ID as id, post_title as name FROM $wpdb-&gt;posts WHERE post_type = '$pickval' ORDER BY id&quot;);&nbsp;</div></li><li><div>                    while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                        $pick_values[$field_name][$item['name']] = $item['id'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ('wp_user' == $pickval) {&nbsp;</div></li><li><div>                    $res = pod_query(&quot;SELECT ID as id, display_name as name FROM $wpdb-&gt;users ORDER BY id&quot;);&nbsp;</div></li><li><div>                    while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                        $pick_values[$field_name][$item['name']] = $item['id'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $res = pod_query(&quot;SELECT id, name FROM @wp_pod_tbl_{$pickval} ORDER BY id&quot;);&nbsp;</div></li><li><div>                    while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                        $pick_values[$field_name][$item['name']] = $item['id'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Loop through the array of items&nbsp;</div></li><li><div>        $ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Test to see if it's an array of arrays&nbsp;</div></li><li><div>        foreach ($data as $key =&gt; $data_row) {&nbsp;</div></li><li><div>            if(!is_array($data_row)) {&nbsp;</div></li><li><div>                $data = array($data);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        foreach ($data as $key =&gt; $data_row) {&nbsp;</div></li><li><div>            $columns = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Loop through each field (use $this-&gt;fields so only valid columns get parsed)&nbsp;</div></li><li><div>            foreach ($this-&gt;fields as $field_name =&gt; $field_data) {&nbsp;</div></li><li><div>                $field_id = $field_data['id'];&nbsp;</div></li><li><div>                $coltype = $field_data['coltype'];&nbsp;</div></li><li><div>                $pickval = $field_data['pickval'];&nbsp;</div></li><li><div>                $field_value = $data_row[$field_name];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (null != $field_value && false !== $field_value) {&nbsp;</div></li><li><div>                    if ('pick' == $coltype || 'file' == $coltype) {&nbsp;</div></li><li><div>                        $field_values = is_array($field_value) ? $field_value : array($field_value);&nbsp;</div></li><li><div>                        $pick_value = array();&nbsp;</div></li><li><div>                        foreach ($field_values as $key =&gt; $pick_title) {&nbsp;</div></li><li><div>                            if (is_int($pick_title) && false !== $numeric_mode) {&nbsp;</div></li><li><div>                                $pick_value[] = $pick_title;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            elseif (!empty($pick_values[$field_name][$pick_title])) {&nbsp;</div></li><li><div>                                $pick_value[] = $pick_values[$field_name][$pick_title];&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $field_value = implode(', ', $pick_value);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $columns[$field_name] = esc_sql(trim($field_value));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if (!empty($columns)) {&nbsp;</div></li><li><div>                $params = array('datatype'=&gt;$this-&gt;dtname, 'columns'=&gt;$columns);&nbsp;</div></li><li><div>                $ids[] = $this-&gt;save_pod_item($params);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $ids;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Export data&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.7.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function export() {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $data = array();&nbsp;</div></li><li><div>        $fields = array();&nbsp;</div></li><li><div>        $pick_values = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Find all pick/file fields&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT id, name, coltype, pickval FROM @wp_pod_fields WHERE datatype = {$this-&gt;dt} ORDER BY weight&quot;);&nbsp;</div></li><li><div>        while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>            $field_id = $row['id'];&nbsp;</div></li><li><div>            $field_name = $row['name'];&nbsp;</div></li><li><div>            $coltype = $row['coltype'];&nbsp;</div></li><li><div>            $pickval = $row['pickval'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Store all pick/file values into an array&nbsp;</div></li><li><div>            if ('file' == $coltype) {&nbsp;</div></li><li><div>                $res = pod_query(&quot;SELECT ID AS id, guid AS name FROM $wpdb-&gt;posts WHERE post_type = 'attachment' ORDER BY id&quot;);&nbsp;</div></li><li><div>                while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                    $pick_values[$field_name][$item['id']] = $item['name'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ('pick' == $coltype) {&nbsp;</div></li><li><div>                if ('wp_taxonomy' == $pickval) {&nbsp;</div></li><li><div>                    $res = pod_query(&quot;SELECT term_id AS id, name FROM $wpdb-&gt;terms ORDER BY id&quot;);&nbsp;</div></li><li><div>                    while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                        $pick_values[$field_name][$item['id']] = $item['name'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ('wp_page' == $pickval || 'wp_post' == $pickval) {&nbsp;</div></li><li><div>                    $pickval = str_replace('wp_', '', $pickval);&nbsp;</div></li><li><div>                    $res = pod_query(&quot;SELECT ID as id, post_title as name FROM $wpdb-&gt;posts WHERE post_type = '$pickval' ORDER BY id&quot;);&nbsp;</div></li><li><div>                    while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                        $pick_values[$field_name][$item['id']] = $item['name'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ('wp_user' == $pickval) {&nbsp;</div></li><li><div>                    $res = pod_query(&quot;SELECT ID as id, display_name as name FROM $wpdb-&gt;users ORDER BY id&quot;);&nbsp;</div></li><li><div>                    while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                        $pick_values[$field_name][$item['id']] = $item['name'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $res = pod_query(&quot;SELECT id, name FROM @wp_pod_tbl_{$pickval} ORDER BY id&quot;);&nbsp;</div></li><li><div>                    while ($item = pods_mysql_fetch_assoc($res)) {&nbsp;</div></li><li><div>                        $pick_values[$field_name][$item['id']] = $item['name'];&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $fields[$field_id] = $field_name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Get all pick rel values&nbsp;</div></li><li><div>        $sql = &quot;&nbsp;</div></li><li><div>        SELECT&nbsp;</div></li><li><div>            p.tbl_row_id, r.field_id, r.tbl_row_id AS item_id&nbsp;</div></li><li><div>        FROM&nbsp;</div></li><li><div>            @wp_pod_rel r&nbsp;</div></li><li><div>        INNER JOIN&nbsp;</div></li><li><div>            @wp_pod p ON p.id = r.pod_id AND p.datatype = {$this-&gt;dt}&nbsp;</div></li><li><div>        ORDER BY&nbsp;</div></li><li><div>            p.tbl_row_id&nbsp;</div></li><li><div>        &quot;;&nbsp;</div></li><li><div>        $result = pod_query($sql);&nbsp;</div></li><li><div>        while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>            $item_id = $row['item_id'];&nbsp;</div></li><li><div>            $tbl_row_id = $row['tbl_row_id'];&nbsp;</div></li><li><div>            $field_name = $fields[$row['field_id']];&nbsp;</div></li><li><div>            $pick_array[$field_name][$tbl_row_id][] = $pick_values[$field_name][$item_id];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Access the current datatype&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT * FROM @wp_pod_tbl_{$this-&gt;dtname} ORDER BY id&quot;);&nbsp;</div></li><li><div>        while ($row = pods_mysql_fetch_assoc($result)) {&nbsp;</div></li><li><div>            $tmp = array();&nbsp;</div></li><li><div>            $row_id = $row['id'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ($fields as $junk =&gt; $fname) {&nbsp;</div></li><li><div>                if (isset($pick_array[$fname][$row_id])) {&nbsp;</div></li><li><div>                    $tmp[$fname] = $pick_array[$fname][$row_id];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    $tmp[$fname] = $row[$fname];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $data[] = $tmp;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Convert CSV to a PHP array&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $data The CSV input&nbsp;</div></li><li><div>     * @since 1.7.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function csv_to_php($data) {&nbsp;</div></li><li><div>        $delimiter = &quot;, &quot;;&nbsp;</div></li><li><div>        $expr = &quot;/$delimiter(?=(?:[^\&quot;]*\&quot;[^\&quot;]*\&quot;)*(?![^\&quot;]*\&quot;))/&quot;;&nbsp;</div></li><li><div>        $data = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $data);&nbsp;</div></li><li><div>        $data = str_replace(&quot;\r&quot;, &quot;\n&quot;, $data);&nbsp;</div></li><li><div>        $lines = explode(&quot;\n&quot;, $data);&nbsp;</div></li><li><div>        $field_names = explode($delimiter, array_shift($lines));&nbsp;</div></li><li><div>        $field_names = preg_replace(&quot;/^\&quot;(.*)\&quot;$/s&quot;, &quot;$1&quot;, $field_names);&nbsp;</div></li><li><div>        foreach ($lines as $line) {&nbsp;</div></li><li><div>            // Skip the empty line&nbsp;</div></li><li><div>            if (empty($line)) continue;&nbsp;</div></li><li><div>            $fields = preg_split($expr, trim($line));&nbsp;</div></li><li><div>            $fields = preg_replace(&quot;/^\&quot;(.*)\&quot;$/s&quot;, &quot;$1&quot;, $fields);&nbsp;</div></li><li><div>            foreach ($field_names as $key =&gt; $field) {&nbsp;</div></li><li><div>                $tmp[$field] = $fields[$key];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $out[] = $tmp;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $out;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Resync wp_pod and wp_pod_tbl_* tables&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * wp_pod_tbl_* is assumed the primary source&nbsp;</div></li><li><div>     * (if not found there, it'll get deleted from wp_pod)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This might take a bit!&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.10.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function fix_wp_pod() {&nbsp;</div></li><li><div>        $result = pod_query(&quot;SELECT id, name FROM @wp_pod_types ORDER BY name&quot;);&nbsp;</div></li><li><div>        while ($row = pods_mysql_fetch_array($result)) {&nbsp;</div></li><li><div>            $id = (int) $row['id'];&nbsp;</div></li><li><div>            $name = pods_sanitize($row['name']);&nbsp;</div></li><li><div>            pod_query(&quot;DELETE p FROM `@wp_pod` AS p LEFT JOIN `@wp_pod_tbl_{$name}` AS t ON t.id = p.tbl_row_id WHERE p.datatype = {$id} AND t.id IS NULL&quot;);&nbsp;</div></li><li><div>            pod_query(&quot;INSERT INTO `@wp_pod` (tbl_row_id, name, datatype, created, modified, author_id) SELECT t.id AS tbl_row_id, t.name AS name, {$id} AS datatype, '&quot; . current_time('mysql') . &quot;' AS created, '&quot; . current_time('mysql') . &quot;' AS modified, 0 AS author_id FROM `@wp_pod_tbl_{$name}` AS t LEFT JOIN `@wp_pod` AS p ON p.datatype = {$id} AND p.tbl_row_id = t.id WHERE p.id IS NULL&quot;);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd> <a href="http://hookr.io/plugins/pods-framework/1.14.8/classes/pod_api/">1.14.8</a></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>PodAPI</li><li><span></span>Pods Framework</li><li><span></span>1.14.8</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>