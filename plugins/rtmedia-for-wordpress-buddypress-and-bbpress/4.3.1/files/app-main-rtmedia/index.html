<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="4.3.1" data-slug="rtmedia-for-wordpress-buddypress-and-bbpress" data-type="file" data-id="17650"><head xmlns="http://www.w3.org/1999/xhtml"><title> app-main-rtmedia | file | Rtmedia For WordPress Buddypress And Bbpress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, rtmedia-for-wordpress-buddypress-and-bbpress, 4.3.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.15"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=9cc51d069699cbc24e66b27a4dad61ad' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.15' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/app-main-rtmedia/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fapp-main-rtmedia%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fapp-main-rtmedia%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-rtmedia-for-wordpress-buddypress-and-bbpress-4.3.1-file-app-main-rtmedia","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="app-main-rtmedia" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to rtmedia-for-wordpress-buddypr&hellip;." href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/" class="plugin"><span property="name">rtmedia-for-wordpress-buddypr&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.3.1." href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/" class="H_VERSION"><span property="name">4.3.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">app-main-rtmedia</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="1084"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/all/" title="All">All <span class="count badge">1084</span></a></li><li class="" data-id="new" data-count="11"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/new/" title="New">New <span class="count badge">11</span></a></li><li class="" data-id="hooks" data-count="448"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/hooks/" title="Hooks">Hooks <span class="count badge">448</span></a></li><li class="" data-id="action" data-count="163"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/actions/" title="Actions">Actions <span class="count badge">163</span></a></li><li class="" data-id="filter" data-count="285"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/filters/" title="Filters">Filters <span class="count badge">285</span></a></li><li class="" data-id="class" data-count="157"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/classes/" title="Classes">Classes <span class="count badge">157</span></a></li><li class="" data-id="constant" data-count="258"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/constants/" title="Constants">Constants <span class="count badge">258</span></a></li><li class="" data-id="function" data-count="219"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/functions/" title="Functions">Functions <span class="count badge">219</span></a></li><li class="" data-id="shortcode" data-count="2"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.3.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">2</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/app/main/RTMedia.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) {&nbsp;</div></li><li><div>  exit;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * rtMedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * The main rtMedia Class. This is where everything starts.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package rtMedia</span>&nbsp;</div></li><li><div><span class="comment"> * @subpackage Main</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @author Faishal &lt;faishal.saiyed@rtcamp.com&gt;</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class RTMedia {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var string default thumbnail url fallback for all media types</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $default_thumbnail;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var array allowed media types</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $allowed_types;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var array privacy settings</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $privacy_settings;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var array default media sizes</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $default_sizes;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var object default application wide privacy levels</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $default_privacy = array(&nbsp;</div></li><li><div>      '0' =&gt; 'Public', &nbsp;</div></li><li><div>      '20' =&gt; 'Users', &nbsp;</div></li><li><div>      '40' =&gt; 'Friends', &nbsp;</div></li><li><div>      '60' =&gt; 'Private', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var string Support forum url</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $support_url = 'http:<span class="comment">//community.rtcamp.com/c/rtmedia/?utm_source=dashboard&utm_medium=plugin&utm_campaign=buddypress-media';</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var int Number of media items to show in one view.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $posts_per_page = 10;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var array The types of activity BuddyPress Media creates</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $activity_types = array(&nbsp;</div></li><li><div>      'media_upload', &nbsp;</div></li><li><div>      'album_updated', &nbsp;</div></li><li><div>      'album_created', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>  public $options;&nbsp;</div></li><li><div>  public $render_options;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Constructs the class</span>&nbsp;</div></li><li><div><span class="comment">   * Defines constants and excerpt lengths, initiates admin notices, </span>&nbsp;</div></li><li><div><span class="comment">   * loads and initiates the plugin, loads translations.</span>&nbsp;</div></li><li><div><span class="comment">   * Initialises media counter</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @global int $bp_media_counter Media counter</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function __construct() {&nbsp;</div></li><li><div>      $this-&gt;default_thumbnail = apply_filters( 'rtmedia_default_thumbnail', RTMEDIA_URL . 'app/assets/admin/img/thumb_default.png' );&nbsp;</div></li><li><div>      add_action( 'init', array( $this, 'check_global_album' ) );&nbsp;</div></li><li><div>      add_action( 'plugins_loaded', array( $this, 'admin_init' ) );&nbsp;</div></li><li><div>      add_action( 'plugins_loaded', array( $this, 'load_translation' ), 10 );&nbsp;</div></li><li><div>      add_action( 'plugins_loaded', array( $this, 'init' ), 20 );&nbsp;</div></li><li><div>      add_action( 'wp_enqueue_scripts', array( 'RTMediaGalleryShortcode', 'register_scripts' ) );&nbsp;</div></li><li><div>      add_action( 'wp_enqueue_scripts', array( &$this, 'enqueue_scripts_styles' ), 999 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Including core functions, actions & filters</span>&nbsp;</div></li><li><div>      include( RTMEDIA_PATH . 'app/main/controllers/template/rtmedia-functions.php' );&nbsp;</div></li><li><div>      include( RTMEDIA_PATH . 'app/main/controllers/template/rtmedia-actions.php' );&nbsp;</div></li><li><div>      include( RTMEDIA_PATH . 'app/main/controllers/template/rtmedia-ajax-actions.php' );&nbsp;</div></li><li><div>      include( RTMEDIA_PATH . 'app/main/controllers/template/rtmedia-filters.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( 'intermediate_image_sizes_advanced', array( $this, 'filter_image_sizes_details' ) );&nbsp;</div></li><li><div>      add_filter( 'intermediate_image_sizes', array( $this, 'filter_image_sizes' ) );&nbsp;</div></li><li><div>      add_filter( 'site_option_upload_filetypes', array( &$this, 'filter_allow_mime_type_mu' ), 1, 1 );&nbsp;</div></li><li><div>      add_filter( 'image_size_names_choose', array( $this, 'rtmedia_custom_image_sizes_choose' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function filter_allow_mime_type_mu( $options ) {&nbsp;</div></li><li><div>      $allowed_types = array();&nbsp;</div></li><li><div>      $this-&gt;allowed_types = apply_filters( 'rtmedia_allowed_types', $this-&gt;allowed_types );&nbsp;</div></li><li><div>      foreach ( $this-&gt;allowed_types as $type ) {&nbsp;</div></li><li><div>          if ( '' !== $type['extn'] && call_user_func( 'is_rtmedia_upload_' . $type['name'] . '_enabled' ) ) {&nbsp;</div></li><li><div>              foreach ( $type['extn'] as $extn ) {&nbsp;</div></li><li><div>                  $allowed_types[] = $extn;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $ext = apply_filters( 'rtmedia_plupload_files_filter', array(&nbsp;</div></li><li><div>          array(&nbsp;</div></li><li><div>              'title' =&gt; 'Media Files', &nbsp;</div></li><li><div>              'extensions' =&gt; implode( ', ', $allowed_types ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      $ext_arr = explode( ', ', $ext[0]['extensions'] );&nbsp;</div></li><li><div>      $options = trim( $options );&nbsp;</div></li><li><div>      foreach ( $ext_arr as $f_ext ) {&nbsp;</div></li><li><div>          if ( $f_ext && strpos( $options, $f_ext ) === false ) {&nbsp;</div></li><li><div>              $options .= ' ' . $f_ext;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $options;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function fix_parent_id() {&nbsp;</div></li><li><div>      $site_global = rtmedia_get_site_option( 'rtmedia-global-albums' );&nbsp;</div></li><li><div>      if ( $site_global && is_array( $site_global ) && isset( $site_global[0] ) ) {&nbsp;</div></li><li><div>          $model = new RTMediaModel();&nbsp;</div></li><li><div>          $album_row = $model-&gt;get_by_id( $site_global[0] );&nbsp;</div></li><li><div>          if ( isset( $album_row['result'] ) && count( $album_row['result'] ) &gt; 0 ) {&nbsp;</div></li><li><div>              global $wpdb;&nbsp;</div></li><li><div>              $row = $album_row['result'][0];&nbsp;</div></li><li><div>              if ( isset( $row['media_id'] ) ) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// @codingStandardsIgnoreStart</span></span>&nbsp;</div></li><li><div>                  $sql = $wpdb-&gt;prepare( &quot;update $wpdb-&gt;posts p&nbsp;</div></li><li><div>                              left join&nbsp;</div></li><li><div>                          $model-&gt;table_name r ON ( p.ID = r.media_id and blog_id = %d )&nbsp;</div></li><li><div>                      set&nbsp;</div></li><li><div>                          post_parent = %d&nbsp;</div></li><li><div>                      where&nbsp;</div></li><li><div>                          p.guid like %s&nbsp;</div></li><li><div>                              and (p.post_parent = 0 or p.post_parent is NULL)&nbsp;</div></li><li><div>                              and not r.id is NULL&nbsp;</div></li><li><div>                              and r.media_type &lt;&gt; 'album'&quot;, get_current_blog_id(), $row['media_id'], '%/rtMedia/%' );&nbsp;</div></li><li><div>                  $wpdb-&gt;query( $sql );&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// @codingStandardsIgnoreEnd</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function fix_privacy() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $update_sql = &quot;UPDATE {$model-&gt;table_name} SET privacy = '80' where privacy = '-1' &quot;;&nbsp;</div></li><li><div>      $wpdb-&gt;query( $update_sql ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Update media privacy of the medias having context=group</span>&nbsp;</div></li><li><div><span class="comment">   * update privacy of groups medias according to the privacy of the group 0-&gt;public, 20-&gt; private/hidden</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function fix_group_media_privacy() {&nbsp;</div></li><li><div>      <span class="comment">//if buddypress is active and groups are enabled</span>&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>      $table_exist = false;&nbsp;</div></li><li><div>      if ( $wpdb-&gt;query( &quot;SHOW TABLES LIKE '{$wpdb-&gt;prefix}bp_groups'&quot; ) ) {&nbsp;</div></li><li><div>          $table_exist = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( class_exists( 'BuddyPress' ) && $table_exist ) {&nbsp;</div></li><li><div>          $model = new RTMediaModel();&nbsp;</div></li><li><div>          $sql_group = &quot; UPDATE $model-&gt;table_name m join {$wpdb-&gt;prefix}bp_groups bp on m.context_id = bp.id SET m.privacy = 0 where m.context = 'group' and bp.status = 'public' and m.privacy &lt;&gt; 80 &quot;;&nbsp;</div></li><li><div>          $wpdb-&gt;query( $sql_group ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span>&nbsp;</div></li><li><div>          $sql_group = &quot; UPDATE $model-&gt;table_name m join {$wpdb-&gt;prefix}bp_groups bp on m.context_id = bp.id SET m.privacy = 20 where m.context = 'group' and ( bp.status = 'private' OR bp.status = 'hidden' ) and m.privacy &lt;&gt; 80 &quot;;&nbsp;</div></li><li><div>          $wpdb-&gt;query( $sql_group ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function fix_db_collation() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $interaction_model = new RTMediaInteractionModel();&nbsp;</div></li><li><div>      $update_media_sql = 'ALTER TABLE ' . $model-&gt;table_name . ' CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci';&nbsp;</div></li><li><div>      $wpdb-&gt;query( $update_media_sql ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span>&nbsp;</div></li><li><div>      $update_media_meta_sql = 'ALTER TABLE ' . $wpdb-&gt;base_prefix . $model-&gt;meta_table_name . ' CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci';&nbsp;</div></li><li><div>      $wpdb-&gt;query( $update_media_meta_sql ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span>&nbsp;</div></li><li><div>      $update_media_interaction_sql = 'ALTER TABLE ' . $interaction_model-&gt;table_name . ' CONVERT TO CHARACTER SET utf8 COLLATE utf8_general_ci';&nbsp;</div></li><li><div>      $wpdb-&gt;query( $update_media_interaction_sql ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function set_site_options() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $rtmedia_options = rtmedia_get_site_option( 'rtmedia-options' );&nbsp;</div></li><li><div>      $bp_media_options = rtmedia_get_site_option( 'bp_media_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( false === $rtmedia_options ) {&nbsp;</div></li><li><div>          $this-&gt;init_site_options();&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">/** if new options added via filter then it needs to be updated */</span>&nbsp;</div></li><li><div>          $this-&gt;options = $rtmedia_options;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;add_image_sizes();&nbsp;</div></li><li><div>      $this-&gt;set_image_quality();&nbsp;</div></li><li><div>      $this-&gt;comment_auto_complete();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * add filter that is being given in the buddypress plugin which add the JS and CSS for autocomplete</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * More deatils on: http://hookr.io/functions/bp_activity_maybe_load_mentions_scripts/</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function comment_auto_complete( $rtmedia_options = false, $bp_media_options = false ) {&nbsp;</div></li><li><div>      add_filter( 'bp_activity_maybe_load_mentions_scripts', array( $this, 'rtmedia_bp_activity_maybe_load_mentions_scripts_callback' ), 10001, 2 );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Always set to true when call on any of the Buddypress Pages</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param       bool       $load_mentions</span>&nbsp;</div></li><li><div><span class="comment">   * @param       bool       $$mentions_enabled</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return      bool     true</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function rtmedia_bp_activity_maybe_load_mentions_scripts_callback( $load_mentions, $mentions_enabled ) {&nbsp;</div></li><li><div>      $load_mentions = true;&nbsp;</div></li><li><div>      return $load_mentions;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function set_image_quality() {&nbsp;</div></li><li><div>      add_filter( 'jpeg_quality', array( $this, 'rtmedia_jpeg_quality' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function rtmedia_jpeg_quality( $quality ) {&nbsp;</div></li><li><div>      $quality = isset( $this-&gt;options['general_jpeg_image_quality'] ) ? $this-&gt;options['general_jpeg_image_quality'] : 90;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $quality;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function image_sizes() {&nbsp;</div></li><li><div>      $image_sizes = array();&nbsp;</div></li><li><div>      $image_sizes['thumbnail'] = array(&nbsp;</div></li><li><div>          'width' =&gt; $this-&gt;options['defaultSizes_photo_thumbnail_width'], &nbsp;</div></li><li><div>          'height' =&gt; $this-&gt;options['defaultSizes_photo_thumbnail_height'], &nbsp;</div></li><li><div>          'crop' =&gt; ( 0 === intval( $this-&gt;options['defaultSizes_photo_thumbnail_crop'] ) ) ? false : true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $image_sizes['activity'] = array(&nbsp;</div></li><li><div>          'width' =&gt; $this-&gt;options['defaultSizes_photo_medium_width'], &nbsp;</div></li><li><div>          'height' =&gt; $this-&gt;options['defaultSizes_photo_medium_height'], &nbsp;</div></li><li><div>          'crop' =&gt; ( 0 === intval( $this-&gt;options['defaultSizes_photo_medium_crop'] ) ) ? false : true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $image_sizes['single'] = array(&nbsp;</div></li><li><div>          'width' =&gt; $this-&gt;options['defaultSizes_photo_large_width'], &nbsp;</div></li><li><div>          'height' =&gt; $this-&gt;options['defaultSizes_photo_large_height'], &nbsp;</div></li><li><div>          'crop' =&gt; ( 0 === intval( $this-&gt;options['defaultSizes_photo_large_crop'] ) ) ? false : true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $image_sizes['featured'] = array(&nbsp;</div></li><li><div>          'width' =&gt; $this-&gt;options['defaultSizes_featured_default_width'], &nbsp;</div></li><li><div>          'height' =&gt; $this-&gt;options['defaultSizes_featured_default_height'], &nbsp;</div></li><li><div>          'crop' =&gt; ( 0 === intval( $this-&gt;options['defaultSizes_featured_default_crop'] ) ) ? false : true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $image_sizes;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function add_image_sizes() {&nbsp;</div></li><li><div>      $bp_media_sizes = $this-&gt;image_sizes();&nbsp;</div></li><li><div>      add_image_size( 'rt_media_thumbnail', $bp_media_sizes['thumbnail']['width'], $bp_media_sizes['thumbnail']['height'], $bp_media_sizes['thumbnail']['crop'] );&nbsp;</div></li><li><div>      add_image_size( 'rt_media_activity_image', $bp_media_sizes['activity']['width'], $bp_media_sizes['activity']['height'], $bp_media_sizes['activity']['crop'] );&nbsp;</div></li><li><div>      add_image_size( 'rt_media_single_image', $bp_media_sizes['single']['width'], $bp_media_sizes['single']['height'], $bp_media_sizes['single']['crop'] );&nbsp;</div></li><li><div>      add_image_size( 'rt_media_featured_image', $bp_media_sizes['featured']['width'], $bp_media_sizes['featured']['height'], $bp_media_sizes['featured']['crop'] );&nbsp;</div></li><li><div>      add_action( 'wp_head', array( &$this, 'custom_style_for_image_size' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function custom_style_for_image_size() {&nbsp;</div></li><li><div>      if ( apply_filters( 'rtmedia_custom_image_style', true ) ) {&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;style type=&quot;text/css&quot;&gt;&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>              $this-&gt;custom_style_for_activity_image_size();&nbsp;</div></li><li><div>              global $rtmedia;&nbsp;</div></li><li><div>              if ( isset( $rtmedia-&gt;options['general_masonry_layout'] ) && 1 === intval( $rtmedia-&gt;options['general_masonry_layout'] ) ) {&nbsp;</div></li><li><div>                  $this-&gt;custom_style_for_gallery_image_size_masonry();&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $this-&gt;custom_style_for_gallery_image_size();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              do_action( 'rtmedia_custom_styles' );&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>          &lt;/style&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function custom_style_for_activity_image_size() {&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      .rtmedia-activity-container .media-type-photo .rtmedia-item-thumbnail {&nbsp;</div></li><li><div>      max-width: &lt;?php echo esc_attr( $this-&gt;options['defaultSizes_photo_medium_width'] ); ?&gt;px;&nbsp;</div></li><li><div>      max-height: &lt;?php echo esc_attr( $this-&gt;options['defaultSizes_photo_medium_height'] ); ?&gt;px;&nbsp;</div></li><li><div>      overflow: hidden;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      .rtmedia-comment-media-container .mejs-container.mejs-video, &nbsp;</div></li><li><div>      .rtmedia-activity-container .mejs-container.mejs-video{&nbsp;</div></li><li><div>      min-height: &lt;?php echo esc_attr( $this-&gt;options['defaultSizes_video_activityPlayer_height'] ); ?&gt;px;&nbsp;</div></li><li><div>      min-width: &lt;?php echo esc_attr( $this-&gt;options['defaultSizes_video_activityPlayer_width'] ); ?&gt;px;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>      global $rtmedia;&nbsp;</div></li><li><div>      if ( rtmedia_check_comment_media_allow() && ! rtmedia_check_comment_in_commented_media_allow() ) { ?&gt;&nbsp;</div></li><li><div>              #buddypress ul.activity-list li.activity-item .activity-comments ul li form.ac-form .rtmedia-comment-media-upload, #buddypress ul.activity-list li.activity-item .activity-comments ul li form.ac-form .rtmedia-container {&nbsp;</div></li><li><div>                  display: none !important&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function custom_style_for_gallery_image_size() {&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      .rtmedia-container ul.rtmedia-list li.rtmedia-list-item div.rtmedia-item-thumbnail {&nbsp;</div></li><li><div>      width: &lt;?php echo esc_attr( $this-&gt;options['defaultSizes_photo_thumbnail_width'] ); ?&gt;px;&nbsp;</div></li><li><div>      height: &lt;?php echo esc_attr( $this-&gt;options['defaultSizes_photo_thumbnail_height'] ); ?&gt;px;&nbsp;</div></li><li><div>      line-height: &lt;?php echo esc_attr( $this-&gt;options['defaultSizes_photo_thumbnail_height'] ); ?&gt;px;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      .rtmedia-container ul.rtmedia-list li.rtmedia-list-item div.rtmedia-item-thumbnail img {&nbsp;</div></li><li><div>      max-width: &lt;?php echo esc_attr( $this-&gt;options['defaultSizes_photo_thumbnail_width'] ); ?&gt;px;&nbsp;</div></li><li><div>      max-height: &lt;?php echo esc_attr( $this-&gt;options['defaultSizes_photo_thumbnail_height'] ); ?&gt;px;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      .rtmedia-container .rtmedia-list  .rtmedia-list-item {&nbsp;</div></li><li><div>      width: &lt;?php echo intval( $this-&gt;options['defaultSizes_photo_thumbnail_width'] ); ?&gt;px;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function custom_style_for_gallery_image_size_masonry() {&nbsp;</div></li><li><div>      if ( intval( $this-&gt;options['defaultSizes_photo_thumbnail_height'] ) &gt; 0 ) {&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          .rtmedia-container .rtmedia-list  .rtmedia-list-item .rtmedia-item-thumbnail {&nbsp;</div></li><li><div>          max-height: &lt;?php echo intval( $this-&gt;options['defaultSizes_photo_thumbnail_height'] ); ?&gt;px;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( intval( $this-&gt;options['defaultSizes_photo_thumbnail_width'] ) &gt; 0 ) {&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          .rtmedia-container .rtmedia-list  .rtmedia-list-item .rtmedia-item-thumbnail {&nbsp;</div></li><li><div>          max-width: &lt;?php echo intval( $this-&gt;options['defaultSizes_photo_thumbnail_width'] ); ?&gt;px;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   *  Default allowed media types array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function set_allowed_types() {&nbsp;</div></li><li><div>      $allowed_types = array(&nbsp;</div></li><li><div>          'photo' =&gt; array(&nbsp;</div></li><li><div>              'name' =&gt; 'photo', &nbsp;</div></li><li><div>              'plural' =&gt; 'photos', &nbsp;</div></li><li><div>              'label' =&gt; esc_html__( 'Photo', 'buddypress-media' ), &nbsp;</div></li><li><div>              'plural_label' =&gt; esc_html__( 'Photos', 'buddypress-media' ), &nbsp;</div></li><li><div>              'extn' =&gt; array( 'jpg', 'jpeg', 'png', 'gif' ), &nbsp;</div></li><li><div>              'thumbnail' =&gt; RTMEDIA_URL . 'app/assets/admin/img/image_thumb.png', &nbsp;</div></li><li><div>              'settings_visibility' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'video' =&gt; array(&nbsp;</div></li><li><div>              'name' =&gt; 'video', &nbsp;</div></li><li><div>              'plural' =&gt; 'videos', &nbsp;</div></li><li><div>              'label' =&gt; esc_html__( 'Video', 'buddypress-media' ), &nbsp;</div></li><li><div>              'plural_label' =&gt; esc_html__( 'Videos', 'buddypress-media' ), &nbsp;</div></li><li><div>              'extn' =&gt; array( 'mp4' ), &nbsp;</div></li><li><div>              'thumbnail' =&gt; RTMEDIA_URL . 'app/assets/admin/img/video_thumb.png', &nbsp;</div></li><li><div>              'settings_visibility' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'music' =&gt; array(&nbsp;</div></li><li><div>              'name' =&gt; 'music', &nbsp;</div></li><li><div>              'plural' =&gt; 'music', &nbsp;</div></li><li><div>              'label' =&gt; esc_html__( 'Music', 'buddypress-media' ), &nbsp;</div></li><li><div>              'plural_label' =&gt; esc_html__( 'Music', 'buddypress-media' ), &nbsp;</div></li><li><div>              'extn' =&gt; array( 'mp3' ), &nbsp;</div></li><li><div>              'thumbnail' =&gt; RTMEDIA_URL . 'app/assets/admin/img/audio_thumb.png', &nbsp;</div></li><li><div>              'settings_visibility' =&gt; true, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// filter for hooking additional media types</span>&nbsp;</div></li><li><div>      $allowed_types = apply_filters( 'rtmedia_allowed_types', $allowed_types );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// sanitize all the types</span>&nbsp;</div></li><li><div>      $allowed_types = $this-&gt;sanitize_allowed_types( $allowed_types );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// set the allowed types property</span>&nbsp;</div></li><li><div>      $this-&gt;allowed_types = $allowed_types;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Sanitize all media sizes after hooking custom media types</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $allowed_types allowed media types after hooking custom types</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array $allowed_types sanitized media types</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function sanitize_allowed_types( $allowed_types ) {&nbsp;</div></li><li><div>      <span class="comment">// check if the array is formatted properly</span>&nbsp;</div></li><li><div>      if ( ! is_array( $allowed_types ) && count( $allowed_types ) &lt; 1 ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//loop through each type</span>&nbsp;</div></li><li><div>      foreach ( $allowed_types as $key =&gt; &$type ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! isset( $type['name'] ) || <span class="comment">// check if a name is set</span>&nbsp;</div></li><li><div>              empty( $type['name'] ) ||&nbsp;</div></li><li><div>              <span class="comment">//commented this section for playlist // !isset($type['extn']) || // check if file extensions are set</span>&nbsp;</div></li><li><div>              <span class="comment">//commented this section for playlist  // empty($type['extn']) ||</span>&nbsp;</div></li><li><div>              strstr( $type['name'], ' ' ) || strstr( $type['name'], '_' )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>              unset( $allowed_types[ $key ] ); <span class="comment">// if not unset this type</span>&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $slug = strtoupper( $type['name'] );&nbsp;</div></li><li><div>          if ( defined( 'RTMEDIA_' . $slug . '_LABEL' ) ) {&nbsp;</div></li><li><div>              $type['label'] = constant( 'RTMEDIA_' . $slug . '_LABEL' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( defined( 'RTMEDIA_' . $slug . '_PLURAL_LABEL' ) ) {&nbsp;</div></li><li><div>              $type['plural_label'] = constant( 'RTMEDIA_' . $slug . '_PLURAL_LABEL' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          <span class="comment">// if thumbnail is not supplied, use the default thumbnail</span>&nbsp;</div></li><li><div>          if ( ! isset( $type['thumbnail'] ) || empty( $type['thumbnail'] ) ) {&nbsp;</div></li><li><div>              $type['thumbnail'] = $this-&gt;default_thumbnail;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $allowed_types;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set the default sizes</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function set_default_sizes() {&nbsp;</div></li><li><div>      $this-&gt;default_sizes = array(&nbsp;</div></li><li><div>          'photo' =&gt; array(&nbsp;</div></li><li><div>              'thumbnail' =&gt; array( 'width' =&gt; 150, 'height' =&gt; 150, 'crop' =&gt; 1 ), &nbsp;</div></li><li><div>              'medium' =&gt; array( 'width' =&gt; 320, 'height' =&gt; 240, 'crop' =&gt; 1 ), &nbsp;</div></li><li><div>              'large' =&gt; array( 'width' =&gt; 800, 'height' =&gt; 0, 'crop' =&gt; 1 ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'video' =&gt; array(&nbsp;</div></li><li><div>              'activityPlayer' =&gt; array( 'width' =&gt; 320, 'height' =&gt; 240 ), &nbsp;</div></li><li><div>              'singlePlayer' =&gt; array( 'width' =&gt; 640, 'height' =&gt; 480 ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'music' =&gt; array(&nbsp;</div></li><li><div>              'activityPlayer' =&gt; array( 'width' =&gt; 320 ), &nbsp;</div></li><li><div>              'singlePlayer' =&gt; array( 'width' =&gt; 640 ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'featured' =&gt; array(&nbsp;</div></li><li><div>              'default' =&gt; array( 'width' =&gt; 100, 'height' =&gt; 100, 'crop' =&gt; 1 ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;default_sizes = apply_filters( 'rtmedia_allowed_sizes', $this-&gt;default_sizes );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Set privacy options</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function set_privacy() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;privacy_settings = array(&nbsp;</div></li><li><div>          'levels' =&gt; array(&nbsp;</div></li><li><div>              60 =&gt; esc_html__( 'Private - Visible only to the user', 'buddypress-media' ), &nbsp;</div></li><li><div>              40 =&gt; esc_html__( 'Friends - Visible to user\'s friends', 'buddypress-media' ), &nbsp;</div></li><li><div>              20 =&gt; esc_html__( 'Logged in Users - Visible to registered users', 'buddypress-media' ), &nbsp;</div></li><li><div>              0 =&gt; esc_html__( 'Public - Visible to the world', 'buddypress-media' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $this-&gt;privacy_settings = apply_filters( 'rtmedia_privacy_levels', $this-&gt;privacy_settings );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( function_exists( 'bp_is_active' ) && ! bp_is_active( 'friends' ) ) {&nbsp;</div></li><li><div>          unset( $this-&gt;privacy_settings['levels'][40] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Load admin screens</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @global RTMediaAdmin $rtmedia_admin Class for loading admin screen</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function admin_init() {&nbsp;</div></li><li><div>      global $rtmedia_admin;&nbsp;</div></li><li><div>      $rtmedia_admin = new RTMediaAdmin();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function media_screen() {&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function get_user_link( $user ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( function_exists( 'bp_core_get_user_domain' ) ) {&nbsp;</div></li><li><div>          $parent_link = bp_core_get_user_domain( $user );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $parent_link = get_author_posts_url( $user );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $parent_link;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function init_buddypress_options() {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * BuddyPress Settings</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $bp_media_options = rtmedia_get_site_option( 'bp_media_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $group = 0;&nbsp;</div></li><li><div>      if ( isset( $bp_media_options['enable_on_group'] ) && ! empty( $bp_media_options['enable_on_group'] ) ) {&nbsp;</div></li><li><div>          $group = $bp_media_options['enable_on_group'];&nbsp;</div></li><li><div>      } else if ( function_exists( 'bp_is_active' ) ) {&nbsp;</div></li><li><div>          $group = bp_is_active( 'groups' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;options['buddypress_enableOnGroup'] = $group;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $activity = 0;&nbsp;</div></li><li><div>      if ( isset( $bp_media_options['activity_upload'] ) && ! empty( $bp_media_options['activity_upload'] ) ) {&nbsp;</div></li><li><div>          $activity = $bp_media_options['activity_upload'];&nbsp;</div></li><li><div>      } else if ( function_exists( 'bp_is_active' ) ) {&nbsp;</div></li><li><div>          $activity = bp_is_active( 'activity' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;options['buddypress_enableOnActivity'] = $activity;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;options['buddypress_enableOnProfile'] = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Last settings updated in options. Update them in DB & after this no other option would be saved in db */</span>&nbsp;</div></li><li><div>      rtmedia_update_site_option( 'rtmedia-options', $this-&gt;options );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  public function init_site_options() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $bp_media_options = rtmedia_get_site_option( 'bp_media_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $defaults = array(&nbsp;</div></li><li><div>          'general_enableAlbums' =&gt; 1, &nbsp;</div></li><li><div>          'general_enableComments' =&gt; 0, &nbsp;</div></li><li><div>          'general_downloadButton' =&gt; ( isset( $bp_media_options['download_enabled'] ) ) ? $bp_media_options['download_enabled'] : 0, &nbsp;</div></li><li><div>          'general_enableLightbox' =&gt; ( isset( $bp_media_options['enable_lightbox'] ) ) ? $bp_media_options['enable_lightbox'] : 1, &nbsp;</div></li><li><div>          'general_perPageMedia' =&gt; ( isset( $bp_media_options['default_count'] ) ) ? $bp_media_options['default_count'] : 10, &nbsp;</div></li><li><div>          'general_enableMediaEndPoint' =&gt; 0, &nbsp;</div></li><li><div>          'general_showAdminMenu' =&gt; ( isset( $bp_media_options['show_admin_menu'] ) ) ? $bp_media_options['show_admin_menu'] : 0, &nbsp;</div></li><li><div>          'general_videothumbs' =&gt; 2, &nbsp;</div></li><li><div>          'general_jpeg_image_quality' =&gt; 90, &nbsp;</div></li><li><div>          'general_AllowUserData' =&gt; 1, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $this-&gt;allowed_types as $type ) {&nbsp;</div></li><li><div>          <span class="comment">// invalid keys handled in sanitize method</span>&nbsp;</div></li><li><div>          $defaults[ 'allowedTypes_' . $type['name'] . '_enabled' ]  = 1;&nbsp;</div></li><li><div>          $defaults[ 'allowedTypes_' . $type['name'] . '_featured' ] = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Previous Sizes values from buddypress is migrated */</span>&nbsp;</div></li><li><div>      foreach ( $this-&gt;default_sizes as $type =&gt; $type_value ) {&nbsp;</div></li><li><div>          foreach ( $type_value as $size =&gt; $size_value ) {&nbsp;</div></li><li><div>              foreach ( $size_value as $dimension =&gt; $value ) {&nbsp;</div></li><li><div>                  switch ( $type ) {&nbsp;</div></li><li><div>                      case 'photo':&nbsp;</div></li><li><div>                          if ( isset( $bp_media_options['sizes']['image'][ $size ][ $dimension ] ) && ! empty( $bp_media_options['sizes']['image'][ $size ][ $dimension ] ) ) {&nbsp;</div></li><li><div>                              $value = $bp_media_options['sizes']['image'][ $size ][ $dimension ];&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                      case 'video':&nbsp;</div></li><li><div>                      case 'music':&nbsp;</div></li><li><div>                          $old = ( 'video' === $type ) ? 'video' : ( 'music' === $type ) ? 'audio' : '';&nbsp;</div></li><li><div>                          switch ( $size ) {&nbsp;</div></li><li><div>                              case 'activityPlayer':&nbsp;</div></li><li><div>                                  if ( isset( $bp_media_options['sizes'][ $old ]['medium'][ $dimension ] ) && ! empty( $bp_media_options['sizes'][ $old ]['medium'][ $dimension ] ) ) {&nbsp;</div></li><li><div>                                      $value = $bp_media_options['sizes'][ $old ]['medium'][ $dimension ];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  break;&nbsp;</div></li><li><div>                              case 'singlePlayer':&nbsp;</div></li><li><div>                                  if ( isset( $bp_media_options['sizes'][ $old ]['large'][ $dimension ] ) && ! empty( $bp_media_options['sizes'][ $old ]['large'][ $dimension ] ) ) {&nbsp;</div></li><li><div>                                      $value = $bp_media_options['sizes'][ $old ]['large'][ $dimension ];&nbsp;</div></li><li><div>                                  }&nbsp;</div></li><li><div>                                  break;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                          break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $defaults[ 'defaultSizes_' . $type . '_' . $size . '_' . $dimension ] = $value;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Privacy */</span>&nbsp;</div></li><li><div>      $defaults['privacy_enabled'] = ( isset( $bp_media_options['privacy_enabled'] ) ) ? $bp_media_options['privacy_enabled'] : 0;&nbsp;</div></li><li><div>      $defaults['privacy_default'] = ( isset( $bp_media_options['default_privacy_level'] ) ) ? $bp_media_options['default_privacy_level'] : 0;&nbsp;</div></li><li><div>      $defaults['privacy_userOverride'] = ( isset( $bp_media_options['privacy_override_enabled'] ) ) ? $bp_media_options['privacy_override_enabled'] : 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $defaults['styles_custom'] = ( isset( $bp_media_options['styles_custom'] ) ) ? $bp_media_options['styles_custom'] : '';&nbsp;</div></li><li><div>      $defaults['styles_enabled'] = ( isset( $bp_media_options['styles_enabled'] ) ) ? $bp_media_options['styles_enabled'] : 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;options = $defaults;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;init_buddypress_options();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Defines all the constants if undefined. Can be overridden by</span>&nbsp;</div></li><li><div><span class="comment">   * defining them elsewhere, say wp-config.php</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function constants() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** If the plugin is installed. */</span>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_IS_INSTALLED' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_IS_INSTALLED', 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Required Version  */</span>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_REQUIRED_BP' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_REQUIRED_BP', '1.7' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Slug Constants for building urls */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Media slugs */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_MEDIA_SLUG' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_MEDIA_SLUG', 'media' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_MEDIA_LABEL' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_MEDIA_LABEL', esc_html__( 'Media', 'buddypress-media' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_ALL_SLUG' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_ALL_SLUG', 'all' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_ALL_LABEL' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_ALL_LABEL', esc_html__( 'All', 'buddypress-media' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_ALBUM_SLUG' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_ALBUM_SLUG', 'album' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_ALBUM_PLURAL_SLUG' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_ALBUM_PLURAL_SLUG', 'albums' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_ALBUM_LABEL' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_ALBUM_LABEL', esc_html__( 'Album', 'buddypress-media' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_ALBUM_PLURAL_LABEL' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_ALBUM_PLURAL_LABEL', esc_html__( 'Albums', 'buddypress-media' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">/** Upload slug */</span></span>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_UPLOAD_SLUG' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_UPLOAD_SLUG', 'upload' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">/** Upload slug */</span></span>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_UPLOAD_LABEL' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_UPLOAD_LABEL', esc_html__( 'Upload', 'buddypress-media' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Global Album/Wall Post */</span>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_GLOBAL_ALBUM_LABEL' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_GLOBAL_ALBUM_LABEL', esc_html__( 'Wall Post', 'buddypress-media' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;define_type_constants();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function define_type_constants() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! isset( $this-&gt;allowed_types ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      foreach ( $this-&gt;allowed_types as $type ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! isset( $type['name'] ) || '' === $type['name'] ) {&nbsp;</div></li><li><div>              continue;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $name = $type['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $type['plural'] ) && '' !== $type['plural'] ) {&nbsp;</div></li><li><div>              $plural = $type['plural'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $plural = $name . 's';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $type['label'] ) && '' !== $type['label'] ) {&nbsp;</div></li><li><div>              $label = $type['label'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $label = ucfirst( $name );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $type['plural_label'] ) && '' !== $type['plural_label'] ) {&nbsp;</div></li><li><div>              $label_plural = $type['plural_label'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $label_plural = ucfirst( $plural );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $slug = strtoupper( $name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! defined( 'RTMEDIA_' . $slug . '_SLUG' ) ) {&nbsp;</div></li><li><div>              define( 'RTMEDIA_' . $slug . '_SLUG', $name );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! defined( 'RTMEDIA_' . $slug . '_PLURAL_SLUG' ) ) {&nbsp;</div></li><li><div>              define( 'RTMEDIA_' . $slug . '_PLURAL_SLUG', $plural );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! defined( 'RTMEDIA_' . $slug . '_LABEL' ) ) {&nbsp;</div></li><li><div>              define( 'RTMEDIA_' . $slug . '_LABEL', $label );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( ! defined( 'RTMEDIA_' . $slug . '_PLURAL_LABEL' ) ) {&nbsp;</div></li><li><div>              define( 'RTMEDIA_' . $slug . '_PLURAL_LABEL', $label_plural );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Hooks the plugin into BuddyPress via 'bp_include' action.</span>&nbsp;</div></li><li><div><span class="comment">   * Initialises the plugin's functionalities, options, </span>&nbsp;</div></li><li><div><span class="comment">   * loads media for Profiles and Groups.</span>&nbsp;</div></li><li><div><span class="comment">   * Creates Admin panels</span>&nbsp;</div></li><li><div><span class="comment">   * Loads accessory functions</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @global BPMediaAdmin $bp_media_admin</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function init() {&nbsp;</div></li><li><div>      <span class="comment">// set metatable in $wpdb</span>&nbsp;</div></li><li><div>      $this-&gt;set_rtmedia_meta_wpdbfix();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// rtMedia db upgrade</span>&nbsp;</div></li><li><div>      add_action( 'rt_db_upgrade', array( $this, 'fix_parent_id' ) );&nbsp;</div></li><li><div>      add_action( 'rt_db_upgrade', array( $this, 'fix_privacy' ) );&nbsp;</div></li><li><div>      add_action( 'rt_db_upgrade', array( $this, 'fix_group_media_privacy' ) );&nbsp;</div></li><li><div>      add_action( 'rt_db_upgrade', array( $this, 'fix_db_collation' ) );&nbsp;</div></li><li><div>      $this-&gt;update_db();&nbsp;</div></li><li><div>      remove_action( 'rt_db_upgrade', array( $this, 'fix_parent_id' ) );&nbsp;</div></li><li><div>      remove_action( 'rt_db_upgrade', array( $this, 'fix_privacy' ) );&nbsp;</div></li><li><div>      remove_action( 'rt_db_upgrade', array( $this, 'fix_group_media_privacy' ) );&nbsp;</div></li><li><div>      remove_action( 'rt_db_upgrade', array( $this, 'fix_db_collation' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;set_allowed_types(); <span class="comment"><span class="comment">// Define allowed types</span></span>&nbsp;</div></li><li><div>      $this-&gt;constants(); <span class="comment">// Define constants</span>&nbsp;</div></li><li><div>      $this-&gt;redirect_on_change_slug();&nbsp;</div></li><li><div>      $this-&gt;set_default_sizes(); <span class="comment">// set default sizes</span>&nbsp;</div></li><li><div>      $this-&gt;set_privacy(); <span class="comment">// set privacy</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Load options/settings</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $this-&gt;set_site_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * BuddyPress - Media Navigation Tab Inject</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Load accessory functions</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $class_construct = array(&nbsp;</div></li><li><div>          'deprecated' =&gt; true, &nbsp;</div></li><li><div>          'interaction' =&gt; true, &nbsp;</div></li><li><div>          'upload_shortcode' =&gt; false, &nbsp;</div></li><li><div>          'gallery_shortcode' =&gt; false, &nbsp;</div></li><li><div>          'upload_endpoint' =&gt; false, &nbsp;</div></li><li><div>          'privacy' =&gt; false, &nbsp;</div></li><li><div>          'nav' =&gt; true, &nbsp;</div></li><li><div>          'like' =&gt; false, &nbsp;</div></li><li><div>          'featured' =&gt; false, &nbsp;</div></li><li><div>          'GroupFeatured' =&gt; false, &nbsp;</div></li><li><div>          'ViewCount' =&gt; false, &nbsp;</div></li><li><div>          'GalleryItemAction' =&gt; false, &nbsp;</div></li><li><div>          'LoginPopup' =&gt; false, &nbsp;</div></li><li><div>          'CommentNotification' =&gt; false, &nbsp;</div></li><li><div>          'LikeNotification' =&gt; false, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      global $rtmedia_nav;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** Legacy code for Add-ons * */</span>&nbsp;</div></li><li><div>      $bp_class_construct = apply_filters( 'bpmedia_class_construct', array() );&nbsp;</div></li><li><div>      foreach ( $bp_class_construct as $classname =&gt; $global_scope ) {&nbsp;</div></li><li><div>          $class = 'BPMedia' . ucfirst( $classname );&nbsp;</div></li><li><div>          if ( class_exists( $class ) ) {&nbsp;</div></li><li><div>              if ( true === $global_scope ) {&nbsp;</div></li><li><div>                  global ${'bp_media_' . $classname};&nbsp;</div></li><li><div>                  ${'bp_media_' . $classname} = new $class();&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  new $class();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">/** ------------------- * */</span>&nbsp;</div></li><li><div>      $class_construct = apply_filters( 'rtmedia_class_construct', $class_construct );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $class_construct['Group'] = false; <span class="comment">// will be constructed after rtmedia pro class.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $class_construct as $key =&gt; $global_scope ) {&nbsp;</div></li><li><div>          $classname = '';&nbsp;</div></li><li><div>          $ck = explode( '_', $key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $ck as $cn ) {&nbsp;</div></li><li><div>              $classname .= ucfirst( $cn );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $class = 'RTMedia' . $classname;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( class_exists( $class ) ) {&nbsp;</div></li><li><div>              if ( true === $global_scope ) {&nbsp;</div></li><li><div>                  global ${'rtmedia_' . $key};&nbsp;</div></li><li><div>                  ${'rtmedia_' . $key} = new $class();&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  new $class();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;set_allowed_types(); <span class="comment"><span class="comment">// Define allowed types</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $rtmedia_buddypress_activity;&nbsp;</div></li><li><div>      $rtmedia_buddypress_activity = new RTMediaBuddyPressActivity();&nbsp;</div></li><li><div>      $media = new RTMediaMedia();&nbsp;</div></li><li><div>      $media-&gt;delete_hook();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $rtmedia_ajax;&nbsp;</div></li><li><div>      $rtmedia_ajax = new RTMediaAJAX();&nbsp;</div></li><li><div>      <span class="comment">//API Classes</span>&nbsp;</div></li><li><div>      global $rtmediajsonapi;&nbsp;</div></li><li><div>      $rtmediajsonapi = new RTMediaJsonApi();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if( function_exists( 'rtmedia_enable_comment_media_uplaod' ) ) {&nbsp;</div></li><li><div>          rtmedia_enable_comment_media_uplaod();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      do_action( 'bp_media_init' ); <span class="comment">// legacy For plugin using this actions</span>&nbsp;</div></li><li><div>      do_action( 'rtmedia_init' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function set_rtmedia_meta_wpdbfix() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>      $media_meta = new RTMediaMeta();&nbsp;</div></li><li><div>      $wpdb-&gt;mediameta = $media_meta-&gt;model-&gt;table_name;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function redirect_on_change_slug() {&nbsp;</div></li><li><div>      $old_slugs = rtmedia_get_site_option( 'rtmedia_old_media_slug', false, true );&nbsp;</div></li><li><div>      $current_slugs = rtmedia_get_site_option( 'rtmedia_current_media_slug', false, false );&nbsp;</div></li><li><div>      if ( false === $current_slugs ) {&nbsp;</div></li><li><div>          rtmedia_update_site_option( 'rtmedia_current_media_slug', RTMEDIA_MEDIA_SLUG );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( RTMEDIA_MEDIA_SLUG === $current_slugs ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( false === $old_slugs ) {&nbsp;</div></li><li><div>          $old_slugs = array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $old_slugs[] = $current_slugs;&nbsp;</div></li><li><div>      rtmedia_update_site_option( 'rtmedia_current_media_slug', RTMEDIA_MEDIA_SLUG );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Loads translations</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  static&nbsp;</div></li><li><div>  function load_translation() {&nbsp;</div></li><li><div>      load_plugin_textdomain( 'buddypress-media', false, basename( RTMEDIA_PATH ) . '/languages/' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function check_global_album() {&nbsp;</div></li><li><div>      <span class="comment">//todo: Nonce required</span>&nbsp;</div></li><li><div>      $album = new RTMediaAlbum();&nbsp;</div></li><li><div>      $global_album = $album-&gt;get_default();&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// @codingStandardsIgnoreStart</span></span>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">//**</span> Hack for plupload default name</span>&nbsp;</div></li><li><div>      if ( isset( $_POST['action'] ) && isset( $_POST['mode'] ) && 'file_upload' === sanitize_text_field( $_POST['mode'] ) ) {&nbsp;</div></li><li><div>          unset( $_POST['name'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// @codingStandardsIgnoreEnd</span></span>&nbsp;</div></li><li><div>      <span class="comment">//**</span>&nbsp;</div></li><li><div>      global $rtmedia_error;&nbsp;</div></li><li><div>      if ( isset( $rtmedia_error ) && true === $rtmedia_error ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ! $global_album ) {&nbsp;</div></li><li><div>          $global_album = $album-&gt;add_global( esc_html__( 'Wall Posts', 'buddypress-media' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// fix multisite global album doesn't exist issue.</span>&nbsp;</div></li><li><div>      if ( is_multisite() && ! rtmedia_get_site_option( 'rtmedia_fix_multisite_global_albums', false ) ) {&nbsp;</div></li><li><div>          $model = new RTMediaModel();&nbsp;</div></li><li><div>          $global_albums = rtmedia_global_albums();&nbsp;</div></li><li><div>          $album_objects = $model-&gt;get_media( array( 'id' =&gt; ( $global_albums ) ), false, false );&nbsp;</div></li><li><div>          if ( empty( $album_objects ) ) {&nbsp;</div></li><li><div>              $global_album = $album-&gt;add_global( esc_html__( 'Wall Posts', 'buddypress-media' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          rtmedia_update_site_option( 'rtmedia_fix_multisite_global_albums', true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function default_count() {&nbsp;</div></li><li><div>      $count = $this-&gt;posts_per_page;&nbsp;</div></li><li><div>      if ( array_key_exists( 'default_count', $this-&gt;options ) ) {&nbsp;</div></li><li><div>          $count = $this-&gt;options['default_count'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $count = ( ! is_int( $count ) ) ? 0 : $count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return ( ! $count ) ? 10 : $count;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  static function plugin_get_version( $path = null ) {&nbsp;</div></li><li><div>      require_once( ABSPATH . 'wp-admin/includes/plugin.php' );&nbsp;</div></li><li><div>      $path = ( $path ) ? $path : RTMEDIA_PATH . 'index.php';&nbsp;</div></li><li><div>      $plugin_data = get_plugin_data( $path );&nbsp;</div></li><li><div>      $plugin_version = $plugin_data['Version'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $plugin_version;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function update_db() {&nbsp;</div></li><li><div>      $update = new RTDBUpdate( false, RTMEDIA_PATH . 'index.php', RTMEDIA_PATH . 'app/schema/', true );&nbsp;</div></li><li><div>      <span class="comment">/** Current Version. */</span>&nbsp;</div></li><li><div>      if ( ! defined( 'RTMEDIA_VERSION' ) ) {&nbsp;</div></li><li><div>          define( 'RTMEDIA_VERSION', $update-&gt;db_version );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( $update-&gt;check_upgrade() ) {&nbsp;</div></li><li><div>          $update-&gt;do_upgrade();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ! $update-&gt;table_exists( $update-&gt;genrate_table_name( 'rtm_media' ) ) ) {&nbsp;</div></li><li><div>          delete_site_option( $update-&gt;get_db_version_option_name() );&nbsp;</div></li><li><div>          $update-&gt;install_db_version = '0';&nbsp;</div></li><li><div>          $update-&gt;do_upgrade();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function create_table_error_notice() {&nbsp;</div></li><li><div>      global $rtmedia_error;&nbsp;</div></li><li><div>      $rtmedia_error = true;&nbsp;</div></li><li><div>      echo &quot;&lt;div class='error'&gt;&lt;p&gt;&lt;strong&gt;&quot; . esc_html__( 'rtMedia', 'buddypress-media' ) . '&lt;/strong&gt;' . esc_html__( &quot;: Can't Create Database table. Please check create table permission.&quot;, 'buddypress-media' ) . '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function enqueue_scripts_styles() {&nbsp;</div></li><li><div>      global $rtmedia;&nbsp;</div></li><li><div>      if ( wp_script_is( 'wp-mediaelement', 'registered' ) ) {&nbsp;</div></li><li><div>          wp_enqueue_style( 'wp-mediaelement' );&nbsp;</div></li><li><div>          wp_enqueue_script( 'wp-mediaelement' );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_enqueue_script( 'wp-mediaelement', RTMEDIA_URL . 'lib/media-element/mediaelement-and-player.min.js', '', RTMEDIA_VERSION );&nbsp;</div></li><li><div>          wp_enqueue_style( 'wp-mediaelement', RTMEDIA_URL . 'lib/media-element/mediaelementplayer.min.css', '', RTMEDIA_VERSION );&nbsp;</div></li><li><div>          wp_enqueue_script( 'wp-mediaelement-start', RTMEDIA_URL . 'lib/media-element/wp-mediaelement.js', 'wp-mediaelement', RTMEDIA_VERSION, true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Dashicons: Needs if not loaded by WP</span>&nbsp;</div></li><li><div>      wp_enqueue_style( 'dashicons' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Dont enqueue rtmedia.min.css if default styles is checked false in rtmedia settings</span>&nbsp;</div></li><li><div>      $suffix = ( function_exists( 'rtm_get_script_style_suffix' ) ) ? rtm_get_script_style_suffix() : '.min';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! ( isset( $rtmedia-&gt;options ) && isset( $rtmedia-&gt;options['styles_enabled'] ) && 0 === $rtmedia-&gt;options['styles_enabled'] ) ) {&nbsp;</div></li><li><div>          wp_enqueue_style( 'rtmedia-main', RTMEDIA_URL . 'app/assets/css/rtmedia' . $suffix . '.css', '', RTMEDIA_VERSION );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' === $suffix ) {&nbsp;</div></li><li><div>          wp_enqueue_script( 'rtmedia-magnific-popup', RTMEDIA_URL . 'app/assets/js/vendors/magnific-popup.js', array(&nbsp;</div></li><li><div>              'jquery', &nbsp;</div></li><li><div>              'wp-mediaelement', &nbsp;</div></li><li><div> ), RTMEDIA_VERSION );&nbsp;</div></li><li><div>          wp_enqueue_script( 'rtmedia-admin-tabs', RTMEDIA_URL . 'app/assets/admin/js/vendors/tabs.js', array(&nbsp;</div></li><li><div>              'jquery', &nbsp;</div></li><li><div>              'wp-mediaelement', &nbsp;</div></li><li><div> ), RTMEDIA_VERSION );&nbsp;</div></li><li><div>          wp_enqueue_script( 'rtmedia-main', RTMEDIA_URL . 'app/assets/js/rtMedia.js', array(&nbsp;</div></li><li><div>              'jquery', &nbsp;</div></li><li><div>              'wp-mediaelement', &nbsp;</div></li><li><div> ), RTMEDIA_VERSION );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_enqueue_script( 'rtmedia-main', RTMEDIA_URL . 'app/assets/js/rtmedia.min.js', array(&nbsp;</div></li><li><div>              'jquery', &nbsp;</div></li><li><div>              'wp-mediaelement', &nbsp;</div></li><li><div> ), RTMEDIA_VERSION );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_ajax_url', admin_url( 'admin-ajax.php' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_media_slug', RTMEDIA_MEDIA_SLUG );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_lightbox_enabled', strval( $this-&gt;options['general_enableLightbox'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $direct_upload = ( isset( $this-&gt;options['general_direct_upload'] ) ? $this-&gt;options['general_direct_upload'] : '0' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_direct_upload_enabled', $direct_upload );&nbsp;</div></li><li><div>      <span class="comment">//gallery reload after media upload, by default true</span>&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_gallery_reload_on_upload', '1' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">//javascript messages</span>&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-magnific', 'rtmedia_load_more', esc_html__( 'Loading media', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_empty_activity_msg', esc_html__( 'Please enter some content to post.', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_empty_comment_msg', esc_html__( 'Empty Comment is not allowed.', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_media_delete_confirmation', esc_html__( 'Are you sure you want to delete this media?', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_media_comment_delete_confirmation', esc_html__( 'Are you sure you want to delete this comment?', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_album_delete_confirmation', esc_html__( 'Are you sure you want to delete this Album?', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_drop_media_msg', esc_html__( 'Drop files here', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_album_created_msg', ' ' . esc_html__( 'album created successfully.', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_something_wrong_msg', esc_html__( 'Something went wrong. Please try again.', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_empty_album_name_msg', esc_html__( 'Enter an album name.', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_max_file_msg', esc_html__( 'Max file Size Limit : ', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_allowed_file_formats', esc_html__( 'Allowed File Formats', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_select_all_visible', esc_html__( 'Select All Visible', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_unselect_all_visible', esc_html__( 'Unselect All Visible', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_no_media_selected', esc_html__( 'Please select some media.', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_selected_media_delete_confirmation', esc_html__( 'Are you sure you want to delete the selected media?', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_selected_media_move_confirmation', esc_html__( 'Are you sure you want to move the selected media?', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_waiting_msg', esc_html__( 'Waiting', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_uploaded_msg', esc_html__( 'Uploaded', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_uploading_msg', esc_html__( 'Uploading', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_upload_failed_msg', esc_html__( 'Failed', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_close', esc_html__( 'Close', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_edit', esc_html__( 'Edit', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_delete', esc_html__( 'Delete', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_edit_media', esc_html__( 'Edit Media', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_remove_from_queue', esc_html__( 'Remove from queue', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_add_more_files_msg', esc_html__( 'Add more files', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_file_extension_error_msg', esc_html__( 'File not supported', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_more', esc_html__( 'more', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_less', esc_html__( 'less', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_read_more', esc_html__( 'Read more', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia__show_less', esc_html__( 'Show less', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_activity_text_with_attachment', apply_filters( 'rtmedia_required_activity_text_with_attachment', 'disable' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_delete_uploaded_media', esc_html__( 'This media is uploaded. Are you sure you want to delete this media?', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtm_wp_version', get_bloginfo( 'version' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rMedia_loading_media', RTMEDIA_URL . 'app/assets/admin/img/boxspinner.gif' );&nbsp;</div></li><li><div>      $rtmedia_media_thumbs = array();&nbsp;</div></li><li><div>      foreach ( $this-&gt;allowed_types as $key_type =&gt; $value_type ) {&nbsp;</div></li><li><div>          $rtmedia_media_thumbs[ $key_type ] = $value_type['thumbnail'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rtmedia_media_thumbs', $rtmedia_media_thumbs );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rtmedia_set_featured_image_msg', esc_html__( 'Featured media set successfully.', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rtmedia_unset_featured_image_msg', esc_html__( 'Featured media removed successfully.', 'buddypress-media' ) );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rtmedia_edit_media_info_upload', array(&nbsp;</div></li><li><div>          'title' =&gt; esc_html__( 'Title:', 'buddypress-media' ), &nbsp;</div></li><li><div>          'description' =&gt; esc_html__( 'Description:', 'buddypress-media' ), &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Localizing strings for rtMedia.backbone.js</span>&nbsp;</div></li><li><div>      $rtmedia_backbone_strings = array(&nbsp;</div></li><li><div>          'rtm_edit_file_name' =&gt; esc_html__( 'Edit File Name', 'buddypress-media' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rtmedia_backbone_strings', $rtmedia_backbone_strings );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Localizing strings for rtMedia.js</span>&nbsp;</div></li><li><div>      $rtmedia_main_js_strings = array(&nbsp;</div></li><li><div>          'rtmedia_albums' =&gt; esc_html__( 'Albums', 'buddypress-media' ), &nbsp;</div></li><li><div>          'privacy_update_success' =&gt; esc_html__( 'Privacy updated successfully.', 'buddypress-media' ), &nbsp;</div></li><li><div>          'privacy_update_error' =&gt; esc_html__( 'Couldn\'t change privacy, please try again.', 'buddypress-media' ), &nbsp;</div></li><li><div>          'file_delete_success' =&gt; esc_html__( 'file deleted successfully.', 'buddypress-media' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_main_js_strings', $rtmedia_main_js_strings );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Enqueue touchswipe</span>&nbsp;</div></li><li><div>      wp_enqueue_script( 'rtmedia-touchswipe', RTMEDIA_URL . 'lib/touchswipe/jquery.touchSwipe.min.js', array( 'jquery' ), RTMEDIA_VERSION, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $rtmedia-&gt;options ) && isset( $rtmedia-&gt;options['general_masonry_layout'] ) && 1 === intval( $rtmedia-&gt;options['general_masonry_layout'] ) ) {&nbsp;</div></li><li><div>          if ( wp_script_is( 'jquery-masonry', 'registered' ) ) {&nbsp;</div></li><li><div>              wp_enqueue_style( 'jquery-masonry' );&nbsp;</div></li><li><div>              wp_enqueue_script( 'jquery-masonry' );&nbsp;</div></li><li><div>              wp_localize_script( 'rtmedia-main', 'rtmedia_masonry_layout', 'true' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              wp_localize_script( 'rtmedia-main', 'rtmedia_masonry_layout', 'false' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_localize_script( 'rtmedia-main', 'rtmedia_masonry_layout', 'false' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $rtmedia-&gt;options['general_display_media'] ) ) {&nbsp;</div></li><li><div>          wp_localize_script( 'rtmedia-backbone', 'rtmedia_load_more_or_pagination', (string) $rtmedia-&gt;options['general_display_media'] );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_localize_script( 'rtmedia-backbone', 'rtmedia_load_more_or_pagination', 'load_more' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $rtmedia-&gt;options['buddypress_enableOnActivity'] ) ) {&nbsp;</div></li><li><div>          wp_localize_script( 'rtmedia-backbone', 'rtmedia_bp_enable_activity', (string) $rtmedia-&gt;options['buddypress_enableOnActivity'] );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          wp_localize_script( 'rtmedia-backbone', 'rtmedia_bp_enable_activity', '0' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rtmedia_upload_progress_error_message', esc_html__( 'There are some uploads in progress. Do you want to cancel them?', 'buddypress-media' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// localise media size config</span>&nbsp;</div></li><li><div>      $media_size_config = array(&nbsp;</div></li><li><div>          'photo' =&gt; array(&nbsp;</div></li><li><div>              'thumb' =&gt; array(&nbsp;</div></li><li><div>                  'width' =&gt; $rtmedia-&gt;options['defaultSizes_photo_thumbnail_width'], &nbsp;</div></li><li><div>                  'height' =&gt; $rtmedia-&gt;options['defaultSizes_photo_thumbnail_height'], &nbsp;</div></li><li><div>                  'crop' =&gt; $rtmedia-&gt;options['defaultSizes_photo_thumbnail_crop'], &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'medium' =&gt; array(&nbsp;</div></li><li><div>                  'width' =&gt; $rtmedia-&gt;options['defaultSizes_photo_medium_width'], &nbsp;</div></li><li><div>                  'height' =&gt; $rtmedia-&gt;options['defaultSizes_photo_medium_height'], &nbsp;</div></li><li><div>                  'crop' =&gt; $rtmedia-&gt;options['defaultSizes_photo_medium_crop'], &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'large' =&gt; array(&nbsp;</div></li><li><div>                  'width' =&gt; $rtmedia-&gt;options['defaultSizes_photo_large_width'], &nbsp;</div></li><li><div>                  'height' =&gt; $rtmedia-&gt;options['defaultSizes_photo_large_height'], &nbsp;</div></li><li><div>                  'crop' =&gt; $rtmedia-&gt;options['defaultSizes_photo_large_crop'], &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'video' =&gt; array(&nbsp;</div></li><li><div>              'activity_media' =&gt; array(&nbsp;</div></li><li><div>                  'width' =&gt; $rtmedia-&gt;options['defaultSizes_video_activityPlayer_width'], &nbsp;</div></li><li><div>                  'height' =&gt; $rtmedia-&gt;options['defaultSizes_video_activityPlayer_height'], &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'single_media' =&gt; array(&nbsp;</div></li><li><div>                  'width' =&gt; $rtmedia-&gt;options['defaultSizes_video_singlePlayer_width'], &nbsp;</div></li><li><div>                  'height' =&gt; $rtmedia-&gt;options['defaultSizes_video_singlePlayer_height'], &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'music' =&gt; array(&nbsp;</div></li><li><div>              'activity_media' =&gt; array(&nbsp;</div></li><li><div>                  'width' =&gt; $rtmedia-&gt;options['defaultSizes_music_activityPlayer_width'], &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'single_media' =&gt; array(&nbsp;</div></li><li><div>                  'width' =&gt; $rtmedia-&gt;options['defaultSizes_music_singlePlayer_width'], &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'featured' =&gt; array(&nbsp;</div></li><li><div>              'default' =&gt; array(&nbsp;</div></li><li><div>                  'width' =&gt; $rtmedia-&gt;options['defaultSizes_featured_default_width'], &nbsp;</div></li><li><div>                  'height' =&gt; $rtmedia-&gt;options['defaultSizes_featured_default_height'], &nbsp;</div></li><li><div>                  'crop' =&gt; $rtmedia-&gt;options['defaultSizes_featured_default_crop'], &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_media_size_config', $media_size_config );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/** rtMedia fot comment media script localize*/</span>&nbsp;</div></li><li><div>      $request_uri = rtm_get_server_var( 'REQUEST_URI', 'FILTER_SANITIZE_URL' );&nbsp;</div></li><li><div>      $url = trailingslashit( $request_uri );&nbsp;</div></li><li><div>      $rtmedia_slug = '/' . RTMEDIA_MEDIA_SLUG;&nbsp;</div></li><li><div>      <span class="comment">// check position of media slug from end of the URL</span>&nbsp;</div></li><li><div>      if ( strrpos( $url, $rtmedia_slug ) !== false ) {&nbsp;</div></li><li><div>          <span class="comment">// split the url upto the last occurance of media slug</span>&nbsp;</div></li><li><div>          $url_upload = substr( $url, 0, strrpos( $url, $rtmedia_slug ) );&nbsp;</div></li><li><div>          $url = trailingslashit( $url_upload ) . 'upload/';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $url = trailingslashit( $url ) . 'upload/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $params = array(&nbsp;</div></li><li><div>          'url' =&gt; $url, &nbsp;</div></li><li><div>          'runtimes' =&gt; 'html5, flash, html4', &nbsp;</div></li><li><div>          'browse_button' =&gt; 'rtmedia-comment-media-upload', &nbsp;</div></li><li><div>          'container' =&gt; 'rtmedia-comment-media-upload-container', &nbsp;</div></li><li><div>          'filters' =&gt; apply_filters( 'rtmedia_plupload_files_filter', array(&nbsp;</div></li><li><div>              array(&nbsp;</div></li><li><div>                  'title' =&gt; 'Media Files', &nbsp;</div></li><li><div>                  'extensions' =&gt; get_rtmedia_allowed_upload_type(), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'max_file_size' =&gt; ( wp_max_upload_size() ) / ( 1024 * 1024 ) . 'M', &nbsp;</div></li><li><div>          'multipart' =&gt; true, &nbsp;</div></li><li><div>          'urlstream_upload' =&gt; true, &nbsp;</div></li><li><div>          'flash_swf_url' =&gt; includes_url( 'js/plupload/plupload.flash.swf' ), &nbsp;</div></li><li><div>          'silverlight_xap_url' =&gt; includes_url( 'js/plupload/plupload.silverlight.xap' ), &nbsp;</div></li><li><div>          'file_data_name' =&gt; 'rtmedia_file', <span class="comment">// key passed to $_FILE.</span>&nbsp;</div></li><li><div>          'multi_selection' =&gt; false, &nbsp;</div></li><li><div>          'multipart_params' =&gt; apply_filters( 'rtmedia-multi-params', array(&nbsp;</div></li><li><div>              'redirect' =&gt; 'no', &nbsp;</div></li><li><div>              'action' =&gt; 'wp_handle_upload', &nbsp;</div></li><li><div>              '_wp_http_referer' =&gt; $request_uri, &nbsp;</div></li><li><div>              'mode' =&gt; 'file_upload', &nbsp;</div></li><li><div>              'rtmedia_upload_nonce' =&gt; RTMediaUploadView::upload_nonce_generator( false, true ), &nbsp;</div></li><li><div> ) ), &nbsp;</div></li><li><div>          'max_file_size_msg' =&gt; apply_filters( 'rtmedia_plupload_file_size_msg', min( array(&nbsp;</div></li><li><div>              ini_get( 'upload_max_filesize' ), &nbsp;</div></li><li><div>              ini_get( 'post_max_size' ), &nbsp;</div></li><li><div> ) ) ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $params = apply_filters( 'rtmedia_modify_upload_params', $params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $rtmedia;&nbsp;</div></li><li><div>      $rtmedia_extns = array();&nbsp;</div></li><li><div>      foreach ( $rtmedia-&gt;allowed_types as $allowed_types_key =&gt; $allowed_types_value ) {&nbsp;</div></li><li><div>          $rtmedia_extns[ $allowed_types_key ] = $allowed_types_value['extn'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $rtmedia_disable_media = &quot;1&quot;;&nbsp;</div></li><li><div>      <span class="comment">/** if the  rtmedia option does have value pick from there*/</span>&nbsp;</div></li><li><div>      if( isset( $rtmedia-&gt;options['rtmedia_disable_media_in_commented_media'] ) ) {&nbsp;</div></li><li><div>          $rtmedia_disable_media = $rtmedia-&gt;options['rtmedia_disable_media_in_commented_media'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_disable_media_in_commented_media', $rtmedia_disable_media );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-main', 'rtmedia_disable_media_in_commented_media_text', esc_html__( 'Adding media in Comments is not allowed', 'buddypress-media' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rtmedia_exteansions', $rtmedia_extns );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rtMedia_update_plupload_comment', $params );&nbsp;</div></li><li><div>      wp_localize_script( 'rtmedia-backbone', 'rMedia_loading_file', admin_url( '/images/loading.gif' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function set_bp_bar() {&nbsp;</div></li><li><div>      remove_action( 'bp_adminbar_menus', 'bp_adminbar_account_menu', 4 );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//todo: This function should return value or pass argument</span>&nbsp;</div></li><li><div>  function set_friends_object() {&nbsp;</div></li><li><div>      if ( is_user_logged_in() ) {&nbsp;</div></li><li><div>          $user = get_current_user_id();&nbsp;</div></li><li><div>          $friends = friends_get_friend_user_ids( $user );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $user = 0;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function filter_image_sizes_details( $sizes ) {&nbsp;</div></li><li><div>      if ( isset( $_REQUEST['post_id'] ) ) {&nbsp;</div></li><li><div>          $sizes = $this-&gt;unset_bp_media_image_sizes_details( $sizes );&nbsp;</div></li><li><div>      } elseif ( isset( $_REQUEST['id'] ) ) { <span class="comment"><span class="comment">//For Regenerate Thumbnails Plugin</span></span>&nbsp;</div></li><li><div>          $model = new RTMediaModel();&nbsp;</div></li><li><div>          $result = $model-&gt;get( array( 'media_id' =&gt; intval( wp_unslash( $_REQUEST['id'] ) ) ) );&nbsp;</div></li><li><div>          if ( ! empty( $result ) ) {&nbsp;</div></li><li><div>              $bp_media_sizes = $this-&gt;image_sizes();&nbsp;</div></li><li><div>              $sizes = array(&nbsp;</div></li><li><div>                  'rt_media_thumbnail' =&gt; $bp_media_sizes['thumbnail'], &nbsp;</div></li><li><div>                  'rt_media_activity_image' =&gt; $bp_media_sizes['activity'], &nbsp;</div></li><li><div>                  'rt_media_single_image' =&gt; $bp_media_sizes['single'], &nbsp;</div></li><li><div>                  'rt_media_featured_image' =&gt; $bp_media_sizes['featured'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $sizes = $this-&gt;unset_bp_media_image_sizes_details( $sizes );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $sizes;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function rtmedia_custom_image_sizes_choose( $sizes ) {&nbsp;</div></li><li><div>      $custom_sizes = array(&nbsp;</div></li><li><div>          'rt_media_thumbnail' =&gt; 'rtMedia Thumbnail', &nbsp;</div></li><li><div>          'rt_media_activity_image' =&gt; 'rtMedia Activity Image', &nbsp;</div></li><li><div>          'rt_media_single_image' =&gt; 'rtMedia Single Image', &nbsp;</div></li><li><div>          'rt_media_featured_image' =&gt; 'rtMedia Fetured Image', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return array_merge( $sizes, $custom_sizes );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function filter_image_sizes( $sizes ) {&nbsp;</div></li><li><div>      if ( isset( $_REQUEST['postid'] ) ) { <span class="comment"><span class="comment">//For Regenerate Thumbnails Plugin</span></span>&nbsp;</div></li><li><div>          if ( $parent_id = get_post_field( 'post_parent', intval( wp_unslash( $_REQUEST['postid'] ) ) ) ) {&nbsp;</div></li><li><div>              $post_type = get_post_field( 'post_type', $parent_id );&nbsp;</div></li><li><div>              if ( 'rtmedia_album' === $post_type ) {&nbsp;</div></li><li><div>                  $sizes = array(&nbsp;</div></li><li><div>                      'rt_media_thumbnail', &nbsp;</div></li><li><div>                      'rt_media_activity_image', &nbsp;</div></li><li><div>                      'rt_media_single_image', &nbsp;</div></li><li><div>                      'rt_media_featured_image', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $sizes = $this-&gt;unset_bp_media_image_sizes( $sizes );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $sizes = $this-&gt;unset_bp_media_image_sizes( $sizes );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $sizes;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function unset_bp_media_image_sizes_details( $sizes ) {&nbsp;</div></li><li><div>      if ( isset( $sizes['rt_media_thumbnail'] ) ) {&nbsp;</div></li><li><div>          unset( $sizes['rt_media_thumbnail'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( isset( $sizes['rt_media_activity_image'] ) ) {&nbsp;</div></li><li><div>          unset( $sizes['rt_media_activity_image'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( isset( $sizes['rt_media_single_image'] ) ) {&nbsp;</div></li><li><div>          unset( $sizes['rt_media_single_image'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( isset( $sizes['rt_media_featured_image'] ) ) {&nbsp;</div></li><li><div>          unset( $sizes['rt_media_featured_image'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $sizes;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function unset_bp_media_image_sizes( $sizes ) {&nbsp;</div></li><li><div>      if ( ( $key = array_search( 'rt_media_thumbnail', $sizes ) ) !== false ) {&nbsp;</div></li><li><div>          unset( $sizes[ $key ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ( $key = array_search( 'rt_media_activity_image', $sizes ) ) !== false ) {&nbsp;</div></li><li><div>          unset( $sizes[ $key ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ( $key = array_search( 'rt_media_single_image', $sizes ) ) !== false ) {&nbsp;</div></li><li><div>          unset( $sizes[ $key ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ( $key = array_search( 'rt_media_featured_image', $sizes ) ) !== false ) {&nbsp;</div></li><li><div>          unset( $sizes[ $key ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $sizes;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function parentlink_global_album( $id ) {&nbsp;</div></li><li><div>  $global_albums = RTMediaAlbum::get_globals();&nbsp;</div></li><li><div>  $parent_link = '';&nbsp;</div></li><li><div>  if ( is_array( $global_albums ) && '' !== $global_albums ) {&nbsp;</div></li><li><div>      if ( in_array( $id, $global_albums ) && function_exists( 'bp_displayed_user_id' ) ) {&nbsp;</div></li><li><div>          $disp_user = bp_displayed_user_id();&nbsp;</div></li><li><div>          $curr_user = get_current_user_id();&nbsp;</div></li><li><div>          if ( $disp_user == $curr_user ) {&nbsp;</div></li><li><div>              $parent_link = get_rtmedia_user_link( $curr_user );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $parent_link = get_rtmedia_user_link( $disp_user );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          global $rtmedia_query;&nbsp;</div></li><li><div>          if ( isset( $rtmedia_query-&gt;is_gallery_shortcode ) && true === $rtmedia_query-&gt;is_gallery_shortcode ) {&nbsp;</div></li><li><div>              $parent_link = get_rtmedia_user_link( get_current_user_id() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $parent_link;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_rtmedia_permalink( $id ) {&nbsp;</div></li><li><div>  $media_model = new RTMediaModel();&nbsp;</div></li><li><div>  $media = $media_model-&gt;get( array( 'id' =&gt; intval( $id ) ) );&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Adding filter to get permalink for current blog</span>&nbsp;</div></li><li><div>  add_filter( 'bp_get_root_domain', 'rtmedia_get_current_blog_url' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $media[0]-&gt;context ) ) {&nbsp;</div></li><li><div>      if ( function_exists( 'bp_get_groups_root_slug' ) && isset( $rtmedia_query-&gt;query ) && isset( $rtmedia_query-&gt;query['context'] ) && 'group' === $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>          $parent_link = get_rtmedia_group_link( $rtmedia_query-&gt;query['context_id'] );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// check for global album</span></span>&nbsp;</div></li><li><div>          $parent_link = parentlink_global_album( $id );&nbsp;</div></li><li><div>          if ( '' === $parent_link ) {&nbsp;</div></li><li><div>              $parent_link = get_rtmedia_user_link( $media[0]-&gt;media_author );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( function_exists( 'bp_get_groups_root_slug' ) && 'group' === $media[0]-&gt;context ) {&nbsp;</div></li><li><div>          $parent_link = get_rtmedia_group_link( $media[0]-&gt;context_id );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// check for global album</span></span>&nbsp;</div></li><li><div>          $parent_link = parentlink_global_album( $id );&nbsp;</div></li><li><div>          if ( '' === $parent_link ) {&nbsp;</div></li><li><div>              $parent_link = get_rtmedia_user_link( $media[0]-&gt;media_author );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $parent_link = trailingslashit( $parent_link );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Removing filter so that doesn't affect other calls to this function</span>&nbsp;</div></li><li><div>  remove_filter( 'bp_get_root_domain', 'rtmedia_get_current_blog_url' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $permalink = trailingslashit( $parent_link . RTMEDIA_MEDIA_SLUG . '/' . $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Filters the rtmedia permalink for a media list.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 4.2.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string  $permalink The rtmedia's permalink.</span>&nbsp;</div></li><li><div><span class="comment">   * @param object  $media     The media in question.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int     $id          ID of the media.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'get_rtmedia_permalink', $permalink, $media, $id );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_rtmedia_user_link( $id ) {&nbsp;</div></li><li><div>  if ( function_exists( 'bp_core_get_user_domain' ) ) {&nbsp;</div></li><li><div>      $parent_link = bp_core_get_user_domain( $id );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $parent_link = get_author_posts_url( $id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $parent_link;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function rtmedia_update_site_option( $option_name, $option_value ) {&nbsp;</div></li><li><div>  if ( is_multisite() ) {&nbsp;</div></li><li><div>      return update_option( $option_name, $option_value );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return update_site_option( $option_name, $option_value );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function get_rtmedia_group_link( $group_id ) {&nbsp;</div></li><li><div>  $group = groups_get_group( array( 'group_id' =&gt; $group_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'rtmedia_get_group_link', bp_get_group_permalink( $group ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>function rtmedia_get_site_option( $option_name, $default = false ) {&nbsp;</div></li><li><div>  if ( is_multisite() ) {&nbsp;</div></li><li><div>      $return_val = get_option( $option_name, $default );&nbsp;</div></li><li><div>      if ( false === $return_val ) {&nbsp;</div></li><li><div>          $return_val = get_site_option( $option_name, $default );&nbsp;</div></li><li><div>          if ( false === $return_val ) {&nbsp;</div></li><li><div>              if ( function_exists( 'bp_get_option' ) ) {&nbsp;</div></li><li><div>                  $return_val = bp_get_option( $option_name, $default );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          rtmedia_update_site_option( $option_name, $return_val );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $return_val = get_site_option( $option_name, $default );&nbsp;</div></li><li><div>      if ( false === $return_val ) {&nbsp;</div></li><li><div>          if ( function_exists( 'bp_get_option' ) ) {&nbsp;</div></li><li><div>              $return_val = bp_get_option( $option_name, $default );&nbsp;</div></li><li><div>              rtmedia_update_site_option( $option_name, $return_val );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  if ( false !== $default && false === $return_val ) {&nbsp;</div></li><li><div>      $return_val = $default;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $return_val;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This wraps up the main rtMedia class. Three important notes:</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * 1. All the constants can be overridden.</span>&nbsp;</div></li><li><div><span class="comment"> *    So, you could use, 'portfolio' instead of 'media'</span>&nbsp;</div></li><li><div><span class="comment"> * 2. The default thumbnail and display sizes can be filtered</span>&nbsp;</div></li><li><div><span class="comment"> *    using 'bpmedia_media_sizes' hook</span>&nbsp;</div></li><li><div><span class="comment"> * 3. The excerpts and string sizes can be filtered</span>&nbsp;</div></li><li><div><span class="comment"> *    using 'bpmedia_excerpt_lengths' hook</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>rtMedia for WordPress, BuddyPress and bbPress</li><li><span></span>4.3.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>