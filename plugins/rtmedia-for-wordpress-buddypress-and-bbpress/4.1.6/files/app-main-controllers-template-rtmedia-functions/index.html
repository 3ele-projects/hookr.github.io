<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="4.1.8" data-slug="rtmedia-for-wordpress-buddypress-and-bbpress" data-type="file" data-id="17634"><head xmlns="http://www.w3.org/1999/xhtml"><title> app-main-controllers-template-rtmedia-functions | file | Rtmedia For WordPress Buddypress And Bbpress | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, rtmedia-for-wordpress-buddypress-and-bbpress, 4.1.8" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ed26ef0d5d5fe6f5a9e4cee5ae0df81e' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/app-main-controllers-template-rtmedia-functions/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fapp-main-controllers-template-rtmedia-functions%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fapp-main-controllers-template-rtmedia-functions%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-rtmedia-for-wordpress-buddypress-and-bbpress-4.1.8-file-app-main-controllers-template-rtmedia-functions","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="app-main-controllers-template-rtmedia-functions" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to rtmedia-for-wordpress-buddypr&hellip;." href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/" class="plugin"><span property="name">rtmedia-for-wordpress-buddypr&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.1.8." href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/" class="H_VERSION"><span property="name">4.1.8</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">app-main-controllers-template&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="976"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/all/" title="All">All <span class="count badge">976</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="386"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/hooks/" title="Hooks">Hooks <span class="count badge">386</span></a></li><li class="" data-id="action" data-count="152"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/actions/" title="Actions">Actions <span class="count badge">152</span></a></li><li class="" data-id="filter" data-count="234"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/filters/" title="Filters">Filters <span class="count badge">234</span></a></li><li class="" data-id="class" data-count="157"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/classes/" title="Classes">Classes <span class="count badge">157</span></a></li><li class="" data-id="constant" data-count="257"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/constants/" title="Constants">Constants <span class="count badge">257</span></a></li><li class="" data-id="function" data-count="174"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/functions/" title="Functions">Functions <span class="count badge">174</span></a></li><li class="" data-id="shortcode" data-count="2"><a href="http://hookr.io/plugins/rtmedia-for-wordpress-buddypress-and-bbpress/4.1.8/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">2</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/app/main/controllers/template/rtmedia-functions.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checks at any point of time any media is left to be processed in the db pool</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function have_rtmedia() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_query-&gt;have_media();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Rewinds the db pool of media album and resets it to beginning</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rewind_rtmedia() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_query-&gt;rewind_media();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * moves ahead in the loop of media within the album</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      object</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_query-&gt;rtmedia();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * echo the title of the media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array       $rtmedia_backbone</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_title() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_backbone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_backbone['backbone'] ) {&nbsp;</div></li><li><div>      echo '&lt;%= media_title %&gt;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return stripslashes( esc_html( $rtmedia_media-&gt;media_title ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * echo the album name of the media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object          $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool/string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_album_name() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_media-&gt;album_id ) {&nbsp;</div></li><li><div>      if ( 'album' === rtmedia_type( $rtmedia_media-&gt;album_id ) ) {&nbsp;</div></li><li><div>          return get_rtmedia_title( $rtmedia_media-&gt;album_id );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Title for RTMedia Gallery</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia         $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_rtmedia_gallery_title() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query, $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $title = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;query['media_type'] ) && 'album' === $rtmedia_query-&gt;query['media_type'] && isset( $rtmedia_query-&gt;media_query['album_id'] ) && '' !== $rtmedia_query-&gt;media_query['album_id'] ) {&nbsp;</div></li><li><div>      $id = $rtmedia_query-&gt;media_query['album_id'];&nbsp;</div></li><li><div>      $title = get_rtmedia_title( $id );&nbsp;</div></li><li><div>  } elseif ( isset( $rtmedia_query-&gt;media_query['media_type'] ) && ! is_array( $rtmedia_query-&gt;media_query['media_type'] ) && '' !== $rtmedia_query-&gt;media_query['media_type'] ) {&nbsp;</div></li><li><div>      $current_media_type = $rtmedia_query-&gt;media_query['media_type'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $current_media_type ) && is_array( $rtmedia-&gt;allowed_types ) && isset( $rtmedia-&gt;allowed_types[ $current_media_type ] ) && is_array( $rtmedia-&gt;allowed_types[ $current_media_type ] ) && isset( $rtmedia-&gt;allowed_types[ $current_media_type ]['plural_label'] ) ) {&nbsp;</div></li><li><div>          $title = sprintf( '%s %s', esc_html__( 'All', 'buddypress-media' ), $rtmedia-&gt;allowed_types[ $current_media_type ]['plural_label'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $title = apply_filters( 'rtmedia_gallery_title', $title );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media title using media ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       int         $id     media id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_rtmedia_title( $id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rtmedia_model = new RTMediaModel();&nbsp;</div></li><li><div>  $title = $rtmedia_model-&gt;get( array(&nbsp;</div></li><li><div>      'id' =&gt; $id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $title[0]-&gt;media_title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Media author's profile pic</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array       $rtmedia_backbone</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $show_link</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $echo</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $author_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_author_profile_pic( $show_link = true, $echo = true, $author_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_backbone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_backbone['backbone'] ) {&nbsp;</div></li><li><div>      echo '';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( empty( $author_id ) ) {&nbsp;</div></li><li><div>          global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $author_id = $rtmedia_media-&gt;media_author;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $show_link = apply_filters( 'rtmedia_single_media_show_profile_picture_link', $show_link );&nbsp;</div></li><li><div>      $profile_pic = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $show_link ) {&nbsp;</div></li><li><div>          $profile_pic .= &quot;&lt;a href='&quot; . esc_url( get_rtmedia_user_link( $author_id ) ) . &quot;' title='&quot; . esc_attr( rtmedia_get_author_name( $author_id ) ) . &quot;'&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $size = apply_filters( 'rtmedia_single_media_profile_picture_size', 90 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( function_exists( 'bp_get_user_has_avatar' ) ) {&nbsp;</div></li><li><div>          if ( bp_core_fetch_avatar( array(&nbsp;</div></li><li><div>                  'item_id' =&gt; $author_id, &nbsp;</div></li><li><div>                  'object' =&gt; 'user', &nbsp;</div></li><li><div>                  'no_grav' =&gt; false, &nbsp;</div></li><li><div>                  'html' =&gt; false, &nbsp;</div></li><li><div> ) ) !== bp_core_avatar_default()&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>              $profile_pic .= bp_core_fetch_avatar( array(&nbsp;</div></li><li><div>                  'item_id' =&gt; $author_id, &nbsp;</div></li><li><div>                  'object' =&gt; 'user', &nbsp;</div></li><li><div>                  'no_grav' =&gt; false, &nbsp;</div></li><li><div>                  'html' =&gt; true, &nbsp;</div></li><li><div>                  'width' =&gt; $size, &nbsp;</div></li><li><div>                  'height' =&gt; $size, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $profile_pic .= &quot;&lt;img src='&quot; . esc_url( bp_core_avatar_default() ) . &quot;' width='&quot; . esc_attr( $size ) . &quot;'  height='&quot; . esc_attr( $size ) . &quot;' /&gt;&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $profile_pic .= get_avatar( $author_id, $size );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $show_link ) {&nbsp;</div></li><li><div>          $profile_pic .= '&lt;/a&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $echo ) {&nbsp;</div></li><li><div>          echo $profile_pic; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return $profile_pic;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Media's author link</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array       $rtmedia_backbone</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $show_link</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_author_name( $show_link = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_backbone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_backbone['backbone'] ) {&nbsp;</div></li><li><div>      echo apply_filters( 'rtmedia_media_author_backbone', '', $show_link ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $show_link = apply_filters( 'rtmedia_single_media_show_profile_name_link', $show_link );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $show_link ) {&nbsp;</div></li><li><div>          echo &quot;&lt;a href='&quot; . esc_url( get_rtmedia_user_link( $rtmedia_media-&gt;media_author ) ) . &quot;' title='&quot; . esc_attr( rtmedia_get_author_name( $rtmedia_media-&gt;media_author ) ) . &quot;'&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      echo esc_html( rtmedia_get_author_name( $rtmedia_media-&gt;media_author ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $show_link ) {&nbsp;</div></li><li><div>          echo '&lt;/a&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media author name using user ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       $user_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_author_name( $user_id ) {&nbsp;</div></li><li><div>  if ( function_exists( 'bp_core_get_user_displayname' ) ) {&nbsp;</div></li><li><div>      return bp_core_get_user_displayname( $user_id );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $user = get_userdata( $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $user ) {&nbsp;</div></li><li><div>          return $user-&gt;display_name;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Media Gallery CSS classes</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_media_gallery_class() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $classes = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;media_query ) && isset( $rtmedia_query-&gt;media_query['context_id'] ) ) {&nbsp;</div></li><li><div>      $classes = 'context-id-' . esc_attr( $rtmedia_query-&gt;media_query['context_id'] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo esc_attr( apply_filters( 'rtmedia_gallery_class_filter', $classes ) );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get RTMedia ID using Post(Media) ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array           $rtmedia_backbone</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object          $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int            $media_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_id( $media_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_backbone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_backbone['backbone'] ) {&nbsp;</div></li><li><div>      return '&lt;%= id %&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $media_id ) {&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>          'media_id' =&gt; $media_id&nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $media ) && count( $media ) &gt; 0 ) {&nbsp;</div></li><li><div>          return $media[0]-&gt;id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $rtmedia_media-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Post(Media) ID using RTMedia ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_media_id( $id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>          'id' =&gt; $id&nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $media[0]-&gt;media_id;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $rtmedia_media-&gt;media_id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Media extension using ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_media_ext( $id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>          'id' =&gt; $id&nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $media[0] ) ) {&nbsp;</div></li><li><div>          $filepath = get_attached_file( $media[0]-&gt;media_id );&nbsp;</div></li><li><div>          $filetype = wp_check_filetype( $filepath );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $filetype['ext'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $filepath = get_attached_file( $rtmedia_media-&gt;media_id );&nbsp;</div></li><li><div>      $filetype = wp_check_filetype( $filepath );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $filetype['ext'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Activity ID using Media ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_activity_id( $id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>          'id' =&gt; $id&nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $media[0]-&gt;activity_id;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $rtmedia_media-&gt;activity_id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get Media type using Media ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object          $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_type( $id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>          'id' =&gt; $id&nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $media[0] ) && isset( $media[0]-&gt;media_type ) ) {&nbsp;</div></li><li><div>          return $media[0]-&gt;media_type;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $rtmedia_media-&gt;media_type;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get cover art using Media ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object          $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_cover_art( $id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>          'id' =&gt; $id&nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $media[0]-&gt;cover_art;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $rtmedia_media-&gt;cover_art;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * echo parmalink of the media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array           $rtmedia_backbone</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $media_id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_permalink( $media_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_backbone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_backbone['backbone'] ) {&nbsp;</div></li><li><div>      echo '&lt;%= rt_permalink %&gt;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      echo esc_url( get_rtmedia_permalink( rtmedia_id( $media_id ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * echo parmalink of the album</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_album_permalink() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo esc_url( get_rtmedia_permalink( $rtmedia_media-&gt;album_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object          $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia         $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool            $size_flag</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool            $echo</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string          $media_size</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_media( $size_flag = true, $echo = true, $media_size = 'rt_media_single_image' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $size_flag = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_media, $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_media-&gt;media_type ) ) {&nbsp;</div></li><li><div>      if ( 'photo' === $rtmedia_media-&gt;media_type ) {&nbsp;</div></li><li><div>          $src = wp_get_attachment_image_src( $rtmedia_media-&gt;media_id, $media_size );&nbsp;</div></li><li><div>          $html = &quot;&lt;img src='&quot; . esc_url( $src[0] ) . &quot;' alt='&quot; . esc_attr( $rtmedia_media-&gt;post_name ) . &quot;' /&gt;&quot;;&nbsp;</div></li><li><div>      } elseif ( 'video' === $rtmedia_media-&gt;media_type ) {&nbsp;</div></li><li><div>          $height = $rtmedia-&gt;options['defaultSizes_video_singlePlayer_height'];&nbsp;</div></li><li><div>          $height = ( $height * 75 ) / 640;&nbsp;</div></li><li><div>          $size = ' width=&quot;' . esc_attr( $rtmedia-&gt;options['defaultSizes_video_singlePlayer_width'] ) . '&quot; height=&quot;' . esc_attr( $height ) . '%&quot; ';&nbsp;</div></li><li><div>          $html = &quot;&lt;div id='rtm-mejs-video-container' style='width:&quot; . esc_attr( $rtmedia-&gt;options['defaultSizes_video_singlePlayer_width'] ) . 'px;height:' . esc_attr( $height ) . &quot;%;  max-width:96%;max-height:80%;'&gt;&quot;;&nbsp;</div></li><li><div>          $html   .= '&lt;video poster=&quot;&quot; src=&quot;' . esc_url( wp_get_attachment_url( $rtmedia_media-&gt;media_id ) ) . '&quot; ' . esc_attr( $size ) . ' type=&quot;video/mp4&quot; class=&quot;wp-video-shortcode&quot; id=&quot;bp_media_video_' . esc_attr( $rtmedia_media-&gt;id ) . '&quot; controls=&quot;controls&quot; preload=&quot;true&quot;&gt;&lt;/video&gt;';&nbsp;</div></li><li><div>          $html   .= '&lt;/div&gt;';&nbsp;</div></li><li><div>      } elseif ( 'music' === $rtmedia_media-&gt;media_type ) {&nbsp;</div></li><li><div>          $width = $rtmedia-&gt;options['defaultSizes_music_singlePlayer_width'];&nbsp;</div></li><li><div>          $width = ( $width * 75 ) / 640;&nbsp;</div></li><li><div>          $size = ' width= ' . esc_attr( $width ) . '% height=30 ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $size_flag ) {&nbsp;</div></li><li><div>              $size = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $html = '&lt;audio src=&quot;' . esc_url( wp_get_attachment_url( $rtmedia_media-&gt;media_id ) ) . '&quot; ' . esc_attr( $size ) . ' type=&quot;audio/mp3&quot; class=&quot;wp-audio-shortcode&quot; id=&quot;bp_media_audio_' . esc_attr( $rtmedia_media-&gt;id ) . '&quot; controls=&quot;controls&quot; preload=&quot;none&quot;&gt;&lt;/audio&gt;';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $html = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html = false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'rtmedia_after_' . $rtmedia_media-&gt;media_type, $rtmedia_media-&gt;id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html = apply_filters( 'rtmedia_single_content_filter', $html, $rtmedia_media );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $echo ) {&nbsp;</div></li><li><div>      echo $html; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return $html;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media src</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array                   $rtmedia_backbone</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object                  $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia                 $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string                  $size</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int                $id</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool                    $recho</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|int|string|void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_image( $size = 'rt_media_thumbnail', $id = false, $recho = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_backbone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_backbone['backbone'] ) {&nbsp;</div></li><li><div>      echo '&lt;%= guid %&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>          'id' =&gt; $id&nbsp;</div></li><li><div> ), false, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $media[0] ) ) {&nbsp;</div></li><li><div>          $media_object = $media[0];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $media_object = $rtmedia_media;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $thumbnail_id = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $media_object-&gt;media_type ) ) {&nbsp;</div></li><li><div>      if ( 'album' === $media_object-&gt;media_type || 'photo' !== $media_object-&gt;media_type || 'video' === $media_object-&gt;media_type ) {&nbsp;</div></li><li><div>          $thumbnail_id = ( isset( $media_object-&gt;cover_art )&nbsp;</div></li><li><div>                            && ( ( false !== filter_var( $media_object-&gt;cover_art, FILTER_VALIDATE_URL ) )   <span class="comment">// Cover art might be an absolute URL</span>&nbsp;</div></li><li><div>                                || ( 0 !== intval( $media_object-&gt;cover_art ) )    <span class="comment">// Cover art might be a media ID</span>&nbsp;</div></li><li><div> ) ) ? $media_object-&gt;cover_art : false;&nbsp;</div></li><li><div>          $thumbnail_id = apply_filters( 'show_custom_album_cover', $thumbnail_id, $media_object-&gt;media_type, $media_object-&gt;id ); <span class="comment">// for rtMedia pro users</span>&nbsp;</div></li><li><div>      } elseif ( 'photo' === $media_object-&gt;media_type ) {&nbsp;</div></li><li><div>          $thumbnail_id = $media_object-&gt;media_id;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $thumbnail_id = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'music' === $media_object-&gt;media_type && empty( $thumbnail_id ) ) {&nbsp;</div></li><li><div>          $thumbnail_id = rtm_get_music_cover_art( $media_object );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( 'music' === $media_object-&gt;media_type && -1 === intval( $thumbnail_id ) ) {&nbsp;</div></li><li><div>          $thumbnail_id = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $thumbnail_id ) {&nbsp;</div></li><li><div>      global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Getting the extension of the uploaded file</span>&nbsp;</div></li><li><div>      $extension = rtmedia_get_extension();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Checking if custom thumbnail for this file extension is set or not</span>&nbsp;</div></li><li><div>      if ( isset( $rtmedia-&gt;allowed_types[ $media_object-&gt;media_type ] ) && isset( $rtmedia-&gt;allowed_types[ $media_object-&gt;media_type ]['ext_thumb'] ) && isset( $rtmedia-&gt;allowed_types[ $media_object-&gt;media_type ]['ext_thumb'][ $extension ] ) ) {&nbsp;</div></li><li><div>          $src = $rtmedia-&gt;allowed_types[ $media_object-&gt;media_type ]['ext_thumb'][ $extension ];&nbsp;</div></li><li><div>      } else if ( isset( $rtmedia-&gt;allowed_types[ $media_object-&gt;media_type ] ) && isset( $rtmedia-&gt;allowed_types[ $media_object-&gt;media_type ]['thumbnail'] ) ) {&nbsp;</div></li><li><div>          $src = $rtmedia-&gt;allowed_types[ $media_object-&gt;media_type ]['thumbnail'];&nbsp;</div></li><li><div>      } elseif ( 'album' === $media_object-&gt;media_type ) {&nbsp;</div></li><li><div>          $src = rtmedia_album_image( $size, $id );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $src = false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( is_numeric( $thumbnail_id ) && 0 !== intval( $thumbnail_id ) ) {&nbsp;</div></li><li><div>          list( $src, $width, $height ) = wp_get_attachment_image_src( $thumbnail_id, $size );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $src = $thumbnail_id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $src = apply_filters( 'rtmedia_media_thumb', $src, $media_object-&gt;id, $media_object-&gt;media_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( true === $recho ) {&nbsp;</div></li><li><div>      echo esc_url( $src );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return $src;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media alt</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $id</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $echo</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_image_alt( $id = false, $echo = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>          'id' =&gt; $id&nbsp;</div></li><li><div> ), false, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $media[0] ) ) {&nbsp;</div></li><li><div>          $media_object = $media[0];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_object = get_post( $media_object-&gt;media_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $post_object-&gt;post_name ) ) {&nbsp;</div></li><li><div>          $img_alt = $post_object-&gt;post_name;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $img_alt = ' ';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $rtmedia_media-&gt;post_name ) ) {&nbsp;</div></li><li><div>          $img_alt = $rtmedia_media-&gt;post_name;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $img_alt = ' ';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $echo ) {&nbsp;</div></li><li><div>      echo esc_attr( $img_alt );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return $img_alt;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get album image</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object          $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia         $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string          $size</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_album_image( $size = 'thumbnail', $id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_media, $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $id ) {&nbsp;</div></li><li><div>      $id = $rtmedia_media-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $model = new RTMediaModel();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;query['context_id'] ) && isset( $rtmedia_query-&gt;query['context'] ) && 'group' !== $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>      if ( 'profile' === $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>          $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>              'album_id' =&gt; $id, &nbsp;</div></li><li><div>              'media_type' =&gt; 'photo', &nbsp;</div></li><li><div>              'media_author' =&gt; $rtmedia_query-&gt;query['context_id'], &nbsp;</div></li><li><div>              'context' =&gt; 'profile', &nbsp;</div></li><li><div>              'context_id' =&gt; $rtmedia_query-&gt;query['context_id'], &nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>              'album_id' =&gt; $id, &nbsp;</div></li><li><div>              'media_type' =&gt; 'photo', &nbsp;</div></li><li><div>              'media_author' =&gt; $rtmedia_query-&gt;query['context_id'], &nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( isset( $rtmedia_query-&gt;query['context_id'] ) && isset( $rtmedia_query-&gt;query['context'] ) && 'group' === $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>          $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>              'album_id' =&gt; $id, &nbsp;</div></li><li><div>              'media_type' =&gt; 'photo', &nbsp;</div></li><li><div>              'context_id' =&gt; $rtmedia_query-&gt;query['context_id'], &nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>              'album_id' =&gt; $id, &nbsp;</div></li><li><div>              'media_type' =&gt; 'photo'&nbsp;</div></li><li><div> ), 0, 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $media ) {&nbsp;</div></li><li><div>      $src = rtmedia_image( $size, $media[0]-&gt;id, false );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $src = $rtmedia-&gt;allowed_types['photo']['thumbnail'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $src;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get duration for media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array       $rtmedia_backbone</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array|bool|mixed|null|string|void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_duration( $id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_backbone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_backbone['backbone'] ) {&nbsp;</div></li><li><div>      echo '&lt;%= duration %&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      $model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $model-&gt;get_media( array(&nbsp;</div></li><li><div>          'id' =&gt; $id&nbsp;</div></li><li><div> ), false, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $media[0] ) ) {&nbsp;</div></li><li><div>          $media_object = $media[0];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $media_object = $rtmedia_media;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $duration = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ( 'video' === $media_object-&gt;media_type ) || ( 'music' === $media_object-&gt;media_type ) ) {&nbsp;</div></li><li><div>      $media_time = get_rtmedia_meta( $media_object-&gt;id, 'duration_time' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( false === $media_time || empty( $media_time ) ) {&nbsp;</div></li><li><div>          $filepath = get_attached_file( $media_object-&gt;media_id );&nbsp;</div></li><li><div>          $media_tags = new RTMediaTags( $filepath );&nbsp;</div></li><li><div>          $duration = $media_tags-&gt;duration;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          add_rtmedia_meta( $media_object-&gt;id, 'duration_time', $duration );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $duration = $media_time;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $duration = str_replace( '-:--', '', $duration );&nbsp;</div></li><li><div>      $duration = '&lt;span class=&quot;rtmedia_time&quot; &gt;' . esc_attr( $duration ) . '&lt;/span&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $duration;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Sanitizing object</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       array       $data</span>&nbsp;</div></li><li><div><span class="comment"> * @param       array       $exceptions</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_sanitize_object( $data, $exceptions = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $data as $key =&gt; $value ) {&nbsp;</div></li><li><div>      if ( ! in_array( $key, array_merge( RTMediaMedia::$default_object, $exceptions ), true ) ) {&nbsp;</div></li><li><div>          unset( $data[ $key ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $data;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if delete media is allowed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_delete_allowed() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $flag = intval( $rtmedia_media-&gt;media_author ) === get_current_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $flag && isset( $rtmedia_media-&gt;context ) && 'group' === $rtmedia_media-&gt;context && function_exists( 'bp_group_is_admin' ) ) {&nbsp;</div></li><li><div>      $flag = ( bp_group_is_admin() || bp_group_is_mod() );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $flag ) {&nbsp;</div></li><li><div>      $flag = is_super_admin();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $flag = apply_filters( 'rtmedia_media_delete_priv', $flag );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $flag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if edit media is allowed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_edit_allowed() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $flag = intval( $rtmedia_media-&gt;media_author ) === get_current_user_id();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $flag ) {&nbsp;</div></li><li><div>      $flag = is_super_admin();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $flag = apply_filters( 'rtmedia_media_edit_priv', $flag );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $flag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media action like edit, delete</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_request_action() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_query-&gt;action_query-&gt;action;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get text-box for editing media title</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_title_input() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $name = 'media_title';&nbsp;</div></li><li><div>  $value = stripslashes( esc_html( $rtmedia_media-&gt;media_title ) );&nbsp;</div></li><li><div>  $html = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'edit' === rtmedia_request_action() ) {&nbsp;</div></li><li><div>      $html .= '&lt;input type=&quot;text&quot; class=&quot;rtmedia-title-editor&quot; name=&quot;' . esc_attr( $name ) . '&quot; id=&quot;' . esc_attr( $name ) . '&quot; value=&quot;' . esc_attr( $value ) . '&quot;&gt;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html .= '&lt;h2 name=&quot;' . esc_attr( $name ) . '&quot; id=&quot;' . esc_attr( $name ) . '&quot;&gt;' . esc_html( $value ) . '&lt;/h2&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html .= '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo $html; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get text-area when editing media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $editor</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $echo</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_description_input( $editor = true, $echo = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $name = 'description';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_media-&gt;post_content ) ) {&nbsp;</div></li><li><div>      $value = $rtmedia_media-&gt;post_content;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $post_details = get_post( $rtmedia_media-&gt;media_id );&nbsp;</div></li><li><div>      $value = $post_details-&gt;post_content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $editor ) {&nbsp;</div></li><li><div>      if ( 'edit' === rtmedia_request_action() ) {&nbsp;</div></li><li><div>          ob_start();&nbsp;</div></li><li><div>          wp_editor( $value, $name, array(&nbsp;</div></li><li><div>              'media_buttons' =&gt; false, &nbsp;</div></li><li><div>              'textarea_rows' =&gt; 2, &nbsp;</div></li><li><div>              'quicktags' =&gt; false, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $html .= ob_get_clean();&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $html .= '&lt;div name=&quot;' . esc_attr( $name ) . '&quot; id=&quot;' . esc_attr( $name ) . '&quot;&gt;' . wp_kses_post( $value ) . '&lt;/div&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html .= &quot;&lt;textarea name='&quot; . esc_attr( $name ) . &quot;' id='&quot; . esc_attr( $name ) . &quot;' class='rtmedia-desc-textarea'&gt;&quot; . esc_textarea( $value ) . '&lt;/textarea&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html .= '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $echo ) {&nbsp;</div></li><li><div>      echo $html; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return $html;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * echo media description</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $echo</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_description( $echo = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $echo ) {&nbsp;</div></li><li><div>      <span class="comment">// escape description for any html tags and reformat using `wpautop`</span>&nbsp;</div></li><li><div>      echo rtmedia_get_media_description();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return rtmedia_get_media_description();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media description</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_media_description( $id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $id ) {&nbsp;</div></li><li><div>      $media_post_id = rtmedia_media_id( $id );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $media_post_id = $rtmedia_media-&gt;media_id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This function will mostly be used in single media page.</span>&nbsp;</div></li><li><div><span class="comment">   * We are showing single media page using `the_content` filter and uses dummy post.</span>&nbsp;</div></li><li><div><span class="comment">   * If we use `the_content` filter again than media description won't work as</span>&nbsp;</div></li><li><div><span class="comment">   * this is already singe media request and hence using `wpautop` instead.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  return wpautop( get_post_field( 'post_content', $media_post_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get total media count in the album</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_count() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_query-&gt;media_count;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the page offset for the media pool</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_offset() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return ( $rtmedia_query-&gt;action_query-&gt;page - 1 ) * $rtmedia_query-&gt;action_query-&gt;per_page_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get number of media per page to be displayed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_per_page_media() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_query-&gt;action_query-&gt;per_page_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the page number of media album in the pagination</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_page() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_query-&gt;action_query-&gt;page;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the current media number in the album pool</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_current_media() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_query-&gt;current_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * rtMedia edit form</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_edit_form() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_user_logged_in() && rtmedia_edit_allowed() ) {&nbsp;</div></li><li><div>      $edit_button = '&lt;button type=&quot;submit&quot; class=&quot;rtmedia-edit rtmedia-action-buttons&quot; &gt;' . esc_html__( 'Edit', 'buddypress-media' ) . '&lt;/button&gt;';&nbsp;</div></li><li><div>      $edit_button = apply_filters( 'rtmedia_edit_button_filter', $edit_button );&nbsp;</div></li><li><div>      $button = '&lt;form action=&quot;' . esc_url( get_rtmedia_permalink( rtmedia_id() ) ) . 'edit/&quot;&gt;' . $edit_button . '&lt;/form&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $button;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * list of actions might be performed on media</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_actions() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $actions = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_user_logged_in() && rtmedia_edit_allowed() ) {&nbsp;</div></li><li><div>      $edit_button = '&lt;button type=&quot;submit&quot; class=&quot;rtmedia-edit rtmedia-action-buttons button&quot; &gt;' . esc_html__( 'Edit', 'buddypress-media' ) . '&lt;/button&gt;';&nbsp;</div></li><li><div>      $edit_button = apply_filters( 'rtmedia_edit_button_filter', $edit_button );&nbsp;</div></li><li><div>      $actions[] = '&lt;form action=&quot;' . esc_url( get_rtmedia_permalink( rtmedia_id() ) ) . 'edit/&quot;&gt;' . $edit_button . '&lt;/form&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $actions = apply_filters( 'rtmedia_action_buttons_before_delete', $actions );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $actions as $action ) {&nbsp;</div></li><li><div>      echo $action; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $actions = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( rtmedia_delete_allowed() ) {&nbsp;</div></li><li><div>      $actions[] = rtmedia_delete_form( $echo = false );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $actions = apply_filters( 'rtmedia_action_buttons_after_delete', $actions );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $actions as $action ) {&nbsp;</div></li><li><div>      echo $action; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'after_rtmedia_action_buttons' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Rendering comments section</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $echo</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_comments( $echo = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html = '&lt;ul id=&quot;rtmedia_comment_ul&quot; class=&quot;rtm-comment-list&quot; data-action=&quot;' . esc_url( get_rtmedia_permalink( rtmedia_id() ) ) . 'delete-comment/&quot;&gt;';&nbsp;</div></li><li><div>  $comments = get_comments( array(&nbsp;</div></li><li><div>      'post_id' =&gt; $rtmedia_media-&gt;media_id, &nbsp;</div></li><li><div>      'order' =&gt; 'ASC'&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  $comment_list = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $comments as $comment ) {&nbsp;</div></li><li><div>      $comment_list .= rmedia_single_comment( (array) $comment );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $comment_list ) ) {&nbsp;</div></li><li><div>      $html .= $comment_list;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $html .= &quot;&lt;li id='rtmedia-no-comments' class='rtmedia-no-comments'&gt;&quot; . apply_filters( 'rtmedia_single_media_no_comment_messege', esc_html__( 'There are no comments on this media yet.', 'buddypress-media' ) ) . '&lt;/li&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html .= '&lt;/ul&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $html ) {&nbsp;</div></li><li><div>      echo $html; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return $html;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render single comment</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array       $allowedtags</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       array       $comment</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rmedia_single_comment( $comment ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $allowedtags, $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html = '';&nbsp;</div></li><li><div>  $html .= '&lt;li class=&quot;rtmedia-comment&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $comment['user_id'] ) {&nbsp;</div></li><li><div>      $user_link = &quot;&lt;a href='&quot; . esc_url( get_rtmedia_user_link( $comment['user_id'] ) ) . &quot;' title='&quot; . esc_attr( rtmedia_get_author_name( $comment['user_id'] ) ) . &quot;'&gt;&quot; . esc_html( rtmedia_get_author_name( $comment['user_id'] ) ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>      $user_name = apply_filters( 'rtmedia_comment_author_name', $user_link, $comment );&nbsp;</div></li><li><div>      $profile_pic = rtmedia_author_profile_pic( $show_link = true, $echo = false, $comment['user_id'] );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $user_name = 'Annonymous';&nbsp;</div></li><li><div>      $profile_pic = '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $profile_pic ) ) {&nbsp;</div></li><li><div>      $html .= &quot;&lt;div class='rtmedia-comment-user-pic cleafix'&gt;&quot; . $profile_pic . '&lt;/div&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html .= &quot;&lt;div class='rtm-comment-wrap'&gt;&lt;div class='rtmedia-comment-details'&gt;&quot;;&nbsp;</div></li><li><div>  $html .= '&lt;span class =&quot;rtmedia-comment-author&quot;&gt;' . $user_name . '&lt;/span&gt;';&nbsp;</div></li><li><div>  $html .= '&lt;span class =&quot;rtmedia-comment-date&quot;&gt; ' . apply_filters( 'rtmedia_comment_date_format', rtmedia_convert_date( $comment['comment_date_gmt'] ), $comment ) . '&lt;/span&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $comment_string = wp_kses( $comment['comment_content'], $allowedtags );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html .= '&lt;div class=&quot;rtmedia-comment-content&quot;&gt;' . wpautop( make_clickable( apply_filters( 'bp_get_activity_content', $comment_string ) ) ) . '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_rt_admin() || ( isset( $comment['user_id'] ) && ( get_current_user_id() === intval( $comment['user_id'] ) || intval( $rtmedia_media-&gt;media_author ) === get_current_user_id() ) ) || apply_filters( 'rtmedia_allow_comment_delete', false ) ) { <span class="comment">// show delete button for comment author and admins</span>&nbsp;</div></li><li><div>      $html .= '&lt;i data-id=&quot;' . esc_attr( $comment['comment_ID'] ) . '&quot; class = &quot;rtmedia-delete-comment dashicons dashicons-no-alt rtmicon&quot; title=&quot;' . esc_attr__( 'Delete Comment', 'buddypress-media' ) . '&quot;&gt;&lt;/i&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $html .= '&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'rtmedia_single_comment', $html, $comment );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media comment count using media ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      wpdb        $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $media_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_media_comment_count( $media_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $wpdb, $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $media_id ) {&nbsp;</div></li><li><div>      $post_id = $rtmedia_media-&gt;media_id;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $post_id = rtmedia_media_id( $media_id );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $query = $wpdb-&gt;prepare( &quot;SELECT count(*) FROM $wpdb-&gt;comments WHERE comment_post_ID = %d&quot;, $post_id );&nbsp;</div></li><li><div>  $comment_count = $wpdb-&gt;get_results( $query, ARRAY_N ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_array( $comment_count ) && is_array( $comment_count[0] ) && isset( $comment_count[0][0] ) ) {&nbsp;</div></li><li><div>      return $comment_count[0][0];&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get previous media link</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object          $rtmedia_interaction</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_pagination_prev_link() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_interaction, $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $page_url = ( ( rtmedia_page() - 1 ) === 1 ) ? '' : 'pg/' . ( rtmedia_page() - 1 );&nbsp;</div></li><li><div>  $site_url = ( is_multisite() ) ? trailingslashit( get_site_url( get_current_blog_id() ) ) : trailingslashit( get_site_url() );&nbsp;</div></li><li><div>  $author_name = get_query_var( 'author_name' );&nbsp;</div></li><li><div>  $link = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_interaction && isset( $rtmedia_interaction-&gt;context ) && 'profile' === $rtmedia_interaction-&gt;context-&gt;type ) {&nbsp;</div></li><li><div>      if ( function_exists( 'bp_core_get_user_domain' ) ) {&nbsp;</div></li><li><div>          $link .= trailingslashit( bp_core_get_user_domain( $rtmedia_query-&gt;media_query['media_author'] ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $link = $site_url . 'author/' . $author_name . '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( $rtmedia_interaction && isset( $rtmedia_interaction-&gt;context ) && 'group' === $rtmedia_interaction-&gt;context-&gt;type ) {&nbsp;</div></li><li><div>          if ( function_exists( 'bp_get_current_group_slug' ) ) {&nbsp;</div></li><li><div>              $link .= $site_url . bp_get_groups_root_slug() . '/' . bp_get_current_group_slug() . '/';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $post = get_post( get_post_field( 'post_parent', $rtmedia_query-&gt;media-&gt;media_id ) );&nbsp;</div></li><li><div>          $link .= $site_url . $post-&gt;post_name . '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $link .= RTMEDIA_MEDIA_SLUG . '/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;action_query-&gt;media_type ) ) {&nbsp;</div></li><li><div>      $media_type_array = array( 'photo', 'music', 'video', 'album', 'playlist' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( $rtmedia_query-&gt;action_query-&gt;media_type, $media_type_array, true ) ) {&nbsp;</div></li><li><div>          $link .= $rtmedia_query-&gt;action_query-&gt;media_type . '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'rtmedia_pagination_prev_link', $link . $page_url, $link, $page_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get next media link</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object          $rtmedia_interaction</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_pagination_next_link() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_interaction, $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $page_url = 'pg/' . ( rtmedia_page() + 1 );&nbsp;</div></li><li><div>  $site_url = ( is_multisite() ) ? trailingslashit( get_site_url( get_current_blog_id() ) ) : trailingslashit( get_site_url() );&nbsp;</div></li><li><div>  $author_name = get_query_var( 'author_name' );&nbsp;</div></li><li><div>  $link = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_interaction && isset( $rtmedia_interaction-&gt;context ) && 'profile' === $rtmedia_interaction-&gt;context-&gt;type ) {&nbsp;</div></li><li><div>      if ( function_exists( 'bp_core_get_user_domain' ) ) {&nbsp;</div></li><li><div>          if ( isset( $rtmedia_query-&gt;media_query['context'] ) && 'profile' === $rtmedia_query-&gt;media_query['context'] && isset( $rtmedia_query-&gt;media_query['context_id'] ) ) {&nbsp;</div></li><li><div>              $user_id = $rtmedia_query-&gt;media_query['context_id'];&nbsp;</div></li><li><div>          } else if ( isset( $rtmedia_query-&gt;media_query['media_author'] ) ) {&nbsp;</div></li><li><div>              $user_id = $rtmedia_query-&gt;media_query['media_author'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $user_id = bp_displayed_user_id();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $link .= trailingslashit( bp_core_get_user_domain( $user_id ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $link .= $site_url . 'author/' . $author_name . '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( $rtmedia_interaction && isset( $rtmedia_interaction-&gt;context ) && 'group' === $rtmedia_interaction-&gt;context-&gt;type ) {&nbsp;</div></li><li><div>          if ( function_exists( 'bp_get_current_group_slug' ) ) {&nbsp;</div></li><li><div>              $link .= $site_url . bp_get_groups_root_slug() . '/' . bp_get_current_group_slug() . '/';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          <span class="comment">// if there are more media than number of media per page to show than $rtmedia_query-&gt;media-&gt;media_id will be set other wise take media_id of very first media</span>&nbsp;</div></li><li><div>          <span class="comment">// For more understanding why array became object check rewind_media() in RTMediaQuery.php file and check it's call</span>&nbsp;</div></li><li><div>          $post_id = ( isset( $rtmedia_query-&gt;media-&gt;media_id ) ? $rtmedia_query-&gt;media-&gt;media_id : $rtmedia_query-&gt;media[0]-&gt;media_id );&nbsp;</div></li><li><div>          $post = get_post( get_post_field( 'post_parent', $post_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $link .= $site_url . $post-&gt;post_name . '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $link .= RTMEDIA_MEDIA_SLUG . '/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;media_query['album_id'] ) && intval( $rtmedia_query-&gt;media_query['album_id'] ) &gt; 0 ) {&nbsp;</div></li><li><div>      $link .= $rtmedia_query-&gt;media_query['album_id'] . '/';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;action_query-&gt;media_type ) ) {&nbsp;</div></li><li><div>      $media_type_array = array( 'photo', 'music', 'video', 'album', 'playlist' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( $rtmedia_query-&gt;action_query-&gt;media_type, $media_type_array, true ) ) {&nbsp;</div></li><li><div>          $link .= $rtmedia_query-&gt;action_query-&gt;media_type . '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'rtmedia_pagination_next_link', $link . $page_url, $link, $page_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * get media page link</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object          $rtmedia_interaction</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string          $page_no</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_pagination_page_link( $page_no = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_interaction, $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $page_url = 'pg/' . $page_no;&nbsp;</div></li><li><div>  $site_url = ( is_multisite() ) ? trailingslashit( get_site_url( get_current_blog_id() ) ) : trailingslashit( get_site_url() );&nbsp;</div></li><li><div>  $author_name = get_query_var( 'author_name' );&nbsp;</div></li><li><div>  $link = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_interaction && isset( $rtmedia_interaction-&gt;context ) && 'profile' === $rtmedia_interaction-&gt;context-&gt;type ) {&nbsp;</div></li><li><div>      if ( function_exists( 'bp_core_get_user_domain' ) && ! empty( $rtmedia_query-&gt;media_query['media_author'] ) ) {&nbsp;</div></li><li><div>          $link .= trailingslashit( bp_core_get_user_domain( $rtmedia_query-&gt;media_query['media_author'] ) );&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $link .= $site_url . 'author/' . $author_name . '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( $rtmedia_interaction && isset( $rtmedia_interaction-&gt;context ) && 'group' === $rtmedia_interaction-&gt;context-&gt;type ) {&nbsp;</div></li><li><div>          if ( function_exists( 'bp_get_current_group_slug' ) ) {&nbsp;</div></li><li><div>              $link .= $site_url . bp_get_groups_root_slug() . '/' . bp_get_current_group_slug() . '/';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $post = get_post( get_post_field( 'post_parent', $rtmedia_query-&gt;media-&gt;media_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $link .= $site_url . $post-&gt;post_name . '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $link .= RTMEDIA_MEDIA_SLUG . '/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;media_query['album_id'] ) && intval( $rtmedia_query-&gt;media_query['album_id'] ) &gt; 0 ) {&nbsp;</div></li><li><div>      $link .= $rtmedia_query-&gt;media_query['album_id'] . '/';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;action_query-&gt;media_type ) ) {&nbsp;</div></li><li><div>      $media_type_array = array( 'photo', 'music', 'video', 'album', 'playlist' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( in_array( $rtmedia_query-&gt;action_query-&gt;media_type, $media_type_array, true ) ) {&nbsp;</div></li><li><div>          $link .= $rtmedia_query-&gt;action_query-&gt;media_type . '/';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'rtmedia_pagination_page_link', $link . $page_url, $link, $page_url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Media pagination</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array       $rtmedia_backbone</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_media_pagination() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_backbone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_backbone['backbone'] ) {&nbsp;</div></li><li><div>      echo '&lt;%= pagination %&gt;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      echo rtmedia_get_pagination_values(); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Render pagination UI</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia         $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> * @global      int             $paged</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_pagination_values() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia, $rtmedia_query, $paged;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $general_options = $rtmedia-&gt;options;&nbsp;</div></li><li><div>  $per_page = $general_options['general_perPageMedia'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;query['per_page'] ) ) {&nbsp;</div></li><li><div>      $per_page = $rtmedia_query-&gt;query['per_page'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $per_page = intval( $per_page );&nbsp;</div></li><li><div>  $range = 1;&nbsp;</div></li><li><div>  $showitems = ( $range * 2 ) + 1;&nbsp;</div></li><li><div>  $rtmedia_media_pages = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 0 === intval( rtmedia_offset() ) ) {&nbsp;</div></li><li><div>      $paged = 1;  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  } else if ( intval( rtmedia_offset() ) === $per_page ) {&nbsp;</div></li><li><div>      $paged = 2; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $paged = ceil( rtmedia_offset() / $per_page ) + 1; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $pages = ceil( rtmedia_count() / $per_page );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $pages ) {&nbsp;</div></li><li><div>      $pages = 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $page_base_url = rtmedia_pagination_page_link();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 1 !== intval( $pages ) ) {&nbsp;</div></li><li><div>      $rtmedia_media_pages .= &quot;&lt;div class='rtm-pagination clearfix'&gt;&quot;;&nbsp;</div></li><li><div>      $rtmedia_media_pages .= &quot;&lt;div class='rtmedia-page-no rtm-page-number'&gt;&quot;;&nbsp;</div></li><li><div>      $rtmedia_media_pages .= &quot;&lt;span class='rtm-label'&gt;&quot;;&nbsp;</div></li><li><div>      $rtmedia_media_pages .= esc_html( apply_filters( 'rtmedia_goto_page_label', esc_html__( 'Go to page no : ', 'buddypress-media' ) ) );&nbsp;</div></li><li><div>      $rtmedia_media_pages .= '&lt;/span&gt;';&nbsp;</div></li><li><div>      $rtmedia_media_pages .= &quot;&lt;input type='hidden' id='rtmedia_first_page' value='1' /&gt;&quot;;&nbsp;</div></li><li><div>      $rtmedia_media_pages .= &quot;&lt;input type='hidden' id='rtmedia_last_page' value='&quot; . esc_attr( $pages ) . &quot;' /&gt;&quot;;&nbsp;</div></li><li><div>      $rtmedia_media_pages .= &quot;&lt;input type='number' value='&quot; . esc_attr( $paged ) . &quot;' min='1' max='&quot; . esc_attr( $pages ) . &quot;' class='rtm-go-to-num' id='rtmedia_go_to_num' /&gt;&quot;;&nbsp;</div></li><li><div>      $rtmedia_media_pages .= &quot;&lt;a class='rtmedia-page-link button' data-page-type='num' data-page-base-url='&quot; . $page_base_url . &quot;' href='#'&gt;&quot; . esc_html__( 'Go', 'buddypress-media' ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>      $rtmedia_media_pages .= &quot;&lt;/div&gt;&lt;div class='rtm-paginate'&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $paged &gt; 1 && $showitems &lt; $pages ) {&nbsp;</div></li><li><div>          $page_url = ( ( rtmedia_page() - 1 ) == 1 ) ? '' : $page_base_url . ( rtmedia_page() - 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $rtmedia_media_pages .= &quot;&lt;a class='rtmedia-page-link' data-page-type='prev' href='&quot; . esc_url( $page_url ) . &quot;'&gt;&lt;i class='dashicons dashicons-arrow-left-alt2'&gt;&lt;/i&gt;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $paged &gt; 2 && $paged &gt; $range + 1 && $showitems &lt; $pages ) {&nbsp;</div></li><li><div>          $page_url = $page_base_url . '1';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $rtmedia_media_pages .= &quot;&lt;a class='rtmedia-page-link' data-page-type='page' data-page='1' href='&quot; . esc_url( $page_url ) . &quot;'&gt;1&lt;/a&gt;&lt;span&gt;...&lt;/span&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      for ( $i = 1; $i &lt;= $pages; $i ++ ) {&nbsp;</div></li><li><div>          if ( 1 != $pages && ( ! ( $i &gt;= $paged + $range + 1 || $i &lt;= $paged - $range - 1 ) || $pages &lt;= $showitems ) ) {&nbsp;</div></li><li><div>              $page_url = $page_base_url . $i;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $rtmedia_media_pages .= ( $paged == $i ) ? &quot;&lt;span class='current'&gt;&quot; . esc_html( $i ) . '&lt;/span&gt;' : &quot;&lt;a class='rtmedia-page-link' data-page-type='page' data-page='&quot; . esc_attr( $i ) . &quot;' href='&quot; . esc_url( $page_url ) . &quot;' class='inactive' &gt;&quot; . esc_html( $i ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $paged &lt; $pages - 1 && $paged + $range - 1 &lt; $pages && $showitems &lt; $pages ) {&nbsp;</div></li><li><div>          $page_url = $page_base_url . $pages;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $rtmedia_media_pages .= &quot;&lt;span&gt;...&lt;/span&gt;&lt;a class='rtmedia-page-link' data-page-type='page' data-page='&quot; . esc_attr( $pages ) . &quot;' href='&quot; . esc_url( $page_url ) . &quot;'&gt;&quot; . esc_html( $pages ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $paged &lt; $pages && $showitems &lt; $pages ) {&nbsp;</div></li><li><div>          $page_url = $page_base_url . ( rtmedia_page() + 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $rtmedia_media_pages .= &quot;&lt;a class='rtmedia-page-link' data-page-type='next' href='&quot; . esc_url( $page_url ) . &quot;'&gt;&lt;i class='dashicons dashicons-arrow-right-alt2'&gt;&lt;/i&gt;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $rtmedia_media_pages .= &quot;&lt;/div&gt;&lt;/div&gt;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_media_pages;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if comments are enabled</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia         $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_comments_enabled() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia-&gt;options['general_enableComments'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if it's a rtmedia gallery</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_gallery() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_query ) {&nbsp;</div></li><li><div>      return $rtmedia_query-&gt;is_gallery();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if it's a album gallery</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_album_gallery() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_query ) {&nbsp;</div></li><li><div>      return $rtmedia_query-&gt;is_album_gallery();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if it's a single media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_single() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_query ) {&nbsp;</div></li><li><div>      return $rtmedia_query-&gt;is_single();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if it's an album</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $album_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_album( $album_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $album_id ) {&nbsp;</div></li><li><div>      $rtmedia_model = new RTMediaModel();&nbsp;</div></li><li><div>      $media = $rtmedia_model-&gt;get( array(&nbsp;</div></li><li><div>          'id' =&gt; $album_id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $media ) && isset( $media[0] ) && isset( $media[0]-&gt;media_type ) && 'album' === $media[0]-&gt;media_type ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_query ) {&nbsp;</div></li><li><div>      return $rtmedia_query-&gt;is_album();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if it's a group album</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_group_album() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_query ) {&nbsp;</div></li><li><div>      return $rtmedia_query-&gt;is_group_album();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if edit is allowed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_edit_allowed() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_query ) {&nbsp;</div></li><li><div>      if ( isset( $rtmedia_query-&gt;media_query['media_author'] ) && get_current_user_id() === intval( $rtmedia_query-&gt;media_query['media_author'] ) && 'edit' === $rtmedia_query-&gt;action_query-&gt;action ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Updating activity after thumbnail set</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      wpdb            $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> * @global      BuddyPress      $bp</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       int             $id</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function update_activity_after_thumb_set( $id ) {&nbsp;</div></li><li><div>  $model = new RTMediaModel();&nbsp;</div></li><li><div>  $media_obj = new RTMediaMedia();&nbsp;</div></li><li><div>  $media = $model-&gt;get( array(&nbsp;</div></li><li><div>      'id' =&gt; $id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  $privacy = $media[0]-&gt;privacy;&nbsp;</div></li><li><div>  $activity_id = rtmedia_activity_id( $id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $activity_id ) ) {&nbsp;</div></li><li><div>      $same_medias = $media_obj-&gt;model-&gt;get( array(&nbsp;</div></li><li><div>          'activity_id' =&gt; $activity_id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      $update_activity_media = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $same_medias as $a_media ) {&nbsp;</div></li><li><div>          $update_activity_media[] = $a_media-&gt;id;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $obj_activity = new RTMediaActivity( $update_activity_media, $privacy, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wpdb, $bp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $activity_old_content = bp_activity_get_meta( $activity_id, 'bp_old_activity_content' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $activity_old_content ) ) {&nbsp;</div></li><li><div>          <span class="comment">// get old activity content and save in activity meta</span>&nbsp;</div></li><li><div>          $activity_get = bp_activity_get_specific( array(&nbsp;</div></li><li><div>              'activity_ids' =&gt; $activity_id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>          $activity = $activity_get['activities'][0];&nbsp;</div></li><li><div>          $activity_body = $activity-&gt;content;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_activity_update_meta( $activity_id, 'bp_old_activity_content', $activity_body );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">//extract activity text from old content</span>&nbsp;</div></li><li><div>          $activity_text = strip_tags( $activity_body, '&lt;span&gt;' );&nbsp;</div></li><li><div>          $activity_text = explode( '&lt;/span&gt;', $activity_text );&nbsp;</div></li><li><div>          $activity_text = strip_tags( $activity_text[0] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          bp_activity_update_meta( $activity_id, 'bp_activity_text', $activity_text );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $activity_text = bp_activity_get_meta( $activity_id, 'bp_activity_text' );&nbsp;</div></li><li><div>      $obj_activity-&gt;activity_text = $activity_text;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wpdb-&gt;update( $bp-&gt;activity-&gt;table_name, array(&nbsp;</div></li><li><div>          'type' =&gt; 'rtmedia_update', &nbsp;</div></li><li><div>          'content' =&gt; $obj_activity-&gt;create_activity_html(), &nbsp;</div></li><li><div> ), array(&nbsp;</div></li><li><div>          'id' =&gt; $activity_id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Updating video poster</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string      $html</span>&nbsp;</div></li><li><div><span class="comment"> * @param       object      $media</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $activity</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function update_video_poster( $html, $media, $activity = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'video' === $media-&gt;media_type ) {&nbsp;</div></li><li><div>      $thumbnail_id = $media-&gt;cover_art;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $thumbnail_id ) {&nbsp;</div></li><li><div>          $thumbnail_info = wp_get_attachment_image_src( $thumbnail_id, 'full' );&nbsp;</div></li><li><div>          $html = str_replace( '&lt;video ', '&lt;video poster=&quot;' . esc_url( $thumbnail_info[0] ) . '&quot; ', $html );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $html;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get video without thumbnail</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      wpdb        $wpdb</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_video_without_thumbs() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rtmedia_model = new RTMediaModel();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $sql = $wpdb-&gt;prepare( &quot;select media_id from {$rtmedia_model-&gt;table_name} where media_type = %s and blog_id = %d and cover_art is null&quot;, 'video', get_current_blog_id() ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  $results = $wpdb-&gt;get_col( $sql ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $results;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Rendering single media comment form</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_comment_form() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( is_user_logged_in() ) {&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;form method=&quot;post&quot; id=&quot;rt_media_comment_form&quot; class=&quot;rt_media_comment_form&quot; action=&quot;&lt;?php echo esc_url( get_rtmedia_permalink( rtmedia_id() ) ); ?&gt;comment/&quot;&gt;&nbsp;</div></li><li><div>          &lt;textarea style=&quot;width:100%&quot; placeholder=&quot;&lt;?php esc_attr_e( 'Type Comment...', 'buddypress-media' ); ?&gt;&quot; name=&quot;comment_content&quot; id=&quot;comment_content&quot;&gt;&lt;/textarea&gt;&nbsp;</div></li><li><div>          &lt;input type=&quot;submit&quot; id=&quot;rt_media_comment_submit&quot; class=&quot;rt_media_comment_submit&quot; value=&quot;&lt;?php esc_attr_e( 'Comment', 'buddypress-media' ); ?&gt;&quot;&gt;&nbsp;</div></li><li><div>          &lt;?php RTMediaComment::comment_nonce_generator(); ?&gt;&nbsp;</div></li><li><div>      &lt;/form&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get cover srt using media ID</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       int             $id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_cover_art_src( $id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $model = new RTMediaModel();&nbsp;</div></li><li><div>  $media = $model-&gt;get( array(&nbsp;</div></li><li><div>      'id' =&gt; $id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  $cover_art = $media[0]-&gt;cover_art;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $cover_art ) ) {&nbsp;</div></li><li><div>      if ( is_numeric( $cover_art ) ) {&nbsp;</div></li><li><div>          $thumbnail_info = wp_get_attachment_image_src( $cover_art, 'full' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $thumbnail_info[0];&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return $cover_art;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Rendering media delete form</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool            $echo</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_delete_form( $echo = true ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( rtmedia_delete_allowed() ) {&nbsp;</div></li><li><div>      $html = '&lt;form method=&quot;post&quot; action=&quot;' . esc_url( get_rtmedia_permalink( rtmedia_id() ) ) . 'delete/&quot;&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;input type=&quot;hidden&quot; name=&quot;id&quot; id=&quot;id&quot; value=&quot;' . esc_attr( rtmedia_id() ) . '&quot;&gt;';&nbsp;</div></li><li><div>      $html .= '&lt;input type=&quot;hidden&quot; name=&quot;request_action&quot; id=&quot;request_action&quot; value=&quot;delete&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $echo ) {&nbsp;</div></li><li><div>          echo $html; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          RTMediaMedia::media_nonce_generator( rtmedia_id(), true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          do_action( 'rtmedia_media_single_delete_form' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&lt;button type=&quot;submit&quot; title=&quot;' . esc_attr__( 'Delete Media', 'buddypress-media' ) . '&quot; class=&quot;rtmedia-delete-media rtmedia-action-buttons button&quot;&gt;' . esc_html__( 'Delete', 'buddypress-media' ) . '&lt;/button&gt;&lt;/form&gt;';&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          $output = $html;&nbsp;</div></li><li><div>          $rtm_nonce = RTMediaMedia::media_nonce_generator( rtmedia_id(), false );&nbsp;</div></li><li><div>          $rtm_nonce = json_decode( $rtm_nonce );&nbsp;</div></li><li><div>          $rtm_nonce_field = wp_nonce_field( 'rtmedia_' . rtmedia_id(), $rtm_nonce-&gt;action, true, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          do_action( 'rtmedia_media_single_delete_form' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $output .= $rtm_nonce_field . '&lt;button type=&quot;submit&quot; title=&quot;' . esc_attr__( 'Delete Media', 'buddypress-media' ) . '&quot; class=&quot;rtmedia-delete-media rtmedia-action-buttons button&quot;&gt;' . esc_html__( 'Delete', 'buddypress-media' ) . '&lt;/button&gt;&lt;/form&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $output;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Rendering RTMedia Uploader</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       array|string    $attr</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_uploader( $attr = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( rtmedia_is_uploader_view_allowed( true, 'media_gallery' ) ) {&nbsp;</div></li><li><div>      if ( function_exists( 'bp_is_blog_page' ) && ! bp_is_blog_page() ) {&nbsp;</div></li><li><div>          if ( function_exists( 'bp_is_user' ) && bp_is_user() && function_exists( 'bp_displayed_user_id' ) && bp_displayed_user_id() === get_current_user_id() ) {&nbsp;</div></li><li><div>              echo RTMediaUploadShortcode::pre_render( $attr ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( function_exists( 'bp_is_group' ) && bp_is_group() ) {&nbsp;</div></li><li><div>                  if ( can_user_upload_in_group() ) {&nbsp;</div></li><li><div>                      echo RTMediaUploadShortcode::pre_render( $attr ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      echo &quot;&lt;div class='rtmedia-upload-not-allowed'&gt;&quot; . wp_kses( apply_filters( 'rtmedia_upload_not_allowed_message', esc_html__( 'You are not allowed to upload/attach media.', 'buddypress-media' ), 'media_gallery' ), RTMediaUpload::$wp_kses_allowed_tags ) . '&lt;/div&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Rendering RTMedia Gallery</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       array|string    $attr</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_gallery( $attr = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  echo RTMediaGalleryShortcode::render( $attr ); <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get meta data of media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $id</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|string     $key</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_rtmedia_meta( $id = false, $key = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( apply_filters( 'rtmedia_use_legacy_meta_function', false ) ) {&nbsp;</div></li><li><div>      $rtmediameta = new RTMediaMeta();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $rtmediameta-&gt;get_meta( $id, $key );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">// check whether to get single value or multiple</span>&nbsp;</div></li><li><div>      $single = ( false === $key ) ? false : true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// use WP's default get_metadata function replace column name from &quot;media_id&quot; to &quot;id&quot; in query</span></span></span></span>&nbsp;</div></li><li><div>      add_filter( 'query', 'rtm_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $meta = get_metadata( 'media', $id, $key, $single );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      remove_filter( 'query', 'rtm_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $meta;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add media meta</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $id</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|string     $key</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|string     $value</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool            $duplicate</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function add_rtmedia_meta( $id = false, $key = false, $value = false, $duplicate = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( apply_filters( 'rtmedia_use_legacy_meta_function', false ) ) {&nbsp;</div></li><li><div>      $rtmediameta = new RTMediaMeta( $id, $key, $value, $duplicate );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $rtmediameta-&gt;add_meta( $id, $key, $value, $duplicate );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// use WP's default get_metadata function replace column name from &quot;media_id&quot; to &quot;id&quot; in query</span></span></span></span>&nbsp;</div></li><li><div>      add_filter( 'query', 'rtm_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $meta = add_metadata( 'media', $id, $key, $value, ! $duplicate );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      remove_filter( 'query', 'rtm_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $meta;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Update media meta</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $id</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|string     $key</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|string     $value</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool            $duplicate</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function update_rtmedia_meta( $id = false, $key = false, $value = false, $duplicate = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( apply_filters( 'rtmedia_use_legacy_meta_function', false ) ) {&nbsp;</div></li><li><div>      $rtmediameta = new RTMediaMeta();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $rtmediameta-&gt;update_meta( $id, $key, $value, $duplicate );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// use WP's default get_metadata function replace column name from &quot;media_id&quot; to &quot;id&quot; in query</span></span></span></span>&nbsp;</div></li><li><div>      add_filter( 'query', 'rtm_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $meta = update_metadata( 'media', $id, $key, $value, $duplicate );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      remove_filter( 'query', 'rtm_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $meta;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Delete media meta</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $id</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|string     $key</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array|bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function delete_rtmedia_meta( $id = false, $key = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( apply_filters( 'rtmedia_use_legacy_meta_function', false ) ) {&nbsp;</div></li><li><div>      $rtmediameta = new RTMediaMeta();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $rtmediameta-&gt;delete_meta( $id, $key );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment"><span class="comment">// use WP's default get_metadata function replace column name from &quot;media_id&quot; to &quot;id&quot; in query</span></span></span></span>&nbsp;</div></li><li><div>      add_filter( 'query', 'rtm_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $meta = delete_metadata( 'media', $id, $key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      remove_filter( 'query', 'rtm_filter_metaid_column_name' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $meta;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get global albums</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_global_albums() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return RTMediaAlbum::get_globals();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get global album list</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $selected_album_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      null|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_global_album_list( $selected_album_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $model = new RTMediaModel();&nbsp;</div></li><li><div>  $global_albums = rtmedia_global_albums();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false === $selected_album_id && ! empty( $global_albums ) && is_array( $global_albums ) ) {&nbsp;</div></li><li><div>      $selected_album_id = $global_albums[0];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $option = null;&nbsp;</div></li><li><div>  $album_objects = $model-&gt;get_media( array(&nbsp;</div></li><li><div>      'id' =&gt; $global_albums&nbsp;</div></li><li><div> ), false, false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $album_objects ) {&nbsp;</div></li><li><div>      foreach ( $album_objects as $album ) {&nbsp;</div></li><li><div>          <span class="comment">//if selected_album_id is provided, keep that album_id selected by default</span>&nbsp;</div></li><li><div>          $selected = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $selected_album_id ) && $selected_album_id === $album-&gt;id ) {&nbsp;</div></li><li><div>              $selected = 'selected=&quot;selected&quot;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $option .= '&lt;option value=&quot;' . esc_attr( $album-&gt;id ) . '&quot; ' . $selected . '&gt;' . esc_html( $album-&gt;media_title ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $option;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get user's album list</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery    $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool            $get_all</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $selected_album_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_user_album_list( $get_all = false, $selected_album_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $model = new RTMediaModel();&nbsp;</div></li><li><div>  $global_option = rtmedia_global_album_list( $selected_album_id );&nbsp;</div></li><li><div>  $global_albums = rtmedia_global_albums();&nbsp;</div></li><li><div>  $album_objects = $model-&gt;get_media( array(&nbsp;</div></li><li><div>      'media_author' =&gt; get_current_user_id(), &nbsp;</div></li><li><div>      'media_type' =&gt; 'album', &nbsp;</div></li><li><div> ), false, 'context' );&nbsp;</div></li><li><div>  $option_group = '';&nbsp;</div></li><li><div>  $profile_option = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $album_objects ) {&nbsp;</div></li><li><div>      foreach ( $album_objects as $album ) {&nbsp;</div></li><li><div>          if ( ! in_array( $album-&gt;id, array_map( 'intval', $global_albums ), true ) && ( ( isset( $rtmedia_query-&gt;media_query['album_id'] ) && ( $album-&gt;id !== $rtmedia_query-&gt;media_query['album_id'] || $get_all ) ) || ! isset( $rtmedia_query-&gt;media_query['album_id'] ) ) ) {&nbsp;</div></li><li><div>              if ( 'profile' === $album-&gt;context ) {&nbsp;</div></li><li><div>                  $profile_option .= '&lt;option value=&quot;' . esc_attr( $album-&gt;id ) . '&quot; ' . selected( $selected_album_id, $album-&gt;id, false ) . '&gt;' . esc_html( $album-&gt;media_title ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $option = apply_filters( 'rtmedia_global_albums_in_uploader', &quot;$global_option&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' != $profile_option ) {&nbsp;</div></li><li><div>      $option .= &quot;&lt;optgroup label='&quot; . esc_attr__( 'Profile Albums', 'buddypress-media' ) . &quot; ' value = 'profile'&gt;$profile_option&lt;/optgroup&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( '' != $option_group && class_exists( 'BuddyPress' ) ) {&nbsp;</div></li><li><div>      $option .= &quot;&lt;optgroup label='&quot; . esc_attr__( 'Group Albums', 'buddypress-media' ) . &quot;' value = 'group'&gt;$option_group&lt;/optgroup&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $option ) {&nbsp;</div></li><li><div>      return $option;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get group's album list</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery        $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int            $selected_album_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|null|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_group_album_list( $selected_album_id = false ) {&nbsp;</div></li><li><div>  <span class="comment">//by default, first album in list will be selected</span>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $model = new RTMediaModel();&nbsp;</div></li><li><div>  $global_option = rtmedia_global_album_list( $selected_album_id );&nbsp;</div></li><li><div>  $global_albums = rtmedia_global_albums();&nbsp;</div></li><li><div>  $album_objects = $model-&gt;get_media( array(&nbsp;</div></li><li><div>      'context' =&gt; $rtmedia_query-&gt;media_query['context'], &nbsp;</div></li><li><div>      'context_id' =&gt; $rtmedia_query-&gt;media_query['context_id'], &nbsp;</div></li><li><div>      'media_type' =&gt; 'album', &nbsp;</div></li><li><div> ), false, false );&nbsp;</div></li><li><div>  $option_group = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $album_objects ) {&nbsp;</div></li><li><div>      foreach ( $album_objects as $album ) {&nbsp;</div></li><li><div>          if ( ! in_array( $album-&gt;id, $global_albums ) && ( ( isset( $rtmedia_query-&gt;media_query['album_id'] ) && ( $album-&gt;id != $rtmedia_query-&gt;media_query['album_id'] ) ) || ! isset( $rtmedia_query-&gt;media_query['album_id'] ) ) ) {&nbsp;</div></li><li><div>              $option_group .= '&lt;option value=&quot;' . esc_attr( $album-&gt;id ) . '&quot; ' . selected( $selected_album_id, $album-&gt;id ) . '&gt;' . esc_html( $album-&gt;media_title ) . '&lt;/option&gt;';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $option = $global_option;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $option_group ) ) {&nbsp;</div></li><li><div>      $option .= &quot;&lt;optgroup label='&quot; . esc_attr__( 'Group Albums', 'buddypress-media' ) . &quot;' value = 'group'&gt;$option_group&lt;/optgroup&gt;&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $option ) {&nbsp;</div></li><li><div>      return $option;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if album creation is allowed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtm_is_album_create_allowed() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'rtm_is_album_create_enable', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if user has an access to create an album</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $user_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtm_is_user_allowed_to_create_album( $user_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! $user_id ) {&nbsp;</div></li><li><div>      $user_id = get_current_user_id();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'rtm_display_create_album_button', true, $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if album is editable</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery        $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_is_album_editable() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;query['context'] ) && 'profile' === $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>      if ( isset( $rtmedia_query-&gt;media_query['media_author'] ) && get_current_user_id() === intval( $rtmedia_query-&gt;media_query['media_author'] ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;query['context'] ) && 'group' === $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>      if ( isset( $rtmedia_query-&gt;album[0]-&gt;media_author ) && get_current_user_id() === intval( $rtmedia_query-&gt;album[0]-&gt;media_author ) ) {&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Rendering sub nav</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaNav      $rtMediaNav</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_sub_nav() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtMediaNav;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rtMediaNav = new RTMediaNav();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rtMediaNav-&gt;sub_nav();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if album is enable</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_album_enable() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia-&gt;options['general_enableAlbums'] ) && 0 !== intval( $rtmedia-&gt;options['general_enableAlbums'] ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Loading right media template</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_load_template() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'rtmedia_before_template_load' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  include( RTMediaTemplate::locate_template() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  do_action( 'rtmedia_after_template_load' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if privacy is enabled</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_privacy_enable() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia-&gt;options['privacy_enabled'] ) && 0 !== intval( $rtmedia-&gt;options['privacy_enabled'] ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if user can override the existing privacy</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_privacy_user_overide() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia-&gt;options['privacy_userOverride'] ) && 0 !== intval( $rtmedia-&gt;options['privacy_userOverride'] ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Rendering privacy UI</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery        $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_edit_media_privacy_ui() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;query['context'] ) && 'group' === $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>      <span class="comment">//if context is group i.e editing a group media, dont show the privacy dropdown</span>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $privacymodel = new RTMediaPrivacy( false );&nbsp;</div></li><li><div>  $privacy = $privacymodel-&gt;select_privacy_ui( $echo = false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $privacy ) {&nbsp;</div></li><li><div>      return &quot;&lt;div class='rtmedia-edit-privacy rtm-field-wrap'&gt;&lt;label for='privacy'&gt;&quot; . esc_html__( 'Privacy : ', 'buddypress-media' ) . '&lt;/label&gt;' . $privacy . '&lt;/div&gt;';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get default privacy</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_rtmedia_default_privacy() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia-&gt;options['privacy_default'] ) ) {&nbsp;</div></li><li><div>      return $rtmedia-&gt;options['privacy_default'];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if media is enabled in BuddyPress group</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_group_media_enable() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia-&gt;options['buddypress_enableOnGroup'] ) && 0 !== intval( $rtmedia-&gt;options['buddypress_enableOnGroup'] ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if media is enabled in BuddyPress Member's profile</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_profile_media_enable() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia-&gt;options['buddypress_enableOnProfile'] ) && 0 !== intval( $rtmedia-&gt;options['buddypress_enableOnProfile'] ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if user in group component</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery        $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_bp_group() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;query['context'] ) && 'group' === $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if user in profile component</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery        $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_bp_profile() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia_query-&gt;query['context'] ) && 'profile' == $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if user can upload in BuddyPress group</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function can_user_upload_in_group() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $group = groups_get_current_group();&nbsp;</div></li><li><div>  $user_id = get_current_user_id();&nbsp;</div></li><li><div>  $display_flag = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( groups_is_user_member( $user_id, $group-&gt;id ) ) {&nbsp;</div></li><li><div>      $display_flag = true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $display_flag = apply_filters( 'rtm_can_user_upload_in_group', $display_flag );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $display_flag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if user can create an album in BuddyPress group</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $group_id</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $user_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function can_user_create_album_in_group( $group_id = false, $user_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( false == $group_id ) {&nbsp;</div></li><li><div>      $group = groups_get_current_group();&nbsp;</div></li><li><div>      $group_id = $group-&gt;id;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $upload_level = groups_get_groupmeta( $group_id, 'rt_media_group_control_level' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $upload_level ) ) {&nbsp;</div></li><li><div>      $upload_level = groups_get_groupmeta( $group_id, 'bp_media_group_control_level' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $upload_level ) ) {&nbsp;</div></li><li><div>          $upload_level = 'all';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_id = get_current_user_id();&nbsp;</div></li><li><div>  $display_flag = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( groups_is_user_member( $user_id, $group_id ) ) {&nbsp;</div></li><li><div>      if ( 'admin' === $upload_level ) {&nbsp;</div></li><li><div>          if ( groups_is_user_admin( $user_id, $group_id ) &gt; 0 ) {&nbsp;</div></li><li><div>              $display_flag = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          if ( 'moderators' === $upload_level ) {&nbsp;</div></li><li><div>              if ( groups_is_user_mod( $user_id, $group_id ) || groups_is_user_admin( $user_id, $group_id ) ) {&nbsp;</div></li><li><div>                  $display_flag = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $display_flag = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $display_flag = apply_filters( 'can_user_create_album_in_group', $display_flag );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $display_flag;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if video upload is allowed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_upload_video_enabled() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia-&gt;options['allowedTypes_video_enabled'] ) && 0 !== intval( $rtmedia-&gt;options['allowedTypes_video_enabled'] ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if photo upload is allowed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_upload_photo_enabled() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia-&gt;options['allowedTypes_photo_enabled'] ) && 0 !== intval( $rtmedia-&gt;options['allowedTypes_photo_enabled'] ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if music upload is allowed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_upload_music_enabled() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $rtmedia-&gt;options['allowedTypes_music_enabled'] ) && 0 !== intval( $rtmedia-&gt;options['allowedTypes_music_enabled'] ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get allowed media upload type</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_rtmedia_allowed_upload_type() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $allow_type_str = '';&nbsp;</div></li><li><div>  $sep = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $rtmedia-&gt;allowed_types as $type ) {&nbsp;</div></li><li><div>      if ( function_exists( 'is_rtmedia_upload_' . $type['name'] . '_enabled' ) && call_user_func( 'is_rtmedia_upload_' . $type['name'] . '_enabled' ) ) {&nbsp;</div></li><li><div>          foreach ( $type['extn'] as $extn ) {&nbsp;</div></li><li><div>              $allow_type_str .= $sep . $extn;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $sep = ', ';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $allow_type_str;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if is admin</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rt_admin() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return current_user_can( 'list_users' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media like count</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int        $media_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array|int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_rtmedia_like( $media_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $mediamodel = new RTMediaModel();&nbsp;</div></li><li><div>  $actions = $mediamodel-&gt;get( array(&nbsp;</div></li><li><div>      'id' =&gt; rtmedia_id( $media_id )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $actions[0]-&gt;likes ) ) {&nbsp;</div></li><li><div>      $actions = intval( $actions[0]-&gt;likes );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $actions = 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $actions;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Show media like count</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function show_rtmedia_like_counts() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $options = $rtmedia-&gt;options;&nbsp;</div></li><li><div>  $count = get_rtmedia_like();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! ( isset( $options['general_enableLikes'] ) && 0 === intval( $options['general_enableLikes'] ) ) ) {&nbsp;</div></li><li><div>      $class = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! intval( $count ) ) {&nbsp;</div></li><li><div>          $class = 'hide';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      ?&gt;&nbsp;</div></li><li><div>      &lt;div class='rtmedia-like-info &lt;?php echo $class; ?&gt;'&gt;&nbsp;</div></li><li><div>          &lt;i class=&quot;rtmicon-thumbs-up rtmicon-fw&quot;&gt;&lt;/i&gt; &lt;span class=&quot;rtmedia-like-counter-wrap&quot;&gt;&lt;span class=&quot;rtmedia-like-counter&quot;&gt;&lt;?php echo esc_html( $count ); ?&gt;&lt;/span&gt; &lt;?php esc_html_e( 'people like this', 'buddypress-media' ); ?&gt;&lt;/span&gt;&nbsp;</div></li><li><div>      &lt;/div&gt;&nbsp;</div></li><li><div>      &lt;?php&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get music cover art</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       object          $media_object</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtm_get_music_cover_art( $media_object ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// return URL if cover_art already set.</span>&nbsp;</div></li><li><div>  $url = $media_object-&gt;cover_art;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $url ) && ! is_numeric( $url ) ) {&nbsp;</div></li><li><div>      return $url;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// return false if covert_art is already analyzed earlier</span>&nbsp;</div></li><li><div>  if ( -1 === intval( $url ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Analyze media for the first time and set cover_art into database.</span>&nbsp;</div></li><li><div>  $file = get_attached_file( $media_object-&gt;media_id );&nbsp;</div></li><li><div>  $media_obj = new RTMediaMedia();&nbsp;</div></li><li><div>  $media_tags = new RTMediaTags( $file );&nbsp;</div></li><li><div>  $title_info = $media_tags-&gt;title;&nbsp;</div></li><li><div>  $image_info = $media_tags-&gt;image;&nbsp;</div></li><li><div>  $image_mime = $image_info['mime'];&nbsp;</div></li><li><div>  $mime = explode( '/', $image_mime );&nbsp;</div></li><li><div>  $id = $media_object-&gt;id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $image_info['data'] ) ) {&nbsp;</div></li><li><div>      $thumb_upload_info = wp_upload_bits( $title_info . '.' . $mime[ count( $mime ) - 1 ], null, $image_info['data'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $thumb_upload_info ) && ! empty( $thumb_upload_info['url'] ) ) {&nbsp;</div></li><li><div>          $media_obj-&gt;model-&gt;update( array(&nbsp;</div></li><li><div>              'cover_art' =&gt; $thumb_upload_info['url']&nbsp;</div></li><li><div> ), array(&nbsp;</div></li><li><div>              'id' =&gt; $id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $thumb_upload_info['url'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $media_obj-&gt;model-&gt;update( array(&nbsp;</div></li><li><div>      'cover_art' =&gt; '-1'&nbsp;</div></li><li><div> ), array(&nbsp;</div></li><li><div>      'id' =&gt; $id&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * &quot;get_music_cover_art&quot; is too generic function name. It shouldn't added in very first place.</span>&nbsp;</div></li><li><div><span class="comment"> * It is renamed as &quot;rtm_get_music_cover_art&quot;</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>if ( ! function_exists( 'get_music_cover_art' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  function get_music_cover_art( $file, $id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get the media privacy symbol</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $rtmedia_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_rtmedia_privacy_symbol( $rtmedia_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $mediamodel = new RTMediaModel();&nbsp;</div></li><li><div>  $actions = $mediamodel-&gt;get( array(&nbsp;</div></li><li><div>      'id' =&gt; rtmedia_id( $rtmedia_id )&nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>  $privacy = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( intval( $actions[0]-&gt;privacy ) &gt;= 0 ) {&nbsp;</div></li><li><div>      $title = $icon = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $actions[0]-&gt;privacy ) {&nbsp;</div></li><li><div>          case 0: <span class="comment">// public</span>&nbsp;</div></li><li><div>              $title = esc_html__( 'Public', 'buddypress-media' );&nbsp;</div></li><li><div>              $icon = 'dashicons dashicons-admin-site rtmicon';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 20: <span class="comment">// users</span>&nbsp;</div></li><li><div>              $title = esc_html__( 'All members', 'buddypress-media' );&nbsp;</div></li><li><div>              $icon = 'dashicons dashicons-groups rtmicon';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 40: <span class="comment">// friends</span>&nbsp;</div></li><li><div>              $title = esc_html__( 'Your friends', 'buddypress-media' );&nbsp;</div></li><li><div>              $icon = 'dashicons dashicons-networking rtmicon';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 60: <span class="comment"><span class="comment">// private</span></span>&nbsp;</div></li><li><div>              $title = esc_html__( 'Only you', 'buddypress-media' );&nbsp;</div></li><li><div>              $icon = 'dashicons dashicons-lock rtmicon';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 80: <span class="comment"><span class="comment">// private</span></span>&nbsp;</div></li><li><div>              $title = esc_html__( 'Blocked temporarily', 'buddypress-media' );&nbsp;</div></li><li><div>              $icon = 'dashicons dashicons-dismiss rtmicon';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $title ) && ! empty( $icon ) ) {&nbsp;</div></li><li><div>          $privacy = &quot;&lt;i class='&quot; . esc_attr( $icon ) . &quot;' title='&quot; . esc_attr( $title ) . &quot;'&gt;&lt;/i&gt;&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $privacy;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media uploaded gmt date</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $rtmedia_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_rtmedia_date_gmt( $rtmedia_id = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $media = get_post( rtmedia_media_id( rtmedia_id( $rtmedia_id ) ) );&nbsp;</div></li><li><div>  $date_time = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $media-&gt;post_date_gmt ) ) {&nbsp;</div></li><li><div>      $date_time = rtmedia_convert_date( $media-&gt;post_date_gmt );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $date_time = apply_filters( 'rtmedia_comment_date_format', $date_time, null );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return '&lt;span&gt;' . $date_time . '&lt;/span&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Convert comment datetime to &quot;time ago&quot; format</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string      $_date</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_convert_date( $_date ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $stf = 0;&nbsp;</div></li><li><div>  $date = new DateTime( $_date );&nbsp;</div></li><li><div>  $date = $date-&gt;format( 'U' );&nbsp;</div></li><li><div>  $cur_time = time();&nbsp;</div></li><li><div>  $diff = $cur_time - $date;&nbsp;</div></li><li><div>  $time_unit = array( 'second', 'minute', 'hour' );&nbsp;</div></li><li><div>  $length = array( 1, 60, 3600, 86400 );&nbsp;</div></li><li><div>  $ago_text = esc_html__( '%s ago ', 'buddypress-media' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  for ( $i = sizeof( $length ) - 1; ( $i &gt;= 0 ) && ( ( $no = $diff / $length[ $i ] ) &lt;= 1 ); $i -- );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $i &lt; 0 ) {&nbsp;</div></li><li><div>      $i = 0;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $i &lt;= 2 ) { <span class="comment">//if posted in last 24 hours</span>&nbsp;</div></li><li><div>      $_time = $cur_time - ( $diff % $length[ $i ] );&nbsp;</div></li><li><div>      $no = floor( $no );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $time_unit[ $i ] ) {&nbsp;</div></li><li><div>          case 'second':&nbsp;</div></li><li><div>              $time_unit_phrase = _n( '1 second', '%s seconds', $no, 'buddypress-media' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'minute':&nbsp;</div></li><li><div>              $time_unit_phrase = _n( '1 minute', '%s minutes', $no, 'buddypress-media' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          case 'hour':&nbsp;</div></li><li><div>              $time_unit_phrase = _n( '1 hour', '%s hours', $no, 'buddypress-media' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              <span class="comment">// should not happen</span>&nbsp;</div></li><li><div>              $time_unit_phrase = '%s unknown';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $value = sprintf( $time_unit_phrase . ' ', $no );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ( 1 === $stf ) && ( $i &gt;= 1 ) && ( ( $cur_time - $_time ) &gt; 0 ) ) {&nbsp;</div></li><li><div>          $value .= rtmedia_convert_date( $_time );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return sprintf( $ago_text, $value );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      <span class="comment">/** translators: date format, see http://php.net/date */</span>&nbsp;</div></li><li><div>      return date_i18n( 'd F Y ', strtotime( $_date ), true );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get media counts</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMediaQuery        $rtmedia_query</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array|void</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_media_counts() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $user_id = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( function_exists( 'bp_displayed_user_id' ) ) {&nbsp;</div></li><li><div>      $user_id = bp_displayed_user_id();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      if ( isset( $rtmedia_query ) && isset( $rtmedia_query-&gt;query['context_id'] ) && 'profile' === $rtmedia_query-&gt;query['context'] ) {&nbsp;</div></li><li><div>          $user_id = $rtmedia_query-&gt;query['context_id'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $media_nav = new RTMediaNav( false );&nbsp;</div></li><li><div>  $temp = $media_nav-&gt;actual_counts( $user_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $temp;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if it is rtmedia's edit page</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      string      $pagenow</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       null        $new_edit</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_is_edit_page( $new_edit = null ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $pagenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">//make sure we are on the backend</span>&nbsp;</div></li><li><div>  if ( ! is_admin() ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( 'edit' === $new_edit ) {&nbsp;</div></li><li><div>      return in_array( $pagenow, array( 'post.php' ), true );&nbsp;</div></li><li><div>  } elseif ( 'new' === $new_edit ) { <span class="comment">//check for new post page</span>&nbsp;</div></li><li><div>      return in_array( $pagenow, array( 'post-new.php' ), true );&nbsp;</div></li><li><div>  } else { <span class="comment">//check for either new or edit</span>&nbsp;</div></li><li><div>      return in_array( $pagenow, array( 'post.php', 'post-new.php' ), true );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if it's a rtmedia page</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_interaction</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function is_rtmedia_page() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! defined( 'RTMEDIA_MEDIA_SLUG' ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_interaction;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $rtmedia_interaction ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! isset( $rtmedia_interaction-&gt;routes ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $rtmedia_interaction-&gt;routes[ RTMEDIA_MEDIA_SLUG ]-&gt;is_template();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * To be used in migration in importing</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       int         $seconds_left</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_migrate_formatseconds( $seconds_left ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $minute_in_seconds = 60;&nbsp;</div></li><li><div>  $hour_in_seconds = $minute_in_seconds * 60;&nbsp;</div></li><li><div>  $day_in_seconds = $hour_in_seconds * 24;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $days = floor( $seconds_left / $day_in_seconds );&nbsp;</div></li><li><div>  $seconds_left = $seconds_left % $day_in_seconds;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $hours = floor( $seconds_left / $hour_in_seconds );&nbsp;</div></li><li><div>  $seconds_left = $seconds_left % $hour_in_seconds;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $minutes = floor( $seconds_left / $minute_in_seconds );&nbsp;</div></li><li><div>  $seconds = $seconds_left % $minute_in_seconds;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $time_components = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $days &gt; 0 ) {&nbsp;</div></li><li><div>      $time_components[] = $days . ' day' . ( $days &gt; 1 ? 's' : '' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $hours &gt; 0 ) {&nbsp;</div></li><li><div>      $time_components[] = $hours . ' hour' . ( $hours &gt; 1 ? 's' : '' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $minutes &gt; 0 ) {&nbsp;</div></li><li><div>      $time_components[] = $minutes . ' minute' . ( $minutes &gt; 1 ? 's' : '' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $seconds &gt; 0 ) {&nbsp;</div></li><li><div>      $time_components[] = $seconds . ' second' . ( $seconds &gt; 1 ? 's' : '' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( count( $time_components ) &gt; 0 ) {&nbsp;</div></li><li><div>      $formatted_time_remaining = implode( ', ', $time_components );&nbsp;</div></li><li><div>      $formatted_time_remaining = trim( $formatted_time_remaining );&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      $formatted_time_remaining = 'No time remaining.';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $formatted_time_remaining;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * echo the size of the media file</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      array       $rtmedia_backbone</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_file_size() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia_backbone;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( $rtmedia_backbone['backbone'] ) {&nbsp;</div></li><li><div>      echo '&lt;%= file_size %&gt;';&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $rtmedia_media-&gt;file_size ) ) {&nbsp;</div></li><li><div>          return $rtmedia_media-&gt;file_size;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return filesize( get_attached_file( $rtmedia_media-&gt;media_id ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get rtmedia media type from file extension</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia             $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string              $extn</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|int|string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_media_type_from_extn( $extn ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $allowed_type = $rtmedia-&gt;allowed_types;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $allowed_type as $type =&gt; $param ) {&nbsp;</div></li><li><div>      if ( isset( $param['extn'] ) && is_array( $param['extn'] ) && in_array( $extn, $param['extn'], true ) ) {&nbsp;</div></li><li><div>          return $type;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get extension from media id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      object      $rtmedia_media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool|int    $media_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_extension( $media_id = false ) {&nbsp;</div></li><li><div>  <span class="comment">// If media_id is false then use global media_id</span>&nbsp;</div></li><li><div>  if ( ! $media_id ) {&nbsp;</div></li><li><div>      global $rtmedia_media;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $rtmedia_media-&gt;media_id ) ) {&nbsp;</div></li><li><div>          $media_id = $rtmedia_media-&gt;media_id;&nbsp;</div></li><li><div>      } else {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Getting filename from media id</span>&nbsp;</div></li><li><div>  $filename = basename( wp_get_attachment_url( $media_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Checking file type of uploaded document</span>&nbsp;</div></li><li><div>  $file_type = wp_check_filetype( $filename );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// return the extension of the filename</span>&nbsp;</div></li><li><div>  return $file_type['ext'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Function to get permalink for current blog</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string      $domain</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_current_blog_url( $domain ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $domain = get_home_url( get_current_blog_id() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $domain;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if album is global</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       int     $album_id</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_is_global_album( $album_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rtmedia_global_albums = rtmedia_global_albums();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! in_array( intval( $album_id ), $rtmedia_global_albums, true ) ) {&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if uploader view is allowed</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       bool        $allow</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string      $section</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_is_uploader_view_allowed( $allow, $section = 'media_gallery' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return apply_filters( 'rtmedia_allow_uploader_view', $allow, $section );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Get rtMedia Encoding API Key</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function get_rtmedia_encoding_api_key() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return get_site_option( 'rtmedia-encoding-api-key' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Filter SQL query strings to swap out the 'meta_id' column.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * WordPress uses the meta_id column for commentmeta and postmeta, and so</span>&nbsp;</div></li><li><div><span class="comment"> * hardcodes the column name into its *_metadata() functions. rtMedia</span>&nbsp;</div></li><li><div><span class="comment"> * uses 'id' for the primary column. To make WP's functions usable for rtMedia, </span>&nbsp;</div></li><li><div><span class="comment"> * we use this filter on 'query' to swap all 'meta_id' with 'id.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string      $q</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtm_filter_metaid_column_name( $q ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Replace quoted content with __QUOTE__ to avoid false positives.</span>&nbsp;</div></li><li><div><span class="comment">   * This regular expression will match nested quotes.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  $quoted_regex = &quot;/'[^'\\\\]*(?:\\\\.[^'\\\\]*)*'/s&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  preg_match_all( $quoted_regex, $q, $quoted_matches );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $q = preg_replace( $quoted_regex, '__QUOTE__', $q );&nbsp;</div></li><li><div>  $q = str_replace( 'meta_id', 'id', $q );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// Put quoted content back into the string.</span>&nbsp;</div></li><li><div>  if ( ! empty( $quoted_matches[0] ) ) {&nbsp;</div></li><li><div>      for ( $i = 0; $i &lt; count( $quoted_matches[0] ); $i ++ ) {&nbsp;</div></li><li><div>          $quote_pos = strpos( $q, '__QUOTE__' );&nbsp;</div></li><li><div>          $q = substr_replace( $q, $quoted_matches[0][ $i ], $quote_pos, 9 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $q;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Checking if SCRIPT_DEBUG constant is defined or not</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtm_get_script_style_suffix() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $suffix = ( defined( 'SCRIPT_DEBUG' ) && constant( 'SCRIPT_DEBUG' ) === true ) ? '' : '.min';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $suffix;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * To get list of allowed types in rtMedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since       3.8.16</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @global      RTMedia     $rtmedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_allowed_types() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  global $rtmedia;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $allowed_media_type = $rtmedia-&gt;allowed_types;&nbsp;</div></li><li><div>  $allowed_media_type = apply_filters( 'rtmedia_allowed_types', $allowed_media_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $allowed_media_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * To get list of allowed upload types in rtMedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since       3.8.16</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_allowed_upload_types() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $allowed_types = rtmedia_get_allowed_types();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  foreach ( $allowed_types as $type =&gt; $type_detail ) {&nbsp;</div></li><li><div>      if ( ! ( function_exists( 'is_rtmedia_upload_' . $type . '_enabled' ) && call_user_func( 'is_rtmedia_upload_' . $type . '_enabled' ) ) ) {&nbsp;</div></li><li><div>          unset( $allowed_types[ $type ] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $allowed_types;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * To get list of allowed upload type name in rtMedia</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since       3.8.16</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_get_allowed_upload_types_array() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $allowed_types = rtmedia_get_allowed_upload_types();&nbsp;</div></li><li><div>  $types = array_keys( $allowed_types );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $types;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Upload and add media</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       array       $upload_params</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool|int</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_add_media( $upload_params = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $upload_params ) ) {&nbsp;</div></li><li><div>      $upload_params = $_POST; <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// @codingStandardsIgnoreLine</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $upload_model = new RTMediaUploadModel();&nbsp;</div></li><li><div>  $upload_array = $upload_model-&gt;set_post_object( $upload_params );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $rtupload = new RTMediaUpload( $upload_array );&nbsp;</div></li><li><div>  $media_id = isset( $rtupload-&gt;media_ids[0] ) ? $rtupload-&gt;media_ids[0] : false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $media_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Add multiple meta key and value for media.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       int         $media_id</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string      $meta_key_val</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      array</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtmedia_add_multiple_meta( $media_id, $meta_key_val ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $meta_ids = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! empty( $media_id ) && ! empty( $meta_key_val ) ) {&nbsp;</div></li><li><div>      $media_meta = new RTMediaMeta();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $meta_key_val as $meta_key =&gt; $meta_val ) {&nbsp;</div></li><li><div>          $meta_ids[] = $media_meta-&gt;add_meta( $media_id, $meta_key, $meta_val );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $meta_ids;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * To get server variable</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string      $server_key</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string      $filter_type</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      string</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtm_get_server_var( $server_key, $filter_type = 'FILTER_SANITIZE_STRING' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  $server_val = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( function_exists( 'filter_input' ) && filter_has_var( INPUT_SERVER, $server_key ) ) {&nbsp;</div></li><li><div>      $server_val = filter_input( INPUT_SERVER, $server_key, constant( $filter_type ) );&nbsp;</div></li><li><div>  } elseif( isset( $_SERVER[ $server_key ] ) ) {&nbsp;</div></li><li><div>      $server_val = $_SERVER[ $server_key ];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  return $server_val;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Check if URL exists of a given media type (i.e mp4, ogg, wmv)</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @param       array       $medias</span>&nbsp;</div></li><li><div><span class="comment"> * @param       string      $media_type</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @return      bool</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>function rtt_is_video_exists( $medias, $media_type = 'mp4' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( empty( $medias ) || empty( $media_type ) ) {&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( isset( $medias[ $media_type ] ) && is_array( $medias[ $media_type ] ) && ! empty( $medias[ $media_type ][0] ) ) {&nbsp;</div></li><li><div>      return $medias[ $media_type ][0];&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>rtMedia for WordPress, BuddyPress and bbPress</li><li><span></span>4.3.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>