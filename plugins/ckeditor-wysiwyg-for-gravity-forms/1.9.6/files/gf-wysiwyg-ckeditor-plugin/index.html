<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="1.9.6" data-slug="ckeditor-wysiwyg-for-gravity-forms" data-type="file" data-id="70733"><head xmlns="http://www.w3.org/1999/xhtml"><title> gf-wysiwyg-ckeditor-plugin | file | Ckeditor Wysiwyg For Gravity Forms | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, ckeditor-wysiwyg-for-gravity-forms, 1.9.6" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=91a8e917c9a687f9c349ac22ad099207' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/gf-wysiwyg-ckeditor-plugin/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fgf-wysiwyg-ckeditor-plugin%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fgf-wysiwyg-ckeditor-plugin%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-ckeditor-wysiwyg-for-gravity-forms-1.9.6-file-gf-wysiwyg-ckeditor-plugin","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="gf-wysiwyg-ckeditor-plugin" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to ckeditor-wysiwyg-for-gravity-&hellip;." href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/" class="plugin"><span property="name">ckeditor-wysiwyg-for-gravity-&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.9.6." href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/" class="H_VERSION"><span property="name">1.9.6</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">gf-wysiwyg-ckeditor-plugin</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="10"><a href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/all/" title="All">All <span class="count badge">10</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="3"><a href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/hooks/" title="Hooks">Hooks <span class="count badge">3</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="3"><a href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/filters/" title="Filters">Filters <span class="count badge">3</span></a></li><li class="" data-id="class" data-count="6"><a href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/classes/" title="Classes">Classes <span class="count badge">6</span></a></li><li class="" data-id="constant" data-count="0"><a href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/constants/" title="Constants">Constants <span class="count badge">0</span></a></li><li class="" data-id="function" data-count="1"><a href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/functions/" title="Functions">Functions <span class="count badge">1</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/ckeditor-wysiwyg-for-gravity-forms/1.9.6/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/gf_wysiwyg_ckeditor_plugin.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">Plugin Name: CKEditor WYSIWYG for Gravity Forms</span>&nbsp;</div></li><li><div><span class="comment">Description: Use the CKEditor WYSIWYG in your Gravity Forms</span>&nbsp;</div></li><li><div><span class="comment">Version: 1.9.6</span>&nbsp;</div></li><li><div><span class="comment">Author: Adrian Gordon</span>&nbsp;</div></li><li><div><span class="comment">Author URI: http://www.itsupportguides.com</span>&nbsp;</div></li><li><div><span class="comment">License: GPL2</span>&nbsp;</div></li><li><div><span class="comment">Text Domain: gravity-forms-wysiwyg-ckeditor</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">------------------------------------------------------------------------</span>&nbsp;</div></li><li><div><span class="comment">Copyright 2015 Adrian Gordon</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">This program is free software; you can redistribute it and/or modify</span>&nbsp;</div></li><li><div><span class="comment">it under the terms of the GNU General Public License as published by</span>&nbsp;</div></li><li><div><span class="comment">the Free Software Foundation; either version 2 of the License, or</span>&nbsp;</div></li><li><div><span class="comment">(at your option) any later version.</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">This program is distributed in the hope that it will be useful, </span>&nbsp;</div></li><li><div><span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>&nbsp;</div></li><li><div><span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>&nbsp;</div></li><li><div><span class="comment">GNU General Public License for more details.</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">You should have received a copy of the GNU General Public License</span>&nbsp;</div></li><li><div><span class="comment">along with this program; if not, write to the Free Software</span>&nbsp;</div></li><li><div><span class="comment">Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! defined( 'ABSPATH' ) ) {&nbsp;</div></li><li><div>  die();&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>load_plugin_textdomain( 'gravity-forms-wysiwyg-ckeditor', false, dirname( plugin_basename( __FILE__ ) ) . '/lang' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">// include upload handler for image upload feature -- extends default classes</span>&nbsp;</div></li><li><div>if ( !class_exists( 'UploadHandler' ) && version_compare( phpversion(), '5.4', '&gt;=' ) ) {&nbsp;</div></li><li><div>  require_once( plugin_dir_path( __FILE__ ).'UploadHandler.php' );&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( class_exists( 'UploadHandler' ) ) {&nbsp;</div></li><li><div>  class ITSG_GFCKEDITOR_UploadHandler extends UploadHandler {&nbsp;</div></li><li><div>      public function post( $print_response = true ) {&nbsp;</div></li><li><div>          $upload = $this-&gt;get_upload_data( $this-&gt;options['param_name'] );&nbsp;</div></li><li><div>          <span class="comment">// Parse the Content-Disposition header, if available:</span>&nbsp;</div></li><li><div>          $content_disposition_header = $this-&gt;get_server_var( 'HTTP_CONTENT_DISPOSITION' );&nbsp;</div></li><li><div>          $file_name = $content_disposition_header ?&nbsp;</div></li><li><div>          rawurldecode(preg_replace(&nbsp;</div></li><li><div>          '/(^[^&quot;]+&quot;)|(&quot;$)/', &nbsp;</div></li><li><div>          '', &nbsp;</div></li><li><div>          $content_disposition_header&nbsp;</div></li><li><div> )) : null;&nbsp;</div></li><li><div>          <span class="comment">// Parse the Content-Range header, which has the following form:</span>&nbsp;</div></li><li><div>          <span class="comment">// Content-Range: bytes 0-524287/2000000</span>&nbsp;</div></li><li><div>          $content_range_header = $this-&gt;get_server_var( 'HTTP_CONTENT_RANGE' );&nbsp;</div></li><li><div>          $content_range = $content_range_header ?&nbsp;</div></li><li><div>          preg_split('/[^0-9]+/', $content_range_header ) : null;&nbsp;</div></li><li><div>          $size =  $content_range ? $content_range[3] : null;&nbsp;</div></li><li><div>          $files = array();&nbsp;</div></li><li><div>          if ( $upload ) {&nbsp;</div></li><li><div>              if ( is_array( $upload['tmp_name'] ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// param_name is an array identifier like &quot;files[]&quot;, </span>&nbsp;</div></li><li><div>                  <span class="comment">// $upload is a multi-dimensional array:</span>&nbsp;</div></li><li><div>                  foreach ( $upload['tmp_name'] as $index =&gt; $value ) {&nbsp;</div></li><li><div>                      $files[] = $this-&gt;handle_file_upload (&nbsp;</div></li><li><div>                          $upload['tmp_name'][$index], &nbsp;</div></li><li><div>                          $file_name ? $file_name : $upload['name'][$index], &nbsp;</div></li><li><div>                          $size ? $size : $upload['size'][$index], &nbsp;</div></li><li><div>                          $upload['type'][$index], &nbsp;</div></li><li><div>                          $upload['error'][$index], &nbsp;</div></li><li><div>                          $index, &nbsp;</div></li><li><div>                          $content_range&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment">// param_name is a single object identifier like &quot;file&quot;, </span>&nbsp;</div></li><li><div>                  <span class="comment">// $upload is a one-dimensional array:</span>&nbsp;</div></li><li><div>                  $files[] = $this-&gt;handle_file_upload(&nbsp;</div></li><li><div>                      isset( $upload['tmp_name'] ) ? $upload['tmp_name'] : null, &nbsp;</div></li><li><div>                      $file_name ? $file_name : ( isset($upload['name'] ) ?&nbsp;</div></li><li><div>                              $upload['name'] : null ), &nbsp;</div></li><li><div>                      $size ? $size : (isset($upload['size']) ?&nbsp;</div></li><li><div>                              $upload['size'] : $this-&gt;get_server_var( 'CONTENT_LENGTH' ) ), &nbsp;</div></li><li><div>                      isset( $upload['type'] ) ?&nbsp;</div></li><li><div>                              $upload['type'] : $this-&gt;get_server_var( 'CONTENT_TYPE' ), &nbsp;</div></li><li><div>                      isset( $upload['error'] )  ? $upload['error'] : null, &nbsp;</div></li><li><div>                      null, &nbsp;</div></li><li><div>                      $content_range&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $CKEditorFuncNum = $this-&gt;options['CKEditorFuncNum'];&nbsp;</div></li><li><div>          $download_url = $files[0]-&gt;url;&nbsp;</div></li><li><div>          $response = &quot;&lt;script&gt;&nbsp;</div></li><li><div>var l = '&quot;.$download_url.&quot;';&nbsp;</div></li><li><div>window.parent.CKEDITOR.tools.callFunction(&nbsp;</div></li><li><div>'&quot; . $CKEditorFuncNum . &quot;', &nbsp;</div></li><li><div>l, &nbsp;</div></li><li><div>'&quot;.  $files[0]-&gt;error .&quot;'&nbsp;</div></li><li><div>);&nbsp;</div></li><li><div>&lt;/script&gt;&quot;;&nbsp;</div></li><li><div>          return $this-&gt;generate_response( $response, $print_response );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function generate_response( $content, $print_response = true ) {&nbsp;</div></li><li><div>          $this-&gt;response = $content;&nbsp;</div></li><li><div>          $this-&gt;body( $content );&nbsp;</div></li><li><div>          return $content;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      protected function trim_file_name( $file_path, $name, $size, $type, $error, $index, $content_range ) {&nbsp;</div></li><li><div>          $name = apply_filters( 'itsg_gf_ckeditor_filename', $name, $file_path, $size, $type, $error, $index, $content_range );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $exclude_characters = array(&nbsp;</div></li><li><div>              '\\', &nbsp;</div></li><li><div>              '/', &nbsp;</div></li><li><div>              ':', &nbsp;</div></li><li><div>              ';', &nbsp;</div></li><li><div>              '*', &nbsp;</div></li><li><div>              '?', &nbsp;</div></li><li><div>              '!', &nbsp;</div></li><li><div>              '&quot;', &nbsp;</div></li><li><div>              '`', &nbsp;</div></li><li><div>              &quot;'&quot;, &nbsp;</div></li><li><div>              '&lt;', &nbsp;</div></li><li><div>              '&gt;', &nbsp;</div></li><li><div>              '{', &nbsp;</div></li><li><div>              '}', &nbsp;</div></li><li><div>              '[', &nbsp;</div></li><li><div>              ']', &nbsp;</div></li><li><div>              ', ', &nbsp;</div></li><li><div>              '|'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $exclude_characters = (array)apply_filters( 'itsg_gf_ckeditor_filename_exclude_characters', $exclude_characters );&nbsp;</div></li><li><div>          $replace_character = (string)apply_filters( 'itsg_gf_ckeditor_filename_replace_characters', '' );&nbsp;</div></li><li><div>          $name = str_replace( $exclude_characters, $replace_character, $name );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $name;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } <span class="comment">// END ITSG_GFCKEDITOR_UploadHandler</span>&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>add_action( 'admin_notices', array( 'ITSG_GF_WYSIWYG_CKEditor', 'admin_warnings' ), 20 );&nbsp;</div></li><li><div>load_plugin_textdomain( 'itsg_gf_wysiwyg_ckeditor', false, dirname( plugin_basename( __FILE__ ) ) . '/lang' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>require_once( plugin_dir_path( __FILE__ ).'gf_wysiwyg_ckeditor_settings.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( !class_exists( 'ITSG_GF_WYSIWYG_CKEditor' ) ) {&nbsp;</div></li><li><div>  class ITSG_GF_WYSIWYG_CKEditor {&nbsp;</div></li><li><div>  private static $name = 'CKEditor WYSIWYG for Gravity Forms';&nbsp;</div></li><li><div>  private static $slug = 'gravity-forms-wysiwyg-ckeditor';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Construct the plugin object</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function __construct() {&nbsp;</div></li><li><div>          <span class="comment">// register plugin functions through 'gform_loaded' -</span>&nbsp;</div></li><li><div>          <span class="comment">// this delays the registration until Gravity Forms has loaded, ensuring it does not run before Gravity Forms is available.</span>&nbsp;</div></li><li><div>          add_action( 'gform_loaded', array( $this, 'register_actions' ) );&nbsp;</div></li><li><div>      } <span class="comment">// END __construct</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Register plugin functions</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function register_actions() {&nbsp;</div></li><li><div>      <span class="comment">// register actions</span>&nbsp;</div></li><li><div>          if ( self::is_gravityforms_installed() ) {&nbsp;</div></li><li><div>              $ckeditor_settings = self::get_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// addon framework</span>&nbsp;</div></li><li><div>              require_once( plugin_dir_path( __FILE__ ).'gf-wysiwyg-ckeditor-addon.php' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">//start plug in</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_action( 'wp_ajax_itsg_gf_wysiwyg_ckeditor_upload', array( $this, 'itsg_gf_wysiwyg_ckeditor_upload' ) );&nbsp;</div></li><li><div>              add_action( 'wp_ajax_nopriv_itsg_gf_wysiwyg_ckeditor_upload', array( $this, 'itsg_gf_wysiwyg_ckeditor_upload' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_filter( 'gform_save_field_value', array( $this, 'save_field_value' ), 10, 4 );&nbsp;</div></li><li><div>              add_action( 'gform_field_standard_settings', array( $this, 'ckeditor_field_settings' ), 10, 2 );&nbsp;</div></li><li><div>              add_filter( 'gform_tooltips', array( $this, 'ckeditor_field_tooltips' ) );&nbsp;</div></li><li><div>              add_action( 'gform_field_css_class', array( $this, 'ckeditor_field_css_class' ), 10, 3 );&nbsp;</div></li><li><div>              add_filter( 'gform_field_content', array( $this, 'ckeditor_field_content' ), 10, 5 );&nbsp;</div></li><li><div>              add_filter( 'gform_counter_script', array( $this, 'ckeditor_counter_script_js' ), 10, 4 );&nbsp;</div></li><li><div>              add_filter( 'gform_merge_tag_filter', array( $this, 'decode_wysiwyg_frontend_confirmation' ), 10, 5 );&nbsp;</div></li><li><div>              add_filter( 'gform_entry_field_value', array( $this, 'decode_wysiwyg_backend_and_gravitypdf' ), 10, 4 );&nbsp;</div></li><li><div>              add_filter( 'plugin_action_links_' . plugin_basename(__FILE__), array( $this, 'plugin_action_links' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_filter( 'gform_field_validation', array( $this, 'ckeditor_dont_count_spaces' ), 10, 4 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_filter( 'gform_entries_column_filter', array( $this, 'entries_column_filter' ), 10, 5 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( self::is_minimum_php_version() ) {&nbsp;</div></li><li><div>                  require_once( plugin_dir_path( __FILE__ ).'gravitypdf/gravitypdf.php' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// patch to allow JS and CSS to load when loading forms through wp-ajax requests</span>&nbsp;</div></li><li><div>              add_action( 'gform_enqueue_scripts', array( $this, 'enqueue_scripts' ), 90, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'gf_settings' == RGForms::get('page') ) {&nbsp;</div></li><li><div>                  <span class="comment">// add settings page</span>&nbsp;</div></li><li><div>                  RGForms::add_settings_page( 'WYSIWYG CKEditor', array( 'ITSG_GF_WYSIWYG_ckeditor_settings_page', 'settings_page' ), self::get_base_url() . '/images/user-registration-icon-32.png' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ( 'WYSIWYG+CKEditor' == RGForms::get('subview') || 'WYSIWYG CKEditor' == RGForms::get('subview') ) && !self::is_minimum_php_version() ) {&nbsp;</div></li><li><div>                      add_action( 'admin_notices', array( $this, 'admin_warnings_minimum_php_version'), 20 );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $ckeditor_settings['enable_upload_image'] && self::is_minimum_php_version() ) {&nbsp;</div></li><li><div>                  <span class="comment">// handles the change upload path settings</span>&nbsp;</div></li><li><div>                  add_filter( 'gform_upload_path', array( $this, 'change_upload_path' ), 10, 2 );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } <span class="comment">// END register_actions</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function ckeditor_dont_count_spaces( $result, $value, $form, $field ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>              if ( ! is_numeric( $field['maxLength'] ) ) {&nbsp;</div></li><li><div>                  return $result;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $value = strip_tags( $value );&nbsp;</div></li><li><div>              $value = preg_replace( '/\r|\n|\s|&nbsp;/', '' , $value ); <span class="comment">// remove line breaks and spaces for the purpose of the character count</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// decode HTML entities so they are counted correctly</span>&nbsp;</div></li><li><div>              if ( function_exists( 'mb_convert_encoding' ) ) {&nbsp;</div></li><li><div>                  $value =  mb_convert_encoding( $value, 'UTF-8', 'HTML-ENTITIES' );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $value =  preg_replace( '/&.*?;/', 'x', $value ); <span class="comment">// multi-byte characters converted to X</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( GFCommon::safe_strlen( $value ) &gt; $field['maxLength'] ) {&nbsp;</div></li><li><div>                  $result['is_valid'] = false;&nbsp;</div></li><li><div>                  $result['message'] = empty( $field['errorMessage'] ) ? esc_html_x( 'The text entered exceeds the maximum number of characters.', 'Same as Gravity Forms (slug: gravityforms) plugin', 'gravity-forms-wysiwyg-ckeditor' ) : $field['errorMessage'];&nbsp;</div></li><li><div>              } elseif ( ! ( $field['isRequired'] && GFCommon::safe_strlen( $value ) == 0 ) ) {&nbsp;</div></li><li><div>                  $result['is_valid'] = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $result;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * BEGIN: patch to allow JS and CSS to load when loading forms through wp-ajax requests</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Enqueue JavaScript to footer</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function enqueue_scripts( $form, $is_ajax ) {&nbsp;</div></li><li><div>          if ( $this-&gt;requires_scripts( $form, $is_ajax ) ) {&nbsp;</div></li><li><div>              $min = defined( 'SCRIPT_DEBUG' ) && SCRIPT_DEBUG || isset( $_GET['gform_debug'] ) ? '' : '.min';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              wp_deregister_script( 'gform_textarea_counter' ); <span class="comment">// deregister default textarea count script - the default script counts spaces</span>&nbsp;</div></li><li><div>              wp_register_script( 'itsg_gf_ckeditor', plugins_url( &quot;/js/itsg_gf_ckeditor{$min}.js&quot;, __FILE__ ), array( 'jquery', 'gform_textarea_counter', 'ITSG_gf_wysiwyg_ckeditor_js', 'ITSG_gf_wysiwyg_ckeditor_jquery_adapter' ) );&nbsp;</div></li><li><div>              wp_enqueue_script( 'gform_textarea_counter', plugins_url( &quot;/js/jquery.textareaCounter.plugin{$min}.js&quot;, __FILE__ ) );&nbsp;</div></li><li><div>              wp_enqueue_script( 'ITSG_gf_wysiwyg_ckeditor_js', plugins_url( &quot;/ckeditor/ckeditor.js&quot;, __FILE__ ) );&nbsp;</div></li><li><div>              wp_enqueue_script( 'ITSG_gf_wysiwyg_ckeditor_jquery_adapter', plugins_url( &quot;ckeditor/adapters/jquery.js&quot;, __FILE__ ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Localize the script with new data</span></span>&nbsp;</div></li><li><div>              $this-&gt;localize_scripts( $form, $is_ajax );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } <span class="comment">// END datepicker_js</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      public function requires_scripts( $form, $is_ajax ) {&nbsp;</div></li><li><div>          if ( is_admin() && defined( 'DOING_AJAX' ) && DOING_AJAX && ! GFCommon::is_form_editor() && is_array( $form ) ) {&nbsp;</div></li><li><div>              foreach ( $form['fields'] as $field ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>                      return true;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      } <span class="comment">// END requires_scripts</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      function localize_scripts( $form, $is_ajax ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Localize the script with new data</span></span>&nbsp;</div></li><li><div>          $form_id = $form['id'];&nbsp;</div></li><li><div>          $form_id = $form['id'];&nbsp;</div></li><li><div>          $is_entry_detail = GFCommon::is_entry_detail();&nbsp;</div></li><li><div>          $is_form_editor = GFCommon::is_form_editor();&nbsp;</div></li><li><div>          $admin_url = admin_url( 'admin-ajax.php' );&nbsp;</div></li><li><div>          $ckeditor_settings = ITSG_GF_WYSIWYG_CKEditor::get_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $extra_plugins = '';&nbsp;</div></li><li><div>          if ( ( ! $is_form_editor || ! $is_entry_detail ) || rgar( $ckeditor_settings, 'enable_oembed' ) ) {&nbsp;</div></li><li><div>              if ( ! $is_form_editor && ! $is_entry_detail ) {&nbsp;</div></li><li><div>                  $extra_plugins .=  'wordcount, notification';&nbsp;</div></li><li><div>                  if ( rgar( $ckeditor_settings, 'enable_oembed' ) ) {&nbsp;</div></li><li><div>                  $extra_plugins .= ', oembed, widget, dialog';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $remove_plugins = '';&nbsp;</div></li><li><div>          if ( rgar( $ckeditor_settings, 'enable_remove_elementspath' ) ) {&nbsp;</div></li><li><div>              $remove_plugins .=  'elementspath';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $ckeditor_fields = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $toolbar_settings = array(&nbsp;</div></li><li><div>              'source' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_source' ) ?: 'Source'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'basicstyles' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_bold' ) ?: 'Bold', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_italic' ) ?: 'Italic', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_underline' ) ?: 'Underline', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_strike' ) ?: 'Strike', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_subscript' ) ?: 'Subscript', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_superscript' ) ?: 'Superscript', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_removeformat' ) ?: '-', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_removeformat' ) ?: 'RemoveFormat', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'clipboard' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_cut' ) ?: 'Cut', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_copy' ) ?: 'Copy', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_paste' ) ?: 'Paste', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_pastetext' ) ?: 'PasteText', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_pastefromword' ) ?: 'PasteFromWord', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_undo' ) ?: '-', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_undo' ) ?: 'Undo', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_redo' ) ?: 'Redo', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'paragraph' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_numberedlist' ) ?: 'NumberedList', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_bulletedlist' ) ?: 'BulletedList', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_outdent' ) ?: 'Outdent', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_indent' ) ?: 'Indent', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_blockquote' ) ?: 'Blockquote', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_creatediv' ) ?: 'CreateDiv', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_justifyleft' ) ?: '-', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_justifyleft' ) ?: 'JustifyLeft', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_justifycenter' ) ?: 'JustifyCenter', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_justifyright' ) ?: 'JustifyRight', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_justifyblock' ) ?: 'JustifyBlock', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_bidiltr' ) ?: '-', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_bidiltr' ) ?: 'BidiLtr', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_bidirtl' ) ?: 'BidiRtl', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_language' ) ?: 'Language', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'links' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_link' ) ?: 'Link', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_unlink' ) ?: 'Unlink', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_anchor' ) ?: 'Anchor', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_oembed' ) ?: 'oembed', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'document' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_preview' ) ?: 'Preview', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_print' ) ?: 'Print', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'editing' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_find' ) ?: 'Find', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_replace' ) ?: 'Replace', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_selectall' ) ?: '-', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_selectall' ) ?: 'SelectAll', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_scayt' ) ?: '-', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_scayt' ) ?: 'Scayt', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'insert' =&gt; array(&nbsp;</div></li><li><div>                  ! ( rgar( $ckeditor_settings, 'enable_image' ) || ( rgar( $ckeditor_settings, 'enable_upload_image' ) && $this-&gt;is_minimum_php_version() ) ) ?: 'Image', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_flash' ) ?: 'Flash', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_table' ) ?: 'Table', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_horizontalrule' ) ?: 'HorizontalRule', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_smiley' ) ?: 'Smiley', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_specialchar' ) ?: 'SpecialChar', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_pagebreak' ) ?: 'PageBreak', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_iframe' ) ?: 'Iframe', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'styles' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_styles' ) ?: 'Styles', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_format' ) ?: 'Format', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_font' ) ?: 'Font', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_fontsize' ) ?: 'FontSize', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'colors' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_textcolor' ) ?: 'TextColor', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_bgcolor' ) ?: 'BGColor', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'tools' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_maximize' ) ?: 'Maximize', &nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_showblocks' ) ?: 'ShowBlocks', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'about' =&gt; array(&nbsp;</div></li><li><div>                  ! rgar( $ckeditor_settings, 'enable_about' ) ?: 'About', &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_array( $form['fields'] ) ) {&nbsp;</div></li><li><div>              foreach ( $form['fields'] as $field ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>                      $field_id = $field['id'];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'source' ] = $toolbar_settings[ 'source' ] ;&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'basicstyles' ] =  $toolbar_settings[ 'basicstyles' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'clipboard' ] =  $toolbar_settings[ 'clipboard' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'paragraph' ] =  $toolbar_settings[ 'paragraph' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'links' ] =  $toolbar_settings[ 'links' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'document' ] =  $toolbar_settings[ 'document' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'editing' ] =  $toolbar_settings[ 'editing' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'insert' ] =  $toolbar_settings[ 'insert' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'styles' ] =  $toolbar_settings[ 'styles' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'colors' ] =  $toolbar_settings[ 'colors' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'tools' ] =  $toolbar_settings[ 'tools' ];&nbsp;</div></li><li><div>                      $ckeditor_fields[ $field_id ][ 'about' ] =  $toolbar_settings[ 'about' ];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// filter to modify global settings on a per form basis</span>&nbsp;</div></li><li><div>          <span class="comment">//$ckeditor_fields = apply_filters( 'itsg_gf_ckeditor_fields', $ckeditor_fields, $form_id );</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $settings_array = array(&nbsp;</div></li><li><div>              'form_id' =&gt; GFCommon::is_entry_detail() ? $_GET['id'] : $form_id, &nbsp;</div></li><li><div>              'is_entry_detail' =&gt; $is_entry_detail ? $is_entry_detail : 0, &nbsp;</div></li><li><div>              'is_form_editor' =&gt; $is_form_editor ? $is_form_editor : 0, &nbsp;</div></li><li><div>              'is_admin' =&gt; is_admin() ? 1 : 0, &nbsp;</div></li><li><div>              'is_dpr_installed' =&gt; $this-&gt;is_dpr_installed() ? 1 : 0, &nbsp;</div></li><li><div>              'enable_upload_image' =&gt; rgar( $ckeditor_settings, 'enable_upload_image') ? 1 : 0, &nbsp;</div></li><li><div>              'is_minimum_php_version' =&gt; $this-&gt;is_minimum_php_version() ? 1 : 0, &nbsp;</div></li><li><div>              'ckeditor_fields' =&gt; $ckeditor_fields, &nbsp;</div></li><li><div>              'extra_plugins' =&gt; $extra_plugins, &nbsp;</div></li><li><div>              'remove_plugins' =&gt; $remove_plugins, &nbsp;</div></li><li><div>              'admin_url' =&gt; $admin_url, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          wp_localize_script( 'itsg_gf_ckeditor', 'itsg_gf_ckeditor_settings', $settings_array );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Enqueued script with localized data.</span>&nbsp;</div></li><li><div>          wp_enqueue_script( 'itsg_gf_ckeditor' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      } <span class="comment">// END localize_scripts</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * END: patch to allow JS and CSS to load when loading forms through wp-ajax requests</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      function entries_column_filter( $value, $form_id, $field_id, $entry, $query_string ) {&nbsp;</div></li><li><div>          $form = GFAPI::get_form( $form_id );&nbsp;</div></li><li><div>          foreach ( $form['fields'] as $field ) {&nbsp;</div></li><li><div>              if ( $field-&gt;id == $field_id && $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>                  return  substr( wp_kses_post( htmlspecialchars_decode( strip_tags( $value, '&lt;strong&gt;&lt;a&gt;&lt;u&gt;&lt;i&gt;' ) ) ), 0, 140);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $value;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      function itsg_gf_wysiwyg_ckeditor_upload() {&nbsp;</div></li><li><div>          $CKEditorFuncNum = isset( $_GET['CKEditorFuncNum'] ) ? $_GET['CKEditorFuncNum'] : null;&nbsp;</div></li><li><div>          if ( is_null( $CKEditorFuncNum ) ) {&nbsp;</div></li><li><div>              die( &quot;&lt;script&gt;&nbsp;</div></li><li><div>              window.parent.CKEDITOR.tools.callFunction(&nbsp;</div></li><li><div>              '', &nbsp;</div></li><li><div>              '', &nbsp;</div></li><li><div>              'ERROR: Failed to pass CKEditorFuncNum');&nbsp;</div></li><li><div>              &lt;/script&gt;&quot; );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $form_id = isset( $_GET['form_id'] ) ? $_GET['form_id'] : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_null( $form_id ) ) {&nbsp;</div></li><li><div>              die( &quot;&lt;script&gt;&nbsp;</div></li><li><div>              window.parent.CKEDITOR.tools.callFunction('', &nbsp;</div></li><li><div>              '', &nbsp;</div></li><li><div>              'ERROR: Failed to get form_id');&nbsp;</div></li><li><div>              &lt;/script&gt;&quot; );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// get target path - also responsible for creating directories if path doesnt exist</span>&nbsp;</div></li><li><div>          $target = GFFormsModel::get_file_upload_path( $form_id, null );&nbsp;</div></li><li><div>          $target_path = pathinfo( $target['path'] );&nbsp;</div></li><li><div>          $target_url = pathinfo( $target['url'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// get Ajax Upload options</span>&nbsp;</div></li><li><div>          $ckeditor_settings = self::get_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// calculate file size in KB from MB</span>&nbsp;</div></li><li><div>          $file_size = $ckeditor_settings['setting_upload_filesize'];&nbsp;</div></li><li><div>          $file_size_kb = $file_size * 1024 * 1024;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// push options to upload handler</span>&nbsp;</div></li><li><div>          $options = array(&nbsp;</div></li><li><div>              'paramName' =&gt; 'upload', &nbsp;</div></li><li><div>              'param_name' =&gt; 'upload', &nbsp;</div></li><li><div>              'CKEditorFuncNum' =&gt; $CKEditorFuncNum, &nbsp;</div></li><li><div>              'upload_dir' =&gt; $target_path['dirname'].'/', &nbsp;</div></li><li><div>              'upload_url' =&gt; $target_url['dirname'].'/', &nbsp;</div></li><li><div>              'image_versions' =&gt; array(&nbsp;</div></li><li><div>                  '' =&gt; array(&nbsp;</div></li><li><div>                  'max_width' =&gt; empty( $ckeditor_settings['setting_upload_filewidth'] ) ? null : $ckeditor_settings['setting_upload_filewidth'], &nbsp;</div></li><li><div>                  'max_height' =&gt; empty( $ckeditor_settings['setting_upload_fileheight'] ) ? null : $ckeditor_settings['setting_upload_fileheight'], &nbsp;</div></li><li><div>                  'jpeg_quality' =&gt; empty( $ckeditor_settings['setting_upload_filejpegquality'] ) ? null : $ckeditor_settings['setting_upload_filejpegquality']&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'accept_file_types' =&gt; empty( $ckeditor_settings['setting_upload_filetype'] ) ? '/(\.|\/)(png|tif|jpeg|jpg|gif)$/i' : '/(\.|\/)('.$ckeditor_settings['setting_upload_filetype'].')$/i', &nbsp;</div></li><li><div>              'max_file_size' =&gt; empty( $file_size_kb ) ? null : $file_size_kb&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( class_exists( 'ITSG_GFCKEDITOR_UploadHandler' ) ) {&nbsp;</div></li><li><div>              <span class="comment">// initialise the upload handler and pass the options</span>&nbsp;</div></li><li><div>              $upload_handler = new ITSG_GFCKEDITOR_UploadHandler( $options );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// terminate the function</span>&nbsp;</div></li><li><div>          die();&nbsp;</div></li><li><div>      } <span class="comment">// END itsg_gf_wysiwyg_ckeditor_upload</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       *   Changes the upload path for Gravity Form uploads.</span>&nbsp;</div></li><li><div><span class="comment">       *   Changes made by this function will be seen when the Gravity Forms function  GFFormsModel::get_file_upload_path() is called.</span>&nbsp;</div></li><li><div><span class="comment">       *   The default upload path applied by this function matches the default for Gravity forms:</span>&nbsp;</div></li><li><div><span class="comment">       *   /gravity_forms/{form_id}-{hashed_form_id}/{month}/{year}/</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function change_upload_path( $path_info, $form_id ) {&nbsp;</div></li><li><div>          $ckeditor_settings = self::get_options();&nbsp;</div></li><li><div>          $file_dir = $ckeditor_settings['setting_upload_filedir'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 0 != strlen( $file_dir ) ) {&nbsp;</div></li><li><div>              <span class="comment">// Generate the yearly and monthly dirs</span>&nbsp;</div></li><li><div>              $time = current_time( 'mysql' );&nbsp;</div></li><li><div>              $y = substr( $time, 0, 4 );&nbsp;</div></li><li><div>              $m = substr( $time, 5, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// removing leading forward slash, if present</span>&nbsp;</div></li><li><div>              if( '/' == $file_dir[0] ) {&nbsp;</div></li><li><div>                  $file_dir = ltrim( $file_dir, '/' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// remove leading forward slash, if present</span>&nbsp;</div></li><li><div>              if( '/' == substr( $file_dir, -1 ) ) {&nbsp;</div></li><li><div>                  $file_dir = rtrim( $file_dir, '/' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// if {form_id} keyword used, replace with current form id</span>&nbsp;</div></li><li><div>              if ( false !== strpos( $file_dir, '{form_id}' ) ) {&nbsp;</div></li><li><div>                  $file_dir = str_replace( '{form_id}', $form_id, $file_dir );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// if {hashed_form_id} keyword used, replace with hashed current form id</span>&nbsp;</div></li><li><div>              if ( false !== strpos( $file_dir, '{hashed_form_id}' ) ) {&nbsp;</div></li><li><div>                  $file_dir = str_replace( '{hashed_form_id}', wp_hash( $form_id), $file_dir );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// if {year} keyword used, replace with current year</span>&nbsp;</div></li><li><div>              if ( false !== strpos($file_dir, '{year}') ) {&nbsp;</div></li><li><div>                  $file_dir = str_replace( '{year}', $y, $file_dir );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// if {month} keyword used, replace with current month</span>&nbsp;</div></li><li><div>              if ( false !== strpos( $file_dir, '{month}' ) ) {&nbsp;</div></li><li><div>                  $file_dir = str_replace( '{month}', $m, $file_dir );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// if {user_id} keyword used, replace with current user id</span>&nbsp;</div></li><li><div>              if ( false !== strpos( $file_dir, '{user_id}' ) ) {&nbsp;</div></li><li><div>                  if ( isset( $_POST['entry_user_id'] ) ) {&nbsp;</div></li><li><div>                      $entry_user_id = $_POST['entry_user_id'];&nbsp;</div></li><li><div>                      $file_dir = str_replace( '{user_id}', $entry_user_id, $file_dir );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $user_id = get_current_user_id() ? get_current_user_id() : '0';&nbsp;</div></li><li><div>                      $file_dir = str_replace( '{user_id}', $user_id, $file_dir );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// if {hashed_user_id} keyword used, replace with hashed current user id</span>&nbsp;</div></li><li><div>              if ( false !== strpos( $file_dir, '{hashed_user_id}' ) ) {&nbsp;</div></li><li><div>                  if ( isset( $_POST['entry_user_id'] ) ) {&nbsp;</div></li><li><div>                      $entry_user_id = $_POST['entry_user_id'];&nbsp;</div></li><li><div>                      $hashed_entry_user_id = wp_hash( $entry_user_id );&nbsp;</div></li><li><div>                      $file_dir = str_replace( '{hashed_user_id}', $hashed_entry_user_id, $file_dir );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $hashed_user_id = wp_hash( is_user_logged_in() ? get_current_user_id() : '0' );&nbsp;</div></li><li><div>                      $file_dir = str_replace( '{hashed_user_id}', $hashed_user_id, $file_dir );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $upload_dir = wp_upload_dir(); <span class="comment">// get WordPress upload directory information - returns an array</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $path_info['path'] = $upload_dir['basedir'].'/'.$file_dir.'/';  <span class="comment">// set the upload path</span>&nbsp;</div></li><li><div>              $path_info['url'] = $upload_dir['baseurl'].'/'.$file_dir.'/';  <span class="comment">// set the upload URL</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $path_info;&nbsp;</div></li><li><div>      } <span class="comment">// END change_upload_path</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       *   Converts php.ini memory limit string to bytes.</span>&nbsp;</div></li><li><div><span class="comment">       *   For example, 2MB would convert to 2097152</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static function return_bytes( $val ) {&nbsp;</div></li><li><div>          $val = trim( $val );&nbsp;</div></li><li><div>          $last = strtolower( $val[ strlen( $val ) -1 ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          switch( $last ) {&nbsp;</div></li><li><div>              case 'g':&nbsp;</div></li><li><div>                  $val *= 1024;&nbsp;</div></li><li><div>              case 'm':&nbsp;</div></li><li><div>                  $val *= 1024;&nbsp;</div></li><li><div>              case 'k':&nbsp;</div></li><li><div>                  $val *= 1024;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $val;&nbsp;</div></li><li><div>      } <span class="comment">// END return_bytes</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       *   Determines the maximum upload file size.</span>&nbsp;</div></li><li><div><span class="comment">       *   Retrieves three values from php.ini and returns the smallest.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static function max_file_upload_in_bytes() {&nbsp;</div></li><li><div>          <span class="comment">//select maximum upload size</span>&nbsp;</div></li><li><div>          $max_upload = self::return_bytes( ini_get( 'upload_max_filesize' ) );&nbsp;</div></li><li><div>          <span class="comment">//select post limit</span>&nbsp;</div></li><li><div>          $max_post = self::return_bytes( ini_get( 'post_max_size' ) );&nbsp;</div></li><li><div>          <span class="comment">//select memory limit</span>&nbsp;</div></li><li><div>          $memory_limit = self::return_bytes( ini_get( 'memory_limit' ) );&nbsp;</div></li><li><div>          <span class="comment">// return the smallest of them, this defines the real limit</span>&nbsp;</div></li><li><div>          return min( $max_upload, $max_post, $memory_limit );&nbsp;</div></li><li><div>      } <span class="comment">// END max_file_upload_in_bytes</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add 'Settings' link to plugin in WordPress installed plugins page</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function plugin_action_links( $links ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $action_links = array(&nbsp;</div></li><li><div>              'settings' =&gt; '&lt;a href=&quot;' . admin_url( 'admin.php?page=gf_settings&subview=WYSIWYG+CKEditor' ) . '&quot; &gt;' . __( 'Settings', 'gravity-forms-wysiwyg-ckeditor' ) . '&lt;/a&gt;', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return array_merge( $action_links, $links );&nbsp;</div></li><li><div>      } <span class="comment">// END plugin_action_links</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       *   Handles the plugin options.</span>&nbsp;</div></li><li><div><span class="comment">       *   Default values are stored in an array.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static function get_options() {&nbsp;</div></li><li><div>          $defaults = array(&nbsp;</div></li><li><div>              'enable_in_form_editor' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_bold' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_italic' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_underline' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_pastetext' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_pastefromword' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_numberedlist' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_bulletedlist' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_outdent' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_indent' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_link' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_unlink' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_format' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_font' =&gt; 'on', &nbsp;</div></li><li><div>              'enable_fontsize' =&gt; 'on', &nbsp;</div></li><li><div>              'setting_upload_filesize' =&gt; '2', &nbsp;</div></li><li><div>              'setting_upload_filetype' =&gt; 'png|tif|jpeg|jpg|gif', &nbsp;</div></li><li><div>              'setting_upload_filedir' =&gt; '/gravity_forms/{form_id}-{hashed_form_id}/{month}/{year}/', &nbsp;</div></li><li><div>              'setting_upload_filejpegquality' =&gt; '75', &nbsp;</div></li><li><div>              'setting_upload_filewidth' =&gt; '786', &nbsp;</div></li><li><div>              'setting_upload_fileheight' =&gt; '786', &nbsp;</div></li><li><div>              'enable_upload_image' =&gt; 'off'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          $options = wp_parse_args( get_option( 'ITSG_gf_wysiwyg_ckeditor_settings' ), $defaults );&nbsp;</div></li><li><div>          return $options;&nbsp;</div></li><li><div>      } <span class="comment">// END get_options</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Customises 'Paragraph Text' field output to</span>&nbsp;</div></li><li><div><span class="comment">       *  1. apply 'gform_wysiwyg_ckeditor' class to ckeditor fields in the wp-admin</span>&nbsp;</div></li><li><div><span class="comment">       *  2. include character limit details and CSS class for admin area</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function ckeditor_field_content( $content, $field, $value, $lead_id, $form_id ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>              if ( is_admin() ) {&nbsp;</div></li><li><div>                  $content = str_replace( &quot;class='&quot;, &quot;class='gform_wysiwyg_ckeditor &quot;, $content );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $label = rgar( $field, 'label' );&nbsp;</div></li><li><div>                  $limit = ( '' == rgar( $field, 'maxLength' ) ? 'unlimited' : rgar( $field, 'maxLength' ) );&nbsp;</div></li><li><div>                  $content = str_replace( &quot;&lt;textarea &quot;, &quot;&lt;textarea data-maxlen='&quot;.$limit.&quot;' &quot;, $content);&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $content;&nbsp;</div></li><li><div>      } <span class="comment">// END ckeditor_field_content</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Customises character limit count down for NON-CKEditor fields to match what CKEditor provides</span>&nbsp;</div></li><li><div><span class="comment">       * - note that these fields DO count spaces, where as CKEDitor does NOT count spaces.</span>&nbsp;</div></li><li><div><span class="comment">       * Output: Characters: [number of characters in field]/[limit on field]</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function ckeditor_counter_script_js( $script, $form_id, $input_id, $max_length ) {&nbsp;</div></li><li><div>          $field_id_number = substr( $input_id, strrpos($input_id, '_') + 1);&nbsp;</div></li><li><div>          $form = GFFormsModel::get_form_meta( $form_id );&nbsp;</div></li><li><div>          $field = GFFormsModel::get_field( $form, $field_id_number );&nbsp;</div></li><li><div>          if ( $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>              return &quot;&quot;;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $script = &quot;jQuery('#{$input_id}').textareaCount(&quot; .&nbsp;</div></li><li><div>                          &quot;    {&quot; .&nbsp;</div></li><li><div>                          &quot;    'maxCharacterSize': {$max_length}, &quot; .&nbsp;</div></li><li><div>                          &quot;    'originalStyle': 'ginput_counter', &quot; .&nbsp;</div></li><li><div>                          &quot;    'displayFormat' : '&quot; .  esc_js( __( 'Characters', 'gravity-forms-wysiwyg-ckeditor' ) ) . &quot;: #input/$max_length'&quot; .&nbsp;</div></li><li><div>                          &quot;    });&quot;;&nbsp;</div></li><li><div>              return $script;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } <span class="comment">// END ckeditor_counter_script_js</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Applies CSS class to 'Paragraph text' fields when CKEditor is enabled</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function ckeditor_field_css_class( $classes, $field, $form ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>               $classes .= ' gform_wysiwyg_ckeditor';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $classes;&nbsp;</div></li><li><div>      } <span class="comment">// END ckeditor_field_css_class</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Applies 'Enable WYSIWYG CKEditor' option to 'Paragraph Text' field</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function ckeditor_field_settings($position, $form_id) {&nbsp;</div></li><li><div>          if ( 25 == $position ) {&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>              &lt;li class=&quot;wysiwyg_field_setting_wysiwyg_ckeditor field_setting&quot; style=&quot;display:list-item;&quot;&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;checkbox&quot; id=&quot;field_enable_wysiwyg_ckeditor&quot;/&gt;&nbsp;</div></li><li><div>                  &lt;label for=&quot;field_enable_wysiwyg_ckeditor&quot; class=&quot;inline&quot;&gt;&nbsp;</div></li><li><div>                      &lt;?php _e( 'Enable WYSIWYG (CKEditor)', 'gravity-forms-wysiwyg-ckeditor' ); ?&gt;&nbsp;</div></li><li><div>                  &lt;/label&gt;&nbsp;</div></li><li><div>                  &lt;?php gform_tooltip( 'form_field_enable_wysiwyg_ckeditor' ) ?&gt;&lt;br/&gt;&nbsp;</div></li><li><div>              &lt;/li&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } <span class="comment">// END ckeditor_field_settings</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Tooltip for field in form editor</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function ckeditor_field_tooltips( $tooltips ) {&nbsp;</div></li><li><div>          $tooltips['form_field_enable_wysiwyg_ckeditor'] = '&lt;h6&gt;'.__( 'Enable WYSIWYG', 'gravity-forms-wysiwyg-ckeditor' ).'&lt;/h6&gt;'.__( 'Check this box to turn this field into a WYSIWYG editor, using CKEditor.', 'gravity-forms-wysiwyg-ckeditor' );&nbsp;</div></li><li><div>          return $tooltips;&nbsp;</div></li><li><div>      } <span class="comment">// END ckeditor_field_tooltips</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Checks if field is CKEditor enabled</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function is_wysiwyg_ckeditor( $field ) {&nbsp;</div></li><li><div>          $field_type = self::get_type( $field );&nbsp;</div></li><li><div>          if ( 'post_content' == $field_type ||&nbsp;</div></li><li><div>              'textarea' == $field_type ||&nbsp;</div></li><li><div>              ( 'post_custom_field' == $field_type && 'textarea' == $field['inputType'] ) ) {&nbsp;</div></li><li><div>              if ( 'true' == $field-&gt;enable_wysiwyg_ckeditor && true !== $field-&gt;useRichTextEditor ) {&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      } <span class="comment">// END is_wysiwyg_ckeditor</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get field type</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      private static function get_type( $field ) {&nbsp;</div></li><li><div>          $type = '';&nbsp;</div></li><li><div>          if ( isset( $field['type'] ) ) {&nbsp;</div></li><li><div>              $type = $field['type'];&nbsp;</div></li><li><div>              if ( 'post_custom_field' == $type ) {&nbsp;</div></li><li><div>                  if ( isset( $field['inputType'] ) ) {&nbsp;</div></li><li><div>                      $type = $field['inputType'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              return $type;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } <span class="comment">// END get_type</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Modifies the value before saved to the database - removes line spaces</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function save_field_value( $value, $lead, $field, $form ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>              $value = rgpost( &quot;input_{$field['id']}&quot; );&nbsp;</div></li><li><div>              $value = preg_replace( &quot;/\r|\n/&quot;, &quot;&quot;, $value );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $value;&nbsp;</div></li><li><div>      } <span class="comment">// END save_field_value</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Warning message if Gravity Forms is installed and enabled</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static function admin_warnings() {&nbsp;</div></li><li><div>          if ( !self::is_gravityforms_installed() ) {&nbsp;</div></li><li><div>              printf(&nbsp;</div></li><li><div>                  '&lt;div class=&quot;error&quot;&gt;&lt;h3&gt;%s&lt;/h3&gt;&lt;p&gt;%s&lt;/p&gt;&lt;p&gt;%s&lt;/p&gt;&lt;/div&gt;', &nbsp;</div></li><li><div>                      __( 'Warning', 'gravity-forms-wysiwyg-ckeditor' ), &nbsp;</div></li><li><div>                      sprintf ( __( 'The plugin %s requires Gravity Forms to be installed.', 'gravity-forms-wysiwyg-ckeditor' ), '&lt;strong&gt;'.self::$name.'&lt;/strong&gt;' ), &nbsp;</div></li><li><div>                      sprintf ( esc_html__( 'Please %sdownload the latest version of Gravity Forms%s and try again.', 'gravity-forms-wysiwyg-ckeditor' ), '&lt;a href=&quot;https:<span class="comment">//www.e-junkie.com/ecom/gb.php?cl=54585&c=ib&aff=299380&quot; target=&quot;_blank&quot; &gt;', '&lt;/a&gt;' )</span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } <span class="comment">// END admin_warnings</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Warning message if Gravity Forms is installed and enabled</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static function admin_warnings_minimum_php_version() {&nbsp;</div></li><li><div>              printf(&nbsp;</div></li><li><div>                  '&lt;div class=&quot;error&quot;&gt;&lt;h3&gt;%s&lt;/h3&gt;&lt;p&gt;%s&lt;/p&gt;&lt;p&gt;%s&lt;/p&gt;&lt;/div&gt;', &nbsp;</div></li><li><div>                      __( 'Warning', 'gravity-forms-wysiwyg-ckeditor' ), &nbsp;</div></li><li><div>                      sprintf( __( 'The &lt;strong&gt;image upload&lt;/strong&gt; feature requires a minimum of PHP version 5.4.', 'gravity-forms-wysiwyg-ckeditor' ) ), &nbsp;</div></li><li><div>                      sprintf( __( 'You are running an PHP version %s. Contact your web hosting provider to update.', 'gravity-forms-wysiwyg-ckeditor' ), phpversion() )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      } <span class="comment">// END admin_warnings</span>_minimum_php_version&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check if GF is installed</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      private static function is_gravityforms_installed() {&nbsp;</div></li><li><div>          if ( !function_exists( 'is_plugin_active' ) || !function_exists( 'is_plugin_active_for_network' ) ) {&nbsp;</div></li><li><div>              require_once( ABSPATH . '/wp-admin/includes/plugin.php' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if (is_multisite()) {&nbsp;</div></li><li><div>              return ( is_plugin_active_for_network('gravityforms/gravityforms.php' ) || is_plugin_active( 'gravityforms/gravityforms.php' ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return is_plugin_active( 'gravityforms/gravityforms.php' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      } <span class="comment">// END is_gravityforms_installed</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check if PHP version is at least 5.4</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      private static function is_minimum_php_version() {&nbsp;</div></li><li><div>          return version_compare( phpversion(), '5.4', '&gt;=' );&nbsp;</div></li><li><div>      } <span class="comment">// END is_minimum_php_version</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check if Gravity Forms - Data Persistence Reloaded is installed</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      private function is_dpr_installed() {&nbsp;</div></li><li><div>          return function_exists( 'ri_gfdp_ajax' );&nbsp;</div></li><li><div>      } <span class="comment">// END is_dpr_installed</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get plugin url</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>       private function get_base_url() {&nbsp;</div></li><li><div>          return plugins_url( null, __FILE__ );&nbsp;</div></li><li><div>      } <span class="comment">// END get_base_url</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * decodes the value before being displayed in the front end confirmation - for gravity wiz better pre-confirmation</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function decode_wysiwyg_frontend_confirmation( $value, $merge_tag, $modifier, $field, $raw_value ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>              return wp_kses_post( $raw_value );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $value;&nbsp;</div></li><li><div>      } <span class="comment">// END decode_wysiwyg_frontend_confirmation</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * decodes the value before being displayed in the entry editor and Gravity PDF 3.x</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function decode_wysiwyg_backend_and_gravitypdf( $value, $field, $lead, $form ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_wysiwyg_ckeditor( $field ) ) {&nbsp;</div></li><li><div>              return  wp_kses_post( htmlspecialchars_decode( $value ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return $value;&nbsp;</div></li><li><div>      } <span class="comment">// END decode_wysiwyg_backend_and_gravitypdf</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>  $ITSG_GF_WYSIWYG_CKEditor = new ITSG_GF_WYSIWYG_CKEditor();&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>CKEditor WYSIWYG for Gravity Forms</li><li><span></span>1.9.6</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>