<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="4.7.1" data-slug="yoast-seo" data-type="class" data-id="14884"><head xmlns="http://www.w3.org/1999/xhtml"><title> wpseo_replace_vars | class | Yoast Seo | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="WPSEO_Replace_Vars, class, plugin, yoast-seo, 4.7.1" /><meta name="description" content="Class: WPSEO_Replace_Vars" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=71b642d364d31d065138541c29f1d692' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/wpseo_replace_vars/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwpseo_replace_vars%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fwpseo_replace_vars%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-yoast-seo-4.7.1-class-wpseo_replace_vars","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="wpseo_replace_vars" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to yoast-seo." href="http://hookr.io/plugins/yoast-seo/" class="plugin"><span property="name">yoast-seo</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.1." href="http://hookr.io/plugins/yoast-seo/4.7.1/" class="H_VERSION"><span property="name">4.7.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/yoast-seo/4.7.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">wpseo_replace_vars</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="558"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/all/" title="All">All <span class="count badge">558</span></a></li><li class="" data-id="new" data-count="3"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/new/" title="New">New <span class="count badge">3</span></a></li><li class="" data-id="hooks" data-count="187"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/hooks/" title="Hooks">Hooks <span class="count badge">187</span></a></li><li class="" data-id="action" data-count="44"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/actions/" title="Actions">Actions <span class="count badge">44</span></a></li><li class="" data-id="filter" data-count="143"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/filters/" title="Filters">Filters <span class="count badge">143</span></a></li><li class="active" data-id="class" data-count="256"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/classes/" title="Classes">Classes <span class="count badge">256</span></a></li><li class="" data-id="constant" data-count="10"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/constants/" title="Constants">Constants <span class="count badge">10</span></a></li><li class="" data-id="function" data-count="103"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/functions/" title="Functions">Functions <span class="count badge">103</span></a></li><li class="" data-id="shortcode" data-count="2"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">2</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>WPSEO_Replace_Vars</strong></h1><p>Class: WPSEO_Replace_Vars.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/yoast-seo/4.7.1/files/inc-class-wpseo-replace-vars/" class="file">/inc/class-wpseo-replace-vars.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="20" class="block" start="20"><li><div>class WPSEO_Replace_Vars {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var    array    Default post/page/cpt information&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $defaults = array(&nbsp;</div></li><li><div>        'ID' =&gt; '', &nbsp;</div></li><li><div>        'name' =&gt; '', &nbsp;</div></li><li><div>        'post_author' =&gt; '', &nbsp;</div></li><li><div>        'post_content' =&gt; '', &nbsp;</div></li><li><div>        'post_date' =&gt; '', &nbsp;</div></li><li><div>        'post_excerpt' =&gt; '', &nbsp;</div></li><li><div>        'post_modified' =&gt; '', &nbsp;</div></li><li><div>        'post_title' =&gt; '', &nbsp;</div></li><li><div>        'taxonomy' =&gt; '', &nbsp;</div></li><li><div>        'term_id' =&gt; '', &nbsp;</div></li><li><div>        'term404' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var object    Current post/page/cpt information&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $args;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var    array    Help texts for use in WPSEO -&gt; Titles and Meta's help tabs&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected static $help_texts = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * @var array    Register of additional variable replacements registered by other plugins/themes&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected static $external_replacements = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Constructor&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return \WPSEO_Replace_Vars&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct() {&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Setup the help texts and external replacements as statics so they will be available to all instances&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function setup_statics_once() {&nbsp;</div></li><li><div>        if ( self::$help_texts === array() ) {&nbsp;</div></li><li><div>            self::set_basic_help_texts();&nbsp;</div></li><li><div>            self::set_advanced_help_texts();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( self::$external_replacements === array() ) {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Action: 'wpseo_register_extra_replacements' - Allows for registration of additional&nbsp;</div></li><li><div>             * variables to replace&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            do_action( 'wpseo_register_extra_replacements' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register new replacement %%variables%%&nbsp;</div></li><li><div>     * For use by other plugins/themes to register extra variables&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see wpseo_register_var_replacement() for a usage example&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $var              The name of the variable to replace, i.e. '%%var%%'&nbsp;</div></li><li><div>     *                                  - the surrounding %% are optional.&nbsp;</div></li><li><div>     * @param  mixed  $replace_function Function or method to call to retrieve the replacement value for the variable&nbsp;</div></li><li><div>     *                                  Uses the same format as add_filter/add_action function parameter and&nbsp;</div></li><li><div>     *                                  should *return* the replacement value. DON'T echo it.&nbsp;</div></li><li><div>     * @param  string $type             Type of variable: 'basic' or 'advanced', defaults to 'advanced'.&nbsp;</div></li><li><div>     * @param  string $help_text        Help text to be added to the help tab for this variable.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool     Whether the replacement function was succesfully registered&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function register_replacement( $var, $replace_function, $type = 'advanced', $help_text = '' ) {&nbsp;</div></li><li><div>        $success = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_string( $var ) && $var !== '' ) {&nbsp;</div></li><li><div>            $var = self::remove_var_delimiter( $var );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( preg_match( '`^[A-Z0-9_-]+$`i', $var ) === false ) {&nbsp;</div></li><li><div>                trigger_error( __( 'A replacement variable can only contain alphanumeric characters, an underscore or a dash. Try renaming your variable.', 'wordpress-seo' ), E_USER_WARNING );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( strpos( $var, 'cf_' ) === 0 || strpos( $var, 'ct_' ) === 0 ) {&nbsp;</div></li><li><div>                trigger_error( __( 'A replacement variable can not start with &quot;%%cf_&quot; or &quot;%%ct_&quot; as these are reserved for the WPSEO standard variable variables for custom fields and custom taxonomies. Try making your variable name unique.', 'wordpress-seo' ), E_USER_WARNING );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( ! method_exists( __CLASS__, 'retrieve_' . $var ) ) {&nbsp;</div></li><li><div>                if ( ! isset( self::$external_replacements[ $var ] ) ) {&nbsp;</div></li><li><div>                    self::$external_replacements[ $var ] = $replace_function;&nbsp;</div></li><li><div>                    self::register_help_text( $type, $var, $help_text );&nbsp;</div></li><li><div>                    $success = true;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else {&nbsp;</div></li><li><div>                    trigger_error( __( 'A replacement variable with the same name has already been registered. Try making your variable name unique.', 'wordpress-seo' ), E_USER_WARNING );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                trigger_error( __( 'You cannot overrule a WPSEO standard variable replacement by registering a variable with the same name. Use the &quot;wpseo_replacements&quot; filter instead to adjust the replacement value.', 'wordpress-seo' ), E_USER_WARNING );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $success;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Replace `%%variable_placeholders%%` with their real value based on the current requested page/post/cpt/etc&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $string the string to replace the variables in.&nbsp;</div></li><li><div>     * @param array  $args   the object some of the replacement values might come from, &nbsp;</div></li><li><div>     *                       could be a post, taxonomy or term.&nbsp;</div></li><li><div>     * @param array  $omit   variables that should not be replaced by this function.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function replace( $string, $args, $omit = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $string = strip_tags( $string );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Let's see if we can bail super early.&nbsp;</div></li><li><div>        if ( strpos( $string, '%%' ) === false ) {&nbsp;</div></li><li><div>            return WPSEO_Utils::standardize_whitespace( $string );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $args = (array) $args;&nbsp;</div></li><li><div>        if ( isset( $args['post_content'] ) && ! empty( $args['post_content'] ) ) {&nbsp;</div></li><li><div>            $args['post_content'] = WPSEO_Utils::strip_shortcode( $args['post_content'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( isset( $args['post_excerpt'] ) && ! empty( $args['post_excerpt'] ) ) {&nbsp;</div></li><li><div>            $args['post_excerpt'] = WPSEO_Utils::strip_shortcode( $args['post_excerpt'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        $this-&gt;args = (object) wp_parse_args( $args, $this-&gt;defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Clean $omit array.&nbsp;</div></li><li><div>        if ( is_array( $omit ) && $omit !== array() ) {&nbsp;</div></li><li><div>            $omit = array_map( array( __CLASS__, 'remove_var_delimiter' ), $omit );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $replacements = array();&nbsp;</div></li><li><div>        if ( preg_match_all( '`%%([^%]+(%%single)?)%%?`iu', $string, $matches ) ) {&nbsp;</div></li><li><div>            $replacements = $this-&gt;set_up_replacements( $matches, $omit );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filter: 'wpseo_replacements' - Allow customization of the replacements before they are applied&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @api array $replacements The replacements&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        $replacements = apply_filters( 'wpseo_replacements', $replacements );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do the actual replacements.&nbsp;</div></li><li><div>        if ( is_array( $replacements ) && $replacements !== array() ) {&nbsp;</div></li><li><div>            $string = str_replace( array_keys( $replacements ), array_values( $replacements ), $string );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filter: 'wpseo_replacements_final' - Allow overruling of whether or not to remove placeholders&nbsp;</div></li><li><div>         * which didn't yield a replacement&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @example &lt;code&gt;add_filter( 'wpseo_replacements_final', '__return_false' );&lt;/code&gt;&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @api     bool $final&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( apply_filters( 'wpseo_replacements_final', true ) === true && ( isset( $matches[1] ) && is_array( $matches[1] ) ) ) {&nbsp;</div></li><li><div>            // Remove non-replaced variables.&nbsp;</div></li><li><div>            $remove = array_diff( $matches[1], $omit ); // Make sure the $omit variables do not get removed.&nbsp;</div></li><li><div>            $remove = array_map( array( __CLASS__, 'add_var_delimiter' ), $remove );&nbsp;</div></li><li><div>            $string = str_replace( $remove, '', $string );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Undouble separators which have nothing between them, i.e. where a non-replaced variable was removed.&nbsp;</div></li><li><div>        if ( isset( $replacements['%%sep%%'] ) && ( is_string( $replacements['%%sep%%'] ) && $replacements['%%sep%%'] !== '' ) ) {&nbsp;</div></li><li><div>            $q_sep = preg_quote( $replacements['%%sep%%'], '`' );&nbsp;</div></li><li><div>            $string = preg_replace( '`' . $q_sep . '(?:\s*' . $q_sep . ')*`u', $replacements['%%sep%%'], $string );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove superfluous whitespace.&nbsp;</div></li><li><div>        $string = WPSEO_Utils::standardize_whitespace( $string );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return trim( $string );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the replacements for the variables found.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $matches variables found in the original string - regex result.&nbsp;</div></li><li><div>     * @param array $omit    variables that should not be replaced by this function.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array retrieved replacements - this might be a smaller array as some variables&nbsp;</div></li><li><div>     *               may not yield a replacement in certain contexts.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function set_up_replacements( $matches, $omit ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $replacements = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // @todo -&gt; figure out a way to deal with external functions starting with cf_/ct_.&nbsp;</div></li><li><div>        foreach ( $matches[1] as $k =&gt; $var ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Don't set up replacements which should be omitted.&nbsp;</div></li><li><div>            if ( in_array( $var, $omit, true ) ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Deal with variable variable names first.&nbsp;</div></li><li><div>            if ( strpos( $var, 'cf_' ) === 0 ) {&nbsp;</div></li><li><div>                $replacement = $this-&gt;retrieve_cf_custom_field_name( $var );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( strpos( $var, 'ct_desc_' ) === 0 ) {&nbsp;</div></li><li><div>                $replacement = $this-&gt;retrieve_ct_desc_custom_tax_name( $var );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( strpos( $var, 'ct_' ) === 0 ) {&nbsp;</div></li><li><div>                $single = ( isset( $matches[2][ $k ] ) && $matches[2][ $k ] !== '' ) ? true : false;&nbsp;</div></li><li><div>                $replacement = $this-&gt;retrieve_ct_custom_tax_name( $var, $single );&nbsp;</div></li><li><div>            } // Deal with non-variable variable names.&nbsp;</div></li><li><div>            elseif ( method_exists( $this, 'retrieve_' . $var ) ) {&nbsp;</div></li><li><div>                $method_name = 'retrieve_' . $var;&nbsp;</div></li><li><div>                $replacement = $this-&gt;$method_name();&nbsp;</div></li><li><div>            } // Deal with externally defined variable names.&nbsp;</div></li><li><div>            elseif ( isset( self::$external_replacements[ $var ] ) && ! is_null( self::$external_replacements[ $var ] ) ) {&nbsp;</div></li><li><div>                $replacement = call_user_func( self::$external_replacements[ $var ], $var, $this-&gt;args );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Replacement retrievals can return null if no replacement can be determined, root those outs.&nbsp;</div></li><li><div>            if ( isset( $replacement ) ) {&nbsp;</div></li><li><div>                $var = self::add_var_delimiter( $var );&nbsp;</div></li><li><div>                $replacements[ $var ] = $replacement;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            unset( $replacement, $single, $method_name );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacements;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** *********************** BASIC VARIABLES ************************** */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post/cpt categories (comma separated) for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_category() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;args-&gt;ID ) ) {&nbsp;</div></li><li><div>            $cat = $this-&gt;get_terms( $this-&gt;args-&gt;ID, 'category' );&nbsp;</div></li><li><div>            if ( $cat !== '' ) {&nbsp;</div></li><li><div>                $replacement = $cat;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( ! isset( $replacement ) || $replacement === '' ) && ( isset( $this-&gt;args-&gt;cat_name ) && ! empty( $this-&gt;args-&gt;cat_name ) ) ) {&nbsp;</div></li><li><div>            $replacement = $this-&gt;args-&gt;cat_name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the category description for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_category_description() {&nbsp;</div></li><li><div>        return $this-&gt;retrieve_term_description();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the date of the post/page/cpt for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_date() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;args-&gt;post_date !== '' ) {&nbsp;</div></li><li><div>            $replacement = mysql2date( get_option( 'date_format' ), $this-&gt;args-&gt;post_date, true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            if ( get_query_var( 'day' ) && get_query_var( 'day' ) !== '' ) {&nbsp;</div></li><li><div>                $replacement = get_the_date();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                if ( single_month_title( ' ', false ) && single_month_title( ' ', false ) !== '' ) {&nbsp;</div></li><li><div>                    $replacement = single_month_title( ' ', false );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                elseif ( get_query_var( 'year' ) !== '' ) {&nbsp;</div></li><li><div>                    $replacement = get_query_var( 'year' );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post/page/cpt excerpt for use as replacement string.&nbsp;</div></li><li><div>     * The excerpt will be auto-generated if it does not exist.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_excerpt() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;args-&gt;ID ) ) {&nbsp;</div></li><li><div>            if ( $this-&gt;args-&gt;post_excerpt !== '' ) {&nbsp;</div></li><li><div>                $replacement = strip_tags( $this-&gt;args-&gt;post_excerpt );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            elseif ( $this-&gt;args-&gt;post_content !== '' ) {&nbsp;</div></li><li><div>                $replacement = wp_html_excerpt( strip_shortcodes( $this-&gt;args-&gt;post_content ), 155 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post/page/cpt excerpt for use as replacement string (without auto-generation).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_excerpt_only() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;args-&gt;ID ) && $this-&gt;args-&gt;post_excerpt !== '' ) {&nbsp;</div></li><li><div>            $replacement = strip_tags( $this-&gt;args-&gt;post_excerpt );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the title of the parent page of the current page/cpt for use as replacement string.&nbsp;</div></li><li><div>     * Only applicable for hierarchical post types.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @todo - check: shouldn't this use $this-&gt;args as well ?&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_parent_title() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $replacement ) && ( ( is_singular() || is_admin() ) && isset( $GLOBALS['post'] ) ) ) {&nbsp;</div></li><li><div>            if ( isset( $GLOBALS['post']-&gt;post_parent ) && 0 !== $GLOBALS['post']-&gt;post_parent ) {&nbsp;</div></li><li><div>                $replacement = get_the_title( $GLOBALS['post']-&gt;post_parent );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current search phrase for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_searchphrase() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $replacement ) ) {&nbsp;</div></li><li><div>            $search = get_query_var( 's' );&nbsp;</div></li><li><div>            if ( $search !== '' ) {&nbsp;</div></li><li><div>                $replacement = esc_html( $search );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the separator for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_sep() {&nbsp;</div></li><li><div>        return WPSEO_Utils::get_title_separator();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the site's tag line / description for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_sitedesc() {&nbsp;</div></li><li><div>        static $replacement;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $replacement ) ) {&nbsp;</div></li><li><div>            $description = trim( strip_tags( get_bloginfo( 'description' ) ) );&nbsp;</div></li><li><div>            if ( $description !== '' ) {&nbsp;</div></li><li><div>                $replacement = $description;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the site's name for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_sitename() {&nbsp;</div></li><li><div>        static $replacement;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $replacement ) ) {&nbsp;</div></li><li><div>            $sitename = WPSEO_Utils::get_site_name();&nbsp;</div></li><li><div>            if ( $sitename !== '' ) {&nbsp;</div></li><li><div>                $replacement = $sitename;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current tag/tags for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_tag() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $this-&gt;args-&gt;ID ) ) {&nbsp;</div></li><li><div>            $tags = $this-&gt;get_terms( $this-&gt;args-&gt;ID, 'post_tag' );&nbsp;</div></li><li><div>            if ( $tags !== '' ) {&nbsp;</div></li><li><div>                $replacement = $tags;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the tag description for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_tag_description() {&nbsp;</div></li><li><div>        return $this-&gt;retrieve_term_description();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the term description for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_term_description() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $this-&gt;args-&gt;term_id ) && ! empty( $this-&gt;args-&gt;taxonomy ) ) {&nbsp;</div></li><li><div>            $term_desc = get_term_field( 'description', $this-&gt;args-&gt;term_id, $this-&gt;args-&gt;taxonomy );&nbsp;</div></li><li><div>            if ( $term_desc !== '' ) {&nbsp;</div></li><li><div>                $replacement = trim( strip_tags( $term_desc ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the term name for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_term_title() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;args-&gt;taxonomy ) && ! empty( $this-&gt;args-&gt;name ) ) {&nbsp;</div></li><li><div>            $replacement = $this-&gt;args-&gt;name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the title of the post/page/cpt for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_title() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_string( $this-&gt;args-&gt;post_title ) && $this-&gt;args-&gt;post_title !== '' ) {&nbsp;</div></li><li><div>            $replacement = stripslashes( $this-&gt;args-&gt;post_title );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve primary category for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool|int|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_primary_category() {&nbsp;</div></li><li><div>        $primary_category = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;args-&gt;ID ) ) {&nbsp;</div></li><li><div>            $wpseo_primary_category = new WPSEO_Primary_Term( 'category', $this-&gt;args-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $term_id = $wpseo_primary_category-&gt;get_primary_term();&nbsp;</div></li><li><div>            $term = get_term( $term_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! is_wp_error( $term ) && ! empty( $term ) ) {&nbsp;</div></li><li><div>                $primary_category = $term-&gt;name;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $primary_category;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** *********************** ADVANCED VARIABLES ************************** */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Determine the page numbering of the current post/page/cpt&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $request 'nr'|'max' - whether to return the page number or the max number of pages.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return int|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function determine_pagenumbering( $request = 'nr' ) {&nbsp;</div></li><li><div>        global $wp_query, $post;&nbsp;</div></li><li><div>        $max_num_pages = null;&nbsp;</div></li><li><div>        $page_number = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $max_num_pages = 1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_singular() ) {&nbsp;</div></li><li><div>            $page_number = get_query_var( 'paged' );&nbsp;</div></li><li><div>            if ( $page_number === 0 || $page_number === '' ) {&nbsp;</div></li><li><div>                $page_number = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $wp_query-&gt;max_num_pages ) && ( $wp_query-&gt;max_num_pages != '' && $wp_query-&gt;max_num_pages != 0 ) ) {&nbsp;</div></li><li><div>                $max_num_pages = $wp_query-&gt;max_num_pages;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $page_number = get_query_var( 'page' );&nbsp;</div></li><li><div>            if ( $page_number === 0 || $page_number === '' ) {&nbsp;</div></li><li><div>                $page_number = 1;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( isset( $post-&gt;post_content ) ) {&nbsp;</div></li><li><div>                $max_num_pages = ( substr_count( $post-&gt;post_content, '&lt;!--nextpage--&gt;' ) + 1 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $return = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $request ) {&nbsp;</div></li><li><div>            case 'nr':&nbsp;</div></li><li><div>                $return = $page_number;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'max':&nbsp;</div></li><li><div>                $return = $max_num_pages;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Determine the post type names for the current post/page/cpt&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $request 'single'|'plural' - whether to return the single or plural form.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function determine_pt_names( $request = 'single' ) {&nbsp;</div></li><li><div>        global $wp_query;&nbsp;</div></li><li><div>        $pt_single = null;&nbsp;</div></li><li><div>        $pt_plural = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $wp_query-&gt;query_vars['post_type'] ) && ( ( is_string( $wp_query-&gt;query_vars['post_type'] ) && $wp_query-&gt;query_vars['post_type'] !== '' ) || ( is_array( $wp_query-&gt;query_vars['post_type'] ) && $wp_query-&gt;query_vars['post_type'] !== array() ) ) ) {&nbsp;</div></li><li><div>            $post_type = $wp_query-&gt;query_vars['post_type'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( isset( $this-&gt;args-&gt;post_type ) && ( is_string( $this-&gt;args-&gt;post_type ) && $this-&gt;args-&gt;post_type !== '' ) ) {&nbsp;</div></li><li><div>            $post_type = $this-&gt;args-&gt;post_type;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            // Make it work in preview mode.&nbsp;</div></li><li><div>            $post_type = $wp_query-&gt;get_queried_object()-&gt;post_type;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_array( $post_type ) ) {&nbsp;</div></li><li><div>            $post_type = reset( $post_type );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $post_type !== '' ) {&nbsp;</div></li><li><div>            $pt = get_post_type_object( $post_type );&nbsp;</div></li><li><div>            $pt_plural = $pt_single = $pt-&gt;name;&nbsp;</div></li><li><div>            if ( isset( $pt-&gt;labels-&gt;singular_name ) ) {&nbsp;</div></li><li><div>                $pt_single = $pt-&gt;labels-&gt;singular_name;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( isset( $pt-&gt;labels-&gt;name ) ) {&nbsp;</div></li><li><div>                $pt_plural = $pt-&gt;labels-&gt;name;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $return = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $request ) {&nbsp;</div></li><li><div>            case 'single':&nbsp;</div></li><li><div>                $return = $pt_single;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            case 'plural':&nbsp;</div></li><li><div>                $return = $pt_plural;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the attachment caption for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_caption() {&nbsp;</div></li><li><div>        return $this-&gt;retrieve_excerpt_only();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a post/page/cpt's custom field value for use as replacement string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $var The complete variable to replace which includes the name of&nbsp;</div></li><li><div>     *                    the custom field which value is to be retrieved.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_cf_custom_field_name( $var ) {&nbsp;</div></li><li><div>        global $post;&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_string( $var ) && $var !== '' ) {&nbsp;</div></li><li><div>            $field = substr( $var, 3 );&nbsp;</div></li><li><div>            if ( ( is_singular() || is_admin() ) && ( is_object( $post ) && isset( $post-&gt;ID ) ) ) {&nbsp;</div></li><li><div>                $name = get_post_meta( $post-&gt;ID, $field, true );&nbsp;</div></li><li><div>                if ( $name !== '' ) {&nbsp;</div></li><li><div>                    $replacement = $name;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a post/page/cpt's custom taxonomies for use as replacement string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $var    The complete variable to replace which includes the name of&nbsp;</div></li><li><div>     *                       the custom taxonomy which value(s) is to be retrieved.&nbsp;</div></li><li><div>     * @param bool   $single Whether to retrieve only the first or all values for the taxonomy.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_ct_custom_tax_name( $var, $single = false ) {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ( is_string( $var ) && $var !== '' ) && ! empty( $this-&gt;args-&gt;ID ) ) {&nbsp;</div></li><li><div>            $tax = substr( $var, 3 );&nbsp;</div></li><li><div>            $name = $this-&gt;get_terms( $this-&gt;args-&gt;ID, $tax, $single );&nbsp;</div></li><li><div>            if ( $name !== '' ) {&nbsp;</div></li><li><div>                $replacement = $name;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a post/page/cpt's custom taxonomies description for use as replacement string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $var The complete variable to replace which includes the name of&nbsp;</div></li><li><div>     *                    the custom taxonomy which description is to be retrieved.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_ct_desc_custom_tax_name( $var ) {&nbsp;</div></li><li><div>        global $post;&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_string( $var ) && $var !== '' ) {&nbsp;</div></li><li><div>            $tax = substr( $var, 8 );&nbsp;</div></li><li><div>            if ( is_object( $post ) && isset( $post-&gt;ID ) ) {&nbsp;</div></li><li><div>                $terms = get_the_terms( $post-&gt;ID, $tax );&nbsp;</div></li><li><div>                if ( is_array( $terms ) && $terms !== array() ) {&nbsp;</div></li><li><div>                    $term = current( $terms );&nbsp;</div></li><li><div>                    $term_desc = get_term_field( 'description', $term-&gt;term_id, $tax );&nbsp;</div></li><li><div>                    if ( $term_desc !== '' ) {&nbsp;</div></li><li><div>                        $replacement = trim( strip_tags( $term_desc ) );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current date for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_currentdate() {&nbsp;</div></li><li><div>        static $replacement;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $replacement ) ) {&nbsp;</div></li><li><div>            $replacement = date_i18n( get_option( 'date_format' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current day for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_currentday() {&nbsp;</div></li><li><div>        static $replacement;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $replacement ) ) {&nbsp;</div></li><li><div>            $replacement = date_i18n( 'j' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current month for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_currentmonth() {&nbsp;</div></li><li><div>        static $replacement;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $replacement ) ) {&nbsp;</div></li><li><div>            $replacement = date_i18n( 'F' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current time for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_currenttime() {&nbsp;</div></li><li><div>        static $replacement;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $replacement ) ) {&nbsp;</div></li><li><div>            $replacement = date_i18n( get_option( 'time_format' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current year for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_currentyear() {&nbsp;</div></li><li><div>        static $replacement;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $replacement ) ) {&nbsp;</div></li><li><div>            $replacement = date_i18n( 'Y' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post/page/cpt's focus keyword for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_focuskw() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;args-&gt;ID ) ) {&nbsp;</div></li><li><div>            $focus_kw = WPSEO_Meta::get_value( 'focuskw', $this-&gt;args-&gt;ID );&nbsp;</div></li><li><div>            if ( $focus_kw !== '' ) {&nbsp;</div></li><li><div>                $replacement = $focus_kw;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post/page/cpt ID for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_id() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;args-&gt;ID ) ) {&nbsp;</div></li><li><div>            $replacement = $this-&gt;args-&gt;ID;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post/page/cpt modified time for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_modified() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;args-&gt;post_modified ) ) {&nbsp;</div></li><li><div>            $replacement = mysql2date( get_option( 'date_format' ), $this-&gt;args-&gt;post_modified, true );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post/page/cpt author's &quot;nice name&quot; for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_name() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $user_id = $this-&gt;retrieve_userid();&nbsp;</div></li><li><div>        $name = get_the_author_meta( 'display_name', $user_id );&nbsp;</div></li><li><div>        if ( $name !== '' ) {&nbsp;</div></li><li><div>            $replacement = $name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post/page/cpt author's users description for use as a replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return null|string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_user_description() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $user_id = $this-&gt;retrieve_userid();&nbsp;</div></li><li><div>        $description = get_the_author_meta( 'description', $user_id );&nbsp;</div></li><li><div>        if ( $description != '' ) {&nbsp;</div></li><li><div>            $replacement = $description;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current page number with context (i.e. 'page 2 of 4') for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_page() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $max = $this-&gt;determine_pagenumbering( 'max' );&nbsp;</div></li><li><div>        $nr = $this-&gt;determine_pagenumbering( 'nr' );&nbsp;</div></li><li><div>        $sep = $this-&gt;retrieve_sep();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $max &gt; 1 && $nr &gt; 1 ) {&nbsp;</div></li><li><div>            $replacement = sprintf( $sep . ' ' . __( 'Page %1$d of %2$d', 'wordpress-seo' ), $nr, $max );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current page number for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_pagenumber() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $nr = $this-&gt;determine_pagenumbering( 'nr' );&nbsp;</div></li><li><div>        if ( isset( $nr ) && $nr &gt; 0 ) {&nbsp;</div></li><li><div>            $replacement = (string) $nr;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the current page total for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_pagetotal() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $max = $this-&gt;determine_pagenumbering( 'max' );&nbsp;</div></li><li><div>        if ( isset( $max ) && $max &gt; 0 ) {&nbsp;</div></li><li><div>            $replacement = (string) $max;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post type plural label for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_pt_plural() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $name = $this-&gt;determine_pt_names( 'plural' );&nbsp;</div></li><li><div>        if ( isset( $name ) && $name !== '' ) {&nbsp;</div></li><li><div>            $replacement = $name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post type single label for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_pt_single() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $name = $this-&gt;determine_pt_names( 'single' );&nbsp;</div></li><li><div>        if ( isset( $name ) && $name !== '' ) {&nbsp;</div></li><li><div>            $replacement = $name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the slug which caused the 404 for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|null&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_term404() {&nbsp;</div></li><li><div>        $replacement = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;args-&gt;term404 !== '' ) {&nbsp;</div></li><li><div>            $replacement = sanitize_text_field( str_replace( '-', ' ', $this-&gt;args-&gt;term404 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else {&nbsp;</div></li><li><div>            $error_request = get_query_var( 'pagename' );&nbsp;</div></li><li><div>            if ( $error_request !== '' ) {&nbsp;</div></li><li><div>                $replacement = sanitize_text_field( str_replace( '-', ' ', $error_request ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else {&nbsp;</div></li><li><div>                $error_request = get_query_var( 'name' );&nbsp;</div></li><li><div>                if ( $error_request !== '' ) {&nbsp;</div></li><li><div>                    $replacement = sanitize_text_field( str_replace( '-', ' ', $error_request ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the post/page/cpt author's user id for use as replacement string.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private function retrieve_userid() {&nbsp;</div></li><li><div>        $replacement = ! empty( $this-&gt;args-&gt;post_author ) ? $this-&gt;args-&gt;post_author : get_query_var( 'author' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $replacement;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** *********************** HELP TEXT RELATED ************************** */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create a variable help text table&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param    string $type Either 'basic' or 'advanced'.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return    string            Help text table&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function create_variable_help_table( $type ) {&nbsp;</div></li><li><div>        if ( ! in_array( $type, array( 'basic', 'advanced' ), true ) ) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table = '&nbsp;</div></li><li><div>            &lt;table class=&quot;yoast_help yoast-table-scrollable&quot;&gt;&nbsp;</div></li><li><div>            &lt;thead&gt;&nbsp;</div></li><li><div>                &lt;tr&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;col&quot;&gt;' . esc_html__( 'Variable', 'wordpress-seo' ) . '&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;col&quot;&gt;' . esc_html__( 'Description', 'wordpress-seo' ) . '&lt;/th&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>            &lt;/thead&gt;&nbsp;</div></li><li><div>            &lt;tbody&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( self::$help_texts[ $type ] as $replace =&gt; $help_text ) {&nbsp;</div></li><li><div>            $table .= '&nbsp;</div></li><li><div>                &lt;tr&gt;&nbsp;</div></li><li><div>                    &lt;td class=&quot;yoast-variable-name&quot;&gt;%%' . esc_html( $replace ) . '%%&lt;/td&gt;&nbsp;</div></li><li><div>                    &lt;td class=&quot;yoast-variable-desc&quot;&gt;' . $help_text . '&lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $table .= '&nbsp;</div></li><li><div>            &lt;/tbody&gt;&nbsp;</div></li><li><div>            &lt;/table&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $table;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create the help text table for the basic variables for use in a help tab&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_basic_help_texts() {&nbsp;</div></li><li><div>        return self::create_variable_help_table( 'basic' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Create the help text table for the advanced variables for use in a help tab&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_advanced_help_texts() {&nbsp;</div></li><li><div>        return self::create_variable_help_table( 'advanced' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set the help text for a user/plugin/theme defined extra variable.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $type      Type of variable: 'basic' or 'advanced'.&nbsp;</div></li><li><div>     * @param  string $replace   Variable to replace, i.e. '%%var%%'.&nbsp;</div></li><li><div>     * @param  string $help_text The actual help text string.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function register_help_text( $type, $replace, $help_text = '' ) {&nbsp;</div></li><li><div>        if ( is_string( $replace ) && $replace !== '' ) {&nbsp;</div></li><li><div>            $replace = self::remove_var_delimiter( $replace );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ( is_string( $type ) && in_array( $type, array(&nbsp;</div></li><li><div>                        'basic', &nbsp;</div></li><li><div>                        'advanced', &nbsp;</div></li><li><div> ), true ) ) && ( $replace !== '' && ! isset( self::$help_texts[ $type ][ $replace ] ) )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>                self::$help_texts[ $type ][ $replace ] = $help_text;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set/translate the help texts for the WPSEO standard basic variables.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function set_basic_help_texts() {&nbsp;</div></li><li><div>        self::$help_texts['basic'] = array(&nbsp;</div></li><li><div>            'date' =&gt; __( 'Replaced with the date of the post/page', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'title' =&gt; __( 'Replaced with the title of the post/page', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'parent_title' =&gt; __( 'Replaced with the title of the parent page of the current page', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'sitename' =&gt; __( 'The site\'s name', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'sitedesc' =&gt; __( 'The site\'s tag line / description', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'excerpt' =&gt; __( 'Replaced with the post/page excerpt (or auto-generated if it does not exist)', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'excerpt_only' =&gt; __( 'Replaced with the post/page excerpt (without auto-generation)', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'tag' =&gt; __( 'Replaced with the current tag/tags', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'category' =&gt; __( 'Replaced with the post categories (comma separated)', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'primary_category' =&gt; __( 'Replaced with the primary category of the post/page', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'category_description' =&gt; __( 'Replaced with the category description', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'tag_description' =&gt; __( 'Replaced with the tag description', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'term_description' =&gt; __( 'Replaced with the term description', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'term_title' =&gt; __( 'Replaced with the term name', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'searchphrase' =&gt; __( 'Replaced with the current search phrase', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'sep' =&gt; sprintf(&nbsp;</div></li><li><div>                /** translators: %s: wp_title() function */&nbsp;</div></li><li><div>                __( 'The separator defined in your theme\'s %s tag.', 'wordpress-seo' ), &nbsp;</div></li><li><div>                '&lt;code&gt;wp_title()&lt;/code&gt;'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set/translate the help texts for the WPSEO standard advanced variables.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function set_advanced_help_texts() {&nbsp;</div></li><li><div>        self::$help_texts['advanced'] = array(&nbsp;</div></li><li><div>            'pt_single' =&gt; __( 'Replaced with the post type single label', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'pt_plural' =&gt; __( 'Replaced with the post type plural label', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'modified' =&gt; __( 'Replaced with the post/page modified time', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'id' =&gt; __( 'Replaced with the post/page ID', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'name' =&gt; __( 'Replaced with the post/page author\'s \'nicename\'', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'user_description' =&gt; __( 'Replaced with the post/page author\'s \'Biographical Info\'', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'userid' =&gt; __( 'Replaced with the post/page author\'s userid', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'currenttime' =&gt; __( 'Replaced with the current time', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'currentdate' =&gt; __( 'Replaced with the current date', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'currentday' =&gt; __( 'Replaced with the current day', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'currentmonth' =&gt; __( 'Replaced with the current month', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'currentyear' =&gt; __( 'Replaced with the current year', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'page' =&gt; __( 'Replaced with the current page number with context (i.e. page 2 of 4)', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'pagetotal' =&gt; __( 'Replaced with the current page total', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'pagenumber' =&gt; __( 'Replaced with the current page number', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'caption' =&gt; __( 'Attachment caption', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'focuskw' =&gt; __( 'Replaced with the posts focus keyword', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'term404' =&gt; __( 'Replaced with the slug which caused the 404', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'cf_&lt;custom-field-name&gt;' =&gt; __( 'Replaced with a posts custom field value', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'ct_&lt;custom-tax-name&gt;' =&gt; __( 'Replaced with a posts custom taxonomies, comma separated.', 'wordpress-seo' ), &nbsp;</div></li><li><div>            'ct_desc_&lt;custom-tax-name&gt;' =&gt; __( 'Replaced with a custom taxonomies description', 'wordpress-seo' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /** *********************** GENERAL HELPER METHODS ************************** */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Remove the '%%' delimiters from a variable string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $string Variable string to be cleaned.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function remove_var_delimiter( $string ) {&nbsp;</div></li><li><div>        return trim( $string, '%' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add the '%%' delimiters to a variable string&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param  string $string Variable string to be delimited.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    private static function add_var_delimiter( $string ) {&nbsp;</div></li><li><div>        return '%%' . $string . '%%';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a post's terms, comma delimited.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int    $id            ID of the post to get the terms for.&nbsp;</div></li><li><div>     * @param string $taxonomy      The taxonomy to get the terms for this post from.&nbsp;</div></li><li><div>     * @param bool   $return_single If true, return the first term.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string either a single term or a comma delimited string of terms.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_terms( $id, $taxonomy, $return_single = false ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $output = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If we're on a specific tag, category or taxonomy page, use that.&nbsp;</div></li><li><div>        if ( is_category() || is_tag() || is_tax() ) {&nbsp;</div></li><li><div>            $term = $GLOBALS['wp_query']-&gt;get_queried_object();&nbsp;</div></li><li><div>            $output = $term-&gt;name;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ( ! empty( $id ) && ! empty( $taxonomy ) ) {&nbsp;</div></li><li><div>            $terms = get_the_terms( $id, $taxonomy );&nbsp;</div></li><li><div>            if ( is_array( $terms ) && $terms !== array() ) {&nbsp;</div></li><li><div>                foreach ( $terms as $term ) {&nbsp;</div></li><li><div>                    if ( $return_single ) {&nbsp;</div></li><li><div>                        $output = $term-&gt;name;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else {&nbsp;</div></li><li><div>                        $output .= $term-&gt;name . ', ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $output = rtrim( trim( $output ), ', ' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        unset( $terms, $term );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Allows filtering of the terms list used to replace %%category%%, %%tag%% and %%ct_&lt;custom-tax-name&gt;%% variables&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @api    string    $output    Comma-delimited string containing the terms&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'wpseo_terms', $output );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>} /** End of class WPSEO_Replace_Vars */&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 4.4</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/yoast-seo/4.7.1/classes/wpseo_replace_vars/" class="active">4.7.1</a></li><li><a href="http://hookr.io/plugins/yoast-seo/4.7/classes/wpseo_replace_vars/" class="">4.7</a></li><li><a href="http://hookr.io/plugins/yoast-seo/4.6/classes/wpseo_replace_vars/" class="">4.6</a></li><li><a href="http://hookr.io/plugins/yoast-seo/4.5/classes/wpseo_replace_vars/" class="">4.5</a></li><li><a href="http://hookr.io/plugins/yoast-seo/4.4/classes/wpseo_replace_vars/" class="">4.4</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>WPSEO_Replace_Vars</li><li><span></span>Yoast SEO</li><li><span></span>4.7.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>