<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="4.7.1" data-slug="yoast-seo" data-type="file" data-id="14443"><head xmlns="http://www.w3.org/1999/xhtml"><title> inc-class-wpseo-meta | file | Yoast Seo | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, yoast-seo, 4.7.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=f659a10f04bd1d9f78d7df44e66e8a3a' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/inc-class-wpseo-meta/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Finc-class-wpseo-meta%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Finc-class-wpseo-meta%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-yoast-seo-4.7.1-file-inc-class-wpseo-meta","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="inc-class-wpseo-meta" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to yoast-seo." href="http://hookr.io/plugins/yoast-seo/" class="plugin"><span property="name">yoast-seo</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.1." href="http://hookr.io/plugins/yoast-seo/4.7.1/" class="H_VERSION"><span property="name">4.7.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/yoast-seo/4.7.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">inc-class-wpseo-meta</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="558"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/all/" title="All">All <span class="count badge">558</span></a></li><li class="" data-id="new" data-count="3"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/new/" title="New">New <span class="count badge">3</span></a></li><li class="" data-id="hooks" data-count="187"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/hooks/" title="Hooks">Hooks <span class="count badge">187</span></a></li><li class="" data-id="action" data-count="44"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/actions/" title="Actions">Actions <span class="count badge">44</span></a></li><li class="" data-id="filter" data-count="143"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/filters/" title="Filters">Filters <span class="count badge">143</span></a></li><li class="" data-id="class" data-count="256"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/classes/" title="Classes">Classes <span class="count badge">256</span></a></li><li class="" data-id="constant" data-count="10"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/constants/" title="Constants">Constants <span class="count badge">10</span></a></li><li class="" data-id="function" data-count="103"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/functions/" title="Functions">Functions <span class="count badge">103</span></a></li><li class="" data-id="shortcode" data-count="2"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">2</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/inc/class-wpseo-meta.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @package WPSEO\Internals</span>&nbsp;</div></li><li><div><span class="comment"> * @since      1.5.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * This class implements defaults and value validation for all WPSEO Post Meta values.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Some guidelines:</span>&nbsp;</div></li><li><div><span class="comment"> * - To update a meta value, you can just use update_post_meta() with the full (prefixed) meta key</span>&nbsp;</div></li><li><div><span class="comment"> *        or the convenience method WPSEO_Meta::set_value() with the internal key.</span>&nbsp;</div></li><li><div><span class="comment"> *        All updates will be automatically validated.</span>&nbsp;</div></li><li><div><span class="comment"> *        Meta values will only be saved to the database if they are *not* the same as the default to</span>&nbsp;</div></li><li><div><span class="comment"> *        keep database load low.</span>&nbsp;</div></li><li><div><span class="comment"> * - To retrieve a WPSEO meta value, you **must** use WPSEO_Meta::get_value() which will always return a</span>&nbsp;</div></li><li><div><span class="comment"> *        string value, either the saved value or the default.</span>&nbsp;</div></li><li><div><span class="comment"> *        This method can also retrieve a complete set of WPSEO meta values for one specific post, see</span>&nbsp;</div></li><li><div><span class="comment"> *        the method documentation for the parameters.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @internal   Unfortunately there isn't a filter available to hook into before returning the results</span>&nbsp;</div></li><li><div><span class="comment"> * for get_post_meta(), get_post_custom() and the likes. That would have been the preferred solution.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @internal   all WP native get_meta() results get cached internally, so no need to cache locally.</span>&nbsp;</div></li><li><div><span class="comment"> * @internal   use $key when the key is the WPSEO internal name (without prefix), $meta_key when it</span>&nbsp;</div></li><li><div><span class="comment"> *             includes the prefix</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class WPSEO_Meta {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    string    Prefix for all WPSEO meta values in the database</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @internal if at any point this would change, quite apart from an upgrade routine, this also will need to</span>&nbsp;</div></li><li><div><span class="comment">   * be changed in the wpml-config.xml file.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static $meta_prefix = '_yoast_wpseo_';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    string   Prefix for all WPSEO meta value form field names and ids</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static $form_prefix = 'yoast_wpseo_';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    int       Allowed length of the meta description.</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static $meta_length = 156;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    string   Reason the meta description is not the default length.</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static $meta_length_reason = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    array  $meta_fields Meta box field definitions for the meta box form</span>&nbsp;</div></li><li><div><span class="comment">   *                Array format:</span>&nbsp;</div></li><li><div><span class="comment">   *                (required)        'type' =&gt; (string) field type. i.e. text / textarea / checkbox /</span>&nbsp;</div></li><li><div><span class="comment">   *                                                    radio / select / multiselect / upload / snippetpreview etc</span>&nbsp;</div></li><li><div><span class="comment">   *                (required)        'title' =&gt; (string) table row title</span>&nbsp;</div></li><li><div><span class="comment">   *                (recommended)    'default_value' =&gt; (string|array) default value for the field</span>&nbsp;</div></li><li><div><span class="comment">   *                                                    IMPORTANT:</span>&nbsp;</div></li><li><div><span class="comment">   *                                                    - if the field has options, the default has to be the</span>&nbsp;</div></li><li><div><span class="comment">   *                                                      key of one of the options</span>&nbsp;</div></li><li><div><span class="comment">   *                                                    - if the field is a text field, the default **has** to be</span>&nbsp;</div></li><li><div><span class="comment">   *                                                      an empty string as otherwise the user can't save</span>&nbsp;</div></li><li><div><span class="comment">   *                                                      an empty value/delete the meta value</span>&nbsp;</div></li><li><div><span class="comment">   *                                                    - if the field is a checkbox, the only valid values</span>&nbsp;</div></li><li><div><span class="comment">   *                                                      are 'on' or 'off'</span>&nbsp;</div></li><li><div><span class="comment">   *                (semi-required)    'options' =&gt; (array) options for used with (multi-)select and radio</span>&nbsp;</div></li><li><div><span class="comment">   *                                                    fields, required if that's the field type</span>&nbsp;</div></li><li><div><span class="comment">   *                                                    key = (string) value which will be saved to db</span>&nbsp;</div></li><li><div><span class="comment">   *                                                    value = (string) text label for the option</span>&nbsp;</div></li><li><div><span class="comment">   *                (optional)        'autocomplete' =&gt; (bool) whether autocomplete is on for text fields, </span>&nbsp;</div></li><li><div><span class="comment">   *                                                    defaults to true</span>&nbsp;</div></li><li><div><span class="comment">   *                (optional)        'class' =&gt; (string) classname(s) to add to the actual &lt;input&gt; tag</span>&nbsp;</div></li><li><div><span class="comment">   *                (optional)        'description' =&gt; (string) description to show underneath the field</span>&nbsp;</div></li><li><div><span class="comment">   *                (optional)        'expl' =&gt; (string) label for a checkbox</span>&nbsp;</div></li><li><div><span class="comment">   *                (optional)        'help' =&gt; (string) help text to show on mouse over ? image</span>&nbsp;</div></li><li><div><span class="comment">   *                (optional)        'rows' =&gt; (int) number of rows for a textarea, defaults to 3</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   *                (optional)        'placeholder' =&gt; (string) Currently only used by add-on plugins</span>&nbsp;</div></li><li><div><span class="comment">   *                (optional)        'serialized' =&gt; (bool) whether the value is expected to be serialized, </span>&nbsp;</div></li><li><div><span class="comment">   *                                                     i.e. an array or object, defaults to false</span>&nbsp;</div></li><li><div><span class="comment">   *                                                     Currently only used by add-on plugins</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @internal</span>&nbsp;</div></li><li><div><span class="comment">   * - Titles, help texts, description text and option labels are added via a translate_meta_boxes() method</span>&nbsp;</div></li><li><div><span class="comment">   *     in the relevant child classes (WPSEO_Metabox and WPSEO_Social_admin) as they are only needed there.</span>&nbsp;</div></li><li><div><span class="comment">   * - Beware: even though the meta keys are divided into subsets, they still have to be uniquely named!</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static $meta_fields = array(&nbsp;</div></li><li><div>      'general' =&gt; array(&nbsp;</div></li><li><div>          'snippetpreview' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'snippetpreview', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'help' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'help-button' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'focuskw_text_input' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'focuskeyword', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '', &nbsp;</div></li><li><div>              'autocomplete' =&gt; false, &nbsp;</div></li><li><div>              'help' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'description' =&gt; '&lt;div id=&quot;focuskwresults&quot;&gt;&lt;/div&gt;', &nbsp;</div></li><li><div>              'help-button' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'focuskw' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'hidden', &nbsp;</div></li><li><div>              'title' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'title' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'hidden', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '', &nbsp;</div></li><li><div>              'description' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'help' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'metadesc' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'hidden', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '', &nbsp;</div></li><li><div>              'class' =&gt; 'metadesc', &nbsp;</div></li><li><div>              'rows' =&gt; 2, &nbsp;</div></li><li><div>              'description' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'help' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'linkdex' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'hidden', &nbsp;</div></li><li><div>              'title' =&gt; 'linkdex', &nbsp;</div></li><li><div>              'default_value' =&gt; '0', &nbsp;</div></li><li><div>              'description' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'content_score' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'hidden', &nbsp;</div></li><li><div>              'title' =&gt; 'content_score', &nbsp;</div></li><li><div>              'default_value' =&gt; '0', &nbsp;</div></li><li><div>              'description' =&gt; '', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'metakeywords' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'metakeywords', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '', &nbsp;</div></li><li><div>              'class' =&gt; 'metakeywords', &nbsp;</div></li><li><div>              'description' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'pageanalysis' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'pageanalysis', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'help' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'help-button' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'advanced' =&gt; array(&nbsp;</div></li><li><div>          'meta-robots-noindex' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'select', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '0', <span class="comment">// = post-type default.</span>&nbsp;</div></li><li><div>              'options' =&gt; array(&nbsp;</div></li><li><div>                  '0' =&gt; '', <span class="comment">// Post type default - translation added later.</span>&nbsp;</div></li><li><div>                  '2' =&gt; '', <span class="comment">// Index - translation added later.</span>&nbsp;</div></li><li><div>                  '1' =&gt; '', <span class="comment">// No-index - translation added later.</span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'meta-robots-nofollow' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'radio', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '0', <span class="comment">// = follow.</span>&nbsp;</div></li><li><div>              'options' =&gt; array(&nbsp;</div></li><li><div>                  '0' =&gt; '', <span class="comment">// Follow - translation added later.</span>&nbsp;</div></li><li><div>                  '1' =&gt; '', <span class="comment">// No-follow - translation added later.</span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'meta-robots-adv' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'multiselect', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '-', <span class="comment">// = site-wide default.</span>&nbsp;</div></li><li><div>              'description' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'options' =&gt; array(&nbsp;</div></li><li><div>                  '-' =&gt; '', <span class="comment">// Site-wide default - translation added later.</span>&nbsp;</div></li><li><div>                  'none' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'noodp' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'noimageindex' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'noarchive' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'nosnippet' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'bctitle' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'text', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '', &nbsp;</div></li><li><div>              'description' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'canonical' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'text', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '', &nbsp;</div></li><li><div>              'description' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>          'redirect' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; 'text', &nbsp;</div></li><li><div>              'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>              'default_value' =&gt; '', &nbsp;</div></li><li><div>              'description' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>      'social' =&gt; array(), &nbsp;</div></li><li><div>      <span class="comment">/** Fields we should validate & save, but not show on any form */</span>&nbsp;</div></li><li><div>      'non_form' =&gt; array(&nbsp;</div></li><li><div>          'linkdex' =&gt; array(&nbsp;</div></li><li><div>              'type' =&gt; null, &nbsp;</div></li><li><div>              'default_value' =&gt; '0', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    array    Helper property - reverse index of the definition array</span>&nbsp;</div></li><li><div><span class="comment">   *                  Format: [full meta key including prefix] =&gt; array</span>&nbsp;</div></li><li><div><span class="comment">   *                          ['subset'] =&gt; (string) primary index</span>&nbsp;</div></li><li><div><span class="comment">   *                          ['key'] =&gt; (string) internal key</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static $fields_index = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    array    Helper property - array containing only the defaults in the format:</span>&nbsp;</div></li><li><div><span class="comment">   *                  [full meta key including prefix] =&gt; (string) default value</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static $defaults = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    array    Helper property to define the social network meta field definitions - networks</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private static $social_networks = array(&nbsp;</div></li><li><div>      'opengraph' =&gt; 'opengraph', &nbsp;</div></li><li><div>      'twitter' =&gt; 'twitter', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    array    Helper property to define the social network meta field definitions - fields and their type</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private static $social_fields = array(&nbsp;</div></li><li><div>      'title' =&gt; 'text', &nbsp;</div></li><li><div>      'description' =&gt; 'textarea', &nbsp;</div></li><li><div>      'image' =&gt; 'upload', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Register our actions and filters</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function init() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $options = WPSEO_Options::get_option( 'wpseo_social' );&nbsp;</div></li><li><div>      foreach ( self::$social_networks as $option =&gt; $network ) {&nbsp;</div></li><li><div>          if ( true === $options[ $option ] ) {&nbsp;</div></li><li><div>              foreach ( self::$social_fields as $box =&gt; $type ) {&nbsp;</div></li><li><div>                  self::$meta_fields['social'][ $network . '-' . $box ] = array(&nbsp;</div></li><li><div>                      'type' =&gt; $type, &nbsp;</div></li><li><div>                      'title' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div>                      'default_value' =&gt; '', &nbsp;</div></li><li><div>                      'description' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// Translation added later.</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $options, $option, $network, $box, $type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Allow add-on plugins to register their meta fields for management by this class</span>&nbsp;</div></li><li><div><span class="comment">       * add_filter() calls must be made before plugins_loaded prio 14</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $extra_fields = apply_filters( 'add_extra_wpseo_meta_fields', array() );&nbsp;</div></li><li><div>      if ( is_array( $extra_fields ) ) {&nbsp;</div></li><li><div>          self::$meta_fields = self::array_merge_recursive_distinct( $extra_fields, self::$meta_fields );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $extra_fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $register = function_exists( 'register_meta' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( self::$meta_fields as $subset =&gt; $field_group ) {&nbsp;</div></li><li><div>          foreach ( $field_group as $key =&gt; $field_def ) {&nbsp;</div></li><li><div>              if ( $field_def['type'] !== 'snippetpreview' ) {&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Function register_meta() is undocumented and not used by WP internally, wrapped in</span>&nbsp;</div></li><li><div><span class="comment">                   * function_exists as a precaution in case they remove it.</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  if ( $register === true ) {&nbsp;</div></li><li><div>                      register_meta( 'post', self::$meta_prefix . $key, array( __CLASS__, 'sanitize_post_meta' ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      add_filter( 'sanitize_post_meta_' . self::$meta_prefix . $key, array( __CLASS__, 'sanitize_post_meta' ), 10, 2 );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Set the $fields_index property for efficiency.</span>&nbsp;</div></li><li><div>                  self::$fields_index[ self::$meta_prefix . $key ] = array(&nbsp;</div></li><li><div>                      'subset' =&gt; $subset, &nbsp;</div></li><li><div>                      'key' =&gt; $key, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Set the $defaults property for efficiency.</span>&nbsp;</div></li><li><div>                  if ( isset( $field_def['default_value'] ) ) {&nbsp;</div></li><li><div>                      self::$defaults[ self::$meta_prefix . $key ] = $field_def['default_value'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      <span class="comment">// Meta will always be a string, so let's make the meta meta default also a string.</span>&nbsp;</div></li><li><div>                      self::$defaults[ self::$meta_prefix . $key ] = '';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $subset, $field_group, $key, $field_def, $register );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( 'update_post_metadata', array( __CLASS__, 'remove_meta_if_default' ), 10, 5 );&nbsp;</div></li><li><div>      add_filter( 'add_post_metadata', array( __CLASS__, 'dont_save_meta_if_default' ), 10, 4 );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Retrieve the meta box form field definitions for the given tab and post type.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $tab       Tab for which to retrieve the field definitions.</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $post_type Post type of the current post.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array             Array containing the meta box field definitions</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_meta_field_defs( $tab, $post_type = 'post' ) {&nbsp;</div></li><li><div>      if ( ! isset( self::$meta_fields[ $tab ] ) ) {&nbsp;</div></li><li><div>          return array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $field_defs = self::$meta_fields[ $tab ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( $tab ) {&nbsp;</div></li><li><div>          case 'non-form':&nbsp;</div></li><li><div>              <span class="comment">// Prevent non-form fields from being passed to forms.</span>&nbsp;</div></li><li><div>              $field_defs = array();&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'general':&nbsp;</div></li><li><div>              $options = WPSEO_Options::get_option( 'wpseo_titles' );&nbsp;</div></li><li><div>              if ( $options['usemetakeywords'] === true ) {&nbsp;</div></li><li><div>                  <span class="comment">/** Adjust the link in the keywords description text string based on the post type */</span>&nbsp;</div></li><li><div>                  $field_defs['metakeywords']['description'] = sprintf( $field_defs['metakeywords']['description'], '&lt;a target=&quot;_blank&quot; href=&quot;' . esc_url( admin_url( 'admin.php?page=wpseo_titles#top#post_types' ) ) . '&quot;&gt;', '&lt;/a&gt;' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  <span class="comment">/** Don't show the keywords field if keywords aren't enabled */</span>&nbsp;</div></li><li><div>                  unset( $field_defs['metakeywords'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Filter the WPSEO metabox form field definitions for the general tab, backward compatibility</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @deprecated 1.5.0</span>&nbsp;</div></li><li><div><span class="comment">               * @deprecated use the 'wpseo_metabox_entries_general' filter instead</span>&nbsp;</div></li><li><div><span class="comment">               * @see        WPSEO_Meta::get_meta_field_defs()</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @param      array $field_defs Metabox orm definitions.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @return     array</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              $field_defs = apply_filters( 'wpseo_metabox_entries', $field_defs );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case 'advanced':&nbsp;</div></li><li><div>              global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $options = WPSEO_Options::get_options( array( 'wpseo', 'wpseo_titles', 'wpseo_internallinks' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! current_user_can( 'manage_options' ) && $options['disableadvanced_meta'] ) {&nbsp;</div></li><li><div>                  return array();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $post_type = '';&nbsp;</div></li><li><div>              if ( isset( $post-&gt;post_type ) ) {&nbsp;</div></li><li><div>                  $post_type = $post-&gt;post_type;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ( ! isset( $post-&gt;post_type ) && isset( $_GET['post_type'] ) ) {&nbsp;</div></li><li><div>                  $post_type = sanitize_text_field( $_GET['post_type'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/** Adjust the no-index 'default for post type' text string based on the post type */</span>&nbsp;</div></li><li><div>              $field_defs['meta-robots-noindex']['options']['0'] = sprintf( $field_defs['meta-robots-noindex']['options']['0'], ( ( isset( $options[ 'noindex-' . $post_type ] ) && $options[ 'noindex-' . $post_type ] === true ) ? 'noindex' : 'index' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/** Adjust the robots advanced 'site-wide default' text string based on those settings */</span>&nbsp;</div></li><li><div>              if ( $options['noodp'] !== false ) {&nbsp;</div></li><li><div>                  $robots_adv = array();&nbsp;</div></li><li><div>                  if ( $options['noodp'] === true ) {&nbsp;</div></li><li><div>                      <span class="comment">// Use translation from field def options - mind that $options and $field_def['options'] keys should be the same!</span>&nbsp;</div></li><li><div>                      $robots_adv[] = $field_defs['meta-robots-adv']['options']['noodp'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $robots_adv = implode( ', ', $robots_adv );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $robots_adv = __( 'None', 'wordpress-seo' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $field_defs['meta-robots-adv']['options']['-'] = sprintf( $field_defs['meta-robots-adv']['options']['-'], $robots_adv );&nbsp;</div></li><li><div>              unset( $robots_adv );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/** Don't show the breadcrumb title field if breadcrumbs aren't enabled */</span>&nbsp;</div></li><li><div>              if ( $options['breadcrumbs-enable'] !== true && ! current_theme_supports( 'yoast-seo-breadcrumbs' ) ) {&nbsp;</div></li><li><div>                  unset( $field_defs['bctitle'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( empty( $post-&gt;ID ) || ( ! empty( $post-&gt;ID ) && self::get_value( 'redirect', $post-&gt;ID ) === '' ) ) {&nbsp;</div></li><li><div>                  unset( $field_defs['redirect'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter the WPSEO metabox form field definitions for a tab</span>&nbsp;</div></li><li><div><span class="comment">       * {tab} can be 'general', 'advanced' or 'social'</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param  array  $field_defs Metabox form definitions.</span>&nbsp;</div></li><li><div><span class="comment">       * @param  string $post_type  Post type of the post the metabox is for, defaults to 'post'.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return apply_filters( 'wpseo_metabox_entries_' . $tab, $field_defs, $post_type );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Validate the post meta values</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  mixed  $meta_value The new value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $meta_key   The full meta key (including prefix).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string             Validated meta value</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function sanitize_post_meta( $meta_value, $meta_key ) {&nbsp;</div></li><li><div>      $field_def = self::$meta_fields[ self::$fields_index[ $meta_key ]['subset'] ][ self::$fields_index[ $meta_key ]['key'] ];&nbsp;</div></li><li><div>      $clean = self::$defaults[ $meta_key ];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      switch ( true ) {&nbsp;</div></li><li><div>          case ( $meta_key === self::$meta_prefix . 'linkdex' ):&nbsp;</div></li><li><div>              $int = WPSEO_Utils::validate_int( $meta_value );&nbsp;</div></li><li><div>              if ( $int !== false && $int &gt;= 0 ) {&nbsp;</div></li><li><div>                  $clean = strval( $int ); <span class="comment">// Convert to string to make sure default check works.</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case ( $field_def['type'] === 'checkbox' ):&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Only allow value if it's one of the predefined options.</span></span>&nbsp;</div></li><li><div>              if ( in_array( $meta_value, array( 'on', 'off' ), true ) ) {&nbsp;</div></li><li><div>                  $clean = $meta_value;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case ( $field_def['type'] === 'select' || $field_def['type'] === 'radio' ):&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Only allow value if it's one of the predefined options.</span></span>&nbsp;</div></li><li><div>              if ( isset( $field_def['options'][ $meta_value ] ) ) {&nbsp;</div></li><li><div>                  $clean = $meta_value;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case ( $field_def['type'] === 'multiselect' && $meta_key === self::$meta_prefix . 'meta-robots-adv' ):&nbsp;</div></li><li><div>              $clean = self::validate_meta_robots_adv( $meta_value );&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case ( $field_def['type'] === 'text' && $meta_key === self::$meta_prefix . 'canonical' ):&nbsp;</div></li><li><div>          case ( $field_def['type'] === 'text' && $meta_key === self::$meta_prefix . 'redirect' ):&nbsp;</div></li><li><div>              <span class="comment">// Validate as url(-part).</span>&nbsp;</div></li><li><div>              $url = WPSEO_Utils::sanitize_url( $meta_value );&nbsp;</div></li><li><div>              if ( $url !== '' ) {&nbsp;</div></li><li><div>                  $clean = $url;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case ( $field_def['type'] === 'upload' && $meta_key === self::$meta_prefix . 'opengraph-image' ):&nbsp;</div></li><li><div>              <span class="comment">// Validate as url.</span>&nbsp;</div></li><li><div>              $url = WPSEO_Utils::sanitize_url( $meta_value, array( 'http', 'https', 'ftp', 'ftps' ) );&nbsp;</div></li><li><div>              if ( $url !== '' ) {&nbsp;</div></li><li><div>                  $clean = $url;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case ( $field_def['type'] === 'textarea' ):&nbsp;</div></li><li><div>              if ( is_string( $meta_value ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// Remove line breaks and tabs.</span>&nbsp;</div></li><li><div>                  <span class="comment">// @todo [JRF =&gt; Yoast] verify that line breaks and the likes aren't allowed/recommended in meta header fields.</span>&nbsp;</div></li><li><div>                  $meta_value = str_replace( array( &quot;\n&quot;, &quot;\r&quot;, &quot;\t&quot;, '  ' ), ' ', $meta_value );&nbsp;</div></li><li><div>                  $clean = WPSEO_Utils::sanitize_text_field( trim( $meta_value ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case ( 'multiselect' === $field_def['type'] ):&nbsp;</div></li><li><div>              $clean = $meta_value;&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          case ( $field_def['type'] === 'text' ):&nbsp;</div></li><li><div>          default:&nbsp;</div></li><li><div>              if ( is_string( $meta_value ) ) {&nbsp;</div></li><li><div>                  $clean = WPSEO_Utils::sanitize_text_field( trim( $meta_value ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $meta_key === self::$meta_prefix . 'focuskw' ) {&nbsp;</div></li><li><div>                  $clean = str_replace( array(&nbsp;</div></li><li><div>                      '&lt;', &nbsp;</div></li><li><div>                      '&gt;', &nbsp;</div></li><li><div>                      '&quot', &nbsp;</div></li><li><div>                      '&#96', &nbsp;</div></li><li><div>                      '&lt;', &nbsp;</div></li><li><div>                      '&gt;', &nbsp;</div></li><li><div>                      '&quot;', &nbsp;</div></li><li><div>                      '`', &nbsp;</div></li><li><div> ), '', $clean );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              break;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $clean = apply_filters( 'wpseo_sanitize_post_meta_' . $meta_key, $clean, $meta_value, $field_def, $meta_key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $clean;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Validate a meta-robots-adv meta value</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @todo [JRF =&gt; Yoast] Verify that this logic for the prioritisation is correct</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  array|string $meta_value The value to validate.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string       Clean value</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function validate_meta_robots_adv( $meta_value ) {&nbsp;</div></li><li><div>      $clean = self::$meta_fields['advanced']['meta-robots-adv']['default_value'];&nbsp;</div></li><li><div>      $options = self::$meta_fields['advanced']['meta-robots-adv']['options'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $meta_value ) ) {&nbsp;</div></li><li><div>          $meta_value = explode( ', ', $meta_value );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $meta_value ) && $meta_value !== array() ) {&nbsp;</div></li><li><div>          $meta_value = array_map( 'trim', $meta_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( in_array( 'none', $meta_value, true ) ) {&nbsp;</div></li><li><div>              <span class="comment">// None is one of the selected values, takes priority over everything else.</span>&nbsp;</div></li><li><div>              $clean = 'none';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( in_array( '-', $meta_value, true ) ) {&nbsp;</div></li><li><div>              <span class="comment">// Site-wide defaults is one of the selected values, takes priority over individual selected entries.</span>&nbsp;</div></li><li><div>              $clean = '-';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              <span class="comment">// Individual selected entries.</span>&nbsp;</div></li><li><div>              $cleaning = array();&nbsp;</div></li><li><div>              foreach ( $meta_value as $value ) {&nbsp;</div></li><li><div>                  if ( isset( $options[ $value ] ) ) {&nbsp;</div></li><li><div>                      $cleaning[] = $value;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $cleaning !== array() ) {&nbsp;</div></li><li><div>                  $clean = implode( ', ', $cleaning );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              unset( $cleaning, $value );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $clean;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Prevent saving of default values and remove potential old value from the database if replaced by a default</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  null   $null       Old, disregard.</span>&nbsp;</div></li><li><div><span class="comment">   * @param  int    $object_id  ID of the current object for which the meta is being updated.</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $meta_key   The full meta key (including prefix).</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $meta_value New meta value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $prev_value The old meta value.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return null|bool          true = stop saving, null = continue saving</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function remove_meta_if_default( $null, $object_id, $meta_key, $meta_value, $prev_value = '' ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">/** If it's one of our meta fields, check against default */</span></span>&nbsp;</div></li><li><div>      if ( isset( self::$fields_index[ $meta_key ] ) && self::meta_value_is_default( $meta_key, $meta_value ) === true ) {&nbsp;</div></li><li><div>          if ( $prev_value !== '' ) {&nbsp;</div></li><li><div>              delete_post_meta( $object_id, $meta_key, $prev_value );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              delete_post_meta( $object_id, $meta_key );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return true; <span class="comment"><span class="comment">// Stop saving the value.</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return null; <span class="comment">// Go on with the normal execution (update) in meta.php.</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Prevent adding of default values to the database</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  null   $null       Old, disregard.</span>&nbsp;</div></li><li><div><span class="comment">   * @param  int    $object_id  ID of the current object for which the meta is being added.</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $meta_key   The full meta key (including prefix).</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $meta_value New meta value.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return null|bool          true = stop saving, null = continue saving</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function dont_save_meta_if_default( $null, $object_id, $meta_key, $meta_value ) {&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">/** If it's one of our meta fields, check against default */</span></span>&nbsp;</div></li><li><div>      if ( isset( self::$fields_index[ $meta_key ] ) && self::meta_value_is_default( $meta_key, $meta_value ) === true ) {&nbsp;</div></li><li><div>          return true; <span class="comment"><span class="comment">// Stop saving the value.</span></span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return null; <span class="comment">// Go on with the normal execution (add) in meta.php.</span>&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Is the given meta value the same as the default value ?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $meta_key   The full meta key (including prefix).</span>&nbsp;</div></li><li><div><span class="comment">   * @param  mixed  $meta_value The value to check.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function meta_value_is_default( $meta_key, $meta_value ) {&nbsp;</div></li><li><div>      return ( isset( self::$defaults[ $meta_key ] ) && $meta_value === self::$defaults[ $meta_key ] );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a custom post meta value</span>&nbsp;</div></li><li><div><span class="comment">   * Returns the default value if the meta value has not been set</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @internal Unfortunately there isn't a filter available to hook into before returning the results</span>&nbsp;</div></li><li><div><span class="comment">   * for get_post_meta(), get_post_custom() and the likes. That would have been the preferred solution.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $key    Internal key of the value to get (without prefix).</span>&nbsp;</div></li><li><div><span class="comment">   * @param  int    $postid Post ID of the post to get the value for.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string         All 'normal' values returned from get_post_meta() are strings.</span>&nbsp;</div></li><li><div><span class="comment">   *                        Objects and arrays are possible, but not used by this plugin</span>&nbsp;</div></li><li><div><span class="comment">   *                        and therefore discarted (except when the special 'serialized' field def</span>&nbsp;</div></li><li><div><span class="comment">   *                        value is set to true - only used by add-on plugins for now).</span>&nbsp;</div></li><li><div><span class="comment">   *                        Will return the default value if no value was found..</span>&nbsp;</div></li><li><div><span class="comment">   *                        Will return empty string if no default was found (not one of our keys) or</span>&nbsp;</div></li><li><div><span class="comment">   *                        if the post does not exist.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_value( $key, $postid = 0 ) {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $postid = absint( $postid );&nbsp;</div></li><li><div>      if ( $postid === 0 ) {&nbsp;</div></li><li><div>          if ( ( isset( $post ) && is_object( $post ) ) && ( isset( $post-&gt;post_status ) && $post-&gt;post_status !== 'auto-draft' ) ) {&nbsp;</div></li><li><div>              $postid = $post-&gt;ID;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              return '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $custom = get_post_custom( $postid ); <span class="comment">// Array of strings or empty array.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $custom[ self::$meta_prefix . $key ][0] ) ) {&nbsp;</div></li><li><div>          $unserialized = maybe_unserialize( $custom[ self::$meta_prefix . $key ][0] );&nbsp;</div></li><li><div>          if ( $custom[ self::$meta_prefix . $key ][0] === $unserialized ) {&nbsp;</div></li><li><div>              return $custom[ self::$meta_prefix . $key ][0];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $field_def = self::$meta_fields[ self::$fields_index[ self::$meta_prefix . $key ]['subset'] ][ self::$fields_index[ self::$meta_prefix . $key ]['key'] ];&nbsp;</div></li><li><div>              if ( isset( $field_def['serialized'] ) && $field_def['serialized'] === true ) {&nbsp;</div></li><li><div>                  <span class="comment">// Ok, serialize value expected/allowed.</span>&nbsp;</div></li><li><div>                  return $unserialized;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Meta was either not found or found, but object/array while not allowed to be.</span>&nbsp;</div></li><li><div>      if ( isset( self::$defaults[ self::$meta_prefix . $key ] ) ) {&nbsp;</div></li><li><div>          return self::$defaults[ self::$meta_prefix . $key ];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">          Shouldn't ever happen, means not one of our keys as there will always be a default available</span>&nbsp;</div></li><li><div><span class="comment">             for all our keys</span>&nbsp;</div></li><li><div><span class="comment">          */</span>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Update a meta value for a post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $key        The internal key of the meta value to change (without prefix).</span>&nbsp;</div></li><li><div><span class="comment">   * @param  mixed  $meta_value The value to set the meta to.</span>&nbsp;</div></li><li><div><span class="comment">   * @param  int    $post_id    The ID of the post to change the meta for.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool   whether the value was changed</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function set_value( $key, $meta_value, $post_id ) {&nbsp;</div></li><li><div>      return update_post_meta( $post_id, self::$meta_prefix . $key, $meta_value );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Deletes a meta value for a post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $key The internal key of the meta value to change (without prefix).</span>&nbsp;</div></li><li><div><span class="comment">   * @param int    $post_id The ID of the post to change the meta for.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool Whether the value was changed</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function delete( $key, $post_id ) {&nbsp;</div></li><li><div>      return delete_post_meta( $post_id, self::$meta_prefix . $key );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Used for imports, this functions imports the value of $old_metakey into $new_metakey for those post</span>&nbsp;</div></li><li><div><span class="comment">   * where no WPSEO meta data has been set.</span>&nbsp;</div></li><li><div><span class="comment">   * Optionally deletes the $old_metakey values.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $old_metakey The old key of the meta value.</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $new_metakey The new key, usually the WPSEO meta key (including prefix).</span>&nbsp;</div></li><li><div><span class="comment">   * @param  bool   $delete_old  Whether to delete the old meta key/value-sets.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function replace_meta( $old_metakey, $new_metakey, $delete_old = false ) {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">      Get only those rows where no wpseo meta values exist for the same post</span>&nbsp;</div></li><li><div><span class="comment">         (with the exception of linkdex as that will be set independently of whether the post has been edited)</span>&nbsp;</div></li><li><div><span class="comment">         @internal Query is pretty well optimized this way</span>&nbsp;</div></li><li><div><span class="comment">      */</span>&nbsp;</div></li><li><div>      $query = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>          &quot;&nbsp;</div></li><li><div>              SELECT `a`.*&nbsp;</div></li><li><div>              FROM {$wpdb-&gt;postmeta} AS a&nbsp;</div></li><li><div>              WHERE `a`.`meta_key` = %s&nbsp;</div></li><li><div>                  AND NOT    EXISTS (&nbsp;</div></li><li><div>                      SELECT DISTINCT `post_id` , count( `meta_id` ) AS count&nbsp;</div></li><li><div>                      FROM {$wpdb-&gt;postmeta} AS b&nbsp;</div></li><li><div>                      WHERE `a`.`post_id` = `b`.`post_id`&nbsp;</div></li><li><div>                          AND `meta_key` LIKE %s&nbsp;</div></li><li><div>                          AND `meta_key` &lt;&gt; %s&nbsp;</div></li><li><div>                      GROUP BY `post_id`&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>              ;&quot;, &nbsp;</div></li><li><div>          $old_metakey, &nbsp;</div></li><li><div>          $wpdb-&gt;esc_like( self::$meta_prefix . '%' ), &nbsp;</div></li><li><div>          self::$meta_prefix . 'linkdex'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $oldies = $wpdb-&gt;get_results( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $oldies ) && $oldies !== array() ) {&nbsp;</div></li><li><div>          foreach ( $oldies as $old ) {&nbsp;</div></li><li><div>              update_post_meta( $old-&gt;post_id, $new_metakey, $old-&gt;meta_value );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Delete old keys.</span></span>&nbsp;</div></li><li><div>      if ( $delete_old === true ) {&nbsp;</div></li><li><div>          delete_post_meta_by_key( $old_metakey );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * General clean-up of the saved meta values</span>&nbsp;</div></li><li><div><span class="comment">   * - Remove potentially lingering old meta keys</span>&nbsp;</div></li><li><div><span class="comment">   * - Remove all default and invalid values</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function clean_up() {&nbsp;</div></li><li><div>      global $wpdb;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Clean up '_yoast_wpseo_meta-robots'</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve all '_yoast_wpseo_meta-robots' meta values and convert if no new values found</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @internal Query is pretty well optimized this way</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @todo [JRF =&gt; Yoast] find out all possible values which the old '_yoast_wpseo_meta-robots' could contain</span>&nbsp;</div></li><li><div><span class="comment">       * to convert the data correctly</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $query = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>          &quot;&nbsp;</div></li><li><div>              SELECT `a`.*&nbsp;</div></li><li><div>              FROM {$wpdb-&gt;postmeta} AS a&nbsp;</div></li><li><div>              WHERE `a`.`meta_key` = %s&nbsp;</div></li><li><div>                  AND NOT    EXISTS (&nbsp;</div></li><li><div>                      SELECT DISTINCT `post_id` , count( `meta_id` ) AS count&nbsp;</div></li><li><div>                      FROM {$wpdb-&gt;postmeta} AS b&nbsp;</div></li><li><div>                      WHERE `a`.`post_id` = `b`.`post_id`&nbsp;</div></li><li><div>                          AND ( `meta_key` = %s&nbsp;</div></li><li><div>                          OR `meta_key` = %s )&nbsp;</div></li><li><div>                      GROUP BY `post_id`&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>              ;&quot;, &nbsp;</div></li><li><div>          self::$meta_prefix . 'meta-robots', &nbsp;</div></li><li><div>          self::$meta_prefix . 'meta-robots-noindex', &nbsp;</div></li><li><div>          self::$meta_prefix . 'meta-robots-nofollow'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $oldies = $wpdb-&gt;get_results( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $oldies ) && $oldies !== array() ) {&nbsp;</div></li><li><div>          foreach ( $oldies as $old ) {&nbsp;</div></li><li><div>              $old_values = explode( ', ', $old-&gt;meta_value );&nbsp;</div></li><li><div>              foreach ( $old_values as $value ) {&nbsp;</div></li><li><div>                  if ( $value === 'noindex' ) {&nbsp;</div></li><li><div>                      update_post_meta( $old-&gt;post_id, self::$meta_prefix . 'meta-robots-noindex', 1 );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  elseif ( $value === 'nofollow' ) {&nbsp;</div></li><li><div>                      update_post_meta( $old-&gt;post_id, self::$meta_prefix . 'meta-robots-nofollow', 1 );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $query, $oldies, $old, $old_values, $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">// Delete old keys.</span></span>&nbsp;</div></li><li><div>      delete_post_meta_by_key( self::$meta_prefix . 'meta-robots' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Remove all default values and (most) invalid option values</span>&nbsp;</div></li><li><div><span class="comment">       * Invalid option values for the multiselect (meta-robots-adv) field will be dealt with seperately</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @internal some of the defaults have changed in v1.5, but as the defaults will be removed and</span>&nbsp;</div></li><li><div><span class="comment">       * new defaults will now automatically be passed when no data found, this update is automatic</span>&nbsp;</div></li><li><div><span class="comment">       * (as long as we remove the old values which we do in the below routine)</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @internal unfortunately we can't use the normal delete_meta() with key/value combination as ''</span>&nbsp;</div></li><li><div><span class="comment">       * (empty string) values will be ignored and would result in all metas with that key being deleted, </span>&nbsp;</div></li><li><div><span class="comment">       * not just the empty fields.</span>&nbsp;</div></li><li><div><span class="comment">       * Still, the below implementation is largely based on the delete_meta() function</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $query = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( self::$meta_fields as $subset =&gt; $field_group ) {&nbsp;</div></li><li><div>          foreach ( $field_group as $key =&gt; $field_def ) {&nbsp;</div></li><li><div>              if ( $field_def['type'] === 'snippetpreview' || ! isset( $field_def['default_value'] ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $key === 'meta-robots-adv' ) {&nbsp;</div></li><li><div>                  $query[] = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                      &quot;( meta_key = %s AND ( meta_value = 'none' OR meta_value = '-' ) )&quot;, &nbsp;</div></li><li><div>                      self::$meta_prefix . $key&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ( isset( $field_def['options'] ) && is_array( $field_def['options'] ) && $field_def['options'] !== array() ) {&nbsp;</div></li><li><div>                  $valid = $field_def['options'];&nbsp;</div></li><li><div>                  <span class="comment">// Remove the default value from the valid options.</span>&nbsp;</div></li><li><div>                  unset( $valid[ $field_def['default_value'] ] );&nbsp;</div></li><li><div>                  $valid = array_keys( $valid );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $query[] = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                      &quot;( meta_key = %s AND meta_value NOT IN ( '&quot; . implode( &quot;', '&quot;, esc_sql( $valid ) ) . &quot;' ) )&quot;, &nbsp;</div></li><li><div>                      self::$meta_prefix . $key&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                  unset( $valid );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ( is_string( $field_def['default_value'] ) && $field_def['default_value'] !== '' ) {&nbsp;</div></li><li><div>                  $query[] = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                      '( meta_key = %s AND meta_value = %s )', &nbsp;</div></li><li><div>                      self::$meta_prefix . $key, &nbsp;</div></li><li><div>                      $field_def['default_value']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $query[] = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                      &quot;( meta_key = %s AND meta_value = '' )&quot;, &nbsp;</div></li><li><div>                      self::$meta_prefix . $key&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $subset, $field_group, $key, $field_def );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $query = &quot;SELECT meta_id FROM {$wpdb-&gt;postmeta} WHERE &quot; . implode( ' OR ', $query ) . ';';&nbsp;</div></li><li><div>      $meta_ids = $wpdb-&gt;get_col( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $meta_ids ) && $meta_ids !== array() ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// WP native action.</span></span>&nbsp;</div></li><li><div>          do_action( 'delete_post_meta', $meta_ids, null, null, null );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $query = &quot;DELETE FROM {$wpdb-&gt;postmeta} WHERE meta_id IN( &quot; . implode( ', ', $meta_ids ) . ' )';&nbsp;</div></li><li><div>          $count = $wpdb-&gt;query( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $count ) {&nbsp;</div></li><li><div>              foreach ( $meta_ids as $object_id ) {&nbsp;</div></li><li><div>                  wp_cache_delete( $object_id, 'post_meta' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// WP native action.</span></span>&nbsp;</div></li><li><div>              do_action( 'deleted_post_meta', $meta_ids, null, null, null );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $query, $meta_ids, $count, $object_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Deal with the multiselect (meta-robots-adv) field</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Removes invalid option combinations, such as 'none, noarchive'</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Default values have already been removed, so we should have a small result set and</span>&nbsp;</div></li><li><div><span class="comment">       * (hopefully) even smaller set of invalid results.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $query = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>          &quot;SELECT meta_id, meta_value FROM {$wpdb-&gt;postmeta} WHERE meta_key = %s&quot;, &nbsp;</div></li><li><div>          self::$meta_prefix . 'meta-robots-adv'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      $oldies = $wpdb-&gt;get_results( $query );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_array( $oldies ) && $oldies !== array() ) {&nbsp;</div></li><li><div>          foreach ( $oldies as $old ) {&nbsp;</div></li><li><div>              $clean = self::validate_meta_robots_adv( $old-&gt;meta_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $clean !== $old-&gt;meta_value ) {&nbsp;</div></li><li><div>                  if ( $clean !== self::$meta_fields['advanced']['meta-robots-adv']['default_value'] ) {&nbsp;</div></li><li><div>                      update_metadata_by_mid( 'post', $old-&gt;meta_id, $clean );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      delete_metadata_by_mid( 'post', $old-&gt;meta_id );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $query, $oldies, $old, $clean );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      do_action( 'wpseo_meta_clean_up' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Recursively merge a variable number of arrays, using the left array as base, </span>&nbsp;</div></li><li><div><span class="comment">   * giving priority to the right array.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Difference with native array_merge_recursive():</span>&nbsp;</div></li><li><div><span class="comment">   * array_merge_recursive converts values with duplicate keys to arrays rather than</span>&nbsp;</div></li><li><div><span class="comment">   * overwriting the value in the first array with the duplicate value in the second array.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * array_merge_recursive_distinct does not change the data types of the values in the arrays.</span>&nbsp;</div></li><li><div><span class="comment">   * Matching keys' values in the second array overwrite those in the first array, as is the</span>&nbsp;</div></li><li><div><span class="comment">   * case with array_merge.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Freely based on information found on http://www.php.net/manual/en/function.array-merge-recursive.php</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @internal Should be moved to a general utility class</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function array_merge_recursive_distinct() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $arrays = func_get_args();&nbsp;</div></li><li><div>      if ( count( $arrays ) &lt; 2 ) {&nbsp;</div></li><li><div>          if ( $arrays === array() ) {&nbsp;</div></li><li><div>              return array();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              return $arrays[0];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $merged = array_shift( $arrays );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $arrays as $array ) {&nbsp;</div></li><li><div>          foreach ( $array as $key =&gt; $value ) {&nbsp;</div></li><li><div>              if ( is_array( $value ) && ( isset( $merged[ $key ] ) && is_array( $merged[ $key ] ) ) ) {&nbsp;</div></li><li><div>                  $merged[ $key ] = self::array_merge_recursive_distinct( $merged[ $key ], $value );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $merged[ $key ] = $value;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset( $key, $value );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $merged;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get a value from $_POST for a given key</span>&nbsp;</div></li><li><div><span class="comment">   * Returns the $_POST value if exists, returns an empty string if key does not exist</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @static</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param  string $key Key of the value to get from $_POST.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string      Returns $_POST value, which will be a string the majority of the time</span>&nbsp;</div></li><li><div><span class="comment">   *                     Will return empty string if key does not exists in $_POST</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_post_value( $key ) {&nbsp;</div></li><li><div>      return ( array_key_exists( $key, $_POST ) ) ? $_POST[ $key ] : '';&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Counts the total of all the keywords being used for posts except the given one</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string  $keyword The keyword to be counted.</span>&nbsp;</div></li><li><div><span class="comment">   * @param integer $post_id The is of the post to which the keyword belongs.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function keyword_usage( $keyword, $post_id ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $keyword ) ) {&nbsp;</div></li><li><div>          return array();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $get_posts = new WP_Query(&nbsp;</div></li><li><div>          array(&nbsp;</div></li><li><div>              'meta_key' =&gt; '_yoast_wpseo_focuskw', &nbsp;</div></li><li><div>              'meta_value' =&gt; $keyword, &nbsp;</div></li><li><div>              'post__not_in' =&gt; array( $post_id ), &nbsp;</div></li><li><div>              'fields' =&gt; 'ids', &nbsp;</div></li><li><div>              'post_type' =&gt; 'any', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * We only need to return zero, one or two results:</span>&nbsp;</div></li><li><div><span class="comment">               * - Zero: keyword hasn't been used before</span>&nbsp;</div></li><li><div><span class="comment">               * - One: Keyword has been used once before</span>&nbsp;</div></li><li><div><span class="comment">               * - Two or more: Keyword has been used twice before</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              'posts_per_page' =&gt; 2, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $get_posts-&gt;posts;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>} <span class="comment">/** End of class */</span>&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Yoast SEO</li><li><span></span>4.7.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>