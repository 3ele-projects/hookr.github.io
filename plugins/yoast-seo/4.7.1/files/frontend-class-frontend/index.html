<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="4.7.1" data-slug="yoast-seo" data-type="file" data-id="10439"><head xmlns="http://www.w3.org/1999/xhtml"><title> frontend-class-frontend | file | Yoast Seo | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, yoast-seo, 4.7.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=4d9cf295b32fced94032b2bb6d42a932' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/frontend-class-frontend/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Ffrontend-class-frontend%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Ffrontend-class-frontend%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-yoast-seo-4.7.1-file-frontend-class-frontend","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="frontend-class-frontend" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to yoast-seo." href="http://hookr.io/plugins/yoast-seo/" class="plugin"><span property="name">yoast-seo</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.7.1." href="http://hookr.io/plugins/yoast-seo/4.7.1/" class="H_VERSION"><span property="name">4.7.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/yoast-seo/4.7.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">frontend-class-frontend</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="558"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/all/" title="All">All <span class="count badge">558</span></a></li><li class="" data-id="new" data-count="3"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/new/" title="New">New <span class="count badge">3</span></a></li><li class="" data-id="hooks" data-count="187"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/hooks/" title="Hooks">Hooks <span class="count badge">187</span></a></li><li class="" data-id="action" data-count="44"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/actions/" title="Actions">Actions <span class="count badge">44</span></a></li><li class="" data-id="filter" data-count="143"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/filters/" title="Filters">Filters <span class="count badge">143</span></a></li><li class="" data-id="class" data-count="256"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/classes/" title="Classes">Classes <span class="count badge">256</span></a></li><li class="" data-id="constant" data-count="10"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/constants/" title="Constants">Constants <span class="count badge">10</span></a></li><li class="" data-id="function" data-count="103"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/functions/" title="Functions">Functions <span class="count badge">103</span></a></li><li class="" data-id="shortcode" data-count="2"><a href="http://hookr.io/plugins/yoast-seo/4.7.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">2</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/frontend/class-frontend.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * @package WPSEO\Frontend</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Main frontend class for Yoast SEO, responsible for the SEO output as well as removing</span>&nbsp;</div></li><li><div><span class="comment"> * default WordPress output.</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>class WPSEO_Frontend {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var    object    Instance of this class.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static $instance;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var array Holds the plugins options.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public $options = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var boolean Boolean indicating wether output buffering has been started.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $ob_started = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Holds the canonical URL for the current page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $canonical = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Holds the canonical URL for the current page that cannot be overriden by a manual canonical input.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $canonical_no_override = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Holds the canonical URL for the current page without pagination.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $canonical_unpaged = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Holds the pages meta description.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $metadesc = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Holds the generated title for the page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $title = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Holds the names of the required options.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $required_options = array( 'wpseo', 'wpseo_rss', 'wpseo_social', 'wpseo_permalinks', 'wpseo_titles' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * @var array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private $hooks;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Class constructor</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Adds and removes a lot of filters.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function __construct() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;options = WPSEO_Options::get_options( $this-&gt;required_options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action( 'wp_head', array( $this, 'front_page_specific_init' ), 0 );&nbsp;</div></li><li><div>      add_action( 'wp_head', array( $this, 'head' ), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// The head function here calls action wpseo_head, to which we hook all our functionality.</span>&nbsp;</div></li><li><div>      add_action( 'wpseo_head', array( $this, 'debug_mark' ), 2 );&nbsp;</div></li><li><div>      add_action( 'wpseo_head', array( $this, 'metadesc' ), 6 );&nbsp;</div></li><li><div>      add_action( 'wpseo_head', array( $this, 'robots' ), 10 );&nbsp;</div></li><li><div>      add_action( 'wpseo_head', array( $this, 'metakeywords' ), 11 );&nbsp;</div></li><li><div>      add_action( 'wpseo_head', array( $this, 'canonical' ), 20 );&nbsp;</div></li><li><div>      add_action( 'wpseo_head', array( $this, 'adjacent_rel_links' ), 21 );&nbsp;</div></li><li><div>      add_action( 'wpseo_head', array( $this, 'publisher' ), 22 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Remove actions that we will handle through our wpseo_head call, and probably change the output of.</span>&nbsp;</div></li><li><div>      remove_action( 'wp_head', 'rel_canonical' );&nbsp;</div></li><li><div>      remove_action( 'wp_head', 'index_rel_link' );&nbsp;</div></li><li><div>      remove_action( 'wp_head', 'start_post_rel_link' );&nbsp;</div></li><li><div>      remove_action( 'wp_head', 'adjacent_posts_rel_link_wp_head' );&nbsp;</div></li><li><div>      remove_action( 'wp_head', 'noindex', 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// When using WP 4.4, just use the new hook.</span>&nbsp;</div></li><li><div>      add_filter( 'pre_get_document_title', array( $this, 'title' ), 15 );&nbsp;</div></li><li><div>      add_filter( 'wp_title', array( $this, 'title' ), 15, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( 'thematic_doctitle', array( $this, 'title' ), 15 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action( 'wp', array( $this, 'page_redirect' ), 99 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_action( 'template_redirect', array( $this, 'noindex_feed' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      add_filter( 'loginout', array( $this, 'nofollow_link' ) );&nbsp;</div></li><li><div>      add_filter( 'register', array( $this, 'nofollow_link' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Fix the WooThemes woo_title() output.</span>&nbsp;</div></li><li><div>      add_filter( 'woo_title', array( $this, 'fix_woo_title' ), 99 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;options['disable-date'] === true ||&nbsp;</div></li><li><div>           $this-&gt;options['disable-author'] === true ||&nbsp;</div></li><li><div>           $this-&gt;options['disable-post_format'] === true&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>          add_action( 'wp', array( $this, 'archive_redirect' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( $this-&gt;options['redirectattachment'] === true ) {&nbsp;</div></li><li><div>          add_action( 'template_redirect', array( $this, 'attachment_redirect' ), 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * The setting to get here has been deprecated, but don't remove the code as that would break</span>&nbsp;</div></li><li><div><span class="comment">       * the functionality for those that still have it!</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( $this-&gt;options['trailingslash'] === true ) {&nbsp;</div></li><li><div>          add_filter( 'user_trailingslashit', array( $this, 'add_trailingslash' ), 10, 2 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( $this-&gt;options['cleanpermalinks'] === true ) {&nbsp;</div></li><li><div>          add_action( 'template_redirect', array( $this, 'clean_permalink' ), 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( $this-&gt;options['cleanreplytocom'] === true ) {&nbsp;</div></li><li><div>          add_filter( 'comment_reply_link', array( $this, 'remove_reply_to_com' ) );&nbsp;</div></li><li><div>          add_action( 'template_redirect', array( $this, 'replytocom_redirect' ), 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      add_filter( 'the_content_feed', array( $this, 'embed_rssfooter' ) );&nbsp;</div></li><li><div>      add_filter( 'the_excerpt_rss', array( $this, 'embed_rssfooter_excerpt' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// For WordPress functions below 4.4.</span>&nbsp;</div></li><li><div>      if ( ! current_theme_supports( 'title-tag' ) && $this-&gt;options['forcerewritetitle'] === true ) {&nbsp;</div></li><li><div>          add_action( 'template_redirect', array( $this, 'force_rewrite_output_buffer' ), 99999 );&nbsp;</div></li><li><div>          add_action( 'wp_footer', array( $this, 'flush_cache' ), - 1 );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;options['title_test'] &gt; 0 ) {&nbsp;</div></li><li><div>          add_filter( 'wpseo_title', array( $this, 'title_test_helper' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $primary_category = new WPSEO_Frontend_Primary_Category();&nbsp;</div></li><li><div>      $primary_category-&gt;register_hooks();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;hooks = array( $primary_category );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Initialize the functions that only need to run on the frontpage</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function front_page_specific_init() {&nbsp;</div></li><li><div>      if ( ! is_front_page() ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      new WPSEO_JSON_LD;&nbsp;</div></li><li><div>      add_action( 'wpseo_head', array( $this, 'webmaster_tools_authentication' ), 90 );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Resets the entire class so canonicals, titles etc can be regenerated.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function reset() {&nbsp;</div></li><li><div>      foreach ( get_class_vars( __CLASS__ ) as $name =&gt; $default ) {&nbsp;</div></li><li><div>          if ( $name == 'instance' ) {&nbsp;</div></li><li><div>              self::$instance = null;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $this-&gt;$name = $default;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $this-&gt;options = WPSEO_Options::get_options( $this-&gt;required_options );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the singleton instance of this class</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return WPSEO_Frontend</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public static function get_instance() {&nbsp;</div></li><li><div>      if ( ! ( self::$instance instanceof self ) ) {&nbsp;</div></li><li><div>          self::$instance = new self();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return self::$instance;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Override Woo's title with our own.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $title Title string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function fix_woo_title( $title ) {&nbsp;</div></li><li><div>      return $this-&gt;title( $title );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determine whether this is the homepage and shows posts.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_home_posts_page() {&nbsp;</div></li><li><div>      return ( is_home() && 'posts' == get_option( 'show_on_front' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determine whether the this is the static frontpage.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_home_static_page() {&nbsp;</div></li><li><div>      return ( is_front_page() && 'page' == get_option( 'show_on_front' ) && is_page( get_option( 'page_on_front' ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determine whether this is the posts page, when it's not the frontpage.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function is_posts_page() {&nbsp;</div></li><li><div>      return ( is_home() && 'page' == get_option( 'show_on_front' ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Used for static home and posts pages as well as singular titles.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param object|null $object If filled, object to get the title for.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_content_title( $object = null ) {&nbsp;</div></li><li><div>      if ( is_null( $object ) ) {&nbsp;</div></li><li><div>          $object = $GLOBALS['wp_query']-&gt;get_queried_object();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_object( $object ) ) {&nbsp;</div></li><li><div>          $title = WPSEO_Meta::get_value( 'title', $object-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $title !== '' ) {&nbsp;</div></li><li><div>              return wpseo_replace_vars( $title, $object );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $post_type = ( isset( $object-&gt;post_type ) ? $object-&gt;post_type : $object-&gt;query_var );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;get_title_from_options( 'title-' . $post_type, $object );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;get_title_from_options( 'title-404-wpseo' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Used for category, tag, and tax titles.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_taxonomy_title() {&nbsp;</div></li><li><div>      $object = $GLOBALS['wp_query']-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $title = WPSEO_Taxonomy_Meta::get_term_meta( $object, $object-&gt;taxonomy, 'title' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $title ) && $title !== '' ) {&nbsp;</div></li><li><div>          return wpseo_replace_vars( $title, $object );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          return $this-&gt;get_title_from_options( 'title-tax-' . $object-&gt;taxonomy, $object );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Used for author titles.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_author_title() {&nbsp;</div></li><li><div>      $author_id = get_query_var( 'author' );&nbsp;</div></li><li><div>      $title = trim( get_the_author_meta( 'wpseo_title', $author_id ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $title !== '' ) {&nbsp;</div></li><li><div>          return wpseo_replace_vars( $title, array() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;get_title_from_options( 'title-author-wpseo' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Simple function to use to pull data from $options.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * All titles pulled from options will be run through the wpseo_replace_vars function.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string       $index      name of the page to get the title from the settings for.</span>&nbsp;</div></li><li><div><span class="comment">   * @param object|array $var_source possible object to pull variables from.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_title_from_options( $index, $var_source = array() ) {&nbsp;</div></li><li><div>      if ( ! isset( $this-&gt;options[ $index ] ) || $this-&gt;options[ $index ] === '' ) {&nbsp;</div></li><li><div>          if ( is_singular() ) {&nbsp;</div></li><li><div>              return wpseo_replace_vars( '%%title%% %%sep%% %%sitename%%', $var_source );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              return '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          return wpseo_replace_vars( $this-&gt;options[ $index ], $var_source );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the default title for the current page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This is the fallback title generator used when a title hasn't been set for the specific content, taxonomy, author</span>&nbsp;</div></li><li><div><span class="comment">   * details, or in the options. It scrubs off any present prefix before or after the title (based on $seplocation) in</span>&nbsp;</div></li><li><div><span class="comment">   * order to prevent duplicate seperations from appearing in the title (this happens when a prefix is supplied to the</span>&nbsp;</div></li><li><div><span class="comment">   * wp_title call on singular pages).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $sep         The separator used between variables.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $seplocation Whether the separator should be left or right.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $title       Possible title that's already set.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function get_default_title( $sep, $seplocation, $title = '' ) {&nbsp;</div></li><li><div>      if ( 'right' == $seplocation ) {&nbsp;</div></li><li><div>          $regex = '`\s*' . preg_quote( trim( $sep ), '`' ) . '\s*`u';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $regex = '`^\s*' . preg_quote( trim( $sep ), '`' ) . '\s*`u';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $title = preg_replace( $regex, '', $title );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_string( $title ) || ( is_string( $title ) && $title === '' ) ) {&nbsp;</div></li><li><div>          $title = get_bloginfo( 'name' );&nbsp;</div></li><li><div>          $title = $this-&gt;add_paging_to_title( $sep, $seplocation, $title );&nbsp;</div></li><li><div>          $title = $this-&gt;add_to_title( $sep, $seplocation, $title, strip_tags( get_bloginfo( 'description' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $title;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $title = $this-&gt;add_paging_to_title( $sep, $seplocation, $title );&nbsp;</div></li><li><div>      $title = $this-&gt;add_to_title( $sep, $seplocation, $title, strip_tags( get_bloginfo( 'name' ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $title;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This function adds paging details to the title.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $sep         Separator used in the title.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $seplocation Whether the separator should be left or right.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $title       The title to append the paging info to.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_paging_to_title( $sep, $seplocation, $title ) {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $wp_query-&gt;query_vars['paged'] ) && $wp_query-&gt;query_vars['paged'] &gt; 1 ) {&nbsp;</div></li><li><div>          return $this-&gt;add_to_title( $sep, $seplocation, $title, $wp_query-&gt;query_vars['paged'] . '/' . $wp_query-&gt;max_num_pages );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $title;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Add part to title, while ensuring that the $seplocation variable is respected.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $sep         Separator used in the title.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $seplocation Whether the separator should be left or right.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $title       The title to append the title_part to.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $title_part  The part to append to the title.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function add_to_title( $sep, $seplocation, $title, $title_part ) {&nbsp;</div></li><li><div>      if ( 'right' === $seplocation ) {&nbsp;</div></li><li><div>          return $title . $sep . $title_part;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $title_part . $sep . $title;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Main title function.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $title              Title that might have already been set.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $separator          Separator determined in theme (unused).</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $separator_location Whether the separator should be left or right.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function title( $title, $separator = '', $separator_location = '' ) {&nbsp;</div></li><li><div>      if ( is_null( $this-&gt;title ) ) {&nbsp;</div></li><li><div>          $this-&gt;title = $this-&gt;generate_title( $title, $separator_location );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $this-&gt;title;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Main title generation function.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $title              Title that might have already been set.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $separator_location Whether the separator should be left or right.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function generate_title( $title, $separator_location ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_feed() ) {&nbsp;</div></li><li><div>          return $title;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $separator = wpseo_replace_vars( '%%sep%%', array() );&nbsp;</div></li><li><div>      $separator = ' ' . trim( $separator ) . ' ';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( '' === trim( $separator_location ) ) {&nbsp;</div></li><li><div>          $separator_location = ( is_rtl() ) ? 'left' : 'right';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// This needs to be kept track of in order to generate</span>&nbsp;</div></li><li><div>      <span class="comment">// default titles for singular pages.</span>&nbsp;</div></li><li><div>      $original_title = $title;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// This flag is used to determine if any additional</span>&nbsp;</div></li><li><div>      <span class="comment">// processing should be done to the title after the</span>&nbsp;</div></li><li><div>      <span class="comment">// main section of title generation completes.</span>&nbsp;</div></li><li><div>      $modified_title = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// This variable holds the page-specific title part</span>&nbsp;</div></li><li><div>      <span class="comment">// that is used to generate default titles.</span>&nbsp;</div></li><li><div>      $title_part = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;is_home_static_page() ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_content_title();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( $this-&gt;is_home_posts_page() ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_title_from_options( 'title-home-wpseo' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( $this-&gt;is_posts_page() ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_content_title( get_post( get_option( 'page_for_posts' ) ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_singular() ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_content_title();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_string( $title ) || '' === $title ) {&nbsp;</div></li><li><div>              $title_part = $original_title;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_search() ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_title_from_options( 'title-search-wpseo' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_string( $title ) || '' === $title ) {&nbsp;</div></li><li><div>              $title_part = sprintf( __( 'Search for &quot;%s&quot;', 'wordpress-seo' ), esc_html( get_search_query() ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_category() || is_tag() || is_tax() ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_taxonomy_title();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_string( $title ) || '' === $title ) {&nbsp;</div></li><li><div>              if ( is_category() ) {&nbsp;</div></li><li><div>                  $title_part = single_cat_title( '', false );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ( is_tag() ) {&nbsp;</div></li><li><div>                  $title_part = single_tag_title( '', false );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $title_part = single_term_title( '', false );&nbsp;</div></li><li><div>                  if ( $title_part === '' ) {&nbsp;</div></li><li><div>                      $term = $GLOBALS['wp_query']-&gt;get_queried_object();&nbsp;</div></li><li><div>                      $title_part = $term-&gt;name;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_author() ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_author_title();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_string( $title ) || '' === $title ) {&nbsp;</div></li><li><div>              $title_part = get_the_author_meta( 'display_name', get_query_var( 'author' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_post_type_archive() ) {&nbsp;</div></li><li><div>          $post_type = get_query_var( 'post_type' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_array( $post_type ) ) {&nbsp;</div></li><li><div>              $post_type = reset( $post_type );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $title = $this-&gt;get_title_from_options( 'title-ptarchive-' . $post_type );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_string( $title ) || '' === $title ) {&nbsp;</div></li><li><div>              $post_type_obj = get_post_type_object( $post_type );&nbsp;</div></li><li><div>              if ( isset( $post_type_obj-&gt;labels-&gt;menu_name ) ) {&nbsp;</div></li><li><div>                  $title_part = $post_type_obj-&gt;labels-&gt;menu_name;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ( isset( $post_type_obj-&gt;name ) ) {&nbsp;</div></li><li><div>                  $title_part = $post_type_obj-&gt;name;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $title_part = ''; <span class="comment">// To be determined what this should be.</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_archive() ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_title_from_options( 'title-archive-wpseo' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// @todo [JRF =&gt; Yoast] Should these not use the archive default if no title found ?</span>&nbsp;</div></li><li><div>          <span class="comment">// WPSEO_Options::get_default( 'wpseo_titles', 'title-archive-wpseo' )</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Replacement would be needed!</span></span>&nbsp;</div></li><li><div>          if ( empty( $title ) ) {&nbsp;</div></li><li><div>              if ( is_month() ) {&nbsp;</div></li><li><div>                  $title_part = sprintf( __( '%s Archives', 'wordpress-seo' ), single_month_title( ' ', false ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ( is_year() ) {&nbsp;</div></li><li><div>                  $title_part = sprintf( __( '%s Archives', 'wordpress-seo' ), get_query_var( 'year' ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              elseif ( is_day() ) {&nbsp;</div></li><li><div>                  $title_part = sprintf( __( '%s Archives', 'wordpress-seo' ), get_the_date() );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $title_part = __( 'Archives', 'wordpress-seo' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_404() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $title = $this-&gt;get_title_from_options( 'title-404-wpseo' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// @todo [JRF =&gt; Yoast] Should these not use the 404 default if no title found ?</span>&nbsp;</div></li><li><div>          <span class="comment">// WPSEO_Options::get_default( 'wpseo_titles', 'title-404-wpseo' )</span>&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// Replacement would be needed!</span></span>&nbsp;</div></li><li><div>          if ( empty( $title ) ) {&nbsp;</div></li><li><div>              $title_part = __( 'Page not found', 'wordpress-seo' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          <span class="comment">// In case the page type is unknown, leave the title alone.</span>&nbsp;</div></li><li><div>          $modified_title = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If you would like to generate a default title instead, </span>&nbsp;</div></li><li><div>          <span class="comment">// the following code could be used</span>&nbsp;</div></li><li><div>          <span class="comment">// $title_part = $title;</span>&nbsp;</div></li><li><div>          <span class="comment">// instead of the line above.</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ( $modified_title && empty( $title ) ) || ! empty( $title_part ) ) {&nbsp;</div></li><li><div>          $title = $this-&gt;get_default_title( $separator, $separator_location, $title_part );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( defined( 'ICL_LANGUAGE_CODE' ) && false !== strpos( $title, ICL_LANGUAGE_CODE ) ) {&nbsp;</div></li><li><div>          $title = str_replace( ' @' . ICL_LANGUAGE_CODE, '', $title );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter: 'wpseo_title' - Allow changing the Yoast SEO &lt;title&gt; output</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api string $title The page title being put out.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return esc_html( strip_tags( stripslashes( apply_filters( 'wpseo_title', $title ) ) ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Function used when title needs to be force overridden.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function force_wp_title() {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>      $old_wp_query = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $wp_query-&gt;is_main_query() ) {&nbsp;</div></li><li><div>          $old_wp_query = $wp_query;&nbsp;</div></li><li><div>          wp_reset_query();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $title = $this-&gt;title( '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $old_wp_query ) ) {&nbsp;</div></li><li><div>          $GLOBALS['wp_query'] = $old_wp_query;&nbsp;</div></li><li><div>          unset( $old_wp_query );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $title;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Outputs or returns the debug marker, which is also used for title replacement when force rewrite is active.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $echo Whether or not to echo the debug marker.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function debug_mark( $echo = true ) {&nbsp;</div></li><li><div>      $marker = sprintf(&nbsp;</div></li><li><div>          '&lt;!-- This site is optimized with the ' . $this-&gt;head_product_name() . '%1$s - https:<span class="comment">//yoast.com/wordpress/plugins/seo/ --&gt;', </span>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filter: 'wpseo_hide_version' - can be used to hide the Yoast SEO version in the debug marker (only available in Yoast SEO Premium)</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @api bool</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          ( ( apply_filters( 'wpseo_hide_version', false ) && $this-&gt;is_premium() ) ? '' : ' v' . WPSEO_VERSION )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $echo === false ) {&nbsp;</div></li><li><div>          return $marker;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          echo &quot;\n${marker}\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output Webmaster Tools authentication strings</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function webmaster_tools_authentication() {&nbsp;</div></li><li><div>      <span class="comment">// Bing.</span>&nbsp;</div></li><li><div>      if ( $this-&gt;options['msverify'] !== '' ) {&nbsp;</div></li><li><div>          echo '&lt;meta name=&quot;msvalidate.01&quot; content=&quot;' . esc_attr( $this-&gt;options['msverify'] ) . &quot;\&quot; /&gt;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Google.</span>&nbsp;</div></li><li><div>      if ( $this-&gt;options['googleverify'] !== '' ) {&nbsp;</div></li><li><div>          echo '&lt;meta name=&quot;google-site-verification&quot; content=&quot;' . esc_attr( $this-&gt;options['googleverify'] ) . &quot;\&quot; /&gt;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Pinterest.</span>&nbsp;</div></li><li><div>      if ( $this-&gt;options['pinterestverify'] !== '' ) {&nbsp;</div></li><li><div>          echo '&lt;meta name=&quot;p:domain_verify&quot; content=&quot;' . esc_attr( $this-&gt;options['pinterestverify'] ) . &quot;\&quot; /&gt;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Yandex.</span>&nbsp;</div></li><li><div>      if ( $this-&gt;options['yandexverify'] !== '' ) {&nbsp;</div></li><li><div>          echo '&lt;meta name=&quot;yandex-verification&quot; content=&quot;' . esc_attr( $this-&gt;options['yandexverify'] ) . &quot;\&quot; /&gt;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Main wrapper function attached to wp_head. This combines all the output on the frontend of the Yoast SEO plugin.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function head() {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $old_wp_query = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! $wp_query-&gt;is_main_query() ) {&nbsp;</div></li><li><div>          $old_wp_query = $wp_query;&nbsp;</div></li><li><div>          wp_reset_query();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Action: 'wpseo_head' - Allow other plugins to output inside the Yoast SEO section of the head section.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      do_action( 'wpseo_head' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      echo '&lt;!-- / ', $this-&gt;head_product_name(), &quot;. --&gt;\n\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $old_wp_query ) ) {&nbsp;</div></li><li><div>          $GLOBALS['wp_query'] = $old_wp_query;&nbsp;</div></li><li><div>          unset( $old_wp_query );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output the meta robots value.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function robots() {&nbsp;</div></li><li><div>      global $wp_query, $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $robots = array();&nbsp;</div></li><li><div>      $robots['index'] = 'index';&nbsp;</div></li><li><div>      $robots['follow'] = 'follow';&nbsp;</div></li><li><div>      $robots['other'] = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_singular() && is_object( $post ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $option_name = 'noindex-' . $post-&gt;post_type;&nbsp;</div></li><li><div>          $noindex = isset( $this-&gt;options[ $option_name ] ) && $this-&gt;options[ $option_name ] === true;&nbsp;</div></li><li><div>          $private = 'private' === $post-&gt;post_status;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $noindex || $private ) {&nbsp;</div></li><li><div>              $robots['index'] = 'noindex';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $robots = $this-&gt;robots_for_single_post( $robots );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          if ( is_search() || is_404() ) {&nbsp;</div></li><li><div>              $robots['index'] = 'noindex';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_tax() || is_tag() || is_category() ) {&nbsp;</div></li><li><div>              $term = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>              if ( is_object( $term ) && ( isset( $this-&gt;options[ 'noindex-tax-' . $term-&gt;taxonomy ] ) && $this-&gt;options[ 'noindex-tax-' . $term-&gt;taxonomy ] === true ) ) {&nbsp;</div></li><li><div>                  $robots['index'] = 'noindex';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Three possible values, index, noindex and default, do nothing for default.</span>&nbsp;</div></li><li><div>              $term_meta = WPSEO_Taxonomy_Meta::get_term_meta( $term, $term-&gt;taxonomy, 'noindex' );&nbsp;</div></li><li><div>              if ( is_string( $term_meta ) && 'default' !== $term_meta ) {&nbsp;</div></li><li><div>                  $robots['index'] = $term_meta;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $this-&gt;is_multiple_terms_query() ) {&nbsp;</div></li><li><div>                  $robots['index'] = 'noindex';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif (&nbsp;</div></li><li><div>              ( is_author() && $this-&gt;options['noindex-author-wpseo'] === true ) ||&nbsp;</div></li><li><div>              ( is_date() && $this-&gt;options['noindex-archive-wpseo'] === true )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>              $robots['index'] = 'noindex';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_home() ) {&nbsp;</div></li><li><div>              if ( get_query_var( 'paged' ) &gt; 1 && $this-&gt;options['noindex-subpages-wpseo'] === true ) {&nbsp;</div></li><li><div>                  $robots['index'] = 'noindex';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $page_for_posts = get_option( 'page_for_posts' );&nbsp;</div></li><li><div>              if ( $page_for_posts ) {&nbsp;</div></li><li><div>                  $robots = $this-&gt;robots_for_single_post( $robots, $page_for_posts );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              unset( $page_for_posts );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_post_type_archive() ) {&nbsp;</div></li><li><div>              $post_type = get_query_var( 'post_type' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_array( $post_type ) ) {&nbsp;</div></li><li><div>                  $post_type = reset( $post_type );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( isset( $this-&gt;options[ 'noindex-ptarchive-' . $post_type ] ) && $this-&gt;options[ 'noindex-ptarchive-' . $post_type ] === true ) {&nbsp;</div></li><li><div>                  $robots['index'] = 'noindex';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $is_paged = isset( $wp_query-&gt;query_vars['paged'] ) && ( $wp_query-&gt;query_vars['paged'] && $wp_query-&gt;query_vars['paged'] &gt; 1 );&nbsp;</div></li><li><div>          $noindex_subpages = $this-&gt;options['noindex-subpages-wpseo'] === true;&nbsp;</div></li><li><div>          if ( $is_paged && $noindex_subpages ) {&nbsp;</div></li><li><div>              $robots['index'] = 'noindex';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;options['noodp'] === true ) {&nbsp;</div></li><li><div>              $robots['other'][] = 'noodp';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset( $robot );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Force override to respect the WP settings.</span>&nbsp;</div></li><li><div>      if ( '0' == get_option( 'blog_public' ) || isset( $_GET['replytocom'] ) ) {&nbsp;</div></li><li><div>          $robots['index'] = 'noindex';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $robotsstr = $robots['index'] . ', ' . $robots['follow'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $robots['other'] !== array() ) {&nbsp;</div></li><li><div>          $robots['other'] = array_unique( $robots['other'] ); <span class="comment">// TODO Most likely no longer needed, needs testing.</span>&nbsp;</div></li><li><div>          $robotsstr .= ', ' . implode( ', ', $robots['other'] );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $robotsstr = preg_replace( '`^index, follow, ?`', '', $robotsstr );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter: 'wpseo_robots' - Allows filtering of the meta robots output of Yoast SEO</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api string $robotsstr The meta robots directives to be echoed.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $robotsstr = apply_filters( 'wpseo_robots', $robotsstr );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $robotsstr ) && $robotsstr !== '' ) {&nbsp;</div></li><li><div>          echo '&lt;meta name=&quot;robots&quot; content=&quot;', esc_attr( $robotsstr ), '&quot;/&gt;', &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $robotsstr;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Determine $robots values for a single post</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $robots  Robots data array.</span>&nbsp;</div></li><li><div><span class="comment">   * @param int   $post_id The post ID for which to determine the $robots values, defaults to current post.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return    array</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function robots_for_single_post( $robots, $post_id = 0 ) {&nbsp;</div></li><li><div>      $noindex = WPSEO_Meta::get_value( 'meta-robots-noindex', $post_id );&nbsp;</div></li><li><div>      if ( $noindex === '1' ) {&nbsp;</div></li><li><div>          $robots['index'] = 'noindex';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( $noindex === '2' ) {&nbsp;</div></li><li><div>          $robots['index'] = 'index';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( WPSEO_Meta::get_value( 'meta-robots-nofollow', $post_id ) === '1' ) {&nbsp;</div></li><li><div>          $robots['follow'] = 'nofollow';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $meta_robots_adv = WPSEO_Meta::get_value( 'meta-robots-adv', $post_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $meta_robots_adv !== '' && ( $meta_robots_adv !== '-' && $meta_robots_adv !== 'none' ) ) {&nbsp;</div></li><li><div>          $meta_robots_adv = explode( ', ', $meta_robots_adv );&nbsp;</div></li><li><div>          foreach ( $meta_robots_adv as $robot ) {&nbsp;</div></li><li><div>              $robots['other'][] = $robot;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset( $robot );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( $meta_robots_adv === '' || $meta_robots_adv === '-' ) {&nbsp;</div></li><li><div>          if ( $this-&gt;options['noodp'] === true ) {&nbsp;</div></li><li><div>              $robots['other'][] = 'noodp';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $meta_robots_adv );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $robots;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This function normally outputs the canonical but is also used in other places to retrieve</span>&nbsp;</div></li><li><div><span class="comment">   * the canonical URL for the current page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $echo        Whether or not to output the canonical element.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $un_paged    Whether or not to return the canonical with or without pagination added to the URL.</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $no_override Whether or not to return a manually overridden canonical.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string $canonical</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function canonical( $echo = true, $un_paged = false, $no_override = false ) {&nbsp;</div></li><li><div>      if ( is_null( $this-&gt;canonical ) ) {&nbsp;</div></li><li><div>          $this-&gt;generate_canonical();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $canonical = $this-&gt;canonical;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $un_paged ) {&nbsp;</div></li><li><div>          $canonical = $this-&gt;canonical_unpaged;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( $no_override ) {&nbsp;</div></li><li><div>          $canonical = $this-&gt;canonical_no_override;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $echo === false ) {&nbsp;</div></li><li><div>          return $canonical;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $canonical ) && '' !== $canonical ) {&nbsp;</div></li><li><div>          echo '&lt;link rel=&quot;canonical&quot; href=&quot;' . esc_url( $canonical, null, 'other' ) . '&quot; /&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * This function normally outputs the canonical but is also used in other places to retrieve</span>&nbsp;</div></li><li><div><span class="comment">   * the canonical URL for the current page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function generate_canonical() {&nbsp;</div></li><li><div>      $canonical = false;&nbsp;</div></li><li><div>      $canonical_override = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Set decent canonicals for homepage, singulars and taxonomy pages.</span>&nbsp;</div></li><li><div>      if ( is_singular() ) {&nbsp;</div></li><li><div>          $obj = get_queried_object();&nbsp;</div></li><li><div>          $canonical = get_permalink( $obj-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;canonical_unpaged = $canonical;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $canonical_override = WPSEO_Meta::get_value( 'canonical' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Fix paginated pages canonical, but only if the page is truly paginated.</span>&nbsp;</div></li><li><div>          if ( get_query_var( 'page' ) &gt; 1 ) {&nbsp;</div></li><li><div>              $num_pages = ( substr_count( $obj-&gt;post_content, '&lt;!--nextpage--&gt;' ) + 1 );&nbsp;</div></li><li><div>              if ( $num_pages && get_query_var( 'page' ) &lt;= $num_pages ) {&nbsp;</div></li><li><div>                  if ( ! $GLOBALS['wp_rewrite']-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>                      $canonical = add_query_arg( 'page', get_query_var( 'page' ), $canonical );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $canonical = user_trailingslashit( trailingslashit( $canonical ) . get_query_var( 'page' ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          if ( is_search() ) {&nbsp;</div></li><li><div>              $search_query = get_search_query();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Regex catches case when /search/page/N without search term is itself mistaken for search term. R.</span>&nbsp;</div></li><li><div>              if ( ! empty( $search_query ) && ! preg_match( '|^page/\d+$|', $search_query ) ) {&nbsp;</div></li><li><div>                  $canonical = get_search_link();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_front_page() ) {&nbsp;</div></li><li><div>              $canonical = WPSEO_Utils::home_url();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( $this-&gt;is_posts_page() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $posts_page_id = get_option( 'page_for_posts' );&nbsp;</div></li><li><div>              $canonical = WPSEO_Meta::get_value( 'canonical', $posts_page_id );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( empty( $canonical ) ) {&nbsp;</div></li><li><div>                  $canonical = get_permalink( $posts_page_id );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_tax() || is_tag() || is_category() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $term = get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $term ) && ! $this-&gt;is_multiple_terms_query() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $canonical_override = WPSEO_Taxonomy_Meta::get_term_meta( $term, $term-&gt;taxonomy, 'canonical' );&nbsp;</div></li><li><div>                  $term_link = get_term_link( $term, $term-&gt;taxonomy );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! is_wp_error( $term_link ) ) {&nbsp;</div></li><li><div>                      $canonical = $term_link;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_post_type_archive() ) {&nbsp;</div></li><li><div>              $post_type = get_query_var( 'post_type' );&nbsp;</div></li><li><div>              if ( is_array( $post_type ) ) {&nbsp;</div></li><li><div>                  $post_type = reset( $post_type );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $canonical = get_post_type_archive_link( $post_type );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_author() ) {&nbsp;</div></li><li><div>              $canonical = get_author_posts_url( get_query_var( 'author' ), get_query_var( 'author_name' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_archive() ) {&nbsp;</div></li><li><div>              if ( is_date() ) {&nbsp;</div></li><li><div>                  if ( is_day() ) {&nbsp;</div></li><li><div>                      $canonical = get_day_link( get_query_var( 'year' ), get_query_var( 'monthnum' ), get_query_var( 'day' ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  elseif ( is_month() ) {&nbsp;</div></li><li><div>                      $canonical = get_month_link( get_query_var( 'year' ), get_query_var( 'monthnum' ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  elseif ( is_year() ) {&nbsp;</div></li><li><div>                      $canonical = get_year_link( get_query_var( 'year' ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;canonical_unpaged = $canonical;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $canonical && get_query_var( 'paged' ) &gt; 1 ) {&nbsp;</div></li><li><div>              global $wp_rewrite;&nbsp;</div></li><li><div>              if ( ! $wp_rewrite-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>                  if ( is_front_page() ) {&nbsp;</div></li><li><div>                      $canonical = trailingslashit( $canonical );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $canonical = add_query_arg( 'paged', get_query_var( 'paged' ), $canonical );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  if ( is_front_page() ) {&nbsp;</div></li><li><div>                      $canonical = WPSEO_Sitemaps_Router::get_base_url( '' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  $canonical = user_trailingslashit( trailingslashit( $canonical ) . trailingslashit( $wp_rewrite-&gt;pagination_base ) . get_query_var( 'paged' ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $this-&gt;canonical_no_override = $canonical;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $canonical ) && $canonical !== '' ) {&nbsp;</div></li><li><div>          <span class="comment">// Force canonical links to be absolute, relative is NOT an option.</span>&nbsp;</div></li><li><div>          if ( WPSEO_Utils::is_url_relative( $canonical ) === true ) {&nbsp;</div></li><li><div>              $canonical = $this-&gt;base_url( $canonical );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $canonical_override ) && $canonical_override !== '' ) {&nbsp;</div></li><li><div>          $canonical = $canonical_override;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter: 'wpseo_canonical' - Allow filtering of the canonical URL put out by Yoast SEO</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api string $canonical The canonical URL</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $this-&gt;canonical = apply_filters( 'wpseo_canonical', $canonical );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Parse the home URL setting to find the base URL for relative URLs.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $path Optional path string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function base_url( $path = null ) {&nbsp;</div></li><li><div>      $url = get_option( 'home' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $parts = wp_parse_url( $url );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $base_url = trailingslashit( $parts['scheme'] . ':<span class="comment">//' . $parts['host'] );</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_null( $path ) ) {&nbsp;</div></li><li><div>          $base_url .= ltrim( $path, '/' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $base_url;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds 'prev' and 'next' links to archives.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @link  http://googlewebmastercentral.blogspot.com/2011/09/pagination-with-relnext-and-relprev.html</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.3</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function adjacent_rel_links() {&nbsp;</div></li><li><div>      <span class="comment">// Don't do this for Genesis, as the way Genesis handles homepage functionality is different and causes issues sometimes.</span>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter 'wpseo_genesis_force_adjacent_rel_home' - Allows devs to allow echoing rel=&quot;next&quot; / rel=&quot;prev&quot; by Yoast SEO on Genesis installs</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api bool $unsigned Whether or not to rel=next / rel=prev</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( is_home() && function_exists( 'genesis' ) && apply_filters( 'wpseo_genesis_force_adjacent_rel_home', false ) === false ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_singular() ) {&nbsp;</div></li><li><div>          $url = $this-&gt;canonical( false, true, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_string( $url ) && $url !== '' ) {&nbsp;</div></li><li><div>              $paged = get_query_var( 'paged' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 0 == $paged ) {&nbsp;</div></li><li><div>                  $paged = 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $paged == 2 ) {&nbsp;</div></li><li><div>                  $this-&gt;adjacent_rel_link( 'prev', $url, ( $paged - 1 ), true );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Make sure to use index.php when needed, done after paged == 2 check so the prev links to homepage will not have index.php erroneously.</span>&nbsp;</div></li><li><div>              if ( is_front_page() ) {&nbsp;</div></li><li><div>                  $url = WPSEO_Sitemaps_Router::get_base_url( '' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $paged &gt; 2 ) {&nbsp;</div></li><li><div>                  $this-&gt;adjacent_rel_link( 'prev', $url, ( $paged - 1 ), true );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $paged &lt; $wp_query-&gt;max_num_pages ) {&nbsp;</div></li><li><div>                  $this-&gt;adjacent_rel_link( 'next', $url, ( $paged + 1 ), true );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $numpages = 0;&nbsp;</div></li><li><div>          if ( isset( $wp_query-&gt;post-&gt;post_content ) ) {&nbsp;</div></li><li><div>              $numpages = ( substr_count( $wp_query-&gt;post-&gt;post_content, '&lt;!--nextpage--&gt;' ) + 1 );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $numpages &gt; 1 ) {&nbsp;</div></li><li><div>              $page = get_query_var( 'page' );&nbsp;</div></li><li><div>              if ( ! $page ) {&nbsp;</div></li><li><div>                  $page = 1;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $url = get_permalink( $wp_query-&gt;post-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// If the current page is the frontpage, pagination should use /base/.</span>&nbsp;</div></li><li><div>              if ( $this-&gt;is_home_static_page() ) {&nbsp;</div></li><li><div>                  $usebase = true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $usebase = false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $page &gt; 1 ) {&nbsp;</div></li><li><div>                  $this-&gt;adjacent_rel_link( 'prev', $url, ( $page - 1 ), $usebase, 'single_paged' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $page &lt; $numpages ) {&nbsp;</div></li><li><div>                  $this-&gt;adjacent_rel_link( 'next', $url, ( $page + 1 ), $usebase, 'single_paged' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get adjacent pages link for archives</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string  $rel                  Link relationship, prev or next.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string  $url                  the un-paginated URL of the current archive.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string  $page                 the page number to add on to $url for the $link tag.</span>&nbsp;</div></li><li><div><span class="comment">   * @param boolean $incl_pagination_base whether or not to include /page/ or not.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function adjacent_rel_link( $rel, $url, $page, $incl_pagination_base ) {&nbsp;</div></li><li><div>      global $wp_rewrite;&nbsp;</div></li><li><div>      if ( ! $wp_rewrite-&gt;using_permalinks() ) {&nbsp;</div></li><li><div>          if ( $page &gt; 1 ) {&nbsp;</div></li><li><div>              $url = add_query_arg( 'paged', $page, $url );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          if ( $page &gt; 1 ) {&nbsp;</div></li><li><div>              $base = '';&nbsp;</div></li><li><div>              if ( $incl_pagination_base ) {&nbsp;</div></li><li><div>                  $base = trailingslashit( $wp_rewrite-&gt;pagination_base );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $url = user_trailingslashit( trailingslashit( $url ) . $base . $page );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter: 'wpseo_' . $rel . '_rel_link' - Allow changing link rel output by Yoast SEO</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api string $unsigned The full `&lt;link` element.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $link = apply_filters( 'wpseo_' . $rel . '_rel_link', '&lt;link rel=&quot;' . esc_attr( $rel ) . '&quot; href=&quot;' . esc_url( $url ) . &quot;\&quot; /&gt;\n&quot; );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $link ) && $link !== '' ) {&nbsp;</div></li><li><div>          echo $link;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Output the rel=publisher code on every page of the site.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean Boolean indicating whether the publisher link was printed</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function publisher() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;options['plus-publisher'] !== '' ) {&nbsp;</div></li><li><div>          echo '&lt;link rel=&quot;publisher&quot; href=&quot;', esc_url( $this-&gt;options['plus-publisher'] ), '&quot;/&gt;', &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Outputs the meta keywords element.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return void</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function metakeywords() {&nbsp;</div></li><li><div>      global $wp_query, $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;options['usemetakeywords'] === false ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $keywords = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_singular() ) {&nbsp;</div></li><li><div>          $keywords = WPSEO_Meta::get_value( 'metakeywords' );&nbsp;</div></li><li><div>          if ( $keywords === '' && ( is_object( $post ) && ( ( isset( $this-&gt;options[ 'metakey-' . $post-&gt;post_type ] ) && $this-&gt;options[ 'metakey-' . $post-&gt;post_type ] !== '' ) ) ) ) {&nbsp;</div></li><li><div>              $keywords = wpseo_replace_vars( $this-&gt;options[ 'metakey-' . $post-&gt;post_type ], $post );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          if ( $this-&gt;is_home_posts_page() && $this-&gt;options['metakey-home-wpseo'] !== '' ) {&nbsp;</div></li><li><div>              $keywords = wpseo_replace_vars( $this-&gt;options['metakey-home-wpseo'], array() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( $this-&gt;is_home_static_page() ) {&nbsp;</div></li><li><div>              $keywords = WPSEO_Meta::get_value( 'metakeywords' );&nbsp;</div></li><li><div>              if ( $keywords === '' && ( is_object( $post ) && ( isset( $this-&gt;options[ 'metakey-' . $post-&gt;post_type ] ) && $this-&gt;options[ 'metakey-' . $post-&gt;post_type ] !== '' ) ) ) {&nbsp;</div></li><li><div>                  $keywords = wpseo_replace_vars( $this-&gt;options[ 'metakey-' . $post-&gt;post_type ], $post );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( $this-&gt;is_posts_page() ) {&nbsp;</div></li><li><div>              $keywords = $this-&gt;get_keywords( get_post( get_option( 'page_for_posts' ) ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_category() || is_tag() || is_tax() ) {&nbsp;</div></li><li><div>              $term = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_object( $term ) ) {&nbsp;</div></li><li><div>                  $keywords = WPSEO_Taxonomy_Meta::get_term_meta( $term, $term-&gt;taxonomy, 'metakey' );&nbsp;</div></li><li><div>                  if ( ( ! is_string( $keywords ) || $keywords === '' ) && ( isset( $this-&gt;options[ 'metakey-tax-' . $term-&gt;taxonomy ] ) && $this-&gt;options[ 'metakey-tax-' . $term-&gt;taxonomy ] !== '' ) ) {&nbsp;</div></li><li><div>                      $keywords = wpseo_replace_vars( $this-&gt;options[ 'metakey-tax-' . $term-&gt;taxonomy ], $term );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_author() ) {&nbsp;</div></li><li><div>              $author_id = get_query_var( 'author' );&nbsp;</div></li><li><div>              $keywords = get_the_author_meta( 'metakey', $author_id );&nbsp;</div></li><li><div>              if ( ! $keywords && $this-&gt;options['metakey-author-wpseo'] !== '' ) {&nbsp;</div></li><li><div>                  $keywords = wpseo_replace_vars( $this-&gt;options['metakey-author-wpseo'], $wp_query-&gt;get_queried_object() );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_post_type_archive() ) {&nbsp;</div></li><li><div>              $post_type = get_query_var( 'post_type' );&nbsp;</div></li><li><div>              if ( is_array( $post_type ) ) {&nbsp;</div></li><li><div>                  $post_type = reset( $post_type );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( isset( $this-&gt;options[ 'metakey-ptarchive-' . $post_type ] ) && $this-&gt;options[ 'metakey-ptarchive-' . $post_type ] !== '' ) {&nbsp;</div></li><li><div>                  $keywords = wpseo_replace_vars( $this-&gt;options[ 'metakey-ptarchive-' . $post_type ], $wp_query-&gt;get_queried_object() );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $keywords = apply_filters( 'wpseo_metakey', trim( $keywords ) ); <span class="comment">// TODO Make deprecated.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter: 'wpseo_metakeywords' - Allow changing the Yoast SEO meta keywords</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api string $keywords The meta keywords to be echoed.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $keywords = apply_filters( 'wpseo_metakeywords', trim( $keywords ) ); <span class="comment">// More appropriately named.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $keywords ) && $keywords !== '' ) {&nbsp;</div></li><li><div>          echo '&lt;meta name=&quot;keywords&quot; content=&quot;', esc_attr( strip_tags( stripslashes( $keywords ) ) ), '&quot;/&gt;', &quot;\n&quot;;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Outputs the meta description element or returns the description text.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $echo Echo or return output flag.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function metadesc( $echo = true ) {&nbsp;</div></li><li><div>      if ( is_null( $this-&gt;metadesc ) ) {&nbsp;</div></li><li><div>          $this-&gt;generate_metadesc();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $echo !== false ) {&nbsp;</div></li><li><div>          if ( is_string( $this-&gt;metadesc ) && $this-&gt;metadesc !== '' ) {&nbsp;</div></li><li><div>              echo '&lt;meta name=&quot;description&quot; content=&quot;', esc_attr( strip_tags( stripslashes( $this-&gt;metadesc ) ) ), '&quot;/&gt;', &quot;\n&quot;;&nbsp;</div></li><li><div>              $this-&gt;add_robot_content_noodp( $this-&gt;metadesc );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( current_user_can( 'manage_options' ) && is_singular() ) {&nbsp;</div></li><li><div>              echo '&lt;!-- ', __( 'Admin only notice: this page doesn\'t show a meta description because it doesn\'t have one, either write it for this page specifically or go into the SEO -&gt; Titles menu and set up a template.', 'wordpress-seo' ), ' --&gt;', &quot;\n&quot;;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          return $this-&gt;metadesc;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Generates the meta description text.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function generate_metadesc() {&nbsp;</div></li><li><div>      global $post, $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $metadesc = '';&nbsp;</div></li><li><div>      $metadesc_override = false;&nbsp;</div></li><li><div>      $post_type = '';&nbsp;</div></li><li><div>      $template = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_object( $post ) && ( isset( $post-&gt;post_type ) && $post-&gt;post_type !== '' ) ) {&nbsp;</div></li><li><div>          $post_type = $post-&gt;post_type;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_singular() ) {&nbsp;</div></li><li><div>          if ( ( $metadesc === '' && $post_type !== '' ) && isset( $this-&gt;options[ 'metadesc-' . $post_type ] ) ) {&nbsp;</div></li><li><div>              $template = $this-&gt;options[ 'metadesc-' . $post_type ];&nbsp;</div></li><li><div>              $term = $post;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $metadesc_override = WPSEO_Meta::get_value( 'metadesc' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          if ( is_search() ) {&nbsp;</div></li><li><div>              $metadesc = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( $this-&gt;is_home_posts_page() ) {&nbsp;</div></li><li><div>              $template = $this-&gt;options['metadesc-home-wpseo'];&nbsp;</div></li><li><div>              $term = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( empty( $template ) ) {&nbsp;</div></li><li><div>                  $template = get_bloginfo( 'description' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( $this-&gt;is_posts_page() ) {&nbsp;</div></li><li><div>              $metadesc = WPSEO_Meta::get_value( 'metadesc', get_option( 'page_for_posts' ) );&nbsp;</div></li><li><div>              if ( ( $metadesc === '' && $post_type !== '' ) && isset( $this-&gt;options[ 'metadesc-' . $post_type ] ) ) {&nbsp;</div></li><li><div>                  $page = get_post( get_option( 'page_for_posts' ) );&nbsp;</div></li><li><div>                  $template = $this-&gt;options[ 'metadesc-' . $post_type ];&nbsp;</div></li><li><div>                  $term = $page;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( $this-&gt;is_home_static_page() ) {&nbsp;</div></li><li><div>              $metadesc = WPSEO_Meta::get_value( 'metadesc' );&nbsp;</div></li><li><div>              if ( ( $metadesc === '' && $post_type !== '' ) && isset( $this-&gt;options[ 'metadesc-' . $post_type ] ) ) {&nbsp;</div></li><li><div>                  $template = $this-&gt;options[ 'metadesc-' . $post_type ];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_category() || is_tag() || is_tax() ) {&nbsp;</div></li><li><div>              $term = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>              $metadesc_override = WPSEO_Taxonomy_Meta::get_term_meta( $term, $term-&gt;taxonomy, 'desc' );&nbsp;</div></li><li><div>              if ( is_object( $term ) && isset( $term-&gt;taxonomy, $this-&gt;options[ 'metadesc-tax-' . $term-&gt;taxonomy ] ) ) {&nbsp;</div></li><li><div>                  $template = $this-&gt;options[ 'metadesc-tax-' . $term-&gt;taxonomy ];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_author() ) {&nbsp;</div></li><li><div>              $author_id = get_query_var( 'author' );&nbsp;</div></li><li><div>              $metadesc = get_the_author_meta( 'wpseo_metadesc', $author_id );&nbsp;</div></li><li><div>              if ( ( ! is_string( $metadesc ) || $metadesc === '' ) && '' !== $this-&gt;options['metadesc-author-wpseo'] ) {&nbsp;</div></li><li><div>                  $template = $this-&gt;options['metadesc-author-wpseo'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_post_type_archive() ) {&nbsp;</div></li><li><div>              $post_type = get_query_var( 'post_type' );&nbsp;</div></li><li><div>              if ( is_array( $post_type ) ) {&nbsp;</div></li><li><div>                  $post_type = reset( $post_type );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( isset( $this-&gt;options[ 'metadesc-ptarchive-' . $post_type ] ) ) {&nbsp;</div></li><li><div>                  $template = $this-&gt;options[ 'metadesc-ptarchive-' . $post_type ];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( is_archive() ) {&nbsp;</div></li><li><div>              $template = $this-&gt;options['metadesc-archive-wpseo'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If we're on a paginated page, and the template doesn't change for paginated pages, bail.</span>&nbsp;</div></li><li><div>          if ( ( ! is_string( $metadesc ) || $metadesc === '' ) && get_query_var( 'paged' ) && get_query_var( 'paged' ) &gt; 1 && $template !== '' ) {&nbsp;</div></li><li><div>              if ( strpos( $template, '%%page' ) === false ) {&nbsp;</div></li><li><div>                  $metadesc = '';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_data = $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_string( $metadesc_override ) && '' !== $metadesc_override ) {&nbsp;</div></li><li><div>          $metadesc = $metadesc_override;&nbsp;</div></li><li><div>          if ( isset( $term ) ) {&nbsp;</div></li><li><div>              $post_data = $term;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else if ( ( ! is_string( $metadesc ) || '' === $metadesc ) && '' !== $template ) {&nbsp;</div></li><li><div>          if ( ! isset( $term ) ) {&nbsp;</div></li><li><div>              $term = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $metadesc = $template;&nbsp;</div></li><li><div>          $post_data = $term;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $metadesc = wpseo_replace_vars( $metadesc, $post_data );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter: 'wpseo_metadesc' - Allow changing the Yoast SEO meta description sentence.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api string $metadesc The description sentence.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $this-&gt;metadesc = apply_filters( 'wpseo_metadesc', trim( $metadesc ) );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Based on the redirect meta value, this function determines whether it should redirect the current post / page.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function page_redirect() {&nbsp;</div></li><li><div>      if ( is_singular() ) {&nbsp;</div></li><li><div>          global $post;&nbsp;</div></li><li><div>          if ( ! isset( $post ) || ! is_object( $post ) ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $redir = WPSEO_Meta::get_value( 'redirect', $post-&gt;ID );&nbsp;</div></li><li><div>          if ( $redir !== '' ) {&nbsp;</div></li><li><div>              wp_redirect( $redir, 301 );&nbsp;</div></li><li><div>              exit;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Outputs noindex values for the current page.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function noindex_page() {&nbsp;</div></li><li><div>      echo '&lt;meta name=&quot;robots&quot; content=&quot;noindex&quot; /&gt;', &quot;\n&quot;;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Send a Robots HTTP header preventing URL from being indexed in the search results while allowing search engines</span>&nbsp;</div></li><li><div><span class="comment">   * to follow the links in the object at the URL.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.1.7</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean Boolean indicating whether the noindex header was sent</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function noindex_feed() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ( is_feed() || is_robots() ) && headers_sent() === false ) {&nbsp;</div></li><li><div>          header( 'X-Robots-Tag: noindex, follow', true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds rel=&quot;nofollow&quot; to a link, only used for login / registration links.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $input The link element as a string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function nofollow_link( $input ) {&nbsp;</div></li><li><div>      return str_replace( '&lt;a ', '&lt;a rel=&quot;nofollow&quot; ', $input );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * When certain archives are disabled, this redirects those to the homepage.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean False when no redirect was triggered</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function archive_redirect() {&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if (&nbsp;</div></li><li><div>          ( $this-&gt;options['disable-date'] === true && $wp_query-&gt;is_date ) ||&nbsp;</div></li><li><div>          ( $this-&gt;options['disable-author'] === true && $wp_query-&gt;is_author ) ||&nbsp;</div></li><li><div>          ( $this-&gt;options['disable-post_format'] === true && $wp_query-&gt;is_tax( 'post_format' ) )&nbsp;</div></li><li><div> ) {&nbsp;</div></li><li><div>          wp_safe_redirect( get_bloginfo( 'url' ), 301 );&nbsp;</div></li><li><div>          exit;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * If the option to redirect attachments to their parent is checked, this performs the redirect.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * An extra check is done for when the attachment has no parent.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean False when no redirect was triggered</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function attachment_redirect() {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>      if ( is_attachment() && ( ( is_object( $post ) && isset( $post-&gt;post_parent ) ) && ( is_numeric( $post-&gt;post_parent ) && $post-&gt;post_parent != 0 ) ) ) {&nbsp;</div></li><li><div>          wp_safe_redirect( get_permalink( $post-&gt;post_parent ), 301 );&nbsp;</div></li><li><div>          exit;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Trailing slashes for everything except is_single().</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Thanks to Mark Jaquith for this code.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $url  URL string.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $type Context (such as single).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function add_trailingslash( $url, $type ) {&nbsp;</div></li><li><div>      if ( 'single' === $type || 'single_paged' === $type ) {&nbsp;</div></li><li><div>          return $url;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          return trailingslashit( $url );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Removes the ?replytocom variable from the link, replacing it with a #comment-&lt;number&gt; anchor.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @todo Should this function also allow for relative urls ?</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $link The comment link as a string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function remove_reply_to_com( $link ) {&nbsp;</div></li><li><div>      return preg_replace( '`href=([&quot;\'])(?:.*(?:\?|&|&#038;)replytocom=(\d+)#respond)`', 'href=$1#comment-$2', $link );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Redirect out the ?replytocom variables when cleanreplytocom is enabled</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.4.13</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function replytocom_redirect() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_GET['replytocom'] ) && is_singular() ) {&nbsp;</div></li><li><div>          $url = get_permalink( $GLOBALS['post']-&gt;ID );&nbsp;</div></li><li><div>          $hash = sanitize_text_field( $_GET['replytocom'] );&nbsp;</div></li><li><div>          $query_string = remove_query_arg( 'replytocom', sanitize_text_field( $_SERVER['QUERY_STRING'] ) );&nbsp;</div></li><li><div>          if ( ! empty( $query_string ) ) {&nbsp;</div></li><li><div>              $url .= '?' . $query_string;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          $url .= '#comment-' . $hash;&nbsp;</div></li><li><div>          wp_safe_redirect( $url, 301 );&nbsp;</div></li><li><div>          exit;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return false;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Removes unneeded query variables from the URL.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return boolean</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function clean_permalink() {&nbsp;</div></li><li><div>      if ( is_robots() || get_query_var( 'sitemap' ) || empty( $_GET ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Recreate current URL.</span>&nbsp;</div></li><li><div>      $cururl = 'http';&nbsp;</div></li><li><div>      if ( isset( $_SERVER['HTTPS'] ) && $_SERVER['HTTPS'] == 'on' ) {&nbsp;</div></li><li><div>          $cururl .= 's';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $cururl .= ':<span class="comment">//';</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $_SERVER['SERVER_PORT'] != '80' && $_SERVER['SERVER_PORT'] != '443' ) {&nbsp;</div></li><li><div>          $cururl .= $_SERVER['SERVER_NAME'] . ':' . $_SERVER['SERVER_PORT'] . $_SERVER['REQUEST_URI'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          $cururl .= $_SERVER['SERVER_NAME'] . $_SERVER['REQUEST_URI'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      $properurl = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_singular() ) {&nbsp;</div></li><li><div>          global $post;&nbsp;</div></li><li><div>          if ( empty( $post ) ) {&nbsp;</div></li><li><div>              $post = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $properurl = get_permalink( $post-&gt;ID );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $page = get_query_var( 'page' );&nbsp;</div></li><li><div>          if ( $page && $page != 1 ) {&nbsp;</div></li><li><div>              $post = get_post( $post-&gt;ID );&nbsp;</div></li><li><div>              $page_count = substr_count( $post-&gt;post_content, '&lt;!--nextpage--&gt;' );&nbsp;</div></li><li><div>              if ( $page &gt; ( $page_count + 1 ) ) {&nbsp;</div></li><li><div>                  $properurl = user_trailingslashit( trailingslashit( $properurl ) . ( $page_count + 1 ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              else {&nbsp;</div></li><li><div>                  $properurl = user_trailingslashit( trailingslashit( $properurl ) . $page );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Fix reply to comment links, whoever decided this should be a GET variable?</span>&nbsp;</div></li><li><div>          if ( preg_match( '`(\?replytocom=[^&]+)`', sanitize_text_field( $_SERVER['REQUEST_URI'] ), $matches ) ) {&nbsp;</div></li><li><div>              $properurl .= str_replace( '?replytocom=', '#comment-', $matches[0] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset( $matches );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Prevent cleaning out posts & page previews for people capable of viewing them.</span>&nbsp;</div></li><li><div>          if ( isset( $_GET['preview'], $_GET['preview_nonce'] ) && current_user_can( 'edit_post' ) ) {&nbsp;</div></li><li><div>              $properurl = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_front_page() ) {&nbsp;</div></li><li><div>          if ( $this-&gt;is_home_posts_page() ) {&nbsp;</div></li><li><div>              $properurl = get_bloginfo( 'url' ) . '/';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          elseif ( $this-&gt;is_home_static_page() ) {&nbsp;</div></li><li><div>              $properurl = get_permalink( $GLOBALS['post']-&gt;ID );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_category() || is_tag() || is_tax() ) {&nbsp;</div></li><li><div>          $term = $wp_query-&gt;get_queried_object();&nbsp;</div></li><li><div>          if ( is_feed() ) {&nbsp;</div></li><li><div>              $properurl = get_term_feed_link( $term-&gt;term_id, $term-&gt;taxonomy );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $properurl = get_term_link( $term, $term-&gt;taxonomy );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_search() ) {&nbsp;</div></li><li><div>          $s = urlencode( preg_replace( '`(%20|\+)`', ' ', get_search_query() ) );&nbsp;</div></li><li><div>          $properurl = get_bloginfo( 'url' ) . '/?s=' . $s;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      elseif ( is_404() ) {&nbsp;</div></li><li><div>          if ( is_multisite() && ! is_subdomain_install() && is_main_site() ) {&nbsp;</div></li><li><div>              if ( $cururl == get_bloginfo( 'url' ) . '/blog/' || $cururl == get_bloginfo( 'url' ) . '/blog' ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;is_home_static_page() ) {&nbsp;</div></li><li><div>                      $properurl = get_permalink( get_option( 'page_for_posts' ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  else {&nbsp;</div></li><li><div>                      $properurl = get_bloginfo( 'url' ) . '/';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $properurl ) && $wp_query-&gt;query_vars['paged'] != 0 && $wp_query-&gt;post_count != 0 ) {&nbsp;</div></li><li><div>          if ( is_search() && ! empty( $s ) ) {&nbsp;</div></li><li><div>              $properurl = get_bloginfo( 'url' ) . '/page/' . $wp_query-&gt;query_vars['paged'] . '/?s=' . $s;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          else {&nbsp;</div></li><li><div>              $properurl = user_trailingslashit( trailingslashit( $properurl ) . 'page/' . $wp_query-&gt;query_vars['paged'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Prevent cleaning out the WP Subscription managers interface for everyone.</span>&nbsp;</div></li><li><div>      if ( isset( $_GET['wp-subscription-manager'] ) ) {&nbsp;</div></li><li><div>          $properurl = '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter: 'wpseo_whitelist_permalink_vars' - Allow plugins to register their own variables not to clean</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api array $unsigned Array of permalink variables _not_ to clean. Empty by default.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $whitelisted_extravars = apply_filters( 'wpseo_whitelist_permalink_vars', array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;options['cleanpermalink-googlesitesearch'] === true ) {&nbsp;</div></li><li><div>          <span class="comment">// Prevent cleaning out Google Site searches.</span>&nbsp;</div></li><li><div>          $whitelisted_extravars = array_merge( $whitelisted_extravars, array(&nbsp;</div></li><li><div>              'q', &nbsp;</div></li><li><div>              'cx', &nbsp;</div></li><li><div>              'debug', &nbsp;</div></li><li><div>              'cof', &nbsp;</div></li><li><div>              'ie', &nbsp;</div></li><li><div>              'sa', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;options['cleanpermalink-googlecampaign'] === true ) {&nbsp;</div></li><li><div>          <span class="comment">// Prevent cleaning out Google Analytics campaign variables.</span>&nbsp;</div></li><li><div>          $whitelisted_extravars = array_merge( $whitelisted_extravars, array(&nbsp;</div></li><li><div>              'utm_campaign', &nbsp;</div></li><li><div>              'utm_medium', &nbsp;</div></li><li><div>              'utm_source', &nbsp;</div></li><li><div>              'utm_content', &nbsp;</div></li><li><div>              'utm_term', &nbsp;</div></li><li><div>              'utm_id', &nbsp;</div></li><li><div>              'gclid', &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;options['cleanpermalink-extravars'] !== '' ) {&nbsp;</div></li><li><div>          $extravars = explode( ', ', $this-&gt;options['cleanpermalink-extravars'] );&nbsp;</div></li><li><div>          $extravars = array_map( 'trim', $extravars );&nbsp;</div></li><li><div>          $whitelisted_extravars = array_merge( $whitelisted_extravars, $extravars );&nbsp;</div></li><li><div>          unset( $extravars );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $whitelisted_extravars as $get ) {&nbsp;</div></li><li><div>          if ( isset( $_GET[ trim( $get ) ] ) ) {&nbsp;</div></li><li><div>              $properurl = '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      unset( $get );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $properurl ) && $cururl != $properurl ) {&nbsp;</div></li><li><div>          wp_safe_redirect( $properurl, 301 );&nbsp;</div></li><li><div>          exit;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Replaces the possible RSS variables with their actual values.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content The RSS content that should have the variables replaced.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function rss_replace_vars( $content ) {&nbsp;</div></li><li><div>      global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Allow the developer to determine whether or not to follow the links in the bits Yoast SEO adds to the RSS feed, defaults to true.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api   bool $unsigned Whether or not to follow the links in RSS feed, defaults to true.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.4.20</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      $no_follow = apply_filters( 'nofollow_rss_links', true );&nbsp;</div></li><li><div>      $no_follow_attr = '';&nbsp;</div></li><li><div>      if ( $no_follow === true ) {&nbsp;</div></li><li><div>          $no_follow_attr = 'rel=&quot;nofollow&quot; ';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $author_link = '';&nbsp;</div></li><li><div>      if ( is_object( $post ) ) {&nbsp;</div></li><li><div>          $author_link = '&lt;a ' . $no_follow_attr . 'href=&quot;' . esc_url( get_author_posts_url( $post-&gt;post_author ) ) . '&quot;&gt;' . get_the_author() . '&lt;/a&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $post_link = '&lt;a ' . $no_follow_attr . 'href=&quot;' . esc_url( get_permalink() ) . '&quot;&gt;' . get_the_title() . '&lt;/a&gt;';&nbsp;</div></li><li><div>      $blog_link = '&lt;a ' . $no_follow_attr . 'href=&quot;' . esc_url( get_bloginfo( 'url' ) ) . '&quot;&gt;' . get_bloginfo( 'name' ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>      $blog_desc_link = '&lt;a ' . $no_follow_attr . 'href=&quot;' . esc_url( get_bloginfo( 'url' ) ) . '&quot;&gt;' . get_bloginfo( 'name' ) . ' - ' . strip_tags( get_bloginfo( 'description' ) ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $content = stripslashes( trim( $content ) );&nbsp;</div></li><li><div>      $content = str_replace( '%%AUTHORLINK%%', $author_link, $content );&nbsp;</div></li><li><div>      $content = str_replace( '%%POSTLINK%%', $post_link, $content );&nbsp;</div></li><li><div>      $content = str_replace( '%%BLOGLINK%%', $blog_link, $content );&nbsp;</div></li><li><div>      $content = str_replace( '%%BLOGDESCLINK%%', $blog_desc_link, $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds the RSS footer (or header) to the full RSS feed item.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content Feed item content.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function embed_rssfooter( $content ) {&nbsp;</div></li><li><div>      return $this-&gt;embed_rss( $content, 'full' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds the RSS footer (or header) to the excerpt RSS feed item.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content Feed item excerpt.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function embed_rssfooter_excerpt( $content ) {&nbsp;</div></li><li><div>      return $this-&gt;embed_rss( $content, 'excerpt' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Adds the RSS footer and/or header to an RSS feed item.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.4.14</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $content Feed item content.</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $context Feed item context, either 'excerpt' or 'full'.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function embed_rss( $content, $context = 'full' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Filter: 'wpseo_include_rss_footer' - Allow the RSS footer to be dynamically shown/hidden.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @api boolean $show_embed Indicates if the RSS footer should be shown or not</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $context The context of the RSS content - 'full' or 'excerpt'.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      if ( ! apply_filters( 'wpseo_include_rss_footer', true, $context ) ) {&nbsp;</div></li><li><div>          return $content;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( is_feed() ) {&nbsp;</div></li><li><div>          $before = '';&nbsp;</div></li><li><div>          $after = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;options['rssbefore'] !== '' ) {&nbsp;</div></li><li><div>              $before = wpautop( $this-&gt;rss_replace_vars( $this-&gt;options['rssbefore'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $this-&gt;options['rssafter'] !== '' ) {&nbsp;</div></li><li><div>              $after = wpautop( $this-&gt;rss_replace_vars( $this-&gt;options['rssafter'] ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( $before !== '' || $after !== '' ) {&nbsp;</div></li><li><div>              if ( ( isset( $context ) && $context === 'excerpt' ) && trim( $content ) !== '' ) {&nbsp;</div></li><li><div>                  $content = wpautop( $content );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $content = $before . $content . $after;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $content;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Used in the force rewrite functionality this retrieves the output, replaces the title with the proper SEO</span>&nbsp;</div></li><li><div><span class="comment">   * title and then flushes the output.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function flush_cache() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $this-&gt;ob_started !== true ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $content = ob_get_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $old_wp_query = $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      wp_reset_query();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $title = $this-&gt;title( '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Find all titles, strip them out and add the new one in within the debug marker, so it's easily identified whether a site uses force rewrite.</span>&nbsp;</div></li><li><div>      $content = preg_replace( '/&lt;title.*?\/title&gt;/i', '', $content );&nbsp;</div></li><li><div>      $content = str_replace( $this-&gt;debug_mark( false ), $this-&gt;debug_mark( false ) . &quot;\n&quot; . '&lt;title&gt;' . $title . '&lt;/title&gt;', $content );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $GLOBALS['wp_query'] = $old_wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      echo $content;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return true;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Starts the output buffer so it can later be fixed by flush_cache()</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function force_rewrite_output_buffer() {&nbsp;</div></li><li><div>      $this-&gt;ob_started = true;&nbsp;</div></li><li><div>      ob_start();&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Function used in testing whether the title should be force rewritten or not.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param string $title Title string.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function title_test_helper( $title ) {&nbsp;</div></li><li><div>      $wpseo_titles = get_option( 'wpseo_titles' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $wpseo_titles['title_test'] ++;&nbsp;</div></li><li><div>      update_option( 'wpseo_titles', $wpseo_titles );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">// Prevent this setting from being on forever when something breaks, as it breaks caching.</span>&nbsp;</div></li><li><div>      if ( $wpseo_titles['title_test'] &gt; 5 ) {&nbsp;</div></li><li><div>          $wpseo_titles['title_test'] = 0;&nbsp;</div></li><li><div>          update_option( 'wpseo_titles', $wpseo_titles );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          remove_filter( 'wpseo_title', array( $this, 'title_test_helper' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $title;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! defined( 'DONOTCACHEPAGE' ) ) {&nbsp;</div></li><li><div>          define( 'DONOTCACHEPAGE', true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ! defined( 'DONOTCACHCEOBJECT' ) ) {&nbsp;</div></li><li><div>          define( 'DONOTCACHCEOBJECT', true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      if ( ! defined( 'DONOTMINIFY' ) ) {&nbsp;</div></li><li><div>          define( 'DONOTMINIFY', true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $_SERVER['HTTP_USER_AGENT'] === &quot;WordPress/{$GLOBALS['wp_version']}; &quot; . get_bloginfo( 'url' ) . ' - Yoast' ) {&nbsp;</div></li><li><div>          return 'This is a Yoast Test Title';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $title;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Get the product name in the head section</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function head_product_name() {&nbsp;</div></li><li><div>      if ( $this-&gt;is_premium() ) {&nbsp;</div></li><li><div>          return 'Yoast SEO Premium plugin';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>      else {&nbsp;</div></li><li><div>          return 'Yoast SEO plugin';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if this plugin is the premium version of WPSEO</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function is_premium() {&nbsp;</div></li><li><div>      return file_exists( WPSEO_PATH . 'premium/' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Checks whether the user has written a meta-description. If written, makes sure meta robots content is noodp.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param String $description The content of the meta description.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function add_robot_content_noodp( $description ) {&nbsp;</div></li><li><div>      if ( ! ( empty( $description ) ) && $this-&gt;options['noodp'] === false ) {&nbsp;</div></li><li><div>          $this-&gt;options['noodp'] = true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Getting the keywords</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param WP_Post $post The post object with the values.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  private function get_keywords( $post ) {&nbsp;</div></li><li><div>      $keywords = WPSEO_Meta::get_value( 'metakeywords', $post-&gt;ID );&nbsp;</div></li><li><div>      $option_meta_key = 'metakey-' . $post-&gt;post_type;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( $keywords === '' && ( is_object( $post ) && ( isset( $this-&gt;options[ $option_meta_key ] ) && $this-&gt;options[ $option_meta_key ] !== '' ) ) ) {&nbsp;</div></li><li><div>          $keywords = wpseo_replace_vars( $this-&gt;options[ $option_meta_key ], $post );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return $keywords;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Check if term archive query is for multiple terms (/term-1, term2/ or /term-1+term-2/).</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  protected function is_multiple_terms_query() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      global $wp_query;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! is_tax() && ! is_tag() && ! is_category() ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      $term = get_queried_object();&nbsp;</div></li><li><div>      $queried_terms = $wp_query-&gt;tax_query-&gt;queried_terms;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( empty( $queried_terms[ $term-&gt;taxonomy ]['terms'] ) ) {&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      return count( $queried_terms[ $term-&gt;taxonomy ]['terms'] ) &gt; 1;&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/** Deprecated functions */</span>&nbsp;</div></li><li><div>  <span class="comment">// @codeCoverageIgnoreStart</span>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Outputs or returns the debug marker, which is also used for title replacement when force rewrite is active.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @deprecated 4.4</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param bool $echo Whether or not to echo the debug marker.</span>&nbsp;</div></li><li><div><span class="comment">   * @return string</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  public function debug_marker( $echo = false ) {&nbsp;</div></li><li><div>      return $this-&gt;debug_mark( $echo );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">// @codeCoverageIgnoreEnd</span>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Yoast SEO</li><li><span></span>4.7.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>