<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="0.9.5.2" data-slug="w3-total-cache" data-type="class" data-id="94451"><head xmlns="http://www.w3.org/1999/xhtml"><title> jsparser | class | W3 Total Cache | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="JSParser, class, plugin, w3-total-cache, 0.9.5.2" /><meta name="description" content="The W3 Total Cache JSParser class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=de6f6219f6245bd1a918529efd4d57c9' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/jsparser/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fjsparser%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fjsparser%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-w3-total-cache-0.9.5.2-class-jsparser","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="jsparser" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to w3-total-cache." href="http://hookr.io/plugins/w3-total-cache/" class="plugin"><span property="name">w3-total-cache</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 0.9.5.2." href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/" class="H_VERSION"><span property="name">0.9.5.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">jsparser</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="1092"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/all/" title="All">All <span class="count badge">1092</span></a></li><li class="" data-id="new" data-count="204"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/new/" title="New">New <span class="count badge">204</span></a></li><li class="" data-id="hooks" data-count="155"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/hooks/" title="Hooks">Hooks <span class="count badge">155</span></a></li><li class="" data-id="action" data-count="69"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/actions/" title="Actions">Actions <span class="count badge">69</span></a></li><li class="" data-id="filter" data-count="86"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/filters/" title="Filters">Filters <span class="count badge">86</span></a></li><li class="active" data-id="class" data-count="629"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/classes/" title="Classes">Classes <span class="count badge">629</span></a></li><li class="" data-id="constant" data-count="229"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/constants/" title="Constants">Constants <span class="count badge">229</span></a></li><li class="" data-id="function" data-count="79"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/functions/" title="Functions">Functions <span class="count badge">79</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>JSParser</strong></h1><p>The W3 Total Cache <strong>JSParser</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/files/lib-minify-jsminplus/" class="file">/lib/Minify/JSMinPlus.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="51" class="block" start="674"><li><div>class JSParser&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    private $t;&nbsp;</div></li><li><div>    private $minifier;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private $opPrecedence = array(&nbsp;</div></li><li><div>        ';' =&gt; 0, &nbsp;</div></li><li><div>        ', ' =&gt; 1, &nbsp;</div></li><li><div>        '=' =&gt; 2, '?' =&gt; 2, ':' =&gt; 2, &nbsp;</div></li><li><div>        // The above all have to have the same precedence, see bug 330975&nbsp;</div></li><li><div>        '||' =&gt; 4, &nbsp;</div></li><li><div>        '&&' =&gt; 5, &nbsp;</div></li><li><div>        '|' =&gt; 6, &nbsp;</div></li><li><div>        '^' =&gt; 7, &nbsp;</div></li><li><div>        '&' =&gt; 8, &nbsp;</div></li><li><div>        '==' =&gt; 9, '!=' =&gt; 9, '===' =&gt; 9, '!==' =&gt; 9, &nbsp;</div></li><li><div>        '&lt;' =&gt; 10, '&lt;=' =&gt; 10, '&gt;=' =&gt; 10, '&gt;' =&gt; 10, 'in' =&gt; 10, 'instanceof' =&gt; 10, &nbsp;</div></li><li><div>        '&lt;&lt;' =&gt; 11, '&gt;&gt;' =&gt; 11, '&gt;&gt;&gt;' =&gt; 11, &nbsp;</div></li><li><div>        '+' =&gt; 12, '-' =&gt; 12, &nbsp;</div></li><li><div>        '*' =&gt; 13, '/' =&gt; 13, '%' =&gt; 13, &nbsp;</div></li><li><div>        'delete' =&gt; 14, 'void' =&gt; 14, 'typeof' =&gt; 14, &nbsp;</div></li><li><div>        '!' =&gt; 14, '~' =&gt; 14, 'U+' =&gt; 14, 'U-' =&gt; 14, &nbsp;</div></li><li><div>        '++' =&gt; 15, '--' =&gt; 15, &nbsp;</div></li><li><div>        'new' =&gt; 16, &nbsp;</div></li><li><div>        '.' =&gt; 17, &nbsp;</div></li><li><div>        JS_NEW_WITH_ARGS =&gt; 0, JS_INDEX =&gt; 0, JS_CALL =&gt; 0, &nbsp;</div></li><li><div>        JS_ARRAY_INIT =&gt; 0, JS_OBJECT_INIT =&gt; 0, JS_GROUP =&gt; 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private $opArity = array(&nbsp;</div></li><li><div>        ', ' =&gt; -2, &nbsp;</div></li><li><div>        '=' =&gt; 2, &nbsp;</div></li><li><div>        '?' =&gt; 3, &nbsp;</div></li><li><div>        '||' =&gt; 2, &nbsp;</div></li><li><div>        '&&' =&gt; 2, &nbsp;</div></li><li><div>        '|' =&gt; 2, &nbsp;</div></li><li><div>        '^' =&gt; 2, &nbsp;</div></li><li><div>        '&' =&gt; 2, &nbsp;</div></li><li><div>        '==' =&gt; 2, '!=' =&gt; 2, '===' =&gt; 2, '!==' =&gt; 2, &nbsp;</div></li><li><div>        '&lt;' =&gt; 2, '&lt;=' =&gt; 2, '&gt;=' =&gt; 2, '&gt;' =&gt; 2, 'in' =&gt; 2, 'instanceof' =&gt; 2, &nbsp;</div></li><li><div>        '&lt;&lt;' =&gt; 2, '&gt;&gt;' =&gt; 2, '&gt;&gt;&gt;' =&gt; 2, &nbsp;</div></li><li><div>        '+' =&gt; 2, '-' =&gt; 2, &nbsp;</div></li><li><div>        '*' =&gt; 2, '/' =&gt; 2, '%' =&gt; 2, &nbsp;</div></li><li><div>        'delete' =&gt; 1, 'void' =&gt; 1, 'typeof' =&gt; 1, &nbsp;</div></li><li><div>        '!' =&gt; 1, '~' =&gt; 1, 'U+' =&gt; 1, 'U-' =&gt; 1, &nbsp;</div></li><li><div>        '++' =&gt; 1, '--' =&gt; 1, &nbsp;</div></li><li><div>        'new' =&gt; 1, &nbsp;</div></li><li><div>        '.' =&gt; 2, &nbsp;</div></li><li><div>        JS_NEW_WITH_ARGS =&gt; 2, JS_INDEX =&gt; 2, JS_CALL =&gt; 2, &nbsp;</div></li><li><div>        JS_ARRAY_INIT =&gt; 1, JS_OBJECT_INIT =&gt; 1, JS_GROUP =&gt; 1, &nbsp;</div></li><li><div>        TOKEN_CONDCOMMENT_START =&gt; 1, TOKEN_CONDCOMMENT_END =&gt; 1&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function __construct($minifier=null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;minifier = $minifier;&nbsp;</div></li><li><div>        $this-&gt;t = new JSTokenizer();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    public function parse($s, $f, $l)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // initialize tokenizer&nbsp;</div></li><li><div>        $this-&gt;t-&gt;init($s, $f, $l);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $x = new JSCompilerContext(false);&nbsp;</div></li><li><div>        $n = $this-&gt;Script($x);&nbsp;</div></li><li><div>        if (!$this-&gt;t-&gt;isDone())&nbsp;</div></li><li><div>            throw $this-&gt;t-&gt;newSyntaxError('Syntax error');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function Script($x)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $n = $this-&gt;Statements($x);&nbsp;</div></li><li><div>        $n-&gt;type = JS_SCRIPT;&nbsp;</div></li><li><div>        $n-&gt;funDecls = $x-&gt;funDecls;&nbsp;</div></li><li><div>        $n-&gt;varDecls = $x-&gt;varDecls;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // minify by scope&nbsp;</div></li><li><div>        if ($this-&gt;minifier)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $n-&gt;value = $this-&gt;minifier-&gt;parseTree($n);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // clear tree from node to save memory&nbsp;</div></li><li><div>            $n-&gt;treeNodes = null;&nbsp;</div></li><li><div>            $n-&gt;funDecls = null;&nbsp;</div></li><li><div>            $n-&gt;varDecls = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $n-&gt;type = JS_MINIFIED;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function Statements($x)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $n = new JSNode($this-&gt;t, JS_BLOCK);&nbsp;</div></li><li><div>        array_push($x-&gt;stmtStack, $n);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (!$this-&gt;t-&gt;isDone() && $this-&gt;t-&gt;peek() != OP_RIGHT_CURLY)&nbsp;</div></li><li><div>            $n-&gt;addNode($this-&gt;Statement($x));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        array_pop($x-&gt;stmtStack);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function Block($x)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;t-&gt;mustMatch(OP_LEFT_CURLY);&nbsp;</div></li><li><div>        $n = $this-&gt;Statements($x);&nbsp;</div></li><li><div>        $this-&gt;t-&gt;mustMatch(OP_RIGHT_CURLY);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function Statement($x)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $tt = $this-&gt;t-&gt;get();&nbsp;</div></li><li><div>        $n2 = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Cases for statements ending in a right curly return early, avoiding the&nbsp;</div></li><li><div>        // common semicolon insertion magic after this switch.&nbsp;</div></li><li><div>        switch ($tt)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            case KEYWORD_FUNCTION:&nbsp;</div></li><li><div>                return $this-&gt;FunctionDefinition(&nbsp;</div></li><li><div>                    $x, &nbsp;</div></li><li><div>                    true, &nbsp;</div></li><li><div>                    count($x-&gt;stmtStack) &gt; 1 ? STATEMENT_FORM : DECLARED_FORM&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case OP_LEFT_CURLY:&nbsp;</div></li><li><div>                $n = $this-&gt;Statements($x);&nbsp;</div></li><li><div>                $this-&gt;t-&gt;mustMatch(OP_RIGHT_CURLY);&nbsp;</div></li><li><div>            return $n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_IF:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                $n-&gt;condition = $this-&gt;ParenExpression($x);&nbsp;</div></li><li><div>                array_push($x-&gt;stmtStack, $n);&nbsp;</div></li><li><div>                $n-&gt;thenPart = $this-&gt;Statement($x);&nbsp;</div></li><li><div>                $n-&gt;elsePart = $this-&gt;t-&gt;match(KEYWORD_ELSE) ? $this-&gt;Statement($x) : null;&nbsp;</div></li><li><div>                array_pop($x-&gt;stmtStack);&nbsp;</div></li><li><div>            return $n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_SWITCH:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                $this-&gt;t-&gt;mustMatch(OP_LEFT_PAREN);&nbsp;</div></li><li><div>                $n-&gt;discriminant = $this-&gt;Expression($x);&nbsp;</div></li><li><div>                $this-&gt;t-&gt;mustMatch(OP_RIGHT_PAREN);&nbsp;</div></li><li><div>                $n-&gt;cases = array();&nbsp;</div></li><li><div>                $n-&gt;defaultIndex = -1;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                array_push($x-&gt;stmtStack, $n);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;t-&gt;mustMatch(OP_LEFT_CURLY);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                while (($tt = $this-&gt;t-&gt;get()) != OP_RIGHT_CURLY)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    switch ($tt)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        case KEYWORD_DEFAULT:&nbsp;</div></li><li><div>                            if ($n-&gt;defaultIndex &gt;= 0)&nbsp;</div></li><li><div>                                throw $this-&gt;t-&gt;newSyntaxError('More than one switch default');&nbsp;</div></li><li><div>                            // FALL THROUGH&nbsp;</div></li><li><div>                        case KEYWORD_CASE:&nbsp;</div></li><li><div>                            $n2 = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                            if ($tt == KEYWORD_DEFAULT)&nbsp;</div></li><li><div>                                $n-&gt;defaultIndex = count($n-&gt;cases);&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                                $n2-&gt;caseLabel = $this-&gt;Expression($x, OP_COLON);&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                        default:&nbsp;</div></li><li><div>                            throw $this-&gt;t-&gt;newSyntaxError('Invalid switch case');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;mustMatch(OP_COLON);&nbsp;</div></li><li><div>                    $n2-&gt;statements = new JSNode($this-&gt;t, JS_BLOCK);&nbsp;</div></li><li><div>                    while (($tt = $this-&gt;t-&gt;peek()) != KEYWORD_CASE && $tt != KEYWORD_DEFAULT && $tt != OP_RIGHT_CURLY)&nbsp;</div></li><li><div>                        $n2-&gt;statements-&gt;addNode($this-&gt;Statement($x));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    array_push($n-&gt;cases, $n2);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                array_pop($x-&gt;stmtStack);&nbsp;</div></li><li><div>            return $n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_FOR:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                $n-&gt;isLoop = true;&nbsp;</div></li><li><div>                $this-&gt;t-&gt;mustMatch(OP_LEFT_PAREN);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (($tt = $this-&gt;t-&gt;peek()) != OP_SEMICOLON)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $x-&gt;inForLoopInit = true;&nbsp;</div></li><li><div>                    if ($tt == KEYWORD_VAR || $tt == KEYWORD_CONST)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $this-&gt;t-&gt;get();&nbsp;</div></li><li><div>                        $n2 = $this-&gt;Variables($x);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $n2 = $this-&gt;Expression($x);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $x-&gt;inForLoopInit = false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($n2 && $this-&gt;t-&gt;match(KEYWORD_IN))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $n-&gt;type = JS_FOR_IN;&nbsp;</div></li><li><div>                    if ($n2-&gt;type == KEYWORD_VAR)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        if (count($n2-&gt;treeNodes) != 1)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            throw $this-&gt;t-&gt;SyntaxError(&nbsp;</div></li><li><div>                                'Invalid for..in left-hand side', &nbsp;</div></li><li><div>                                $this-&gt;t-&gt;filename, &nbsp;</div></li><li><div>                                $n2-&gt;lineno&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // NB: n2[0].type == IDENTIFIER and n2[0].value == n2[0].name.&nbsp;</div></li><li><div>                        $n-&gt;iterator = $n2-&gt;treeNodes[0];&nbsp;</div></li><li><div>                        $n-&gt;varDecl = $n2;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $n-&gt;iterator = $n2;&nbsp;</div></li><li><div>                        $n-&gt;varDecl = null;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $n-&gt;object = $this-&gt;Expression($x);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $n-&gt;setup = $n2 ? $n2 : null;&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;mustMatch(OP_SEMICOLON);&nbsp;</div></li><li><div>                    $n-&gt;condition = $this-&gt;t-&gt;peek() == OP_SEMICOLON ? null : $this-&gt;Expression($x);&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;mustMatch(OP_SEMICOLON);&nbsp;</div></li><li><div>                    $n-&gt;update = $this-&gt;t-&gt;peek() == OP_RIGHT_PAREN ? null : $this-&gt;Expression($x);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;t-&gt;mustMatch(OP_RIGHT_PAREN);&nbsp;</div></li><li><div>                $n-&gt;body = $this-&gt;nest($x, $n);&nbsp;</div></li><li><div>            return $n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_WHILE:&nbsp;</div></li><li><div>                    $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                    $n-&gt;isLoop = true;&nbsp;</div></li><li><div>                    $n-&gt;condition = $this-&gt;ParenExpression($x);&nbsp;</div></li><li><div>                    $n-&gt;body = $this-&gt;nest($x, $n);&nbsp;</div></li><li><div>            return $n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_DO:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                $n-&gt;isLoop = true;&nbsp;</div></li><li><div>                $n-&gt;body = $this-&gt;nest($x, $n, KEYWORD_WHILE);&nbsp;</div></li><li><div>                $n-&gt;condition = $this-&gt;ParenExpression($x);&nbsp;</div></li><li><div>                if (!$x-&gt;ecmaStrictMode)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    // &lt;script language=&quot;JavaScript&quot;&gt; (without version hints) may need&nbsp;</div></li><li><div>                    // automatic semicolon insertion without a newline after do-while.&nbsp;</div></li><li><div>                    // See http://bugzilla.mozilla.org/show_bug.cgi?id=238945.&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;match(OP_SEMICOLON);&nbsp;</div></li><li><div>                    return $n;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_BREAK:&nbsp;</div></li><li><div>            case KEYWORD_CONTINUE:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($this-&gt;t-&gt;peekOnSameLine() == TOKEN_IDENTIFIER)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;get();&nbsp;</div></li><li><div>                    $n-&gt;label = $this-&gt;t-&gt;currentToken()-&gt;value;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $ss = $x-&gt;stmtStack;&nbsp;</div></li><li><div>                $i = count($ss);&nbsp;</div></li><li><div>                $label = $n-&gt;label;&nbsp;</div></li><li><div>                if ($label)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    do&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        if (--$i &lt; 0)&nbsp;</div></li><li><div>                            throw $this-&gt;t-&gt;newSyntaxError('Label not found');&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    while ($ss[$i]-&gt;label != $label);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    do&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        if (--$i &lt; 0)&nbsp;</div></li><li><div>                            throw $this-&gt;t-&gt;newSyntaxError('Invalid ' . $tt);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    while (!$ss[$i]-&gt;isLoop && ($tt != KEYWORD_BREAK || $ss[$i]-&gt;type != KEYWORD_SWITCH));&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $n-&gt;target = $ss[$i];&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_TRY:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                $n-&gt;tryBlock = $this-&gt;Block($x);&nbsp;</div></li><li><div>                $n-&gt;catchClauses = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                while ($this-&gt;t-&gt;match(KEYWORD_CATCH))&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $n2 = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;mustMatch(OP_LEFT_PAREN);&nbsp;</div></li><li><div>                    $n2-&gt;varName = $this-&gt;t-&gt;mustMatch(TOKEN_IDENTIFIER)-&gt;value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;match(KEYWORD_IF))&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        if ($x-&gt;ecmaStrictMode)&nbsp;</div></li><li><div>                            throw $this-&gt;t-&gt;newSyntaxError('Illegal catch guard');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (count($n-&gt;catchClauses) && !end($n-&gt;catchClauses)-&gt;guard)&nbsp;</div></li><li><div>                            throw $this-&gt;t-&gt;newSyntaxError('Guarded catch after unguarded');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $n2-&gt;guard = $this-&gt;Expression($x);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $n2-&gt;guard = null;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;mustMatch(OP_RIGHT_PAREN);&nbsp;</div></li><li><div>                    $n2-&gt;block = $this-&gt;Block($x);&nbsp;</div></li><li><div>                    array_push($n-&gt;catchClauses, $n2);&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ($this-&gt;t-&gt;match(KEYWORD_FINALLY))&nbsp;</div></li><li><div>                    $n-&gt;finallyBlock = $this-&gt;Block($x);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (!count($n-&gt;catchClauses) && !$n-&gt;finallyBlock)&nbsp;</div></li><li><div>                    throw $this-&gt;t-&gt;newSyntaxError('Invalid try statement');&nbsp;</div></li><li><div>            return $n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_CATCH:&nbsp;</div></li><li><div>            case KEYWORD_FINALLY:&nbsp;</div></li><li><div>                throw $this-&gt;t-&gt;newSyntaxError($tt + ' without preceding try');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_THROW:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                $n-&gt;value = $this-&gt;Expression($x);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_RETURN:&nbsp;</div></li><li><div>                if (!$x-&gt;inFunction)&nbsp;</div></li><li><div>                    throw $this-&gt;t-&gt;newSyntaxError('Invalid return');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                $tt = $this-&gt;t-&gt;peekOnSameLine();&nbsp;</div></li><li><div>                if ($tt != TOKEN_END && $tt != TOKEN_NEWLINE && $tt != OP_SEMICOLON && $tt != OP_RIGHT_CURLY)&nbsp;</div></li><li><div>                    $n-&gt;value = $this-&gt;Expression($x);&nbsp;</div></li><li><div>                else&nbsp;</div></li><li><div>                    $n-&gt;value = null;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_WITH:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                $n-&gt;object = $this-&gt;ParenExpression($x);&nbsp;</div></li><li><div>                $n-&gt;body = $this-&gt;nest($x, $n);&nbsp;</div></li><li><div>            return $n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_VAR:&nbsp;</div></li><li><div>            case KEYWORD_CONST:&nbsp;</div></li><li><div>                    $n = $this-&gt;Variables($x);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case TOKEN_CONDCOMMENT_START:&nbsp;</div></li><li><div>            case TOKEN_CONDCOMMENT_END:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>            return $n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case KEYWORD_DEBUGGER:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case TOKEN_NEWLINE:&nbsp;</div></li><li><div>            case OP_SEMICOLON:&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t, OP_SEMICOLON);&nbsp;</div></li><li><div>                $n-&gt;expression = null;&nbsp;</div></li><li><div>            return $n;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            default:&nbsp;</div></li><li><div>                if ($tt == TOKEN_IDENTIFIER)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;scanOperand = false;&nbsp;</div></li><li><div>                    $tt = $this-&gt;t-&gt;peek();&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;scanOperand = true;&nbsp;</div></li><li><div>                    if ($tt == OP_COLON)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $label = $this-&gt;t-&gt;currentToken()-&gt;value;&nbsp;</div></li><li><div>                        $ss = $x-&gt;stmtStack;&nbsp;</div></li><li><div>                        for ($i = count($ss) - 1; $i &gt;= 0; --$i)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            if ($ss[$i]-&gt;label == $label)&nbsp;</div></li><li><div>                                throw $this-&gt;t-&gt;newSyntaxError('Duplicate label');&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;t-&gt;get();&nbsp;</div></li><li><div>                        $n = new JSNode($this-&gt;t, JS_LABEL);&nbsp;</div></li><li><div>                        $n-&gt;label = $label;&nbsp;</div></li><li><div>                        $n-&gt;statement = $this-&gt;nest($x, $n);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        return $n;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $n = new JSNode($this-&gt;t, OP_SEMICOLON);&nbsp;</div></li><li><div>                $this-&gt;t-&gt;unget();&nbsp;</div></li><li><div>                $n-&gt;expression = $this-&gt;Expression($x);&nbsp;</div></li><li><div>                $n-&gt;end = $n-&gt;expression-&gt;end;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;t-&gt;lineno == $this-&gt;t-&gt;currentToken()-&gt;lineno)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $tt = $this-&gt;t-&gt;peekOnSameLine();&nbsp;</div></li><li><div>            if ($tt != TOKEN_END && $tt != TOKEN_NEWLINE && $tt != OP_SEMICOLON && $tt != OP_RIGHT_CURLY)&nbsp;</div></li><li><div>                throw $this-&gt;t-&gt;newSyntaxError('Missing ; before statement');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;t-&gt;match(OP_SEMICOLON);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function FunctionDefinition($x, $requireName, $functionForm)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $f = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($f-&gt;type != KEYWORD_FUNCTION)&nbsp;</div></li><li><div>            $f-&gt;type = ($f-&gt;value == 'get') ? JS_GETTER : JS_SETTER;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;t-&gt;match(TOKEN_IDENTIFIER))&nbsp;</div></li><li><div>            $f-&gt;name = $this-&gt;t-&gt;currentToken()-&gt;value;&nbsp;</div></li><li><div>        elseif ($requireName)&nbsp;</div></li><li><div>            throw $this-&gt;t-&gt;newSyntaxError('Missing function identifier');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;t-&gt;mustMatch(OP_LEFT_PAREN);&nbsp;</div></li><li><div>            $f-&gt;params = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (($tt = $this-&gt;t-&gt;get()) != OP_RIGHT_PAREN)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if ($tt != TOKEN_IDENTIFIER)&nbsp;</div></li><li><div>                throw $this-&gt;t-&gt;newSyntaxError('Missing formal parameter');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            array_push($f-&gt;params, $this-&gt;t-&gt;currentToken()-&gt;value);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;t-&gt;peek() != OP_RIGHT_PAREN)&nbsp;</div></li><li><div>                $this-&gt;t-&gt;mustMatch(OP_COMMA);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;t-&gt;mustMatch(OP_LEFT_CURLY);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $x2 = new JSCompilerContext(true);&nbsp;</div></li><li><div>        $f-&gt;body = $this-&gt;Script($x2);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;t-&gt;mustMatch(OP_RIGHT_CURLY);&nbsp;</div></li><li><div>        $f-&gt;end = $this-&gt;t-&gt;currentToken()-&gt;end;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $f-&gt;functionForm = $functionForm;&nbsp;</div></li><li><div>        if ($functionForm == DECLARED_FORM)&nbsp;</div></li><li><div>            array_push($x-&gt;funDecls, $f);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $f;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function Variables($x)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $n = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;t-&gt;mustMatch(TOKEN_IDENTIFIER);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $n2 = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>            $n2-&gt;name = $n2-&gt;value;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;t-&gt;match(OP_ASSIGN))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                if ($this-&gt;t-&gt;currentToken()-&gt;assignOp)&nbsp;</div></li><li><div>                    throw $this-&gt;t-&gt;newSyntaxError('Invalid variable initialization');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $n2-&gt;initializer = $this-&gt;Expression($x, OP_COMMA);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $n2-&gt;readOnly = $n-&gt;type == KEYWORD_CONST;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $n-&gt;addNode($n2);&nbsp;</div></li><li><div>            array_push($x-&gt;varDecls, $n2);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        while ($this-&gt;t-&gt;match(OP_COMMA));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function Expression($x, $stop=false)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $operators = array();&nbsp;</div></li><li><div>        $operands = array();&nbsp;</div></li><li><div>        $n = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $bl = $x-&gt;bracketLevel;&nbsp;</div></li><li><div>        $cl = $x-&gt;curlyLevel;&nbsp;</div></li><li><div>        $pl = $x-&gt;parenLevel;&nbsp;</div></li><li><div>        $hl = $x-&gt;hookLevel;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (($tt = $this-&gt;t-&gt;get()) != TOKEN_END)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if ($tt == $stop &&&nbsp;</div></li><li><div>                $x-&gt;bracketLevel == $bl &&&nbsp;</div></li><li><div>                $x-&gt;curlyLevel == $cl &&&nbsp;</div></li><li><div>                $x-&gt;parenLevel == $pl &&&nbsp;</div></li><li><div>                $x-&gt;hookLevel == $hl&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // Stop only if tt matches the optional stop parameter, and that&nbsp;</div></li><li><div>                // token is not quoted by some kind of bracket.&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            switch ($tt)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                case OP_SEMICOLON:&nbsp;</div></li><li><div>                    // NB: cannot be empty, Statement handled that.&nbsp;</div></li><li><div>                    break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_HOOK:&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    while (    !empty($operators) &&&nbsp;</div></li><li><div>                        $this-&gt;opPrecedence[end($operators)-&gt;type] &gt; $this-&gt;opPrecedence[$tt]&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                        $this-&gt;reduce($operators, $operands);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    array_push($operators, new JSNode($this-&gt;t));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    ++$x-&gt;hookLevel;&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;scanOperand = true;&nbsp;</div></li><li><div>                    $n = $this-&gt;Expression($x);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if (!$this-&gt;t-&gt;match(OP_COLON))&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    --$x-&gt;hookLevel;&nbsp;</div></li><li><div>                    array_push($operands, $n);&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_COLON:&nbsp;</div></li><li><div>                    if ($x-&gt;hookLevel)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    throw $this-&gt;t-&gt;newSyntaxError('Invalid label');&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_ASSIGN:&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Use &gt;, not &gt;=, for right-associative ASSIGN&nbsp;</div></li><li><div>                    while (    !empty($operators) &&&nbsp;</div></li><li><div>                        $this-&gt;opPrecedence[end($operators)-&gt;type] &gt; $this-&gt;opPrecedence[$tt]&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                        $this-&gt;reduce($operators, $operands);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    array_push($operators, new JSNode($this-&gt;t));&nbsp;</div></li><li><div>                    end($operands)-&gt;assignOp = $this-&gt;t-&gt;currentToken()-&gt;assignOp;&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;scanOperand = true;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case KEYWORD_IN:&nbsp;</div></li><li><div>                    // An in operator should not be parsed if we're parsing the head of&nbsp;</div></li><li><div>                    // a for (...) loop, unless it is in the then part of a conditional&nbsp;</div></li><li><div>                    // expression, or parenthesized somehow.&nbsp;</div></li><li><div>                    if ($x-&gt;inForLoopInit && !$x-&gt;hookLevel &&&nbsp;</div></li><li><div>                        !$x-&gt;bracketLevel && !$x-&gt;curlyLevel &&&nbsp;</div></li><li><div>                        !$x-&gt;parenLevel&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>                // FALL THROUGH&nbsp;</div></li><li><div>                case OP_COMMA:&nbsp;</div></li><li><div>                    // A comma operator should not be parsed if we're parsing the then part&nbsp;</div></li><li><div>                    // of a conditional expression unless it's parenthesized somehow.&nbsp;</div></li><li><div>                    if ($tt == OP_COMMA && $x-&gt;hookLevel &&&nbsp;</div></li><li><div>                        !$x-&gt;bracketLevel && !$x-&gt;curlyLevel &&&nbsp;</div></li><li><div>                        !$x-&gt;parenLevel&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>                // Treat comma as left-associative so reduce can fold left-heavy&nbsp;</div></li><li><div>                // COMMA trees into a single array.&nbsp;</div></li><li><div>                // FALL THROUGH&nbsp;</div></li><li><div>                case OP_OR:&nbsp;</div></li><li><div>                case OP_AND:&nbsp;</div></li><li><div>                case OP_BITWISE_OR:&nbsp;</div></li><li><div>                case OP_BITWISE_XOR:&nbsp;</div></li><li><div>                case OP_BITWISE_AND:&nbsp;</div></li><li><div>                case OP_EQ: case OP_NE: case OP_STRICT_EQ: case OP_STRICT_NE:&nbsp;</div></li><li><div>                case OP_LT: case OP_LE: case OP_GE: case OP_GT:&nbsp;</div></li><li><div>                case KEYWORD_INSTANCEOF:&nbsp;</div></li><li><div>                case OP_LSH: case OP_RSH: case OP_URSH:&nbsp;</div></li><li><div>                case OP_PLUS: case OP_MINUS:&nbsp;</div></li><li><div>                case OP_MUL: case OP_DIV: case OP_MOD:&nbsp;</div></li><li><div>                case OP_DOT:&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    while (    !empty($operators) &&&nbsp;</div></li><li><div>                        $this-&gt;opPrecedence[end($operators)-&gt;type] &gt;= $this-&gt;opPrecedence[$tt]&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                        $this-&gt;reduce($operators, $operands);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($tt == OP_DOT)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $this-&gt;t-&gt;mustMatch(TOKEN_IDENTIFIER);&nbsp;</div></li><li><div>                        array_push($operands, new JSNode($this-&gt;t, OP_DOT, array_pop($operands), new JSNode($this-&gt;t)));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        array_push($operators, new JSNode($this-&gt;t));&nbsp;</div></li><li><div>                        $this-&gt;t-&gt;scanOperand = true;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case KEYWORD_DELETE: case KEYWORD_VOID: case KEYWORD_TYPEOF:&nbsp;</div></li><li><div>                case OP_NOT: case OP_BITWISE_NOT: case OP_UNARY_PLUS: case OP_UNARY_MINUS:&nbsp;</div></li><li><div>                case KEYWORD_NEW:&nbsp;</div></li><li><div>                    if (!$this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    array_push($operators, new JSNode($this-&gt;t));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_INCREMENT: case OP_DECREMENT:&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        array_push($operators, new JSNode($this-&gt;t));  // prefix increment or decrement&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // Don't cross a line boundary for postfix {in, de}crement.&nbsp;</div></li><li><div>                        $t = $this-&gt;t-&gt;tokens[($this-&gt;t-&gt;tokenIndex + $this-&gt;t-&gt;lookahead - 1) & 3];&nbsp;</div></li><li><div>                        if ($t && $t-&gt;lineno != $this-&gt;t-&gt;lineno)&nbsp;</div></li><li><div>                            break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if (!empty($operators))&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            // Use &gt;, not &gt;=, so postfix has higher precedence than prefix.&nbsp;</div></li><li><div>                            while ($this-&gt;opPrecedence[end($operators)-&gt;type] &gt; $this-&gt;opPrecedence[$tt])&nbsp;</div></li><li><div>                                $this-&gt;reduce($operators, $operands);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $n = new JSNode($this-&gt;t, $tt, array_pop($operands));&nbsp;</div></li><li><div>                        $n-&gt;postfix = true;&nbsp;</div></li><li><div>                        array_push($operands, $n);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case KEYWORD_FUNCTION:&nbsp;</div></li><li><div>                    if (!$this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    array_push($operands, $this-&gt;FunctionDefinition($x, false, EXPRESSED_FORM));&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;scanOperand = false;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case KEYWORD_NULL: case KEYWORD_THIS: case KEYWORD_TRUE: case KEYWORD_FALSE:&nbsp;</div></li><li><div>                case TOKEN_IDENTIFIER: case TOKEN_NUMBER: case TOKEN_STRING: case TOKEN_REGEXP:&nbsp;</div></li><li><div>                    if (!$this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    array_push($operands, new JSNode($this-&gt;t));&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;scanOperand = false;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case TOKEN_CONDCOMMENT_START:&nbsp;</div></li><li><div>                case TOKEN_CONDCOMMENT_END:&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                        array_push($operators, new JSNode($this-&gt;t));&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                        array_push($operands, new JSNode($this-&gt;t));&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_LEFT_BRACKET:&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // Array initialiser.  Parse using recursive descent, as the&nbsp;</div></li><li><div>                        // sub-grammar here is not an operator grammar.&nbsp;</div></li><li><div>                        $n = new JSNode($this-&gt;t, JS_ARRAY_INIT);&nbsp;</div></li><li><div>                        while (($tt = $this-&gt;t-&gt;peek()) != OP_RIGHT_BRACKET)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            if ($tt == OP_COMMA)&nbsp;</div></li><li><div>                            {&nbsp;</div></li><li><div>                                $this-&gt;t-&gt;get();&nbsp;</div></li><li><div>                                $n-&gt;addNode(null);&nbsp;</div></li><li><div>                                continue;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            $n-&gt;addNode($this-&gt;Expression($x, OP_COMMA));&nbsp;</div></li><li><div>                            if (!$this-&gt;t-&gt;match(OP_COMMA))&nbsp;</div></li><li><div>                                break;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;t-&gt;mustMatch(OP_RIGHT_BRACKET);&nbsp;</div></li><li><div>                        array_push($operands, $n);&nbsp;</div></li><li><div>                        $this-&gt;t-&gt;scanOperand = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // Property indexing operator.&nbsp;</div></li><li><div>                        array_push($operators, new JSNode($this-&gt;t, JS_INDEX));&nbsp;</div></li><li><div>                        $this-&gt;t-&gt;scanOperand = true;&nbsp;</div></li><li><div>                        ++$x-&gt;bracketLevel;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_RIGHT_BRACKET:&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;scanOperand || $x-&gt;bracketLevel == $bl)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    while ($this-&gt;reduce($operators, $operands)-&gt;type != JS_INDEX)&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    --$x-&gt;bracketLevel;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_LEFT_CURLY:&nbsp;</div></li><li><div>                    if (!$this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Object initialiser.  As for array initialisers (see above), &nbsp;</div></li><li><div>                    // parse using recursive descent.&nbsp;</div></li><li><div>                    ++$x-&gt;curlyLevel;&nbsp;</div></li><li><div>                    $n = new JSNode($this-&gt;t, JS_OBJECT_INIT);&nbsp;</div></li><li><div>                    while (!$this-&gt;t-&gt;match(OP_RIGHT_CURLY))&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        do&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            $tt = $this-&gt;t-&gt;get();&nbsp;</div></li><li><div>                            $tv = $this-&gt;t-&gt;currentToken()-&gt;value;&nbsp;</div></li><li><div>                            if (($tv == 'get' || $tv == 'set') && $this-&gt;t-&gt;peek() == TOKEN_IDENTIFIER)&nbsp;</div></li><li><div>                            {&nbsp;</div></li><li><div>                                if ($x-&gt;ecmaStrictMode)&nbsp;</div></li><li><div>                                    throw $this-&gt;t-&gt;newSyntaxError('Illegal property accessor');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $n-&gt;addNode($this-&gt;FunctionDefinition($x, true, EXPRESSED_FORM));&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                            {&nbsp;</div></li><li><div>                                switch ($tt)&nbsp;</div></li><li><div>                                {&nbsp;</div></li><li><div>                                    case TOKEN_IDENTIFIER:&nbsp;</div></li><li><div>                                    case TOKEN_NUMBER:&nbsp;</div></li><li><div>                                    case TOKEN_STRING:&nbsp;</div></li><li><div>                                        $id = new JSNode($this-&gt;t);&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    case OP_RIGHT_CURLY:&nbsp;</div></li><li><div>                                        if ($x-&gt;ecmaStrictMode)&nbsp;</div></li><li><div>                                            throw $this-&gt;t-&gt;newSyntaxError('Illegal trailing , ');&nbsp;</div></li><li><div>                                    break 3;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                    default:&nbsp;</div></li><li><div>                                        throw $this-&gt;t-&gt;newSyntaxError('Invalid property name');&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                $this-&gt;t-&gt;mustMatch(OP_COLON);&nbsp;</div></li><li><div>                                $n-&gt;addNode(new JSNode($this-&gt;t, JS_PROPERTY_INIT, $id, $this-&gt;Expression($x, OP_COMMA)));&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        while ($this-&gt;t-&gt;match(OP_COMMA));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $this-&gt;t-&gt;mustMatch(OP_RIGHT_CURLY);&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    array_push($operands, $n);&nbsp;</div></li><li><div>                    $this-&gt;t-&gt;scanOperand = false;&nbsp;</div></li><li><div>                    --$x-&gt;curlyLevel;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_RIGHT_CURLY:&nbsp;</div></li><li><div>                    if (!$this-&gt;t-&gt;scanOperand && $x-&gt;curlyLevel != $cl)&nbsp;</div></li><li><div>                        throw new Exception('PANIC: right curly botch');&nbsp;</div></li><li><div>                break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_LEFT_PAREN:&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        array_push($operators, new JSNode($this-&gt;t, JS_GROUP));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        while (    !empty($operators) &&&nbsp;</div></li><li><div>                            $this-&gt;opPrecedence[end($operators)-&gt;type] &gt; $this-&gt;opPrecedence[KEYWORD_NEW]&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                            $this-&gt;reduce($operators, $operands);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // Handle () now, to regularize the n-ary case for n &gt; 0.&nbsp;</div></li><li><div>                        // We must set scanOperand in case there are arguments and&nbsp;</div></li><li><div>                        // the first one is a regexp or unary+/-.&nbsp;</div></li><li><div>                        $n = end($operators);&nbsp;</div></li><li><div>                        $this-&gt;t-&gt;scanOperand = true;&nbsp;</div></li><li><div>                        if ($this-&gt;t-&gt;match(OP_RIGHT_PAREN))&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            if ($n && $n-&gt;type == KEYWORD_NEW)&nbsp;</div></li><li><div>                            {&nbsp;</div></li><li><div>                                array_pop($operators);&nbsp;</div></li><li><div>                                $n-&gt;addNode(array_pop($operands));&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            else&nbsp;</div></li><li><div>                            {&nbsp;</div></li><li><div>                                $n = new JSNode($this-&gt;t, JS_CALL, array_pop($operands), new JSNode($this-&gt;t, JS_LIST));&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            array_push($operands, $n);&nbsp;</div></li><li><div>                            $this-&gt;t-&gt;scanOperand = false;&nbsp;</div></li><li><div>                            break;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ($n && $n-&gt;type == KEYWORD_NEW)&nbsp;</div></li><li><div>                            $n-&gt;type = JS_NEW_WITH_ARGS;&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            array_push($operators, new JSNode($this-&gt;t, JS_CALL));&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    ++$x-&gt;parenLevel;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case OP_RIGHT_PAREN:&nbsp;</div></li><li><div>                    if ($this-&gt;t-&gt;scanOperand || $x-&gt;parenLevel == $pl)&nbsp;</div></li><li><div>                        break 2;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    while (($tt = $this-&gt;reduce($operators, $operands)-&gt;type) != JS_GROUP &&&nbsp;</div></li><li><div>                        $tt != JS_CALL && $tt != JS_NEW_WITH_ARGS&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ($tt != JS_GROUP)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        $n = end($operands);&nbsp;</div></li><li><div>                        if ($n-&gt;treeNodes[1]-&gt;type != OP_COMMA)&nbsp;</div></li><li><div>                            $n-&gt;treeNodes[1] = new JSNode($this-&gt;t, JS_LIST, $n-&gt;treeNodes[1]);&nbsp;</div></li><li><div>                        else&nbsp;</div></li><li><div>                            $n-&gt;treeNodes[1]-&gt;type = JS_LIST;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    --$x-&gt;parenLevel;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Automatic semicolon insertion means we may scan across a newline&nbsp;</div></li><li><div>                // and into the beginning of another statement.  If so, break out of&nbsp;</div></li><li><div>                // the while loop and let the t.scanOperand logic handle errors.&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    break 2;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($x-&gt;hookLevel != $hl)&nbsp;</div></li><li><div>            throw $this-&gt;t-&gt;newSyntaxError('Missing : in conditional expression');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($x-&gt;parenLevel != $pl)&nbsp;</div></li><li><div>            throw $this-&gt;t-&gt;newSyntaxError('Missing ) in parenthetical');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($x-&gt;bracketLevel != $bl)&nbsp;</div></li><li><div>            throw $this-&gt;t-&gt;newSyntaxError('Missing ] in index expression');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;t-&gt;scanOperand)&nbsp;</div></li><li><div>            throw $this-&gt;t-&gt;newSyntaxError('Missing operand');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Resume default mode, scanning for operands, not operators.&nbsp;</div></li><li><div>        $this-&gt;t-&gt;scanOperand = true;&nbsp;</div></li><li><div>        $this-&gt;t-&gt;unget();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        while (count($operators))&nbsp;</div></li><li><div>            $this-&gt;reduce($operators, $operands);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return array_pop($operands);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function ParenExpression($x)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;t-&gt;mustMatch(OP_LEFT_PAREN);&nbsp;</div></li><li><div>        $n = $this-&gt;Expression($x);&nbsp;</div></li><li><div>        $this-&gt;t-&gt;mustMatch(OP_RIGHT_PAREN);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // Statement stack and nested statement handler.&nbsp;</div></li><li><div>    private function nest($x, $node, $end = false)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        array_push($x-&gt;stmtStack, $node);&nbsp;</div></li><li><div>        $n = $this-&gt;statement($x);&nbsp;</div></li><li><div>        array_pop($x-&gt;stmtStack);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($end)&nbsp;</div></li><li><div>            $this-&gt;t-&gt;mustMatch($end);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function reduce(&$operators, &$operands)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $n = array_pop($operators);&nbsp;</div></li><li><div>        $op = $n-&gt;type;&nbsp;</div></li><li><div>        $arity = $this-&gt;opArity[$op];&nbsp;</div></li><li><div>        $c = count($operands);&nbsp;</div></li><li><div>        if ($arity == -2)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Flatten left-associative trees&nbsp;</div></li><li><div>            if ($c &gt;= 2)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $left = $operands[$c - 2];&nbsp;</div></li><li><div>                if ($left-&gt;type == $op)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $right = array_pop($operands);&nbsp;</div></li><li><div>                    $left-&gt;addNode($right);&nbsp;</div></li><li><div>                    return $left;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $arity = 2;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Always use push to add operands to n, to update start and end&nbsp;</div></li><li><div>        $a = array_splice($operands, $c - $arity);&nbsp;</div></li><li><div>        for ($i = 0; $i &lt; $arity; $i++)&nbsp;</div></li><li><div>            $n-&gt;addNode($a[$i]);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Include closing bracket or postfix operator in [start, end]&nbsp;</div></li><li><div>        $te = $this-&gt;t-&gt;currentToken()-&gt;end;&nbsp;</div></li><li><div>        if ($n-&gt;end &lt; $te)&nbsp;</div></li><li><div>            $n-&gt;end = $te;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        array_push($operands, $n);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $n;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 0.9.5</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.4/classes/jsparser/" class="">0.9.5.4</a></li><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.3/classes/jsparser/" class="">0.9.5.3</a></li><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/classes/jsparser/" class="active">0.9.5.2</a></li><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.1/classes/jsparser/" class="">0.9.5.1</a></li><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5/classes/jsparser/" class="">0.9.5</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>JSParser</li><li><span></span>W3 Total Cache</li><li><span></span>0.9.5.4</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>