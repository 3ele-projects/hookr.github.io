<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="0.9.5.2" data-slug="w3-total-cache" data-type="class" data-id="94103"><head xmlns="http://www.w3.org/1999/xhtml"><title> cfruntime | class | W3 Total Cache | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="CFRuntime, class, plugin, w3-total-cache, 0.9.5.2" /><meta name="description" content="Core functionality and default settings shared across all SDK classes." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=fa0b7144730980a1b5c145d66c785a7e' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/cfruntime/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcfruntime%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Fcfruntime%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-w3-total-cache-0.9.5.2-class-cfruntime","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="cfruntime" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to w3-total-cache." href="http://hookr.io/plugins/w3-total-cache/" class="plugin"><span property="name">w3-total-cache</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 0.9.5.2." href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/" class="H_VERSION"><span property="name">0.9.5.2</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">cfruntime</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="1092"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/all/" title="All">All <span class="count badge">1092</span></a></li><li class="" data-id="new" data-count="204"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/new/" title="New">New <span class="count badge">204</span></a></li><li class="" data-id="hooks" data-count="155"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/hooks/" title="Hooks">Hooks <span class="count badge">155</span></a></li><li class="" data-id="action" data-count="69"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/actions/" title="Actions">Actions <span class="count badge">69</span></a></li><li class="" data-id="filter" data-count="86"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/filters/" title="Filters">Filters <span class="count badge">86</span></a></li><li class="active" data-id="class" data-count="629"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/classes/" title="Classes">Classes <span class="count badge">629</span></a></li><li class="" data-id="constant" data-count="229"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/constants/" title="Constants">Constants <span class="count badge">229</span></a></li><li class="" data-id="function" data-count="79"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/functions/" title="Functions">Functions <span class="count badge">79</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>CFRuntime</strong></h1><p>Core functionality and default settings shared across all SDK classes.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/files/lib-sns-sdk-class/" class="file">/lib/SNS/sdk.class.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="50" class="block" start="146"><li><div>class CFRuntime&nbsp;</div></li><li><div>{&nbsp;</div></li><li><div>    /**%******************************************************************************************%*/&nbsp;</div></li><li><div>    // CONSTANTS&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Name of the software.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const NAME = CFRUNTIME_NAME;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Version of the software.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const VERSION = CFRUNTIME_VERSION;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Build ID of the software.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const BUILD = CFRUNTIME_BUILD;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * User agent string used to identify the software.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const USERAGENT = CFRUNTIME_USERAGENT;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**%******************************************************************************************%*/&nbsp;</div></li><li><div>    // PROPERTIES&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The Amazon API Key.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $key;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The Amazon API Secret Key.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $secret_key;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The Amazon Authentication Token.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $auth_token;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The Amazon Account ID, without hyphens.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $account_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The Amazon Associates ID.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $assoc_id;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle for the utility functions.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $util;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * An identifier for the current AWS service.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $service = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The supported API version.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $api_version = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The state of whether auth should be handled as AWS Query.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $use_aws_query = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The default class to use for utilities (defaults to &lt;CFUtilities&gt;).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $utilities_class = 'CFUtilities';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The default class to use for HTTP requests (defaults to &lt;CFRequest&gt;).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $request_class = 'CFRequest';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The default class to use for HTTP responses (defaults to &lt;CFResponse&gt;).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $response_class = 'CFResponse';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The default class to use for parsing XML (defaults to &lt;CFSimpleXML&gt;).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $parser_class = 'CFSimpleXML';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The default class to use for handling batch requests (defaults to &lt;CFBatchRequest&gt;).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $batch_class = 'CFBatchRequest';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The number of seconds to adjust the request timestamp by (defaults to 0).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $adjust_offset = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The state of SSL/HTTPS use.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $use_ssl = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The state of SSL certificate verification.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $ssl_verification = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The proxy to use for connecting.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $proxy = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The alternate hostname to use, if any.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $hostname = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The state of the capability to override the hostname with &lt;set_hostname()&gt;.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $override_hostname = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The alternate port number to use, if any.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $port_number = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The alternate resource prefix to use, if any.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $resource_prefix = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The state of cache flow usage.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $use_cache_flow = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The caching class to use.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $cache_class = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The caching location to use.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $cache_location = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * When the cache should be considered stale.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $cache_expires = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The state of cache compression.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $cache_compress = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The current instantiated cache object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $cache_object = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The current instantiated batch request object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $batch_object = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The internally instantiated batch request object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $internal_batch_object = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The state of batch flow usage.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $use_batch_flow = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The state of the cache deletion setting.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $delete_cache = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The state of the debug mode setting.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $debug_mode = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The number of times to retry failed requests.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $max_retries = 3;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The user-defined callback function to call when a stream is read from.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $registered_streaming_read_callback = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The user-defined callback function to call when a stream is written to.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $registered_streaming_write_callback = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**%******************************************************************************************%*/&nbsp;</div></li><li><div>    // CONSTRUCTOR&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The constructor. You would not normally instantiate this class directly. Rather, you would instantiate&nbsp;</div></li><li><div>     * a service-specific class.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $key (Optional) Your AWS key, or a session key. If blank, it will look for the &lt;code&gt;AWS_KEY&lt;/code&gt; constant.&nbsp;</div></li><li><div>     * @param string $secret_key (Optional) Your AWS secret key, or a session secret key. If blank, it will look for the &lt;code&gt;AWS_SECRET_KEY&lt;/code&gt; constant.&nbsp;</div></li><li><div>     * @param string $token (optional) An AWS session token. If blank, a request will be made to the AWS Secure Token Service to fetch a set of session credentials.&nbsp;</div></li><li><div>     * @return boolean A value of `false` if no valid values are set, otherwise `true`.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct($key = null, $secret_key = null, $token = null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Instantiate the utilities class.&nbsp;</div></li><li><div>        $this-&gt;util = new $this-&gt;utilities_class();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Determine the current service.&nbsp;</div></li><li><div>        $this-&gt;service = get_class($this);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set default values&nbsp;</div></li><li><div>        $this-&gt;key = null;&nbsp;</div></li><li><div>        $this-&gt;secret_key = null;&nbsp;</div></li><li><div>        $this-&gt;auth_token = $token;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If both a key and secret key are passed in, use those.&nbsp;</div></li><li><div>        if ($key && $secret_key)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;key = $key;&nbsp;</div></li><li><div>            $this-&gt;secret_key = $secret_key;&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // If neither are passed in, look for the constants instead.&nbsp;</div></li><li><div>        elseif (defined('AWS_KEY') && defined('AWS_SECRET_KEY'))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;key = AWS_KEY;&nbsp;</div></li><li><div>            $this-&gt;secret_key = AWS_SECRET_KEY;&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Otherwise set the values to blank and return false.&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            throw new CFRuntime_Exception('No valid credentials were used to authenticate with AWS.');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handle session-based authentication for services that support it.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $key (Optional) Your AWS key, or a session key. If blank, it will look for the &lt;code&gt;AWS_KEY&lt;/code&gt; constant.&nbsp;</div></li><li><div>     * @param string $secret_key (Optional) Your AWS secret key, or a session secret key. If blank, it will look for the &lt;code&gt;AWS_SECRET_KEY&lt;/code&gt; constant.&nbsp;</div></li><li><div>     * @param string $token (optional) An AWS session token. If blank, a request will be made to the AWS Secure Token Service to fetch a set of session credentials.&nbsp;</div></li><li><div>     * @return boolean A value of `false` if no valid values are set, otherwise `true`.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function session_based_auth($key = null, $secret_key = null, $token = null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Instantiate the utilities class.&nbsp;</div></li><li><div>        $this-&gt;util = new $this-&gt;utilities_class();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Use 'em if we've got 'em&nbsp;</div></li><li><div>        if ($key && $secret_key && $token)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;key = $key;&nbsp;</div></li><li><div>            $this-&gt;secret_key = $secret_key;&nbsp;</div></li><li><div>            $this-&gt;auth_token = $token;&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if (!$key && !defined('AWS_KEY'))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // @codeCoverageIgnoreStart&nbsp;</div></li><li><div>                throw new CFRuntime_Exception('No account key was passed into the constructor, nor was it set in the AWS_KEY constant.');&nbsp;</div></li><li><div>                // @codeCoverageIgnoreEnd&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if (!$secret_key && !defined('AWS_SECRET_KEY'))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // @codeCoverageIgnoreStart&nbsp;</div></li><li><div>                throw new CFRuntime_Exception('No account secret was passed into the constructor, nor was it set in the AWS_SECRET_KEY constant.');&nbsp;</div></li><li><div>                // @codeCoverageIgnoreEnd&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If both a key and secret key are passed in, use those.&nbsp;</div></li><li><div>            if ($key && $secret_key)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;key = $key;&nbsp;</div></li><li><div>                $this-&gt;secret_key = $secret_key;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // If neither are passed in, look for the constants instead.&nbsp;</div></li><li><div>            elseif (defined('AWS_KEY') && defined('AWS_SECRET_KEY'))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;key = AWS_KEY;&nbsp;</div></li><li><div>                $this-&gt;secret_key = AWS_SECRET_KEY;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Determine storage type.&nbsp;</div></li><li><div>            $this-&gt;set_cache_config(AWS_DEFAULT_CACHE_CONFIG);&nbsp;</div></li><li><div>            $cache_class = $this-&gt;cache_class;&nbsp;</div></li><li><div>            $cache_object = new $cache_class('aws_active_session_credentials_' . get_class($this) . '_' . $this-&gt;key, AWS_DEFAULT_CACHE_CONFIG, 3600); // AWS_DEFAULT_CACHE_CONFIG only matters if it's a file system path.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Fetch session credentials&nbsp;</div></li><li><div>            $session_credentials = $cache_object-&gt;response_manager(array($this, 'cache_token'), array($this-&gt;key, $this-&gt;secret_key));&nbsp;</div></li><li><div>            $this-&gt;auth_token = $session_credentials['SessionToken'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If both a key and secret key are passed in, use those.&nbsp;</div></li><li><div>            if (isset($session_credentials['AccessKeyId']) && isset($session_credentials['SecretAccessKey']))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;key = $session_credentials['AccessKeyId'];&nbsp;</div></li><li><div>                $this-&gt;secret_key = $session_credentials['SecretAccessKey'];&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            // Otherwise set the values to blank and return false.&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                throw new CFRuntime_Exception('No valid credentials were used to authenticate with AWS.');&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The callback function that is executed  while caching the session credentials.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $key (Optional) Your AWS key, or a session key. If blank, it will look for the &lt;code&gt;AWS_KEY&lt;/code&gt; constant.&nbsp;</div></li><li><div>     * @param string $secret_key (Optional) Your AWS secret key, or a session secret key. If blank, it will look for the &lt;code&gt;AWS_SECRET_KEY&lt;/code&gt; constant.&nbsp;</div></li><li><div>     * @return mixed The data to be cached or null.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function cache_token($key, $secret_key)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $token = new AmazonSTS($key, $secret_key);&nbsp;</div></li><li><div>        $response = $token-&gt;get_session_token();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($response-&gt;isOK())&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>            Array&nbsp;</div></li><li><div>            (&nbsp;</div></li><li><div>                [AccessKeyId] =&gt; ******&nbsp;</div></li><li><div>                [Expiration] =&gt; ******&nbsp;</div></li><li><div>                [SecretAccessKey] =&gt; ******&nbsp;</div></li><li><div>                [SessionToken] =&gt; ******&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>            */&nbsp;</div></li><li><div>            return $response-&gt;body-&gt;GetSessionTokenResult-&gt;Credentials-&gt;to_array()-&gt;getArrayCopy();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return null;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Alternate approach to constructing a new instance. Supports chaining.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $key (Optional) Your AWS key, or a session key. If blank, it will look for the &lt;code&gt;AWS_KEY&lt;/code&gt; constant.&nbsp;</div></li><li><div>     * @param string $secret_key (Optional) Your AWS secret key, or a session secret key. If blank, it will look for the &lt;code&gt;AWS_SECRET_KEY&lt;/code&gt; constant.&nbsp;</div></li><li><div>     * @param string $token (optional) An AWS session token. If blank, a request will be made to the AWS Secure Token Service to fetch a set of session credentials.&nbsp;</div></li><li><div>     * @return boolean A value of `false` if no valid values are set, otherwise `true`.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function init($key = null, $secret_key = null, $token = null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if (version_compare(PHP_VERSION, '5.3.0', '&lt;'))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            throw new Exception('PHP 5.3 or newer is required to instantiate a new class with CLASS::init().');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $self = get_called_class();&nbsp;</div></li><li><div>        return new $self($key, $secret_key, $token);&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**%******************************************************************************************%*/&nbsp;</div></li><li><div>    // MAGIC METHODS&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * A magic method that allows `camelCase` method names to be translated into `snake_case` names.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $name (Required) The name of the method.&nbsp;</div></li><li><div>     * @param array $arguments (Required) The arguments passed to the method.&nbsp;</div></li><li><div>     * @return mixed The results of the intended method.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function  __call($name, $arguments)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Convert camelCase method calls to snake_case.&nbsp;</div></li><li><div>        $method_name = strtolower(preg_replace('/([a-z])([A-Z])/', '$1_$2', $name));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (method_exists($this, $method_name))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            return call_user_func_array(array($this, $method_name), $arguments);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        throw new CFRuntime_Exception('The method ' . $name . '() is undefined. Attempted to map to ' . $method_name . '() which is also undefined. Error occurred');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**%******************************************************************************************%*/&nbsp;</div></li><li><div>    // SET CUSTOM SETTINGS&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adjusts the current time. Use this method for occasions when a server is out of sync with Amazon&nbsp;</div></li><li><div>     * servers.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param integer $seconds (Required) The number of seconds to adjust the sent timestamp by.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function adjust_offset($seconds)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;adjust_offset = $seconds;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set the proxy settings to use.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $proxy (Required) Accepts proxy credentials in the following format: `proxy://user:pass@hostname:port`&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_proxy($proxy)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;proxy = $proxy;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set the hostname to connect to. This is useful for alternate services that are API-compatible with&nbsp;</div></li><li><div>     * AWS, but run from a different hostname.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $hostname (Required) The alternate hostname to use in place of the default one. Useful for mock or test applications living on different hostnames.&nbsp;</div></li><li><div>     * @param integer $port_number (Optional) The alternate port number to use in place of the default one. Useful for mock or test applications living on different port numbers.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_hostname($hostname, $port_number = null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;override_hostname)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;hostname = $hostname;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($port_number)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;port_number = $port_number;&nbsp;</div></li><li><div>                $this-&gt;hostname .= ':' . (string) $this-&gt;port_number;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set the resource prefix to use. This method is useful for alternate services that are API-compatible&nbsp;</div></li><li><div>     * with AWS.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $prefix (Required) An alternate prefix to prepend to the resource path. Useful for mock or test applications.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_resource_prefix($prefix)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;resource_prefix = $prefix;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Disables any subsequent use of the &lt;set_hostname()&gt; method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param boolean $override (Optional) Whether or not subsequent calls to &lt;set_hostname()&gt; should be obeyed. A `false` value disables the further effectiveness of &lt;set_hostname()&gt;. Defaults to `true`.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function allow_hostname_override($override = true)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;override_hostname = $override;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Disables SSL/HTTPS connections for hosts that don't support them. Some services, however, still&nbsp;</div></li><li><div>     * require SSL support.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This method will throw a user warning when invoked, which can be hidden by changing your&nbsp;</div></li><li><div>     * &lt;php:error_reporting()&gt; settings.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function disable_ssl()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        trigger_error('Disabling SSL connections is potentially unsafe and highly discouraged.', E_USER_WARNING);&nbsp;</div></li><li><div>        $this-&gt;use_ssl = false;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Disables the verification of the SSL Certificate Authority. Doing so can enable an attacker to carry&nbsp;</div></li><li><div>     * out a man-in-the-middle attack.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * https://secure.wikimedia.org/wikipedia/en/wiki/Man-in-the-middle_attack&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This method will throw a user warning when invoked, which can be hidden by changing your&nbsp;</div></li><li><div>     * &lt;php:error_reporting()&gt; settings.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function disable_ssl_verification($ssl_verification = false)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        trigger_error('Disabling the verification of SSL certificates can lead to man-in-the-middle attacks. It is potentially unsafe and highly discouraged.', E_USER_WARNING);&nbsp;</div></li><li><div>        $this-&gt;ssl_verification = $ssl_verification;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enables HTTP request/response header logging to `STDERR`.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param boolean $enabled (Optional) Whether or not to enable debug mode. Defaults to `true`.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function enable_debug_mode($enabled = true)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;debug_mode = $enabled;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sets the maximum number of times to retry failed requests.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param integer $retries (Optional) The maximum number of times to retry failed requests. Defaults to `3`.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_max_retries($retries = 3)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;max_retries = $retries;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set the caching configuration to use for response caching.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $location (Required) &lt;p&gt;The location to store the cache object in. This may vary by cache method.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;File - The local file system paths such as &lt;code&gt;./cache&lt;/code&gt; (relative) or &lt;code&gt;/tmp/cache/&lt;/code&gt; (absolute). The location must be server-writable.&lt;/li&gt;&lt;li&gt;APC - Pass in &lt;code&gt;apc&lt;/code&gt; to use this lightweight cache. You must have the &lt;a href=&quot;http://php.net/apc&quot;&gt;APC extension&lt;/a&gt; installed.&lt;/li&gt;&lt;li&gt;XCache - Pass in &lt;code&gt;xcache&lt;/code&gt; to use this lightweight cache. You must have the &lt;a href=&quot;http://xcache.lighttpd.net&quot;&gt;XCache&lt;/a&gt; extension installed.&lt;/li&gt;&lt;li&gt;Memcached - Pass in an indexed array of associative arrays. Each associative array should have a &lt;code&gt;host&lt;/code&gt; and a &lt;code&gt;port&lt;/code&gt; value representing a &lt;a href=&quot;http://php.net/memcached&quot;&gt;Memcached&lt;/a&gt; server to connect to.&lt;/li&gt;&lt;li&gt;PDO - A URL-style string (e.g. &lt;code&gt;pdo.mysql://user:pass@localhost/cache&lt;/code&gt;) or a standard DSN-style string (e.g. &lt;code&gt;pdo.sqlite:/sqlite/cache.db&lt;/code&gt;). MUST be prefixed with &lt;code&gt;pdo.&lt;/code&gt;. See &lt;code&gt;CachePDO&lt;/code&gt; and &lt;a href=&quot;http://php.net/pdo&quot;&gt;PDO&lt;/a&gt; for more details.&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>     * @param boolean $gzip (Optional) Whether or not data should be gzipped before being stored. A value of `true` will compress the contents before caching them. A value of `false` will leave the contents uncompressed. Defaults to `true`.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_cache_config($location, $gzip = true)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // If we have an array, we're probably passing in Memcached servers and ports.&nbsp;</div></li><li><div>        if (is_array($location))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;cache_class = 'CacheMC';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // I would expect locations like `/tmp/cache`, `pdo.mysql://user:pass@hostname:port`, `pdo.sqlite:memory:`, and `apc`.&nbsp;</div></li><li><div>            $type = strtolower(substr($location, 0, 3));&nbsp;</div></li><li><div>            switch ($type)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                case 'apc':&nbsp;</div></li><li><div>                    $this-&gt;cache_class = 'CacheAPC';&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'xca': // First three letters of `xcache`&nbsp;</div></li><li><div>                    $this-&gt;cache_class = 'CacheXCache';&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'pdo':&nbsp;</div></li><li><div>                    $this-&gt;cache_class = 'CachePDO';&nbsp;</div></li><li><div>                    $location = substr($location, 4);&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    $this-&gt;cache_class = 'CacheFile';&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set the remaining cache information.&nbsp;</div></li><li><div>        $this-&gt;cache_location = $location;&nbsp;</div></li><li><div>        $this-&gt;cache_compress = $gzip;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register a callback function to execute whenever a data stream is read from using&nbsp;</div></li><li><div>     * &lt;CFRequest::streaming_read_callback()&gt;.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The user-defined callback function should accept three arguments:&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * &lt;ul&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;&lt;code&gt;$curl_handle&lt;/code&gt; - &lt;code&gt;resource&lt;/code&gt; - Required - The cURL handle resource that represents the in-progress transfer.&lt;/li&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;&lt;code&gt;$file_handle&lt;/code&gt; - &lt;code&gt;resource&lt;/code&gt; - Required - The file handle resource that represents the file on the local file system.&lt;/li&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;&lt;code&gt;$length&lt;/code&gt; - &lt;code&gt;integer&lt;/code&gt; - Required - The length in kilobytes of the data chunk that was transferred.&lt;/li&gt;&nbsp;</div></li><li><div>     * &lt;/ul&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array|function $callback (Required) The callback function is called by &lt;php:call_user_func()&gt;, so you can pass the following values: &lt;ul&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;The name of a global function to execute, passed as a string.&lt;/li&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;A method to execute, passed as &lt;code&gt;array('ClassName', 'MethodName')&lt;/code&gt;.&lt;/li&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;An anonymous function (PHP 5.3+).&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function register_streaming_read_callback($callback)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;registered_streaming_read_callback = $callback;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register a callback function to execute whenever a data stream is written to using&nbsp;</div></li><li><div>     * &lt;CFRequest::streaming_write_callback()&gt;.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The user-defined callback function should accept two arguments:&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * &lt;ul&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;&lt;code&gt;$curl_handle&lt;/code&gt; - &lt;code&gt;resource&lt;/code&gt; - Required - The cURL handle resource that represents the in-progress transfer.&lt;/li&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;&lt;code&gt;$length&lt;/code&gt; - &lt;code&gt;integer&lt;/code&gt; - Required - The length in kilobytes of the data chunk that was transferred.&lt;/li&gt;&nbsp;</div></li><li><div>     * &lt;/ul&gt;&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|array|function $callback (Required) The callback function is called by &lt;php:call_user_func()&gt;, so you can pass the following values: &lt;ul&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;The name of a global function to execute, passed as a string.&lt;/li&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;A method to execute, passed as &lt;code&gt;array('ClassName', 'MethodName')&lt;/code&gt;.&lt;/li&gt;&nbsp;</div></li><li><div>     *     &lt;li&gt;An anonymous function (PHP 5.3+).&lt;/li&gt;&lt;/ul&gt;&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function register_streaming_write_callback($callback)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;registered_streaming_write_callback = $callback;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**%******************************************************************************************%*/&nbsp;</div></li><li><div>    // SET CUSTOM CLASSES&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set a custom class for this functionality. Use this method when extending/overriding existing classes&nbsp;</div></li><li><div>     * with new functionality.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The replacement class must extend from &lt;CFUtilities&gt;.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $class (Optional) The name of the new class to use for this functionality.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_utilities_class($class = 'CFUtilities')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;utilities_class = $class;&nbsp;</div></li><li><div>        $this-&gt;util = new $this-&gt;utilities_class();&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set a custom class for this functionality. Use this method when extending/overriding existing classes&nbsp;</div></li><li><div>     * with new functionality.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The replacement class must extend from &lt;CFRequest&gt;.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $class (Optional) The name of the new class to use for this functionality.&nbsp;</div></li><li><div>     * @param $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_request_class($class = 'CFRequest')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;request_class = $class;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set a custom class for this functionality. Use this method when extending/overriding existing classes&nbsp;</div></li><li><div>     * with new functionality.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The replacement class must extend from &lt;CFResponse&gt;.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $class (Optional) The name of the new class to use for this functionality.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_response_class($class = 'CFResponse')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;response_class = $class;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set a custom class for this functionality. Use this method when extending/overriding existing classes&nbsp;</div></li><li><div>     * with new functionality.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The replacement class must extend from &lt;CFSimpleXML&gt;.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $class (Optional) The name of the new class to use for this functionality.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_parser_class($class = 'CFSimpleXML')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;parser_class = $class;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set a custom class for this functionality. Use this method when extending/overriding existing classes&nbsp;</div></li><li><div>     * with new functionality.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The replacement class must extend from &lt;CFBatchRequest&gt;.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $class (Optional) The name of the new class to use for this functionality.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function set_batch_class($class = 'CFBatchRequest')&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;batch_class = $class;&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**%******************************************************************************************%*/&nbsp;</div></li><li><div>    // AUTHENTICATION&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Default, shared method for authenticating a connection to AWS. Overridden on a class-by-class basis&nbsp;</div></li><li><div>     * as necessary.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $action (Required) Indicates the action to perform.&nbsp;</div></li><li><div>     * @param array $opt (Optional) An associative array of parameters for authenticating. See the individual methods for allowed keys.&nbsp;</div></li><li><div>     * @param string $domain (Optional) The URL of the queue to perform the action on.&nbsp;</div></li><li><div>     * @param integer $signature_version (Optional) The signature version to use. Defaults to 2.&nbsp;</div></li><li><div>     * @param integer $redirects (Do Not Use) Used internally by this function on occasions when Amazon S3 returns a redirect code and it needs to call itself recursively.&nbsp;</div></li><li><div>     * @return CFResponse Object containing a parsed HTTP response.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function authenticate($action, $opt = null, $domain = null, $signature_version = 2, $redirects = 0)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Handle nulls&nbsp;</div></li><li><div>        if (is_null($signature_version))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $signature_version = 2;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $method_arguments = func_get_args();&nbsp;</div></li><li><div>        $headers = array();&nbsp;</div></li><li><div>        $signed_headers = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Use the caching flow to determine if we need to do a round-trip to the server.&nbsp;</div></li><li><div>        if ($this-&gt;use_cache_flow)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Generate an identifier specific to this particular set of arguments.&nbsp;</div></li><li><div>            $cache_id = $this-&gt;key . '_' . get_class($this) . '_' . $action . '_' . sha1(serialize($method_arguments));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Instantiate the appropriate caching object.&nbsp;</div></li><li><div>            $this-&gt;cache_object = new $this-&gt;cache_class($cache_id, $this-&gt;cache_location, $this-&gt;cache_expires, $this-&gt;cache_compress);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;delete_cache)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;use_cache_flow = false;&nbsp;</div></li><li><div>                $this-&gt;delete_cache = false;&nbsp;</div></li><li><div>                return $this-&gt;cache_object-&gt;delete();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Invoke the cache callback function to determine whether to pull data from the cache or make a fresh request.&nbsp;</div></li><li><div>            $data = $this-&gt;cache_object-&gt;response_manager(array($this, 'cache_callback'), $method_arguments);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Parse the XML body&nbsp;</div></li><li><div>            $data = $this-&gt;parse_callback($data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // End!&nbsp;</div></li><li><div>            return $data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $return_curl_handle = false;&nbsp;</div></li><li><div>        $x_amz_target = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do we have a custom resource prefix?&nbsp;</div></li><li><div>        if ($this-&gt;resource_prefix)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $domain .= $this-&gt;resource_prefix;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Determine signing values&nbsp;</div></li><li><div>        $current_time = time() + $this-&gt;adjust_offset;&nbsp;</div></li><li><div>        $date = gmdate(CFUtilities::DATE_FORMAT_RFC2616, $current_time);&nbsp;</div></li><li><div>        $timestamp = gmdate(CFUtilities::DATE_FORMAT_ISO8601, $current_time);&nbsp;</div></li><li><div>        $nonce = $this-&gt;util-&gt;generate_guid();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do we have an authentication token?&nbsp;</div></li><li><div>        if ($this-&gt;auth_token)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $headers['X-Amz-Security-Token'] = $this-&gt;auth_token;&nbsp;</div></li><li><div>            $query['SecurityToken'] = $this-&gt;auth_token;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Manage the key-value pairs that are used in the query.&nbsp;</div></li><li><div>        if (stripos($action, 'x-amz-target') !== false)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $x_amz_target = trim(str_ireplace('x-amz-target:', '', $action));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $query['Action'] = $action;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only add it if it exists.&nbsp;</div></li><li><div>        if ($this-&gt;api_version)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $query['Version'] = $this-&gt;api_version;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Only Signature v2&nbsp;</div></li><li><div>        if ($signature_version === 2)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $query['AWSAccessKeyId'] = $this-&gt;key;&nbsp;</div></li><li><div>            $query['SignatureMethod'] = 'HmacSHA256';&nbsp;</div></li><li><div>            $query['SignatureVersion'] = 2;&nbsp;</div></li><li><div>            $query['Timestamp'] = $timestamp;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $curlopts = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set custom CURLOPT settings&nbsp;</div></li><li><div>        if (is_array($opt) && isset($opt['curlopts']))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $curlopts = $opt['curlopts'];&nbsp;</div></li><li><div>            unset($opt['curlopts']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Merge in any options that were passed in&nbsp;</div></li><li><div>        if (is_array($opt))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $query = array_merge($query, $opt);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $return_curl_handle = isset($query['returnCurlHandle']) ? $query['returnCurlHandle'] : false;&nbsp;</div></li><li><div>        unset($query['returnCurlHandle']);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Do a case-sensitive, natural order sort on the array keys.&nbsp;</div></li><li><div>        uksort($query, 'strcmp');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Normalize JSON input&nbsp;</div></li><li><div>        if (isset($query['body']) && $query['body'] === '[]')&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $query['body'] = '{}';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;use_aws_query)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Create the string that needs to be hashed.&nbsp;</div></li><li><div>            $canonical_query_string = $this-&gt;util-&gt;to_signable_string($query);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Create the string that needs to be hashed.&nbsp;</div></li><li><div>            $canonical_query_string = $this-&gt;util-&gt;encode_signature2($query['body']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Remove the default scheme from the domain.&nbsp;</div></li><li><div>        $domain = str_replace(array('http://', 'https://'), '', $domain);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Parse our request.&nbsp;</div></li><li><div>        $parsed_url = parse_url('http://' . $domain);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set the proper host header.&nbsp;</div></li><li><div>        if (isset($parsed_url['port']) && (integer) $parsed_url['port'] !== 80 && (integer) $parsed_url['port'] !== 443)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $host_header = strtolower($parsed_url['host']) . ':' . $parsed_url['port'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $host_header = strtolower($parsed_url['host']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set the proper request URI.&nbsp;</div></li><li><div>        $request_uri = isset($parsed_url['path']) ? $parsed_url['path'] : '/';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($signature_version === 2)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Prepare the string to sign&nbsp;</div></li><li><div>            $string_to_sign = &quot;POST\n$host_header\n$request_uri\n$canonical_query_string&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Hash the AWS secret key and generate a signature for the request.&nbsp;</div></li><li><div>            $query['Signature'] = base64_encode(hash_hmac('sha256', $string_to_sign, $this-&gt;secret_key, true));&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Generate the querystring from $query&nbsp;</div></li><li><div>        $querystring = $this-&gt;util-&gt;to_query_string($query);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Gather information to pass along to other classes.&nbsp;</div></li><li><div>        $helpers = array(&nbsp;</div></li><li><div>            'utilities' =&gt; $this-&gt;utilities_class, &nbsp;</div></li><li><div>            'request' =&gt; $this-&gt;request_class, &nbsp;</div></li><li><div>            'response' =&gt; $this-&gt;response_class, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Compose the request.&nbsp;</div></li><li><div>        $request_url = ($this-&gt;use_ssl ? 'https://' : 'http://') . $domain;&nbsp;</div></li><li><div>        $request_url .= !isset($parsed_url['path']) ? '/' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Instantiate the request class&nbsp;</div></li><li><div>        $request = new $this-&gt;request_class($request_url, $this-&gt;proxy, $helpers);&nbsp;</div></li><li><div>        $request-&gt;set_method('POST');&nbsp;</div></li><li><div>        $request-&gt;set_body($querystring);&nbsp;</div></li><li><div>        $headers['Content-Type'] = 'application/x-www-form-urlencoded; charset=utf-8';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Signing using X-Amz-Target is handled differently.&nbsp;</div></li><li><div>        if ($signature_version === 3 && $x_amz_target)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $headers['X-Amz-Target'] = $x_amz_target;&nbsp;</div></li><li><div>            $headers['Content-Type'] = 'application/json; amzn-1.0';&nbsp;</div></li><li><div>            $headers['Content-Encoding'] = 'amz-1.0';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $request-&gt;set_body($query['body']);&nbsp;</div></li><li><div>            $querystring = $query['body'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Pass along registered stream callbacks&nbsp;</div></li><li><div>        if ($this-&gt;registered_streaming_read_callback)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $request-&gt;register_streaming_read_callback($this-&gt;registered_streaming_read_callback);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($this-&gt;registered_streaming_write_callback)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $request-&gt;register_streaming_write_callback($this-&gt;registered_streaming_write_callback);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add authentication headers&nbsp;</div></li><li><div>        if ($signature_version === 3)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $headers['X-Amz-Nonce'] = $nonce;&nbsp;</div></li><li><div>            $headers['Date'] = $date;&nbsp;</div></li><li><div>            $headers['Content-Length'] = strlen($querystring);&nbsp;</div></li><li><div>            $headers['Content-MD5'] = $this-&gt;util-&gt;hex_to_base64(md5($querystring));&nbsp;</div></li><li><div>            $headers['Host'] = $host_header;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Sort headers&nbsp;</div></li><li><div>        uksort($headers, 'strnatcasecmp');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($signature_version === 3 && $this-&gt;use_ssl)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Prepare the string to sign (HTTPS)&nbsp;</div></li><li><div>            $string_to_sign = $date . $nonce;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ($signature_version === 3 && !$this-&gt;use_ssl)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Prepare the string to sign (HTTP)&nbsp;</div></li><li><div>            $string_to_sign = &quot;POST\n$request_uri\n\n&quot;;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Add headers to request and compute the string to sign&nbsp;</div></li><li><div>        foreach ($headers as $header_key =&gt; $header_value)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Strip linebreaks from header values as they're illegal and can allow for security issues&nbsp;</div></li><li><div>            $header_value = str_replace(array(&quot;\r&quot;, &quot;\n&quot;), '', $header_value);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Add the header if it has a value&nbsp;</div></li><li><div>            if ($header_value !== '')&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $request-&gt;add_header($header_key, $header_value);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Signature v3 over HTTP&nbsp;</div></li><li><div>            if ($signature_version === 3 && !$this-&gt;use_ssl)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // Generate the string to sign&nbsp;</div></li><li><div>                if (&nbsp;</div></li><li><div>                    substr(strtolower($header_key), 0, 8) === 'content-' ||&nbsp;</div></li><li><div>                    strtolower($header_key) === 'date' ||&nbsp;</div></li><li><div>                    strtolower($header_key) === 'expires' ||&nbsp;</div></li><li><div>                    strtolower($header_key) === 'host' ||&nbsp;</div></li><li><div>                    substr(strtolower($header_key), 0, 6) === 'x-amz-'&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $string_to_sign .= strtolower($header_key) . ':' . $header_value . &quot;\n&quot;;&nbsp;</div></li><li><div>                    $signed_headers[] = $header_key;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ($signature_version === 3)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if (!$this-&gt;use_ssl)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $string_to_sign .= &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if (isset($query['body']) && $query['body'] !== '')&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $string_to_sign .= $query['body'];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Convert from string-to-sign to bytes-to-sign&nbsp;</div></li><li><div>                $bytes_to_sign = hash('sha256', $string_to_sign, true);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Hash the AWS secret key and generate a signature for the request.&nbsp;</div></li><li><div>                $signature = base64_encode(hash_hmac('sha256', $bytes_to_sign, $this-&gt;secret_key, true));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // Hash the AWS secret key and generate a signature for the request.&nbsp;</div></li><li><div>                $signature = base64_encode(hash_hmac('sha256', $string_to_sign, $this-&gt;secret_key, true));&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $headers['X-Amzn-Authorization'] = 'AWS3' . ($this-&gt;use_ssl ? '-HTTPS' : '')&nbsp;</div></li><li><div>                . ' AWSAccessKeyId=' . $this-&gt;key&nbsp;</div></li><li><div>                . ', Algorithm=HmacSHA256'&nbsp;</div></li><li><div>                . ', SignedHeaders=' . implode(';', $signed_headers)&nbsp;</div></li><li><div>                . ', Signature=' . $signature;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $request-&gt;add_header('X-Amzn-Authorization', $headers['X-Amzn-Authorization']);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Update RequestCore settings&nbsp;</div></li><li><div>        $request-&gt;request_class = $this-&gt;request_class;&nbsp;</div></li><li><div>        $request-&gt;response_class = $this-&gt;response_class;&nbsp;</div></li><li><div>        $request-&gt;ssl_verification = $this-&gt;ssl_verification;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Debug mode&nbsp;</div></li><li><div>        if ($this-&gt;debug_mode)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $request-&gt;debug_mode = $this-&gt;debug_mode;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (count($curlopts))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $request-&gt;set_curlopts($curlopts);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Manage the (newer) batch request API or the (older) returnCurlHandle setting.&nbsp;</div></li><li><div>        if ($this-&gt;use_batch_flow)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $handle = $request-&gt;prep_request();&nbsp;</div></li><li><div>            $this-&gt;batch_object-&gt;add($handle);&nbsp;</div></li><li><div>            $this-&gt;use_batch_flow = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return $handle;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ($return_curl_handle)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            return $request-&gt;prep_request();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Send!&nbsp;</div></li><li><div>        $request-&gt;send_request();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $request_headers = $headers;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Prepare the response.&nbsp;</div></li><li><div>        $headers = $request-&gt;get_response_header();&nbsp;</div></li><li><div>        $headers['x-aws-stringtosign'] = $string_to_sign;&nbsp;</div></li><li><div>        $headers['x-aws-request-headers'] = $request_headers;&nbsp;</div></li><li><div>        $headers['x-aws-body'] = $querystring;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $data = new $this-&gt;response_class($headers, $this-&gt;parse_callback($request-&gt;get_response_body(), $headers), $request-&gt;get_response_code());&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Was it Amazon's fault the request failed? Retry the request until we reach $max_retries.&nbsp;</div></li><li><div>        if ((integer) $request-&gt;get_response_code() === 500 || (integer) $request-&gt;get_response_code() === 503)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if ($redirects &lt;= $this-&gt;max_retries)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                // Exponential backoff&nbsp;</div></li><li><div>                $delay = (integer) (pow(4, $redirects) * 100000);&nbsp;</div></li><li><div>                usleep($delay);&nbsp;</div></li><li><div>                $data = $this-&gt;authenticate($action, $opt, $domain, $signature_version, ++$redirects);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $data;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**%******************************************************************************************%*/&nbsp;</div></li><li><div>    // BATCH REQUEST LAYER&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Specifies that the intended request should be queued for a later batch request.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param CFBatchRequest $queue (Optional) The &lt;CFBatchRequest&gt; instance to use for managing batch requests. If not available, it generates a new instance of &lt;CFBatchRequest&gt;.&nbsp;</div></li><li><div>     * @return $this A reference to the current instance.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function batch(CFBatchRequest &$queue = null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($queue)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;batch_object = $queue;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif ($this-&gt;internal_batch_object)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;batch_object = &$this-&gt;internal_batch_object;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;internal_batch_object = new $this-&gt;batch_class();&nbsp;</div></li><li><div>            $this-&gt;batch_object = &$this-&gt;internal_batch_object;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;use_batch_flow = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Executes the batch request queue by sending all queued requests.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param boolean $clear_after_send (Optional) Whether or not to clear the batch queue after sending a request. Defaults to `true`. Set this to `false` if you are caching batch responses and want to retrieve results later.&nbsp;</div></li><li><div>     * @return array An array of &lt;CFResponse&gt; objects.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function send($clear_after_send = true)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        if ($this-&gt;use_batch_flow)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // When we send the request, disable batch flow.&nbsp;</div></li><li><div>            $this-&gt;use_batch_flow = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // If we're not caching, simply send the request.&nbsp;</div></li><li><div>            if (!$this-&gt;use_cache_flow)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $response = $this-&gt;batch_object-&gt;send();&nbsp;</div></li><li><div>                $parsed_data = array_map(array($this, 'parse_callback'), $response);&nbsp;</div></li><li><div>                $parsed_data = new CFArray($parsed_data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Clear the queue&nbsp;</div></li><li><div>                if ($clear_after_send)&nbsp;</div></li><li><div>                {&nbsp;</div></li><li><div>                    $this-&gt;batch_object-&gt;queue = array();&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return $parsed_data;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Generate an identifier specific to this particular set of arguments.&nbsp;</div></li><li><div>            $cache_id = $this-&gt;key . '_' . get_class($this) . '_' . sha1(serialize($this-&gt;batch_object));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Instantiate the appropriate caching object.&nbsp;</div></li><li><div>            $this-&gt;cache_object = new $this-&gt;cache_class($cache_id, $this-&gt;cache_location, $this-&gt;cache_expires, $this-&gt;cache_compress);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ($this-&gt;delete_cache)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;use_cache_flow = false;&nbsp;</div></li><li><div>                $this-&gt;delete_cache = false;&nbsp;</div></li><li><div>                return $this-&gt;cache_object-&gt;delete();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Invoke the cache callback function to determine whether to pull data from the cache or make a fresh request.&nbsp;</div></li><li><div>            $data_set = $this-&gt;cache_object-&gt;response_manager(array($this, 'cache_callback_batch'), array($this-&gt;batch_object));&nbsp;</div></li><li><div>            $parsed_data = array_map(array($this, 'parse_callback'), $data_set);&nbsp;</div></li><li><div>            $parsed_data = new CFArray($parsed_data);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Clear the queue&nbsp;</div></li><li><div>            if ($clear_after_send)&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $this-&gt;batch_object-&gt;queue = array();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // End!&nbsp;</div></li><li><div>            return $parsed_data;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Load the class&nbsp;</div></li><li><div>        $null = new CFBatchRequest();&nbsp;</div></li><li><div>        unset($null);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        throw new CFBatchRequest_Exception('You must use $object-&gt;batch()-&gt;send()');&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Parses a response body into a PHP object if appropriate.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param CFResponse|string $response (Required) The &lt;CFResponse&gt; object to parse, or an XML string that would otherwise be a response body.&nbsp;</div></li><li><div>     * @param string $content_type (Optional) The content-type to use when determining how to parse the content.&nbsp;</div></li><li><div>     * @return CFResponse|string A parsed &lt;CFResponse&gt; object, or parsed XML.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function parse_callback($response, $headers = null)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Shorten this so we have a (mostly) single code path&nbsp;</div></li><li><div>        if (isset($response-&gt;body))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            if (is_string($response-&gt;body))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                $body = $response-&gt;body;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            else&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                return $response;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif (is_string($response))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $body = $response;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            return $response;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Decompress gzipped content&nbsp;</div></li><li><div>        if (isset($headers['content-encoding']))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            switch (strtolower(trim($headers['content-encoding'], &quot;\x09\x0A\x0D\x20&quot;)))&nbsp;</div></li><li><div>            {&nbsp;</div></li><li><div>                case 'gzip':&nbsp;</div></li><li><div>                case 'x-gzip':&nbsp;</div></li><li><div>                    if (strpos($headers['_info']['url'], 'monitoring.') !== false)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // CloudWatch incorrectly uses the deflate algorithm when they say gzip.&nbsp;</div></li><li><div>                        if (($uncompressed = gzuncompress($body)) !== false)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            $body = $uncompressed;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        elseif (($uncompressed = gzinflate($body)) !== false)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            $body = $uncompressed;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // Everyone else uses gzip correctly.&nbsp;</div></li><li><div>                        $decoder = new CFGzipDecode($body);&nbsp;</div></li><li><div>                        if ($decoder-&gt;parse())&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            $body = $decoder-&gt;data;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                case 'deflate':&nbsp;</div></li><li><div>                    if (strpos($headers['_info']['url'], 'monitoring.') !== false)&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // CloudWatchWatch incorrectly does nothing when they say deflate.&nbsp;</div></li><li><div>                        continue;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    else&nbsp;</div></li><li><div>                    {&nbsp;</div></li><li><div>                        // Everyone else uses deflate correctly.&nbsp;</div></li><li><div>                        if (($uncompressed = gzuncompress($body)) !== false)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            $body = $uncompressed;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        elseif (($uncompressed = gzinflate($body)) !== false)&nbsp;</div></li><li><div>                        {&nbsp;</div></li><li><div>                            $body = $uncompressed;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Look for XML cues&nbsp;</div></li><li><div>        if (&nbsp;</div></li><li><div>            (isset($headers['content-type']) && ($headers['content-type'] === 'text/xml' || $headers['content-type'] === 'application/xml')) || // We know it's XML&nbsp;</div></li><li><div>            (!isset($headers['content-type']) && (stripos($body, '&lt;?xml') === 0 || strpos($body, '&lt;Error&gt;') === 0) || preg_match('/^&lt;(\w*) xmlns=&quot;http(s?):\/\/(\w*).amazon(aws)?.com/im', $body)) // Sniff for XML&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Strip the default XML namespace to simplify XPath expressions&nbsp;</div></li><li><div>            $body = str_replace(&quot;xmlns=&quot;, &quot;ns=&quot;, $body);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Parse the XML body&nbsp;</div></li><li><div>            $body = new $this-&gt;parser_class($body);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        // Look for JSON cues&nbsp;</div></li><li><div>        elseif (&nbsp;</div></li><li><div>            (isset($headers['content-type']) && $headers['content-type'] === 'application/json') || // We know it's JSON&nbsp;</div></li><li><div>            (!isset($headers['content-type']) && $this-&gt;util-&gt;is_json($body)) // Sniff for JSON&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            // Normalize JSON to a CFSimpleXML object&nbsp;</div></li><li><div>            $body = CFJSON::to_xml($body);&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Put the parsed data back where it goes&nbsp;</div></li><li><div>        if (isset($response-&gt;body))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $response-&gt;body = $body;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        else&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $response = $body;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $response;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**%******************************************************************************************%*/&nbsp;</div></li><li><div>    // CACHING LAYER&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Specifies that the resulting &lt;CFResponse&gt; object should be cached according to the settings from&nbsp;</div></li><li><div>     * &lt;set_cache_config()&gt;.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string|integer $expires (Required) The time the cache is to expire. Accepts a number of seconds as an integer, or an amount of time, as a string, that is understood by &lt;php:strtotime()&gt; (e.g. &quot;1 hour&quot;).&nbsp;</div></li><li><div>     * @param $this A reference to the current instance.&nbsp;</div></li><li><div>     * @return $this&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function cache($expires)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Die if they haven't used set_cache_config().&nbsp;</div></li><li><div>        if (!$this-&gt;cache_class)&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            throw new CFRuntime_Exception('Must call set_cache_config() before using cache()');&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if (is_string($expires))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $expires = strtotime($expires);&nbsp;</div></li><li><div>            $this-&gt;cache_expires = $expires - time();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        elseif (is_int($expires))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $this-&gt;cache_expires = $expires;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;use_cache_flow = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The callback function that is executed when the cache doesn't exist or has expired. The response of&nbsp;</div></li><li><div>     * this method is cached. Accepts identical parameters as the &lt;authenticate()&gt; method. Never call this&nbsp;</div></li><li><div>     * method directly -- it is used internally by the caching system.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $action (Required) Indicates the action to perform.&nbsp;</div></li><li><div>     * @param array $opt (Optional) An associative array of parameters for authenticating. See the individual methods for allowed keys.&nbsp;</div></li><li><div>     * @param string $domain (Optional) The URL of the queue to perform the action on.&nbsp;</div></li><li><div>     * @param integer $signature_version (Optional) The signature version to use. Defaults to 2.&nbsp;</div></li><li><div>     * @return CFResponse A parsed HTTP response.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function cache_callback($action, $opt = null, $domain = null, $signature_version = 2)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        // Disable the cache flow since it's already been handled.&nbsp;</div></li><li><div>        $this-&gt;use_cache_flow = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make the request&nbsp;</div></li><li><div>        $response = $this-&gt;authenticate($action, $opt, $domain, $signature_version);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If this is an XML document, convert it back to a string.&nbsp;</div></li><li><div>        if (isset($response-&gt;body) && ($response-&gt;body instanceof SimpleXMLElement))&nbsp;</div></li><li><div>        {&nbsp;</div></li><li><div>            $response-&gt;body = $response-&gt;body-&gt;asXML();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $response;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Used for caching the results of a batch request. Never call this method directly; it is used&nbsp;</div></li><li><div>     * internally by the caching system.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param CFBatchRequest $batch (Required) The batch request object to send.&nbsp;</div></li><li><div>     * @return CFResponse A parsed HTTP response.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function cache_callback_batch(CFBatchRequest $batch)&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        return $batch-&gt;send();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Deletes a cached &lt;CFResponse&gt; object using the specified cache storage type.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return boolean A value of `true` if cached object exists and is successfully deleted, otherwise `false`.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function delete_cache()&nbsp;</div></li><li><div>    {&nbsp;</div></li><li><div>        $this-&gt;use_cache_flow = true;&nbsp;</div></li><li><div>        $this-&gt;delete_cache = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $this;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 0.9.5</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.4/classes/cfruntime/" class="">0.9.5.4</a></li><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.3/classes/cfruntime/" class="">0.9.5.3</a></li><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.2/classes/cfruntime/" class="active">0.9.5.2</a></li><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5.1/classes/cfruntime/" class="">0.9.5.1</a></li><li><a href="http://hookr.io/plugins/w3-total-cache/0.9.5/classes/cfruntime/" class="">0.9.5</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>CFRuntime</li><li><span></span>W3 Total Cache</li><li><span></span>0.9.5.4</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>