<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr file lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr file lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr file lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr file ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr file gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr file" data-site="plugin" data-version="4.0.1" data-slug="contact-form-7-signature-addon" data-type="file" data-id="25171"><head xmlns="http://www.w3.org/1999/xhtml"><title> includes-class-tgm-plugin-activation | file | Contact Form 7 Signature Addon | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="file, plugin, contact-form-7-signature-addon, 4.0.1" /><meta name="description" content="The WordPress Hook/API Index" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=55c6ad1c7a7dc3d54a7c64fce904603f' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/files/includes-class-tgm-plugin-activation/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-class-tgm-plugin-activation%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Ffiles%2Fincludes-class-tgm-plugin-activation%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-contact-form-7-signature-addon-4.0.1-file-includes-class-tgm-plugin-activation","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="includes-class-tgm-plugin-activation" class="single single-file"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to contact-form-7-signature-addon." href="http://hookr.io/plugins/contact-form-7-signature-addon/" class="plugin"><span property="name">contact-form-7-signature-addon</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.0.1." href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/" class="H_VERSION"><span property="name">4.0.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to files." href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/files/" class=""><span property="name">files</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">includes-class-tgm-plugin-act&hellip;</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="file"><ul role="navigation"><li class="" data-id="all" data-count="34"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/all/" title="All">All <span class="count badge">34</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="17"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/hooks/" title="Hooks">Hooks <span class="count badge">17</span></a></li><li class="" data-id="action" data-count="5"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/actions/" title="Actions">Actions <span class="count badge">5</span></a></li><li class="" data-id="filter" data-count="12"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/filters/" title="Filters">Filters <span class="count badge">12</span></a></li><li class="" data-id="class" data-count="11"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/classes/" title="Classes">Classes <span class="count badge">11</span></a></li><li class="" data-id="constant" data-count="2"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/constants/" title="Constants">Constants <span class="count badge">2</span></a></li><li class="" data-id="function" data-count="4"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/functions/" title="Functions">Functions <span class="count badge">4</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article> <section><h1>/includes/class-tgm-plugin-activation.php</h1><p><pre><ol  class="block" start="1"><li><div>&lt;?php&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * Plugin installation and activation for WordPress themes.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * Please note that this is a drop-in library for a theme or plugin.</span>&nbsp;</div></li><li><div><span class="comment"> * The authors of this library (Thomas, Gary and Juliette) are NOT responsible</span>&nbsp;</div></li><li><div><span class="comment"> * for the support of your plugin or theme. Please contact the plugin</span>&nbsp;</div></li><li><div><span class="comment"> * or theme author for support.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @package   TGM-Plugin-Activation</span>&nbsp;</div></li><li><div><span class="comment"> * @version   2.6.1</span>&nbsp;</div></li><li><div><span class="comment"> * @link      http://tgmpluginactivation.com/</span>&nbsp;</div></li><li><div><span class="comment"> * @author    Thomas Griffin, Gary Jones, Juliette Reinders Folmer</span>&nbsp;</div></li><li><div><span class="comment"> * @copyright Copyright (c) 2011, Thomas Griffin</span>&nbsp;</div></li><li><div><span class="comment"> * @license   GPL-2.0+</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">  Copyright 2011 Thomas Griffin (thomasgriffinmedia.com)</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  This program is free software; you can redistribute it and/or modify</span>&nbsp;</div></li><li><div><span class="comment">  it under the terms of the GNU General Public License, version 2, as</span>&nbsp;</div></li><li><div><span class="comment">  published by the Free Software Foundation.</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  This program is distributed in the hope that it will be useful, </span>&nbsp;</div></li><li><div><span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>&nbsp;</div></li><li><div><span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>&nbsp;</div></li><li><div><span class="comment">  GNU General Public License for more details.</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">  You should have received a copy of the GNU General Public License</span>&nbsp;</div></li><li><div><span class="comment">  along with this program; if not, write to the Free Software</span>&nbsp;</div></li><li><div><span class="comment">  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>&nbsp;</div></li><li><div><span class="comment">*/</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! class_exists( 'TGM_Plugin_Activation' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Automatic plugin installation and activation library.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Creates a way to automatically install and activate plugins from within themes.</span>&nbsp;</div></li><li><div><span class="comment">   * The plugins can be either bundled, downloaded from the WordPress</span>&nbsp;</div></li><li><div><span class="comment">   * Plugin Repository or downloaded from another external source.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @package TGM-Plugin-Activation</span>&nbsp;</div></li><li><div><span class="comment">   * @author  Thomas Griffin</span>&nbsp;</div></li><li><div><span class="comment">   * @author  Gary Jones</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  class TGM_Plugin_Activation {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * TGMPA version number.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @const string Version number.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      const TGMPA_VERSION = '2.6.1';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Regular expression to test if a URL is a WP plugin repo URL.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @const string Regex.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      const WP_REPO_REGEX = '|^http[s]?:<span class="comment">//wordpress\.org/(?:extend/)?plugins/|';</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Arbitrary regular expression to test if a string starts with a URL.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @const string Regex.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      const IS_URL_REGEX = '|^http[s]?:<span class="comment">//|';</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Holds a copy of itself, so it can be referenced by the class name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var TGM_Plugin_Activation</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static $instance;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Holds arrays of plugin details.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0 the array has the plugin slug as an associative key.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $plugins = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Holds arrays of plugin names to use to sort the plugins array.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected $sort_order = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Whether any plugins have the 'force_activation' setting set to true.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var bool</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected $has_forced_activation = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Whether any plugins have the 'force_deactivation' setting set to true.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var bool</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected $has_forced_deactivation = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Name of the unique ID to hash notices.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $id = 'tgmpa';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Name of the query-string argument for the admin page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected $menu = 'tgmpa-install-plugins';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Parent menu file slug.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $parent_slug = 'themes.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Capability needed to view the plugin installation menu item.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $capability = 'edit_theme_options';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Default absolute path to folder containing bundled plugin zip files.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var string Absolute path prefix to zip file location for bundled plugins. Default is empty string.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $default_path = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Flag to show admin notices or not.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $has_notices = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Flag to determine if the user can dismiss the notice nag.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $dismissable = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Message to be output above nag notice if dismissable is false.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $dismiss_msg = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Flag to set automatic activation of plugins. Off by default.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $is_automatic = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Optional message to display before the plugins table.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var string Message filtered by wp_kses_post(). Default is empty string.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $message = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Holds configurable array of strings.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Default values are added in the constructor.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $strings = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Holds the version of WordPress.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var int</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $wp_version;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Holds the hook name for the admin page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $page_hook;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Adds a reference of this object to $instance, populates default strings, </span>&nbsp;</div></li><li><div><span class="comment">       * does the tgmpa_init action hook, and hooks in the interactions to init.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * {@internal This method should be `protected`, but as too many TGMPA implementations</span>&nbsp;</div></li><li><div><span class="comment">       * haven't upgraded beyond v2.3.6 yet, this gives backward compatibility issues.</span>&nbsp;</div></li><li><div><span class="comment">       * Reverted back to public for the time being.}}</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @see TGM_Plugin_Activation::init()</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function __construct() {&nbsp;</div></li><li><div>          <span class="comment">// Set the current WordPress version.</span>&nbsp;</div></li><li><div>          $this-&gt;wp_version = $GLOBALS['wp_version'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Announce that the class is ready, and pass the object (for advanced use).</span>&nbsp;</div></li><li><div>          do_action_ref_array( 'tgmpa_init', array( $this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Load our text domain and allow for overloading the fall-back file.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * {@internal IMPORTANT! If this code changes, review the regex in the custom TGMPA</span>&nbsp;</div></li><li><div><span class="comment">           * generator on the website.}}</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          add_action( 'init', array( $this, 'load_textdomain' ), 5 );&nbsp;</div></li><li><div>          add_filter( 'load_textdomain_mofile', array( $this, 'overload_textdomain_mofile' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// When the rest of WP has loaded, kick-start the rest of the class.</span>&nbsp;</div></li><li><div>          add_action( 'init', array( $this, 'init' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Magic method to (not) set protected properties from outside of this class.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * {@internal hackedihack... There is a serious bug in v2.3.2 - 2.3.6  where the `menu` property</span>&nbsp;</div></li><li><div><span class="comment">       * is being assigned rather than tested in a conditional, effectively rendering it useless.</span>&nbsp;</div></li><li><div><span class="comment">       * This 'hack' prevents this from happening.}}</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @see https://github.com/TGMPA/TGM-Plugin-Activation/blob/2.3.6/tgm-plugin-activation/class-tgm-plugin-activation.php#L1593</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.2</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $name  Name of an inaccessible property.</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed  $value Value to assign to the property.</span>&nbsp;</div></li><li><div><span class="comment">       * @return void  Silently fail to set the property when this is tried from outside of this class context.</span>&nbsp;</div></li><li><div><span class="comment">       *               (Inside this class context, the __set() method if not used as there is direct access.)</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function __set( $name, $value ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Magic method to get the value of a protected property outside of this class context.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.2</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $name Name of an inaccessible property.</span>&nbsp;</div></li><li><div><span class="comment">       * @return mixed The property value.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function __get( $name ) {&nbsp;</div></li><li><div>          return $this-&gt;{$name};&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Initialise the interactions between this class and WordPress.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Hooks in three new methods for the class: admin_menu, notices and styles.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @see TGM_Plugin_Activation::admin_menu()</span>&nbsp;</div></li><li><div><span class="comment">       * @see TGM_Plugin_Activation::notices()</span>&nbsp;</div></li><li><div><span class="comment">       * @see TGM_Plugin_Activation::styles()</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function init() {&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * By default TGMPA only loads on the WP back-end and not in an Ajax call. Using this filter</span>&nbsp;</div></li><li><div><span class="comment">           * you can overrule that behaviour.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param bool $load Whether or not TGMPA should load.</span>&nbsp;</div></li><li><div><span class="comment">           *                   Defaults to the return of `is_admin() && ! defined( 'DOING_AJAX' )`.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          if ( true !== apply_filters( 'tgmpa_load', ( is_admin() && ! defined( 'DOING_AJAX' ) ) ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Load class strings.</span>&nbsp;</div></li><li><div>          $this-&gt;strings = array(&nbsp;</div></li><li><div>              'page_title' =&gt; __( 'Install Required Plugins', 'tgmpa' ), &nbsp;</div></li><li><div>              'menu_title' =&gt; __( 'Install Plugins', 'tgmpa' ), &nbsp;</div></li><li><div>              <span class="comment"><span class="comment">/** translators: %s: plugin name. */</span></span>&nbsp;</div></li><li><div>              'installing' =&gt; __( 'Installing Plugin: %s', 'tgmpa' ), &nbsp;</div></li><li><div>              <span class="comment"><span class="comment">/** translators: %s: plugin name. */</span></span>&nbsp;</div></li><li><div>              'updating' =&gt; __( 'Updating Plugin: %s', 'tgmpa' ), &nbsp;</div></li><li><div>              'oops' =&gt; __( 'Something went wrong with the plugin API.', 'tgmpa' ), &nbsp;</div></li><li><div>              'notice_can_install_required' =&gt; _n_noop(&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name(s). */</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'This theme requires the following plugin: %1$s.', &nbsp;</div></li><li><div>                  'This theme requires the following plugins: %1$s.', &nbsp;</div></li><li><div>                  'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'notice_can_install_recommended' =&gt; _n_noop(&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name(s). */</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'This theme recommends the following plugin: %1$s.', &nbsp;</div></li><li><div>                  'This theme recommends the following plugins: %1$s.', &nbsp;</div></li><li><div>                  'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'notice_ask_to_update' =&gt; _n_noop(&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name(s). */</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'The following plugin needs to be updated to its latest version to ensure maximum compatibility with this theme: %1$s.', &nbsp;</div></li><li><div>                  'The following plugins need to be updated to their latest version to ensure maximum compatibility with this theme: %1$s.', &nbsp;</div></li><li><div>                  'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'notice_ask_to_update_maybe' =&gt; _n_noop(&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name(s). */</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'There is an update available for: %1$s.', &nbsp;</div></li><li><div>                  'There are updates available for the following plugins: %1$s.', &nbsp;</div></li><li><div>                  'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'notice_can_activate_required' =&gt; _n_noop(&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name(s). */</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'The following required plugin is currently inactive: %1$s.', &nbsp;</div></li><li><div>                  'The following required plugins are currently inactive: %1$s.', &nbsp;</div></li><li><div>                  'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'notice_can_activate_recommended' =&gt; _n_noop(&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name(s). */</span></span></span></span></span></span>&nbsp;</div></li><li><div>                  'The following recommended plugin is currently inactive: %1$s.', &nbsp;</div></li><li><div>                  'The following recommended plugins are currently inactive: %1$s.', &nbsp;</div></li><li><div>                  'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'install_link' =&gt; _n_noop(&nbsp;</div></li><li><div>                  'Begin installing plugin', &nbsp;</div></li><li><div>                  'Begin installing plugins', &nbsp;</div></li><li><div>                  'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'update_link' =&gt; _n_noop(&nbsp;</div></li><li><div>                  'Begin updating plugin', &nbsp;</div></li><li><div>                  'Begin updating plugins', &nbsp;</div></li><li><div>                  'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'activate_link' =&gt; _n_noop(&nbsp;</div></li><li><div>                  'Begin activating plugin', &nbsp;</div></li><li><div>                  'Begin activating plugins', &nbsp;</div></li><li><div>                  'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              'return' =&gt; __( 'Return to Required Plugins Installer', 'tgmpa' ), &nbsp;</div></li><li><div>              'dashboard' =&gt; __( 'Return to the Dashboard', 'tgmpa' ), &nbsp;</div></li><li><div>              'plugin_activated' =&gt; __( 'Plugin activated successfully.', 'tgmpa' ), &nbsp;</div></li><li><div>              'activated_successfully' =&gt; __( 'The following plugin was activated successfully:', 'tgmpa' ), &nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name. */</span></span></span></span></span>&nbsp;</div></li><li><div>              'plugin_already_active' =&gt; __( 'No action taken. Plugin %1$s was already active.', 'tgmpa' ), &nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name. */</span></span></span></span></span>&nbsp;</div></li><li><div>              'plugin_needs_higher_version' =&gt; __( 'Plugin not activated. A higher version of %s is needed for this theme. Please update the plugin.', 'tgmpa' ), &nbsp;</div></li><li><div>              <span class="comment">/** translators: 1: dashboard link. */</span>&nbsp;</div></li><li><div>              'complete' =&gt; __( 'All plugins installed and activated successfully. %1$s', 'tgmpa' ), &nbsp;</div></li><li><div>              'dismiss' =&gt; __( 'Dismiss this notice', 'tgmpa' ), &nbsp;</div></li><li><div>              'notice_cannot_install_activate' =&gt; __( 'There are one or more required or recommended plugins to install, update or activate.', 'tgmpa' ), &nbsp;</div></li><li><div>              'contact_admin' =&gt; __( 'Please contact the administrator of this site for help.', 'tgmpa' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          do_action( 'tgmpa_register' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/** After this point, the plugins should be registered and the configuration set. */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Proceed only if we have plugins to handle.</span>&nbsp;</div></li><li><div>          if ( empty( $this-&gt;plugins ) || ! is_array( $this-&gt;plugins ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set up the menu and notices if we still have outstanding actions.</span>&nbsp;</div></li><li><div>          if ( true !== $this-&gt;is_tgmpa_complete() ) {&nbsp;</div></li><li><div>              <span class="comment">// Sort the plugins.</span>&nbsp;</div></li><li><div>              array_multisort( $this-&gt;sort_order, SORT_ASC, $this-&gt;plugins );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              add_action( 'admin_menu', array( $this, 'admin_menu' ) );&nbsp;</div></li><li><div>              add_action( 'admin_head', array( $this, 'dismiss' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Prevent the normal links from showing underneath a single install/update page.</span>&nbsp;</div></li><li><div>              add_filter( 'install_plugin_complete_actions', array( $this, 'actions' ) );&nbsp;</div></li><li><div>              add_filter( 'update_plugin_complete_actions', array( $this, 'actions' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( $this-&gt;has_notices ) {&nbsp;</div></li><li><div>                  add_action( 'admin_notices', array( $this, 'notices' ) );&nbsp;</div></li><li><div>                  add_action( 'admin_init', array( $this, 'admin_init' ), 1 );&nbsp;</div></li><li><div>                  add_action( 'admin_enqueue_scripts', array( $this, 'thickbox' ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If needed, filter plugin action links.</span>&nbsp;</div></li><li><div>          add_action( 'load-plugins.php', array( $this, 'add_plugin_action_link_filters' ), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Make sure things get reset on switch theme.</span>&nbsp;</div></li><li><div>          add_action( 'switch_theme', array( $this, 'flush_plugins_cache' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;has_notices ) {&nbsp;</div></li><li><div>              add_action( 'switch_theme', array( $this, 'update_dismiss' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Setup the force activation hook.</span>&nbsp;</div></li><li><div>          if ( true === $this-&gt;has_forced_activation ) {&nbsp;</div></li><li><div>              add_action( 'admin_init', array( $this, 'force_activation' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Setup the force deactivation hook.</span>&nbsp;</div></li><li><div>          if ( true === $this-&gt;has_forced_deactivation ) {&nbsp;</div></li><li><div>              add_action( 'switch_theme', array( $this, 'force_deactivation' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Load translations.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * (@internal Uses `load_theme_textdomain()` rather than `load_plugin_textdomain()` to</span>&nbsp;</div></li><li><div><span class="comment">       * get round the different ways of handling the path and deprecated notices being thrown</span>&nbsp;</div></li><li><div><span class="comment">       * and such. For plugins, the actual file name will be corrected by a filter.}}</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * {@internal IMPORTANT! If this function changes, review the regex in the custom TGMPA</span>&nbsp;</div></li><li><div><span class="comment">       * generator on the website.}}</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function load_textdomain() {&nbsp;</div></li><li><div>          if ( is_textdomain_loaded( 'tgmpa' ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( false !== strpos( __FILE__, WP_PLUGIN_DIR ) || false !== strpos( __FILE__, WPMU_PLUGIN_DIR ) ) {&nbsp;</div></li><li><div>              <span class="comment">// Plugin, we'll need to adjust the file name.</span>&nbsp;</div></li><li><div>              add_action( 'load_textdomain_mofile', array( $this, 'correct_plugin_mofile' ), 10, 2 );&nbsp;</div></li><li><div>              load_theme_textdomain( 'tgmpa', dirname( __FILE__ ) . '/languages' );&nbsp;</div></li><li><div>              remove_action( 'load_textdomain_mofile', array( $this, 'correct_plugin_mofile' ), 10 );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              load_theme_textdomain( 'tgmpa', dirname( __FILE__ ) . '/languages' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Correct the .mo file name for (must-use) plugins.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Themese use `/path/{locale}.mo` while plugins use `/path/{text-domain}-{locale}.mo`.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * {@internal IMPORTANT! If this function changes, review the regex in the custom TGMPA</span>&nbsp;</div></li><li><div><span class="comment">       * generator on the website.}}</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $mofile Full path to the target mofile.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $domain The domain for which a language file is being loaded.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string $mofile</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function correct_plugin_mofile( $mofile, $domain ) {&nbsp;</div></li><li><div>          <span class="comment">// Exit early if not our domain (just in case).</span>&nbsp;</div></li><li><div>          if ( 'tgmpa' !== $domain ) {&nbsp;</div></li><li><div>              return $mofile;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          return preg_replace( '`/([a-z]{2}_[A-Z]{2}.mo)$`', '/tgmpa-$1', $mofile );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Potentially overload the fall-back translation file for the current language.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * WP, by default since WP 3.7, will load a local translation first and if none</span>&nbsp;</div></li><li><div><span class="comment">       * can be found, will try and find a translation in the /wp-content/languages/ directory.</span>&nbsp;</div></li><li><div><span class="comment">       * As this library is theme/plugin agnostic, translation files for TGMPA can exist both</span>&nbsp;</div></li><li><div><span class="comment">       * in the WP_LANG_DIR /plugins/ subdirectory as well as in the /themes/ subdirectory.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * This method makes sure both directories are checked.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * {@internal IMPORTANT! If this function changes, review the regex in the custom TGMPA</span>&nbsp;</div></li><li><div><span class="comment">       * generator on the website.}}</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $mofile Full path to the target mofile.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $domain The domain for which a language file is being loaded.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string $mofile</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function overload_textdomain_mofile( $mofile, $domain ) {&nbsp;</div></li><li><div>          <span class="comment">// Exit early if not our domain, not a WP_LANG_DIR load or if the file exists and is readable.</span>&nbsp;</div></li><li><div>          if ( 'tgmpa' !== $domain || false === strpos( $mofile, WP_LANG_DIR ) || @is_readable( $mofile ) ) {&nbsp;</div></li><li><div>              return $mofile;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Current fallback file is not valid, let's try the alternative option.</span>&nbsp;</div></li><li><div>          if ( false !== strpos( $mofile, '/themes/' ) ) {&nbsp;</div></li><li><div>              return str_replace( '/themes/', '/plugins/', $mofile );&nbsp;</div></li><li><div>          } elseif ( false !== strpos( $mofile, '/plugins/' ) ) {&nbsp;</div></li><li><div>              return str_replace( '/plugins/', '/themes/', $mofile );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return $mofile;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Hook in plugin action link filters for the WP native plugins page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * - Prevent activation of plugins which don't meet the minimum version requirements.</span>&nbsp;</div></li><li><div><span class="comment">       * - Prevent deactivation of force-activated plugins.</span>&nbsp;</div></li><li><div><span class="comment">       * - Add update notice if update available.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function add_plugin_action_link_filters() {&nbsp;</div></li><li><div>          foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>              if ( false === $this-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>                  add_filter( 'plugin_action_links_' . $plugin['file_path'], array( $this, 'filter_plugin_action_links_activate' ), 20 );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( true === $plugin['force_activation'] ) {&nbsp;</div></li><li><div>                  add_filter( 'plugin_action_links_' . $plugin['file_path'], array( $this, 'filter_plugin_action_links_deactivate' ), 20 );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( false !== $this-&gt;does_plugin_require_update( $slug ) ) {&nbsp;</div></li><li><div>                  add_filter( 'plugin_action_links_' . $plugin['file_path'], array( $this, 'filter_plugin_action_links_update' ), 20 );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Remove the 'Activate' link on the WP native plugins page if the plugin does not meet the</span>&nbsp;</div></li><li><div><span class="comment">       * minimum version requirements.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $actions Action links.</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function filter_plugin_action_links_activate( $actions ) {&nbsp;</div></li><li><div>          unset( $actions['activate'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $actions;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Remove the 'Deactivate' link on the WP native plugins page if the plugin has been set to force activate.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $actions Action links.</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function filter_plugin_action_links_deactivate( $actions ) {&nbsp;</div></li><li><div>          unset( $actions['deactivate'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $actions;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add a 'Requires update' link on the WP native plugins page if the plugin does not meet the</span>&nbsp;</div></li><li><div><span class="comment">       * minimum version requirements.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $actions Action links.</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function filter_plugin_action_links_update( $actions ) {&nbsp;</div></li><li><div>          $actions['update'] = sprintf(&nbsp;</div></li><li><div>              '&lt;a href=&quot;%1$s&quot; title=&quot;%2$s&quot; class=&quot;edit&quot;&gt;%3$s&lt;/a&gt;', &nbsp;</div></li><li><div>              esc_url( $this-&gt;get_tgmpa_status_url( 'update' ) ), &nbsp;</div></li><li><div>              esc_attr__( 'This plugin needs to be updated to be compatible with your theme.', 'tgmpa' ), &nbsp;</div></li><li><div>              esc_html__( 'Update Required', 'tgmpa' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $actions;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Handles calls to show plugin information via links in the notices.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * We get the links in the admin notices to point to the TGMPA page, rather</span>&nbsp;</div></li><li><div><span class="comment">       * than the typical plugin-install.php file, so we can prepare everything</span>&nbsp;</div></li><li><div><span class="comment">       * beforehand.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * WP does not make it easy to show the plugin information in the thickbox -</span>&nbsp;</div></li><li><div><span class="comment">       * here we have to require a file that includes a function that does the</span>&nbsp;</div></li><li><div><span class="comment">       * main work of displaying it, enqueue some styles, set up some globals and</span>&nbsp;</div></li><li><div><span class="comment">       * finally call that function before exiting.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Down right easy once you know how...</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Returns early if not the TGMPA page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @global string $tab Used as iframe div class names, helps with styling</span>&nbsp;</div></li><li><div><span class="comment">       * @global string $body_id Used as the iframe body ID, helps with styling</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return null Returns early if not the TGMPA page.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function admin_init() {&nbsp;</div></li><li><div>          if ( ! $this-&gt;is_tgmpa_page() ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_REQUEST['tab'] ) && 'plugin-information' === $_REQUEST['tab'] ) {&nbsp;</div></li><li><div>              <span class="comment">// Needed for install_plugin_information().</span>&nbsp;</div></li><li><div>              require_once ABSPATH . 'wp-admin/includes/plugin-install.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              wp_enqueue_style( 'plugin-install' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              global $tab, $body_id;&nbsp;</div></li><li><div>              $body_id = 'plugin-information';&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// @codingStandardsIgnoreStart</span></span>&nbsp;</div></li><li><div>              $tab = 'plugin-information';&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// @codingStandardsIgnoreEnd</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              install_plugin_information();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              exit;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Enqueue thickbox scripts/styles for plugin info.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Thickbox is not automatically included on all admin pages, so we must</span>&nbsp;</div></li><li><div><span class="comment">       * manually enqueue it for those pages.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Thickbox is only loaded if the user has not dismissed the admin</span>&nbsp;</div></li><li><div><span class="comment">       * notice or if there are any plugins left to install and activate.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function thickbox() {&nbsp;</div></li><li><div>          if ( ! get_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice_' . $this-&gt;id, true ) ) {&nbsp;</div></li><li><div>              add_thickbox();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Adds submenu page if there are plugin actions to take.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * This method adds the submenu page letting users know that a required</span>&nbsp;</div></li><li><div><span class="comment">       * plugin needs to be installed.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * This page disappears once the plugin has been installed and activated.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @see TGM_Plugin_Activation::init()</span>&nbsp;</div></li><li><div><span class="comment">       * @see TGM_Plugin_Activation::install_plugins_page()</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return null Return early if user lacks capability to install a plugin.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function admin_menu() {&nbsp;</div></li><li><div>          <span class="comment">// Make sure privileges are correct to see the page.</span>&nbsp;</div></li><li><div>          if ( ! current_user_can( 'install_plugins' ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $args = apply_filters(&nbsp;</div></li><li><div>              'tgmpa_admin_menu_args', &nbsp;</div></li><li><div>              array(&nbsp;</div></li><li><div>                  'parent_slug' =&gt; $this-&gt;parent_slug, <span class="comment">// Parent Menu slug.</span>&nbsp;</div></li><li><div>                  'page_title' =&gt; $this-&gt;strings['page_title'], <span class="comment">// Page title.</span>&nbsp;</div></li><li><div>                  'menu_title' =&gt; $this-&gt;strings['menu_title'], <span class="comment">// Menu title.</span>&nbsp;</div></li><li><div>                  'capability' =&gt; $this-&gt;capability, <span class="comment">// Capability.</span>&nbsp;</div></li><li><div>                  'menu_slug' =&gt; $this-&gt;menu, <span class="comment">// Menu slug.</span>&nbsp;</div></li><li><div>                  'function' =&gt; array( $this, 'install_plugins_page' ), <span class="comment">// Callback.</span>&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $this-&gt;add_admin_menu( $args );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add the menu item.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * {@internal IMPORTANT! If this function changes, review the regex in the custom TGMPA</span>&nbsp;</div></li><li><div><span class="comment">       * generator on the website.}}</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $args Menu item configuration.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function add_admin_menu( array $args ) {&nbsp;</div></li><li><div>          if ( has_filter( 'tgmpa_admin_menu_use_add_theme_page' ) ) {&nbsp;</div></li><li><div>              _deprecated_function( 'The &quot;tgmpa_admin_menu_use_add_theme_page&quot; filter', '2.5.0', esc_html__( 'Set the parent_slug config variable instead.', 'tgmpa' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'themes.php' === $this-&gt;parent_slug ) {&nbsp;</div></li><li><div>              $this-&gt;page_hook = call_user_func( 'add_theme_page', $args['page_title'], $args['menu_title'], $args['capability'], $args['menu_slug'], $args['function'] );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $this-&gt;page_hook = call_user_func( 'add_submenu_page', $args['parent_slug'], $args['page_title'], $args['menu_title'], $args['capability'], $args['menu_slug'], $args['function'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Echoes plugin installation form.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * This method is the callback for the admin_menu method function.</span>&nbsp;</div></li><li><div><span class="comment">       * This displays the admin page and form area where the user can select to install and activate the plugin.</span>&nbsp;</div></li><li><div><span class="comment">       * Aborts early if we're processing a plugin installation action.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return null Aborts early if we're processing a plugin installation action.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function install_plugins_page() {&nbsp;</div></li><li><div>          <span class="comment">// Store new instance of plugin table in object.</span>&nbsp;</div></li><li><div>          $plugin_table = new TGMPA_List_Table;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Return early if processing a plugin installation action.</span>&nbsp;</div></li><li><div>          if ( ( ( 'tgmpa-bulk-install' === $plugin_table-&gt;current_action() || 'tgmpa-bulk-update' === $plugin_table-&gt;current_action() ) && $plugin_table-&gt;process_bulk_actions() ) || $this-&gt;do_plugin_install() ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Force refresh of available plugin information so we'll know about manual updates/deletes.</span>&nbsp;</div></li><li><div>          wp_clean_plugins_cache( false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          ?&gt;&nbsp;</div></li><li><div>          &lt;div class=&quot;tgmpa wrap&quot;&gt;&nbsp;</div></li><li><div>              &lt;h1&gt;&lt;?php echo esc_html( get_admin_page_title() ); ?&gt;&lt;/h1&gt;&nbsp;</div></li><li><div>              &lt;?php $plugin_table-&gt;prepare_items(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;?php&nbsp;</div></li><li><div>              if ( ! empty( $this-&gt;message ) && is_string( $this-&gt;message ) ) {&nbsp;</div></li><li><div>                  echo wp_kses_post( $this-&gt;message );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              ?&gt;&nbsp;</div></li><li><div>              &lt;?php $plugin_table-&gt;views(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              &lt;form id=&quot;tgmpa-plugins&quot; action=&quot;&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;hidden&quot; name=&quot;tgmpa-page&quot; value=&quot;&lt;?php echo esc_attr( $this-&gt;menu ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                  &lt;input type=&quot;hidden&quot; name=&quot;plugin_status&quot; value=&quot;&lt;?php echo esc_attr( $plugin_table-&gt;view_context ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                  &lt;?php $plugin_table-&gt;display(); ?&gt;&nbsp;</div></li><li><div>              &lt;/form&gt;&nbsp;</div></li><li><div>          &lt;/div&gt;&nbsp;</div></li><li><div>          &lt;?php&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Installs, updates or activates a plugin depending on the action link clicked by the user.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Checks the $_GET variable to see which actions have been</span>&nbsp;</div></li><li><div><span class="comment">       * passed and responds with the appropriate method.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Uses WP_Filesystem to process and handle the plugin installation</span>&nbsp;</div></li><li><div><span class="comment">       * method.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @uses WP_Filesystem</span>&nbsp;</div></li><li><div><span class="comment">       * @uses WP_Error</span>&nbsp;</div></li><li><div><span class="comment">       * @uses WP_Upgrader</span>&nbsp;</div></li><li><div><span class="comment">       * @uses Plugin_Upgrader</span>&nbsp;</div></li><li><div><span class="comment">       * @uses Plugin_Installer_Skin</span>&nbsp;</div></li><li><div><span class="comment">       * @uses Plugin_Upgrader_Skin</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return boolean True on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function do_plugin_install() {&nbsp;</div></li><li><div>          if ( empty( $_GET['plugin'] ) ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// All plugin information will be stored in an array for processing.</span>&nbsp;</div></li><li><div>          $slug = $this-&gt;sanitize_key( urldecode( $_GET['plugin'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! isset( $this-&gt;plugins[ $slug ] ) ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Was an install or upgrade action link clicked?</span>&nbsp;</div></li><li><div>          if ( ( isset( $_GET['tgmpa-install'] ) && 'install-plugin' === $_GET['tgmpa-install'] ) || ( isset( $_GET['tgmpa-update'] ) && 'update-plugin' === $_GET['tgmpa-update'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $install_type = 'install';&nbsp;</div></li><li><div>              if ( isset( $_GET['tgmpa-update'] ) && 'update-plugin' === $_GET['tgmpa-update'] ) {&nbsp;</div></li><li><div>                  $install_type = 'update';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              check_admin_referer( 'tgmpa-' . $install_type, 'tgmpa-nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Pass necessary information via URL if WP_Filesystem is needed.</span>&nbsp;</div></li><li><div>              $url = wp_nonce_url(&nbsp;</div></li><li><div>                  add_query_arg(&nbsp;</div></li><li><div>                      array(&nbsp;</div></li><li><div>                          'plugin' =&gt; urlencode( $slug ), &nbsp;</div></li><li><div>                          'tgmpa-' . $install_type =&gt; $install_type . '-plugin', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      $this-&gt;get_tgmpa_url()&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                  'tgmpa-' . $install_type, &nbsp;</div></li><li><div>                  'tgmpa-nonce'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $method = ''; <span class="comment"><span class="comment">// Leave blank so WP_Filesystem can populate it as necessary.</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( false === ( $creds = request_filesystem_credentials( esc_url_raw( $url ), $method, false, false, array() ) ) ) {&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! WP_Filesystem( $creds ) ) {&nbsp;</div></li><li><div>                  request_filesystem_credentials( esc_url_raw( $url ), $method, true, false, array() ); <span class="comment">// Setup WP_Filesystem.</span>&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/** If we arrive here, we have the filesystem. */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Prep variables for Plugin_Installer_Skin class.</span>&nbsp;</div></li><li><div>              $extra = array();&nbsp;</div></li><li><div>              $extra['slug'] = $slug; <span class="comment">// Needed for potentially renaming of directory name.</span>&nbsp;</div></li><li><div>              $source = $this-&gt;get_download_url( $slug );&nbsp;</div></li><li><div>              $api = ( 'repo' === $this-&gt;plugins[ $slug ]['source_type'] ) ? $this-&gt;get_plugins_api( $slug ) : null;&nbsp;</div></li><li><div>              $api = ( false !== $api ) ? $api : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $url = add_query_arg(&nbsp;</div></li><li><div>                  array(&nbsp;</div></li><li><div>                      'action' =&gt; $install_type . '-plugin', &nbsp;</div></li><li><div>                      'plugin' =&gt; urlencode( $slug ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                  'update.php'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! class_exists( 'Plugin_Upgrader', false ) ) {&nbsp;</div></li><li><div>                  require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $title = ( 'update' === $install_type ) ? $this-&gt;strings['updating'] : $this-&gt;strings['installing'];&nbsp;</div></li><li><div>              $skin_args = array(&nbsp;</div></li><li><div>                  'type' =&gt; ( 'bundled' !== $this-&gt;plugins[ $slug ]['source_type'] ) ? 'web' : 'upload', &nbsp;</div></li><li><div>                  'title' =&gt; sprintf( $title, $this-&gt;plugins[ $slug ]['name'] ), &nbsp;</div></li><li><div>                  'url' =&gt; esc_url_raw( $url ), &nbsp;</div></li><li><div>                  'nonce' =&gt; $install_type . '-plugin_' . $slug, &nbsp;</div></li><li><div>                  'plugin' =&gt; '', &nbsp;</div></li><li><div>                  'api' =&gt; $api, &nbsp;</div></li><li><div>                  'extra' =&gt; $extra, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              unset( $title );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'update' === $install_type ) {&nbsp;</div></li><li><div>                  $skin_args['plugin'] = $this-&gt;plugins[ $slug ]['file_path'];&nbsp;</div></li><li><div>                  $skin = new Plugin_Upgrader_Skin( $skin_args );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $skin = new Plugin_Installer_Skin( $skin_args );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Create a new instance of Plugin_Upgrader.</span>&nbsp;</div></li><li><div>              $upgrader = new Plugin_Upgrader( $skin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Perform the action and install the plugin from the $source urldecode().</span>&nbsp;</div></li><li><div>              add_filter( 'upgrader_source_selection', array( $this, 'maybe_adjust_source_dir' ), 1, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'update' === $install_type ) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Inject our info into the update transient.</span></span>&nbsp;</div></li><li><div>                  $to_inject = array( $slug =&gt; $this-&gt;plugins[ $slug ] );&nbsp;</div></li><li><div>                  $to_inject[ $slug ]['source'] = $source;&nbsp;</div></li><li><div>                  $this-&gt;inject_update_info( $to_inject );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $upgrader-&gt;upgrade( $this-&gt;plugins[ $slug ]['file_path'] );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $upgrader-&gt;install( $source );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              remove_filter( 'upgrader_source_selection', array( $this, 'maybe_adjust_source_dir' ), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Make sure we have the correct file path now the plugin is installed/updated.</span>&nbsp;</div></li><li><div>              $this-&gt;populate_file_path( $slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Only activate plugins if the config option is set to true and the plugin isn't</span>&nbsp;</div></li><li><div>              <span class="comment">// already active (upgrade).</span>&nbsp;</div></li><li><div>              if ( $this-&gt;is_automatic && ! $this-&gt;is_plugin_active( $slug ) ) {&nbsp;</div></li><li><div>                  $plugin_activate = $upgrader-&gt;plugin_info(); <span class="comment">// Grab the plugin info from the Plugin_Upgrader method.</span>&nbsp;</div></li><li><div>                  if ( false === $this-&gt;activate_single_plugin( $plugin_activate, $slug, true ) ) {&nbsp;</div></li><li><div>                      return true; <span class="comment"><span class="comment">// Finish execution of the function early as we encountered an error.</span></span>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $this-&gt;show_tgmpa_version();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment"><span class="comment">// Display message based on if all plugins are now active or not.</span></span>&nbsp;</div></li><li><div>              if ( $this-&gt;is_tgmpa_complete() ) {&nbsp;</div></li><li><div>                  echo '&lt;p&gt;', sprintf( esc_html( $this-&gt;strings['complete'] ), '&lt;a href=&quot;' . esc_url( self_admin_url() ) . '&quot;&gt;' . esc_html__( 'Return to the Dashboard', 'tgmpa' ) . '&lt;/a&gt;' ), '&lt;/p&gt;';&nbsp;</div></li><li><div>                  echo '&lt;style type=&quot;text/css&quot;&gt;#adminmenu .wp-submenu li.current { display: none !important; }&lt;/style&gt;';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  echo '&lt;p&gt;&lt;a href=&quot;', esc_url( $this-&gt;get_tgmpa_url() ), '&quot; target=&quot;_parent&quot;&gt;', esc_html( $this-&gt;strings['return'] ), '&lt;/a&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          } elseif ( isset( $this-&gt;plugins[ $slug ]['file_path'], $_GET['tgmpa-activate'] ) && 'activate-plugin' === $_GET['tgmpa-activate'] ) {&nbsp;</div></li><li><div>              <span class="comment">// Activate action link was clicked.</span>&nbsp;</div></li><li><div>              check_admin_referer( 'tgmpa-activate', 'tgmpa-nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( false === $this-&gt;activate_single_plugin( $this-&gt;plugins[ $slug ]['file_path'], $slug ) ) {&nbsp;</div></li><li><div>                  return true; <span class="comment"><span class="comment">// Finish execution of the function early as we encountered an error.</span></span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Inject information into the 'update_plugins' site transient as WP checks that before running an update.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $plugins The plugin information for the plugins which are to be updated.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function inject_update_info( $plugins ) {&nbsp;</div></li><li><div>          $repo_updates = get_site_transient( 'update_plugins' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! is_object( $repo_updates ) ) {&nbsp;</div></li><li><div>              $repo_updates = new stdClass;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>              $file_path = $plugin['file_path'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( empty( $repo_updates-&gt;response[ $file_path ] ) ) {&nbsp;</div></li><li><div>                  $repo_updates-&gt;response[ $file_path ] = new stdClass;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// We only really need to set package, but let's do all we can in case WP changes something.</span>&nbsp;</div></li><li><div>              $repo_updates-&gt;response[ $file_path ]-&gt;slug = $slug;&nbsp;</div></li><li><div>              $repo_updates-&gt;response[ $file_path ]-&gt;plugin = $file_path;&nbsp;</div></li><li><div>              $repo_updates-&gt;response[ $file_path ]-&gt;new_version = $plugin['version'];&nbsp;</div></li><li><div>              $repo_updates-&gt;response[ $file_path ]-&gt;package = $plugin['source'];&nbsp;</div></li><li><div>              if ( empty( $repo_updates-&gt;response[ $file_path ]-&gt;url ) && ! empty( $plugin['external_url'] ) ) {&nbsp;</div></li><li><div>                  $repo_updates-&gt;response[ $file_path ]-&gt;url = $plugin['external_url'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          set_site_transient( 'update_plugins', $repo_updates );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Adjust the plugin directory name if necessary.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The final destination directory of a plugin is based on the subdirectory name found in the</span>&nbsp;</div></li><li><div><span class="comment">       * (un)zipped source. In some cases - most notably GitHub repository plugin downloads -, this</span>&nbsp;</div></li><li><div><span class="comment">       * subdirectory name is not the same as the expected slug and the plugin will not be recognized</span>&nbsp;</div></li><li><div><span class="comment">       * as installed. This is fixed by adjusting the temporary unzipped source subdirectory name to</span>&nbsp;</div></li><li><div><span class="comment">       * the expected plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string       $source        Path to upgrade/zip-file-name.tmp/subdirectory/.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string       $remote_source Path to upgrade/zip-file-name.tmp.</span>&nbsp;</div></li><li><div><span class="comment">       * @param \WP_Upgrader $upgrader      Instance of the upgrader which installs the plugin.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string $source</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function maybe_adjust_source_dir( $source, $remote_source, $upgrader ) {&nbsp;</div></li><li><div>          if ( ! $this-&gt;is_tgmpa_page() || ! is_object( $GLOBALS['wp_filesystem'] ) ) {&nbsp;</div></li><li><div>              return $source;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Check for single file plugins.</span>&nbsp;</div></li><li><div>          $source_files = array_keys( $GLOBALS['wp_filesystem']-&gt;dirlist( $remote_source ) );&nbsp;</div></li><li><div>          if ( 1 === count( $source_files ) && false === $GLOBALS['wp_filesystem']-&gt;is_dir( $source ) ) {&nbsp;</div></li><li><div>              return $source;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Multi-file plugin, let's see if the directory is correctly named.</span>&nbsp;</div></li><li><div>          $desired_slug = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Figure out what the slug is supposed to be.</span>&nbsp;</div></li><li><div>          if ( false === $upgrader-&gt;bulk && ! empty( $upgrader-&gt;skin-&gt;options['extra']['slug'] ) ) {&nbsp;</div></li><li><div>              $desired_slug = $upgrader-&gt;skin-&gt;options['extra']['slug'];&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">// Bulk installer contains less info, so fall back on the info registered here.</span>&nbsp;</div></li><li><div>              foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>                  if ( ! empty( $upgrader-&gt;skin-&gt;plugin_names[ $upgrader-&gt;skin-&gt;i ] ) && $plugin['name'] === $upgrader-&gt;skin-&gt;plugin_names[ $upgrader-&gt;skin-&gt;i ] ) {&nbsp;</div></li><li><div>                      $desired_slug = $slug;&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              unset( $slug, $plugin );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $desired_slug ) ) {&nbsp;</div></li><li><div>              $subdir_name = untrailingslashit( str_replace( trailingslashit( $remote_source ), '', $source ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $subdir_name ) && $subdir_name !== $desired_slug ) {&nbsp;</div></li><li><div>                  $from_path = untrailingslashit( $source );&nbsp;</div></li><li><div>                  $to_path = trailingslashit( $remote_source ) . $desired_slug;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( true === $GLOBALS['wp_filesystem']-&gt;move( $from_path, $to_path ) ) {&nbsp;</div></li><li><div>                      return trailingslashit( $to_path );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      return new WP_Error( 'rename_failed', esc_html__( 'The remote plugin package does not contain a folder with the desired slug and renaming did not work.', 'tgmpa' ) . ' ' . esc_html__( 'Please contact the plugin provider and ask them to package their plugin according to the WordPress guidelines.', 'tgmpa' ), array( 'found' =&gt; $subdir_name, 'expected' =&gt; $desired_slug ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } elseif ( empty( $subdir_name ) ) {&nbsp;</div></li><li><div>                  return new WP_Error( 'packaged_wrong', esc_html__( 'The remote plugin package consists of more than one file, but the files are not packaged in a folder.', 'tgmpa' ) . ' ' . esc_html__( 'Please contact the plugin provider and ask them to package their plugin according to the WordPress guidelines.', 'tgmpa' ), array( 'found' =&gt; $subdir_name, 'expected' =&gt; $desired_slug ) );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $source;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Activate a single plugin and send feedback about the result to the screen.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $file_path Path within wp-plugins/ to main plugin file.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug      Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool   $automatic Whether this is an automatic activation after an install. Defaults to false.</span>&nbsp;</div></li><li><div><span class="comment">       *                          This determines the styling of the output messages.</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool False if an error was encountered, true otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function activate_single_plugin( $file_path, $slug, $automatic = false ) {&nbsp;</div></li><li><div>          if ( $this-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>              $activate = activate_plugin( $file_path );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_wp_error( $activate ) ) {&nbsp;</div></li><li><div>                  echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', wp_kses_post( $activate-&gt;get_error_message() ), '&lt;/p&gt;&lt;/div&gt;', &nbsp;</div></li><li><div>                      '&lt;p&gt;&lt;a href=&quot;', esc_url( $this-&gt;get_tgmpa_url() ), '&quot; target=&quot;_parent&quot;&gt;', esc_html( $this-&gt;strings['return'] ), '&lt;/a&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  return false; <span class="comment">// End it here if there is an error with activation.</span>&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ( ! $automatic ) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Make sure message doesn't display again if bulk activation is performed</span></span>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// immediately after a single activation.</span></span>&nbsp;</div></li><li><div>                      if ( ! isset( $_POST['action'] ) ) { <span class="comment"><span class="comment">// WPCS: CSRF OK.</span></span>&nbsp;</div></li><li><div>                          echo '&lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;&lt;p&gt;', esc_html( $this-&gt;strings['activated_successfully'] ), ' &lt;strong&gt;', esc_html( $this-&gt;plugins[ $slug ]['name'] ), '.&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Simpler message layout for use on the plugin install page.</span></span>&nbsp;</div></li><li><div>                      echo '&lt;p&gt;', esc_html( $this-&gt;strings['plugin_activated'] ), '&lt;/p&gt;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          } elseif ( $this-&gt;is_plugin_active( $slug ) ) {&nbsp;</div></li><li><div>              <span class="comment">// No simpler message format provided as this message should never be encountered</span>&nbsp;</div></li><li><div>              <span class="comment">// on the plugin install page.</span>&nbsp;</div></li><li><div>              echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', &nbsp;</div></li><li><div>                  sprintf(&nbsp;</div></li><li><div>                      esc_html( $this-&gt;strings['plugin_already_active'] ), &nbsp;</div></li><li><div>                      '&lt;strong&gt;' . esc_html( $this-&gt;plugins[ $slug ]['name'] ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                  '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>          } elseif ( $this-&gt;does_plugin_require_update( $slug ) ) {&nbsp;</div></li><li><div>              if ( ! $automatic ) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Make sure message doesn't display again if bulk activation is performed</span></span>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// immediately after a single activation.</span></span>&nbsp;</div></li><li><div>                  if ( ! isset( $_POST['action'] ) ) { <span class="comment"><span class="comment">// WPCS: CSRF OK.</span></span>&nbsp;</div></li><li><div>                      echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', &nbsp;</div></li><li><div>                          sprintf(&nbsp;</div></li><li><div>                              esc_html( $this-&gt;strings['plugin_needs_higher_version'] ), &nbsp;</div></li><li><div>                              '&lt;strong&gt;' . esc_html( $this-&gt;plugins[ $slug ]['name'] ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                          '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Simpler message layout for use on the plugin install page.</span></span>&nbsp;</div></li><li><div>                  echo '&lt;p&gt;', sprintf( esc_html( $this-&gt;strings['plugin_needs_higher_version'] ), esc_html( $this-&gt;plugins[ $slug ]['name'] ) ), '&lt;/p&gt;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Echoes required plugin notice.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Outputs a message telling users that a specific plugin is required for</span>&nbsp;</div></li><li><div><span class="comment">       * their theme. If appropriate, it includes a link to the form page where</span>&nbsp;</div></li><li><div><span class="comment">       * users can install and activate the plugin.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Returns early if we're on the Install page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 1.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @global object $current_screen</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return null Returns early if we're on the Install page.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function notices() {&nbsp;</div></li><li><div>          <span class="comment">// Remove nag on the install page / Return early if the nag message has been dismissed or user &lt; author.</span>&nbsp;</div></li><li><div>          if ( ( $this-&gt;is_tgmpa_page() || $this-&gt;is_core_update_page() ) || get_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice_' . $this-&gt;id, true ) || ! current_user_can( apply_filters( 'tgmpa_show_admin_notice_capability', 'publish_posts' ) ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Store for the plugin slugs by message type.</span>&nbsp;</div></li><li><div>          $message = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Initialize counters used to determine plurality of action link texts.</span>&nbsp;</div></li><li><div>          $install_link_count = 0;&nbsp;</div></li><li><div>          $update_link_count = 0;&nbsp;</div></li><li><div>          $activate_link_count = 0;&nbsp;</div></li><li><div>          $total_required_action_count = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>              if ( $this-&gt;is_plugin_active( $slug ) && false === $this-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! $this-&gt;is_plugin_installed( $slug ) ) {&nbsp;</div></li><li><div>                  if ( current_user_can( 'install_plugins' ) ) {&nbsp;</div></li><li><div>                      $install_link_count++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                          $message['notice_can_install_required'][] = $slug;&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $message['notice_can_install_recommended'][] = $slug;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                      $total_required_action_count++;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  if ( ! $this-&gt;is_plugin_active( $slug ) && $this-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>                      if ( current_user_can( 'activate_plugins' ) ) {&nbsp;</div></li><li><div>                          $activate_link_count++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                              $message['notice_can_activate_required'][] = $slug;&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $message['notice_can_activate_recommended'][] = $slug;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                          $total_required_action_count++;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( $this-&gt;does_plugin_require_update( $slug ) || false !== $this-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( current_user_can( 'update_plugins' ) ) {&nbsp;</div></li><li><div>                          $update_link_count++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( $this-&gt;does_plugin_require_update( $slug ) ) {&nbsp;</div></li><li><div>                              $message['notice_ask_to_update'][] = $slug;&nbsp;</div></li><li><div>                          } elseif ( false !== $this-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>                              $message['notice_ask_to_update_maybe'][] = $slug;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                          $total_required_action_count++;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          unset( $slug, $plugin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// If we have notices to display, we move forward.</span>&nbsp;</div></li><li><div>          if ( ! empty( $message ) || $total_required_action_count &gt; 0 ) {&nbsp;</div></li><li><div>              krsort( $message ); <span class="comment">// Sort messages.</span>&nbsp;</div></li><li><div>              $rendered = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// As add_settings_error() wraps the final message in a &lt;p&gt; and as the final message can't be</span>&nbsp;</div></li><li><div>              <span class="comment">// filtered, using &lt;p&gt;'s in our html would render invalid html output.</span>&nbsp;</div></li><li><div>              $line_template = '&lt;span style=&quot;display: block; margin: 0.5em 0.5em 0 0; clear: both;&quot;&gt;%s&lt;/span&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! current_user_can( 'activate_plugins' ) && ! current_user_can( 'install_plugins' ) && ! current_user_can( 'update_plugins' ) ) {&nbsp;</div></li><li><div>                  $rendered = esc_html( $this-&gt;strings['notice_cannot_install_activate'] ) . ' ' . esc_html( $this-&gt;strings['contact_admin'] );&nbsp;</div></li><li><div>                  $rendered .= $this-&gt;create_user_action_links_for_notice( 0, 0, 0, $line_template );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// If dismissable is false and a message is set, output it now.</span>&nbsp;</div></li><li><div>                  if ( ! $this-&gt;dismissable && ! empty( $this-&gt;dismiss_msg ) ) {&nbsp;</div></li><li><div>                      $rendered .= sprintf( $line_template, wp_kses_post( $this-&gt;dismiss_msg ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Render the individual message lines for the notice.</span>&nbsp;</div></li><li><div>                  foreach ( $message as $type =&gt; $plugin_group ) {&nbsp;</div></li><li><div>                      $linked_plugins = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Get the external info link for a plugin if one is available.</span>&nbsp;</div></li><li><div>                      foreach ( $plugin_group as $plugin_slug ) {&nbsp;</div></li><li><div>                          $linked_plugins[] = $this-&gt;get_info_link( $plugin_slug );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      unset( $plugin_slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $count = count( $plugin_group );&nbsp;</div></li><li><div>                      $linked_plugins = array_map( array( 'TGMPA_Utils', 'wrap_in_em' ), $linked_plugins );&nbsp;</div></li><li><div>                      $last_plugin = array_pop( $linked_plugins ); <span class="comment"><span class="comment">// Pop off last name to prep for readability.</span></span>&nbsp;</div></li><li><div>                      $imploded = empty( $linked_plugins ) ? $last_plugin : ( implode( ', ', $linked_plugins ) . ' ' . esc_html_x( 'and', 'plugin A *and* plugin B', 'tgmpa' ) . ' ' . $last_plugin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $rendered .= sprintf(&nbsp;</div></li><li><div>                          $line_template, &nbsp;</div></li><li><div>                          sprintf(&nbsp;</div></li><li><div>                              translate_nooped_plural( $this-&gt;strings[ $type ], $count, 'tgmpa' ), &nbsp;</div></li><li><div>                              $imploded, &nbsp;</div></li><li><div>                              $count&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  unset( $type, $plugin_group, $linked_plugins, $count, $last_plugin, $imploded );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $rendered .= $this-&gt;create_user_action_links_for_notice( $install_link_count, $update_link_count, $activate_link_count, $line_template );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Register the nag messages and prepare them to be processed.</span>&nbsp;</div></li><li><div>              add_settings_error( 'tgmpa', 'tgmpa', $rendered, $this-&gt;get_admin_notice_class() );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Admin options pages already output settings_errors, so this is to avoid duplication.</span>&nbsp;</div></li><li><div>          if ( 'options-general' !== $GLOBALS['current_screen']-&gt;parent_base ) {&nbsp;</div></li><li><div>              $this-&gt;display_settings_errors();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Generate the user action links for the admin notice.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $install_count  Number of plugins to install.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $update_count   Number of plugins to update.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $activate_count Number of plugins to activate.</span>&nbsp;</div></li><li><div><span class="comment">       * @param int $line_template  Template for the HTML tag to output a line.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Action links.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function create_user_action_links_for_notice( $install_count, $update_count, $activate_count, $line_template ) {&nbsp;</div></li><li><div>          <span class="comment">// Setup action links.</span>&nbsp;</div></li><li><div>          $action_links = array(&nbsp;</div></li><li><div>              'install' =&gt; '', &nbsp;</div></li><li><div>              'update' =&gt; '', &nbsp;</div></li><li><div>              'activate' =&gt; '', &nbsp;</div></li><li><div>              'dismiss' =&gt; $this-&gt;dismissable ? '&lt;a href=&quot;' . esc_url( wp_nonce_url( add_query_arg( 'tgmpa-dismiss', 'dismiss_admin_notices' ), 'tgmpa-dismiss-' . get_current_user_id() ) ) . '&quot; class=&quot;dismiss-notice&quot; target=&quot;_parent&quot;&gt;' . esc_html( $this-&gt;strings['dismiss'] ) . '&lt;/a&gt;' : '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $link_template = '&lt;a href=&quot;%2$s&quot;&gt;%1$s&lt;/a&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( current_user_can( 'install_plugins' ) ) {&nbsp;</div></li><li><div>              if ( $install_count &gt; 0 ) {&nbsp;</div></li><li><div>                  $action_links['install'] = sprintf(&nbsp;</div></li><li><div>                      $link_template, &nbsp;</div></li><li><div>                      translate_nooped_plural( $this-&gt;strings['install_link'], $install_count, 'tgmpa' ), &nbsp;</div></li><li><div>                      esc_url( $this-&gt;get_tgmpa_status_url( 'install' ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( $update_count &gt; 0 ) {&nbsp;</div></li><li><div>                  $action_links['update'] = sprintf(&nbsp;</div></li><li><div>                      $link_template, &nbsp;</div></li><li><div>                      translate_nooped_plural( $this-&gt;strings['update_link'], $update_count, 'tgmpa' ), &nbsp;</div></li><li><div>                      esc_url( $this-&gt;get_tgmpa_status_url( 'update' ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( current_user_can( 'activate_plugins' ) && $activate_count &gt; 0 ) {&nbsp;</div></li><li><div>              $action_links['activate'] = sprintf(&nbsp;</div></li><li><div>                  $link_template, &nbsp;</div></li><li><div>                  translate_nooped_plural( $this-&gt;strings['activate_link'], $activate_count, 'tgmpa' ), &nbsp;</div></li><li><div>                  esc_url( $this-&gt;get_tgmpa_status_url( 'activate' ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $action_links = apply_filters( 'tgmpa_notice_action_links', $action_links );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $action_links = array_filter( (array) $action_links ); <span class="comment">// Remove any empty array items.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $action_links ) ) {&nbsp;</div></li><li><div>              $action_links = sprintf( $line_template, implode( ' | ', $action_links ) );&nbsp;</div></li><li><div>              return apply_filters( 'tgmpa_notice_rendered_action_links', $action_links );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get admin notice class.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Work around all the changes to the various admin notice classes between WP 4.4 and 3.7</span>&nbsp;</div></li><li><div><span class="comment">       * (lowest supported version by TGMPA).</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_admin_notice_class() {&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;strings['nag_type'] ) ) {&nbsp;</div></li><li><div>              return sanitize_html_class( strtolower( $this-&gt;strings['nag_type'] ) );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              if ( version_compare( $this-&gt;wp_version, '4.2', '&gt;=' ) ) {&nbsp;</div></li><li><div>                  return 'notice-warning';&nbsp;</div></li><li><div>              } elseif ( version_compare( $this-&gt;wp_version, '4.1', '&gt;=' ) ) {&nbsp;</div></li><li><div>                  return 'notice';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  return 'updated';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Display settings errors and remove those which have been displayed to avoid duplicate messages showing</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function display_settings_errors() {&nbsp;</div></li><li><div>          global $wp_settings_errors;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          settings_errors( 'tgmpa' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( (array) $wp_settings_errors as $key =&gt; $details ) {&nbsp;</div></li><li><div>              if ( 'tgmpa' === $details['setting'] ) {&nbsp;</div></li><li><div>                  unset( $wp_settings_errors[ $key ] );&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Register dismissal of admin notices.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Acts on the dismiss link in the admin nag messages.</span>&nbsp;</div></li><li><div><span class="comment">       * If clicked, the admin notice disappears and will no longer be visible to this user.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function dismiss() {&nbsp;</div></li><li><div>          if ( isset( $_GET['tgmpa-dismiss'] ) && check_admin_referer( 'tgmpa-dismiss-' . get_current_user_id() ) ) {&nbsp;</div></li><li><div>              update_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice_' . $this-&gt;id, 1 );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Add individual plugin to our collection of plugins.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * If the required keys are not set or the plugin has already</span>&nbsp;</div></li><li><div><span class="comment">       * been registered, the plugin is not added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array|null $plugin Array of plugin arguments or null if invalid argument.</span>&nbsp;</div></li><li><div><span class="comment">       * @return null Return early if incorrect argument.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function register( $plugin ) {&nbsp;</div></li><li><div>          if ( empty( $plugin['slug'] ) || empty( $plugin['name'] ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $plugin['slug'] ) || ! is_string( $plugin['slug'] ) || isset( $this-&gt;plugins[ $plugin['slug'] ] ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $defaults = array(&nbsp;</div></li><li><div>              'name' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// String</span></span></span></span></span>&nbsp;</div></li><li><div>              'slug' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// String</span></span></span></span></span>&nbsp;</div></li><li><div>              'source' =&gt; 'repo', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// String</span></span></span></span></span>&nbsp;</div></li><li><div>              'required' =&gt; false, <span class="comment"><span class="comment"><span class="comment">// Boolean</span></span></span>&nbsp;</div></li><li><div>              'version' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// String</span></span></span></span></span>&nbsp;</div></li><li><div>              'force_activation' =&gt; false, <span class="comment"><span class="comment"><span class="comment">// Boolean</span></span></span>&nbsp;</div></li><li><div>              'force_deactivation' =&gt; false, <span class="comment"><span class="comment"><span class="comment">// Boolean</span></span></span>&nbsp;</div></li><li><div>              'external_url' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// String</span></span></span></span></span>&nbsp;</div></li><li><div>              'is_callable' =&gt; '', <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">// String</span></span></span></span></span>|Array.&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Prepare the received data.</span>&nbsp;</div></li><li><div>          $plugin = wp_parse_args( $plugin, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Standardize the received slug.</span>&nbsp;</div></li><li><div>          $plugin['slug'] = $this-&gt;sanitize_key( $plugin['slug'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Forgive users for using string versions of booleans or floats for version number.</span>&nbsp;</div></li><li><div>          $plugin['version'] = (string) $plugin['version'];&nbsp;</div></li><li><div>          $plugin['source'] = empty( $plugin['source'] ) ? 'repo' : $plugin['source'];&nbsp;</div></li><li><div>          $plugin['required'] = TGMPA_Utils::validate_bool( $plugin['required'] );&nbsp;</div></li><li><div>          $plugin['force_activation'] = TGMPA_Utils::validate_bool( $plugin['force_activation'] );&nbsp;</div></li><li><div>          $plugin['force_deactivation'] = TGMPA_Utils::validate_bool( $plugin['force_deactivation'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Enrich the received data.</span>&nbsp;</div></li><li><div>          $plugin['file_path'] = $this-&gt;_get_plugin_basename_from_slug( $plugin['slug'] );&nbsp;</div></li><li><div>          $plugin['source_type'] = $this-&gt;get_plugin_source_type( $plugin['source'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set the class properties.</span>&nbsp;</div></li><li><div>          $this-&gt;plugins[ $plugin['slug'] ]    = $plugin;&nbsp;</div></li><li><div>          $this-&gt;sort_order[ $plugin['slug'] ] = $plugin['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Should we add the force activation hook ?</span>&nbsp;</div></li><li><div>          if ( true === $plugin['force_activation'] ) {&nbsp;</div></li><li><div>              $this-&gt;has_forced_activation = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Should we add the force deactivation hook ?</span>&nbsp;</div></li><li><div>          if ( true === $plugin['force_deactivation'] ) {&nbsp;</div></li><li><div>              $this-&gt;has_forced_deactivation = true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Determine what type of source the plugin comes from.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $source The source of the plugin as provided, either empty (= WP repo), a file path</span>&nbsp;</div></li><li><div><span class="comment">       *                       (= bundled) or an external URL.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string 'repo', 'external', or 'bundled'</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_plugin_source_type( $source ) {&nbsp;</div></li><li><div>          if ( 'repo' === $source || preg_match( self::WP_REPO_REGEX, $source ) ) {&nbsp;</div></li><li><div>              return 'repo';&nbsp;</div></li><li><div>          } elseif ( preg_match( self::IS_URL_REGEX, $source ) ) {&nbsp;</div></li><li><div>              return 'external';&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return 'bundled';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Sanitizes a string key.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Near duplicate of WP Core `sanitize_key()`. The difference is that uppercase characters *are*</span>&nbsp;</div></li><li><div><span class="comment">       * allowed, so as not to break upgrade paths from non-standard bundled plugins using uppercase</span>&nbsp;</div></li><li><div><span class="comment">       * characters in the plugin directory path/slug. Silly them.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @see https://developer.wordpress.org/reference/hooks/sanitize_key/</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $key String key.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Sanitized key</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function sanitize_key( $key ) {&nbsp;</div></li><li><div>          $raw_key = $key;&nbsp;</div></li><li><div>          $key = preg_replace( '`[^A-Za-z0-9_-]`', '', $key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Filter a sanitized key string.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $key     Sanitized key.</span>&nbsp;</div></li><li><div><span class="comment">           * @param string $raw_key The key prior to sanitization.</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          return apply_filters( 'tgmpa_sanitize_key', $key, $raw_key );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Amend default configuration settings.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $config Array of config options to pass as class properties.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function config( $config ) {&nbsp;</div></li><li><div>          $keys = array(&nbsp;</div></li><li><div>              'id', &nbsp;</div></li><li><div>              'default_path', &nbsp;</div></li><li><div>              'has_notices', &nbsp;</div></li><li><div>              'dismissable', &nbsp;</div></li><li><div>              'dismiss_msg', &nbsp;</div></li><li><div>              'menu', &nbsp;</div></li><li><div>              'parent_slug', &nbsp;</div></li><li><div>              'capability', &nbsp;</div></li><li><div>              'is_automatic', &nbsp;</div></li><li><div>              'message', &nbsp;</div></li><li><div>              'strings', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $keys as $key ) {&nbsp;</div></li><li><div>              if ( isset( $config[ $key ] ) ) {&nbsp;</div></li><li><div>                  if ( is_array( $config[ $key ] ) ) {&nbsp;</div></li><li><div>                      $this-&gt;$key = array_merge( $this-&gt;$key, $config[ $key ] );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $this-&gt;$key = $config[ $key ];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Amend action link after plugin installation.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $install_actions Existing array of actions.</span>&nbsp;</div></li><li><div><span class="comment">       * @return false|array Amended array of actions.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function actions( $install_actions ) {&nbsp;</div></li><li><div>          <span class="comment">// Remove action links on the TGMPA install page.</span>&nbsp;</div></li><li><div>          if ( $this-&gt;is_tgmpa_page() ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $install_actions;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Flushes the plugins cache on theme switch to prevent stale entries</span>&nbsp;</div></li><li><div><span class="comment">       * from remaining in the plugin table.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param bool $clear_update_cache Optional. Whether to clear the Plugin updates cache.</span>&nbsp;</div></li><li><div><span class="comment">       *                                 Parameter added in v2.5.0.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function flush_plugins_cache( $clear_update_cache = true ) {&nbsp;</div></li><li><div>          wp_clean_plugins_cache( $clear_update_cache );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Set file_path key for each installed plugin.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $plugin_slug Optional. If set, only (re-)populates the file path for that specific plugin.</span>&nbsp;</div></li><li><div><span class="comment">       *                            Parameter added in v2.5.0.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function populate_file_path( $plugin_slug = '' ) {&nbsp;</div></li><li><div>          if ( ! empty( $plugin_slug ) && is_string( $plugin_slug ) && isset( $this-&gt;plugins[ $plugin_slug ] ) ) {&nbsp;</div></li><li><div>              $this-&gt;plugins[ $plugin_slug ]['file_path'] = $this-&gt;_get_plugin_basename_from_slug( $plugin_slug );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">// Add file_path key for all plugins.</span>&nbsp;</div></li><li><div>              foreach ( $this-&gt;plugins as $slug =&gt; $values ) {&nbsp;</div></li><li><div>                  $this-&gt;plugins[ $slug ]['file_path'] = $this-&gt;_get_plugin_basename_from_slug( $slug );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Helper function to extract the file path of the plugin file from the</span>&nbsp;</div></li><li><div><span class="comment">       * plugin slug, if the plugin is installed.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug (typically folder name) as provided by the developer.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Either file path for plugin if installed, or just the plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function _get_plugin_basename_from_slug( $slug ) {&nbsp;</div></li><li><div>          $keys = array_keys( $this-&gt;get_plugins() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $keys as $key ) {&nbsp;</div></li><li><div>              if ( preg_match( '|^' . $slug . '/|', $key ) ) {&nbsp;</div></li><li><div>                  return $key;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $slug;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve plugin data, given the plugin name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Loops through the registered plugins looking for $name. If it finds it, </span>&nbsp;</div></li><li><div><span class="comment">       * it returns the $data from that plugin. Otherwise, returns false.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $name Name of the plugin, as it was registered.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $data Optional. Array key of plugin data to return. Default is slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string|boolean Plugin slug if found, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function _get_plugin_data_from_name( $name, $data = 'slug' ) {&nbsp;</div></li><li><div>          foreach ( $this-&gt;plugins as $values ) {&nbsp;</div></li><li><div>              if ( $name === $values['name'] && isset( $values[ $data ] ) ) {&nbsp;</div></li><li><div>                  return $values[ $data ];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve the download URL for a package.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Plugin download URL or path to local file or empty string if undetermined.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_download_url( $slug ) {&nbsp;</div></li><li><div>          $dl_source = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          switch ( $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>              case 'repo':&nbsp;</div></li><li><div>                  return $this-&gt;get_wp_repo_download_url( $slug );&nbsp;</div></li><li><div>              case 'external':&nbsp;</div></li><li><div>                  return $this-&gt;plugins[ $slug ]['source'];&nbsp;</div></li><li><div>              case 'bundled':&nbsp;</div></li><li><div>                  return $this-&gt;default_path . $this-&gt;plugins[ $slug ]['source'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $dl_source; <span class="comment">// Should never happen.</span>&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve the download URL for a WP repo package.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Plugin download URL.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_wp_repo_download_url( $slug ) {&nbsp;</div></li><li><div>          $source = '';&nbsp;</div></li><li><div>          $api = $this-&gt;get_plugins_api( $slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( false !== $api && isset( $api-&gt;download_link ) ) {&nbsp;</div></li><li><div>              $source = $api-&gt;download_link;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $source;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Try to grab information from WordPress API.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return object Plugins_api response object on success, WP_Error on failure.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_plugins_api( $slug ) {&nbsp;</div></li><li><div>          static $api = array(); <span class="comment">// Cache received responses.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! isset( $api[ $slug ] ) ) {&nbsp;</div></li><li><div>              if ( ! function_exists( 'plugins_api' ) ) {&nbsp;</div></li><li><div>                  require_once ABSPATH . 'wp-admin/includes/plugin-install.php';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $response = plugins_api( 'plugin_information', array( 'slug' =&gt; $slug, 'fields' =&gt; array( 'sections' =&gt; false ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $api[ $slug ] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_wp_error( $response ) ) {&nbsp;</div></li><li><div>                  wp_die( esc_html( $this-&gt;strings['oops'] ) );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $api[ $slug ] = $response;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $api[ $slug ];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve a link to a plugin information page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Fully formed html link to a plugin information page if available</span>&nbsp;</div></li><li><div><span class="comment">       *                or the plugin name if not.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_info_link( $slug ) {&nbsp;</div></li><li><div>          if ( ! empty( $this-&gt;plugins[ $slug ]['external_url'] ) && preg_match( self::IS_URL_REGEX, $this-&gt;plugins[ $slug ]['external_url'] ) ) {&nbsp;</div></li><li><div>              $link = sprintf(&nbsp;</div></li><li><div>                  '&lt;a href=&quot;%1$s&quot; target=&quot;_blank&quot;&gt;%2$s&lt;/a&gt;', &nbsp;</div></li><li><div>                  esc_url( $this-&gt;plugins[ $slug ]['external_url'] ), &nbsp;</div></li><li><div>                  esc_html( $this-&gt;plugins[ $slug ]['name'] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          } elseif ( 'repo' === $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>              $url = add_query_arg(&nbsp;</div></li><li><div>                  array(&nbsp;</div></li><li><div>                      'tab' =&gt; 'plugin-information', &nbsp;</div></li><li><div>                      'plugin' =&gt; urlencode( $slug ), &nbsp;</div></li><li><div>                      'TB_iframe' =&gt; 'true', &nbsp;</div></li><li><div>                      'width' =&gt; '640', &nbsp;</div></li><li><div>                      'height' =&gt; '500', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                  self_admin_url( 'plugin-install.php' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $link = sprintf(&nbsp;</div></li><li><div>                  '&lt;a href=&quot;%1$s&quot; class=&quot;thickbox&quot;&gt;%2$s&lt;/a&gt;', &nbsp;</div></li><li><div>                  esc_url( $url ), &nbsp;</div></li><li><div>                  esc_html( $this-&gt;plugins[ $slug ]['name'] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $link = esc_html( $this-&gt;plugins[ $slug ]['name'] ); <span class="comment">// No hyperlink.</span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $link;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Determine if we're on the TGMPA Install page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return boolean True when on the TGMPA page, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function is_tgmpa_page() {&nbsp;</div></li><li><div>          return isset( $_GET['page'] ) && $this-&gt;menu === $_GET['page'];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Determine if we're on a WP Core installation/upgrade page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return boolean True when on a WP Core installation/upgrade page, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function is_core_update_page() {&nbsp;</div></li><li><div>          <span class="comment">// Current screen is not always available, most notably on the customizer screen.</span>&nbsp;</div></li><li><div>          if ( ! function_exists( 'get_current_screen' ) ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'update-core' === $screen-&gt;base ) {&nbsp;</div></li><li><div>              <span class="comment">// Core update screen.</span>&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          } elseif ( 'plugins' === $screen-&gt;base && ! empty( $_POST['action'] ) ) { <span class="comment"><span class="comment">// WPCS: CSRF ok.</span></span>&nbsp;</div></li><li><div>              <span class="comment">// Plugins bulk update screen.</span>&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          } elseif ( 'update' === $screen-&gt;base && ! empty( $_POST['action'] ) ) { <span class="comment"><span class="comment">// WPCS: CSRF ok.</span></span>&nbsp;</div></li><li><div>              <span class="comment">// Individual updates (ajax call).</span>&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve the URL to the TGMPA Install page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * I.e. depending on the config settings passed something along the lines of:</span>&nbsp;</div></li><li><div><span class="comment">       * http://example.com/wp-admin/themes.php?page=tgmpa-install-plugins</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Properly encoded URL (not escaped).</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_tgmpa_url() {&nbsp;</div></li><li><div>          static $url;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! isset( $url ) ) {&nbsp;</div></li><li><div>              $parent = $this-&gt;parent_slug;&nbsp;</div></li><li><div>              if ( false === strpos( $parent, '.php' ) ) {&nbsp;</div></li><li><div>                  $parent = 'admin.php';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              $url = add_query_arg(&nbsp;</div></li><li><div>                  array(&nbsp;</div></li><li><div>                      'page' =&gt; urlencode( $this-&gt;menu ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                  self_admin_url( $parent )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $url;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve the URL to the TGMPA Install page for a specific plugin status (view).</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * I.e. depending on the config settings passed something along the lines of:</span>&nbsp;</div></li><li><div><span class="comment">       * http://example.com/wp-admin/themes.php?page=tgmpa-install-plugins&plugin_status=install</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $status Plugin status - either 'install', 'update' or 'activate'.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Properly encoded URL (not escaped).</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_tgmpa_status_url( $status ) {&nbsp;</div></li><li><div>          return add_query_arg(&nbsp;</div></li><li><div>              array(&nbsp;</div></li><li><div>                  'plugin_status' =&gt; urlencode( $status ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              $this-&gt;get_tgmpa_url()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Determine whether there are open actions for plugins registered with TGMPA.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool True if complete, i.e. no outstanding actions. False otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function is_tgmpa_complete() {&nbsp;</div></li><li><div>          $complete = true;&nbsp;</div></li><li><div>          foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>              if ( ! $this-&gt;is_plugin_active( $slug ) || false !== $this-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>                  $complete = false;&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $complete;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check if a plugin is installed. Does not take must-use plugins into account.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool True if installed, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function is_plugin_installed( $slug ) {&nbsp;</div></li><li><div>          $installed_plugins = $this-&gt;get_plugins(); <span class="comment"><span class="comment">// Retrieve a list of all installed plugins (WP cached).</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return ( ! empty( $installed_plugins[ $this-&gt;plugins[ $slug ]['file_path'] ] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check if a plugin is active.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool True if active, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function is_plugin_active( $slug ) {&nbsp;</div></li><li><div>          return ( ( ! empty( $this-&gt;plugins[ $slug ]['is_callable'] ) && is_callable( $this-&gt;plugins[ $slug ]['is_callable'] ) ) || is_plugin_active( $this-&gt;plugins[ $slug ]['file_path'] ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check if a plugin can be updated, i.e. if we have information on the minimum WP version required</span>&nbsp;</div></li><li><div><span class="comment">       * available, check whether the current install meets them.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool True if OK to update, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function can_plugin_update( $slug ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// We currently can't get reliable info on non-WP-repo plugins - issue #380.</span></span>&nbsp;</div></li><li><div>          if ( 'repo' !== $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $api = $this-&gt;get_plugins_api( $slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( false !== $api && isset( $api-&gt;requires ) ) {&nbsp;</div></li><li><div>              return version_compare( $this-&gt;wp_version, $api-&gt;requires, '&gt;=' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// No usable info received from the plugins API, presume we can update.</span>&nbsp;</div></li><li><div>          return true;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check to see if the plugin is 'updatetable', i.e. installed, with an update available</span>&nbsp;</div></li><li><div><span class="comment">       * and no WP version requirements blocking it.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.6.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool True if OK to proceed with update, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function is_plugin_updatetable( $slug ) {&nbsp;</div></li><li><div>          if ( ! $this-&gt;is_plugin_installed( $slug ) ) {&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return ( false !== $this-&gt;does_plugin_have_update( $slug ) && $this-&gt;can_plugin_update( $slug ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check if a plugin can be activated, i.e. is not currently active and meets the minimum</span>&nbsp;</div></li><li><div><span class="comment">       * plugin version requirements set in TGMPA (if any).</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool True if OK to activate, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function can_plugin_activate( $slug ) {&nbsp;</div></li><li><div>          return ( ! $this-&gt;is_plugin_active( $slug ) && ! $this-&gt;does_plugin_require_update( $slug ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve the version number of an installed plugin.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string Version number as string or an empty string if the plugin is not installed</span>&nbsp;</div></li><li><div><span class="comment">       *                or version unknown (plugins which don't comply with the plugin header standard).</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_installed_version( $slug ) {&nbsp;</div></li><li><div>          $installed_plugins = $this-&gt;get_plugins(); <span class="comment"><span class="comment">// Retrieve a list of all installed plugins (WP cached).</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $installed_plugins[ $this-&gt;plugins[ $slug ]['file_path'] ]['Version'] ) ) {&nbsp;</div></li><li><div>              return $installed_plugins[ $this-&gt;plugins[ $slug ]['file_path'] ]['Version'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check whether a plugin complies with the minimum version requirements.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool True when a plugin needs to be updated, otherwise false.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function does_plugin_require_update( $slug ) {&nbsp;</div></li><li><div>          $installed_version = $this-&gt;get_installed_version( $slug );&nbsp;</div></li><li><div>          $minimum_version = $this-&gt;plugins[ $slug ]['version'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return version_compare( $minimum_version, $installed_version, '&gt;' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Check whether there is an update available for a plugin.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return false|string Version number string of the available update or false if no update available.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function does_plugin_have_update( $slug ) {&nbsp;</div></li><li><div>          <span class="comment">// Presume bundled and external plugins will point to a package which meets the minimum required version.</span>&nbsp;</div></li><li><div>          if ( 'repo' !== $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>              if ( $this-&gt;does_plugin_require_update( $slug ) ) {&nbsp;</div></li><li><div>                  return $this-&gt;plugins[ $slug ]['version'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              return false;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $repo_updates = get_site_transient( 'update_plugins' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $repo_updates-&gt;response[ $this-&gt;plugins[ $slug ]['file_path'] ]-&gt;new_version ) ) {&nbsp;</div></li><li><div>              return $repo_updates-&gt;response[ $this-&gt;plugins[ $slug ]['file_path'] ]-&gt;new_version;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve potential upgrade notice for a plugin.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string The upgrade notice or an empty string if no message was available or provided.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_upgrade_notice( $slug ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// We currently can't get reliable info on non-WP-repo plugins - issue #380.</span></span>&nbsp;</div></li><li><div>          if ( 'repo' !== $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>              return '';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $repo_updates = get_site_transient( 'update_plugins' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $repo_updates-&gt;response[ $this-&gt;plugins[ $slug ]['file_path'] ]-&gt;upgrade_notice ) ) {&nbsp;</div></li><li><div>              return $repo_updates-&gt;response[ $this-&gt;plugins[ $slug ]['file_path'] ]-&gt;upgrade_notice;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return '';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Wrapper around the core WP get_plugins function, making sure it's actually available.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $plugin_folder Optional. Relative path to single plugin folder.</span>&nbsp;</div></li><li><div><span class="comment">       * @return array Array of installed plugins with plugin information.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_plugins( $plugin_folder = '' ) {&nbsp;</div></li><li><div>          if ( ! function_exists( 'get_plugins' ) ) {&nbsp;</div></li><li><div>              require_once ABSPATH . 'wp-admin/includes/plugin.php';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return get_plugins( $plugin_folder );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Delete dismissable nag option when theme is switched.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * This ensures that the user(s) is/are again reminded via nag of required</span>&nbsp;</div></li><li><div><span class="comment">       * and/or recommended plugins if they re-activate the theme.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.1.1</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function update_dismiss() {&nbsp;</div></li><li><div>          delete_metadata( 'user', null, 'tgmpa_dismissed_notice_' . $this-&gt;id, null, true );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Forces plugin activation if the parameter 'force_activation' is</span>&nbsp;</div></li><li><div><span class="comment">       * set to true.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * This allows theme authors to specify certain plugins that must be</span>&nbsp;</div></li><li><div><span class="comment">       * active at all times while using the current theme.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Please take special care when using this parameter as it has the</span>&nbsp;</div></li><li><div><span class="comment">       * potential to be harmful if not used correctly. Setting this parameter</span>&nbsp;</div></li><li><div><span class="comment">       * to true will not allow the specified plugin to be deactivated unless</span>&nbsp;</div></li><li><div><span class="comment">       * the user switches themes.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function force_activation() {&nbsp;</div></li><li><div>          foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>              if ( true === $plugin['force_activation'] ) {&nbsp;</div></li><li><div>                  if ( ! $this-&gt;is_plugin_installed( $slug ) ) {&nbsp;</div></li><li><div>                      <span class="comment">// Oops, plugin isn't there so iterate to next condition.</span>&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  } elseif ( $this-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>                      <span class="comment">// There we go, activate the plugin.</span>&nbsp;</div></li><li><div>                      activate_plugin( $plugin['file_path'] );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Forces plugin deactivation if the parameter 'force_deactivation'</span>&nbsp;</div></li><li><div><span class="comment">       * is set to true and adds the plugin to the 'recently active' plugins list.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * This allows theme authors to specify certain plugins that must be</span>&nbsp;</div></li><li><div><span class="comment">       * deactivated upon switching from the current theme to another.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Please take special care when using this parameter as it has the</span>&nbsp;</div></li><li><div><span class="comment">       * potential to be harmful if not used correctly.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function force_deactivation() {&nbsp;</div></li><li><div>          $deactivated = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Only proceed forward if the parameter is set to true and plugin is active</span>&nbsp;</div></li><li><div><span class="comment">               * as a 'normal' (not must-use) plugin.</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              if ( true === $plugin['force_deactivation'] && is_plugin_active( $plugin['file_path'] ) ) {&nbsp;</div></li><li><div>                  deactivate_plugins( $plugin['file_path'] );&nbsp;</div></li><li><div>                  $deactivated[ $plugin['file_path'] ] = time();&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $deactivated ) ) {&nbsp;</div></li><li><div>              update_option( 'recently_activated', $deactivated + (array) get_option( 'recently_activated' ) );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Echo the current TGMPA version number to the page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function show_tgmpa_version() {&nbsp;</div></li><li><div>          echo '&lt;p style=&quot;float: right; padding: 0em 1.5em 0.5em 0;&quot;&gt;&lt;strong&gt;&lt;small&gt;', &nbsp;</div></li><li><div>              esc_html(&nbsp;</div></li><li><div>                  sprintf(&nbsp;</div></li><li><div>                      <span class="comment">/** translators: %s: version number */</span>&nbsp;</div></li><li><div>                      __( 'TGMPA v%s', 'tgmpa' ), &nbsp;</div></li><li><div>                      self::TGMPA_VERSION&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>              '&lt;/small&gt;&lt;/strong&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Returns the singleton instance of the class.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.4.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return \TGM_Plugin_Activation The TGM_Plugin_Activation object.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static function get_instance() {&nbsp;</div></li><li><div>          if ( ! isset( self::$instance ) && ! ( self::$instance instanceof self ) ) {&nbsp;</div></li><li><div>              self::$instance = new self();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return self::$instance;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( ! function_exists( 'load_tgm_plugin_activation' ) ) {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Ensure only one instance of the class is ever invoked.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      function load_tgm_plugin_activation() {&nbsp;</div></li><li><div>          $GLOBALS['tgmpa'] = TGM_Plugin_Activation::get_instance();&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  if ( did_action( 'plugins_loaded' ) ) {&nbsp;</div></li><li><div>      load_tgm_plugin_activation();&nbsp;</div></li><li><div>  } else {&nbsp;</div></li><li><div>      add_action( 'plugins_loaded', 'load_tgm_plugin_activation' );&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! function_exists( 'tgmpa' ) ) {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Helper function to register a collection of required plugins.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.0.0</span>&nbsp;</div></li><li><div><span class="comment">   * @api</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $plugins An array of plugin arrays.</span>&nbsp;</div></li><li><div><span class="comment">   * @param array $config  Optional. An array of configuration values.</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function tgmpa( $plugins, $config = array() ) {&nbsp;</div></li><li><div>      $instance = call_user_func( array( get_class( $GLOBALS['tgmpa'] ), 'get_instance' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      foreach ( $plugins as $plugin ) {&nbsp;</div></li><li><div>          call_user_func( array( $instance, 'register' ), $plugin );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( ! empty( $config ) && is_array( $config ) ) {&nbsp;</div></li><li><div>          <span class="comment">// Send out notices for deprecated arguments passed.</span>&nbsp;</div></li><li><div>          if ( isset( $config['notices'] ) ) {&nbsp;</div></li><li><div>              _deprecated_argument( __FUNCTION__, '2.2.0', 'The `notices` config parameter was renamed to `has_notices` in TGMPA 2.2.0. Please adjust your configuration.' );&nbsp;</div></li><li><div>              if ( ! isset( $config['has_notices'] ) ) {&nbsp;</div></li><li><div>                  $config['has_notices'] = $config['notices'];&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $config['parent_menu_slug'] ) ) {&nbsp;</div></li><li><div>              _deprecated_argument( __FUNCTION__, '2.4.0', 'The `parent_menu_slug` config parameter was removed in TGMPA 2.4.0. In TGMPA 2.5.0 an alternative was (re-)introduced. Please adjust your configuration. For more information visit the website: http:<span class="comment"><span class="comment">//tgmpluginactivation.com/configuration/#h-configuration-options.' );</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>          if ( isset( $config['parent_url_slug'] ) ) {&nbsp;</div></li><li><div>              _deprecated_argument( __FUNCTION__, '2.4.0', 'The `parent_url_slug` config parameter was removed in TGMPA 2.4.0. In TGMPA 2.5.0 an alternative was (re-)introduced. Please adjust your configuration. For more information visit the website: http:<span class="comment"><span class="comment">//tgmpluginactivation.com/configuration/#h-configuration-options.' );</span></span>&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          call_user_func( array( $instance, 'config' ), $config );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * WP_List_Table isn't always available. If it isn't available, </span>&nbsp;</div></li><li><div><span class="comment"> * we load it here.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>if ( ! class_exists( 'WP_List_Table' ) ) {&nbsp;</div></li><li><div>  require_once ABSPATH . 'wp-admin/includes/class-wp-list-table.php';&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! class_exists( 'TGMPA_List_Table' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * List table class for handling plugins.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Extends the WP_List_Table class to provide a future-compatible</span>&nbsp;</div></li><li><div><span class="comment">   * way of listing out all required/recommended plugins.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Gives users an interface similar to the Plugin Administration</span>&nbsp;</div></li><li><div><span class="comment">   * area with similar (albeit stripped down) capabilities.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * This class also allows for the bulk install of plugins.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @package TGM-Plugin-Activation</span>&nbsp;</div></li><li><div><span class="comment">   * @author  Thomas Griffin</span>&nbsp;</div></li><li><div><span class="comment">   * @author  Gary Jones</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  class TGMPA_List_Table extends WP_List_Table {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * TGMPA instance.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var object</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected $tgmpa;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * The currently chosen view.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var string One of: 'all', 'install', 'update', 'activate'</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public $view_context = 'all';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * The plugin counts for the various views.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected $view_totals = array(&nbsp;</div></li><li><div>          'all' =&gt; 0, &nbsp;</div></li><li><div>          'install' =&gt; 0, &nbsp;</div></li><li><div>          'update' =&gt; 0, &nbsp;</div></li><li><div>          'activate' =&gt; 0, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * References parent constructor and sets defaults for class.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function __construct() {&nbsp;</div></li><li><div>          $this-&gt;tgmpa = call_user_func( array( get_class( $GLOBALS['tgmpa'] ), 'get_instance' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          parent::__construct(&nbsp;</div></li><li><div>              array(&nbsp;</div></li><li><div>                  'singular' =&gt; 'plugin', &nbsp;</div></li><li><div>                  'plural' =&gt; 'plugins', &nbsp;</div></li><li><div>                  'ajax' =&gt; false, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( isset( $_REQUEST['plugin_status'] ) && in_array( $_REQUEST['plugin_status'], array( 'install', 'update', 'activate' ), true ) ) {&nbsp;</div></li><li><div>              $this-&gt;view_context = sanitize_key( $_REQUEST['plugin_status'] );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          add_filter( 'tgmpa_table_data_items', array( $this, 'sort_table_items' ) );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get a list of CSS classes for the &lt;table&gt; tag.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Overruled to prevent the 'plural' argument from being added.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array CSS classnames.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_table_classes() {&nbsp;</div></li><li><div>          return array( 'widefat', 'fixed' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Gathers and renames all of our plugin information to be used by WP_List_Table to create our table.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array $table_data Information for use in table.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function _gather_plugin_data() {&nbsp;</div></li><li><div>          <span class="comment">// Load thickbox for plugin links.</span>&nbsp;</div></li><li><div>          $this-&gt;tgmpa-&gt;admin_init();&nbsp;</div></li><li><div>          $this-&gt;tgmpa-&gt;thickbox();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Categorize the plugins which have open actions.</span>&nbsp;</div></li><li><div>          $plugins = $this-&gt;categorize_plugins_to_views();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Set the counts for the view links.</span>&nbsp;</div></li><li><div>          $this-&gt;set_view_totals( $plugins );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Prep variables for use and grab list of all installed plugins.</span>&nbsp;</div></li><li><div>          $table_data = array();&nbsp;</div></li><li><div>          $i = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Redirect to the 'all' view if no plugins were found for the selected view context.</span>&nbsp;</div></li><li><div>          if ( empty( $plugins[ $this-&gt;view_context ] ) ) {&nbsp;</div></li><li><div>              $this-&gt;view_context = 'all';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $plugins[ $this-&gt;view_context ] as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>              $table_data[ $i ]['sanitized_plugin'] = $plugin['name'];&nbsp;</div></li><li><div>              $table_data[ $i ]['slug'] = $slug;&nbsp;</div></li><li><div>              $table_data[ $i ]['plugin'] = '&lt;strong&gt;' . $this-&gt;tgmpa-&gt;get_info_link( $slug ) . '&lt;/strong&gt;';&nbsp;</div></li><li><div>              $table_data[ $i ]['source'] = $this-&gt;get_plugin_source_type_text( $plugin['source_type'] );&nbsp;</div></li><li><div>              $table_data[ $i ]['type'] = $this-&gt;get_plugin_advise_type_text( $plugin['required'] );&nbsp;</div></li><li><div>              $table_data[ $i ]['status'] = $this-&gt;get_plugin_status_text( $slug );&nbsp;</div></li><li><div>              $table_data[ $i ]['installed_version'] = $this-&gt;tgmpa-&gt;get_installed_version( $slug );&nbsp;</div></li><li><div>              $table_data[ $i ]['minimum_version'] = $plugin['version'];&nbsp;</div></li><li><div>              $table_data[ $i ]['available_version'] = $this-&gt;tgmpa-&gt;does_plugin_have_update( $slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Prep the upgrade notice info.</span>&nbsp;</div></li><li><div>              $upgrade_notice = $this-&gt;tgmpa-&gt;get_upgrade_notice( $slug );&nbsp;</div></li><li><div>              if ( ! empty( $upgrade_notice ) ) {&nbsp;</div></li><li><div>                  $table_data[ $i ]['upgrade_notice'] = $upgrade_notice;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  add_action( &quot;tgmpa_after_plugin_row_{$slug}&quot;, array( $this, 'wp_plugin_update_row' ), 10, 2 );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $table_data[ $i ] = apply_filters( 'tgmpa_table_data_item', $table_data[ $i ], $plugin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $i++;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $table_data;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Categorize the plugins which have open actions into views for the TGMPA page.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function categorize_plugins_to_views() {&nbsp;</div></li><li><div>          $plugins = array(&nbsp;</div></li><li><div>              'all' =&gt; array(), <span class="comment">// Meaning: all plugins which still have open actions.</span>&nbsp;</div></li><li><div>              'install' =&gt; array(), &nbsp;</div></li><li><div>              'update' =&gt; array(), &nbsp;</div></li><li><div>              'activate' =&gt; array(), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;tgmpa-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>              if ( $this-&gt;tgmpa-&gt;is_plugin_active( $slug ) && false === $this-&gt;tgmpa-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// No need to display plugins if they are installed, up-to-date and active.</span>&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $plugins['all'][ $slug ] = $plugin;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! $this-&gt;tgmpa-&gt;is_plugin_installed( $slug ) ) {&nbsp;</div></li><li><div>                      $plugins['install'][ $slug ] = $plugin;&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      if ( false !== $this-&gt;tgmpa-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>                          $plugins['update'][ $slug ] = $plugin;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( $this-&gt;tgmpa-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>                          $plugins['activate'][ $slug ] = $plugin;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $plugins;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Set the counts for the view links.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $plugins Plugins order by view.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function set_view_totals( $plugins ) {&nbsp;</div></li><li><div>          foreach ( $plugins as $type =&gt; $list ) {&nbsp;</div></li><li><div>              $this-&gt;view_totals[ $type ] = count( $list );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get the plugin required/recommended text string.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $required Plugin required setting.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_plugin_advise_type_text( $required ) {&nbsp;</div></li><li><div>          if ( true === $required ) {&nbsp;</div></li><li><div>              return __( 'Required', 'tgmpa' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return __( 'Recommended', 'tgmpa' );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get the plugin source type text string.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $type Plugin type.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_plugin_source_type_text( $type ) {&nbsp;</div></li><li><div>          $string = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          switch ( $type ) {&nbsp;</div></li><li><div>              case 'repo':&nbsp;</div></li><li><div>                  $string = __( 'WordPress Repository', 'tgmpa' );&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'external':&nbsp;</div></li><li><div>                  $string = __( 'External Source', 'tgmpa' );&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>              case 'bundled':&nbsp;</div></li><li><div>                  $string = __( 'Pre-Packaged', 'tgmpa' );&nbsp;</div></li><li><div>                  break;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $string;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Determine the plugin status message.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_plugin_status_text( $slug ) {&nbsp;</div></li><li><div>          if ( ! $this-&gt;tgmpa-&gt;is_plugin_installed( $slug ) ) {&nbsp;</div></li><li><div>              return __( 'Not Installed', 'tgmpa' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! $this-&gt;tgmpa-&gt;is_plugin_active( $slug ) ) {&nbsp;</div></li><li><div>              $install_status = __( 'Installed But Not Activated', 'tgmpa' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              $install_status = __( 'Active', 'tgmpa' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $update_status = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;tgmpa-&gt;does_plugin_require_update( $slug ) && false === $this-&gt;tgmpa-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>              $update_status = __( 'Required Update not Available', 'tgmpa' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( $this-&gt;tgmpa-&gt;does_plugin_require_update( $slug ) ) {&nbsp;</div></li><li><div>              $update_status = __( 'Requires Update', 'tgmpa' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          } elseif ( false !== $this-&gt;tgmpa-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>              $update_status = __( 'Update recommended', 'tgmpa' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( '' === $update_status ) {&nbsp;</div></li><li><div>              return $install_status;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return sprintf(&nbsp;</div></li><li><div>              <span class="comment">/** translators: 1: install status, 2: update status */</span>&nbsp;</div></li><li><div>              _x( '%1$s, %2$s', 'Install/Update Status', 'tgmpa' ), &nbsp;</div></li><li><div>              $install_status, &nbsp;</div></li><li><div>              $update_status&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Sort plugins by Required/Recommended type and by alphabetical plugin name within each type.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $items Prepared table items.</span>&nbsp;</div></li><li><div><span class="comment">       * @return array Sorted table items.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function sort_table_items( $items ) {&nbsp;</div></li><li><div>          $type = array();&nbsp;</div></li><li><div>          $name = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $items as $i =&gt; $plugin ) {&nbsp;</div></li><li><div>              $type[ $i ] = $plugin['type']; <span class="comment">// Required / recommended.</span>&nbsp;</div></li><li><div>              $name[ $i ] = $plugin['sanitized_plugin'];&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          array_multisort( $type, SORT_DESC, $name, SORT_ASC, $items );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $items;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get an associative array ( id =&gt; link ) of the views available on this table.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_views() {&nbsp;</div></li><li><div>          $status_links = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          foreach ( $this-&gt;view_totals as $type =&gt; $count ) {&nbsp;</div></li><li><div>              if ( $count &lt; 1 ) {&nbsp;</div></li><li><div>                  continue;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              switch ( $type ) {&nbsp;</div></li><li><div>                  case 'all':&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: number of plugins. */</span></span></span></span>&nbsp;</div></li><li><div>                      $text = _nx( 'All &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;', 'All &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;', $count, 'plugins', 'tgmpa' );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'install':&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: number of plugins. */</span></span></span></span>&nbsp;</div></li><li><div>                      $text = _n( 'To Install &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;', 'To Install &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;', $count, 'tgmpa' );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'update':&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: number of plugins. */</span></span></span></span>&nbsp;</div></li><li><div>                      $text = _n( 'Update Available &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;', 'Update Available &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;', $count, 'tgmpa' );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  case 'activate':&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: number of plugins. */</span></span></span></span>&nbsp;</div></li><li><div>                      $text = _n( 'To Activate &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;', 'To Activate &lt;span class=&quot;count&quot;&gt;(%s)&lt;/span&gt;', $count, 'tgmpa' );&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>                  default:&nbsp;</div></li><li><div>                      $text = '';&nbsp;</div></li><li><div>                      break;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( ! empty( $text ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $status_links[ $type ] = sprintf(&nbsp;</div></li><li><div>                      '&lt;a href=&quot;%s&quot;%s&gt;%s&lt;/a&gt;', &nbsp;</div></li><li><div>                      esc_url( $this-&gt;tgmpa-&gt;get_tgmpa_status_url( $type ) ), &nbsp;</div></li><li><div>                      ( $type === $this-&gt;view_context ) ? ' class=&quot;current&quot;' : '', &nbsp;</div></li><li><div>                      sprintf( $text, number_format_i18n( $count ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $status_links;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Create default columns to display important plugin information</span>&nbsp;</div></li><li><div><span class="comment">       * like type, action and status.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array  $item        Array of item data.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $column_name The name of the column.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function column_default( $item, $column_name ) {&nbsp;</div></li><li><div>          return $item[ $column_name ];&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Required for bulk installing.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Adds a checkbox for each plugin.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $item Array of item data.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string The input checkbox with all necessary info.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function column_cb( $item ) {&nbsp;</div></li><li><div>          return sprintf(&nbsp;</div></li><li><div>              '&lt;input type=&quot;checkbox&quot; name=&quot;%1$s[]&quot; value=&quot;%2$s&quot; id=&quot;%3$s&quot; /&gt;', &nbsp;</div></li><li><div>              esc_attr( $this-&gt;_args['singular'] ), &nbsp;</div></li><li><div>              esc_attr( $item['slug'] ), &nbsp;</div></li><li><div>              esc_attr( $item['sanitized_plugin'] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Create default title column along with the action links.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $item Array of item data.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string The plugin name and action links.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function column_plugin( $item ) {&nbsp;</div></li><li><div>          return sprintf(&nbsp;</div></li><li><div>              '%1$s %2$s', &nbsp;</div></li><li><div>              $item['plugin'], &nbsp;</div></li><li><div>              $this-&gt;row_actions( $this-&gt;get_row_actions( $item ), true )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Create version information column.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $item Array of item data.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string HTML-formatted version information.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function column_version( $item ) {&nbsp;</div></li><li><div>          $output = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( $this-&gt;tgmpa-&gt;is_plugin_installed( $item['slug'] ) ) {&nbsp;</div></li><li><div>              $installed = ! empty( $item['installed_version'] ) ? $item['installed_version'] : _x( 'unknown', 'as in: &quot;version nr unknown&quot;', 'tgmpa' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $color = '';&nbsp;</div></li><li><div>              if ( ! empty( $item['minimum_version'] ) && $this-&gt;tgmpa-&gt;does_plugin_require_update( $item['slug'] ) ) {&nbsp;</div></li><li><div>                  $color = ' color: #ff0000; font-weight: bold;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $output[] = sprintf(&nbsp;</div></li><li><div>                  '&lt;p&gt;&lt;span style=&quot;min-width: 32px; text-align: right; float: right;%1$s&quot;&gt;%2$s&lt;/span&gt;' . __( 'Installed version:', 'tgmpa' ) . '&lt;/p&gt;', &nbsp;</div></li><li><div>                  $color, &nbsp;</div></li><li><div>                  $installed&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $item['minimum_version'] ) ) {&nbsp;</div></li><li><div>              $output[] = sprintf(&nbsp;</div></li><li><div>                  '&lt;p&gt;&lt;span style=&quot;min-width: 32px; text-align: right; float: right;&quot;&gt;%1$s&lt;/span&gt;' . __( 'Minimum required version:', 'tgmpa' ) . '&lt;/p&gt;', &nbsp;</div></li><li><div>                  $item['minimum_version']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! empty( $item['available_version'] ) ) {&nbsp;</div></li><li><div>              $color = '';&nbsp;</div></li><li><div>              if ( ! empty( $item['minimum_version'] ) && version_compare( $item['available_version'], $item['minimum_version'], '&gt;=' ) ) {&nbsp;</div></li><li><div>                  $color = ' color: #71C671; font-weight: bold;';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $output[] = sprintf(&nbsp;</div></li><li><div>                  '&lt;p&gt;&lt;span style=&quot;min-width: 32px; text-align: right; float: right;%1$s&quot;&gt;%2$s&lt;/span&gt;' . __( 'Available version:', 'tgmpa' ) . '&lt;/p&gt;', &nbsp;</div></li><li><div>                  $color, &nbsp;</div></li><li><div>                  $item['available_version']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( empty( $output ) ) {&nbsp;</div></li><li><div>              return '&nbsp;'; <span class="comment">// Let's not break the table layout.</span>&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return implode( &quot;\n&quot;, $output );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Sets default message within the plugins table if no plugins</span>&nbsp;</div></li><li><div><span class="comment">       * are left for interaction.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * Hides the menu item to prevent the user from clicking and</span>&nbsp;</div></li><li><div><span class="comment">       * getting a permissions error.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function no_items() {&nbsp;</div></li><li><div>          echo esc_html__( 'No plugins to install, update or activate.', 'tgmpa' ) . ' &lt;a href=&quot;' . esc_url( self_admin_url() ) . '&quot;&gt; ' . esc_html__( 'Return to the Dashboard', 'tgmpa' ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>          echo '&lt;style type=&quot;text/css&quot;&gt;#adminmenu .wp-submenu li.current { display: none !important; }&lt;/style&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Output all the column information within the table.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array $columns The column names.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_columns() {&nbsp;</div></li><li><div>          $columns = array(&nbsp;</div></li><li><div>              'cb' =&gt; '&lt;input type=&quot;checkbox&quot; /&gt;', &nbsp;</div></li><li><div>              'plugin' =&gt; __( 'Plugin', 'tgmpa' ), &nbsp;</div></li><li><div>              'source' =&gt; __( 'Source', 'tgmpa' ), &nbsp;</div></li><li><div>              'type' =&gt; __( 'Type', 'tgmpa' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'all' === $this-&gt;view_context || 'update' === $this-&gt;view_context ) {&nbsp;</div></li><li><div>              $columns['version'] = __( 'Version', 'tgmpa' );&nbsp;</div></li><li><div>              $columns['status'] = __( 'Status', 'tgmpa' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return apply_filters( 'tgmpa_table_columns', $columns );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get name of default primary column</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0 / WP 4.3+ compatibility</span>&nbsp;</div></li><li><div><span class="comment">       * @access protected</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_default_primary_column_name() {&nbsp;</div></li><li><div>          return 'plugin';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get the name of the primary column.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0 / WP 4.3+ compatibility</span>&nbsp;</div></li><li><div><span class="comment">       * @access protected</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return string The name of the primary column.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_primary_column_name() {&nbsp;</div></li><li><div>          if ( method_exists( 'WP_List_Table', 'get_primary_column_name' ) ) {&nbsp;</div></li><li><div>              return parent::get_primary_column_name();&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return $this-&gt;get_default_primary_column_name();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Get the actions which are relevant for a specific plugin row.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param array $item Array of item data.</span>&nbsp;</div></li><li><div><span class="comment">       * @return array Array with relevant action links.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function get_row_actions( $item ) {&nbsp;</div></li><li><div>          $actions = array();&nbsp;</div></li><li><div>          $action_links = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Display the 'Install' action link if the plugin is not yet available.</span>&nbsp;</div></li><li><div>          if ( ! $this-&gt;tgmpa-&gt;is_plugin_installed( $item['slug'] ) ) {&nbsp;</div></li><li><div>              <span class="comment"><span class="comment"><span class="comment">/** translators: %2$s: plugin name in screen reader markup */</span></span></span>&nbsp;</div></li><li><div>              $actions['install'] = __( 'Install %2$s', 'tgmpa' );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              <span class="comment">// Display the 'Update' action link if an update is available and WP complies with plugin minimum.</span>&nbsp;</div></li><li><div>              if ( false !== $this-&gt;tgmpa-&gt;does_plugin_have_update( $item['slug'] ) && $this-&gt;tgmpa-&gt;can_plugin_update( $item['slug'] ) ) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">/** translators: %2$s: plugin name in screen reader markup */</span></span></span>&nbsp;</div></li><li><div>                  $actions['update'] = __( 'Update %2$s', 'tgmpa' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Display the 'Activate' action link, but only if the plugin meets the minimum version.</span>&nbsp;</div></li><li><div>              if ( $this-&gt;tgmpa-&gt;can_plugin_activate( $item['slug'] ) ) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment"><span class="comment">/** translators: %2$s: plugin name in screen reader markup */</span></span></span>&nbsp;</div></li><li><div>                  $actions['activate'] = __( 'Activate %2$s', 'tgmpa' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Create the actual links.</span>&nbsp;</div></li><li><div>          foreach ( $actions as $action =&gt; $text ) {&nbsp;</div></li><li><div>              $nonce_url = wp_nonce_url(&nbsp;</div></li><li><div>                  add_query_arg(&nbsp;</div></li><li><div>                      array(&nbsp;</div></li><li><div>                          'plugin' =&gt; urlencode( $item['slug'] ), &nbsp;</div></li><li><div>                          'tgmpa-' . $action =&gt; $action . '-plugin', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                      $this-&gt;tgmpa-&gt;get_tgmpa_url()&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                  'tgmpa-' . $action, &nbsp;</div></li><li><div>                  'tgmpa-nonce'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $action_links[ $action ] = sprintf(&nbsp;</div></li><li><div>                  '&lt;a href=&quot;%1$s&quot;&gt;' . esc_html( $text ) . '&lt;/a&gt;', <span class="comment">// $text contains the second placeholder.</span>&nbsp;</div></li><li><div>                  esc_url( $nonce_url ), &nbsp;</div></li><li><div>                  '&lt;span class=&quot;screen-reader-text&quot;&gt;' . esc_html( $item['sanitized_plugin'] ) . '&lt;/span&gt;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $prefix = ( defined( 'WP_NETWORK_ADMIN' ) && WP_NETWORK_ADMIN ) ? 'network_admin_' : '';&nbsp;</div></li><li><div>          return apply_filters( &quot;tgmpa_{$prefix}plugin_action_links&quot;, array_filter( $action_links ), $item['slug'], $item, $this-&gt;view_context );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Generates content for a single row of the table.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param object $item The current item.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function single_row( $item ) {&nbsp;</div></li><li><div>          parent::single_row( $item );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">           * Fires after each specific row in the TGMPA Plugins list table.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * The dynamic portion of the hook name, `$item['slug']`, refers to the slug</span>&nbsp;</div></li><li><div><span class="comment">           * for the plugin.</span>&nbsp;</div></li><li><div><span class="comment">           *</span>&nbsp;</div></li><li><div><span class="comment">           * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">           */</span>&nbsp;</div></li><li><div>          do_action( &quot;tgmpa_after_plugin_row_{$item['slug']}&quot;, $item['slug'], $item, $this-&gt;view_context );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Show the upgrade notice below a plugin row if there is one.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @see /wp-admin/includes/update.php</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $slug Plugin slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @param array  $item The information available in this table row.</span>&nbsp;</div></li><li><div><span class="comment">       * @return null Return early if upgrade notice is empty.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function wp_plugin_update_row( $slug, $item ) {&nbsp;</div></li><li><div>          if ( empty( $item['upgrade_notice'] ) ) {&nbsp;</div></li><li><div>              return;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          echo '&nbsp;</div></li><li><div>              &lt;tr class=&quot;plugin-update-tr&quot;&gt;&nbsp;</div></li><li><div>                  &lt;td colspan=&quot;', absint( $this-&gt;get_column_count() ), '&quot; class=&quot;plugin-update colspanchange&quot;&gt;&nbsp;</div></li><li><div>                      &lt;div class=&quot;update-message&quot;&gt;', &nbsp;</div></li><li><div>                          esc_html__( 'Upgrade message from the plugin author:', 'tgmpa' ), &nbsp;</div></li><li><div>                          ' &lt;strong&gt;', wp_kses_data( $item['upgrade_notice'] ), '&lt;/strong&gt;&nbsp;</div></li><li><div>                      &lt;/div&gt;&nbsp;</div></li><li><div>                  &lt;/td&gt;&nbsp;</div></li><li><div>              &lt;/tr&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Extra controls to be displayed between bulk actions and pagination.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $which 'top' or 'bottom' table navigation.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function extra_tablenav( $which ) {&nbsp;</div></li><li><div>          if ( 'bottom' === $which ) {&nbsp;</div></li><li><div>              $this-&gt;tgmpa-&gt;show_tgmpa_version();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Defines the bulk actions for handling registered plugins.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @return array $actions The bulk actions for the plugin install table.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function get_bulk_actions() {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          $actions = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'update' !== $this-&gt;view_context && 'activate' !== $this-&gt;view_context ) {&nbsp;</div></li><li><div>              if ( current_user_can( 'install_plugins' ) ) {&nbsp;</div></li><li><div>                  $actions['tgmpa-bulk-install'] = __( 'Install', 'tgmpa' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( 'install' !== $this-&gt;view_context ) {&nbsp;</div></li><li><div>              if ( current_user_can( 'update_plugins' ) ) {&nbsp;</div></li><li><div>                  $actions['tgmpa-bulk-update'] = __( 'Update', 'tgmpa' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              if ( current_user_can( 'activate_plugins' ) ) {&nbsp;</div></li><li><div>                  $actions['tgmpa-bulk-activate'] = __( 'Activate', 'tgmpa' );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $actions;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Processes bulk installation and activation actions.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * The bulk installation process looks for the $_POST information and passes that</span>&nbsp;</div></li><li><div><span class="comment">       * through if a user has to use WP_Filesystem to enter their credentials.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function process_bulk_actions() {&nbsp;</div></li><li><div>          <span class="comment">// Bulk installation process.</span>&nbsp;</div></li><li><div>          if ( 'tgmpa-bulk-install' === $this-&gt;current_action() || 'tgmpa-bulk-update' === $this-&gt;current_action() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              check_admin_referer( 'bulk-' . $this-&gt;_args['plural'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $install_type = 'install';&nbsp;</div></li><li><div>              if ( 'tgmpa-bulk-update' === $this-&gt;current_action() ) {&nbsp;</div></li><li><div>                  $install_type = 'update';&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $plugins_to_install = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Did user actually select any plugins to install/update ?</span>&nbsp;</div></li><li><div>              if ( empty( $_POST['plugin'] ) ) {&nbsp;</div></li><li><div>                  if ( 'install' === $install_type ) {&nbsp;</div></li><li><div>                      $message = __( 'No plugins were selected to be installed. No action taken.', 'tgmpa' );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $message = __( 'No plugins were selected to be updated. No action taken.', 'tgmpa' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', esc_html( $message ), '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  return false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_array( $_POST['plugin'] ) ) {&nbsp;</div></li><li><div>                  $plugins_to_install = (array) $_POST['plugin'];&nbsp;</div></li><li><div>              } elseif ( is_string( $_POST['plugin'] ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// Received via Filesystem page - un-flatten array (WP bug #19643).</span>&nbsp;</div></li><li><div>                  $plugins_to_install = explode( ', ', $_POST['plugin'] );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Sanitize the received input.</span>&nbsp;</div></li><li><div>              $plugins_to_install = array_map( 'urldecode', $plugins_to_install );&nbsp;</div></li><li><div>              $plugins_to_install = array_map( array( $this-&gt;tgmpa, 'sanitize_key' ), $plugins_to_install );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Validate the received input.</span>&nbsp;</div></li><li><div>              foreach ( $plugins_to_install as $key =&gt; $slug ) {&nbsp;</div></li><li><div>                  <span class="comment">// Check if the plugin was registered with TGMPA and remove if not.</span>&nbsp;</div></li><li><div>                  if ( ! isset( $this-&gt;tgmpa-&gt;plugins[ $slug ] ) ) {&nbsp;</div></li><li><div>                      unset( $plugins_to_install[ $key ] );&nbsp;</div></li><li><div>                      continue;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// For install: make sure this is a plugin we *can* install and not one already installed.</span>&nbsp;</div></li><li><div>                  if ( 'install' === $install_type && true === $this-&gt;tgmpa-&gt;is_plugin_installed( $slug ) ) {&nbsp;</div></li><li><div>                      unset( $plugins_to_install[ $key ] );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// For updates: make sure this is a plugin we *can* update (update available and WP version ok).</span>&nbsp;</div></li><li><div>                  if ( 'update' === $install_type && false === $this-&gt;tgmpa-&gt;is_plugin_updatetable( $slug ) ) {&nbsp;</div></li><li><div>                      unset( $plugins_to_install[ $key ] );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// No need to proceed further if we have no plugins to handle.</span>&nbsp;</div></li><li><div>              if ( empty( $plugins_to_install ) ) {&nbsp;</div></li><li><div>                  if ( 'install' === $install_type ) {&nbsp;</div></li><li><div>                      $message = __( 'No plugins are available to be installed at this time.', 'tgmpa' );&nbsp;</div></li><li><div>                  } else {&nbsp;</div></li><li><div>                      $message = __( 'No plugins are available to be updated at this time.', 'tgmpa' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', esc_html( $message ), '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  return false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Pass all necessary information if WP_Filesystem is needed.</span>&nbsp;</div></li><li><div>              $url = wp_nonce_url(&nbsp;</div></li><li><div>                  $this-&gt;tgmpa-&gt;get_tgmpa_url(), &nbsp;</div></li><li><div>                  'bulk-' . $this-&gt;_args['plural']&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Give validated data back to $_POST which is the only place the filesystem looks for extra fields.</span>&nbsp;</div></li><li><div>              $_POST['plugin'] = implode( ', ', $plugins_to_install ); <span class="comment">// Work around for WP bug #19643.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $method = ''; <span class="comment"><span class="comment">// Leave blank so WP_Filesystem can populate it as necessary.</span></span>&nbsp;</div></li><li><div>              $fields = array_keys( $_POST ); <span class="comment">// Extra fields to pass to WP_Filesystem.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( false === ( $creds = request_filesystem_credentials( esc_url_raw( $url ), $method, false, false, $fields ) ) ) {&nbsp;</div></li><li><div>                  return true; <span class="comment">// Stop the normal page form from displaying, credential request form will be shown.</span>&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Now we have some credentials, setup WP_Filesystem.</span>&nbsp;</div></li><li><div>              if ( ! WP_Filesystem( $creds ) ) {&nbsp;</div></li><li><div>                  <span class="comment">// Our credentials were no good, ask the user for them again.</span>&nbsp;</div></li><li><div>                  request_filesystem_credentials( esc_url_raw( $url ), $method, true, false, $fields );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/** If we arrive here, we have the filesystem */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Store all information in arrays since we are processing a bulk installation.</span>&nbsp;</div></li><li><div>              $names = array();&nbsp;</div></li><li><div>              $sources = array(); <span class="comment">// Needed for installs.</span>&nbsp;</div></li><li><div>              $file_paths = array(); <span class="comment">// Needed for upgrades.</span>&nbsp;</div></li><li><div>              $to_inject = array(); <span class="comment">// Information to inject into the update_plugins transient.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Prepare the data for validated plugins for the install/upgrade.</span>&nbsp;</div></li><li><div>              foreach ( $plugins_to_install as $slug ) {&nbsp;</div></li><li><div>                  $name = $this-&gt;tgmpa-&gt;plugins[ $slug ]['name'];&nbsp;</div></li><li><div>                  $source = $this-&gt;tgmpa-&gt;get_download_url( $slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  if ( ! empty( $name ) && ! empty( $source ) ) {&nbsp;</div></li><li><div>                      $names[] = $name;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      switch ( $install_type ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          case 'install':&nbsp;</div></li><li><div>                              $sources[] = $source;&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          case 'update':&nbsp;</div></li><li><div>                              $file_paths[] = $this-&gt;tgmpa-&gt;plugins[ $slug ]['file_path'];&nbsp;</div></li><li><div>                              $to_inject[ $slug ]           = $this-&gt;tgmpa-&gt;plugins[ $slug ];&nbsp;</div></li><li><div>                              $to_inject[ $slug ]['source'] = $source;&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              unset( $slug, $name, $source );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Create a new instance of TGMPA_Bulk_Installer.</span>&nbsp;</div></li><li><div>              $installer = new TGMPA_Bulk_Installer(&nbsp;</div></li><li><div>                  new TGMPA_Bulk_Installer_Skin(&nbsp;</div></li><li><div>                      array(&nbsp;</div></li><li><div>                          'url' =&gt; esc_url_raw( $this-&gt;tgmpa-&gt;get_tgmpa_url() ), &nbsp;</div></li><li><div>                          'nonce' =&gt; 'bulk-' . $this-&gt;_args['plural'], &nbsp;</div></li><li><div>                          'names' =&gt; $names, &nbsp;</div></li><li><div>                          'install_type' =&gt; $install_type, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Wrap the install process with the appropriate HTML.</span>&nbsp;</div></li><li><div>              echo '&lt;div class=&quot;tgmpa&quot;&gt;', &nbsp;</div></li><li><div>                  '&lt;h2 style=&quot;font-size: 23px; font-weight: 400; line-height: 29px; margin: 0; padding: 9px 15px 4px 0;&quot;&gt;', esc_html( get_admin_page_title() ), '&lt;/h2&gt;&nbsp;</div></li><li><div>                  &lt;div class=&quot;update-php&quot; style=&quot;width: 100%; height: 98%; min-height: 850px; padding-top: 1px;&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Process the bulk installation submissions.</span>&nbsp;</div></li><li><div>              add_filter( 'upgrader_source_selection', array( $this-&gt;tgmpa, 'maybe_adjust_source_dir' ), 1, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( 'tgmpa-bulk-update' === $this-&gt;current_action() ) {&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">// Inject our info into the update transient.</span></span>&nbsp;</div></li><li><div>                  $this-&gt;tgmpa-&gt;inject_update_info( $to_inject );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  $installer-&gt;bulk_upgrade( $file_paths );&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $installer-&gt;bulk_install( $sources );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              remove_filter( 'upgrader_source_selection', array( $this-&gt;tgmpa, 'maybe_adjust_source_dir' ), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              echo '&lt;/div&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Bulk activation process.</span>&nbsp;</div></li><li><div>          if ( 'tgmpa-bulk-activate' === $this-&gt;current_action() ) {&nbsp;</div></li><li><div>              check_admin_referer( 'bulk-' . $this-&gt;_args['plural'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Did user actually select any plugins to activate ?</span>&nbsp;</div></li><li><div>              if ( empty( $_POST['plugin'] ) ) {&nbsp;</div></li><li><div>                  echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', esc_html__( 'No plugins were selected to be activated. No action taken.', 'tgmpa' ), '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  return false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Grab plugin data from $_POST.</span>&nbsp;</div></li><li><div>              $plugins = array();&nbsp;</div></li><li><div>              if ( isset( $_POST['plugin'] ) ) {&nbsp;</div></li><li><div>                  $plugins = array_map( 'urldecode', (array) $_POST['plugin'] );&nbsp;</div></li><li><div>                  $plugins = array_map( array( $this-&gt;tgmpa, 'sanitize_key' ), $plugins );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              $plugins_to_activate = array();&nbsp;</div></li><li><div>              $plugin_names = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Grab the file paths for the selected & inactive plugins from the registration array.</span>&nbsp;</div></li><li><div>              foreach ( $plugins as $slug ) {&nbsp;</div></li><li><div>                  if ( $this-&gt;tgmpa-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>                      $plugins_to_activate[] = $this-&gt;tgmpa-&gt;plugins[ $slug ]['file_path'];&nbsp;</div></li><li><div>                      $plugin_names[] = $this-&gt;tgmpa-&gt;plugins[ $slug ]['name'];&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>              unset( $slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Return early if there are no plugins to activate.</span>&nbsp;</div></li><li><div>              if ( empty( $plugins_to_activate ) ) {&nbsp;</div></li><li><div>                  echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', esc_html__( 'No plugins are available to be activated at this time.', 'tgmpa' ), '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  return false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">// Now we are good to go - let's start activating plugins.</span>&nbsp;</div></li><li><div>              $activate = activate_plugins( $plugins_to_activate );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              if ( is_wp_error( $activate ) ) {&nbsp;</div></li><li><div>                  echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', wp_kses_post( $activate-&gt;get_error_message() ), '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  $count = count( $plugin_names ); <span class="comment">// Count so we can use _n function.</span>&nbsp;</div></li><li><div>                  $plugin_names = array_map( array( 'TGMPA_Utils', 'wrap_in_strong' ), $plugin_names );&nbsp;</div></li><li><div>                  $last_plugin = array_pop( $plugin_names ); <span class="comment"><span class="comment">// Pop off last name to prep for readability.</span></span>&nbsp;</div></li><li><div>                  $imploded = empty( $plugin_names ) ? $last_plugin : ( implode( ', ', $plugin_names ) . ' ' . esc_html_x( 'and', 'plugin A *and* plugin B', 'tgmpa' ) . ' ' . $last_plugin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  printf( <span class="comment">// WPCS: xss ok.</span>&nbsp;</div></li><li><div>                      '&lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;&lt;p&gt;%1$s %2$s.&lt;/p&gt;&lt;/div&gt;', &nbsp;</div></li><li><div>                      esc_html( _n( 'The following plugin was activated successfully:', 'The following plugins were activated successfully:', $count, 'tgmpa' ) ), &nbsp;</div></li><li><div>                      $imploded&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">// Update recently activated plugins option.</span>&nbsp;</div></li><li><div>                  $recent = (array) get_option( 'recently_activated' );&nbsp;</div></li><li><div>                  foreach ( $plugins_to_activate as $plugin =&gt; $time ) {&nbsp;</div></li><li><div>                      if ( isset( $recent[ $plugin ] ) ) {&nbsp;</div></li><li><div>                          unset( $recent[ $plugin ] );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>                  update_option( 'recently_activated', $recent );&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              unset( $_POST ); <span class="comment">// Reset the $_POST variable in case user wants to perform one action after another.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              return true;&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Prepares all of our information to be outputted into a usable table.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public function prepare_items() {&nbsp;</div></li><li><div>          $columns = $this-&gt;get_columns(); <span class="comment">// Get all necessary column information.</span>&nbsp;</div></li><li><div>          $hidden = array(); <span class="comment">// No columns to hide, but we must set as an array.</span>&nbsp;</div></li><li><div>          $sortable = array(); <span class="comment">// No reason to make sortable columns.</span>&nbsp;</div></li><li><div>          $primary = $this-&gt;get_primary_column_name(); <span class="comment">// Column which has the row actions.</span>&nbsp;</div></li><li><div>          $this-&gt;_column_headers = array( $columns, $hidden, $sortable, $primary ); <span class="comment">// Get all necessary column headers.</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Process our bulk activations here.</span>&nbsp;</div></li><li><div>          if ( 'tgmpa-bulk-activate' === $this-&gt;current_action() ) {&nbsp;</div></li><li><div>              $this-&gt;process_bulk_actions();&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          <span class="comment">// Store all of our plugin data into $items array so WP_List_Table can use it.</span>&nbsp;</div></li><li><div>          $this-&gt;items = apply_filters( 'tgmpa_table_data_items', $this-&gt;_gather_plugin_data() );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment">/** *********** DEPRECATED METHODS *********** */</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Retrieve plugin data, given the plugin name.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since      2.2.0</span>&nbsp;</div></li><li><div><span class="comment">       * @deprecated 2.5.0 use {@see TGM_Plugin_Activation::_get_plugin_data_from_name()} instead.</span>&nbsp;</div></li><li><div><span class="comment">       * @see        TGM_Plugin_Activation::_get_plugin_data_from_name()</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $name Name of the plugin, as it was registered.</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $data Optional. Array key of plugin data to return. Default is slug.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string|boolean Plugin slug if found, false otherwise.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected function _get_plugin_data_from_name( $name, $data = 'slug' ) {&nbsp;</div></li><li><div>          _deprecated_function( __FUNCTION__, 'TGMPA 2.5.0', 'TGM_Plugin_Activation::_get_plugin_data_from_name()' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return $this-&gt;tgmpa-&gt;_get_plugin_data_from_name( $name, $data );&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! class_exists( 'TGM_Bulk_Installer' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Hack: Prevent TGMPA v2.4.1- bulk installer class from being loaded if 2.4.1- is loaded after 2.5+.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * {@internal The TGMPA_Bulk_Installer class was originally called TGM_Bulk_Installer.</span>&nbsp;</div></li><li><div><span class="comment">   *            For more information, see that class.}}</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  class TGM_Bulk_Installer {&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>if ( ! class_exists( 'TGM_Bulk_Installer_Skin' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Hack: Prevent TGMPA v2.4.1- bulk installer skin class from being loaded if 2.4.1- is loaded after 2.5+.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.2</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * {@internal The TGMPA_Bulk_Installer_Skin class was originally called TGM_Bulk_Installer_Skin.</span>&nbsp;</div></li><li><div><span class="comment">   *            For more information, see that class.}}</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  class TGM_Bulk_Installer_Skin {&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div><span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment"> * The WP_Upgrader file isn't always available. If it isn't available, </span>&nbsp;</div></li><li><div><span class="comment"> * we load it here.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * We check to make sure no action or activation keys are set so that WordPress</span>&nbsp;</div></li><li><div><span class="comment"> * does not try to re-include the class when processing upgrades or installs outside</span>&nbsp;</div></li><li><div><span class="comment"> * of the class.</span>&nbsp;</div></li><li><div><span class="comment"> *</span>&nbsp;</div></li><li><div><span class="comment"> * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment"> */</span>&nbsp;</div></li><li><div>add_action( 'admin_init', 'tgmpa_load_bulk_installer' );&nbsp;</div></li><li><div>if ( ! function_exists( 'tgmpa_load_bulk_installer' ) ) {&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Load bulk installer</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  function tgmpa_load_bulk_installer() {&nbsp;</div></li><li><div>      <span class="comment">// Silently fail if 2.5+ is loaded *after* an older version.</span>&nbsp;</div></li><li><div>      if ( ! isset( $GLOBALS['tgmpa'] ) ) {&nbsp;</div></li><li><div>          return;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment"><span class="comment"><span class="comment">// Get TGMPA class instance.</span></span></span>&nbsp;</div></li><li><div>      $tgmpa_instance = call_user_func( array( get_class( $GLOBALS['tgmpa'] ), 'get_instance' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      if ( isset( $_GET['page'] ) && $tgmpa_instance-&gt;menu === $_GET['page'] ) {&nbsp;</div></li><li><div>          if ( ! class_exists( 'Plugin_Upgrader', false ) ) {&nbsp;</div></li><li><div>              require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php';&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! class_exists( 'TGMPA_Bulk_Installer' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Installer class to handle bulk plugin installations.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * Extends WP_Upgrader and customizes to suit the installation of multiple</span>&nbsp;</div></li><li><div><span class="comment">               * plugins.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * {@internal Since 2.5.0 the class is an extension of Plugin_Upgrader rather than WP_Upgrader.}}</span>&nbsp;</div></li><li><div><span class="comment">               * {@internal Since 2.5.2 the class has been renamed from TGM_Bulk_Installer to TGMPA_Bulk_Installer.</span>&nbsp;</div></li><li><div><span class="comment">               *            This was done to prevent backward compatibility issues with v2.3.6.}}</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @package TGM-Plugin-Activation</span>&nbsp;</div></li><li><div><span class="comment">               * @author  Thomas Griffin</span>&nbsp;</div></li><li><div><span class="comment">               * @author  Gary Jones</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              class TGMPA_Bulk_Installer extends Plugin_Upgrader {&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Holds result of bulk plugin installation.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @var string</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public $result;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Flag to check if bulk installation is occurring or not.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @var boolean</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public $bulk = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * TGMPA instance</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @var object</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  protected $tgmpa;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Whether or not the destination directory needs to be cleared ( = on update).</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @var bool</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  protected $clear_destination = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * References parent constructor and sets defaults for class.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @param \Bulk_Upgrader_Skin|null $skin Installer skin.</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function __construct( $skin = null ) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment">// Get TGMPA class instance.</span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;tgmpa = call_user_func( array( get_class( $GLOBALS['tgmpa'] ), 'get_instance' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      parent::__construct( $skin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( isset( $this-&gt;skin-&gt;options['install_type'] ) && 'update' === $this-&gt;skin-&gt;options['install_type'] ) {&nbsp;</div></li><li><div>                          $this-&gt;clear_destination = true;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( $this-&gt;tgmpa-&gt;is_automatic ) {&nbsp;</div></li><li><div>                          $this-&gt;activate_strings();&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      add_action( 'upgrader_process_complete', array( $this-&gt;tgmpa, 'populate_file_path' ) );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Sets the correct activation strings for the installer skin to use.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function activate_strings() {&nbsp;</div></li><li><div>                      $this-&gt;strings['activation_failed'] = __( 'Plugin activation failed.', 'tgmpa' );&nbsp;</div></li><li><div>                      $this-&gt;strings['activation_success'] = __( 'Plugin activated successfully.', 'tgmpa' );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Performs the actual installation of each plugin.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @see WP_Upgrader::run()</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @param array $options The installation config options.</span>&nbsp;</div></li><li><div><span class="comment">                   * @return null|array Return early if error, array of installation data on success.</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function run( $options ) {&nbsp;</div></li><li><div>                      $result = parent::run( $options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Reset the strings in case we changed one during automatic activation.</span>&nbsp;</div></li><li><div>                      if ( $this-&gt;tgmpa-&gt;is_automatic ) {&nbsp;</div></li><li><div>                          if ( 'update' === $this-&gt;skin-&gt;options['install_type'] ) {&nbsp;</div></li><li><div>                              $this-&gt;upgrade_strings();&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              $this-&gt;install_strings();&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      return $result;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Processes the bulk installation of plugins.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * {@internal This is basically a near identical copy of the WP Core</span>&nbsp;</div></li><li><div><span class="comment">                   * Plugin_Upgrader::bulk_upgrade() method, with minor adjustments to deal with</span>&nbsp;</div></li><li><div><span class="comment">                   * new installs instead of upgrades.</span>&nbsp;</div></li><li><div><span class="comment">                   * For ease of future synchronizations, the adjustments are clearly commented, but no other</span>&nbsp;</div></li><li><div><span class="comment">                   * comments are added. Code style has been made to comply.}}</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @see Plugin_Upgrader::bulk_upgrade()</span>&nbsp;</div></li><li><div><span class="comment">                   * @see https://core.trac.wordpress.org/browser/tags/4.2.1/src/wp-admin/includes/class-wp-upgrader.php#L838</span>&nbsp;</div></li><li><div><span class="comment">                   * (@internal Last synced: Dec 31st 2015 against https://core.trac.wordpress.org/browser/trunk?rev=36134}}</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @param array $plugins The plugin sources needed for installation.</span>&nbsp;</div></li><li><div><span class="comment">                   * @param array $args    Arbitrary passed extra arguments.</span>&nbsp;</div></li><li><div><span class="comment">                   * @return array|false   Install confirmation messages on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function bulk_install( $plugins, $args = array() ) {&nbsp;</div></li><li><div>                      <span class="comment">// [TGMPA + ] Hook auto-activation in.</span>&nbsp;</div></li><li><div>                      add_filter( 'upgrader_post_install', array( $this, 'auto_activate' ), 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $defaults = array(&nbsp;</div></li><li><div>                          'clear_update_cache' =&gt; true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      $parsed_args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;init();&nbsp;</div></li><li><div>                      $this-&gt;bulk = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;install_strings(); <span class="comment"><span class="comment"><span class="comment"><span class="comment">// [TGMPA + ] adjusted.</span></span></span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">/** [TGMPA - ] $current = get_site_transient( 'update_plugins' ); */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">/** [TGMPA - ] add_filter('upgrader_clear_destination', array($this, 'delete_old_plugin'), 10, 4); */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;skin-&gt;header();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Connect to the Filesystem first.</span>&nbsp;</div></li><li><div>                      $res = $this-&gt;fs_connect( array( WP_CONTENT_DIR, WP_PLUGIN_DIR ) );&nbsp;</div></li><li><div>                      if ( ! $res ) {&nbsp;</div></li><li><div>                          $this-&gt;skin-&gt;footer();&nbsp;</div></li><li><div>                          return false;&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;skin-&gt;bulk_header();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                       * Only start maintenance mode if:</span>&nbsp;</div></li><li><div><span class="comment">                       * - running Multisite and there are one or more plugins specified, OR</span>&nbsp;</div></li><li><div><span class="comment">                       * - a plugin with an update available is currently active.</span>&nbsp;</div></li><li><div><span class="comment">                       * @TODO: For multisite, maintenance mode should only kick in for individual sites if at all possible.</span>&nbsp;</div></li><li><div><span class="comment">                       */</span>&nbsp;</div></li><li><div>                      $maintenance = ( is_multisite() && ! empty( $plugins ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                      [TGMPA - ]</span>&nbsp;</div></li><li><div><span class="comment">                      foreach ( $plugins as $plugin )</span>&nbsp;</div></li><li><div><span class="comment">                          $maintenance = $maintenance || ( is_plugin_active( $plugin ) && isset( $current-&gt;response[ $plugin] ) );</span>&nbsp;</div></li><li><div><span class="comment">                      */</span>&nbsp;</div></li><li><div>                      if ( $maintenance ) {&nbsp;</div></li><li><div>                          $this-&gt;maintenance_mode( true );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $results = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;update_count = count( $plugins );&nbsp;</div></li><li><div>                      $this-&gt;update_current = 0;&nbsp;</div></li><li><div>                      foreach ( $plugins as $plugin ) {&nbsp;</div></li><li><div>                          $this-&gt;update_current++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                          [TGMPA - ]</span>&nbsp;</div></li><li><div><span class="comment">                          $this-&gt;skin-&gt;plugin_info = get_plugin_data( WP_PLUGIN_DIR . '/' . $plugin, false, true);</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">                          if ( !isset( $current-&gt;response[ $plugin ] ) ) {</span>&nbsp;</div></li><li><div><span class="comment">                              $this-&gt;skin-&gt;set_result('up_to_date');</span>&nbsp;</div></li><li><div><span class="comment">                              $this-&gt;skin-&gt;before();</span>&nbsp;</div></li><li><div><span class="comment">                              $this-&gt;skin-&gt;feedback('up_to_date');</span>&nbsp;</div></li><li><div><span class="comment">                              $this-&gt;skin-&gt;after();</span>&nbsp;</div></li><li><div><span class="comment">                              $results[$plugin] = true;</span>&nbsp;</div></li><li><div><span class="comment">                              continue;</span>&nbsp;</div></li><li><div><span class="comment">                          }</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">                          // Get the URL to the zip file.</span>&nbsp;</div></li><li><div><span class="comment">                          $r = $current-&gt;response[ $plugin ];</span>&nbsp;</div></li><li><div><span class="comment">&nbsp;</span>&nbsp;</div></li><li><div><span class="comment">                          $this-&gt;skin-&gt;plugin_active = is_plugin_active($plugin);</span>&nbsp;</div></li><li><div><span class="comment">                          */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $result = $this-&gt;run(&nbsp;</div></li><li><div>                              array(&nbsp;</div></li><li><div>                                  'package' =&gt; $plugin, <span class="comment"><span class="comment"><span class="comment"><span class="comment">// [TGMPA + ] adjusted.</span></span></span></span>&nbsp;</div></li><li><div>                                  'destination' =&gt; WP_PLUGIN_DIR, &nbsp;</div></li><li><div>                                  'clear_destination' =&gt; false, <span class="comment"><span class="comment"><span class="comment"><span class="comment">// [TGMPA + ] adjusted.</span></span></span></span>&nbsp;</div></li><li><div>                                  'clear_working' =&gt; true, &nbsp;</div></li><li><div>                                  'is_multi' =&gt; true, &nbsp;</div></li><li><div>                                  'hook_extra' =&gt; array(&nbsp;</div></li><li><div>                                      'plugin' =&gt; $plugin, &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          $results[ $plugin ] = $this-&gt;result;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment">// Prevent credentials auth screen from displaying multiple times.</span>&nbsp;</div></li><li><div>                          if ( false === $result ) {&nbsp;</div></li><li><div>                              break;&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      } <span class="comment">//end foreach $plugins</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;maintenance_mode( false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                       * Fires when the bulk upgrader process is complete.</span>&nbsp;</div></li><li><div><span class="comment">                       *</span>&nbsp;</div></li><li><div><span class="comment">                       * @since WP 3.6.0 / TGMPA 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">                       *</span>&nbsp;</div></li><li><div><span class="comment">                       * @param Plugin_Upgrader $this Plugin_Upgrader instance. In other contexts, $this, might</span>&nbsp;</div></li><li><div><span class="comment">                       *                              be a Theme_Upgrader or Core_Upgrade instance.</span>&nbsp;</div></li><li><div><span class="comment">                       * @param array           $data {</span>&nbsp;</div></li><li><div><span class="comment">                       *     Array of bulk item update data.</span>&nbsp;</div></li><li><div><span class="comment">                       *</span>&nbsp;</div></li><li><div><span class="comment">                       *     @type string $action   Type of action. Default 'update'.</span>&nbsp;</div></li><li><div><span class="comment">                       *     @type string $type     Type of update process. Accepts 'plugin', 'theme', or 'core'.</span>&nbsp;</div></li><li><div><span class="comment">                       *     @type bool   $bulk     Whether the update process is a bulk update. Default true.</span>&nbsp;</div></li><li><div><span class="comment">                       *     @type array  $packages Array of plugin, theme, or core packages to update.</span>&nbsp;</div></li><li><div><span class="comment">                       * }</span>&nbsp;</div></li><li><div><span class="comment">                       */</span>&nbsp;</div></li><li><div>                      do_action( 'upgrader_process_complete', $this, array(&nbsp;</div></li><li><div>                          'action' =&gt; 'install', <span class="comment"><span class="comment"><span class="comment"><span class="comment">// [TGMPA + ] adjusted.</span></span></span></span>&nbsp;</div></li><li><div>                          'type' =&gt; 'plugin', &nbsp;</div></li><li><div>                          'bulk' =&gt; true, &nbsp;</div></li><li><div>                          'plugins' =&gt; $plugins, &nbsp;</div></li><li><div> ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;skin-&gt;bulk_footer();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;skin-&gt;footer();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Cleanup our hooks, in case something else does a upgrade on this connection.</span>&nbsp;</div></li><li><div>                      <span class="comment">/** [TGMPA - ] remove_filter('upgrader_clear_destination', array($this, 'delete_old_plugin')); */</span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// [TGMPA + ] Remove our auto-activation hook.</span>&nbsp;</div></li><li><div>                      remove_filter( 'upgrader_post_install', array( $this, 'auto_activate' ), 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Force refresh of plugin update information.</span>&nbsp;</div></li><li><div>                      wp_clean_plugins_cache( $parsed_args['clear_update_cache'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      return $results;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Handle a bulk upgrade request.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @see Plugin_Upgrader::bulk_upgrade()</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @param array $plugins The local WP file_path's of the plugins which should be upgraded.</span>&nbsp;</div></li><li><div><span class="comment">                   * @param array $args    Arbitrary passed extra arguments.</span>&nbsp;</div></li><li><div><span class="comment">                   * @return string|bool Install confirmation messages on success, false on failure.</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function bulk_upgrade( $plugins, $args = array() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      add_filter( 'upgrader_post_install', array( $this, 'auto_activate' ), 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $result = parent::bulk_upgrade( $plugins, $args );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      remove_filter( 'upgrader_post_install', array( $this, 'auto_activate' ), 10 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      return $result;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Abuse a filter to auto-activate plugins after installation.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * Hooked into the 'upgrader_post_install' filter hook.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @param bool $bool The value we need to give back (true).</span>&nbsp;</div></li><li><div><span class="comment">                   * @return bool</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function auto_activate( $bool ) {&nbsp;</div></li><li><div>                      <span class="comment">// Only process the activation of installed plugins if the automatic flag is set to true.</span>&nbsp;</div></li><li><div>                      if ( $this-&gt;tgmpa-&gt;is_automatic ) {&nbsp;</div></li><li><div>                          <span class="comment">// Flush plugins cache so the headers of the newly installed plugins will be read correctly.</span>&nbsp;</div></li><li><div>                          wp_clean_plugins_cache();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment">// Get the installed plugin file.</span>&nbsp;</div></li><li><div>                          $plugin_info = $this-&gt;plugin_info();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          <span class="comment">// Don't try to activate on upgrade of active plugin as WP will do this already.</span>&nbsp;</div></li><li><div>                          if ( ! is_plugin_active( $plugin_info ) ) {&nbsp;</div></li><li><div>                              $activate = activate_plugin( $plugin_info );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              <span class="comment">// Adjust the success string based on the activation result.</span>&nbsp;</div></li><li><div>                              $this-&gt;strings['process_success'] = $this-&gt;strings['process_success'] . &quot;&lt;br /&gt;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                              if ( is_wp_error( $activate ) ) {&nbsp;</div></li><li><div>                                  $this-&gt;skin-&gt;error( $activate );&nbsp;</div></li><li><div>                                  $this-&gt;strings['process_success'] .= $this-&gt;strings['activation_failed'];&nbsp;</div></li><li><div>                              } else {&nbsp;</div></li><li><div>                                  $this-&gt;strings['process_success'] .= $this-&gt;strings['activation_success'];&nbsp;</div></li><li><div>                              }&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      return $bool;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( ! class_exists( 'TGMPA_Bulk_Installer_Skin' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>              <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">               * Installer skin to set strings for the bulk plugin installations..</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * Extends Bulk_Upgrader_Skin and customizes to suit the installation of multiple</span>&nbsp;</div></li><li><div><span class="comment">               * plugins.</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * {@internal Since 2.5.2 the class has been renamed from TGM_Bulk_Installer_Skin to</span>&nbsp;</div></li><li><div><span class="comment">               *            TGMPA_Bulk_Installer_Skin.</span>&nbsp;</div></li><li><div><span class="comment">               *            This was done to prevent backward compatibility issues with v2.3.6.}}</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @see https://core.trac.wordpress.org/browser/trunk/src/wp-admin/includes/class-wp-upgrader-skins.php</span>&nbsp;</div></li><li><div><span class="comment">               *</span>&nbsp;</div></li><li><div><span class="comment">               * @package TGM-Plugin-Activation</span>&nbsp;</div></li><li><div><span class="comment">               * @author  Thomas Griffin</span>&nbsp;</div></li><li><div><span class="comment">               * @author  Gary Jones</span>&nbsp;</div></li><li><div><span class="comment">               */</span>&nbsp;</div></li><li><div>              class TGMPA_Bulk_Installer_Skin extends Bulk_Upgrader_Skin {&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Holds plugin info for each individual plugin installation.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @var array</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public $plugin_info = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Holds names of plugins that are undergoing bulk installations.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @var array</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public $plugin_names = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Integer to use for iteration through each plugin installation.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @var integer</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public $i = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * TGMPA instance</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @var object</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  protected $tgmpa;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Constructor. Parses default args with new ones and extracts them for use.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @param array $args Arguments to pass for use within the class.</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function __construct( $args = array() ) {&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment"><span class="comment">// Get TGMPA class instance.</span></span></span>&nbsp;</div></li><li><div>                      $this-&gt;tgmpa = call_user_func( array( get_class( $GLOBALS['tgmpa'] ), 'get_instance' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Parse default and new args.</span>&nbsp;</div></li><li><div>                      $defaults = array(&nbsp;</div></li><li><div>                          'url' =&gt; '', &nbsp;</div></li><li><div>                          'nonce' =&gt; '', &nbsp;</div></li><li><div>                          'names' =&gt; array(), &nbsp;</div></li><li><div>                          'install_type' =&gt; 'install', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      $args = wp_parse_args( $args, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Set plugin names to $this-&gt;plugin_names property.</span>&nbsp;</div></li><li><div>                      $this-&gt;plugin_names = $args['names'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Extract the new args.</span>&nbsp;</div></li><li><div>                      parent::__construct( $args );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Sets install skin strings for each individual plugin.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * Checks to see if the automatic activation flag is set and uses the</span>&nbsp;</div></li><li><div><span class="comment">                   * the proper strings accordingly.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function add_strings() {&nbsp;</div></li><li><div>                      if ( 'update' === $this-&gt;options['install_type'] ) {&nbsp;</div></li><li><div>                          parent::add_strings();&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name, 2: action number 3: total number of actions. */</span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;upgrader-&gt;strings['skin_before_update_header'] = __( 'Updating Plugin %1$s (%2$d/%3$d)', 'tgmpa' );&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          <span class="comment">/** translators: 1: plugin name, 2: error message. */</span>&nbsp;</div></li><li><div>                          $this-&gt;upgrader-&gt;strings['skin_update_failed_error'] = __( 'An error occurred while installing %1$s: &lt;strong&gt;%2$s&lt;/strong&gt;.', 'tgmpa' );&nbsp;</div></li><li><div>                          <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name. */</span></span></span></span></span>&nbsp;</div></li><li><div>                          $this-&gt;upgrader-&gt;strings['skin_update_failed'] = __( 'The installation of %1$s failed.', 'tgmpa' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                          if ( $this-&gt;tgmpa-&gt;is_automatic ) {&nbsp;</div></li><li><div>                              <span class="comment">// Automatic activation strings.</span>&nbsp;</div></li><li><div>                              $this-&gt;upgrader-&gt;strings['skin_upgrade_start'] = __( 'The installation and activation process is starting. This process may take a while on some hosts, so please be patient.', 'tgmpa' );&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name. */</span></span></span></span></span>&nbsp;</div></li><li><div>                              $this-&gt;upgrader-&gt;strings['skin_update_successful'] = __( '%1$s installed and activated successfully.', 'tgmpa' ) . ' &lt;a href=&quot;#&quot; class=&quot;hide-if-no-js&quot; onclick=&quot;%2$s&quot;&gt;&lt;span&gt;' . esc_html__( 'Show Details', 'tgmpa' ) . '&lt;/span&gt;&lt;span class=&quot;hidden&quot;&gt;' . esc_html__( 'Hide Details', 'tgmpa' ) . '&lt;/span&gt;.&lt;/a&gt;';&nbsp;</div></li><li><div>                              $this-&gt;upgrader-&gt;strings['skin_upgrade_end'] = __( 'All installations and activations have been completed.', 'tgmpa' );&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name, 2: action number 3: total number of actions. */</span></span></span>&nbsp;</div></li><li><div>                              $this-&gt;upgrader-&gt;strings['skin_before_update_header'] = __( 'Installing and Activating Plugin %1$s (%2$d/%3$d)', 'tgmpa' );&nbsp;</div></li><li><div>                          } else {&nbsp;</div></li><li><div>                              <span class="comment">// Default installation strings.</span>&nbsp;</div></li><li><div>                              $this-&gt;upgrader-&gt;strings['skin_upgrade_start'] = __( 'The installation process is starting. This process may take a while on some hosts, so please be patient.', 'tgmpa' );&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name. */</span></span></span></span></span>&nbsp;</div></li><li><div>                              $this-&gt;upgrader-&gt;strings['skin_update_successful'] = esc_html__( '%1$s installed successfully.', 'tgmpa' ) . ' &lt;a href=&quot;#&quot; class=&quot;hide-if-no-js&quot; onclick=&quot;%2$s&quot;&gt;&lt;span&gt;' . esc_html__( 'Show Details', 'tgmpa' ) . '&lt;/span&gt;&lt;span class=&quot;hidden&quot;&gt;' . esc_html__( 'Hide Details', 'tgmpa' ) . '&lt;/span&gt;.&lt;/a&gt;';&nbsp;</div></li><li><div>                              $this-&gt;upgrader-&gt;strings['skin_upgrade_end'] = __( 'All installations have been completed.', 'tgmpa' );&nbsp;</div></li><li><div>                              <span class="comment"><span class="comment"><span class="comment">/** translators: 1: plugin name, 2: action number 3: total number of actions. */</span></span></span>&nbsp;</div></li><li><div>                              $this-&gt;upgrader-&gt;strings['skin_before_update_header'] = __( 'Installing Plugin %1$s (%2$d/%3$d)', 'tgmpa' );&nbsp;</div></li><li><div>                          }&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Outputs the header strings and necessary JS before each plugin installation.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @param string $title Unused in this implementation.</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function before( $title = '' ) {&nbsp;</div></li><li><div>                      if ( empty( $title ) ) {&nbsp;</div></li><li><div>                          $title = esc_html( $this-&gt;plugin_names[ $this-&gt;i ] );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      parent::before( $title );&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Outputs the footer strings and necessary JS after each plugin installation.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * Checks for any errors and outputs them if they exist, else output</span>&nbsp;</div></li><li><div><span class="comment">                   * success strings.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @param string $title Unused in this implementation.</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function after( $title = '' ) {&nbsp;</div></li><li><div>                      if ( empty( $title ) ) {&nbsp;</div></li><li><div>                          $title = esc_html( $this-&gt;plugin_names[ $this-&gt;i ] );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                      parent::after( $title );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;i++;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Outputs links after bulk plugin installation is complete.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since 2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function bulk_footer() {&nbsp;</div></li><li><div>                      <span class="comment">// Serve up the string to say installations (and possibly activations) are complete.</span>&nbsp;</div></li><li><div>                      parent::bulk_footer();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">// Flush plugins cache so we can make sure that the installed plugins list is always up to date.</span>&nbsp;</div></li><li><div>                      wp_clean_plugins_cache();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      $this-&gt;tgmpa-&gt;show_tgmpa_version();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment"><span class="comment">// Display message based on if all plugins are now active or not.</span></span>&nbsp;</div></li><li><div>                      $update_actions = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( $this-&gt;tgmpa-&gt;is_tgmpa_complete() ) {&nbsp;</div></li><li><div>                          <span class="comment">// All plugins are active, so we display the complete string and hide the menu to protect users.</span>&nbsp;</div></li><li><div>                          echo '&lt;style type=&quot;text/css&quot;&gt;#adminmenu .wp-submenu li.current { display: none !important; }&lt;/style&gt;';&nbsp;</div></li><li><div>                          $update_actions['dashboard'] = sprintf(&nbsp;</div></li><li><div>                              esc_html( $this-&gt;tgmpa-&gt;strings['complete'] ), &nbsp;</div></li><li><div>                              '&lt;a href=&quot;' . esc_url( self_admin_url() ) . '&quot;&gt;' . esc_html__( 'Return to the Dashboard', 'tgmpa' ) . '&lt;/a&gt;'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                      } else {&nbsp;</div></li><li><div>                          $update_actions['tgmpa_page'] = '&lt;a href=&quot;' . esc_url( $this-&gt;tgmpa-&gt;get_tgmpa_url() ) . '&quot; target=&quot;_parent&quot;&gt;' . esc_html( $this-&gt;tgmpa-&gt;strings['return'] ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                       * Filter the list of action links available following bulk plugin installs/updates.</span>&nbsp;</div></li><li><div><span class="comment">                       *</span>&nbsp;</div></li><li><div><span class="comment">                       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">                       *</span>&nbsp;</div></li><li><div><span class="comment">                       * @param array $update_actions Array of plugin action links.</span>&nbsp;</div></li><li><div><span class="comment">                       * @param array $plugin_info    Array of information for the last-handled plugin.</span>&nbsp;</div></li><li><div><span class="comment">                       */</span>&nbsp;</div></li><li><div>                      $update_actions = apply_filters( 'tgmpa_update_bulk_plugins_complete_actions', $update_actions, $this-&gt;plugin_info );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                      if ( ! empty( $update_actions ) ) {&nbsp;</div></li><li><div>                          $this-&gt;feedback( implode( ' | ', (array) $update_actions ) );&nbsp;</div></li><li><div>                      }&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment"><span class="comment">/** *********** DEPRECATED METHODS *********** */</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Flush header output buffer.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since      2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   * @deprecated 2.5.0 use {@see Bulk_Upgrader_Skin::flush_output()} instead</span>&nbsp;</div></li><li><div><span class="comment">                   * @see        Bulk_Upgrader_Skin::flush_output()</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function before_flush_output() {&nbsp;</div></li><li><div>                      _deprecated_function( __FUNCTION__, 'TGMPA 2.5.0', 'Bulk_Upgrader_Skin::flush_output()' );&nbsp;</div></li><li><div>                      $this-&gt;flush_output();&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">                   * Flush footer output buffer and iterate $this-&gt;i to make sure the</span>&nbsp;</div></li><li><div><span class="comment">                   * installation strings reference the correct plugin.</span>&nbsp;</div></li><li><div><span class="comment">                   *</span>&nbsp;</div></li><li><div><span class="comment">                   * @since      2.2.0</span>&nbsp;</div></li><li><div><span class="comment">                   * @deprecated 2.5.0 use {@see Bulk_Upgrader_Skin::flush_output()} instead</span>&nbsp;</div></li><li><div><span class="comment">                   * @see        Bulk_Upgrader_Skin::flush_output()</span>&nbsp;</div></li><li><div><span class="comment">                   */</span>&nbsp;</div></li><li><div>                  public function after_flush_output() {&nbsp;</div></li><li><div>                      _deprecated_function( __FUNCTION__, 'TGMPA 2.5.0', 'Bulk_Upgrader_Skin::flush_output()' );&nbsp;</div></li><li><div>                      $this-&gt;flush_output();&nbsp;</div></li><li><div>                      $this-&gt;i++;&nbsp;</div></li><li><div>                  }&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>if ( ! class_exists( 'TGMPA_Utils' ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>  <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">   * Generic utilities for TGMPA.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * All methods are static, poor-dev name-spacing class wrapper.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * Class was called TGM_Utils in 2.5.0 but renamed TGMPA_Utils in 2.5.1 as this was conflicting with Soliloquy.</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">   *</span>&nbsp;</div></li><li><div><span class="comment">   * @package TGM-Plugin-Activation</span>&nbsp;</div></li><li><div><span class="comment">   * @author  Juliette Reinders Folmer</span>&nbsp;</div></li><li><div><span class="comment">   */</span>&nbsp;</div></li><li><div>  class TGMPA_Utils {&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Whether the PHP filter extension is enabled.</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @see http://php.net/book.filter</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @static</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @var bool $has_filters True is the extension is enabled.</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static $has_filters;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Wrap an arbitrary string in &lt;em&gt; tags. Meant to be used in combination with array_map().</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @static</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $string Text to be wrapped.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static function wrap_in_em( $string ) {&nbsp;</div></li><li><div>          return '&lt;em&gt;' . wp_kses_post( $string ) . '&lt;/em&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Wrap an arbitrary string in &lt;strong&gt; tags. Meant to be used in combination with array_map().</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @static</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param string $string Text to be wrapped.</span>&nbsp;</div></li><li><div><span class="comment">       * @return string</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static function wrap_in_strong( $string ) {&nbsp;</div></li><li><div>          return '&lt;strong&gt;' . wp_kses_post( $string ) . '&lt;/strong&gt;';&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Helper function: Validate a value as boolean</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @static</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed $value Arbitrary value.</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      public static function validate_bool( $value ) {&nbsp;</div></li><li><div>          if ( ! isset( self::$has_filters ) ) {&nbsp;</div></li><li><div>              self::$has_filters = extension_loaded( 'filter' );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( self::$has_filters ) {&nbsp;</div></li><li><div>              return filter_var( $value, FILTER_VALIDATE_BOOLEAN );&nbsp;</div></li><li><div>          } else {&nbsp;</div></li><li><div>              return self::emulate_filter_bool( $value );&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>      <span class="comment">/**</span>&nbsp;</div></li><li><div><span class="comment">       * Helper function: Cast a value to bool</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @since 2.5.0</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @static</span>&nbsp;</div></li><li><div><span class="comment">       *</span>&nbsp;</div></li><li><div><span class="comment">       * @param mixed $value Value to cast.</span>&nbsp;</div></li><li><div><span class="comment">       * @return bool</span>&nbsp;</div></li><li><div><span class="comment">       */</span>&nbsp;</div></li><li><div>      protected static function emulate_filter_bool( $value ) {&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// @codingStandardsIgnoreStart</span></span>&nbsp;</div></li><li><div>          static $true = array(&nbsp;</div></li><li><div>              '1', &nbsp;</div></li><li><div>              'true', 'True', 'TRUE', &nbsp;</div></li><li><div>              'y', 'Y', &nbsp;</div></li><li><div>              'yes', 'Yes', 'YES', &nbsp;</div></li><li><div>              'on', 'On', 'ON', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          static $false = array(&nbsp;</div></li><li><div>              '0', &nbsp;</div></li><li><div>              'false', 'False', 'FALSE', &nbsp;</div></li><li><div>              'n', 'N', &nbsp;</div></li><li><div>              'no', 'No', 'NO', &nbsp;</div></li><li><div>              'off', 'Off', 'OFF', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>          <span class="comment"><span class="comment">// @codingStandardsIgnoreEnd</span></span>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          if ( is_bool( $value ) ) {&nbsp;</div></li><li><div>              return $value;&nbsp;</div></li><li><div>          } elseif ( is_int( $value ) && ( 0 === $value || 1 === $value ) ) {&nbsp;</div></li><li><div>              return (bool) $value;&nbsp;</div></li><li><div>          } elseif ( ( is_float( $value ) && ! is_nan( $value ) ) && ( (float) 0 === $value || (float) 1 === $value ) ) {&nbsp;</div></li><li><div>              return (bool) $value;&nbsp;</div></li><li><div>          } elseif ( is_string( $value ) ) {&nbsp;</div></li><li><div>              $value = trim( $value );&nbsp;</div></li><li><div>              if ( in_array( $value, $true, true ) ) {&nbsp;</div></li><li><div>                  return true;&nbsp;</div></li><li><div>              } elseif ( in_array( $value, $false, true ) ) {&nbsp;</div></li><li><div>                  return false;&nbsp;</div></li><li><div>              } else {&nbsp;</div></li><li><div>                  return false;&nbsp;</div></li><li><div>              }&nbsp;</div></li><li><div>          }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>          return false;&nbsp;</div></li><li><div>      }&nbsp;</div></li><li><div>  } <span class="comment">// End of class TGMPA_Utils</span>&nbsp;</div></li><li><div>} <span class="comment">// End of class_exists wrapper</span>&nbsp;</div></li></ol></pre>.</p> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>file</li><li><span></span></li><li><span></span>Contact Form 7 Signature Addon</li><li><span></span>4.0.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>