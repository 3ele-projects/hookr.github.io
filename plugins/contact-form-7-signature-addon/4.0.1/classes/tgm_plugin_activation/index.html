<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="4.0.1" data-slug="contact-form-7-signature-addon" data-type="class" data-id="25204"><head xmlns="http://www.w3.org/1999/xhtml"><title> tgm_plugin_activation | class | Contact Form 7 Signature Addon | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="TGM_Plugin_Activation, class, plugin, contact-form-7-signature-addon, 4.0.1" /><meta name="description" content="Automatic plugin installation and activation library." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=ffcd4e071fbd4b293c15c0deb56e015e' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/tgm_plugin_activation/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Ftgm_plugin_activation%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Ftgm_plugin_activation%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-contact-form-7-signature-addon-4.0.1-class-tgm_plugin_activation","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="tgm_plugin_activation" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to contact-form-7-signature-addon." href="http://hookr.io/plugins/contact-form-7-signature-addon/" class="plugin"><span property="name">contact-form-7-signature-addon</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 4.0.1." href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/" class="H_VERSION"><span property="name">4.0.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">tgm_plugin_activation</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="34"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/all/" title="All">All <span class="count badge">34</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="17"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/hooks/" title="Hooks">Hooks <span class="count badge">17</span></a></li><li class="" data-id="action" data-count="5"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/actions/" title="Actions">Actions <span class="count badge">5</span></a></li><li class="" data-id="filter" data-count="12"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/filters/" title="Filters">Filters <span class="count badge">12</span></a></li><li class="active" data-id="class" data-count="11"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/classes/" title="Classes">Classes <span class="count badge">11</span></a></li><li class="" data-id="constant" data-count="2"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/constants/" title="Constants">Constants <span class="count badge">2</span></a></li><li class="" data-id="function" data-count="4"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/functions/" title="Functions">Functions <span class="count badge">4</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>TGM_Plugin_Activation</strong></h1><p>Automatic plugin installation and activation library.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/files/includes-class-tgm-plugin-activation/" class="file">/includes/class-tgm-plugin-activation.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="50" class="block" start="50"><li><div>class TGM_Plugin_Activation {&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * TGMPA version number.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @const string Version number.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const TGMPA_VERSION = '2.6.1';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Regular expression to test if a URL is a WP plugin repo URL.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @const string Regex.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const WP_REPO_REGEX = '|^http[s]?://wordpress\.org/(?:extend/)?plugins/|';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Arbitrary regular expression to test if a string starts with a URL.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @const string Regex.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    const IS_URL_REGEX = '|^http[s]?://|';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Holds a copy of itself, so it can be referenced by the class name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var TGM_Plugin_Activation&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static $instance;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Holds arrays of plugin details.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0.0&nbsp;</div></li><li><div>     * @since 2.5.0 the array has the plugin slug as an associative key.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $plugins = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Holds arrays of plugin names to use to sort the plugins array.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $sort_order = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether any plugins have the 'force_activation' setting set to true.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $has_forced_activation = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Whether any plugins have the 'force_deactivation' setting set to true.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var bool&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $has_forced_deactivation = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Name of the unique ID to hash notices.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $id = 'tgmpa';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Name of the query-string argument for the admin page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected $menu = 'tgmpa-install-plugins';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Parent menu file slug.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $parent_slug = 'themes.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Capability needed to view the plugin installation menu item.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $capability = 'edit_theme_options';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Default absolute path to folder containing bundled plugin zip files.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string Absolute path prefix to zip file location for bundled plugins. Default is empty string.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $default_path = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Flag to show admin notices or not.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var boolean&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $has_notices = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Flag to determine if the user can dismiss the notice nag.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var boolean&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $dismissable = true;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Message to be output above nag notice if dismissable is false.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $dismiss_msg = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Flag to set automatic activation of plugins. Off by default.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var boolean&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $is_automatic = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Optional message to display before the plugins table.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string Message filtered by wp_kses_post(). Default is empty string.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $message = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Holds configurable array of strings.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Default values are added in the constructor.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $strings = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Holds the version of WordPress.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var int&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $wp_version;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Holds the hook name for the admin page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @var string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public $page_hook;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds a reference of this object to $instance, populates default strings, &nbsp;</div></li><li><div>     * does the tgmpa_init action hook, and hooks in the interactions to init.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * {@internal This method should be `protected`, but as too many TGMPA implementations&nbsp;</div></li><li><div>     * haven't upgraded beyond v2.3.6 yet, this gives backward compatibility issues.&nbsp;</div></li><li><div>     * Reverted back to public for the time being.}}&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see TGM_Plugin_Activation::init()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __construct() {&nbsp;</div></li><li><div>        // Set the current WordPress version.&nbsp;</div></li><li><div>        $this-&gt;wp_version = $GLOBALS['wp_version'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Announce that the class is ready, and pass the object (for advanced use).&nbsp;</div></li><li><div>        do_action_ref_array( 'tgmpa_init', array( $this ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Load our text domain and allow for overloading the fall-back file.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * {@internal IMPORTANT! If this code changes, review the regex in the custom TGMPA&nbsp;</div></li><li><div>         * generator on the website.}}&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        add_action( 'init', array( $this, 'load_textdomain' ), 5 );&nbsp;</div></li><li><div>        add_filter( 'load_textdomain_mofile', array( $this, 'overload_textdomain_mofile' ), 10, 2 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // When the rest of WP has loaded, kick-start the rest of the class.&nbsp;</div></li><li><div>        add_action( 'init', array( $this, 'init' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Magic method to (not) set protected properties from outside of this class.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * {@internal hackedihack... There is a serious bug in v2.3.2 - 2.3.6  where the `menu` property&nbsp;</div></li><li><div>     * is being assigned rather than tested in a conditional, effectively rendering it useless.&nbsp;</div></li><li><div>     * This 'hack' prevents this from happening.}}&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see https://github.com/TGMPA/TGM-Plugin-Activation/blob/2.3.6/tgm-plugin-activation/class-tgm-plugin-activation.php#L1593&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.2&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $name  Name of an inaccessible property.&nbsp;</div></li><li><div>     * @param mixed  $value Value to assign to the property.&nbsp;</div></li><li><div>     * @return void  Silently fail to set the property when this is tried from outside of this class context.&nbsp;</div></li><li><div>     *               (Inside this class context, the __set() method if not used as there is direct access.)&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __set( $name, $value ) {&nbsp;</div></li><li><div>        return;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Magic method to get the value of a protected property outside of this class context.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.2&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $name Name of an inaccessible property.&nbsp;</div></li><li><div>     * @return mixed The property value.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function __get( $name ) {&nbsp;</div></li><li><div>        return $this-&gt;{$name};&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Initialise the interactions between this class and WordPress.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Hooks in three new methods for the class: admin_menu, notices and styles.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see TGM_Plugin_Activation::admin_menu()&nbsp;</div></li><li><div>     * @see TGM_Plugin_Activation::notices()&nbsp;</div></li><li><div>     * @see TGM_Plugin_Activation::styles()&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function init() {&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * By default TGMPA only loads on the WP back-end and not in an Ajax call. Using this filter&nbsp;</div></li><li><div>         * you can overrule that behaviour.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.5.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param bool $load Whether or not TGMPA should load.&nbsp;</div></li><li><div>         *                   Defaults to the return of `is_admin() && ! defined( 'DOING_AJAX' )`.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        if ( true !== apply_filters( 'tgmpa_load', ( is_admin() && ! defined( 'DOING_AJAX' ) ) ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Load class strings.&nbsp;</div></li><li><div>        $this-&gt;strings = array(&nbsp;</div></li><li><div>            'page_title' =&gt; __( 'Install Required Plugins', 'tgmpa' ), &nbsp;</div></li><li><div>            'menu_title' =&gt; __( 'Install Plugins', 'tgmpa' ), &nbsp;</div></li><li><div>            /** translators: %s: plugin name. */&nbsp;</div></li><li><div>            'installing' =&gt; __( 'Installing Plugin: %s', 'tgmpa' ), &nbsp;</div></li><li><div>            /** translators: %s: plugin name. */&nbsp;</div></li><li><div>            'updating' =&gt; __( 'Updating Plugin: %s', 'tgmpa' ), &nbsp;</div></li><li><div>            'oops' =&gt; __( 'Something went wrong with the plugin API.', 'tgmpa' ), &nbsp;</div></li><li><div>            'notice_can_install_required' =&gt; _n_noop(&nbsp;</div></li><li><div>                /** translators: 1: plugin name(s). */&nbsp;</div></li><li><div>                'This theme requires the following plugin: %1$s.', &nbsp;</div></li><li><div>                'This theme requires the following plugins: %1$s.', &nbsp;</div></li><li><div>                'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'notice_can_install_recommended' =&gt; _n_noop(&nbsp;</div></li><li><div>                /** translators: 1: plugin name(s). */&nbsp;</div></li><li><div>                'This theme recommends the following plugin: %1$s.', &nbsp;</div></li><li><div>                'This theme recommends the following plugins: %1$s.', &nbsp;</div></li><li><div>                'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'notice_ask_to_update' =&gt; _n_noop(&nbsp;</div></li><li><div>                /** translators: 1: plugin name(s). */&nbsp;</div></li><li><div>                'The following plugin needs to be updated to its latest version to ensure maximum compatibility with this theme: %1$s.', &nbsp;</div></li><li><div>                'The following plugins need to be updated to their latest version to ensure maximum compatibility with this theme: %1$s.', &nbsp;</div></li><li><div>                'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'notice_ask_to_update_maybe' =&gt; _n_noop(&nbsp;</div></li><li><div>                /** translators: 1: plugin name(s). */&nbsp;</div></li><li><div>                'There is an update available for: %1$s.', &nbsp;</div></li><li><div>                'There are updates available for the following plugins: %1$s.', &nbsp;</div></li><li><div>                'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'notice_can_activate_required' =&gt; _n_noop(&nbsp;</div></li><li><div>                /** translators: 1: plugin name(s). */&nbsp;</div></li><li><div>                'The following required plugin is currently inactive: %1$s.', &nbsp;</div></li><li><div>                'The following required plugins are currently inactive: %1$s.', &nbsp;</div></li><li><div>                'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'notice_can_activate_recommended' =&gt; _n_noop(&nbsp;</div></li><li><div>                /** translators: 1: plugin name(s). */&nbsp;</div></li><li><div>                'The following recommended plugin is currently inactive: %1$s.', &nbsp;</div></li><li><div>                'The following recommended plugins are currently inactive: %1$s.', &nbsp;</div></li><li><div>                'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'install_link' =&gt; _n_noop(&nbsp;</div></li><li><div>                'Begin installing plugin', &nbsp;</div></li><li><div>                'Begin installing plugins', &nbsp;</div></li><li><div>                'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'update_link' =&gt; _n_noop(&nbsp;</div></li><li><div>                'Begin updating plugin', &nbsp;</div></li><li><div>                'Begin updating plugins', &nbsp;</div></li><li><div>                'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'activate_link' =&gt; _n_noop(&nbsp;</div></li><li><div>                'Begin activating plugin', &nbsp;</div></li><li><div>                'Begin activating plugins', &nbsp;</div></li><li><div>                'tgmpa'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'return' =&gt; __( 'Return to Required Plugins Installer', 'tgmpa' ), &nbsp;</div></li><li><div>            'dashboard' =&gt; __( 'Return to the Dashboard', 'tgmpa' ), &nbsp;</div></li><li><div>            'plugin_activated' =&gt; __( 'Plugin activated successfully.', 'tgmpa' ), &nbsp;</div></li><li><div>            'activated_successfully' =&gt; __( 'The following plugin was activated successfully:', 'tgmpa' ), &nbsp;</div></li><li><div>            /** translators: 1: plugin name. */&nbsp;</div></li><li><div>            'plugin_already_active' =&gt; __( 'No action taken. Plugin %1$s was already active.', 'tgmpa' ), &nbsp;</div></li><li><div>            /** translators: 1: plugin name. */&nbsp;</div></li><li><div>            'plugin_needs_higher_version' =&gt; __( 'Plugin not activated. A higher version of %s is needed for this theme. Please update the plugin.', 'tgmpa' ), &nbsp;</div></li><li><div>            /** translators: 1: dashboard link. */&nbsp;</div></li><li><div>            'complete' =&gt; __( 'All plugins installed and activated successfully. %1$s', 'tgmpa' ), &nbsp;</div></li><li><div>            'dismiss' =&gt; __( 'Dismiss this notice', 'tgmpa' ), &nbsp;</div></li><li><div>            'notice_cannot_install_activate' =&gt; __( 'There are one or more required or recommended plugins to install, update or activate.', 'tgmpa' ), &nbsp;</div></li><li><div>            'contact_admin' =&gt; __( 'Please contact the administrator of this site for help.', 'tgmpa' ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        do_action( 'tgmpa_register' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /** After this point, the plugins should be registered and the configuration set. */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Proceed only if we have plugins to handle.&nbsp;</div></li><li><div>        if ( empty( $this-&gt;plugins ) || ! is_array( $this-&gt;plugins ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set up the menu and notices if we still have outstanding actions.&nbsp;</div></li><li><div>        if ( true !== $this-&gt;is_tgmpa_complete() ) {&nbsp;</div></li><li><div>            // Sort the plugins.&nbsp;</div></li><li><div>            array_multisort( $this-&gt;sort_order, SORT_ASC, $this-&gt;plugins );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            add_action( 'admin_menu', array( $this, 'admin_menu' ) );&nbsp;</div></li><li><div>            add_action( 'admin_head', array( $this, 'dismiss' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Prevent the normal links from showing underneath a single install/update page.&nbsp;</div></li><li><div>            add_filter( 'install_plugin_complete_actions', array( $this, 'actions' ) );&nbsp;</div></li><li><div>            add_filter( 'update_plugin_complete_actions', array( $this, 'actions' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $this-&gt;has_notices ) {&nbsp;</div></li><li><div>                add_action( 'admin_notices', array( $this, 'notices' ) );&nbsp;</div></li><li><div>                add_action( 'admin_init', array( $this, 'admin_init' ), 1 );&nbsp;</div></li><li><div>                add_action( 'admin_enqueue_scripts', array( $this, 'thickbox' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If needed, filter plugin action links.&nbsp;</div></li><li><div>        add_action( 'load-plugins.php', array( $this, 'add_plugin_action_link_filters' ), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Make sure things get reset on switch theme.&nbsp;</div></li><li><div>        add_action( 'switch_theme', array( $this, 'flush_plugins_cache' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $this-&gt;has_notices ) {&nbsp;</div></li><li><div>            add_action( 'switch_theme', array( $this, 'update_dismiss' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup the force activation hook.&nbsp;</div></li><li><div>        if ( true === $this-&gt;has_forced_activation ) {&nbsp;</div></li><li><div>            add_action( 'admin_init', array( $this, 'force_activation' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Setup the force deactivation hook.&nbsp;</div></li><li><div>        if ( true === $this-&gt;has_forced_deactivation ) {&nbsp;</div></li><li><div>            add_action( 'switch_theme', array( $this, 'force_deactivation' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Load translations.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * (@internal Uses `load_theme_textdomain()` rather than `load_plugin_textdomain()` to&nbsp;</div></li><li><div>     * get round the different ways of handling the path and deprecated notices being thrown&nbsp;</div></li><li><div>     * and such. For plugins, the actual file name will be corrected by a filter.}}&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * {@internal IMPORTANT! If this function changes, review the regex in the custom TGMPA&nbsp;</div></li><li><div>     * generator on the website.}}&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function load_textdomain() {&nbsp;</div></li><li><div>        if ( is_textdomain_loaded( 'tgmpa' ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== strpos( __FILE__, WP_PLUGIN_DIR ) || false !== strpos( __FILE__, WPMU_PLUGIN_DIR ) ) {&nbsp;</div></li><li><div>            // Plugin, we'll need to adjust the file name.&nbsp;</div></li><li><div>            add_action( 'load_textdomain_mofile', array( $this, 'correct_plugin_mofile' ), 10, 2 );&nbsp;</div></li><li><div>            load_theme_textdomain( 'tgmpa', dirname( __FILE__ ) . '/languages' );&nbsp;</div></li><li><div>            remove_action( 'load_textdomain_mofile', array( $this, 'correct_plugin_mofile' ), 10 );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            load_theme_textdomain( 'tgmpa', dirname( __FILE__ ) . '/languages' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Correct the .mo file name for (must-use) plugins.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Themese use `/path/{locale}.mo` while plugins use `/path/{text-domain}-{locale}.mo`.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * {@internal IMPORTANT! If this function changes, review the regex in the custom TGMPA&nbsp;</div></li><li><div>     * generator on the website.}}&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $mofile Full path to the target mofile.&nbsp;</div></li><li><div>     * @param string $domain The domain for which a language file is being loaded.&nbsp;</div></li><li><div>     * @return string $mofile&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function correct_plugin_mofile( $mofile, $domain ) {&nbsp;</div></li><li><div>        // Exit early if not our domain (just in case).&nbsp;</div></li><li><div>        if ( 'tgmpa' !== $domain ) {&nbsp;</div></li><li><div>            return $mofile;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return preg_replace( '`/([a-z]{2}_[A-Z]{2}.mo)$`', '/tgmpa-$1', $mofile );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Potentially overload the fall-back translation file for the current language.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * WP, by default since WP 3.7, will load a local translation first and if none&nbsp;</div></li><li><div>     * can be found, will try and find a translation in the /wp-content/languages/ directory.&nbsp;</div></li><li><div>     * As this library is theme/plugin agnostic, translation files for TGMPA can exist both&nbsp;</div></li><li><div>     * in the WP_LANG_DIR /plugins/ subdirectory as well as in the /themes/ subdirectory.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This method makes sure both directories are checked.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * {@internal IMPORTANT! If this function changes, review the regex in the custom TGMPA&nbsp;</div></li><li><div>     * generator on the website.}}&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $mofile Full path to the target mofile.&nbsp;</div></li><li><div>     * @param string $domain The domain for which a language file is being loaded.&nbsp;</div></li><li><div>     * @return string $mofile&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function overload_textdomain_mofile( $mofile, $domain ) {&nbsp;</div></li><li><div>        // Exit early if not our domain, not a WP_LANG_DIR load or if the file exists and is readable.&nbsp;</div></li><li><div>        if ( 'tgmpa' !== $domain || false === strpos( $mofile, WP_LANG_DIR ) || @is_readable( $mofile ) ) {&nbsp;</div></li><li><div>            return $mofile;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Current fallback file is not valid, let's try the alternative option.&nbsp;</div></li><li><div>        if ( false !== strpos( $mofile, '/themes/' ) ) {&nbsp;</div></li><li><div>            return str_replace( '/themes/', '/plugins/', $mofile );&nbsp;</div></li><li><div>        } elseif ( false !== strpos( $mofile, '/plugins/' ) ) {&nbsp;</div></li><li><div>            return str_replace( '/plugins/', '/themes/', $mofile );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return $mofile;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Hook in plugin action link filters for the WP native plugins page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * - Prevent activation of plugins which don't meet the minimum version requirements.&nbsp;</div></li><li><div>     * - Prevent deactivation of force-activated plugins.&nbsp;</div></li><li><div>     * - Add update notice if update available.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function add_plugin_action_link_filters() {&nbsp;</div></li><li><div>        foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>            if ( false === $this-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>                add_filter( 'plugin_action_links_' . $plugin['file_path'], array( $this, 'filter_plugin_action_links_activate' ), 20 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( true === $plugin['force_activation'] ) {&nbsp;</div></li><li><div>                add_filter( 'plugin_action_links_' . $plugin['file_path'], array( $this, 'filter_plugin_action_links_deactivate' ), 20 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false !== $this-&gt;does_plugin_require_update( $slug ) ) {&nbsp;</div></li><li><div>                add_filter( 'plugin_action_links_' . $plugin['file_path'], array( $this, 'filter_plugin_action_links_update' ), 20 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Remove the 'Activate' link on the WP native plugins page if the plugin does not meet the&nbsp;</div></li><li><div>     * minimum version requirements.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $actions Action links.&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function filter_plugin_action_links_activate( $actions ) {&nbsp;</div></li><li><div>        unset( $actions['activate'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $actions;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Remove the 'Deactivate' link on the WP native plugins page if the plugin has been set to force activate.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $actions Action links.&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function filter_plugin_action_links_deactivate( $actions ) {&nbsp;</div></li><li><div>        unset( $actions['deactivate'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $actions;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add a 'Requires update' link on the WP native plugins page if the plugin does not meet the&nbsp;</div></li><li><div>     * minimum version requirements.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $actions Action links.&nbsp;</div></li><li><div>     * @return array&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function filter_plugin_action_links_update( $actions ) {&nbsp;</div></li><li><div>        $actions['update'] = sprintf(&nbsp;</div></li><li><div>            '&lt;a href=&quot;%1$s&quot; title=&quot;%2$s&quot; class=&quot;edit&quot;&gt;%3$s&lt;/a&gt;', &nbsp;</div></li><li><div>            esc_url( $this-&gt;get_tgmpa_status_url( 'update' ) ), &nbsp;</div></li><li><div>            esc_attr__( 'This plugin needs to be updated to be compatible with your theme.', 'tgmpa' ), &nbsp;</div></li><li><div>            esc_html__( 'Update Required', 'tgmpa' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $actions;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Handles calls to show plugin information via links in the notices.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * We get the links in the admin notices to point to the TGMPA page, rather&nbsp;</div></li><li><div>     * than the typical plugin-install.php file, so we can prepare everything&nbsp;</div></li><li><div>     * beforehand.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * WP does not make it easy to show the plugin information in the thickbox -&nbsp;</div></li><li><div>     * here we have to require a file that includes a function that does the&nbsp;</div></li><li><div>     * main work of displaying it, enqueue some styles, set up some globals and&nbsp;</div></li><li><div>     * finally call that function before exiting.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Down right easy once you know how...&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Returns early if not the TGMPA page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global string $tab Used as iframe div class names, helps with styling&nbsp;</div></li><li><div>     * @global string $body_id Used as the iframe body ID, helps with styling&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return null Returns early if not the TGMPA page.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_init() {&nbsp;</div></li><li><div>        if ( ! $this-&gt;is_tgmpa_page() ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $_REQUEST['tab'] ) && 'plugin-information' === $_REQUEST['tab'] ) {&nbsp;</div></li><li><div>            // Needed for install_plugin_information().&nbsp;</div></li><li><div>            require_once ABSPATH . 'wp-admin/includes/plugin-install.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            wp_enqueue_style( 'plugin-install' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            global $tab, $body_id;&nbsp;</div></li><li><div>            $body_id = 'plugin-information';&nbsp;</div></li><li><div>            // @codingStandardsIgnoreStart&nbsp;</div></li><li><div>            $tab = 'plugin-information';&nbsp;</div></li><li><div>            // @codingStandardsIgnoreEnd&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            install_plugin_information();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            exit;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Enqueue thickbox scripts/styles for plugin info.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Thickbox is not automatically included on all admin pages, so we must&nbsp;</div></li><li><div>     * manually enqueue it for those pages.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Thickbox is only loaded if the user has not dismissed the admin&nbsp;</div></li><li><div>     * notice or if there are any plugins left to install and activate.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function thickbox() {&nbsp;</div></li><li><div>        if ( ! get_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice_' . $this-&gt;id, true ) ) {&nbsp;</div></li><li><div>            add_thickbox();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adds submenu page if there are plugin actions to take.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This method adds the submenu page letting users know that a required&nbsp;</div></li><li><div>     * plugin needs to be installed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This page disappears once the plugin has been installed and activated.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see TGM_Plugin_Activation::init()&nbsp;</div></li><li><div>     * @see TGM_Plugin_Activation::install_plugins_page()&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return null Return early if user lacks capability to install a plugin.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function admin_menu() {&nbsp;</div></li><li><div>        // Make sure privileges are correct to see the page.&nbsp;</div></li><li><div>        if ( ! current_user_can( 'install_plugins' ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $args = apply_filters(&nbsp;</div></li><li><div>            'tgmpa_admin_menu_args', &nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'parent_slug' =&gt; $this-&gt;parent_slug, // Parent Menu slug.&nbsp;</div></li><li><div>                'page_title' =&gt; $this-&gt;strings['page_title'], // Page title.&nbsp;</div></li><li><div>                'menu_title' =&gt; $this-&gt;strings['menu_title'], // Menu title.&nbsp;</div></li><li><div>                'capability' =&gt; $this-&gt;capability, // Capability.&nbsp;</div></li><li><div>                'menu_slug' =&gt; $this-&gt;menu, // Menu slug.&nbsp;</div></li><li><div>                'function' =&gt; array( $this, 'install_plugins_page' ), // Callback.&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;add_admin_menu( $args );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add the menu item.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * {@internal IMPORTANT! If this function changes, review the regex in the custom TGMPA&nbsp;</div></li><li><div>     * generator on the website.}}&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $args Menu item configuration.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function add_admin_menu( array $args ) {&nbsp;</div></li><li><div>        if ( has_filter( 'tgmpa_admin_menu_use_add_theme_page' ) ) {&nbsp;</div></li><li><div>            _deprecated_function( 'The &quot;tgmpa_admin_menu_use_add_theme_page&quot; filter', '2.5.0', esc_html__( 'Set the parent_slug config variable instead.', 'tgmpa' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'themes.php' === $this-&gt;parent_slug ) {&nbsp;</div></li><li><div>            $this-&gt;page_hook = call_user_func( 'add_theme_page', $args['page_title'], $args['menu_title'], $args['capability'], $args['menu_slug'], $args['function'] );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $this-&gt;page_hook = call_user_func( 'add_submenu_page', $args['parent_slug'], $args['page_title'], $args['menu_title'], $args['capability'], $args['menu_slug'], $args['function'] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Echoes plugin installation form.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This method is the callback for the admin_menu method function.&nbsp;</div></li><li><div>     * This displays the admin page and form area where the user can select to install and activate the plugin.&nbsp;</div></li><li><div>     * Aborts early if we're processing a plugin installation action.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return null Aborts early if we're processing a plugin installation action.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function install_plugins_page() {&nbsp;</div></li><li><div>        // Store new instance of plugin table in object.&nbsp;</div></li><li><div>        $plugin_table = new TGMPA_List_Table;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Return early if processing a plugin installation action.&nbsp;</div></li><li><div>        if ( ( ( 'tgmpa-bulk-install' === $plugin_table-&gt;current_action() || 'tgmpa-bulk-update' === $plugin_table-&gt;current_action() ) && $plugin_table-&gt;process_bulk_actions() ) || $this-&gt;do_plugin_install() ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Force refresh of available plugin information so we'll know about manual updates/deletes.&nbsp;</div></li><li><div>        wp_clean_plugins_cache( false );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;tgmpa wrap&quot;&gt;&nbsp;</div></li><li><div>            &lt;h1&gt;&lt;?php echo esc_html( get_admin_page_title() ); ?&gt;&lt;/h1&gt;&nbsp;</div></li><li><div>            &lt;?php $plugin_table-&gt;prepare_items(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            if ( ! empty( $this-&gt;message ) && is_string( $this-&gt;message ) ) {&nbsp;</div></li><li><div>                echo wp_kses_post( $this-&gt;message );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;?php $plugin_table-&gt;views(); ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;form id=&quot;tgmpa-plugins&quot; action=&quot;&quot; method=&quot;post&quot;&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;hidden&quot; name=&quot;tgmpa-page&quot; value=&quot;&lt;?php echo esc_attr( $this-&gt;menu ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                &lt;input type=&quot;hidden&quot; name=&quot;plugin_status&quot; value=&quot;&lt;?php echo esc_attr( $plugin_table-&gt;view_context ); ?&gt;&quot; /&gt;&nbsp;</div></li><li><div>                &lt;?php $plugin_table-&gt;display(); ?&gt;&nbsp;</div></li><li><div>            &lt;/form&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Installs, updates or activates a plugin depending on the action link clicked by the user.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Checks the $_GET variable to see which actions have been&nbsp;</div></li><li><div>     * passed and responds with the appropriate method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Uses WP_Filesystem to process and handle the plugin installation&nbsp;</div></li><li><div>     * method.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @uses WP_Filesystem&nbsp;</div></li><li><div>     * @uses WP_Error&nbsp;</div></li><li><div>     * @uses WP_Upgrader&nbsp;</div></li><li><div>     * @uses Plugin_Upgrader&nbsp;</div></li><li><div>     * @uses Plugin_Installer_Skin&nbsp;</div></li><li><div>     * @uses Plugin_Upgrader_Skin&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return boolean True on success, false on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function do_plugin_install() {&nbsp;</div></li><li><div>        if ( empty( $_GET['plugin'] ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // All plugin information will be stored in an array for processing.&nbsp;</div></li><li><div>        $slug = $this-&gt;sanitize_key( urldecode( $_GET['plugin'] ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $this-&gt;plugins[ $slug ] ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Was an install or upgrade action link clicked?&nbsp;</div></li><li><div>        if ( ( isset( $_GET['tgmpa-install'] ) && 'install-plugin' === $_GET['tgmpa-install'] ) || ( isset( $_GET['tgmpa-update'] ) && 'update-plugin' === $_GET['tgmpa-update'] ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $install_type = 'install';&nbsp;</div></li><li><div>            if ( isset( $_GET['tgmpa-update'] ) && 'update-plugin' === $_GET['tgmpa-update'] ) {&nbsp;</div></li><li><div>                $install_type = 'update';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            check_admin_referer( 'tgmpa-' . $install_type, 'tgmpa-nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Pass necessary information via URL if WP_Filesystem is needed.&nbsp;</div></li><li><div>            $url = wp_nonce_url(&nbsp;</div></li><li><div>                add_query_arg(&nbsp;</div></li><li><div>                    array(&nbsp;</div></li><li><div>                        'plugin' =&gt; urlencode( $slug ), &nbsp;</div></li><li><div>                        'tgmpa-' . $install_type =&gt; $install_type . '-plugin', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    $this-&gt;get_tgmpa_url()&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'tgmpa-' . $install_type, &nbsp;</div></li><li><div>                'tgmpa-nonce'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $method = ''; // Leave blank so WP_Filesystem can populate it as necessary.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false === ( $creds = request_filesystem_credentials( esc_url_raw( $url ), $method, false, false, array() ) ) ) {&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! WP_Filesystem( $creds ) ) {&nbsp;</div></li><li><div>                request_filesystem_credentials( esc_url_raw( $url ), $method, true, false, array() ); // Setup WP_Filesystem.&nbsp;</div></li><li><div>                return true;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            /** If we arrive here, we have the filesystem. */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Prep variables for Plugin_Installer_Skin class.&nbsp;</div></li><li><div>            $extra = array();&nbsp;</div></li><li><div>            $extra['slug'] = $slug; // Needed for potentially renaming of directory name.&nbsp;</div></li><li><div>            $source = $this-&gt;get_download_url( $slug );&nbsp;</div></li><li><div>            $api = ( 'repo' === $this-&gt;plugins[ $slug ]['source_type'] ) ? $this-&gt;get_plugins_api( $slug ) : null;&nbsp;</div></li><li><div>            $api = ( false !== $api ) ? $api : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $url = add_query_arg(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'action' =&gt; $install_type . '-plugin', &nbsp;</div></li><li><div>                    'plugin' =&gt; urlencode( $slug ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'update.php'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! class_exists( 'Plugin_Upgrader', false ) ) {&nbsp;</div></li><li><div>                require_once ABSPATH . 'wp-admin/includes/class-wp-upgrader.php';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $title = ( 'update' === $install_type ) ? $this-&gt;strings['updating'] : $this-&gt;strings['installing'];&nbsp;</div></li><li><div>            $skin_args = array(&nbsp;</div></li><li><div>                'type' =&gt; ( 'bundled' !== $this-&gt;plugins[ $slug ]['source_type'] ) ? 'web' : 'upload', &nbsp;</div></li><li><div>                'title' =&gt; sprintf( $title, $this-&gt;plugins[ $slug ]['name'] ), &nbsp;</div></li><li><div>                'url' =&gt; esc_url_raw( $url ), &nbsp;</div></li><li><div>                'nonce' =&gt; $install_type . '-plugin_' . $slug, &nbsp;</div></li><li><div>                'plugin' =&gt; '', &nbsp;</div></li><li><div>                'api' =&gt; $api, &nbsp;</div></li><li><div>                'extra' =&gt; $extra, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            unset( $title );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'update' === $install_type ) {&nbsp;</div></li><li><div>                $skin_args['plugin'] = $this-&gt;plugins[ $slug ]['file_path'];&nbsp;</div></li><li><div>                $skin = new Plugin_Upgrader_Skin( $skin_args );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $skin = new Plugin_Installer_Skin( $skin_args );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Create a new instance of Plugin_Upgrader.&nbsp;</div></li><li><div>            $upgrader = new Plugin_Upgrader( $skin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Perform the action and install the plugin from the $source urldecode().&nbsp;</div></li><li><div>            add_filter( 'upgrader_source_selection', array( $this, 'maybe_adjust_source_dir' ), 1, 3 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( 'update' === $install_type ) {&nbsp;</div></li><li><div>                // Inject our info into the update transient.&nbsp;</div></li><li><div>                $to_inject = array( $slug =&gt; $this-&gt;plugins[ $slug ] );&nbsp;</div></li><li><div>                $to_inject[ $slug ]['source'] = $source;&nbsp;</div></li><li><div>                $this-&gt;inject_update_info( $to_inject );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $upgrader-&gt;upgrade( $this-&gt;plugins[ $slug ]['file_path'] );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $upgrader-&gt;install( $source );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            remove_filter( 'upgrader_source_selection', array( $this, 'maybe_adjust_source_dir' ), 1 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Make sure we have the correct file path now the plugin is installed/updated.&nbsp;</div></li><li><div>            $this-&gt;populate_file_path( $slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Only activate plugins if the config option is set to true and the plugin isn't&nbsp;</div></li><li><div>            // already active (upgrade).&nbsp;</div></li><li><div>            if ( $this-&gt;is_automatic && ! $this-&gt;is_plugin_active( $slug ) ) {&nbsp;</div></li><li><div>                $plugin_activate = $upgrader-&gt;plugin_info(); // Grab the plugin info from the Plugin_Upgrader method.&nbsp;</div></li><li><div>                if ( false === $this-&gt;activate_single_plugin( $plugin_activate, $slug, true ) ) {&nbsp;</div></li><li><div>                    return true; // Finish execution of the function early as we encountered an error.&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $this-&gt;show_tgmpa_version();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Display message based on if all plugins are now active or not.&nbsp;</div></li><li><div>            if ( $this-&gt;is_tgmpa_complete() ) {&nbsp;</div></li><li><div>                echo '&lt;p&gt;', sprintf( esc_html( $this-&gt;strings['complete'] ), '&lt;a href=&quot;' . esc_url( self_admin_url() ) . '&quot;&gt;' . esc_html__( 'Return to the Dashboard', 'tgmpa' ) . '&lt;/a&gt;' ), '&lt;/p&gt;';&nbsp;</div></li><li><div>                echo '&lt;style type=&quot;text/css&quot;&gt;#adminmenu .wp-submenu li.current { display: none !important; }&lt;/style&gt;';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                echo '&lt;p&gt;&lt;a href=&quot;', esc_url( $this-&gt;get_tgmpa_url() ), '&quot; target=&quot;_parent&quot;&gt;', esc_html( $this-&gt;strings['return'] ), '&lt;/a&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        } elseif ( isset( $this-&gt;plugins[ $slug ]['file_path'], $_GET['tgmpa-activate'] ) && 'activate-plugin' === $_GET['tgmpa-activate'] ) {&nbsp;</div></li><li><div>            // Activate action link was clicked.&nbsp;</div></li><li><div>            check_admin_referer( 'tgmpa-activate', 'tgmpa-nonce' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( false === $this-&gt;activate_single_plugin( $this-&gt;plugins[ $slug ]['file_path'], $slug ) ) {&nbsp;</div></li><li><div>                return true; // Finish execution of the function early as we encountered an error.&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Inject information into the 'update_plugins' site transient as WP checks that before running an update.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $plugins The plugin information for the plugins which are to be updated.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function inject_update_info( $plugins ) {&nbsp;</div></li><li><div>        $repo_updates = get_site_transient( 'update_plugins' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! is_object( $repo_updates ) ) {&nbsp;</div></li><li><div>            $repo_updates = new stdClass;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>            $file_path = $plugin['file_path'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( empty( $repo_updates-&gt;response[ $file_path ] ) ) {&nbsp;</div></li><li><div>                $repo_updates-&gt;response[ $file_path ] = new stdClass;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // We only really need to set package, but let's do all we can in case WP changes something.&nbsp;</div></li><li><div>            $repo_updates-&gt;response[ $file_path ]-&gt;slug = $slug;&nbsp;</div></li><li><div>            $repo_updates-&gt;response[ $file_path ]-&gt;plugin = $file_path;&nbsp;</div></li><li><div>            $repo_updates-&gt;response[ $file_path ]-&gt;new_version = $plugin['version'];&nbsp;</div></li><li><div>            $repo_updates-&gt;response[ $file_path ]-&gt;package = $plugin['source'];&nbsp;</div></li><li><div>            if ( empty( $repo_updates-&gt;response[ $file_path ]-&gt;url ) && ! empty( $plugin['external_url'] ) ) {&nbsp;</div></li><li><div>                $repo_updates-&gt;response[ $file_path ]-&gt;url = $plugin['external_url'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        set_site_transient( 'update_plugins', $repo_updates );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Adjust the plugin directory name if necessary.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * The final destination directory of a plugin is based on the subdirectory name found in the&nbsp;</div></li><li><div>     * (un)zipped source. In some cases - most notably GitHub repository plugin downloads -, this&nbsp;</div></li><li><div>     * subdirectory name is not the same as the expected slug and the plugin will not be recognized&nbsp;</div></li><li><div>     * as installed. This is fixed by adjusting the temporary unzipped source subdirectory name to&nbsp;</div></li><li><div>     * the expected plugin slug.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string       $source        Path to upgrade/zip-file-name.tmp/subdirectory/.&nbsp;</div></li><li><div>     * @param string       $remote_source Path to upgrade/zip-file-name.tmp.&nbsp;</div></li><li><div>     * @param \WP_Upgrader $upgrader      Instance of the upgrader which installs the plugin.&nbsp;</div></li><li><div>     * @return string $source&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function maybe_adjust_source_dir( $source, $remote_source, $upgrader ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;is_tgmpa_page() || ! is_object( $GLOBALS['wp_filesystem'] ) ) {&nbsp;</div></li><li><div>            return $source;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Check for single file plugins.&nbsp;</div></li><li><div>        $source_files = array_keys( $GLOBALS['wp_filesystem']-&gt;dirlist( $remote_source ) );&nbsp;</div></li><li><div>        if ( 1 === count( $source_files ) && false === $GLOBALS['wp_filesystem']-&gt;is_dir( $source ) ) {&nbsp;</div></li><li><div>            return $source;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Multi-file plugin, let's see if the directory is correctly named.&nbsp;</div></li><li><div>        $desired_slug = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Figure out what the slug is supposed to be.&nbsp;</div></li><li><div>        if ( false === $upgrader-&gt;bulk && ! empty( $upgrader-&gt;skin-&gt;options['extra']['slug'] ) ) {&nbsp;</div></li><li><div>            $desired_slug = $upgrader-&gt;skin-&gt;options['extra']['slug'];&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // Bulk installer contains less info, so fall back on the info registered here.&nbsp;</div></li><li><div>            foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>                if ( ! empty( $upgrader-&gt;skin-&gt;plugin_names[ $upgrader-&gt;skin-&gt;i ] ) && $plugin['name'] === $upgrader-&gt;skin-&gt;plugin_names[ $upgrader-&gt;skin-&gt;i ] ) {&nbsp;</div></li><li><div>                    $desired_slug = $slug;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            unset( $slug, $plugin );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $desired_slug ) ) {&nbsp;</div></li><li><div>            $subdir_name = untrailingslashit( str_replace( trailingslashit( $remote_source ), '', $source ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! empty( $subdir_name ) && $subdir_name !== $desired_slug ) {&nbsp;</div></li><li><div>                $from_path = untrailingslashit( $source );&nbsp;</div></li><li><div>                $to_path = trailingslashit( $remote_source ) . $desired_slug;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( true === $GLOBALS['wp_filesystem']-&gt;move( $from_path, $to_path ) ) {&nbsp;</div></li><li><div>                    return trailingslashit( $to_path );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    return new WP_Error( 'rename_failed', esc_html__( 'The remote plugin package does not contain a folder with the desired slug and renaming did not work.', 'tgmpa' ) . ' ' . esc_html__( 'Please contact the plugin provider and ask them to package their plugin according to the WordPress guidelines.', 'tgmpa' ), array( 'found' =&gt; $subdir_name, 'expected' =&gt; $desired_slug ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } elseif ( empty( $subdir_name ) ) {&nbsp;</div></li><li><div>                return new WP_Error( 'packaged_wrong', esc_html__( 'The remote plugin package consists of more than one file, but the files are not packaged in a folder.', 'tgmpa' ) . ' ' . esc_html__( 'Please contact the plugin provider and ask them to package their plugin according to the WordPress guidelines.', 'tgmpa' ), array( 'found' =&gt; $subdir_name, 'expected' =&gt; $desired_slug ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $source;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Activate a single plugin and send feedback about the result to the screen.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $file_path Path within wp-plugins/ to main plugin file.&nbsp;</div></li><li><div>     * @param string $slug      Plugin slug.&nbsp;</div></li><li><div>     * @param bool   $automatic Whether this is an automatic activation after an install. Defaults to false.&nbsp;</div></li><li><div>     *                          This determines the styling of the output messages.&nbsp;</div></li><li><div>     * @return bool False if an error was encountered, true otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function activate_single_plugin( $file_path, $slug, $automatic = false ) {&nbsp;</div></li><li><div>        if ( $this-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>            $activate = activate_plugin( $file_path );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_wp_error( $activate ) ) {&nbsp;</div></li><li><div>                echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', wp_kses_post( $activate-&gt;get_error_message() ), '&lt;/p&gt;&lt;/div&gt;', &nbsp;</div></li><li><div>                    '&lt;p&gt;&lt;a href=&quot;', esc_url( $this-&gt;get_tgmpa_url() ), '&quot; target=&quot;_parent&quot;&gt;', esc_html( $this-&gt;strings['return'] ), '&lt;/a&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                return false; // End it here if there is an error with activation.&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if ( ! $automatic ) {&nbsp;</div></li><li><div>                    // Make sure message doesn't display again if bulk activation is performed&nbsp;</div></li><li><div>                    // immediately after a single activation.&nbsp;</div></li><li><div>                    if ( ! isset( $_POST['action'] ) ) { // WPCS: CSRF OK.&nbsp;</div></li><li><div>                        echo '&lt;div id=&quot;message&quot; class=&quot;updated&quot;&gt;&lt;p&gt;', esc_html( $this-&gt;strings['activated_successfully'] ), ' &lt;strong&gt;', esc_html( $this-&gt;plugins[ $slug ]['name'] ), '.&lt;/strong&gt;&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    // Simpler message layout for use on the plugin install page.&nbsp;</div></li><li><div>                    echo '&lt;p&gt;', esc_html( $this-&gt;strings['plugin_activated'] ), '&lt;/p&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif ( $this-&gt;is_plugin_active( $slug ) ) {&nbsp;</div></li><li><div>            // No simpler message format provided as this message should never be encountered&nbsp;</div></li><li><div>            // on the plugin install page.&nbsp;</div></li><li><div>            echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', &nbsp;</div></li><li><div>                sprintf(&nbsp;</div></li><li><div>                    esc_html( $this-&gt;strings['plugin_already_active'] ), &nbsp;</div></li><li><div>                    '&lt;strong&gt;' . esc_html( $this-&gt;plugins[ $slug ]['name'] ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>        } elseif ( $this-&gt;does_plugin_require_update( $slug ) ) {&nbsp;</div></li><li><div>            if ( ! $automatic ) {&nbsp;</div></li><li><div>                // Make sure message doesn't display again if bulk activation is performed&nbsp;</div></li><li><div>                // immediately after a single activation.&nbsp;</div></li><li><div>                if ( ! isset( $_POST['action'] ) ) { // WPCS: CSRF OK.&nbsp;</div></li><li><div>                    echo '&lt;div id=&quot;message&quot; class=&quot;error&quot;&gt;&lt;p&gt;', &nbsp;</div></li><li><div>                        sprintf(&nbsp;</div></li><li><div>                            esc_html( $this-&gt;strings['plugin_needs_higher_version'] ), &nbsp;</div></li><li><div>                            '&lt;strong&gt;' . esc_html( $this-&gt;plugins[ $slug ]['name'] ) . '&lt;/strong&gt;'&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                        '&lt;/p&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // Simpler message layout for use on the plugin install page.&nbsp;</div></li><li><div>                echo '&lt;p&gt;', sprintf( esc_html( $this-&gt;strings['plugin_needs_higher_version'] ), esc_html( $this-&gt;plugins[ $slug ]['name'] ) ), '&lt;/p&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Echoes required plugin notice.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Outputs a message telling users that a specific plugin is required for&nbsp;</div></li><li><div>     * their theme. If appropriate, it includes a link to the form page where&nbsp;</div></li><li><div>     * users can install and activate the plugin.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Returns early if we're on the Install page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 1.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @global object $current_screen&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return null Returns early if we're on the Install page.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function notices() {&nbsp;</div></li><li><div>        // Remove nag on the install page / Return early if the nag message has been dismissed or user &lt; author.&nbsp;</div></li><li><div>        if ( ( $this-&gt;is_tgmpa_page() || $this-&gt;is_core_update_page() ) || get_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice_' . $this-&gt;id, true ) || ! current_user_can( apply_filters( 'tgmpa_show_admin_notice_capability', 'publish_posts' ) ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Store for the plugin slugs by message type.&nbsp;</div></li><li><div>        $message = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Initialize counters used to determine plurality of action link texts.&nbsp;</div></li><li><div>        $install_link_count = 0;&nbsp;</div></li><li><div>        $update_link_count = 0;&nbsp;</div></li><li><div>        $activate_link_count = 0;&nbsp;</div></li><li><div>        $total_required_action_count = 0;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>            if ( $this-&gt;is_plugin_active( $slug ) && false === $this-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! $this-&gt;is_plugin_installed( $slug ) ) {&nbsp;</div></li><li><div>                if ( current_user_can( 'install_plugins' ) ) {&nbsp;</div></li><li><div>                    $install_link_count++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                        $message['notice_can_install_required'][] = $slug;&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        $message['notice_can_install_recommended'][] = $slug;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                    $total_required_action_count++;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                if ( ! $this-&gt;is_plugin_active( $slug ) && $this-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>                    if ( current_user_can( 'activate_plugins' ) ) {&nbsp;</div></li><li><div>                        $activate_link_count++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                            $message['notice_can_activate_required'][] = $slug;&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $message['notice_can_activate_recommended'][] = $slug;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                        $total_required_action_count++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                if ( $this-&gt;does_plugin_require_update( $slug ) || false !== $this-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( current_user_can( 'update_plugins' ) ) {&nbsp;</div></li><li><div>                        $update_link_count++;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        if ( $this-&gt;does_plugin_require_update( $slug ) ) {&nbsp;</div></li><li><div>                            $message['notice_ask_to_update'][] = $slug;&nbsp;</div></li><li><div>                        } elseif ( false !== $this-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>                            $message['notice_ask_to_update_maybe'][] = $slug;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    if ( true === $plugin['required'] ) {&nbsp;</div></li><li><div>                        $total_required_action_count++;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        unset( $slug, $plugin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // If we have notices to display, we move forward.&nbsp;</div></li><li><div>        if ( ! empty( $message ) || $total_required_action_count &gt; 0 ) {&nbsp;</div></li><li><div>            krsort( $message ); // Sort messages.&nbsp;</div></li><li><div>            $rendered = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // As add_settings_error() wraps the final message in a &lt;p&gt; and as the final message can't be&nbsp;</div></li><li><div>            // filtered, using &lt;p&gt;'s in our html would render invalid html output.&nbsp;</div></li><li><div>            $line_template = '&lt;span style=&quot;display: block; margin: 0.5em 0.5em 0 0; clear: both;&quot;&gt;%s&lt;/span&gt;' . &quot;\n&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! current_user_can( 'activate_plugins' ) && ! current_user_can( 'install_plugins' ) && ! current_user_can( 'update_plugins' ) ) {&nbsp;</div></li><li><div>                $rendered = esc_html( $this-&gt;strings['notice_cannot_install_activate'] ) . ' ' . esc_html( $this-&gt;strings['contact_admin'] );&nbsp;</div></li><li><div>                $rendered .= $this-&gt;create_user_action_links_for_notice( 0, 0, 0, $line_template );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // If dismissable is false and a message is set, output it now.&nbsp;</div></li><li><div>                if ( ! $this-&gt;dismissable && ! empty( $this-&gt;dismiss_msg ) ) {&nbsp;</div></li><li><div>                    $rendered .= sprintf( $line_template, wp_kses_post( $this-&gt;dismiss_msg ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Render the individual message lines for the notice.&nbsp;</div></li><li><div>                foreach ( $message as $type =&gt; $plugin_group ) {&nbsp;</div></li><li><div>                    $linked_plugins = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Get the external info link for a plugin if one is available.&nbsp;</div></li><li><div>                    foreach ( $plugin_group as $plugin_slug ) {&nbsp;</div></li><li><div>                        $linked_plugins[] = $this-&gt;get_info_link( $plugin_slug );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    unset( $plugin_slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $count = count( $plugin_group );&nbsp;</div></li><li><div>                    $linked_plugins = array_map( array( 'TGMPA_Utils', 'wrap_in_em' ), $linked_plugins );&nbsp;</div></li><li><div>                    $last_plugin = array_pop( $linked_plugins ); // Pop off last name to prep for readability.&nbsp;</div></li><li><div>                    $imploded = empty( $linked_plugins ) ? $last_plugin : ( implode( ', ', $linked_plugins ) . ' ' . esc_html_x( 'and', 'plugin A *and* plugin B', 'tgmpa' ) . ' ' . $last_plugin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $rendered .= sprintf(&nbsp;</div></li><li><div>                        $line_template, &nbsp;</div></li><li><div>                        sprintf(&nbsp;</div></li><li><div>                            translate_nooped_plural( $this-&gt;strings[ $type ], $count, 'tgmpa' ), &nbsp;</div></li><li><div>                            $imploded, &nbsp;</div></li><li><div>                            $count&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                unset( $type, $plugin_group, $linked_plugins, $count, $last_plugin, $imploded );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $rendered .= $this-&gt;create_user_action_links_for_notice( $install_link_count, $update_link_count, $activate_link_count, $line_template );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Register the nag messages and prepare them to be processed.&nbsp;</div></li><li><div>            add_settings_error( 'tgmpa', 'tgmpa', $rendered, $this-&gt;get_admin_notice_class() );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Admin options pages already output settings_errors, so this is to avoid duplication.&nbsp;</div></li><li><div>        if ( 'options-general' !== $GLOBALS['current_screen']-&gt;parent_base ) {&nbsp;</div></li><li><div>            $this-&gt;display_settings_errors();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Generate the user action links for the admin notice.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param int $install_count  Number of plugins to install.&nbsp;</div></li><li><div>     * @param int $update_count   Number of plugins to update.&nbsp;</div></li><li><div>     * @param int $activate_count Number of plugins to activate.&nbsp;</div></li><li><div>     * @param int $line_template  Template for the HTML tag to output a line.&nbsp;</div></li><li><div>     * @return string Action links.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function create_user_action_links_for_notice( $install_count, $update_count, $activate_count, $line_template ) {&nbsp;</div></li><li><div>        // Setup action links.&nbsp;</div></li><li><div>        $action_links = array(&nbsp;</div></li><li><div>            'install' =&gt; '', &nbsp;</div></li><li><div>            'update' =&gt; '', &nbsp;</div></li><li><div>            'activate' =&gt; '', &nbsp;</div></li><li><div>            'dismiss' =&gt; $this-&gt;dismissable ? '&lt;a href=&quot;' . esc_url( wp_nonce_url( add_query_arg( 'tgmpa-dismiss', 'dismiss_admin_notices' ), 'tgmpa-dismiss-' . get_current_user_id() ) ) . '&quot; class=&quot;dismiss-notice&quot; target=&quot;_parent&quot;&gt;' . esc_html( $this-&gt;strings['dismiss'] ) . '&lt;/a&gt;' : '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $link_template = '&lt;a href=&quot;%2$s&quot;&gt;%1$s&lt;/a&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( current_user_can( 'install_plugins' ) ) {&nbsp;</div></li><li><div>            if ( $install_count &gt; 0 ) {&nbsp;</div></li><li><div>                $action_links['install'] = sprintf(&nbsp;</div></li><li><div>                    $link_template, &nbsp;</div></li><li><div>                    translate_nooped_plural( $this-&gt;strings['install_link'], $install_count, 'tgmpa' ), &nbsp;</div></li><li><div>                    esc_url( $this-&gt;get_tgmpa_status_url( 'install' ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( $update_count &gt; 0 ) {&nbsp;</div></li><li><div>                $action_links['update'] = sprintf(&nbsp;</div></li><li><div>                    $link_template, &nbsp;</div></li><li><div>                    translate_nooped_plural( $this-&gt;strings['update_link'], $update_count, 'tgmpa' ), &nbsp;</div></li><li><div>                    esc_url( $this-&gt;get_tgmpa_status_url( 'update' ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( current_user_can( 'activate_plugins' ) && $activate_count &gt; 0 ) {&nbsp;</div></li><li><div>            $action_links['activate'] = sprintf(&nbsp;</div></li><li><div>                $link_template, &nbsp;</div></li><li><div>                translate_nooped_plural( $this-&gt;strings['activate_link'], $activate_count, 'tgmpa' ), &nbsp;</div></li><li><div>                esc_url( $this-&gt;get_tgmpa_status_url( 'activate' ) )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $action_links = apply_filters( 'tgmpa_notice_action_links', $action_links );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $action_links = array_filter( (array) $action_links ); // Remove any empty array items.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $action_links ) ) {&nbsp;</div></li><li><div>            $action_links = sprintf( $line_template, implode( ' | ', $action_links ) );&nbsp;</div></li><li><div>            return apply_filters( 'tgmpa_notice_rendered_action_links', $action_links );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get admin notice class.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Work around all the changes to the various admin notice classes between WP 4.4 and 3.7&nbsp;</div></li><li><div>     * (lowest supported version by TGMPA).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function get_admin_notice_class() {&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;strings['nag_type'] ) ) {&nbsp;</div></li><li><div>            return sanitize_html_class( strtolower( $this-&gt;strings['nag_type'] ) );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            if ( version_compare( $this-&gt;wp_version, '4.2', '&gt;=' ) ) {&nbsp;</div></li><li><div>                return 'notice-warning';&nbsp;</div></li><li><div>            } elseif ( version_compare( $this-&gt;wp_version, '4.1', '&gt;=' ) ) {&nbsp;</div></li><li><div>                return 'notice';&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                return 'updated';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Display settings errors and remove those which have been displayed to avoid duplicate messages showing&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function display_settings_errors() {&nbsp;</div></li><li><div>        global $wp_settings_errors;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        settings_errors( 'tgmpa' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( (array) $wp_settings_errors as $key =&gt; $details ) {&nbsp;</div></li><li><div>            if ( 'tgmpa' === $details['setting'] ) {&nbsp;</div></li><li><div>                unset( $wp_settings_errors[ $key ] );&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Register dismissal of admin notices.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Acts on the dismiss link in the admin nag messages.&nbsp;</div></li><li><div>     * If clicked, the admin notice disappears and will no longer be visible to this user.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.1.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function dismiss() {&nbsp;</div></li><li><div>        if ( isset( $_GET['tgmpa-dismiss'] ) && check_admin_referer( 'tgmpa-dismiss-' . get_current_user_id() ) ) {&nbsp;</div></li><li><div>            update_user_meta( get_current_user_id(), 'tgmpa_dismissed_notice_' . $this-&gt;id, 1 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add individual plugin to our collection of plugins.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * If the required keys are not set or the plugin has already&nbsp;</div></li><li><div>     * been registered, the plugin is not added.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array|null $plugin Array of plugin arguments or null if invalid argument.&nbsp;</div></li><li><div>     * @return null Return early if incorrect argument.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function register( $plugin ) {&nbsp;</div></li><li><div>        if ( empty( $plugin['slug'] ) || empty( $plugin['name'] ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( empty( $plugin['slug'] ) || ! is_string( $plugin['slug'] ) || isset( $this-&gt;plugins[ $plugin['slug'] ] ) ) {&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $defaults = array(&nbsp;</div></li><li><div>            'name' =&gt; '', // String&nbsp;</div></li><li><div>            'slug' =&gt; '', // String&nbsp;</div></li><li><div>            'source' =&gt; 'repo', // String&nbsp;</div></li><li><div>            'required' =&gt; false, // Boolean&nbsp;</div></li><li><div>            'version' =&gt; '', // String&nbsp;</div></li><li><div>            'force_activation' =&gt; false, // Boolean&nbsp;</div></li><li><div>            'force_deactivation' =&gt; false, // Boolean&nbsp;</div></li><li><div>            'external_url' =&gt; '', // String&nbsp;</div></li><li><div>            'is_callable' =&gt; '', // String|Array.&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Prepare the received data.&nbsp;</div></li><li><div>        $plugin = wp_parse_args( $plugin, $defaults );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Standardize the received slug.&nbsp;</div></li><li><div>        $plugin['slug'] = $this-&gt;sanitize_key( $plugin['slug'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Forgive users for using string versions of booleans or floats for version number.&nbsp;</div></li><li><div>        $plugin['version'] = (string) $plugin['version'];&nbsp;</div></li><li><div>        $plugin['source'] = empty( $plugin['source'] ) ? 'repo' : $plugin['source'];&nbsp;</div></li><li><div>        $plugin['required'] = TGMPA_Utils::validate_bool( $plugin['required'] );&nbsp;</div></li><li><div>        $plugin['force_activation'] = TGMPA_Utils::validate_bool( $plugin['force_activation'] );&nbsp;</div></li><li><div>        $plugin['force_deactivation'] = TGMPA_Utils::validate_bool( $plugin['force_deactivation'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Enrich the received data.&nbsp;</div></li><li><div>        $plugin['file_path'] = $this-&gt;_get_plugin_basename_from_slug( $plugin['slug'] );&nbsp;</div></li><li><div>        $plugin['source_type'] = $this-&gt;get_plugin_source_type( $plugin['source'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Set the class properties.&nbsp;</div></li><li><div>        $this-&gt;plugins[ $plugin['slug'] ]    = $plugin;&nbsp;</div></li><li><div>        $this-&gt;sort_order[ $plugin['slug'] ] = $plugin['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Should we add the force activation hook ?&nbsp;</div></li><li><div>        if ( true === $plugin['force_activation'] ) {&nbsp;</div></li><li><div>            $this-&gt;has_forced_activation = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Should we add the force deactivation hook ?&nbsp;</div></li><li><div>        if ( true === $plugin['force_deactivation'] ) {&nbsp;</div></li><li><div>            $this-&gt;has_forced_deactivation = true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Determine what type of source the plugin comes from.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $source The source of the plugin as provided, either empty (= WP repo), a file path&nbsp;</div></li><li><div>     *                       (= bundled) or an external URL.&nbsp;</div></li><li><div>     * @return string 'repo', 'external', or 'bundled'&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function get_plugin_source_type( $source ) {&nbsp;</div></li><li><div>        if ( 'repo' === $source || preg_match( self::WP_REPO_REGEX, $source ) ) {&nbsp;</div></li><li><div>            return 'repo';&nbsp;</div></li><li><div>        } elseif ( preg_match( self::IS_URL_REGEX, $source ) ) {&nbsp;</div></li><li><div>            return 'external';&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return 'bundled';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Sanitizes a string key.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Near duplicate of WP Core `sanitize_key()`. The difference is that uppercase characters *are*&nbsp;</div></li><li><div>     * allowed, so as not to break upgrade paths from non-standard bundled plugins using uppercase&nbsp;</div></li><li><div>     * characters in the plugin directory path/slug. Silly them.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @see https://developer.wordpress.org/reference/hooks/sanitize_key/&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $key String key.&nbsp;</div></li><li><div>     * @return string Sanitized key&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function sanitize_key( $key ) {&nbsp;</div></li><li><div>        $raw_key = $key;&nbsp;</div></li><li><div>        $key = preg_replace( '`[^A-Za-z0-9_-]`', '', $key );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**&nbsp;</div></li><li><div>         * Filter a sanitized key string.&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @since 2.5.0&nbsp;</div></li><li><div>         *&nbsp;</div></li><li><div>         * @param string $key     Sanitized key.&nbsp;</div></li><li><div>         * @param string $raw_key The key prior to sanitization.&nbsp;</div></li><li><div>         */&nbsp;</div></li><li><div>        return apply_filters( 'tgmpa_sanitize_key', $key, $raw_key );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Amend default configuration settings.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $config Array of config options to pass as class properties.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function config( $config ) {&nbsp;</div></li><li><div>        $keys = array(&nbsp;</div></li><li><div>            'id', &nbsp;</div></li><li><div>            'default_path', &nbsp;</div></li><li><div>            'has_notices', &nbsp;</div></li><li><div>            'dismissable', &nbsp;</div></li><li><div>            'dismiss_msg', &nbsp;</div></li><li><div>            'menu', &nbsp;</div></li><li><div>            'parent_slug', &nbsp;</div></li><li><div>            'capability', &nbsp;</div></li><li><div>            'is_automatic', &nbsp;</div></li><li><div>            'message', &nbsp;</div></li><li><div>            'strings', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $keys as $key ) {&nbsp;</div></li><li><div>            if ( isset( $config[ $key ] ) ) {&nbsp;</div></li><li><div>                if ( is_array( $config[ $key ] ) ) {&nbsp;</div></li><li><div>                    $this-&gt;$key = array_merge( $this-&gt;$key, $config[ $key ] );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $this-&gt;$key = $config[ $key ];&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Amend action link after plugin installation.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param array $install_actions Existing array of actions.&nbsp;</div></li><li><div>     * @return false|array Amended array of actions.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function actions( $install_actions ) {&nbsp;</div></li><li><div>        // Remove action links on the TGMPA install page.&nbsp;</div></li><li><div>        if ( $this-&gt;is_tgmpa_page() ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $install_actions;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Flushes the plugins cache on theme switch to prevent stale entries&nbsp;</div></li><li><div>     * from remaining in the plugin table.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param bool $clear_update_cache Optional. Whether to clear the Plugin updates cache.&nbsp;</div></li><li><div>     *                                 Parameter added in v2.5.0.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function flush_plugins_cache( $clear_update_cache = true ) {&nbsp;</div></li><li><div>        wp_clean_plugins_cache( $clear_update_cache );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Set file_path key for each installed plugin.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $plugin_slug Optional. If set, only (re-)populates the file path for that specific plugin.&nbsp;</div></li><li><div>     *                            Parameter added in v2.5.0.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function populate_file_path( $plugin_slug = '' ) {&nbsp;</div></li><li><div>        if ( ! empty( $plugin_slug ) && is_string( $plugin_slug ) && isset( $this-&gt;plugins[ $plugin_slug ] ) ) {&nbsp;</div></li><li><div>            $this-&gt;plugins[ $plugin_slug ]['file_path'] = $this-&gt;_get_plugin_basename_from_slug( $plugin_slug );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            // Add file_path key for all plugins.&nbsp;</div></li><li><div>            foreach ( $this-&gt;plugins as $slug =&gt; $values ) {&nbsp;</div></li><li><div>                $this-&gt;plugins[ $slug ]['file_path'] = $this-&gt;_get_plugin_basename_from_slug( $slug );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Helper function to extract the file path of the plugin file from the&nbsp;</div></li><li><div>     * plugin slug, if the plugin is installed.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.0.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug (typically folder name) as provided by the developer.&nbsp;</div></li><li><div>     * @return string Either file path for plugin if installed, or just the plugin slug.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function _get_plugin_basename_from_slug( $slug ) {&nbsp;</div></li><li><div>        $keys = array_keys( $this-&gt;get_plugins() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $keys as $key ) {&nbsp;</div></li><li><div>            if ( preg_match( '|^' . $slug . '/|', $key ) ) {&nbsp;</div></li><li><div>                return $key;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $slug;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve plugin data, given the plugin name.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Loops through the registered plugins looking for $name. If it finds it, &nbsp;</div></li><li><div>     * it returns the $data from that plugin. Otherwise, returns false.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $name Name of the plugin, as it was registered.&nbsp;</div></li><li><div>     * @param string $data Optional. Array key of plugin data to return. Default is slug.&nbsp;</div></li><li><div>     * @return string|boolean Plugin slug if found, false otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function _get_plugin_data_from_name( $name, $data = 'slug' ) {&nbsp;</div></li><li><div>        foreach ( $this-&gt;plugins as $values ) {&nbsp;</div></li><li><div>            if ( $name === $values['name'] && isset( $values[ $data ] ) ) {&nbsp;</div></li><li><div>                return $values[ $data ];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the download URL for a package.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return string Plugin download URL or path to local file or empty string if undetermined.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_download_url( $slug ) {&nbsp;</div></li><li><div>        $dl_source = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        switch ( $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>            case 'repo':&nbsp;</div></li><li><div>                return $this-&gt;get_wp_repo_download_url( $slug );&nbsp;</div></li><li><div>            case 'external':&nbsp;</div></li><li><div>                return $this-&gt;plugins[ $slug ]['source'];&nbsp;</div></li><li><div>            case 'bundled':&nbsp;</div></li><li><div>                return $this-&gt;default_path . $this-&gt;plugins[ $slug ]['source'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $dl_source; // Should never happen.&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the download URL for a WP repo package.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return string Plugin download URL.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function get_wp_repo_download_url( $slug ) {&nbsp;</div></li><li><div>        $source = '';&nbsp;</div></li><li><div>        $api = $this-&gt;get_plugins_api( $slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $api && isset( $api-&gt;download_link ) ) {&nbsp;</div></li><li><div>            $source = $api-&gt;download_link;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $source;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Try to grab information from WordPress API.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return object Plugins_api response object on success, WP_Error on failure.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function get_plugins_api( $slug ) {&nbsp;</div></li><li><div>        static $api = array(); // Cache received responses.&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $api[ $slug ] ) ) {&nbsp;</div></li><li><div>            if ( ! function_exists( 'plugins_api' ) ) {&nbsp;</div></li><li><div>                require_once ABSPATH . 'wp-admin/includes/plugin-install.php';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $response = plugins_api( 'plugin_information', array( 'slug' =&gt; $slug, 'fields' =&gt; array( 'sections' =&gt; false ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $api[ $slug ] = false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_wp_error( $response ) ) {&nbsp;</div></li><li><div>                wp_die( esc_html( $this-&gt;strings['oops'] ) );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $api[ $slug ] = $response;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $api[ $slug ];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve a link to a plugin information page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return string Fully formed html link to a plugin information page if available&nbsp;</div></li><li><div>     *                or the plugin name if not.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_info_link( $slug ) {&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;plugins[ $slug ]['external_url'] ) && preg_match( self::IS_URL_REGEX, $this-&gt;plugins[ $slug ]['external_url'] ) ) {&nbsp;</div></li><li><div>            $link = sprintf(&nbsp;</div></li><li><div>                '&lt;a href=&quot;%1$s&quot; target=&quot;_blank&quot;&gt;%2$s&lt;/a&gt;', &nbsp;</div></li><li><div>                esc_url( $this-&gt;plugins[ $slug ]['external_url'] ), &nbsp;</div></li><li><div>                esc_html( $this-&gt;plugins[ $slug ]['name'] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        } elseif ( 'repo' === $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>            $url = add_query_arg(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'tab' =&gt; 'plugin-information', &nbsp;</div></li><li><div>                    'plugin' =&gt; urlencode( $slug ), &nbsp;</div></li><li><div>                    'TB_iframe' =&gt; 'true', &nbsp;</div></li><li><div>                    'width' =&gt; '640', &nbsp;</div></li><li><div>                    'height' =&gt; '500', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                self_admin_url( 'plugin-install.php' )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $link = sprintf(&nbsp;</div></li><li><div>                '&lt;a href=&quot;%1$s&quot; class=&quot;thickbox&quot;&gt;%2$s&lt;/a&gt;', &nbsp;</div></li><li><div>                esc_url( $url ), &nbsp;</div></li><li><div>                esc_html( $this-&gt;plugins[ $slug ]['name'] )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            $link = esc_html( $this-&gt;plugins[ $slug ]['name'] ); // No hyperlink.&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $link;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Determine if we're on the TGMPA Install page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.1.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return boolean True when on the TGMPA page, false otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function is_tgmpa_page() {&nbsp;</div></li><li><div>        return isset( $_GET['page'] ) && $this-&gt;menu === $_GET['page'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Determine if we're on a WP Core installation/upgrade page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return boolean True when on a WP Core installation/upgrade page, false otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    protected function is_core_update_page() {&nbsp;</div></li><li><div>        // Current screen is not always available, most notably on the customizer screen.&nbsp;</div></li><li><div>        if ( ! function_exists( 'get_current_screen' ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( 'update-core' === $screen-&gt;base ) {&nbsp;</div></li><li><div>            // Core update screen.&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        } elseif ( 'plugins' === $screen-&gt;base && ! empty( $_POST['action'] ) ) { // WPCS: CSRF ok.&nbsp;</div></li><li><div>            // Plugins bulk update screen.&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        } elseif ( 'update' === $screen-&gt;base && ! empty( $_POST['action'] ) ) { // WPCS: CSRF ok.&nbsp;</div></li><li><div>            // Individual updates (ajax call).&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the URL to the TGMPA Install page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * I.e. depending on the config settings passed something along the lines of:&nbsp;</div></li><li><div>     * http://example.com/wp-admin/themes.php?page=tgmpa-install-plugins&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string Properly encoded URL (not escaped).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_tgmpa_url() {&nbsp;</div></li><li><div>        static $url;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! isset( $url ) ) {&nbsp;</div></li><li><div>            $parent = $this-&gt;parent_slug;&nbsp;</div></li><li><div>            if ( false === strpos( $parent, '.php' ) ) {&nbsp;</div></li><li><div>                $parent = 'admin.php';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $url = add_query_arg(&nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'page' =&gt; urlencode( $this-&gt;menu ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                self_admin_url( $parent )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $url;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the URL to the TGMPA Install page for a specific plugin status (view).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * I.e. depending on the config settings passed something along the lines of:&nbsp;</div></li><li><div>     * http://example.com/wp-admin/themes.php?page=tgmpa-install-plugins&plugin_status=install&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $status Plugin status - either 'install', 'update' or 'activate'.&nbsp;</div></li><li><div>     * @return string Properly encoded URL (not escaped).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_tgmpa_status_url( $status ) {&nbsp;</div></li><li><div>        return add_query_arg(&nbsp;</div></li><li><div>            array(&nbsp;</div></li><li><div>                'plugin_status' =&gt; urlencode( $status ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            $this-&gt;get_tgmpa_url()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Determine whether there are open actions for plugins registered with TGMPA.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return bool True if complete, i.e. no outstanding actions. False otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_tgmpa_complete() {&nbsp;</div></li><li><div>        $complete = true;&nbsp;</div></li><li><div>        foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>            if ( ! $this-&gt;is_plugin_active( $slug ) || false !== $this-&gt;does_plugin_have_update( $slug ) ) {&nbsp;</div></li><li><div>                $complete = false;&nbsp;</div></li><li><div>                break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $complete;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if a plugin is installed. Does not take must-use plugins into account.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return bool True if installed, false otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_plugin_installed( $slug ) {&nbsp;</div></li><li><div>        $installed_plugins = $this-&gt;get_plugins(); // Retrieve a list of all installed plugins (WP cached).&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return ( ! empty( $installed_plugins[ $this-&gt;plugins[ $slug ]['file_path'] ] ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if a plugin is active.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return bool True if active, false otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_plugin_active( $slug ) {&nbsp;</div></li><li><div>        return ( ( ! empty( $this-&gt;plugins[ $slug ]['is_callable'] ) && is_callable( $this-&gt;plugins[ $slug ]['is_callable'] ) ) || is_plugin_active( $this-&gt;plugins[ $slug ]['file_path'] ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if a plugin can be updated, i.e. if we have information on the minimum WP version required&nbsp;</div></li><li><div>     * available, check whether the current install meets them.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return bool True if OK to update, false otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function can_plugin_update( $slug ) {&nbsp;</div></li><li><div>        // We currently can't get reliable info on non-WP-repo plugins - issue #380.&nbsp;</div></li><li><div>        if ( 'repo' !== $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>            return true;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $api = $this-&gt;get_plugins_api( $slug );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false !== $api && isset( $api-&gt;requires ) ) {&nbsp;</div></li><li><div>            return version_compare( $this-&gt;wp_version, $api-&gt;requires, '&gt;=' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // No usable info received from the plugins API, presume we can update.&nbsp;</div></li><li><div>        return true;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check to see if the plugin is 'updatetable', i.e. installed, with an update available&nbsp;</div></li><li><div>     * and no WP version requirements blocking it.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.6.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return bool True if OK to proceed with update, false otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function is_plugin_updatetable( $slug ) {&nbsp;</div></li><li><div>        if ( ! $this-&gt;is_plugin_installed( $slug ) ) {&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            return ( false !== $this-&gt;does_plugin_have_update( $slug ) && $this-&gt;can_plugin_update( $slug ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check if a plugin can be activated, i.e. is not currently active and meets the minimum&nbsp;</div></li><li><div>     * plugin version requirements set in TGMPA (if any).&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return bool True if OK to activate, false otherwise.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function can_plugin_activate( $slug ) {&nbsp;</div></li><li><div>        return ( ! $this-&gt;is_plugin_active( $slug ) && ! $this-&gt;does_plugin_require_update( $slug ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve the version number of an installed plugin.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return string Version number as string or an empty string if the plugin is not installed&nbsp;</div></li><li><div>     *                or version unknown (plugins which don't comply with the plugin header standard).&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_installed_version( $slug ) {&nbsp;</div></li><li><div>        $installed_plugins = $this-&gt;get_plugins(); // Retrieve a list of all installed plugins (WP cached).&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $installed_plugins[ $this-&gt;plugins[ $slug ]['file_path'] ]['Version'] ) ) {&nbsp;</div></li><li><div>            return $installed_plugins[ $this-&gt;plugins[ $slug ]['file_path'] ]['Version'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return '';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check whether a plugin complies with the minimum version requirements.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return bool True when a plugin needs to be updated, otherwise false.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function does_plugin_require_update( $slug ) {&nbsp;</div></li><li><div>        $installed_version = $this-&gt;get_installed_version( $slug );&nbsp;</div></li><li><div>        $minimum_version = $this-&gt;plugins[ $slug ]['version'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return version_compare( $minimum_version, $installed_version, '&gt;' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Check whether there is an update available for a plugin.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return false|string Version number string of the available update or false if no update available.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function does_plugin_have_update( $slug ) {&nbsp;</div></li><li><div>        // Presume bundled and external plugins will point to a package which meets the minimum required version.&nbsp;</div></li><li><div>        if ( 'repo' !== $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>            if ( $this-&gt;does_plugin_require_update( $slug ) ) {&nbsp;</div></li><li><div>                return $this-&gt;plugins[ $slug ]['version'];&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $repo_updates = get_site_transient( 'update_plugins' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( isset( $repo_updates-&gt;response[ $this-&gt;plugins[ $slug ]['file_path'] ]-&gt;new_version ) ) {&nbsp;</div></li><li><div>            return $repo_updates-&gt;response[ $this-&gt;plugins[ $slug ]['file_path'] ]-&gt;new_version;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Retrieve potential upgrade notice for a plugin.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $slug Plugin slug.&nbsp;</div></li><li><div>     * @return string The upgrade notice or an empty string if no message was available or provided.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_upgrade_notice( $slug ) {&nbsp;</div></li><li><div>        // We currently can't get reliable info on non-WP-repo plugins - issue #380.&nbsp;</div></li><li><div>        if ( 'repo' !== $this-&gt;plugins[ $slug ]['source_type'] ) {&nbsp;</div></li><li><div>            return '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $repo_updates = get_site_transient( 'update_plugins' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $repo_updates-&gt;response[ $this-&gt;plugins[ $slug ]['file_path'] ]-&gt;upgrade_notice ) ) {&nbsp;</div></li><li><div>            return $repo_updates-&gt;response[ $this-&gt;plugins[ $slug ]['file_path'] ]-&gt;upgrade_notice;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return '';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Wrapper around the core WP get_plugins function, making sure it's actually available.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $plugin_folder Optional. Relative path to single plugin folder.&nbsp;</div></li><li><div>     * @return array Array of installed plugins with plugin information.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function get_plugins( $plugin_folder = '' ) {&nbsp;</div></li><li><div>        if ( ! function_exists( 'get_plugins' ) ) {&nbsp;</div></li><li><div>            require_once ABSPATH . 'wp-admin/includes/plugin.php';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return get_plugins( $plugin_folder );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Delete dismissable nag option when theme is switched.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This ensures that the user(s) is/are again reminded via nag of required&nbsp;</div></li><li><div>     * and/or recommended plugins if they re-activate the theme.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.1.1&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function update_dismiss() {&nbsp;</div></li><li><div>        delete_metadata( 'user', null, 'tgmpa_dismissed_notice_' . $this-&gt;id, null, true );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Forces plugin activation if the parameter 'force_activation' is&nbsp;</div></li><li><div>     * set to true.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This allows theme authors to specify certain plugins that must be&nbsp;</div></li><li><div>     * active at all times while using the current theme.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Please take special care when using this parameter as it has the&nbsp;</div></li><li><div>     * potential to be harmful if not used correctly. Setting this parameter&nbsp;</div></li><li><div>     * to true will not allow the specified plugin to be deactivated unless&nbsp;</div></li><li><div>     * the user switches themes.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function force_activation() {&nbsp;</div></li><li><div>        foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>            if ( true === $plugin['force_activation'] ) {&nbsp;</div></li><li><div>                if ( ! $this-&gt;is_plugin_installed( $slug ) ) {&nbsp;</div></li><li><div>                    // Oops, plugin isn't there so iterate to next condition.&nbsp;</div></li><li><div>                    continue;&nbsp;</div></li><li><div>                } elseif ( $this-&gt;can_plugin_activate( $slug ) ) {&nbsp;</div></li><li><div>                    // There we go, activate the plugin.&nbsp;</div></li><li><div>                    activate_plugin( $plugin['file_path'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Forces plugin deactivation if the parameter 'force_deactivation'&nbsp;</div></li><li><div>     * is set to true and adds the plugin to the 'recently active' plugins list.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * This allows theme authors to specify certain plugins that must be&nbsp;</div></li><li><div>     * deactivated upon switching from the current theme to another.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * Please take special care when using this parameter as it has the&nbsp;</div></li><li><div>     * potential to be harmful if not used correctly.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.2.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function force_deactivation() {&nbsp;</div></li><li><div>        $deactivated = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $this-&gt;plugins as $slug =&gt; $plugin ) {&nbsp;</div></li><li><div>            /**&nbsp;</div></li><li><div>             * Only proceed forward if the parameter is set to true and plugin is active&nbsp;</div></li><li><div>             * as a 'normal' (not must-use) plugin.&nbsp;</div></li><li><div>             */&nbsp;</div></li><li><div>            if ( true === $plugin['force_deactivation'] && is_plugin_active( $plugin['file_path'] ) ) {&nbsp;</div></li><li><div>                deactivate_plugins( $plugin['file_path'] );&nbsp;</div></li><li><div>                $deactivated[ $plugin['file_path'] ] = time();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! empty( $deactivated ) ) {&nbsp;</div></li><li><div>            update_option( 'recently_activated', $deactivated + (array) get_option( 'recently_activated' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Echo the current TGMPA version number to the page.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.5.0&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public function show_tgmpa_version() {&nbsp;</div></li><li><div>        echo '&lt;p style=&quot;float: right; padding: 0em 1.5em 0.5em 0;&quot;&gt;&lt;strong&gt;&lt;small&gt;', &nbsp;</div></li><li><div>            esc_html(&nbsp;</div></li><li><div>                sprintf(&nbsp;</div></li><li><div>                    /** translators: %s: version number */&nbsp;</div></li><li><div>                    __( 'TGMPA v%s', 'tgmpa' ), &nbsp;</div></li><li><div>                    self::TGMPA_VERSION&nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            '&lt;/small&gt;&lt;/strong&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Returns the singleton instance of the class.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @since 2.4.0&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return \TGM_Plugin_Activation The TGM_Plugin_Activation object.&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    public static function get_instance() {&nbsp;</div></li><li><div>        if ( ! isset( self::$instance ) && ! ( self::$instance instanceof self ) ) {&nbsp;</div></li><li><div>            self::$instance = new self();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return self::$instance;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.0.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.1/classes/tgm_plugin_activation/" class="active">4.0.1</a></li><li><a href="http://hookr.io/plugins/contact-form-7-signature-addon/4.0.0/classes/tgm_plugin_activation/" class="">4.0.0</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>TGM_Plugin_Activation</li><li><span></span>Contact Form 7 Signature Addon</li><li><span></span>4.0.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>