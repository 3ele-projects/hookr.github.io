<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="1.7.4" data-slug="advanced-custom-fields-validated-field" data-type="class" data-id="76417"><head xmlns="http://www.w3.org/1999/xhtml"><title> acf_field_validated_field | class | Advanced Custom Fields Validated Field | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="acf_field_validated_field, class, plugin, advanced-custom-fields-validated-field, 1.7.4" /><meta name="description" content="The Advanced Custom Fields: Validated Field acf field validated class." /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.16"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=e32659fbe8dfd4d4b8560b35667e08ce' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.16' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/acf_field_validated_field/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Facf_field_validated_field%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Facf_field_validated_field%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-advanced-custom-fields-validated-field-1.7.4-class-acf_field_validated_field","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="acf_field_validated_field" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to advanced-custom-fields-valida&hellip;." href="http://hookr.io/plugins/advanced-custom-fields-validated-field/" class="plugin"><span property="name">advanced-custom-fields-valida&hellip;</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 1.7.4." href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/" class="H_VERSION"><span property="name">1.7.4</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">acf_field_validated_field</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="42"><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/all/" title="All">All <span class="count badge">42</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="35"><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/hooks/" title="Hooks">Hooks <span class="count badge">35</span></a></li><li class="" data-id="action" data-count="13"><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/actions/" title="Actions">Actions <span class="count badge">13</span></a></li><li class="" data-id="filter" data-count="22"><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/filters/" title="Filters">Filters <span class="count badge">22</span></a></li><li class="active" data-id="class" data-count="2"><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/classes/" title="Classes">Classes <span class="count badge">2</span></a></li><li class="" data-id="constant" data-count="2"><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/constants/" title="Constants">Constants <span class="count badge">2</span></a></li><li class="" data-id="function" data-count="3"><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/functions/" title="Functions">Functions <span class="count badge">3</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>acf_field_validated_field</strong></h1><p>The Advanced Custom Fields: Validated Field <strong>acf field validated</strong> class.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(2)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/files/validated-field-v4/" class="file">/validated_field_v4.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="3" class="block" start="3"><li><div>class acf_field_validated_field extends acf_field {&nbsp;</div></li><li><div>    // vars&nbsp;</div></li><li><div>    var $slug, &nbsp;</div></li><li><div>        $config, &nbsp;</div></li><li><div>        $settings, // will hold info such as dir / path&nbsp;</div></li><li><div>        $defaults, // will hold default field options&nbsp;</div></li><li><div>        $sub_defaults, // will hold default sub field options&nbsp;</div></li><li><div>        $debug, // if true, don't use minified and confirm form submit                    &nbsp;</div></li><li><div>        $drafts, &nbsp;</div></li><li><div>        $frontend;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  __construct&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Set name / label needed for actions / filters&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function __construct() {&nbsp;</div></li><li><div>        // vars&nbsp;</div></li><li><div>        $this-&gt;slug = 'acf-validated-field';&nbsp;</div></li><li><div>        $this-&gt;strbool = array( 'true' =&gt; true, 'false' =&gt; false );&nbsp;</div></li><li><div>        $this-&gt;config = array(&nbsp;</div></li><li><div>            'acf_vf_debug' =&gt; array(&nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'false', &nbsp;</div></li><li><div>                'label' =&gt; __( 'Enable Debug', 'acf_vf' ), &nbsp;</div></li><li><div>                'help' =&gt; __( 'Check this box to turn on debugging for Validated Fields.', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'acf_vf_drafts' =&gt; array(&nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'true', &nbsp;</div></li><li><div>                'label' =&gt; __( 'Enable Draft Validation', 'acf_vf' ), &nbsp;</div></li><li><div>                'help' =&gt; __( 'Check this box to enable Draft validation globally, or uncheck to allow it to be set per field.', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'acf_vf_frontend' =&gt; array(&nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'false', &nbsp;</div></li><li><div>                'label' =&gt; __( 'Enable Front-End Validation', 'acf_vf' ), &nbsp;</div></li><li><div>                'help' =&gt; __( 'Check this box to turn on validation for front-end forms created with', 'acf_vf' ) . ' &lt;code&gt;acf_form()&lt;/code&gt;.', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'acf_vf_frontend_css' =&gt; array(&nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'true', &nbsp;</div></li><li><div>                'label' =&gt; __( 'Enqueue Admin CSS on Front-End', 'acf_vf' ), &nbsp;</div></li><li><div>                'help' =&gt; __( 'Uncheck this box to turn off &quot;colors-fresh&quot; admin theme enqueued by', 'acf_vf' ) . ' &lt;code&gt;acf_form_head()&lt;/code&gt;.', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;name = 'validated_field';&nbsp;</div></li><li><div>        $this-&gt;label = __( 'Validated Field', 'acf_vf' );&nbsp;</div></li><li><div>        $this-&gt;category = __( 'Basic', 'acf' );&nbsp;</div></li><li><div>        $this-&gt;drafts = $this-&gt;option_value( 'acf_vf_drafts' );&nbsp;</div></li><li><div>        $this-&gt;frontend = $this-&gt;option_value( 'acf_vf_frontend' );&nbsp;</div></li><li><div>        $this-&gt;frontend_css = $this-&gt;option_value( 'acf_vf_frontend_css' );&nbsp;</div></li><li><div>        $this-&gt;debug = $this-&gt;option_value( 'acf_vf_debug' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;defaults = array(&nbsp;</div></li><li><div>            'read_only' =&gt; false, &nbsp;</div></li><li><div>            'mask' =&gt; '', &nbsp;</div></li><li><div>            'function' =&gt; 'none', &nbsp;</div></li><li><div>            'pattern' =&gt; '', &nbsp;</div></li><li><div>            'message' =&gt;  __( 'Validation failed.', 'acf_vf' ), &nbsp;</div></li><li><div>            'unique' =&gt; 'non-unique', &nbsp;</div></li><li><div>            'unique_statuses' =&gt; apply_filters( 'acf_vf/unique_statuses', array( 'publish', 'future' ) ), &nbsp;</div></li><li><div>            'drafts' =&gt; true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;sub_defaults = array(&nbsp;</div></li><li><div>            'type' =&gt; '', &nbsp;</div></li><li><div>            'key' =&gt; '', &nbsp;</div></li><li><div>            'name' =&gt; '', &nbsp;</div></li><li><div>            '_name' =&gt; '', &nbsp;</div></li><li><div>            'id' =&gt; '', &nbsp;</div></li><li><div>            'value' =&gt; '', &nbsp;</div></li><li><div>            'field_group' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;input_defaults = array(&nbsp;</div></li><li><div>            'id' =&gt; '', &nbsp;</div></li><li><div>            'value' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // do not delete!&nbsp;</div></li><li><div>        parent::__construct();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // settings&nbsp;</div></li><li><div>        $this-&gt;settings = array(&nbsp;</div></li><li><div>            'path' =&gt; apply_filters( 'acf/helpers/get_path', __FILE__ ), &nbsp;</div></li><li><div>            'dir' =&gt; apply_filters( 'acf/helpers/get_dir', __FILE__ ), &nbsp;</div></li><li><div>            'version' =&gt; ACF_VF_VERSION, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_admin() || $this-&gt;frontend ) { // admin actions&nbsp;</div></li><li><div>            // ACF 5.0+ http://www.advancedcustomfields.com/resources/filters/acf-validate_value/&nbsp;</div></li><li><div>            add_action( 'wp_ajax_validate_fields', array( $this, 'ajax_validate_fields' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            add_action( $this-&gt;frontend? 'wp_head' : 'admin_head', array( $this, 'input_admin_head' ) );&nbsp;</div></li><li><div>            if ( ! is_admin() && $this-&gt;frontend ) {&nbsp;</div></li><li><div>                if ( ! $this-&gt;frontend_css ) {&nbsp;</div></li><li><div>                    add_action( 'acf/input/admin_enqueue_scripts', array( $this, 'remove_acf_form_style' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                add_action( 'wp_ajax_nopriv_validate_fields', array( $this, 'ajax_validate_fields' ) );&nbsp;</div></li><li><div>                add_action( 'wp_head', array( $this, 'ajaxurl' ), 1 );&nbsp;</div></li><li><div>                add_action( 'wp_head', array( $this, 'input_admin_enqueue_scripts' ), 1 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( is_admin() ) {&nbsp;</div></li><li><div>                add_action( 'admin_init', array( $this, 'admin_register_settings' ) );&nbsp;</div></li><li><div>                add_action( 'admin_menu', array( $this, 'admin_add_menu' ), 11 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function option_value( $key ) {&nbsp;</div></li><li><div>        return ( false !== $option = get_option( $key ) )?&nbsp;</div></li><li><div>            $option == $this-&gt;config[$key]['default'] :&nbsp;</div></li><li><div>            $this-&gt;strbool[$this-&gt;config[$key]['default']];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function ajaxurl() {&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;script type=&quot;text/javascript&quot;&gt;var ajaxurl = '&lt;?php echo admin_url('admin-ajax.php'); ?&gt;';&lt;/script&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_add_menu() {&nbsp;</div></li><li><div>        $page = add_submenu_page( 'edit.php?post_type=acf', __( 'Validated Field Settings', 'acf_vf' ), __( 'Validated Field Settings', 'acf_vf' ), 'manage_options', $this-&gt;slug, array( &$this, 'admin_settings_page' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_register_settings() {&nbsp;</div></li><li><div>        foreach ( $this-&gt;config as $key =&gt; $value ) {&nbsp;</div></li><li><div>            register_setting( $this-&gt;slug, $key );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_settings_page() {&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>        &lt;h2&gt;Validated Field Settings&lt;/h2&gt;&nbsp;</div></li><li><div>        &lt;form method=&quot;post&quot; action=&quot;options.php&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php settings_fields( $this-&gt;slug ); ?&gt;&nbsp;</div></li><li><div>            &lt;?php do_settings_sections( $this-&gt;slug ); ?&gt;&nbsp;</div></li><li><div>            &lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php foreach ( $this-&gt;config as $key =&gt; $value ) { ?&gt;&nbsp;</div></li><li><div>                &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&lt;?php echo $value['label']; ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td&gt;&nbsp;</div></li><li><div>                        &lt;input type=&quot;checkbox&quot; id=&quot;&lt;?php echo $key; ?&gt;&quot; name=&quot;&lt;?php echo $key; ?&gt;&quot; value=&quot;&lt;?php echo $value['default']; ?&gt;&quot; &lt;?php if ( $this-&gt;option_value( $key ) ) echo 'checked'; ?&gt;/&gt;&nbsp;</div></li><li><div>                        &lt;small&gt;&lt;em&gt;&lt;?php echo $value['help']; ?&gt;&lt;/em&gt;&lt;/small&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>            &lt;?php } ?&gt;&nbsp;</div></li><li><div>            &lt;/table&gt;&nbsp;</div></li><li><div>            &lt;?php submit_button(); ?&gt;&nbsp;</div></li><li><div>        &lt;/form&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function remove_acf_form_style() {&nbsp;</div></li><li><div>        wp_dequeue_style( array( 'colors-fresh' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setup_field( $field ) {&nbsp;</div></li><li><div>        // setup booleans, for compatibility&nbsp;</div></li><li><div>        $field['read_only'] = ( false == $field['read_only'] || 'false' === $field['read_only'] )? false : true;&nbsp;</div></li><li><div>        $field['drafts'] = ( false == $field['drafts'] || 'false' === $field['drafts'] )? false : true;&nbsp;</div></li><li><div>        $field =  array_merge( $this-&gt;defaults, $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sub_field = isset( $field['sub_field'] )? &nbsp;</div></li><li><div>            $field['sub_field'] :    // already set up&nbsp;</div></li><li><div>            array();                // create it&nbsp;</div></li><li><div>        // mask the sub field as the parent by giving it the same key values&nbsp;</div></li><li><div>        foreach( array( 'key', 'name', '_name', 'id', 'value', 'field_group' ) as $key ) {&nbsp;</div></li><li><div>            $sub_field[$key] = isset( $field[$key] )? $field[$key] : '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field['sub_field'] = array_merge( $this-&gt;sub_defaults, $sub_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setup_sub_field( $field ) {&nbsp;</div></li><li><div>        return $field['sub_field'];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  get_post_statuses()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Get the various post statuses that have been registered&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type        function&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function get_post_statuses() {&nbsp;</div></li><li><div>        global $wp_post_statuses;&nbsp;</div></li><li><div>        return $wp_post_statuses;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  ajax_validate_fields()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Parse the input when a page is submitted to determine if it is valid or not.&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type        ajax action&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function ajax_validate_fields() {&nbsp;</div></li><li><div>        $post_id = isset( $_REQUEST['post_id'] )?                // the submitted post_id&nbsp;</div></li><li><div>            $_REQUEST['post_id'] : &nbsp;</div></li><li><div>            0;&nbsp;</div></li><li><div>        $post_type = get_post_type( $post_id );                    // the type of the submitted post&nbsp;</div></li><li><div>        $frontend = isset( $_REQUEST['frontend'] )?&nbsp;</div></li><li><div>            $_REQUEST['frontend'] :&nbsp;</div></li><li><div>            false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $click_id =  isset( $_REQUEST['click_id'] )?             // the ID of the clicked element, for drafts/publish&nbsp;</div></li><li><div>            $_REQUEST['click_id'] : &nbsp;</div></li><li><div>            'publish';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // the validated field inputs to process&nbsp;</div></li><li><div>        $inputs = ( isset( $_REQUEST['fields'] ) && is_array( $_REQUEST['fields'] ) )? &nbsp;</div></li><li><div>            $_REQUEST['fields'] : &nbsp;</div></li><li><div>            array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        header( 'HTTP/1.1 200 OK' );                            // be positive!&nbsp;</div></li><li><div>        header( 'Content-Type: application/json; charset=' . get_option( 'blog_charset' ) );&nbsp;</div></li><li><div>        $return_fields = array();                                // JSON response to the client&nbsp;</div></li><li><div>        foreach ( $inputs as $i=&gt;$input ) {                        // loop through each field&nbsp;</div></li><li><div>            // input defaults&nbsp;</div></li><li><div>            $input = array_merge( $this-&gt;input_defaults, $input );&nbsp;</div></li><li><div>            $valid = true;                                        // wait for a any test to fail&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // extract the field key&nbsp;</div></li><li><div>            preg_match( '/\\[([^\\]]*?)\\](\\[(\d*?)\\]\\[([^\\]]*?)\\])?/', $input['id'], $matches );&nbsp;</div></li><li><div>            $key = isset( $matches[1] )? $matches[1] : false;    // the key for this ACF&nbsp;</div></li><li><div>            $index = isset( $matches[3] )? $matches[3] : false;    // the field index, if it is a repeater&nbsp;</div></li><li><div>            $sub_key = isset( $matches[4] )? $matches[4] : false; // the key for the sub field, if it is a repeater&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // load the field config, set defaults&nbsp;</div></li><li><div>            $field = $this-&gt;setup_field( get_field_object( $key, $post_id ) );&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            // if it's a repeater field, get the validated field so we can do meta queries...&nbsp;</div></li><li><div>            if ( $is_repeater = ( 'repeater' == $field['type'] && $index ) ) {&nbsp;</div></li><li><div>                foreach ( $field['sub_fields'] as $repeater ) {&nbsp;</div></li><li><div>                    $repeater = $this-&gt;setup_field( $repeater );&nbsp;</div></li><li><div>                    $sub_field = $this-&gt;setup_sub_field( $repeater );&nbsp;</div></li><li><div>                    if ( $sub_key == $sub_field['key'] ) {&nbsp;</div></li><li><div>                        $parent_field = $field;                    // we are going to map down a level, but track the top level field&nbsp;</div></li><li><div>                        $field = $repeater;                        // the '$field' should be the Validated Field&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $sub_field = false;                            // in case it isn't the right one&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // the wrapped field&nbsp;</div></li><li><div>                $sub_field = $this-&gt;setup_sub_field( $field );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $value = $input['value'];                            // the submitted value&nbsp;</div></li><li><div>            if ( $field['required'] && empty( $value ) ) {&nbsp;</div></li><li><div>                continue;                                        // let the required field handle it&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $click_id != 'publish' && !$field['drafts'] ) {&nbsp;</div></li><li><div>                continue;                                        // we aren't publishing and we don't want to validate drafts&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            $function = $field['function'];                        // what type of validation?&nbsp;</div></li><li><div>            $pattern = $field['pattern'];                        // string to use for validation&nbsp;</div></li><li><div>            $message = $field['message'];                        // failure message to return to the UI&nbsp;</div></li><li><div>            if ( ! empty( $function ) && ! empty( $pattern ) ) {&nbsp;</div></li><li><div>                switch ( $function ) {                            // only run these checks if we have a pattern&nbsp;</div></li><li><div>                    case 'regex':                                // check for any matches to the regular expression&nbsp;</div></li><li><div>                        $pattern_fltr = '/' . str_replace( &quot;/&quot;, &quot;\/&quot;, $pattern ) . '/';&nbsp;</div></li><li><div>                        if ( ! preg_match( $pattern_fltr, $value ) ) {&nbsp;</div></li><li><div>                            $valid = false;                        // return false if there are no matches&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'sql':                                    // todo: sql checks?&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'php':                                    // this code is a little tricky, one bad eval() can break the lot. needs a nonce.&nbsp;</div></li><li><div>                        $this_key = $field['name'];&nbsp;</div></li><li><div>                        if ( $is_repeater ) $this_key .= '_' . $index . '_' . $sub_sub_field['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // get the fields based on the keys and then index by the meta value for easy of use&nbsp;</div></li><li><div>                        $input_fields = array();&nbsp;</div></li><li><div>                        foreach ( $input_fields as $key =&gt; $val ) {&nbsp;</div></li><li><div>                            if ( $false !== ( $input_field = get_field_object( $key, $post_id ) ) ) {&nbsp;</div></li><li><div>                                $meta_key = $input_field['name'];&nbsp;</div></li><li><div>                                $input_fields[$meta_key] = array(&nbsp;</div></li><li><div>                                    'field'=&gt;$input_field, &nbsp;</div></li><li><div>                                    'value'=&gt;$val, &nbsp;</div></li><li><div>                                    'prev_val'=&gt;get_post_meta( $post_id, $meta_key, true )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // it gets tricky but we are trying to account for an capture bad php code where possible&nbsp;</div></li><li><div>                        $pattern = addcslashes( trim( $pattern ), &quot;'&quot; );&nbsp;</div></li><li><div>                        if ( substr( $pattern, -1 ) != ';' ) $pattern.= ';';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $value = addslashes( $value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $prev_value = addslashes( $prev_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        $function_name = 'validate_' . preg_replace( '~[\\[\\]]+~', '_', $input['id'] ) . 'function';&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>                    $php = &lt;&lt;&lt;PHP&nbsp;</div></li><li><div>if ( ! function_exists( '$function_name' ) ):&nbsp;</div></li><li><div>function $function_name( \$args, &\$message ) {&nbsp;</div></li><li><div>    extract( \$args );&nbsp;</div></li><li><div>    try {&nbsp;</div></li><li><div>        \$code = '$pattern return true;';&nbsp;</div></li><li><div>        return eval( \$code );&nbsp;</div></li><li><div>    } catch ( Exception \$e ) {&nbsp;</div></li><li><div>        \$message = &quot;Error: &quot;.\$e-&gt;getMessage(); return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif; // function_exists&nbsp;</div></li><li><div>\$valid = $function_name( array( 'post_id'=&gt;'$post_id', 'post_type'=&gt;'$post_type', 'this_key'=&gt;'$this_key', 'value'=&gt;'$value', 'prev_value'=&gt;'$prev_value', 'inputs'=&gt;\$input_fields ), \$message );&nbsp;</div></li><li><div>PHP;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // it gets tricky but we are trying to account for an capture bad php code where possible&nbsp;</div></li><li><div>                        $pattern = trim( $pattern );&nbsp;</div></li><li><div>                        if ( substr( $pattern, -1 ) != ';' ) $pattern.= ';';&nbsp;</div></li><li><div>                        $php = 'function '.$function_name.'( $post_id, $post_type, $name, $value, $prev_value, $inputs, &$message ) { '.&quot;\n&quot;;&nbsp;</div></li><li><div>                        $php.= '    try { '.&quot;\n&quot;;&nbsp;</div></li><li><div>                        $php.= '        $code = \'' . str_replace(&quot;'&quot;, &quot;\'&quot;, $pattern . ' return true;' ) . '\';'.&quot;\n&quot;;&nbsp;</div></li><li><div>                        $php.= '        return eval( $code ); '.&quot;\n&quot;;&nbsp;</div></li><li><div>                        $php.= '    } catch ( Exception $e ) { '.&quot;\n&quot;;&nbsp;</div></li><li><div>                        $php.= '        $message = &quot;Error: &quot;.$e-&gt;getMessage(); return false; '.&quot;\n&quot;;&nbsp;</div></li><li><div>                        $php.= '    } '.&quot;\n&quot;;&nbsp;</div></li><li><div>                        $php.= '} '.&quot;\n&quot;;&nbsp;</div></li><li><div>                        $php.= '$valid = '.$function_name.'( &quot;'.$post_id.'&quot;, &quot;'.$post_type.'&quot;, &quot;'.$this_key.'&quot;, &quot;'.addslashes( $value ).'&quot;, &quot;'.addslashes( $prev_value ).'&quot;, $inputs, $message );'.&quot;\n&quot;;&nbsp;</div></li><li><div>                        &nbsp;</div></li><li><div>                        if ( true !== eval( $php ) ) {            // run the eval() in the eval()&nbsp;</div></li><li><div>                            $error = error_get_last();            // get the error from the eval() on failure&nbsp;</div></li><li><div>                            // check to see if this is our error or not.&nbsp;</div></li><li><div>                            if ( strpos( $error['file'], &quot;validated_field_v4.php&quot; ) && strpos( $error['file'], &quot;eval()'d code&quot; ) ) {&nbsp;</div></li><li><div>                                preg_match( '/eval\\(\\)\'d code\\((\d+)\\)/', $error['file'], $matches );&nbsp;</div></li><li><div>                                $message = __( 'PHP Error', 'acf_vf' ) . ': ' . $error['message'] . ', line ' . $matches[1] . '.';&nbsp;</div></li><li><div>                                $valid = false;&nbsp;</div></li><li><div>                            } &nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        // if a string is returned, return it as the error.&nbsp;</div></li><li><div>                        if ( is_string( $valid ) ) {&nbsp;</div></li><li><div>                            $message = $valid;&nbsp;</div></li><li><div>                            $valid = false;&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            } elseif ( ! empty( $function ) && $function != 'none' ) {&nbsp;</div></li><li><div>                $message = __( 'This field\'s validation is not properly configured.', 'acf_vf' );&nbsp;</div></li><li><div>                $valid = false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>                &nbsp;</div></li><li><div>            $unique = $field['unique'];&nbsp;</div></li><li><div>            if ( $valid && ! empty( $value ) && ! empty( $unique ) && $unique != 'non-unique' ) {&nbsp;</div></li><li><div>                global $wpdb;&nbsp;</div></li><li><div>                $status_in = &quot;'&quot; . implode( &quot;', '&quot;, $field['unique_statuses'] ) . &quot;'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // WPML compatibility, get code list of active languages&nbsp;</div></li><li><div>                if ( function_exists( 'icl_object_id' ) ) {&nbsp;</div></li><li><div>                    $languages = $wpdb-&gt;get_results( &quot;SELECT code FROM {$wpdb-&gt;prefix}icl_languages WHERE active = 1&quot;, ARRAY_A );&nbsp;</div></li><li><div>                    $wpml_ids = array();&nbsp;</div></li><li><div>                    foreach( $languages as $lang ) {&nbsp;</div></li><li><div>                        $wpml_ids[] = (int) icl_object_id( $post_id, $post_type, true, $lang['code'] );&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $post_ids = array_unique( $wpml_ids );&nbsp;</div></li><li><div>                } else {&nbsp;</div></li><li><div>                    $post_ids = array( (int) $post_id );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $sql_prefix = &quot;SELECT pm.meta_id AS meta_id, pm.post_id AS post_id, p.post_title AS post_title FROM {$wpdb-&gt;postmeta} pm JOIN {$wpdb-&gt;posts} p ON p.ID = pm.post_id AND p.post_status IN ($status_in)&quot;;&nbsp;</div></li><li><div>                switch ( $unique ) {&nbsp;</div></li><li><div>                    case 'global': &nbsp;</div></li><li><div>                        // check to see if this value exists anywhere in the postmeta table&nbsp;</div></li><li><div>                        $sql = $wpdb-&gt;prepare( &nbsp;</div></li><li><div>                            &quot;{$sql_prefix} AND post_id NOT IN ([NOT_IN]) WHERE ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                            $value, &nbsp;</div></li><li><div>                            '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'post_type':&nbsp;</div></li><li><div>                        // check to see if this value exists in the postmeta table with this $post_id&nbsp;</div></li><li><div>                        $sql = $wpdb-&gt;prepare( &nbsp;</div></li><li><div>                            &quot;{$sql_prefix} AND p.post_type = %s AND post_id NOT IN ([NOT_IN]) WHERE ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                            $post_type, &nbsp;</div></li><li><div>                            $value, &nbsp;</div></li><li><div>                            '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    case 'post_key':&nbsp;</div></li><li><div>                        // check to see if this value exists in the postmeta table with both this $post_id and $meta_key&nbsp;</div></li><li><div>                        if ( $is_repeater ) {&nbsp;</div></li><li><div>                            $this_key = $parent_field['name'] . '_' . $index . '_' . $field['name'];&nbsp;</div></li><li><div>                            $meta_key = $parent_field['name'] . '_%_' . $field['name'];&nbsp;</div></li><li><div>                            $sql = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                                &quot;{$sql_prefix} AND p.post_type = %s WHERE ( ( post_id NOT IN ([NOT_IN]) AND meta_key != %s AND meta_key LIKE %s ) OR ( post_id NOT IN ([NOT_IN]) AND meta_key LIKE %s ) ) AND ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                                $post_type, &nbsp;</div></li><li><div>                                $this_key, &nbsp;</div></li><li><div>                                $meta_key, &nbsp;</div></li><li><div>                                $meta_key, &nbsp;</div></li><li><div>                                $value, &nbsp;</div></li><li><div>                                '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $sql = $wpdb-&gt;prepare( &nbsp;</div></li><li><div>                                &quot;{$sql_prefix} AND p.post_type = %s AND post_id NOT IN ([NOT_IN]) WHERE meta_key = %s AND ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                                $post_type, &nbsp;</div></li><li><div>                                $field['name'], &nbsp;</div></li><li><div>                                $value, &nbsp;</div></li><li><div>                                '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                    default:&nbsp;</div></li><li><div>                        // no dice, set $sql to null&nbsp;</div></li><li><div>                        $sql = null;&nbsp;</div></li><li><div>                        break;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Only run if we hit a condition above&nbsp;</div></li><li><div>                if ( ! empty( $sql ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Update the [NOT_IN] values&nbsp;</div></li><li><div>                    $sql = $this-&gt;prepare_not_in( $sql, $post_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // Execute the SQL&nbsp;</div></li><li><div>                    $rows = $wpdb-&gt;get_results( $sql );&nbsp;</div></li><li><div>                    if ( count( $rows ) ) {&nbsp;</div></li><li><div>                        // We got some matches, but there might be more than one so we need to concatenate the collisions&nbsp;</div></li><li><div>                        $conflicts = &quot;&quot;;&nbsp;</div></li><li><div>                        foreach ( $rows as $row ) {&nbsp;</div></li><li><div>                            $permalink = ( $frontend )? get_permalink( $row-&gt;post_id ) : &quot;/wp-admin/post.php?post={$row-&gt;post_id}&action=edit&quot;;&nbsp;</div></li><li><div>                            $conflicts.= &quot;&lt;a href='{$permalink}' style='color:inherit;text-decoration:underline;'&gt;{$row-&gt;post_title}&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>                            if ( $row !== end( $rows ) ) $conflicts.= ', ';&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        $message = __( 'The value', 'acf_vf' ) . &quot; '$value' &quot; . __( 'is already in use by', 'acf_vf' ) . &quot; {$conflicts}.&quot;;&nbsp;</div></li><li><div>                        $valid = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $return_fields[] = array(&nbsp;</div></li><li><div>                'id' =&gt; $input['id'], &nbsp;</div></li><li><div>                'message' =&gt; true === $valid? '' : ! empty( $message )? htmlentities( $message, ENT_NOQUOTES, 'UTF-8' ) : __( 'Validation failed.', 'acf_vf' ), &nbsp;</div></li><li><div>                'valid' =&gt; $valid, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // Send the results back to the browser as JSON&nbsp;</div></li><li><div>        echo json_encode( $return_fields, $this-&gt;debug? JSON_PRETTY_PRINT : 0 );&nbsp;</div></li><li><div>        die();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function prepare_not_in( $sql, $post_ids ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $not_in_count = substr_count( $sql, '[NOT_IN]' );&nbsp;</div></li><li><div>        if ( $not_in_count &gt; 0 ) {&nbsp;</div></li><li><div>            $args = array( str_replace( '[NOT_IN]', implode( ', ', array_fill( 0, count( $post_ids ), '%d' ) ), str_replace( '%', '%%', $sql ) ) );&nbsp;</div></li><li><div>            for ( $i=0; $i &lt; substr_count( $sql, '[NOT_IN]' ); $i++ ) { &nbsp;</div></li><li><div>                $args = array_merge( $args, $post_ids );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $sql = call_user_func_array( array( $wpdb, 'prepare' ), $args );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $sql;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  create_options()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Create extra options for your field. This is rendered when editing a field.&nbsp;</div></li><li><div>    *  The value of $field['name'] can be used (like below) to save extra data to the $field&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $field    - an array holding all the field's data&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function create_options( $field ) {&nbsp;</div></li><li><div>        // defaults?&nbsp;</div></li><li><div>        $field = $this-&gt;setup_field( $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // key is needed in the field names to correctly save the data&nbsp;</div></li><li><div>        $key = $field['name'];&nbsp;</div></li><li><div>        $html_key = preg_replace( '~[\\[\\]]+~', '_', $key );&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $field );&nbsp;</div></li><li><div>        $sub_field['name'] = $key . '][sub_field';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get all of the registered fields for the sub type drop down&nbsp;</div></li><li><div>        $fields_names = apply_filters( 'acf/registered_fields', array() );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // remove types that don't jive well with this one&nbsp;</div></li><li><div>        unset( $fields_names[__( 'Layout', 'acf' )] );&nbsp;</div></li><li><div>        unset( $fields_names[__( 'Basic', 'acf' )][ 'validated_field' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;field_option field_option_&lt;?php echo $this-&gt;name; ?&gt; field_option_&lt;?php echo $this-&gt;name; ?&gt;_readonly&quot; id=&quot;field_option_&lt;?php echo $html_key; ?&gt;_readonly&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;label&quot;&gt;&lt;label&gt;&lt;?php _e( 'Read Only?', 'acf_vf' ); ?&gt; &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&lt;?php &nbsp;</div></li><li><div>            do_action( 'acf/create_field', array(&nbsp;</div></li><li><div>                'type' =&gt; 'radio', &nbsp;</div></li><li><div>                'name' =&gt; 'fields['.$key.'][read_only]', &nbsp;</div></li><li><div>                'value' =&gt; ( false == $field['read_only'] || 'false' === $field['read_only'] )? 'false' : 'true', &nbsp;</div></li><li><div>                'choices' =&gt; array(&nbsp;</div></li><li><div>                    'true' =&gt; __( 'Yes', 'acf_vf' ), &nbsp;</div></li><li><div>                    'false' =&gt; __( 'No', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'class' =&gt; 'horizontal'&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;field_option field_option_&lt;?php echo $this-&gt;name; ?&gt; field_option_&lt;?php echo $this-&gt;name; ?&gt;_readonly&quot; id=&quot;field_option_&lt;?php echo $html_key; ?&gt;_drafts&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;label&quot;&gt;&lt;label&gt;&lt;?php _e( 'Validate Drafts/Preview?', 'acf_vf' ); ?&gt; &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&lt;?php &nbsp;</div></li><li><div>            do_action( 'acf/create_field', array(&nbsp;</div></li><li><div>                'type' =&gt; 'radio', &nbsp;</div></li><li><div>                'name' =&gt; 'fields['.$key.'][drafts]', &nbsp;</div></li><li><div>                'value' =&gt; ( false == $field['drafts'] || 'false' === $field['drafts'] )? 'false' : 'true', &nbsp;</div></li><li><div>                'choices' =&gt; array(&nbsp;</div></li><li><div>                    'true' =&gt; __( 'Yes', 'acf_vf' ), &nbsp;</div></li><li><div>                    'false' =&gt; __( 'No', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                'class' =&gt; 'horizontal'&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! $this-&gt;drafts ) {&nbsp;</div></li><li><div>                echo '&lt;em&gt;';&nbsp;</div></li><li><div>                _e( 'Warning', 'acf_vf' );&nbsp;</div></li><li><div>                echo ': &lt;code&gt;ACF_VF_DRAFTS&lt;/code&gt; ';&nbsp;</div></li><li><div>                _e( 'has been set to &lt;code&gt;false&lt;/code&gt; which overrides field level configurations', 'acf_vf' );&nbsp;</div></li><li><div>                echo '.&lt;/em&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;field_option field_option_&lt;?php echo $this-&gt;name; ?&gt;&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;label&quot;&gt;&lt;label&gt;&lt;?php _e( 'Validated Field', 'acf_vf' ); ?&gt; &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>            &lt;/script&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;sub-field&quot;&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;fields&quot;&gt;&nbsp;</div></li><li><div>                        &lt;div class=&quot;field sub_field acf-sub_field&quot;&gt;&nbsp;</div></li><li><div>                            &lt;div class=&quot;field_form&quot;&gt;&nbsp;</div></li><li><div>                                &lt;table class=&quot;acf_input widefat&quot;&gt;&nbsp;</div></li><li><div>                                    &lt;tbody&gt;&nbsp;</div></li><li><div>                                        &lt;tr class=&quot;field_type&quot;&gt;&nbsp;</div></li><li><div>                                            &lt;td class=&quot;label&quot;&gt;&lt;label&gt;&lt;span class=&quot;required&quot;&gt;*&lt;/span&gt; &lt;?php _e( 'Field Type', 'acf' ); ?&gt;&nbsp;</div></li><li><div>                                            &lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                                            &lt;td&gt;&lt;?php&nbsp;</div></li><li><div>                                            // Create the drop down of field types&nbsp;</div></li><li><div>                                            do_action( 'acf/create_field', array(&nbsp;</div></li><li><div>                                                'type' =&gt; 'select', &nbsp;</div></li><li><div>                                                'name' =&gt; 'fields[' . $key . '][sub_field][type]', &nbsp;</div></li><li><div>                                                'value' =&gt; $sub_field['type'], &nbsp;</div></li><li><div>                                                'class' =&gt; 'type', &nbsp;</div></li><li><div>                                                'choices' =&gt; $fields_names&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                                            // Create the default sub field settings&nbsp;</div></li><li><div>                                            do_action( 'acf/create_field_options', $sub_field );&nbsp;</div></li><li><div>                                            ?&gt;&nbsp;</div></li><li><div>                                            &lt;/td&gt;&nbsp;</div></li><li><div>                                        &lt;/tr&gt;&nbsp;</div></li><li><div>                                        &lt;tr class=&quot;field_save&quot;&gt;&nbsp;</div></li><li><div>                                            &lt;td class=&quot;label&quot;&gt;&nbsp;</div></li><li><div>                                            &lt;/td&gt;&nbsp;</div></li><li><div>                                            &lt;td&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                                        &lt;/tr&gt;&nbsp;</div></li><li><div>                                    &lt;/tbody&gt;&nbsp;</div></li><li><div>                                &lt;/table&gt;&nbsp;</div></li><li><div>                            &lt;/div&gt;&nbsp;</div></li><li><div>                            &lt;!-- End Form --&gt;&nbsp;</div></li><li><div>                        &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;field_option field_option_&lt;?php echo $this-&gt;name; ?&gt; non_read_only&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;label&quot;&gt;&lt;label&gt;&lt;?php _e( 'Input Mask', 'acf_vf' ); ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&lt;?php _e( 'Use &#39;a&#39; to match A-Za-z, &#39;9&#39; to match 0-9, and &#39;*&#39; to match any alphanumeric.', 'acf_vf' ); ?&gt; &nbsp;</div></li><li><div>                &lt;a href=&quot;http://digitalbush.com/projects/masked-input-plugin/&quot; target=&quot;_new&quot;&gt;&lt;?php _e( 'More info', 'acf_vf' ); ?&gt;&lt;/a&gt;.&nbsp;</div></li><li><div>                &lt;?php &nbsp;</div></li><li><div>                do_action( 'acf/create_field', &nbsp;</div></li><li><div>                    array(&nbsp;</div></li><li><div>                        'type' =&gt; 'text', &nbsp;</div></li><li><div>                        'name' =&gt; 'fields[' . $key . '][mask]', &nbsp;</div></li><li><div>                        'value' =&gt; $field['mask'], &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                ?&gt;&lt;br /&gt;&nbsp;</div></li><li><div>                &lt;strong&gt;&lt;?php __( 'Input masking is not compatible with the &quot;number&quot; field type!', 'acf_vf' ); ?&gt;&lt;/strong&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;field_option field_option_&lt;?php echo $this-&gt;name; ?&gt; non_read_only&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;label&quot;&gt;&lt;label&gt;&lt;?php _e( 'Validation Function', 'acf_vf' ); ?&gt;&lt;/label&gt;&lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&lt;?php _e( &quot;How should the field be server side validated?&quot;, 'acf_vf' ); ?&gt;&lt;br /&gt;&nbsp;</div></li><li><div>                &lt;?php &nbsp;</div></li><li><div>                do_action( 'acf/create_field', &nbsp;</div></li><li><div>                    array(&nbsp;</div></li><li><div>                        'type' =&gt; 'select', &nbsp;</div></li><li><div>                        'name' =&gt; 'fields[' . $key . '][function]', &nbsp;</div></li><li><div>                        'value' =&gt; $field['function'], &nbsp;</div></li><li><div>                        'choices' =&gt; array(&nbsp;</div></li><li><div>                            'none' =&gt; __( 'None', 'acf_vf' ), &nbsp;</div></li><li><div>                            'regex' =&gt; __( 'Regular Expression', 'acf_vf' ), &nbsp;</div></li><li><div>                            //'sql' =&gt; __( 'SQL Query', 'acf_vf' ), &nbsp;</div></li><li><div>                            'php' =&gt; __( 'PHP Statement', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                        'optgroup' =&gt; true, &nbsp;</div></li><li><div>                        'multiple' =&gt; '0', &nbsp;</div></li><li><div>                        'class' =&gt; 'validated_select', &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;field_option field_option_&lt;?php echo $this-&gt;name; ?&gt; field_option_&lt;?php echo $this-&gt;name; ?&gt;_validation non_read_only&quot; id=&quot;field_option_&lt;?php echo $html_key; ?&gt;_validation&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;label&quot;&gt;&lt;label&gt;&lt;?php _e( 'Validation Pattern', 'acf_vf' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;validated-&lt;?php echo $html_key; ?&gt;-info&quot;&gt;&nbsp;</div></li><li><div>                    &lt;div class='validation-type regex'&gt;&nbsp;</div></li><li><div>                        &lt;?php _e( 'Pattern match the input using', 'acf_vf' ); ?&gt; &lt;a href=&quot;http://php.net/manual/en/function.preg-match.php&quot; target=&quot;_new&quot;&gt;PHP preg_match()&lt;/a&gt;.&nbsp;</div></li><li><div>                        &lt;br /&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class='validation-type php'&gt;&nbsp;</div></li><li><div>                        &lt;ul&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;&lt;?php _e( &quot;Use any PHP code and return true or false. If nothing is returned it will evaluate to true.&quot;, 'acf_vf' ); ?&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;&lt;?php _e( 'Available variables', 'acf_vf' ); ?&gt; - &lt;b&gt;$post_id&lt;/b&gt;, &lt;b&gt;$post_type&lt;/b&gt;, &lt;b&gt;$name&lt;/b&gt;, &lt;b&gt;$value&lt;/b&gt;, &lt;b&gt;$prev_value&lt;/b&gt;, &lt;b&gt;&amp;$message&lt;/b&gt; (&lt;?php _e('returned to UI', 'acf_vf' ); ?&gt;).&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;&lt;?php _e( 'Example', 'acf_vf' ); ?&gt;: &lt;code&gt;if ( empty( $value ) ) { $message = sprint_f( $message, get_current_user()-&gt;user_login ); return false; }&lt;/code&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                        &lt;/ul&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class='validation-type sql'&gt;&nbsp;</div></li><li><div>                        &lt;?php _e( 'SQL', 'acf_vf' ); ?&gt;.&nbsp;</div></li><li><div>                        &lt;br /&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt; &nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                do_action( 'acf/create_field', array(&nbsp;</div></li><li><div>                    'type' =&gt; 'textarea', &nbsp;</div></li><li><div>                    'name' =&gt; 'fields['.$key.'][pattern]', &nbsp;</div></li><li><div>                    'value' =&gt; $field['pattern'], &nbsp;</div></li><li><div>                    'class' =&gt; 'editor'                     &nbsp;</div></li><li><div> )); &nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;acf-field-&lt;?php echo $html_key; ?&gt;_editor&quot; style=&quot;height:200px;&quot;&gt;&lt;?php echo $field['pattern']; ?&gt;&lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;field_option field_option_&lt;?php echo $this-&gt;name; ?&gt; field_option_&lt;?php echo $this-&gt;name; ?&gt;_message non_read_only&quot; id=&quot;field_option_&lt;?php echo $html_key; ?&gt;_message&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;label&quot;&gt;&lt;label&gt;&lt;?php _e( 'Error Message', 'acf_vf' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&lt;?php &nbsp;</div></li><li><div>            do_action( 'acf/create_field', &nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'type' =&gt; 'text', &nbsp;</div></li><li><div>                    'name' =&gt; 'fields['.$key.'][message]', &nbsp;</div></li><li><div>                    'value' =&gt; $field['message'], &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ); &nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;field_option field_option_&lt;?php echo $this-&gt;name; ?&gt; non_read_only&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;label&quot;&gt;&lt;label&gt;&lt;?php _e( 'Unique Value?', 'acf_vf' ); ?&gt; &lt;/label&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td&gt;&nbsp;</div></li><li><div>            &lt;div id=&quot;validated-&lt;?php echo $html_key; ?&gt;-unique&quot;&gt;&nbsp;</div></li><li><div>            &lt;p&gt;&lt;?php _e( 'Make sure this value is unique for...', 'acf_vf' ); ?&gt;&lt;br/&gt;&nbsp;</div></li><li><div>            &lt;?php &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            do_action( 'acf/create_field', &nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'type' =&gt; 'select', &nbsp;</div></li><li><div>                    'name' =&gt; 'fields[' . $key . '][unique]', &nbsp;</div></li><li><div>                    'value' =&gt; $field['unique'], &nbsp;</div></li><li><div>                    'choices' =&gt; array(&nbsp;</div></li><li><div>                        'non-unique'=&gt; __( 'Non-Unique Value', 'acf_vf' ), &nbsp;</div></li><li><div>                        'global' =&gt; __( 'Unique Globally', 'acf_vf' ), &nbsp;</div></li><li><div>                        'post_type' =&gt; __( 'Unique For Post Type', 'acf_vf' ), &nbsp;</div></li><li><div>                        'post_key' =&gt; __( 'Unique For Post Type', 'acf_vf' ) . ' + ' . __( 'Field/Meta Key', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>                    'optgroup' =&gt; false, &nbsp;</div></li><li><div>                    'multiple' =&gt; '0', &nbsp;</div></li><li><div>                    'class' =&gt; 'validated-select', &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;/p&gt;&nbsp;</div></li><li><div>            &lt;div class=&quot;unique_statuses&quot;&gt;&nbsp;</div></li><li><div>            &lt;p&gt;&lt;?php _e( 'Apply to which post statuses?', 'acf_vf'); ?&gt;&lt;br/&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            $statuses = $this-&gt;get_post_statuses();&nbsp;</div></li><li><div>            $choices = array();&nbsp;</div></li><li><div>            foreach ( $statuses as $value =&gt; $status ) {&nbsp;</div></li><li><div>                $choices[$value] = $status-&gt;label;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            do_action( 'acf/create_field', &nbsp;</div></li><li><div>                array(&nbsp;</div></li><li><div>                    'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                    'name' =&gt; 'fields['.$key.'][unique_statuses]', &nbsp;</div></li><li><div>                    'value' =&gt; $field['unique_statuses'], &nbsp;</div></li><li><div>                    'choices' =&gt; $choices, &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ); &nbsp;</div></li><li><div>            ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>            jQuery(document).ready(function() {&nbsp;</div></li><li><div>                jQuery(&quot;#acf-field-&lt;?php echo $html_key; ?&gt;_pattern&quot;).hide();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                ace.require(&quot;ace/ext/language_tools&quot;);&nbsp;</div></li><li><div>                ace.config.loadModule('ace/snippets/snippets');&nbsp;</div></li><li><div>                ace.config.loadModule('ace/snippets/php');&nbsp;</div></li><li><div>                ace.config.loadModule(&quot;ace/ext/searchbox&quot;);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                var editor = ace.edit(&quot;acf-field-&lt;?php echo $html_key; ?&gt;_editor&quot;);&nbsp;</div></li><li><div>                editor.setTheme(&quot;ace/theme/monokai&quot;);&nbsp;</div></li><li><div>                editor.getSession().setMode(&quot;ace/mode/text&quot;);&nbsp;</div></li><li><div>                editor.getSession().on('change', function(e) {&nbsp;</div></li><li><div>                    var val = editor.getValue();&nbsp;</div></li><li><div>                    var func = jQuery('#acf-field-&lt;?php echo $html_key; ?&gt;_function').val();&nbsp;</div></li><li><div>                    if (func=='php') {&nbsp;</div></li><li><div>                        val = val.substr(val.indexOf('\n')+1);&nbsp;</div></li><li><div>                    } else if (func=='regex') {&nbsp;</div></li><li><div>                        if (val.indexOf('\n')&gt;0) {&nbsp;</div></li><li><div>                            editor.setValue(val.trim().split('\n')[0]);&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    jQuery(&quot;#acf-field-&lt;?php echo $html_key; ?&gt;_pattern&quot;).val(val);&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>                jQuery(&quot;#acf-field-&lt;?php echo $html_key; ?&gt;_editor&quot;).data('editor', editor);&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                jQuery('#acf-field-&lt;?php echo $html_key; ?&gt;_function').on('change', function() {&nbsp;</div></li><li><div>                    jQuery('#validated-&lt;?php echo $html_key; ?&gt;-info div').hide(300);&nbsp;</div></li><li><div>                    jQuery('#validated-&lt;?php echo $html_key; ?&gt;-info div.'+jQuery(this).val()).show(300);&nbsp;</div></li><li><div>                    if (jQuery(this).val()!='none') {&nbsp;</div></li><li><div>                        jQuery('#validated-&lt;?php echo $html_key; ?&gt;-info .field_option_&lt;?php echo $this-&gt;name; ?&gt;_validation').show();&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        jQuery('#validated-&lt;?php echo $html_key; ?&gt;-info .field_option_&lt;?php echo $this-&gt;name; ?&gt;_validation').hide();&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    var sPhp = '&lt;'+'?'+'php';&nbsp;</div></li><li><div>                    var editor = jQuery('#acf-field-&lt;?php echo $html_key; ?&gt;_editor').data('editor');&nbsp;</div></li><li><div>                    var val = editor.getValue();&nbsp;</div></li><li><div>                    if (jQuery(this).val()=='none') {&nbsp;</div></li><li><div>                        jQuery('#field_option_&lt;?php echo $html_key; ?&gt;_validation, #field_option_&lt;?php echo $html_key; ?&gt;_message').hide(300);&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        if (jQuery(this).val()=='php') {&nbsp;</div></li><li><div>                            if (val.indexOf(sPhp)!=0) {&nbsp;</div></li><li><div>                                editor.setValue(sPhp +'\n' + val);&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            editor.getSession().setMode(&quot;ace/mode/php&quot;);&nbsp;</div></li><li><div>                            jQuery(&quot;#acf-field-&lt;?php echo $html_key; ?&gt;_editor&quot;).css('height', '420px');&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            editor.setOptions({&nbsp;</div></li><li><div>                                enableBasicAutocompletion: true, &nbsp;</div></li><li><div>                                enableSnippets: true, &nbsp;</div></li><li><div>                                enableLiveAutocompletion: true&nbsp;</div></li><li><div>                            });&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            if (val.indexOf(sPhp)==0) {&nbsp;</div></li><li><div>                                editor.setValue(val.substr(val.indexOf('\n')+1));&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                            editor.getSession().setMode(&quot;ace/mode/text&quot;);&nbsp;</div></li><li><div>                            jQuery(&quot;#acf-field-&lt;?php echo $html_key; ?&gt;_editor&quot;).css('height', '18px');&nbsp;</div></li><li><div>                            editor.setOptions({&nbsp;</div></li><li><div>                                enableBasicAutocompletion: false, &nbsp;</div></li><li><div>                                enableSnippets: false, &nbsp;</div></li><li><div>                                enableLiveAutocompletion: false&nbsp;</div></li><li><div>                            });&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                        editor.resize();&nbsp;</div></li><li><div>                        editor.gotoLine(1, 1, false);&nbsp;</div></li><li><div>                        jQuery('#field_option_&lt;?php echo $html_key; ?&gt;_validation, #field_option_&lt;?php echo $html_key; ?&gt;_message').show(300);&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                jQuery('#acf-field-&lt;?php echo $html_key; ?&gt;_unique').on('change', function() {&nbsp;</div></li><li><div>                    var unqa = jQuery('#validated-&lt;?php echo $html_key; ?&gt;-unique .unique_statuses');&nbsp;</div></li><li><div>                    var val = jQuery(this).val();&nbsp;</div></li><li><div>                    if (val=='non-unique'||val=='') { unqa.hide(300); } else { unqa.show(300); }&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // update ui&nbsp;</div></li><li><div>                jQuery('#acf-field-&lt;?php echo $html_key; ?&gt;_function').trigger('change');&nbsp;</div></li><li><div>                jQuery('#acf-field-&lt;?php echo $html_key; ?&gt;_unique').trigger('change');&nbsp;</div></li><li><div>                jQuery('#acf-field-&lt;?php echo $html_key; ?&gt;_sub_field_type').trigger('change');&nbsp;</div></li><li><div>            });&nbsp;</div></li><li><div>            &lt;/script&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  create_field()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Create the HTML interface for your field&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $field - an array holding all the field's data&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function create_field( $field ) {&nbsp;</div></li><li><div>        global $post, $pagenow;&nbsp;</div></li><li><div>        $is_new = $pagenow=='post-new.php';&nbsp;</div></li><li><div>        $field = $this-&gt;setup_field( $field );&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $field );&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;validated-field&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            if ( $field['read_only'] ) {&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;p&gt;&lt;?php &nbsp;</div></li><li><div>                ob_start();&nbsp;</div></li><li><div>                do_action( 'acf/create_field', $sub_field ); &nbsp;</div></li><li><div>                $contents = ob_get_contents();&nbsp;</div></li><li><div>                $contents = preg_replace(&quot;~&lt;(input|textarea|select)~&quot;, &quot;&lt;\${1} disabled=true readonly&quot;, $contents );&nbsp;</div></li><li><div>                $contents = preg_replace(&quot;~acf-hidden~&quot;, &quot;acf-hidden acf-vf-readonly&quot;, $contents );&nbsp;</div></li><li><div>                ob_end_clean();&nbsp;</div></li><li><div>                echo $contents;&nbsp;</div></li><li><div>                ?&gt;&lt;/p&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                do_action( 'acf/create_field', $sub_field ); &nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        if ( ! empty( $field['mask'] ) && ( $is_new || ( isset( $field['read_only'] ) && ! $field['read_only'] ) ) ) { ?&gt;&nbsp;</div></li><li><div>            &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>                jQuery(function($) {&nbsp;</div></li><li><div>                   $('[name=&quot;&lt;?php echo str_replace('[', '\\\\[', str_replace(']', '\\\\]', $field['name'])); ?&gt;&quot;]').mask('&lt;?php echo $field['mask']?&gt;');&nbsp;</div></li><li><div>                });&nbsp;</div></li><li><div>            &lt;/script&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  input_admin_enqueue_scripts()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This action is called in the admin_enqueue_scripts action on the edit screen where your field is created.&nbsp;</div></li><li><div>    *  Use this action to add css + javascript to assist your create_field() action.&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  $info    http://codex.wordpress.org/Plugin_API/Action_Reference/admin_enqueue_scripts&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function input_admin_enqueue_scripts() {&nbsp;</div></li><li><div>        // register acf scripts&nbsp;</div></li><li><div>        $min = ( ! $this-&gt;debug )? '.min' : '';&nbsp;</div></li><li><div>        wp_register_script( 'acf-validated-field', $this-&gt;settings['dir'] . &quot;js/input{$min}.js&quot;, array( 'jquery' ), $this-&gt;settings['version'] );&nbsp;</div></li><li><div>        wp_register_script( 'jquery-masking', $this-&gt;settings['dir'] . &quot;js/jquery.maskedinput{$min}.js&quot;, array( 'jquery' ), $this-&gt;settings['version']);&nbsp;</div></li><li><div>        wp_register_script( 'sh-core', $this-&gt;settings['dir'] . 'js/shCore.js', array( 'acf-input' ), $this-&gt;settings['version'] );&nbsp;</div></li><li><div>        wp_register_script( 'sh-autoloader', $this-&gt;settings['dir'] . 'js/shAutoloader.js', array( 'sh-core' ), $this-&gt;settings['version']);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // enqueue scripts&nbsp;</div></li><li><div>        wp_enqueue_script( array(&nbsp;</div></li><li><div>            'jquery', &nbsp;</div></li><li><div>            'jquery-ui-core', &nbsp;</div></li><li><div>            'jquery-ui-tabs', &nbsp;</div></li><li><div>            'jquery-masking', &nbsp;</div></li><li><div>            'acf-validated-field', &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>        if ( $this-&gt;debug ) { &nbsp;</div></li><li><div>            add_action( $this-&gt;frontend? 'wp_head' : 'admin_head', array( &$this, 'debug_head' ), 20 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( ! $this-&gt;drafts ) { &nbsp;</div></li><li><div>            add_action( $this-&gt;frontend? 'wp_head' : 'admin_head', array( &$this, 'drafts_head' ), 20 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( $this-&gt;frontend && ! is_admin() ) {&nbsp;</div></li><li><div>            add_action( 'wp_head', array( &$this, 'frontend_head' ), 20 );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function debug_head() {&nbsp;</div></li><li><div>        // set debugging for javascript&nbsp;</div></li><li><div>        echo '&lt;script type=&quot;text/javascript&quot;&gt;vf.debug=true;&lt;/script&gt;';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function drafts_head() {&nbsp;</div></li><li><div>        // don't validate drafts for anything&nbsp;</div></li><li><div>        echo '&lt;script type=&quot;text/javascript&quot;&gt;vf.drafts=false;&lt;/script&gt;';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function frontend_head() {&nbsp;</div></li><li><div>        // indicate that this is validating the front end&nbsp;</div></li><li><div>        echo '&lt;script type=&quot;text/javascript&quot;&gt;vf.frontend=true;&lt;/script&gt;';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  input_admin_head()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This action is called in the admin_head action on the edit screen where your field is created.&nbsp;</div></li><li><div>    *  Use this action to add css and javascript to assist your create_field() action.&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @info    http://codex.wordpress.org/Plugin_API/Action_Reference/admin_head&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function input_admin_head() {&nbsp;</div></li><li><div>        wp_enqueue_style( 'font-awesome', plugins_url( 'css/font-awesome/css/font-awesome.min.css', __FILE__ ), array(), '4.2.0' ); &nbsp;</div></li><li><div>        wp_enqueue_style( 'acf-validated_field', plugins_url( 'css/input.css', __FILE__ ), array( 'acf-input' ), ACF_VF_VERSION ); &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  field_group_admin_enqueue_scripts()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This action is called in the admin_enqueue_scripts action on the edit screen where your field is edited.&nbsp;</div></li><li><div>    *  Use this action to add css + javascript to assist your create_field_options() action.&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  $info    http://codex.wordpress.org/Plugin_API/Action_Reference/admin_enqueue_scripts&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function field_group_admin_enqueue_scripts() {&nbsp;</div></li><li><div>        wp_enqueue_script( 'ace-editor', plugins_url( 'js/ace/ace.js', __FILE__ ), array(), '1.1.7' );&nbsp;</div></li><li><div>        wp_enqueue_script( 'ace-ext-language_tools', plugins_url( 'js/ace/ext-language_tools.js', __FILE__ ), array(), '1.1.7' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  field_group_admin_head()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This action is called in the admin_head action on the edit screen where your field is edited.&nbsp;</div></li><li><div>    *  Use this action to add css and javascript to assist your create_field_options() action.&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @info    http://codex.wordpress.org/Plugin_API/Action_Reference/admin_head&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function field_group_admin_head() { }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  load_value()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $value after it is loaded from the db&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $value - the value found in the database&nbsp;</div></li><li><div>    *  @param    $post_id - the $post_id from which the value was loaded from&nbsp;</div></li><li><div>    *  @param    $field - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $value - the value to be saved in te database&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function load_value( $value, $post_id, $field ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        return apply_filters( 'acf/load_value/type='.$sub_field['type'], $value, $post_id, $sub_field );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  update_value()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $value before it is updated in the db&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $value - the value which will be saved in the database&nbsp;</div></li><li><div>    *  @param    $post_id - the $post_id of which the value will be saved&nbsp;</div></li><li><div>    *  @param    $field - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $value - the modified value&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function update_value( $value, $post_id, $field ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        return apply_filters( 'acf/update_value/type='.$sub_field['type'], $value, $post_id, $sub_field );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  format_value()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $value after it is loaded from the db and before it is passed to the create_field action&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $value    - the value which was loaded from the database&nbsp;</div></li><li><div>    *  @param    $post_id - the $post_id from which the value was loaded&nbsp;</div></li><li><div>    *  @param    $field    - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $value    - the modified value&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function format_value( $value, $post_id, $field ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        return apply_filters( 'acf/format_value/type='.$sub_field['type'], $value, $post_id, $sub_field );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  format_value_for_api()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $value after it is loaded from the db and before it is passed back to the api functions such as the_field&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $value    - the value which was loaded from the database&nbsp;</div></li><li><div>    *  @param    $post_id - the $post_id from which the value was loaded&nbsp;</div></li><li><div>    *  @param    $field    - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $value    - the modified value&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function format_value_for_api( $value, $post_id, $field ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        return apply_filters( 'acf/format_value_for_api/type='.$sub_field['type'], $value, $post_id, $sub_field );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  load_field()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $field after it is loaded from the database&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $field - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $field - the field array holding all the field options&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function load_field( $field ) {&nbsp;</div></li><li><div>        global $currentpage;&nbsp;</div></li><li><div>        $field = $this-&gt;setup_field( $field );&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $field );&nbsp;</div></li><li><div>        $sub_field = apply_filters( 'acf/load_field/type='.$sub_field['type'], $sub_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The relationship field gets settings from the sub_field so we need to return it since it effectively displays through this method.&nbsp;</div></li><li><div>        if ( isset( $_POST['action'] ) && $_POST['action'] == 'acf/fields/relationship/query_posts' ) {&nbsp;</div></li><li><div>            // Bug fix, if the taxonomy is &quot;all&quot; just omit it from the filter.&nbsp;</div></li><li><div>            if ( $sub_field['taxonomy'][0] == 'all' ) {&nbsp;</div></li><li><div>                unset( $sub_field['taxonomy']);&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            return $sub_field;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field['sub_field'] = $sub_field;&nbsp;</div></li><li><div>        if ( $field['read_only'] && $currentpage == 'edit.php' ) {&nbsp;</div></li><li><div>            $field['label'] .= ' &lt;i class=&quot;fa fa-ban&quot; style=&quot;color:red;&quot; title=&quot;'. __( 'Read only', 'acf_vf' ) . '&quot;&gt;&lt;/i&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  update_field()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $field before it is saved to the database&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $field - the field array holding all the field options&nbsp;</div></li><li><div>    *  @param    $post_id - the field group ID (post_type = acf)&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $field - the modified field&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function update_field( $field, $post_id ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        $sub_field = apply_filters( 'acf/update_field/type='.$sub_field['type'], $sub_field, $post_id );&nbsp;</div></li><li><div>        $field['sub_field'] = $sub_field;&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd><dt><strong><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/files/validated-field-v5/" class="file">/validated_field_v5.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="3" class="block" start="3"><li><div>class acf_field_validated_field extends acf_field {&nbsp;</div></li><li><div>    //static final NL = &quot;\n&quot;;&nbsp;</div></li><li><div>    // vars&nbsp;</div></li><li><div>    var $slug, &nbsp;</div></li><li><div>        $config, &nbsp;</div></li><li><div>        $settings, // will hold info such as dir / path&nbsp;</div></li><li><div>        $defaults, // will hold default field options&nbsp;</div></li><li><div>        $sub_defaults, // will hold default sub field options&nbsp;</div></li><li><div>        $debug, // if true, don't use minified and confirm form submit                    &nbsp;</div></li><li><div>        $drafts, &nbsp;</div></li><li><div>        $frontend;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  __construct&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Set name / label needed for actions / filters&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function __construct() {&nbsp;</div></li><li><div>        // vars&nbsp;</div></li><li><div>        $this-&gt;slug = 'acf-validated-field';&nbsp;</div></li><li><div>        $this-&gt;strbool = array( 'true' =&gt; true, 'false' =&gt; false );&nbsp;</div></li><li><div>        $this-&gt;config = array(&nbsp;</div></li><li><div>            'acf_vf_debug' =&gt; array(&nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'false', &nbsp;</div></li><li><div>                'label' =&gt; __( 'Enable Debug', 'acf_vf' ), &nbsp;</div></li><li><div>                'help' =&gt; __( 'Check this box to turn on debugging for Validated Fields.', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'acf_vf_drafts' =&gt; array(&nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'true', &nbsp;</div></li><li><div>                'label' =&gt; __( 'Enable Draft Validation', 'acf_vf' ), &nbsp;</div></li><li><div>                'help' =&gt; __( 'Check this box to enable Draft validation globally, or uncheck to allow it to be set per field.', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'acf_vf_frontend' =&gt; array(&nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'true', &nbsp;</div></li><li><div>                'label' =&gt; __( 'Enable Front-End Validation', 'acf_vf' ), &nbsp;</div></li><li><div>                'help' =&gt; __( 'Check this box to turn on validation for front-end forms created with', 'acf_vf' ) . ' &lt;code&gt;acf_form()&lt;/code&gt;.', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'acf_vf_frontend_css' =&gt; array(&nbsp;</div></li><li><div>                'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>                'default' =&gt; 'true', &nbsp;</div></li><li><div>                'label' =&gt; __( 'Enqueue Admin CSS on Front-End', 'acf_vf' ), &nbsp;</div></li><li><div>                'help' =&gt; __( 'Uncheck this box to turn off &quot;colors-fresh&quot; admin theme enqueued by', 'acf_vf' ) . ' &lt;code&gt;acf_form_head()&lt;/code&gt;.', &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        $this-&gt;name = 'validated_field';&nbsp;</div></li><li><div>        $this-&gt;label = __( 'Validated Field', 'acf_vf' );&nbsp;</div></li><li><div>        $this-&gt;category = __( 'Basic', 'acf' );&nbsp;</div></li><li><div>        $this-&gt;drafts = $this-&gt;option_value( 'acf_vf_drafts' );&nbsp;</div></li><li><div>        $this-&gt;frontend = $this-&gt;option_value( 'acf_vf_frontend' );&nbsp;</div></li><li><div>        $this-&gt;frontend_css = $this-&gt;option_value( 'acf_vf_frontend_css' );&nbsp;</div></li><li><div>        $this-&gt;debug = $this-&gt;option_value( 'acf_vf_debug' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;defaults = array(&nbsp;</div></li><li><div>            'read_only' =&gt; false, &nbsp;</div></li><li><div>            'mask' =&gt; '', &nbsp;</div></li><li><div>            'function' =&gt; 'none', &nbsp;</div></li><li><div>            'pattern' =&gt; '', &nbsp;</div></li><li><div>            'message' =&gt;  __( 'Validation failed.', 'acf_vf' ), &nbsp;</div></li><li><div>            'unique' =&gt; 'non-unique', &nbsp;</div></li><li><div>            'unique_statuses' =&gt; apply_filters( 'acf_vf/unique_statuses', array( 'publish', 'future' ) ), &nbsp;</div></li><li><div>            'drafts' =&gt; true, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;sub_defaults = array(&nbsp;</div></li><li><div>            'type' =&gt; '', &nbsp;</div></li><li><div>            'key' =&gt; '', &nbsp;</div></li><li><div>            'name' =&gt; '', &nbsp;</div></li><li><div>            '_name' =&gt; '', &nbsp;</div></li><li><div>            'id' =&gt; '', &nbsp;</div></li><li><div>            'value' =&gt; '', &nbsp;</div></li><li><div>            'field_group' =&gt; '', &nbsp;</div></li><li><div>            'readonly' =&gt; '', &nbsp;</div></li><li><div>            'disabled' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;input_defaults = array(&nbsp;</div></li><li><div>            'id' =&gt; '', &nbsp;</div></li><li><div>            'value' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // do not delete!&nbsp;</div></li><li><div>        parent::__construct();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // settings&nbsp;</div></li><li><div>        $this-&gt;settings = array(&nbsp;</div></li><li><div>            'path' =&gt; apply_filters( 'acf/helpers/get_path', __FILE__ ), &nbsp;</div></li><li><div>            'dir' =&gt; apply_filters( 'acf/helpers/get_dir', __FILE__ ), &nbsp;</div></li><li><div>            'version' =&gt; ACF_VF_VERSION, &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_admin() || $this-&gt;frontend ) { // admin actions&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // bug fix for acf with backslashes in the content.&nbsp;</div></li><li><div>            add_filter( 'content_save_pre', array( $this, 'fix_post_content' ) );&nbsp;</div></li><li><div>            add_filter( 'acf/get_valid_field', array( $this, 'fix_upgrade' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // override the default ajax actions to provide our own messages since they aren't filtered&nbsp;</div></li><li><div>            add_action( 'init', array( $this, 'override_acf_ajax_validation' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( ! is_admin() && $this-&gt;frontend ) {&nbsp;</div></li><li><div>                if ( ! $this-&gt;frontend_css ) {&nbsp;</div></li><li><div>                    add_action( 'acf/input/admin_enqueue_scripts', array( $this, 'remove_acf_form_style' ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                add_action( 'wp_head', array( $this, 'set_post_id_to_acf_form' ) );&nbsp;</div></li><li><div>                add_action( 'wp_head', array( $this, 'input_admin_enqueue_scripts' ), 1 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            if ( is_admin() ) {&nbsp;</div></li><li><div>                add_action( 'admin_init', array( $this, 'admin_register_settings' ) );&nbsp;</div></li><li><div>                add_action( 'admin_menu', array( $this, 'admin_add_menu' ), 11 );&nbsp;</div></li><li><div>                add_action( 'admin_head', array( $this, 'admin_head' ) );&nbsp;</div></li><li><div>                // add the post_ID to the acf[] form&nbsp;</div></li><li><div>                add_action( 'edit_form_after_editor', array( $this, 'edit_form_after_editor' ) );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( is_admin() || $this-&gt;frontend ) {&nbsp;</div></li><li><div>                // validate validated_fields&nbsp;</div></li><li><div>                add_filter( &quot;acf/validate_value/type=validated_field&quot;, array( $this, 'validate_field' ), 10, 4 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fix_upgrade( $field ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // the $_POST will tell us if this is an upgrade&nbsp;</div></li><li><div>        $is_5_upgrade = &nbsp;</div></li><li><div>            isset( $_POST['action'] ) && $_POST['action'] == 'acf/admin/data_upgrade' && &nbsp;</div></li><li><div>            isset( $_POST['version'] ) && $_POST['version'] == '5.0.0';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if it is an upgrade recursively fix the field values&nbsp;</div></li><li><div>        if ( $is_5_upgrade ) {&nbsp;</div></li><li><div>            $field = $this-&gt;do_recursive_slash_fix( $field );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function fix_post_content( $content ) {&nbsp;</div></li><li><div>        global $post;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // are we saving a field group?&nbsp;</div></li><li><div>        $is_field_group = get_post_type() == 'acf-field-group';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // are we saving a field group?&nbsp;</div></li><li><div>        $is_field = get_post_type() == 'acf-field';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // are we upgrading to ACF 5?&nbsp;</div></li><li><div>        $is_5_upgrade = &nbsp;</div></li><li><div>            isset( $_POST['action'] ) && $_POST['action'] == 'acf/admin/data_upgrade' && &nbsp;</div></li><li><div>            isset( $_POST['version'] ) && $_POST['version'] == '5.0.0';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if we are, we need to check the values for single, but not double, backslashes and make them double&nbsp;</div></li><li><div>        if ( $is_field || $is_field_group || $is_5_upgrade ) {&nbsp;</div></li><li><div>            $content = $this-&gt;do_slash_fix( $content );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $content;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function do_slash_fix( $string ) {&nbsp;</div></li><li><div>        if ( preg_match( '~(?&lt;!\\\\)\\\\(?!\\\\)~', $string ) ) {&nbsp;</div></li><li><div>            $string = str_replace('\\', '\\\\', $string );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        if ( preg_match( '~\\\\\\\\&quot;~', $string ) ) {&nbsp;</div></li><li><div>            $string = str_replace('\\\\&quot;', '\\&quot;', $string );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $string;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function do_recursive_slash_fix( $array ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // loop through all levels of the array&nbsp;</div></li><li><div>        foreach( $array as $key =&gt; &$value ) {&nbsp;</div></li><li><div>            if ( is_array( $value ) ) {&nbsp;</div></li><li><div>                // div deeper&nbsp;</div></li><li><div>                $value = $this-&gt;do_recursive_slash_fix( $value );&nbsp;</div></li><li><div>            } elseif ( is_string( $value ) ) {&nbsp;</div></li><li><div>                // fix single backslashes to double&nbsp;</div></li><li><div>                $value = $this-&gt;do_slash_fix( $value );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $array;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function override_acf_ajax_validation() {&nbsp;</div></li><li><div>        remove_all_actions( 'wp_ajax_acf/validate_save_post' );&nbsp;</div></li><li><div>        remove_all_actions( 'wp_ajax_nopriv_acf/validate_save_post' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_action( 'wp_ajax_acf/validate_save_post', array( $this, 'ajax_validate_save_post') );&nbsp;</div></li><li><div>        add_action( 'wp_ajax_nopriv_acf/validate_save_post', array( $this, 'ajax_validate_save_post') );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function set_post_id_to_acf_form() {&nbsp;</div></li><li><div>        global $post;&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>        jQuery(document).ready(function() {&nbsp;</div></li><li><div>            jQuery('form.acf-form').append('&lt;input type=&quot;hidden&quot; name=&quot;acf[post_ID]&quot; value=&quot;&lt;?php echo $post-&gt;ID; ?&gt;&quot;/&gt;');&nbsp;</div></li><li><div>            jQuery('form.acf-form').append('&lt;input type=&quot;hidden&quot; name=&quot;acf[frontend]&quot; value=&quot;true&quot;/&gt;');&nbsp;</div></li><li><div>        });&nbsp;</div></li><li><div>        &lt;/script&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function edit_form_after_editor( $post ) {&nbsp;</div></li><li><div>        echo &quot;&lt;input type='hidden' name='acf[post_ID]' value='{$post-&gt;ID}'/&gt;&quot;;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function option_value( $key ) {&nbsp;</div></li><li><div>        return ( false !== $option = get_option( $key ) )?&nbsp;</div></li><li><div>            $option == $this-&gt;config[$key]['default'] :&nbsp;</div></li><li><div>            $this-&gt;strbool[$this-&gt;config[$key]['default']];&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_head() {&nbsp;</div></li><li><div>        $min = ( ! $this-&gt;debug )? '.min' : '';&nbsp;</div></li><li><div>        wp_register_script( 'acf-validated-field-admin', plugins_url( &quot;js/admin{$min}.js&quot;, __FILE__ ), array( 'jquery', 'acf-field-group' ), ACF_VF_VERSION );&nbsp;</div></li><li><div>        wp_register_script( 'acf-validated-field-group', plugins_url( &quot;js/field-group{$min}.js&quot;, __FILE__ ), array( 'jquery', 'acf-field-group' ), ACF_VF_VERSION );&nbsp;</div></li><li><div>        wp_enqueue_script( array(&nbsp;</div></li><li><div>            'jquery', &nbsp;</div></li><li><div>            'acf-validated-field-admin', &nbsp;</div></li><li><div>            'acf-validated-field-group', &nbsp;</div></li><li><div> ));    &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_add_menu() {&nbsp;</div></li><li><div>        $page = add_submenu_page( 'edit.php?post_type=acf-field-group', __( 'Validated Field Settings', 'acf_vf' ), __( 'Validated Field Settings', 'acf_vf' ), 'manage_options', $this-&gt;slug, array( &$this, 'admin_settings_page' ) );        &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_register_settings() {&nbsp;</div></li><li><div>        foreach ( $this-&gt;config as $key =&gt; $value ) {&nbsp;</div></li><li><div>            register_setting( $this-&gt;slug, $key );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function admin_settings_page() {&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;wrap&quot;&gt;&nbsp;</div></li><li><div>        &lt;h2&gt;Validated Field Settings&lt;/h2&gt;&nbsp;</div></li><li><div>        &lt;form method=&quot;post&quot; action=&quot;options.php&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php settings_fields( $this-&gt;slug ); ?&gt;&nbsp;</div></li><li><div>            &lt;?php do_settings_sections( $this-&gt;slug ); ?&gt;&nbsp;</div></li><li><div>            &lt;table class=&quot;form-table&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php foreach ( $this-&gt;config as $key =&gt; $value ) { ?&gt;&nbsp;</div></li><li><div>                &lt;tr valign=&quot;top&quot;&gt;&nbsp;</div></li><li><div>                    &lt;th scope=&quot;row&quot;&gt;&lt;?php echo $value['label']; ?&gt;&lt;/th&gt;&nbsp;</div></li><li><div>                    &lt;td&gt;&nbsp;</div></li><li><div>                        &lt;input type=&quot;checkbox&quot; id=&quot;&lt;?php echo $key; ?&gt;&quot; name=&quot;&lt;?php echo $key; ?&gt;&quot; value=&quot;&lt;?php echo $value['default']; ?&gt;&quot; &lt;?php if ( $this-&gt;option_value( $key ) ) echo 'checked'; ?&gt;/&gt;&nbsp;</div></li><li><div>                        &lt;small&gt;&lt;em&gt;&lt;?php echo $value['help']; ?&gt;&lt;/em&gt;&lt;/small&gt;&nbsp;</div></li><li><div>                    &lt;/td&gt;&nbsp;</div></li><li><div>                &lt;/tr&gt;&nbsp;</div></li><li><div>            &lt;?php } ?&gt;&nbsp;</div></li><li><div>            &lt;/table&gt;&nbsp;</div></li><li><div>            &lt;?php submit_button(); ?&gt;&nbsp;</div></li><li><div>        &lt;/form&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function remove_acf_form_style() {&nbsp;</div></li><li><div>        wp_dequeue_style( array( 'colors-fresh' ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setup_field( $field ) {&nbsp;</div></li><li><div>        // setup booleans, for compatibility&nbsp;</div></li><li><div>        $field = acf_prepare_field( array_merge( $this-&gt;defaults, $field ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // set up the sub_field&nbsp;</div></li><li><div>        $sub_field = isset( $field['sub_field'] )? &nbsp;</div></li><li><div>            $field['sub_field'] :    // already set up&nbsp;</div></li><li><div>            array();                // create it&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // mask the sub field as the parent by giving it the same key values&nbsp;</div></li><li><div>        foreach( $field as $key =&gt; $value ) {&nbsp;</div></li><li><div>            if ( in_array( $key, array( 'sub_field', 'type' ) ) )&nbsp;</div></li><li><div>                continue;&nbsp;</div></li><li><div>            $sub_field[$key] = $value;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // these fields need some special formatting&nbsp;</div></li><li><div>        $sub_field['_input'] = $field['prefix'].'['.$sub_field['key'].']';&nbsp;</div></li><li><div>        $sub_field['name'] = $sub_field['_input'];&nbsp;</div></li><li><div>        $sub_field['id'] = str_replace( '-acfcloneindex', '', str_replace( ']', '', str_replace( '[', '-', $sub_field['_input'] ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // make sure all the defaults are set&nbsp;</div></li><li><div>        $field['sub_field'] = array_merge( $this-&gt;sub_defaults, $sub_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function setup_sub_field( $field ) {&nbsp;</div></li><li><div>        return $field['sub_field'];    &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  get_post_statuses()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Get the various post statuses that have been registered&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type        function&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function get_post_statuses() {&nbsp;</div></li><li><div>        global $wp_post_statuses;&nbsp;</div></li><li><div>        return $wp_post_statuses;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  ajax_validate_save_post()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Override the default acf_input()-&gt;ajax_validate_save_post() to return a custom validation message&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type        function&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function ajax_validate_save_post() {&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // validate&nbsp;</div></li><li><div>        if ( ! isset( $_POST['_acfnonce'] ) ) {&nbsp;</div></li><li><div>            // ignore validation, this form $_POST was not correctly configured&nbsp;</div></li><li><div>            die();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // success&nbsp;</div></li><li><div>        if ( acf_validate_save_post() ) {&nbsp;</div></li><li><div>            $json = array(&nbsp;</div></li><li><div>                'result' =&gt; 1, &nbsp;</div></li><li><div>                'message' =&gt; __( 'Validation successful', 'acf' ), &nbsp;</div></li><li><div>                'errors' =&gt; 0&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>            die( json_encode( $json ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // fail&nbsp;</div></li><li><div>        $json = array(&nbsp;</div></li><li><div>            'result' =&gt; 0, &nbsp;</div></li><li><div>            'message' =&gt; __( 'Validation failed', 'acf' ), &nbsp;</div></li><li><div>            'errors' =&gt; acf_get_validation_errors()&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // update message&nbsp;</div></li><li><div>        $i = count( $json['errors'] );&nbsp;</div></li><li><div>        $json['message'] .= '. ' . sprintf( _n( '1 field below is invalid.', '%s fields below are invalid.', $i, 'acf_vf' ), $i ) . ' ' . __( 'Please check your values and submit again.', 'acf_vf' );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        die( json_encode( $json ) );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    function validate_field( $valid, $value, $field, $input ) {&nbsp;</div></li><li><div>        if ( ! $valid )&nbsp;</div></li><li><div>            return $valid;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get ID of the submit post or cpt, allow null for options page&nbsp;</div></li><li><div>        $post_id = isset( $_POST['acf']['post_ID'] )? $_POST['acf']['post_ID'] : null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $post_type = get_post_type( $post_id );                // the type of the submitted post&nbsp;</div></li><li><div>        $frontend = isset( $_REQUEST['acf']['frontend'] )?&nbsp;</div></li><li><div>            $_REQUEST['acf']['frontend'] :&nbsp;</div></li><li><div>            false;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $field['parent'] ) ) {&nbsp;</div></li><li><div>            $parent_field = acf_get_field( $field['parent'] );    &nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if it's a repeater field, get the validated field so we can do meta queries...&nbsp;</div></li><li><div>        if ( $is_repeater = ( isset( $parent_field ) && 'repeater' == $parent_field['type'] ) ) {&nbsp;</div></li><li><div>            $index = explode( '][', $input );&nbsp;</div></li><li><div>            $index = $index[1];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // the wrapped field&nbsp;</div></li><li><div>        $field = $this-&gt;setup_field( $field );&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $field );&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        //$value = $input['value'];                            // the submitted value&nbsp;</div></li><li><div>        if ( $field['required'] && empty( $value ) ) {&nbsp;</div></li><li><div>            return $valid;                                    // let the required field handle it&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !$field['drafts'] ) {&nbsp;</div></li><li><div>            return $valid;                                    // we aren't publishing and we don't want to validate drafts&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        $function = $field['function'];                        // what type of validation?&nbsp;</div></li><li><div>        $pattern = $field['pattern'];                        // string to use for validation&nbsp;</div></li><li><div>        $message = $field['message'];                        // failure message to return to the UI&nbsp;</div></li><li><div>        if ( ! empty( $function ) && ! empty( $pattern ) ) {&nbsp;</div></li><li><div>            switch ( $function ) {                            // only run these checks if we have a pattern&nbsp;</div></li><li><div>                case 'regex':                                // check for any matches to the regular expression&nbsp;</div></li><li><div>                    $pattern_fltr = '/' . str_replace( &quot;/&quot;, &quot;\/&quot;, $pattern ) . '/';&nbsp;</div></li><li><div>                    if ( ! preg_match( $pattern_fltr, $value ) ) {&nbsp;</div></li><li><div>                        $valid = false;                        // return false if there are no matches&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'sql':                                    // todo: sql checks?&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'php':                                    // this code is a little tricky, one bad eval() can break the lot. needs a nonce.&nbsp;</div></li><li><div>                    $this_key = $field['name'];&nbsp;</div></li><li><div>                    if ( $is_repeater ) $this_key .= '_' . $index . '_' . $sub_sub_field['name'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // get the fields based on the keys and then index by the meta value for easy of use&nbsp;</div></li><li><div>                    $input_fields = array();&nbsp;</div></li><li><div>                    foreach ( $_POST['acf'] as $key =&gt; $val ) {&nbsp;</div></li><li><div>                        if ( false !== ( $input_field = get_field_object( $key, $post_id ) ) ) {&nbsp;</div></li><li><div>                            $meta_key = $input_field['name'];&nbsp;</div></li><li><div>                            $input_fields[$meta_key] = array(&nbsp;</div></li><li><div>                                'field'=&gt;$input_field, &nbsp;</div></li><li><div>                                'value'=&gt;$val, &nbsp;</div></li><li><div>                                'prev_val'=&gt;get_post_meta( $post_id, $meta_key, true )&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $message = $field['message'];            // the default message&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // not yet saved to the database, so this is the previous value still&nbsp;</div></li><li><div>                    $prev_value = get_post_meta( $post_id, $this_key, true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // unique function for this key&nbsp;</div></li><li><div>                    $function_name = 'validate_' . $field['key'] . '_function';&nbsp;</div></li><li><div>                    &nbsp;</div></li><li><div>                    // it gets tricky but we are trying to account for an capture bad php code where possible&nbsp;</div></li><li><div>                    $pattern = addcslashes( trim( $pattern ), '$' );&nbsp;</div></li><li><div>                    if ( substr( $pattern, -1 ) != ';' ) $pattern.= ';';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    $value = addslashes( $value );&nbsp;</div></li><li><div>                    $prev_value = addslashes( $prev_value );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    // this must be left aligned as it contains an inner HEREDOC&nbsp;</div></li><li><div>                    $php = &lt;&lt;&lt;PHP&nbsp;</div></li><li><div>if ( ! function_exists( '$function_name' ) ):&nbsp;</div></li><li><div>function $function_name( \$args, &\$message ) {&nbsp;</div></li><li><div>    extract( \$args );&nbsp;</div></li><li><div>    try {&nbsp;</div></li><li><div>        \$code = &lt;&lt;&lt;INNERPHP&nbsp;</div></li><li><div>        $pattern return true;&nbsp;</div></li><li><div>INNERPHP;&nbsp;</div></li><li><div>        return @eval( \$code );&nbsp;</div></li><li><div>    } catch ( Exception \$e ) {&nbsp;</div></li><li><div>        \$message = &quot;Error: &quot;.\$e-&gt;getMessage(); return false;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li><li><div>endif; // function_exists&nbsp;</div></li><li><div>\$valid = $function_name( array( 'post_id'=&gt;'$post_id', 'post_type'=&gt;'$post_type', 'this_key'=&gt;'$this_key', 'value'=&gt;'$value', 'prev_value'=&gt;'$prev_value', 'inputs'=&gt;\$input_fields ), \$message );&nbsp;</div></li><li><div>PHP;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    if ( true !== eval( $php ) ) {            // run the eval() in the eval()&nbsp;</div></li><li><div>                        $error = error_get_last();            // get the error from the eval() on failure&nbsp;</div></li><li><div>                        // check to see if this is our error or not.&nbsp;</div></li><li><div>                        if ( strpos( $error['file'], &quot;validated_field_v5.php&quot; ) && strpos( $error['file'], &quot;eval()'d code&quot; ) ) {&nbsp;</div></li><li><div>                            preg_match( '/eval\\(\\)\'d code\\((\d+)\\)/', $error['file'], $matches );&nbsp;</div></li><li><div>                            $message = __( 'PHP Error', 'acf_vf' ) . ': ' . $error['message'] . ', line ' . $matches[1] . '.';&nbsp;</div></li><li><div>                            $valid = false;&nbsp;</div></li><li><div>                        } &nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    // if a string is returned, return it as the error.&nbsp;</div></li><li><div>                    if ( is_string( $valid ) ) {&nbsp;</div></li><li><div>                        $message = $valid;&nbsp;</div></li><li><div>                        $valid = false;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $message = stripslashes( $message );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        } elseif ( ! empty( $function ) && $function != 'none' ) {&nbsp;</div></li><li><div>            $message = __( 'This field\'s validation is not properly configured.', 'acf_vf' );&nbsp;</div></li><li><div>            $valid = false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>            &nbsp;</div></li><li><div>        $unique = $field['unique'];&nbsp;</div></li><li><div>        $field_is_unique = ! empty( $value ) && ! empty( $unique ) && $unique != 'non-unique';&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // validate the submitted values since there might be dupes in the form submit that aren't yet in the database&nbsp;</div></li><li><div>        if ( $valid && $field_is_unique ) {&nbsp;</div></li><li><div>            $value_instances = 0;&nbsp;</div></li><li><div>            switch ( $unique ) {&nbsp;</div></li><li><div>                case 'global';&nbsp;</div></li><li><div>                case 'post_type':&nbsp;</div></li><li><div>                case 'this_post':&nbsp;</div></li><li><div>                    // no duplicates at all allowed&nbsp;</div></li><li><div>                    foreach ( $_REQUEST['acf'] as $submitted ) {&nbsp;</div></li><li><div>                        if ( is_array( $submitted ) ) {&nbsp;</div></li><li><div>                            foreach ( $submitted as $row ) {&nbsp;</div></li><li><div>                                // there is only one, but we don't know the key&nbsp;</div></li><li><div>                                foreach ( $row as $submitted2 ) {&nbsp;</div></li><li><div>                                    if ( $submitted2 == $value ) {&nbsp;</div></li><li><div>                                        $value_instances++;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                    break;&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            if ( $submitted == $value ) {&nbsp;</div></li><li><div>                                $value_instances++;&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'post_key':&nbsp;</div></li><li><div>                case 'this_post_key':&nbsp;</div></li><li><div>                    // only check the key for a repeater&nbsp;</div></li><li><div>                    if ( $is_repeater ) {&nbsp;</div></li><li><div>                        foreach ( $_REQUEST['acf'] as $key =&gt; $submitted ) {&nbsp;</div></li><li><div>                            if ( $key == $parent_field['key'] ) {    &nbsp;</div></li><li><div>                                foreach ( $submitted as $row ) {&nbsp;</div></li><li><div>                                    // there is only one, but we don't know the key&nbsp;</div></li><li><div>                                    foreach ( $row as $submitted2 ) {&nbsp;</div></li><li><div>                                        if ( $submitted2 == $value ) {&nbsp;</div></li><li><div>                                            $value_instances++;&nbsp;</div></li><li><div>                                        }&nbsp;</div></li><li><div>                                        break;&nbsp;</div></li><li><div>                                    }&nbsp;</div></li><li><div>                                }&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // this value came up more than once, so we need to mark it as an error&nbsp;</div></li><li><div>            if ( $value_instances &gt; 1 ) {&nbsp;</div></li><li><div>                $message = __( 'The value', 'acf_vf' ) . &quot; '$value' &quot; . __( 'was submitted multiple times and should be unique for', 'acf_vf' ) . &quot; {$field['label']}.&quot;;&nbsp;</div></li><li><div>                $valid = false;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $valid && $field_is_unique ) {&nbsp;</div></li><li><div>            global $wpdb;&nbsp;</div></li><li><div>            $status_in = &quot;'&quot; . implode( &quot;', '&quot;, $field['unique_statuses'] ) . &quot;'&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // WPML compatibility, get code list of active languages&nbsp;</div></li><li><div>            if ( function_exists( 'icl_object_id' ) ) {&nbsp;</div></li><li><div>                $languages = $wpdb-&gt;get_results( &quot;SELECT code FROM {$wpdb-&gt;prefix}icl_languages WHERE active = 1&quot;, ARRAY_A );&nbsp;</div></li><li><div>                $wpml_ids = array();&nbsp;</div></li><li><div>                foreach( $languages as $lang ) {&nbsp;</div></li><li><div>                    $wpml_ids[] = (int) icl_object_id( $post_id, $post_type, true, $lang['code'] );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>                $post_ids = array_unique( $wpml_ids );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                $post_ids = array( (int) $post_id );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $sql_prefix = &quot;SELECT pm.meta_id AS meta_id, pm.post_id AS post_id, p.post_title AS post_title FROM {$wpdb-&gt;postmeta} pm JOIN {$wpdb-&gt;posts} p ON p.ID = pm.post_id AND p.post_status IN ($status_in)&quot;;&nbsp;</div></li><li><div>            switch ( $unique ) {&nbsp;</div></li><li><div>                case 'global': &nbsp;</div></li><li><div>                    // check to see if this value exists anywhere in the postmeta table&nbsp;</div></li><li><div>                    $sql = $wpdb-&gt;prepare( &nbsp;</div></li><li><div>                        &quot;{$sql_prefix} AND post_id NOT IN ([IN_NOT_IN]) WHERE ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                        $value, &nbsp;</div></li><li><div>                        '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'post_type':&nbsp;</div></li><li><div>                    // check to see if this value exists in the postmeta table with this $post_id&nbsp;</div></li><li><div>                    $sql = $wpdb-&gt;prepare( &nbsp;</div></li><li><div>                        &quot;{$sql_prefix} AND p.post_type = %s WHERE ( ( post_id IN ([IN_NOT_IN]) AND meta_key != %s ) OR post_id NOT IN ([IN_NOT_IN]) ) AND ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                        $post_type, &nbsp;</div></li><li><div>                        $field['name'], &nbsp;</div></li><li><div>                        $value, &nbsp;</div></li><li><div>                        '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'this_post':&nbsp;</div></li><li><div>                    // check to see if this value exists in the postmeta table with this $post_id&nbsp;</div></li><li><div>                    $this_key = $is_repeater ? &nbsp;</div></li><li><div>                        $parent_field['name'] . '_' . $index . '_' . $field['name'] :&nbsp;</div></li><li><div>                        $field['name'];&nbsp;</div></li><li><div>                    $sql = $wpdb-&gt;prepare( &nbsp;</div></li><li><div>                        &quot;{$sql_prefix} AND post_id IN ([IN_NOT_IN]) AND meta_key != %s AND ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                        $this_key, &nbsp;</div></li><li><div>                        $value, &nbsp;</div></li><li><div>                        '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'post_key':&nbsp;</div></li><li><div>                case 'this_post_key':&nbsp;</div></li><li><div>                    // check to see if this value exists in the postmeta table with both this $post_id and $meta_key&nbsp;</div></li><li><div>                    if ( $is_repeater ) {&nbsp;</div></li><li><div>                        $this_key = $parent_field['name'] . '_' . $index . '_' . $field['name'];&nbsp;</div></li><li><div>                        $meta_key = $parent_field['name'] . '_%_' . $field['name'];&nbsp;</div></li><li><div>                        if ( 'post_key' == $unique ) {&nbsp;</div></li><li><div>                            $sql = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                                &quot;{$sql_prefix} AND p.post_type = %s WHERE ( ( post_id IN ([IN_NOT_IN]) AND meta_key != %s AND meta_key LIKE %s ) OR ( post_id NOT IN ([IN_NOT_IN]) AND meta_key LIKE %s ) ) AND ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                                $post_type, &nbsp;</div></li><li><div>                                $this_key, &nbsp;</div></li><li><div>                                $meta_key, &nbsp;</div></li><li><div>                                $meta_key, &nbsp;</div></li><li><div>                                $value, &nbsp;</div></li><li><div>                                '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $sql = $wpdb-&gt;prepare(&nbsp;</div></li><li><div>                                &quot;{$sql_prefix} WHERE post_id IN ([IN_NOT_IN]) AND meta_key != %s AND meta_key LIKE %s AND ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                                $this_key, &nbsp;</div></li><li><div>                                $meta_key, &nbsp;</div></li><li><div>                                $meta_key, &nbsp;</div></li><li><div>                                $value, &nbsp;</div></li><li><div>                                '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    } else {&nbsp;</div></li><li><div>                        if ( 'post_key' == $unique ) {&nbsp;</div></li><li><div>                            $sql = $wpdb-&gt;prepare( &nbsp;</div></li><li><div>                                &quot;{$sql_prefix} AND p.post_type = %s AND post_id NOT IN ([IN_NOT_IN]) WHERE meta_key = %s AND ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                                $post_type, &nbsp;</div></li><li><div>                                $field['name'], &nbsp;</div></li><li><div>                                $value, &nbsp;</div></li><li><div>                                '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        } else {&nbsp;</div></li><li><div>                            $sql = $wpdb-&gt;prepare( &nbsp;</div></li><li><div>                                &quot;{$sql_prefix} AND post_id IN ([IN_NOT_IN]) WHERE meta_key = %s AND ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                                $field['name'], &nbsp;</div></li><li><div>                                $value, &nbsp;</div></li><li><div>                                '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                case 'this_post_key':&nbsp;</div></li><li><div>                    // check to see if this value exists in the postmeta table with this $post_id&nbsp;</div></li><li><div>                    $sql = $wpdb-&gt;prepare( &nbsp;</div></li><li><div>                        &quot;{$sql_prefix} AND p.post_type = %s WHERE ( ( post_id IN ([IN_NOT_IN]) AND meta_key = %s ) ) AND ( meta_value = %s OR meta_value LIKE %s )&quot;, &nbsp;</div></li><li><div>                        $post_type, &nbsp;</div></li><li><div>                        $field['name'], &nbsp;</div></li><li><div>                        $value, &nbsp;</div></li><li><div>                        '%&quot;' . $wpdb-&gt;esc_like( $value ) . '&quot;%'&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>                default:&nbsp;</div></li><li><div>                    // no dice, set $sql to null&nbsp;</div></li><li><div>                    $sql = null;&nbsp;</div></li><li><div>                    break;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // Only run if we hit a condition above&nbsp;</div></li><li><div>            if ( ! empty( $sql ) ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Update the [IN_NOT_IN] values&nbsp;</div></li><li><div>                $sql = $this-&gt;prepare_in_and_not_in( $sql, $post_ids );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Execute the SQL&nbsp;</div></li><li><div>                $rows = $wpdb-&gt;get_results( $sql );&nbsp;</div></li><li><div>                if ( count( $rows ) ) {&nbsp;</div></li><li><div>                    // We got some matches, but there might be more than one so we need to concatenate the collisions&nbsp;</div></li><li><div>                    $conflicts = &quot;&quot;;&nbsp;</div></li><li><div>                    foreach ( $rows as $row ) {&nbsp;</div></li><li><div>                        $permalink = ( $frontend )? get_permalink( $row-&gt;post_id ) : &quot;/wp-admin/post.php?post={$row-&gt;post_id}&action=edit&quot;;&nbsp;</div></li><li><div>                        $conflicts.= &quot;&lt;a href='{$permalink}' style='color:inherit;text-decoration:underline;'&gt;{$row-&gt;post_title}&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>                        if ( $row !== end( $rows ) ) $conflicts.= ', ';&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                    $message = __( 'The value', 'acf_vf' ) . &quot; '$value' &quot; . __( 'is already in use by', 'acf_vf' ) . &quot; {$conflicts}.&quot;;&nbsp;</div></li><li><div>                    $valid = false;&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // ACF will use any message as an error&nbsp;</div></li><li><div>        if ( ! $valid ) $valid = $message;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $valid;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    private function prepare_in_and_not_in( $sql, $post_ids ) {&nbsp;</div></li><li><div>        global $wpdb;&nbsp;</div></li><li><div>        $not_in_count = substr_count( $sql, '[IN_NOT_IN]' );&nbsp;</div></li><li><div>        if ( $not_in_count &gt; 0 ) {&nbsp;</div></li><li><div>            $args = array( str_replace( '[IN_NOT_IN]', implode( ', ', array_fill( 0, count( $post_ids ), '%d' ) ), str_replace( '%', '%%', $sql ) ) );&nbsp;</div></li><li><div>            for ( $i=0; $i &lt; substr_count( $sql, '[IN_NOT_IN]' ); $i++ ) { &nbsp;</div></li><li><div>                $args = array_merge( $args, $post_ids );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            $sql = call_user_func_array( array( $wpdb, 'prepare' ), $args );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        return $sql;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  render_field_settings()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Create extra settings for your field. These are visible when editing a field&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $field (array) the $field being edited&nbsp;</div></li><li><div>    *  @return    n/a&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    function render_field_settings( $field ) {&nbsp;</div></li><li><div>        //return;&nbsp;</div></li><li><div>        // defaults?&nbsp;</div></li><li><div>        $field = $this-&gt;setup_field( $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // key is needed in the field names to correctly save the data&nbsp;</div></li><li><div>        $key = $field['key'];&nbsp;</div></li><li><div>        $html_key = 'acf_fields-'.$field['ID'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $field );&nbsp;</div></li><li><div>        $sub_field['prefix'] = &quot;{$field['prefix']}[sub_field]&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // remove types that don't jive well with this one&nbsp;</div></li><li><div>        $fields_names = apply_filters( 'acf/get_field_types', array() );&nbsp;</div></li><li><div>        unset( $fields_names[__( 'Layout', 'acf' )] );&nbsp;</div></li><li><div>        unset( $fields_names[__( 'Basic', 'acf' )][ 'validated_field' ] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field_id = str_replace(&quot;-temp&quot;, &quot;&quot;, $field['id'] );&nbsp;</div></li><li><div>        $field_key = $field['key'];&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // layout&nbsp;</div></li><li><div>        acf_render_field_setting( $field, array(&nbsp;</div></li><li><div>            'label' =&gt; __( 'Read Only?', 'acf_vf' ), &nbsp;</div></li><li><div>            'instructions' =&gt; __( 'When a field is marked read only, it will be visible but uneditable. Read only fields are marked with ', 'acf_vf' ). '&lt;i class=&quot;fa fa-ban&quot; style=&quot;color:red;&quot; title=&quot;'. __( 'Read only', 'acf_vf' ) . '&quot;&gt;&lt;/i&gt;.', &nbsp;</div></li><li><div>            'type' =&gt; 'radio', &nbsp;</div></li><li><div>            'name' =&gt; 'read_only', &nbsp;</div></li><li><div>            'layout' =&gt; 'horizontal', &nbsp;</div></li><li><div>            'prefix' =&gt; $field['prefix'], &nbsp;</div></li><li><div>            'choices' =&gt; array(&nbsp;</div></li><li><div>                '' =&gt; __( 'No', 'acf_vf' ), &nbsp;</div></li><li><div>                '1' =&gt; __( 'Yes', 'acf_vf' ), &nbsp;</div></li><li><div> )&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Validate Drafts&nbsp;</div></li><li><div>        acf_render_field_setting( $field, array(&nbsp;</div></li><li><div>            'label' =&gt; __( 'Validate Drafts/Preview?', 'acf_vf' ), &nbsp;</div></li><li><div>            'instructions' =&gt; '', &nbsp;</div></li><li><div>            'type' =&gt; 'radio', &nbsp;</div></li><li><div>            'name' =&gt; 'drafts', &nbsp;</div></li><li><div>            'prefix' =&gt; $field['prefix'], &nbsp;</div></li><li><div>            'choices' =&gt; array(&nbsp;</div></li><li><div>                '1' =&gt; __( 'Yes', 'acf_vf' ), &nbsp;</div></li><li><div>                '' =&gt; __( 'No', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'layout' =&gt; 'horizontal', &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( false && ! $this-&gt;drafts ) {&nbsp;</div></li><li><div>            echo '&lt;em&gt;';&nbsp;</div></li><li><div>            _e( 'Warning', 'acf_vf' );&nbsp;</div></li><li><div>            echo ': &lt;code&gt;ACF_VF_DRAFTS&lt;/code&gt; ';&nbsp;</div></li><li><div>            _e( 'has been set to &lt;code&gt;false&lt;/code&gt; which overrides field level configurations', 'acf_vf' );&nbsp;</div></li><li><div>            echo '.&lt;/em&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;acf-field acf-sub_field&quot; data-setting=&quot;validated_field&quot; data-name=&quot;sub_field&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;acf-label&quot;&gt;&nbsp;</div></li><li><div>                &lt;label&gt;&lt;?php _e( 'Validated Field', 'acf_vf' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                &lt;p class=&quot;description&quot;&gt;&lt;/p&gt;        &nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;acf-input&quot;&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>                $atts = array(&nbsp;</div></li><li><div>                    'id' =&gt; 'acfcloneindex', &nbsp;</div></li><li><div>                    'class' =&gt; &quot;field field_type-{$sub_field['type']}&quot;, &nbsp;</div></li><li><div>                    'data-id' =&gt; $sub_field['id'], &nbsp;</div></li><li><div>                    'data-key' =&gt; $sub_field['key'], &nbsp;</div></li><li><div>                    'data-type' =&gt; $sub_field['type'], &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $metas = array(&nbsp;</div></li><li><div>                    'id' =&gt; $sub_field['id'], &nbsp;</div></li><li><div>                    'key' =&gt; $sub_field['key'], &nbsp;</div></li><li><div>                    'parent' =&gt; $sub_field['parent'], &nbsp;</div></li><li><div>                    'save' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;div &lt;?php echo acf_esc_attr( $atts ); ?&gt;&gt;&nbsp;</div></li><li><div>                    &lt;div class=&quot;field-meta acf-hidden&quot;&gt;&nbsp;</div></li><li><div>                        &lt;?php &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        // meta        &nbsp;</div></li><li><div>                        foreach( $metas as $k =&gt; $v ) {&nbsp;</div></li><li><div>                            acf_hidden_input(array( 'class' =&gt; &quot;input-{$k}&quot;, 'name' =&gt; &quot;{$sub_field['prefix']}[{$k}]&quot;, 'value' =&gt; $v ));&nbsp;</div></li><li><div>                        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                        ?&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                    &lt;div class=&quot;sub-field-settings&quot;&gt;            &nbsp;</div></li><li><div>                        &lt;table class=&quot;acf-table&quot;&gt;&nbsp;</div></li><li><div>                            &lt;tbody&gt;&nbsp;</div></li><li><div>                            &lt;?php &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            if ( ! isset( $sub_field['function'] ) || empty( $sub_field['function'] ) ) {&nbsp;</div></li><li><div>                                $sub_field['function'] = 'none';&nbsp;</div></li><li><div>                            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Validated Field Type&nbsp;</div></li><li><div>                            acf_render_field_setting( $sub_field, array(&nbsp;</div></li><li><div>                                'label' =&gt; __( 'Field Type', 'acf_vf' ), &nbsp;</div></li><li><div>                                'instructions' =&gt; __( 'The underlying field type that you would like to validate.', 'acf_vf' ), &nbsp;</div></li><li><div>                                'type' =&gt; 'select', &nbsp;</div></li><li><div>                                'name' =&gt; 'type', &nbsp;</div></li><li><div>                                'prefix' =&gt; $sub_field['prefix'], &nbsp;</div></li><li><div>                                'choices' =&gt; $fields_names, &nbsp;</div></li><li><div>                                'required' =&gt; true&nbsp;</div></li><li><div> ), 'tr' );            &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            // Render the Sub Field&nbsp;</div></li><li><div>                            do_action( &quot;acf/render_field_settings/type={$sub_field['type']}&quot;, $sub_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                            ?&gt;&nbsp;</div></li><li><div>                            &lt;tr class=&quot;field_save acf-field&quot; data-name=&quot;conditional_logic&quot; style=&quot;display:none;&quot;&gt;&nbsp;</div></li><li><div>                                &lt;td class=&quot;acf-label&quot;&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                                &lt;td class=&quot;acf-input&quot;&gt;&lt;/td&gt;&nbsp;</div></li><li><div>                            &lt;/tr&gt;&nbsp;</div></li><li><div>                            &lt;/tbody&gt;&nbsp;</div></li><li><div>                        &lt;/table&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( !empty( $field['mask'] ) && $sub_field['type'] == 'number' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $mask_error = ( !empty( $field['mask'] ) && $sub_field['type'] == 'number' )? &nbsp;</div></li><li><div>            'color:red;' : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Input Mask&nbsp;</div></li><li><div>        acf_render_field_setting( $field, array(&nbsp;</div></li><li><div>            'label' =&gt; __( 'Input mask', 'acf_vf' ), &nbsp;</div></li><li><div>            'instructions' =&gt; __( 'Use &#39;a&#39; to match A-Za-z, &#39;9&#39; to match 0-9, and &#39;*&#39; to match any alphanumeric.', 'acf_vf' ) . &nbsp;</div></li><li><div>                                ' &lt;a href=&quot;http://digitalbush.com/projects/masked-input-plugin/&quot; target=&quot;_new&quot;&gt;' . &nbsp;</div></li><li><div>                                __( 'More info', 'acf_vf' ) . &nbsp;</div></li><li><div>                                '&lt;/a&gt;.&lt;br/&gt;&lt;br/&gt;&lt;strong style=&quot;' . $mask_error . '&quot;&gt;' . &nbsp;</div></li><li><div>                                __( 'Input masking is not compatible with the &quot;number&quot; field type!', 'acf_vf' ) .&nbsp;</div></li><li><div>                                '&lt;/strong&gt;', &nbsp;</div></li><li><div>            'type' =&gt; 'text', &nbsp;</div></li><li><div>            'name' =&gt; 'mask', &nbsp;</div></li><li><div>            'prefix' =&gt; $field['prefix'], &nbsp;</div></li><li><div>            'value' =&gt; $field['mask'], &nbsp;</div></li><li><div>            'layout' =&gt; 'horizontal', &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Validation Function&nbsp;</div></li><li><div>        acf_render_field_setting( $field, array(&nbsp;</div></li><li><div>            'label' =&gt; __( 'Validation Function', 'acf_vf' ), &nbsp;</div></li><li><div>            'instructions' =&gt; __( 'How should the field be server side validated?', 'acf_vf' ), &nbsp;</div></li><li><div>            'type' =&gt; 'select', &nbsp;</div></li><li><div>            'name' =&gt; 'function', &nbsp;</div></li><li><div>            'prefix' =&gt; $field['prefix'], &nbsp;</div></li><li><div>            'value' =&gt; $field['function'], &nbsp;</div></li><li><div>            'choices' =&gt; array(&nbsp;</div></li><li><div>                'none' =&gt; __( 'None', 'acf_vf' ), &nbsp;</div></li><li><div>                'regex' =&gt; __( 'Regular Expression', 'acf_vf' ), &nbsp;</div></li><li><div>                //'sql' =&gt; __( 'SQL Query', 'acf_vf' ), &nbsp;</div></li><li><div>                'php' =&gt; __( 'PHP Statement', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'layout' =&gt; 'horizontal', &nbsp;</div></li><li><div>            'optgroup' =&gt; true, &nbsp;</div></li><li><div>            'multiple' =&gt; '0', &nbsp;</div></li><li><div>            'class' =&gt; 'validated_select validation-function', &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;tr class=&quot;acf-field validation-settings&quot; data-setting=&quot;validated_field&quot; data-name=&quot;pattern&quot; id=&quot;field_option_&lt;?php echo $html_key; ?&gt;_validation&quot;&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;acf-label&quot;&gt;&nbsp;</div></li><li><div>                &lt;label&gt;&lt;?php _e( 'Pattern', 'acf_vf' ); ?&gt;&lt;/label&gt;&nbsp;</div></li><li><div>                &lt;p class=&quot;description&quot;&gt;    &nbsp;</div></li><li><div>                &lt;small&gt;&nbsp;</div></li><li><div>                &lt;div class=&quot;validation-info&quot;&gt;&nbsp;</div></li><li><div>                    &lt;div class='validation-type regex'&gt;&nbsp;</div></li><li><div>                        &lt;?php _e( 'Pattern match the input using', 'acf_vf' ); ?&gt; &lt;a href=&quot;http://php.net/manual/en/function.preg-match.php&quot; target=&quot;_new&quot;&gt;PHP preg_match()&lt;/a&gt;.&nbsp;</div></li><li><div>                        &lt;br /&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class='validation-type php'&gt;&nbsp;</div></li><li><div>                        &lt;ul&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;&lt;?php _e( 'Use any PHP code and return true for success or false for failure. If nothing is returned it will evaluate to true.', 'acf_vf' ); ?&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;&lt;?php _e( 'Available variables', 'acf_vf' ); ?&gt;:&nbsp;</div></li><li><div>                            &lt;ul&gt;&nbsp;</div></li><li><div>                                &lt;li&gt;&lt;code&gt;$post_id = $post-&gt;ID&lt;/code&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                                &lt;li&gt;&lt;code&gt;$post_type = $post-&gt;post_type&lt;/code&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                                &lt;li&gt;&lt;code&gt;$name = meta_key&lt;/code&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                                &lt;li&gt;&lt;code&gt;$value = form value&lt;/code&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                                &lt;li&gt;&lt;code&gt;$prev_value = db value&lt;/code&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                                &lt;li&gt;&lt;code&gt;$inputs = array(&lt;blockquote&gt;'field'=&gt;?, &lt;br/&gt;'value'=&gt;?, &lt;br/&gt;'prev_value'=&gt;?&lt;br/&gt;&lt;/blockquote&gt;)&lt;/code&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                                &lt;li&gt;&lt;code&gt;&amp;$message = error message&lt;/code&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;/ul&gt;&nbsp;</div></li><li><div>                            &lt;/li&gt;&nbsp;</div></li><li><div>                            &lt;li&gt;&lt;?php _e( 'Example', 'acf_vf' ); ?&gt;: &nbsp;</div></li><li><div>                            &lt;small&gt;&lt;code&gt;&lt;pre&gt;if ( empty( $value ) ) {&nbsp;</div></li><li><div>  $message = 'required!'; &nbsp;</div></li><li><div>  return false;&nbsp;</div></li><li><div>}&lt;/pre&gt;&lt;/code&gt;&lt;/small&gt;&lt;/li&gt;&nbsp;</div></li><li><div>                        &lt;/ul&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                    &lt;div class='validation-type sql'&gt;&nbsp;</div></li><li><div>                        &lt;?php _e( 'SQL', 'acf_vf' ); ?&gt;.&nbsp;</div></li><li><div>                        &lt;br /&gt;&nbsp;</div></li><li><div>                    &lt;/div&gt;&nbsp;</div></li><li><div>                &lt;/div&gt; &nbsp;</div></li><li><div>                &lt;/small&gt;&nbsp;</div></li><li><div>                &lt;/p&gt;        &nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>            &lt;td class=&quot;acf-input&quot;&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Pattern&nbsp;</div></li><li><div>                acf_render_field( array(&nbsp;</div></li><li><div>                    'label' =&gt; __( 'Pattern', 'acf_vf' ), &nbsp;</div></li><li><div>                    'instructions' =&gt; '', &nbsp;</div></li><li><div>                    'type' =&gt; 'textarea', &nbsp;</div></li><li><div>                    'name' =&gt; 'pattern', &nbsp;</div></li><li><div>                    'prefix' =&gt; $field['prefix'], &nbsp;</div></li><li><div>                    'value' =&gt; $field['pattern'], &nbsp;</div></li><li><div>                    'layout' =&gt; 'horizontal', &nbsp;</div></li><li><div>                    'class' =&gt; 'editor', &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;div id=&quot;&lt;?php echo $field_id; ?&gt;-editor&quot; class='ace-editor' style=&quot;height:200px;&quot;&gt;&lt;?php echo $field['pattern']; ?&gt;&lt;/div&gt;&nbsp;</div></li><li><div>            &lt;/td&gt;&nbsp;</div></li><li><div>        &lt;/tr&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Error Message&nbsp;</div></li><li><div>        acf_render_field_setting( $field, array(&nbsp;</div></li><li><div>            'label' =&gt; __( 'Error Message', 'acf_vf' ), &nbsp;</div></li><li><div>            'instructions' =&gt; __( 'The default error message that is returned to the client.', 'acf_vf' ), &nbsp;</div></li><li><div>            'type' =&gt; 'text', &nbsp;</div></li><li><div>            'name' =&gt; 'message', &nbsp;</div></li><li><div>            'prefix' =&gt; $field['prefix'], &nbsp;</div></li><li><div>            'value' =&gt; $field['message'], &nbsp;</div></li><li><div>            'layout' =&gt; 'horizontal', &nbsp;</div></li><li><div>            'class' =&gt; 'validation-settings'&nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Validation Function&nbsp;</div></li><li><div>        acf_render_field_setting( $field, array(&nbsp;</div></li><li><div>            'label' =&gt; __( 'Unique Value?', 'acf_vf' ), &nbsp;</div></li><li><div>            'instructions' =&gt; __( &quot;Make sure this value is unique for...&quot;, 'acf_vf' ), &nbsp;</div></li><li><div>            'type' =&gt; 'select', &nbsp;</div></li><li><div>            'name' =&gt; 'unique', &nbsp;</div></li><li><div>            'prefix' =&gt; $field['prefix'], &nbsp;</div></li><li><div>            'value' =&gt; $field['unique'], &nbsp;</div></li><li><div>            'choices' =&gt; array(&nbsp;</div></li><li><div>                'non-unique' =&gt; __( 'Non-Unique Value', 'acf_vf' ), &nbsp;</div></li><li><div>                'global' =&gt; __( 'Unique Globally', 'acf_vf' ), &nbsp;</div></li><li><div>                'post_type' =&gt; __( 'Unique For Post Type', 'acf_vf' ), &nbsp;</div></li><li><div>                'post_key' =&gt; __( 'Unique For Post Type', 'acf_vf' ) . ' + ' . __( 'Field/Meta Key', 'acf_vf' ), &nbsp;</div></li><li><div>                'this_post' =&gt; __( 'Unique For Post', 'acf_vf' ), &nbsp;</div></li><li><div>                'this_post_key' =&gt; __( 'Unique For Post', 'acf_vf' ) . ' + ' . __( 'Field/Meta Key', 'acf_vf' ), &nbsp;</div></li><li><div> ), &nbsp;</div></li><li><div>            'layout' =&gt; 'horizontal', &nbsp;</div></li><li><div>            'optgroup' =&gt; false, &nbsp;</div></li><li><div>            'multiple' =&gt; '0', &nbsp;</div></li><li><div>            'class' =&gt; 'validated_select validation-unique', &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Unique Status&nbsp;</div></li><li><div>        $statuses = $this-&gt;get_post_statuses();&nbsp;</div></li><li><div>        $choices = array();&nbsp;</div></li><li><div>        foreach ( $statuses as $value =&gt; $status ) {&nbsp;</div></li><li><div>            $choices[$value] = $status-&gt;label;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        acf_render_field_setting( $field, array(&nbsp;</div></li><li><div>            'label' =&gt; __( 'Apply to...?', 'acf_vf' ), &nbsp;</div></li><li><div>            'instructions' =&gt; __( &quot;Make sure this value is unique for the checked post statuses.&quot;, 'acf_vf' ), &nbsp;</div></li><li><div>            'type' =&gt; 'checkbox', &nbsp;</div></li><li><div>            'name' =&gt; 'unique_statuses', &nbsp;</div></li><li><div>            'prefix' =&gt; $field['prefix'], &nbsp;</div></li><li><div>            'value' =&gt; $field['unique_statuses'], &nbsp;</div></li><li><div>            'choices' =&gt; $choices, &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  render_field()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  Create the HTML interface for your field&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $field (array) the $field being rendered&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $field (array) the $field being edited&nbsp;</div></li><li><div>    *  @return    n/a&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    &nbsp;</div></li><li><div>    function render_field( $field ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        global $post, $pagenow;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $is_new = $pagenow=='post-new.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field = $this-&gt;setup_field( $field );&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        ?&gt;&nbsp;</div></li><li><div>        &lt;div class=&quot;validated-field&quot;&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>            if ( $field['read_only'] && $field['read_only'] != 'false' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;p&gt;&nbsp;</div></li><li><div>                &lt;?php &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Buffer output&nbsp;</div></li><li><div>                ob_start();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Render the subfield&nbsp;</div></li><li><div>                echo apply_filters( 'acf/render_field/type='.$sub_field['type'], $sub_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Try to make the field readonly&nbsp;</div></li><li><div>                $contents = ob_get_contents();&nbsp;</div></li><li><div>                $contents = preg_replace(&quot;~&lt;(input|textarea|select)~&quot;, &quot;&lt;\${1} disabled=true read_only&quot;, $contents );&nbsp;</div></li><li><div>                $contents = preg_replace(&quot;~acf-hidden~&quot;, &quot;acf-hidden acf-vf-readonly&quot;, $contents );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Stop buffering&nbsp;</div></li><li><div>                ob_end_clean();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // Return our (hopefully) readonly input.&nbsp;</div></li><li><div>                echo $contents;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                ?&gt;&nbsp;</div></li><li><div>                &lt;/p&gt;&nbsp;</div></li><li><div>                &lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                // wrapper for other fields, especially relationship&nbsp;</div></li><li><div>                echo &quot;&lt;div class='acf-field acf-field-{$sub_field['type']} field_type-{$sub_field['type']}' data-type='{$sub_field['type']}' data-key='{$sub_field['key']}'&gt;&lt;div class='acf-input'&gt;&quot;;&nbsp;</div></li><li><div>                echo apply_filters( 'acf/render_field/type='.$sub_field['type'], $sub_field );&nbsp;</div></li><li><div>                echo &quot;&lt;/div&gt;&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>        &lt;/div&gt;&nbsp;</div></li><li><div>        &lt;?php&nbsp;</div></li><li><div>        if ( ! empty( $field['mask'] ) && ( $is_new || ( isset( $field['read_only'] ) && ( ! $field['read_only'] || $field['read_only'] == 'false' ) ) ) ) {&nbsp;</div></li><li><div>            // we have to use $sub_field['key'] since new repeater fields don't have a unique ID&nbsp;</div></li><li><div>            ?&gt;&nbsp;</div></li><li><div>            &lt;script type=&quot;text/javascript&quot;&gt;&nbsp;</div></li><li><div>                (function($) {&nbsp;</div></li><li><div>                    $(&quot;.field_key-&lt;?php echo $sub_field['key']; ?&gt; input&quot;).each( function() {&nbsp;</div></li><li><div>                        $(this).mask(&quot;&lt;?php echo $field['mask']?&gt;&quot;);&nbsp;</div></li><li><div>                    });&nbsp;</div></li><li><div>                })(jQuery);&nbsp;</div></li><li><div>            &lt;/script&gt;&nbsp;</div></li><li><div>            &lt;?php&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  input_admin_enqueue_scripts()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This action is called in the admin_enqueue_scripts action on the edit screen where your field is created.&nbsp;</div></li><li><div>    *  Use this action to add css + javascript to assist your create_field() action.&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  $info    http://codex.wordpress.org/Plugin_API/Action_Reference/admin_enqueue_scripts&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function input_admin_enqueue_scripts() {&nbsp;</div></li><li><div>        // register acf scripts&nbsp;</div></li><li><div>        $min = ( ! $this-&gt;debug )? '.min' : '';&nbsp;</div></li><li><div>        wp_register_script( 'acf-validated-field-input', plugins_url( &quot;js/input{$min}.js&quot;, __FILE__ ), array( 'acf-validated-field' ), ACF_VF_VERSION );&nbsp;</div></li><li><div>        wp_register_script( 'jquery-masking', plugins_url( &quot;js/jquery.maskedinput{$min}.js&quot;, __FILE__ ), array( 'jquery' ), ACF_VF_VERSION);&nbsp;</div></li><li><div>        wp_register_script( 'sh-core', plugins_url( 'js/shCore.js', __FILE__ ), array( 'acf-input' ), ACF_VF_VERSION );&nbsp;</div></li><li><div>        wp_register_script( 'sh-autoloader', plugins_url( 'js/shAutoloader.js', __FILE__ ), array( 'sh-core' ), ACF_VF_VERSION);&nbsp;</div></li><li><div>        &nbsp;</div></li><li><div>        // enqueue scripts&nbsp;</div></li><li><div>        wp_enqueue_script( array(&nbsp;</div></li><li><div>            'jquery', &nbsp;</div></li><li><div>            'jquery-ui-core', &nbsp;</div></li><li><div>            'jquery-ui-tabs', &nbsp;</div></li><li><div>            'jquery-masking', &nbsp;</div></li><li><div>            'acf-validated-field', &nbsp;</div></li><li><div>            'acf-validated-field-input', &nbsp;</div></li><li><div> ));&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  input_admin_footer()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This action is called in the wp_head/admin_head action on the edit screen where your field is created.&nbsp;</div></li><li><div>    *  Use this action to add css and javascript to assist your create_field() action.&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    action (admin_footer)&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    n/a&nbsp;</div></li><li><div>    *  @return    n/a&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function input_admin_footer() {&nbsp;</div></li><li><div>        wp_deregister_style('font-awesome');&nbsp;</div></li><li><div>        wp_enqueue_style( 'font-awesome', plugins_url( 'css/font-awesome/css/font-awesome.min.css', __FILE__ ), array(), '4.2.0' ); &nbsp;</div></li><li><div>        wp_enqueue_style( 'acf-validated_field', plugins_url( 'css/input.css', __FILE__ ), array(), ACF_VF_VERSION ); &nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  field_group_admin_enqueue_scripts()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This action is called in the admin_enqueue_scripts action on the edit screen where your field is edited.&nbsp;</div></li><li><div>    *  Use this action to add css + javascript to assist your create_field_options() action.&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  $info    http://codex.wordpress.org/Plugin_API/Action_Reference/admin_enqueue_scripts&nbsp;</div></li><li><div>    *  @type    action&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function field_group_admin_enqueue_scripts() {&nbsp;</div></li><li><div>        wp_enqueue_script( 'ace-editor', plugins_url( 'js/ace/ace.js', __FILE__ ), array(), '1.1.7' );&nbsp;</div></li><li><div>        wp_enqueue_script( 'ace-ext-language_tools', plugins_url( 'js/ace/ext-language_tools.js', __FILE__ ), array(), '1.1.7' );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  load_value()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $value after it is loaded from the db&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $value - the value found in the database&nbsp;</div></li><li><div>    *  @param    $post_id - the $post_id from which the value was loaded from&nbsp;</div></li><li><div>    *  @param    $field - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $value - the value to be saved in te database&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function load_value( $value, $post_id, $field ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        return apply_filters( 'acf/load_value/type='.$sub_field['type'], $value, $post_id, $sub_field );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  update_value()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $value before it is updated in the db&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $value - the value which will be saved in the database&nbsp;</div></li><li><div>    *  @param    $post_id - the $post_id of which the value will be saved&nbsp;</div></li><li><div>    *  @param    $field - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $value - the modified value&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function update_value( $value, $post_id, $field ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        return apply_filters( 'acf/update_value/type='.$sub_field['type'], $value, $post_id, $sub_field );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  format_value()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $value after it is loaded from the db and before it is passed to the create_field action&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $value    - the value which was loaded from the database&nbsp;</div></li><li><div>    *  @param    $post_id - the $post_id from which the value was loaded&nbsp;</div></li><li><div>    *  @param    $field    - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $value    - the modified value&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function format_value( $value, $post_id, $field ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        return apply_filters( 'acf/format_value/type='.$sub_field['type'], $value, $post_id, $sub_field );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  format_value_for_api()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $value after it is loaded from the db and before it is passed back to the api functions such as the_field&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $value    - the value which was loaded from the database&nbsp;</div></li><li><div>    *  @param    $post_id - the $post_id from which the value was loaded&nbsp;</div></li><li><div>    *  @param    $field    - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $value    - the modified value&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function format_value_for_api( $value, $post_id, $field ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        return apply_filters( 'acf/format_value_for_api/type='.$sub_field['type'], $value, $post_id, $sub_field );&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  load_field()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $field after it is loaded from the database&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $field - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $field - the field array holding all the field options&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function load_field( $field ) {&nbsp;</div></li><li><div>        $field = $this-&gt;setup_field( $field );&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $field );&nbsp;</div></li><li><div>        $sub_field = apply_filters( 'acf/load_field/type='.$sub_field['type'], $sub_field );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // The relationship field gets settings from the sub_field so we need to return it since it effectively displays through this method.&nbsp;</div></li><li><div>        if ( 'relationship' == $sub_field['type'] && isset( $_POST['action'] ) && $_POST['action'] == 'acf/fields/relationship/query' ) {&nbsp;</div></li><li><div>            // the name is the key, so use _name&nbsp;</div></li><li><div>            $sub_field['name'] = $sub_field['_name'];&nbsp;</div></li><li><div>            return $sub_field;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $field['sub_field'] = $sub_field;&nbsp;</div></li><li><div>        if ( $field['read_only'] && $field['read_only'] != 'false' && get_post_type() != 'acf-field-group' ) {&nbsp;</div></li><li><div>            $field['label'] .= ' &lt;i class=&quot;fa fa-ban&quot; style=&quot;color:red;&quot; title=&quot;'. __( 'Read only', 'acf_vf' ) . '&quot;&gt;&lt;/i&gt;';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Just avoid using any type of quotes in the db values&nbsp;</div></li><li><div>        $field['pattern'] = str_replace( &quot;%%squot%%&quot;, &quot;'&quot;, $field['pattern'] );&nbsp;</div></li><li><div>        $field['pattern'] = str_replace( &quot;%%dquot%%&quot;, '&quot;', $field['pattern'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>    *  update_field()&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  This filter is appied to the $field before it is saved to the database&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @type    filter&nbsp;</div></li><li><div>    *  @since    3.6&nbsp;</div></li><li><div>    *  @date    23/01/13&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @param    $field - the field array holding all the field options&nbsp;</div></li><li><div>    *&nbsp;</div></li><li><div>    *  @return    $field - the modified field&nbsp;</div></li><li><div>    */&nbsp;</div></li><li><div>    function update_field( $field ) {&nbsp;</div></li><li><div>        $sub_field = $this-&gt;setup_sub_field( $this-&gt;setup_field( $field ) );&nbsp;</div></li><li><div>        $sub_field = apply_filters( 'acf/update_field/type='.$sub_field['type'], $sub_field );&nbsp;</div></li><li><div>        $field['sub_field'] = $sub_field;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Just avoid using any type of quotes in the db values&nbsp;</div></li><li><div>        $field['pattern'] = str_replace( &quot;'&quot;, &quot;%%squot%%&quot;, $field['pattern'] );&nbsp;</div></li><li><div>        $field['pattern'] = str_replace( '&quot;', &quot;%%dquot%%&quot;, $field['pattern'] );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $field;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 1.7.3</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.7/classes/acf_field_validated_field/" class="">1.7.7</a></li><li><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.6/classes/acf_field_validated_field/" class="">1.7.6</a></li><li><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.5/classes/acf_field_validated_field/" class="">1.7.5</a></li><li><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.4/classes/acf_field_validated_field/" class="active">1.7.4</a></li><li><a href="http://hookr.io/plugins/advanced-custom-fields-validated-field/1.7.3/classes/acf_field_validated_field/" class="">1.7.3</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>acf_field_validated_field</li><li><span></span>Advanced Custom Fields: Validated Field</li><li><span></span>1.7.7</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2018 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>