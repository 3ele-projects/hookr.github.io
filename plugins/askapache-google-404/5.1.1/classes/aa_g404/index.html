<!DOCTYPE html> <!--[if lt IE 7]><html class="hookr class lt-ie9 lt-ie8 lt-ie7 ie"><![endif]--> <!--[if IE 7]><html class="hookr class lt-ie9 lt-ie8 ie7 ie"><![endif]--> <!--[if IE 8]><html class="hookr class lt-ie9 ie8 ie"><![endif]--> <!--[if IE 9]><html class="hookr class ie9 ie"><![endif]--> <!--[if gt IE 9]><html class="hookr class gt-ie9 ie"><![endif]--><html lang="en-US" id="single" class="hookr class" data-site="plugin" data-version="5.1.1" data-slug="askapache-google-404" data-type="class" data-id="10755"><head xmlns="http://www.w3.org/1999/xhtml"><title> aa_g404 | class | Askapache Google 404 | hookr.io</title><meta charset="UTF-8"><meta name="author" content="thepassionofthechris \m/," /><meta name="keywords" content="AA_G404, class, plugin, askapache-google-404, 5.1.1" /><meta name="description" content="AA_G404" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"><link rel="shortcut icon" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.ico" /><link rel="icon" type="image/png" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.png"><link rel="icon" type="image/gif" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.gif"><link rel="icon" type="image/jpeg" href="http://hookr.io/wp-content/themes/hookr/assets/images/favicon.jpg"><meta name="google-site-verification" content="Q5dnl0YziNqRLCBxFtc2Rd8vUuueYAt6VIUYZItvEL4" /><script type="text/javascript">/*<![CDATA[*/window._wpemojiSettings={"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/hookr.io\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.11"}};!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;return g&&g.fillText?(g.textBaseline="top",g.font="600 32px Arial","flag"===a?(g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3):"diversity"===a?(g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e):("simple"===a?g.fillText(h(55357,56835),0,0):g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);/*]]>*/</script><style type="text/css">img.wp-smiley,img.emoji{display:inline !important;border:none !important;box-shadow:none !important;height:1em !important;width:1em !important;margin:0
.07em !important;vertical-align:-0.1em !important;background:none !important;padding:0
!important}</style><link rel='stylesheet' id='screen-css'  href='http://hookr.io/wp-content/themes/hookr/assets/css/hookr.css?ver=aeb7f09c6fa084578f8e20b95fe7fdea' type='text/css' media='screen' /><link rel='stylesheet' id='qtip-css'  href='http://hookr.io/wp-content/themes/hookr/assets/vendor/jquery.qtip.custom/jquery.qtip.min.css?ver=4.4.11' type='text/css' media='screen' /><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fU9dGoIwDLsQW_XbHbyAXmCMAsNBsS2otxcYvqFP_UmaJg66x4T8LtzemD427BVtH4fiBC3RncGLoAp0AqWYRDS2lA4ZMw4VMZREKsp-NM46e14PlShpHJc_UwSsawz6R6CbURX38oNzDUwp3egSX1iZ3osif0PIhinVK3YQI9NsWNYRs6dAnCNt0zNWDW4OPw.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdTPzS8tTtXLzcwDAA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/fZBBDsIwDAQ_RG1Kn8AvuKWJUQ1JHBIXVF5PKOoFKZV8Gc_KK3nAmVHNWCBwPAxfKp4d5ZWPOIncM5pSSAve6jxmygskbyxN4mvwP_Sk6KRSSJ6vS9dDD6eNGkdXbu3hV9nUs7JvSpNqrzXK0uwFKyFJpKg7V3jPwZPp1XjDm7JYz2kUk10XTFHK6LgoXqo5b-YD.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9DPyM_PLtJPLC5OLSnWL0vNS8kv0s8qLE0tqtQrLMks0EsuLS7Jz0URys3MAwA.js"></script><script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9YvzdRPTUtLTS7RzchMz8gB4hK93Mw8HQP9jPz87CL9xOLi1JJi_axiCF8vsSBTrzgzLz0nFQA.js"></script><link rel='https://api.w.org/' href='http://hookr.io/wp-json/' /><link rel="canonical" href="http://hookr.io/classes/aa_g404/" /><link rel="alternate" type="application/json+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Faa_g404%2F" /><link rel="alternate" type="text/xml+oembed" href="http://hookr.io/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhookr.io%2Fclasses%2Faa_g404%2F&#038;format=xml" /><script>/*<![CDATA[*/if('undefined'===typeof Hookr)
var Hookr={};if('undefined'===typeof Hookr.Util)
Hookr.Util={};Hookr.Util=jQuery&&jQuery.extend(Hookr.Util,{"adminAjax":"http:\/\/hookr.io\/wp-admin\/admin-ajax.php","themeUrl":"http:\/\/hookr.io\/wp-content\/themes\/hookr\/","apiKey":"plugin-askapache-google-404-5.1.1-class-aa_g404","actions":{"popover":0,"range":1,"search":2,"stat":3}});/*]]>*/</script><!--[if lt IE 9]><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv.js"></script><script src="http://hookr.io/wp-content/themes/hookr/assets/js/html5shiv-printshiv.js"></script><![endif]--></head><body id="aa_g404" class="single single-class single-format-standard"><div id="gutter"><div><ul id="nav-breadcrumb" role="navigation" class="pivot clear fix"><li class="home"><a title="Go to hookr.io." href="http://hookr.io" class="home">hookr.io</a></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to plugins." href="http://hookr.io/plugins/" class=""><span property="name">plugins</span></a><meta property="position" content="2"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to askapache-google-404." href="http://hookr.io/plugins/askapache-google-404/" class="plugin"><span property="name">askapache-google-404</span></a><meta property="position" content="3"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to 5.1.1." href="http://hookr.io/plugins/askapache-google-404/5.1.1/" class="H_VERSION"><span property="name">5.1.1</span></a><meta property="position" content="4"></span></li><li>/</li><li><span property="itemListElement" typeof="ListItem"><a property="item" typeof="WebPage" title="Go to classes." href="http://hookr.io/plugins/askapache-google-404/5.1.1/classes/" class=""><span property="name">classes</span></a><meta property="position" content="5"></span></li><li>/</li><li class="current_item"><span property="itemListElement" typeof="ListItem"><span property="name">aa_g404</span><meta property="position" content="6"></span></li></ul></div></div><header class="jv-fixed"><div> <button class="btn" data-jv-trigger="left"><span></span></button><h1 title="hookr.io"><a href="http://hookr.io" title="hookr.io"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/hookr.svg" title="The WordPress Hook/API Index" alt="The WordPress Hook/API Index"/></a></h1> <nav id="nav-api-types" class="pivot clearfix" data-jv-order="0" data-jv-content="left" data-active="class"><ul role="navigation"><li class="" data-id="all" data-count="16"><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/all/" title="All">All <span class="count badge">16</span></a></li><li class="" data-id="new" data-count="0"><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/new/" title="New">New <span class="count badge">0</span></a></li><li class="" data-id="hooks" data-count="0"><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/hooks/" title="Hooks">Hooks <span class="count badge">0</span></a></li><li class="" data-id="action" data-count="0"><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/actions/" title="Actions">Actions <span class="count badge">0</span></a></li><li class="" data-id="filter" data-count="0"><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/filters/" title="Filters">Filters <span class="count badge">0</span></a></li><li class="active" data-id="class" data-count="2"><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/classes/" title="Classes">Classes <span class="count badge">2</span></a></li><li class="" data-id="constant" data-count="5"><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/constants/" title="Constants">Constants <span class="count badge">5</span></a></li><li class="" data-id="function" data-count="9"><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/functions/" title="Functions">Functions <span class="count badge">9</span></a></li><li class="" data-id="shortcode" data-count="0"><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/shortcodes/" title="Shortcodes">Shortcodes <span class="count badge">0</span></a></li></ul> </nav> <nav id="nav-main" class="pivot" data-jv-order="1" data-jv-content="left"><ul role="navigation"><li class=""><a href="http://hookr.io/all/" title="Core">Core</a></li><li class="active"><a href="http://hookr.io/plugins/" title="Plugins">Plugins</a></li><li class=""><a href="http://hookr.io/themes/" title="Themes">Themes</a></li><li class=""><a href="http://hookr.io/features/" title="Features">Features</a></li><li class=""><a href="http://hookr.io/plugin/" title="Plugin">Plugin</a></li><li class=""><a href="http://hookr.io/about/" title="About">About</a></li><li class=""><a href="http://hookr.io/contact/" title="Contact">Contact</a></li></ul> </nav></div> </header><div role="main" id="middle"><div><div id="mainbar"> <article><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=hookrio" id="_carbonads_js"></script><noscript>derpy.</noscript> <section><h1><strong>AA_G404</strong></h1><p>AA_G404.</p> </section> <section id="defined" class="source"><h2>Defined <span class="count">(1)</span></h2><p>The class is defined in the following location(s).</p><dl><dt><strong><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/files/askapache-google-404/" class="file">/askapache-google-404.php <span>&nbsp;</span></a></strong></dt><dd><pre><ol data-line="51" class="block" start="117"><li><div>class AA_G404 {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // an array of options and values&nbsp;</div></li><li><div>    var $options = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // array to hold plugin information&nbsp;</div></li><li><div>    var $plugin = array();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    // array to hold the css and html&nbsp;</div></li><li><div>    var $code = array(&nbsp;</div></li><li><div>        'css' =&gt; '', &nbsp;</div></li><li><div>        'html' =&gt; '', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads the options into the class vars.&nbsp;</div></li><li><div>     * Adds this plugins 'load' function to the 'load-plugin' hook.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function init() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // load $this-&gt;plugin, $this-&gt;options&nbsp;</div></li><li><div>        $this-&gt;load_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( is_admin() ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // sorry, gotta force a reset&nbsp;</div></li><li><div>            if ( ! isset( $this-&gt;options['cse_id'] ) ) {&nbsp;</div></li><li><div>                $this-&gt;reset_options();&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // add options page&nbsp;</div></li><li><div>            add_action( 'admin_menu', array( &$this, 'admin_menu' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // add load&nbsp;</div></li><li><div>            add_action( &quot;load-{$this-&gt;plugin['hook']}&quot;, array( &$this, 'load' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // hook 404_template to show our 404 template, but only if enabled&nbsp;</div></li><li><div>            if ( ( '1' === $this-&gt;options['enabled'] ) ) {&nbsp;</div></li><li><div>                add_filter( '404_template', array( &$this, 'get_404_template' ), 2000, 1 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The load function executed by the load-plugin hook.  Passes control of request handling to the 'handle_post' function.&nbsp;</div></li><li><div>     * Adds the meta-boxes and the contextual help.&nbsp;</div></li><li><div>     * Enqueues the neccessary js and css files for plugin adminstration.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>        AA_G404D && ISCLOG::tw( ( is_404() ? 'is_404: TRUE' : ' is_404: FALSE' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // load code&nbsp;</div></li><li><div>        $this-&gt;load_code();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // add contextual help&nbsp;</div></li><li><div>        add_action( &quot;admin_head-{$this-&gt;plugin['hook']}&quot;, array( &$this, 'add_help' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // enqueue css - wp_enqueue_style( $handle, $src = false, $deps = array(), $ver = false, $media = 'all' )&nbsp;</div></li><li><div>        wp_enqueue_style( $this-&gt;plugin['pagenice'], plugins_url( 'f/admin.css', __FILE__ ), array( 'wp-jquery-ui-dialog' ), $this-&gt;plugin['version'], 'all' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // enqueue javascript - wp_enqueue_script( $handle, $src = false, $deps = array(), $ver = false, $in_footer = false )&nbsp;</div></li><li><div>        wp_enqueue_script( $this-&gt;plugin['pagenice'], plugins_url( 'f/admin.js', __FILE__ ), array( 'jquery', 'jquery-ui-dialog', 'jquery-ui-tabs', 'jquery-ui-progressbar', 'postbox' ), $this-&gt;plugin['version'], true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // parse and handle post requests to plugin&nbsp;</div></li><li><div>        if ( 'POST' === $_SERVER['REQUEST_METHOD'] ) {&nbsp;</div></li><li><div>            $this-&gt;handle_post();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D && ISCLOG::tw( ( is_404() ? 'is_404: TRUE' : ' is_404: FALSE' ) );&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The main function that lets this plugin handle errors instead of WP's builtin error handling.&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @param string $template The template file&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string    absolute path of php template&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_404_template( $template ) {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>        AA_G404D && ISCLOG::tw( ( is_404() ? 'is_404: TRUE' : ' is_404: FALSE' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // load code&nbsp;</div></li><li><div>        $this-&gt;load_code();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // construct handler class&nbsp;</div></li><li><div>        global $AA_G404_Handler;&nbsp;</div></li><li><div>        if ( ! is_object( $AA_G404_Handler ) ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'AA_G404_Handler NOT AN OBJECT' );&nbsp;</div></li><li><div>            $AA_G404_Handler = aa_g404_get_handler_object();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Now handle the incoming request with AA_G404_Handler::handle_it&nbsp;</div></li><li><div>        $AA_G404_Handler-&gt;handle_it();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Loads the 404 error template specified by the 404_handler option&nbsp;</div></li><li><div>        if ( file_exists( $this-&gt;options['404_handler'] ) ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'loading: ' . $this-&gt;options['404_handler'] );&nbsp;</div></li><li><div>            AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>            return $this-&gt;options['404_handler'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // return for the template_redirect&nbsp;</div></li><li><div>        AA_G404D && ISCLOG::tw( ( is_404() ? 'is_404: TRUE' : ' is_404: FALSE' ) );&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $template;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * currently code is not saved across upgrades due to a potential security issue&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function upgrade_settings() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // upgrade plugin settings&nbsp;</div></li><li><div>        $this-&gt;plugin = $this-&gt;get_plugin_data( true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // current code&nbsp;</div></li><li><div>        $code = get_option( 'askapache_google_404_code' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // code base64_decoded&nbsp;</div></li><li><div>        $codeb64 = ( ( $code !== false && strlen( $code ) &gt; 2 ) ? base64_decode( $code ) : '' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if 46 empty&nbsp;</div></li><li><div>        $codeb64_len = strlen( $codeb64 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( substr( $codeb64, 0, 2 ) === 'a:' ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'code looks to be uncompressed: ' . $codeb64 );&nbsp;</div></li><li><div>            $code = base64_encode( gzdeflate( $codeb64, 1 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( strlen( $code ) &gt; 46 ) {&nbsp;</div></li><li><div>                AA_G404D && ISCLOG::tw( 'saving askapache_google_404_code: ' . $code );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;code = $code;&nbsp;</div></li><li><div>                update_option( 'askapache_google_404_code', $code );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'code is compressed: ' . $codeb64_len );&nbsp;</div></li><li><div>            $this-&gt;code = unserialize( gzinflate( $codeb64 ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // first check $code is valid&nbsp;</div></li><li><div>        if ( $code === false || strlen( $code ) &lt; 20 ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::epx( array( 'code === false', $code ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // set code to defaults&nbsp;</div></li><li><div>            $this-&gt;code = $this-&gt;get_default_code();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } elseif ( @unserialize( $codeb64 ) !== false ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'IS OLD VERSION' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $old_code = unserialize( $codeb64 );&nbsp;</div></li><li><div>            $new_code_compressed = base64_encode( gzdeflate( serialize( $old_code ), 1 ) );&nbsp;</div></li><li><div>            $new_code_uncompressed = unserialize( gzinflate( base64_decode( $new_code_compressed ) ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $new_code_uncompressed === $old_code ) {&nbsp;</div></li><li><div>                AA_G404D && ISCLOG::tw( 'SWITCHING TO NEW VERSION' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                $this-&gt;code = $old_code;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                delete_option( 'askapache_google_404_code' );&nbsp;</div></li><li><div>                add_option( 'askapache_google_404_code', $new_code_compressed, '', 'no' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                AA_G404D && ISCLOG::tw( 'NOT SWITCHING TO NEW VERSION' );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'NEW VERSION ALREADY' );&nbsp;</div></li><li><div>            $this-&gt;code = $code;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // default options&nbsp;</div></li><li><div>        $default_options = $this-&gt;get_default_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // current options&nbsp;</div></li><li><div>        $options = get_option( 'askapache_google_404_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // first check $options is valid or set to defaults&nbsp;</div></li><li><div>        if ( $options === false || ! is_array( $options ) ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::epx( 'options === false or not array!' );&nbsp;</div></li><li><div>            $options = $default_options;&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // the default_options keys&nbsp;</div></li><li><div>            $default_options_keys = array_keys( $default_options );&nbsp;</div></li><li><div>            sort( $default_options_keys );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // keys to current options&nbsp;</div></li><li><div>            $options_keys = array_keys( $options );&nbsp;</div></li><li><div>            sort( $options_keys );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( $default_options_keys != $options_keys ) {&nbsp;</div></li><li><div>                AA_G404D && ISCLOG::epx( 'default_options_keys != options_keys' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                foreach ( $options as $k =&gt; $v ) {&nbsp;</div></li><li><div>                    AA_G404D && ISCLOG::tw( &quot;{$k} =&gt; {$v}&quot; );&nbsp;</div></li><li><div>                    if ( array_key_exists( $k, $default_options ) ) {&nbsp;</div></li><li><div>                        AA_G404D && ISCLOG::epx( &quot;{$k} =&gt; {$v}&quot; );&nbsp;</div></li><li><div>                        $default_options[ $k ] = $v;&nbsp;</div></li><li><div>                    }&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>                // no set the options to the newly updated default_options&nbsp;</div></li><li><div>                $options = $default_options;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get legacy analytics_key and save to options&nbsp;</div></li><li><div>        if ( ! array_key_exists( 'analytics_key', $options ) || empty( $options['analytics_key'] ) ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'searching for analytics_key' );&nbsp;</div></li><li><div>            $analytics_key = get_option( 'aa_google_404_analytics_key' ); // UA-732153-7&nbsp;</div></li><li><div>            $options['analytics_key'] = ( $analytics_key !== false && strlen( $analytics_key ) &gt; 3 ) ? $analytics_key : '';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // update 404_handler in case of __DIR__ changed&nbsp;</div></li><li><div>        if ( strpos( $options['404_handler'], 'plugins/askapache-google-404/404.php' ) !== false ) {&nbsp;</div></li><li><div>            $options['404_handler'] = __DIR__ . '/404.php';&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // now set this-&gt;options to newly created options&nbsp;</div></li><li><div>        $this-&gt;options = $options;&nbsp;</div></li><li><div>        // ------------------------------------------------------------------------------------------------------&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // delete these unused options&nbsp;</div></li><li><div>        delete_option( 'aa_google_404_api_key' );&nbsp;</div></li><li><div>        delete_option( 'aa_google_404_adsense_key' );&nbsp;</div></li><li><div>        delete_option( 'aa_google_404_analytics_key' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save all these variables to database&nbsp;</div></li><li><div>        $this-&gt;save_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads this-&gt;code&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_code() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get code&nbsp;</div></li><li><div>        $code = get_option( 'askapache_google_404_code' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // code decoded&nbsp;</div></li><li><div>        $code_decoded = ( $code !== false ) ? base64_decode( $code ) : '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if 46 empty&nbsp;</div></li><li><div>        $code_decoded_len = strlen( $code_decoded );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $code_decoded_len === 46 ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'code is empty!  Getting and saving default code' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // original code that comes with plugin&nbsp;</div></li><li><div>            $this-&gt;code = $this-&gt;get_default_code();&nbsp;</div></li><li><div>            $this-&gt;save_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // check if code is serialized already, indicating it is not using the newer compression&nbsp;</div></li><li><div>        if ( substr( $code_decoded, 0, 2 ) === 'a:' ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'code looks to be uncompressed: ' . $code_decoded );&nbsp;</div></li><li><div>            $code = base64_encode( gzdeflate( $code_decoded, 1 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( strlen( $code ) &gt; 4 ) {&nbsp;</div></li><li><div>                $this-&gt;code = $code;&nbsp;</div></li><li><div>                update_option( 'askapache_google_404_code', $code );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'code is compressed: ' . $code_decoded_len );&nbsp;</div></li><li><div>            $this-&gt;code = unserialize( gzinflate( $code_decoded ) );&nbsp;</div></li><li><div>            //AA_G404D && ISCLOG::epx( $this-&gt;code );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Loads options named by opts array into correspondingly named class vars&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function load_options() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get options&nbsp;</div></li><li><div>        $this-&gt;options = get_option( 'askapache_google_404_options' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // first try get_option, then parse this __FILE__&nbsp;</div></li><li><div>        $this-&gt;plugin = $this-&gt;get_plugin_data();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Saves options from class vars passed in by opts array and the adsense key and api key&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function save_options() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // save options&nbsp;</div></li><li><div>        update_option( 'askapache_google_404_options', $this-&gt;options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // save plugin&nbsp;</div></li><li><div>        update_option( 'askapache_google_404_plugin', $this-&gt;plugin );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // save code&nbsp;</div></li><li><div>        if ( ! empty( $this-&gt;code ) && is_array( $this-&gt;code ) && array_key_exists( 'css', $this-&gt;code ) ) {&nbsp;</div></li><li><div>            //$code = base64_encode( serialize( $this-&gt;code ) );&nbsp;</div></li><li><div>            $code = base64_encode( gzdeflate( serialize( $this-&gt;code ), 1 ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            if ( strlen( $code ) &gt; 46 ) {&nbsp;</div></li><li><div>                AA_G404D && ISCLOG::tw( &quot;saving askapache_google_404_code as: {$code}&quot; );&nbsp;</div></li><li><div>                update_option( 'askapache_google_404_code', $code );&nbsp;</div></li><li><div>            } else {&nbsp;</div></li><li><div>                AA_G404D && ISCLOG::tw( &quot;NOT saving askapache_google_404_code as: {$code}&quot; );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'this-&gt;code is empty!  not saving' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * this plugin has to protect the code as it is displayed live on error pages, a prime target for malicious crackers and spammers&nbsp;</div></li><li><div>     * can someone help me add the proper code to make sure everything is escaped correctly?&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function handle_post() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if current user does not have manage_options rights, then DIE&nbsp;</div></li><li><div>        if ( ! current_user_can( 'manage_options' ) ) {&nbsp;</div></li><li><div>            wp_die( __( 'You do not have sufficient permissions to manage options for this site.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // verify nonce, if not verified, then DIE&nbsp;</div></li><li><div>        if ( isset( $_POST[ &quot;_{$this-&gt;plugin['nonce']}&quot; ] ) ) {&nbsp;</div></li><li><div>            wp_verify_nonce( $_POST[ &quot;_{$this-&gt;plugin['nonce']}&quot; ], $this-&gt;plugin['nonce'] ) || wp_die( __( '&lt;strong&gt;ERROR&lt;/strong&gt;: Incorrect Form Submission, please try again.' ) );&nbsp;</div></li><li><div>        } elseif ( isset( $_POST['ag4_action_reset'] ) ) {&nbsp;</div></li><li><div>            wp_verify_nonce( $_POST['ag4_action_reset'], 'ag4_action_reset_nonce' ) || wp_die( __( '&lt;strong&gt;ERROR&lt;/strong&gt;: Incorrect Form Submission, please try again.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // resets options to default values&nbsp;</div></li><li><div>        if ( isset( $_POST['ag4_action_reset'] ) ) {&nbsp;</div></li><li><div>            $this-&gt;reset_options();&nbsp;</div></li><li><div>            return;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // load up the current options from the database&nbsp;</div></li><li><div>        $this-&gt;load_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // process absolute integer options&nbsp;</div></li><li><div>        foreach ( array( 'recent_num', 'tag_cloud_num' ) as $k ) {&nbsp;</div></li><li><div>            $this-&gt;options[ $k ] = ( ( isset( $_POST[ &quot;ag4_{$k}&quot; ] ) ) ? absint( $_POST[ &quot;ag4_{$k}&quot; ] ) : absint( $this-&gt;options[ $k ] ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // process options of type string&nbsp;</div></li><li><div>        foreach ( array( 'cse_id', 'analytics_key', 'robots_tag', '404_handler' ) as $k ) {&nbsp;</div></li><li><div>            $this-&gt;options[ $k ] = ( ( isset( $_POST[ &quot;ag4_{$k}&quot; ] ) && ! empty( $_POST[ &quot;ag4_{$k}&quot; ] ) ) ? $_POST[ &quot;ag4_{$k}&quot; ] : $this-&gt;options[ $k ] );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // process on ('1' ) or off ('0' ) options&nbsp;</div></li><li><div>        $on_off_options = array(&nbsp;</div></li><li><div>            'enabled', &nbsp;</div></li><li><div>            'robots_meta', &nbsp;</div></li><li><div>            'recent_posts', &nbsp;</div></li><li><div>            'tag_cloud', &nbsp;</div></li><li><div>            'analytics_log', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        foreach ( $on_off_options as $k ) {&nbsp;</div></li><li><div>            $this-&gt;options[ $k ] = ( ( ! isset( $_POST[ &quot;ag4_{$k}&quot; ] ) ) ? '0' : '1' );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // TODO: Nothing :)&nbsp;</div></li><li><div>        foreach ( array( 'analytics_url' ) as $k ) {&nbsp;</div></li><li><div>            if ( isset( $_POST[ &quot;ag4_{$k}&quot; ] ) ) {&nbsp;</div></li><li><div>                $this-&gt;options[ $k ] = stripslashes( $_POST[ &quot;ag4_{$k}&quot; ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // process incoming unfiltered code&nbsp;</div></li><li><div>        foreach ( array( 'css', 'html' ) as $k ) {&nbsp;</div></li><li><div>            if ( isset( $_POST[ &quot;ag4_{$k}&quot; ] ) && strlen( $_POST[ &quot;ag4_{$k}&quot; ] ) &gt; 10 ) {&nbsp;</div></li><li><div>                $this-&gt;code[ $k ] = stripslashes( $_POST[ &quot;ag4_{$k}&quot; ] );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save code and options arrays to database&nbsp;</div></li><li><div>        $this-&gt;save_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets and sets the default values for the plugin options, then saves them&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function reset_options() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get all the plugin array data&nbsp;</div></li><li><div>        $this-&gt;plugin = $this-&gt;get_plugin_data( true );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // original code that comes with plugin&nbsp;</div></li><li><div>        $this-&gt;code = $this-&gt;get_default_code();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // get default options&nbsp;</div></li><li><div>        $this-&gt;options = $this-&gt;get_default_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // Save all these variables to database&nbsp;</div></li><li><div>        $this-&gt;save_options();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets the default $this-&gt;options&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array   Array of options&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_default_options() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $handler = file_exists( TEMPLATEPATH . '/404.php' ) ? TEMPLATEPATH . '/404.php' : __DIR__ . '/404.php';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $ga = isset( $this-&gt;options['analytics_key'], $this-&gt;options['analytics_key'][5] ) ? $this-&gt;options['analytics_key'] : '';&nbsp;</div></li><li><div>        $cse = isset( $this-&gt;options['cse_id'], $this-&gt;options['cse_id'][15] ) ? $this-&gt;options['cse_id'] : 'partner-pub-4356884677303281:hcqlgw-sn16';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // default options&nbsp;</div></li><li><div>        $options = array(&nbsp;</div></li><li><div>            'cse_id' =&gt; $cse, // partner-pub-4356884677303281:hcqlgw-sn16&nbsp;</div></li><li><div>            'analytics_key' =&gt; $ga, // UA-732153-7&nbsp;</div></li><li><div>            'analytics_url' =&gt; '&quot;/404/?page=&quot; + document.location.pathname + document.location.search + &quot;&from=&quot; + document.referrer', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'enabled' =&gt; '1', // 404 error handling is ON by default&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'analytics_log' =&gt; '1', //&nbsp;</div></li><li><div>&nbsp;&nbsp;</div></li><li><div>            'robots_meta' =&gt; '1', // adding noindex, follow robot meta tag to error pages is ON by default&nbsp;</div></li><li><div>            'robots_tag' =&gt; 'noindex, follow', // the value of the robot meta on error pages&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'recent_posts' =&gt; '1', // showing recent posts on error pages is ON by default&nbsp;</div></li><li><div>            'recent_num' =&gt; 6, // number of recent posts to show&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'tag_cloud' =&gt; '1', // showing a tag cloud on error pages is ON by default&nbsp;</div></li><li><div>            'tag_cloud_num' =&gt; 30, // number tags used to create cloud&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            '404_handler' =&gt; $handler, // the file location of 404 template&nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $options;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Gets the default code for css and html&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array  original_code with 3 keys&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_default_code() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $original_code = array(&nbsp;</div></li><li><div>            'css' =&gt; '#g404ajax {width:99%;overflow:hidden;margin-left:2px;}' . &quot;\n&quot;&nbsp;</div></li><li><div>            . '#g404ajax .gsc-control-cse, ' . &quot;\n&quot; . '#g404ajax .gsc-webResult.gsc-result, ' . &quot;\n&quot; . '#g404ajax .gsc-results .gsc-imageResult, ' . &quot;\n&quot;&nbsp;</div></li><li><div>            . '#g404ajax .cse .gsc-webResult.gsc-result, ' . &quot;\n&quot; . '#g404ajax .gsc-imageResult-column, ' . &quot;\n&quot; . '#g404ajax .gsc-imageResult-classic {border:0};', &nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            'html' =&gt; '&lt;div id=&quot;g404ajax&quot;&gt;' . &quot;\n&quot; . '%google%' . &quot;\n\n&quot; . '&lt;p style=&quot;clear:both;&quot;&gt;&lt;/p&gt;' . &quot;\n\n&quot; . '&lt;/div&gt;&lt;!--g404ajax--&gt;'&nbsp;</div></li><li><div>            . &quot;\n\n&quot; . '&lt;h3&gt;Recent Posts&lt;/h3&gt;' . &quot;\n&quot; . '%recent_posts%' . &quot;\n\n&quot; . '&lt;h3&gt;Popular topics:&lt;/h3&gt;' . &quot;\n&quot; . '%tag_cloud%', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>        return $original_code;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add options page to admin menu&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function admin_menu() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // add_options_page( $page_title, $menu_title, $capability, $menu_slug, $function = '' ) {&nbsp;</div></li><li><div>        add_options_page( $this-&gt;plugin['plugin-name'], $this-&gt;plugin['short-name'], 'manage_options', $this-&gt;plugin['page'], array( &$this, 'options_page' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * The main options page&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function options_page() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( ! current_user_can( 'manage_options' ) ) {&nbsp;</div></li><li><div>            wp_die( __( 'You do not have sufficient permissions to manage options for this site.' ) );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;div class=&quot;wrap&quot; id=&quot;ag4&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( function_exists( 'screen_icon' ) ) {&nbsp;</div></li><li><div>            screen_icon();&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;h2&gt;' . $this-&gt;plugin['plugin-name'] . '&lt;/h2&gt;';&nbsp;</div></li><li><div>        echo '&lt;form action=&quot;' . admin_url( $this-&gt;plugin['action'] ) . '&quot; method=&quot;post&quot; id=&quot;ag4_form&quot;&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        //ISCLOG::pdh( $this-&gt;options );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // print form nonce&nbsp;</div></li><li><div>        echo '&lt;p style=&quot;display:none;&quot;&gt;&lt;input type=&quot;hidden&quot; id=&quot;_' . $this-&gt;plugin['nonce'] . '&quot; name=&quot;_' . $this-&gt;plugin['nonce'] . '&quot; value=&quot;' . wp_create_nonce( $this-&gt;plugin['nonce'] ) . '&quot; /&gt;';&nbsp;</div></li><li><div>        echo '&lt;input type=&quot;hidden&quot; name=&quot;_wp_http_referer&quot; value=&quot;' . ( esc_attr( $_SERVER['REQUEST_URI'] ) ) . '&quot; /&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $section_names = array(&nbsp;</div></li><li><div>            'general' =&gt; 'General', &nbsp;</div></li><li><div>            'output' =&gt; '404 Output Options', &nbsp;</div></li><li><div>            'tracking' =&gt; 'Tracking/Logging', &nbsp;</div></li><li><div>            'css' =&gt; 'CSS Editor', &nbsp;</div></li><li><div>            'html' =&gt; 'HTML Editor', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>        echo '&lt;div id=&quot;ag4-tabs&quot; class=&quot;ui-tabs ui-widget ui-widget-content ui-corner-all&quot;&gt;';&nbsp;</div></li><li><div>        ?&gt;&lt;ul id=&quot;ag4_tabs_ul&quot; class=&quot;hide-if-no-js&quot;  style=&quot;display:none&quot;&gt;&lt;?php foreach ( $section_names as $section_id =&gt; $section_name ) {&nbsp;</div></li><li><div>            printf( '&lt;li&gt;&lt;a href=&quot;#section-%s&quot;&gt;%s&lt;/a&gt;&lt;/li&gt;', esc_attr( $section_id ), $section_name );&nbsp;</div></li><li><div>        } ?&gt;&lt;/ul&gt;&lt;?php&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;div id=&quot;section-general&quot; class=&quot;ag4-section&quot;&gt;&lt;h3 class=&quot;hide-if-js&quot;&gt;General&lt;/h3&gt;';&nbsp;</div></li><li><div>        echo '&lt;table class=&quot;form-table&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;th scope=&quot;row&quot;&gt;Enable/Disable Plugin&lt;/th&gt;&lt;td&gt;&lt;fieldset&gt;&lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;span&gt;Enable/Disable handling errors&lt;/span&gt;&lt;/legend&gt;';&nbsp;</div></li><li><div>        echo '&lt;label for=&quot;ag4_enabled&quot; style=&quot;font-weight:bold&quot; title=&quot;Handle Erorrs&quot;&gt;&lt;input type=&quot;radio&quot;' . checked( $this-&gt;options['enabled'], '1', false ) . ' value=&quot;1&quot; name=&quot;ag4_enabled&quot; id=&quot;ag4_enabled_on&quot; /&gt; Enable plugin to handle 404s, immediately&lt;/label&gt;&lt;br /&gt;';&nbsp;</div></li><li><div>        echo '&lt;label for=&quot;ag4_enabled&quot; title=&quot;Turn off this plugin&quot;&gt;&lt;input type=&quot;radio&quot;' . checked( $this-&gt;options['enabled'], '0', false ) . ' value=&quot;0&quot; name=&quot;ag4_enabled&quot; id=&quot;ag4_enabled_off&quot; /&gt; Disable this plugin from handling 404s&lt;/label&gt;&lt;br /&gt;';&nbsp;</div></li><li><div>        echo '&lt;/fieldset&gt;&lt;/td&gt;&lt;/tr&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;tr&gt;&lt;th scope=&quot;row&quot;&gt;404.php Template File&lt;/th&gt;&lt;td&gt;';&nbsp;</div></li><li><div>        echo '&lt;fieldset&gt;&lt;legend class=&quot;screen-reader-text&quot;&gt;&lt;span&gt;404.php Template File&lt;/span&gt;&lt;/legend&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $error_templates = array(&nbsp;</div></li><li><div>            __DIR__ . '/404.php', &nbsp;</div></li><li><div>            get_404_template(), &nbsp;</div></li><li><div>            TEMPLATEPATH . '/404.php', &nbsp;</div></li><li><div>            dirname( TEMPLATEPATH ) . '/default/404.php', &nbsp;</div></li><li><div>            'Custom File Location', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $error_templates = array_unique( $error_templates );&nbsp;</div></li><li><div>        $can_edit = current_user_can( 'edit_files' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        foreach ( $error_templates as $v =&gt; $k ) {&nbsp;</div></li><li><div>            if ( $k === 'Custom File Location' ) {&nbsp;</div></li><li><div>                echo '&lt;label for=&quot;ag4_404_handler&quot; title=&quot;' . $k . '&quot;&gt;&lt;input type=&quot;radio&quot;' . checked( $this-&gt;options['404_handler'], $k, false );&nbsp;</div></li><li><div>                echo ' value=&quot;' . $k . '&quot; name=&quot;ag4_404_handler&quot; id=&quot;ag4_other_file&quot; /&gt; ';&nbsp;</div></li><li><div>                echo '&lt;input type=&quot;text&quot; value=&quot;Custom File Location&quot; class=&quot;code&quot; id=&quot;ag4_404_choose_file&quot; style=&quot;min-width:35em;&quot; name=&quot;ag4_404_choose_file&quot; title=&quot;File Path&quot;&gt;&lt;/label&gt;&lt;br /&gt;';&nbsp;</div></li><li><div>            } elseif ( file_exists( $k ) ) {&nbsp;</div></li><li><div>                echo '&lt;label for=&quot;ag4_404_handler&quot; title=&quot;' . $k . '&quot;&gt;&lt;input type=&quot;radio&quot;' . checked( $this-&gt;options['404_handler'], $k, false );&nbsp;</div></li><li><div>                echo ' value=&quot;' . $k . '&quot; name=&quot;ag4_404_handler&quot; id=&quot;ag4_404_handler_' . $v . '&quot; /&gt; &lt;code&gt;' . $k . '&lt;/code&gt; ';&nbsp;</div></li><li><div>                echo ( $can_edit ? '&lt;a href=&quot;' . admin_url( &quot;theme-editor.php?file={$k}&quot; ) . '&quot;&gt;(EDIT)&lt;/a&gt;' : '' ) . '&lt;/label&gt;&lt;br /&gt;';&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>        echo '&lt;/fieldset&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;';&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;binfo&quot;&gt;Add to existing 404.php theme file';&nbsp;</div></li><li><div>        echo ' in your template directory:  &lt;br /&gt;Add &lt;code style=&quot;font-size:11px;&quot;&gt;if ( function_exists( \'aa_google_404\' ) ) { aa_google_404(); }&lt;/code&gt; in the body and save as';&nbsp;</div></li><li><div>        echo ' 404.php in your template folder.&lt;br /&gt; - See the included 404.php file for a simple working example.&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        /**$this-&gt;form_field( 2, 'Google API Key &lt;a href=&quot;http://code.google.com/apis/ajaxsearch/signup.html&quot;&gt;Get One&lt;/a&gt;', 'api_key', 'This identifies your blog to Google.' );&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;binfo&quot;&gt;You need a Google API Key for this site to display the ajax results.  Go ahead and add your AdSense ID as future versions of this plugin will allow you to incorporate AdSense setups compliant with Google Guidelines.&lt;/p&gt;';            */&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;/div&gt;&lt;!--section--&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;div class=&quot;ag4-section&quot; id=&quot;section-output&quot;&gt;&lt;h3 class=&quot;hide-if-js&quot;&gt;404 Output Options&lt;/h3&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;form_field( 1, 'Show Recent Posts', 'recent_posts', 'Displays List of Recent Posts' );&nbsp;</div></li><li><div>        $this-&gt;form_field( 3, 'Recent Posts # to Show', 'recent_num', 'How many recent posts to show..' );&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;binfo&quot;&gt;Shows a list of Recent Posts on your blog.&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;form_field( 1, 'Show Popular Tag Cloud', 'tag_cloud', 'Displays Popular Tag Cloud' );&nbsp;</div></li><li><div>        $this-&gt;form_field( 3, 'Tag # to Use', 'tag_cloud_num', 'How many tags to use, otherwise ALL tags..' );&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;binfo&quot;&gt;Displays a tag cloud (heatmap) from provided data. of your popular tags where each tag is displayed with a font-size showing how popular the tag is, more popular tags are larger.&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;form_field( 1, 'Add &lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/seo/updated-robotstxt-for-wordpress.html&quot;&gt;robots meta&lt;/a&gt; to prevent indexing', 'robots_meta', 'Prevent 404 pages from being indexed. This prevents your error pages from being indexed by Google and other search engines, which saves your PageRank for your non-error pages.  Highly recommended, Google recommended.' );&nbsp;</div></li><li><div>        $this-&gt;form_field( 2, 'Robots meta tag value &lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/seo/updated-robotstxt-for-wordpress.html&quot;&gt;(?)&lt;/a&gt;', 'robots_tag', 'Value of robots meta tag.' );&nbsp;</div></li><li><div>        echo '&lt;/div&gt;&lt;!--section--&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;div class=&quot;ag4-section&quot; id=&quot;section-tracking&quot;&gt;&lt;h3 class=&quot;hide-if-js&quot;&gt;404 Tracking/Logging&lt;/h3&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;binfo&quot;&gt;Use Google Analytics to &lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/seo/tip-google-analytics-404-error-page.html&quot;&gt;Track/Log Errors&lt;/a&gt;.&lt;/p&gt;';&nbsp;</div></li><li><div>        $this-&gt;form_field( 1, '&lt;a href=&quot;http://www.google.com/support/googleanalytics/bin/answer.py?hl=en&answer=86927&quot;&gt;Track&lt;/a&gt; &lt;a target=&quot;_blank&quot; href=&quot;http://www.google.com/support/forum/p/Google+Analytics/thread?tid=09386ba811b3e7d8&hl=en&quot;&gt;Errors&lt;/a&gt; with Google Analytics', 'analytics_log', 'Use Google Analytics to Track/Log Errors' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;form_field( 2, 'Google Analytics Key &lt;small&gt;UA-733153-7&lt;/small&gt; &lt;a target=&quot;_blank&quot; href=&quot;https://www.google.com/adsense/support/bin/answer.py?answer=45465&quot;&gt;Get One&lt;/a&gt;', 'analytics_key', 'The tracking ID for this site.' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;binfo&quot;&gt;This is clever as instead of using your server and database to store 404s, which results in crazy additional server-load, this method uses javascript so google machines will do all the work.  &lt;code&gt;&quot;/404.html?page=&quot; + document.location.pathname + document.location.search + &quot;&amp;from=&quot; + document.referrer&lt;/code&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        $this-&gt;form_field( '2j', 'Tracking URL for reports &lt;a target=&quot;_blank&quot; href=&quot;http://www.google.com/support/googleanalytics/bin/answer.py?answer=75129&quot;&gt;Get One&lt;/a&gt;', 'analytics_url', 'Lets you view errors in analytics!' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $this-&gt;form_field( 2, 'Your Google CSE ID &lt;small&gt;partner-pub-4356884677303281:hcqlgw-sn16&lt;/small&gt; &lt;a target=&quot;_blank&quot; href=&quot;https://support.google.com/adsense/answer/1055578?hl=en&quot;&gt;(?)&lt;/a&gt;', 'cse_id', 'Get one using AdSense account or a CSE' );&nbsp;</div></li><li><div>        echo '&lt;/div&gt;&lt;!--section--&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;div class=&quot;ag4-section&quot; id=&quot;section-html&quot;&gt;&lt;h3 class=&quot;hide-if-js&quot;&gt;HTML Editor&lt;/h3&gt;';&nbsp;</div></li><li><div>        $this-&gt;form_field( 5, '', 'html', 'This controls the output of the plugin.  Move stuff around, change what you want, and load the default if you mess up too much.' );&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;binfo&quot;&gt;This lets you determine the placement and any extra html you want output by this plugin.&lt;br /&gt;&lt;br /&gt;&lt;code&gt;%google%&lt;/code&gt; - required!  This will be the search box and search results&lt;br /&gt;&lt;code&gt;%error_title%&lt;/code&gt; - replaced with the status code and error phrase - 404 Not Found&lt;br /&gt;&lt;code&gt;%tag_cloud%&lt;/code&gt; - replaced with your tag cloud if enabled&lt;br /&gt;&lt;code&gt;%recent_posts%&lt;/code&gt; - replaced with the recent posts html if enabled&lt;/p&gt;';&nbsp;</div></li><li><div>        echo '&lt;/div&gt;&lt;!--section--&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;div class=&quot;ag4-section&quot; id=&quot;section-css&quot;&gt;&lt;h3 class=&quot;hide-if-js&quot;&gt;CSS Editor&lt;/h3&gt;';&nbsp;</div></li><li><div>        $this-&gt;form_field( 5, '', 'css', 'The css that controls the google ajax search results.. (and anything else on the page)' );&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;binfo&quot;&gt;Modify the css that is output (inline) on your 404 error pages.  Changes the appearance of, well, everything.&lt;/p&gt;';&nbsp;</div></li><li><div>        echo '&lt;/div&gt;&lt;!--section--&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;/div&gt;&lt;!--ag4-tabs--&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;submit hide-if-js&quot;&gt;&lt;input type=&quot;submit&quot; class=&quot;button-primary&quot; name=&quot;ag4_action_save&quot; id=&quot;ag4_action_save&quot; value=&quot;Save Changes &raquo;&quot; /&gt;  &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&nbsp;&nbsp;&nbsp;&nbsp;';&nbsp;</div></li><li><div>        echo '&lt;input type=&quot;submit&quot; class=&quot;button button-primary button-large&quot; name=&quot;ag4_action_reset&quot; id=&quot;ag4_action_reset&quot; value=&quot;Revert to Defaults &raquo;&quot; /&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>        echo '&lt;/form&gt;&lt;br style=&quot;clear:both;&quot; /&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // just a temp solution.. will be cleaned for next release&nbsp;</div></li><li><div>        echo &quot;&lt;form style='display: none' method='post' action='&quot; . admin_url( $this-&gt;plugin['action'] ) . &quot;' id='ag4_reset'&gt;&lt;p&gt;&quot;;&nbsp;</div></li><li><div>        echo &quot;&lt;input type='hidden' name='ag4_action_reset' id='ag4_action_reset' value='&quot; . wp_create_nonce( 'ag4_action_reset_nonce' ) . &quot;' /&gt;&lt;/p&gt;&lt;/form&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo &quot;&lt;p&gt;&lt;a id='aamainsubmit' title='Save Changes' href='#' class='button button-primary button-large hide-if-no-js ag4submit aasubmit-button'&gt;Save&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;p class=&quot;hide-if-no-js&quot;&gt;';&nbsp;</div></li><li><div>        echo &quot;&lt;a title='Reset all options EXCEPT CSE ID and Analytics KEY - including code to the default values' href='#' class='ag4reset'&gt;&lt;em class='aasubmit-b'&gt;RESET TO DEFAULTS&lt;/em&gt;&lt;/a&gt;&quot;;&nbsp;</div></li><li><div>        echo '&lt;/p&gt;&lt;hr style=&quot;margin-top:2em;&quot; /&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;div style=&quot;width:300px;float:left;&quot;&gt;&lt;p&gt;&lt;br class=&quot;clear&quot; /&gt;&lt;/p&gt;&nbsp;</div></li><li><div>        &lt;h3&gt;Articles from AskApache&lt;/h3&gt;';&nbsp;</div></li><li><div>        echo '&lt;ul&gt;&lt;li&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/seo/seo-secrets.html&quot;&gt;SEO Secrets of AskApache.com&lt;/a&gt;&lt;/li&gt;';&nbsp;</div></li><li><div>        echo '&lt;li&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/seo/seo-advanced-pagerank-indexing.html&quot;&gt;Controlling Pagerank and Indexing&lt;/a&gt;&lt;/li&gt;';&nbsp;</div></li><li><div>        echo '&lt;li&gt;&lt;a target=&quot;_blank&quot; ref=&quot;http://www.askapache.com/htaccess/htaccess.html&quot;&gt;Ultimate .htaccess Tutorial&lt;/a&gt;&lt;/li&gt;';&nbsp;</div></li><li><div>        echo '&lt;li&gt;&lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/seo/updated-robotstxt-for-wordpress.html&quot;&gt;Robots.txt Info for WordPress&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;/div&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Add Help&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function add_help() {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $current_screen = get_current_screen();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $help = '&lt;h4&gt;Fixing Status Headers&lt;/h4&gt;';&nbsp;</div></li><li><div>        $help .= '&lt;p&gt;For super-advanced users, or those with access and knowledge of Apache &lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/htaccess/htaccess.html&quot;&gt;.htaccess/httpd.conf files&lt;/a&gt;';&nbsp;</div></li><li><div>        $help .= ' you should check that your error pages are correctly returning a &lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/htaccess/apache-status-code-headers-errordocument.html&quot;&gt;&lt;code&gt;404 Not Found&lt;/code&gt;';&nbsp;</div></li><li><div>        $help .= ' HTTP Header&lt;/a&gt; and not a &lt;code&gt;200 OK&lt;/code&gt; Header which appears to be the default for many WP installs, this plugin attempts to fix this using PHP, but the best way I have found';&nbsp;</div></li><li><div>        $help .= ' is to add the following to your &lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/htaccess/htaccess.html&quot;&gt;.htaccess&lt;/a&gt; file.&lt;/p&gt;';&nbsp;</div></li><li><div>        $help .= '&lt;pre&gt;ErrorDocument 404 /index.php?error=404' . &quot;\n&quot; . 'Redirect 404 /index.php?error=404&lt;/pre&gt;';&nbsp;</div></li><li><div>        $help .= '&lt;p&gt;You can check your headers by requesting a bad url on your site using my online tool &lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/online-tools/http-headers-tool/&quot;&gt;Advanced HTTP Headers&lt;/a&gt;.&lt;/p&gt;';&nbsp;</div></li><li><div>        $help .= '&lt;h4&gt;Future Awesomeness&lt;/h4&gt;';&nbsp;</div></li><li><div>        $help .= '&lt;p&gt;The goal of this plugin is to boost your sites SEO by telling search engines to ignore your error pages, with the focus on human users to increase people staying on your site and being';&nbsp;</div></li><li><div>        $help .= ' able to find what they were originally looking for on your site.  Because I am obsessed with fast web pages, many various speed/efficiency improvements are also on the horizon.&lt;/p&gt;';&nbsp;</div></li><li><div>        $help .= '&lt;p&gt;Another feature that I am using with beta versions of this plugin, is tracking information for you to go over at your leisure, to fix recurring problems.  The information is collected';&nbsp;</div></li><li><div>        $help .= ' is the requested url that wasnt found, the referring url that contains the invalid link.&lt;/p&gt;';&nbsp;</div></li><li><div>        $help .= '&lt;p&gt;The reason I didnt include it in this release is because for sites like AskApache with a very high volume of traffic (and thus 404 requests) this feature can create a bottleneck and ';&nbsp;</div></li><li><div>        $help .= 'slow down or freeze a blog if thousands of 404 errors are being requested and saved to the database.  This could also very quickly be used by malicious entities as a Denial of Service ';&nbsp;</div></li><li><div>        $help .= 'attack.  So I am figuring out and putting into place limits.. like once a specific requested url resulting in a not found error has been requested 100x in a day, an email is sent to the ';&nbsp;</div></li><li><div>        $help .= 'blog administrator.  But to prevent Email DoS and similar problems with the number and interval of emails allowed by your email provider other considerations on limits need to be examined.&lt;/p&gt;';&nbsp;</div></li><li><div>        $help .= '&lt;h5&gt;Comments/Questions&lt;/h5&gt;&lt;p&gt;&lt;strong&gt;Please visit &lt;a target=&quot;_blank&quot; href=&quot;http://www.askapache.com/&quot;&gt;AskApache.com&lt;/a&gt; or send me an email at &lt;code&gt;webmaster@askapache.com&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        add_contextual_help( $current_screen, $help );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Clean way to add html for form fields&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return void&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function form_field( $w = 1, $title = '', $id = '', $desc = '' ) {&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        echo '&lt;div&gt;';&nbsp;</div></li><li><div>        switch ( $w ) :&nbsp;</div></li><li><div>            case 1:&nbsp;</div></li><li><div>                echo &quot;&lt;p class='c4r'&gt;&lt;input title='{$desc}' name='ag4_{$id}' size='10' &quot;;&nbsp;</div></li><li><div>                echo &quot;type='checkbox' id='ag4_{$id}' value='{$this-&gt;options[$id]}' &quot; . checked( '1', $this-&gt;options[ $id ], false ) . ' /&gt;';&nbsp;</div></li><li><div>                echo &quot;&lt;label title='{$desc}' for='ag4_{$id}'&gt; {$title}&lt;/label&gt;&lt;br style='clear:both;' /&gt;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>            case 2:&nbsp;</div></li><li><div>                echo &quot;&lt;p class='c4r'&gt;&lt;label title='{$desc}' for='ag4_{$id}'&gt; {$title}:&lt;/label&gt;&lt;br style='clear:both;' /&gt;&quot;;&nbsp;</div></li><li><div>                echo &quot;&lt;input title='{$desc}' name='ag4_{$id}' type='text' id='ag4_{$id}' value='&quot; . ( isset( $this-&gt;options[ $id ] ) ? $this-&gt;options[ $id ] : '' ) . &quot;' /&gt;&lt;br style='clear:both;' /&gt;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>            case '2j':&nbsp;</div></li><li><div>                echo &quot;&lt;p class='c4r'&gt;&lt;label title='{$desc}' for='ag4_{$id}'&gt; {$title}:&lt;/label&gt;&lt;br style='clear:both;' /&gt;&quot;;&nbsp;</div></li><li><div>                echo &quot;&lt;input title='{$desc}' name='ag4_{$id}' type='text' id='ag4_{$id}' value='&quot; . ( isset( $this-&gt;options[ $id ] ) ? stripslashes( $this-&gt;options[ $id ] ) : '' ) . &quot;' /&gt;&lt;br style='clear:both;' /&gt;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            case '2h':&nbsp;</div></li><li><div>                echo &quot;&lt;p class='c4r hide-if-js'&gt;&lt;label title='{$desc}' for='ag4_{$id}'&gt; {$title}:&lt;/label&gt;&lt;br style='clear:both;' /&gt;&quot;;&nbsp;</div></li><li><div>                echo &quot;&lt;input title='{$desc}' name='ag4_{$id}' type='text' id='ag4_{$id}' value='&quot; . ( isset( $this-&gt;options[ $id ] ) ? $this-&gt;options[ $id ] : '' ) . &quot;' /&gt;&lt;br style='clear:both;' /&gt;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>            case 3:&nbsp;</div></li><li><div>                echo &quot;&lt;p class='c4r'&gt;&lt;input title='{$desc}' name='ag4_{$id}' style='float:left;margin-right:5px;' size='4' type='text' id='ag4_{$id}' &quot;;&nbsp;</div></li><li><div>                echo &quot;value='&quot; . ( isset( $this-&gt;options[ $id ] ) ? $this-&gt;options[ $id ] : '' ) . &quot;' /&gt;&lt;label title='{$desc}' for='ag4_{$id}'&gt; {$title}:&lt;/label&gt;&lt;br style='clear:both;' /&gt;&lt;/p&gt;&quot;;&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>            case 5:&nbsp;</div></li><li><div>                echo &quot;&lt;div&gt;&lt;label for='ag4_{$id}'&gt;{$desc}&lt;br /&gt;&lt;/label&gt;&lt;br /&gt;{$title}&lt;/div&gt;&quot;;&nbsp;</div></li><li><div>                echo &quot;&lt;div&gt;&lt;textarea title='{$desc}' cols='70' rows='12' name='ag4_{$id}' id='ag4_{$id}' class='codepress {$id}'&gt;&quot; . htmlspecialchars( $this-&gt;code[ $id ] ) . '&lt;/textarea&gt;&lt;/div&gt;';&nbsp;</div></li><li><div>            break;&nbsp;</div></li><li><div>        endswitch;&nbsp;</div></li><li><div>        echo '&lt;/div&gt;';&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Get all plugin data by reading it&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return array Plugin data&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function get_plugin_data( $force = false, $type = 'settings' ) {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>        AA_G404D && ISCLOG::tw( ( $force ? 'force: TRUE' : 'force: FALSE' ) );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        $plugin = get_option( 'askapache_google_404_plugin' );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( $force === true || $plugin === false || ! is_array( $plugin ) || ! array_key_exists( 'file', $plugin ) || &quot;{$plugin['file']}&quot; !== __FILE__ ) {&nbsp;</div></li><li><div>            clearstatcache();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $data = $this-&gt;read_file( __FILE__, 1450 );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $mtx = $plugin = array();&nbsp;</div></li><li><div>            preg_match_all( '/[^a-z0-9]+((?:[a-z0-9]{2, 25})(?:\ ?[a-z0-9]{2, 25})?(?:\ ?[a-z0-9]{2, 25})?)\:[\s\t]*(.+)/i', $data, $mtx, PREG_SET_ORDER );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $valids = array(&nbsp;</div></li><li><div>                'plugin-name', &nbsp;</div></li><li><div>                'short-name', &nbsp;</div></li><li><div>                'author', &nbsp;</div></li><li><div>                'version', &nbsp;</div></li><li><div>                'wordpress-uri', &nbsp;</div></li><li><div>                'author-uri', &nbsp;</div></li><li><div>                'plugin-uri', &nbsp;</div></li><li><div>                'file', &nbsp;</div></li><li><div>                'title', &nbsp;</div></li><li><div>                'page', &nbsp;</div></li><li><div>                'pagenice', &nbsp;</div></li><li><div>                'nonce', &nbsp;</div></li><li><div>                'hook', &nbsp;</div></li><li><div>                'action', &nbsp;</div></li><li><div> );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            foreach ( $mtx as $m ) {&nbsp;</div></li><li><div>                $mm = trim( str_replace( ' ', '-', strtolower( $m[1] ) ) );&nbsp;</div></li><li><div>                if ( in_array( $mm, $valids, true ) ) {&nbsp;</div></li><li><div>                    $plugin[ $mm ] = str_replace( array( &quot;\r&quot;, &quot;\n&quot;, &quot;\t&quot; ), '', trim( $m[2] ) );&nbsp;</div></li><li><div>                }&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            $plugin['file'] = __FILE__;&nbsp;</div></li><li><div>            $plugin['title'] = '&lt;a href=&quot;' . $plugin['plugin-uri'] . '&quot; title=&quot;Visit plugin homepage&quot;&gt;' . esc_attr( $plugin['plugin-name'] ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>            $plugin['author'] = '&lt;a href=&quot;' . $plugin['author-uri'] . '&quot; title=&quot;Visit author homepage&quot;&gt;' . esc_attr( $plugin['author'] ) . '&lt;/a&gt;';&nbsp;</div></li><li><div>            $plugin['page'] = basename( __FILE__ );&nbsp;</div></li><li><div>            $plugin['pagenice'] = rtrim( $plugin['page'], '.php' );&nbsp;</div></li><li><div>            $plugin['nonce'] = 'form_' . $plugin['pagenice'];&nbsp;</div></li><li><div>            $plugin['hook'] = $type . '_page_' . $plugin['pagenice'];&nbsp;</div></li><li><div>            $plugin['action'] = ( ( $type === 'settings' ) ? 'options-general' : $type ) . '.php?page=' . $plugin['page'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        if ( array_key_exists( 'short-name', $plugin ) && strpos( $plugin['short-name'], '&lt;' . 'img' ) === false ) {&nbsp;</div></li><li><div>            $plugin['short-name'] = '&lt;img style=&quot;position:relative; bottom:-3px&quot; src=&quot;' . plugins_url( 'f/i/icon-menu.png', __FILE__ ) . '&quot; alt=&quot;&quot; /&gt;&nbsp;' . $plugin['short-name'];&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D && ISCLOG::tw( ( $force ? 'force: TRUE' : 'force: FALSE' ) );&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        return $plugin;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>    /**&nbsp;</div></li><li><div>     * Reads a file with fopen and fread for a binary-safe read.  $f is the file and $b is how many bytes to return, useful when you dont want to read the whole file (saving mem)&nbsp;</div></li><li><div>     *&nbsp;</div></li><li><div>     * @return string|bool - the content of the file or false on error&nbsp;</div></li><li><div>     */&nbsp;</div></li><li><div>    function read_file( $f, $b = false ) {&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // file pointer&nbsp;</div></li><li><div>        $fp = null;&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // data read&nbsp;</div></li><li><div>        $d = '';&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if no size specified, read entire file&nbsp;</div></li><li><div>        if ( $b === false ) {&nbsp;</div></li><li><div>            $b = @filesize( $f );&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>            // in case filesize failed&nbsp;</div></li><li><div>            if ( $b === false ) {&nbsp;</div></li><li><div>                $b = 4098;&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // return false on failures&nbsp;</div></li><li><div>        if ( ! ( $b &gt; 0 ) || ! false === ( $fp = fopen( $f, 'rb' ) ) || ! is_resource( $fp ) ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( 'ERROR OPENING FILE!!! ' . $f );&nbsp;</div></li><li><div>            AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>            return false;&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // if read_length greater than 512 bytes, &nbsp;</div></li><li><div>        if ( $b &gt; 8192 ) {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( basename( $f ) . ': READ/REQUESTED = ' . $b . '/' . strlen( $d ) . '    read size is &gt; 8192 bytes so read in the data in 128 byte increments' );&nbsp;</div></li><li><div>            // Read in the data in 128 byte increments&nbsp;</div></li><li><div>            while ( ! feof( $fp ) && strlen( $d ) &lt; $b ) {&nbsp;</div></li><li><div>                $d .= fread( $fp, 128 );&nbsp;</div></li><li><div>            }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        } else {&nbsp;</div></li><li><div>            AA_G404D && ISCLOG::tw( basename( $f ) . ': READ/REQUESTED = ' . $b . '/' . strlen( $d ) . '    read size is &lt; 8192 bytes' );&nbsp;</div></li><li><div>            // if read size is &lt; than 8192 bytes, read it all in straight&nbsp;</div></li><li><div>            $d = fread( $fp, $b );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // close file pointer if still open&nbsp;</div></li><li><div>        if ( is_resource( $fp ) ) {&nbsp;</div></li><li><div>            fclose( $fp );&nbsp;</div></li><li><div>        }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        AA_G404D_F && ISCLOG::ti();&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>        // return read data&nbsp;</div></li><li><div>        return $d;&nbsp;</div></li><li><div>    }&nbsp;</div></li><li><div>&nbsp;</div></li><li><div>}&nbsp;</div></li></ol></pre></dd></dl> </section> </article></div><div id="sidebar"><ul class="widgets"><li> <a href="http://hookr.io/plugin/"><img src="http://hookr.io/wp-content/themes/hookr/assets/images/plugin-download.jpg" /></a></li><li id="versions"><dl><dt>Version(s)</dt><dd><dl><dt>Since</dt><dd> 5.0.0</dd><dt>Others</dt><dd><ul><li><a href="http://hookr.io/plugins/askapache-google-404/5.1.1/classes/aa_g404/" class="active">5.1.1</a></li><li><a href="http://hookr.io/plugins/askapache-google-404/5.1.0/classes/aa_g404/" class="">5.1.0</a></li><li><a href="http://hookr.io/plugins/askapache-google-404/5.0.2/classes/aa_g404/" class="">5.0.2</a></li><li><a href="http://hookr.io/plugins/askapache-google-404/5.0.1/classes/aa_g404/" class="">5.0.1</a></li><li><a href="http://hookr.io/plugins/askapache-google-404/5.0.0/classes/aa_g404/" class="">5.0.0</a></li></ul></dd></dl></dd></dl></li><li id="tags"><dl><dt>Tags</dt><dd><ul><li><span></span>plugin</li><li><span></span>class</li><li><span></span>AA_G404</li><li><span></span>AskApache Google 404</li><li><span></span>5.1.1</li></ul></dd></dl></li></ul></div></div></div><script>Hookr.View.init();Hookr.Single.init();</script><footer><div><ul id="nav-social" class="pivot" role="navigation"><li id="twitter"><a href="http://twitter.com/hookr_io" title="Follow me!"></a></li></ul><div> &copy; 2017 hookr.io <strong>(beta)</strong> | <a href="http://hookr.io/privacy/" title="Privacy">Privacy</a> | Proudly Powered by WordPress</div></div> </footer> <script type="text/javascript" src="http://hookr.io/wp-content/cache/minify/000000/M9EvL9BNzU1KTdHLzcwDAA.js"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-49583310-1','hookr.io');ga('send','pageview');</script></body></html>